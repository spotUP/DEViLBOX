# PT36 (ProTracker 3.6)

**Status:** NATIVE_SAMPLER — PCM extracted, plays via Sampler engine
**Parser:** `src/lib/import/formats/PT36Parser.ts`
**Extensions:** `.mod` (IFF-wrapped)
**UADE name:** N/A (native sampler)
**Reference files:** `Reference Music/ProTracker 36/`

---

## Overview

ProTracker 3.6 wraps a standard 4-channel ProTracker MOD inside an IFF FORM/MODL
container. The PTDT chunk contains the raw MOD data; INFO carries song metadata
including CIA tempo; VERS carries the tracker version string; CMNT carries author
and comments. This is the standard format produced by ProTracker 3.6 on the Amiga.

Reference: OpenMPT `soundlib/Load_pt36.cpp`

---

## File Layout

### IFF Container

All multi-byte fields are big-endian:

```
Offset  Size  Description
------  ----  -----------
0       4     "FORM"
4       4     totalSize (u32BE, size of everything after this field)
8       4     "MODL" (form type)
12      ...   IFF chunks
```

### IFF Chunk Structure

```
signature (u32BE, 4-byte ASCII)
chunkSize  (u32BE) — includes the 8-byte header
  NOTE: first chunk's chunkSize -= 4 due to "MODL" being counted
data[chunkSize - 8 bytes]
```

| Chunk | Description |
|-------|-------------|
| `VERS` | 4-byte pad + "PT" (2 bytes) + version string |
| `INFO` | 64-byte PT36InfoChunk (see below) |
| `CMNT` | author[32] (null-terminated) + comment text |
| `PTDT` | Raw ProTracker MOD data |

---

## Detection Algorithm

```
1. buf.byteLength >= 12
2. buf[0..3] == "FORM"
3. buf[8..11] == "MODL"
```

---

## PT36InfoChunk (64 bytes, all u16BE except name[32])

```
Offset  Size  Description
------  ----  -----------
0       32    name[32] (song title, null-padded)
32      2     numSamples (u16BE)
34      2     numOrders (u16BE)
36      2     numPatterns (u16BE)
38      2     volume (u16BE, 0–64; 0 = ignore)
40      2     tempo (u16BE, BPM; used when CIA mode active)
42      2     flags (u16BE): bit 8 clear = VBlank; bit 8 set = CIA tempo
44      2     dateDay (u16BE)
46      2     dateMonth (u16BE, 1–12)
48      2     dateYear (u16BE, offset from 1900)
50      14    hour/min/sec/msec playtime fields (informational only)
```

---

## PTDT Chunk (Raw ProTracker MOD)

The PTDT chunk contains a standard 31-instrument ProTracker MOD. The MOD layout:

```
Offset  Size  Description
------  ----  -----------
0       20    title[20]
20      930   31 × 30-byte sample headers
950     1     song length (u8)
951     1     restart position (u8)
952     128   pattern order table (128 × u8)
1080    4     format tag ("M.K." or "M!K!")
1084    ...   pattern data (numPatterns × 64 rows × 4 channels × 4 bytes)
...     ...   sequential raw 8-bit signed PCM sample data
```

**Known bug in some PT36 files:** PTDT chunk sizes are incorrect when samples exceed
64 KiB (off by 65536 per large sample). Since PTDT is always the last chunk, the
parser passes the entire remaining buffer to the MOD parser.

---

## Reference Implementations

- **Parser source:** `src/lib/import/formats/PT36Parser.ts`
- **OpenMPT reference:** `soundlib/Load_pt36.cpp`
