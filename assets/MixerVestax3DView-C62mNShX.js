import{j as e,aQ as t,aR as s}from"./index-zx6LJBPK.js";import{r as a}from"./vendor-utils-XMmR-oGw.js";import{P as n,O as r,C as o,u as i}from"./DJ3DCameraControls-DKofB3_2.js";import{V as l}from"./DJView-B1pcUmTm.js";import{V as c,u as m,a as u,R as d,b as h,M as f}from"./react-three-fiber.esm-DUbY8J_y.js";import"./vendor-react-DkDaD07v.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";import"./DJKeyboardHandler-Dzr29xNs.js";import"./parseModuleToSong-BCo4MrbT.js";import"./ReadOnlyPatternCanvas-D4F3fqwn.js";import"./sortable.esm-Nw3Rboz6.js";import"./MasterEffectsModal-BHri30Qv.js";import"./guitarMLRegistry-Ct9uudVS.js";import"./useVisualizationAnimation-D37DdYyX.js";import"./NoteRepeatEngine-CA535fLg.js";import"./MpcResamplerDSP-nORj9P5z.js";import"./AudioContextSingleton-BmUieoGD.js";const x="/models/vestax-mixer.glb",V=.02,p=.75*-Math.PI,b=.75*Math.PI-p,D=new f,g=new f,k=new f,v=new f,N=new f;function E(e,t,s){g.makeTranslation(t.x,t.y,t.z),D.makeRotationY(e),k.makeTranslation(-t.x,-t.y,-t.z),s.copy(g).multiply(D).multiply(k)}function C(e){return/Klamz_uv_Death_DJ_02/i.test(e)}function M(e){let t=e.replace(/^Mixer[\s_]+/,"");const s=t.match(/Klamz_uv_Death_DJ_02mixer_EXP(.+)/);s&&(t=s[1]),t=t.replace(/FBXASC032/g," ").trim();const a=/^(knob|fader|hfader|button|window)\d*$/;let n=t;for(;!a.test(n)&&/_\d+$/.test(n);)n=n.replace(/_\d+$/,"");return a.test(n)?n:t}function w({viewRef:n}){const{scene:r}=i(x),o=a.useRef(null),l=a.useRef(null),f=a.useRef({x:0,y:0}),D=a.useRef(0),{knobControls:g,faderControls:k,buttonControls:w}=a.useMemo(()=>{const e=t.getState;return{knobControls:[{meshName:"knob2",label:"CH1 Trim",action:t=>{e().setDeckTrimGain("A",t);try{s().getDeck("A").setTrimGain(t)}catch{}},readValue:()=>e().decks.A.trimGain,min:-12,max:12,defaultValue:0,centerDetent:!0},{meshName:"knob3",label:"CH1 EQ High",action:t=>{e().setDeckEQ("A","high",t);try{s().getDeck("A").setEQ("high",t)}catch{}},readValue:()=>e().decks.A.eqHigh,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob4",label:"CH1 EQ Mid",action:t=>{e().setDeckEQ("A","mid",t);try{s().getDeck("A").setEQ("mid",t)}catch{}},readValue:()=>e().decks.A.eqMid,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob5",label:"CH1 EQ Low",action:t=>{e().setDeckEQ("A","low",t);try{s().getDeck("A").setEQ("low",t)}catch{}},readValue:()=>e().decks.A.eqLow,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob13",label:"CH2 Trim",action:t=>{e().setDeckTrimGain("B",t);try{s().getDeck("B").setTrimGain(t)}catch{}},readValue:()=>e().decks.B.trimGain,min:-12,max:12,defaultValue:0,centerDetent:!0},{meshName:"knob12",label:"CH2 EQ High",action:t=>{e().setDeckEQ("B","high",t);try{s().getDeck("B").setEQ("high",t)}catch{}},readValue:()=>e().decks.B.eqHigh,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob11",label:"CH2 EQ Mid",action:t=>{e().setDeckEQ("B","mid",t);try{s().getDeck("B").setEQ("mid",t)}catch{}},readValue:()=>e().decks.B.eqMid,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob10",label:"CH2 EQ Low",action:t=>{e().setDeckEQ("B","low",t);try{s().getDeck("B").setEQ("low",t)}catch{}},readValue:()=>e().decks.B.eqLow,min:-24,max:6,defaultValue:0,centerDetent:!0},{meshName:"knob9",label:"Cue/Mix",action:t=>e().setCueMix(t),readValue:()=>e().cueMix,min:0,max:1,defaultValue:.5,centerDetent:!0},{meshName:"knob8",label:"Headphone Level",action:t=>e().setCueVolume(t),readValue:()=>e().cueVolume,min:0,max:1.5,defaultValue:1},{meshName:"knob7",label:"Master Level",action:t=>{e().setMasterVolume(t);try{s().mixer.setMasterVolume(t)}catch{}},readValue:()=>e().masterVolume,min:0,max:1.5,defaultValue:1},{meshName:"knob6",label:"Booth Level",action:t=>e().setBoothVolume(t),readValue:()=>e().boothVolume,min:0,max:1.5,defaultValue:1},{meshName:"knob",label:"CF Curve",action:t=>{const a=t<.33?"cut":t<.66?"smooth":"linear";e().setCrossfaderCurve(a);try{s().setCrossfaderCurve(a)}catch{}},readValue:()=>{const t=e().crossfaderCurve;return"cut"===t?.17:"smooth"===t?.5:.83},min:0,max:1,defaultValue:.5},{meshName:"knob1",label:"CF Reverse",action:t=>e().setHamsterSwitch(t>.5),readValue:()=>e().hamsterSwitch?1:0,min:0,max:1,defaultValue:0},{meshName:"knob15",label:"Filter",action:t=>{const a=2*(t-.5);e().setDeckFilter("A",a),e().setDeckFilter("B",a);try{s().getDeck("A").setFilterPosition(a),s().getDeck("B").setFilterPosition(a)}catch{}},readValue:()=>(e().decks.A.filterPosition+1)/2,min:0,max:1,defaultValue:.5,centerDetent:!0}],faderControls:[{meshName:"exp_fader1",label:"CH1 Volume",axis:"z",dragAxis:"y",travel:5.5,defaultValue:1,action:t=>{e().setDeckVolume("A",t);try{s().getDeck("A").setVolume(t)}catch{}},readValue:()=>e().decks.A.volume,min:0,max:1.5},{meshName:"fader1",label:"CH2 Volume",axis:"z",dragAxis:"y",travel:5.5,defaultValue:1,action:t=>{e().setDeckVolume("B",t);try{s().getDeck("B").setVolume(t)}catch{}},readValue:()=>e().decks.B.volume,min:0,max:1.5},{meshName:"fader4",label:"Master Volume",axis:"z",dragAxis:"y",travel:5,defaultValue:1,action:t=>{e().setMasterVolume(t);try{s().mixer.setMasterVolume(t)}catch{}},readValue:()=>e().masterVolume,min:0,max:1.5},{meshName:"hfader1",label:"Crossfader",axis:"x",dragAxis:"x",travel:5,defaultValue:.5,action:t=>{const a=e().hamsterSwitch?1-t:t;e().setCrossfader(a);try{s().setCrossfader(a)}catch{}},readValue:()=>{const t=e().hamsterSwitch,s=e().crossfaderPosition;return t?1-s:s},min:0,max:1},{meshName:"exp_hfader1",label:"Crossfader Alt",axis:"x",dragAxis:"x",travel:5,defaultValue:.5,action:t=>{const a=e().hamsterSwitch?1-t:t;e().setCrossfader(a);try{s().setCrossfader(a)}catch{}},readValue:()=>{const t=e().hamsterSwitch,s=e().crossfaderPosition;return t?1-s:s},min:0,max:1},{meshName:"knob14",label:"CF Monitor",axis:"x",dragAxis:"x",travel:3,defaultValue:1,action:t=>e().setSessionMonitorVolume(t),readValue:()=>e().sessionMonitorVolume,min:0,max:1.5}],buttonControls:[{meshName:"button1",label:"CUE CH1",action:()=>{const t=e(),a=!t.decks.A.pflEnabled;t.togglePFL("A");try{s().mixer.setPFL("A",a)}catch{}},readActive:()=>e().decks.A.pflEnabled},{meshName:"button2",label:"CUE CH2",action:()=>{const t=e(),a=!t.decks.B.pflEnabled;t.togglePFL("B");try{s().mixer.setPFL("B",a)}catch{}},readActive:()=>e().decks.B.pflEnabled},{meshName:"exp_button1",label:"CUE CH1 Alt",action:()=>{const t=e(),a=!t.decks.A.pflEnabled;t.togglePFL("A");try{s().mixer.setPFL("A",a)}catch{}},readActive:()=>e().decks.A.pflEnabled},{meshName:"exp_button2",label:"CUE CH2 Alt",action:()=>{const t=e(),a=!t.decks.B.pflEnabled;t.togglePFL("B");try{s().mixer.setPFL("B",a)}catch{}},readActive:()=>e().decks.B.pflEnabled}]}},[]),y=a.useMemo(()=>{const e=new Map;for(const t of g)e.set(t.meshName,t);return e},[g]),A=a.useMemo(()=>{const e=new Map;for(const t of k)e.set(t.meshName,t);return e},[k]),B=a.useMemo(()=>{const e=new Map;for(const t of w)e.set(t.meshName,t);return e},[w]),{sceneGroup:j,meshRegistry:L}=a.useMemo(()=>{const e=r.clone(!0),t=new Map;e.traverse(e=>{if(!("isMesh"in e)||!e.isMesh)return;0;const s=e,a=function(e){const t=C(e.name)||null!=e.parent&&C(e.parent.name),s=M(e.name),a=e.parent?M(e.parent.name):"",n=/^(knob|fader|hfader|button|window)\d*$/;let r=s;return!n.test(r)&&n.test(a)&&(r=a),t&&n.test(r)?"exp_"+r:r}(s);s.geometry.computeBoundingBox();const n=s.geometry.boundingBox,r=new c;n.getCenter(r);let o="static";a.startsWith("knob")||a.startsWith("exp_knob")?o="knob":/^(exp_)?fader\d+$/.test(a)?o="fader":/^(exp_)?hfader\d+$/.test(a)?o="hfader":a.startsWith("button")||a.startsWith("exp_button")?o="button":"window"!==a&&"exp_window"!==a||(o="vu"),s.updateMatrix();const i=t.get(a);i?(i.meshes.push(s),i.restMatrices.push(s.matrix.clone())):t.set(a,{meshes:[s],restMatrices:[s.matrix.clone()],center:r,type:o}),"knob"!==o&&"fader"!==o&&"hfader"!==o||(s.matrixAutoUpdate=!1),"static"!==o&&"vu"!==o&&(s.userData.interactive=!0,s.userData.controlName=a)});[...t.entries()].filter(([,e])=>"static"!==e.type).length;return{sceneGroup:e,meshRegistry:t}},[r]);m(()=>{const e=t.getState();for(const[t,a]of y){const e=L.get(t);if(!e||0===e.meshes.length)continue;const s=(a.readValue()-a.min)/(a.max-a.min);E(p+s*b,e.center,v);for(let t=0;t<e.meshes.length;t++){const s=e.meshes[t];s.matrix.copy(e.restMatrices[t]).multiply(v),s.matrixWorldNeedsUpdate=!0}}for(const[t,a]of A){const e=L.get(t);if(!e||0===e.meshes.length)continue;const s=(a.readValue()-a.min)/(a.max-a.min)-(a.defaultValue-a.min)/(a.max-a.min);"x"===a.axis?N.makeTranslation(s*a.travel,0,0):N.makeTranslation(0,0,-s*a.travel);for(let t=0;t<e.meshes.length;t++){const s=e.meshes[t];s.matrix.copy(e.restMatrices[t]).multiply(N),s.matrixWorldNeedsUpdate=!0}}const s=L.get("window");if(s){const t=e.decks.A.peakDb??-60,a=e.decks.B.peakDb??-60,n=Math.max(t,a),r=Math.max(0,Math.min(1,(n+60)/60)),o=r>.6?1:r/.6,i=r<.8?1:1-(r-.8)/.2;for(const e of s.meshes){const t=e.material;t.emissive&&(t.emissive.setRGB(o*r*.5,i*r*.5,0),t.emissiveIntensity=2*r)}}for(const[t,a]of B){const e=L.get(t);if(!e)continue;const s=a.readActive();for(const t of e.meshes){const e=t.material;e.emissive&&(e.emissive.setRGB(s?1:.1,s?.4:.1,.1),e.emissiveIntensity=s?1.5:.2)}}});const{camera:P,scene:R}=u(),H=a.useMemo(()=>new d,[]),_=a.useMemo(()=>new h,[]),F=a.useCallback(e=>{let t=e;for(;t;){if(t.userData.controlName)return t.userData.controlName;t=t.parent}return null},[]),Q=a.useCallback(e=>{const t=n.current?.getBoundingClientRect();if(!t)return null;_.x=(e.clientX-t.left)/t.width*2-1,_.y=-(e.clientY-t.top)/t.height*2+1,H.setFromCamera(_,P);const s=H.intersectObjects(R.children,!0);for(const a of s){const e=F(a.object);if(e)return e}return null},[n,P,R,H,_,F]);return a.useEffect(()=>{const e=n.current;if(!e)return;const t=e=>{if(0!==e.button)return;const t=Q(e);if(!t)return;const s=B.get(t);if(s)return void s.action();const a=y.get(t);if(a)return o.current=t,f.current={x:e.clientX,y:e.clientY},void(D.current=a.readValue());const n=A.get(t);n&&(l.current=t,f.current={x:e.clientX,y:e.clientY},D.current=n.readValue())},s=e=>{const t=Q(e);if(!t)return;const s=y.get(t);if(s)return void s.action(s.defaultValue);const a=A.get(t);a&&a.action(a.defaultValue)},a=e=>{const t=o.current;if(t){const s=y.get(t);if(!s)return;const a=(f.current.y-e.clientY)/200*(s.max-s.min),n=Math.max(s.min,Math.min(s.max,D.current+a));return void s.action(n)}const s=l.current;if(s){const t=A.get(s);if(!t)return;const a=("x"===t.dragAxis?e.clientX-f.current.x:f.current.y-e.clientY)/150*(t.max-t.min);t.action(Math.max(t.min,Math.min(t.max,D.current+a)))}},r=()=>{o.current=null,l.current=null};return e.addEventListener("pointerdown",t),e.addEventListener("dblclick",s),document.addEventListener("pointermove",a),document.addEventListener("pointerup",r),()=>{e.removeEventListener("pointerdown",t),e.removeEventListener("dblclick",s),document.removeEventListener("pointermove",a),document.removeEventListener("pointerup",r)}},[n,Q,y,A,B]),e.jsxDEV("group",{scale:[V,V,V],children:e.jsxDEV("primitive",{object:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:677,columnNumber:7},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:676,columnNumber:5},this)}function y(){const t=a.useRef(null),s=a.useRef(null);return e.jsxDEV("div",{className:"relative w-full h-full min-h-[200px]",style:{touchAction:"none"},children:[e.jsxDEV(l,{ref:s,className:"absolute inset-0",children:[e.jsxDEV(n,{makeDefault:!0,position:[0,.45,.45],fov:42,near:.01,far:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:694,columnNumber:9},this),e.jsxDEV("ambientLight",{intensity:.4},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:701,columnNumber:9},this),e.jsxDEV("directionalLight",{position:[2,4,2],intensity:.8,castShadow:!1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:702,columnNumber:9},this),e.jsxDEV("directionalLight",{position:[-1,2,-1],intensity:.3},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:703,columnNumber:9},this),e.jsxDEV("pointLight",{position:[0,.05,0],color:"#60a5fa",intensity:.4,distance:.5},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:704,columnNumber:9},this),e.jsxDEV(w,{viewRef:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:706,columnNumber:9},this),e.jsxDEV(r,{ref:t,enablePan:!1,enableZoom:!1,enableRotate:!1,enableDamping:!0,dampingFactor:.1,minPolarAngle:.05*Math.PI,maxPolarAngle:.6*Math.PI,minDistance:.1,maxDistance:2,target:[0,-.05,0],mouseButtons:{LEFT:void 0,MIDDLE:void 0,RIGHT:void 0}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:708,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:693,columnNumber:7},this),e.jsxDEV(o,{orbitRef:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:727,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVestax3DView.tsx",lineNumber:691,columnNumber:5},this)}i.preload(x);export{y as MixerVestax3DView,y as default};
