import{c0 as t,bF as e,aE as i,c1 as n}from"./index-C3ONEZAf.js";import"./vendor-utils-Cm-70yv0.js";import"./vendor-react-LeNVipsj.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-Cpb_sTe-.js";class s{name="BuzzmachineSynth";input;output;audioContext;engine=t.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;constructor(t){this.machineType=t,this.audioContext=e(),this.input=this.audioContext.createGain(),this.output=this.audioContext.createGain(),this.input.connect(this.output),this.initEngine()}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let t=0;t<200&&(await new Promise(t=>setTimeout(t,50)),!this.useWasmEngine&&this.initInProgress);t++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const t=this.audioContext;await this.engine.init(t),this.workletNode=await this.engine.createMachineNode(t,this.machineType),this.input.disconnect(this.output),this.input.connect(this.workletNode),this.workletNode.connect(this.output),this.useWasmEngine=!0}catch(t){this.initError=t instanceof Error?t:new Error(String(t)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const t=i[this.machineType];n("BuzzmachineSynth",this.initError.message,{synthName:t?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:t?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}setParameter(t,e){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,t,e)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}dispose(){this.input.disconnect(),this.output.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null)}}export{s as BuzzmachineSynth};
