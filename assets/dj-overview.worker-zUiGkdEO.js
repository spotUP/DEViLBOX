!function(){"use strict";const l="#ef4444",t="#f59e0b",e="rgba(6, 182, 212, 0.25)",i="rgba(6, 182, 212, 0.6)";let f=null,o=null,n=1,a=400,c=24,r={bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",border:"#2f2525"},s="tracker",h=0,g=1,y=-1,b=!1,d=0,S=0,u=0,R=0,M=null,m=null,p=0,k=!0;function P(l){s=l.playbackMode,h=l.songPos,g=l.totalPositions,y=l.cuePoint,b=l.loopActive,d=l.patternLoopStart,S=l.patternLoopEnd,u=l.audioPosition,R=l.durationMs,M=l.waveformPeaks,m=l.frequencyPeaks}self.onmessage=w=>{const x=w.data;switch(x.type){case"init":f=x.canvas,f.width=Math.round(x.width*x.dpr),f.height=Math.round(x.height*x.dpr),o=f.getContext("2d"),n=x.dpr,a=x.width,c=x.height,r=x.colors,P(x),function(){const f=()=>{(k||p>0)&&function(){if(!o)return;if(k=!1,o.setTransform(n,0,0,n,0,0),o.fillStyle=r.bg,o.fillRect(0,0,a,c),"audio"===s){const t=R/1e3;if(M&&M.length>0&&t>0){const l=M.length,t=a/l,e=c/2;if(m&&3===m.length&&m[0].length>0){const l=m[0],t=m[1],i=m[2],f=l.length,n=a/f,c=e;for(let e=0;e<f;e++){const f=e*n,a=Math.max(1,n-.5),r=l[e]*c*.9,s=t[e]*c*.9,h=i[e]*c*.9;r>.5&&(o.fillStyle="rgba(60, 130, 246, 0.7)",o.fillRect(f,c-r,a,2*r)),s>.5&&(o.fillStyle="rgba(74, 222, 128, 0.55)",o.fillRect(f,c-s,a,2*s)),h>.5&&(o.fillStyle="rgba(251, 191, 36, 0.5)",o.fillRect(f,c-h,a,2*h))}}else for(let i=0;i<l;i++){const l=M[i]*e*.9;o.fillStyle="rgba(100, 160, 255, 0.5)",o.fillRect(i*t,e-l,Math.max(1,t-.5),2*l)}}else o.fillStyle=r.bgSecondary,o.fillRect(0,0,a,c);if((t>0?u/t:0)>.85&&t>0?(p+=.08,o.fillStyle=`rgba(239, 68, 68, ${.15+.15*Math.sin(p)})`,o.fillRect(0,0,a,c)):p=0,t>0){const e=u/t*a;o.fillStyle=l,o.fillRect(e-1,0,2,c),o.fillStyle="#ffffff",o.fillRect(e,0,1,c)}}else{const f=Math.max(g,1),n=a/f;for(let l=0;l<f;l++){o.fillStyle=l%2==0?r.bgSecondary:r.bgTertiary;const t=Math.floor(l*n);o.fillRect(t,0,Math.ceil(n),c),l>0&&(o.fillStyle=r.border,o.fillRect(t,0,1,c))}if(M&&M.length>0){const l=M.length,t=a/l,e=c/2;if(m&&3===m.length&&m[0].length>0){const l=m[0],t=m[1],i=m[2],f=l.length,n=a/f;for(let a=0;a<f;a++){const f=a*n,c=Math.max(1,n-.5),r=l[a]*e*.85,s=t[a]*e*.85,h=i[a]*e*.85;r>.5&&(o.fillStyle="rgba(60, 130, 246, 0.55)",o.fillRect(f,e-r,c,2*r)),s>.5&&(o.fillStyle="rgba(74, 222, 128, 0.4)",o.fillRect(f,e-s,c,2*s)),h>.5&&(o.fillStyle="rgba(251, 191, 36, 0.35)",o.fillRect(f,e-h,c,2*h))}}else for(let i=0;i<l;i++){const l=M[i];if(l<=0)continue;const f=l*e*.85;o.fillStyle="rgba(140, 180, 255, 0.4)",o.fillRect(i*t,e-f,Math.max(1,t-.5),2*f)}}if(h/f>.85&&f>0?(p+=.08,o.fillStyle=`rgba(239, 68, 68, ${.15+.15*Math.sin(p)})`,o.fillRect(0,0,a,c)):p=0,b&&S>d){const l=d/f*a,t=(S-d)/f*a;o.fillStyle=e,o.fillRect(l,0,t,c),o.fillStyle=i,o.fillRect(l,0,1,c),o.fillRect(l+t-1,0,1,c)}if(y>=0&&y<f){const l=(y+.5)/f*a;o.fillStyle=t,o.beginPath(),o.moveTo(l-4,c),o.lineTo(l+4,c),o.lineTo(l,c-6),o.closePath(),o.fill()}if(f>0){const t=(h+.5)/f*a;o.fillStyle=l,o.fillRect(t-1,0,2,c),o.fillStyle="#ffffff",o.fillRect(t,0,1,c)}}o.strokeStyle=r.border,o.lineWidth=1,o.strokeRect(.5,.5,a-1,c-1)}(),requestAnimationFrame(f)};requestAnimationFrame(f)}(),self.postMessage({type:"ready"});break;case"state":P(x),k=!0;break;case"resize":n=x.dpr,a=x.w,c=x.h,f&&(f.width=Math.round(a*n),f.height=Math.round(c*n)),k=!0;break;case"colors":r=x.colors,k=!0}}}();
