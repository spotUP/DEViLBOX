import{b as e,am as t,an as r,g as s,j as a,ao as l}from"./index-C3ONEZAf.js";import{r as n,R as o}from"./vendor-utils-Cm-70yv0.js";import{start as i,Player as c}from"./vendor-tone-CADp_hfL.js";import{az as d,ad as x,ap as f,X as u,T as m,aa as h,n as b,ae as p,Z as g,e as j,M as v,I as y,b0 as N}from"./vendor-ui-Cpb_sTe-.js";import"./vendor-react-LeNVipsj.js";const w={kicks:"Kicks",snares:"Snares",hihats:"Hi-Hats",claps:"Claps",percussion:"Percussion",fx:"FX",bass:"Bass",leads:"Leads",pads:"Pads",loops:"Loops",vocals:"Vocals",other:"Other"},k=({onClose:k})=>{const{currentInstrumentId:C,updateInstrument:S,setPreviewInstrument:z}=e(),{uploadZip:D,uploadDirectory:E,removeUserPack:A}=t(),I=r(),[P,L]=n.useState(I[0]||null),[F,R]=n.useState("kicks"),[U,G]=n.useState(""),[K,M]=n.useState(new Set),[B,T]=n.useState(null),[$,Z]=n.useState(!1),[,O]=n.useState(!1),[V,q]=n.useState(null),H=n.useRef(null),J=n.useRef(0),X=n.useRef(!0),Q=n.useRef(null),W=n.useRef(null),Y=o.useMemo(()=>{if(0===K.size||!P)return null;const e=Array.from(K)[K.size-1];for(const t of P.categories){const r=P.samples[t].find(t=>t.url===e);if(r)return r}return null},[K,P]),_=o.useMemo(()=>Y?{id:999,name:`Preview: ${Y.name}`,type:"sample",synthType:"Sampler",sample:{url:Y.url,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}:null,[Y]);n.useEffect(()=>{if(_){z(_);try{s().invalidateInstrument(999)}catch{}}else z(null);return()=>{z(null);try{s().invalidateInstrument(999)}catch{}}},[_,z]),n.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&Y&&_){s().triggerPolyNoteAttack(999,t,1,_)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&Y&&_){s().triggerPolyNoteRelease(999,t,_)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[Y,_]),n.useEffect(()=>(X.current=!0,()=>{X.current=!1,H.current&&(H.current.stop(),H.current.dispose())}),[]),n.useEffect(()=>{P&&!I.find(e=>e.id===P.id)?(L(I[0]||null),M(new Set)):!P&&I.length>0&&L(I[0])},[I,P]);const ee=(()=>{if(!P)return[];const e=P.samples[F]||[];if(!U.trim())return e;const t=U.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.filename.toLowerCase().includes(t))})(),te=async e=>{const t=++J.current;try{H.current&&(H.current.stop(),H.current.dispose(),H.current=null),await i(),q(e.url),O(!0);const r=new c({url:l(e.url),onload:()=>{J.current===t&&r.start()},onstop:()=>{J.current===t&&(O(!1),q(null))}}).toDestination();H.current=r}catch(r){J.current===t&&(O(!1),q(null))}},re=()=>{if(null===C||0===K.size||!P)return;const t=Array.from(K),r=[];for(const e of t)for(const t of P.categories){const s=P.samples[t].find(t=>t.url===e);if(s){r.push(s);break}}const a=r[0];if(S(C,{type:"sample",name:a.name,synthType:"Sampler",sample:{url:a.url,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}),r.length>1){const{createInstrument:t}=e.getState();for(let e=1;e<r.length;e++){const s=r[e];t({type:"sample",name:s.name,synthType:"Sampler",sample:{url:s.url,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0})}}z(null);try{s().invalidateInstrument(999)}catch{}k()},se=e=>{switch(e){case"kicks":case"snares":return a.jsx(N,{size:14});case"hihats":case"percussion":default:return a.jsx(v,{size:14});case"fx":return a.jsx(y,{size:14})}},ae=e=>({kicks:"text-red-400",snares:"text-orange-400",hihats:"text-yellow-400",claps:"text-pink-400",percussion:"text-purple-400",fx:"text-green-400"}[e]||"text-ft2-highlight");return a.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/90 pt-16",children:a.jsxs("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden border-t-2 border-ft2-border relative",children:[$&&a.jsx("div",{className:"absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"p-6 bg-ft2-header border-2 border-ft2-highlight rounded-xl shadow-2xl flex flex-col items-center gap-4",children:[a.jsx(d,{size:48,className:"text-ft2-highlight animate-bounce"}),a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"text-ft2-highlight font-black text-xl tracking-tighter",children:"PACKING..."}),a.jsx("p",{className:"text-ft2-textDim text-xs font-bold uppercase",children:"Processing audio files"})]})]})}),a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(d,{size:20,className:"text-ft2-highlight"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-ft2-highlight font-bold text-sm",children:"SAMPLE PACKS"}),a.jsx("p",{className:"text-ft2-textDim text-xs",children:"Browse and load samples"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>Q.current?.click(),className:"flex items-center gap-2 px-3 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-text rounded transition-colors text-xs font-bold",title:"Upload ZIP pack",children:[a.jsx(x,{size:14}),"ZIP"]}),a.jsxs("button",{onClick:()=>W.current?.click(),className:"flex items-center gap-2 px-3 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-text rounded transition-colors text-xs font-bold",title:"Upload Folder",children:[a.jsx(f,{size:14}),"FOLDER"]}),a.jsx("button",{onClick:k,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:a.jsx(u,{size:20})})]}),a.jsx("input",{ref:Q,type:"file",accept:".zip",className:"hidden",onChange:async e=>{const t=e.target.files?.[0];if(t){Z(!0);try{const e=await D(t);X.current&&(L(e),e.categories.length>0&&R(e.categories[0]))}catch{X.current&&alert("Failed to load ZIP pack. Ensure it contains audio files.")}finally{X.current&&Z(!1)}Q.current&&(Q.current.value="")}}}),a.jsx("input",{ref:W,type:"file",webkitdirectory:"",directory:"",className:"hidden",onChange:async e=>{const t=e.target.files;if(t&&0!==t.length){Z(!0);try{const e=await E(t);X.current&&(L(e),e.categories.length>0&&R(e.categories[0]))}catch{X.current&&alert("Failed to load directory. Ensure it contains audio files.")}finally{X.current&&Z(!1)}W.current&&(W.current.value="")}}})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{className:"w-64 bg-ft2-header border-r border-ft2-border flex flex-col",children:[a.jsx("div",{className:"p-3 border-b border-ft2-border",children:a.jsx("h3",{className:"text-ft2-text font-bold text-xs mb-2",children:"AVAILABLE PACKS"})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-2 scrollbar-ft2",children:I.map(e=>a.jsx("button",{onClick:()=>{L(e),e.categories.length>0&&R(e.categories[0])},className:"w-full p-3 rounded mb-2 text-left transition-all group "+(P?.id===e.id?"bg-ft2-cursor text-ft2-bg":"bg-ft2-bg border border-ft2-border hover:border-ft2-highlight"),children:a.jsxs("div",{className:"flex items-start gap-3",children:[e.coverImage?a.jsx("img",{src:l(e.coverImage),alt:e.name,className:"w-12 h-12 rounded object-cover shrink-0"}):a.jsx("div",{className:"w-12 h-12 rounded shrink-0 flex items-center justify-center border "+(P?.id===e.id?"bg-ft2-bg/20 border-ft2-bg/30 text-ft2-bg":"bg-ft2-bg border-ft2-border text-ft2-highlight"),children:a.jsx(d,{size:20})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-1",children:[a.jsx("div",{className:"font-bold text-sm truncate "+(P?.id===e.id?"text-ft2-bg":"text-ft2-text"),children:e.name}),e.isUserUploaded&&a.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),confirm("Are you sure you want to remove this sample pack?")&&A(t)})(t,e.id),className:"p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(P?.id===e.id?"hover:bg-ft2-bg/20 text-ft2-bg":"hover:bg-ft2-border text-red-400"),children:a.jsx(m,{size:12})})]}),a.jsxs("div",{className:"text-xs truncate "+(P?.id===e.id?"text-ft2-bg/70":"text-ft2-textDim"),children:["by ",e.author]}),a.jsxs("div",{className:"text-xs mt-1 "+(P?.id===e.id?"text-ft2-bg/70":"text-ft2-textDim"),children:[e.sampleCount," samples"]})]})]})},e.id))})]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:P?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border shrink-0",children:a.jsxs("div",{className:"flex items-center gap-4",children:[P.coverImage?a.jsx("img",{src:l(P.coverImage),alt:P.name,className:"w-16 h-16 rounded object-cover border border-ft2-border"}):a.jsx("div",{className:"w-16 h-16 rounded bg-ft2-bg border border-ft2-border flex items-center justify-center text-ft2-highlight",children:a.jsx(d,{size:32})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-ft2-text font-bold text-lg",children:P.name}),a.jsx("p",{className:"text-ft2-textDim text-xs mt-1 max-w-2xl",children:P.description}),a.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[a.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-ft2-bg border border-ft2-border text-ft2-textDim rounded",children:P.author}),a.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-ft2-bg border border-ft2-border text-ft2-textDim rounded",children:[P.sampleCount," SAMPLES"]}),P.isUserUploaded&&a.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-accent-primary/20 text-accent-primary rounded font-bold",children:"USER UPLOAD"})]})]})]})}),a.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx(h,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"}),a.jsx("input",{type:"text",value:U,onChange:e=>{G(e.target.value),M(new Set),T(null)},placeholder:"Search samples...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none"})]})}),a.jsx("div",{className:"flex gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border overflow-x-auto shrink-0",children:P.categories.map(e=>{const t=F===e,r=P.samples[e]?.length||0;return 0===r?null:a.jsxs("button",{onClick:()=>{R(e),M(new Set),T(null)},className:`\n                          flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold rounded transition-colors whitespace-nowrap\n                          ${t?"bg-ft2-cursor text-ft2-bg":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${ae(e)}`}\n                        `,children:[se(e),w[e].toUpperCase(),a.jsxs("span",{className:"text-[10px] "+(t?"text-ft2-bg/70":"text-ft2-textDim"),children:["(",r,")"]})]},e)})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:0===ee.length?a.jsx("div",{className:"flex items-center justify-center h-full text-ft2-textDim",children:U?`No samples found matching "${U}"`:"No samples in this category"}):a.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:ee.map((e,t)=>{const r=K.has(e.url),s=V===e.url;return a.jsx("div",{role:"button",tabIndex:0,onClick:r=>((e,t,r)=>{const s=new Set(K);if(r.shiftKey&&null!==B){const e=Math.min(B,t),r=Math.max(B,t);for(let t=e;t<=r;t++)s.add(ee[t].url)}else r.ctrlKey||r.metaKey?s.has(e.url)?s.delete(e.url):s.add(e.url):(s.clear(),s.add(e.url),te(e));M(s),T(t)})(e,t,r),onDoubleClick:()=>re(),onKeyDown:e=>{"Enter"===e.key&&re()},className:`\n                              p-2 rounded border text-left transition-all group cursor-pointer\n                              ${r?"bg-ft2-cursor text-ft2-bg border-ft2-cursor":"bg-ft2-header border-ft2-border hover:border-ft2-highlight"}\n                            `,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),s?(H.current&&(H.current.stop(),H.current.dispose(),H.current=null),O(!1),q(null)):te(e)},className:`\n                                  w-7 h-7 rounded flex items-center justify-center transition-colors shrink-0\n                                  ${r?"bg-ft2-bg/20 hover:bg-ft2-bg/30":"bg-ft2-border hover:bg-ft2-highlight/20"}\n                                `,children:s?a.jsx(b,{size:12,className:r?"text-ft2-bg":"text-ft2-highlight"}):a.jsx(p,{size:12,className:r?"text-ft2-bg":"text-ft2-text"})}),a.jsx("span",{className:"font-medium text-xs truncate "+(r?"text-ft2-bg":"text-ft2-text"),children:e.name})]})},e.url)})})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center text-ft2-textDim",children:"Select a sample pack to browse"})})]}),a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-t-2 border-ft2-border",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"text-ft2-textDim text-xs",children:P&&a.jsxs(a.Fragment,{children:[ee.length," sample",1!==ee.length?"s":""," in"," ",w[F],K.size>0&&a.jsxs("span",{className:"ml-2 text-ft2-text",children:["â€¢ ",K.size," selected. Double-click or click Load to use."]})]})}),Y&&a.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[a.jsx(g,{size:12,className:"text-amber-400 fill-amber-400"}),a.jsx("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:k,className:"px-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors",children:"Cancel"}),a.jsxs("button",{onClick:re,disabled:0===K.size,className:"flex items-center gap-2 px-4 py-2 bg-ft2-cursor text-ft2-bg font-bold hover:bg-ft2-highlight rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(j,{size:16}),"Load ",K.size>1?`${K.size} Samples`:"Sample"]})]})]})]})})};export{k as SamplePackBrowser};
