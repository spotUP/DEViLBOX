import{aV as e}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";function t(e,t){return t<0||t>=e.length?0:255&e[t]}function n(e,n){const s=t(e,n);return s<128?s:s-256}function s(e,t){return t+1>=e.length?0:(255&e[t])<<8|255&e[t+1]}function o(e,t){const n=s(e,t);return n<32768?n:n-65536}function l(e,t){return t+3>=e.length?0:16777216*(255&e[t])+((255&e[t+1])<<16)+((255&e[t+2])<<8)+(255&e[t+3])}function r(e,s,o=64){const l=[];let r=s;for(;r<e.length&&l.length<o;){const s=n(e,r);if(l.push(s),r++,-128===s){r<e.length&&(l.push(127&t(e,r)),r++);break}}return l}function f(t,n){const f=new Uint8Array(t),a=n.replace(/\.[^.]+$/,"");let i=null;try{i=function(e){let t=0,n=0,r=0,f=10,a=0,i=0,h=0,c=0;18663===s(e,0)&&24832===s(e,4)&&(c=6+s(e,6),n=30);let u=0;for(;c<e.length-20&&u++<4096;){const l=s(e,c);if(c+=2,20085===l)break;switch(l){case 18426:t=c+o(e,c),c+=2;break;case 24832:c+=2,24832===s(e,c-2-2)&&(c+=2);break;case 49404:f=s(e,c),c+=2,18!==f&&(n=10),16890===s(e,c)&&(c+=2,r=c+o(e,c),c+=2);break;case 4656:c-=6,16890===s(e,c)&&(c+=2,r=c+o(e,c),c+=2),c+=4;break;case 48764:c+=4}if(c>e.length-4)break}if(!t&&!r)return null;let p=r,m=f;const g=[];if(r>0&&r<e.length){let t=r;for(let n=0;n<64&&t+6<e.length;n++){const n=l(e,t);if(0===n||n>1048576)break;const o=s(e,t+4);if(0===o)break;const r=Math.floor(3579545/o);g.push({length:n,tuning:o,relative:r,volume:64,loopPtr:0,finetune:0,volseqOffset:0}),t+=f}}c=0;let v=160,d=144;for(u=0;c<e.length-4&&u++<8192;){const t=s(e,c);switch(c+=2,t){case 12845:{const t=s(e,c);c+=2,10!==t&&12!==t||(c-=8,17914===s(e,c)?(c+=2,a=c+o(e,c),c+=2):c+=6);break}case 1024:case 1088:case 1536:{const t=s(e,c);c+=2,192===t||64===t?(v=176,d=160):t===v?(c+=2,17914===s(e,c)&&(c+=2,h=c+o(e,c),c+=2)):t===d&&(c+=2,17914===s(e,c)&&(c+=2,i=c+o(e,c),c+=2));break}}}return{base:t,variant:n,periodTableOffset:a,frqseqsOffset:i,volseqsOffset:h,samples:g,sampleInfoBase:p,sampleInfoSize:m}}(f)}catch{}const h=[];if(i&&i.samples.length>0)for(let e=0;e<i.samples.length;e++){const t=i.samples[e],n=[63&t.volume,-128,0],o=[-128,0];if(i.frqseqsOffset>0&&i.frqseqsOffset<f.length){const t=i.base+s(f,i.frqseqsOffset+2*e);if(t>0&&t<f.length){const e=r(f,t,64);e.length>0&&o.splice(0,o.length,...e)}}if(i.volseqsOffset>0&&i.volseqsOffset<f.length){const t=i.base+s(f,i.volseqsOffset+2*e);if(t>0&&t<f.length){const e=r(f,t,64);e.length>0&&n.splice(0,n.length,...e)}}const l={defaultVolume:Math.min(64,t.volume),relative:t.relative>0?t.relative:8364,vibratoSpeed:0,vibratoDepth:0,volseq:n,frqseq:o};h.push({id:e+1,name:`DW Inst ${e+1}`,type:"synth",synthType:"DavidWhittakerSynth",davidWhittaker:l,effects:[],volume:0,pan:0})}0===h.length&&h.push({id:1,name:"DW Instrument",type:"synth",synthType:"DavidWhittakerSynth",davidWhittaker:{...e},effects:[],volume:0,pan:0});const c=[];for(let e=0;e<4;e++){const t=[];for(let n=0;n<64;n++)0===n&&e<h.length?t.push({note:49,instrument:e+1,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}):t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});c.push({id:`channel-${e}`,name:`Channel ${e+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:t})}const u=[0];return{name:a,format:"XM",patterns:[{id:"pattern-0",name:"Pattern 1",length:64,channels:c}],instruments:h,songPositions:u,songLength:u.length,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125}}export{f as parseDavidWhittakerFile};
