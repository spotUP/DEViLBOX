import{aX as t}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";function n(t,n){return(t[n]<<8|t[n+1])>>>0}function e(t,n){return(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0}function r(t,r){const o=new Uint8Array(t);if(void 0!==r){const t=(r.split("/").pop()??r).toLowerCase();if(!t.startsWith("rh.")&&!t.endsWith(".rh"))return!1}return!(o.length<32)&&(24576===n(o,0)&&(24576===n(o,4)&&(24576===n(o,8)&&(24576===n(o,12)&&(24576===n(o,16)&&(16890===n(o,20)&&1316307450===e(o,28)))))))}function o(t){let e=-1;for(let i=0;i<8;i++){const r=64+2*i;if(r+2>t.length)break;if(9240===n(t,r)){r-1>=0&&(e=t[r-1]);break}}if(e<0)return null;let r=-1;for(let i=0;i<=4;i++){const e=54+2*i;if(e+2>t.length)break;if(16890===n(t,e)){r=e+2;break}}if(r<0||r+2>t.length)return null;const o=function(t,e){const r=n(t,e);return r>=32768?r-65536:r}(t,r);let l=r;r+4<=t.length&&53756===n(t,r+2)&&(l+=64);const s=l+o;return s<0||s>=t.length?null:{tableOffset:s,count:e+1}}async function l(n,l){if(!r(n,l))throw new Error("Not a Rob Hubbard module");const s=new Uint8Array(n),i=l.split("/").pop()??l,a=i.replace(/^rh\./i,"")||i;let u=[];const f=o(s);null!==f&&(u=function(t,n,r){const o=[];let l=n;for(let s=0;s<r&&!(l+6>t.length);s++){const n=e(t,l);if(0===n||n>65536)break;const r=t[l+4],s=r<=64?r:64;if(l+6+n>t.length)break;const i=t.slice(l+6,l+6+n),a=new Array(n);for(let t=0;t<n;t++){const n=i[t];a[t]=n>=128?n-256:n}o.push({sampleLen:n,loopOffset:-1,sampleVolume:s||64,relative:1024,divider:0,vibratoIdx:0,hiPos:0,loPos:0,vibTable:[],sampleData:a}),l+=n+6}return o}(s,f.tableOffset,f.count));const c=u.length,p=[];for(let e=0;e<13;e++)if(e<c){const t=u[e];p.push({id:e+1,name:`Sample ${e+1}`,type:"synth",synthType:"RobHubbardSynth",effects:[],volume:0,pan:0,robHubbard:t})}else p.push({id:e+1,name:`Sample ${e+1}`,type:"synth",synthType:"RobHubbardSynth",effects:[],volume:0,pan:0,robHubbard:{...t}});const m=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${a} [Rob Hubbard]${c>0?` (${c}/13 smp extracted)`:" (13 smp)"}`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===n||3===n?-50:50,instrumentId:null,color:null,rows:m})),importMetadata:{sourceFormat:"MOD",sourceFile:l,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:13}}],instruments:p,songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{r as isRobHubbardFormat,l as parseRobHubbardFile};
