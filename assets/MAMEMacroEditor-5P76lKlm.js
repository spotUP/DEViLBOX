import{aP as e,aG as t,c as s,j as o}from"./index-zx6LJBPK.js";import{r}from"./vendor-utils-XMmR-oGw.js";import{f as i,T as n}from"./vendor-ui-uomqNFY-.js";import"./vendor-react-DkDaD07v.js";import"./vendor-tone-CADp_hfL.js";const l={[e.VOLUME]:{label:"Volume",min:0,max:127,signed:!1,color:"#00d4aa",description:"Volume envelope (0-127)"},[e.ARPEGGIO]:{label:"Arpeggio",min:-24,max:24,signed:!0,color:"#ff6b6b",description:"Semitone offset (-24 to +24)"},[e.DUTY]:{label:"Duty/Wave",min:0,max:7,signed:!1,color:"#ffd93d",description:"Duty cycle or wave mode"},[e.WAVETABLE]:{label:"Wavetable",min:0,max:63,signed:!1,color:"#6bcbff",description:"Wavetable index select"},[e.PITCH]:{label:"Pitch",min:-128,max:127,signed:!0,color:"#c56bff",description:"Fine pitch offset (cents)"},[e.PANNING]:{label:"Panning",min:-127,max:127,signed:!0,color:"#ff9f43",description:"Left/Right panning"},[e.PHASE_RESET]:{label:"Phase Reset",min:0,max:1,signed:!1,color:"#ff6b9d",description:"Trigger phase reset (0/1)"},[e.ALG]:{label:"Algorithm",min:0,max:7,signed:!1,color:"#4ecdc4",description:"FM algorithm select"},[e.FB]:{label:"Feedback",min:0,max:7,signed:!1,color:"#45b7d1",description:"FM feedback amount"}},a={"vol-sustain":{name:"Sustain",data:[127],loop:0},"vol-decay":{name:"Decay",data:[127,100,80,64,50,40,32,25,20,15,10,5,0]},"vol-pluck":{name:"Pluck",data:[127,80,50,30,15,5,0]},"vol-swell":{name:"Swell",data:[0,10,25,45,70,100,127],loop:6},"vol-tremolo":{name:"Tremolo",data:[127,100,80,100,127,100,80,100],loop:0},"arp-maj":{name:"Major",data:[0,4,7],loop:0},"arp-min":{name:"Minor",data:[0,3,7],loop:0},"arp-oct":{name:"Octave",data:[0,12],loop:0},"arp-5th":{name:"Fifth",data:[0,7],loop:0},"arp-dim":{name:"Dim",data:[0,3,6],loop:0},"pitch-vibrato":{name:"Vibrato",data:[0,5,10,5,0,-5,-10,-5],loop:0},"pitch-wobble":{name:"Wobble",data:[0,15,0,-15],loop:0},"pitch-slide-up":{name:"Slide Up",data:[0,5,10,15,20,25,30]},"pitch-slide-dn":{name:"Slide Down",data:[0,-5,-10,-15,-20,-25,-30]},"duty-cycle":{name:"Cycle",data:[0,1,2,3],loop:0},"duty-pulse":{name:"Pulse",data:[0,1,0,1,2,1],loop:0}};function c({macro:e,onChange:s,label:i,min:l=0,max:a=127,signed:c=!1,color:d="#00d4aa",height:m=80}){const u=r.useRef(null),[p,b]=r.useState(!1),[f,h]=r.useState(null),E="cyan-lineart"===t(e=>e.currentThemeId),x=E?"#00ffff":d,N=E?"#030808":"#0a0a0b",M=E?"rgba(0, 255, 255, 0.08)":"rgba(100, 100, 120, 0.15)",g=E?"#00ffff":"#888",v=e.data.length>0?e.data:[c?0:Math.floor(a/2)],D=v.length,V=r.useCallback(()=>{const t=u.current;if(!t)return;const s=t.getContext("2d");if(!s)return;const o=window.devicePixelRatio||1,r=Math.max(200,12*D),i=m;t.width=r*o,t.height=i*o,t.style.width=r+"px",t.style.height=i+"px",s.scale(o,o);const n=r,d=i,p=(n-4)/Math.max(1,D),b=a-l;s.fillStyle=N,s.fillRect(0,0,n,d),s.strokeStyle=M,s.lineWidth=1;for(let e=0;e<=4;e++){const t=2+(d-4)*e/4;s.beginPath(),s.moveTo(2,t),s.lineTo(n-2,t),s.stroke()}if(c&&(s.strokeStyle=E?"rgba(0, 255, 255, 0.3)":"rgba(255, 255, 255, 0.2)",s.beginPath(),s.moveTo(2,d/2),s.lineTo(n-2,d/2),s.stroke()),e.loop>=0&&e.loop<D){const t=2+e.loop*p;s.fillStyle="rgba(0, 255, 0, 0.3)",s.fillRect(t,0,n-t,d),s.strokeStyle="#00ff00",s.lineWidth=2,s.beginPath(),s.moveTo(t,0),s.lineTo(t,d),s.stroke()}if(e.release>=0&&e.release<D){const t=2+e.release*p;s.strokeStyle="#ff6600",s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(t,0),s.lineTo(t,d),s.stroke(),s.setLineDash([])}for(let e=0;e<D;e++){const t=2+e*p,o=v[e],r=(o-l)/b,i=r*(d-4);if(c){const i=d/2,n=o>=0?i-(r-.5)*(d-4):i,c=Math.abs(o)/(a-l)*(d-4);s.fillStyle=f===e?"#ffffff":x,s.fillRect(t+1,n,p-2,c)}else s.fillStyle=f===e?"#ffffff":x,s.fillRect(t+1,d-2-i,p-2,i);e%8==0&&(s.fillStyle=g,s.font="8px monospace",s.fillText(String(e),t+2,d-2))}},[v,D,m,l,a,c,e.loop,e.release,f,x,N,M,g,E]);r.useEffect(()=>{V()},[V]);const C=r.useCallback(e=>{const t=u.current;if(!t)return null;const s=t.getBoundingClientRect(),o=e.clientX-s.left,r=s.width/D;return Math.floor(o/r)},[D]),y=r.useCallback(e=>{const t=u.current;if(!t)return 0;const s=t.getBoundingClientRect(),o=1-(e.clientY-s.top)/s.height,r=a-l;return Math.round(l+o*r)},[l,a]),k=r.useCallback(t=>{const o=C(t),r=y(t);if(null===o||o<0||o>=D)return;b(!0),h(o);const i=[...v];i[o]=Math.max(l,Math.min(a,r)),s({...e,data:i})},[C,y,v,D,l,a,s,e]),A=r.useCallback(t=>{if(!p)return;const o=C(t),r=y(t);if(null===o||o<0||o>=D)return;h(o);const i=[...v];i[o]=Math.max(l,Math.min(a,r)),s({...e,data:i})},[p,C,y,v,D,l,a,s,e]),L=r.useCallback(()=>{b(!1),h(null)},[]),j=r.useCallback(()=>{const t=[...v,v[v.length-1]||0];s({...e,data:t})},[v,s,e]),O=r.useCallback(()=>{if(v.length<=1)return;const t=v.slice(0,-1),o=e.loop>=t.length?t.length-1:e.loop,r=e.release>=t.length?-1:e.release;s({...e,data:t,loop:o,release:r})},[v,s,e]),U=r.useCallback(()=>{const t=c?0:Math.floor(a/2);s({...e,data:[t],loop:-1,release:-1})},[s,e,c,a]),B=r.useCallback(()=>{null!==f&&s({...e,loop:e.loop===f?-1:f})},[f,s,e]),X=r.useCallback(()=>{null!==f&&s({...e,release:e.release===f?-1:f})},[f,s,e]);return o.jsxDEV("div",{className:"flex flex-col gap-1",children:[o.jsxDEV("div",{className:"flex items-center justify-between px-1",children:[o.jsxDEV("span",{className:"text-[10px] font-mono uppercase tracking-wider",style:{color:x},children:i},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:383,columnNumber:9},this),o.jsxDEV("div",{className:"flex items-center gap-1",children:[o.jsxDEV("span",{className:"text-[9px] text-slate-500",children:[D," steps"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:387,columnNumber:11},this),o.jsxDEV("button",{onClick:j,className:"px-1 py-0.5 text-[9px] bg-dark-surface hover:bg-dark-border rounded",title:"Add step",children:"+"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:388,columnNumber:11},this),o.jsxDEV("button",{onClick:O,className:"px-1 py-0.5 text-[9px] bg-dark-surface hover:bg-dark-border rounded",title:"Remove step",children:"-"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:393,columnNumber:11},this),o.jsxDEV("button",{onClick:B,className:"px-1 py-0.5 text-[9px] bg-green-900/50 hover:bg-green-800/50 rounded",title:"Set loop point",children:"L"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:398,columnNumber:11},this),o.jsxDEV("button",{onClick:X,className:"px-1 py-0.5 text-[9px] bg-orange-900/50 hover:bg-orange-800/50 rounded",title:"Set release point",children:"R"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:403,columnNumber:11},this),o.jsxDEV("button",{onClick:U,className:"px-1 py-0.5 text-[9px] bg-red-900/50 hover:bg-red-800/50 rounded",title:"Clear",children:o.jsxDEV(n,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:413,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:408,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:386,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:382,columnNumber:7},this),o.jsxDEV("div",{className:"relative overflow-x-auto",children:o.jsxDEV("canvas",{ref:u,className:"cursor-crosshair rounded",onMouseDown:k,onMouseMove:A,onMouseUp:L,onMouseLeave:L},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:420,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:419,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:380,columnNumber:5},this)}function d({instrumentId:n,macros:d,onChange:m,chipCapabilities:u={}}){const[p,b]=r.useState(new Set([e.VOLUME])),[f,h]=r.useState(null),E="cyan-lineart"===t(e=>e.currentThemeId),x=r.useMemo(()=>{const t=[e.VOLUME,e.ARPEGGIO,e.PITCH];return u.hasWavetable&&t.push(e.WAVETABLE),u.hasNoise&&t.push(e.DUTY),u.hasPanning&&t.push(e.PANNING),u.hasFM&&t.push(e.ALG,e.FB),t.push(e.PHASE_RESET),t},[u]),N=r.useCallback(e=>{const t=d.find(t=>t.type===e);if(t)return t;const s=l[e];return{type:e,data:[s?.signed?0:s?.max||127],loop:-1,release:-1}},[d]),M=r.useCallback((e,t)=>{const o=d.filter(t=>t.type!==e);o.push(t),m(o);const r=s().getMAMEChipSynth(n);r&&r.setMacro({type:t.type,data:t.data,loop:t.loop,release:t.release})},[d,m,n]),g=r.useCallback((e,t)=>{const s=a[t];if(!s)return;const o=N(e);M(e,{...o,data:[...s.data],loop:s.loop??-1}),h(null)},[N,M]),v=r.useCallback(e=>{b(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),D=r.useCallback(t=>{const s=t===e.VOLUME?"vol-":t===e.ARPEGGIO?"arp-":t===e.PITCH?"pitch-":t===e.DUTY?"duty-":"";return Object.keys(a).filter(e=>e.startsWith(s))},[]),V=E?"linear-gradient(180deg, #0a1515 0%, #050c0c 100%)":"linear-gradient(180deg, #1e1e1e 0%, #151515 100%)",C=E?"rgba(0, 255, 255, 0.2)":"rgba(255, 255, 255, 0.08)";return o.jsxDEV("div",{className:"rounded-lg overflow-hidden",style:{background:V,border:`1px solid ${C}`},children:[o.jsxDEV("div",{className:"px-3 py-2 flex items-center justify-between border-b",style:{borderColor:C},children:[o.jsxDEV("span",{className:"text-xs font-semibold uppercase tracking-wider",style:{color:E?"#00ffff":"#e2e8f0"},children:"Macros"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:555,columnNumber:9},this),o.jsxDEV("span",{className:"text-[10px] text-slate-500",children:[d.filter(e=>e.data.length>1).length," active"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:561,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:551,columnNumber:7},this),o.jsxDEV("div",{className:"p-2 space-y-2",children:x.map(e=>{const t=l[e];if(!t)return null;const s=N(e),r=p.has(e),n=s.data.length>1,d=D(e);return o.jsxDEV("div",{className:"rounded border",style:{borderColor:n?t.color+"40":C},children:[o.jsxDEV("button",{onClick:()=>v(e),className:"w-full px-2 py-1.5 flex items-center justify-between hover:bg-white/5 transition-colors",children:[o.jsxDEV("div",{className:"flex items-center gap-2",children:[o.jsxDEV("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:n?t.color:"#444"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:589,columnNumber:19},this),o.jsxDEV("span",{className:"text-[11px] font-medium",style:{color:E?"#00ffff":"#e2e8f0"},children:t.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:593,columnNumber:19},this),n&&o.jsxDEV("span",{className:"text-[9px] text-slate-500",children:["(",s.data.length," steps)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:600,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:588,columnNumber:17},this),o.jsxDEV(i,{size:14,className:"transform transition-transform "+(r?"rotate-180":""),style:{color:E?"#00ffff":"#888"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:605,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:584,columnNumber:15},this),r&&o.jsxDEV("div",{className:"px-2 pb-2 space-y-2",children:[d.length>0&&o.jsxDEV("div",{className:"relative",children:[o.jsxDEV("button",{onClick:()=>h(f===e?null:e),className:"text-[10px] px-2 py-1 bg-dark-surface hover:bg-dark-border rounded flex items-center gap-1",children:["Presets",o.jsxDEV(i,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:623,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:618,columnNumber:23},this),f===e&&o.jsxDEV("div",{className:"absolute top-full left-0 mt-1 bg-dark-bg border border-dark-border rounded shadow-lg z-10",children:d.map(t=>o.jsxDEV("button",{onClick:()=>g(e,t),className:"block w-full text-left px-3 py-1.5 text-[10px] hover:bg-dark-surface",children:a[t].name},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:628,columnNumber:29},this))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:626,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:617,columnNumber:21},this),o.jsxDEV(c,{macro:s,onChange:t=>M(e,t),label:t.label,min:t.min,max:t.max,signed:t.signed,color:t.color,height:60},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:642,columnNumber:19},this),o.jsxDEV("p",{className:"text-[9px] text-slate-500 px-1",children:t.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:654,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:614,columnNumber:17},this)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:578,columnNumber:13},this)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:567,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/editors/MAMEMacroEditor.tsx",lineNumber:546,columnNumber:5},this)}export{d as MAMEMacroEditor,d as default};
