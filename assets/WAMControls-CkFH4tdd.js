import{c as e,a4 as s,aN as t,j as o}from"./index-zx6LJBPK.js";import{r as n}from"./vendor-utils-XMmR-oGw.js";import{G as r,f as i,u as l,v as m,n as c}from"./vendor-ui-uomqNFY-.js";import"./vendor-react-DkDaD07v.js";import"./vendor-tone-CADp_hfL.js";const a=({instrument:a,onChange:u})=>{const[d,x]=n.useState(a.wam?.moduleUrl||""),[p,N]=n.useState(!1),[b,v]=n.useState(null),[f,C]=n.useState(null),[E,V]=n.useState({}),[D,h]=n.useState(!1),[g,j]=n.useState(null),M=n.useRef(null),W=e(),y=n.useCallback((e,t)=>{V(s=>({...s,[e]:t}));const o=W.getInstrument(a.id,a,-1);o instanceof s&&o.setParameter(e,t)},[W,a]);n.useEffect(()=>{let e=!0,t=null,o=null;return(async()=>{if(M.current&&(M.current.innerHTML="",C(null),h(!1),j(null),a.wam?.moduleUrl))try{N(!0),v(null);const r=W.getInstrument(a.id,a,-1);if(!(r instanceof s)){const e=`Instrument ${a.id} is not a WAMSynth (got ${r?.constructor.name})`;return void v(e)}if(await r.ensureInitialized(),!e)return;const i=r.descriptor,l=i&&/no gui/i.test(String(i.name||""))?null:await r.createGui();if(l&&e&&M.current){t=l,h(!0),M.current.appendChild(l);let e=0,s=0;const n=()=>{const t=M.current;if(!t||!l)return;l.style.transform="",l.style.position="",l.style.left="",l.style.top="";const o=l.offsetWidth||l.scrollWidth||l.clientWidth,n=l.offsetHeight||l.scrollHeight||l.clientHeight;if(!o||!n)return;e=o,s=n;const r=t.clientWidth,i=t.clientHeight;if(!r||!i)return;const m=Math.min(r/e,i/s),c=e*m,a=s*m;l.style.position="absolute",l.style.transformOrigin="top left",l.style.transform=`scale(${m})`,l.style.left=(r-c)/2+"px",l.style.top=(i-a)/2+"px"};o=new ResizeObserver(n),o.observe(M.current),requestAnimationFrame(n),setTimeout(n,300),setTimeout(n,800),setTimeout(n,1500),"effect"===r.pluginType&&j(`"${r.descriptor?.name||"This plugin"}" is an audio effect. A built-in tone generator feeds audio through it so you can play it from the keyboard.`)}else if(e)try{const s=await r.getParameters();if(s&&Object.keys(s).length>0&&e){C(s);const e={};Object.entries(s).forEach(([s,t])=>{e[s]=t.defaultValue??t.minValue??0}),V(e)}else if(e&&M.current){const e=r.descriptor?.name||"This plugin";M.current.innerHTML=`<div class="text-text-muted text-sm p-6 text-center"><p class="font-semibold mb-2">${e}</p><p class="text-xs italic">This plugin does not provide a GUI or discoverable parameters.<br/>It can still be played from the keyboard.</p></div>`}}catch(n){e&&M.current&&(M.current.innerHTML='<div class="text-text-muted text-xs p-4 italic">Plugin does not provide a native GUI</div>')}}catch(r){const s=r instanceof Error?r.message:String(r);e&&v(s)}finally{e&&N(!1)}})(),()=>{e=!1,o?.disconnect(),t&&t.parentElement&&t.parentElement.removeChild(t)}},[a.id,a.wam?.moduleUrl,W]);const A=n.useCallback(e=>{x(e),u({wam:{...a.wam,moduleUrl:e,pluginState:null}}),W.invalidateInstrument(a.id)},[a,u,W]),U=n.useCallback(e=>{const s=e.target.value;s&&A(s)},[A]),L=["WAMOBXd","WAMSynth101","WAMTinySynth","WAMFaustFlute"].includes(a.synthType),O=t.filter(e=>"instrument"===e.type).reduce((e,s)=>{const t="Synthesizers";return e[t]||(e[t]=[]),e[t].push(s),e},{});return o.jsxDEV("div",{className:"flex flex-col h-full bg-dark-bgSecondary p-4 space-y-4 overflow-hidden",children:[!L&&o.jsxDEV("div",{className:"flex flex-col gap-2",children:[o.jsxDEV("label",{className:"text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2",children:[o.jsxDEV(r,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:242,columnNumber:13},void 0),"Web Audio Module"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:241,columnNumber:11},void 0),o.jsxDEV("div",{className:"relative",children:[o.jsxDEV("select",{value:a.wam?.moduleUrl||"",onChange:U,disabled:p,className:"w-full bg-dark-bg border border-dark-border rounded px-3 py-2 text-sm text-text-primary focus:outline-none focus:border-accent-primary transition-colors appearance-none cursor-pointer disabled:opacity-50",children:[o.jsxDEV("option",{value:"",children:"Select a WAM plugin..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:254,columnNumber:15},void 0),Object.entries(O).map(([e,s])=>o.jsxDEV("optgroup",{label:e,children:s.map(e=>o.jsxDEV("option",{value:e.url,children:[e.name," â€” ",e.description]},e.url,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:258,columnNumber:21},void 0))},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:256,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:248,columnNumber:13},void 0),o.jsxDEV(i,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:265,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:247,columnNumber:11},void 0),o.jsxDEV("details",{className:"group",children:[o.jsxDEV("summary",{className:"text-[10px] text-text-muted cursor-pointer hover:text-text-secondary select-none flex items-center gap-1",children:[o.jsxDEV(i,{size:10,className:"group-open:rotate-180 transition-transform"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:271,columnNumber:15},void 0),"Custom URL"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:270,columnNumber:13},void 0),o.jsxDEV("div",{className:"mt-2 space-y-2",children:[o.jsxDEV("form",{onSubmit:e=>{e.preventDefault();const s=d.trim();s&&(u({wam:{...a.wam,moduleUrl:s,pluginState:null}}),W.invalidateInstrument(a.id))},className:"flex gap-2",children:[o.jsxDEV("input",{type:"text",value:d,onChange:e=>x(e.target.value),placeholder:"https://example.com/my-wam-plugin/index.js",className:"flex-1 bg-dark-bg border border-dark-border rounded px-3 py-1.5 text-sm text-text-primary focus:outline-none focus:border-accent-primary transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:276,columnNumber:17},void 0),o.jsxDEV("button",{type:"submit",disabled:p,className:"bg-accent-primary hover:bg-accent-primary/90 disabled:opacity-50 text-text-inverse px-4 py-1.5 rounded text-sm font-bold transition-all flex items-center gap-2",children:p?o.jsxDEV(l,{size:14,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:288,columnNumber:32},void 0):"LOAD"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:283,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:275,columnNumber:15},void 0),o.jsxDEV("p",{className:"text-[10px] text-text-muted italic",children:["Enter any WAM 2.0 module URL. Browse more at"," ",o.jsxDEV("a",{href:"https://www.webaudiomodules.com/",target:"_blank",rel:"noreferrer",className:"text-accent-primary hover:underline",children:"webaudiomodules.com"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:293,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:291,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:274,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:269,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:240,columnNumber:9},void 0),b&&o.jsxDEV("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded-lg p-4 flex items-start gap-3",children:[o.jsxDEV(m,{size:18,className:"text-accent-error flex-shrink-0 mt-0.5"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:303,columnNumber:11},void 0),o.jsxDEV("div",{className:"flex-1",children:[o.jsxDEV("h4",{className:"text-sm font-bold text-accent-error uppercase",children:"Loading Error"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:305,columnNumber:13},void 0),o.jsxDEV("p",{className:"text-xs text-text-secondary mt-1 select-text cursor-text",children:b},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:306,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:304,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:302,columnNumber:9},void 0),g&&!b&&o.jsxDEV("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg px-4 py-2.5 flex items-center gap-3",children:[o.jsxDEV(m,{size:14,className:"text-blue-400 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:314,columnNumber:11},void 0),o.jsxDEV("p",{className:"text-xs text-text-secondary",children:g},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:315,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:313,columnNumber:9},void 0),p&&!b&&o.jsxDEV("div",{className:"flex-1 flex flex-col items-center justify-center gap-3 bg-dark-bg/20 rounded-xl border border-dark-border border-dashed",children:[o.jsxDEV(l,{size:32,className:"text-accent-primary animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:322,columnNumber:11},void 0),o.jsxDEV("p",{className:"text-sm text-text-muted font-mono animate-pulse",children:"Initializing Web Audio Module..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:323,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:321,columnNumber:9},void 0),o.jsxDEV("div",{className:"flex-1 flex flex-col min-h-0 "+(p||b||!a.wam?.moduleUrl||!D&&f?"hidden":""),children:[o.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[o.jsxDEV("span",{className:"text-xs font-bold text-text-muted uppercase",children:"Plugin Interface"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:334,columnNumber:11},void 0),o.jsxDEV("button",{onClick:()=>W.invalidateInstrument(a.id),className:"text-[10px] text-text-muted hover:text-text-primary flex items-center gap-1",children:[o.jsxDEV(l,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:339,columnNumber:13},void 0)," Reload"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:335,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:333,columnNumber:9},void 0),o.jsxDEV("div",{ref:M,className:"flex-1 bg-black rounded-lg border border-dark-border overflow-x-hidden overflow-y-auto relative min-h-[300px]"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:342,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:328,columnNumber:7},void 0),f&&!D&&!p&&!b&&o.jsxDEV("div",{className:"flex-1 flex flex-col min-h-0",children:[o.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[o.jsxDEV("span",{className:"text-xs font-bold text-text-muted uppercase flex items-center gap-1.5",children:[o.jsxDEV(c,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:353,columnNumber:15},void 0),"Plugin Parameters"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:352,columnNumber:13},void 0),o.jsxDEV("button",{onClick:()=>W.invalidateInstrument(a.id),className:"text-[10px] text-text-muted hover:text-text-primary flex items-center gap-1",children:[o.jsxDEV(l,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:360,columnNumber:15},void 0)," Reload"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:356,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:351,columnNumber:11},void 0),o.jsxDEV("div",{className:"flex-1 overflow-auto space-y-1.5 p-3 bg-dark-bg rounded-lg border border-dark-border",children:Object.entries(f).map(([e,s])=>{const t=s.minValue??0,n=s.maxValue??1,r=n-t>10?1:.01,i=E[e]??s.defaultValue??t;return o.jsxDEV("div",{className:"flex items-center gap-3",children:[o.jsxDEV("label",{className:"text-xs text-text-secondary w-32 truncate",title:s.label||e,children:s.label||e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:371,columnNumber:19},void 0),o.jsxDEV("input",{type:"range",min:t,max:n,step:r,value:i,onChange:s=>y(e,parseFloat(s.target.value)),className:"flex-1 accent-accent-primary h-1.5"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:374,columnNumber:19},void 0),o.jsxDEV("span",{className:"text-[10px] text-text-muted w-12 text-right font-mono",children:i.toFixed(2)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:383,columnNumber:19},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:370,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:363,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:350,columnNumber:9},void 0),!a.wam?.moduleUrl&&!p&&o.jsxDEV("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 text-center p-8 bg-dark-bg/10 rounded-xl border border-dark-border border-dashed",children:[o.jsxDEV("div",{className:"p-4 rounded-full bg-dark-bgTertiary text-text-muted",children:o.jsxDEV(r,{size:48},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:397,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:396,columnNumber:11},void 0),o.jsxDEV("div",{children:[o.jsxDEV("h3",{className:"text-lg font-bold text-text-primary",children:"No WAM Loaded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:400,columnNumber:13},void 0),o.jsxDEV("p",{className:"text-sm text-text-muted max-w-xs mx-auto mt-2",children:"Web Audio Modules are external plugins. Enter a URL above to load a synthesizer or effect."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:401,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:399,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:395,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/WAMControls.tsx",lineNumber:237,columnNumber:5},void 0)};export{a as WAMControls};
