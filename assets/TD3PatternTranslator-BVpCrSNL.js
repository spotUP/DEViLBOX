import{b8 as t,b9 as n}from"./index-BScIrLQs.js";import"./vendor-utils-Cm-70yv0.js";import"./vendor-react-LeNVipsj.js";import"./vendor-tone-MhHxAwwC.js";import"./vendor-ui-CfbwX2Zi.js";const e={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function r(t){if(!t||"==="===t||"---"===t)return null;const n=t.match(/^([A-G])(#?)(-?\d)$/);if(!n)return null;const[,o,r,s]=n,i=parseInt(s,10),l=e[o+(r||"")];return void 0===l?null:{semitone:l,octave:i}}function s(t,n=2){if(!t)return null;const e=r(t);if(!e)return null;const{semitone:o,octave:s}=e;let i=s-n,l=!1;return 0===o&&3===i&&(l=!0,i=2),i<0||i>2?null:{value:o,octave:i,upperC:l}}function i(t,n=2){let e=n+t.octave;t.upperC&&0===t.value&&(e+=1);const r=o[t.value];return r.includes("#")?`${r}${e}`:`${r}-${e}`}function l(n,e=2){const o=0===n.note||97===n.note,r=o?"":t(n.note);return{note:o?null:s(r,e),accent:1===n.flag1||1===n.flag2,slide:2===n.flag1||2===n.flag2,tie:!1}}function u(t,e=2){const o=t.note?i(t.note,e):"";return{note:o?n(o):0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:t.accent?1:void 0,flag2:t.slide?2:void 0}}function a(n,e=2){const o=[],r=[];n.length>16&&o.push(`Pattern has ${n.length} rows, only first 16 will be exported`);for(let s=0;s<Math.min(n.length,16);s++){const i=n[s],u=l(i,e);if(i.note&&0!==i.note&&97!==i.note&&!u.note){const n=t(i.note);o.push(`Row ${s+1}: Note ${n} is out of TD-3 range (C2-C5)`)}if(s>0&&u.note&&n[s-1]){const t=n[s-1];t.note&&0!==t.note&&97!==t.note&&t.note===i.note&&(u.tie=!0)}r.push(u)}for(;r.length<16;)r.push({note:null,accent:!1,slide:!1,tie:!1});return{steps:r,warnings:o}}function f(t,n=2){return t.map(t=>u(t,n))}function c(n){const e=new Map;for(const i of n)if(i.note&&0!==i.note&&97!==i.note){const n=r(t(i.note));if(n){const t=e.get(n.octave)||0;e.set(n.octave,t+1)}}if(0===e.size)return 2;let o=0,s=2;return e.forEach((t,n)=>{t>o&&(o=t,s=n)}),Math.max(1,Math.min(4,s))}function p(n,e=2){const o=[],r=[];if(0===n.length)return o.push("Pattern is empty"),{valid:!1,errors:o,warnings:r};n.length>16&&r.push(`Pattern has ${n.length} rows, only first 16 will be exported`);let i=0;for(let l=0;l<Math.min(n.length,16);l++){const o=n[l];if(o.note&&0!==o.note&&97!==o.note){s(t(o.note),e)||i++}}return i>0&&r.push(`${i} note(s) are out of TD-3 range and will be skipped`),{valid:0===o.length,errors:o,warnings:r}}export{r as parseTrackerNote,c as suggestBaseOctave,i as td3NoteToTracker,u as td3StepToTrackerCell,f as td3StepsToTrackerCells,l as trackerCellToTD3Step,s as trackerNoteToTD3,a as trackerPatternToTD3Steps,p as validatePatternForTD3Export};
