const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BuzzmachineSynth-ChGsB0cW.js","assets/vendor-utils-Cm-70yv0.js","assets/vendor-react-LeNVipsj.js","assets/vendor-tone-MhHxAwwC.js","assets/vendor-ui-C64XGON6.js","assets/instrumentFactory-8LiacaiB.js","assets/TD3PatternTranslator-Cc64HjVE.js","assets/HelpModal-vmkQ_ely.js","assets/ExportDialog-SJaiZKXm.js","assets/EditInstrumentModal-DkxQa2I3.js","assets/sortable.esm-TWhn5F4B.js","assets/index-CnBEUN5i.js","assets/TD3PatternDialog-g8rYzrk4.js","assets/TD3PatternLoader-C1bZAG-1.js","assets/DrumpadEditorModal-D8LtTBcP.js","assets/TipOfTheDay-TW0KIsBA.js","assets/PatternManagement-COMI5JI7.js","assets/SamplePackBrowser-f0K3iy_9.js"])))=>i.map(i=>d[i]);
import{R as e,p as t,a,c as n,r as s,b as r,e as i}from"./vendor-utils-Cm-70yv0.js";import{r as o,a as l,g as c,b as u}from"./vendor-react-LeNVipsj.js";import{T as d,G as p,W as h,F as m,E as f,D as g,R as y,a as b,L as v,c as x,P as w,g as k,C as S,M,b as N,d as C,e as E,V as P,f as _,O as T,S as A,h as O,N as I,A as D,i as F,j as R,J as j,k as L,l as B,m as V,n as z,B as U,o as G,p as W,q as H,r as K,s as $,t as q,u as X,v as Y,w as Q,x as Z,y as J,z as ee,H as te,I as ae,K as ne,Q as se,U as re,X as ie,Y as oe,Z as le,_ as ce,$ as ue,a0 as de,a1 as pe,a2 as he,a3 as me,a4 as fe,a5 as ge,a6 as ye,a7 as be,a8 as ve,a9 as xe,aa as we,ab as ke,ac as Se}from"./vendor-tone-MhHxAwwC.js";import{C as Me,U as Ne,a as Ce,X as Ee,R as Pe,S as _e,M as Te,Z as Ae,b as Oe,c as Ie,d as De,e as Fe,T as Re,f as je,L as Le,g as Be,A as Ve,h as ze,D as Ue,E as Ge,i as We,j as He,k as Ke,l as $e,P as qe,m as Xe,n as Ye,o as Qe,p as Ze,V as Je,q as et,H as tt,W as at,r as nt,s as st,t as rt,u as it,v as ot,w as lt,x as ct,y as ut,z as dt,B as pt,F as ht,G as mt,I as ft,J as gt,K as yt,N as bt,O as vt,Q as xt,Y as wt,_ as kt,$ as St,a0 as Mt,a1 as Nt,a2 as Ct,a3 as Et,a4 as Pt,a5 as _t,a6 as Tt,a7 as At,a8 as Ot,a9 as It,aa as Dt,ab as Ft,ac as Rt,ad as jt,ae as Lt,af as Bt,ag as Vt,ah as zt,ai as Ut,aj as Gt,ak as Wt,al as Ht,am as Kt,an as $t,ao as qt,ap as Xt,aq as Yt,ar as Qt,as as Zt,at as Jt,au as ea,av as ta,aw as aa,ax as na,ay as sa,az as ra,aA as ia,aB as oa,aC as la,aD as ca,aE as ua,aF as da}from"./vendor-ui-C64XGON6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var pa,ha,ma={exports:{}},fa={};var ga,ya,ba,va,xa=(ha||(ha=1,ma.exports=function(){if(pa)return fa;pa=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(t,a,n){var s=null;if(void 0!==n&&(s=""+n),void 0!==a.key&&(s=""+a.key),"key"in a)for(var r in n={},a)"key"!==r&&(n[r]=a[r]);else n=a;return a=n.ref,{$$typeof:e,type:t,key:s,ref:void 0!==a?a:null,props:n}}return fa.Fragment=t,fa.jsx=a,fa.jsxs=a,fa}()),ma.exports),wa={exports:{}},ka={},Sa={exports:{}},Ma={};function Na(){return ya||(ya=1,Sa.exports=(ga||(ga=1,function(e){function t(e,t){var a=e.length;e.push(t);e:for(;0<a;){var n=a-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[a]=r,a=n}}function a(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],a=e.pop();if(a!==t){e[0]=a;e:for(var n=0,r=e.length,i=r>>>1;n<i;){var o=2*(n+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,a))c<r&&0>s(u,l)?(e[n]=u,e[c]=a,n=c):(e[n]=l,e[o]=a,n=o);else{if(!(c<r&&0>s(u,a)))break e;e[n]=u,e[c]=a,n=c}}}return t}function s(e,t){var a=e.sortIndex-t.sortIndex;return 0!==a?a:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var r=performance;e.unstable_now=function(){return r.now()}}else{var i=Date,o=i.now();e.unstable_now=function(){return i.now()-o}}var l=[],c=[],u=1,d=null,p=3,h=!1,m=!1,f=!1,g=!1,y="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var s=a(c);null!==s;){if(null===s.callback)n(c);else{if(!(s.startTime<=e))break;n(c),s.sortIndex=s.expirationTime,t(l,s)}s=a(c)}}function w(e){if(f=!1,x(e),!m)if(null!==a(l))m=!0,S||(S=!0,k());else{var t=a(c);null!==t&&A(w,t.startTime-e)}}var k,S=!1,M=-1,N=5,C=-1;function E(){return!(!g&&e.unstable_now()-C<N)}function P(){if(g=!1,S){var t=e.unstable_now();C=t;var s=!0;try{e:{m=!1,f&&(f=!1,b(M),M=-1),h=!0;var r=p;try{t:{for(x(t),d=a(l);null!==d&&!(d.expirationTime>t&&E());){var i=d.callback;if("function"==typeof i){d.callback=null,p=d.priorityLevel;var o=i(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof o){d.callback=o,x(t),s=!0;break t}d===a(l)&&n(l),x(t)}else n(l);d=a(l)}if(null!==d)s=!0;else{var u=a(c);null!==u&&A(w,u.startTime-t),s=!1}}break e}finally{d=null,p=r,h=!1}s=void 0}}finally{s?k():S=!1}}}if("function"==typeof v)k=function(){v(P)};else if("undefined"!=typeof MessageChannel){var _=new MessageChannel,T=_.port2;_.port1.onmessage=P,k=function(){T.postMessage(null)}}else k=function(){y(P,0)};function A(t,a){M=y(function(){t(e.unstable_now())},a)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(N=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var a=p;p=t;try{return e()}finally{p=a}},e.unstable_requestPaint=function(){g=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var a=p;p=e;try{return t()}finally{p=a}},e.unstable_scheduleCallback=function(n,s,r){var i=e.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?i+r:i,n){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return n={id:u++,callback:s,priorityLevel:n,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>i?(n.sortIndex=r,t(c,n),null===a(l)&&n===a(c)&&(f?(b(M),M=-1):f=!0,A(w,r-i))):(n.sortIndex=o,t(l,n),m||h||(m=!0,S||(S=!0,k()))),n},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=p;return function(){var a=p;p=t;try{return e.apply(this,arguments)}finally{p=a}}}}(Ma)),Ma)),Sa.exports}function Ca(){if(ba)return ka;ba=1;var e=Na(),t=o(),a=l();function n(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function r(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(a=t.return),e=t.return}while(e)}return 3===t.tag?a:null}function i(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(r(e)!==e)throw Error(n(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var p=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),E=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function _(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var T=Symbol.for("react.client.reference");function A(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===T?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case k:return"Suspense";case S:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case f:return"Portal";case x:return e.displayName||"Context";case v:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:A(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return A(e(t))}catch(a){}}return null}var O=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F={pending:!1,data:null,method:null,action:null},R=[],j=-1;function L(e){return{current:e}}function B(e){0>j||(e.current=R[j],R[j]=null,j--)}function V(e,t){j++,R[j]=e.current,e.current=t}var z,U,G=L(null),W=L(null),H=L(null),K=L(null);function $(e,t){switch(V(H,t),V(W,e),V(G,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?vd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=xd(t=vd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(G),V(G,e)}function q(){B(G),B(W),B(H)}function X(e){null!==e.memoizedState&&V(K,e);var t=G.current,a=xd(t,e.type);t!==a&&(V(W,e),V(G,a))}function Y(e){W.current===e&&(B(G),B(W)),K.current===e&&(B(K),pp._currentValue=F)}function Q(e){if(void 0===z)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||"",U=-1<a.stack.indexOf("\n    at")?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+z+e+U}var Z=!1;function J(e,t){if(!e||Z)return"";Z=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(s){var n=s}Reflect.construct(e,[],a)}else{try{a.call()}catch(r){n=r}e.call(a.prototype)}}else{try{throw Error()}catch(i){n=i}(a=e())&&"function"==typeof a.catch&&a.catch(function(){})}}catch(o){if(o&&n&&"string"==typeof o.stack)return[o.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),i=r[0],o=r[1];if(i&&o){var l=i.split("\n"),c=o.split("\n");for(s=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(n===l.length||s===c.length)for(n=l.length-1,s=c.length-1;1<=n&&0<=s&&l[n]!==c[s];)s--;for(;1<=n&&0<=s;n--,s--)if(l[n]!==c[s]){if(1!==n||1!==s)do{if(n--,0>--s||l[n]!==c[s]){var u="\n"+l[n].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=n&&0<=s);break}}}finally{Z=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Q(a):""}function ee(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return J(e.type,!1);case 11:return J(e.type.render,!1);case 1:return J(e.type,!0);case 31:return Q("Activity");default:return""}}function te(e){try{var t="",a=null;do{t+=ee(e,a),a=e,e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}var ae=Object.prototype.hasOwnProperty,ne=e.unstable_scheduleCallback,se=e.unstable_cancelCallback,re=e.unstable_shouldYield,ie=e.unstable_requestPaint,oe=e.unstable_now,le=e.unstable_getCurrentPriorityLevel,ce=e.unstable_ImmediatePriority,ue=e.unstable_UserBlockingPriority,de=e.unstable_NormalPriority,pe=e.unstable_LowPriority,he=e.unstable_IdlePriority,me=e.log,fe=e.unstable_setDisableYieldValue,ge=null,ye=null;function be(e){if("function"==typeof me&&fe(e),ye&&"function"==typeof ye.setStrictMode)try{ye.setStrictMode(ge,e)}catch(t){}}var ve=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/we|0)|0},xe=Math.log,we=Math.LN2;var ke=256,Se=262144,Me=4194304;function Ne(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t,a){var n=e.pendingLanes;if(0===n)return 0;var s=0,r=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var o=134217727&n;return 0!==o?0!==(n=o&~r)?s=Ne(n):0!==(i&=o)?s=Ne(i):a||0!==(a=o&~e)&&(s=Ne(a)):0!==(o=n&~r)?s=Ne(o):0!==i?s=Ne(i):a||0!==(a=n&~e)&&(s=Ne(a)),0===s?0:0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(a=t&-t)||32===r&&4194048&a)?t:s}function Ee(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Pe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function _e(){var e=Me;return!(62914560&(Me<<=1))&&(Me=4194304),e}function Te(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function Ae(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-ve(t);e.entangledLanes|=t,e.entanglements[n]=1073741824|e.entanglements[n]|261930&a}function Ie(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-ve(a),s=1<<n;s&t|e[n]&t&&(e[n]|=t),a&=~s}}function De(e,t){var a=t&-t;return 0!==((a=42&a?1:Fe(a))&(e.suspendedLanes|t))?0:a}function Fe(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Re(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function je(){var e=D.p;return 0!==e?e:void 0===(e=window.event)?32:Pp(e.type)}function Le(e,t){var a=D.p;try{return D.p=e,t()}finally{D.p=a}}var Be=Math.random().toString(36).slice(2),Ve="__reactFiber$"+Be,ze="__reactProps$"+Be,Ue="__reactContainer$"+Be,Ge="__reactEvents$"+Be,We="__reactListeners$"+Be,He="__reactHandles$"+Be,Ke="__reactResources$"+Be,$e="__reactMarker$"+Be;function qe(e){delete e[Ve],delete e[ze],delete e[Ge],delete e[We],delete e[He]}function Xe(e){var t=e[Ve];if(t)return t;for(var a=e.parentNode;a;){if(t=a[Ue]||a[Ve]){if(a=t.alternate,null!==t.child||null!==a&&null!==a.child)for(e=Ld(e);null!==e;){if(a=e[Ve])return a;e=Ld(e)}return t}a=(e=a).parentNode}return null}function Ye(e){if(e=e[Ve]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(n(33))}function Ze(e){var t=e[Ke];return t||(t=e[Ke]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Je(e){e[$e]=!0}var et=new Set,tt={};function at(e,t){nt(e,t),nt(e+"Capture",t)}function nt(e,t){for(tt[e]=t,e=0;e<t.length;e++)et.add(t[e])}var st=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},it={};function ot(e,t,a){if(s=t,ae.call(it,s)||!ae.call(rt,s)&&(st.test(s)?it[s]=!0:(rt[s]=!0,0)))if(null===a)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var n=t.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void e.removeAttribute(t)}e.setAttribute(t,""+a)}var s}function lt(e,t,a){if(null===a)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+a)}}function ct(e,t,a,n){if(null===n)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(a)}e.setAttributeNS(t,a,""+n)}}function ut(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=dt(e)?"checked":"value";e._valueTracker=function(e,t,a){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){a=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=dt(e)?e.checked?"true":"false":e.value),(e=n)!==a&&(t.setValue(e),!0)}function mt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function gt(e){return e.replace(ft,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yt(e,t,a,n,s,r,i,o){e.name="",null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ut(t)):e.value!==""+ut(t)&&(e.value=""+ut(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?vt(e,i,ut(t)):null!=a?vt(e,i,ut(a)):null!=n&&e.removeAttribute("value"),null==s&&null!=r&&(e.defaultChecked=!!r),null!=s&&(e.checked=s&&"function"!=typeof s&&"symbol"!=typeof s),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+ut(o):e.removeAttribute("name")}function bt(e,t,a,n,s,r,i,o){if(null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&(e.type=r),null!=t||null!=a){if(("submit"===r||"reset"===r)&&null==t)return void pt(e);a=null!=a?""+ut(a):"",t=null!=t?""+ut(t):a,o||t===e.value||(e.value=t),e.defaultValue=t}n="function"!=typeof(n=null!=n?n:s)&&"symbol"!=typeof n&&!!n,e.checked=o?e.checked:!!n,e.defaultChecked=!!n,null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i&&(e.name=i),pt(e)}function vt(e,t,a){"number"===t&&mt(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function xt(e,t,a,n){if(e=e.options,t){t={};for(var s=0;s<a.length;s++)t["$"+a[s]]=!0;for(a=0;a<e.length;a++)s=t.hasOwnProperty("$"+e[a].value),e[a].selected!==s&&(e[a].selected=s),s&&n&&(e[a].defaultSelected=!0)}else{for(a=""+ut(a),t=null,s=0;s<e.length;s++){if(e[s].value===a)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function wt(e,t,a){null==t||((t=""+ut(t))!==e.value&&(e.value=t),null!=a)?e.defaultValue=null!=a?""+ut(a):"":e.defaultValue!==t&&(e.defaultValue=t)}function kt(e,t,a,s){if(null==t){if(null!=s){if(null!=a)throw Error(n(92));if(O(s)){if(1<s.length)throw Error(n(93));s=s[0]}a=s}null==a&&(a=""),t=a}a=ut(t),e.defaultValue=a,(s=e.textContent)===a&&""!==s&&null!==s&&(e.value=s),pt(e)}function St(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&3===a.nodeType)return void(a.nodeValue=t)}e.textContent=t}var Mt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,a){var n=0===t.indexOf("--");null==a||"boolean"==typeof a||""===a?n?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":n?e.setProperty(t,a):"number"!=typeof a||0===a||Mt.has(t)?"float"===t?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Ct(e,t,a){if(null!=t&&"object"!=typeof t)throw Error(n(62));if(e=e.style,null!=a){for(var s in a)!a.hasOwnProperty(s)||null!=t&&t.hasOwnProperty(s)||(0===s.indexOf("--")?e.setProperty(s,""):"float"===s?e.cssFloat="":e[s]="");for(var r in t)s=t[r],t.hasOwnProperty(r)&&a[r]!==s&&Nt(e,r,s)}else for(var i in t)t.hasOwnProperty(i)&&Nt(e,i,t[i])}function Et(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_t=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tt(e){return _t.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function At(){}var Ot=null;function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,Ft=null;function Rt(e){var t=Ye(e);if(t&&(e=t.stateNode)){var a=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(yt(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,"radio"===a.type&&null!=t){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var s=a[t];if(s!==e&&s.form===e.form){var r=s[ze]||null;if(!r)throw Error(n(90));yt(s,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<a.length;t++)(s=a[t]).form===e.form&&ht(s)}break e;case"textarea":wt(e,a.value,a.defaultValue);break e;case"select":null!=(t=a.value)&&xt(e,!!a.multiple,t,!1)}}}var jt=!1;function Lt(e,t,a){if(jt)return e(t,a);jt=!0;try{return e(t)}finally{if(jt=!1,(null!==Dt||null!==Ft)&&(tu(),Dt&&(t=Dt,e=Ft,Ft=Dt=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Bt(e,t){var a=e.stateNode;if(null===a)return null;var s=a[ze]||null;if(null===s)return null;a=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(a&&"function"!=typeof a)throw Error(n(231,t,typeof a));return a}var Vt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),zt=!1;if(Vt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Jp){zt=!1}var Gt=null,Wt=null,Ht=null;function Kt(){if(Ht)return Ht;var e,t,a=Wt,n=a.length,s="value"in Gt?Gt.value:Gt.textContent,r=s.length;for(e=0;e<n&&a[e]===s[e];e++);var i=n-e;for(t=1;t<=i&&a[n-t]===s[r-t];t++);return Ht=s.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Xt(){return!1}function Yt(e){function t(t,a,n,s,r){for(var i in this._reactName=t,this._targetInst=n,this.type=a,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(s):s[i]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?qt:Xt,this.isPropagationStopped=Xt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var Qt,Zt,Jt,ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ta=Yt(ea),aa=p({},ea,{view:0,detail:0}),na=Yt(aa),sa=p({},aa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fa,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Qt=e.screenX-Jt.screenX,Zt=e.screenY-Jt.screenY):Zt=Qt=0,Jt=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),ra=Yt(sa),ia=Yt(p({},sa,{dataTransfer:0})),oa=Yt(p({},aa,{relatedTarget:0})),la=Yt(p({},ea,{animationName:0,elapsedTime:0,pseudoElement:0})),ca=Yt(p({},ea,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ua=Yt(p({},ea,{data:0})),da={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ha={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ma(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ha[e])&&!!t[e]}function fa(){return ma}var ga=Yt(p({},aa,{key:function(e){if(e.key){var t=da[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?pa[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fa,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),ya=Yt(p({},sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),va=Yt(p({},aa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fa})),xa=Yt(p({},ea,{propertyName:0,elapsedTime:0,pseudoElement:0})),wa=Yt(p({},sa,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Sa=Yt(p({},ea,{newState:0,oldState:0})),Ma=[9,13,27,32],Ca=Vt&&"CompositionEvent"in window,Ea=null;Vt&&"documentMode"in document&&(Ea=document.documentMode);var Pa=Vt&&"TextEvent"in window&&!Ea,_a=Vt&&(!Ca||Ea&&8<Ea&&11>=Ea),Ta=String.fromCharCode(32),Aa=!1;function Oa(e,t){switch(e){case"keyup":return-1!==Ma.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ia(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Da=!1;var Fa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ra(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Fa[e.type]:"textarea"===t}function ja(e,t,a,n){Dt?Ft?Ft.push(n):Ft=[n]:Dt=n,0<(t=rd(t,"onChange")).length&&(a=new ta("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var La=null,Ba=null;function Va(e){Qu(e,0)}function za(e){if(ht(Qe(e)))return e}function Ua(e,t){if("change"===e)return t}var Ga=!1;if(Vt){var Wa;if(Vt){var Ha="oninput"in document;if(!Ha){var Ka=document.createElement("div");Ka.setAttribute("oninput","return;"),Ha="function"==typeof Ka.oninput}Wa=Ha}else Wa=!1;Ga=Wa&&(!document.documentMode||9<document.documentMode)}function $a(){La&&(La.detachEvent("onpropertychange",qa),Ba=La=null)}function qa(e){if("value"===e.propertyName&&za(Ba)){var t=[];ja(t,Ba,e,It(e)),Lt(Va,t)}}function Xa(e,t,a){"focusin"===e?($a(),Ba=a,(La=t).attachEvent("onpropertychange",qa)):"focusout"===e&&$a()}function Ya(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return za(Ba)}function Qa(e,t){if("click"===e)return za(t)}function Za(e,t){if("input"===e||"change"===e)return za(t)}var Ja="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function en(e,t){if(Ja(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var s=a[n];if(!ae.call(t,s)||!Ja(e[s],t[s]))return!1}return!0}function tn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function an(e,t){var a,n=tn(e);for(e=0;n;){if(3===n.nodeType){if(a=e+n.textContent.length,e<=t&&a>=t)return{node:n,offset:t-e};e=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=tn(n)}}function nn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?nn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function sn(e){for(var t=mt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var a="string"==typeof t.contentWindow.location.href}catch(n){a=!1}if(!a)break;t=mt((e=t.contentWindow).document)}return t}function rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var on=Vt&&"documentMode"in document&&11>=document.documentMode,ln=null,cn=null,un=null,dn=!1;function pn(e,t,a){var n=a.window===a?a.document:9===a.nodeType?a:a.ownerDocument;dn||null==ln||ln!==mt(n)||("selectionStart"in(n=ln)&&rn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},un&&en(un,n)||(un=n,0<(n=rd(cn,"onSelect")).length&&(t=new ta("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=ln)))}function hn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var mn={animationend:hn("Animation","AnimationEnd"),animationiteration:hn("Animation","AnimationIteration"),animationstart:hn("Animation","AnimationStart"),transitionrun:hn("Transition","TransitionRun"),transitionstart:hn("Transition","TransitionStart"),transitioncancel:hn("Transition","TransitionCancel"),transitionend:hn("Transition","TransitionEnd")},fn={},gn={};function yn(e){if(fn[e])return fn[e];if(!mn[e])return e;var t,a=mn[e];for(t in a)if(a.hasOwnProperty(t)&&t in gn)return fn[e]=a[t];return e}Vt&&(gn=document.createElement("div").style,"AnimationEvent"in window||(delete mn.animationend.animation,delete mn.animationiteration.animation,delete mn.animationstart.animation),"TransitionEvent"in window||delete mn.transitionend.transition);var bn=yn("animationend"),vn=yn("animationiteration"),xn=yn("animationstart"),wn=yn("transitionrun"),kn=yn("transitionstart"),Sn=yn("transitioncancel"),Mn=yn("transitionend"),Nn=new Map,Cn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function En(e,t){Nn.set(e,t),at(t,[e])}Cn.push("scrollEnd");var Pn="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},_n=[],Tn=0,An=0;function On(){for(var e=Tn,t=An=Tn=0;t<e;){var a=_n[t];_n[t++]=null;var n=_n[t];_n[t++]=null;var s=_n[t];_n[t++]=null;var r=_n[t];if(_n[t++]=null,null!==n&&null!==s){var i=n.pending;null===i?s.next=s:(s.next=i.next,i.next=s),n.pending=s}0!==r&&Rn(a,s,r)}}function In(e,t,a,n){_n[Tn++]=e,_n[Tn++]=t,_n[Tn++]=a,_n[Tn++]=n,An|=n,e.lanes|=n,null!==(e=e.alternate)&&(e.lanes|=n)}function Dn(e,t,a,n){return In(e,t,a,n),jn(e)}function Fn(e,t){return In(e,null,null,t),jn(e)}function Rn(e,t,a){e.lanes|=a;var n=e.alternate;null!==n&&(n.lanes|=a);for(var s=!1,r=e.return;null!==r;)r.childLanes|=a,null!==(n=r.alternate)&&(n.childLanes|=a),22===r.tag&&(null===(e=r.stateNode)||1&e._visibility||(s=!0)),e=r,r=r.return;return 3===e.tag?(r=e.stateNode,s&&null!==t&&(s=31-ve(a),null===(n=(e=r.hiddenUpdates)[s])?e[s]=[t]:n.push(t),t.lane=536870912|a),r):null}function jn(e){if(50<Kc)throw Kc=0,$c=null,Error(n(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ln={};function Bn(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(e,t,a,n){return new Bn(e,t,a,n)}function zn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Un(e,t){var a=e.alternate;return null===a?((a=Vn(e.tag,t,e.key,e.mode)).elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=65011712&e.flags,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Gn(e,t){e.flags&=65011714;var a=e.alternate;return null===a?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Wn(e,t,a,s,r,i){var o=0;if(s=e,"function"==typeof e)zn(e)&&(o=1);else if("string"==typeof e)o=function(e,t,a){if(1===a||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,a,G.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Vn(31,a,t,r)).elementType=C,e.lanes=i,e;case g:return Hn(a.children,r,i,t);case y:o=8,r|=24;break;case b:return(e=Vn(12,a,t,2|r)).elementType=b,e.lanes=i,e;case k:return(e=Vn(13,a,t,r)).elementType=k,e.lanes=i,e;case S:return(e=Vn(19,a,t,r)).elementType=S,e.lanes=i,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:o=10;break e;case v:o=9;break e;case w:o=11;break e;case M:o=14;break e;case N:o=16,s=null;break e}o=29,a=Error(n(130,null===e?"null":typeof e,"")),s=null}return(t=Vn(o,a,t,r)).elementType=e,t.type=s,t.lanes=i,t}function Hn(e,t,a,n){return(e=Vn(7,e,n,t)).lanes=a,e}function Kn(e,t,a){return(e=Vn(6,e,null,t)).lanes=a,e}function $n(e){var t=Vn(18,null,null,0);return t.stateNode=e,t}function qn(e,t,a){return(t=Vn(4,null!==e.children?e.children:[],e.key,t)).lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Xn=new WeakMap;function Yn(e,t){if("object"==typeof e&&null!==e){var a=Xn.get(e);return void 0!==a?a:(t={value:e,source:t,stack:te(t)},Xn.set(e,t),t)}return{value:e,source:t,stack:te(t)}}var Qn=[],Zn=0,Jn=null,es=0,ts=[],as=0,ns=null,ss=1,rs="";function is(e,t){Qn[Zn++]=es,Qn[Zn++]=Jn,Jn=e,es=t}function os(e,t,a){ts[as++]=ss,ts[as++]=rs,ts[as++]=ns,ns=e;var n=ss;e=rs;var s=32-ve(n)-1;n&=~(1<<s),a+=1;var r=32-ve(t)+s;if(30<r){var i=s-s%5;r=(n&(1<<i)-1).toString(32),n>>=i,s-=i,ss=1<<32-ve(t)+s|a<<s|n,rs=r+e}else ss=1<<r|a<<s|n,rs=e}function ls(e){null!==e.return&&(is(e,1),os(e,1,0))}function cs(e){for(;e===Jn;)Jn=Qn[--Zn],Qn[Zn]=null,es=Qn[--Zn],Qn[Zn]=null;for(;e===ns;)ns=ts[--as],ts[as]=null,rs=ts[--as],ts[as]=null,ss=ts[--as],ts[as]=null}function us(e,t){ts[as++]=ss,ts[as++]=rs,ts[as++]=ns,ss=t.id,rs=t.overflow,ns=e}var ds=null,ps=null,hs=!1,ms=null,fs=!1,gs=Error(n(519));function ys(e){throw Ss(Yn(Error(n(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),gs}function bs(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[Ve]=e,t[ze]=n,a){case"dialog":Zu("cancel",t),Zu("close",t);break;case"iframe":case"object":case"embed":Zu("load",t);break;case"video":case"audio":for(a=0;a<Xu.length;a++)Zu(Xu[a],t);break;case"source":Zu("error",t);break;case"img":case"image":case"link":Zu("error",t),Zu("load",t);break;case"details":Zu("toggle",t);break;case"input":Zu("invalid",t),bt(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Zu("invalid",t);break;case"textarea":Zu("invalid",t),kt(t,n.value,n.defaultValue,n.children)}"string"!=typeof(a=n.children)&&"number"!=typeof a&&"bigint"!=typeof a||t.textContent===""+a||!0===n.suppressHydrationWarning||dd(t.textContent,a)?(null!=n.popover&&(Zu("beforetoggle",t),Zu("toggle",t)),null!=n.onScroll&&Zu("scroll",t),null!=n.onScrollEnd&&Zu("scrollend",t),null!=n.onClick&&(t.onclick=At),t=!0):t=!1,t||ys(e,!0)}function vs(e){for(ds=e.return;ds;)switch(ds.tag){case 5:case 31:case 13:return void(fs=!1);case 27:case 3:return void(fs=!0);default:ds=ds.return}}function xs(e){if(e!==ds)return!1;if(!hs)return vs(e),hs=!0,!1;var t,a=e.tag;if((t=3!==a&&27!==a)&&((t=5===a)&&(t=!("form"!==(t=e.type)&&"button"!==t)||wd(e.type,e.memoizedProps)),t=!t),t&&ps&&ys(e),vs(e),13===a){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));ps=jd(e)}else if(31===a){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));ps=jd(e)}else 27===a?(a=ps,Pd(e.type)?(e=Rd,Rd=null,ps=e):ps=a):ps=ds?Fd(e.stateNode.nextSibling):null;return!0}function ws(){ps=ds=null,hs=!1}function ks(){var e=ms;return null!==e&&(null===Oc?Oc=e:Oc.push.apply(Oc,e),ms=null),e}function Ss(e){null===ms?ms=[e]:ms.push(e)}var Ms=L(null),Ns=null,Cs=null;function Es(e,t,a){V(Ms,t._currentValue),t._currentValue=a}function Ps(e){e._currentValue=Ms.current,B(Ms)}function _s(e,t,a){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function Ts(e,t,a,s){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var i=r.dependencies;if(null!==i){var o=r.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=a,null!==(l=i.alternate)&&(l.lanes|=a),_s(i.return,a,e),s||(o=null);break e}i=l.next}}else if(18===r.tag){if(null===(o=r.return))throw Error(n(341));o.lanes|=a,null!==(i=o.alternate)&&(i.lanes|=a),_s(o,a,e),o=null}else o=r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===e){o=null;break}if(null!==(r=o.sibling)){r.return=o.return,o=r;break}o=o.return}r=o}}function As(e,t,a,s){e=null;for(var r=t,i=!1;null!==r;){if(!i)if(524288&r.flags)i=!0;else if(262144&r.flags)break;if(10===r.tag){var o=r.alternate;if(null===o)throw Error(n(387));if(null!==(o=o.memoizedProps)){var l=r.type;Ja(r.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(r===K.current){if(null===(o=r.alternate))throw Error(n(387));o.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(pp):e=[pp])}r=r.return}null!==e&&Ts(t,e,a,s),t.flags|=262144}function Os(e){for(e=e.firstContext;null!==e;){if(!Ja(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Is(e){Ns=e,Cs=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ds(e){return Rs(Ns,e)}function Fs(e,t){return null===Ns&&Is(e),Rs(e,t)}function Rs(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},null===Cs){if(null===e)throw Error(n(308));Cs=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Cs=Cs.next=t;return a}var js="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,a){e.push(a)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ls=e.unstable_scheduleCallback,Bs=e.unstable_NormalPriority,Vs={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zs(){return{controller:new js,data:new Map,refCount:0}}function Us(e){e.refCount--,0===e.refCount&&Ls(Bs,function(){e.controller.abort()})}var Gs=null,Ws=0,Hs=0,Ks=null;function $s(){if(0===--Ws&&null!==Gs){null!==Ks&&(Ks.status="fulfilled");var e=Gs;Gs=null,Hs=0,Ks=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var qs=I.S;I.S=function(e,t){Fc=oe(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Gs){var a=Gs=[];Ws=0,Hs=Wu(),Ks={status:"pending",value:void 0,then:function(e){a.push(e)}}}Ws++,t.then($s,$s)}(0,t),null!==qs&&qs(e,t)};var Xs=L(null);function Ys(){var e=Xs.current;return null!==e?e:gc.pooledCache}function Qs(e,t){V(Xs,null===t?Xs.current:t.pool)}function Zs(){var e=Ys();return null===e?null:{parent:Vs._currentValue,pool:e}}var Js=Error(n(460)),er=Error(n(474)),tr=Error(n(542)),ar={then:function(){}};function nr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function sr(e,t,a){switch(void 0===(a=e[a])?e.push(t):a!==t&&(t.then(At,At),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e;default:if("string"==typeof t.status)t.then(At,At);else{if(null!==(e=gc)&&100<e.shellSuspendCounter)throw Error(n(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var a=t;a.status="fulfilled",a.value=e}},function(e){if("pending"===t.status){var a=t;a.status="rejected",a.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e}throw ir=t,Js}}function rr(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw ir=t,Js;throw t}}var ir=null;function or(){if(null===ir)throw Error(n(459));var e=ir;return ir=null,e}function lr(e){if(e===Js||e===tr)throw Error(n(483))}var cr=null,ur=0;function dr(e){var t=ur;return ur+=1,null===cr&&(cr=[]),sr(cr,e,t)}function pr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function hr(e,t){if(t.$$typeof===h)throw Error(n(525));throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mr(e){function t(t,a){if(e){var n=t.deletions;null===n?(t.deletions=[a],t.flags|=16):n.push(a)}}function a(a,n){if(!e)return null;for(;null!==n;)t(a,n),n=n.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Un(e,t)).index=0,e.sibling=null,e}function i(t,a,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<a?(t.flags|=67108866,a):n:(t.flags|=67108866,a):(t.flags|=1048576,a)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,a,n){return null===t||6!==t.tag?((t=Kn(a,e.mode,n)).return=e,t):((t=r(t,a)).return=e,t)}function c(e,t,a,n){var s=a.type;return s===g?d(e,t,a.props.children,n,a.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===N&&rr(s)===t.type)?(pr(t=r(t,a.props),a),t.return=e,t):(pr(t=Wn(a.type,a.key,a.props,null,e.mode,n),a),t.return=e,t)}function u(e,t,a,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==a.containerInfo||t.stateNode.implementation!==a.implementation?((t=qn(a,e.mode,n)).return=e,t):((t=r(t,a.children||[])).return=e,t)}function d(e,t,a,n,s){return null===t||7!==t.tag?((t=Hn(a,e.mode,n,s)).return=e,t):((t=r(t,a)).return=e,t)}function p(e,t,a){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Kn(""+t,e.mode,a)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case m:return pr(a=Wn(t.type,t.key,t.props,null,e.mode,a),t),a.return=e,a;case f:return(t=qn(t,e.mode,a)).return=e,t;case N:return p(e,t=rr(t),a)}if(O(t)||_(t))return(t=Hn(t,e.mode,a,null)).return=e,t;if("function"==typeof t.then)return p(e,dr(t),a);if(t.$$typeof===x)return p(e,Fs(e,t),a);hr(e,t)}return null}function h(e,t,a,n){var s=null!==t?t.key:null;if("string"==typeof a&&""!==a||"number"==typeof a||"bigint"==typeof a)return null!==s?null:l(e,t,""+a,n);if("object"==typeof a&&null!==a){switch(a.$$typeof){case m:return a.key===s?c(e,t,a,n):null;case f:return a.key===s?u(e,t,a,n):null;case N:return h(e,t,a=rr(a),n)}if(O(a)||_(a))return null!==s?null:d(e,t,a,n,null);if("function"==typeof a.then)return h(e,t,dr(a),n);if(a.$$typeof===x)return h(e,t,Fs(e,a),n);hr(e,a)}return null}function y(e,t,a,n,s){if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return l(t,e=e.get(a)||null,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case m:return c(t,e=e.get(null===n.key?a:n.key)||null,n,s);case f:return u(t,e=e.get(null===n.key?a:n.key)||null,n,s);case N:return y(e,t,a,n=rr(n),s)}if(O(n)||_(n))return d(t,e=e.get(a)||null,n,s,null);if("function"==typeof n.then)return y(e,t,a,dr(n),s);if(n.$$typeof===x)return y(e,t,a,Fs(t,n),s);hr(t,n)}return null}function b(l,c,u,d){if("object"==typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case m:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===g){if(7===c.tag){a(l,c.sibling),(d=r(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===v||"object"==typeof v&&null!==v&&v.$$typeof===N&&rr(v)===c.type){a(l,c.sibling),pr(d=r(c,u.props),u),d.return=l,l=d;break e}a(l,c);break}t(l,c),c=c.sibling}u.type===g?((d=Hn(u.props.children,l.mode,d,u.key)).return=l,l=d):(pr(d=Wn(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return o(l);case f:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){a(l,c.sibling),(d=r(c,u.children||[])).return=l,l=d;break e}a(l,c);break}t(l,c),c=c.sibling}(d=qn(u,l.mode,d)).return=l,l=d}return o(l);case N:return b(l,c,u=rr(u),d)}if(O(u))return function(n,r,o,l){for(var c=null,u=null,d=r,m=r=0,f=null;null!==d&&m<o.length;m++){d.index>m?(f=d,d=null):f=d.sibling;var g=h(n,d,o[m],l);if(null===g){null===d&&(d=f);break}e&&d&&null===g.alternate&&t(n,d),r=i(g,r,m),null===u?c=g:u.sibling=g,u=g,d=f}if(m===o.length)return a(n,d),hs&&is(n,m),c;if(null===d){for(;m<o.length;m++)null!==(d=p(n,o[m],l))&&(r=i(d,r,m),null===u?c=d:u.sibling=d,u=d);return hs&&is(n,m),c}for(d=s(d);m<o.length;m++)null!==(f=y(d,n,m,o[m],l))&&(e&&null!==f.alternate&&d.delete(null===f.key?m:f.key),r=i(f,r,m),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach(function(e){return t(n,e)}),hs&&is(n,m),c}(l,c,u,d);if(_(u)){if("function"!=typeof(v=_(u)))throw Error(n(150));return function(r,o,l,c){if(null==l)throw Error(n(151));for(var u=null,d=null,m=o,f=o=0,g=null,b=l.next();null!==m&&!b.done;f++,b=l.next()){m.index>f?(g=m,m=null):g=m.sibling;var v=h(r,m,b.value,c);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(r,m),o=i(v,o,f),null===d?u=v:d.sibling=v,d=v,m=g}if(b.done)return a(r,m),hs&&is(r,f),u;if(null===m){for(;!b.done;f++,b=l.next())null!==(b=p(r,b.value,c))&&(o=i(b,o,f),null===d?u=b:d.sibling=b,d=b);return hs&&is(r,f),u}for(m=s(m);!b.done;f++,b=l.next())null!==(b=y(m,r,f,b.value,c))&&(e&&null!==b.alternate&&m.delete(null===b.key?f:b.key),o=i(b,o,f),null===d?u=b:d.sibling=b,d=b);return e&&m.forEach(function(e){return t(r,e)}),hs&&is(r,f),u}(l,c,u=v.call(u),d)}if("function"==typeof u.then)return b(l,c,dr(u),d);if(u.$$typeof===x)return b(l,c,Fs(l,u),d);hr(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(a(l,c.sibling),(d=r(c,u)).return=l,l=d):(a(l,c),(d=Kn(u,l.mode,d)).return=l,l=d),o(l)):a(l,c)}return function(e,t,a,n){try{ur=0;var s=b(e,t,a,n);return cr=null,s}catch(i){if(i===Js||i===tr)throw i;var r=Vn(29,i,null,e.mode);return r.lanes=n,r.return=e,r}}}var fr=mr(!0),gr=mr(!1),yr=!1;function br(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function xr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wr(e,t,a){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,2&fc){var s=n.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),n.pending=t,t=jn(e),Rn(e,null,a),t}return In(e,n,t,a),jn(e)}function kr(e,t,a){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&a)){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,Ie(e,a)}}function Sr(e,t){var a=e.updateQueue,n=e.alternate;if(null!==n&&a===(n=n.updateQueue)){var s=null,r=null;if(null!==(a=a.firstBaseUpdate)){do{var i={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};null===r?s=r=i:r=r.next=i,a=a.next}while(null!==a);null===r?s=r=t:r=r.next=t}else s=r=t;return a={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},void(e.updateQueue=a)}null===(e=a.lastBaseUpdate)?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var Mr=!1;function Nr(){if(Mr){if(null!==Ks)throw Ks}}function Cr(e,t,a,n){Mr=!1;var s=e.updateQueue;yr=!1;var r=s.firstBaseUpdate,i=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?r=c:i.next=c,i=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==r){var d=s.baseState;for(i=0,u=c=l=null,o=r;;){var h=-536870913&o.lane,m=h!==o.lane;if(m?(bc&h)===h:(n&h)===h){0!==h&&h===Hs&&(Mr=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,g=o;h=t;var y=a;switch(g.tag){case 1:if("function"==typeof(f=g.payload)){d=f.call(y,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=g.payload)?f.call(y,d,h):f))break e;d=p({},d,h);break e;case 2:yr=!0}}null!==(h=o.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=s.callbacks)?s.callbacks=[h]:m.push(h))}else m={lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=m,l=d):u=u.next=m,i|=h;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(m=o).next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}null===u&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null===r&&(s.shared.lanes=0),Cc|=i,e.lanes=i,e.memoizedState=d}}function Er(e,t){if("function"!=typeof e)throw Error(n(191,e));e.call(t)}function Pr(e,t){var a=e.callbacks;if(null!==a)for(e.callbacks=null,e=0;e<a.length;e++)Er(a[e],t)}var _r=L(null),Tr=L(0);function Ar(e,t){V(Tr,e=Mc),V(_r,t),Mc=e|t.baseLanes}function Or(){V(Tr,Mc),V(_r,_r.current)}function Ir(){Mc=Tr.current,B(_r),B(Tr)}var Dr=L(null),Fr=null;function Rr(e){var t=e.alternate;V(zr,1&zr.current),V(Dr,e),null===Fr&&(null===t||null!==_r.current||null!==t.memoizedState)&&(Fr=e)}function jr(e){V(zr,zr.current),V(Dr,e),null===Fr&&(Fr=e)}function Lr(e){22===e.tag?(V(zr,zr.current),V(Dr,e),null===Fr&&(Fr=e)):Br()}function Br(){V(zr,zr.current),V(Dr,Dr.current)}function Vr(e){B(Dr),Fr===e&&(Fr=null),B(zr)}var zr=L(0);function Ur(e){for(var t=e;null!==t;){if(13===t.tag){var a=t.memoizedState;if(null!==a&&(null===(a=a.dehydrated)||Id(a)||Dd(a)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gr=0,Wr=null,Hr=null,Kr=null,$r=!1,qr=!1,Xr=!1,Yr=0,Qr=0,Zr=null,Jr=0;function ei(){throw Error(n(321))}function ti(e,t){if(null===t)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Ja(e[a],t[a]))return!1;return!0}function ai(e,t,a,n,s,r){return Gr=r,Wr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,I.H=null===e||null===e.memoizedState?bo:vo,Xr=!1,r=a(n,s),Xr=!1,qr&&(r=si(t,a,n,s)),ni(e),r}function ni(e){I.H=yo;var t=null!==Hr&&null!==Hr.next;if(Gr=0,Kr=Hr=Wr=null,$r=!1,Qr=0,Zr=null,t)throw Error(n(300));null===e||Fo||null!==(e=e.dependencies)&&Os(e)&&(Fo=!0)}function si(e,t,a,s){Wr=e;var r=0;do{if(qr&&(Zr=null),Qr=0,qr=!1,25<=r)throw Error(n(301));if(r+=1,Kr=Hr=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}I.H=xo,i=t(a,s)}while(qr);return i}function ri(){var e=I.H,t=e.useState()[0];return t="function"==typeof t.then?di(t):t,e=e.useState()[0],(null!==Hr?Hr.memoizedState:null)!==e&&(Wr.flags|=1024),t}function ii(){var e=0!==Yr;return Yr=0,e}function oi(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function li(e){if($r){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}$r=!1}Gr=0,Kr=Hr=Wr=null,qr=!1,Qr=Yr=0,Zr=null}function ci(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Kr?Wr.memoizedState=Kr=e:Kr=Kr.next=e,Kr}function ui(){if(null===Hr){var e=Wr.alternate;e=null!==e?e.memoizedState:null}else e=Hr.next;var t=null===Kr?Wr.memoizedState:Kr.next;if(null!==t)Kr=t,Hr=e;else{if(null===e){if(null===Wr.alternate)throw Error(n(467));throw Error(n(310))}e={memoizedState:(Hr=e).memoizedState,baseState:Hr.baseState,baseQueue:Hr.baseQueue,queue:Hr.queue,next:null},null===Kr?Wr.memoizedState=Kr=e:Kr=Kr.next=e}return Kr}function di(e){var t=Qr;return Qr+=1,null===Zr&&(Zr=[]),e=sr(Zr,e,t),t=Wr,null===(null===Kr?t.memoizedState:Kr.next)&&(t=t.alternate,I.H=null===t||null===t.memoizedState?bo:vo),e}function pi(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return di(e);if(e.$$typeof===x)return Ds(e)}throw Error(n(438,String(e)))}function hi(e){var t=null,a=Wr.updateQueue;if(null!==a&&(t=a.memoCache),null==t){var n=Wr.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(t={data:n.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===a&&(a={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=a),a.memoCache=t,void 0===(a=t.data[t.index]))for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=E;return t.index++,a}function mi(e,t){return"function"==typeof t?t(e):t}function fi(e){return gi(ui(),Hr,e)}function gi(e,t,a){var s=e.queue;if(null===s)throw Error(n(311));s.lastRenderedReducer=a;var r=e.baseQueue,i=s.pending;if(null!==i){if(null!==r){var o=r.next;r.next=i.next,i.next=o}t.baseQueue=r=i,s.pending=null}if(i=e.baseState,null===r)e.memoizedState=i;else{var l=o=null,c=null,u=t=r.next,d=!1;do{var p=-536870913&u.lane;if(p!==u.lane?(bc&p)===p:(Gr&p)===p){var h=u.revertLane;if(0===h)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),p===Hs&&(d=!0);else{if((Gr&h)===h){u=u.next,h===Hs&&(d=!0);continue}p={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,o=i):c=c.next=p,Wr.lanes|=h,Cc|=h}p=u.action,Xr&&a(i,p),i=u.hasEagerState?u.eagerState:a(i,p)}else h={lane:p,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,o=i):c=c.next=h,Wr.lanes|=p,Cc|=p;u=u.next}while(null!==u&&u!==t);if(null===c?o=i:c.next=l,!Ja(i,e.memoizedState)&&(Fo=!0,d&&null!==(a=Ks)))throw a;e.memoizedState=i,e.baseState=o,e.baseQueue=c,s.lastRenderedState=i}return null===r&&(s.lanes=0),[e.memoizedState,s.dispatch]}function yi(e){var t=ui(),a=t.queue;if(null===a)throw Error(n(311));a.lastRenderedReducer=e;var s=a.dispatch,r=a.pending,i=t.memoizedState;if(null!==r){a.pending=null;var o=r=r.next;do{i=e(i,o.action),o=o.next}while(o!==r);Ja(i,t.memoizedState)||(Fo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),a.lastRenderedState=i}return[i,s]}function bi(e,t,a){var s=Wr,r=ui(),i=hs;if(i){if(void 0===a)throw Error(n(407));a=a()}else a=t();var o=!Ja((Hr||r).memoizedState,a);if(o&&(r.memoizedState=a,Fo=!0),r=r.queue,Gi(wi.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||null!==Kr&&1&Kr.memoizedState.tag){if(s.flags|=2048,Li(9,{destroy:void 0},xi.bind(null,s,r,a,t),null),null===gc)throw Error(n(349));i||127&Gr||vi(s,t,a)}return a}function vi(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},null===(t=Wr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.stores=[e]):null===(a=t.stores)?t.stores=[e]:a.push(e)}function xi(e,t,a,n){t.value=a,t.getSnapshot=n,ki(t)&&Si(e)}function wi(e,t,a){return a(function(){ki(t)&&Si(e)})}function ki(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Ja(e,a)}catch(n){return!0}}function Si(e){var t=Fn(e,2);null!==t&&Yc(t,e,2)}function Mi(e){var t=ci();if("function"==typeof e){var a=e;if(e=a(),Xr){be(!0);try{a()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mi,lastRenderedState:e},t}function Ni(e,t,a,n){return e.baseState=a,gi(e,Hr,"function"==typeof n?n:mi)}function Ci(e,t,a,s,r){if(mo(e))throw Error(n(485));if(null!==(e=t.action)){var i={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==I.T?a(!0):i.isTransition=!1,s(i),null===(a=t.pending)?(i.next=t.pending=i,Ei(t,i)):(i.next=a.next,t.pending=a.next=i)}}function Ei(e,t){var a=t.action,n=t.payload,s=e.state;if(t.isTransition){var r=I.T,i={};I.T=i;try{var o=a(s,n),l=I.S;null!==l&&l(i,o),Pi(e,t,o)}catch(c){Ti(e,t,c)}finally{null!==r&&null!==i.types&&(r.types=i.types),I.T=r}}else try{Pi(e,t,r=a(s,n))}catch(u){Ti(e,t,u)}}function Pi(e,t,a){null!==a&&"object"==typeof a&&"function"==typeof a.then?a.then(function(a){_i(e,t,a)},function(a){return Ti(e,t,a)}):_i(e,t,a)}function _i(e,t,a){t.status="fulfilled",t.value=a,Ai(t),e.state=a,null!==(t=e.pending)&&((a=t.next)===t?e.pending=null:(a=a.next,t.next=a,Ei(e,a)))}function Ti(e,t,a){var n=e.pending;if(e.pending=null,null!==n){n=n.next;do{t.status="rejected",t.reason=a,Ai(t),t=t.next}while(t!==n)}e.action=null}function Ai(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Oi(e,t){return t}function Ii(e,t){if(hs){var a=gc.formState;if(null!==a){e:{var n=Wr;if(hs){if(ps){t:{for(var s=ps,r=fs;8!==s.nodeType;){if(!r){s=null;break t}if(null===(s=Fd(s.nextSibling))){s=null;break t}}s="F!"===(r=s.data)||"F"===r?s:null}if(s){ps=Fd(s.nextSibling),n="F!"===s.data;break e}}ys(n)}n=!1}n&&(t=a[0])}}return(a=ci()).memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:t},a.queue=n,a=uo.bind(null,Wr,n),n.dispatch=a,n=Mi(!1),r=ho.bind(null,Wr,!1,n.queue),s={state:t,dispatch:null,action:e,pending:null},(n=ci()).queue=s,a=Ci.bind(null,Wr,s,r,a),s.dispatch=a,n.memoizedState=e,[t,a,!1]}function Di(e){return Fi(ui(),Hr,e)}function Fi(e,t,a){if(t=gi(e,t,Oi)[0],e=fi(mi)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var n=di(t)}catch(i){if(i===Js)throw tr;throw i}else n=t;var s=(t=ui()).queue,r=s.dispatch;return a!==t.memoizedState&&(Wr.flags|=2048,Li(9,{destroy:void 0},Ri.bind(null,s,a),null)),[n,r,e]}function Ri(e,t){e.action=t}function ji(e){var t=ui(),a=Hr;if(null!==a)return Fi(t,a,e);ui(),t=t.memoizedState;var n=(a=ui()).queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Li(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},null===(t=Wr.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t),null===(a=t.lastEffect)?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function Bi(){return ui().memoizedState}function Vi(e,t,a,n){var s=ci();Wr.flags|=e,s.memoizedState=Li(1|t,{destroy:void 0},a,void 0===n?null:n)}function zi(e,t,a,n){var s=ui();n=void 0===n?null:n;var r=s.memoizedState.inst;null!==Hr&&null!==n&&ti(n,Hr.memoizedState.deps)?s.memoizedState=Li(t,r,a,n):(Wr.flags|=e,s.memoizedState=Li(1|t,r,a,n))}function Ui(e,t){Vi(8390656,8,e,t)}function Gi(e,t){zi(2048,8,e,t)}function Wi(e){var t=ui().memoizedState;return function(e){Wr.flags|=4;var t=Wr.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.events=[e];else{var a=t.events;null===a?t.events=[e]:a.push(e)}}({ref:t,nextImpl:e}),function(){if(2&fc)throw Error(n(440));return t.impl.apply(void 0,arguments)}}function Hi(e,t){return zi(4,2,e,t)}function Ki(e,t){return zi(4,4,e,t)}function $i(e,t){if("function"==typeof t){e=e();var a=t(e);return function(){"function"==typeof a?a():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function qi(e,t,a){a=null!=a?a.concat([e]):null,zi(4,4,$i.bind(null,t,e),a)}function Xi(){}function Yi(e,t){var a=ui();t=void 0===t?null:t;var n=a.memoizedState;return null!==t&&ti(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Qi(e,t){var a=ui();t=void 0===t?null:t;var n=a.memoizedState;if(null!==t&&ti(t,n[1]))return n[0];if(n=e(),Xr){be(!0);try{e()}finally{be(!1)}}return a.memoizedState=[n,t],n}function Zi(e,t,a){return void 0===a||1073741824&Gr&&!(261930&bc)?e.memoizedState=t:(e.memoizedState=a,e=Xc(),Wr.lanes|=e,Cc|=e,a)}function Ji(e,t,a,n){return Ja(a,t)?a:null!==_r.current?(e=Zi(e,a,n),Ja(e,t)||(Fo=!0),e):42&Gr&&(!(1073741824&Gr)||261930&bc)?(e=Xc(),Wr.lanes|=e,Cc|=e,t):(Fo=!0,e.memoizedState=a)}function eo(e,t,a,n,s){var r=D.p;D.p=0!==r&&8>r?r:8;var i,o,l,c=I.T,u={};I.T=u,ho(e,!1,t,a);try{var d=s(),p=I.S;if(null!==p&&p(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then)po(e,t,(i=n,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},d.then(function(){l.status="fulfilled",l.value=i;for(var e=0;e<o.length;e++)(0,o[e])(i)},function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)}),l),qc());else po(e,t,n,qc())}catch(h){po(e,t,{then:function(){},status:"rejected",reason:h},qc())}finally{D.p=r,null!==c&&null!==u.types&&(c.types=u.types),I.T=c}}function to(){}function ao(e,t,a,s){if(5!==e.tag)throw Error(n(476));var r=no(e).queue;eo(e,r,t,F,null===a?to:function(){return so(e),a(s)})}function no(e){var t=e.memoizedState;if(null!==t)return t;var a={};return(t={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mi,lastRenderedState:F},next:null}).next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mi,lastRenderedState:a},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function so(e){var t=no(e);null===t.next&&(t=e.alternate.memoizedState),po(e,t.next.queue,{},qc())}function ro(){return Ds(pp)}function io(){return ui().memoizedState}function oo(){return ui().memoizedState}function lo(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var a=qc(),n=wr(t,e=xr(a),a);return null!==n&&(Yc(n,t,a),kr(n,t,a)),t={cache:zs()},void(e.payload=t)}t=t.return}}function co(e,t,a){var n=qc();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},mo(e)?fo(t,a):null!==(a=Dn(e,t,a,n))&&(Yc(a,e,n),go(a,t,n))}function uo(e,t,a){po(e,t,a,qc())}function po(e,t,a,n){var s={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(mo(e))fo(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=r(i,a);if(s.hasEagerState=!0,s.eagerState=o,Ja(o,i))return In(e,t,s,0),null===gc&&On(),!1}catch(l){}if(null!==(a=Dn(e,t,s,n)))return Yc(a,e,n),go(a,t,n),!0}return!1}function ho(e,t,a,s){if(s={lane:2,revertLane:Wu(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},mo(e)){if(t)throw Error(n(479))}else null!==(t=Dn(e,a,s,2))&&Yc(t,e,2)}function mo(e){var t=e.alternate;return e===Wr||null!==t&&t===Wr}function fo(e,t){qr=$r=!0;var a=e.pending;null===a?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function go(e,t,a){if(4194048&a){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,Ie(e,a)}}var yo={readContext:Ds,use:pi,useCallback:ei,useContext:ei,useEffect:ei,useImperativeHandle:ei,useLayoutEffect:ei,useInsertionEffect:ei,useMemo:ei,useReducer:ei,useRef:ei,useState:ei,useDebugValue:ei,useDeferredValue:ei,useTransition:ei,useSyncExternalStore:ei,useId:ei,useHostTransitionStatus:ei,useFormState:ei,useActionState:ei,useOptimistic:ei,useMemoCache:ei,useCacheRefresh:ei};yo.useEffectEvent=ei;var bo={readContext:Ds,use:pi,useCallback:function(e,t){return ci().memoizedState=[e,void 0===t?null:t],e},useContext:Ds,useEffect:Ui,useImperativeHandle:function(e,t,a){a=null!=a?a.concat([e]):null,Vi(4194308,4,$i.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Vi(4194308,4,e,t)},useInsertionEffect:function(e,t){Vi(4,2,e,t)},useMemo:function(e,t){var a=ci();t=void 0===t?null:t;var n=e();if(Xr){be(!0);try{e()}finally{be(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=ci();if(void 0!==a){var s=a(t);if(Xr){be(!0);try{a(t)}finally{be(!1)}}}else s=t;return n.memoizedState=n.baseState=s,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},n.queue=e,e=e.dispatch=co.bind(null,Wr,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ci().memoizedState=e},useState:function(e){var t=(e=Mi(e)).queue,a=uo.bind(null,Wr,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Xi,useDeferredValue:function(e,t){return Zi(ci(),e,t)},useTransition:function(){var e=Mi(!1);return e=eo.bind(null,Wr,e.queue,!0,!1),ci().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var s=Wr,r=ci();if(hs){if(void 0===a)throw Error(n(407));a=a()}else{if(a=t(),null===gc)throw Error(n(349));127&bc||vi(s,t,a)}r.memoizedState=a;var i={value:a,getSnapshot:t};return r.queue=i,Ui(wi.bind(null,s,i,e),[e]),s.flags|=2048,Li(9,{destroy:void 0},xi.bind(null,s,i,a,t),null),a},useId:function(){var e=ci(),t=gc.identifierPrefix;if(hs){var a=rs;t="_"+t+"R_"+(a=(ss&~(1<<32-ve(ss)-1)).toString(32)+a),0<(a=Yr++)&&(t+="H"+a.toString(32)),t+="_"}else t="_"+t+"r_"+(a=Jr++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ro,useFormState:Ii,useActionState:Ii,useOptimistic:function(e){var t=ci();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=ho.bind(null,Wr,!0,a),a.dispatch=t,[e,t]},useMemoCache:hi,useCacheRefresh:function(){return ci().memoizedState=lo.bind(null,Wr)},useEffectEvent:function(e){var t=ci(),a={impl:e};return t.memoizedState=a,function(){if(2&fc)throw Error(n(440));return a.impl.apply(void 0,arguments)}}},vo={readContext:Ds,use:pi,useCallback:Yi,useContext:Ds,useEffect:Gi,useImperativeHandle:qi,useInsertionEffect:Hi,useLayoutEffect:Ki,useMemo:Qi,useReducer:fi,useRef:Bi,useState:function(){return fi(mi)},useDebugValue:Xi,useDeferredValue:function(e,t){return Ji(ui(),Hr.memoizedState,e,t)},useTransition:function(){var e=fi(mi)[0],t=ui().memoizedState;return["boolean"==typeof e?e:di(e),t]},useSyncExternalStore:bi,useId:io,useHostTransitionStatus:ro,useFormState:Di,useActionState:Di,useOptimistic:function(e,t){return Ni(ui(),0,e,t)},useMemoCache:hi,useCacheRefresh:oo};vo.useEffectEvent=Wi;var xo={readContext:Ds,use:pi,useCallback:Yi,useContext:Ds,useEffect:Gi,useImperativeHandle:qi,useInsertionEffect:Hi,useLayoutEffect:Ki,useMemo:Qi,useReducer:yi,useRef:Bi,useState:function(){return yi(mi)},useDebugValue:Xi,useDeferredValue:function(e,t){var a=ui();return null===Hr?Zi(a,e,t):Ji(a,Hr.memoizedState,e,t)},useTransition:function(){var e=yi(mi)[0],t=ui().memoizedState;return["boolean"==typeof e?e:di(e),t]},useSyncExternalStore:bi,useId:io,useHostTransitionStatus:ro,useFormState:ji,useActionState:ji,useOptimistic:function(e,t){var a=ui();return null!==Hr?Ni(a,0,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:hi,useCacheRefresh:oo};function wo(e,t,a,n){a=null==(a=a(n,t=e.memoizedState))?t:p({},t,a),e.memoizedState=a,0===e.lanes&&(e.updateQueue.baseState=a)}xo.useEffectEvent=Wi;var ko={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=qc(),s=xr(n);s.payload=t,null!=a&&(s.callback=a),null!==(t=wr(e,s,n))&&(Yc(t,e,n),kr(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=qc(),s=xr(n);s.tag=1,s.payload=t,null!=a&&(s.callback=a),null!==(t=wr(e,s,n))&&(Yc(t,e,n),kr(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=qc(),n=xr(a);n.tag=2,null!=t&&(n.callback=t),null!==(t=wr(e,n,a))&&(Yc(t,e,a),kr(t,e,a))}};function So(e,t,a,n,s,r,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,r,i):!t.prototype||!t.prototype.isPureReactComponent||(!en(a,n)||!en(s,r))}function Mo(e,t,a,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(a,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&ko.enqueueReplaceState(t,t.state,null)}function No(e,t){var a=t;if("ref"in t)for(var n in a={},t)"ref"!==n&&(a[n]=t[n]);if(e=e.defaultProps)for(var s in a===t&&(a=p({},a)),e)void 0===a[s]&&(a[s]=e[s]);return a}function Co(e){Pn(e)}function Eo(e){}function Po(e){Pn(e)}function _o(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(a){setTimeout(function(){throw a})}}function To(e,t,a){try{(0,e.onCaughtError)(a.value,{componentStack:a.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(n){setTimeout(function(){throw n})}}function Ao(e,t,a){return(a=xr(a)).tag=3,a.payload={element:null},a.callback=function(){_o(e,t)},a}function Oo(e){return(e=xr(e)).tag=3,e}function Io(e,t,a,n){var s=a.type.getDerivedStateFromError;if("function"==typeof s){var r=n.value;e.payload=function(){return s(r)},e.callback=function(){To(t,a,n)}}var i=a.stateNode;null!==i&&"function"==typeof i.componentDidCatch&&(e.callback=function(){To(t,a,n),"function"!=typeof s&&(null===Lc?Lc=new Set([this]):Lc.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})})}var Do=Error(n(461)),Fo=!1;function Ro(e,t,a,n){t.child=null===e?gr(t,null,a,n):fr(t,e.child,a,n)}function jo(e,t,a,n,s){a=a.render;var r=t.ref;if("ref"in n){var i={};for(var o in n)"ref"!==o&&(i[o]=n[o])}else i=n;return Is(t),n=ai(e,t,a,i,r,s),o=ii(),null===e||Fo?(hs&&o&&ls(t),t.flags|=1,Ro(e,t,n,s),t.child):(oi(e,t,s),il(e,t,s))}function Lo(e,t,a,n,s){if(null===e){var r=a.type;return"function"!=typeof r||zn(r)||void 0!==r.defaultProps||null!==a.compare?((e=Wn(a.type,null,n,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Bo(e,t,r,n,s))}if(r=e.child,!ol(e,s)){var i=r.memoizedProps;if((a=null!==(a=a.compare)?a:en)(i,n)&&e.ref===t.ref)return il(e,t,s)}return t.flags|=1,(e=Un(r,n)).ref=t.ref,e.return=t,t.child=e}function Bo(e,t,a,n,s){if(null!==e){var r=e.memoizedProps;if(en(r,n)&&e.ref===t.ref){if(Fo=!1,t.pendingProps=n=r,!ol(e,s))return t.lanes=e.lanes,il(e,t,s);131072&e.flags&&(Fo=!0)}}return Ko(e,t,a,n,s)}function Vo(e,t,a,n){var s=n.children,r=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===n.mode){if(128&t.flags){if(r=null!==r?r.baseLanes|a:a,null!==e){for(n=t.child=e.child,s=0;null!==n;)s=s|n.lanes|n.childLanes,n=n.sibling;n=s&~r}else n=0,t.child=null;return Uo(e,t,r,a,n)}if(!(536870912&a))return n=t.lanes=536870912,Uo(e,t,null!==r?r.baseLanes|a:a,a,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Qs(0,null!==r?r.cachePool:null),null!==r?Ar(t,r):Or(),Lr(t)}else null!==r?(Qs(0,r.cachePool),Ar(t,r),Br(),t.memoizedState=null):(null!==e&&Qs(0,null),Or(),Br());return Ro(e,t,s,a),t.child}function zo(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Uo(e,t,a,n,s){var r=Ys();return r=null===r?null:{parent:Vs._currentValue,pool:r},t.memoizedState={baseLanes:a,cachePool:r},null!==e&&Qs(0,null),Or(),Lr(t),null!==e&&As(e,t,n,!0),t.childLanes=s,null}function Go(e,t){return(t=tl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Wo(e,t,a){return fr(t,e.child,null,a),(e=Go(t,t.pendingProps)).flags|=2,Vr(t),t.memoizedState=null,e}function Ho(e,t){var a=t.ref;if(null===a)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof a&&"object"!=typeof a)throw Error(n(284));null!==e&&e.ref===a||(t.flags|=4194816)}}function Ko(e,t,a,n,s){return Is(t),a=ai(e,t,a,n,void 0,s),n=ii(),null===e||Fo?(hs&&n&&ls(t),t.flags|=1,Ro(e,t,a,s),t.child):(oi(e,t,s),il(e,t,s))}function $o(e,t,a,n,s,r){return Is(t),t.updateQueue=null,a=si(t,n,a,s),ni(e),n=ii(),null===e||Fo?(hs&&n&&ls(t),t.flags|=1,Ro(e,t,a,r),t.child):(oi(e,t,r),il(e,t,r))}function qo(e,t,a,n,s){if(Is(t),null===t.stateNode){var r=Ln,i=a.contextType;"object"==typeof i&&null!==i&&(r=Ds(i)),r=new a(n,r),t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=ko,t.stateNode=r,r._reactInternals=t,(r=t.stateNode).props=n,r.state=t.memoizedState,r.refs={},br(t),i=a.contextType,r.context="object"==typeof i&&null!==i?Ds(i):Ln,r.state=t.memoizedState,"function"==typeof(i=a.getDerivedStateFromProps)&&(wo(t,a,i,n),r.state=t.memoizedState),"function"==typeof a.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(i=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),i!==r.state&&ko.enqueueReplaceState(r,r.state,null),Cr(t,n,r,s),Nr(),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308),n=!0}else if(null===e){r=t.stateNode;var o=t.memoizedProps,l=No(a,o);r.props=l;var c=r.context,u=a.contextType;i=Ln,"object"==typeof u&&null!==u&&(i=Ds(u));var d=a.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof r.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o||c!==i)&&Mo(t,r,n,i),yr=!1;var p=t.memoizedState;r.state=p,Cr(t,n,r,s),Nr(),c=t.memoizedState,o||p!==c||yr?("function"==typeof d&&(wo(t,a,d,n),c=t.memoizedState),(l=yr||So(t,a,l,n,p,c,i))?(u||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4194308)):("function"==typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),r.props=n,r.state=c,r.context=i,n=l):("function"==typeof r.componentDidMount&&(t.flags|=4194308),n=!1)}else{r=t.stateNode,vr(e,t),u=No(a,i=t.memoizedProps),r.props=u,d=t.pendingProps,p=r.context,c=a.contextType,l=Ln,"object"==typeof c&&null!==c&&(l=Ds(c)),(c="function"==typeof(o=a.getDerivedStateFromProps)||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(i!==d||p!==l)&&Mo(t,r,n,l),yr=!1,p=t.memoizedState,r.state=p,Cr(t,n,r,s),Nr();var h=t.memoizedState;i!==d||p!==h||yr||null!==e&&null!==e.dependencies&&Os(e.dependencies)?("function"==typeof o&&(wo(t,a,o,n),h=t.memoizedState),(u=yr||So(t,a,u,n,p,h,l)||null!==e&&null!==e.dependencies&&Os(e.dependencies))?(c||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(n,h,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(n,h,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof r.componentDidUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=h),r.props=n,r.state=h,r.context=l,n=u):("function"!=typeof r.componentDidUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),n=!1)}return r=n,Ho(e,t),n=!!(128&t.flags),r||n?(r=t.stateNode,a=n&&"function"!=typeof a.getDerivedStateFromError?null:r.render(),t.flags|=1,null!==e&&n?(t.child=fr(t,e.child,null,s),t.child=fr(t,null,a,s)):Ro(e,t,a,s),t.memoizedState=r.state,e=t.child):e=il(e,t,s),e}function Xo(e,t,a,n){return ws(),t.flags|=256,Ro(e,t,a,n),t.child}var Yo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qo(e){return{baseLanes:e,cachePool:Zs()}}function Zo(e,t,a){return e=null!==e?e.childLanes&~a:0,t&&(e|=_c),e}function Jo(e,t,a){var s,r=t.pendingProps,i=!1,o=!!(128&t.flags);if((s=o)||(s=(null===e||null!==e.memoizedState)&&!!(2&zr.current)),s&&(i=!0,t.flags&=-129),s=!!(32&t.flags),t.flags&=-33,null===e){if(hs){if(i?Rr(t):Br(),(e=ps)?null!==(e=null!==(e=Od(e,fs))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ns?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(a=$n(e)).return=t,t.child=a,ds=t,ps=null):e=null,null===e)throw ys(t);return Dd(e)?t.lanes=32:t.lanes=536870912,null}var l=r.children;return r=r.fallback,i?(Br(),l=tl({mode:"hidden",children:l},i=t.mode),r=Hn(r,i,a,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(r=t.child).memoizedState=Qo(a),r.childLanes=Zo(e,s,a),t.memoizedState=Yo,zo(null,r)):(Rr(t),el(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(o)256&t.flags?(Rr(t),t.flags&=-257,t=al(e,t,a)):null!==t.memoizedState?(Br(),t.child=e.child,t.flags|=128,t=null):(Br(),l=r.fallback,i=t.mode,r=tl({mode:"visible",children:r.children},i),(l=Hn(l,i,a,null)).flags|=2,r.return=t,l.return=t,r.sibling=l,t.child=r,fr(t,e.child,null,a),(r=t.child).memoizedState=Qo(a),r.childLanes=Zo(e,s,a),t.memoizedState=Yo,t=zo(null,r));else if(Rr(t),Dd(l)){if(s=l.nextSibling&&l.nextSibling.dataset)var u=s.dgst;s=u,(r=Error(n(419))).stack="",r.digest=s,Ss({value:r,source:null,stack:null}),t=al(e,t,a)}else if(Fo||As(e,t,a,!1),s=0!==(a&e.childLanes),Fo||s){if(null!==(s=gc)&&(0!==(r=De(s,a))&&r!==c.retryLane))throw c.retryLane=r,Fn(e,r),Yc(s,e,r),Do;Id(l)||lu(),t=al(e,t,a)}else Id(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ps=Fd(l.nextSibling),ds=t,hs=!0,ms=null,fs=!1,null!==e&&us(t,e),(t=el(t,r.children)).flags|=4096);return t}return i?(Br(),l=r.fallback,i=t.mode,u=(c=e.child).sibling,(r=Un(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=Un(u,l):(l=Hn(l,i,a,null)).flags|=2,l.return=t,r.return=t,r.sibling=l,t.child=r,zo(null,r),r=t.child,null===(l=e.child.memoizedState)?l=Qo(a):(null!==(i=l.cachePool)?(c=Vs._currentValue,i=i.parent!==c?{parent:c,pool:c}:i):i=Zs(),l={baseLanes:l.baseLanes|a,cachePool:i}),r.memoizedState=l,r.childLanes=Zo(e,s,a),t.memoizedState=Yo,zo(e.child,r)):(Rr(t),e=(a=e.child).sibling,(a=Un(a,{mode:"visible",children:r.children})).return=t,a.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=a,t.memoizedState=null,a)}function el(e,t){return(t=tl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function tl(e,t){return(e=Vn(22,e,null,t)).lanes=0,e}function al(e,t,a){return fr(t,e.child,null,a),(e=el(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function nl(e,t,a){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),_s(e.return,t,a)}function sl(e,t,a,n,s,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:s,treeForkCount:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=a,i.tailMode=s,i.treeForkCount=r)}function rl(e,t,a){var n=t.pendingProps,s=n.revealOrder,r=n.tail;n=n.children;var i=zr.current,o=!!(2&i);if(o?(i=1&i|2,t.flags|=128):i&=1,V(zr,i),Ro(e,t,n,a),n=hs?es:0,!o&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&nl(e,a,t);else if(19===e.tag)nl(e,a,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(s){case"forwards":for(a=t.child,s=null;null!==a;)null!==(e=a.alternate)&&null===Ur(e)&&(s=a),a=a.sibling;null===(a=s)?(s=t.child,t.child=null):(s=a.sibling,a.sibling=null),sl(t,!1,s,a,r,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Ur(e)){t.child=s;break}e=s.sibling,s.sibling=a,a=s,s=e}sl(t,!0,a,null,r,n);break;case"together":sl(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function il(e,t,a){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(a&t.childLanes)){if(null===e)return null;if(As(e,t,a,!1),0===(a&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(a=Un(e=t.child,e.pendingProps),t.child=a,a.return=t;null!==e.sibling;)e=e.sibling,(a=a.sibling=Un(e,e.pendingProps)).return=t;a.sibling=null}return t.child}function ol(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Os(e))}function ll(e,t,a){if(null!==e)if(e.memoizedProps!==t.pendingProps)Fo=!0;else{if(!(ol(e,a)||128&t.flags))return Fo=!1,function(e,t,a){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),Es(0,Vs,e.memoizedState.cache),ws();break;case 27:case 5:X(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:Es(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,jr(t),null;break;case 13:var n=t.memoizedState;if(null!==n)return null!==n.dehydrated?(Rr(t),t.flags|=128,null):0!==(a&t.child.childLanes)?Jo(e,t,a):(Rr(t),null!==(e=il(e,t,a))?e.sibling:null);Rr(t);break;case 19:var s=!!(128&e.flags);if((n=0!==(a&t.childLanes))||(As(e,t,a,!1),n=0!==(a&t.childLanes)),s){if(n)return rl(e,t,a);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),V(zr,zr.current),n)break;return null;case 22:return t.lanes=0,Vo(e,t,a,t.pendingProps);case 24:Es(0,Vs,e.memoizedState.cache)}return il(e,t,a)}(e,t,a);Fo=!!(131072&e.flags)}else Fo=!1,hs&&1048576&t.flags&&os(t,es,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=rr(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var r=e.$$typeof;if(r===w){t.tag=11,t=jo(null,t,e,s,a);break e}if(r===M){t.tag=14,t=Lo(null,t,e,s,a);break e}}throw t=A(e)||e,Error(n(306,t,""))}zn(e)?(s=No(e,s),t.tag=1,t=qo(null,t,e,s,a)):(t.tag=0,t=Ko(null,t,e,s,a))}return t;case 0:return Ko(e,t,t.type,t.pendingProps,a);case 1:return qo(e,t,s=t.type,r=No(s,t.pendingProps),a);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(n(387));s=t.pendingProps;var i=t.memoizedState;r=i.element,vr(e,t),Cr(t,s,null,a);var o=t.memoizedState;if(s=o.cache,Es(0,Vs,s),s!==i.cache&&Ts(t,[Vs],a,!0),Nr(),s=o.element,i.isDehydrated){if(i={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Xo(e,t,s,a);break e}if(s!==r){Ss(r=Yn(Error(n(424)),t)),t=Xo(e,t,s,a);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ps=Fd(e.firstChild),ds=t,hs=!0,ms=null,fs=!0,a=gr(t,null,s,a),t.child=a;a;)a.flags=-3&a.flags|4096,a=a.sibling}else{if(ws(),s===r){t=il(e,t,a);break e}Ro(e,t,s,a)}t=t.child}return t;case 26:return Ho(e,t),null===e?(a=$d(t.type,null,t.pendingProps,null))?t.memoizedState=a:hs||(a=t.type,e=t.pendingProps,(s=bd(H.current).createElement(a))[Ve]=t,s[ze]=e,md(s,a,e),Je(s),t.stateNode=s):t.memoizedState=$d(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&hs&&(s=t.stateNode=Bd(t.type,t.pendingProps,H.current),ds=t,fs=!0,r=ps,Pd(t.type)?(Rd=r,ps=Fd(s.firstChild)):ps=r),Ro(e,t,t.pendingProps.children,a),Ho(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&hs&&((r=s=ps)&&(null!==(s=function(e,t,a,n){for(;1===e.nodeType;){var s=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(n){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(r=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(r!==s.rel||e.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||e.getAttribute("title")!==(null==s.title?null:s.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((r=e.getAttribute("src"))!==(null==s.src?null:s.src)||e.getAttribute("type")!==(null==s.type?null:s.type)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&r&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var r=null==s.name?null:""+s.name;if("hidden"===s.type&&e.getAttribute("name")===r)return e}if(null===(e=Fd(e.nextSibling)))break}return null}(s,t.type,t.pendingProps,fs))?(t.stateNode=s,ds=t,ps=Fd(s.firstChild),fs=!1,r=!0):r=!1),r||ys(t)),X(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,wd(r,i)?s=null:null!==o&&wd(r,o)&&(t.flags|=32),null!==t.memoizedState&&(r=ai(e,t,ri,null,null,a),pp._currentValue=r),Ho(e,t),Ro(e,t,s,a),t.child;case 6:return null===e&&hs&&((e=a=ps)&&(null!==(a=function(e,t,a){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!a)return null;if(null===(e=Fd(e.nextSibling)))return null}return e}(a,t.pendingProps,fs))?(t.stateNode=a,ds=t,ps=null,e=!0):e=!1),e||ys(t)),null;case 13:return Jo(e,t,a);case 4:return $(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=fr(t,null,s,a):Ro(e,t,s,a),t.child;case 11:return jo(e,t,t.type,t.pendingProps,a);case 7:return Ro(e,t,t.pendingProps,a),t.child;case 8:case 12:return Ro(e,t,t.pendingProps.children,a),t.child;case 10:return s=t.pendingProps,Es(0,t.type,s.value),Ro(e,t,s.children,a),t.child;case 9:return r=t.type._context,s=t.pendingProps.children,Is(t),s=s(r=Ds(r)),t.flags|=1,Ro(e,t,s,a),t.child;case 14:return Lo(e,t,t.type,t.pendingProps,a);case 15:return Bo(e,t,t.type,t.pendingProps,a);case 19:return rl(e,t,a);case 31:return function(e,t,a){var s=t.pendingProps,r=!!(128&t.flags);if(t.flags&=-129,null===e){if(hs){if("hidden"===s.mode)return e=Go(t,s),t.lanes=536870912,zo(null,e);if(jr(t),(e=ps)?null!==(e=null!==(e=Od(e,fs))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ns?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(a=$n(e)).return=t,t.child=a,ds=t,ps=null):e=null,null===e)throw ys(t);return t.lanes=536870912,null}return Go(t,s)}var i=e.memoizedState;if(null!==i){var o=i.dehydrated;if(jr(t),r)if(256&t.flags)t.flags&=-257,t=Wo(e,t,a);else{if(null===t.memoizedState)throw Error(n(558));t.child=e.child,t.flags|=128,t=null}else if(Fo||As(e,t,a,!1),r=0!==(a&e.childLanes),Fo||r){if(null!==(s=gc)&&0!==(o=De(s,a))&&o!==i.retryLane)throw i.retryLane=o,Fn(e,o),Yc(s,e,o),Do;lu(),t=Wo(e,t,a)}else e=i.treeContext,ps=Fd(o.nextSibling),ds=t,hs=!0,ms=null,fs=!1,null!==e&&us(t,e),(t=Go(t,s)).flags|=4096;return t}return(e=Un(e.child,{mode:s.mode,children:s.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,a);case 22:return Vo(e,t,a,t.pendingProps);case 24:return Is(t),s=Ds(Vs),null===e?(null===(r=Ys())&&(r=gc,i=zs(),r.pooledCache=i,i.refCount++,null!==i&&(r.pooledCacheLanes|=a),r=i),t.memoizedState={parent:s,cache:r},br(t),Es(0,Vs,r)):(0!==(e.lanes&a)&&(vr(e,t),Cr(t,null,null,a),Nr()),r=e.memoizedState,i=t.memoizedState,r.parent!==s?(r={parent:s,cache:s},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),Es(0,Vs,s)):(s=i.cache,Es(0,Vs,s),s!==r.cache&&Ts(t,[Vs],a,!0))),Ro(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(n(156,t.tag))}function cl(e){e.flags|=4}function ul(e,t,a,n,s){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&s)===s)if(e.stateNode.complete)e.flags|=8192;else{if(!ru())throw ir=ar,er;e.flags|=8192}}else e.flags&=-16777217}function dl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!ip(t)){if(!ru())throw ir=ar,er;e.flags|=8192}}function pl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?_e():536870912,e.lanes|=t,Tc|=t)}function hl(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;null!==t;)null!==t.alternate&&(a=t),t=t.sibling;null===a?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;null!==a;)null!==a.alternate&&(n=a),a=a.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ml(e){var t=null!==e.alternate&&e.alternate.child===e.child,a=0,n=0;if(t)for(var s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=65011712&s.subtreeFlags,n|=65011712&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function fl(e,t,a){var s=t.pendingProps;switch(cs(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return ml(t),null;case 3:return a=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Ps(Vs),q(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==e&&null!==e.child||(xs(t)?cl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,ks())),ml(t),null;case 26:var r=t.type,i=t.memoizedState;return null===e?(cl(t),null!==i?(ml(t),dl(t,i)):(ml(t),ul(t,r,0,0,a))):i?i!==e.memoizedState?(cl(t),ml(t),dl(t,i)):(ml(t),t.flags&=-16777217):((e=e.memoizedProps)!==s&&cl(t),ml(t),ul(t,r,0,0,a)),null;case 27:if(Y(t),a=H.current,r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(n(166));return ml(t),null}e=G.current,xs(t)?bs(t):(e=Bd(r,s,a),t.stateNode=e,cl(t))}return ml(t),null;case 5:if(Y(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(n(166));return ml(t),null}if(i=G.current,xs(t))bs(t);else{var o=bd(H.current);switch(i){case 1:i=o.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:i=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":i=o.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":i=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(i=o.createElement("div")).innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i="string"==typeof s.is?o.createElement("select",{is:s.is}):o.createElement("select"),s.multiple?i.multiple=!0:s.size&&(i.size=s.size);break;default:i="string"==typeof s.is?o.createElement(r,{is:s.is}):o.createElement(r)}}i[Ve]=t,i[ze]=s;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)i.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=i;e:switch(md(i,r,s),r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&cl(t)}}return ml(t),ul(t,t.type,null===e||e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if("string"!=typeof s&&null===t.stateNode)throw Error(n(166));if(e=H.current,xs(t)){if(e=t.stateNode,a=t.memoizedProps,s=null,null!==(r=ds))switch(r.tag){case 27:case 5:s=r.memoizedProps}e[Ve]=t,(e=!!(e.nodeValue===a||null!==s&&!0===s.suppressHydrationWarning||dd(e.nodeValue,a)))||ys(t,!0)}else(e=bd(e).createTextNode(s))[Ve]=t,t.stateNode=e}return ml(t),null;case 31:if(a=t.memoizedState,null===e||null!==e.memoizedState){if(s=xs(t),null!==a){if(null===e){if(!s)throw Error(n(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(n(557));e[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),e=!1}else a=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return 256&t.flags?(Vr(t),t):(Vr(t),null);if(128&t.flags)throw Error(n(558))}return ml(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=xs(t),null!==s&&null!==s.dehydrated){if(null===e){if(!r)throw Error(n(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(n(317));r[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),r=!1}else r=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(Vr(t),t):(Vr(t),null)}return Vr(t),128&t.flags?(t.lanes=a,t):(a=null!==s,e=null!==e&&null!==e.memoizedState,a&&(r=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(r=s.alternate.memoizedState.cachePool.pool),i=null,null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(i=s.memoizedState.cachePool.pool),i!==r&&(s.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),pl(t,t.updateQueue),ml(t),null);case 4:return q(),null===e&&td(t.stateNode.containerInfo),ml(t),null;case 10:return Ps(t.type),ml(t),null;case 19:if(B(zr),null===(s=t.memoizedState))return ml(t),null;if(r=!!(128&t.flags),null===(i=s.rendering))if(r)hl(s,!1);else{if(0!==Nc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(i=Ur(e))){for(t.flags|=128,hl(s,!1),e=i.updateQueue,t.updateQueue=e,pl(t,e),t.subtreeFlags=0,e=a,a=t.child;null!==a;)Gn(a,e),a=a.sibling;return V(zr,1&zr.current|2),hs&&is(t,s.treeForkCount),t.child}e=e.sibling}null!==s.tail&&oe()>Rc&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ur(i))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,pl(t,e),hl(s,!0),null===s.tail&&"hidden"===s.tailMode&&!i.alternate&&!hs)return ml(t),null}else 2*oe()-s.renderingStartTime>Rc&&536870912!==a&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304);s.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=s.last)?e.sibling=i:t.child=i,s.last=i)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=oe(),e.sibling=null,a=zr.current,V(zr,r?1&a|2:1&a),hs&&is(t,s.treeForkCount),e):(ml(t),null);case 22:case 23:return Vr(t),Ir(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?!!(536870912&a)&&!(128&t.flags)&&(ml(t),6&t.subtreeFlags&&(t.flags|=8192)):ml(t),null!==(a=t.updateQueue)&&pl(t,a.retryQueue),a=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(a=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==a&&(t.flags|=2048),null!==e&&B(Xs),null;case 24:return a=null,null!==e&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Ps(Vs),ml(t),null;case 25:case 30:return null}throw Error(n(156,t.tag))}function gl(e,t){switch(cs(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ps(Vs),q(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 31:if(null!==t.memoizedState){if(Vr(t),null===t.alternate)throw Error(n(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Vr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(zr),null;case 4:return q(),null;case 10:return Ps(t.type),null;case 22:case 23:return Vr(t),Ir(),null!==e&&B(Xs),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Ps(Vs),null;default:return null}}function yl(e,t){switch(cs(t),t.tag){case 3:Ps(Vs),q();break;case 26:case 27:case 5:Y(t);break;case 4:q();break;case 31:null!==t.memoizedState&&Vr(t);break;case 13:Vr(t);break;case 19:B(zr);break;case 10:Ps(t.type);break;case 22:case 23:Vr(t),Ir(),null!==e&&B(Xs);break;case 24:Ps(Vs)}}function bl(e,t){try{var a=t.updateQueue,n=null!==a?a.lastEffect:null;if(null!==n){var s=n.next;a=s;do{if((a.tag&e)===e){n=void 0;var r=a.create,i=a.inst;n=r(),i.destroy=n}a=a.next}while(a!==s)}}catch(o){Nu(t,t.return,o)}}function vl(e,t,a){try{var n=t.updateQueue,s=null!==n?n.lastEffect:null;if(null!==s){var r=s.next;n=r;do{if((n.tag&e)===e){var i=n.inst,o=i.destroy;if(void 0!==o){i.destroy=void 0,s=t;var l=a,c=o;try{c()}catch(u){Nu(s,l,u)}}}n=n.next}while(n!==r)}}catch(u){Nu(t,t.return,u)}}function xl(e){var t=e.updateQueue;if(null!==t){var a=e.stateNode;try{Pr(t,a)}catch(n){Nu(e,e.return,n)}}}function wl(e,t,a){a.props=No(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){Nu(e,t,n)}}function kl(e,t){try{var a=e.ref;if(null!==a){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;default:n=e.stateNode}"function"==typeof a?e.refCleanup=a(n):a.current=n}}catch(s){Nu(e,t,s)}}function Sl(e,t){var a=e.ref,n=e.refCleanup;if(null!==a)if("function"==typeof n)try{n()}catch(s){Nu(e,t,s)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof a)try{a(null)}catch(r){Nu(e,t,r)}else a.current=null}function Ml(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(s){Nu(e,e.return,s)}}function Nl(e,t,a){try{var s=e.stateNode;!function(e,t,a,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,i=null,o=null,l=null,c=null,u=null,d=null;for(m in a){var p=a[m];if(a.hasOwnProperty(m)&&null!=p)switch(m){case"checked":case"value":break;case"defaultValue":c=p;default:s.hasOwnProperty(m)||pd(e,t,m,null,s,p)}}for(var h in s){var m=s[h];if(p=a[h],s.hasOwnProperty(h)&&(null!=m||null!=p))switch(h){case"type":i=m;break;case"name":r=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":o=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(n(137,t));break;default:m!==p&&pd(e,t,h,m,s,p)}}return void yt(e,o,l,c,u,d,i,r);case"select":for(i in m=o=l=h=null,a)if(c=a[i],a.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":m=c;default:s.hasOwnProperty(i)||pd(e,t,i,null,s,c)}for(r in s)if(i=s[r],c=a[r],s.hasOwnProperty(r)&&(null!=i||null!=c))switch(r){case"value":h=i;break;case"defaultValue":l=i;break;case"multiple":o=i;default:i!==c&&pd(e,t,r,i,s,c)}return t=l,a=o,s=m,void(null!=h?xt(e,!!a,h,!1):!!s!=!!a&&(null!=t?xt(e,!!a,t,!0):xt(e,!!a,a?[]:"",!1)));case"textarea":for(l in m=h=null,a)if(r=a[l],a.hasOwnProperty(l)&&null!=r&&!s.hasOwnProperty(l))switch(l){case"value":case"children":break;default:pd(e,t,l,null,s,r)}for(o in s)if(r=s[o],i=a[o],s.hasOwnProperty(o)&&(null!=r||null!=i))switch(o){case"value":h=r;break;case"defaultValue":m=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(n(91));break;default:r!==i&&pd(e,t,o,r,s,i)}return void wt(e,h,m);case"option":for(var f in a)if(h=a[f],a.hasOwnProperty(f)&&null!=h&&!s.hasOwnProperty(f))if("selected"===f)e.selected=!1;else pd(e,t,f,null,s,h);for(c in s)if(h=s[c],m=a[c],s.hasOwnProperty(c)&&h!==m&&(null!=h||null!=m))if("selected"===c)e.selected=h&&"function"!=typeof h&&"symbol"!=typeof h;else pd(e,t,c,h,s,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in a)h=a[g],a.hasOwnProperty(g)&&null!=h&&!s.hasOwnProperty(g)&&pd(e,t,g,null,s,h);for(u in s)if(h=s[u],m=a[u],s.hasOwnProperty(u)&&h!==m&&(null!=h||null!=m))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(n(137,t));break;default:pd(e,t,u,h,s,m)}return;default:if(Et(t)){for(var y in a)h=a[y],a.hasOwnProperty(y)&&void 0!==h&&!s.hasOwnProperty(y)&&hd(e,t,y,void 0,s,h);for(d in s)h=s[d],m=a[d],!s.hasOwnProperty(d)||h===m||void 0===h&&void 0===m||hd(e,t,d,h,s,m);return}}for(var b in a)h=a[b],a.hasOwnProperty(b)&&null!=h&&!s.hasOwnProperty(b)&&pd(e,t,b,null,s,h);for(p in s)h=s[p],m=a[p],!s.hasOwnProperty(p)||h===m||null==h&&null==m||pd(e,t,p,h,s,m)}(s,e.type,a,t),s[ze]=t}catch(r){Nu(e,e.return,r)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Pd(e.type)||4===e.tag}function El(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Pd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Pl(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?(9===a.nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).insertBefore(e,t):((t=9===a.nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).appendChild(e),null!=(a=a._reactRootContainer)||null!==t.onclick||(t.onclick=At));else if(4!==n&&(27===n&&Pd(e.type)&&(a=e.stateNode,t=null),null!==(e=e.child)))for(Pl(e,t,a),e=e.sibling;null!==e;)Pl(e,t,a),e=e.sibling}function _l(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(4!==n&&(27===n&&Pd(e.type)&&(a=e.stateNode),null!==(e=e.child)))for(_l(e,t,a),e=e.sibling;null!==e;)_l(e,t,a),e=e.sibling}function Tl(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,s=t.attributes;s.length;)t.removeAttributeNode(s[0]);md(t,n,a),t[Ve]=e,t[ze]=a}catch(r){Nu(e,e.return,r)}}var Al=!1,Ol=!1,Il=!1,Dl="function"==typeof WeakSet?WeakSet:Set,Fl=null;function Rl(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:Yl(e,a),4&n&&bl(5,a);break;case 1:if(Yl(e,a),4&n)if(e=a.stateNode,null===t)try{e.componentDidMount()}catch(i){Nu(a,a.return,i)}else{var s=No(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(s,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){Nu(a,a.return,o)}}64&n&&xl(a),512&n&&kl(a,a.return);break;case 3:if(Yl(e,a),64&n&&null!==(e=a.updateQueue)){if(t=null,null!==a.child)switch(a.child.tag){case 27:case 5:case 1:t=a.child.stateNode}try{Pr(e,t)}catch(i){Nu(a,a.return,i)}}break;case 27:null===t&&4&n&&Tl(a);case 26:case 5:Yl(e,a),null===t&&4&n&&Ml(a),512&n&&kl(a,a.return);break;case 12:Yl(e,a);break;case 31:Yl(e,a),4&n&&Ul(e,a);break;case 13:Yl(e,a),4&n&&Gl(e,a),64&n&&(null!==(e=a.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var a=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==a.readyState)t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}(e,a=_u.bind(null,a))));break;case 22:if(!(n=null!==a.memoizedState||Al)){t=null!==t&&null!==t.memoizedState||Ol,s=Al;var r=Ol;Al=n,(Ol=t)&&!r?Zl(e,a,!!(8772&a.subtreeFlags)):Yl(e,a),Al=s,Ol=r}break;case 30:break;default:Yl(e,a)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ll=null,Bl=!1;function Vl(e,t,a){for(a=a.child;null!==a;)zl(e,t,a),a=a.sibling}function zl(e,t,a){if(ye&&"function"==typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(ge,a)}catch(r){}switch(a.tag){case 26:Ol||Sl(a,t),Vl(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode).parentNode.removeChild(a);break;case 27:Ol||Sl(a,t);var n=Ll,s=Bl;Pd(a.type)&&(Ll=a.stateNode,Bl=!1),Vl(e,t,a),Vd(a.stateNode),Ll=n,Bl=s;break;case 5:Ol||Sl(a,t);case 6:if(n=Ll,s=Bl,Ll=null,Vl(e,t,a),Bl=s,null!==(Ll=n))if(Bl)try{(9===Ll.nodeType?Ll.body:"HTML"===Ll.nodeName?Ll.ownerDocument.body:Ll).removeChild(a.stateNode)}catch(i){Nu(a,t,i)}else try{Ll.removeChild(a.stateNode)}catch(i){Nu(a,t,i)}break;case 18:null!==Ll&&(Bl?(_d(9===(e=Ll).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,a.stateNode),Kp(e)):_d(Ll,a.stateNode));break;case 4:n=Ll,s=Bl,Ll=a.stateNode.containerInfo,Bl=!0,Vl(e,t,a),Ll=n,Bl=s;break;case 0:case 11:case 14:case 15:vl(2,a,t),Ol||vl(4,a,t),Vl(e,t,a);break;case 1:Ol||(Sl(a,t),"function"==typeof(n=a.stateNode).componentWillUnmount&&wl(a,t,n)),Vl(e,t,a);break;case 21:Vl(e,t,a);break;case 22:Ol=(n=Ol)||null!==a.memoizedState,Vl(e,t,a),Ol=n;break;default:Vl(e,t,a)}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Kp(e)}catch(a){Nu(t,t.return,a)}}}function Gl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Kp(e)}catch(a){Nu(t,t.return,a)}}function Wl(e,t){var a=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Dl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Dl),t;default:throw Error(n(435,e.tag))}}(e);t.forEach(function(t){if(!a.has(t)){a.add(t);var n=Tu.bind(null,e,t);t.then(n,n)}})}function Hl(e,t){var a=t.deletions;if(null!==a)for(var s=0;s<a.length;s++){var r=a[s],i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(Pd(l.type)){Ll=l.stateNode,Bl=!1;break e}break;case 5:Ll=l.stateNode,Bl=!1;break e;case 3:case 4:Ll=l.stateNode.containerInfo,Bl=!0;break e}l=l.return}if(null===Ll)throw Error(n(160));zl(i,o,r),Ll=null,Bl=!1,null!==(i=r.alternate)&&(i.return=null),r.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)$l(t,e),t=t.sibling}var Kl=null;function $l(e,t){var a=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Hl(t,e),ql(e),4&s&&(vl(3,e,e.return),bl(3,e),vl(5,e,e.return));break;case 1:Hl(t,e),ql(e),512&s&&(Ol||null===a||Sl(a,a.return)),64&s&&Al&&(null!==(e=e.updateQueue)&&(null!==(s=e.callbacks)&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===a?s:a.concat(s))));break;case 26:var r=Kl;if(Hl(t,e),ql(e),512&s&&(Ol||null===a||Sl(a,a.return)),4&s){var i=null!==a?a.memoizedState:null;if(s=e.memoizedState,null===a)if(null===s)if(null===e.stateNode){e:{s=e.type,a=e.memoizedProps,r=r.ownerDocument||r;t:switch(s){case"title":(!(i=r.getElementsByTagName("title")[0])||i[$e]||i[Ve]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=r.createElement(s),r.head.insertBefore(i,r.querySelector("head > title"))),md(i,s,a),i[Ve]=e,Je(i),s=i;break e;case"link":var o=sp("link","href",r).get(s+(a.href||""));if(o)for(var l=0;l<o.length;l++)if((i=o[l]).getAttribute("href")===(null==a.href||""===a.href?null:a.href)&&i.getAttribute("rel")===(null==a.rel?null:a.rel)&&i.getAttribute("title")===(null==a.title?null:a.title)&&i.getAttribute("crossorigin")===(null==a.crossOrigin?null:a.crossOrigin)){o.splice(l,1);break t}md(i=r.createElement(s),s,a),r.head.appendChild(i);break;case"meta":if(o=sp("meta","content",r).get(s+(a.content||"")))for(l=0;l<o.length;l++)if((i=o[l]).getAttribute("content")===(null==a.content?null:""+a.content)&&i.getAttribute("name")===(null==a.name?null:a.name)&&i.getAttribute("property")===(null==a.property?null:a.property)&&i.getAttribute("http-equiv")===(null==a.httpEquiv?null:a.httpEquiv)&&i.getAttribute("charset")===(null==a.charSet?null:a.charSet)){o.splice(l,1);break t}md(i=r.createElement(s),s,a),r.head.appendChild(i);break;default:throw Error(n(468,s))}i[Ve]=e,Je(i),s=i}e.stateNode=s}else rp(r,e.type,e.stateNode);else e.stateNode=Jd(r,s,e.memoizedProps);else i!==s?(null===i?null!==a.stateNode&&(a=a.stateNode).parentNode.removeChild(a):i.count--,null===s?rp(r,e.type,e.stateNode):Jd(r,s,e.memoizedProps)):null===s&&null!==e.stateNode&&Nl(e,e.memoizedProps,a.memoizedProps)}break;case 27:Hl(t,e),ql(e),512&s&&(Ol||null===a||Sl(a,a.return)),null!==a&&4&s&&Nl(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Hl(t,e),ql(e),512&s&&(Ol||null===a||Sl(a,a.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(f){Nu(e,e.return,f)}}4&s&&null!=e.stateNode&&Nl(e,r=e.memoizedProps,null!==a?a.memoizedProps:r),1024&s&&(Il=!0);break;case 6:if(Hl(t,e),ql(e),4&s){if(null===e.stateNode)throw Error(n(162));s=e.memoizedProps,a=e.stateNode;try{a.nodeValue=s}catch(f){Nu(e,e.return,f)}}break;case 3:if(np=null,r=Kl,Kl=Gd(t.containerInfo),Hl(t,e),Kl=r,ql(e),4&s&&null!==a&&a.memoizedState.isDehydrated)try{Kp(t.containerInfo)}catch(f){Nu(e,e.return,f)}Il&&(Il=!1,Xl(e));break;case 4:s=Kl,Kl=Gd(e.stateNode.containerInfo),Hl(t,e),ql(e),Kl=s;break;case 12:default:Hl(t,e),ql(e);break;case 31:case 19:Hl(t,e),ql(e),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 13:Hl(t,e),ql(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==a&&null!==a.memoizedState)&&(Dc=oe()),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 22:r=null!==e.memoizedState;var c=null!==a&&null!==a.memoizedState,u=Al,d=Ol;if(Al=u||r,Ol=d||c,Hl(t,e),Ol=d,Al=u,ql(e),8192&s)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===a||c||Al||Ol||Ql(e)),a=null,t=e;;){if(5===t.tag||26===t.tag){if(null===a){c=a=t;try{if(i=c.stateNode,r)"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var p=c.memoizedProps.style,h=null!=p&&p.hasOwnProperty("display")?p.display:null;l.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(f){Nu(c,c.return,f)}}}else if(6===t.tag){if(null===a){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(f){Nu(c,c.return,f)}}}else if(18===t.tag){if(null===a){c=t;try{var m=c.stateNode;r?Td(m,!0):Td(c.stateNode,!1)}catch(f){Nu(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}4&s&&(null!==(s=e.updateQueue)&&(null!==(a=s.retryQueue)&&(s.retryQueue=null,Wl(e,a))));case 30:case 21:}}function ql(e){var t=e.flags;if(2&t){try{for(var a,s=e.return;null!==s;){if(Cl(s)){a=s;break}s=s.return}if(null==a)throw Error(n(160));switch(a.tag){case 27:var r=a.stateNode;_l(e,El(e),r);break;case 5:var i=a.stateNode;32&a.flags&&(St(i,""),a.flags&=-33),_l(e,El(e),i);break;case 3:case 4:var o=a.stateNode.containerInfo;Pl(e,El(e),o);break;default:throw Error(n(161))}}catch(l){Nu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Xl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Xl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Yl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Rl(e,t.alternate,t),t=t.sibling}function Ql(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:vl(4,t,t.return),Ql(t);break;case 1:Sl(t,t.return);var a=t.stateNode;"function"==typeof a.componentWillUnmount&&wl(t,t.return,a),Ql(t);break;case 27:Vd(t.stateNode);case 26:case 5:Sl(t,t.return),Ql(t);break;case 22:null===t.memoizedState&&Ql(t);break;default:Ql(t)}e=e.sibling}}function Zl(e,t,a){for(a=a&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var n=t.alternate,s=e,r=t,i=r.flags;switch(r.tag){case 0:case 11:case 15:Zl(s,r,a),bl(4,r);break;case 1:if(Zl(s,r,a),"function"==typeof(s=(n=r).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){Nu(n,n.return,c)}if(null!==(s=(n=r).updateQueue)){var o=n.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)Er(l[s],o)}catch(c){Nu(n,n.return,c)}}a&&64&i&&xl(r),kl(r,r.return);break;case 27:Tl(r);case 26:case 5:Zl(s,r,a),a&&null===n&&4&i&&Ml(r),kl(r,r.return);break;case 12:Zl(s,r,a);break;case 31:Zl(s,r,a),a&&4&i&&Ul(s,r);break;case 13:Zl(s,r,a),a&&4&i&&Gl(s,r);break;case 22:null===r.memoizedState&&Zl(s,r,a),kl(r,r.return);break;case 30:break;default:Zl(s,r,a)}t=t.sibling}}function Jl(e,t){var a=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(a=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==a&&(null!=e&&e.refCount++,null!=a&&Us(a))}function ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e))}function tc(e,t,a,n){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ac(e,t,a,n),t=t.sibling}function ac(e,t,a,n){var s=t.flags;switch(t.tag){case 0:case 11:case 15:tc(e,t,a,n),2048&s&&bl(9,t);break;case 1:case 31:case 13:default:tc(e,t,a,n);break;case 3:tc(e,t,a,n),2048&s&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e)));break;case 12:if(2048&s){tc(e,t,a,n),e=t.stateNode;try{var r=t.memoizedProps,i=r.id,o=r.onPostCommit;"function"==typeof o&&o(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Nu(t,t.return,l)}}else tc(e,t,a,n);break;case 23:break;case 22:r=t.stateNode,i=t.alternate,null!==t.memoizedState?2&r._visibility?tc(e,t,a,n):sc(e,t):2&r._visibility?tc(e,t,a,n):(r._visibility|=2,nc(e,t,a,n,!!(10256&t.subtreeFlags)||!1)),2048&s&&Jl(i,t);break;case 24:tc(e,t,a,n),2048&s&&ec(t.alternate,t)}}function nc(e,t,a,n,s){for(s=s&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var r=e,i=t,o=a,l=n,c=i.flags;switch(i.tag){case 0:case 11:case 15:nc(r,i,o,l,s),bl(8,i);break;case 23:break;case 22:var u=i.stateNode;null!==i.memoizedState?2&u._visibility?nc(r,i,o,l,s):sc(r,i):(u._visibility|=2,nc(r,i,o,l,s)),s&&2048&c&&Jl(i.alternate,i);break;case 24:nc(r,i,o,l,s),s&&2048&c&&ec(i.alternate,i);break;default:nc(r,i,o,l,s)}t=t.sibling}}function sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var a=e,n=t,s=n.flags;switch(n.tag){case 22:sc(a,n),2048&s&&Jl(n.alternate,n);break;case 24:sc(a,n),2048&s&&ec(n.alternate,n);break;default:sc(a,n)}t=t.sibling}}var rc=8192;function ic(e,t,a){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)oc(e,t,a),e=e.sibling}function oc(e,t,a){switch(e.tag){case 26:ic(e,t,a),e.flags&rc&&null!==e.memoizedState&&function(e,t,a,n){if(!("stylesheet"!==a.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&a.state.loading)){if(null===a.instance){var s=qd(n.href),r=t.querySelector(Xd(s));if(r)return null!==(t=r._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=lp.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=r,void Je(r);r=t.ownerDocument||t,n=Yd(n),(s=zd.get(s))&&tp(n,s),Je(r=r.createElement("link"));var i=r;i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),md(r,"link",n),a.instance=r}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&!(3&a.state.loading)&&(e.count++,a=lp.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}(a,Kl,e.memoizedState,e.memoizedProps);break;case 5:default:ic(e,t,a);break;case 3:case 4:var n=Kl;Kl=Gd(e.stateNode.containerInfo),ic(e,t,a),Kl=n;break;case 22:null===e.memoizedState&&(null!==(n=e.alternate)&&null!==n.memoizedState?(n=rc,rc=16777216,ic(e,t,a),rc=n):ic(e,t,a))}}function lc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var a=0;a<t.length;a++){var n=t[a];Fl=n,pc(n,e)}lc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)uc(e),e=e.sibling}function uc(e){switch(e.tag){case 0:case 11:case 15:cc(e),2048&e.flags&&vl(9,e,e.return);break;case 3:case 12:default:cc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,dc(e)):cc(e)}}function dc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var a=0;a<t.length;a++){var n=t[a];Fl=n,pc(n,e)}lc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:vl(8,t,t.return),dc(t);break;case 22:2&(a=t.stateNode)._visibility&&(a._visibility&=-3,dc(t));break;default:dc(t)}e=e.sibling}}function pc(e,t){for(;null!==Fl;){var a=Fl;switch(a.tag){case 0:case 11:case 15:vl(8,a,t);break;case 23:case 22:if(null!==a.memoizedState&&null!==a.memoizedState.cachePool){var n=a.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Us(a.memoizedState.cache)}if(null!==(n=a.child))n.return=a,Fl=n;else e:for(a=e;null!==Fl;){var s=(n=Fl).sibling,r=n.return;if(jl(n),n===a){Fl=null;break e}if(null!==s){s.return=r,Fl=s;break e}Fl=r}}}var hc={getCacheForType:function(e){var t=Ds(Vs),a=t.data.get(e);return void 0===a&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return Ds(Vs).controller.signal}},mc="function"==typeof WeakMap?WeakMap:Map,fc=0,gc=null,yc=null,bc=0,vc=0,xc=null,wc=!1,kc=!1,Sc=!1,Mc=0,Nc=0,Cc=0,Ec=0,Pc=0,_c=0,Tc=0,Ac=null,Oc=null,Ic=!1,Dc=0,Fc=0,Rc=1/0,jc=null,Lc=null,Bc=0,Vc=null,zc=null,Uc=0,Gc=0,Wc=null,Hc=null,Kc=0,$c=null;function qc(){return 2&fc&&0!==bc?bc&-bc:null!==I.T?Wu():je()}function Xc(){if(0===_c)if(536870912&bc&&!hs)_c=536870912;else{var e=Se;!(3932160&(Se<<=1))&&(Se=262144),_c=e}return null!==(e=Dr.current)&&(e.flags|=32),_c}function Yc(e,t,a){(e!==gc||2!==vc&&9!==vc)&&null===e.cancelPendingCommit||(nu(e,0),eu(e,bc,_c,!1)),Ae(e,a),2&fc&&e===gc||(e===gc&&(!(2&fc)&&(Ec|=a),4===Nc&&eu(e,bc,_c,!1)),ju(e))}function Qc(e,t,a){if(6&fc)throw Error(n(327));for(var s=!a&&!(127&t)&&0===(t&e.expiredLanes)||Ee(e,t),r=s?function(e,t){var a=fc;fc|=2;var s=iu(),r=ou();gc!==e||bc!==t?(jc=null,Rc=oe()+500,nu(e,t)):kc=Ee(e,t);e:for(;;)try{if(0!==vc&&null!==yc){t=yc;var i=xc;t:switch(vc){case 1:vc=0,xc=null,mu(e,t,i,1);break;case 2:case 9:if(nr(i)){vc=0,xc=null,hu(t);break}t=function(){2!==vc&&9!==vc||gc!==e||(vc=7),ju(e)},i.then(t,t);break e;case 3:vc=7;break e;case 4:vc=5;break e;case 7:nr(i)?(vc=0,xc=null,hu(t)):(vc=0,xc=null,mu(e,t,i,7));break;case 5:var o=null;switch(yc.tag){case 26:o=yc.memoizedState;case 5:case 27:var l=yc;if(o?ip(o):l.stateNode.complete){vc=0,xc=null;var c=l.sibling;if(null!==c)yc=c;else{var u=l.return;null!==u?(yc=u,fu(u)):yc=null}break t}}vc=0,xc=null,mu(e,t,i,5);break;case 6:vc=0,xc=null,mu(e,t,i,6);break;case 8:au(),Nc=6;break e;default:throw Error(n(462))}}du();break}catch(d){su(e,d)}return Cs=Ns=null,I.H=s,I.A=r,fc=a,null!==yc?0:(gc=null,bc=0,On(),Nc)}(e,t):cu(e,t,!0),i=s;;){if(0===r){kc&&!s&&eu(e,t,0,!1);break}if(a=e.current.alternate,!i||Jc(a)){if(2===r){if(i=t,e.errorRecoveryDisabledLanes&i)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;r=Ac;var c=l.current.memoizedState.isDehydrated;if(c&&(nu(l,o).flags|=256),2!==(o=cu(l,o,!1))){if(Sc&&!c){l.errorRecoveryDisabledLanes|=i,Ec|=i,r=4;break e}i=Oc,Oc=r,null!==i&&(null===Oc?Oc=i:Oc.push.apply(Oc,i))}r=o}if(i=!1,2!==r)continue}}if(1===r){nu(e,0),eu(e,t,0,!0);break}e:{switch(s=e,i=r){case 0:case 1:throw Error(n(345));case 4:if((4194048&t)!==t)break;case 6:eu(s,t,_c,!wc);break e;case 2:Oc=null;break;case 3:case 5:break;default:throw Error(n(329))}if((62914560&t)===t&&10<(r=Dc+300-oe())){if(eu(s,t,_c,!wc),0!==Ce(s,0,!0))break e;Uc=t,s.timeoutHandle=Sd(Zc.bind(null,s,a,Oc,jc,Ic,t,_c,Ec,Tc,wc,i,"Throttled",-0,0),r)}else Zc(s,a,Oc,jc,Ic,t,_c,Ec,Tc,wc,i,null,-0,0)}break}r=cu(e,t,!1),i=!1}ju(e)}function Zc(e,t,a,n,s,r,i,o,l,c,u,d,p,h){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){oc(t,r,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:At});var m=(62914560&r)===r?Dc-oe():(4194048&r)===r?Fc-oe():0;if(null!==(m=function(e,t){return e.stylesheets&&0===e.count&&up(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var n=setTimeout(function(){if(e.stylesheets&&up(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===op&&(op=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var s=a[n],r=s.transferSize,i=s.initiatorType,o=s.duration;if(r&&o&&fd(i)){for(i=0,o=s.responseEnd,n+=1;n<a.length;n++){var l=a[n],c=l.startTime;if(c>o)break;var u=l.transferSize,d=l.initiatorType;u&&fd(d)&&(i+=u*((l=l.responseEnd)<o?1:(o-c)/(l-c)))}if(--n,t+=8*(r+i)/(s.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var s=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&up(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>op?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(s)}}:null}(d,m)))return Uc=r,e.cancelPendingCommit=m(yu.bind(null,e,t,r,a,n,s,i,o,l,u,d,null,p,h)),void eu(e,r,i,!c)}yu(e,t,r,a,n,s,i,o,l)}function Jc(e){for(var t=e;;){var a=t.tag;if((0===a||11===a||15===a)&&16384&t.flags&&(null!==(a=t.updateQueue)&&null!==(a=a.stores)))for(var n=0;n<a.length;n++){var s=a[n],r=s.getSnapshot;s=s.value;try{if(!Ja(r(),s))return!1}catch(i){return!1}}if(a=t.child,16384&t.subtreeFlags&&null!==a)a.return=t,t=a;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function eu(e,t,a,n){t&=~Pc,t&=~Ec,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var s=t;0<s;){var r=31-ve(s),i=1<<r;n[r]=-1,s&=~i}0!==a&&Oe(e,a,t)}function tu(){return!!(6&fc)||(Lu(0),!1)}function au(){if(null!==yc){if(0===vc)var e=yc.return;else Cs=Ns=null,li(e=yc),cr=null,ur=0,e=yc;for(;null!==e;)yl(e.alternate,e),e=e.return;yc=null}}function nu(e,t){var a=e.timeoutHandle;-1!==a&&(e.timeoutHandle=-1,Md(a)),null!==(a=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,a()),Uc=0,au(),gc=e,yc=a=Un(e.current,null),bc=t,vc=0,xc=null,wc=!1,kc=Ee(e,t),Sc=!1,Tc=_c=Pc=Ec=Cc=Nc=0,Oc=Ac=null,Ic=!1,8&t&&(t|=32&t);var n=e.entangledLanes;if(0!==n)for(e=e.entanglements,n&=t;0<n;){var s=31-ve(n),r=1<<s;t|=e[s],n&=~r}return Mc=t,On(),a}function su(e,t){Wr=null,I.H=yo,t===Js||t===tr?(t=or(),vc=3):t===er?(t=or(),vc=4):vc=t===Do?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,xc=t,null===yc&&(Nc=1,_o(e,Yn(t,e.current)))}function ru(){var e=Dr.current;return null===e||((4194048&bc)===bc?null===Fr:!!((62914560&bc)===bc||536870912&bc)&&e===Fr)}function iu(){var e=I.H;return I.H=yo,null===e?yo:e}function ou(){var e=I.A;return I.A=hc,e}function lu(){Nc=4,wc||(4194048&bc)!==bc&&null!==Dr.current||(kc=!0),!(134217727&Cc)&&!(134217727&Ec)||null===gc||eu(gc,bc,_c,!1)}function cu(e,t,a){var n=fc;fc|=2;var s=iu(),r=ou();gc===e&&bc===t||(jc=null,nu(e,t)),t=!1;var i=Nc;e:for(;;)try{if(0!==vc&&null!==yc){var o=yc,l=xc;switch(vc){case 8:au(),i=6;break e;case 3:case 2:case 9:case 6:null===Dr.current&&(t=!0);var c=vc;if(vc=0,xc=null,mu(e,o,l,c),a&&kc){i=0;break e}break;default:c=vc,vc=0,xc=null,mu(e,o,l,c)}}uu(),i=Nc;break}catch(u){su(e,u)}return t&&e.shellSuspendCounter++,Cs=Ns=null,fc=n,I.H=s,I.A=r,null===yc&&(gc=null,bc=0,On()),i}function uu(){for(;null!==yc;)pu(yc)}function du(){for(;null!==yc&&!re();)pu(yc)}function pu(e){var t=ll(e.alternate,e,Mc);e.memoizedProps=e.pendingProps,null===t?fu(e):yc=t}function hu(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=$o(a,t,t.pendingProps,t.type,void 0,bc);break;case 11:t=$o(a,t,t.pendingProps,t.type.render,t.ref,bc);break;case 5:li(t);default:yl(a,t),t=ll(a,t=yc=Gn(t,Mc),Mc)}e.memoizedProps=e.pendingProps,null===t?fu(e):yc=t}function mu(e,t,a,s){Cs=Ns=null,li(t),cr=null,ur=0;var r=t.return;try{if(function(e,t,a,s,r){if(a.flags|=32768,null!==s&&"object"==typeof s&&"function"==typeof s.then){if(null!==(t=a.alternate)&&As(t,a,r,!0),null!==(a=Dr.current)){switch(a.tag){case 31:case 13:return null===Fr?lu():null===a.alternate&&0===Nc&&(Nc=3),a.flags&=-257,a.flags|=65536,a.lanes=r,s===ar?a.flags|=16384:(null===(t=a.updateQueue)?a.updateQueue=new Set([s]):t.add(s),Cu(e,s,r)),!1;case 22:return a.flags|=65536,s===ar?a.flags|=16384:(null===(t=a.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},a.updateQueue=t):null===(a=t.retryQueue)?t.retryQueue=new Set([s]):a.add(s),Cu(e,s,r)),!1}throw Error(n(435,a.tag))}return Cu(e,s,r),lu(),!1}if(hs)return null!==(t=Dr.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,s!==gs&&Ss(Yn(e=Error(n(422),{cause:s}),a))):(s!==gs&&Ss(Yn(t=Error(n(423),{cause:s}),a)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,s=Yn(s,a),Sr(e,r=Ao(e.stateNode,s,r)),4!==Nc&&(Nc=2)),!1;var i=Error(n(520),{cause:s});if(i=Yn(i,a),null===Ac?Ac=[i]:Ac.push(i),4!==Nc&&(Nc=2),null===t)return!0;s=Yn(s,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=r&-r,a.lanes|=e,Sr(a,e=Ao(a.stateNode,s,e)),!1;case 1:if(t=a.type,i=a.stateNode,!(128&a.flags||"function"!=typeof t.getDerivedStateFromError&&(null===i||"function"!=typeof i.componentDidCatch||null!==Lc&&Lc.has(i))))return a.flags|=65536,r&=-r,a.lanes|=r,Io(r=Oo(r),e,a,s),Sr(a,r),!1}a=a.return}while(null!==a);return!1}(e,r,t,a,bc))return Nc=1,_o(e,Yn(a,e.current)),void(yc=null)}catch(i){if(null!==r)throw yc=r,i;return Nc=1,_o(e,Yn(a,e.current)),void(yc=null)}32768&t.flags?(hs||1===s?e=!0:kc||536870912&bc?e=!1:(wc=e=!0,(2===s||9===s||3===s||6===s)&&(null!==(s=Dr.current)&&13===s.tag&&(s.flags|=16384))),gu(t,e)):fu(t)}function fu(e){var t=e;do{if(32768&t.flags)return void gu(t,wc);e=t.return;var a=fl(t.alternate,t,Mc);if(null!==a)return void(yc=a);if(null!==(t=t.sibling))return void(yc=t);yc=t=e}while(null!==t);0===Nc&&(Nc=5)}function gu(e,t){do{var a=gl(e.alternate,e);if(null!==a)return a.flags&=32767,void(yc=a);if(null!==(a=e.return)&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&null!==(e=e.sibling))return void(yc=e);yc=e=a}while(null!==e);Nc=6,yc=null}function yu(e,t,a,s,r,i,o,l,c){e.cancelPendingCommit=null;do{ku()}while(0!==Bc);if(6&fc)throw Error(n(327));if(null!==t){if(t===e.current)throw Error(n(177));if(i=t.lanes|t.childLanes,function(e,t,a,n,s,r){var i=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(a=i&~a;0<a;){var u=31-ve(a),d=1<<u;o[u]=0,l[u]=-1;var p=c[u];if(null!==p)for(c[u]=null,u=0;u<p.length;u++){var h=p[u];null!==h&&(h.lane&=-536870913)}a&=~d}0!==n&&Oe(e,n,0),0!==r&&0===s&&0!==e.tag&&(e.suspendedLanes|=r&~(i&~t))}(e,a,i|=An,o,l,c),e===gc&&(yc=gc=null,bc=0),zc=t,Vc=e,Uc=a,Gc=i,Wc=r,Hc=s,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ne(de,function(){return Su(),null})):(e.callbackNode=null,e.callbackPriority=0),s=!!(13878&t.flags),13878&t.subtreeFlags||s){s=I.T,I.T=null,r=D.p,D.p=2,o=fc,fc|=4;try{!function(e,t){if(e=e.containerInfo,gd=wp,rn(e=sn(e))){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(a=(a=e.ownerDocument)&&a.defaultView||window).getSelection&&a.getSelection();if(s&&0!==s.rangeCount){a=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{a.nodeType,i.nodeType}catch(g){a=null;break e}var o=0,l=-1,c=-1,u=0,d=0,p=e,h=null;t:for(;;){for(var m;p!==a||0!==r&&3!==p.nodeType||(l=o+r),p!==i||0!==s&&3!==p.nodeType||(c=o+s),3===p.nodeType&&(o+=p.nodeValue.length),null!==(m=p.firstChild);)h=p,p=m;for(;;){if(p===e)break t;if(h===a&&++u===r&&(l=o),h===i&&++d===s&&(c=o),null!==(m=p.nextSibling))break;h=(p=h).parentNode}p=m}a=-1===l||-1===c?null:{start:l,end:c}}else a=null}a=a||{start:0,end:0}}else a=null;for(yd={focusedElem:e,selectionRange:a},wp=!1,Fl=t;null!==Fl;)if(e=(t=Fl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fl=e;else for(;null!==Fl;){switch(i=(t=Fl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(a=0;a<e.length;a++)(r=e[a]).ref.impl=r.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==i){e=void 0,a=t,r=i.memoizedProps,i=i.memoizedState,s=a.stateNode;try{var f=No(a.type,r);e=s.getSnapshotBeforeUpdate(f,i),s.__reactInternalSnapshotBeforeUpdate=e}catch(y){Nu(a,a.return,y)}}break;case 3:if(1024&e)if(9===(a=(e=t.stateNode.containerInfo).nodeType))Ad(e);else if(1===a)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ad(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(n(163))}if(null!==(e=t.sibling)){e.return=t.return,Fl=e;break}Fl=t.return}}(e,t)}finally{fc=o,D.p=r,I.T=s}}Bc=1,bu(),vu(),xu()}}function bu(){if(1===Bc){Bc=0;var e=Vc,t=zc,a=!!(13878&t.flags);if(13878&t.subtreeFlags||a){a=I.T,I.T=null;var n=D.p;D.p=2;var s=fc;fc|=4;try{$l(t,e);var r=yd,i=sn(e.containerInfo),o=r.focusedElem,l=r.selectionRange;if(i!==o&&o&&o.ownerDocument&&nn(o.ownerDocument.documentElement,o)){if(null!==l&&rn(o)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var d=o.ownerDocument||document,p=d&&d.defaultView||window;if(p.getSelection){var h=p.getSelection(),m=o.textContent.length,f=Math.min(l.start,m),g=void 0===l.end?f:Math.min(l.end,m);!h.extend&&f>g&&(i=g,g=f,f=i);var y=an(o,f),b=an(o,g);if(y&&b&&(1!==h.rangeCount||h.anchorNode!==y.node||h.anchorOffset!==y.offset||h.focusNode!==b.node||h.focusOffset!==b.offset)){var v=d.createRange();v.setStart(y.node,y.offset),h.removeAllRanges(),f>g?(h.addRange(v),h.extend(b.node,b.offset)):(v.setEnd(b.node,b.offset),h.addRange(v))}}}}for(d=[],h=o;h=h.parentNode;)1===h.nodeType&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop});for("function"==typeof o.focus&&o.focus(),o=0;o<d.length;o++){var x=d[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}wp=!!gd,yd=gd=null}finally{fc=s,D.p=n,I.T=a}}e.current=t,Bc=2}}function vu(){if(2===Bc){Bc=0;var e=Vc,t=zc,a=!!(8772&t.flags);if(8772&t.subtreeFlags||a){a=I.T,I.T=null;var n=D.p;D.p=2;var s=fc;fc|=4;try{Rl(e,t.alternate,t)}finally{fc=s,D.p=n,I.T=a}}Bc=3}}function xu(){if(4===Bc||3===Bc){Bc=0,ie();var e=Vc,t=zc,a=Uc,n=Hc;10256&t.subtreeFlags||10256&t.flags?Bc=5:(Bc=0,zc=Vc=null,wu(e,e.pendingLanes));var s=e.pendingLanes;if(0===s&&(Lc=null),Re(a),t=t.stateNode,ye&&"function"==typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(ge,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==n){t=I.T,s=D.p,D.p=2,I.T=null;try{for(var r=e.onRecoverableError,i=0;i<n.length;i++){var o=n[i];r(o.value,{componentStack:o.stack})}}finally{I.T=t,D.p=s}}3&Uc&&ku(),ju(e),s=e.pendingLanes,261930&a&&42&s?e===$c?Kc++:(Kc=0,$c=e):Kc=0,Lu(0)}}function wu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Us(t)))}function ku(){return bu(),vu(),xu(),Su()}function Su(){if(5!==Bc)return!1;var e=Vc,t=Gc;Gc=0;var a=Re(Uc),s=I.T,r=D.p;try{D.p=32>a?32:a,I.T=null,a=Wc,Wc=null;var i=Vc,o=Uc;if(Bc=0,zc=Vc=null,Uc=0,6&fc)throw Error(n(331));var l=fc;if(fc|=4,uc(i.current),ac(i,i.current,o,a),fc=l,Lu(0,!1),ye&&"function"==typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(ge,i)}catch(c){}return!0}finally{D.p=r,I.T=s,wu(e,t)}}function Mu(e,t,a){t=Yn(a,t),null!==(e=wr(e,t=Ao(e.stateNode,t,2),2))&&(Ae(e,2),ju(e))}function Nu(e,t,a){if(3===e.tag)Mu(e,e,a);else for(;null!==t;){if(3===t.tag){Mu(t,e,a);break}if(1===t.tag){var n=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Lc||!Lc.has(n))){e=Yn(a,e),null!==(n=wr(t,a=Oo(2),2))&&(Io(a,n,t,e),Ae(n,2),ju(n));break}}t=t.return}}function Cu(e,t,a){var n=e.pingCache;if(null===n){n=e.pingCache=new mc;var s=new Set;n.set(t,s)}else void 0===(s=n.get(t))&&(s=new Set,n.set(t,s));s.has(a)||(Sc=!0,s.add(a),e=Eu.bind(null,e,t,a),t.then(e,e))}function Eu(e,t,a){var n=e.pingCache;null!==n&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,gc===e&&(bc&a)===a&&(4===Nc||3===Nc&&(62914560&bc)===bc&&300>oe()-Dc?!(2&fc)&&nu(e,0):Pc|=a,Tc===bc&&(Tc=0)),ju(e)}function Pu(e,t){0===t&&(t=_e()),null!==(e=Fn(e,t))&&(Ae(e,t),ju(e))}function _u(e){var t=e.memoizedState,a=0;null!==t&&(a=t.retryLane),Pu(e,a)}function Tu(e,t){var a=0;switch(e.tag){case 31:case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(a=r.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(n(314))}null!==s&&s.delete(t),Pu(e,a)}var Au=null,Ou=null,Iu=!1,Du=!1,Fu=!1,Ru=0;function ju(e){e!==Ou&&null===e.next&&(null===Ou?Au=Ou=e:Ou=Ou.next=e),Du=!0,Iu||(Iu=!0,Cd(function(){6&fc?ne(ce,Bu):Vu()}))}function Lu(e,t){if(!Fu&&Du){Fu=!0;do{for(var a=!1,n=Au;null!==n;){if(0!==e){var s=n.pendingLanes;if(0===s)var r=0;else{var i=n.suspendedLanes,o=n.pingedLanes;r=(1<<31-ve(42|e)+1)-1,r=201326741&(r&=s&~(i&~o))?201326741&r|1:r?2|r:0}0!==r&&(a=!0,Gu(n,r))}else r=bc,!(3&(r=Ce(n,n===gc?r:0,null!==n.cancelPendingCommit||-1!==n.timeoutHandle)))||Ee(n,r)||(a=!0,Gu(n,r));n=n.next}}while(a);Fu=!1}}function Bu(){Vu()}function Vu(){Du=Iu=!1;var e=0;0!==Ru&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==kd&&(kd=e,!0);return kd=null,!1}()&&(e=Ru);for(var t=oe(),a=null,n=Au;null!==n;){var s=n.next,r=zu(n,t);0===r?(n.next=null,null===a?Au=s:a.next=s,null===s&&(Ou=a)):(a=n,(0!==e||3&r)&&(Du=!0)),n=s}0!==Bc&&5!==Bc||Lu(e),0!==Ru&&(Ru=0)}function zu(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,r=-62914561&e.pendingLanes;0<r;){var i=31-ve(r),o=1<<i,l=s[i];-1===l?0!==(o&a)&&0===(o&n)||(s[i]=Pe(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}if(a=bc,a=Ce(e,e===(t=gc)?a:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),n=e.callbackNode,0===a||e===t&&(2===vc||9===vc)||null!==e.cancelPendingCommit)return null!==n&&null!==n&&se(n),e.callbackNode=null,e.callbackPriority=0;if(!(3&a)||Ee(e,a)){if((t=a&-a)===e.callbackPriority)return t;switch(null!==n&&se(n),Re(a)){case 2:case 8:a=ue;break;case 32:default:a=de;break;case 268435456:a=he}return n=Uu.bind(null,e),a=ne(a,n),e.callbackPriority=t,e.callbackNode=a,t}return null!==n&&null!==n&&se(n),e.callbackPriority=2,e.callbackNode=null,2}function Uu(e,t){if(0!==Bc&&5!==Bc)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ku()&&e.callbackNode!==a)return null;var n=bc;return 0===(n=Ce(e,e===gc?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Qc(e,n,t),zu(e,oe()),null!=e.callbackNode&&e.callbackNode===a?Uu.bind(null,e):null)}function Gu(e,t){if(ku())return null;Qc(e,t,!0)}function Wu(){if(0===Ru){var e=Hs;0===e&&(e=ke,!(261888&(ke<<=1))&&(ke=256)),Ru=e}return Ru}function Hu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Tt(""+e)}function Ku(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}for(var $u=0;$u<Cn.length;$u++){var qu=Cn[$u];En(qu.toLowerCase(),"on"+(qu[0].toUpperCase()+qu.slice(1)))}En(bn,"onAnimationEnd"),En(vn,"onAnimationIteration"),En(xn,"onAnimationStart"),En("dblclick","onDoubleClick"),En("focusin","onFocus"),En("focusout","onBlur"),En(wn,"onTransitionRun"),En(kn,"onTransitionStart"),En(Sn,"onTransitionCancel"),En(Mn,"onTransitionEnd"),nt("onMouseEnter",["mouseout","mouseover"]),nt("onMouseLeave",["mouseout","mouseover"]),nt("onPointerEnter",["pointerout","pointerover"]),nt("onPointerLeave",["pointerout","pointerover"]),at("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),at("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),at("onBeforeInput",["compositionend","keypress","textInput","paste"]),at("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xu));function Qu(e,t){t=!!(4&t);for(var a=0;a<e.length;a++){var n=e[a],s=n.event;n=n.listeners;e:{var r=void 0;if(t)for(var i=n.length-1;0<=i;i--){var o=n[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){Pn(u)}s.currentTarget=null,r=l}else for(i=0;i<n.length;i++){if(l=(o=n[i]).instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){Pn(u)}s.currentTarget=null,r=l}}}}function Zu(e,t){var a=t[Ge];void 0===a&&(a=t[Ge]=new Set);var n=e+"__bubble";a.has(n)||(ad(t,e,2,!1),a.add(n))}function Ju(e,t,a){var n=0;t&&(n|=4),ad(a,e,n,t)}var ed="_reactListening"+Math.random().toString(36).slice(2);function td(e){if(!e[ed]){e[ed]=!0,et.forEach(function(t){"selectionchange"!==t&&(Yu.has(t)||Ju(t,!1,e),Ju(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ed]||(t[ed]=!0,Ju("selectionchange",!1,t))}}function ad(e,t,a,n){switch(Pp(t)){case 2:var s=kp;break;case 8:s=Sp;break;default:s=Mp}a=s.bind(null,t,a,e),s=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,a,{capture:!0,passive:s}):e.addEventListener(t,a,!0):void 0!==s?e.addEventListener(t,a,{passive:s}):e.addEventListener(t,a,!1)}function nd(e,t,a,n,s){var i=n;if(!(1&t||2&t||null===n))e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var l=n.stateNode.containerInfo;if(l===s)break;if(4===o)for(o=n.return;null!==o;){var c=o.tag;if((3===c||4===c)&&o.stateNode.containerInfo===s)return;o=o.return}for(;null!==l;){if(null===(o=Xe(l)))return;if(5===(c=o.tag)||6===c||26===c||27===c){n=i=o;continue e}l=l.parentNode}}n=n.return}Lt(function(){var n=i,s=It(a),o=[];e:{var l=Nn.get(e);if(void 0!==l){var c=ta,u=e;switch(e){case"keypress":if(0===$t(a))break e;case"keydown":case"keyup":c=ga;break;case"focusin":u="focus",c=oa;break;case"focusout":u="blur",c=oa;break;case"beforeblur":case"afterblur":c=oa;break;case"click":if(2===a.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=ra;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ia;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=va;break;case bn:case vn:case xn:c=la;break;case Mn:c=xa;break;case"scroll":case"scrollend":c=na;break;case"wheel":c=wa;break;case"copy":case"cut":case"paste":c=ca;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=ya;break;case"toggle":case"beforetoggle":c=Sa}var d=!!(4&t),p=!d&&("scroll"===e||"scrollend"===e),h=d?null!==l?l+"Capture":null:l;d=[];for(var m,f=n;null!==f;){var g=f;if(m=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===m||null===h||null!=(g=Bt(f,h))&&d.push(sd(f,g,m)),p)break;f=f.return}0<d.length&&(l=new c(l,u,null,a,s),o.push({event:l,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||a===Ot||!(u=a.relatedTarget||a.fromElement)||!Xe(u)&&!u[Ue])&&(c||l)&&(l=s.window===s?s:(l=s.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=n,null!==(u=(u=a.relatedTarget||a.toElement)?Xe(u):null)&&(p=r(u),d=u.tag,u!==p||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=n),c!==u)){if(d=ra,g="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=ya,g="onPointerLeave",h="onPointerEnter",f="pointer"),p=null==c?l:Qe(c),m=null==u?l:Qe(u),(l=new d(g,f+"leave",c,a,s)).target=p,l.relatedTarget=m,g=null,Xe(s)===n&&((d=new d(h,f+"enter",u,a,s)).target=m,d.relatedTarget=p,g=d),p=g,c&&u)e:{for(d=id,f=u,m=0,g=h=c;g;g=d(g))m++;g=0;for(var y=f;y;y=d(y))g++;for(;0<m-g;)h=d(h),m--;for(;0<g-m;)f=d(f),g--;for(;m--;){if(h===f||null!==f&&h===f.alternate){d=h;break e}h=d(h),f=d(f)}d=null}else d=null;null!==c&&od(o,l,c,d,!1),null!==u&&null!==p&&od(o,p,u,d,!0)}if("select"===(c=(l=n?Qe(n):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var b=Ua;else if(Ra(l))if(Ga)b=Za;else{b=Ya;var v=Xa}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?n&&Et(n.elementType)&&(b=Ua):b=Qa;switch(b&&(b=b(e,n))?ja(o,b,a,s):(v&&v(e,l,n),"focusout"===e&&n&&"number"===l.type&&null!=n.memoizedProps.value&&vt(l,"number",l.value)),v=n?Qe(n):window,e){case"focusin":(Ra(v)||"true"===v.contentEditable)&&(ln=v,cn=n,un=null);break;case"focusout":un=cn=ln=null;break;case"mousedown":dn=!0;break;case"contextmenu":case"mouseup":case"dragend":dn=!1,pn(o,a,s);break;case"selectionchange":if(on)break;case"keydown":case"keyup":pn(o,a,s)}var x;if(Ca)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Da?Oa(e,a)&&(w="onCompositionEnd"):"keydown"===e&&229===a.keyCode&&(w="onCompositionStart");w&&(_a&&"ko"!==a.locale&&(Da||"onCompositionStart"!==w?"onCompositionEnd"===w&&Da&&(x=Kt()):(Wt="value"in(Gt=s)?Gt.value:Gt.textContent,Da=!0)),0<(v=rd(n,w)).length&&(w=new ua(w,e,null,a,s),o.push({event:w,listeners:v}),x?w.data=x:null!==(x=Ia(a))&&(w.data=x))),(x=Pa?function(e,t){switch(e){case"compositionend":return Ia(t);case"keypress":return 32!==t.which?null:(Aa=!0,Ta);case"textInput":return(e=t.data)===Ta&&Aa?null:e;default:return null}}(e,a):function(e,t){if(Da)return"compositionend"===e||!Ca&&Oa(e,t)?(e=Kt(),Ht=Wt=Gt=null,Da=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _a&&"ko"!==t.locale?null:t.data}}(e,a))&&(0<(w=rd(n,"onBeforeInput")).length&&(v=new ua("onBeforeInput","beforeinput",null,a,s),o.push({event:v,listeners:w}),v.data=x)),function(e,t,a,n,s){if("submit"===t&&a&&a.stateNode===s){var r=Hu((s[ze]||null).action),i=n.submitter;i&&null!==(t=(t=i[ze]||null)?Hu(t.formAction):i.getAttribute("formAction"))&&(r=t,i=null);var o=new ta("action","action",null,n,s);e.push({event:o,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==Ru){var e=i?Ku(s,i):new FormData(s);ao(a,{pending:!0,data:e,method:s.method,action:r},null,e)}}else"function"==typeof r&&(o.preventDefault(),e=i?Ku(s,i):new FormData(s),ao(a,{pending:!0,data:e,method:s.method,action:r},r,e))},currentTarget:s}]})}}(o,e,n,a,s)}Qu(o,t)})}function sd(e,t,a){return{instance:e,listener:t,currentTarget:a}}function rd(e,t){for(var a=t+"Capture",n=[];null!==e;){var s=e,r=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===r||(null!=(s=Bt(e,a))&&n.unshift(sd(e,s,r)),null!=(s=Bt(e,t))&&n.push(sd(e,s,r))),3===e.tag)return n;e=e.return}return[]}function id(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function od(e,t,a,n,s){for(var r=t._reactName,i=[];null!==a&&a!==n;){var o=a,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===n)break;5!==o&&26!==o&&27!==o||null===c||(l=c,s?null!=(c=Bt(a,r))&&i.unshift(sd(a,c,l)):s||null!=(c=Bt(a,r))&&i.push(sd(a,c,l))),a=a.return}0!==i.length&&e.push({event:t,listeners:i})}var ld=/\r\n?/g,cd=/\u0000|\uFFFD/g;function ud(e){return("string"==typeof e?e:""+e).replace(ld,"\n").replace(cd,"")}function dd(e,t){return t=ud(t),ud(e)===t}function pd(e,t,a,s,r,i){switch(a){case"children":"string"==typeof s?"body"===t||"textarea"===t&&""===s||St(e,s):("number"==typeof s||"bigint"==typeof s)&&"body"!==t&&St(e,""+s);break;case"className":lt(e,"class",s);break;case"tabIndex":lt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":lt(e,a,s);break;case"style":Ct(e,s,i);break;case"data":if("object"!==t){lt(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==a)){e.removeAttribute(a);break}if(null==s||"function"==typeof s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(a);break}s=Tt(""+s),e.setAttribute(a,s);break;case"action":case"formAction":if("function"==typeof s){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof i&&("formAction"===a?("input"!==t&&pd(e,t,"name",r.name,r,null),pd(e,t,"formEncType",r.formEncType,r,null),pd(e,t,"formMethod",r.formMethod,r,null),pd(e,t,"formTarget",r.formTarget,r,null)):(pd(e,t,"encType",r.encType,r,null),pd(e,t,"method",r.method,r,null),pd(e,t,"target",r.target,r,null))),null==s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(a);break}s=Tt(""+s),e.setAttribute(a,s);break;case"onClick":null!=s&&(e.onclick=At);break;case"onScroll":null!=s&&Zu("scroll",e);break;case"onScrollEnd":null!=s&&Zu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(n(61));if(null!=(a=s.__html)){if(null!=r.children)throw Error(n(60));e.innerHTML=a}}break;case"multiple":e.multiple=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"muted":e.muted=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"==typeof s||"boolean"==typeof s||"symbol"==typeof s){e.removeAttribute("xlink:href");break}a=Tt(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,""+s):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":!0===s?e.setAttribute(a,""):!1!==s&&null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,s):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&!isNaN(s)&&1<=s?e.setAttribute(a,s):e.removeAttribute(a);break;case"rowSpan":case"start":null==s||"function"==typeof s||"symbol"==typeof s||isNaN(s)?e.removeAttribute(a):e.setAttribute(a,s);break;case"popover":Zu("beforetoggle",e),Zu("toggle",e),ot(e,"popover",s);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":ot(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<a.length)||"o"!==a[0]&&"O"!==a[0]||"n"!==a[1]&&"N"!==a[1])&&ot(e,a=Pt.get(a)||a,s)}}function hd(e,t,a,s,r,i){switch(a){case"style":Ct(e,s,i);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(n(61));if(null!=(a=s.__html)){if(null!=r.children)throw Error(n(60));e.innerHTML=a}}break;case"children":"string"==typeof s?St(e,s):("number"==typeof s||"bigint"==typeof s)&&St(e,""+s);break;case"onScroll":null!=s&&Zu("scroll",e);break;case"onScrollEnd":null!=s&&Zu("scrollend",e);break;case"onClick":null!=s&&(e.onclick=At);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:tt.hasOwnProperty(a)||("o"!==a[0]||"n"!==a[1]||(r=a.endsWith("Capture"),t=a.slice(2,r?a.length-7:void 0),"function"==typeof(i=null!=(i=e[ze]||null)?i[a]:null)&&e.removeEventListener(t,i,r),"function"!=typeof s)?a in e?e[a]=s:!0===s?e.setAttribute(a,""):ot(e,a,s):("function"!=typeof i&&null!==i&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,s,r)))}}function md(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zu("error",e),Zu("load",e);var s,r=!1,i=!1;for(s in a)if(a.hasOwnProperty(s)){var o=a[s];if(null!=o)switch(s){case"src":r=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,t));default:pd(e,t,s,o,a,null)}}return i&&pd(e,t,"srcSet",a.srcSet,a,null),void(r&&pd(e,t,"src",a.src,a,null));case"input":Zu("invalid",e);var l=s=o=i=null,c=null,u=null;for(r in a)if(a.hasOwnProperty(r)){var d=a[r];if(null!=d)switch(r){case"name":i=d;break;case"type":o=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":s=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(n(137,t));break;default:pd(e,t,r,d,a,null)}}return void bt(e,s,l,c,u,o,i,!1);case"select":for(i in Zu("invalid",e),r=o=s=null,a)if(a.hasOwnProperty(i)&&null!=(l=a[i]))switch(i){case"value":s=l;break;case"defaultValue":o=l;break;case"multiple":r=l;default:pd(e,t,i,l,a,null)}return t=s,a=o,e.multiple=!!r,void(null!=t?xt(e,!!r,t,!1):null!=a&&xt(e,!!r,a,!0));case"textarea":for(o in Zu("invalid",e),s=i=r=null,a)if(a.hasOwnProperty(o)&&null!=(l=a[o]))switch(o){case"value":r=l;break;case"defaultValue":i=l;break;case"children":s=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(n(91));break;default:pd(e,t,o,l,a,null)}return void kt(e,r,i,s);case"option":for(c in a)if(a.hasOwnProperty(c)&&null!=(r=a[c]))if("selected"===c)e.selected=r&&"function"!=typeof r&&"symbol"!=typeof r;else pd(e,t,c,r,a,null);return;case"dialog":Zu("beforetoggle",e),Zu("toggle",e),Zu("cancel",e),Zu("close",e);break;case"iframe":case"object":Zu("load",e);break;case"video":case"audio":for(r=0;r<Xu.length;r++)Zu(Xu[r],e);break;case"image":Zu("error",e),Zu("load",e);break;case"details":Zu("toggle",e);break;case"embed":case"source":case"link":Zu("error",e),Zu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in a)if(a.hasOwnProperty(u)&&null!=(r=a[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,t));default:pd(e,t,u,r,a,null)}return;default:if(Et(t)){for(d in a)a.hasOwnProperty(d)&&(void 0!==(r=a[d])&&hd(e,t,d,r,a,void 0));return}}for(l in a)a.hasOwnProperty(l)&&(null!=(r=a[l])&&pd(e,t,l,r,a,null))}function fd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var gd=null,yd=null;function bd(e){return 9===e.nodeType?e:e.ownerDocument}function vd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function wd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var kd=null;var Sd="function"==typeof setTimeout?setTimeout:void 0,Md="function"==typeof clearTimeout?clearTimeout:void 0,Nd="function"==typeof Promise?Promise:void 0,Cd="function"==typeof queueMicrotask?queueMicrotask:void 0!==Nd?function(e){return Nd.resolve(null).then(e).catch(Ed)}:Sd;function Ed(e){setTimeout(function(){throw e})}function Pd(e){return"head"===e}function _d(e,t){var a=t,n=0;do{var s=a.nextSibling;if(e.removeChild(a),s&&8===s.nodeType)if("/$"===(a=s.data)||"/&"===a){if(0===n)return e.removeChild(s),void Kp(t);n--}else if("$"===a||"$?"===a||"$~"===a||"$!"===a||"&"===a)n++;else if("html"===a)Vd(e.ownerDocument.documentElement);else if("head"===a){Vd(a=e.ownerDocument.head);for(var r=a.firstChild;r;){var i=r.nextSibling,o=r.nodeName;r[$e]||"SCRIPT"===o||"STYLE"===o||"LINK"===o&&"stylesheet"===r.rel.toLowerCase()||a.removeChild(r),r=i}}else"body"===a&&Vd(e.ownerDocument.body);a=s}while(a);Kp(t)}function Td(e,t){var a=e;e=0;do{var n=a.nextSibling;if(1===a.nodeType?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",""===a.getAttribute("style")&&a.removeAttribute("style")):3===a.nodeType&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&8===n.nodeType)if("/$"===(a=n.data)){if(0===e)break;e--}else"$"!==a&&"$?"!==a&&"$~"!==a&&"$!"!==a||e++;a=n}while(a)}function Ad(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Ad(a),qe(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===a.rel.toLowerCase())continue}e.removeChild(a)}}function Od(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Fd(e.nextSibling)))return null}return e}function Id(e){return"$?"===e.data||"$~"===e.data}function Dd(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Fd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Rd=null;function jd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var a=e.data;if("/$"===a||"/&"===a){if(0===t)return Fd(e.nextSibling);t--}else"$"!==a&&"$!"!==a&&"$?"!==a&&"$~"!==a&&"&"!==a||t++}e=e.nextSibling}return null}function Ld(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var a=e.data;if("$"===a||"$!"===a||"$?"===a||"$~"===a||"&"===a){if(0===t)return e;t--}else"/$"!==a&&"/&"!==a||t++}e=e.previousSibling}return null}function Bd(e,t,a){switch(t=bd(a),e){case"html":if(!(e=t.documentElement))throw Error(n(452));return e;case"head":if(!(e=t.head))throw Error(n(453));return e;case"body":if(!(e=t.body))throw Error(n(454));return e;default:throw Error(n(451))}}function Vd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);qe(e)}var zd=new Map,Ud=new Set;function Gd(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Wd=D.d;D.d={f:function(){var e=Wd.f(),t=tu();return e||t},r:function(e){var t=Ye(e);null!==t&&5===t.tag&&"form"===t.type?so(t):Wd.r(e)},D:function(e){Wd.D(e),Kd("dns-prefetch",e,null)},C:function(e,t){Wd.C(e,t),Kd("preconnect",e,t)},L:function(e,t,a){Wd.L(e,t,a);var n=Hd;if(n&&e&&t){var s='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&a&&a.imageSrcSet?(s+='[imagesrcset="'+gt(a.imageSrcSet)+'"]',"string"==typeof a.imageSizes&&(s+='[imagesizes="'+gt(a.imageSizes)+'"]')):s+='[href="'+gt(e)+'"]';var r=s;switch(t){case"style":r=qd(e);break;case"script":r=Qd(e)}zd.has(r)||(e=p({rel:"preload",href:"image"===t&&a&&a.imageSrcSet?void 0:e,as:t},a),zd.set(r,e),null!==n.querySelector(s)||"style"===t&&n.querySelector(Xd(r))||"script"===t&&n.querySelector(Zd(r))||(md(t=n.createElement("link"),"link",e),Je(t),n.head.appendChild(t)))}},m:function(e,t){Wd.m(e,t);var a=Hd;if(a&&e){var n=t&&"string"==typeof t.as?t.as:"script",s='link[rel="modulepreload"][as="'+gt(n)+'"][href="'+gt(e)+'"]',r=s;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Qd(e)}if(!zd.has(r)&&(e=p({rel:"modulepreload",href:e},t),zd.set(r,e),null===a.querySelector(s))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Zd(r)))return}md(n=a.createElement("link"),"link",e),Je(n),a.head.appendChild(n)}}},X:function(e,t){Wd.X(e,t);var a=Hd;if(a&&e){var n=Ze(a).hoistableScripts,s=Qd(e),r=n.get(s);r||((r=a.querySelector(Zd(s)))||(e=p({src:e,async:!0},t),(t=zd.get(s))&&ap(e,t),Je(r=a.createElement("script")),md(r,"link",e),a.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}},S:function(e,t,a){Wd.S(e,t,a);var n=Hd;if(n&&e){var s=Ze(n).hoistableStyles,r=qd(e);t=t||"default";var i=s.get(r);if(!i){var o={loading:0,preload:null};if(i=n.querySelector(Xd(r)))o.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},a),(a=zd.get(r))&&tp(e,a);var l=i=n.createElement("link");Je(l),md(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,ep(i,t,n)}i={type:"stylesheet",instance:i,count:1,state:o},s.set(r,i)}}},M:function(e,t){Wd.M(e,t);var a=Hd;if(a&&e){var n=Ze(a).hoistableScripts,s=Qd(e),r=n.get(s);r||((r=a.querySelector(Zd(s)))||(e=p({src:e,async:!0,type:"module"},t),(t=zd.get(s))&&ap(e,t),Je(r=a.createElement("script")),md(r,"link",e),a.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}}};var Hd="undefined"==typeof document?null:document;function Kd(e,t,a){var n=Hd;if(n&&"string"==typeof t&&t){var s=gt(t);s='link[rel="'+e+'"][href="'+s+'"]',"string"==typeof a&&(s+='[crossorigin="'+a+'"]'),Ud.has(s)||(Ud.add(s),e={rel:e,crossOrigin:a,href:t},null===n.querySelector(s)&&(md(t=n.createElement("link"),"link",e),Je(t),n.head.appendChild(t)))}}function $d(e,t,a,s){var r,i,o,l,c=(c=H.current)?Gd(c):null;if(!c)throw Error(n(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof a.precedence&&"string"==typeof a.href?(t=qd(a.href),(s=(a=Ze(c).hoistableStyles).get(t))||(s={type:"style",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===a.rel&&"string"==typeof a.href&&"string"==typeof a.precedence){e=qd(a.href);var u=Ze(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Xd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),zd.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},zd.set(e,a),u||(r=c,i=e,o=a,l=d.state,r.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=r.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),md(i,"link",o),Je(i),r.head.appendChild(i))))),t&&null===s)throw Error(n(528,""));return d}if(t&&null!==s)throw Error(n(529,""));return null;case"script":return t=a.async,"string"==typeof(a=a.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Qd(a),(s=(a=Ze(c).hoistableScripts).get(t))||(s={type:"script",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,e))}}function qd(e){return'href="'+gt(e)+'"'}function Xd(e){return'link[rel="stylesheet"]['+e+"]"}function Yd(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Qd(e){return'[src="'+gt(e)+'"]'}function Zd(e){return"script[async]"+e}function Jd(e,t,a){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+gt(a.href)+'"]');if(s)return t.instance=s,Je(s),s;var r=p({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return Je(s=(e.ownerDocument||e).createElement("style")),md(s,"style",r),ep(s,a.precedence,e),t.instance=s;case"stylesheet":r=qd(a.href);var i=e.querySelector(Xd(r));if(i)return t.state.loading|=4,t.instance=i,Je(i),i;s=Yd(a),(r=zd.get(r))&&tp(s,r),Je(i=(e.ownerDocument||e).createElement("link"));var o=i;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),md(i,"link",s),t.state.loading|=4,ep(i,a.precedence,e),t.instance=i;case"script":return i=Qd(a.src),(r=e.querySelector(Zd(i)))?(t.instance=r,Je(r),r):(s=a,(r=zd.get(i))&&ap(s=p({},a),r),Je(r=(e=e.ownerDocument||e).createElement("script")),md(r,"link",s),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(n(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(s=t.instance,t.state.loading|=4,ep(s,a.precedence,e));return t.instance}function ep(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=n.length?n[n.length-1]:null,r=s,i=0;i<n.length;i++){var o=n[i];if(o.dataset.precedence===t)r=o;else if(r!==s)break}r?r.parentNode.insertBefore(e,r.nextSibling):(t=9===a.nodeType?a.head:a).insertBefore(e,t.firstChild)}function tp(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ap(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var np=null;function sp(e,t,a){if(null===np){var n=new Map,s=np=new Map;s.set(a,n)}else(n=(s=np).get(a))||(n=new Map,s.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),s=0;s<a.length;s++){var r=a[s];if(!(r[$e]||r[Ve]||"link"===e&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var i=r.getAttribute(t)||"";i=e+i;var o=n.get(i);o?o.push(r):n.set(i,[r])}}return n}function rp(e,t,a){(e=e.ownerDocument||e).head.insertBefore(a,"title"===t?e.querySelector("head > title"):null)}function ip(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var op=0;function lp(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)up(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var cp=null;function up(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cp=new Map,t.forEach(dp,e),cp=null,lp.call(e))}function dp(e,t){if(!(4&t.state.loading)){var a=cp.get(e);if(a)var n=a.get(null);else{a=new Map,cp.set(e,a);for(var s=e.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var i=s[r];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(a.set(i.dataset.precedence,i),n=i)}n&&a.set(null,n)}i=(s=t.instance).getAttribute("data-precedence"),(r=a.get(i)||n)===n&&a.set(null,s),a.set(i,s),this.count++,n=lp.bind(this),s.addEventListener("load",n),s.addEventListener("error",n),r?r.parentNode.insertBefore(s,r.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(s,e.firstChild),t.state.loading|=4}}var pp={$$typeof:x,Provider:null,Consumer:null,_currentValue:F,_currentValue2:F,_threadCount:0};function hp(e,t,a,n,s,r,i,o,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=n,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function mp(e,t,a,n,s,r,i,o,l,c,u,d){return e=new hp(e,t,a,i,l,c,u,d,o),t=1,!0===r&&(t|=24),r=Vn(3,null,null,t),e.current=r,r.stateNode=e,(t=zs()).refCount++,e.pooledCache=t,t.refCount++,r.memoizedState={element:n,isDehydrated:a,cache:t},br(r),e}function fp(e){return e?e=Ln:Ln}function gp(e,t,a,n,s,r){s=fp(s),null===n.context?n.context=s:n.pendingContext=s,(n=xr(t)).payload={element:a},null!==(r=void 0===r?null:r)&&(n.callback=r),null!==(a=wr(e,n,t))&&(Yc(a,0,t),kr(a,e,t))}function yp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var a=e.retryLane;e.retryLane=0!==a&&a<t?a:t}}function bp(e,t){yp(e,t),(e=e.alternate)&&yp(e,t)}function vp(e){if(13===e.tag||31===e.tag){var t=Fn(e,67108864);null!==t&&Yc(t,0,67108864),bp(e,67108864)}}function xp(e){if(13===e.tag||31===e.tag){var t=qc(),a=Fn(e,t=Fe(t));null!==a&&Yc(a,0,t),bp(e,t)}}var wp=!0;function kp(e,t,a,n){var s=I.T;I.T=null;var r=D.p;try{D.p=2,Mp(e,t,a,n)}finally{D.p=r,I.T=s}}function Sp(e,t,a,n){var s=I.T;I.T=null;var r=D.p;try{D.p=8,Mp(e,t,a,n)}finally{D.p=r,I.T=s}}function Mp(e,t,a,n){if(wp){var s=Np(n);if(null===s)nd(e,t,n,Cp,a),jp(e,n);else if(function(e,t,a,n,s){switch(t){case"focusin":return Tp=Lp(Tp,e,t,a,n,s),!0;case"dragenter":return Ap=Lp(Ap,e,t,a,n,s),!0;case"mouseover":return Op=Lp(Op,e,t,a,n,s),!0;case"pointerover":var r=s.pointerId;return Ip.set(r,Lp(Ip.get(r)||null,e,t,a,n,s)),!0;case"gotpointercapture":return r=s.pointerId,Dp.set(r,Lp(Dp.get(r)||null,e,t,a,n,s)),!0}return!1}(s,e,t,a,n))n.stopPropagation();else if(jp(e,n),4&t&&-1<Rp.indexOf(e)){for(;null!==s;){var r=Ye(s);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var i=Ne(r.pendingLanes);if(0!==i){var o=r;for(o.pendingLanes|=2,o.entangledLanes|=2;i;){var l=1<<31-ve(i);o.entanglements[1]|=l,i&=~l}ju(r),!(6&fc)&&(Rc=oe()+500,Lu(0))}}break;case 31:case 13:null!==(o=Fn(r,2))&&Yc(o,0,2),tu(),bp(r,2)}if(null===(r=Np(n))&&nd(e,t,n,Cp,a),r===s)break;s=r}null!==s&&n.stopPropagation()}else nd(e,t,n,null,a)}}function Np(e){return Ep(e=It(e))}var Cp=null;function Ep(e){if(Cp=null,null!==(e=Xe(e))){var t=r(e);if(null===t)e=null;else{var a=t.tag;if(13===a){if(null!==(e=i(t)))return e;e=null}else if(31===a){if(null!==(e=c(t)))return e;e=null}else if(3===a){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Cp=e,null}function Pp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case ce:return 2;case ue:return 8;case de:case pe:return 32;case he:return 268435456;default:return 32}default:return 32}}var _p=!1,Tp=null,Ap=null,Op=null,Ip=new Map,Dp=new Map,Fp=[],Rp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jp(e,t){switch(e){case"focusin":case"focusout":Tp=null;break;case"dragenter":case"dragleave":Ap=null;break;case"mouseover":case"mouseout":Op=null;break;case"pointerover":case"pointerout":Ip.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dp.delete(t.pointerId)}}function Lp(e,t,a,n,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=Ye(t))&&vp(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Bp(e){var t=Xe(e.target);if(null!==t){var a=r(t);if(null!==a)if(13===(t=a.tag)){if(null!==(t=i(a)))return e.blockedOn=t,void Le(e.priority,function(){xp(a)})}else if(31===t){if(null!==(t=c(a)))return e.blockedOn=t,void Le(e.priority,function(){xp(a)})}else if(3===t&&a.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===a.tag?a.stateNode.containerInfo:null)}e.blockedOn=null}function Vp(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var a=Np(e.nativeEvent);if(null!==a)return null!==(t=Ye(a))&&vp(t),e.blockedOn=a,!1;var n=new(a=e.nativeEvent).constructor(a.type,a);Ot=n,a.target.dispatchEvent(n),Ot=null,t.shift()}return!0}function zp(e,t,a){Vp(e)&&a.delete(t)}function Up(){_p=!1,null!==Tp&&Vp(Tp)&&(Tp=null),null!==Ap&&Vp(Ap)&&(Ap=null),null!==Op&&Vp(Op)&&(Op=null),Ip.forEach(zp),Dp.forEach(zp)}function Gp(t,a){t.blockedOn===a&&(t.blockedOn=null,_p||(_p=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Up)))}var Wp=null;function Hp(t){Wp!==t&&(Wp=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Wp===t&&(Wp=null);for(var e=0;e<t.length;e+=3){var a=t[e],n=t[e+1],s=t[e+2];if("function"!=typeof n){if(null===Ep(n||a))continue;break}var r=Ye(a);null!==r&&(t.splice(e,3),e-=3,ao(r,{pending:!0,data:s,method:a.method,action:n},n,s))}}))}function Kp(e){function t(t){return Gp(t,e)}null!==Tp&&Gp(Tp,e),null!==Ap&&Gp(Ap,e),null!==Op&&Gp(Op,e),Ip.forEach(t),Dp.forEach(t);for(var a=0;a<Fp.length;a++){var n=Fp[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Fp.length&&null===(a=Fp[0]).blockedOn;)Bp(a),null===a.blockedOn&&Fp.shift();if(null!=(a=(e.ownerDocument||e).$$reactFormReplay))for(n=0;n<a.length;n+=3){var s=a[n],r=a[n+1],i=s[ze]||null;if("function"==typeof r)i||Hp(a);else if(i){var o=null;if(r&&r.hasAttribute("formAction")){if(s=r,i=r[ze]||null)o=i.formAction;else if(null!==Ep(s))continue}else o=i.action;"function"==typeof o?a[n+1]=o:(a.splice(n,3),n-=3),Hp(a)}}}function $p(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return s=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==s&&(s(),s=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var n=!1,s=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==s&&(s(),s=null)}}}function qp(e){this._internalRoot=e}function Xp(e){this._internalRoot=e}Xp.prototype.render=qp.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));gp(t.current,qc(),e,t,null,null)},Xp.prototype.unmount=qp.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;gp(e.current,2,null,e,null,null),tu(),t[Ue]=null}},Xp.prototype.unstable_scheduleHydration=function(e){if(e){var t=je();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Fp.length&&0!==t&&t<Fp[a].priority;a++);Fp.splice(a,0,e),0===a&&Bp(e)}};var Yp=t.version;if("19.2.3"!==Yp)throw Error(n(527,Yp,"19.2.3"));D.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=r(e)))throw Error(n(188));return t!==e?null:e}for(var a=e,s=t;;){var i=a.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(s=i.return)){a=s;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===a)return u(i),e;if(o===s)return u(i),t;o=o.sibling}throw Error(n(188))}if(a.return!==s.return)a=i,s=o;else{for(var l=!1,c=i.child;c;){if(c===a){l=!0,a=i,s=o;break}if(c===s){l=!0,s=i,a=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===a){l=!0,a=o,s=i;break}if(c===s){l=!0,s=o,a=i;break}c=c.sibling}if(!l)throw Error(n(189))}}if(a.alternate!==s)throw Error(n(190))}if(3!==a.tag)throw Error(n(188));return a.stateNode.current===a?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Qp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.3"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{ge=Zp.inject(Qp),ye=Zp}catch(eh){}}return ka.createRoot=function(e,t){if(!s(e))throw Error(n(299));var a=!1,r="",i=Co,o=Eo,l=Po;return null!=t&&(!0===t.unstable_strictMode&&(a=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=mp(e,1,!1,null,0,a,r,null,i,o,l,$p),e[Ue]=t.current,td(e),new qp(t)},ka.hydrateRoot=function(e,t,a){if(!s(e))throw Error(n(299));var r=!1,i="",o=Co,l=Eo,c=Po,u=null;return null!=a&&(!0===a.unstable_strictMode&&(r=!0),void 0!==a.identifierPrefix&&(i=a.identifierPrefix),void 0!==a.onUncaughtError&&(o=a.onUncaughtError),void 0!==a.onCaughtError&&(l=a.onCaughtError),void 0!==a.onRecoverableError&&(c=a.onRecoverableError),void 0!==a.formState&&(u=a.formState)),(t=mp(e,1,!0,t,0,r,i,u,o,l,c,$p)).context=fp(null),a=t.current,(i=xr(r=Fe(r=qc()))).callback=null,wr(a,i,r),a=r,t.current.lanes=a,Ae(t,a),ju(t),e[Ue]=t.current,td(e),new Xp(t)},ka.version="19.2.3",ka}var Ea=(va||(va=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),wa.exports=Ca()),wa.exports);const Pa={},_a=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");n=e(t.map(e=>{if((e=function(e){return"/DEViLBOX/"+e}(e))in Pa)return;Pa[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},Ta=e=>Symbol.iterator in e,Aa=e=>"entries"in e,Oa=(e,t)=>{const a=e instanceof Map?e:new Map(e.entries()),n=t instanceof Map?t:new Map(t.entries());if(a.size!==n.size)return!1;for(const[s,r]of a)if(!n.has(s)||!Object.is(r,n.get(s)))return!1;return!0};function Ia(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(Ta(e)&&Ta(t)?Aa(e)&&Aa(t)?Oa(e,t):((e,t)=>{const a=e[Symbol.iterator](),n=t[Symbol.iterator]();let s=a.next(),r=n.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=a.next(),r=n.next()}return!!s.done&&!!r.done})(e,t):Oa({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function Da(t){const a=e.useRef(void 0);return e=>{const n=t(e);return Ia(a.current,n)?a.current:a.current=n}}const Fa=e=>(a,n,s)=>(s.setState=(e,n,...s)=>{const r="function"==typeof e?t(e):e;return a(r,n,...s)},e(s.setState,n,s));function Ra(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t="/DEViLBOX/",a=t.endsWith("/")?t.slice(0,-1):t;if(""===a||"/"===a)return e;const n=e.startsWith("/")?e:"/"+e;if(n.startsWith(a))return n;return a+n}function ja(e,t,a){const n=e.replace(/\.wav$/i,"");return{filename:e,name:n.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/\s+/g," ").trim()||n,category:t,url:Ra(`${a}/${t}/${encodeURIComponent(e)}`)}}const La="data/samples/packs/drumnibus",Ba={id:"drumnibus",name:"Drumnibus Electro Drums",author:"Legowelt",description:"A collection of 229 electro drum machine samples. Classic analog-style kicks, snares, hi-hats, percussion and FX sounds perfect for electro, techno, and electronic music production.",coverImage:Ra("data/samples/packs/drumnibus/cover.png"),basePath:La,categories:["kicks","snares","hihats","percussion","fx"],samples:{kicks:["BB_Electro1short.wav","BD_Drumaxia.wav","BD_Pufsub.wav","BD_808A1200.wav","BD_DiggerLong.wav","BD_Digidap.wav","BD_Digimozzy.wav","BD_Dikkie.wav","BD_Dome_Long.wav","BD_EchoRam1.wav","BD_EchoRam2.wav","BD_Electro1shorter.wav","BD_Juxtapos.wav","BD_Lite2021.wav","BD_LofiHuman.wav","BD_Losamplix.wav","BD_Magnotron..wav","BD_Matrixtape1.wav","BD_Matrixtape2.wav","BD_Plastiklog.wav","BD_Punchtron.wav","BD_Punchysplur.wav","BD_Pziforze.wav","BD_Ritmo.wav","BD_Romkick1.wav","BD_Rubydub.wav","BD_Ruflex.wav","BD_Simpletron.wav","BD_Springworth.wav","BD_Spriverbion.wav","BD_Stuf.wav","BD_SubThud.wav","BD_Zistort.wav"].map(e=>ja(e,"kicks",La)),snares:["SD_808A1200.wav","SD_Analog_Noise_2.wav","SD_Analog_Noise_4.wav","SD_Analog_Noise_5.wav","SD_Analog_Noise1.wav","SD_CompuCrunchy.wav","SD_Digidap.wav","SD_Draconis1.wav","SD_Draconis2.wav","SD_Drumaxia.wav","SD_Echoram1.wav","SD_Echoram2.wav","SD_Echoram3.wav","SD_electro7000.wav","SD_Hark.wav","SD_Juxtapos.wav","SD_Kitcatlitter.wav","SD_LoDigital_1.wav","SD_LoDigital_2.wav","SD_LofiHuman.wav","SD_Magnotron.wav","SD_Mamba.wav","SD_Mambalazesnare.wav","SD_Mambalazesnare2.wav","SD_NomiSnare.wav","SD_NomiSnareLazer.wav","SD_NomiSnareWhip.wav","SD_Punchtron..wav","SD_Reverz1.wav","SD_Reverz2.wav","SD_Reverz3.wav","SD_Ritmo.wav","SD_Rubydubwav.wav","SD_Ruflex.wav","SD_Strakker.wav","SD_Turbosound.wav","SD_Wolf_3.wav","SD_Wolf_5.wav","SD_Wolf_6.wav","SD_Wolf_7.wav","SD_Wolf_8.wav","SD_Wolf_9.wav","SD_Wolf1.wav","SD_Wolf2.wav","SD_Wolfsweep1.wav"].map(e=>ja(e,"snares",La)),hihats:["CH_Digidap.wav","CH_DistortedRitmo.wav","CH_DraconisD921.wav","CH_DraconisD922.wav","CH_Fantio_Closed_Hat.wav","CH_Filtix_Closed_Hat.wav","CH_Juxtapos.wav","CH_LofiHuman.wav","CH_Magnotron.wav","CH_Punchtron.wav","CH_Rezmatix_Closed_Hat.wav","CH_Rubydub.wav","CH_Ruflex.wav","CH_Sizzel_Closed_Hat.wav","CYM_Juxtapos.wav","CYM_Magnotron.wav","CYM_Punchtron.wav","CYM_Ruflex.wav","CYM_Synthique.wav","OH_AnalogHihat1.wav","OH_AnalogOpenhatwav.wav","OH_AnalogVeryLongHat.wav","OH_Digidap.wav","OH_DistortedRitmo.wav","OH_DraconisD921.wav","OH_DraconisD922.wav","OH_Drumaxia.wav","OH_Fantio_Open_Hat.wav","OH_Filtix_Open_Hat.wav","OH_Juxtapos.wav","OH_LofiHuman.wav","OH_Magnotron.wav","OH_Punchtron.wav","OH_Rezmatix_Open_Hat_Long.wav","OH_Rezmatix_Open_Hat.wav","OH_Rubydub.wav","OH_Ruflex.wav","OH_Sizzel_Open_Hat.wav"].map(e=>ja(e,"hihats",La)),claps:[],percussion:["BELL_Darkgong.wav","BELL_Filterbell.wav","BELL_Hypnoschaal.wav","BELL_Hypnoschaal2.wav","BELL_Hypnoschaal3.wav","BONGO_Ryhtmbox.wav","BONGO_Ryhtmbox2.wav","BONGO_Simple.wav","CLAP_Juxtapos.wav","CLAP_LofiHuman.wav","CLAP_Magnotron.wav","CLAP_Punchtron.wav","CLAP_Rubydub.wav","CLAP_Ruflex.wav","CLAVE_Punchtron.wav","CLAVE_Simple.wav","CLAVE_Singalique.wav","CLAVE_Syntheticblox.wav","CONGA_Lowpark.wav","CONGA_Syntique.wav","COW_Syntique.wav","LAZ_Drumaxia.wav","LAZ_Blip1.wav","LAZ_Blip2.wav","LAZ_Blip3.wav","LAZ_Chewy1.wav","LAZ_Digidap.wav","LAZ_Lectrophy.wav","LAZ_Lectrophy2.wav","LAZ_lowvix1.wav","LAZ_lowvix2.wav","LAZ_lowvix3.wav","LAZ_Mambalazesnare.wav","LAZ_R900.wav","LAZ_Softrond.wav","LAZ_Softrond2.wav","LAZ_Softrond3.wav","RIM_Losimple.wav","RIM_Magnotron.wav","RIM_Rubydub.wav","SHAKE_AnalogShaker1.wav","SHAKE_AnalogShaker2.wav","SHAKE_AnalogShaker3.wav","SHAKE_Ritmo.wav","SNAP_Juxtapos.wav","TABLA_Mamba.wav","TAMB_Tamb&Shaker.wav","TAMB_TapeShake1.wav","TAMB_TapeShake2.wav","TAMB_TapeShake3.wav","TOM_digger.wav","TOM_DistortedRitmo.wav","TOM_DistortedRitmoHi.wav","TOM_DraconisDS92.wav","TOM_DraconisDS92high.wav","TOM_Druimaxia.wav","TOM_Juxtapos.wav","TOM_LofiHuman.wav","TOM_Magnotron.wav","TOM_Osciaz.wav","TOM_Punchtron.wav","TOM_Rubydub.wav","TOM_Ruflex.wav","TOM_Stofelectro1.wav","TOM_TamborineTom.wav","TOM_TamborineTom2.wav","TOM_TamborineTom3.wav","TOM_Warped.wav"].map(e=>ja(e,"percussion",La)),fx:["FX_AnalogFX1.wav","FX_AnalogFX2.wav","FX_Blarper.wav","FX_Briesherfst.wav","FX_Briesherfst2.wav","FX_Briesherfst3.wav","FX_Burst1.wav","FX_Burst2.wav","FX_Chainmalz.wav","FX_Digidap2.wav","FX_Digidap3.wav","FX_Drumaxia.wav","FX_Drumaxia2.wav","FX_ElectroIsland.wav","FX_ElectroIsland2.wav","FX_Emerx1.wav","FX_Emerx2.wav","FX_Emerx3.wav","FX_LofiHuman.wav","FX_LofiHuman2.wav","FX_Magstorm1.wav","FX_Magstorm2.wav","FX_NomiElastiek.wav","FX_NomiLaser1.wav","FX_NomiLectric.wav","FX_NomiLectric2.wav","FX_NomiSnip.wav","FX_NomiSpring.wav","FX_Poni1.wav","FX_Poni2.wav","FX_Poni3.wav","FX_Quarkulator.wav","FX_Quarkulator2.wav","FX_Sloiz.wav","FX_Snakamon1.wav","FX_Snakamon2.wav","FX_Snakamon3.wav","FX_Snakamon3B.wav","FX_Snakamon5.wav","FX_Sonar.wav","FX_Sonar2.wav","FX_Sydrum1.wav","FX_Sydrum2.wav","FX_Sydrum3.wav","FX_Timpio.wav"].map(e=>ja(e,"fx",La)),bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:229},Va="data/samples/packs/casio-mt40",za=[Ba,{id:"casio-mt40",name:"Casio MT-40",author:"Casio",description:"Classic 8-bit instrument sounds from the legendary Casio MT-40 keyboard. Home of the Sleng Teng riddim.",coverImage:Ra("data/samples/packs/casio-mt40/cover.jpg"),basePath:Va,categories:["leads"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:["accordion.wav","banjo.wav","bass.wav","brass.wav","celesta.wav","cello.wav","clarinet.wav","elec piano.wav","flute.wav","folk flute.wav","funny fuzz.wav","glocken.wav","guitar.wav","harpsichord.wav","organ.wav","oriental.wav","pipe-organ.wav","recorder.wav","st ensemble.wav","synth fuzz.wav","trumpet.wav","violin.wav","xylophone.wav"].map(e=>ja(e,"leads",Va)),pads:[],loops:[],vocals:[],other:[]},sampleCount:23}];const Ua=c(a()),Ga={kicks:"kicks",kick:"kicks",bd:"kicks",bassdrum:"kicks","bass drum":"kicks",snares:"snares",snare:"snares",sd:"snares",hihats:"hihats",hihat:"hihats","hi-hats":"hihats","hi-hat":"hihats",hh:"hihats",claps:"claps",clap:"claps",cp:"claps",percussion:"percussion",perc:"percussion",fx:"fx",effects:"fx",sfx:"fx",bass:"bass",leads:"leads",lead:"leads",pads:"pads",pad:"pads",loops:"loops",loop:"loops",vocals:"vocals",vocal:"vocals",vox:"vocals",toms:"percussion",tom:"percussion",cymbals:"hihats",cymbal:"hihats",rides:"hihats",ride:"hihats",crash:"hihats",open:"hihats",closed:"hihats",oh:"hihats",ch:"hihats"},Wa=[".wav",".mp3",".ogg",".flac",".aiff",".aif"],Ha=[".png",".jpg",".jpeg",".webp"];function Ka(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Wa.includes(t)}function $a(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Ha.includes(t)}function qa(e){const t=e.toLowerCase();return t.includes("cover")||t.includes("folder")||t.includes("front")||t.includes("artwork")}function Xa(e,t){const a=e.toLowerCase();return".ds_store"===a||"thumbs.db"===a||a.startsWith("._")||t.includes("__MACOSX")||e.startsWith(".")}function Ya(e){const t=e.toLowerCase().trim();return Ga[t]||"other"}function Qa(e){const t=e.replace(/\.(wav|mp3|ogg|flac|aiff|aif)$/i,"");return t.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim()||t}const Za=n()(Fa((e,t)=>({userPacks:[],uploadZip:async t=>{try{const a=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let a,n=e.name.replace(/\.zip$/i,""),s=[];const r=new Set;try{const l=await Ua.loadAsync(e),c=Object.entries(l.files);let u=0;for(const[e,a]of c){if(a.dir)continue;const n=e.split("/").filter(e=>e.length>0);if(0===n.length)continue;const o=n[n.length-1];if(Xa(o,e))continue;if($a(o)){const t=qa(o)?2:n.length<=2?1:0;s.push({path:e,filename:o,priority:t});continue}if(!Ka(o))continue;let l="other";n.length>=2&&(l=Ya(n[n.length-2]));try{const e=await a.async("blob"),n=URL.createObjectURL(e),s={filename:o,name:Qa(o),category:l,url:n};t[l].push(s),r.add(l),u++}catch(i){}}if(s.length>0){s.sort((e,t)=>t.priority-e.priority);const e=s[0],t=l.files[e.path];if(t)try{const e=await t.async("blob");a=URL.createObjectURL(e)}catch(o){}}const d=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===d)throw new Error("No audio files found in the ZIP.");return{id:`user-${Date.now()}`,name:n,author:"User Upload",description:`User-uploaded sample pack with ${d} samples`,coverImage:a,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:d,isUserUploaded:!0}}catch(l){throw l}}(t);return e(e=>{e.userPacks.push(a)}),a}catch(a){throw a}},uploadDirectory:async t=>{try{const a=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let a,n="",s=[];const r=new Set;for(let l=0;l<e.length;l++){const a=e[l],i=a.webkitRelativePath||a.name;if(Xa(a.name,i))continue;const c=i.split("/").filter(e=>e.length>0),u=c[c.length-1];if(c.length>1&&!n&&(n=c[0]),$a(u)){const e=qa(u)?2:c.length<=2?1:0;s.push({file:a,priority:e});continue}if(!Ka(u))continue;let d="other";c.length>=2&&(d=Ya(c.length>=3?c[c.length-2]:c[1]));try{const e=URL.createObjectURL(a),n={filename:u,name:Qa(u),category:d,url:e};t[d].push(n),r.add(d)}catch(o){}}if(n||(n="Uploaded Pack"),s.length>0){s.sort((e,t)=>t.priority-e.priority);try{a=URL.createObjectURL(s[0].file)}catch(o){}}const i=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===i)throw new Error("No audio files found in the directory.");return{id:`user-${Date.now()}`,name:n,author:"User Upload",description:`User-uploaded sample pack with ${i} samples`,coverImage:a,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:i,isUserUploaded:!0}}(t);return e(e=>{e.userPacks.push(a)}),a}catch(a){throw a}},removeUserPack:t=>{e(e=>{e.userPacks=e.userPacks.filter(e=>e.id!==t)})},clearUserPacks:()=>{e(e=>{e.userPacks=[]})}}))),Ja=()=>{const e=Za(e=>e.userPacks);return[...za,...e]},en=[null,"#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],tn={note:!0,instrument:!0,volume:!0,effect:!0,effect2:!0,flag1:!1,flag2:!1,cutoff:!1,resonance:!1,envMod:!1,pan:!1,probability:!1},an={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},nn={wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},sn={sampleUrl:"",grainSize:100,grainOverlap:50,playbackRate:1,detune:0,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:4,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}},rn={type:"vfx",clock:16e6,romsLoaded:!1,registers:{}},on={type:"doc",clock:1e6,romsLoaded:!1,registers:{}},ln={type:"swp30",clock:33868800,romsLoaded:!1,registers:{}},cn={moduleData:"",format:"UNKNOWN",useLibopenmpt:!0,repeatCount:0,stereoSeparation:100,interpolationFilter:0},un={voices:7,detune:30,mix:50,stereoSpread:80,envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},dn={voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100},portamento:0},pn={drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:50,decay:"fast",harmonic:"third"},keyClick:30,vibrato:{type:"C3",depth:50},rotary:{enabled:!0,speed:"slow"}},hn={drumType:"kick",machineType:"909",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},snare:{pitch:220,pitchHigh:476,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},hihat:{tone:50,decay:100,metallic:50},clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},conga:{pitch:310,decay:180,tuning:50},cowbell:{decay:400,filterFreq:2640},rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450},maracas:{decay:30,filterFreq:5e3},cymbal:{tone:50,decay:2e3}},mn={channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop",swing:0}},fn={pulseWidth:50,pwmDepth:30,pwmRate:2,pwmWaveform:"sine",oscillators:2,detune:10,envelope:{attack:50,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:4e3,resonance:20,envelopeAmount:30,keyTracking:50},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},gn={sections:{violin:100,viola:70,cello:50,bass:30},ensemble:{depth:60,rate:3,voices:4},attack:200,release:1e3,brightness:60},yn={A:{f1:800,f2:1200,f3:2500},E:{f1:400,f2:2e3,f3:2600},I:{f1:300,f2:2300,f3:3e3},O:{f1:500,f2:800,f3:2500},U:{f1:350,f2:600,f3:2400}},bn={mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},vn={machineType:"ArguruDistortion",parameters:{}},xn={vowel:"A",vowelMorph:{target:"O",amount:0,rate:1,mode:"manual"},oscillator:{type:"sawtooth"},formants:{...yn.A,bandwidth:100},envelope:{attack:50,decay:500,sustain:0,release:100},brightness:70},wn={VOL:0,ARP:1,DUTY:2,WAVE:3,PITCH:4,EX1:5,EX2:6,EX3:7,ALG:8,FB:9,FMS:10,AMS:11,PAN_L:12,PAN_R:13,PHASE_RESET:14,EX4:15,EX5:16,EX6:17,EX7:18,EX8:19},kn={chipType:1,algorithm:4,feedback:4,fms:0,ams:0,fms2:0,ams2:0,ops:4,opllPreset:0,fixedDrums:!1,operators:[{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:50,ar:28,dr:6,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:10,d2r:4,sl:2,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:8,d2r:3,sl:3,rr:5,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0}],macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]},Sn={algorithm:0,feedback:0,oscSync:!0,operators:Array.from({length:6},()=>({level:99,coarse:1,fine:0,detune:7,mode:"ratio",egRates:[99,99,99,99],egLevels:[99,99,99,0],breakPoint:0,leftDepth:0,rightDepth:0,leftCurve:0,rightCurve:0,rateScaling:0,ampModSens:0,velocitySens:0})),pitchEgRates:[99,99,99,99],pitchEgLevels:[50,50,50,50],lfoSpeed:35,lfoDelay:0,lfoPitchModDepth:0,lfoAmpModDepth:0,lfoSync:!1,lfoWave:"triangle",lfoPitchModSens:0,transpose:0,name:"INIT VOICE"},Mn={osc1Waveform:"saw",osc1Octave:0,osc1Detune:0,osc1PulseWidth:.5,osc1Level:1,osc2Waveform:"saw",osc2Octave:0,osc2Detune:.1,osc2PulseWidth:.5,osc2Level:.7,oscSync:!1,oscXor:!1,filterCutoff:.7,filterResonance:.3,filterType:"lp24",filterEnvAmount:.5,filterKeyTrack:0,filterVelocity:.3,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:"sine",lfoDelay:0,lfoOscAmount:0,lfoFilterAmount:0,lfoAmpAmount:0,lfoPwAmount:0,masterVolume:.7,voices:8,unison:!1,unisonDetune:.1,portamento:0,panSpread:.3,velocitySensitivity:.5,noiseLevel:0,subOscLevel:0,subOscOctave:-1,drift:.02},Nn={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1},Cn={keymap:[],polyphony:"poly",maxVoices:8,noteCut:!1},En={enabled:!1,waveform:"sine",rate:5,sync:!1,syncDivision:"1/4",filterAmount:0,filterTarget:"cutoff",pitchAmount:0,volumeAmount:0,phase:0,retrigger:!0},Pn={oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"square",rate:2,depth:100},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:1.5,wet:.1}},_n={text:"COMMODORE SIXTY FOUR",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},Tn={moduleUrl:"",pluginState:null,pluginStateVersion:1,pluginStateTimestamp:0},An={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0},On={osc1:{mode:1,transpose:0,detune:0,color:64,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:10,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:-10,color:64,level:0},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:127,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:32},envelope2:{attack:0,decay:64,sustain:127,release:32},lfo1:{rate:64,depth:0}},In={laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:40,ratio:2.5},noise:{amount:10,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:40},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:2,wet:.2}},Dn={oscillator:{type:"square",tune:200,fine:0},oscillator2:{enabled:!1,detune:0,mix:.5},noise:{enabled:!0,type:"white",mix:.2,color:100},filter:{cutoff:800,resonance:60,envMod:70,decay:200},lfo:{enabled:!1,rate:5,depth:0,target:"pitch"},envelope:{decay:300,sustain:0},sweep:{enabled:!0,amount:24,time:150}},Fn={type:"sawtooth",detune:0,octave:0},Rn={attack:10,decay:500,sustain:0,release:100},jn={type:"lowpass",frequency:2e3,Q:1,rolloff:-24},Ln={engineType:"db303",volume:.8,oscillator:{type:"sawtooth",pulseWidth:1,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.5},slide:{time:.17,mode:"exponential"},overdrive:{amount:0},devilFish:{enabled:!0,normalDecay:.5,accentDecay:.1,softAttack:0,accentSoftAttack:.5,passbandCompensation:.9,resTracking:.7,filterInputDrive:0,filterSelect:1,diodeCharacter:0,duffingAmount:0,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.5,feedback:0,tone:.5,mix:0,stereo:.75}},Bn=[{id:"straight",name:"Straight",category:"straight",description:"No groove, all rows on the grid",values:[0,0]},{id:"light-shuffle",name:"Light Shuffle",category:"shuffle",description:"Subtle rhythmic bounce (16th)",values:[0,8],velocityOffsets:[0,-.05]},{id:"medium-shuffle",name:"Medium Shuffle",category:"shuffle",description:"Classic bouncy shuffle feel",values:[0,16],velocityOffsets:[0,-.1]},{id:"heavy-shuffle",name:"Heavy Shuffle",category:"shuffle",description:"Strong triplet-style bounce",values:[0,25],velocityOffsets:[0,-.15]},{id:"triplet",name:"Full Triplet",category:"shuffle",description:"True 2:1 triplet timing (66%)",values:[0,33],velocityOffsets:[0,-.2]},{id:"mpc-50",name:"MPC 50%",category:"swing",description:"MPC straight (no swing)",values:[0,0]},{id:"mpc-54",name:"MPC 54%",category:"swing",description:"MPC light swing",values:[0,8],velocityOffsets:[0,-.08]},{id:"mpc-58",name:"MPC 58%",category:"swing",description:"MPC medium swing",values:[0,16],velocityOffsets:[0,-.12]},{id:"mpc-62",name:"MPC 62%",category:"swing",description:"MPC heavy swing",values:[0,25],velocityOffsets:[0,-.18]},{id:"mpc-66",name:"MPC 66%",category:"swing",description:"MPC maximum swing",values:[0,33],velocityOffsets:[0,-.25]},{id:"funk-16th",name:"Funk 16th",category:"funk",description:"16th note funk groove",values:[0,5,-3,10],velocityOffsets:[.1,-.2,.05,-.3],suggestedBpmRange:[90,130]},{id:"funk-lazy",name:"Lazy Funk",category:"funk",description:"Relaxed funk feel, everything slightly late",values:[3,8,5,12],velocityOffsets:[.05,-.1,.05,-.15],suggestedBpmRange:[80,110]},{id:"funk-tight",name:"Tight Funk",category:"funk",description:"Rushed funk feel, snappy timing",values:[-2,5,-5,8],velocityOffsets:[.15,-.15,.1,-.2],suggestedBpmRange:[100,140]},{id:"boom-bap",name:"Boom Bap",category:"hip-hop",description:"Classic 90s hip-hop swing",values:[0,12,0,8],velocityOffsets:[.1,-.15,.05,-.1],suggestedBpmRange:[85,100]},{id:"lo-fi",name:"Lo-Fi",category:"hip-hop",description:"Drunk/loose timing for lo-fi beats",values:[5,15,-3,18],velocityOffsets:[-.05,-.2,-.1,-.25],suggestedBpmRange:[70,95]},{id:"trap-triplet",name:"Trap Triplet",category:"hip-hop",description:"Triplet hi-hat groove for trap",values:[0,22,11,33,0,22],velocityOffsets:[.1,-.2,-.1,-.3,.05,-.25],suggestedBpmRange:[130,160]},{id:"drunken",name:"Drunken Master",category:"custom",description:"Irregular timing for experimental feel",values:[0,8,-5,15,3,20,-8,12],velocityOffsets:[0,-.1,.05,-.2,.1,-.15,.05,-.3]},{id:"push-pull",name:"Push-Pull",category:"custom",description:"Alternating early/late for tension",values:[-10,10,-10,10],velocityOffsets:[.1,-.1,.1,-.1]}];const Vn=[{id:"ramp-up",name:"Ramp Up",shape:"rampUp",points:[{row:0,value:0},{row:63,value:1}]},{id:"ramp-down",name:"Ramp Down",shape:"rampDown",points:[{row:0,value:1},{row:63,value:0}]},{id:"triangle",name:"Triangle",shape:"triangle",points:[{row:0,value:0},{row:31,value:1},{row:63,value:0}]},{id:"sine",name:"Sine Wave",shape:"sine",points:Array.from({length:64},(e,t)=>({row:t,value:(Math.sin(t/64*Math.PI*2)+1)/2}))}];(new Date).toISOString(),(new Date).toISOString();const zn=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Un(e){if(null===e||""===e||"..."===e)return 0;if("==="===e||"OFF"===e)return 97;const t=e.match(/^([A-G])([#-])(\d)$/);if(!t)return 0;const[,a,n,s]=t,r=parseInt(s,10),i=a+n,o=zn.indexOf(i);if(-1===o)return 0;const l=12*r+o+1;return l<1||l>96?0:l}function Gn(e){if(0===e)return"...";if(97===e)return"===";if(e<1||e>96)return"...";const t=e-1,a=Math.floor(t/12);return`${zn[t%12]}${a}`}const Wn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,K:20,L:21,P:25,R:27,T:29,X:33},Hn=Object.fromEntries(Object.entries(Wn).map(([e,t])=>[t,e]));function Kn(e){if(!e||"..."===e||"000"===e)return[0,0];const t=e.match(/^([0-9A-Z])([0-9A-F]{2})$/i);if(!t)return[0,0];const[,a,n]=t;return[Wn[a.toUpperCase()]??0,parseInt(n,16)]}function $n(e,t){if(0===e&&0===t)return"...";return`${Hn[e]??"0"}${t.toString(16).toUpperCase().padStart(2,"0")}`}function qn(e){return 0===e||97===e||e<1||e>96?null:e+11}function Xn(e){const t=e-11;return Math.min(96,Math.max(1,t))}function Yn(e){if(!e||"object"!=typeof e)return!1;if(!e.output||"object"!=typeof e.output)return!1;const t=e.output,a="function"==typeof t.connect&&"function"==typeof t.disconnect&&"number"==typeof t.numberOfOutputs&&"function"!=typeof t.toDestination,n="function"==typeof e.toDestination;return a&&!n}const Qn=globalThis.BaseAudioContext||globalThis.AudioContext||globalThis.webkitAudioContext;let Zn=null;function Jn(){if(!Zn)throw new Error("[audio-context] AudioContext not initialized  ToneEngine must be created first");return Zn}function es(e){if(!e)throw new Error("[audio-context] getNativeContext called with null/undefined context");if(Qn&&e instanceof Qn)return e;let t=[e],a=new Set,n=0;for(;t.length>0&&n<50;){const e=t.shift();if(e&&!a.has(e)){if(a.add(e),n++,Qn&&e instanceof Qn)return e;e.rawContext&&t.push(e.rawContext),e._nativeAudioContext&&t.push(e._nativeAudioContext),e.nativeContext&&t.push(e.nativeContext),e.baseAudioContext&&t.push(e.baseAudioContext),e.context&&t.push(e.context),e._context&&t.push(e._context)}}return e}function ts(e){if(!e||"object"!=typeof e)return!1;if(!("function"==typeof e.connect&&"function"==typeof e.disconnect&&"number"==typeof e.numberOfInputs&&"number"==typeof e.numberOfOutputs&&void 0!==e.context))return!1;const t=e.constructor?.name||"",a=t.endsWith("Node")||"AudioNode"===t,n="function"==typeof e.toDestination||"function"==typeof e.toMaster;return a&&!n}function as(e){if(!e)return null;if(ts(e))return e;if(e.input&&ts(e.input))return e.input;if(e.output&&ts(e.output))return e.output;const t=[e._gainNode,e._node,e._input,e._output,e._nativeNode];for(const a of t)if(ts(a))return a;if(e.input&&"object"==typeof e.input&&!ts(e.input)){const t=[e.input._gainNode,e.input._node,e.input.input];for(const e of t)if(ts(e))return e}return null}const ns=/^([A-Ga-g])([#b]?)(-?\d+)$/,ss={C:0,D:2,E:4,F:5,G:7,A:9,B:11};function rs(e){if("number"==typeof e)return Math.max(0,Math.min(127,Math.round(12*Math.log2(e/440)+69)));const t=e.match(ns);if(!t)return 60;const[,a,n,s]=t,r=ss[a.toUpperCase()]??0,i="#"===n?1:"b"===n?-1:0,o=parseInt(s);return Math.max(0,Math.min(127,12*(o+1)+r+i))}function is(e){if("number"==typeof e)return e>=0&&e<=127&&Number.isInteger(e)?440*Math.pow(2,(e-69)/12):e;const t=rs(e);return 440*Math.pow(2,(t-69)/12)}function os(){return Zn?Zn.currentTime:0}function ls(e,t=120){if("number"==typeof e)return e;const a=e.match(/^(\d+)n$/);if(a){return 4/parseInt(a[1])*(60/t)}const n=parseFloat(e);return isNaN(n)?0:n}const cs="cutoff",us="cutoffHz",ds="resonance",ps="envMod",hs="envModPercent",ms="decay",fs="accent",gs="waveform",ys="pulseWidth",bs="pitchToPw",vs="subOscGain",xs="subOscBlend",ws="normalDecay",ks="accentDecay",Ss="softAttack",Ms="accentSoftAttack",Ns="passbandCompensation",Cs="resTracking",Es="filterInputDrive",Ps="filterSelect",_s="diodeCharacter",Ts="duffingAmount",As="filterFmDepth",Os="korgIbiasScale",Is="korgBite",Ds="korgClip",Fs="korgCrossmod",Rs="korgQSag",js="korgSharpness",Ls="lpBpMix",Bs="filterTracking",Vs="stageNLAmount",zs="ensembleAmount",Us="slideTime",Gs="lfoRate",Ws="lfoContour",Hs="lfoPitchDepth",Ks="lfoPwmDepth",$s="lfoFilterDepth",qs="lfoStiffDepth",Xs="chorusMix",Ys="phaserLfoRate",Qs="phaserLfoWidth",Zs="phaserFeedback",Js="phaserMix",er="delayTime",tr="delayFeedback",ar="delayTone",nr="delayMix",sr="delaySpread",rr="tuning",ir="volume",or="lfoWaveform",lr="chorusMode",cr="oversamplingOrder";class ur{name="DB303Synth";output;workletNode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;overdrive=null;overdriveGain=null;overdriveAmount=0;config={};audioContext;_disposed=!1;_initPromise;_resolveInit=null;_pendingParams=[];_releaseTimeout=null;constructor(){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{if(await ur.ensureInitialized(this.audioContext),this._disposed)return;this.createNode()}catch(e){}}static wasmBinary=null;static jsCode=null;static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}db303/DB303.worklet.js`)}catch(a){}if(!this.wasmBinary||!this.jsCode){const[e,a]=await Promise.all([fetch(`${t}db303/DB303.wasm`),fetch(`${t}db303/DB303.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar DB303 = createDB303Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}createNode(){if(this._disposed)return;const e=this.audioContext;if(this.workletNode=new AudioWorkletNode(e,"db303-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?this._resolveInit&&(this._resolveInit(),this._resolveInit=null):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:ur.wasmBinary,jsCode:ur.jsCode}),this._pendingParams.length>0){for(const{paramId:e,value:t}of this._pendingParams)this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t});this._pendingParams=[]}this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch(t){}}_savedSlideTime=.5;_currentSlideTime=.5;triggerAttack(e,t,a=1,n=!1,s=!1,r=!1){if(!this.workletNode||this._disposed)return;null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null);const i="string"==typeof e?rs(e):Math.round(12*Math.log2(e/440)+69);let o=Math.floor(127*a);if(n&&o<100&&(o=127),!n&&o>=100&&(o=99),"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=Math.floor(i/12)-1;e[i%12]}r&&(this._savedSlideTime=this._currentSlideTime,this.setSlideTime(0));const l=t??os();this.workletNode.port.postMessage({type:"noteOn",time:l,note:i,velocity:o,slide:s}),r&&setTimeout(()=>{this._disposed||this.setSlideTime(this._savedSlideTime)},50)}triggerRelease(e){if(!this.workletNode||this._disposed)return;const t=e??os();this.workletNode.port.postMessage({type:"gateOff",time:t})}releaseAll(){this.workletNode&&!this._disposed&&(null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode.port.postMessage({type:"allNotesOff"}))}noteOn(e,t,a,n){const s=is(e);this.triggerAttack(s,void 0,t/127,a,n,!1)}noteOff(){this.triggerRelease()}triggerAttackRelease(e,t,a,n,s=!1,r=!1,i=!1){if(this._disposed)return;const o=a??os();this.triggerAttack(e,o,n||1,s,r,i);const l=1e3*(o+ls(t)-os());null!==this._releaseTimeout&&clearTimeout(this._releaseTimeout),this._releaseTimeout=setTimeout(()=>{this._releaseTimeout=null,this._disposed||this.triggerRelease()},Math.max(0,l))}setParameterByName(e,t){if(!this._disposed){if(!this.workletNode){const a=this._pendingParams.findIndex(t=>t.paramId===e);return void(a>=0?this._pendingParams[a].value=t:this._pendingParams.push({paramId:e,value:t}))}this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}}setParam(e,t){switch(e){case"cutoff":this.setCutoff(t);break;case"cutoff_hz":this.setCutoffHz(t);break;case"resonance":this.setResonance(t);break;case"env_mod":this.setEnvMod(t);break;case"env_mod_percent":this.setEnvModPercent(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"waveform":this.setWaveform(t);break;case"pulse_width":this.setPulseWidth(t);break;case"pitch_to_pw":this.setPitchToPw(t);break;case"sub_osc_gain":this.setSubOscGain(t);break;case"sub_osc_blend":this.setSubOscBlend(t);break;case"normal_decay":this.setNormalDecay(t);break;case"accent_decay":this.setAccentDecay(t);break;case"soft_attack":this.setSoftAttack(t);break;case"accent_soft_attack":this.setAccentSoftAttack(t);break;case"passband_compensation":this.setPassbandCompensation(t);break;case"res_tracking":this.setResTracking(t);break;case"filter_input_drive":this.setFilterInputDrive(t);break;case"filter_select":this.setFilterSelect(t);break;case"diode_character":this.setDiodeCharacter(t);break;case"duffing_amount":this.setDuffingAmount(t);break;case"filter_fm_depth":this.setFilterFmDepth(t);break;case"korg_bite":this.setKorgBite(t);break;case"korg_clip":this.setKorgClip(t);break;case"korg_crossmod":this.setKorgCrossmod(t);break;case"korg_q_sag":this.setKorgQSag(t);break;case"korg_sharpness":this.setKorgSharpness(t);break;case"lp_bp_mix":this.setLpBpMix(t);break;case"filter_tracking":this.setFilterTracking(t);break;case"stage_nl_amount":this.setStageNLAmount(t);break;case"ensemble_amount":this.setEnsembleAmount(t);break;case"slide_time":this.setSlideTime(t);break;case"lfo_rate":this.setLfoRate(t);break;case"lfo_contour":this.setLfoContour(t);break;case"lfo_pitch_depth":this.setLfoPitchDepth(t);break;case"lfo_pwm_depth":this.setLfoPwmDepth(t);break;case"lfo_filter_depth":this.setLfoFilterDepth(t);break;case"lfo_stiff_depth":this.setLfoStiffDepth(t);break;case"chorus_mix":this.setChorusMix(t);break;case"phaser_rate":this.setPhaserRate(t);break;case"phaser_width":this.setPhaserWidth(t);break;case"phaser_feedback":this.setPhaserFeedback(t);break;case"phaser_mix":this.setPhaserMix(t);break;case"delay_time":this.setDelayTime(t);break;case"delay_feedback":this.setDelayFeedback(t);break;case"delay_tone":this.setDelayTone(t);break;case"delay_mix":this.setDelayMix(t);break;case"delay_spread":this.setDelaySpread(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"lfo_waveform":this.setLfoWaveform(t);break;case"chorus_mode":this.setChorusMode(t);break;case"oversampling_order":this.setOversamplingOrder(t)}}setCutoff(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(cs,t)}setResonance(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ds,t)}setEnvMod(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ps,t)}setDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ms,t)}setAccent(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(fs,t)}setAccentAmount(e){this.setAccent(e)}setSlideTime(e){const t=Math.max(0,Math.min(1,e));this._currentSlideTime=e,this.setParameterByName(Us,t)}setVolume(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ir,t)}setWaveform(e){this.setParameterByName(gs,e)}setTuning(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(rr,t)}setLfoWaveform(e){this.setParameterByName(or,e)}setLfoRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Gs,t)}setLfoContour(e){this.setParameterByName(Ws,e)}setLfoPitchDepth(e){this.setParameterByName(Hs,e)}setLfoPwmDepth(e){this.setParameterByName(Ks,e)}setLfoFilterDepth(e){this.setParameterByName($s,e)}setLfoStiffDepth(e){this.setParameterByName(qs,e)}setNormalDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ws,t)}setAccentDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ks,t)}setSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ss,t)}setAccentSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ms,t)}setPassbandCompensation(e){this.setParameterByName(Ns,e)}setFeedbackHighpass(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName("feedbackHighpass",t)}setResTracking(e){this.setParameterByName(Cs,e)}setFilterInputDrive(e){this.setParameterByName(Es,e)}setFilterSelect(e){this.setParameterByName(Ps,e)}setDiodeCharacter(e){this.setParameterByName(_s,e)}setDuffingAmount(e){let t;if(Math.abs(e)<.16)t=0;else{t=(e>0?1:-1)*(Math.abs(e)-.16)/.84}this.setParameterByName(Ts,t)}setFilterFmDepth(e){this.setParameterByName(As,e)}setLpBpMix(e){this.setParameterByName(Ls,e)}setFilterTracking(e){this.setParameterByName(Bs,e)}setKorgIbiasScale(e){this.setParameterByName(Os,e)}setKorgBite(e){this.setParameterByName(Is,e)}setKorgClip(e){this.setParameterByName(Ds,e)}setKorgCrossmod(e){this.setParameterByName(Fs,e)}setKorgQSag(e){this.setParameterByName(Rs,e)}setKorgSharpness(e){this.setParameterByName(js,e)}setPitchToPw(e){this.setParameterByName(bs,e)}setCutoffHz(e){this.setParameterByName(us,Math.max(10,Math.min(5e3,e)))}setEnvModPercent(e){this.setParameterByName(hs,Math.max(0,Math.min(300,e)))}setStageNLAmount(e){this.setParameterByName(Vs,e)}setEnsembleAmount(e){this.setParameterByName(zs,e)}setChorusMode(e){this.setParameterByName(lr,e)}setOversamplingOrder(e){this.setParameterByName(cr,e)}setPulseWidth(e){this.setParameterByName(ys,e)}setSubOscGain(e){this.setParameterByName(vs,e)}setSubOscBlend(e){this.setParameterByName(xs,e)}setChorusMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Xs,t)}setPhaserRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ys,t)}setPhaserWidth(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Qs,t)}setPhaserFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Zs,t)}setPhaserMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Js,t)}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(er,t)}setDelayFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(tr,t)}setDelayTone(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ar,t)}setDelayMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(nr,t)}setDelaySpread(e){this.setParameterByName(sr,e)}setOverdrive(e){if(this._disposed||!this.workletNode)return;this.overdriveAmount=Math.min(Math.max(e,0),100)/100;const t=this.audioContext.currentTime;if(this.overdriveAmount>0){this.overdrive&&this.overdriveGain||(this.overdriveGain=this.audioContext.createGain(),this.overdrive=this.audioContext.createWaveShaper());const e=new Float32Array(4096),n=1+8*this.overdriveAmount;for(let t=0;t<4096;t++){const a=t/4096*2-1;e[t]=Math.tanh(a*n)/Math.tanh(n)}this.overdrive.curve=e,this.overdriveGain.gain.linearRampToValueAtTime(1+2*this.overdriveAmount,t+.03);try{this.workletNode.disconnect(this.output)}catch(a){}try{this.workletNode.connect(this.overdriveGain),this.overdriveGain.connect(this.overdrive),this.overdrive.connect(this.output)}catch(a){}}else{if(this.overdrive&&this.overdriveGain){try{this.workletNode.disconnect(this.overdriveGain),this.overdriveGain.disconnect(this.overdrive),this.overdrive.disconnect(this.output)}catch(a){}this.overdriveGain.gain.linearRampToValueAtTime(1,t+.03)}try{this.workletNode.connect(this.output)}catch(a){}}}setVegDecay(e){}setVegSustain(e){}setFilterFM(e){this.setFilterFmDepth(e/100)}setMuffler(e){switch(e){case"soft":this.setOverdrive(15);break;case"hard":this.setOverdrive(45);break;case"dark":this.setOverdrive(30);break;case"mid":this.setOverdrive(25);break;case"bright":this.setOverdrive(35);break;default:this.setOverdrive(0)}}setSweepSpeed(e){}setHighResonanceEnabled(e){}setAccentSweepEnabled(e){}setChorusEnabled(e){e||this.setParameterByName(Xs,0)}setPhaserEnabled(e){e||this.setParameterByName(Js,0)}setPhaserDepth(e){this.setParameterByName(Qs,e)}setDelayEnabled(e){e||this.setParameterByName(nr,0)}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}enableDevilFish(e){}setHighResonance(e){}dispose(){this._disposed=!0,null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveGain&&(this.overdriveGain.disconnect(),this.overdriveGain=null),this.output.disconnect()}}const dr="vfx",pr="rsa",hr="swp30",mr={vfx:0,doc:1,rsa:2,swp30:3,segapcm:4,ga20:5,upd933:6};class fr{static instance;module=null;isInitialized=!1;heapU8=null;constructor(){}static getInstance(){return fr.instance||(fr.instance=new fr),fr.instance}async init(){if(this.isInitialized)return;const e="/DEViLBOX/";try{const t=await fetch(`${e}mame/MAMEChips.js`),a=await t.text(),n=new Function(`${a}; return MAMEChips;`)(),s=await fetch(`${e}mame/MAMEChips.wasm`),r=await s.arrayBuffer();this.module=await n({wasmBinary:r}),this.module.wasmMemory&&(this.heapU8=new Uint8Array(this.module.wasmMemory.buffer)),this.isInitialized=!0}catch(t){throw new Error(`MAMEChips WASM failed to load: ${t}`)}}createInstance(e,t){if(!this.isInitialized)return 0;const a=mr[e];return this.module._mame_create_instance(a,t)}deleteInstance(e){this.isInitialized&&0!==e&&this.module._mame_delete_instance(e)}write(e,t,a){this.isInitialized&&0!==e&&this.module._mame_write(e,t,a)}write16(e,t,a){this.isInitialized&&0!==e&&this.module._mame_write16(e,t,a)}read(e,t){return this.isInitialized&&0!==e?this.module._mame_read(e,t):0}setRom(e,t){if(!this.isInitialized||!this.heapU8)return;const a=this.module._malloc(t.length);this.heapU8.set(t,a),this.module._mame_set_rom(e,a,t.length)}addMidiEvent(e,t){if(!this.isInitialized||0===e||!this.heapU8)return;const a=this.module._malloc(t.length);this.heapU8.set(t,a),this.module._mame_add_midi_event(e,a,t.length),this.module._free(a)}rsaLoadRoms(e,t,a,n){if(!this.isInitialized||0===e||!this.heapU8)return;const s=this.module._malloc(t.length),r=this.module._malloc(a.length),i=this.module._malloc(n.length);this.heapU8.set(t,s),this.heapU8.set(a,r),this.heapU8.set(n,i),this.module._rsa_load_roms(e,s,r,i)}render(e,t=128){if(!this.isInitialized||0===e||!this.module.wasmMemory)return{left:new Float32Array(t),right:new Float32Array(t)};const a=this.module._malloc(4*t),n=this.module._malloc(4*t);this.module._mame_render(e,a,n,t);const s=this.module.wasmMemory.buffer,r=new Float32Array(s,a,t).slice(),i=new Float32Array(s,n,t).slice();return this.module._free(a),this.module._free(n),{left:r,right:i}}}class gr{name="MAMESynth";output;engine=fr.getInstance();config;isInitialized=!1;initInProgress=!1;handle=0;voices=[];numHardwareVoices=32;constructor(e){this.output=Jn().createGain(),this.config=e,"rsa"===e.type?this.numHardwareVoices=16:"swp30"===e.type&&(this.numHardwareVoices=64);for(let t=0;t<this.numHardwareVoices;t++)this.voices.push({note:"",active:!1,voiceIndex:t,startTime:0});this.initEngine()}async ensureInitialized(){if(!this.isInitialized)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.isInitialized&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.isInitialized){this.initInProgress=!0;try{await this.engine.init();let e=16e6;"rsa"===this.config.type?e=2e7:"swp30"===this.config.type&&(e=33868800);const t=this.config.clock||e;if(this.handle=this.engine.createInstance(this.config.type,t),this.config.roms)for(const a of this.config.roms)this.engine.setRom(a.bank,a.data);this.isInitialized=!0,"vfx"===this.config.type&&(this.engine.write(this.handle,88,31),this.engine.write(this.handle,96,1)),this.startRendering()}catch(e){}finally{this.initInProgress=!1}}}startRendering(){const e=Jn();if(!e||!e.createScriptProcessor)return;const t=e.createScriptProcessor(512,0,2);t.onaudioprocess=e=>{if(!this.isInitialized||0===this.handle)return;const t=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),{left:n,right:s}=this.engine.render(this.handle,512);t.set(n),a.set(s)},t.connect(this.output)}getHandle(){return this.handle}write(e,t){this.isInitialized&&0!==this.handle&&this.engine.write(this.handle,e,t)}write16(e,t){this.isInitialized&&0!==this.handle&&this.engine.write16(this.handle,e,t)}read(e){return this.isInitialized&&0!==this.handle?this.engine.read(this.handle,e):0}findFreeVoice(){const e=this.voices.find(e=>!e.active);return e||this.voices.sort((e,t)=>e.startTime-t.startTime)[0]}triggerAttack(e,t,a=1){if(!this.isInitialized||0===this.handle)return this;const n=is(e),s=this.findFreeVoice();s.note=e,s.active=!0,s.startTime=Date.now();const r=s.voiceIndex;if("vfx"===this.config.type){this.engine.write(this.handle,120,r),this.engine.write16(this.handle,0,1);const e=44100,t=Math.floor(2048*n*32/e);this.engine.write16(this.handle,8,65535&t),this.engine.write(this.handle,10,t>>16&255),this.engine.write16(this.handle,136,0),this.engine.write16(this.handle,144,8192);const s=Math.floor(65535*a);this.engine.write16(this.handle,16,s),this.engine.write16(this.handle,0,0)}else if("doc"===this.config.type){this.engine.write(this.handle,224,0),this.engine.write(this.handle,0+r,0);const e=Math.floor(65536*n/1e3);this.engine.write(this.handle,0+r,255&e),this.engine.write(this.handle,32+r,e>>8&255),this.engine.write(this.handle,64+r,Math.floor(255*a)),this.engine.write(this.handle,128+r,0)}else if("rsa"===this.config.type){const e=Math.floor(16384*n/32e3);for(let t=0;t<10;t++){const a=256*r+16*t;this.engine.write(this.handle,a+0,255&e),this.engine.write(this.handle,a+1,e>>8&255),this.engine.write(this.handle,a+5,127)}}else if("swp30"===this.config.type){const e=r<<6,t=Math.floor(1024*n/44100);this.engine.write16(this.handle,10|e,t)}return this}triggerRelease(e,t){if(!this.isInitialized||0===this.handle)return this;const a=this.voices.find(t=>t.active&&t.note===e);if(!a)return this;a.active=!1;const n=a.voiceIndex;if("vfx"===this.config.type)this.engine.write(this.handle,120,n),this.engine.write16(this.handle,0,1);else if("doc"===this.config.type)this.engine.write(this.handle,128+n,1);else if("rsa"===this.config.type)for(let s=0;s<10;s++){const e=256*n+16*s;this.engine.write(this.handle,e+5,255)}return this}dispose(){0!==this.handle&&(this.engine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const yr=new Map,br=new WeakMap;function vr(e,t){return e.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory')}const xr={VOLUME:0,ARPEGGIO:1,DUTY:2,WAVETABLE:3,PITCH:4,PANNING:5,PHASE_RESET:6,ALG:7,FB:8,FMS:9,AMS:10};const wr={numVoices:1,numOperators:0,hasFM:!1,hasAlgorithm:!1,hasFeedback:!1,hasVibrato:!1,hasTremolo:!1,hasPitchLFO:!1,hasAmpLFO:!1,hasWavetable:!1,hasPCM:!1,hasNoise:!1,hasADSR:!0,hasSSG:!1,hasPanning:!1,hasStereo:!1,hasDSP:!1,hasReverb:!1,sampleRAMSize:0},kr={AICA:{numVoices:64,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:2097152},SCSP:{numVoices:32,numOperators:4,hasFM:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:524288},C352:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},ES5503:{numVoices:32,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:65536},YMF271:{numVoices:12,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:4194304},YMOPQ:{numVoices:8,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasADSR:!0,hasPanning:!1,hasStereo:!1},K054539:{numVoices:8,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:8388608},ICS2115:{numVoices:32,hasWavetable:!0,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},RF5C400:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},SN76477:{numVoices:1,hasNoise:!0,hasVibrato:!0},TMS36XX:{numVoices:6,hasADSR:!1},TMS5220:{numVoices:1},MEA8000:{numVoices:1},Votrax:{numVoices:1},Astrocade:{numVoices:3,hasNoise:!0,hasVibrato:!0},SNKWave:{numVoices:3,hasWavetable:!0},SP0250:{numVoices:1},UPD931:{numVoices:1},UPD933:{numVoices:8,hasWavetable:!0,hasADSR:!0},TR707:{numVoices:15,hasPCM:!0,sampleRAMSize:32768},VASynth:{numVoices:16,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0},CEM3394:{numVoices:1,hasADSR:!0,hasVibrato:!0},ASC:{numVoices:4,hasWavetable:!0,hasStereo:!0}};function Sr(e){return{...wr,...kr[e]||{}}}const Mr=0,Nr=1,Cr=2,Er=3;class Pr{channelMemory=new Map;speed=6;bpm=125;constructor(){}getChannelMemory(e){return this.channelMemory.has(e)||this.channelMemory.set(e,{arpeggioX:0,arpeggioY:0,arpeggioTick:0,pitchSlideUp:0,pitchSlideDown:0,tonePortamento:0,tonePortamentoTarget:null,vibratoSpeed:0,vibratoDepth:0,vibratoPhase:0,vibratoWaveform:0,tremoloSpeed:0,tremoloDepth:0,tremoloPhase:0,tremoloWaveform:0,volumeSlide:0,currentVolume:64,currentPanning:128,currentPitch:440,currentPitchOffset:0,noteCutTick:-1,noteDelayTick:-1,retriggerTick:0,retriggerVolume:0,sampleOffset:0,loopStart:0,loopCount:0,loopRow:0}),this.channelMemory.get(e)}setSpeed(e){this.speed=Math.max(1,Math.min(31,e))}setBPM(e){this.bpm=Math.max(32,Math.min(255,e))}getSpeed(){return this.speed}getBPM(){return this.bpm}processTickZero(e,t,a,n,s){const r=this.getChannelMemory(t),i={positionJump:null,patternBreak:null,patternDelay:0};if(!e||e.length<3)return i;const o=e.charAt(0).toUpperCase(),l=parseInt(e.substring(1),16),c=l>>4&15,u=15&l;switch(a>0&&(r.currentPitch=a),o){case"0":l>0&&(r.arpeggioX=c,r.arpeggioY=u,r.arpeggioTick=0);break;case"1":l>0&&(r.pitchSlideUp=l);break;case"2":l>0&&(r.pitchSlideDown=l);break;case"3":l>0&&(r.tonePortamento=l),a>0&&(r.tonePortamentoTarget=a);break;case"4":c>0&&(r.vibratoSpeed=c),u>0&&(r.vibratoDepth=u);break;case"5":case"6":case"A":l>0&&(r.volumeSlide=l);break;case"7":c>0&&(r.tremoloSpeed=c),u>0&&(r.tremoloDepth=u);break;case"8":r.currentPanning=l,s.setPanning(l);break;case"9":l>0&&(r.sampleOffset=l),s.setSampleOffset(256*r.sampleOffset);break;case"B":i.positionJump=l;break;case"C":r.currentVolume=Math.min(l,64),s.setVolume(r.currentVolume);break;case"D":i.patternBreak=10*c+u;break;case"E":this.processExtendedTick0(l,t,n,s,i);break;case"F":0===l||(l<32?this.speed=l:this.bpm=l)}return i}processExtendedTick0(e,t,a,n,s){const r=this.getChannelMemory(t),i=15&e;switch(e>>4&15){case 1:r.currentPitchOffset+=4*i,n.setPitchOffset(r.currentPitchOffset);break;case 2:r.currentPitchOffset-=4*i,n.setPitchOffset(r.currentPitchOffset);break;case 3:case 5:break;case 4:r.vibratoWaveform=3&i;break;case 6:0===i?r.loopStart=a:0===r.loopCount?(r.loopCount=i,r.loopRow=r.loopStart):(r.loopCount--,r.loopCount>0&&(r.loopRow=r.loopStart));break;case 7:r.tremoloWaveform=3&i;break;case 8:r.currentPanning=17*i,n.setPanning(r.currentPanning);break;case 9:i>0&&(r.retriggerTick=i);break;case 10:r.currentVolume=Math.min(r.currentVolume+i,64),n.setVolume(r.currentVolume);break;case 11:r.currentVolume=Math.max(r.currentVolume-i,0),n.setVolume(r.currentVolume);break;case 12:r.noteCutTick=i,0===i&&n.cutNote();break;case 13:r.noteDelayTick=i;break;case 14:s.patternDelay=i}}processTickN(e,t,a,n){const s=this.getChannelMemory(t);if(!e)return;switch(e.charAt(0).toUpperCase()){case"0":this.processArpeggio(s,a,n);break;case"1":this.processPitchSlideUp(s,n);break;case"2":this.processPitchSlideDown(s,n);break;case"3":this.processTonePortamento(s,n);break;case"4":this.processVibrato(s,n);break;case"5":this.processTonePortamento(s,n),this.processVolumeSlide(s,n);break;case"6":this.processVibrato(s,n),this.processVolumeSlide(s,n);break;case"7":this.processTremolo(s,n);break;case"A":this.processVolumeSlide(s,n);break;case"E":this.processExtendedTickN(e,s,a,n)}}processExtendedTickN(e,t,a,n){switch(parseInt(e.substring(1),16)>>4&15){case 9:t.retriggerTick>0&&a%t.retriggerTick===0&&n.retriggerNote(t.currentVolume/64);break;case 12:a===t.noteCutTick&&n.cutNote()}}processArpeggio(e,t,a){if(0===e.arpeggioX&&0===e.arpeggioY)return;let n=0;switch(t%3){case 0:n=0;break;case 1:n=e.arpeggioX;break;case 2:n=e.arpeggioY}const s=e.currentPitch*Math.pow(2,n/12);a.setFrequency(s)}processPitchSlideUp(e,t){e.pitchSlideUp>0&&(e.currentPitchOffset+=4*e.pitchSlideUp,t.setPitchOffset(e.currentPitchOffset))}processPitchSlideDown(e,t){e.pitchSlideDown>0&&(e.currentPitchOffset-=4*e.pitchSlideDown,t.setPitchOffset(e.currentPitchOffset))}processTonePortamento(e,t){if(0===e.tonePortamento||null===e.tonePortamentoTarget)return;const a=e.tonePortamentoTarget-e.currentPitch,n=4*e.tonePortamento;Math.abs(a)<n?e.currentPitch=e.tonePortamentoTarget:e.currentPitch+=a>0?n:-n,t.setFrequency(e.currentPitch)}processVibrato(e,t){if(0===e.vibratoDepth)return;const a=4*this.calculateWaveformValue(e.vibratoWaveform,e.vibratoPhase,e.vibratoDepth);t.setPitchOffset(e.currentPitchOffset+a),e.vibratoPhase=e.vibratoPhase+e.vibratoSpeed&63}processTremolo(e,t){if(0===e.tremoloDepth)return;const a=this.calculateWaveformValue(e.tremoloWaveform,e.tremoloPhase,e.tremoloDepth),n=Math.round(a),s=Math.max(0,Math.min(64,e.currentVolume+n));t.setVolume(s),e.tremoloPhase=e.tremoloPhase+e.tremoloSpeed&63}processVolumeSlide(e,t){if(0===e.volumeSlide)return;const a=e.volumeSlide>>4&15,n=15&e.volumeSlide;a>0?e.currentVolume=Math.min(e.currentVolume+a,64):n>0&&(e.currentVolume=Math.max(e.currentVolume-n,0)),t.setVolume(e.currentVolume)}calculateWaveformValue(e,t,a){const n=t/64*Math.PI*2;switch(e){case Mr:return Math.sin(n)*a;case Nr:return((64-t)/32-1)*a;case Cr:return(t<32?1:-1)*a;case Er:return(2*Math.random()-1)*a;default:return 0}}hasNoteDelay(e){return!!e&&(e.toUpperCase().startsWith("ED")&&"ED0"!==e)}getNoteDelayTick(e){return e&&e.toUpperCase().startsWith("ED")&&parseInt(e.substring(2),16)||0}reset(){this.channelMemory.clear(),this.speed=6,this.bpm=125}resetChannel(e){const t=this.getChannelMemory(e);t.currentPitchOffset=0,t.arpeggioX=0,t.arpeggioY=0,t.arpeggioTick=0,t.pitchSlideUp=0,t.pitchSlideDown=0,t.tonePortamentoTarget=null,t.vibratoPhase=0,t.tremoloPhase=0,t.noteCutTick=-1,t.noteDelayTick=-1}}function _r(e,t){const a=t/64;return e*Math.pow(2,a/12)}function Tr(e){const t=function(e){return 69+12*Math.log2(e/440)}(e),a=Math.floor(t),n=t-a,s=Math.max(0,Math.min(127,a)),r=Math.round(64*n);return{kc:s,kf:Math.max(0,Math.min(63,r))}}class Ar{output;workletNode=null;_initPromise;_pendingCalls=[];_isReady=!1;_disposed=!1;capabilities;config={};currentNote=60;currentFreq=261.63;currentVelocity=1;isNoteOn=!1;noteOnTime=0;static MIN_GATE_TIME=50;macros=new Map;opMacros=[];effectRouter;channelIndex=0;basePitchOffset=0;effectPitchOffset=0;oscBuffer=null;oscCallbacks=new Set;constructor(){this.output=Jn().createGain(),this.effectRouter=new Pr,this.capabilities=Sr("default")}initSynth(){this.capabilities=Sr(this.chipName),this._initPromise=this.initialize(),this.capabilities.numOperators>0&&(this.opMacros=Array.from({length:this.capabilities.numOperators},()=>({})))}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=Jn(),{wasmBinary:t,jsCode:a}=await async function(e,t,a){const n="/DEViLBOX/";let s=br.get(e);if(s||(s=new Set,br.set(e,s)),!s.has("__mame_init_helper__")){try{await e.audioWorklet.addModule(`${n}mame/mame-worklet-init.js`)}catch(r){}s.add("__mame_init_helper__")}if(!s.has(t)){try{await e.audioWorklet.addModule(`${n}mame/${a}`)}catch(r){}s.add(t)}if(!yr.has(t)){const e=(async()=>{const[e,a]=await Promise.all([fetch(`${n}mame/${t}.wasm`),fetch(`${n}mame/${t}.js`)]);if(!e.ok)throw new Error(`Failed to load ${t}.wasm: ${e.status}`);if(!a.ok)throw new Error(`Failed to load ${t}.js: ${a.status}`);const[s,r]=await Promise.all([e.arrayBuffer(),a.text()]);return{wasmBinary:s,jsCode:vr(r,`${n}mame/`)}})();yr.set(t,e)}return yr.get(t)}(e,this.chipName,this.workletFile);if(this._disposed)return;const n=this.output,{workletNode:s,readyPromise:r}=function(e,t,a,n,s){const r=new AudioWorkletNode(e,t,{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),i=new Promise((e,a)=>{const n=setTimeout(()=>a(new Error(`${t} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=i=>{"ready"===i.data.type?(clearTimeout(n),e()):"error"===i.data.type&&(clearTimeout(n),a(new Error(i.data.message||`${t} init error`))),s&&s.call(r.port,i)}});r.port.postMessage({type:"init",wasmBinary:a,jsCode:n,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch(o){}return{workletNode:r,readyPromise:i}}(e,this.processorName,t,a,n);this.workletNode=s;const i=this.workletNode.port.onmessage;this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data),i&&i.call(this.workletNode.port,e)},await r}catch(e){}}handleWorkletMessage(e){switch(e.type){case"ready":this._isReady=!0;for(const e of this._pendingCalls)this.processPendingCall(e);this._pendingCalls=[];break;case"oscData":e.buffer&&(this.oscBuffer=new Float32Array(e.buffer),this.oscCallbacks.forEach(e=>e(this.oscBuffer)))}}processPendingCall(e){"setParam"===e.method&&this.setParam(e.args[0],e.args[1])}triggerAttack(e,t,a=1){this._disposed||(this.currentNote="string"==typeof e?function(e){const t=e.match(/^([A-Ga-g][#b]?)[-]?(\d)$/);if(!t)return 60;const a=t[1].toUpperCase(),n=parseInt(t[2]),s={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a];return void 0===s?60:12*(n+1)+s}(e):e>127?Math.round(12*Math.log2(e/440)+69):e,this.currentFreq=function(e){return 440*Math.pow(2,(e-69)/12)}(this.currentNote),this.currentVelocity=a,this.isNoteOn=!0,this.noteOnTime=Date.now(),this.resetMacros(),this.effectRouter.resetChannel(this.channelIndex),this.writeKeyOn(this.currentNote,a))}triggerRelease(e){if(this._disposed)return;const t=Date.now()-this.noteOnTime;t<Ar.MIN_GATE_TIME?setTimeout(()=>this.triggerRelease(e),Ar.MIN_GATE_TIME-t):(this.isNoteOn=!1,this.releaseMacros(),this.writeKeyOff())}triggerAttackRelease(e,t,a,n){if(this._disposed)return;this.triggerAttack(e,a,n||1);const s=ls(t);setTimeout(()=>{this._disposed||this.triggerRelease()},1e3*s)}releaseAll(){this.workletNode&&!this._disposed&&(this.workletNode.port.postMessage({type:"allNotesOff"}),this.isNoteOn=!1)}setFrequency(e){this.currentFreq=e,this.writeFrequency(e)}setPitchOffset(e){this.effectPitchOffset=e;const t=_r(this.currentFreq,this.basePitchOffset+e);this.writeFrequency(t)}setVolume(e){const t=e/64;this.writeVolume(t*this.currentVelocity)}setPanning(e){this.writePanning(e)}setSampleOffset(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setSampleOffset",offset:e})}retriggerNote(e){this.writeKeyOn(this.currentNote,e)}cutNote(){this.writeVolume(0),this.isNoteOn=!1}writeDuty(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:100,value:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"selectWavetable",index:e})}writePhaseReset(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"phaseReset"})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dr",value:t})}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"sl",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dt",value:t})}setMacro(e){const t={type:e.type,data:e.data,loop:e.loop??-1,release:e.release??-1,position:0,active:e.data.length>0,released:!1};this.macros.set(e.type,t)}setMacros(e){for(const t of e)this.setMacro(t)}clearMacros(){this.macros.clear()}resetMacros(){this.macros.forEach(e=>{e.position=0,e.released=!1});for(const e of this.opMacros)for(const t of Object.keys(e)){const a=e[t];a&&(a.position=0,a.released=!1)}}releaseMacros(){this.macros.forEach(e=>{e.released=!0,e.release>=0&&e.release<e.data.length&&(e.position=e.release)});for(const e of this.opMacros)for(const t of Object.keys(e)){const a=e[t];a&&(a.released=!0,a.release>=0&&a.release<a.data.length&&(a.position=a.release))}}processTick(e=os()){this.isNoteOn&&(this.macros.forEach((e,t)=>{if(!e.active||0===e.data.length)return;let a=e.position;a>=e.data.length&&(a=e.data.length-1);const n=e.data[a];this.applyMacroValue(t,n),a++,a>=e.data.length&&(a=e.loop>=0?e.loop:e.data.length-1),e.position=a}),this.processOperatorMacros())}applyMacroValue(e,t){switch(e){case xr.VOLUME:const e=t/127*this.currentVelocity;this.writeVolume(e);break;case xr.ARPEGGIO:const a=t>127?t-256:t,n=this.currentFreq*Math.pow(2,a/12);this.writeFrequency(n);break;case xr.DUTY:this.writeDuty(t);break;case xr.WAVETABLE:this.writeWavetableSelect(t);break;case xr.PITCH:const s=t>127?t-256:t;this.basePitchOffset=s;const r=_r(this.currentFreq,this.basePitchOffset+this.effectPitchOffset);this.writeFrequency(r);break;case xr.PANNING:const i=t>127?t-256:t;this.writePanning(128+i);break;case xr.PHASE_RESET:0!==t&&this.writePhaseReset();break;case xr.ALG:this.setFMAlgorithm(t);break;case xr.FB:this.setFMFeedback(t);break;case xr.FMS:this.setFMSensitivity(t);break;case xr.AMS:this.setAMSensitivity(t)}}processOperatorMacros(){for(let e=0;e<this.opMacros.length;e++){const t=this.opMacros[e];if(t){if(t.tl?.active){const a=this.advanceOpMacro(t.tl);this.setOperatorTL(e,a)}if(t.ar?.active){const a=this.advanceOpMacro(t.ar);this.setOperatorAR(e,a)}if(t.dr?.active){const a=this.advanceOpMacro(t.dr);this.setOperatorDR(e,a)}if(t.sl?.active){const a=this.advanceOpMacro(t.sl);this.setOperatorSL(e,a)}if(t.rr?.active){const a=this.advanceOpMacro(t.rr);this.setOperatorRR(e,a)}if(t.mult?.active){const a=this.advanceOpMacro(t.mult);this.setOperatorMult(e,a)}if(t.dt?.active){const a=this.advanceOpMacro(t.dt);this.setOperatorDetune(e,a)}}}}advanceOpMacro(e){if(!e.active||0===e.data.length)return 0;let t=e.position;t>=e.data.length&&(t=e.data.length-1);const a=e.data[t];return t++,t>=e.data.length&&(t=e.loop>=0?e.loop:e.data.length-1),e.position=t,a}setFMAlgorithm(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:200,value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:201,value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:202,value:e})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:203,value:e})}processEffectTick0(e,t,a){return this.effectRouter.processTickZero(e,this.channelIndex,t,a,this)}processEffectTickN(e,t){this.effectRouter.processTickN(e,this.channelIndex,t,this)}hasNoteDelay(e){return this.effectRouter.hasNoteDelay(e)}getNoteDelayTick(e){return this.effectRouter.getNoteDelayTick(e)}setChannelIndex(e){this.channelIndex=e}getOscData(){return this.oscBuffer}onOscData(e){return this.oscCallbacks.add(e),this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!0}),()=>{this.oscCallbacks.delete(e),0===this.oscCallbacks.size&&this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!1})}}setParam(e,t){this._isReady||this._pendingCalls.push({method:"setParam",args:[e,t]})}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r??0})}dispose(){this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.oscCallbacks.clear(),this.output.disconnect()}}class Or extends d{name="TapeSaturation";inputGain;saturation;toneFilter;outputGain;dryGain;wetGain;_drive;_tone;_wet;input;output;constructor(e={}){super(),this._drive=e.drive??.5,this._tone=e.tone??12e3,this._wet=e.wet??1,this.input=new p(1),this.output=new p(1),this.inputGain=new p(this.calculateInputGain(this._drive)),this.saturation=new h(this.createSaturationCurve(this._drive),4096),this.toneFilter=new m({type:"lowpass",frequency:this._tone,rolloff:-12,Q:.7}),this.outputGain=new p(this.calculateMakeupGain(this._drive)),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.input.connect(this.inputGain),this.inputGain.connect(this.saturation),this.saturation.connect(this.toneFilter),this.toneFilter.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output)}createSaturationCurve(e){const t=new Float32Array(4096),a=1+8*e;for(let n=0;n<4096;n++){const e=n/4096*2-1;t[n]=e>=0?.95*Math.tanh(e*a)+.02*e:Math.tanh(e*a*.85)}return t}calculateInputGain(e){return 1+2*e}calculateMakeupGain(e){return 1/(1+.5*e)}get drive(){return this._drive}set drive(e){this._drive=Math.max(0,Math.min(1,e)),this.inputGain.gain.value=this.calculateInputGain(this._drive),this.saturation.curve=this.createSaturationCurve(this._drive),this.outputGain.gain.value=this.calculateMakeupGain(this._drive)}get tone(){return this._tone}set tone(e){this._tone=Math.max(2e3,Math.min(2e4,e)),this.toneFilter.frequency.value=this._tone}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.inputGain.dispose(),this.saturation.dispose(),this.toneFilter.dispose(),this.outputGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this}}const Ir=2048;function Dr(e){const t=new Float32Array(Ir),a=new Float32Array(Ir);switch(e){case"sine":a[1]=1;break;case"saw":for(let e=1;e<1024;e++)a[e]=2/(e*Math.PI)*(e%2==0?1:-1);break;case"square":for(let e=1;e<1024;e+=2)a[e]=4/(e*Math.PI);break;case"triangle":for(let e=1;e<1024;e+=2)a[e]=8/(Math.PI*Math.PI*e*e)*((e-1)/2%2==0?1:-1)}return{real:t,imag:a}}function Fr(e){const t=new Float32Array(Ir),a=new Float32Array(Ir);for(let n=1;n<1024;n++)a[n]=2/(n*Math.PI)*Math.sin(n*Math.PI*e);return{real:t,imag:a}}function Rr(e,t,a){const n=new Float32Array(Ir),s=new Float32Array(Ir),r=[e,t,a],i=[100,150,200];for(let o=1;o<1024;o++){const e=100*o;let t=0;for(let a=0;a<r.length;a++){const n=Math.abs(e-r[a]);t+=Math.exp(-n*n/(2*i[a]*i[a]))}s[o]=t/(.5*o+1)}return{real:n,imag:s}}const jr=[{id:"basic-saw",name:"Saw",category:"Basic",frames:[Dr("saw")]},{id:"basic-square",name:"Square",category:"Basic",frames:[Dr("square")]},{id:"basic-triangle",name:"Triangle",category:"Basic",frames:[Dr("triangle")]},{id:"basic-sine",name:"Sine",category:"Basic",frames:[Dr("sine")]},{id:"analog-sweep",name:"Analog Sweep",category:"Analog",frames:[Dr("sine"),Dr("triangle"),Dr("saw"),Dr("square")]},{id:"pwm",name:"PWM",category:"Analog",frames:[Fr(.1),Fr(.25),Fr(.5),Fr(.75),Fr(.9)]},{id:"saw-stack",name:"Saw Stack",category:"Analog",frames:[Dr("saw"),(()=>{const e=Dr("saw");for(let t=1;t<1024;t++){const a=.1*Math.PI*t,n=Math.cos(a),s=Math.sin(a),r=e.real[t],i=e.imag[t];e.real[t]=r*n-i*s,e.imag[t]=r*s+i*n}return e})()]},{id:"digital-harmonics",name:"Digital",category:"Digital",frames:[(()=>{const e=new Float32Array(Ir),t=new Float32Array(Ir);for(let a=1;a<32;a+=2)t[a]=1/a;return{real:e,imag:t}})(),(()=>{const e=new Float32Array(Ir),t=new Float32Array(Ir);for(let a=2;a<32;a+=2)t[a]=1/a;return{real:e,imag:t}})()]},{id:"vocal-a",name:"Vocal A",category:"Vocal",frames:[Rr(800,1200,2800)]},{id:"vocal-morph",name:"Vocal Morph",category:"Vocal",frames:[Rr(300,2300,3e3),Rr(500,1800,2500),Rr(800,1200,2800),Rr(450,800,2500),Rr(300,600,2300)]},{id:"metallic",name:"Metallic",category:"FX",frames:[(()=>{const e=new Float32Array(Ir),t=new Float32Array(Ir);return[1,2.756,5.404,8.933,13.344].forEach((e,a)=>{const n=Math.round(e);n<1024&&(t[n]=1/(a+1))}),{real:e,imag:t}})()]}];function Lr(e,t){if(1===e.frames.length)return e.frames[0];const a=t*(e.frames.length-1),n=Math.floor(a),s=a-n;return n>=e.frames.length-1?e.frames[e.frames.length-1]:function(e,t,a){const n=new Float32Array(Ir),s=new Float32Array(Ir);for(let r=0;r<Ir;r++)n[r]=e.real[r]*(1-a)+t.real[r]*a,s[r]=e.imag[r]*(1-a)+t.imag[r]*a;return{real:n,imag:s}}(e.frames[n],e.frames[n+1],s)}class Br{name="WavetableSynth";output;voices=new Map;voicePool=[];config;audioContext;filter;outputGain;baseMorphPosition=0;constructor(e){this.config=e,this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.filter=this.audioContext.createBiquadFilter(),this.filter.type=e.filter.type,this.filter.frequency.value=e.filter.cutoff,this.filter.Q.value=e.filter.resonance/10,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=2,this.filter.connect(this.outputGain),this.outputGain.connect(this.output);for(let t=0;t<8;t++)this.voicePool.push(this.createVoice());this.baseMorphPosition=e.morphPosition/100}createVoice(){return new Vr(this.config,this.filter,this.audioContext)}getCurrentMorphPosition(){return Math.max(0,Math.min(1,this.baseMorphPosition))}triggerAttack(e,t,a=1){const n=t??os(),s="string"==typeof e?is(e):e,r="string"==typeof e?rs(e):Math.round(69+12*Math.log2(e/440));let i=this.voicePool.pop();if(!i){const e=this.voices.keys().next().value;void 0!==e&&(i=this.voices.get(e),this.voices.delete(e))}if(i){const e=this.getCurrentMorphPosition();if(i.setMorphPosition(e),i.triggerAttack(s,n,a),this.voices.set(r,i),0!==this.config.filter.envelopeAmount){const e=this.config.filter.cutoff,t=this.config.filter.envelopeAmount/100,a=Math.min(2e4,e+t*(2e4-e)),s=this.config.filterEnvelope.attack/1e3,r=this.config.filterEnvelope.decay/1e3,i=e+(a-e)*(this.config.filterEnvelope.sustain/100);this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(e,n),this.filter.frequency.linearRampToValueAtTime(a,n+s),this.filter.frequency.linearRampToValueAtTime(i,n+s+r)}}}triggerRelease(e,t){const a=t??os(),n="string"==typeof e?rs(e):Math.round(69+12*Math.log2(e/440)),s=this.voices.get(n);s&&(s.triggerRelease(a),this.voices.delete(n),setTimeout(()=>{this.voicePool.push(s)},this.config.envelope.release+100))}triggerAttackRelease(e,t,a,n=1){const s=a??os(),r="string"==typeof t?ls(t):t;this.triggerAttack(e,s,n),this.triggerRelease(e,s+r)}setMorphPosition(e){this.baseMorphPosition=Math.max(0,Math.min(1,e));const t=this.getCurrentMorphPosition();this.voices.forEach(e=>{e.setMorphPosition(t)})}setMorphLFORate(e){this.config.morphLFORate=e}setFilterCutoff(e){this.config.filter.cutoff=e,this.filter.frequency.value=e}setFilterResonance(e){this.config.filter.resonance=e,this.filter.Q.value=e/10}updateConfig(e){this.config={...this.config,...e},e.filter&&(e.filter.type&&(this.filter.type=e.filter.type),void 0!==e.filter.cutoff&&(this.filter.frequency.value=e.filter.cutoff),void 0!==e.filter.resonance&&(this.filter.Q.value=e.filter.resonance/10))}dispose(){this.voices.forEach(e=>e.dispose()),this.voicePool.forEach(e=>e.dispose()),this.filter.disconnect(),this.outputGain.disconnect(),this.output.disconnect()}}class Vr{oscillators=[];gains=[];panners=[];config;audioContext;attackTime;decayTime;sustainLevel;releaseTime;constructor(e,t,a){this.config=e,this.audioContext=a,this.attackTime=e.envelope.attack/1e3,this.decayTime=e.envelope.decay/1e3,this.sustainLevel=e.envelope.sustain/100,this.releaseTime=e.envelope.release/1e3;const n=e.unison.voices,s=e.unison.detune,r=e.unison.stereoSpread/100;for(let i=0;i<n;i++){let e=0;n>1&&(e=(i/(n-1)*2-1)*s);let o=0;n>1&&(o=(i/(n-1)*2-1)*r);const l=a.createOscillator();l.detune.value=e;const c=a.createGain();c.gain.value=0;const u=a.createStereoPanner();u.pan.value=o,l.connect(c),c.connect(u),u.connect(t),this.oscillators.push(l),this.gains.push(c),this.panners.push(u)}this.setMorphPosition(e.morphPosition/100)}setMorphPosition(e){const t=(a=this.config.wavetableId,jr.find(e=>e.id===a));var a;if(!t)return;const n=Lr(t,e),s=Math.min(32,n.imag.length),r=new Float32Array(s+1),i=new Float32Array(s+1);for(let l=1;l<s;l++)i[l+1-1]=n.imag[l];const o=this.audioContext.createPeriodicWave(r,i,{disableNormalization:!1});this.oscillators.forEach(e=>{e.setPeriodicWave(o)})}triggerAttack(e,t,a){this.oscillators.forEach(a=>{a.frequency.setValueAtTime(e,t),a.start(t)}),this.gains.forEach(e=>{const a=e.gain;a.cancelScheduledValues(t),a.setValueAtTime(0,t),a.linearRampToValueAtTime(1,t+this.attackTime),a.linearRampToValueAtTime(this.sustainLevel,t+this.attackTime+this.decayTime)})}triggerRelease(e){this.gains.forEach(t=>{const a=t.gain;a.cancelScheduledValues(e),a.setValueAtTime(a.value,e),a.linearRampToValueAtTime(0,e+this.releaseTime)});const t=e+this.releaseTime+.1;this.oscillators.forEach(e=>{e.stop(t)})}dispose(){this.oscillators.forEach(e=>{try{e.stop()}catch(t){}e.disconnect()}),this.gains.forEach(e=>e.disconnect()),this.panners.forEach(e=>e.disconnect())}}class zr{audioContext;workletNode=null;isInitialized=!1;currentModel=null;outputGain;static BUILT_IN_MODELS=[{name:"Ibanez TS9",fileName:"TS9_DriveKnob.json",type:"pedal"},{name:"Ibanez Mostortion Clone",fileName:"Ibanez_Mostortion_Clone_GainKnob.json",type:"pedal"},{name:"Mooer CaliMkIV",fileName:"Mooer_CaliMkIV_GainKnob.json",type:"pedal"},{name:"Boss MT2",fileName:"BossMT2_PedalHighGain.json",type:"pedal"},{name:"Pro Co RAT Distortion",fileName:"ProcoRatPedal_HighGain.json",type:"pedal"},{name:"MXR 78",fileName:"MXR78_pedal_DistKnob.json",type:"pedal"},{name:"Ibanez TS808",fileName:"Ibanez808TubeScreamer.json",type:"pedal"},{name:"RevvG3 Pedal",fileName:"RevvG3_Pedal_GainKnob.json",type:"pedal"},{name:"Jeckyl and Hyde Distortion",fileName:"Jeckyl_and_Hyde_Distortion_DriveKnob.json",type:"pedal"},{name:"Friedman BEOD Pedal",fileName:"Friedman_BEOD_Pedal_GainKnob.json",type:"pedal"},{name:"Blackstar HT40 Clean",fileName:"BlackstarHT40_AmpClean.json",type:"amp"},{name:"Mesa Mini Rec High Gain",fileName:"MesaMiniRec_HighGain_DirectOut.json",type:"amp"},{name:"Splawn OD High Gain",fileName:"Splawn_OD_FractalFM3_HighGain.json",type:"amp"},{name:"Ethos Lead Channel",fileName:"EthosLeadChan_GainKnob.json",type:"amp"},{name:"Princeton Amp Clean",fileName:"PrincetonAmp_Clean.json",type:"amp"},{name:"Dumble Kit High Gain",fileName:"DumbleKit_HighG_DirectOut.json",type:"amp"},{name:"Blackstar HT40 Gain",fileName:"BlackstarHT40_GainKnob_SM57mic.json",type:"amp"},{name:"T-Rex Mudhoney + Pork Loin",fileName:"TRexMudhoney_plus_PorkLoin_HighGain.json",type:"pedal"},{name:"Prince Of Tone OD",fileName:"PrinceOfToneClone_OD_Knob.json",type:"pedal"},{name:"Pork Loin Pedal",fileName:"PorkLoinPedal_LowGain.json",type:"pedal"},{name:"Prince Of Tone Dist",fileName:"PrinceOfToneClone_Dist_Knob.json",type:"pedal"},{name:"Aguilar Agro Bright Bass",fileName:"AguilarAgro_Bright_Bass.json",type:"bass"},{name:"Aguilar Agro Dark Bass",fileName:"AguilarAgro_Dark_Bass.json",type:"bass"},{name:"BadCat50 Med Gain",fileName:"BadCat50_MedGain_PREAMP.json",type:"amp"},{name:"ShiftTwin Clean2",fileName:"ShiftTwin_Clean2_PREAMP.json",type:"amp"},{name:"Sovtek50 Med Gain",fileName:"Sovtek50_MedGain_DIRECT.json",type:"amp"},{name:"ShiftTwin StampedeDT",fileName:"ShiftTwin_StampedeDT_PREAMP.json",type:"amp"},{name:"Sovtek50 Dod FX56B",fileName:"Sovtek50_DodFX56B_DIRECT.json",type:"amp"},{name:"ENGL E645 Clean",fileName:"ENGL_E645_Clean_EdoardoNapoli.json",type:"amp"},{name:"Filmosound with Cab",fileName:"Filmosound_with_cab.json",type:"amp"},{name:"ENGL E430 Clean",fileName:"ENGL_E430_Clean_EdoardoNapoli.json",type:"amp"},{name:"El Coyote Trainwreck",fileName:"ElCoyote_Trainwreck_Crunch.json",type:"amp"},{name:"Supro Bold Drive",fileName:"Supro_Bold_DriveKnob.json",type:"amp"},{name:"Goat Pedal High Gain",fileName:"GoatPedal_HighGain.json",type:"pedal"},{name:"Protein Blue Pedal",fileName:"ProteinBlue_pedal_DriveKnob.json",type:"pedal"},{name:"Little Big Muff",fileName:"LittleBigMuff_HighGainPedal.json",type:"pedal"},{name:"Big Muff V6",fileName:"BigMuff_V6_T3_S5.json",type:"pedal"}];constructor(e){this.audioContext=e,this.outputGain=e.createGain(),this.outputGain.gain.value=1}async initialize(){if(!this.isInitialized)try{const e="/DEViLBOX/";await this.audioContext.audioWorklet.addModule(`${e}GuitarML.worklet.js`),this.workletNode=new AudioWorkletNode(this.audioContext,"guitarml-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]}),this.workletNode.connect(this.outputGain),this.workletNode.port.onmessage=e=>this.handleWorkletMessage(e.data),this.isInitialized=!0}catch(e){throw e}}handleWorkletMessage(e){if("modelLoaded"===e.type)e.success}async loadModel(e){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");if(e<0||e>=zr.BUILT_IN_MODELS.length)throw new Error(`Invalid model index: ${e}`);const t=zr.BUILT_IN_MODELS[e];try{const e="/DEViLBOX/",a=await fetch(`${e}models/guitarml/${t.fileName}`);if(!a.ok)throw new Error(`Failed to fetch model: ${a.statusText}`);const n=await a.json();this.workletNode.port.postMessage({type:"loadModel",modelData:n}),this.currentModel=t}catch(a){throw a}}async loadModelFromURL(e,t){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");try{const a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch model: ${a.statusText}`);const n=await a.json();this.workletNode.port.postMessage({type:"loadModel",modelData:n}),this.currentModel={name:t,fileName:e,type:"pedal"}}catch(a){throw a}}setParameter(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setGain(e){this.setParameter("gain",e)}setCondition(e){this.setParameter("condition",e)}setDryWet(e){this.setParameter("dryWet",e)}setEnabled(e){this.setParameter("enabled",e?1:0)}setUseSRCFilter(e){this.setParameter("useSRCFilter",e?1:0)}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}connect(e){this.outputGain.connect(e)}disconnect(){this.outputGain.disconnect()}getInput(){if(!this.workletNode)throw new Error("GuitarML not initialized - call initialize() first");return this.workletNode}getOutput(){return this.outputGain}isReady(){return this.isInitialized}getCurrentModel(){return this.currentModel}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.outputGain.disconnect(),this.isInitialized=!1}}class Ur extends d{name="NeuralEffectWrapper";input;output;guitarML;_wet;dryGain;wetGain;modelIndex;neuralOutputGain;eq3;presenceFilter;constructor(e){super(),this.modelIndex=e.modelIndex,this._wet=e.wet??1;const t=es(this.context);this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.guitarML=new zr(t),this.neuralOutputGain=new p(1),this.eq3=new f({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500}),this.presenceFilter=new m({type:"highshelf",frequency:4e3,gain:0,Q:.7}),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.neuralOutputGain.connect(this.eq3),this.eq3.connect(this.presenceFilter),this.presenceFilter.connect(this.wetGain),this.wetGain.connect(this.output)}async loadModel(){await this.guitarML.initialize();const e=as(this.input),t=e?._nativeAudioNode||e;t&&t.connect(this.guitarML.getInput());const a=as(this.neuralOutputGain),n=a?._nativeAudioNode||a;n&&this.guitarML.getOutput().connect(n),await this.guitarML.loadModel(this.modelIndex)}setParameter(e,t){const a=Math.max(0,Math.min(100,t))/100;switch(e){case"drive":case"gain":case"condition":this.guitarML.setCondition(a);break;case"dryWet":this.guitarML.setDryWet(a);break;case"level":case"output":this.wetGain.gain.value=a*this._wet;break;case"tone":case"presence":this.presenceFilter.gain.value=20*(a-.5);break;case"bass":this.eq3.low.value=30*(a-.5);break;case"mid":this.eq3.mid.value=30*(a-.5);break;case"treble":this.eq3.high.value=30*(a-.5)}}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.guitarML.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.neuralOutputGain.dispose(),this.eq3.dispose(),this.presenceFilter.dispose(),this}}class Gr extends d{name="SpaceEcho";input;output;head1;head2;head3;head1Gain;head2Gain;head3Gain;feedbackGain;saturation;eq;reverb;reverbGain;echoGain;wowLFO;wowGain;dryGain;wetGain;_options;constructor(e={}){super(),this._options={mode:e.mode??4,rate:e.rate??300,intensity:e.intensity??.5,echoVolume:e.echoVolume??.8,reverbVolume:e.reverbVolume??.3,bass:e.bass??0,treble:e.treble??0,wow:e.wow??.15,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.head1=new g(this._options.rate/1e3),this.head2=new g(2*this._options.rate/1e3),this.head3=new g(3*this._options.rate/1e3),this.head1Gain=new p(0),this.head2Gain=new p(0),this.head3Gain=new p(0),this.reverb=new y({decay:2.5,preDelay:.01}),this.reverb.generate(),this.reverbGain=new p(this._options.reverbVolume),this.echoGain=new p(this._options.echoVolume),this.feedbackGain=new p(this._options.intensity),this.saturation=new b(.1),this.eq=new f({low:this._options.bass,mid:0,high:this._options.treble,lowFrequency:200,highFrequency:2500}),this.wowLFO=new v(.5+.2*Math.random(),-.002,.002),this.wowLFO.type="sine",this.wowGain=new p(this._options.wow),this.wowLFO.connect(this.wowGain),this.wowLFO.start(),this.wowGain.connect(this.head1.delayTime),this.wowGain.connect(this.head2.delayTime),this.wowGain.connect(this.head3.delayTime),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.head1),this.input.connect(this.head2),this.input.connect(this.head3),this.input.connect(this.reverb),this.head1.connect(this.head1Gain),this.head2.connect(this.head2Gain),this.head3.connect(this.head3Gain);const t=new p(1);this.head1Gain.connect(t),this.head2Gain.connect(t),this.head3Gain.connect(t),t.connect(this.echoGain),this.echoGain.connect(this.eq),this.eq.connect(this.saturation),this.saturation.connect(this.feedbackGain),this.feedbackGain.connect(this.head1),this.feedbackGain.connect(this.head2),this.feedbackGain.connect(this.head3),this.reverb.connect(this.reverbGain),this.eq.connect(this.wetGain),this.reverbGain.connect(this.wetGain),this.wetGain.connect(this.output),this.setMode(this._options.mode)}setMode(e){this._options.mode=e;const t=[1,5,8,10,11].includes(e),a=[2,4,6,8,9,11].includes(e),n=[3,4,7,9,10,11].includes(e);this.head1Gain.gain.rampTo(t?1:0,.1),this.head2Gain.gain.rampTo(a?1:0,.1),this.head3Gain.gain.rampTo(n?1:0,.1);const s=e>=5;this.reverbGain.gain.rampTo(s?this._options.reverbVolume:0,.1)}setRate(e){this._options.rate=e,this.head1.delayTime.rampTo(e/1e3,.1),this.head2.delayTime.rampTo(2*e/1e3,.1),this.head3.delayTime.rampTo(3*e/1e3,.1)}setIntensity(e){this._options.intensity=e,this.feedbackGain.gain.rampTo(e,.1)}setEchoVolume(e){this._options.echoVolume=e,this.echoGain.gain.rampTo(e,.1)}setReverbVolume(e){this._options.reverbVolume=e,this._options.mode>=5&&this.reverbGain.gain.rampTo(e,.1)}setBass(e){this._options.bass=e,this.eq.low.value=e}setTreble(e){this._options.treble=e,this.eq.high.value=e}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.head1.dispose(),this.head2.dispose(),this.head3.dispose(),this.head1Gain.dispose(),this.head2Gain.dispose(),this.head3Gain.dispose(),this.feedbackGain.dispose(),this.reverb.dispose(),this.reverbGain.dispose(),this.echoGain.dispose(),this.eq.dispose(),this.saturation.dispose(),this.wowLFO.dispose(),this.wowGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}let Wr=null,Hr=null,Kr=!1,$r=null;class qr extends d{name="SpaceyDelayer";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={firstTap:e.firstTap??250,tapSize:e.tapSize??150,feedback:Math.min(e.feedback??40,95),multiTap:e.multiTap??1,tapeFilter:e.tapeFilter??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=es(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await qr.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"spacey-delayer-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("firstTap",this._options.firstTap),this.sendParam("tapSize",this._options.tapSize),this.sendParam("feedback",this._options.feedback),this.sendParam("multiTap",this._options.multiTap),this.sendParam("tapeFilter",this._options.tapeFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Wr,jsCode:Hr}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!Kr){if($r)return $r;$r=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}spacey-delayer/SpaceyDelayer.worklet.js`)}catch(a){const e=a?.message||String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load SpaceyDelayer worklet: ${e}`)}if(!Wr||!Hr){const[e,a]=await Promise.all([fetch(`${t}spacey-delayer/SpaceyDelayer.wasm`),fetch(`${t}spacey-delayer/SpaceyDelayer.js`)]);if(!e.ok||!a.ok)throw $r=null,new Error(`Failed to fetch SpaceyDelayer WASM/JS: wasm=${e.status} js=${a.status}`);Wr=await e.arrayBuffer();let n=await a.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createSpaceyDelayer = createSpaceyDelayer || Module;",Hr=n}Kr=!0})();try{await $r}catch(t){throw $r=null,Kr=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setFirstTap(e){this._options.firstTap=Math.max(10,Math.min(e,2e3)),this.sendParam("firstTap",this._options.firstTap)}setTapSize(e){this._options.tapSize=Math.max(10,Math.min(e,1e3)),this.sendParam("tapSize",this._options.tapSize)}setFeedback(e){this._options.feedback=Math.max(0,Math.min(e,95)),this.sendParam("feedback",this._options.feedback)}setMultiTap(e){this._options.multiTap=e?1:0,this.sendParam("multiTap",e?1:0)}setTapeFilter(e){this._options.tapeFilter=e?1:0,this.sendParam("tapeFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}let Xr=null,Yr=null,Qr=!1,Zr=null;class Jr extends d{name="RETapeEcho";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={mode:Math.max(0,Math.min(e.mode??3,5)),repeatRate:Math.max(0,Math.min(e.repeatRate??.5,1)),intensity:Math.max(0,Math.min(e.intensity??.5,1)),echoVolume:Math.max(0,Math.min(e.echoVolume??.8,1)),wow:Math.max(0,Math.min(e.wow??0,1)),flutter:Math.max(0,Math.min(e.flutter??0,1)),dirt:Math.max(0,Math.min(e.dirt??0,1)),inputBleed:e.inputBleed??0,loopAmount:Math.max(0,Math.min(e.loopAmount??0,1)),playheadFilter:e.playheadFilter??1,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=es(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await Jr.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"re-tape-echo-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("mode",this._options.mode),this.sendParam("repeatRate",this._options.repeatRate),this.sendParam("intensity",this._options.intensity),this.sendParam("echoVolume",this._options.echoVolume),this.sendParam("wow",this._options.wow),this.sendParam("flutter",this._options.flutter),this.sendParam("dirt",this._options.dirt),this.sendParam("inputBleed",this._options.inputBleed),this.sendParam("loopAmount",this._options.loopAmount),this.sendParam("playheadFilter",this._options.playheadFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Xr,jsCode:Yr}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!Qr){if(Zr)return Zr;Zr=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}re-tape-echo/RETapeEcho.worklet.js`)}catch(a){const e=a?.message||String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load RETapeEcho worklet: ${e}`)}if(!Xr||!Yr){const[e,a]=await Promise.all([fetch(`${t}re-tape-echo/RETapeEcho.wasm`),fetch(`${t}re-tape-echo/RETapeEcho.js`)]);if(!e.ok||!a.ok)throw Zr=null,new Error(`Failed to fetch RETapeEcho WASM/JS: wasm=${e.status} js=${a.status}`);Xr=await e.arrayBuffer();let n=await a.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createRETapeEcho = createRETapeEcho || Module;",Yr=n}Qr=!0})();try{await Zr}catch(t){throw Zr=null,Qr=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setMode(e){this._options.mode=Math.max(0,Math.min(Math.round(e),5)),this.sendParam("mode",this._options.mode)}setRepeatRate(e){this._options.repeatRate=Math.max(0,Math.min(e,1)),this.sendParam("repeatRate",this._options.repeatRate)}setIntensity(e){this._options.intensity=Math.max(0,Math.min(e,1)),this.sendParam("intensity",this._options.intensity)}setEchoVolume(e){this._options.echoVolume=Math.max(0,Math.min(e,1)),this.sendParam("echoVolume",this._options.echoVolume)}setWow(e){this._options.wow=Math.max(0,Math.min(e,1)),this.sendParam("wow",this._options.wow)}setFlutter(e){this._options.flutter=Math.max(0,Math.min(e,1)),this.sendParam("flutter",this._options.flutter)}setDirt(e){this._options.dirt=Math.max(0,Math.min(e,1)),this.sendParam("dirt",this._options.dirt)}setInputBleed(e){this._options.inputBleed=e?1:0,this.sendParam("inputBleed",e?1:0)}setLoopAmount(e){this._options.loopAmount=Math.max(0,Math.min(e,1)),this.sendParam("loopAmount",this._options.loopAmount)}setPlayheadFilter(e){this._options.playheadFilter=e?1:0,this.sendParam("playheadFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class ei extends d{name="BiPhase";input;output;phaserA;phaserB;parallelInB;seriesInB;outputA;outputB;dryGain;wetGain;_options;constructor(e={}){super(),this._options={rateA:e.rateA??.5,depthA:e.depthA??.6,rateB:e.rateB??4,depthB:e.depthB??.4,feedback:e.feedback??.3,routing:e.routing??"parallel",wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.phaserA=new w({frequency:this._options.rateA,octaves:5*this._options.depthA,baseFrequency:350,stages:6,Q:20*this._options.feedback}),this.phaserB=new w({frequency:this._options.rateB,octaves:5*this._options.depthB,baseFrequency:450,stages:6,Q:20*this._options.feedback}),this.parallelInB=new p(0),this.seriesInB=new p(0),this.outputA=new p(1),this.outputB=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.phaserA),this.input.connect(this.parallelInB),this.parallelInB.connect(this.phaserB),this.phaserA.connect(this.seriesInB),this.seriesInB.connect(this.phaserB),this.phaserA.connect(this.outputA),this.outputA.connect(this.wetGain),this.phaserB.connect(this.outputB),this.outputB.connect(this.wetGain),this.wetGain.connect(this.output),this.setRouting(this._options.routing)}setRouting(e){this._options.routing=e,"parallel"===e?(this.parallelInB.gain.rampTo(1,.1),this.seriesInB.gain.rampTo(0,.1),this.outputA.gain.rampTo(1,.1),this.outputB.gain.rampTo(1,.1)):(this.parallelInB.gain.rampTo(0,.1),this.seriesInB.gain.rampTo(1,.1),this.outputA.gain.rampTo(0,.1),this.outputB.gain.rampTo(1,.1))}setRateA(e){this._options.rateA=e,this.phaserA.frequency.rampTo(e,.1)}setDepthA(e){this._options.depthA=e,this.phaserA.octaves=5*e}setRateB(e){this._options.rateB=e,this.phaserB.frequency.rampTo(e,.1)}setDepthB(e){this._options.depthB=e,this.phaserB.octaves=5*e}setFeedback(e){this._options.feedback=e;const t=20*e;this.phaserA.Q.value=t,this.phaserB.Q.value=t}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.phaserA.dispose(),this.phaserB.dispose(),this.parallelInB.dispose(),this.seriesInB.dispose(),this.outputA.dispose(),this.outputB.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}class ti extends d{name="DubFilter";input;output;filter;drive;gainNode;dryGain;wetGain;_options;constructor(e={}){super(),this._options={cutoff:e.cutoff??20,resonance:e.resonance??1,gain:e.gain??1,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.filter=new m({frequency:this._options.cutoff,type:"highpass",rolloff:-24,Q:this._options.resonance/100*20}),this.drive=new b({distortion:.1,wet:.5}),this.gainNode=new p(this._options.gain),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.filter),this.filter.connect(this.drive),this.drive.connect(this.gainNode),this.gainNode.connect(this.wetGain),this.wetGain.connect(this.output)}setCutoff(e){this._options.cutoff=e,this.filter.frequency.rampTo(e,.05)}setResonance(e){this._options.resonance=e;const t=e/100*20;this.filter.Q.rampTo(t,.1)}setGain(e){this._options.gain=e,this.gainNode.gain.rampTo(e,.1)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.filter.dispose(),this.drive.dispose(),this.gainNode.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const ai=0,ni=1;class si extends d{name="MoogFilter";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackFilter=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={cutoff:e.cutoff??1e3,resonance:e.resonance??.1,drive:e.drive??1,model:e.model??ai,filterMode:e.filterMode??ni,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setCutoff(e){this._options.cutoff=Math.max(20,Math.min(2e4,e)),this.sendParam(1,this._options.cutoff),this.fallbackFilter&&this.fallbackFilter.setCutoff(this._options.cutoff)}setResonance(e){this._options.resonance=Math.max(0,Math.min(1,e)),this.sendParam(2,this._options.resonance),this.fallbackFilter&&this.fallbackFilter.setResonance(this._options.resonance)}setDrive(e){this._options.drive=Math.max(.1,Math.min(4,e)),this.sendParam(3,this._options.drive)}setModel(e){this._options.model=e,this.sendParam(0,e)}setFilterMode(e){this._options.filterMode=e,this.sendParam(4,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await si.ensureInitialized(e),!si.wasmBinary||!si.jsCode)return;this.workletNode=new AudioWorkletNode(e,"moogfilters-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.model),this.sendParam(1,this._options.cutoff),this.sendParam(2,this._options.resonance),this.sendParam(3,this._options.drive),this.sendParam(4,this._options.filterMode),this.sendParam(5,1),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:si.wasmBinary,jsCode:si.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}moogfilters/MoogFilters.worklet.js`)}catch(a){}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}moogfilters/MoogFilters.wasm`),fetch(`${t}moogfilters/MoogFilters.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(n){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackFilter=new ri(e.sampleRate),this.fallbackFilter.setCutoff(this._options.cutoff),this.fallbackFilter.setResonance(this._options.resonance),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackFilter.process(t,a,n,s)};const t=this.input,a=this.wetGain,n=t._gainNode||t,s=a._gainNode||a,r=n._nativeAudioNode||n._node||n,i=s._nativeAudioNode||s._node||s;r.connect(this.fallbackNode),this.fallbackNode.connect(i),i.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const a=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;a.connect(this.workletNode),this.workletNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class ri{sampleRate;stateL=new Float64Array(5);delayL=new Float64Array(5);stateR=new Float64Array(5);delayR=new Float64Array(5);wc=0;g=0;gRes=0;gComp=1;drive=1;constructor(e){this.sampleRate=e,this.setCutoff(1e3),this.setResonance(.1)}setCutoff(e){this.wc=2*Math.PI*e/this.sampleRate,this.g=.9892*this.wc-.4342*this.wc**2+.1381*this.wc**3-.0202*this.wc**4,this.updateResonance()}setResonance(e){this._resonance=e,this.updateResonance()}_resonance=.1;updateResonance(){this.gRes=this._resonance*(1.0029+.0526*this.wc-.926*this.wc**2+.0218*this.wc**3)}process(e,t,a,n){const s=e.length,{stateL:r,delayL:i,stateR:o,delayR:l,g:c,gRes:u,gComp:d,drive:p}=this;for(let h=0;h<s;h++){r[0]=Math.tanh(p*(e[h]-4*u*(r[4]-d*e[h])));for(let e=0;e<4;e++)r[e+1]=ii(c*(.3/1.3*r[e]+1/1.3*i[e]-r[e+1])+r[e+1]),i[e]=r[e];a[h]=r[4],o[0]=Math.tanh(p*(t[h]-4*u*(o[4]-d*t[h])));for(let e=0;e<4;e++)o[e+1]=ii(c*(.3/1.3*o[e]+1/1.3*l[e]-o[e+1])+o[e+1]),l[e]=o[e];n[h]=o[4]}}}function ii(e){return Math.min(Math.max(e,-1e30),1e30)}class oi extends d{name="MVerb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={damping:e.damping??.5,density:e.density??.5,bandwidth:e.bandwidth??.5,decay:e.decay??.7,predelay:e.predelay??0,size:e.size??.8,gain:e.gain??1,mix:e.mix??.4,earlyMix:e.earlyMix??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setDamping(e){this._options.damping=li(e),this.sendParam(0,e)}setDensity(e){this._options.density=li(e),this.sendParam(1,e)}setBandwidth(e){this._options.bandwidth=li(e),this.sendParam(2,e)}setDecay(e){this._options.decay=li(e),this.sendParam(3,e)}setPredelay(e){this._options.predelay=li(e),this.sendParam(4,e)}setSize(e){this._options.size=li(e),this.sendParam(5,e)}setGain(e){this._options.gain=li(e),this.sendParam(6,e)}setMix(e){this._options.mix=li(e),this.sendParam(7,e)}setEarlyMix(e){this._options.earlyMix=li(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=li(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await oi.ensureInitialized(e),!oi.wasmBinary||!oi.jsCode)return;this.workletNode=new AudioWorkletNode(e,"mverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.damping),this.sendParam(1,this._options.density),this.sendParam(2,this._options.bandwidth),this.sendParam(3,this._options.decay),this.sendParam(4,this._options.predelay),this.sendParam(5,this._options.size),this.sendParam(6,this._options.gain),this.sendParam(7,1),this.sendParam(8,this._options.earlyMix),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:oi.wasmBinary,jsCode:oi.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}mverb/MVerb.worklet.js`)}catch(a){}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}mverb/MVerb.wasm`),fetch(`${t}mverb/MVerb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(n){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new ci(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,a,n,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const a=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;a.connect(this.workletNode),this.workletNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function li(e){return Math.max(0,Math.min(1,e))}class ci{combs;allpasses;constructor(e){const t=e/44100;this.combs=[new ui(Math.round(1116*t),.84),new ui(Math.round(1188*t),.84),new ui(Math.round(1277*t),.84),new ui(Math.round(1356*t),.84)],this.allpasses=[new di(Math.round(556*t),.5),new di(Math.round(441*t),.5)]}process(e,t,a,n){const s=e.length;for(let r=0;r<s;r++){const s=.5*(e[r]+t[r]);let i=0;for(const e of this.combs)i+=e.process(s);i*=.25;for(const e of this.allpasses)i=e.process(i);a[r]=i,n[r]=i}}}class ui{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index];return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,t}}class di{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index],a=-e+t;return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,a}}class pi extends d{name="Leslie";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackLeslie=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={speed:e.speed??0,hornRate:e.hornRate??6.8,drumRate:e.drumRate??5.9,hornDepth:e.hornDepth??.7,drumDepth:e.drumDepth??.5,doppler:e.doppler??.5,mix:e.mix??1,width:e.width??.8,acceleration:e.acceleration??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setSpeed(e){this._options.speed=hi(e),this.sendParam(0,e)}setHornRate(e){this._options.hornRate=Math.max(.1,Math.min(10,e)),this.sendParam(1,e)}setDrumRate(e){this._options.drumRate=Math.max(.1,Math.min(8,e)),this.sendParam(2,e)}setHornDepth(e){this._options.hornDepth=hi(e),this.sendParam(3,e)}setDrumDepth(e){this._options.drumDepth=hi(e),this.sendParam(4,e)}setDoppler(e){this._options.doppler=hi(e),this.sendParam(5,e)}setMix(e){this._options.mix=hi(e),this.sendParam(6,e)}setWidth(e){this._options.width=hi(e),this.sendParam(7,e)}setAcceleration(e){this._options.acceleration=hi(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=hi(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await pi.ensureInitialized(e),!pi.wasmBinary||!pi.jsCode)return;this.workletNode=new AudioWorkletNode(e,"leslie-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.speed),this.sendParam(1,this._options.hornRate),this.sendParam(2,this._options.drumRate),this.sendParam(3,this._options.hornDepth),this.sendParam(4,this._options.drumDepth),this.sendParam(5,this._options.doppler),this.sendParam(6,1),this.sendParam(7,this._options.width),this.sendParam(8,this._options.acceleration),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:pi.wasmBinary,jsCode:pi.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}leslie/Leslie.worklet.js`)}catch(a){}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}leslie/Leslie.wasm`),fetch(`${t}leslie/Leslie.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(n){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackLeslie=new mi(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackLeslie.process(t,a,n,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const a=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;a.connect(this.workletNode),this.workletNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function hi(e){return Math.max(0,Math.min(1,e))}class mi{phase=0;rate=6.8;sampleRate;constructor(e){this.sampleRate=e}process(e,t,a,n){const s=e.length;for(let r=0;r<s;r++){const s=Math.sin(2*this.phase*Math.PI),i=.7+.3*s;a[r]=e[r]*i,n[r]=t[r]*(.7-.3*s),this.phase+=this.rate/this.sampleRate,this.phase>=1&&(this.phase-=1)}}}class fi extends d{name="SpringReverb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={decay:e.decay??.6,damping:e.damping??.4,tension:e.tension??.5,mix:e.mix??.35,drip:e.drip??.5,diffusion:e.diffusion??.7,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setDecay(e){this._options.decay=gi(e),this.sendParam(0,e)}setDamping(e){this._options.damping=gi(e),this.sendParam(1,e)}setTension(e){this._options.tension=gi(e),this.sendParam(2,e)}setSpringMix(e){this._options.mix=gi(e),this.sendParam(3,e)}setDrip(e){this._options.drip=gi(e),this.sendParam(4,e)}setDiffusion(e){this._options.diffusion=gi(e),this.sendParam(5,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=gi(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await fi.ensureInitialized(e),!fi.wasmBinary||!fi.jsCode)return;this.workletNode=new AudioWorkletNode(e,"springreverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.decay),this.sendParam(1,this._options.damping),this.sendParam(2,this._options.tension),this.sendParam(3,1),this.sendParam(4,this._options.drip),this.sendParam(5,this._options.diffusion),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:fi.wasmBinary,jsCode:fi.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}springreverb/SpringReverb.worklet.js`)}catch(a){}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}springreverb/SpringReverb.wasm`),fetch(`${t}springreverb/SpringReverb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(n){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new yi(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,a,n,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const a=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;a.connect(this.workletNode),this.workletNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function gi(e){return Math.max(0,Math.min(1,e))}class yi{combs;constructor(e){const t=e/44100;this.combs=[{buffer:new Float32Array(Math.round(1116*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1188*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1277*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1356*t)),index:0,feedback:.8,lp:0}]}process(e,t,a,n){const s=e.length;for(let r=0;r<s;r++){const s=.5*(e[r]+t[r]);let i=0;for(const e of this.combs){const t=e.buffer[e.index];e.lp=t+.4*(e.lp-t),e.buffer[e.index]=s+e.lp*e.feedback,e.index=(e.index+1)%e.buffer.length,i+=t}i*=.25,a[r]=i,n[r]=i}}}const bi={"1/1":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3};function vi(e,t){return 6e4/e*bi[t]}const xi=[{value:"1/1",label:"1/1",category:"Straight"},{value:"1/2",label:"1/2",category:"Straight"},{value:"1/4",label:"1/4",category:"Straight"},{value:"1/8",label:"1/8",category:"Straight"},{value:"1/16",label:"1/16",category:"Straight"},{value:"1/32",label:"1/32",category:"Straight"},{value:"1/2d",label:"1/2.",category:"Dotted"},{value:"1/4d",label:"1/4.",category:"Dotted"},{value:"1/8d",label:"1/8.",category:"Dotted"},{value:"1/16d",label:"1/16.",category:"Dotted"},{value:"1/2t",label:"1/2T",category:"Triplet"},{value:"1/4t",label:"1/4T",category:"Triplet"},{value:"1/8t",label:"1/8T",category:"Triplet"}],wi={Delay:[{param:"time",unit:"seconds"}],FeedbackDelay:[{param:"time",unit:"seconds"}],PingPongDelay:[{param:"time",unit:"seconds"}],SpaceEcho:[{param:"rate",unit:"ms"}],SpaceyDelayer:[{param:"firstTap",unit:"ms"}],RETapeEcho:[{param:"repeatRate",unit:"normalized"}],Chorus:[{param:"frequency",unit:"hz"}],BiPhase:[{param:"rateA",unit:"hz"}]};function ki(e,t,a){switch(a){case"seconds":return function(e,t){return vi(e,t)/1e3}(e,t);case"ms":default:return vi(e,t);case"hz":return function(e,t){return 1e3/vi(e,t)}(e,t);case"normalized":return Math.min(1,Math.max(0,vi(e,t)/1e3))}}function Si(e){return 1===e.bpmSync}function Mi(e){const t=e.syncDivision;return t&&t in bi?t:"1/8"}class Ni extends d{name="SidechainCompressor";compressor;dryGain;wetGain;sidechainInput;sidechainGainNode;sidechainAnalyser;_threshold;_ratio;_attack;_release;_knee;_sidechainGain;_wet;animationFrame=null;baseThreshold;input;output;constructor(e={}){super(),this._threshold=e.threshold??-24,this._ratio=e.ratio??4,this._attack=e.attack??.003,this._release=e.release??.25,this._knee=e.knee??6,this._sidechainGain=e.sidechainGain??1,this._wet=e.wet??1,this.baseThreshold=this._threshold,this.input=new p(1),this.output=new p(1),this.compressor=new S({threshold:this._threshold,ratio:this._ratio,attack:this._attack,release:this._release,knee:this._knee}),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.sidechainInput=new p(1),this.sidechainGainNode=new p(this._sidechainGain),this.sidechainAnalyser=new M({smoothing:.8,normalRange:!1}),this.input.connect(this.compressor),this.compressor.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.sidechainInput.connect(this.sidechainGainNode),this.sidechainGainNode.connect(this.sidechainAnalyser),this.startSidechainPolling()}getSidechainInput(){return this.sidechainInput}startSidechainPolling=()=>{this.updateSidechain()};updateSidechain=()=>{const e=this.sidechainAnalyser.getValue(),t="number"==typeof e?e:e[0];if(t>-60){const e=24*Math.min(1,Math.max(0,(t+60)/60))*this._sidechainGain;this.compressor.threshold.value=this.baseThreshold-e}else this.compressor.threshold.value=this.baseThreshold;this.animationFrame=requestAnimationFrame(this.updateSidechain)};get threshold(){return this._threshold}set threshold(e){this._threshold=Math.max(-60,Math.min(0,e)),this.baseThreshold=this._threshold,this.compressor.threshold.value=this._threshold}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.max(1,Math.min(20,e)),this.compressor.ratio.value=this._ratio}get attack(){return this._attack}set attack(e){this._attack=Math.max(.001,Math.min(.5,e)),this.compressor.attack.value=this._attack}get release(){return this._release}set release(e){this._release=Math.max(.01,Math.min(1,e)),this.compressor.release.value=this._release}get knee(){return this._knee}set knee(e){this._knee=Math.max(0,Math.min(40,e)),this.compressor.knee.value=this._knee}get sidechainGain(){return this._sidechainGain}set sidechainGain(e){this._sidechainGain=Math.max(0,Math.min(2,e)),this.sidechainGainNode.gain.value=this._sidechainGain}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}getReduction(){return this.compressor.reduction}dispose(){return null!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),super.dispose(),this.compressor.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.sidechainInput.dispose(),this.sidechainGainNode.dispose(),this.sidechainAnalyser.dispose(),this}}class Ci{config;loop=null;currentStepIndex=0;pingPongDirection=1;baseNote="C4";baseVelocity=1;isPlaying=!1;heldNotes=new Set;onStep;onNoteOn;onNoteOff;currentPlayingNote=null;constructor(e){this.config={...e.config},this.onStep=e.onStep,this.onNoteOn=e.onNoteOn,this.onNoteOff=e.onNoteOff}getSteps(){return this.config.steps&&this.config.steps.length>0?this.config.steps:this.config.pattern&&this.config.pattern.length>0?this.config.pattern.map(e=>({noteOffset:e})):[{noteOffset:0}]}getInterval(){const{speed:e,speedUnit:t}=this.config,a=N().bpm.value;switch(t){case"hz":return 1/Math.max(1,Math.min(60,e));case"ticks":return 60/a*(e/48);case"division":return{1:"1n",2:"2n",4:"4n",8:"8n",16:"16n",32:"32n",64:"64n"}[e]||`${e}n`;default:return 1/15}}getSwingAdjustedTime(e,t){const a=(this.config.swing??0)/100;if(0===a)return e;if(t%2==0){return e+("number"==typeof this.getInterval()?this.getInterval():.066)*a*.5}return e}getNextStepIndex(){const e=this.getSteps().length;switch(this.config.mode){case"loop":default:return(this.currentStepIndex+1)%e;case"pingpong":let t=this.currentStepIndex+this.pingPongDirection;return t>=e?(this.pingPongDirection=-1,t=e-2):t<0&&(this.pingPongDirection=1,t=1),e<=2?(this.currentStepIndex+1)%e:Math.max(0,Math.min(e-1,t));case"oneshot":const a=this.currentStepIndex+1;return a>=e?(this.isPlaying=!1,e-1):a;case"random":return Math.floor(Math.random()*e)}}midiToNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}noteNameToMidi(e){const t=e.match(/^([A-Ga-g][#b]?)(-?\d+)$/);if(!t)return 60;const a=t[1].charAt(0).toUpperCase()+t[1].slice(1);return 12*(parseInt(t[2],10)+1)+({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a]??0)}processStep(e){if(!this.isPlaying)return;const t=this.getSteps()[this.currentStepIndex];if(!t)return;if("skip"===t.effect)return void(this.currentStepIndex=this.getNextStepIndex());const a=this.noteNameToMidi(this.baseNote)+t.noteOffset,n=this.midiToNoteName(a),s=(t.volume??100)/100,r="accent"===t.effect?1.2:1,i=Math.min(1,this.baseVelocity*s*r),o=(t.gate??100)/100,l=("number"==typeof this.getInterval()?this.getInterval():C(this.getInterval()).toSeconds())*o*.95;this.currentPlayingNote&&this.onNoteOff&&this.onNoteOff(this.currentPlayingNote),this.onNoteOn&&this.onNoteOn(n,i,l),this.currentPlayingNote=n,this.onStep&&this.onStep(this.currentStepIndex,t,t.noteOffset),this.currentStepIndex=this.getNextStepIndex()}start(e,t=1){if(this.isPlaying)return this.baseNote=e,this.baseVelocity=t,void this.heldNotes.add(e);this.baseNote=e,this.baseVelocity=t,this.currentStepIndex=0,this.pingPongDirection=1,this.isPlaying=!0,this.heldNotes.add(e);const a=this.getInterval();this.loop=new E(e=>{this.processStep(e)},a),this.loop.start(0)}stop(e){if(e){if(this.heldNotes.delete(e),this.heldNotes.size>0){const e=Array.from(this.heldNotes)[this.heldNotes.size-1];return void(this.baseNote=e)}}else this.heldNotes.clear();this.currentPlayingNote&&this.onNoteOff&&(this.onNoteOff(this.currentPlayingNote),this.currentPlayingNote=null),this.loop&&(this.loop.stop(),this.loop.dispose(),this.loop=null),this.isPlaying=!1,this.currentStepIndex=0,this.pingPongDirection=1}stopAll(){this.heldNotes.clear(),this.stop()}updateConfig(e){if(this.config={...this.config,...e},this.loop&&this.isPlaying){const e=this.getInterval();this.loop.interval=e}"oneshot"===e.mode&&(this.currentStepIndex=0)}getCurrentStep(){return this.currentStepIndex}getIsPlaying(){return this.isPlaying}getConfig(){return{...this.config}}dispose(){this.stopAll(),this.loop&&(this.loop.dispose(),this.loop=null)}}const Ei={OPN2:0,OPM:1,OPL3:2,OPLL:11,OPNA:13,OPNB:14,OPZ:22,Y8950:23,OPL4:26,OPN:47,OPNB_B:48,ESFM:49,PSG:3,AY:12,SAA:18,T6W28:43,AY8930:50,NES:4,GB:5,SNES:24,FDS:16,MMC5:17,VRC6:9,N163:8,VB:44,NDS:51,GBA_DMA:52,GBA_MINMOD:53,POKEMINI:54,PCE:6,SCC:7,SWAN:19,SM8521:37,BUBBLE:38,X1_010:41,NAMCO:55,SID:10,SID_6581:45,SID_8580:46,VIC:33,TED:34,PET:56,TIA:15,POKEY:57,LYNX:25,OKI:20,ES5506:21,SEGAPCM:27,YMZ280B:28,RF5C68:29,GA20:30,C140:31,QSOUND:32,K007232:39,K053260:40,MSM6258:58,MSM5232:59,MULTIPCM:60,AMIGA:61,VERA:36,SUPERVISION:35,UPD1771:42,PCSPKR:62,PONG:63,PV1000:64,DAVE:65,SU:66,BIFURCATOR:67,POWERNOISE:68,ZXBEEPER:69,ZXBEEPER_QT:70,SCVTONE:71,PCMDAC:72},Pi="__FurnaceChipEngineInstance__";class _i{static instance=null;static instanceId=0;myInstanceId;isLoaded=!1;initPromise=null;initFailedPermanently=!1;workletNode=null;lastInitAttempt=0;writeCount=0;nativeContext=null;rawContext=null;outputGain=null;constructor(){this.myInstanceId=++_i.instanceId}static getInstance(){const e=globalThis[Pi];return e?(_i.instance!==e&&(_i.instance=e),e):(_i.instance||(_i.instance=new _i,globalThis[Pi]=_i.instance),_i.instance)}async init(e){if(this.isLoaded)return;if(this.initFailedPermanently)return;if(this.initPromise)return this.initPromise;const t=Date.now();return t-this.lastInitAttempt<500?void 0:(this.lastInitAttempt=t,this.initPromise=this.doInit(e),this.initPromise)}async doInit(e){try{const s=e,r=s.rawContext||s._context||e,i=es(e);if(!r||!r.audioWorklet)return void(this.initPromise=null);if("running"!==r.state){try{await r.resume()}catch{}if("running"!==r.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===r.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const o="/DEViLBOX/",l=`?v=${Date.now()}`,c=i instanceof AudioContext?i:r,u=`${o}FurnaceChips.worklet.js${l}`;try{await c.audioWorklet.addModule(u)}catch(t){if(!t?.message?.includes("already")&&"InvalidStateError"!==t?.name)return void(this.initPromise=null)}const d=`${o}FurnaceChips.wasm${l}`,p=`${o}FurnaceChips.js${l}`,[h,m]=await Promise.all([fetch(d,{cache:"no-store"}),fetch(p,{cache:"no-store"})]);if(!h.ok)return void(this.initPromise=null);if(!m.ok)return void(this.initPromise=null);const f=await h.arrayBuffer();let g=await m.text();g='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+g.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');try{this.nativeContext=i,this.workletNode=new AudioWorkletNode(c,"furnace-chips-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode}catch(t){return void(this.initPromise=null)}const y=new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4),a=n=>{"initialized"===n.data.type&&(clearTimeout(t),this.workletNode?.port.removeEventListener("message",a),e(!0))};this.workletNode.port.addEventListener("message",a),this.workletNode.port.start()});this.workletNode&&this.workletNode.port.postMessage({type:"init",wasmBinary:f,jsCode:g});if(await y){this.isLoaded=!0,this.rawContext=c;try{const e=c.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(c.destination),this.outputGain=e}catch(a){try{if(i&&i.destination){const e=i.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(i.destination),this.outputGain=e}}catch(n){}}this.workletNode.port.addEventListener("message",e=>{"debug"===e.data.type?e.data.msgType:e.data.type}),setTimeout(()=>{this.requestWorkletStatus()},500)}else this.initPromise=null}catch(t){this.initPromise=null}}write(e,t,a){if(this.writeCount,!this.workletNode)return this.writeCount,void this.writeCount++;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(()=>{});const n={type:"write",chipType:e,register:t,value:a,writeId:this.writeCount};this.workletNode.port.postMessage(n);const s=8===t||40===t||t>=160&&t<=167;if(this.writeCount<10||s){this.nativeContext}this.writeCount++}getDiagnostics(){return{loaded:this.isLoaded,hasWorklet:null!==this.workletNode,contextState:this.nativeContext?.state||null}}requestWorkletStatus(){this.workletNode&&this.workletNode.port.postMessage({type:"getStatus"})}testPing(){this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now()})}testWrite(){this.workletNode&&this.workletNode.port.postMessage({type:"write",chipType:0,register:255,value:170,writeId:-1})}getNativeOutput(){return this.outputGain}getWorkletDiagnostics(){const e=null!==this.workletNode,t=null!==this.workletNode?.port;return{hasNode:e,hasPort:t,portId:t?`port-inst-${this.myInstanceId}`:"none"}}resetWriteCount(){this.writeCount=0;this.rawContext;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(e=>{}),this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now(),label:"post-reset"})}setWavetable(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",chipType:e,index:t,data:a})}setLogging(e){this.workletNode&&this.workletNode.port.postMessage({type:"setLogging",enabled:e})}async getLog(){return this.workletNode?new Promise(e=>{const t=a=>{"logData"===a.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(a.data.data))};this.workletNode?.port.addEventListener("message",t),this.workletNode?.port.postMessage({type:"getLog"})}):new Uint8Array(0)}getOutput(){if(!this.workletNode)throw new Error("Engine not initialized");return this.workletNode}setOutputGain(e){this.outputGain&&this.outputGain.gain.setValueAtTime(e,this.rawContext?.currentTime||0)}getOutputGainValue(){return this.outputGain?.gain.value??1}isInitialized(){return this.isLoaded&&null!==this.workletNode}deactivate(e){this.workletNode&&this.workletNode.port.postMessage({type:"deactivate",chipType:e})}}const Ti=[{id:"32x16FunkyLead",name:"Funky Lead",category:"32x16",len:32,max:15,data:[8,15,14,11,9,6,4,4,6,7,6,4,3,3,4,6,8,9,11,12,12,11,9,8,9,11,11,9,6,4,1,0]},{id:"32x16NamcoBass",name:"Namco Bass",category:"32x16",len:32,max:15,data:[7,10,12,13,14,13,12,10,7,4,2,1,0,1,2,4,7,11,13,14,13,11,7,3,1,0,1,3,7,14,7,0]},{id:"32x16ataribass",name:"Atari Bass",category:"32x16",len:32,max:15,data:[15,15,0,0,15,15,0,0,0,0,15,15,15,15,0,0,15,15,15,15,15,15,0,0,0,0,0,0,0,0,0,0]},{id:"32x16brass",name:"Brass",category:"32x16",len:32,max:15,data:[15,14,13,12,11,8,6,2,4,3,7,9,9,7,5,0,15,15,13,13,13,11,11,8,8,0,0,0,0,0,0,0]},{id:"32x16clarinet",name:"Clarinet",category:"32x16",len:32,max:15,data:[12,14,15,15,15,15,15,15,15,15,15,15,15,15,14,12,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,3]},{id:"32x16distortedsquare",name:"Distorted Square",category:"32x16",len:32,max:15,data:[14,12,10,11,14,9,10,13,9,14,10,15,13,7,14,6,5,1,6,0,3,2,4,5,0,3,2,4,2,3,6,1]},{id:"32x16eguitar",name:"E-Guitar",category:"32x16",len:32,max:15,data:[0,12,9,6,13,2,9,12,4,3,4,12,10,8,8,1,2,0,9,10,10,12,0,0,5,3,0,15,0,0,10,10]},{id:"32x16flute",name:"Flute",category:"32x16",len:32,max:15,data:[12,14,15,15,14,14,14,15,13,14,15,15,14,13,11,9,6,4,2,0,0,2,2,2,1,1,1,1,0,1,2,4]},{id:"32x16guitar",name:"Guitar",category:"32x16",len:32,max:15,data:[9,15,15,14,15,15,15,15,15,15,15,13,5,1,1,3,7,7,5,4,2,1,0,4,8,7,4,1,2,3,5,6]},{id:"32x16opllpiano",name:"OPLL Piano",category:"32x16",len:32,max:15,data:[7,13,15,15,15,15,14,11,10,12,15,14,8,3,2,4,7,11,13,13,10,4,0,2,5,5,3,1,0,0,0,1]},{id:"32x16opllvibra",name:"OPLL Vibraphone",category:"32x16",len:32,max:15,data:[5,14,12,9,8,15,15,15,14,15,12,13,15,15,11,4,7,11,9,1,0,2,4,1,1,0,0,0,4,7,4,1]},{id:"32x16reedorgan",name:"Reed Organ",category:"32x16",len:32,max:15,data:[8,12,10,11,10,12,12,13,12,15,14,13,12,13,13,9,6,2,2,3,2,1,0,3,2,3,3,5,4,5,3,7]},{id:"32x16saw",name:"Saw",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]},{id:"32x16saw2",name:"Saw 2",category:"32x16",len:32,max:15,data:[15,14,13,12,11,10,9,8,15,14,13,12,11,10,9,8,12,14,12,10,8,6,5,4,3,3,2,2,1,1,0,0]},{id:"32x16sax",name:"Sax",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,0,15,10,11,12,13,14,15,15]},{id:"32x16slapbass",name:"Slap Bass",category:"32x16",len:32,max:15,data:[8,13,15,15,13,11,8,7,6,8,10,14,15,12,4,0,8,15,12,3,0,2,5,8,9,9,7,5,2,0,0,3]},{id:"32x16synthbass",name:"Synth Bass",category:"32x16",len:32,max:15,data:[10,9,9,8,5,7,7,5,4,4,5,7,8,9,10,10,10,9,7,6,8,10,12,12,12,11,8,4,3,2,3,1]},{id:"32x16synthbrass",name:"Synth Brass",category:"32x16",len:32,max:15,data:[2,15,5,0,0,9,15,13,11,9,12,14,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x16trumpet",name:"Trumpet",category:"32x16",len:32,max:15,data:[7,15,13,12,10,10,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,6,5,5,3,2,0,0]},{id:"32x16voice",name:"Voice",category:"32x16",len:32,max:15,data:[7,8,9,10,10,11,11,12,12,12,12,12,12,12,12,12,11,11,10,10,9,8,7,2,1,0,0,0,0,0,1,2]},{id:"32x32KeygenBass",name:"Keygen Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,25,27,29,30,31,31,31,31,31,31,31,31,31]},{id:"32x32accordion",name:"Accordion",category:"32x32",len:32,max:31,data:[0,8,1,13,20,23,20,17,23,17,9,9,18,17,16,26,31,26,27,24,20,14,5,12,10,18,11,15,21,12,5,11]},{id:"32x32accordion2",name:"Accordion 2",category:"32x32",len:32,max:31,data:[16,17,21,22,22,22,20,19,13,12,11,10,10,13,15,17,27,27,31,31,31,29,25,23,9,7,3,1,0,2,4,6]},{id:"32x32acousticguitar",name:"Acoustic Guitar",category:"32x32",len:32,max:31,data:[2,18,26,28,29,28,28,28,29,31,31,27,14,2,1,0,1,2,2,0,1,1,1,1,1,1,1,0,0,0,0,0]},{id:"32x32agogo",name:"Agogo",category:"32x32",len:32,max:31,data:[16,8,6,31,13,16,16,14,25,21,8,12,28,18,18,12,16,16,23,0,13,16,20,16,6,12,18,17,8,15,15,26]},{id:"32x32ataribass",name:"Atari Bass",category:"32x32",len:32,max:31,data:[31,31,31,31,31,31,31,31,0,0,0,0,0,0,0,0,31,31,31,0,0,0,31,31,31,31,31,0,0,0,0,0]},{id:"32x32bass2",name:"Bass 2",category:"32x32",len:32,max:31,data:[15,25,31,31,26,18,12,7,4,3,3,3,4,6,8,12,15,19,23,26,28,29,29,29,28,26,22,16,8,2,0,5]},{id:"32x32bass3",name:"Bass 3",category:"32x32",len:32,max:31,data:[15,15,12,7,2,0,2,7,15,24,29,31,29,24,19,16,15,16,17,18,17,17,16,15,15,15,15,14,14,13,14,15]},{id:"32x32bell",name:"Bell",category:"32x32",len:32,max:31,data:[16,31,30,16,26,25,13,28,31,15,0,0,8,4,10,26,13,4,20,30,29,30,30,19,1,9,23,9,5,11,0,0]},{id:"32x32brass",name:"Brass",category:"32x32",len:32,max:31,data:[31,31,29,27,25,23,21,19,16,14,12,10,8,6,4,2,28,26,23,21,19,17,14,12,22,20,17,15,13,11,9,6]},{id:"32x32brass2",name:"Brass 2",category:"32x32",len:32,max:31,data:[16,18,21,24,27,29,30,31,31,31,30,29,27,24,21,18,0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29]},{id:"32x32chime",name:"Chime",category:"32x32",len:32,max:31,data:[15,27,23,17,23,27,21,15,23,30,26,17,21,23,15,6,15,24,15,7,9,13,4,0,7,15,9,3,7,13,7,3]},{id:"32x32choir",name:"Choir",category:"32x32",len:32,max:31,data:[0,3,8,13,22,26,30,31,31,30,28,24,20,18,17,16,15,15,15,15,16,16,16,16,15,14,12,10,8,5,2,0]},{id:"32x32clarinet",name:"Clarinet",category:"32x32",len:32,max:31,data:[20,31,29,26,26,28,30,31,31,30,28,26,25,27,30,31,15,0,4,6,6,4,2,0,0,1,3,5,6,6,2,2]},{id:"32x32clarinet2",name:"Clarinet 2",category:"32x32",len:32,max:31,data:[21,27,30,28,24,22,24,26,24,22,19,18,19,26,23,19,12,6,0,1,4,8,7,5,7,10,13,11,9,7,5,10]},{id:"32x32distortedpulse",name:"Distorted Pulse",category:"32x32",len:32,max:31,data:[31,31,31,31,0,0,0,0,16,16,16,16,0,0,0,0,8,8,8,8,0,0,0,0,3,3,3,3,0,0,0,0]},{id:"32x32distortedpulse2",name:"Distorted Pulse 2",category:"32x32",len:32,max:31,data:[3,25,13,15,18,16,17,15,15,15,17,15,12,11,6,15,27,0,13,15,18,3,8,15,15,20,17,15,12,31,29,15]},{id:"32x32distortedsaw",name:"Distorted Saw",category:"32x32",len:32,max:31,data:[0,7,10,10,14,14,17,17,21,21,25,25,27,27,29,29,29,29,31,31,31,31,31,5,8,11,14,16,18,20,22,0]},{id:"32x32ebass",name:"E-Bass",category:"32x32",len:32,max:31,data:[17,21,31,28,23,27,30,13,0,8,11,10,7,8,14,21,27,27,26,25,31,19,0,2,0,0,0,8,15,18,18,16]},{id:"32x32eguitar",name:"E-Guitar",category:"32x32",len:32,max:31,data:[3,9,16,23,28,31,31,29,26,23,25,27,28,29,28,22,8,0,12,28,0,14,2,0,1,31,30,4,3,1,0,0]},{id:"32x32eguitar2",name:"E-Guitar 2",category:"32x32",len:32,max:31,data:[16,27,31,28,31,25,16,0,3,0,11,7,5,16,18,17,23,23,30,31,29,30,0,12,3,4,4,8,11,10,20,21]},{id:"32x32englishhorn",name:"English Horn",category:"32x32",len:32,max:31,data:[16,22,31,22,15,9,15,9,15,13,11,8,6,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,6,8,11]},{id:"32x32fantasia",name:"Fantasia",category:"32x32",len:32,max:31,data:[0,6,14,15,14,8,5,7,15,15,21,26,27,26,21,15,17,23,29,31,31,28,22,12,11,15,19,20,19,17,6,1]},{id:"32x32filteredsaw",name:"Filtered Saw",category:"32x32",len:32,max:31,data:[16,18,20,21,23,25,26,28,29,30,31,31,31,31,30,26,19,9,3,1,0,0,1,2,3,4,6,7,9,11,12,14]},{id:"32x32filteredsquare",name:"Filtered Square",category:"32x32",len:32,max:31,data:[20,24,27,28,29,30,31,31,31,31,30,29,28,27,24,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32flute",name:"Flute",category:"32x32",len:32,max:31,data:[16,19,23,27,30,31,31,31,29,25,21,17,12,8,6,4,3,3,3,3,3,3,3,3,4,5,6,7,8,9,11,13]},{id:"32x32frenchhorn",name:"French Horn",category:"32x32",len:32,max:31,data:[16,22,27,29,30,31,31,26,22,16,14,9,4,5,8,15,19,20,18,16,14,10,8,8,8,8,9,13,14,13,13,13]},{id:"32x32frenchhorn2",name:"French Horn 2",category:"32x32",len:32,max:31,data:[29,31,29,27,24,22,18,11,2,0,2,4,8,13,16,17,18,17,16,13,8,4,2,0,2,11,18,22,24,27,29,31]},{id:"32x32glockenspiel",name:"Glockenspiel",category:"32x32",len:33,max:31,data:[16,29,24,17,24,29,20,16,24,31,26,16,20,22,15,5,16,26,15,11,15,15,5,0,7,15,11,2,7,15,7,2,16]},{id:"32x32hardslap",name:"Hard Slap",category:"32x32",len:32,max:31,data:[18,30,21,16,15,17,22,31,2,11,29,0,20,10,15,31,6,21,30,0,7,11,12,8,1,11,30,16,1,31,18,4]},{id:"32x32jazzguitar",name:"Jazz Guitar",category:"32x32",len:32,max:31,data:[0,2,3,2,1,0,0,2,11,19,24,29,30,30,29,28,27,28,30,31,30,25,17,13,13,15,16,17,16,13,7,0]},{id:"32x32lead",name:"Lead",category:"32x32",len:32,max:31,data:[31,23,18,14,11,9,7,5,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,5,7,9,11,14,18,23,31]},{id:"32x32lead2",name:"Lead 2",category:"32x32",len:32,max:31,data:[11,20,26,30,31,31,30,22,12,0,1,1,1,17,16,16,16,16,30,31,30,0,5,8,18,20,21,22,20,19,15,11]},{id:"32x32mutetrumpet",name:"Mute Trumpet",category:"32x32",len:32,max:31,data:[31,29,20,15,12,11,12,12,13,13,13,14,14,15,16,15,15,15,14,14,15,15,16,16,16,16,16,16,17,17,17,24]},{id:"32x32oboe",name:"Oboe",category:"32x32",len:32,max:31,data:[21,31,14,0,1,8,14,18,20,22,22,22,21,20,18,17,15,13,12,11,10,9,9,10,12,15,20,27,31,30,13,1]},{id:"32x32octavelead",name:"Octave Lead",category:"32x32",len:32,max:31,data:[6,11,15,19,23,27,29,31,13,14,15,16,17,18,18,0,3,6,9,12,14,16,17,18,0,0,0,0,0,0,0,0]},{id:"32x32octavesaw",name:"Octave Saw",category:"32x32",len:32,max:31,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]},{id:"32x32organ",name:"Organ",category:"32x32",len:32,max:31,data:[23,31,31,28,27,26,19,15,19,23,17,10,9,11,8,10,20,29,28,22,19,17,9,5,8,13,8,3,2,6,5,9]},{id:"32x32organ2",name:"Organ 2",category:"32x32",len:32,max:31,data:[16,19,26,30,31,27,23,14,10,6,8,9,9,8,13,14,18,17,20,22,26,24,24,19,18,13,12,9,5,2,5,8]},{id:"32x32organ3",name:"Organ 3",category:"32x32",len:32,max:31,data:[16,31,31,24,22,24,20,15,16,18,17,17,22,22,11,6,16,25,21,11,10,15,16,14,16,17,12,8,10,9,0,0]},{id:"32x32piano",name:"Piano",category:"32x32",len:32,max:31,data:[18,30,31,29,31,30,30,31,31,31,31,26,10,2,2,6,14,14,10,8,5,3,1,9,17,15,8,2,4,7,10,13]},{id:"32x32piano2",name:"Piano 2",category:"32x32",len:32,max:31,data:[14,27,31,31,31,31,28,22,21,24,31,29,16,7,5,8,15,22,26,26,21,8,0,4,10,11,6,2,0,1,0,2]},{id:"32x32reedorgan",name:"Reed Organ",category:"32x32",len:32,max:31,data:[16,22,31,22,15,8,0,8,16,22,31,22,15,8,16,22,15,13,16,18,16,16,16,16,16,16,31,31,31,31,31,31]},{id:"32x32sam",name:"SAM",category:"32x32",len:32,max:31,data:[5,10,15,10,10,15,15,26,31,31,31,26,21,15,10,10,10,10,15,21,26,26,26,26,21,26,21,21,10,5,0,0]},{id:"32x32saw2",name:"Saw 2",category:"32x32",len:32,max:31,data:[15,31,30,25,23,20,19,17,17,16,15,15,15,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{id:"32x32sax",name:"Sax",category:"32x32",len:32,max:31,data:[0,16,22,27,29,31,29,27,22,16,9,5,2,0,2,5,9,16,24,29,31,29,24,16,7,2,0,2,7,16,31,16]},{id:"32x32strings",name:"Strings",category:"32x32",len:32,max:31,data:[5,31,10,0,0,18,31,26,23,19,25,28,31,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32strings2",name:"Strings 2",category:"32x32",len:32,max:31,data:[21,26,26,21,16,16,16,24,29,31,29,21,15,12,12,16,19,19,15,7,2,0,2,7,16,16,10,5,5,10,16,16]},{id:"32x32synthbass",name:"Synth Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,15,15,0,0,15,15,31,31,31,31,31,31,0,7,7,7,7,7,7,0,23,23,23,23,23,23,0]},{id:"32x32synthbell",name:"Synth Bell",category:"32x32",len:32,max:31,data:[16,31,26,31,19,12,16,19,11,0,6,0,29,18,4,28,19,0,7,0,15,19,16,12,23,31,27,31,4,14,28,5]},{id:"32x32synthlead",name:"Synth Lead",category:"32x32",len:32,max:31,data:[0,0,0,0,3,26,1,0,1,28,0,29,0,18,5,4,0,0,3,0,31,0,20,31,5,2,0,20,27,31,0,16]},{id:"32x32synthlead2",name:"Synth Lead 2",category:"32x32",len:32,max:31,data:[16,16,15,0,16,31,31,31,16,16,15,0,15,15,15,0,0,0,0,15,0,0,15,15,15,15,0,0,0,15,0,0]},{id:"32x32synthpiano",name:"Synth Piano",category:"32x32",len:32,max:31,data:[14,7,8,8,7,3,2,5,3,4,13,25,31,31,31,30,25,14,14,18,22,17,9,9,8,9,15,25,30,29,23,5]},{id:"32x32synthstrings",name:"Synth Strings",category:"32x32",len:32,max:31,data:[17,26,31,31,27,22,17,14,13,16,21,28,31,25,8,1,16,31,24,7,0,5,11,17,19,18,15,10,4,1,1,7]},{id:"32x32trumpet",name:"Trumpet",category:"32x32",len:32,max:31,data:[15,31,26,24,21,20,19,19,18,17,17,17,17,16,17,16,16,16,16,16,16,16,15,14,14,12,11,10,7,4,1,0]},{id:"32x32tuba",name:"Tuba",category:"32x32",len:32,max:31,data:[19,28,31,30,26,22,19,17,16,15,14,14,15,15,15,16,17,17,18,18,18,18,18,17,16,14,11,8,4,1,0,7]},{id:"32x32vibraphone",name:"Vibraphone",category:"32x32",len:32,max:31,data:[10,28,25,18,17,30,31,31,29,31,25,26,30,31,22,9,15,22,19,2,1,5,9,2,3,1,0,0,8,15,8,3]},{id:"32x32voice",name:"Voice",category:"32x32",len:32,max:31,data:[16,25,28,31,28,25,12,8,8,13,19,29,31,29,24,19,9,8,3,2,1,1,0,1,0,0,2,1,5,5,8,14]},{id:"32x32voice2",name:"Voice 2",category:"32x32",len:32,max:31,data:[0,6,8,17,19,21,21,19,16,12,10,12,20,26,29,30,29,21,13,0,1,1,2,2,16,31,30,30,28,16,8,2]},{id:"128x256bass",name:"Bass",category:"128x256",len:128,max:255,data:[0,1,5,17,41,76,120,164,201,227,242,249,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,250,248,244,240,236,232,228,224,222,220,218,217,216,215,214,213,212,210,207,204,199,194,189,184,178,172,166,160,154,148,144,140,136,133,131,129,127,125,123,122,121,120,119,118,117,114,111,107,102,97,90,83,76,70,64,58,52,46,42,39,37,35,34,33,32,31,30,29,28,25,22,17,13,9,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"128x256chime",name:"Chime",category:"128x256",len:128,max:255,data:[128,154,184,203,201,192,190,187,181,176,172,167,164,161,160,161,165,174,188,210,235,252,255,254,253,253,252,250,249,248,246,245,244,244,246,248,252,255,251,233,210,212,223,224,225,230,233,235,237,239,240,240,239,236,230,217,192,151,110,101,118,122,123,130,136,140,144,148,151,151,150,145,136,118,91,55,23,13,20,25,24,28,33,35,38,41,44,44,44,41,35,26,13,2,2,12,9,5,5,4,2,1,1,0,0,0,0,0,1,3,9,25,57,92,95,80,77,76,69,64,61,57,54,52,52,53,58,67]},{id:"128x256lead",name:"Lead",category:"128x256",len:128,max:255,data:[96,159,151,135,187,216,196,170,210,251,206,157,149,151,191,242,206,206,248,206,168,164,166,208,247,200,156,186,218,207,179,212,255,241,241,255,255,255,255,255,248,241,248,255,255,255,232,195,217,212,179,221,250,242,223,163,105,134,164,126,94,110,150,123,102,153,132,104,144,161,128,90,120,149,91,31,13,4,34,76,42,37,60,22,0,0,0,7,13,6,0,0,0,0,0,14,14,0,43,75,48,37,68,98,54,8,47,88,91,87,49,6,49,49,13,64,103,105,98,49,4,44,84,58,38,67,119,104]}];function Ai(e,t){if(e.max===t)return e.data;const a=t/e.max;return e.data.map(e=>Math.round(Math.max(0,Math.min(t,e*a))))}function Oi(e,t){const a=(n=e,Ti.find(e=>e.id===n));var n;if(!a)return null;switch(t){case"gb":case"n163":case"swan":return Ai(a,15);case"pce":case"vb":return 31===a.max?a.data:Ai(a,31);case"scc":return Ai(a,255).map(e=>e-128);case"lynx":return Ai(a,255);default:return a.data}}class Ii{static mapOPN2(e,t,a){const n=Ei.OPN2,s=t%3,r=0===(t<3?0:1)?0:256;if(e.write(n,34,8),a.fms||a.ams){const t=a.fms??0;e.write(n,34,8|7&t)}const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&t.rs)<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&t.ssg)})}static mapOPM(e,t,a){const n=Ei.OPM,s=7&t;if(e.write(n,1,2),e.write(n,24,0),e.write(n,25,127),e.write(n,25,255),a.fms||a.ams){const t=a.fms??0;e.write(n,24,16*t&255);const s=a.fms??127,r=a.ams??127;e.write(n,25,128|127&s),e.write(n,25,127&r)}const r=192|(7&a.feedback)<<3|7&a.algorithm;e.write(n,32+s,r);const i=a.fms??0,o=a.ams??0;e.write(n,56+s,(7&i)<<4|3&o);const l=[0,8,16,24];a.operators.forEach((t,a)=>{const r=l[a]+s,i=this.furnaceDtToOPN2(t.dt??0);e.write(n,64+r,(7&i)<<4|15&(t.mult??1)),e.write(n,96+r,127&(t.tl??0)),e.write(n,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(n,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(n,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(n,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapOPL3(e,t,a,n){const s=n??Ei.OPL3;e.write(s,261,1),e.write(s,1,32);const r=t<9?0:256,i=t%9,o=48|(7&a.feedback)<<1|1&a.algorithm;e.write(s,r|192+i,o);const l=this.getOPL3Slots(i);a.operators.slice(0,2).forEach((t,a)=>{const n=r|l[a],i=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(s,32+n,i),e.write(s,64+n,(3&t.ksl)<<6|63&t.tl),e.write(s,96+n,t.ar>>1<<4|t.dr>>1),e.write(s,128+n,(15&t.sl)<<4|15&t.rr),e.write(s,224+n,7&t.ws)})}static mapPSG(e,t,a){const n=Ei.PSG;e.write(n,0,231),e.write(n,1,255);const s=144|(3&t)<<5|15&Math.min(15,Math.floor(a.operators[0].tl/8));e.write(n,0,s)}static mapGB(e,t,a){const n=Ei.GB;e.write(n,16,0),e.write(n,38,143),e.write(n,37,255),e.write(n,36,255)}static mapC64(e,t,a){const n=a.c64,s=a.chipType===Ei.SID_6581||a.chipType===Ei.SID_8580,r=s?a.chipType:Ei.SID;if(s){const a=7*t,s=n?.a??0,i=n?.d??8;e.write(r,a+5,(15&s)<<4|15&i);const o=n?.s??15,l=n?.r??4;e.write(r,a+6,(15&o)<<4|15&l);const c=n?.duty??2048;e.write(r,a+2,255&c),e.write(r,a+3,c>>8&15);let u=0;n?(n.noiseOn&&(u|=128),n.pulseOn&&(u|=64),n.sawOn&&(u|=32),n.triOn&&(u|=16),n.ringMod&&(u|=4),n.oscSync&&(u|=2)):u=64,e.write(r,a+4,u),e.write(r,24,15);const d=n?.filterResonance??n?.filterRes??0;let p=0;n?.filterOn&&!0!==n?.filterCh3Off&&(p|=1<<t),e.write(r,23,(15&d)<<4|p)}else{const a=0,s=1,i=2,o=3,l=5,c=6,u=7,d=8,p=13,h=50,m=51,f=t*64,g=17*(n?.a??0),y=17*(n?.d??8),b=17*(n?.s??15),v=17*(n?.r??4);e.write(r,f+s,255&g),e.write(r,f+i,255&y),e.write(r,f+o,255&b),e.write(r,f+l,255&v);let x=0;n?(n.triOn&&(x|=1),n.sawOn&&(x|=2),n.pulseOn&&(x|=4),n.noiseOn&&(x|=8)):x=4,e.write(r,f+c,x);const w=n?.duty??2048;e.write(r,f+u,w>>8&255),e.write(r,f+d,255&w),e.write(r,f+p,255),e.write(r,f+h,255),e.write(r,f+m,255),e.write(r,f+a,0)}}static mapNES(e,t,a){const n=Ei.NES;if(e.write(n,16405,31),e.write(n,16385,8),e.write(n,16389,8),e.write(n,16384,48),e.write(n,16386,0),e.write(n,16387,8),e.write(n,16388,48),e.write(n,16390,0),e.write(n,16391,8),e.write(n,16392,0),e.write(n,16394,0),e.write(n,16395,8),e.write(n,16396,48),e.write(n,16398,8),e.write(n,16399,8),t<2){const s=4*t,r=3&Math.floor((a.operators[0]?.mult??2)/4),i=Math.max(0,15-Math.floor(a.operators[0].tl/8));e.write(n,16384+s,r<<6|48|15&i)}else if(2===t)e.write(n,16392,255);else if(3===t){const t=Math.max(0,15-Math.floor(a.operators[0].tl/8));e.write(n,16396,48|15&t)}}static mapAY(e,t,a){const n=Ei.AY;e.write(n,7,56)}static mapPCE(e,t,a){const n=Ei.PCE;e.write(n,0,0),e.write(n,1,255)}static mapSNES(e,t,a){const n=Ei.SNES;e.write(n,93,2),e.write(n,12,127),e.write(n,28,127),e.write(n,108,0),e.write(n,76,0),e.write(n,92,0);for(let s=0;s<8;s++)e.write(n,16*s+4,s)}static mapOPLL(e,t,a){const n=Ei.OPLL,s=a.opllPreset??3;if(0===s&&a.operators.length>=2){const t=a.operators[0],s=a.operators[1],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(n,0,r);const i=(s.am?128:0)|(s.vib?64:0)|(s.sus?32:0)|(s.ksr?16:0)|15&s.mult;e.write(n,1,i);const o=Math.min(63,t.tl>>1);e.write(n,2,(3&t.ksl)<<6|63&o);const l=1&(s.ws??0),c=1&(t.ws??0);e.write(n,3,l<<4|c<<3|7&a.feedback),e.write(n,4,(15&t.ar)<<4|15&t.dr),e.write(n,5,(15&s.ar)<<4|15&s.dr),e.write(n,6,(15&t.sl)<<4|15&t.rr),e.write(n,7,(15&s.sl)<<4|15&s.rr)}e.write(n,48+t,(15&s)<<4),e.write(n,14,0)}static mapOPNA(e,t,a){const n=Ei.OPNA,s=t%3,r=0===(t<3?0:1)?0:256;e.write(n,34,8),e.write(n,41,159),e.write(n,257,63);const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&t.rs)<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&t.ssg)})}static mapOPN(e,t,a){const n=Ei.OPN,s=t%3;e.write(n,34,8);const r=(7&a.feedback)<<3|7&a.algorithm;e.write(n,176+s,r);const i=(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,180+s,i);const o=[0,8,4,12];a.operators.forEach((t,a)=>{const r=o[a]+s,i=this.furnaceDtToOPN2(t.dt);e.write(n,48+r,(7&i)<<4|15&t.mult),e.write(n,64+r,127&t.tl),e.write(n,80+r,(3&t.rs)<<6|31&t.ar),e.write(n,96+r,(t.am?128:0)|31&t.dr),e.write(n,112+r,31&t.d2r),e.write(n,128+r,(15&t.sl)<<4|15&t.rr),e.write(n,144+r,15&t.ssg)})}static mapOPNB(e,t,a){const n=Ei.OPNB,s=t%3,r=0===(t<3?0:1)?0:256;e.write(n,34,0);const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&t.rs)<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&t.ssg)})}static mapVRC6(e,t,a){const n=Ei.VRC6;e.write(n,36867,0)}static mapN163(e,t,a){const n=Ei.N163;e.write(n,127,0)}static mapSCC(e,t,a){const n=Ei.SCC;for(let s=0;s<5;s++)e.write(n,138+s,15);e.write(n,143,31)}static mapFDS(e,t,a){const n=Ei.FDS;e.write(n,16419,0),e.write(n,16419,131),e.write(n,16521,0)}static mapMMC5(e,t,a){const n=Ei.MMC5;e.write(n,20501,3),e.write(n,20496,0)}static mapTIA(e,t,a){const n=Ei.TIA;e.write(n,25,15),e.write(n,26,15)}static mapSAA(e,t,a){const n=Ei.SAA;e.write(n,28,2),e.write(n,28,1)}static mapSWAN(e,t,a){const n=Ei.SWAN;for(let s=0;s<4;s++)e.write(n,8+s,255);e.write(n,15,0),e.write(n,17,15)}static mapOKI(e,t,a){const n=Ei.OKI;e.write(n,12,0)}static mapES5506(e,t,a){}static mapOPZ(e,t,a){const n=Ei.OPZ,s=7&t;e.write(n,1,2),e.write(n,24,0),e.write(n,25,127),e.write(n,25,255);const r=192|(7&a.feedback)<<3|7&a.algorithm;e.write(n,32+s,r);const i=a.fms??0,o=a.ams??0;e.write(n,56+s,(7&i)<<4|3&o);const l=[0,8,16,24];a.operators.forEach((t,a)=>{const r=l[a]+s,i=this.furnaceDtToOPN2(t.dt??0);e.write(n,64+r,(7&i)<<4|15&(t.mult??1)),e.write(n,96+r,127&(t.tl??0)),e.write(n,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(n,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(n,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(n,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapY8950(e,t,a){const n=Ei.Y8950;e.write(n,1,32),e.write(n,4,0),e.write(n,8,0);const s=t%9,r=(7&a.feedback)<<1|1&a.algorithm;e.write(n,192+s,r);const i=this.getOPL3Slots(s);a.operators.slice(0,2).forEach((t,a)=>{const s=i[a],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(n,32+s,r),e.write(n,64+s,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(n,96+s,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(n,128+s,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(n,224+s,3&(t.ws??0))})}static mapOPL4(e,t,a){const n=Ei.OPL4;e.write(n,261,3),e.write(n,514,16),e.write(n,1,32);const s=t<9?0:256,r=t%9,i=48|(7&a.feedback)<<1|1&a.algorithm;e.write(n,s|192+r,i);const o=this.getOPL3Slots(r);a.operators.slice(0,2).forEach((t,a)=>{const r=s|o[a],i=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(n,32+r,i),e.write(n,64+r,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(n,96+r,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(n,128+r,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(n,224+r,7&(t.ws??0))})}static mapSEGAPCM(e,t,a){const n=Ei.SEGAPCM;for(let s=0;s<16;s++){const t=s<<3;e.write(n,134+t,3),e.write(n,2+t,127),e.write(n,3+t,127)}}static mapYMZ280B(e,t,a){const n=Ei.YMZ280B;e.write(n,255,128);for(let s=0;s<8;s++)e.write(n,2+4*s,255),e.write(n,3+4*s,8)}static mapRF5C68(e,t,a){const n=Ei.RF5C68;e.write(n,8,255);for(let s=0;s<8;s++)e.write(n,0+s,0),e.write(n,1+s,0);e.write(n,8,0)}static mapGA20(e,t,a){const n=Ei.GA20;for(let s=0;s<4;s++)e.write(n,5+8*s,0),e.write(n,6+8*s,0)}static mapC140(e,t,a){const n=Ei.C140;for(let s=0;s<24;s++)e.write(n,5+(s<<4),0)}static mapQSOUND(e,t,a){const n=Ei.QSOUND;e.write(n,0,0)}static mapVIC(e,t,a){const n=Ei.VIC;e.write(n,14,15)}static mapTED(e,t,a){const n=Ei.TED;e.write(n,17,15)}static mapSUPERVISION(e,t,a){}static mapVERA(e,t,a){const n=Ei.VERA;for(let s=0;s<16;s++)e.write(n,129472+4*s+2,3)}static mapSM8521(e,t,a){const n=Ei.SM8521;e.write(n,64,128)}static mapBUBBLE(e,t,a){}static mapK007232(e,t,a){const n=Ei.K007232;e.write(n,12,255),e.write(n,13,0)}static mapK053260(e,t,a){const n=Ei.K053260;e.write(n,40,0),e.write(n,47,2)}static mapX1_010(e,t,a){const n=Ei.X1_010;for(let s=0;s<16;s++)e.write(n,8*s,0)}static mapUPD1771(e,t,a){}static mapT6W28(e,t,a){const n=Ei.T6W28;e.write(n,1,231)}static mapVB(e,t,a){const n=Ei.VB;for(let s=0;s<6;s++){const t=1024+64*s;e.write(n,t+4,255),e.write(n,t+16,240)}}static mapLYNX(e,t,a){const n=Ei.LYNX;e.write(n,80,0)}static mapNAMCO(e,t,a){}static mapPET(e,t,a){}static mapPOKEY(e,t,a){}static mapAMIGA(e,t,a){}static mapPCSPKR(e,t,a){}static getOPL3Slots(e){return[[0,1,2,8,9,10,16,17,18][e],[3,4,5,11,12,13,19,20,21][e]]}static furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}static uploadWavetable(e,t,a){switch(t){case Ei.GB:for(let s=0;s<16;s++){const t=15&(a[2*s]||0),n=15&(a[2*s+1]||0);e.write(Ei.GB,48+s,t<<4|n)}break;case Ei.SCC:for(let s=0;s<32;s++)e.write(Ei.SCC,s,255&a[s]);break;case Ei.N163:e.write(Ei.N163,57344,128);for(let s=0;s<Math.min(128,a.length);s++)e.write(Ei.N163,63488,255&a[s]);break;case Ei.PCE:for(let s=0;s<32;s++)e.write(Ei.PCE,6,31&a[s]);break;case Ei.SWAN:for(let s=0;s<16;s++){const t=15&(a[2*s]||0),n=15&(a[2*s+1]||0);e.write(Ei.SWAN,64+s,t<<4|n)}break;case Ei.BUBBLE:const t=new Uint8Array(a.slice(0,32));e.setWavetable(Ei.BUBBLE,0,t),e.setWavetable(Ei.BUBBLE,1,t);break;case Ei.X1_010:const n=a.some(e=>e<0);for(let s=0;s<16;s++){const t=4096|s<<7;for(let s=0;s<128;s++){const r=s*a.length/128,i=Math.floor(r),o=r-i,l=a[i]||0,c=l+((a[(i+1)%a.length]||0)-l)*o;let u;u=n?255&Math.round(4*c):17*c-128&255,e.write(Ei.X1_010,t+s,u)}}}}static loadWavetablePreset(e,t,a){let n;switch(t){case Ei.GB:n="gb";break;case Ei.PCE:n="pce";break;case Ei.N163:n="n163";break;case Ei.SCC:n="scc";break;case Ei.SWAN:n="swan";break;case Ei.VB:n="vb";break;case Ei.LYNX:n="lynx";break;default:return!1}const s=Oi(a,n);return!!s&&(this.uploadWavetable(e,t,s),!0)}static getRecommendedWavetables(e){switch(e){case Ei.GB:case Ei.N163:case Ei.SWAN:return["32x16saw","32x16FunkyLead","32x16NamcoBass","32x16brass","32x16clarinet","32x16flute","32x16guitar","32x16opllpiano","32x16synthbass","32x16trumpet","32x16voice"];case Ei.PCE:case Ei.VB:return["32x32piano","32x32brass","32x32flute","32x32lead","32x32organ","32x32strings","32x32synthbass","32x32trumpet","32x32voice","32x32bell","32x32choir","32x32vibraphone"];case Ei.SCC:return["32x32piano","32x32brass","32x32lead","32x32organ","32x32synthbass","32x32trumpet","32x32strings","32x32flute"];case Ei.LYNX:return["128x256bass","128x256chime","128x256lead","32x32piano","32x32brass","32x32lead","32x32synthbass"];default:return[]}}}class Di{static CLOCK_OPN2=7670454;static CLOCK_OPN2_PAL=7600489;static CLOCK_OPN=4e6;static CLOCK_OPM=3579545;static FREQ_BASE_OPN2=9440540;static FREQ_BASE_OPN=4720270;static FREQ_BASE_OPM=3579545;static freqToOPN2(e){if(e<=0)return{block:0,fnum:0};const t=this.CLOCK_OPN2;let a=7,n=0;for(a=7;a>=0;a--){const s=Math.pow(2,a);if(n=Math.round(144*e*2097152/(t*s)),n<=2047&&n>=600)break;if(!(n<=2047&&n<600&&a>0)&&(0===a&&n<=2047))break}return n>2047&&(a=7,n=2047),a=Math.max(0,Math.min(7,a)),n=Math.max(0,Math.min(2047,n)),{block:a,fnum:n}}static freqToOPM(e){if(e<=0)return{kc:0,kf:0};const t=12*Math.log2(e/440)+69,a=Math.floor(t),n=t-a,s=Math.floor(a/12)-1,r=a%12;return{kc:Math.max(0,Math.min(7,s))<<4|[0,1,2,4,5,6,8,9,10,12,13,14][r],kf:63&Math.floor(64*n)}}static freqToGB(e){if(e<=0)return 0;const t=2048-131072/e;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNES(e){if(e<=0)return 0;const t=1789773/(16*e)-1;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNESNoise(e){const t=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];if(e<=0)return 15;const a=1789773/e;let n=0,s=Math.abs(t[0]-a);for(let r=1;r<16;r++){const e=Math.abs(t[r]-a);e<s&&(s=e,n=r)}return n}static freqToAY(e,t=1789773){if(e<=0)return 0;const a=Math.floor(t/(16*e));return Math.max(0,Math.min(4095,a))}static freqToPCE(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(4095,t))}static freqToSCC(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToSID(e,t=!0){if(e<=0)return 0;const a=t?985248:1022727,n=Math.floor(16777216*e/a);return Math.max(0,Math.min(65535,n))}static freqToPSG(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(1023,t))}static freqToSNES(e){if(e<=0)return 0;const t=Math.floor(4096*e/32e3);return Math.max(0,Math.min(16383,t))}static freqToFDS(e){if(e<=0)return 0;const t=Math.floor(65536*e/1789773);return Math.max(0,Math.min(4095,t))}static freqToVRC6(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToPOKEY(e){if(e<=0)return 0;const t=Math.floor(1789773/(2*e))-1;return Math.max(0,Math.min(255,t))}static freqToTIA(e){if(e<=0)return 0;const t=Math.floor(31440/(32*e))-1;return Math.max(0,Math.min(31,t))}static freqToVIC(e){if(e<=0)return 0;const t=Math.floor(256-1022727/(32*e));return Math.max(0,Math.min(127,t))}static freqToTED(e){if(e<=0)return 0;const t=Math.floor(1024-1773447/(8*e));return Math.max(0,Math.min(1023,t))}static freqToAmiga(e,t=!0){if(e<=0)return 65535;const a=t?3546895:3579545,n=Math.floor(a/(2*e));return Math.max(124,Math.min(65535,n))}}let Fi=0;const Ri=n((e,t)=>({errors:[],activeError:null,reportError:t=>{const a="synth-error-"+ ++Fi,n={timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",audioContextState:"undefined"!=typeof AudioContext?(new AudioContext).state:"AudioContext not available",wasmSupported:"undefined"!=typeof WebAssembly,...t.debugData},s={id:a,synthType:t.synthType,synthName:t.synthName,errorType:t.errorType,message:t.message,stack:t.stack,debugData:n,dismissed:!1};return e(e=>({errors:[...e.errors,s],activeError:s})),a},dismissError:t=>{e(e=>({errors:e.errors.map(e=>e.id===t?{...e,dismissed:!0}:e),activeError:e.activeError?.id===t?null:e.activeError}))},dismissAll:()=>{e(e=>({errors:e.errors.map(e=>({...e,dismissed:!0})),activeError:null}))},clearDismissed:()=>{e(e=>({errors:e.errors.filter(e=>!e.dismissed)}))},getDebugString:e=>{const t=["=== DEViLBOX Synth Error Report ===","",`Synth Type: ${e.synthType}`,e.synthName?`Synth Name: ${e.synthName}`:null,`Error Type: ${e.errorType}`,`Message: ${e.message}`,"","--- Debug Data ---",`Timestamp: ${e.debugData.timestamp}`,`User Agent: ${e.debugData.userAgent}`,`AudioContext State: ${e.debugData.audioContextState}`,`WASM Supported: ${e.debugData.wasmSupported}`,""].filter(Boolean),a=Object.keys(e.debugData).filter(e=>!["timestamp","userAgent","audioContextState","wasmSupported","synthConfig"].includes(e));if(a.length>0){t.push("--- Additional Info ---");for(const n of a)t.push(`${n}: ${JSON.stringify(e.debugData[n])}`);t.push("")}return e.debugData.synthConfig&&(t.push("--- Synth Config ---"),t.push(JSON.stringify(e.debugData.synthConfig,null,2)),t.push("")),e.stack&&(t.push("--- Stack Trace ---"),t.push(e.stack)),t.join("\n")},copyToClipboard:async e=>{const a=t().getDebugString(e);try{return await navigator.clipboard.writeText(a),!0}catch(n){return!1}}})),ji=(e,t,a)=>Ri.getState().reportError({synthType:e,message:t,synthName:a?.synthName,errorType:a?.errorType??"init",stack:a?.error?.stack,debugData:a?.debugData});class Li{name="FurnaceSynth";output;chipEngine=_i.getInstance();config;channelIndex=0;macroPositions=new Map;opMacroPositions=Array.from({length:4},()=>({}));activeNoteFreq=440;isNoteOn=!1;currentDuty=2;currentPan=0;velocity=1;baseTLValues=[];_oplBlock=0;_oplFnum=0;useWasmEngine=!1;errorReported=!1;gbFreqHigh=0;gbFreqVal=0;nesNoiseIndex=0;initInProgress=!1;wasmNoteTriggered=!1;noteOnTime=0;static MIN_GATE_TIME=.05;_volumeOffsetDb=0;constructor(e=kn,t=0){this.config={...e,operators:e.operators?.map(e=>({...e}))||[]},this.channelIndex=t,this.output=Jn().createGain(),this.chipEngine=_i.getInstance(),this.initEngine()}getChipType(){return this.config.chipType}setVolumeOffset(e){this._volumeOffsetDb=e,this.useWasmEngine&&this.chipEngine.setOutputGain(Math.pow(10,e/20))}async ensureInitialized(){if(!this.useWasmEngine){if(this.initInProgress){for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);if(this.useWasmEngine)return}await this.initEngine(),!this.useWasmEngine&&this.chipEngine.isInitialized()&&(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters())}}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=Jn();if("running"!==e.state){if(!(await Promise.race([new Promise(t=>{const a=()=>{"running"===e.state?t(!0):setTimeout(a,100)};a()}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return this.reportInitError("audio","AudioContext failed to start. Click anywhere to enable audio, then try again."),void(this.initInProgress=!1)}await this.chipEngine.init(e),this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters(),this.isNoteOn&&this.activeNoteFreq>0&&(this.updateFrequency(this.activeNoteFreq),this.writeKeyOn(this.velocity),this.wasmNoteTriggered=!0)):this.reportInitError("wasm","WASM chip engine failed to initialize. This synth requires WebAssembly support.")}catch(e){const t=e instanceof Error?e:new Error(String(e));this.reportInitError("wasm",t.message,t)}finally{this.initInProgress=!1}}}reportInitError(e,t,a){this.errorReported||(this.errorReported=!0,ji(`Furnace/${this.config.chipType||"Unknown"}`,t,{errorType:e,error:a,debugData:{chipType:this.config.chipType,channelIndex:this.channelIndex,synthConfig:this.config}}))}processTick(e=os()){this.isNoteOn&&(this.config.macros.forEach(t=>{if(!t.data||0===t.data.length)return;let a=this.macroPositions.get(t.type)||0;a>=t.data.length&&(a=t.data.length-1);const n=t.data[a];switch(t.type){case 0:const t=Math.max(0,n/127*this.velocity);this.output.gain.setValueAtTime(t,e);break;case 1:this.updateFrequency(this.activeNoteFreq*Math.pow(2,n/12));break;case 2:this.currentDuty=n,this.writeDutyRegister(n);break;case 3:this.writeWavetableSelect(n);break;case 4:const a=n>127?n-256:n;this.updateFrequency(this.activeNoteFreq*Math.pow(2,a/1200));break;case 5:this.currentPan=n>127?n-256:n,this.writePanRegister(this.currentPan);break;case 6:0!==n&&this.writePhaseReset()}a++,a>=t.data.length&&(a=t.loop>=0?t.loop:t.data.length-1),this.macroPositions.set(t.type,a)}),this.config.opMacros.forEach((e,t)=>{if(!e)return;const a=this.config.operators[t];if(a){if(e.tl&&e.tl.data.length>0){const n=this.advanceOpMacro(e.tl,t,"tl");a.tl=n,this.writeOperatorTL(t,n)}if(e.mult&&e.mult.data.length>0){const n=this.advanceOpMacro(e.mult,t,"mult");a.mult=n,this.writeOperatorMult(t,n)}if(e.ar&&e.ar.data.length>0){const n=this.advanceOpMacro(e.ar,t,"ar");a.ar=n,this.writeOperatorAR(t,n)}if(e.dr&&e.dr.data.length>0){const n=this.advanceOpMacro(e.dr,t,"dr");a.dr=n,this.writeOperatorDR(t,n)}if(e.sl&&e.sl.data.length>0){const n=this.advanceOpMacro(e.sl,t,"sl");a.sl=n,this.writeOperatorSL(t,n)}if(e.rr&&e.rr.data.length>0){const n=this.advanceOpMacro(e.rr,t,"rr");a.rr=n,this.writeOperatorRR(t,n)}}}))}advanceOpMacro(e,t,a){let n=this.opMacroPositions[t][a]||0;n>=e.data.length&&(n=e.data.length-1);const s=e.data[n];return n++,n>=e.data.length&&(n=e.loop>=0?e.loop:e.data.length-1),this.opMacroPositions[t][a]=n,s}writeDutyRegister(e){const t=this.channelIndex;if(this.config.chipType===Ei.NES){if(t<2){const a=16384+4*t,n=48|15&(this.config.operators[0]?.tl||15);this.chipEngine.write(Ei.NES,a,(3&e)<<6|n)}}else if(this.config.chipType===Ei.GB){if(t<2){const a=0===t?17:22;this.chipEngine.write(Ei.GB,a,(3&e)<<6)}}else this.config.chipType,Ei.PSG}writeWavetableSelect(e){if(this.config.wavetables&&this.config.wavetables[e]){const t=this.config.wavetables[e].data;Ii.uploadWavetable(this.chipEngine,this.config.chipType,t)}}writePanRegister(e){const t=this.channelIndex;if(this.config.chipType===Ei.OPN2){const a=t%3,n=0===(t<3?0:1)?0:256;let s=192;e<-32?s=128:e>32&&(s=64),this.chipEngine.write(Ei.OPN2,n|180+a,s)}else if(this.config.chipType===Ei.OPM){let a=192;e<-32?a=128:e>32&&(a=64);const n=(7&this.config.feedback)<<3|7&this.config.algorithm;this.chipEngine.write(Ei.OPM,32+(7&t),a|n)}else this.config.chipType===Ei.GB&&this.chipEngine.write(Ei.GB,37,255)}writePhaseReset(){if(this.config.chipType===Ei.OPN2){const e=this.channelIndex%3,t=this.channelIndex<3?0:1;this.chipEngine.write(Ei.OPN2,40,t<<2|e),this.chipEngine.write(Ei.OPN2,40,240|t<<2|e)}}writeOperatorTL(e,t){const a=this.channelIndex;if(this.config.chipType===Ei.OPN2){const n=0===(a<3?0:1)?0:256,s=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,n|64+s,127&t)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const n=[0,16,8,24][e]+(7&a),s=this.config.chipType;this.chipEngine.write(s,96+n,127&t)}}writeOperatorMult(e,t){const a=this.channelIndex,n=this.config.operators[e];if(!n)return;const s=this.furnaceDtToOPN2(n.dt);if(this.config.chipType===Ei.OPN2){const n=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,n|48+r,(7&s)<<4|15&t)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const n=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,64+n,(7&s)<<4|15&t)}}writeOperatorAR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===Ei.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,s|80+r,(3&n.rs)<<6|31&t)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,128+s,(3&n.rs)<<6|31&t)}}writeOperatorDR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===Ei.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,s|96+r,(n.am?128:0)|31&t)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,160+s,(n.am?128:0)|31&t)}}writeOperatorSL(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===Ei.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,s|128+r,(15&t)<<4|15&n.rr)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&t)<<4|15&n.rr)}}writeOperatorRR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===Ei.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(Ei.OPN2,s|128+r,(15&n.sl)<<4|15&t)}else if(this.config.chipType===Ei.OPM||this.config.chipType===Ei.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&n.sl)<<4|15&t)}}furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}updateFrequency(e){const t=this.channelIndex%3,a=0===(this.channelIndex<3?0:1)?0:256;if(this.config.chipType===Ei.OPN2){const{block:n,fnum:s}=Di.freqToOPN2(e);this.chipEngine.write(Ei.OPN2,a|160+t,255&s),this.chipEngine.write(Ei.OPN2,a|164+t,(7&n)<<3|s>>8&7)}else if(this.config.chipType===Ei.OPN){const{block:t,fnum:a}=Di.freqToOPN2(e),n=this.channelIndex%3;this.chipEngine.write(Ei.OPN,160+n,255&a),this.chipEngine.write(Ei.OPN,164+n,(7&t)<<3|a>>8&7)}else if(this.config.chipType===Ei.OPM){const{kc:t,kf:a}=Di.freqToOPM(e);this.chipEngine.write(Ei.OPM,40+(7&this.channelIndex),t),this.chipEngine.write(Ei.OPM,48+(7&this.channelIndex),a<<2)}else if(this.config.chipType===Ei.OPZ){const t=[0,1,2,4,5,6,8,9,10,12,13,14],a=Math.round(12*Math.log2(e/440)+69),n=Math.max(0,Math.min(127,a)),s=(7&Math.floor(n/12))<<4|t[n%12],r=12*Math.log2(e/440)+69-n,i=63&Math.floor(64*r);this.chipEngine.write(Ei.OPZ,40+(7&this.channelIndex),s),this.chipEngine.write(Ei.OPZ,48+(7&this.channelIndex),i<<2)}else if(this.config.chipType===Ei.OPL3||this.config.chipType===Ei.Y8950||this.config.chipType===Ei.OPL4||this.config.chipType===Ei.ESFM){const t=this.channelIndex%9,a=this.channelIndex<9?0:256;let n=4,s=Math.floor(e*(1<<19)/2e5);for(;s>1023&&n<7;)s>>=1,n++;for(;s<256&&n>0;)s<<=1,n--;s&=1023,this._oplBlock=n,this._oplFnum=s,this.chipEngine.write(this.config.chipType,a|160+t,255&s),this.chipEngine.write(this.config.chipType,a|176+t,(7&n)<<2|s>>8&3)}else if(this.config.chipType===Ei.OPLL){const t=this.channelIndex%9;let a=4,n=Math.floor(e*(1<<18)/2e5);for(;n>511&&a<7;)n>>=1,a++;for(;n<128&&a>0;)n<<=1,a--;n&=511,this._oplBlock=a,this._oplFnum=n,this.chipEngine.write(Ei.OPLL,16+t,255&n)}else if(this.config.chipType===Ei.OPNA||this.config.chipType===Ei.OPNB||this.config.chipType===Ei.OPNB_B){const{block:t,fnum:a}=Di.freqToOPN2(e),n=this.channelIndex%3,s=0===(this.channelIndex<3?0:1)?0:256;this.chipEngine.write(this.config.chipType,s|160+n,255&a),this.chipEngine.write(this.config.chipType,s|164+n,(7&t)<<3|a>>8&7)}else if(this.config.chipType===Ei.AY||this.config.chipType===Ei.AY8930){const t=1789773,a=4095&Math.floor(t/(16*e)),n=this.channelIndex%3;this.chipEngine.write(this.config.chipType,2*n,255&a),this.chipEngine.write(this.config.chipType,2*n+1,a>>8&15)}else if(this.config.chipType===Ei.SID||this.config.chipType===Ei.SID_6581||this.config.chipType===Ei.SID_8580){const t=985248,a=65535&Math.floor(16777216*e/t),n=this.channelIndex%3*7;this.chipEngine.write(this.config.chipType,n+0,255&a),this.chipEngine.write(this.config.chipType,n+1,a>>8&255)}else if(this.config.chipType===Ei.PSG){const t=1023&Math.floor(3579545/(32*e)),a=3&this.channelIndex;this.chipEngine.write(Ei.PSG,0,128|a<<5|15&t),this.chipEngine.write(Ei.PSG,0,t>>4&63)}else if(this.config.chipType===Ei.NES){const t=this.channelIndex;if(t<2){const a=Di.freqToNES(e),n=16384+4*t;this.chipEngine.write(Ei.NES,n+2,255&a),this.chipEngine.write(Ei.NES,n+3,a>>8&7)}else if(2===t){const t=Di.freqToNES(e);this.chipEngine.write(Ei.NES,16394,255&t),this.chipEngine.write(Ei.NES,16395,t>>8&7)}else if(3===t){const t=Di.freqToNESNoise(e);this.nesNoiseIndex=t,this.chipEngine.write(Ei.NES,16398,15&t)}}else if(this.config.chipType===Ei.GB){const t=Di.freqToGB(e);this.gbFreqVal=t}else if(this.config.chipType===Ei.PCE){const t=this.channelIndex,a=4095&Math.floor(3579545/(32*e));this.chipEngine.write(Ei.PCE,0,7&t),this.chipEngine.write(Ei.PCE,2,255&a),this.chipEngine.write(Ei.PCE,3,a>>8&15)}else if(this.config.chipType===Ei.SNES){const t=16*(7&this.channelIndex),a=16383&Math.floor(4096*e/32e3);this.chipEngine.write(Ei.SNES,t+2,255&a),this.chipEngine.write(Ei.SNES,t+3,a>>8&63)}}updateParameters(){switch(this.config.chipType){case 0:Ii.mapOPN2(this.chipEngine,this.channelIndex,this.config);break;case 1:Ii.mapOPM(this.chipEngine,this.channelIndex,this.config);break;case 2:Ii.mapOPL3(this.chipEngine,this.channelIndex,this.config);break;case 11:Ii.mapOPLL(this.chipEngine,this.channelIndex,this.config);break;case 13:Ii.mapOPNA(this.chipEngine,this.channelIndex,this.config);break;case 14:case 48:Ii.mapOPNB(this.chipEngine,this.channelIndex,this.config);break;case 22:Ii.mapOPZ(this.chipEngine,this.channelIndex,this.config);break;case 23:Ii.mapY8950(this.chipEngine,this.channelIndex,this.config);break;case 26:Ii.mapOPL4(this.chipEngine,this.channelIndex,this.config);break;case 47:Ii.mapOPN(this.chipEngine,this.channelIndex,this.config);break;case 49:Ii.mapOPL3(this.chipEngine,this.channelIndex,this.config,Ei.ESFM);break;case 3:Ii.mapPSG(this.chipEngine,this.channelIndex,this.config);break;case 12:Ii.mapAY(this.chipEngine,this.channelIndex,this.config);break;case 18:Ii.mapSAA(this.chipEngine,this.channelIndex,this.config);break;case 43:Ii.mapT6W28(this.chipEngine,this.channelIndex,this.config);break;case 4:Ii.mapNES(this.chipEngine,this.channelIndex,this.config);break;case 5:Ii.mapGB(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.GB,this.config.wavetables[0].data);break;case 6:Ii.mapPCE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.PCE,this.config.wavetables[0].data);break;case 24:Ii.mapSNES(this.chipEngine,this.channelIndex,this.config);break;case 44:Ii.mapVB(this.chipEngine,this.channelIndex,this.config);break;case 16:Ii.mapFDS(this.chipEngine,this.channelIndex,this.config);break;case 17:Ii.mapMMC5(this.chipEngine,this.channelIndex,this.config);break;case 8:Ii.mapN163(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.N163,this.config.wavetables[0].data);break;case 9:Ii.mapVRC6(this.chipEngine,this.channelIndex,this.config);break;case 7:Ii.mapSCC(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.SCC,this.config.wavetables[0].data);break;case 19:Ii.mapSWAN(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.SWAN,this.config.wavetables[0].data);break;case 36:Ii.mapVERA(this.chipEngine,this.channelIndex,this.config);break;case 37:Ii.mapSM8521(this.chipEngine,this.channelIndex,this.config);break;case 38:Ii.mapBUBBLE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.BUBBLE,this.config.wavetables[0].data);break;case 10:case 45:case 46:Ii.mapC64(this.chipEngine,this.channelIndex,this.config);break;case 20:Ii.mapOKI(this.chipEngine,this.channelIndex,this.config);break;case 21:Ii.mapES5506(this.chipEngine,this.channelIndex,this.config);break;case 27:Ii.mapSEGAPCM(this.chipEngine,this.channelIndex,this.config);break;case 28:Ii.mapYMZ280B(this.chipEngine,this.channelIndex,this.config);break;case 29:Ii.mapRF5C68(this.chipEngine,this.channelIndex,this.config);break;case 30:Ii.mapGA20(this.chipEngine,this.channelIndex,this.config);break;case 31:Ii.mapC140(this.chipEngine,this.channelIndex,this.config);break;case 32:Ii.mapQSOUND(this.chipEngine,this.channelIndex,this.config);break;case 39:Ii.mapK007232(this.chipEngine,this.channelIndex,this.config);break;case 40:Ii.mapK053260(this.chipEngine,this.channelIndex,this.config);break;case 41:Ii.mapX1_010(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Ii.uploadWavetable(this.chipEngine,Ei.X1_010,this.config.wavetables[0].data);break;case 15:Ii.mapTIA(this.chipEngine,this.channelIndex,this.config);break;case 33:Ii.mapVIC(this.chipEngine,this.channelIndex,this.config);break;case 34:Ii.mapTED(this.chipEngine,this.channelIndex,this.config);break;case 35:Ii.mapSUPERVISION(this.chipEngine,this.channelIndex,this.config);break;case 42:Ii.mapUPD1771(this.chipEngine,this.channelIndex,this.config);break;case 25:Ii.mapLYNX(this.chipEngine,this.channelIndex,this.config);break;case 55:Ii.mapNAMCO(this.chipEngine,this.channelIndex,this.config);break;case 56:Ii.mapPET(this.chipEngine,this.channelIndex,this.config);break;case 57:Ii.mapPOKEY(this.chipEngine,this.channelIndex,this.config);break;case 61:Ii.mapAMIGA(this.chipEngine,this.channelIndex,this.config);break;case 62:Ii.mapPCSPKR(this.chipEngine,this.channelIndex,this.config)}}triggerAttack(e,t,a){const n=is(e);this.activeNoteFreq=n,this.isNoteOn=!0,this.velocity=void 0!==a?a:1;const s=t||os();return this.noteOnTime=os(),this.useWasmEngine||(this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters()):this.initInProgress||this.initEngine()),this.useWasmEngine?(this.macroPositions.clear(),this.opMacroPositions=Array.from({length:4},()=>({})),this.currentDuty=2,this.currentPan=0,this.baseTLValues=this.config.operators.map(e=>e.tl),this.applyVelocityToCarriers(),this.updateParameters(),this.updateFrequency(n),this.writeKeyOn(a),this.wasmNoteTriggered=!0,this.processTick(s),this):this}applyVelocityToCarriers(){if(this.config.chipType!==Ei.OPN2&&this.config.chipType!==Ei.OPM)return;const e=[[3],[3],[3],[3],[2,3],[2,3],[1,2,3],[0,1,2,3]][7&this.config.algorithm]||[3],t=Math.floor(32*(1-this.velocity));for(const a of e)if(this.config.operators[a]){const e=this.baseTLValues[a];this.config.operators[a].tl=Math.min(127,e+t)}}writeKeyOn(e){const t=this.channelIndex,a=void 0!==e?Math.floor(15*e):15;switch(this.config.chipType){case Ei.OPN2:{const e=(t<3?0:1)<<2|t%3,a=240|e;this.chipEngine.write(Ei.OPN2,40,e),this.chipEngine.write(Ei.OPN2,40,a);break}case Ei.OPM:this.chipEngine.write(Ei.OPM,8,7&t),this.chipEngine.write(Ei.OPM,8,120|7&t);break;case Ei.NES:if(this.chipEngine.write(Ei.NES,16405,31),t<2){const e=16384+4*t,n=Di.freqToNES(this.activeNoteFreq);this.chipEngine.write(Ei.NES,e,(3&this.currentDuty)<<6|48|a),this.chipEngine.write(Ei.NES,e+1,8),this.chipEngine.write(Ei.NES,e+2,255&n),this.chipEngine.write(Ei.NES,e+3,8|n>>8&7)}else if(2===t){const e=Di.freqToNES(this.activeNoteFreq);this.chipEngine.write(Ei.NES,16392,255),this.chipEngine.write(Ei.NES,16394,255&e),this.chipEngine.write(Ei.NES,16395,8|e>>8&7)}else 3===t&&(this.chipEngine.write(Ei.NES,16396,48|a),this.chipEngine.write(Ei.NES,16398,15&this.nesNoiseIndex),this.chipEngine.write(Ei.NES,16399,8));break;case Ei.GB:{const e=this.gbFreqVal||0;if(t<2){const n=0===t?16:21;this.chipEngine.write(Ei.GB,n+1,(3&this.currentDuty)<<6|63),this.chipEngine.write(Ei.GB,n+2,a<<4|8),this.chipEngine.write(Ei.GB,n+3,2048-e&255),this.chipEngine.write(Ei.GB,n+4,2048-e>>8&7|128)}else 2===t?(this.chipEngine.write(Ei.GB,26,128),this.chipEngine.write(Ei.GB,27,255),this.chipEngine.write(Ei.GB,28,32),this.chipEngine.write(Ei.GB,29,2048-e&255),this.chipEngine.write(Ei.GB,30,2048-e>>8&7|128)):3===t&&(this.chipEngine.write(Ei.GB,32,63),this.chipEngine.write(Ei.GB,33,a<<4|8),this.chipEngine.write(Ei.GB,34,0),this.chipEngine.write(Ei.GB,35,128));this.chipEngine.write(Ei.GB,38,128);break}case Ei.PSG:const e=15-Math.min(15,a);this.chipEngine.write(Ei.PSG,0,144|(3&t)<<5|e);break;case Ei.PCE:{const e=4095&Math.floor(3579545/(32*this.activeNoteFreq));this.chipEngine.write(Ei.PCE,0,7&t),this.chipEngine.write(Ei.PCE,4,95),this.chipEngine.write(Ei.PCE,4,31);for(let t=0;t<32;t++){const e=t<16?31:0;this.chipEngine.write(Ei.PCE,6,e)}this.chipEngine.write(Ei.PCE,2,255&e),this.chipEngine.write(Ei.PCE,3,e>>8&15),this.chipEngine.write(Ei.PCE,5,255),this.chipEngine.write(Ei.PCE,4,128|31&a);break}case Ei.SNES:{const e=16*(7&t),n=1<<(7&t);this.chipEngine.write(Ei.SNES,92,n);const s=16383&Math.floor(4096*this.activeNoteFreq/32e3);this.chipEngine.write(Ei.SNES,e+2,255&s),this.chipEngine.write(Ei.SNES,e+3,s>>8&63),this.chipEngine.write(Ei.SNES,e+5,255),this.chipEngine.write(Ei.SNES,e+6,224),this.chipEngine.write(Ei.SNES,e+0,8*a),this.chipEngine.write(Ei.SNES,e+1,8*a),this.chipEngine.write(Ei.SNES,92,0),this.chipEngine.write(Ei.SNES,76,n);break}case Ei.OPL3:{const e=t%9,a=t<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(Ei.OPL3,a|176+e,n),this.chipEngine.write(Ei.OPL3,a|176+e,s);break}case Ei.OPLL:{const e=t%9,a=(7&this._oplBlock)<<1|this._oplFnum>>8&1,n=16|a;this.chipEngine.write(Ei.OPLL,32+e,a),this.chipEngine.write(Ei.OPLL,32+e,n);break}case Ei.OPNA:{const e=(t<3?0:1)<<2|t%3,a=240|e;this.chipEngine.write(Ei.OPNA,40,e),this.chipEngine.write(Ei.OPNA,40,a);break}case Ei.OPNB:{const e=[1,2,5,6][3&t];this.chipEngine.write(Ei.OPNB,40,e),this.chipEngine.write(Ei.OPNB,40,240|e);break}case Ei.OPN:{const e=t%3;this.chipEngine.write(Ei.OPN,40,e),this.chipEngine.write(Ei.OPN,40,240|e);break}case Ei.OPZ:{const e=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7,a=64|e;this.chipEngine.write(Ei.OPZ,32+(7&t),e),this.chipEngine.write(Ei.OPZ,32+(7&t),a);break}case Ei.Y8950:case Ei.OPL4:{const e=this.config.chipType,a=t%9,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(e,176+a,n),this.chipEngine.write(e,176+a,s);break}case Ei.AY:{const e=4095&Math.floor(1789773/(16*this.activeNoteFreq));this.chipEngine.write(Ei.AY,2*t,255&e),this.chipEngine.write(Ei.AY,2*t+1,e>>8&15),this.chipEngine.write(Ei.AY,8+t,15&a);const n=63&~(1<<t);this.chipEngine.write(Ei.AY,7,n);break}case Ei.SAA:{const e=8e6;let n=4,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));for(;s<0&&n<7;)n++,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));for(;s>255&&n>0;)n--,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));s=Math.max(0,Math.min(255,s)),this.chipEngine.write(Ei.SAA,0+t,a<<4|a),this.chipEngine.write(Ei.SAA,8+t,s);const r=16+Math.floor(t/2),i=t%2*4;this.chipEngine.write(Ei.SAA,r,n<<i|n<<4*(1-t%2)),this.chipEngine.write(Ei.SAA,20,1<<t);break}case Ei.T6W28:{const e=3072e3,n=3===t?15:16,s=Math.floor(e/(n*this.activeNoteFreq))-1,r=Math.max(0,Math.min(1023,s)),i=15-Math.min(15,a);this.chipEngine.write(Ei.T6W28,0,128|(3&t)<<5|15&r),this.chipEngine.write(Ei.T6W28,0,r>>4&63),this.chipEngine.write(Ei.T6W28,1,128|(3&t)<<5|15&r),this.chipEngine.write(Ei.T6W28,1,r>>4&63),this.chipEngine.write(Ei.T6W28,0,144|(3&t)<<5|i),this.chipEngine.write(Ei.T6W28,1,144|(3&t)<<5|i);break}case Ei.VRC6:if(t<2){const e=0===t?36864:40960,n=Math.floor(3579545/(16*this.activeNoteFreq))-1;this.chipEngine.write(Ei.VRC6,e,(7&this.currentDuty)<<4|a),this.chipEngine.write(Ei.VRC6,e+1,255&n),this.chipEngine.write(Ei.VRC6,e+2,128|n>>8&15)}else{const e=Math.floor(3579545/(14*this.activeNoteFreq))-1;this.chipEngine.write(Ei.VRC6,45056,63&a),this.chipEngine.write(Ei.VRC6,45057,255&e),this.chipEngine.write(Ei.VRC6,45058,128|e>>8&15)}break;case Ei.N163:{const e=Math.floor(7864320*this.activeNoteFreq/3579545);this.chipEngine.write(Ei.N163,120,255&e),this.chipEngine.write(Ei.N163,122,e>>8&255),this.chipEngine.write(Ei.N163,124,224|e>>16&3),this.chipEngine.write(Ei.N163,127,240|a);break}case Ei.FDS:{const e=4095&Math.floor(65536*this.activeNoteFreq/1789773);this.chipEngine.write(Ei.FDS,16512,128|2*a),this.chipEngine.write(Ei.FDS,16514,255&e),this.chipEngine.write(Ei.FDS,16515,e>>8&15);break}case Ei.MMC5:{const e=0===t?20480:20484,n=Di.freqToNES(this.activeNoteFreq);this.chipEngine.write(Ei.MMC5,e,(3&this.currentDuty)<<6|48|a),this.chipEngine.write(Ei.MMC5,e+2,255&n),this.chipEngine.write(Ei.MMC5,e+3,8|n>>8&7);break}case Ei.SCC:{const e=Math.floor(3579545/(16*this.activeNoteFreq))-1,n=128;this.chipEngine.write(Ei.SCC,n+2*t,255&e),this.chipEngine.write(Ei.SCC,n+2*t+1,e>>8&15),this.chipEngine.write(Ei.SCC,n+10+t,15&a),this.chipEngine.write(Ei.SCC,n+15,1<<t);break}case Ei.SWAN:{const e=3072e3,n=2047&Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Ei.SWAN,2*t,255&n),this.chipEngine.write(Ei.SWAN,2*t+1,n>>8&7),this.chipEngine.write(Ei.SWAN,8+t,a<<4|a),this.chipEngine.write(Ei.SWAN,16,1<<t),this.chipEngine.write(Ei.SWAN,17,15);break}case Ei.VERA:{const e=25e6,n=65535&Math.floor(2097152*this.activeNoteFreq/e),s=4*t;this.chipEngine.write(Ei.VERA,s+0,255&n),this.chipEngine.write(Ei.VERA,s+1,n>>8&255),this.chipEngine.write(Ei.VERA,s+2,(63&a)<<2|3),this.chipEngine.write(Ei.VERA,s+3,63);break}case Ei.SM8521:{const e=756e3,n=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n)),r=[[71,70],[73,72],[77,76]],i=[66,68,74];this.chipEngine.write(Ei.SM8521,i[t]||66,31&a),r[t]&&(this.chipEngine.write(Ei.SM8521,r[t][0],s>>8&15),this.chipEngine.write(Ei.SM8521,r[t][1],255&s)),this.chipEngine.write(Ei.SM8521,64,128|1<<t);break}case Ei.BUBBLE:{const e=3579545,n=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n));this.chipEngine.write(Ei.BUBBLE,1&t,255&s),this.chipEngine.write(Ei.BUBBLE,2+(1&t),15&a);break}case Ei.X1_010:{const e=4194304,n=65535&Math.floor(this.activeNoteFreq*e/1e6),s=t<<3;this.chipEngine.write(Ei.X1_010,s+2,255&n),this.chipEngine.write(Ei.X1_010,s+3,n>>8&255),this.chipEngine.write(Ei.X1_010,s+1,a<<4),this.chipEngine.write(Ei.X1_010,s,3);break}case Ei.VB:{const e=5e6,n=Math.floor(2048-e/(16*this.activeNoteFreq)),s=Math.max(0,Math.min(2047,n)),r=1024+64*t;this.chipEngine.write(Ei.VB,r+8,2047-s&255),this.chipEngine.write(Ei.VB,r+12,2047-s>>8&7),this.chipEngine.write(Ei.VB,r+4,255),this.chipEngine.write(Ei.VB,r+16,(15&a)<<4),this.chipEngine.write(Ei.VB,r+20,0),this.chipEngine.write(Ei.VB,r+0,128);break}case Ei.LYNX:{const e=16e6,n=Math.floor(e/(256*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,n)),r=32+8*t;this.chipEngine.write(Ei.LYNX,r+0,a<<4|a),this.chipEngine.write(Ei.LYNX,r+1,1),this.chipEngine.write(Ei.LYNX,r+4,s),this.chipEngine.write(Ei.LYNX,r+5,128),this.chipEngine.write(Ei.LYNX,80,255);break}case Ei.SID:{const e=t*64;this.chipEngine.write(Ei.SID,e+0,1);break}case Ei.SID_6581:case Ei.SID_8580:{const e=7*t,a=45===this.config.chipType?Ei.SID_6581:Ei.SID_8580,n=0,s=8,r=15,i=8,o=64,l=1,c=2048;this.chipEngine.write(a,e+2,255&c),this.chipEngine.write(a,e+3,c>>8&15),this.chipEngine.write(a,e+5,n<<4|s),this.chipEngine.write(a,e+6,r<<4|i),this.chipEngine.write(a,e+4,o|l);break}case Ei.TIA:{const e=31440,n=Math.floor(e/(32*this.activeNoteFreq))-1,s=Math.max(0,Math.min(31,n)),r=0===t?21:22;this.chipEngine.write(Ei.TIA,r,4),this.chipEngine.write(Ei.TIA,r+2,31&s),this.chipEngine.write(Ei.TIA,r+4,15&a);break}case Ei.VIC:{const e=1022727;let n=Math.floor(256-e/(32*this.activeNoteFreq));n>>=t<3?2-t:1;const s=Math.max(0,Math.min(127,n));this.chipEngine.write(Ei.VIC,10+t,255-s),this.chipEngine.write(Ei.VIC,14,15&a);break}case Ei.TED:{const e=1773447,n=Math.floor(1024-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(1023,n));0===t?(this.chipEngine.write(Ei.TED,14,1022-s&255),this.chipEngine.write(Ei.TED,18,1022-s>>8&3)):(this.chipEngine.write(Ei.TED,15,1022-s&255),this.chipEngine.write(Ei.TED,16,1022-s>>8&3));const r=15&a|(0===t?16:32);this.chipEngine.write(Ei.TED,17,r);break}case Ei.SUPERVISION:{const e=4e6;if(t<2){const a=Math.floor(2*e/(32*this.activeNoteFreq)),n=Math.max(1,Math.min(2047,a)),s=16+4*t;this.chipEngine.write(Ei.SUPERVISION,s,255&n),this.chipEngine.write(Ei.SUPERVISION,s+1,n>>8&7);const r=30|(3&this.currentDuty)<<4;this.chipEngine.write(Ei.SUPERVISION,s+2,r),this.chipEngine.write(Ei.SUPERVISION,s+3,255)}else if(3===t){const e=15-(15&Math.floor(12*Math.log2(this.activeNoteFreq/440)+69))<<4|15&a;this.chipEngine.write(Ei.SUPERVISION,40,e),this.chipEngine.write(Ei.SUPERVISION,41,200),this.chipEngine.write(Ei.SUPERVISION,42,30)}break}case Ei.UPD1771:this.chipEngine.write(Ei.UPD1771,0,2);break;case Ei.OKI:this.chipEngine.write(Ei.OKI,t,128|a<<3);break;case Ei.SEGAPCM:{const e=8*t;this.chipEngine.write(Ei.SEGAPCM,e+134,255),this.chipEngine.write(Ei.SEGAPCM,e+2,a<<3),this.chipEngine.write(Ei.SEGAPCM,e+3,a<<3);break}case Ei.YMZ280B:{const e=4*t;this.chipEngine.write(Ei.YMZ280B,1+e,192|a<<1);break}case Ei.RF5C68:this.chipEngine.write(Ei.RF5C68,7,t),this.chipEngine.write(Ei.RF5C68,8,255&~(1<<t));break;case Ei.GA20:this.chipEngine.write(Ei.GA20,0+8*t+5,0);break;case Ei.C140:{const e=16*t;this.chipEngine.write(Ei.C140,e+5,96);break}case Ei.QSOUND:this.chipEngine.write(Ei.QSOUND,8*t+6,a<<4);break;case Ei.K007232:this.chipEngine.write(Ei.K007232,6*t+0,128);break;case Ei.K053260:this.chipEngine.write(Ei.K053260,40,1<<t);break;case Ei.ES5506:break;case Ei.OPN:{const e=t%3;this.chipEngine.write(Ei.OPN,40,e),this.chipEngine.write(Ei.OPN,40,240|e);break}case Ei.OPNB_B:{const e=[1,2,5,6,0,4][t%6];this.chipEngine.write(Ei.OPNB_B,40,e),this.chipEngine.write(Ei.OPNB_B,40,240|e);break}case Ei.ESFM:{const e=t%18,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(Ei.ESFM,a|176+e%9,n),this.chipEngine.write(Ei.ESFM,a|176+e%9,s);break}case Ei.AY8930:{const e=1789773,n=65535&Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Ei.AY8930,2*t,255&n),this.chipEngine.write(Ei.AY8930,2*t+1,n>>8&255),this.chipEngine.write(Ei.AY8930,8+t,31&a),this.chipEngine.write(Ei.AY8930,7,63&~(1<<t)),this.chipEngine.write(Ei.AY8930,22+t,8);break}case Ei.NDS:{const e=16*t,n=65535&Math.floor(65536*this.activeNoteFreq/32768);this.chipEngine.write(Ei.NDS,e+8,255&n),this.chipEngine.write(Ei.NDS,e+9,n>>8&255),this.chipEngine.write(Ei.NDS,e+3,128|a<<1);break}case Ei.GBA_DMA:this.chipEngine.write(Ei.GBA_DMA,130,11);break;case Ei.GBA_MINMOD:this.chipEngine.write(Ei.GBA_MINMOD,0,128|a);break;case Ei.POKEMINI:{const e=4e6,t=Math.floor(e/(16*this.activeNoteFreq)),n=Math.max(1,Math.min(65535,t));this.chipEngine.write(Ei.POKEMINI,74,255&n),this.chipEngine.write(Ei.POKEMINI,75,n>>8&255),this.chipEngine.write(Ei.POKEMINI,76,n>>1&255),this.chipEngine.write(Ei.POKEMINI,77,n>>1>>8&255),this.chipEngine.write(Ei.POKEMINI,72,4),this.chipEngine.write(Ei.POKEMINI,113,a>8?3:a>4?2:1);break}case Ei.NAMCO:{const e=4194304,n=1048575&Math.floor(this.activeNoteFreq*e/192e3);if(0===t)this.chipEngine.write(Ei.NAMCO,16,n>>4&15),this.chipEngine.write(Ei.NAMCO,17,15&n),this.chipEngine.write(Ei.NAMCO,18,n>>8&15),this.chipEngine.write(Ei.NAMCO,19,n>>12&15),this.chipEngine.write(Ei.NAMCO,20,n>>16&15);else{const e=21+5*(t-1);this.chipEngine.write(Ei.NAMCO,e+1,15&n),this.chipEngine.write(Ei.NAMCO,e+2,n>>8&15),this.chipEngine.write(Ei.NAMCO,e+3,n>>12&15),this.chipEngine.write(Ei.NAMCO,e+4,n>>16&15)}this.chipEngine.write(Ei.NAMCO,21+5*t,15&a),this.chipEngine.write(Ei.NAMCO,5+5*t,0);break}case Ei.PET:{const e=1e6,t=Math.floor(e/(16*this.activeNoteFreq))-1,a=Math.max(0,Math.min(65535,t));this.chipEngine.write(Ei.PET,8,255&a),this.chipEngine.write(Ei.PET,9,a>>8&255),this.chipEngine.write(Ei.PET,11,16);break}case Ei.POKEY:{const e=1789773,n=Math.floor(e/(2*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,n));this.chipEngine.write(Ei.POKEY,2*t,s),this.chipEngine.write(Ei.POKEY,2*t+1,160|15&a),this.chipEngine.write(Ei.POKEY,8,0),this.chipEngine.write(Ei.POKEY,15,3);break}case Ei.MSM6258:this.chipEngine.write(Ei.MSM6258,0,2);break;case Ei.MSM5232:this.chipEngine.write(Ei.MSM5232,t,128|a);break;case Ei.MULTIPCM:{const e=t<<3;this.chipEngine.write(Ei.MULTIPCM,e+4,128),this.chipEngine.write(Ei.MULTIPCM,e+5,15-a<<3);break}case Ei.AMIGA:{const e=3546895,n=Math.floor(e/(2*this.activeNoteFreq)),s=Math.max(124,Math.min(65535,n)),r=160+16*t;this.chipEngine.write(Ei.AMIGA,r+6,s>>8&255),this.chipEngine.write(Ei.AMIGA,r+7,255&s),this.chipEngine.write(Ei.AMIGA,r+8,4*a&127),this.chipEngine.write(Ei.AMIGA,150,32768|1<<t);break}case Ei.PCSPKR:{const e=1193182,t=Math.floor(e/this.activeNoteFreq),a=Math.max(1,Math.min(65535,t));this.chipEngine.write(Ei.PCSPKR,0,255&a),this.chipEngine.write(Ei.PCSPKR,1,a>>8&255);break}case Ei.PONG:this.chipEngine.write(Ei.PONG,0,1);break;case Ei.PV1000:{const e=3579545,a=Math.floor(63-e/(1024*this.activeNoteFreq)),n=Math.max(0,Math.min(62,a));this.chipEngine.write(Ei.PV1000,t,n);break}case Ei.DAVE:{const e=8e6,n=Math.floor(4096-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n));this.chipEngine.write(Ei.DAVE,2*t,255&s),this.chipEngine.write(Ei.DAVE,2*t+1,s>>8&15),this.chipEngine.write(Ei.DAVE,8+t,a<<2&63),this.chipEngine.write(Ei.DAVE,12+t,a<<2&63),this.chipEngine.write(Ei.DAVE,7,15);break}case Ei.SU:{const e=t<<3;this.chipEngine.write(Ei.SU,e+4,128|a);break}case Ei.BIFURCATOR:this.chipEngine.write(Ei.BIFURCATOR,t,a);break;case Ei.POWERNOISE:{const e=t<<2;this.chipEngine.write(Ei.POWERNOISE,e+0,128|a);break}case Ei.ZXBEEPER:{const e=35e5,t=Math.floor(e/(2*this.activeNoteFreq));this.chipEngine.write(Ei.ZXBEEPER,0,255&t),this.chipEngine.write(Ei.ZXBEEPER,1,t>>8&255);break}case Ei.ZXBEEPER_QT:{const e=35e5,a=Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Ei.ZXBEEPER_QT,2*t,255&a),this.chipEngine.write(Ei.ZXBEEPER_QT,2*t+1,a>>8&255);break}case Ei.SCVTONE:{const e=3579545,n=Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Ei.SCVTONE,2*t,255&n),this.chipEngine.write(Ei.SCVTONE,2*t+1,n>>8&15|a<<4);break}case Ei.PCMDAC:this.chipEngine.write(Ei.PCMDAC,0,128|a)}}triggerRelease(e){if(this.isNoteOn=!1,!this.useWasmEngine)return this;const t=os()-this.noteOnTime;if(t<Li.MIN_GATE_TIME){setTimeout(()=>this.writeKeyOff(),1e3*(Li.MIN_GATE_TIME-t))}else this.writeKeyOff();return this}writeKeyOff(){if(!this.wasmNoteTriggered)return;this.wasmNoteTriggered=!1;const e=this.channelIndex;switch(this.config.chipType){case Ei.OPN2:{const t=e%3,a=e<3?0:1,n=0===a?0:256,s=a<<2|t;this.chipEngine.write(Ei.OPN2,40,s);const r=[0,8,4,12];for(let e=0;e<4;e++){const a=r[e]+t;this.chipEngine.write(Ei.OPN2,n|64+a,127)}this.chipEngine.deactivate(Ei.OPN2);break}case Ei.OPM:{const t=7&e;this.chipEngine.write(Ei.OPM,8,t);const a=[0,16,8,24];for(let n=0;n<4;n++){const t=a[n]+(7&e);this.chipEngine.write(Ei.OPM,96+t,127)}this.chipEngine.deactivate(Ei.OPM);break}case Ei.OPL3:{const t=e%9,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Ei.OPL3,a|176+t,n);break}case Ei.OPLL:{const t=e%9,a=3579545;let n=0,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-n)/a);for(;s>511&&n<7;)n++,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-n)/a);s=Math.min(511,Math.max(0,s));const r=(7&n)<<1|s>>8&1;this.chipEngine.write(Ei.OPLL,32+t,r);break}case Ei.OPNA:{const t=(e<3?0:1)<<2|e%3;this.chipEngine.write(Ei.OPNA,40,t);break}case Ei.OPNB:{const t=[1,2,5,6][3&e];this.chipEngine.write(Ei.OPNB,40,t);break}case Ei.OPN:{const t=e%3;this.chipEngine.write(Ei.OPN,40,t);break}case Ei.OPZ:{const t=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7;this.chipEngine.write(Ei.OPZ,32+(7&e),t),this.chipEngine.deactivate(Ei.OPZ);break}case Ei.Y8950:case Ei.OPL4:{const t=this.config.chipType,a=e%9,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(t,176+a,n);break}case Ei.PSG:this.chipEngine.write(Ei.PSG,0,159|(3&e)<<5);break;case Ei.AY:this.chipEngine.write(Ei.AY,8+e,0);break;case Ei.SAA:this.chipEngine.write(Ei.SAA,0+e,0),this.chipEngine.write(Ei.SAA,20,0);break;case Ei.T6W28:this.chipEngine.write(Ei.T6W28,0,159|(3&e)<<5),this.chipEngine.write(Ei.T6W28,1,159|(3&e)<<5);break;case Ei.NES:if(e<2){const t=16384+4*e;this.chipEngine.write(Ei.NES,t,48)}else 2===e?this.chipEngine.write(Ei.NES,16392,0):3===e&&this.chipEngine.write(Ei.NES,16396,48);break;case Ei.GB:{const t=16+5*e;e<2?this.chipEngine.write(Ei.GB,t+2,8):2===e?this.chipEngine.write(Ei.GB,28,0):3===e&&this.chipEngine.write(Ei.GB,33,8);break}case Ei.PCE:this.chipEngine.write(Ei.PCE,0,7&e),this.chipEngine.write(Ei.PCE,5,0);break;case Ei.SNES:this.chipEngine.write(Ei.SNES,92,1<<(7&e));break;case Ei.VB:{const t=1024+64*e;this.chipEngine.write(Ei.VB,t+16,0);break}case Ei.LYNX:{const t=32+8*e;this.chipEngine.write(Ei.LYNX,t+0,0);break}case Ei.VRC6:if(e<2){const t=0===e?36864:40960;this.chipEngine.write(Ei.VRC6,t,0)}else this.chipEngine.write(Ei.VRC6,45056,0);break;case Ei.N163:this.chipEngine.write(Ei.N163,127,0);break;case Ei.FDS:this.chipEngine.write(Ei.FDS,16512,128);break;case Ei.MMC5:{const t=0===e?20480:20484;this.chipEngine.write(Ei.MMC5,t,48);break}case Ei.SCC:this.chipEngine.write(Ei.SCC,170+e,0);break;case Ei.SWAN:this.chipEngine.write(Ei.SWAN,8+e,0);break;case Ei.VERA:{const t=4*e;this.chipEngine.write(Ei.VERA,t+2,0);break}case Ei.SM8521:{const t=[66,68,74][e]||66;this.chipEngine.write(Ei.SM8521,t,0);break}case Ei.BUBBLE:this.chipEngine.write(Ei.BUBBLE,2+e,0);break;case Ei.X1_010:{const t=e<<3;this.chipEngine.write(Ei.X1_010,t,0);break}case Ei.SID:{const t=0,a=e*64;this.chipEngine.write(Ei.SID,a+t,0);break}case Ei.SID_6581:case Ei.SID_8580:{const t=7*e,a=45===this.config.chipType?Ei.SID_6581:Ei.SID_8580;this.chipEngine.write(a,t+4,0);break}case Ei.TIA:this.chipEngine.write(Ei.TIA,25+e,0);break;case Ei.VIC:this.chipEngine.write(Ei.VIC,10+e,0);break;case Ei.TED:this.chipEngine.write(Ei.TED,17,0);break;case Ei.SUPERVISION:{const t=16+4*e;this.chipEngine.write(Ei.SUPERVISION,t+2,0);break}case Ei.UPD1771:this.chipEngine.write(Ei.UPD1771,0,0);break;case Ei.YMZ280B:{const t=4*e;this.chipEngine.write(Ei.YMZ280B,1+t,64);break}case Ei.RF5C68:this.chipEngine.write(Ei.RF5C68,8,255);break;case Ei.GA20:{const t=8*e;this.chipEngine.write(Ei.GA20,t+5,0),this.chipEngine.write(Ei.GA20,t+6,0);break}case Ei.SEGAPCM:{const t=8*(15&e);this.chipEngine.write(Ei.SEGAPCM,134+t,0);break}case Ei.K007232:this.chipEngine.write(Ei.K007232,12,0);break;case Ei.K053260:this.chipEngine.write(Ei.K053260,40,0);break;case Ei.QSOUND:{const t=e%16,a=t<8?6+8*t:70+8*(t-8);this.chipEngine.write(Ei.QSOUND,0,0),this.chipEngine.write(Ei.QSOUND,1,0),this.chipEngine.write(Ei.QSOUND,2,a);break}case Ei.C140:{const t=16*(e%24);this.chipEngine.write(Ei.C140,t+5,0);break}case Ei.ES5506:case Ei.OKI:break;case Ei.OPN:{const t=e%3;this.chipEngine.write(Ei.OPN,40,t);break}case Ei.OPNB_B:{const t=[1,2,5,6][3&e];this.chipEngine.write(Ei.OPNB_B,40,t);break}case Ei.ESFM:{const t=e%9,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Ei.ESFM,a|176+t,n);break}case Ei.AY8930:this.chipEngine.write(Ei.AY8930,8+e,0);break;case Ei.NDS:{const t=16*e;this.chipEngine.write(Ei.NDS,t+3,0);break}case Ei.GBA_DMA:this.chipEngine.write(Ei.GBA_DMA,132,0);break;case Ei.GBA_MINMOD:this.chipEngine.write(Ei.GBA_MINMOD,132,0);break;case Ei.POKEMINI:this.chipEngine.write(Ei.POKEMINI,113,0);break;case Ei.NAMCO:{const t=8*e;this.chipEngine.write(Ei.NAMCO,21+t,0);break}case Ei.PET:this.chipEngine.write(Ei.PET,0,0);break;case Ei.POKEY:this.chipEngine.write(Ei.POKEY,2*e+1,0);break;case Ei.MSM6258:this.chipEngine.write(Ei.MSM6258,0,1);break;case Ei.MSM5232:{const t=10+e;this.chipEngine.write(Ei.MSM5232,t,0);break}case Ei.MULTIPCM:{const t=8*e;this.chipEngine.write(Ei.MULTIPCM,t+5,0);break}case Ei.AMIGA:this.chipEngine.write(Ei.AMIGA,150,1<<e);break;case Ei.PCSPKR:this.chipEngine.write(Ei.PCSPKR,97,0);break;case Ei.PONG:break;case Ei.PV1000:this.chipEngine.write(Ei.PV1000,252+e,0);break;case Ei.DAVE:{const t=8+3*e+2;this.chipEngine.write(Ei.DAVE,t,0);break}case Ei.SU:{const t=e<<5;this.chipEngine.write(Ei.SU,t+2,0);break}case Ei.BIFURCATOR:break;case Ei.POWERNOISE:{const t=4*e;this.chipEngine.write(Ei.POWERNOISE,t,0);break}case Ei.ZXBEEPER:case Ei.ZXBEEPER_QT:break;case Ei.SCVTONE:this.chipEngine.write(Ei.SCVTONE,e,0);break;case Ei.PCMDAC:this.chipEngine.write(Ei.PCMDAC,0,128)}}dispose(){this.output.disconnect()}}function Bi(e){switch(e){case Gi.GENESIS:case Gi.GENESIS_EXT:case Gi.YM2151:case Gi.YM2612:case Gi.YM2203:case Gi.YM2203_EXT:case Gi.YM2608:case Gi.YM2608_EXT:case Gi.YM2610:case Gi.YM2610_EXT:case Gi.YM2610B:case Gi.YM2610B_EXT:case Gi.ARCADE:case Gi.TX81Z:case Gi.OPL:case Gi.OPL2:case Gi.OPL3:case Gi.OPL4:case Gi.OPLL:case Gi.VRC7:case Gi.ESFM:return"fm";case Gi.AY8910:case Gi.AY8930:case Gi.SMS:case Gi.SAA1099:case Gi.T6W28:return"psg";case Gi.C64_6581:case Gi.C64_8580:case Gi.SID2:case Gi.SID3:return"c64";case Gi.SNES:return"snes";case Gi.GB:return"gb";case Gi.NES:case Gi.NES_VRC7:case Gi.NES_FDS:case Gi.VRC6:case Gi.MMC5:case Gi.FDS:return"nes";case Gi.PCE:return"pce";case Gi.NAMCO:case Gi.NAMCO_15XX:case Gi.NAMCO_CUS30:case Gi.N163:return"namco";case Gi.AMIGA:case Gi.SEGAPCM:case Gi.QSOUND:case Gi.MULTIPCM:case Gi.RF5C68:case Gi.MSM6295:case Gi.MSM6258:case Gi.YMZ280B:case Gi.K007232:case Gi.K053260:case Gi.GA20:case Gi.C140:case Gi.ES5506:return"sample";default:return"other"}}class Vi{platformType;family;effectMemory=new Map;constructor(e=Gi.GB){this.platformType=e,this.family=Bi(e)}setPlatform(e){this.platformType=e,this.family=Bi(e)}getMemory(e,t){const a=this.effectMemory.get(e);return a?a.get(t)??0:0}setMemory(e,t,a){this.effectMemory.has(e)||this.effectMemory.set(e,new Map),this.effectMemory.get(e).set(t,a)}resetMemory(){this.effectMemory.clear()}routeEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];0===n?n=this.getMemory(t,a):this.setMemory(t,a,n);const r=n>>4&15,i=15&n;switch(a){case 0:0!==n&&s.push({cmd:Hi.NOTE_PORTA,chan:t,val1:r,val2:i});break;case 1:s.push({cmd:Hi.PITCH,chan:t,val1:n,val2:0});break;case 2:s.push({cmd:Hi.PITCH,chan:t,val1:-n,val2:0});break;case 3:s.push({cmd:Hi.NOTE_PORTA,chan:t,val1:n,val2:1});break;case 4:s.push({cmd:Hi.HINT_VIBRATO,chan:t,val1:r,val2:i});break;case 7:s.push({cmd:Hi.HINT_TREMOLO,chan:t,val1:r,val2:i});break;case 8:s.push({cmd:Hi.PANNING,chan:t,val1:n,val2:n});break;case 10:s.push({cmd:Hi.HINT_VOL_SLIDE,chan:t,val1:r,val2:i});break;case 12:s.push({cmd:Hi.VOLUME,chan:t,val1:n,val2:0});break;case 14:s.push(...this.routeExtendedEffect(this.platformType,t,r,i));break;default:s.push(...this.routePlatformEffect(this.platformType,t,a,n))}return s}routeExtendedEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];switch(a){case 1:s.push({cmd:Hi.PITCH,chan:t,val1:n,val2:0});break;case 2:s.push({cmd:Hi.PITCH,chan:t,val1:-n,val2:0});break;case 3:s.push({cmd:Hi.LEGATO,chan:t,val1:n,val2:0});break;case 4:s.push({cmd:Hi.HINT_VIBRATO_SHAPE,chan:t,val1:n,val2:0});break;case 5:s.push({cmd:Hi.PITCH,chan:t,val1:n-8,val2:1});break;case 9:s.push({cmd:Hi.NOTE_ON,chan:t,val1:-1,val2:n});break;case 10:s.push({cmd:Hi.HINT_VOL_SLIDE,chan:t,val1:n,val2:0});break;case 11:s.push({cmd:Hi.HINT_VOL_SLIDE,chan:t,val1:0,val2:n});break;case 12:s.push({cmd:Hi.NOTE_OFF,chan:t,val1:n,val2:0});break;case 13:s.push({cmd:Hi.PRE_NOTE,chan:t,val1:n,val2:0});break;case 15:s.push({cmd:Hi.MACRO_ON,chan:t,val1:n,val2:0})}return s.push(...this.routePlatformExtendedEffect(this.platformType,t,a,n)),s}routePlatformEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];switch(this.family){case"fm":s.push(...this.routeFMEffect(t,a,n));break;case"c64":s.push(...this.routeC64Effect(t,a,n));break;case"snes":s.push(...this.routeSNESEffect(t,a,n));break;case"gb":s.push(...this.routeGBEffect(t,a,n));break;case"nes":s.push(...this.routeNESEffect(t,a,n));break;case"pce":s.push(...this.routePCEEffect(t,a,n));break;case"psg":s.push(...this.routePSGEffect(t,a,n));break;case"namco":s.push(...this.routeNamcoEffect(t,a,n));break;case"sample":s.push(...this.routeSampleEffect(t,a,n))}return s}routePlatformExtendedEffect(e,t,a,n){const s=[];switch(e!==this.platformType&&this.setPlatform(e),this.family){case"gb":6===a&&s.push({cmd:Hi.GB_SWEEP_TIME,chan:t,val1:n,val2:0});break;case"nes":6===a&&s.push({cmd:Hi.NES_SWEEP,chan:t,val1:n,val2:0});break;case"c64":6===a&&s.push({cmd:Hi.C64_FILTER_MODE,chan:t,val1:n,val2:0})}return s}routeFMEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:Hi.FM_LFO,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.FM_TL,chan:e,val1:s,val2:8*r});break;case 18:n.push({cmd:Hi.FM_AR,chan:e,val1:s,val2:2*r});break;case 19:n.push({cmd:Hi.FM_DR,chan:e,val1:s,val2:2*r});break;case 20:n.push({cmd:Hi.FM_MULT,chan:e,val1:s,val2:r});break;case 21:n.push({cmd:Hi.FM_RR,chan:e,val1:s,val2:r});break;case 22:n.push({cmd:Hi.FM_SL,chan:e,val1:s,val2:r});break;case 23:n.push({cmd:Hi.FM_DT,chan:e,val1:s,val2:r});break;case 24:n.push({cmd:Hi.FM_FB,chan:e,val1:a>>4,val2:0});break;case 25:n.push({cmd:Hi.FM_FB,chan:e,val1:0,val2:7&a});break;case 26:n.push({cmd:Hi.FM_SSG,chan:e,val1:s,val2:r});break;case 27:n.push({cmd:Hi.FM_AM_DEPTH,chan:e,val1:s,val2:0}),n.push({cmd:Hi.FM_PM_DEPTH,chan:e,val1:r,val2:0});break;case 31:n.push({cmd:Hi.FM_HARD_RESET,chan:e,val1:a,val2:0})}return n}routeC64Effect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.C64_CUTOFF,chan:e,val1:8*a,val2:0});break;case 17:n.push({cmd:Hi.C64_FINE_CUTOFF,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.C64_RESONANCE,chan:e,val1:15&a,val2:0});break;case 19:n.push({cmd:Hi.C64_FILTER_MODE,chan:e,val1:7&a,val2:0});break;case 20:n.push({cmd:Hi.C64_EXTENDED,chan:e,val1:0,val2:a});break;case 21:n.push({cmd:Hi.C64_EXTENDED,chan:e,val1:1,val2:a});break;case 22:n.push({cmd:Hi.C64_DUTY_RESET,chan:e,val1:16*a,val2:0});break;case 23:n.push({cmd:Hi.C64_FINE_DUTY,chan:e,val1:a,val2:0})}return n}routeSNESEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.SNES_ECHO,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.SNES_ECHO_DELAY,chan:e,val1:15&a,val2:0});break;case 18:n.push({cmd:Hi.SNES_ECHO_FEEDBACK,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:Hi.SNES_ECHO_VOL_LEFT,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:Hi.SNES_ECHO_VOL_RIGHT,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:Hi.SNES_ECHO_FIR,chan:e,val1:a,val2:0});break;case 22:n.push({cmd:Hi.SNES_PITCH_MOD,chan:e,val1:a,val2:0});break;case 23:n.push({cmd:Hi.SNES_GAIN_MODE,chan:e,val1:a,val2:0});break;case 24:n.push({cmd:Hi.SNES_GAIN,chan:e,val1:a,val2:0});break;case 25:n.push({cmd:Hi.SNES_INVERT,chan:e,val1:a,val2:0})}return n}routeGBEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:Hi.GB_SWEEP_TIME,chan:e,val1:s,val2:0}),n.push({cmd:Hi.GB_SWEEP_DIR,chan:e,val1:r>>3,val2:0});break;case 17:n.push({cmd:Hi.WAVE,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.STD_NOISE_MODE,chan:e,val1:a,val2:0})}return n}routeNESEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:Hi.NES_SWEEP,chan:e,val1:s,val2:r});break;case 17:n.push({cmd:Hi.NES_DMC,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.NES_ENV_MODE,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:Hi.NES_LENGTH,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:Hi.FDS_MOD_DEPTH,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:Hi.FDS_MOD_HIGH,chan:e,val1:a,val2:0});break;case 22:n.push({cmd:Hi.FDS_MOD_LOW,chan:e,val1:a,val2:0})}return n}routePCEEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.PCE_LFO_MODE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.PCE_LFO_SPEED,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.WAVE,chan:e,val1:a,val2:0})}return n}routePSGEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.AY_ENVELOPE_SET,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.AY_ENVELOPE_LOW,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.AY_ENVELOPE_HIGH,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:Hi.AY_AUTO_ENVELOPE,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:Hi.STD_NOISE_FREQ,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:Hi.STD_NOISE_MODE,chan:e,val1:a,val2:0})}return n}routeNamcoEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.WAVE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.N163_WAVE_POSITION,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.N163_WAVE_LENGTH,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:Hi.N163_WAVE_LOADPOS,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:Hi.N163_CHANNEL_LIMIT,chan:e,val1:a,val2:0})}return n}routeSampleEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:Hi.SAMPLE_MODE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:Hi.SAMPLE_BANK,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:Hi.SAMPLE_DIR,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:Hi.SAMPLE_POS,chan:e,val1:a<<8,val2:0});break;case 20:n.push({cmd:Hi.ES5506_FILTER_MODE,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:Hi.ES5506_FILTER_K1,chan:e,val1:a<<8,val2:65280});break;case 22:n.push({cmd:Hi.ES5506_FILTER_K2,chan:e,val1:a<<8,val2:65280});break;case 23:n.push({cmd:Hi.QSOUND_ECHO_FEEDBACK,chan:e,val1:a,val2:0});break;case 24:n.push({cmd:Hi.QSOUND_ECHO_LEVEL,chan:e,val1:a,val2:0});break;case 25:n.push({cmd:Hi.QSOUND_SURROUND,chan:e,val1:a,val2:0})}return n}clearMemory(){this.effectMemory.clear()}clearChannelMemory(e){this.effectMemory.delete(e)}}let zi=null;function Ui(){return zi||(zi=new Vi),zi}new Proxy({},{get:(e,t)=>Ui()[t],set:(e,t,a)=>(Ui()[t]=a,!0)});const Gi={GENESIS:2,GENESIS_EXT:3,ARCADE:13,NES_VRC7:9,NES_FDS:10,SMS:4,GB:6,PCE:7,NES:8,SNES:26,SWAN:43,LYNX:60,VBOY:47,NDS:103,POKEMINI:45,TIA:21,POKEY:41,C64_6581:11,C64_8580:12,PET:25,VIC20:24,TED:97,FDS:29,MMC5:30,N163:31,VRC6:27,VRC7:48,AY:17,AY8910:17,AY8930:23,SAA1099:22,T6W28:83,YM2612:20,YM2151:19,TX81Z:44,YM2203:32,YM2203_EXT:33,YM2608:34,YM2608_EXT:35,YM2610:57,YM2610_EXT:58,YM2610B:49,YM2610B_EXT:63,OPL:36,OPL2:37,OPL3:38,OPL4:67,OPLL:28,ESFM:100,AMIGA:18,SEGAPCM:46,SEGAPCM_COMPAT:64,MULTIPCM:39,QSOUND:61,RF5C68:42,PCM_DAC:86,ES5506:69,K007232:84,K053260:96,GA20:85,C140:98,C219:99,YMZ280B:76,MSM6258:75,MSM6295:74,SCC:53,SCC_PLUS:72,NAMCO:77,NAMCO_15XX:78,NAMCO_CUS30:79,BUBSYS_WSG:66,X1_010:65,VERA:62,SOUND_UNIT:73,PCSPKR:40,PONG:87,PV1000:95,MSM5232:82,SM8521:94,DAVE:102,POWERNOISE:101,SFX_BEEPER:50,GBA_DMA:104,GBA_MINMOD:105,SID2:108,SID3:111,SUPERVISION:109,UPD1771C:110},Wi=10,Hi={NOTE_ON:0,NOTE_OFF:1,INSTRUMENT:4,VOLUME:5,NOTE_PORTA:8,PITCH:9,PANNING:10,LEGATO:11,PRE_NOTE:13,HINT_VIBRATO:14,HINT_VIBRATO_SHAPE:16,HINT_VOL_SLIDE:20,HINT_TREMOLO:24,SAMPLE_MODE:28,SAMPLE_BANK:30,SAMPLE_POS:31,SAMPLE_DIR:32,FM_HARD_RESET:33,FM_LFO:34,FM_TL:36,FM_AR:38,FM_DR:39,FM_SL:40,FM_RR:42,FM_DT:43,FM_SSG:50,FM_FB:53,FM_MULT:54,FM_AM_DEPTH:58,FM_PM_DEPTH:59,STD_NOISE_FREQ:62,STD_NOISE_MODE:63,WAVE:64,GB_SWEEP_TIME:65,GB_SWEEP_DIR:66,PCE_LFO_MODE:67,PCE_LFO_SPEED:68,NES_SWEEP:69,NES_DMC:70,C64_CUTOFF:71,C64_RESONANCE:72,C64_FILTER_MODE:73,C64_DUTY_RESET:77,C64_EXTENDED:78,C64_FINE_DUTY:79,C64_FINE_CUTOFF:80,AY_ENVELOPE_SET:81,AY_ENVELOPE_LOW:82,AY_ENVELOPE_HIGH:83,AY_AUTO_ENVELOPE:87,FDS_MOD_DEPTH:90,FDS_MOD_HIGH:91,FDS_MOD_LOW:92,QSOUND_ECHO_FEEDBACK:100,QSOUND_ECHO_LEVEL:102,QSOUND_SURROUND:103,N163_WAVE_POSITION:113,N163_WAVE_LENGTH:114,N163_WAVE_LOADPOS:117,N163_CHANNEL_LIMIT:120,SNES_ECHO:132,SNES_PITCH_MOD:133,SNES_INVERT:134,SNES_GAIN_MODE:135,SNES_GAIN:136,SNES_ECHO_DELAY:138,SNES_ECHO_VOL_LEFT:139,SNES_ECHO_VOL_RIGHT:140,SNES_ECHO_FEEDBACK:141,SNES_ECHO_FIR:142,NES_ENV_MODE:143,NES_LENGTH:144,MACRO_ON:147,ES5506_FILTER_MODE:151,ES5506_FILTER_K1:152,ES5506_FILTER_K2:153},Ki=1;class $i{static instance=null;workletNode=null;_nativeCtx=null;initialized=!1;initializing=!1;chips=new Map;_audioRouted=!1;_sharedGain=null;_wasmReadyResolve=null;_wasmReadyReject=null;_wasmReadyPromise=null;_chipCreatedResolve=null;_chipCreatedPromise=null;oscCallbacks=new Set;latestOscData=[];static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;effectRouter=new Vi;constructor(){}static getInstance(){return $i.instance||($i.instance=new $i),$i.instance}get isInitialized(){return this.initialized}getChannelCount(e){return void 0!==e?this.chips.get(e)?.numChannels??0:this.chips.values().next().value?.numChannels??0}get channelCount(){return this.getChannelCount()}get platform(){return this.chips.keys().next().value??0}get handle(){return this.chips.values().next().value?.handle??0}hasChip(e){return this.chips.has(e)}get audioRouted(){return this._audioRouted}getOrCreateSharedGain(){if(this._sharedGain)return this._sharedGain;const e=this.getWorkletNode(),t=this.getNativeCtx();return e&&t?(this._sharedGain=t.createGain(),e.connect(this._sharedGain),this._sharedGain.connect(t.destination),this._audioRouted=!0,this._sharedGain):null}async init(e){if(!this.initialized&&!this.initializing){this.initializing=!0;try{const n=es(e);if(!n)throw new Error("Could not get native AudioContext");if(this._nativeCtx=n,"running"!==n.state)try{await n.resume()}catch(t){throw new Error(`AudioContext not running (state: ${n.state})`)}if("running"!==n.state)throw new Error(`AudioContext still not running after resume (state: ${n.state})`);await $i.ensureModuleLoaded(n);try{this.workletNode=new AudioWorkletNode(n,"furnace-dispatch-processor",{outputChannelCount:[2],processorOptions:{sampleRate:n.sampleRate}})}catch(a){throw a}this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this._wasmReadyPromise=new Promise((e,t)=>{this._wasmReadyResolve=e,this._wasmReadyReject=t,setTimeout(()=>t(new Error("FurnaceDispatch WASM ready timeout after 10s")),1e4)}),this.workletNode.port.postMessage({type:"init",sampleRate:n.sampleRate,wasmBinary:$i.wasmBinary,jsCode:$i.jsCode}),await this._wasmReadyPromise;try{const e=n.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(n.destination)}catch(t){}this.initialized=!0}catch(n){throw n}finally{this.initializing=!1}}}static async ensureModuleLoaded(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/",a=`?v=${Date.now()}`;if("running"!==e.state)try{await e.resume()}catch(n){}try{await e.audioWorklet.addModule(`${t}furnace-dispatch/FurnaceDispatch.worklet.js${a}`)}catch(n){const e=n?.message||String(n);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load FurnaceDispatch worklet: ${e}`)}if(!this.wasmBinary||!this.jsCode){const[e,n]=await Promise.all([fetch(`${t}furnace-dispatch/FurnaceDispatch.wasm${a}`,{cache:"no-store"}),fetch(`${t}furnace-dispatch/FurnaceDispatch.js${a}`,{cache:"no-store"})]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar createFurnaceDispatch = createFurnaceDispatch || Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}handleWorkletMessage(e){switch(e.type){case"ready":this._wasmReadyResolve&&(this._wasmReadyResolve(),this._wasmReadyResolve=null);break;case"chipCreated":this.chips.set(e.platformType,{handle:e.handle,numChannels:e.numChannels});let t=0;for(const e of this.chips.values())t+=e.numChannels;this.latestOscData=new Array(t).fill(null),this._chipCreatedResolve&&(this._chipCreatedResolve(),this._chipCreatedResolve=null);break;case"oscData":this.latestOscData=e.channels;for(const a of this.oscCallbacks)a(e.channels);break;case"error":this._wasmReadyReject&&(this._wasmReadyReject(new Error(e.message)),this._wasmReadyReject=null,this._wasmReadyResolve=null)}}async createChip(e,t){this._nativeCtx&&await $i.ensureModuleLoaded(this._nativeCtx),this.workletNode&&(this._chipCreatedPromise=new Promise(e=>{this._chipCreatedResolve=e}),this.workletNode.port.postMessage({type:"createChip",platformType:e,sampleRate:t}))}async waitForChipCreated(){this._chipCreatedPromise&&await this._chipCreatedPromise}dispatch(e,t,a=0,n=0,s){this.workletNode&&this.workletNode.port.postMessage({type:"dispatch",cmd:e,chan:t,val1:a,val2:n,platformType:s})}noteOn(e,t,a){this.dispatch(Hi.NOTE_ON,e,t,0,a)}noteOff(e,t){this.dispatch(Hi.NOTE_OFF,e,0,0,t)}setInstrument(e,t,a){this.dispatch(Hi.INSTRUMENT,e,t,0,a)}setVolume(e,t,a){this.dispatch(Hi.VOLUME,e,t,0,a)}setGBInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setGBInstrument",insIndex:e,insData:t,platformType:a})}setWavetable(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",waveIndex:e,waveData:t,platformType:a})}setFMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setFMInstrument",insIndex:e,insData:t,platformType:a})}setC64Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setC64Instrument",insIndex:e,insData:t,platformType:a})}setNESInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setNESInstrument",insIndex:e,insData:t,platformType:a})}setSNESInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setSNESInstrument",insIndex:e,insData:t,platformType:a})}setN163Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setN163Instrument",insIndex:e,insData:t,platformType:a})}setFDSInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setFDSInstrument",insIndex:e,insData:t,platformType:a})}uploadFurnaceInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:a})}setAmigaInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setAmigaInstrument",insIndex:e,insData:t,platformType:a})}setMultiPCMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setMultiPCMInstrument",insIndex:e,insData:t,platformType:a})}setES5506Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setES5506Instrument",insIndex:e,insData:t,platformType:a})}setESFMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setESFMInstrument",insIndex:e,insData:t,platformType:a})}setWaveSynth(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWaveSynth",insIndex:e,insData:t,platformType:a})}setMacro(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setMacro",insIndex:e,macroData:t,platformType:a})}setInstrumentFull(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:a})}setSample(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setSample",sampleIndex:e,sampleData:t,platformType:a})}renderSamples(e){this.workletNode&&this.workletNode.port.postMessage({type:"renderSamples",platformType:e})}setMacrosEnabled(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMacrosEnabled",enabled:e,platformType:t})}clearMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"clearMacros",insIndex:e,platformType:t})}releaseMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"releaseMacros",chan:e,platformType:t})}setCompatFlags(e,t){if(!this.workletNode)return;const a=new Uint8Array(57);a[0]=e.limitSlides?1:0,a[1]=e.linearPitch??2,a[2]=e.pitchSlideSpeed??0,a[3]=e.loopModality??0,a[4]=e.delayBehavior??0,a[5]=e.jumpTreatment??0,a[6]=e.properNoiseLayout?1:0,a[7]=e.waveDutyIsVol?1:0,a[8]=e.resetMacroOnPorta?1:0,a[9]=e.legacyVolumeSlides?1:0,a[10]=e.compatibleArpeggio?1:0,a[11]=e.noteOffResetsSlides?1:0,a[12]=e.targetResetsSlides?1:0,a[13]=e.arpNonPorta?1:0,a[14]=e.algMacroBehavior?1:0,a[15]=e.brokenShortcutSlides?1:0,a[16]=e.ignoreDuplicateSlides?1:0,a[17]=e.stopPortaOnNoteOff?1:0,a[18]=e.continuousVibrato?1:0,a[19]=e.brokenDACMode?1:0,a[20]=e.oneTickCut?1:0,a[21]=e.newInsTriggersInPorta?1:0,a[22]=e.arp0Reset?1:0,a[23]=e.brokenSpeedSel?1:0,a[24]=e.noSlidesOnFirstTick?1:0,a[25]=e.rowResetsArpPos?1:0,a[26]=e.ignoreJumpAtEnd?1:0,a[27]=e.buggyPortaAfterSlide?1:0,a[28]=e.gbInsAffectsEnvelope?1:0,a[29]=e.sharedExtStat?1:0,a[30]=e.ignoreDACModeOutsideChannel?1:0,a[31]=e.e1e2AlsoTakePriority?1:0,a[32]=e.newSegaPCM?1:0,a[33]=e.fbPortaPause?1:0,a[34]=e.snDutyReset?1:0,a[35]=e.pitchMacroIsLinear?1:0,a[36]=e.oldOctaveBoundary?1:0,a[37]=e.noOPN2Vol?1:0,a[38]=e.newVolumeScaling?1:0,a[39]=e.volMacroLinger?1:0,a[40]=e.brokenOutVol?1:0,a[41]=e.brokenOutVol2?1:0,a[42]=e.e1e2StopOnSameNote?1:0,a[43]=e.brokenPortaArp?1:0,a[44]=e.snNoLowPeriods?1:0,a[45]=e.disableSampleMacro?1:0,a[46]=e.oldArpStrategy?1:0,a[47]=e.brokenPortaLegato?1:0,a[48]=e.brokenFMOff?1:0,a[49]=e.preNoteNoEffect?1:0,a[50]=e.oldDPCM?1:0,a[51]=e.resetArpPhaseOnNewNote?1:0,a[52]=e.ceilVolumeScaling?1:0,a[53]=e.oldAlwaysSetVolume?1:0,a[54]=e.oldSampleOffset?1:0,a[55]=e.oldCenterRate?1:0,a[56]=e.noVolSlideReset?1:0,this.workletNode.port.postMessage({type:"setCompatFlags",flags:a,platformType:t})}setCompatFlag(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setCompatFlag",flagIndex:e,value:t,platformType:a})}resetCompatFlags(e){this.workletNode&&this.workletNode.port.postMessage({type:"resetCompatFlags",platformType:e})}setLinearPitch(e,t){this.setCompatFlag(Ki,e,t)}setTickRate(e){this.workletNode&&this.workletNode.port.postMessage({type:"setTickRate",hz:e})}reset(e){this.workletNode&&this.workletNode.port.postMessage({type:"reset",platformType:e})}forceIns(e){this.workletNode&&this.workletNode.port.postMessage({type:"forceIns",platformType:e})}mute(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"mute",chan:e,mute:t,platformType:a})}onOscData(e){return this.oscCallbacks.add(e),()=>{this.oscCallbacks.delete(e)}}getOscData(){return this.latestOscData}getWorkletNode(){return this.workletNode}getNativeCtx(){return this._nativeCtx}dispatchFM(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchC64(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchSNES(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchGB(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchNES(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchAY(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchES5506(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchN163(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchSample(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchMacro(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}applyEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routeEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}applyExtendedEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routeExtendedEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}applyPlatformEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routePlatformEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}resetEffectMemory(){this.effectRouter.resetMemory()}getEffectRouter(){return this.effectRouter}dispose(){if(this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.chips.clear(),this._audioRouted=!1,this._sharedGain){try{this._sharedGain.disconnect()}catch{}this._sharedGain=null}this.oscCallbacks.clear(),this.latestOscData=[],$i.instance=null}}const qi=n(e=>({channelData:[],numChannels:0,platformType:0,isActive:!1,updateChannelData:t=>e({channelData:t,isActive:!0}),setChipInfo:(t,a)=>e({numChannels:t,platformType:a,channelData:new Array(t).fill(null)}),clear:()=>e({channelData:[],numChannels:0,platformType:0,isActive:!1})})),Xi={[Gi.GB]:["PU1","PU2","WAV","NOI"],[Gi.NES]:["PU1","PU2","TRI","NOI","DPCM"],[Gi.SMS]:["SQ1","SQ2","SQ3","NOI"],[Gi.AY]:["A","B","C"],[Gi.AY8930]:["A","B","C"],[Gi.PCE]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Gi.SNES]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Gi.VRC6]:["PU1","PU2","SAW"],[Gi.FDS]:["FDS"],[Gi.MMC5]:["PU1","PU2","PCM"],[Gi.N163]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Gi.C64_6581]:["V1","V2","V3"],[Gi.C64_8580]:["V1","V2","V3"],[Gi.VIC20]:["BASS","ALT","SOP","NOI"],[Gi.SAA1099]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Gi.TIA]:["AUD0","AUD1"],[Gi.POKEY]:["CH1","CH2","CH3","CH4"],[Gi.LYNX]:["CH1","CH2","CH3","CH4"],[Gi.SWAN]:["CH1","CH2","CH3","CH4"],[Gi.VERA]:["PU1","PU2","PU3","PU4","PU5","PU6","PU7","PU8","PU9","PU10","PU11","PU12","PU13","PU14","PU15","PU16","PCM"],[Gi.SCC]:["CH1","CH2","CH3","CH4","CH5"],[Gi.VBOY]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Gi.AMIGA]:["CH1","CH2","CH3","CH4"],[Gi.PET]:["CH"],[Gi.PCSPKR]:["SPK"],[Gi.SFX_BEEPER]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Gi.PONG]:["CH"],[Gi.TED]:["SQ1","SQ2"],[Gi.POKEMINI]:["CH"],[Gi.PV1000]:["CH1","CH2","CH3"],[Gi.SOUND_UNIT]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Gi.NAMCO]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Gi.QSOUND]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8","CH9","CH10","CH11","CH12","CH13","CH14","CH15","CH16"],[Gi.DAVE]:["CH1","CH2","CH3","NOI"]},Yi={[Gi.GB]:15,[Gi.SMS]:15,[Gi.NES]:15,[Gi.PCE]:31,[Gi.VIC20]:15,[Gi.TIA]:15,[Gi.POKEY]:15,[Gi.PV1000]:15,[Gi.POKEMINI]:3,[Gi.PONG]:1,[Gi.PCSPKR]:1,[Gi.SFX_BEEPER]:15,[Gi.TED]:8,[Gi.VRC6]:15,[Gi.MMC5]:15,[Gi.SWAN]:15,[Gi.LYNX]:127};function Qi(e){return Yi[e]??127}class Zi{name="FurnaceDispatchSynth";output;engine;_disposed=!1;_ready=!1;_readyPromise;_resolveReady;currentChannel=0;platformType;activeNotes=new Map;_releaseTimeouts=new Map;_volumeOffsetDb=0;furnaceInstrumentIndex=0;constructor(e=Gi.GB){this.output=Jn().createGain(),this.platformType=e,this.engine=$i.getInstance(),this._readyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize()}get ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}setFurnaceInstrumentIndex(e){this.furnaceInstrumentIndex=e}async uploadInstrumentFromConfig(e,t){await this.ensureInitialized();const{updateFurnaceInstrument:a}=await _a(async()=>{const{updateFurnaceInstrument:e}=await import("./FurnaceInstrumentEncoder-DUItTP_3.js");return{updateFurnaceInstrument:e}},[]),n=a(e,t,this.furnaceInstrumentIndex);this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,n,this.platformType)}async uploadInstrumentData(e){e&&0!==e.length&&(await this.ensureInitialized(),this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,e,this.platformType))}setVolumeOffset(e){this._volumeOffsetDb=e;const t=this._nativeGain;t&&(t.gain.value=Math.pow(10,e/20))}async initialize(){try{const e=Jn();if(await this.engine.init(e),this._disposed)return;const t=this.engine.getNativeCtx()?.sampleRate??e.sampleRate;await this.engine.createChip(this.platformType,t),await this.engine.waitForChipCreated();const a=this.engine.getOrCreateSharedGain();a&&(this._nativeGain=a,0!==this._volumeOffsetDb&&(a.gain.value=Math.pow(10,this._volumeOffsetDb/20))),this.setupDefaultInstrument(),this._ready=!0,this._resolveReady();const n=qi.getState(),s=this.getChannelNames();n.setChipInfo(s.length,this.platformType),this.engine.onOscData(e=>{qi.getState().updateChannelData(e)})}catch(e){this._resolveReady()}}setupDefaultInstrument(){const e=Gi,t=this.platformType,a=this.engine.getChannelCount(t)||4,n=Qi(t),s=(e,a,n=0,s=0)=>this.engine.dispatch(e,a,n,s,t),r=(e,a)=>this.engine.setInstrument(e,a,t),i=(e,a)=>this.engine.setVolume(e,a,t);switch(t){case e.GB:this.setupDefaultGBInstrument();break;case e.PCE:this.setupDefaultWavetable(32,31);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.SCC:case e.SCC_PLUS:this.setupDefaultWavetable(32,255);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.VBOY:this.setupDefaultWavetable(32,63);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.NAMCO:case e.NAMCO_15XX:case e.NAMCO_CUS30:case e.BUBSYS_WSG:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.SWAN:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.FDS:this.setupDefaultWavetable(64,63),s(Hi.WAVE,0,0,0);break;case e.N163:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.X1_010:case e.SOUND_UNIT:this.setupDefaultWavetable(32,255);for(let e=0;e<a;e++)s(Hi.WAVE,e,0,0);break;case e.AMIGA:case e.SEGAPCM:case e.SEGAPCM_COMPAT:case e.RF5C68:case e.K007232:case e.K053260:case e.GA20:case e.GBA_DMA:case e.GBA_MINMOD:case e.NDS:case e.MSM6295:case e.YMZ280B:case e.QSOUND:case e.MULTIPCM:this.loadTestSample8bit(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.MSM6258:this.loadTestSampleVOX(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.ES5506:case e.C140:case e.C219:case e.PCM_DAC:this.loadTestSample16bit(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.SNES:this.loadTestSampleBRR(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n)}if(![e.AMIGA,e.SEGAPCM,e.SEGAPCM_COMPAT,e.RF5C68,e.K007232,e.K053260,e.GA20,e.GBA_DMA,e.GBA_MINMOD,e.NDS,e.MSM6295,e.YMZ280B,e.QSOUND,e.MULTIPCM,e.MSM6258,e.ES5506,e.C140,e.C219,e.PCM_DAC,e.SNES].includes(t))for(let o=0;o<a;o++)r(o,0),i(o,n)}setupDefaultGBInstrument(){const e=this.platformType,t=new Uint8Array([15,0,2,0,0,1,0,0]);this.engine.setGBInstrument(0,t,e);for(let r=0;r<4;r++)this.engine.setInstrument(r,0,e),this.engine.setVolume(r,15,e);const a=32,n=new Uint8Array(136),s=new DataView(n.buffer);s.setInt32(0,a,!0),s.setInt32(4,15,!0);for(let r=0;r<a;r++){const e=r<16?Math.round(r/16*15):Math.round((a-r)/16*15);s.setInt32(8+4*r,e,!0)}this.engine.setWavetable(0,n,e)}setupDefaultWavetable(e,t){const a=new Uint8Array(8+4*e),n=new DataView(a.buffer);n.setInt32(0,e,!0),n.setInt32(4,t,!0);for(let s=0;s<e;s++){const a=Math.round(s/(e-1)*t);n.setInt32(8+4*s,a,!0)}this.engine.setWavetable(0,a,this.platformType)}buildSampleHeader(e,t,a=8363,n=0,s,r=!0){const i=new DataView(new ArrayBuffer(32));return i.setUint32(0,e,!0),i.setInt32(4,n,!0),i.setInt32(8,s??e,!0),i.setUint8(12,t),i.setUint8(13,0),i.setUint8(14,0),i.setUint8(15,0),i.setUint32(16,a,!0),i.setUint8(22,r?1:0),i}loadTestSample8bit(){const e=new Uint8Array(64),t=this.buildSampleHeader(32,8,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let a=0;a<32;a++)e[32+a]=a<16?127:128;this.engine.setSample(0,e,this.platformType)}loadTestSample16bit(){const e=new Uint8Array(96),t=this.buildSampleHeader(32,16,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));const a=new DataView(e.buffer);for(let n=0;n<32;n++){const e=n<16?32767:-32768;a.setInt16(32+2*n,e,!0)}this.engine.setSample(0,e,this.platformType)}loadTestSampleBRR(){const e=Math.ceil(2),t=new Uint8Array(32+9*e),a=this.buildSampleHeader(32,9,8363);new Uint8Array(t.buffer,0,32).set(new Uint8Array(a.buffer));for(let n=0;n<e;n++){const a=32+9*n,s=n===e-1;t[a]=194|(s?1:0);for(let e=0;e<8;e++){const s=16*n+2*e,r=s<16?7:8,i=s+1<16?7:8;t[a+1+e]=(15&r)<<4|15&i}}this.engine.setSample(0,t,this.platformType)}loadTestSampleVOX(){const e=new Uint8Array(48.5),t=this.buildSampleHeader(32,Wi,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let a=0;a<16.5;a++){const t=2*a,n=t<16?15:0,s=t+1<16?15:0;e[32+a]=n<<4|s}this.engine.setSample(0,e,this.platformType)}getChannelNames(){const e=Xi[this.platformType];if(e)return e;const t=this.engine.getChannelCount(this.platformType)||1;return Array.from({length:t},(e,t)=>`CH${t+1}`)}getNumChannels(){return this.engine.getChannelCount(this.platformType)}onOscData(e){return this.engine.onOscData(e)}getOscData(){return this.engine.getOscData()}triggerAttack(e,t,a=1){if(!this._ready||this._disposed)return;const n="string"==typeof e?rs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,s=this.currentChannel,r=this._releaseTimeouts.get(s);r&&(clearTimeout(r),this._releaseTimeouts.delete(s));const i=this.platformType;this.engine.setInstrument(s,this.furnaceInstrumentIndex,i);const o=Qi(i),l=Math.round(a*o);this.engine.setVolume(s,l,i),this.engine.noteOn(s,n,i),this.activeNotes.set(n,s)}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n);const s=this.engine.getNativeCtx();if(s){const n=this.currentChannel,r=(a??s.currentTime)+t,i=setTimeout(()=>{this._releaseTimeouts.delete(n),this.triggerRelease(e)},Math.max(0,1e3*(r-s.currentTime)));this._releaseTimeouts.set(n,i)}}triggerRelease(e,t){if(this._ready&&!this._disposed)if(void 0!==e){const t="string"==typeof e?rs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,a=this.activeNotes.get(t);void 0!==a&&(this.engine.noteOff(a,this.platformType),this.activeNotes.delete(t))}else{for(const[,e]of this.activeNotes)this.engine.noteOff(e,this.platformType);this.activeNotes.clear()}}releaseAll(){this.triggerRelease()}setChannel(e){this.currentChannel=e}sendCommand(e,t,a=0,n=0){this._ready&&!this._disposed&&this.engine.dispatch(e,t,a,n,this.platformType)}applyEffect(e,t,a){this._ready&&!this._disposed&&this.engine.applyEffect(a??this.currentChannel,e,t,this.platformType)}applyExtendedEffect(e,t,a){this._ready&&!this._disposed&&this.engine.applyExtendedEffect(a??this.currentChannel,e,t,this.platformType)}applyPlatformEffect(e,t,a){this._ready&&!this._disposed&&this.engine.applyPlatformEffect(a??this.currentChannel,e,t,this.platformType)}resetEffectMemory(){this.engine.resetEffectMemory()}setGBInstrument(e,t){this.engine.setGBInstrument(e,t,this.platformType)}setWavetable(e,t){this.engine.setWavetable(e,t,this.platformType)}renderSamples(){this.engine.renderSamples(this.platformType)}setParam(e,t){switch(e){case"volume":this.engine.setVolume(this.currentChannel,t,this.platformType);break;case"channel":this.currentChannel=t}}dispose(){this._disposed=!0,this.activeNotes.clear();for(const e of this._releaseTimeouts.values())clearTimeout(e);this._releaseTimeouts.clear(),this._nativeGain=null,this.output.disconnect()}}class Ji{name="DrumKitSynth";config;sampleBuffers=new Map;activeVoices=[];audioContext;outputGain;output;onSampleNeeded;constructor(e){this.config=e,this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=.8,this.outputGain.connect(this.output)}setSampleLoader(e){this.onSampleNeeded=e}async preloadSamples(){if(!this.onSampleNeeded)return;const e=this.config.keymap.map(async e=>{if(!this.sampleBuffers.has(e.id)){const t=await this.onSampleNeeded(e.sampleId,e.sampleUrl);t&&this.sampleBuffers.set(e.id,t)}});await Promise.all(e)}loadSample(e,t){this.sampleBuffers.set(e,t)}findMapping(e){for(const t of this.config.keymap)if(e>=t.noteStart&&e<=t.noteEnd)return t;return null}noteToMidiNumber(e){return"number"==typeof e?e+11:function(e){if("number"==typeof e)return e+11;if(null==e||""===e||"..."===e||"==="===e)return 60;const t=e.match(/^([A-G])([#b])?-?(\d)$/i);if(!t)return 60;const[,a,n,s]=t,r=parseInt(s,10),i=a.toUpperCase(),o=n?i+n:i+"-",l=zn.indexOf(o);return-1===l?60:12*(r+1)+l}(e)}triggerAttack(e,t,a=.8){const n=this.noteToMidiNumber(e),s=this.findMapping(n);if(!s)return;const r=this.sampleBuffers.get(s.id);if(!r)return;if(this.activeVoices.length>=this.config.maxVoices){const e=this.activeVoices.shift();e&&this.disposeVoice(e)}if("mono"===this.config.polyphony||this.config.noteCut){this.activeVoices.filter(e=>e.mappingId===s.id).forEach(e=>{this.disposeVoice(e);const t=this.activeVoices.indexOf(e);-1!==t&&this.activeVoices.splice(t,1)})}const i=this.calculatePlaybackRate(s,n),o=this.audioContext.createBufferSource();o.buffer=r,o.playbackRate.value=i;const l=(s.panOffset||0)/100,c=this.audioContext.createStereoPanner();c.pan.value=l;const u=Math.pow(10,(s.volumeOffset||0)/20),d=this.audioContext.createGain();d.gain.value=a*u,o.connect(c),c.connect(d),d.connect(this.outputGain);const p=t??os();o.start(p);const h={source:o,panner:c,gain:d,midiNote:n,mappingId:s.id,startTime:p};this.activeVoices.push(h);const m=r.duration/i;setTimeout(()=>{const e=this.activeVoices.indexOf(h);-1!==e&&(this.activeVoices.splice(e,1),this.disposeVoice(h))},1e3*(m+.1))}calculatePlaybackRate(e,t){let a=1;if(e.pitchOffset&&(a*=Math.pow(2,e.pitchOffset/12)),e.fineTune&&(a*=Math.pow(2,e.fineTune/1200)),e.baseNote){const n=t-this.noteToMidiNumber(e.baseNote);a*=Math.pow(2,n/12)}return Math.max(.1,Math.min(4,a))}triggerRelease(e,t){const a=this.noteToMidiNumber(e);this.activeVoices.filter(e=>e.midiNote===a).forEach(e=>{const a=t??os();e.gain.gain.setValueAtTime(e.gain.gain.value,a),e.gain.gain.linearRampToValueAtTime(0,a+.05),setTimeout(()=>{const t=this.activeVoices.indexOf(e);-1!==t&&(this.activeVoices.splice(t,1),this.disposeVoice(e))},100)})}disposeVoice(e){try{e.source.stop()}catch(t){}try{e.source.disconnect(),e.panner.disconnect(),e.gain.disconnect()}catch(t){}}releaseAll(){this.activeVoices.forEach(e=>this.disposeVoice(e)),this.activeVoices=[]}updateConfig(e){this.config={...this.config,...e}}getKeymap(){return[...this.config.keymap]}addMapping(e){this.config.keymap.push(e)}removeMapping(e){const t=this.config.keymap.findIndex(t=>t.id===e);-1!==t&&(this.config.keymap.splice(t,1),this.sampleBuffers.delete(e))}clearKeymap(){this.config.keymap=[],this.sampleBuffers.clear(),this.releaseAll()}dispose(){this.releaseAll(),this.sampleBuffers.clear(),this.outputGain.disconnect(),this.output.disconnect()}}const eo={type:"sine",frequency:440},to={enabled:!0,type:"square",rate:2,depth:100},ao={enabled:!0,time:.3,feedback:.4,wet:.3},no={enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},so={enabled:!0,decay:1.5,wet:.1};class ro{name="DubSirenSynth";output;osc;filter;reverb;delay;distortion;gate;_toneOutput;signal;lfo;constructor(e){const t={oscillator:{...eo,...e?.oscillator},lfo:{...to,...e?.lfo},delay:{...ao,...e?.delay},filter:{...no,...e?.filter},reverb:{...so,...e?.reverb}};this.output=Jn().createGain(),this._toneOutput=new P(0);const a=as(this._toneOutput);a&&a.connect(this.output),this.reverb=new y({decay:t.reverb.decay,wet:t.reverb.enabled?t.reverb.wet:0}),this.delay=new _({delayTime:t.delay.time,feedback:t.delay.feedback,wet:t.delay.enabled?t.delay.wet:0}),this.filter=new m({frequency:t.filter.frequency,type:t.filter.type,rolloff:t.filter.rolloff,Q:1}),this.distortion=new b(.1),this.gate=new p(0),this.osc=new T({type:t.oscillator.type}),this.signal=new A({units:"frequency",value:t.oscillator.frequency}),this.lfo=new v({type:t.lfo.type,frequency:t.lfo.rate,amplitude:1,min:-t.lfo.depth,max:t.lfo.depth}),this.osc.frequency.value=0,this.signal.connect(this.osc.frequency),t.lfo.enabled&&(this.lfo.connect(this.osc.frequency),this.lfo.start()),this.osc.connect(this.gate),this.gate.connect(this.filter),this.filter.connect(this.distortion),this.distortion.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.osc.start()}applyConfig(e){this.osc.type=e.oscillator.type,this.setFrequency(e.oscillator.frequency),this.lfo.type=e.lfo.type,this.setLFORate(e.lfo.rate),this.setLFODepth(e.lfo.depth),e.lfo.enabled?"started"!==this.lfo.state&&(this.lfo.start(),this.lfo.connect(this.osc.frequency)):(this.lfo.stop(),this.lfo.disconnect()),this.setDelayTime(e.delay.time),this.setDelayFeedback(e.delay.feedback),this.setDelayMix(e.delay.enabled?e.delay.wet:0),this.setFilterFreq(e.filter.frequency),this.filter.type=e.filter.type,this.filter.rolloff=e.filter.rolloff,this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,a){const n=t||os();if(e){const t=is(e);this.signal.setValueAtTime(t,n)}this.gate.gain.cancelScheduledValues(n),this.gate.gain.setValueAtTime(1,n)}triggerRelease(e){const t=e||os();this.gate.gain.cancelScheduledValues(t),this.gate.gain.setValueAtTime(0,t)}setOscType(e){this.osc.type=e}setFrequency(e){this.signal.rampTo(e,.1)}setLFOType(e){this.lfo.type=e}setLFORate(e){this.lfo.frequency.rampTo(e,.1)}setLFODepth(e){this.lfo.min=-e,this.lfo.max=e}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.delay.delayTime.rampTo(t,.1)}setDelayFeedback(e){this.delay.feedback.rampTo(e,.1)}setDelayMix(e){this.delay.wet.rampTo(e,.1)}setFilterFreq(e){this.filter.frequency.rampTo(e,.1)}dispose(){this.osc.dispose(),this.gate.dispose(),this.filter.dispose(),this.distortion.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect(),this.signal.dispose(),this.lfo.dispose()}get volume(){return this._toneOutput.volume}}class io{name="SpaceLaserSynth";output;synth;filter;noise;noiseGain;reverb;delay;_toneOutput;config;constructor(e){this.config=e,this.output=Jn().createGain(),this._toneOutput=new P(0);const t=as(this._toneOutput);t&&t.connect(this.output),this.reverb=new y({decay:e.reverb.decay,wet:e.reverb.enabled?e.reverb.wet:0}),this.delay=new _({delayTime:e.delay.time,feedback:e.delay.feedback,wet:e.delay.enabled?e.delay.wet:0}),this.filter=new m({frequency:e.filter.cutoff,type:e.filter.type,Q:e.filter.resonance/10}),this.synth=new O({harmonicity:e.fm.ratio,modulationIndex:e.fm.amount,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1},modulationEnvelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1}}),this.noise=new I({type:e.noise.type,volume:-1/0}),this.noiseGain=new p(e.noise.amount/100),this.noise.connect(this.noiseGain),this.synth.connect(this.filter),this.noiseGain.connect(this.filter),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.noise.start()}applyConfig(e){this.config=e,this.synth.harmonicity.value=e.fm.ratio,this.synth.modulationIndex.value=e.fm.amount,this.synth.envelope.decay=e.laser.sweepTime/1e3,this.synth.modulationEnvelope.decay=e.laser.sweepTime/1e3,this.noise.type=e.noise.type,this.noiseGain.gain.rampTo(e.noise.amount/100,.1),this.filter.type=e.filter.type,this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.delay.delayTime.rampTo(e.delay.time,.1),this.delay.feedback.rampTo(e.delay.feedback,.1),this.delay.wet.rampTo(e.delay.enabled?e.delay.wet:0,.1),this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,a=1){const n=t||os(),s=this.config.laser.sweepTime/1e3,r=e?is(e):this.config.laser.startFreq,i=this.config.laser.endFreq;this.synth.triggerAttack(r,n,a),this.synth.frequency.cancelScheduledValues(n+.001),"exponential"===this.config.laser.sweepCurve?this.synth.frequency.exponentialRampToValueAtTime(i,n+s):this.synth.frequency.linearRampToValueAtTime(i,n+s),this.synth.triggerRelease(n+s)}triggerRelease(e){const t=null==e?os():e;this.synth.triggerRelease(t)}dispose(){this.noise.stop(),this.synth.dispose(),this.filter.dispose(),this.noise.dispose(),this.noiseGain.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}class oo{name="SynareSynth";output;osc1;osc2;noise;osc1Gain;osc2Gain;noiseGain;filter;ampEnv;_toneOutput;filterFreqEnv;pitchEnv;lfo;lfoGain;config;constructor(e){this.config=e,this.osc1=new T({type:"square",frequency:e.oscillator.tune}),this.osc2=new T({type:"square",frequency:e.oscillator.tune}),this.noise=new I({type:e.noise.type}),this.osc1Gain=new p(1),this.osc2Gain=new p(e.oscillator2.enabled?e.oscillator2.mix:0),this.noiseGain=new p(e.noise.enabled?e.noise.mix:0),this.filter=new m({frequency:e.filter.cutoff,type:"lowpass",rolloff:-24,Q:e.filter.resonance/10}),this.ampEnv=new D({attack:.005,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain,release:.1}),this.output=Jn().createGain(),this._toneOutput=new P(0);const t=as(this._toneOutput);t&&t.connect(this.output),this.filterFreqEnv=new F({attack:.005,decay:e.filter.decay/1e3,sustain:0,release:.1}),this.pitchEnv=new F({attack:.005,decay:e.sweep.time/1e3,sustain:0,release:.1}),this.lfo=new v({frequency:e.lfo.rate,amplitude:e.lfo.depth/100}),this.lfoGain=new p(0),this.lfo.connect(this.lfoGain),this.lfo.start(),this.osc1.connect(this.osc1Gain),this.osc2.connect(this.osc2Gain),this.noise.connect(this.noiseGain);const a=new p(1);this.osc1Gain.connect(a),this.osc2Gain.connect(a),this.noiseGain.connect(a),a.connect(this.filter),this.filter.connect(this.ampEnv),this.ampEnv.connect(this._toneOutput),this.applyConfig(e),this.osc1.start(),this.osc2.start(),this.noise.start()}applyConfig(e){this.config=e,this.osc1.frequency.rampTo(e.oscillator.tune,.1),this.osc2.frequency.rampTo(e.oscillator.tune*Math.pow(2,e.oscillator2.detune/12),.1),this.osc1Gain.gain.rampTo(1,.1),this.osc2Gain.gain.rampTo(e.oscillator2.enabled?e.oscillator2.mix:0,.1),this.noiseGain.gain.rampTo(e.noise.enabled?e.noise.mix:0,.1),this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.ampEnv.decay=e.envelope.decay/1e3,this.ampEnv.sustain=e.envelope.sustain,this.filterFreqEnv.decay=e.filter.decay/1e3,this.pitchEnv.decay=e.sweep.time/1e3,this.lfo.frequency.rampTo(e.lfo.rate,.1),this.lfoGain.gain.rampTo(e.lfo.enabled?e.lfo.depth/100:0,.1)}triggerAttack(e,t,a){const n=t||os();if(e){const t=is(e);this.osc1.frequency.setValueAtTime(t,n),this.osc2.frequency.setValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),n)}if(this.ampEnv.triggerAttack(n,a),this.config.filter.envMod>0){const e=Math.min(2e4,this.config.filter.cutoff+100*this.config.filter.envMod);this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(this.config.filter.cutoff,n),this.filter.frequency.exponentialRampToValueAtTime(e,n+.005),this.filter.frequency.exponentialRampToValueAtTime(this.config.filter.cutoff,n+this.config.filter.decay/1e3)}if(this.config.sweep.enabled){const t=e?is(e):this.config.oscillator.tune,a=t*Math.pow(2,this.config.sweep.amount/12);this.osc1.frequency.cancelScheduledValues(n),this.osc2.frequency.cancelScheduledValues(n),this.osc1.frequency.setValueAtTime(a,n),this.osc1.frequency.exponentialRampToValueAtTime(t,n+this.config.sweep.time/1e3),this.osc2.frequency.setValueAtTime(a*Math.pow(2,this.config.oscillator2.detune/12),n),this.osc2.frequency.exponentialRampToValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),n+this.config.sweep.time/1e3)}}triggerRelease(e){const t=e||os();this.ampEnv.triggerRelease(t)}updateParameter(e,t){this.applyConfig(this.config)}dispose(){this.osc1.dispose(),this.osc2.dispose(),this.noise.dispose(),this.osc1Gain.dispose(),this.osc2Gain.dispose(),this.noiseGain.dispose(),this.filter.dispose(),this.ampEnv.dispose(),this.filterFreqEnv.dispose(),this.pitchEnv.dispose(),this.lfo.dispose(),this.lfoGain.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}let lo=(e,t)=>0!==(e&t),co=e=>{let t=new Uint8Array(e.length);return e.split("").forEach((e,a)=>{t[a]=e.charCodeAt(0)}),t},uo=e=>{let t=new Uint8Array(4);return t[0]=e,t[1]=e>>8,t[2]=e>>16,t[3]=e>>24,t},po=e=>{let t=new Uint8Array(2);return t[0]=e,t[1]=e>>8,t},ho=null,mo=e=>{if(null===ho&&(ho=new AudioContext),!ho)throw new Error("No player available!");return((e,t)=>{let a,n=new Promise((n,s)=>{let r=e.createBufferSource(),i=e.createBuffer(1,t.length,22050),o=i.getChannelData(0);for(let e=0;e<t.length;e++)o[e]=t[e];r.buffer=i,r.connect(e.destination),r.onended=()=>{n(!0)},a=e=>{r.disconnect(),s(e)},r.start(0)});return n.abort=a,n})(ho,e)},fo=e=>{let t=new Uint8Array(44+e.length),a=0,n=e=>{t.set(e,a),a+=e.length};return n(co("RIFF")),n(uo(e.length+12+16+8-8)),n(co("WAVE")),n(co("fmt ")),n(uo(16)),n(po(1)),n(po(1)),n(uo(22050)),n(uo(22050)),n(po(1)),n(po(8)),n(co("data")),n(uo(e.length)),n(e),t},go={" ":0,"!":2,'"':2,"#":2,$:2,"%":2,"&":2,"'":130,"(":0,")":0,"*":2,"+":2,",":2,"-":2,".":2,"/":2,0:3,1:3,2:3,3:3,4:3,5:3,6:3,7:3,8:3,9:3,":":2,";":2,"<":2,"=":2,">":2,"?":2,"@":2,A:192,B:168,C:176,D:172,E:192,F:160,G:184,H:160,I:192,J:188,K:160,L:172,M:168,N:172,O:192,P:160,Q:160,R:172,S:180,T:164,U:192,V:168,W:168,X:176,Y:192,Z:188,"[":0,"\\":0,"]":0,"^":2,_:0,"`":32},yo='(A)=|(!)=.|(") =-AH5NKWOWT-|(")=KWOW4T-|(#)= NAH4MBER|($)= DAA4LER|(%)= PERSEH4NT|(&)= AEND|(\')=|(*)= AE4STERIHSK|(+)= PLAH4S|(,)=,| (-) =-|(-)=|(.)= POYNT|(/)= SLAE4SH|(0)= ZIY4ROW| (1ST)=FER4ST| (10TH)=TEH4NTH|(1)= WAH4N| (2ND)=SEH4KUND|(2)= TUW4| (3RD)=THER4D|(3)= THRIY4|(4)= FOH4R| (5TH)=FIH4FTH|(5)= FAY4V| (64) =SIH4KSTIY FOHR|(6)= SIH4KS|(7)= SEH4VUN| (8TH)=EY4TH|(8)= EY4T|(9)= NAY4N|(:)=.|(;)=.|(<)= LEH4S DHAEN|(=)= IY4KWULZ|(>)= GREY4TER DHAEN|(?)=?|(@)= AE6T|(^)= KAE4RIXT',bo=128,vo=(e,t)=>0!==(go[e]&t),xo=(e,t,a)=>vo(e[t],a),wo=(e,t)=>-1!==t.indexOf(e),ko=e=>{let t=e.split("=");const a=t.pop(),n=t.join("=").split("("),s=n.pop().split(")"),r=n[0],i=s[0],o=s[1];let l=["T","C","S"],c=["E","I","Y"],u=(e,t)=>!!e.startsWith(i,t)&&(!!((e,t)=>{for(let a=r.length-1;a>-1;a--){let n=r[a];if(vo(n,bo)){if(e[--t]!==n)return!1}else if(!{" ":()=>!xo(e,--t,bo),"#":()=>xo(e,--t,64),".":()=>xo(e,--t,8),"&":()=>xo(e,--t,16)||wo(e.substr(--t,2),["CH","SH"]),"@":()=>{if(xo(e,--t,4))return!0;let a=e[t];if("H"!==a)return!1;if(!wo(a,l))return!1;throw new Error("Is always false but happened? "+a)},"^":()=>xo(e,--t,32),"+":()=>wo(e[--t],c),":":()=>{for(;t>=0&&xo(e,t-1,32);)t--;return!0}}[n]())return!1}return!0})(e,t)&&((e,t)=>{for(let a=0;a<o.length;a++){let n=o[a];if(vo(n,bo)){if(e[++t]!==n)return!1}else if(!{" ":()=>!xo(e,++t,bo),"#":()=>xo(e,++t,64),".":()=>xo(e,++t,8),"&":()=>xo(e,++t,16)||wo(e.substr(++t-2,2),["HC","HS"]),"@":()=>{if(xo(e,++t,4))return!0;let a=e[t];if("H"!==a)return!1;if(!wo(a,l))return!1;throw new Error("This should not be possible ",a)},"^":()=>xo(e,++t,32),"+":()=>wo(e[++t],c),":":()=>{for(;xo(e,t+1,32);)t++;return!0},"%":()=>"E"!==e[t+1]?"ING"===e.substr(t+1,3)&&(t+=3,!0):xo(e,t+2,bo)?wo(e[t+2],["R","S","D"])?(t+=2,!0):"L"!==e[t+2]?"FUL"===e.substr(t+2,3)&&(t+=4,!0):"Y"===e[t+3]&&(t+=3,!0):(t++,!0)}[n]())return!1}return!0})(e,t+(i.length-1))),d=(e,t,n)=>{if(u(e,t))return n(a,i.length),!0};return d.c=i[0],d},So={};" (A.)=EH4Y. |(A) =AH| (ARE) =AAR| (AR)O=AXR|(AR)#=EH4R| ^(AS)#=EY4S|(A)WA=AX|(AW)=AO5| :(ANY)=EH4NIY|(A)^+#=EY5|#:(ALLY)=ULIY| (AL)#=UL|(AGAIN)=AXGEH4N|#:(AG)E=IHJ|(A)^%=EY|(A)^+:#=AE| :(A)^+ =EY4| (ARR)=AXR|(ARR)=AE4R| ^(AR) =AA5R|(AR)=AA5R|(AIR)=EH4R|(AI)=EY4|(AY)=EY5|(AU)=AO4|#:(AL) =UL|#:(ALS) =ULZ|(ALK)=AO4K|(AL)^=AOL| :(ABLE)=EY4BUL|(ABLE)=AXBUL|(A)VO=EY4|(ANG)+=EY4NJ|(ATARI)=AHTAA4RIY|(A)TOM=AE|(A)TTI=AE| (AT) =AET| (A)T=AH|(A)=AE| (B) =BIY4| (BE)^#=BIH|(BEING)=BIY4IHNX| (BOTH) =BOW4TH| (BUS)#=BIH4Z|(BREAK)=BREY5K|(BUIL)=BIH4L|(B)=B| (C) =SIY4| (CH)^=K|^E(CH)=K|(CHA)R#=KEH5|(CH)=CH| S(CI)#=SAY4|(CI)A=SH|(CI)O=SH|(CI)EN=SH|(CITY)=SIHTIY|(C)+=S|(CK)=K|(COMMODORE)=KAA4MAHDOHR|(COM)=KAHM|(CUIT)=KIHT|(CREA)=KRIYEY|(C)=K| (D) =DIY4| (DR.) =DAA4KTER|#:(DED) =DIHD|.E(D) =D|#:^E(D) =T| (DE)^#=DIH| (DO) =DUW| (DOES)=DAHZ|(DONE) =DAH5N|(DOING)=DUW4IHNX| (DOW)=DAW|#(DU)A=JUW|#(DU)^#=JAX|(D)=D| (E) =IYIY4|#:(E) =|':^(E) =| :(E) =IY|#(ED) =D|#:(E)D =|(EV)ER=EH4V|(E)^%=IY4|(ERI)#=IY4RIY|(ERI)=EH4RIH|#:(ER)#=ER|(ERROR)=EH4ROHR|(ERASE)=IHREY5S|(ER)#=EHR|(ER)=ER| (EVEN)=IYVEHN|#:(E)W=|@(EW)=UW|(EW)=YUW|(E)O=IY|#:&(ES) =IHZ|#:(E)S =|#:(ELY) =LIY|#:(EMENT)=MEHNT|(EFUL)=FUHL|(EE)=IY4|(EARN)=ER5N| (EAR)^=ER5|(EAD)=EHD|#:(EA) =IYAX|(EA)SU=EH5|(EA)=IY5|(EIGH)=EY4|(EI)=IY4| (EYE)=AY4|(EY)=IY|(EU)=YUW5|(EQUAL)=IY4KWUL|(E)=EH| (F) =EH4F|(FUL)=FUHL|(FRIEND)=FREH5ND|(FATHER)=FAA4DHER|(F)F=|(F)=F| (G) =JIY4|(GIV)=GIH5V| (G)I^=G|(GE)T=GEH5|SU(GGES)=GJEH4S|(GG)=G| B#(G)=G|(G)+=J|(GREAT)=GREY4T|(GON)E=GAO5N|#(GH)=| (GN)=N|(G)=G| (H) =EY4CH| (HAV)=/HAE6V| (HERE)=/HIYR| (HOUR)=AW5ER|(HOW)=/HAW|(H)#=/H|(H)=| (IN)=IHN| (I) =AY4|(I) =AY|(IN)D=AY5N|SEM(I)=IY| ANT(I)=AY|(IER)=IYER|#:R(IED) =IYD|(IED) =AY5D|(IEN)=IYEHN|(IE)T=AY4EH|(I')=AY5| :(I)^%=AY5| :(IE) =AY4|(I)%=IY|(IE)=IY4| (IDEA)=AYDIY5AH|(I)^+:#=IH|(IR)#=AYR|(IZ)%=AYZ|(IS)%=AYZ|I^(I)^#=IH|+^(I)^+=AY|#:^(I)^+=IH|(I)^+=AY|(IR)=ER|(IGH)=AY4|(ILD)=AY5LD| (IGN)=IHGN|(IGN) =AY4N|(IGN)^=AY4N|(IGN)%=AY4N|(ICRO)=AY4KROH|(IQUE)=IY4K|(I)=IH| (J) =JEY4|(J)=J| (K) =KEY4| (K)N=|(K)=K| (L) =EH4L|(LO)C#=LOW|L(L)=|#:^(L)%=UL|(LEAD)=LIYD| (LAUGH)=LAE4F|(L)=L| (M) =EH4M| (MR.) =MIH4STER| (MS.)=MIH5Z| (MRS.) =MIH4SIXZ|(MOV)=MUW4V|(MACHIN)=MAHSHIY5N|M(M)=|(M)=M| (N) =EH4N|E(NG)+=NJ|(NG)R=NXG|(NG)#=NXG|(NGL)%=NXGUL|(NG)=NX|(NK)=NXK| (NOW) =NAW4|N(N)=|(NON)E=NAH4N|(N)=N| (O) =OH4W|(OF) =AHV| (OH) =OW5|(OROUGH)=ER4OW|#:(OR) =ER|#:(ORS) =ERZ|(OR)=AOR| (ONE)=WAHN|#(ONE) =WAHN|(OW)=OW| (OVER)=OW5VER|PR(O)V=UW4|(OV)=AH4V|(O)^%=OW5|(O)^EN=OW|(O)^I#=OW5|(OL)D=OW4L|(OUGHT)=AO5T|(OUGH)=AH5F| (OU)=AW|H(OU)S#=AW4|(OUS)=AXS|(OUR)=OHR|(OULD)=UH5D|(OU)^L=AH5|(OUP)=UW5P|(OU)=AW|(OY)=OY|(OING)=OW4IHNX|(OI)=OY5|(OOR)=OH5R|(OOK)=UH5K|F(OOD)=UW5D|L(OOD)=AH5D|M(OOD)=UW5D|(OOD)=UH5D|F(OOT)=UH5T|(OO)=UW5|(O')=OH|(O)E=OW|(O) =OW|(OA)=OW4| (ONLY)=OW4NLIY| (ONCE)=WAH4NS|(ON'T)=OW4NT|C(O)N=AA|(O)NG=AO| :^(O)N=AH|I(ON)=UN|#:(ON)=UN|#^(ON)=UN|(O)ST=OW|(OF)^=AO4F|(OTHER)=AH5DHER|R(O)B=RAA|^R(O):#=OW5|(OSS) =AO5S|#:^(OM)=AHM|(O)=AA| (P) =PIY4|(PH)=F|(PEOPL)=PIY5PUL|(POW)=PAW4|(PUT) =PUHT|(P)P=|(P)S=|(P)N=|(PROF.)=PROHFEH4SER|(P)=P| (Q) =KYUW4|(QUAR)=KWOH5R|(QU)=KW|(Q)=K| (R) =AA5R| (RE)^#=RIY|(R)R=|(R)=R| (S) =EH4S|(SH)=SH|#(SION)=ZHUN|(SOME)=SAHM|#(SUR)#=ZHER|(SUR)#=SHER|#(SU)#=ZHUW|#(SSU)#=SHUW|#(SED)=ZD|#(S)#=Z|(SAID)=SEHD|^(SION)=SHUN|(S)S=|.(S) =Z|#:.E(S) =Z|#:^#(S) =S|U(S) =S| :#(S) =Z|##(S) =Z| (SCH)=SK|(S)C+=|#(SM)=ZUM|#(SN)'=ZUM|(STLE)=SUL|(S)=S| (T) =TIY4| (THE) #=DHIY| (THE) =DHAX|(TO) =TUX| (THAT)=DHAET| (THIS) =DHIHS| (THEY)=DHEY| (THERE)=DHEHR|(THER)=DHER|(THEIR)=DHEHR| (THAN) =DHAEN| (THEM) =DHAEN|(THESE) =DHIYZ| (THEN)=DHEHN|(THROUGH)=THRUW4|(THOSE)=DHOHZ|(THOUGH) =DHOW|(TODAY)=TUXDEY|(TOMO)RROW=TUMAA5|(TO)TAL=TOW5| (THUS)=DHAH4S|(TH)=TH|#:(TED)=TIXD|S(TI)#N=CH|(TI)O=SH|(TI)A=SH|(TIEN)=SHUN|(TUR)#=CHER|(TU)A=CHUW| (TWO)=TUW|&(T)EN =|(T)=T| (U) =YUW4| (UN)I=YUWN| (UN)=AHN| (UPON)=AXPAON|@(UR)#=UH4R|(UR)#=YUH4R|(UR)=ER|(U)^ =AH|(U)^^=AH5|(UY)=AY5| G(U)#=|G(U)%=|G(U)#=W|#N(U)=YUW|@(U)=UW|(U)=YUW| (V) =VIY4|(VIEW)=VYUW5|(V)=V| (W) =DAH4BULYUW| (WERE)=WER|(WA)SH=WAA|(WA)ST=WEY|(WA)S=WAH|(WA)T=WAA|(WHERE)=WHEHR|(WHAT)=WHAHT|(WHOL)=/HOWL|(WHO)=/HUW|(WH)=WH|(WAR)#=WEHR|(WAR)=WAOR|(WOR)^=WER|(WR)=R|(WOM)A=WUHM|(WOM)E=WIHM|(WEA)R=WEH|(WANT)=WAA5NT|ANS(WER)=ER|(W)=W| (X) =EH4KR| (X)=Z|(X)=KS| (Y) =WAY4|(YOUNG)=YAHNX| (YOUR)=YOHR| (YOU)=YUW| (YES)=YEHS| (Y)=Y|F(Y)=AY|PS(YCH)=AYK|#:^(Y)=IY|#:^(Y)I=IY| :(Y) =AY| :(Y)#=AY| :(Y)^+:#=IH| :(Y)^#=AY|(Y)=IH| (Z) =ZIY4|(Z)=Z".split("|").map(e=>{let t=ko(e),a=t.c;So[a]=So[a]||[],So[a].push(t)});let Mo=yo.split("|").map(ko),No="*12345678".split(""),Co=" *.*?*,*-*IYIHEHAEAAAHAOUHAXIXERUXOHRXLXWXYXWHR*L*W*Y*M*N*NXDXQ*S*SHF*TH/H/XZ*ZHV*DHCH**J*******EYAYOYAWOWUWB*****D*****G*****GX****P*****T*****K*****KX****ULUMUN".match(/.{1,2}/g),Eo=[32768,49408,49408,49408,49408,164,164,164,164,164,164,132,132,164,164,132,132,132,132,132,132,132,68,4164,4164,4164,4164,2124,3148,2124,1096,16460,9280,8256,8256,9280,64,64,9284,8260,8260,9284,8264,8256,76,8260,0,0,180,180,180,148,148,148,78,78,78,1102,1102,1102,78,78,78,78,78,78,75,75,75,1099,1099,1099,75,75,75,75,75,75,128,193,193],Po=[0,4626,4626,4626,2056,2824,2312,2824,3592,3851,2822,4108,3082,1541,1541,3595,3082,3594,3082,2825,2056,2055,2825,2567,2310,2056,2054,2055,2055,2055,770,1285,514,514,514,514,514,514,1542,1542,2055,1542,1542,514,2312,1027,513,286,3597,3852,3852,3852,3598,3593,2054,513,514,1797,513,257,1798,513,514,1798,513,514,2056,514,514,1540,514,514,1798,513,1028,1798,257,1028,1479,1535],_o=(e,t)=>{let a=Co.findIndex(a=>a===e+t&&"*"!==a[1]);return-1!==a&&a},To=e=>{let t=Co.findIndex(t=>t===e+"*");return-1!==t&&t},Ao=(e,t)=>lo(Eo[e],t),Oo=128,Io=e=>{if(!e)return!1;let t=e=>{if(e<0||e>l.length)throw new Error("Out of bounds: "+e);return e===l.length?null:l[e]},a=(e,t,a,r)=>{for(let c=l.length-1;c>=e;c--)l[c+1]=l[c],o[c+1]=s(c),i[c+1]=n(c);l[e]=t,o[e]=0|r,i[e]=a},n=e=>0|i[e],s=e=>0|o[e],r=(e,t)=>{if(128&t)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");if(e<0||e>l.length)throw new Error("Out of bounds: "+e);o[e]=t},i=[],o=[],l=[],c=0;return((e,t,a)=>{for(let n=0;n<e.length;n++){e.toLowerCase();let s,r=e[n],i=e[n+1]||"";if(!1===(s=_o(r,i)))if(!1===(s=To(r))){for(s=No.length;r!==No[s]&&s>0;)--s;if(0===s)throw Error(`Could not parse char ${r}`);a(s)}else t(s);else n++,t(s)}})(e,e=>{i[c]=0,o[c]=0,l[c++]=e},e=>{if(128&e)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");i[c-1]=e}),Do(l,o,i),((e,t,a,n)=>{let s,r=(s,r)=>{switch(s){case 53:Ao(a(r-1),1024)&&t(r,16);break;case 42:e(r+1,43,n(r));break;case 44:e(r+1,45,n(r))}},i=(a,s)=>{t(a,13),e(a+1,s,n(a))},o=-1;for(;null!==(s=a(++o));){if(0===s)continue;if(Ao(s,16)){e(o+1,Ao(s,32)?21:20,n(o)),r(s,o);continue}if(78===s){i(o,24);continue}if(79===s){i(o,27);continue}if(80===s){i(o,28);continue}if(Ao(s,Oo)&&n(o)){0===a(o+1)&&(s=a(o+2),null!==s&&Ao(s,Oo)&&n(o+2)&&e(o+2,31,0));continue}let l=0===o?null:a(o-1);if(23!==s)if(24===s&&Ao(l,Oo))t(o,19);else if(60!==l||32!==s){if(60===s){let e=a(o+1);Ao(e,32)||null===e||t(o,63);continue}if(72===s){let e=a(o+1);Ao(e,32)&&null!==e||(t(o,75),s=75)}Ao(s,1)&&32===l?t(o,s-12):Ao(s,1)||r(s,o),69!==s&&57!==s||o>0&&Ao(a(o-1),Oo)&&(s=a(o+1),0===s&&(s=a(o+2)),Ao(s,Oo)&&!n(o+1)&&t(o,30))}else t(o,38);else switch(l){case 69:t(o-1,42);break;case 57:t(o-1,44);break;default:Ao(l,Oo)&&t(o,18)}}})(a,(e,t)=>{l[e]=t},t,n),((e,t,a)=>{let n,s=0;for(;null!==(n=e(s));){if(Ao(n,64)&&(n=e(s+1),null!==n&&Ao(n,Oo))){let e=t(s+1);0!==e&&e<128&&a(s,e+1)}++s}})(t,n,(e,t)=>{i[e]=t}),((e,t,a)=>{let n,s=0;for(;null!==(n=e(s));){let e=t(s);a(s,0===e||e>127?255&Po[n]:Po[n]>>8),s++}})(t,n,r),((e,t,a)=>{for(let r=0;null!==e(r);r++){if(!Ao(e(r),256))continue;let n=r;for(;--r>1&&!Ao(e(r),Oo););if(0===r)break;for(;r<n;r++)if(!Ao(e(r),8192)||Ao(e(r),4)){let e=a(r);t(r,(e>>1)+e+1)}}let n,s=-1;for(;null!==(n=e(++s));){let r=s;if(Ao(n,Oo)){if(n=e(++r),!Ao(n,64)){18!==n&&19!==n||!Ao(e(++r),64)||t(s,a(s)-1);continue}let i=null===n?65:Eo[n];if(!lo(i,4)){if(lo(i,1)){let e=a(s);t(s,e-(e>>3))}continue}let o=a(s);t(s,(o>>2)+o+1);continue}if(Ao(n,2048))n=e(++r),null!==n&&Ao(n,2)&&(t(r,6),t(r-1,5));else if(Ao(n,2)){for(;0===(n=e(++r)););null!==n&&Ao(n,2)&&(t(r,1+(a(r)>>1)),t(s,1+(a(s)>>1)))}else r>0&&Ao(n,4096)&&Ao(e(r-1),2)&&t(r,a(r)-2)}})(t,r,s),((e,t,a)=>{let n,s=-1;for(;null!==(n=e(++s));)if(Ao(n,2)){if(Ao(n,1)){let t,a=s;do{t=e(++a)}while(0===t);if(null!==t&&(Ao(t,8)||36===t||37===t))continue}t(s+1,n+1,a(s),255&Po[n+1]),t(s+2,n+2,a(s),255&Po[n+2]),s+=2}})(t,a,n),Do(l,o,i),l.map((e,t)=>e?[e,0|o[t],0|i[t]]:null).filter(e=>e)},Do=(e,t,a)=>{for(let n=0;n<e.length;n++){}},Fo=[24,26,23,23,23],Ro=[0,224,230,236,243,249,0,6,12,6],jo=[0,31,31,31,31,2,2,2,2,2,2,2,2,2,5,5,2,10,2,8,5,5,11,10,9,8,8,160,8,8,23,31,18,18,18,18,30,30,20,20,20,20,23,23,26,26,29,29,2,2,2,2,2,2,26,29,27,26,29,27,26,29,27,26,29,27,23,29,23,23,29,23,23,29,23,23,29,23,23,23],Lo=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,4,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,0,1,0,1,0,5,5,5,5,5,4,4,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,1,3,0,2,3,0,2,160,160],Bo=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3,3,3,3,1,2,3,2,1,3,3,3,3,1,1,3,3,3,2,2,3,2,3,0,0,5,5,5,5,4,4,2,0,2,2,0,3,2,0,4,2,0,3,2,0,2,2,0,2,3,0,3,3,0,3,176,160],Vo=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,241,226,211,187,124,149,1,2,3,3,0,114,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,25,0,0,0,0,0,0,0,0,0],zo=[0,5980947,5980947,5980947,5980947,7230474,6113550,5980947,5783320,5842971,5712919,5775125,5383440,5844244,6113550,4075794,5383182,5774866,4076306,7218448,5250317,6112527,5904395,3944978,7216654,5904395,7230217,5320198,7943686,6641158,7943686,5980945,6506758,6967046,5315078,7946758,6113550,5383440,6107913,6767114,4990984,6106890,6639366,6639366,7946758,6639365,7958022,0,5916691,5777179,5775125,5778203,5774866,5382669,5315078,5315078,5315078,7946758,7946758,7946758,7368198,7237126,7237126,6181894,6181894,6181894,5315078,5315078,5315078,7946758,7946758,7946758,6647046,6641162,7367946,6181894,6181894,6181894,556844,98067],Uo=[0,0,0,0,0,526861,461581,527630,527887,68879,68623,3087,68367,2316,461581,330508,68623,3087,396301,67597,2061,461838,2061,330252,67597,2061,526861,780,2313,198153,0,0,0,0,0,0,0,0,779,66827,779,1035,0,0,1,66827,920064,66050,593422,68879,3087,68879,3087,2061,2,260,0,2,260,0,1,260,0,1,260,0,0,0,0,0,0,0,0,461324,0,0,330240,0,1245199,1048591],Go=[56,132,107,25,198,99,24,134,115,152,198,177,28,202,49,140,199,49,136,194,48,152,70,49,24,198,53,12,202,49,12,198,33,16,36,105,18,194,49,20,196,113,8,74,34,73,171,106,168,172,73,81,50,213,82,136,147,108,148,34,21,84,210,37,150,212,80,165,70,33,8,133,107,24,196,99,16,206,107,24,140,113,25,140,99,53,12,198,51,153,204,108,181,78,162,153,70,33,40,130,149,46,227,48,156,197,48,156,162,177,156,103,49,136,102,89,44,83,24,132,103,80,202,227,10,172,171,48,172,98,48,140,99,16,148,98,177,140,130,40,150,51,152,214,181,76,98,41,165,74,181,156,198,49,20,214,56,156,75,180,134,101,24,174,103,28,166,99,25,150,35,25,132,19,8,166,82,172,202,34,137,110,171,25,140,98,52,196,98,25,134,99,24,196,35,88,214,163,80,66,84,74,173,74,37,17,107,100,137,74,99,57,138,35,49,42,234,162,169,68,197,18,205,66,52,140,98,24,140,99,17,72,102,49,157,68,51,29,70,49,156,198,177,12,205,50,136,196,115,24,134,115,8,214,99,88,7,129,224,240,60,7,135,144,60,124,15,199,192,192,240,124,30,7,128,128,0,28,120,112,241,199,31,192,12,254,28,31,31,14,10,122,192,113,242,131,143,3,15,15,12,0,121,248,97,224,67,15,131,231,24,249,193,19,218,233,99,143,15,131,131,135,195,31,60,112,240,225,225,227,135,184,113,14,32,227,141,72,120,28,147,135,48,225,193,193,228,120,33,131,131,195,135,6,57,229,195,135,7,14,28,28,112,244,113,156,96,54,50,195,30,60,243,143,14,60,112,227,199,143,15,15,14,60,120,240,227,135,6,240,227,7,193,153,135,15,24,120,112,112,252,243,16,177,140,140,49,124,112,225,134,60,100,108,176,225,227,15,35,143,15,30,62,56,60,56,123,143,7,14,60,244,23,30,60,120,242,158,114,73,227,37,54,56,88,57,226,222,60,120,120,225,199,97,225,225,176,240,240,195,199,14,56,192,240,206,115,115,24,52,176,225,199,142,28,60,248,56,240,225,193,139,134,143,28,120,112,240,120,172,177,143,57,49,219,56,97,195,14,14,56,120,115,23,30,57,30,56,100,225,241,193,78,15,64,162,2,197,143,129,161,252,18,8,100,224,60,34,224,69,7,142,12,50,144,240,31,32,73,224,248,12,96,240,23,26,65,170,164,208,141,18,130,30,30,3,248,62,3,12,115,128,112,68,38,3,36,225,62,4,78,4,28,193,9,204,158,144,33,7,144,67,100,192,15,198,144,156,193,91,3,226,29,129,224,94,29,3,132,184,44,15,128,177,131,224,48,65,30,67,137,131,80,252,36,46,19,131,241,124,76,44,201,13,131,176,181,130,228,232,6,156,7,160,153,29,7,62,130,143,112,48,116,64,202,16,228,232,15,146,20,63,6,248,132,136,67,129,10,52,57,65,198,227,28,71,3,176,184,19,10,194,100,248,24,249,96,179,192,101,32,96,166,140,195,129,32,48,38,30,28,56,211,1,176,38,64,244,11,195,66,31,133,50,38,96,64,201,203,1,236,17,40,64,250,4,52,224,112,76,140,29,7,105,3,22,200,4,35,232,198,154,11,26,3,224,118,6,5,207,30,188,88,49,113,102,0,248,63,4,252,12,116,39,138,128,113,194,58,38,6,192,31,5,15,152,64,174,1,127,192,7,255,0,14,254,0,3,223,128,3,239,128,27,241,194,0,231,224,24,252,224,33,252,128,60,252,64,14,126,0,63,62,0,15,254,0,31,255,0,62,240,7,252,0,126,16,63,255,0,63,56,14,124,1,135,12,252,199,0,62,4,15,62,31,15,15,31,15,2,131,135,207,3,135,15,63,192,7,158,96,63,192,3,254,0,63,224,119,225,192,254,224,195,224,1,223,248,3,7,0,126,112,0,124,56,24,254,12,30,120,28,124,62,14,31,30,30,62,0,127,131,7,219,135,131,7,199,7,16,113,255,0,63,226,1,224,193,195,225,0,127,192,5,240,32,248,240,112,254,120,121,248,2,63,12,143,3,15,159,224,193,199,135,3,195,195,176,225,225,193,227,224,113,240,0,252,112,124,12,62,56,14,28,112,195,199,3,129,193,199,231,0,15,199,135,25,9,239,196,51,224,193,252,248,112,240,120,248,240,97,199,0,31,248,1,124,248,240,120,112,60,124,206,14,33,131,207,8,7,143,8,193,135,143,128,199,227,0,7,248,224,239,0,57,247,128,14,248,225,227,248,33,159,192,255,3,248,7,192,31,248,196,4,252,196,193,188,135,240,15,192,127,5,224,37,236,192,62,132,71,240,142,3,248,3,251,192,25,248,7,156,12,23,248,7,224,31,161,252,15,252,1,240,63,0,254,3,240,31,0,253,0,255,136,13,249,1,255,0,112,7,192,62,66,243,13,196,127,128,252,7,240,94,192,63,0,120,63,129,255,1,248,1,195,232,12,228,100,143,228,15,240,7,240,194,31,0,127,192,111,128,126,3,248,7,240,63,192,120,15,130,7,254,34,119,112,2,118,3,254,0,254,103,0,124,199,241,142,198,59,224,63,132,243,25,216,3,153,252,9,184,15,248,0,157,36,97,249,13,0,253,3,240,31,144,63,1,248,31,208,15,248,55,1,248,7,240,15,192,63,0,254,3,248,15,192,63,0,250,3,240,15,128,255,1,184,7,240,1,252,1,188,128,19,30,0,127,225,64,127,160,127,176,0,63,192,31,192,56,15,240,31,128,255,1,252,3,241,126,1,254,1,240,255,0,127,192,29,7,240,15,192,126,6,224,7,224,15,248,6,193,254,1,252,3,224,15,0,252],Wo=(e,t,a,n,s)=>{let r=((e,t)=>{let a=(e,t)=>(e*t>>8&255)<<1,n=[[],[],[]];zo.map((e,t)=>{n[0][t]=255&e,n[1][t]=e>>8&255,n[2][t]=e>>16&255});for(let s=5;s<30;s++)n[0][s]=a(e,n[0][s]),n[1][s]=a(t,n[1][s]);for(let s=48;s<54;s++)n[0][s]=a(e,n[0][s]),n[1][s]=a(t,n[1][s]);return n})(a,n);const[i,o,l,c]=((e,t,a)=>{let n=(e,t,a)=>{let n,s=t;for(t<30?t=0:t-=30;127===(n=a[t]);)++t;for(;t!==s;)for(n+=e,a[t]=255&n;++t!==s&&255===a[t];);},s=[],r=[[],[],[]],i=[[],[],[]],o=[],l=0;for(let c=0;c<t.length;c++){let u=t[c][0];1===u?n(1,l,s):2===u&&n(255,l,s);let d=Ro[t[c][2]];for(let n=t[c][1];n>0;n--)r[0][l]=a[0][u],r[1][l]=a[1][u],r[2][l]=a[2][u],i[0][l]=255&Uo[u],i[1][l]=Uo[u]>>8&255,i[2][l]=Uo[u]>>16&255,o[l]=Vo[u],s[l]=e+d&255,l++}return[s,r,i,o]})(t,e,r);let u=((e,t,a,n)=>{let s,r,i=[e,t[0],t[1],t[2],a[0],a[1],a[2]],o=(e,t)=>{if(e<0||e>i.length-1)throw new Error(`Error invalid table in Read: ${e}`);return i[e][t]},l=(e,t,a,n)=>{let s=n<0,r=Math.abs(n)%e,l=n/e|0,c=0,u=e;for(;--u>0;){let n=o(t,a)+l;if(c+=r,c>=e&&(c-=e,s?n--:n&&n++),t<0||t>i.length-1)throw new Error(`Error invalid table in Read: ${t}`);i[t][++a]=n,n+=l}},c=0;for(let u=0;u<n.length-1;u++){let t=n[u][0],a=n[u+1][0],i=jo[a],d=jo[t];d===i?(s=Lo[t],r=Lo[a]):d<i?(s=Bo[a],r=Lo[a]):(s=Lo[t],r=Bo[t]),c+=n[u][1];let p=c+r,h=c-s,m=s+r;if(!(m-2&128)){let t=n[u][1]>>1,a=n[u+1][1]>>1;l(t+a,0,h,e[c+a]-e[c-t]);for(let e=1;e<7;e++)l(m,e,h,o(e,p)-o(e,h))}}return c+n[n.length-1][1]})(i,o,l,e);if(!s)for(let p=0;p<i.length;p++)i[p]-=o[0][p]>>1;let d=[0,1,2,2,2,3,3,4,4,5,6,8,9,11,13,15];for(let p=l[0].length-1;p>=0;p--)l[0][p]=d[l[0][p]],l[1][p]=d[l[1][p]],l[2][p]=d[l[2][p]];return[u,o,i,l,c]},Ho=(e,t,a,n)=>{let s=(7&a)-1,r=256*s&65535,i=248&a,o=(t,a,n,s)=>{let o=8,l=Go[r+i];do{128&l?e(t,a):e(n,s),l<<=1}while(--o)};if(0===i){let e=n>>4^255;i=255&t;do{o(3,26,4,6),i++,i&=255}while(255&++e);return i}i^=255;let l=255&Fo[s];do{o(2,5,1,l)}while(255&++i);return t},Ko=e=>127*Math.sin(2*Math.PI*(e/256))|0,$o=(e,t,a,n,s,r)=>{s=255&(s||72);let i=Wo(e,t=void 0===t?64:255&t,a=void 0===a?128:255&a,n=void 0===n?128:255&n,r=r||!1),o=(e=>{let t=new Uint8Array(e),a=0,n=0,s=(e,t)=>{let a=16*(15&t);s.ary(e,[a,a,a,a,a])};return s.ary=(e,s)=>{if(a+=[[162,167,167,127,128],[226,60,60,0,0],[225,60,59,0,0],[200,0,0,54,55],[199,0,0,54,54]][n][e],(a/50|0)>t.length)throw new Error(`Buffer overflow, want ${a/50|0} but buffersize is only ${t.length}!`);n=e;for(let n=0;n<5;n++)t[(a/50|0)+n]=s[n]},s.get=()=>t.slice(0,a/50|0),s})(176.4*e.reduce((e,t)=>e+t[1],0)*s|0);const[l,c,u,d,p]=i;return qo(u,c,d,p),((e,t,a,n,s,r,i)=>{let o=a,l=0,c=0,u=0,d=0,p=0,h=s[0],m=.75*h|0;for(;t;){let f=i[p];if(248&f)d=Ho(e,d,f,s[255&p]),p+=2,t-=2,o=a;else{{let t=[],a=256*l,s=256*c,i=256*u;for(let e=0;e<5;e++){const o=Ko(255&a>>8),l=Ko(255&s>>8),c=(255&i>>8)<129?-112:112;let u=o*(15&r[0][p])+l*(15&r[1][p])+c*(15&r[2][p]);u/=32,u+=128,t[e]=0|u,a+=256*n[0][p]/4,s+=256*n[1][p]/4,i+=256*n[2][p]/4}e.ary(0,t)}if(o--,0===o){if(p++,0===--t)return;o=a}if(h--,0!==h){if(m--,0!==m||0===f){l+=n[0][p],c+=n[1][p],u+=n[2][p];continue}d=Ho(e,d,f,s[255&p])}}h=s[p],m=.75*h|0,l=0,c=0,u=0}})(o,l,s,c,u,d,p),o.get()},qo=(e,t,a,n)=>{for(let s=0;s<n.length;s++)s++},Xo=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Io(e);return!1!==a&&$o(a,t.pitch,t.mouth,t.throat,t.speed,t.singmode)},Yo=e=>{let t=" "+e.toUpperCase(),a=0,n="",s=(e,t)=>{a+=t,n+=e},r=0;for(;a<t.length&&r++<1e4;){t.toLowerCase();let e=t[a];if("."!==e||xo(t,a+1,1)){if(vo(e,2)){Mo.some(e=>e(t,a,s));continue}if(0!==go[e]){if(!vo(e,bo))return!1;So[e].some(e=>e(t,a,s));continue}n+=" ",a++}else n+=".",a++}return n},Qo=Xo,Zo=(e,t)=>{let a=Xo(e,t);return!1!==a&&(e=>{let t=new Float32Array(e.length);for(let a=0;a<e.length;a++)t[a]=(e[a]-128)/256;return t})(a)};function Jo(e){let t=e||{},a=(e,a)=>a||t.phonetic?e.toUpperCase():Yo(e);this.buf8=(e,n)=>Qo(a(e,n),t),this.buf32=(e,n)=>Zo(a(e,n),t),this.speak=(e,t)=>mo(this.buf32(e,t)),this.download=(e,t)=>{(e=>{let t=new Blob([fo(e)],{type:"audio/vnd.wave"}),a=window.URL||window.webkitURL,n=a.createObjectURL(t),s=document.createElement("a");s.href=n,s.target="_blank",s.download="sam.wav",document.body.appendChild(s),s.click(),document.body.removeChild(s),a.revokeObjectURL(n)})(this.buf8(e,t))},this.wav=(e,t)=>fo(this.buf8(e,t))}Jo.buf8=Qo,Jo.buf32=Zo,Jo.convert=Yo;class el{name="SAMSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={...e},this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._sam=new Jo({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()}async ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch(e){}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const a=this.audioContext.createBufferSource();a.buffer=this._buffer,a.loop=this._config.singmode,a.connect(this._playerGain),a.onended=()=>{this._sourceNode===a&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=a,a.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,this._config.phonetic);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const a=this._isPlaying;this._buffer=t,a&&this._config.singmode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,a=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.mouth&&e.mouth!==this._config.mouth||void 0!==e.throat&&e.throat!==this._config.throat||void 0!==e.singmode&&e.singmode!==this._config.singmode||void 0!==e.phonetic&&e.phonetic!==this._config.phonetic;this._config={...this._config,...e},void 0!==e.singmode&&this._sourceNode&&(this._sourceNode.loop=e.singmode),(a||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{this._sam=new Jo({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()},50))}triggerAttack(e,t,a=1){if(this._buffer)if(this._config.singmode){const n="string"==typeof e?rs(e):e,s=Math.pow(2,(n-60)/12);this._isPlaying&&this._sourceNode?this._sourceNode.playbackRate.value=s:(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s)),this._playerGain.gain.value=a}else this._startSource(t),this._playerGain.gain.value=a}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n)}triggerRelease(){}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}class tl{name="V2Synth";output;_worklet=null;_initialized=!1;_initPromise;_pendingNotes=[];_releaseTimers=new Set;_initialConfig;constructor(e){this.output=Jn().createGain(),this._initialConfig=e,this._initPromise=this._initialize()}async _initialize(){const e=Jn();if("running"!==e.state){try{await e.resume()}catch{}"running"!==e.state&&await Promise.race([new Promise(t=>{const a=()=>{"running"===e.state?t():setTimeout(a,100)};setTimeout(a,100)}),new Promise((e,t)=>setTimeout(()=>t(new Error("AudioContext not running after 5s")),5e3))])}const t="/DEViLBOX/",a=`?v=${Date.now()}`;try{await e.audioWorklet.addModule(`${t}V2Synth.worklet.js${a}`)}catch(l){}const[n,s]=await Promise.all([fetch(`${t}V2Synth.wasm${a}`,{cache:"no-store"}),fetch(`${t}V2Synth.js${a}`,{cache:"no-store"})]);if(!n.ok)throw new Error(`Failed to load V2Synth.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load V2Synth.js: ${s.status}`);const[r,i]=await Promise.all([n.arrayBuffer(),s.text()]),o='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+i.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/(_malloc=wasmExports\["\w+"\])/,'$1;Module["_malloc"]=_malloc').replace(/(_free=wasmExports\["\w+"\])/,'$1;Module["_free"]=_free');this._worklet=new AudioWorkletNode(e,"v2-synth-processor",{outputChannelCount:[2]}),await new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("V2Synth initialization timeout after 10s"))},1e4);this._worklet.port.onmessage=t=>{"ready"===t.data.type?(clearTimeout(a),this._initialized=!0,this._initialConfig&&this._applyV2Config(this._initialConfig),this._pendingNotes.forEach(e=>this._sendMIDI([144,e.note,e.vel])),this._pendingNotes=[],e()):t.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:o})}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch(l){}}async ready(){return this._initPromise}async ensureInitialized(){return this._initPromise}triggerAttack(e,t,a=1){const n="string"==typeof e?rs(e):e,s=Math.floor(127*a);this._initialized?this._sendMIDI([144,n,s]):this._pendingNotes.push({note:n,vel:s})}triggerRelease(e){this._initialized}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,void 0,n);const s="string"==typeof e?rs(e):e,r="number"==typeof t?t:parseFloat(String(t)),i=setTimeout(()=>{this._releaseTimers.delete(i),this._initialized&&this._worklet&&this._sendMIDI([128,s,0])},1e3*r);this._releaseTimers.add(i)}setParameter(e,t){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"param",index:e,value:t})}applyConfig(e){this._initialized?this._applyV2Config(e):this._initialConfig=e}_applyV2Config(e){e.osc1&&(this.setParameter(2,e.osc1.mode),this.setParameter(4,e.osc1.transpose+64),this.setParameter(5,e.osc1.detune+64),this.setParameter(6,e.osc1.color),this.setParameter(7,e.osc1.level)),e.osc2&&(this.setParameter(8,e.osc2.mode),this.setParameter(9,e.osc2.ringMod?1:0),this.setParameter(10,e.osc2.transpose+64),this.setParameter(11,e.osc2.detune+64),this.setParameter(12,e.osc2.color),this.setParameter(13,e.osc2.level)),e.osc3&&(this.setParameter(14,e.osc3.mode),this.setParameter(15,e.osc3.ringMod?1:0),this.setParameter(16,e.osc3.transpose+64),this.setParameter(17,e.osc3.detune+64),this.setParameter(18,e.osc3.color),this.setParameter(19,e.osc3.level)),e.filter1&&(this.setParameter(20,e.filter1.mode),this.setParameter(21,e.filter1.cutoff),this.setParameter(22,e.filter1.resonance)),e.filter2&&(this.setParameter(23,e.filter2.mode),this.setParameter(24,e.filter2.cutoff),this.setParameter(25,e.filter2.resonance)),e.routing&&(this.setParameter(26,e.routing.mode),this.setParameter(27,e.routing.balance)),e.envelope&&(this.setParameter(32,e.envelope.attack),this.setParameter(33,e.envelope.decay),this.setParameter(34,e.envelope.sustain),this.setParameter(36,e.envelope.release)),e.envelope2&&(this.setParameter(38,e.envelope2.attack),this.setParameter(39,e.envelope2.decay),this.setParameter(40,e.envelope2.sustain),this.setParameter(42,e.envelope2.release)),e.lfo1&&(this.setParameter(47,e.lfo1.rate),this.setParameter(50,e.lfo1.depth))}_sendMIDI(e){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"midi",msg:e})}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._initialized=!1,this._worklet&&this._worklet.disconnect(),this.output.disconnect()}}class al{name="V2SpeechSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,...e},this._readyPromise=new Promise(e=>{this._readyResolve=e});const t=Math.round(this._config.pitch/127*255),a=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+n)),r=Math.max(0,Math.min(255,128-n));this._sam=new Jo({pitch:t,speed:a,mouth:Math.round(s),throat:Math.round(r),singmode:this._config.singMode,phonetic:!1}),this._render()}async ready(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch(e){}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const a=this.audioContext.createBufferSource();a.buffer=this._buffer,a.loop=this._config.singMode,a.connect(this._playerGain),a.onended=()=>{this._sourceNode===a&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=a,a.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,!1);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const a=this._isPlaying;this._buffer=t,a&&this._config.singMode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,a=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.formantShift&&e.formantShift!==this._config.formantShift||void 0!==e.singMode&&e.singMode!==this._config.singMode;this._config={...this._config,...e},void 0!==e.singMode&&this._sourceNode&&(this._sourceNode.loop=e.singMode),(a||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{const e=Math.round(this._config.pitch/127*255),t=Math.round(this._config.speed/127*255),a=(this._config.formantShift-64)/64*50,n=Math.max(0,Math.min(255,128+a)),s=Math.max(0,Math.min(255,128-a));this._sam=new Jo({pitch:e,speed:t,mouth:Math.round(n),throat:Math.round(s),singmode:this._config.singMode,phonetic:!1}),this._render()},50))}triggerAttack(e,t,a=1){if(this._buffer)if(this._config.singMode){const n="string"==typeof e?rs(e):e,s=Math.pow(2,(n-60)/12);this._isPlaying&&this._sourceNode?this._sourceNode.playbackRate.value=s:(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s)),this._playerGain.gain.value=a}else this._startSource(t),this._playerGain.gain.value=a}triggerRelease(e){}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n)}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}const nl={ARGURU_DISTORTION:"ArguruDistortion",ELAK_DIST2:"ElakDist2",JESKOLA_DISTORTION:"JeskolaDistortion",GEONIK_OVERDRIVE:"GeonikOverdrive",GRAUE_SOFTSAT:"GraueSoftSat",WHITENOISE_STEREODIST:"WhiteNoiseStereoDist",ELAK_SVF:"ElakSVF",CYANPHASE_NOTCH:"CyanPhaseNotch",Q_ZFILTER:"QZfilter",FSM_PHILTA:"FSMPhilta",JESKOLA_DELAY:"JeskolaDelay",JESKOLA_CROSSDELAY:"JeskolaCrossDelay",JESKOLA_FREEVERB:"JeskolaFreeverb",FSM_PANZERDELAY:"FSMPanzerDelay",FSM_CHORUS:"FSMChorus",FSM_CHORUS2:"FSMChorus2",WHITENOISE_WHITECHORUS:"WhiteNoiseWhiteChorus",BIGYO_FREQUENCYSHIFTER:"BigyoFrequencyShifter",GEONIK_COMPRESSOR:"GeonikCompressor",LD_SLIMIT:"LdSLimit",OOMEK_EXCITER:"OomekExciter",OOMEK_MASTERIZER:"OomekMasterizer",DEDACODE_STEREOGAIN:"DedaCodeStereoGain",FSM_KICK:"FSMKick",FSM_KICKXP:"FSMKickXP",JESKOLA_TRILOK:"JeskolaTrilok",JESKOLA_NOISE:"JeskolaNoise",OOMEK_AGGRESSOR:"OomekAggressor",OOMEK_AGGRESSOR_DF:"OomekAggressorDF",MADBRAIN_4FM2F:"MadBrain4FM2F",MADBRAIN_DYNAMITE6:"MadBrainDynamite6",MAKK_M3:"MakkM3",MAKK_M4:"MakkM4",CYANPHASE_DTMF:"CyanPhaseDTMF",ELENZIL_FREQUENCYBOMB:"ElenzilFrequencyBomb"},sl={[nl.ARGURU_DISTORTION]:{name:"Arguru Distortion",shortName:"Distortion",author:"Arguru",type:"effect",parameters:[{index:0,name:"Input Gain",description:"Input Gain",minValue:1,maxValue:2048,defaultValue:256,type:"word"},{index:1,name:"Threshold (-)",description:"Threshold level (negative)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:2,name:"Threshold (+)",description:"Threshold level (positive)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:3,name:"Output Gain",description:"Output Gain",minValue:1,maxValue:2048,defaultValue:1024,type:"word"},{index:4,name:"Phase Inversor",description:"Stereo phase inversor",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:5,name:"Mode",description:"Operational mode (0=Clip, 1=Saturate)",minValue:0,maxValue:1,defaultValue:0,type:"byte"}]},[nl.ELAK_SVF]:{name:"Elak SVF Filter",shortName:"SVF",author:"Elak",type:"effect",parameters:[{index:0,name:"Cutoff",description:"Cut-off frequency",minValue:0,maxValue:1e3,defaultValue:512,type:"word"},{index:1,name:"Resonance",description:"Resonance",minValue:0,maxValue:65534,defaultValue:512,type:"word"}]},[nl.FSM_KICK]:{name:"FSM Kick",shortName:"Kick",author:"FSM",type:"generator",parameters:[]},[nl.FSM_KICKXP]:{name:"FSM KickXP",shortName:"KickXP",author:"FSM",type:"generator",parameters:[]},[nl.JESKOLA_TRILOK]:{name:"Jeskola Trilok",shortName:"Trilok",author:"Jeskola",type:"generator",parameters:[]},[nl.JESKOLA_NOISE]:{name:"Jeskola Noise",shortName:"Noise",author:"Jeskola",type:"generator",parameters:[]},[nl.OOMEK_AGGRESSOR]:{name:"Oomek Aggressor",shortName:"Aggressor",author:"Oomek",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"}]},[nl.OOMEK_AGGRESSOR_DF]:{name:"Oomek Aggressor Devil Fish",shortName:"AggressorDF",author:"Oomek + Devil Fish Mods",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Normal envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:8,name:"Accent Decay",description:"Accent envelope decay time (Devil Fish)",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:9,name:"VEG Decay",description:"Volume envelope decay (Devil Fish)",minValue:0,maxValue:128,defaultValue:96,type:"byte"},{index:10,name:"VEG Sustain",description:"Volume envelope sustain 0-100% (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:11,name:"Soft Attack",description:"Soft attack time 0.3-30ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:12,name:"Filter Tracking",description:"Filter tracking 0-200% (Devil Fish)",minValue:0,maxValue:200,defaultValue:0,type:"byte"},{index:13,name:"High Resonance",description:"High resonance mode - self oscillation (Devil Fish)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:14,name:"Slide Time",description:"Slide/glide time 10-500ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:30,type:"byte"},{index:15,name:"Muffler",description:"Output soft clipping 0=off, 1=soft, 2=hard (Devil Fish)",minValue:0,maxValue:2,defaultValue:0,type:"byte"},{index:16,name:"Sweep Speed",description:"Accent sweep speed 0=fast, 1=normal, 2=slow (Devil Fish)",minValue:0,maxValue:2,defaultValue:1,type:"byte"}]},[nl.MADBRAIN_4FM2F]:{name:"MadBrain 4FM2F",shortName:"4FM2F",author:"MadBrain",type:"generator",parameters:[]},[nl.MADBRAIN_DYNAMITE6]:{name:"MadBrain Dynamite6",shortName:"Dynamite6",author:"MadBrain",type:"generator",parameters:[]},[nl.MAKK_M3]:{name:"Makk M3",shortName:"M3",author:"Makk",type:"generator",parameters:[]},[nl.MAKK_M4]:{name:"Makk M4",shortName:"M4",author:"Makk",type:"generator",parameters:[]},[nl.ELAK_DIST2]:{name:"Elak Dist2",shortName:"Dist2",author:"Elak",type:"effect",parameters:[]},[nl.JESKOLA_DISTORTION]:{name:"Jeskola Distortion",shortName:"JDist",author:"Jeskola",type:"effect",parameters:[]},[nl.GEONIK_OVERDRIVE]:{name:"Geonik Overdrive",shortName:"Overdrive",author:"Geonik",type:"effect",parameters:[]},[nl.GRAUE_SOFTSAT]:{name:"Graue SoftSat",shortName:"SoftSat",author:"Graue",type:"effect",parameters:[]},[nl.WHITENOISE_STEREODIST]:{name:"WhiteNoise StereoDist",shortName:"StereoDist",author:"WhiteNoise",type:"effect",parameters:[]},[nl.CYANPHASE_NOTCH]:{name:"CyanPhase Notch",shortName:"Notch",author:"CyanPhase",type:"effect",parameters:[]},[nl.Q_ZFILTER]:{name:"Q Zfilter",shortName:"Zfilter",author:"Q",type:"effect",parameters:[]},[nl.FSM_PHILTA]:{name:"FSM Philta",shortName:"Philta",author:"FSM",type:"effect",parameters:[]},[nl.JESKOLA_DELAY]:{name:"Jeskola Delay",shortName:"JDelay",author:"Jeskola",type:"effect",parameters:[]},[nl.JESKOLA_CROSSDELAY]:{name:"Jeskola CrossDelay",shortName:"CrossDelay",author:"Jeskola",type:"effect",parameters:[]},[nl.JESKOLA_FREEVERB]:{name:"Jeskola Freeverb",shortName:"Freeverb",author:"Jeskola",type:"effect",parameters:[]},[nl.FSM_PANZERDELAY]:{name:"FSM PanzerDelay",shortName:"PanzerDelay",author:"FSM",type:"effect",parameters:[]},[nl.FSM_CHORUS]:{name:"FSM Chorus",shortName:"Chorus",author:"FSM",type:"effect",parameters:[]},[nl.FSM_CHORUS2]:{name:"FSM Chorus2",shortName:"Chorus2",author:"FSM",type:"effect",parameters:[]},[nl.WHITENOISE_WHITECHORUS]:{name:"WhiteNoise WhiteChorus",shortName:"WhiteChorus",author:"WhiteNoise",type:"effect",parameters:[]},[nl.BIGYO_FREQUENCYSHIFTER]:{name:"Bigyo FrequencyShifter",shortName:"FreqShift",author:"Bigyo",type:"effect",parameters:[]},[nl.GEONIK_COMPRESSOR]:{name:"Geonik Compressor",shortName:"Compressor",author:"Geonik",type:"effect",parameters:[]},[nl.LD_SLIMIT]:{name:"Ld SLimit",shortName:"SLimit",author:"Ld",type:"effect",parameters:[]},[nl.OOMEK_EXCITER]:{name:"Oomek Exciter",shortName:"Exciter",author:"Oomek",type:"effect",parameters:[]},[nl.OOMEK_MASTERIZER]:{name:"Oomek Masterizer",shortName:"Masterizer",author:"Oomek",type:"master",parameters:[]},[nl.DEDACODE_STEREOGAIN]:{name:"DedaCode StereoGain",shortName:"StereoGain",author:"DedaCode",type:"effect",parameters:[]},[nl.CYANPHASE_DTMF]:{name:"CyanPhase DTMF",shortName:"DTMF",author:"CyanPhase",type:"generator",parameters:[]},[nl.ELENZIL_FREQUENCYBOMB]:{name:"Elenzil FrequencyBomb",shortName:"FreqBomb",author:"Elenzil",type:"generator",parameters:[]}};class rl{static instance=null;isLoaded=!1;initPromise=null;workletNode=null;nativeContext=null;constructor(){}static getInstance(){return rl.instance||(rl.instance=new rl),rl.instance}async init(e){if(!this.isLoaded)return this.initPromise||(this.initPromise=this.doInit(e)),this.initPromise}async doInit(e){try{const t=e,a=t.rawContext||t._context||es(e);if(this.nativeContext=a,!a||!a.audioWorklet)return void(this.initPromise=null);if("running"!==a.state){try{await a.resume()}catch{}if("running"!==a.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===a.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const n="/DEViLBOX/",s=`?v=${Date.now()}`;await a.audioWorklet.addModule(`${n}Buzzmachine.worklet.js${s}`),this.isLoaded=!0}catch(t){throw this.initPromise=null,t}}isInitialized(){return this.isLoaded}async createMachineNode(e,t){this.isLoaded||await this.init(e);const a=e,n=a.rawContext||a._context||es(e),s=new AudioWorkletNode(n,"buzzmachine-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});return await this.loadMachineWasm(s,t),s}async loadMachineWasm(e,t){const a=this.getMachineFilename(t),n="/DEViLBOX/",[s,r]=await Promise.all([fetch(`${n}buzzmachines/${a}.js`),fetch(`${n}buzzmachines/${a}.wasm`)]);if(!s.ok||!r.ok)throw new Error(`Failed to load buzzmachine: ${t}`);const i=await s.text(),o=await r.arrayBuffer();return new Promise((a,n)=>{const s=setTimeout(()=>{n(new Error("Buzzmachine init timeout"))},5e3);e.port.onmessage=e=>{"initialized"===e.data.type?(clearTimeout(s),a()):"error"===e.data.type&&(clearTimeout(s),n(new Error(e.data.error)))},e.port.postMessage({type:"init",wasmBinary:o,jsCode:i,machineType:t})})}getMachineFilename(e){const t={[nl.ARGURU_DISTORTION]:"Arguru_Distortion",[nl.ELAK_DIST2]:"Elak_Dist2",[nl.JESKOLA_DISTORTION]:"Jeskola_Distortion",[nl.GEONIK_OVERDRIVE]:"Geonik_Overdrive",[nl.GRAUE_SOFTSAT]:"Graue_SoftSat",[nl.WHITENOISE_STEREODIST]:"WhiteNoise_StereoDist",[nl.ELAK_SVF]:"Elak_SVF",[nl.CYANPHASE_NOTCH]:"CyanPhase_Notch",[nl.Q_ZFILTER]:"Q_Zfilter",[nl.FSM_PHILTA]:"FSM_Philta",[nl.JESKOLA_DELAY]:"Jeskola_Delay",[nl.JESKOLA_CROSSDELAY]:"Jeskola_CrossDelay",[nl.JESKOLA_FREEVERB]:"Jeskola_Freeverb",[nl.FSM_PANZERDELAY]:"FSM_PanzerDelay",[nl.FSM_CHORUS]:"FSM_Chorus",[nl.FSM_CHORUS2]:"FSM_Chorus2",[nl.WHITENOISE_WHITECHORUS]:"WhiteNoise_WhiteChorus",[nl.BIGYO_FREQUENCYSHIFTER]:"Bigyo_FrequencyShifter",[nl.GEONIK_COMPRESSOR]:"Geonik_Compressor",[nl.LD_SLIMIT]:"Ld_SLimit",[nl.OOMEK_EXCITER]:"Oomek_Exciter",[nl.OOMEK_MASTERIZER]:"Oomek_Masterizer",[nl.DEDACODE_STEREOGAIN]:"DedaCode_StereoGain",[nl.FSM_KICK]:"FSM_Kick",[nl.FSM_KICKXP]:"FSM_KickXP",[nl.JESKOLA_TRILOK]:"Jeskola_Trilok",[nl.JESKOLA_NOISE]:"Jeskola_Noise",[nl.OOMEK_AGGRESSOR]:"Oomek_Aggressor",[nl.OOMEK_AGGRESSOR_DF]:"Oomek_Aggressor_DF",[nl.MADBRAIN_4FM2F]:"MadBrain_4FM2F",[nl.MADBRAIN_DYNAMITE6]:"MadBrain_Dynamite6",[nl.MAKK_M3]:"Makk_M3",[nl.MAKK_M4]:"Makk_M4",[nl.CYANPHASE_DTMF]:"CyanPhase_DTMF",[nl.ELENZIL_FREQUENCYBOMB]:"Elenzil_FrequencyBomb"}[e];if(!t)throw new Error(`Unknown machine type: ${e}`);return t}setParameter(e,t,a){e.port.postMessage({type:"setParameter",paramIndex:t,paramValue:a})}stop(e){e.port.postMessage({type:"stop"})}getMachineInfo(e){return sl[e]}}class il{name="BuzzmachineGenerator";output;audioContext;engine=rl.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;preGain=null;overdrive=null;overdriveDry=null;overdriveWet=null;mufflerFilter=null;postFilter=null;postGain=null;overdriveAmount=0;mufflerMode="off";filterTrackingAmount=0;currentCutoff=1e3;constructor(e){this.audioContext=Jn(),this.machineType=e,this.output=this.audioContext.createGain(),this.is303Style()&&this.createEffectsChain(),this.initEngine()}createEffectsChain(){const e=this.audioContext;this.preGain=e.createGain(),this.overdrive=e.createWaveShaper(),this.overdrive.oversample="2x",this.updateOverdriveCurve(.4),this.overdriveDry=e.createGain(),this.overdriveDry.gain.value=1,this.overdriveWet=e.createGain(),this.overdriveWet.gain.value=0,this.mufflerFilter=e.createBiquadFilter(),this.mufflerFilter.type="lowpass",this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7,this.postFilter=e.createBiquadFilter(),this.postFilter.type="lowpass",this.postFilter.frequency.value=2e4,this.postFilter.Q.value=1,this.postGain=e.createGain();const t=e.createGain();this.preGain.connect(this.overdriveDry),this.preGain.connect(this.overdrive),this.overdrive.connect(this.overdriveWet),this.overdriveDry.connect(t),this.overdriveWet.connect(t),t.connect(this.mufflerFilter),this.mufflerFilter.connect(this.postFilter),this.postFilter.connect(this.postGain),this.postGain.connect(this.output)}updateOverdriveCurve(e){if(!this.overdrive)return;const t=4096,a=new Float32Array(t),n=100*e;for(let s=0;s<t;s++){const e=s/t*2-1;a[s]=(1+n)*e/(1+n*Math.abs(e))}this.overdrive.curve=a}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const t=this.audioContext;if(await this.engine.init(t),this.workletNode=await this.engine.createMachineNode(t,this.machineType),!this.workletNode)throw new Error("Worklet node creation failed");const a=this.is303Style()&&this.preGain?this.preGain:this.output;this.workletNode.connect(a);try{const e=this.audioContext.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(this.audioContext.destination)}catch(e){}this.useWasmEngine=!0}catch(t){this.initError=t instanceof Error?t:new Error(String(t)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=sl[this.machineType];ji("BuzzmachineGenerator",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}triggerAttack(e,t,a=1,n,s){if(!this.useWasmEngine||!this.workletNode)return;const r=is(e);this.is303Style()&&this.filterTrackingAmount>0&&this.applyFilterTracking(r),this.workletNode.port.postMessage({type:"noteOn",frequency:r,velocity:Math.round(127*a),time:t,accent:n,slide:s})}triggerRelease(e){this.useWasmEngine&&this.workletNode&&this.workletNode.port.postMessage({type:"noteOff",time:e})}triggerAttackRelease(e,t,a,n=1,s,r){const i=void 0!==a?ls(a):os(),o=ls(t);this.triggerAttack(e,i,n,s,r),this.triggerRelease(i+o)}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}releaseAll(){this.stop()}is303Style(){return this.machineType===nl.OOMEK_AGGRESSOR||this.machineType===nl.OOMEK_AGGRESSOR_DF}isDevilFishWasm(){return this.machineType===nl.OOMEK_AGGRESSOR_DF}setCutoff(e){if(!this.is303Style())return;const t=200*Math.pow(100,e);this.currentCutoff=Math.max(200,Math.min(5e3,t)),this.postFilter&&0===this.filterTrackingAmount&&(this.postFilter.frequency.value=Math.min(18e3,1.5*this.currentCutoff));const a=Math.round(240*e);this.setParameter(1,Math.min(240,Math.max(0,a)))}setResonance(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(2,Math.min(128,Math.max(0,t)))}setEnvMod(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(3,Math.min(128,Math.max(0,t)))}setDecay(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(4,Math.min(128,Math.max(0,t)))}setAccentAmount(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(5,Math.min(128,Math.max(0,t)))}setAccent(e){this.setAccentAmount(e)}setTuning(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(6,Math.min(200,Math.max(0,t)))}setVolume(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(7,Math.min(200,Math.max(0,t)))}setWaveform(e){if(!this.is303Style())return;let t;t="number"==typeof e?e>=.5?1:0:"square"===e?1:0,this.setParameter(0,t)}setSlideTime(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(14,t)}}enableDevilFish(e,t){this.is303Style()&&(e?(this.setOverdrive(t?.overdrive??.3),this.setMuffler(t?.muffler??"mid"),this.setHighResonanceEnabled(!0),this.isDevilFishWasm()&&(this.setFilterTracking(.5),this.setSlideTime(.17),this.setSweepSpeed("normal"))):(this.setOverdrive(0),this.setMuffler("off"),this.setHighResonanceEnabled(!1),this.setFilterTracking(0)))}setOverdrive(e){if(this.is303Style()&&this.overdrive)if(this.overdriveAmount=Math.min(Math.max(e,0),1),0===this.overdriveAmount)this.overdriveDry&&(this.overdriveDry.gain.value=1),this.overdriveWet&&(this.overdriveWet.gain.value=0);else{const e=.8*this.overdriveAmount;this.overdriveDry&&(this.overdriveDry.gain.value=1-e),this.overdriveWet&&(this.overdriveWet.gain.value=e),this.updateOverdriveCurve(.2+.6*this.overdriveAmount)}}setMuffler(e){if(this.is303Style()){if(this.mufflerMode=e,this.isDevilFishWasm()){let e;switch(this.mufflerMode){case"dark":case"mid":e=1;break;case"bright":e=2;break;default:e=0}this.setParameter(15,e)}if(this.mufflerFilter)switch(this.mufflerMode){case"dark":this.mufflerFilter.frequency.value=2e3,this.mufflerFilter.Q.value=.5;break;case"mid":this.mufflerFilter.frequency.value=6e3,this.mufflerFilter.Q.value=.7;break;case"bright":this.mufflerFilter.frequency.value=12e3,this.mufflerFilter.Q.value=.7;break;default:this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7}}}applyFilterTracking(e){if(!this.postFilter||0===this.filterTrackingAmount)return;const t=Math.log2(e/440)*this.filterTrackingAmount*2e3,a=Math.max(200,Math.min(18e3,this.currentCutoff+t));this.postFilter.frequency.value=a}setFilterTracking(e){if(this.is303Style()&&(this.filterTrackingAmount=Math.min(Math.max(e,0),1),this.isDevilFishWasm())){const t=Math.round(200*e);this.setParameter(12,Math.min(200,t))}}setHighResonanceEnabled(e){this.is303Style()&&(this.isDevilFishWasm()&&this.setParameter(13,e?1:0),this.postFilter&&(this.postFilter.Q.value=e?4:1))}setHighResonance(e){this.setHighResonanceEnabled(e)}setNormalDecay(e){this.is303Style()&&this.setDecay(e)}setAccentDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(8,Math.min(128,Math.max(0,t)))}}setVegDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(9,Math.min(128,Math.max(0,t)))}}setVegSustain(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(10,t)}}setSoftAttack(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(11,Math.min(100,Math.max(0,t)))}}setFilterFM(e){this.is303Style()&&this.isDevilFishWasm()&&this.setParameter(19,Math.round(100*e))}setSweepSpeed(e){if(this.is303Style()&&this.isDevilFishWasm()){let t;if("number"==typeof e)t=Math.round(2*e);else switch(e.toLowerCase()){case"fast":t=0;break;case"slow":t=2;break;default:t=1}this.setParameter(16,t)}}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}dispose(){this.output.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.preGain&&(this.preGain.disconnect(),this.preGain=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveDry&&(this.overdriveDry.disconnect(),this.overdriveDry=null),this.overdriveWet&&(this.overdriveWet.disconnect(),this.overdriveWet=null),this.mufflerFilter&&(this.mufflerFilter.disconnect(),this.mufflerFilter=null),this.postFilter&&(this.postFilter.disconnect(),this.postFilter=null),this.postGain&&(this.postGain.disconnect(),this.postGain=null)}}const ol=0,ll=1,cl=2,ul=3,dl=4,pl=5,hl=6,ml=7,fl=8,gl=9,yl=10,bl=11,vl=12,xl=13,wl=14,kl=15,Sl=16,Ml=17,Nl=18,Cl=19,El=20,Pl=126,_l=127,Tl=128,Al=129,Ol=130,Il=131,Dl=132,Fl=133,Rl=134,jl=135,Ll=136,Bl=137,Vl=138,zl=139,Ul=140,Gl=141,Wl=142,Hl=143,Kl=144,$l={"E.PIANO 1":{algorithm:5,feedback:6,operators:[{level:99,coarse:1,fine:0,detune:7},{level:70,coarse:14,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:60,coarse:1,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:80,coarse:1,fine:0,detune:7}]},"BRASS 1":{algorithm:22,feedback:7},"STRINGS 1":{algorithm:2,feedback:4},"INIT VOICE":{algorithm:0,feedback:0}};class ql{name="DexedSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=Jn().createGain(),this.config={algorithm:0,feedback:0,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=Jn(),a="/DEViLBOX/";ql.isWorkletLoaded||(ql.workletLoadPromise||(ql.workletLoadPromise=t.audioWorklet.addModule(`${a}dexed/Dexed.worklet.js`)),await ql.workletLoadPromise,ql.isWorkletLoaded=!0);const[n,s]=await Promise.all([fetch(`${a}dexed/Dexed.wasm`),fetch(`${a}dexed/Dexed.js`)]);if(!n.ok)throw new Error(`Failed to load Dexed.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load Dexed.js: ${s.status}`);const[r,i]=await Promise.all([n.arrayBuffer(),s.text()]),o=i.replace(/import\.meta\.url/g,`"${a}dexed/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(t,"dexed-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:o}),this._worklet.connect(this.output);try{const e=t.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(t.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){this._worklet&&this.isInitialized&&(void 0!==e.algorithm&&this.setParameter(Rl,e.algorithm),void 0!==e.feedback&&this.setParameter(jl,e.feedback),void 0!==e.oscSync&&this.setParameter(Ll,e.oscSync?1:0),void 0!==e.transpose&&this.setParameter(Kl,e.transpose),void 0!==e.lfoSpeed&&this.setParameter(Bl,e.lfoSpeed),void 0!==e.lfoDelay&&this.setParameter(Vl,e.lfoDelay),void 0!==e.lfoPmd&&this.setParameter(zl,e.lfoPmd),void 0!==e.lfoAmd&&this.setParameter(Ul,e.lfoAmd),void 0!==e.lfoSync&&this.setParameter(Gl,e.lfoSync?1:0),void 0!==e.lfoWave&&this.setParameter(Wl,e.lfoWave),void 0!==e.lfoPms&&this.setParameter(Hl,e.lfoPms),e.pitchEgRates&&(this.setParameter(Pl,e.pitchEgRates[0]),this.setParameter(_l,e.pitchEgRates[1]),this.setParameter(Tl,e.pitchEgRates[2]),this.setParameter(Al,e.pitchEgRates[3])),e.pitchEgLevels&&(this.setParameter(Ol,e.pitchEgLevels[0]),this.setParameter(Il,e.pitchEgLevels[1]),this.setParameter(Dl,e.pitchEgLevels[2]),this.setParameter(Fl,e.pitchEgLevels[3])),e.operators&&e.operators.forEach((e,t)=>{if(t>=6)return;const a=21*t;void 0!==e.level&&this.setParameter(a+Sl,e.level),void 0!==e.coarse&&this.setParameter(a+Nl,e.coarse),void 0!==e.fine&&this.setParameter(a+Cl,e.fine),void 0!==e.detune&&this.setParameter(a+El,e.detune),void 0!==e.mode&&this.setParameter(a+Ml,e.mode),e.egRates&&(this.setParameter(a+ol,e.egRates[0]),this.setParameter(a+ll,e.egRates[1]),this.setParameter(a+cl,e.egRates[2]),this.setParameter(a+ul,e.egRates[3])),e.egLevels&&(this.setParameter(a+dl,e.egLevels[0]),this.setParameter(a+pl,e.egLevels[1]),this.setParameter(a+hl,e.egLevels[2]),this.setParameter(a+ml,e.egLevels[3])),void 0!==e.breakPoint&&this.setParameter(a+fl,e.breakPoint),void 0!==e.leftDepth&&this.setParameter(a+gl,e.leftDepth),void 0!==e.rightDepth&&this.setParameter(a+yl,e.rightDepth),void 0!==e.leftCurve&&this.setParameter(a+bl,e.leftCurve),void 0!==e.rightCurve&&this.setParameter(a+vl,e.rightCurve),void 0!==e.rateScaling&&this.setParameter(a+xl,e.rateScaling),void 0!==e.ampModSens&&this.setParameter(a+wl,e.ampModSens),void 0!==e.velocitySens&&this.setParameter(a+kl,e.velocitySens)}))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadSysEx(e){this._worklet?.port.postMessage({type:"loadSysEx",sysexData:Array.from(e)})}loadPreset(e){const t=$l[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setAlgorithm(e){this.config.algorithm=Math.max(0,Math.min(31,e)),this.setParameter(Rl,this.config.algorithm)}setFeedback(e){this.config.feedback=Math.max(0,Math.min(7,e)),this.setParameter(jl,this.config.feedback)}setOperatorLevel(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+Sl,Math.max(0,Math.min(99,t)))}setOperatorCoarse(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+Nl,Math.max(0,Math.min(31,t)))}setOperatorFine(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+Cl,Math.max(0,Math.min(99,t)))}setOperatorDetune(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+El,Math.max(0,Math.min(14,t)))}setLfoSpeed(e){this.config.lfoSpeed=Math.max(0,Math.min(99,e)),this.setParameter(Bl,this.config.lfoSpeed)}setLfoPitchModDepth(e){this.config.lfoPmd=Math.max(0,Math.min(99,e)),this.setParameter(zl,this.config.lfoPmd)}setLfoAmpModDepth(e){this.config.lfoAmd=Math.max(0,Math.min(99,e)),this.setParameter(Ul,this.config.lfoAmd)}setLfoWaveform(e){this.config.lfoWave=Math.max(0,Math.min(5,e)),this.setParameter(Wl,this.config.lfoWave)}setTranspose(e){this.config.transpose=Math.max(0,Math.min(48,e)),this.setParameter(Kl,this.config.transpose)}triggerAttack(e,t,a=1){const n=rs(e),s=Math.round(127*a);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}),this):(this.pendingNotes.push({note:n,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Xl=0,Yl=1,Ql=2,Zl=3,Jl=4,ec=5,tc=6,ac=7,nc=8,sc=9,rc=11,ic=12,oc=13,lc=14,cc=15,uc=16,dc=17,pc=18,hc=19,mc=20,fc=21,gc=22,yc=23,bc=24,vc=25,xc=26,wc=27,kc=28,Sc=29,Mc=30,Nc=31,Cc=32,Ec=33,Pc=34,_c=35,Tc=36,Ac=37,Oc=38,Ic=39,Dc=40,Fc=41,Rc=42,jc=43,Lc=44,Bc=0,Vc=1,zc=0,Uc={"Classic Brass":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Detune:.05,osc1Level:1,osc2Level:.8,filterCutoff:.4,filterResonance:.2,filterEnvAmount:.6,filterAttack:.1,filterDecay:.3,filterSustain:.4,filterRelease:.2,ampAttack:.05,ampDecay:.1,ampSustain:.8,ampRelease:.3},"Fat Lead":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Octave:-1,osc2Detune:.1,osc1Level:1,osc2Level:1,filterCutoff:.6,filterResonance:.4,filterEnvAmount:.3,lfoRate:.3,lfoOscAmount:.1},"Pulse Pad":{osc1Waveform:Vc,osc2Waveform:Vc,osc1PulseWidth:.3,osc2PulseWidth:.7,osc2Detune:.02,filterCutoff:.3,filterResonance:.1,filterEnvAmount:.2,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,lfoRate:.15,lfoPwAmount:.3},"Sync Lead":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Octave:1,oscSync:!0,filterCutoff:.5,filterResonance:.3,filterEnvAmount:.5},Init:{osc1Waveform:Bc,osc1Level:1,osc2Level:0,filterCutoff:.7,filterResonance:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3}};class Gc{name="OBXdSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=Jn().createGain(),this.config={osc1Waveform:Bc,osc1Octave:0,osc1Level:1,osc1PulseWidth:.5,osc2Waveform:Bc,osc2Octave:0,osc2Detune:.1,osc2Level:.7,osc2PulseWidth:.5,filterCutoff:.7,filterResonance:.3,filterEnvAmount:.5,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:zc,masterVolume:.7,velocitySensitivity:.5,panSpread:.3,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=Jn(),a="/DEViLBOX/";Gc.isWorkletLoaded||(Gc.workletLoadPromise||(Gc.workletLoadPromise=t.audioWorklet.addModule(`${a}obxd/OBXd.worklet.js`)),await Gc.workletLoadPromise,Gc.isWorkletLoaded=!0);const[n,s]=await Promise.all([fetch(`${a}obxd/OBXd.wasm`),fetch(`${a}obxd/OBXd.js`)]);if(!n.ok)throw new Error(`Failed to load OBXd.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load OBXd.js: ${s.status}`);const[r,i]=await Promise.all([n.arrayBuffer(),s.text()]),o=i.replace(/import\.meta\.url/g,`"${a}obxd/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(t,"obxd-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:o}),this._worklet.connect(this.output);try{const e=t.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(t.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){if(!this._worklet||!this.isInitialized)return;const t=[["osc1Waveform",Xl],["osc1Octave",Yl],["osc1Detune",Ql],["osc1PulseWidth",Zl],["osc1Level",Jl],["osc2Waveform",ec],["osc2Octave",tc],["osc2Detune",ac],["osc2PulseWidth",nc],["osc2Level",sc],["filterCutoff",oc],["filterResonance",lc],["filterType",cc],["filterEnvAmount",uc],["filterKeyTrack",dc],["filterVelocity",pc],["filterAttack",hc],["filterDecay",mc],["filterSustain",fc],["filterRelease",gc],["ampAttack",yc],["ampDecay",bc],["ampSustain",vc],["ampRelease",xc],["lfoRate",wc],["lfoWaveform",kc],["lfoDelay",Sc],["lfoOscAmount",Mc],["lfoFilterAmount",Nc],["lfoAmpAmount",Cc],["lfoPwAmount",Ec],["masterVolume",Pc],["voices",_c],["unisonDetune",Ac],["portamento",Oc],["velocitySensitivity",Dc],["panSpread",Ic],["noiseLevel",Fc],["subOscLevel",Rc],["subOscOctave",jc],["drift",Lc]];for(const[a,n]of t){const t=e[a];void 0!==t&&this.setParameter(n,t)}void 0!==e.oscSync&&this.setParameter(rc,e.oscSync?1:0),void 0!==e.oscXor&&this.setParameter(ic,e.oscXor?1:0),void 0!==e.unison&&this.setParameter(Tc,e.unison?1:0)}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadPreset(e){const t=Uc[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setCutoff(e){this.config.filterCutoff=Math.max(0,Math.min(1,e)),this.setParameter(oc,this.config.filterCutoff)}setResonance(e){this.config.filterResonance=Math.max(0,Math.min(1,e)),this.setParameter(lc,this.config.filterResonance)}setFilterEnvAmount(e){this.config.filterEnvAmount=Math.max(0,Math.min(1,e)),this.setParameter(uc,this.config.filterEnvAmount)}setOsc1Waveform(e){this.config.osc1Waveform=e,this.setParameter(Xl,e)}setOsc2Waveform(e){this.config.osc2Waveform=e,this.setParameter(ec,e)}setOsc2Detune(e){this.config.osc2Detune=Math.max(-1,Math.min(1,e)),this.setParameter(ac,this.config.osc2Detune)}setLfoRate(e){this.config.lfoRate=Math.max(0,Math.min(1,e)),this.setParameter(wc,this.config.lfoRate)}setLfoOscAmount(e){this.config.lfoOscAmount=Math.max(0,Math.min(1,e)),this.setParameter(Mc,this.config.lfoOscAmount)}setLfoFilterAmount(e){this.config.lfoFilterAmount=Math.max(0,Math.min(1,e)),this.setParameter(Nc,this.config.lfoFilterAmount)}setPortamento(e){this.config.portamento=Math.max(0,Math.min(1,e)),this.setParameter(Oc,this.config.portamento)}setUnison(e){this.config.unison=e,this.setParameter(Tc,e?1:0)}setUnisonDetune(e){this.config.unisonDetune=Math.max(0,Math.min(1,e)),this.setParameter(Ac,this.config.unisonDetune)}setVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.setParameter(Pc,this.config.masterVolume)}triggerAttack(e,t,a=1){const n=rs(e),s=Math.round(127*a);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}),this):(this.pendingNotes.push({note:n,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Wc=0,Hc=0,Kc=0,$c=16,qc=32,Xc=96,Yc=104,Qc=152;class Zc{name="CZ101Synth";output;audioContext;workletNode=null;voices=[];currentPatch=null;isInitialized=!1;initPromise=null;static DEFAULT_PATCH={name:"Init",line1:{waveform1:Wc,dcaEnvelope:[{rate:99,level:99},{rate:60,level:80},{rate:40,level:60},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:0,level:0}],dcwEnvelope:[{rate:99,level:99},{rate:50,level:70},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:2,level:2},{rate:0,level:0}]}};constructor(){this.audioContext=Jn(),this.output=this.audioContext.createGain();for(let e=0;e<8;e++)this.voices.push({note:0,velocity:0,active:!1,envStage:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){const e=this.audioContext;if(!e.audioWorklet)throw new Error("AudioWorklet not supported");try{await e.audioWorklet.addModule("/DEViLBOX/cz101/CZ101.worklet.js")}catch(t){if(!t?.message?.includes("already"))throw t}this.workletNode=new AudioWorkletNode(e,"cz101-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch(a){}await new Promise((e,t)=>{const a=setTimeout(()=>t(new Error("CZ101 init timeout")),5e3),n=t=>{"initialized"===t.data.type&&(clearTimeout(a),this.workletNode?.port.removeEventListener("message",n),e())};this.workletNode.port.addEventListener("message",n),this.workletNode.port.start(),this.workletNode.port.postMessage({type:"init"})}),this.isInitialized=!0,this.loadPatch(Zc.DEFAULT_PATCH)}writeReg(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"writeReg",register:e,value:t})}midiNoteToPitch(e,t=0){return(e-7<<9)+4*t}encodeDCAStep(e,t,a,n){return(1&e)<<15|(127&t)<<8|(1&a)<<7|127&n}_encodeDCOStep(e,t,a,n,s){return(1&e)<<15|(127&t)<<8|(1&a)<<7|(1&n)<<6|63&s}encodeWaveform(e,t,a,n,s,r){return(7&e)<<13|(7&(t??e))<<10|(void 0!==t?1:0)<<9|(7&a)<<6|(n?1:0)<<5|(3&s)<<3|(r?1:0)<<2}loadPatch(e){if(this.currentPatch=e,this.workletNode)for(let t=0;t<8;t++){const a=this.encodeWaveform(e.line1.waveform1,e.line1.waveform2,Hc,e.ringMod??!1,e.noiseMode?2:0,!1);this.writeReg(Yc+t,a)}}triggerAttack(e,t,a=.8){const n="string"==typeof e?rs(e):e;let s=this.voices.findIndex(e=>!e.active);-1===s&&(s=0);const r=this.voices[s];if(r.note=n,r.velocity=Math.floor(127*a),r.active=!0,r.envStage=0,!this.workletNode||!this.currentPatch)return;const i=this.midiNoteToPitch(n,this.currentPatch.detune??0);this.writeReg(Xc+s,i),this.writeReg(Qc+s,0);const o=this.currentPatch.line1.dcaEnvelope[0],l=this.encodeDCAStep(0,o.rate,0,Math.floor(o.level*r.velocity/127));this.writeReg(Kc+s,l);const c=this.currentPatch.line1.dcwEnvelope[0],u=this.encodeDCAStep(0,c.rate,0,c.level);if(this.writeReg(qc+s,u),this.currentPatch.line1.dcoEnvelope&&this.currentPatch.line1.dcoEnvelope.length>0){const e=this.currentPatch.line1.dcoEnvelope[0],t=this._encodeDCOStep(0,e.rate,0,0,e.level);this.writeReg($c+s,t)}}triggerRelease(e,t){const a="string"==typeof e?rs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;if(this.voices[n].active=!1,!this.workletNode||!this.currentPatch)return;const s=this.encodeDCAStep(1,40,0,0);this.writeReg(Kc+n,s)}setParameter(e,t){}getParameters(){return{}}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.disconnect()}}const Jc=0,eu=1,tu=2,au=3,nu=4,su=5,ru=6,iu=7,ou=1,lu=2,cu=4;class uu extends Ar{name="CEM3394Synth";chipName="CEM3394";workletFile="CEM3394.worklet.js";processorName="cem3394-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setCutoff(e){this.setParameterById(ru,e)}setResonance(e){this.setParameterById(su,e)}setFilterModulation(e){this.setParameterById(eu,e)}setPulseWidth(e){this.setParameterById(au,e)}setWaveform(e){let t=lu|cu;if("string"==typeof e)switch(e.toLowerCase()){case"triangle":t=ou;break;case"sawtooth":case"saw":t=lu;break;case"pulse":case"square":t=cu;break;case"all":t=ou|lu|cu}else t=e;this.setParameterById(tu,t)}setVolume(e){this.setParameterById(iu,e)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={vco_frequency:Jc,modulation:eu,wave_select:tu,pulse_width:au,mixer_balance:nu,resonance:su,cutoff:ru,volume:iu}[e];void 0!==a&&this.setParameterById(a,t)}}const du=0;class pu extends Ar{name="SCSPSynth";chipName="SCSP";workletFile="SCSP.worklet.js";processorName="scsp-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const a=t/2,n=Math.log2(e/a),s=Math.floor(n)+1,r=Math.round(1024*(e/(a*Math.pow(2,s-1))-1));return{oct:Math.max(-8,Math.min(7,s)),fns:Math.max(0,Math.min(1023,r))}}(e);this.workletNode.port.postMessage({type:"setFrequency",oct:t.oct,fns:t.fns,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",tl:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*31),a=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",sdl:t,sdr:a,slot:this.currentSlot})}setFMLevel(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMLevel",slot:e,level:t})}setFMInputSlot(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMInputSlot",slot:e,inputSlot:t})}setSlot(e){this.currentSlot=Math.max(0,Math.min(31,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r??0})}setEnvelope(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,ar:t,d1r:a,d2r:n,rr:s,dl:r})}setLFO(e,t,a,n,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,plfos:t,alfos:a,freq:n,wave:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:du,volume:du}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(du,e)}}const hu={chipName:"TR707",basePath:"/roms/tr707",zipFile:"tr707.zip",combinedFile:"tr707_combined.bin",combinedSize:131072,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768}]},mu={chipName:"TR707-Expansion",basePath:"/roms/tr707",zipFile:"tr707_expansion.zip",combinedFile:"tr707_expansion.bin",combinedSize:262144,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768},{name:"tr707_expansion.bin",offset:131072,size:131072}]},fu={chipName:"C352",basePath:"/roms/c352",zipFile:"c352.zip",combinedFile:"c352_samples.bin",combinedSize:8388608,files:[{name:"c352_samples_0.bin",offset:0,size:4194304,required:!0},{name:"c352_samples_1.bin",offset:4194304,size:4194304,required:!0}]},gu={chipName:"K054539",basePath:"/roms/k054539",zipFile:"k054539.zip",combinedFile:"k054539_samples.bin",combinedSize:6291456,files:[{name:"k054539_samples_0.bin",offset:0,size:2097152,required:!0},{name:"k054539_samples_1.bin",offset:2097152,size:1048576,required:!0},{name:"k054539_samples_2.bin",offset:3145728,size:1048576,required:!0},{name:"k054539_samples_3.bin",offset:4194304,size:2097152,required:!0}]},yu={chipName:"ICS2115",basePath:"/roms/ics2115",zipFile:"ics2115.zip",combinedFile:"ics2115_wavetable.bin",combinedSize:262144,files:[{name:"ics2115_wavetable_0.bin",offset:0,size:262144,required:!0}]},bu={chipName:"RF5C400",basePath:"/roms/rf5c400",zipFile:"rf5c400.zip",combinedFile:"rf5c400_samples.bin",files:[{name:"rf5c400_samples.bin",offset:0,required:!0}]},vu={chipName:"ES5503",basePath:"/roms/es5503",zipFile:"es5503.zip",combinedFile:"es5503_wavetable.bin",files:[{name:"es5503_wavetable.bin",offset:0,required:!0}]},xu={chipName:"D50",basePath:"/roms/d50",zipFile:"d50.zip",files:[{name:"d50_firmware.bin",offset:0,size:65536,required:!0},{name:"d50_ic30.bin",offset:65536,size:524288,required:!0},{name:"d50_ic29.bin",offset:589824,size:524288,required:!0}]},wu={chipName:"VFX",basePath:"/roms/vfx",zipFile:"vfx.zip",files:[{name:"u14.bin",offset:0,size:524288,required:!0},{name:"u15.bin",offset:524288,size:524288,required:!0},{name:"u16.bin",offset:1048576,size:524288,required:!0},{name:"vfx210b-low.bin",offset:1572864,size:65536},{name:"vfx210b-high.bin",offset:1638400,size:65536}]};async function ku(e){try{if(e.zipFile){const t=`${e.basePath}/${e.zipFile}`,a=await async function(e,t){try{const a=await fetch(Ra(e));if(!a.ok)return null;if((a.headers.get("content-type")||"").includes("text/html"))return null;const n=await a.arrayBuffer();if(n.byteLength<4)return null;const s=new Uint8Array(n,0,4);if(80!==s[0]||75!==s[1])return null;const r=await Ua.loadAsync(n),i=t.files.filter(e=>e.size).map(e=>e.offset+e.size),o=i.length>0?Math.max(...i):t.combinedSize||4194304;let l=new Uint8Array(o),c=0;for(const e of t.files){let t=r.file(e.name);if(!t){const a=Object.keys(r.files).find(t=>t.endsWith("/"+e.name)||t===e.name);a&&(t=r.file(a))}if(!t){if(e.required)return null;continue}const a=await t.async("uint8array");e.size&&(a.length,e.size);const n=e.offset+a.length;if(n>l.length){const e=new Uint8Array(n);e.set(l),l=e}l.set(a,e.offset),c++}return 0===c?null:l}catch(a){return null}}(t,e);if(a)return a}if(e.combinedFile)try{const t=await fetch(Ra(`${e.basePath}/${e.combinedFile}`)),a=t.headers.get("content-type")||"";if(t.ok&&!a.includes("text/html")){const a=await t.arrayBuffer(),n=new Uint8Array(a);return e.combinedSize&&(n.length,e.combinedSize),n}}catch(t){}const a=Math.max(...e.files.map(e=>e.offset+(e.size||0))),n=new Uint8Array(a||1048576);let s=0;const r=await Promise.allSettled(e.files.map(async t=>{try{const a=await fetch(Ra(`${e.basePath}/${t.name}`)),r=a.headers.get("content-type")||"";if(!a.ok||r.includes("text/html")){if(t.required)throw new Error(`${t.name} not found (HTTP ${a.status}, type: ${r})`);return}const i=await a.arrayBuffer(),o=new Uint8Array(i);t.size&&(o.length,t.size),n.set(o,t.offset),s++}catch(a){if(t.required)throw a}}));if(0===s)throw new Error(`No ROM files loaded for ${e.chipName}`);if(r.find((t,a)=>"rejected"===t.status&&e.files[a].required))throw new Error(`Required ROM file failed to load for ${e.chipName}`);return n}catch(a){throw new Error(`${e.chipName} ROM files not found or invalid.\nPlease place ROM files in ${e.basePath}/\nRequired files: ${e.files.filter(e=>e.required).map(e=>e.name).join(", ")}`)}}const Su=1,Mu=0,Nu=1,Cu=3,Eu=5,Pu=6,_u=7,Tu=8,Au=10,Ou=12;class Iu{name="VFXSynth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=16e6;static NUM_VOICES=32;constructor(){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<Iu.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,looping:!1})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(dr,Iu.CLOCK),0===this.handle)throw new Error("Failed to create ES5506 instance");this.isInitialized=!0;try{const e=await async function(){const e=await ku(wu);return[e.slice(0,524288),e.slice(524288,1048576),e.slice(1048576,1572864)]}();for(let t=0;t<e.length;t++)await this.loadSampleROM(t,e[t].buffer)}catch(e){}}async loadSampleROM(e,t){this.isInitialized||await this.init(),this.mameEngine.setRom(e,new Uint8Array(t)),this.romLoaded=!0}writeVoiceReg(e,t,a){if(0===this.handle)return;const n=16*e+t;this.mameEngine.write16(this.handle,n,a)}midiNoteToFreqCount(e,t=44100){const a=440*Math.pow(2,(e-69)/12);return 4294967295&Math.floor(a*Math.pow(2,32)/t)}velocityToVolume(e){const t=e/127,a=Math.pow(t,2);return Math.floor(65535*a)}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,a=.8){if(!this.isInitialized||!this.romLoaded)return;const n="string"==typeof e?rs(e):e,s=this.allocateVoice(),r=this.voices[s];r.note=n,r.velocity=Math.floor(127*a),r.active=!0;const i=this.midiNoteToFreqCount(n);this.writeVoiceReg(s,Nu,i>>>16),this.writeVoiceReg(s,Nu+1,65535&i);const o=this.velocityToVolume(r.velocity);this.writeVoiceReg(s,Cu,o),this.writeVoiceReg(s,_u,o),this.writeVoiceReg(s,Pu,0);let l=Su;this.writeVoiceReg(s,Mu,l)}triggerAttackRelease(e,t=.5,a,n=.8){this.triggerAttack(e,a,n);const s="string"==typeof t?ls(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?rs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1,this.writeVoiceReg(n,Eu,128),this.writeVoiceReg(n,Tu,128)}setFilter(e,t,a){this.writeVoiceReg(e,Ou,Math.floor(65535*t)),this.writeVoiceReg(e,Au,Math.floor(65535*a))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const Du=0,Fu=6144;class Ru{name="D50Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=2e7;static NUM_VOICES=16;constructor(){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<Ru.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,partialMask:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(pr,Ru.CLOCK),0===this.handle)throw new Error("Failed to create Roland SA instance");this.isInitialized=!0;try{const{firmware:e,ic30:t,ic29:a}=await async function(){const e=await ku(xu);return{firmware:e.slice(0,65536),ic30:e.slice(65536,589824),ic29:e.slice(589824,1114112)}}();await this.loadROMs(t.buffer,a.buffer,e.buffer)}catch(e){}}async loadROMs(e,t,a){this.isInitialized||await this.init(),this.mameEngine.rsaLoadRoms(this.handle,new Uint8Array(e),new Uint8Array(t),new Uint8Array(a)),this.romLoaded=!0}writeControl(e,t){0!==this.handle&&this.mameEngine.write(this.handle,e,t)}_midiNoteToPitch(e,t=0){return e}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e,this.isInitialized}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,a=.8){if(!this.isInitialized||!this.romLoaded)return;const n="string"==typeof e?rs(e):e,s=this.allocateVoice(),r=this.voices[s],i=this._currentPatch?.effects?.chorusRate??0,o=this._midiNoteToPitch(n,i);r.note=n,r.velocity=Math.floor(127*a),r.active=!0,r.partialMask=15;const l=Du+128*s;this.writeControl(l+0,o),this.writeControl(l+1,r.velocity),this.writeControl(l+2,1)}triggerAttackRelease(e,t=.5,a,n=.8){this.triggerAttack(e,a,n);const s="string"==typeof t?ls(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?rs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1;const s=Du+128*n;this.writeControl(s+2,0)}setChorus(e,t){this.writeControl(Fu+0,Math.floor(127*e)),this.writeControl(Fu+1,Math.floor(127*t))}setReverb(e){this.writeControl(Fu+16,Math.floor(127*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const ju=0,Lu=1,Bu=2,Vu=3,zu=4,Uu=5,Gu=6,Wu=7,Hu=8,Ku=9,$u=[{ic5:"mks20_15179738.BIN",ic6:"mks20_15179737.BIN",ic7:"mks20_15179736.BIN",ic18:"mks20_15179757.BIN"},{ic5:"mks20_15179741.BIN",ic6:"mks20_15179740.BIN",ic7:"mks20_15179739.BIN",ic18:"mks20_15179757.BIN"},{ic5:"MK80_IC5.bin",ic6:"MK80_IC6.bin",ic7:"MK80_IC7.bin",ic18:"MK80_IC18.bin"}],qu=[{name:"MKS-20: Piano 1",romSet:0},{name:"MKS-20: Piano 2",romSet:0},{name:"MKS-20: Piano 3",romSet:0},{name:"MKS-20: Harpsichord",romSet:1},{name:"MKS-20: Clavi",romSet:1},{name:"MKS-20: Vibraphone",romSet:1},{name:"MKS-20: E-Piano 1",romSet:1},{name:"MKS-20: E-Piano 2",romSet:1},{name:"MK-80: Classic",romSet:2},{name:"MK-80: Special",romSet:2},{name:"MK-80: Blend",romSet:2},{name:"MK-80: Contemporary",romSet:2},{name:"MK-80: A. Piano 1",romSet:2},{name:"MK-80: A. Piano 2",romSet:2},{name:"MK-80: Clavi",romSet:2},{name:"MK-80: Vibraphone",romSet:2}];class Xu{name="RdPianoSynth";output;audioContext;_worklet=null;config;isInitialized=!1;pendingNotes=[];loadedRomSets=new Set;currentPatch=0;romLoadError=!1;_initPromise;static romCache=new Map;static isWorkletLoaded=!1;static workletLoadPromise=null;static wasmBinary=null;static jsCode=null;constructor(e={}){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.config={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.audioContext,t="/DEViLBOX/";if(!Xu.isWorkletLoaded){if(!Xu.workletLoadPromise){const a=`?v=${Date.now()}`;Xu.workletLoadPromise=e.audioWorklet.addModule(`${t}rdpiano/RdPiano.worklet.js${a}`)}await Xu.workletLoadPromise,Xu.isWorkletLoaded=!0}if(!Xu.wasmBinary||!Xu.jsCode){const[e,a]=await Promise.all([fetch(`${t}rdpiano/RdPiano.wasm`),fetch(`${t}rdpiano/RdPiano.js`)]);if(!e.ok||!a.ok)throw new Error("Failed to fetch RdPiano WASM files");const[n,s]=await Promise.all([e.arrayBuffer(),a.text()]);Xu.jsCode=s.replace(/import\.meta\.url/g,`"${t}rdpiano/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),Xu.wasmBinary=n}this._worklet=new AudioWorkletNode(this.audioContext,"rdpiano-processor"),this._worklet.port.onmessage=e=>{const{type:t}=e.data;if("wasmReady"===t)this.loadROMs();else if("ready"===t){this.isInitialized=!0,this.applyConfig(),null!=this.config.patch&&0!==this.config.patch&&this.selectPatch(this.config.patch);for(const{note:e,velocity:t}of this.pendingNotes)this._worklet?.port.postMessage({type:"noteOn",note:e,velocity:t});this.pendingNotes=[]}},this._worklet.port.postMessage({type:"init",wasmBinary:Xu.wasmBinary,jsCode:Xu.jsCode}),this._worklet.connect(this.output)}catch(e){}}async loadROMs(){try{const e=`${"/DEViLBOX/"}rdpiano/roms/`,t=await this.fetchROM(e+"RD200_B.bin");if(!t)return void(this.romLoadError=!0);this._worklet?.port.postMessage({type:"loadProgramROM",romData:t}),await new Promise(e=>setTimeout(e,50));const a=this.config.patch||0,n=qu[a].romSet;await this.loadROMSet(n),await new Promise(e=>setTimeout(e,100)),this._worklet?.port.postMessage({type:"initMCU"})}catch(e){this.romLoadError=!0}}async loadROMSet(e){if(this.loadedRomSets.has(e))return!0;if(e<0||e>2)return!1;const t="/DEViLBOX/rdpiano/roms/",a=$u[e],[n,s,r,i]=await Promise.all([this.fetchROM(t+a.ic5),this.fetchROM(t+a.ic6),this.fetchROM(t+a.ic7),this.fetchROM(t+a.ic18)]);return!!(n&&s&&r&&i)&&(this._worklet?.port.postMessage({type:"loadROMSet",setIndex:e,ic5:n,ic6:s,ic7:r,ic18:i}),this.loadedRomSets.add(e),!0)}async fetchROM(e){const t=Xu.romCache.get(e);if(t)return t.slice(0);try{const t=await fetch(e);if(!t.ok)return null;const a=await t.arrayBuffer();return Xu.romCache.set(e,a),a.slice(0)}catch(a){return null}}applyConfig(){this._worklet&&this.isInitialized&&(null!=this.config.chorusEnabled&&this.setParameter(ju,this.config.chorusEnabled?1:0),null!=this.config.chorusRate&&this.setParameter(Lu,this.config.chorusRate),null!=this.config.chorusDepth&&this.setParameter(Bu,this.config.chorusDepth),null!=this.config.efxEnabled&&this.setParameter(Vu,this.config.efxEnabled?1:0),null!=this.config.phaserRate&&this.setParameter(zu,this.config.phaserRate),null!=this.config.phaserDepth&&this.setParameter(Uu,this.config.phaserDepth),null!=this.config.tremoloEnabled&&this.setParameter(Gu,this.config.tremoloEnabled?1:0),null!=this.config.tremoloRate&&this.setParameter(Wu,this.config.tremoloRate),null!=this.config.tremoloDepth&&this.setParameter(Hu,this.config.tremoloDepth),null!=this.config.volume&&this.setParameter(Ku,this.config.volume))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}async selectPatch(e){if(e<0||e>=16)return;const t=qu[e];if(!this.loadedRomSets.has(t.romSet)){if(!(await this.loadROMSet(t.romSet)))return}this._worklet?.port.postMessage({type:"selectPatch",patchIndex:e}),this.currentPatch=e}setChorusEnabled(e){this.config.chorusEnabled=e,this.setParameter(ju,e?1:0)}setChorusRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusRate=e,this.setParameter(Lu,e)}setChorusDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusDepth=e,this.setParameter(Bu,e)}setEfxEnabled(e){this.config.efxEnabled=e,this.setParameter(Vu,e?1:0)}setPhaserRate(e){e=Math.max(0,Math.min(1,e)),this.config.phaserRate=e,this.setParameter(zu,e)}setPhaserDepth(e){e=Math.max(0,Math.min(1,e)),this.config.phaserDepth=e,this.setParameter(Uu,e)}setTremoloEnabled(e){this.config.tremoloEnabled=e,this.setParameter(Gu,e?1:0)}setTremoloRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloRate=e,this.setParameter(Wu,e)}setTremoloDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloDepth=e,this.setParameter(Hu,e)}setVolume(e){e=Math.max(0,Math.min(1,e)),this.config.volume=e,this.setParameter(Ku,e)}triggerAttack(e,t,a=1){const n=rs(e),s=Math.round(127*Math.max(0,Math.min(1,a)));this.romLoadError||(this.isInitialized?this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}):this.pendingNotes.push({note:n,velocity:s}))}triggerRelease(e,t){if(this._worklet)if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}getCurrentPatch(){return this.currentPatch}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Yu=8,Qu=10,Zu=12,Ju=50,ed=4096;class td{name="MU2000Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;static CLOCK=33868800;static NUM_VOICES=64;constructor(){this.audioContext=Jn(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<td.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,channel:0,active:!1,startTime:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(hr,td.CLOCK),0===this.handle)throw new Error("Failed to create SWP30 instance");this.isInitialized=!0}async loadWaveROM(e){this.isInitialized||await this.init();const t=new Uint8Array(e);this.mameEngine.setRom(0,t),this.romLoaded=!0}midiNoteToPitch(e,t=0){const a=e-60+t/8192,n=Math.pow(2,a/12);return 65535&Math.floor(8192*n)}velocityToVolume(e){return Math.floor(2*e)}allocateVoice(e){let t=this.voices.findIndex(e=>!e.active);if(-1===t){let a=1/0,n=0;for(let t=0;t<this.voices.length;t++)this.voices[t].channel===e&&this.voices[t].startTime<a&&(a=this.voices[t].startTime,n=t);if(a===1/0)for(let e=0;e<this.voices.length;e++)this.voices[e].startTime<a&&(a=this.voices[e].startTime,n=e);t=n}return t}writeReg(e,t){0!==this.handle&&this.mameEngine.write16(this.handle,e,t)}triggerAttack(e,t,a=.8,n=0){if(!this.isInitialized||!this.romLoaded)return;const s="string"==typeof e?rs(e):e,r=this.allocateVoice(n),i=this.voices[r];i.note=s,i.velocity=Math.floor(127*a),i.channel=n,i.active=!0,i.startTime=performance.now();const o=64*r,l=this.midiNoteToPitch(s);this.writeReg(o+Zu,l);const c=this.velocityToVolume(i.velocity);this.writeReg(o+Ju,c),this.writeReg(o+Yu,0),this.writeReg(o+Qu,0)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?rs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1;const s=64*n;this.writeReg(s+Ju,0)}sendMidi(e){0!==this.handle&&this.mameEngine.addMidiEvent(this.handle,e)}setMasterVolume(e){this.writeReg(ed,Math.floor(255*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const ad=0;class nd extends Ar{name="AICASynth";chipName="AICA";workletFile="AICA.worklet.js";processorName="aica-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",volume:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",pan:t,slot:this.currentSlot})}setSlot(e){this.currentSlot=Math.max(0,Math.min(63,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r})}setEnvelope(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,attack:t,decay1:a,decay2:n,release:s,sustainLevel:r})}setLFO(e,t,a,n,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,pitchDepth:t,ampDepth:a,rate:n,waveform:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:ad,volume:ad}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(ad,e)}}const sd=0,rd=1,id=2,od=3,ld=4,cd=5,ud=6,dd=7;class pd extends Ar{name="ASCSynth";chipName="ASC";workletFile="ASC.worklet.js";processorName="asc-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=(e-128)/128*.5;this.workletNode.port.postMessage({type:"setPanning",width:t})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveform(e){this.writeWavetableSelect(e)}setAttack(e){this.setParameterById(id,e)}setDecay(e){this.setParameterById(od,e)}setSustain(e){this.setParameterById(ld,e)}setRelease(e){this.setParameterById(cd,e)}setStereoWidth(e){this.setParameterById(ud,e)}setDetune(e){this.setParameterById(dd,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:sd,waveform:rd,attack:id,decay:od,sustain:ld,release:cd,stereo_width:ud,detune:dd}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const hd=0,md=1,fd=2,gd=3,yd=4,bd=5,vd=6,xd=7;class wd extends Ar{name="AstrocadeSynth";chipName="Astrocade";workletFile="Astrocade.worklet.js";processorName="astrocade-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVibratoSpeed(e){this.sendMessage("setVibratoSpeed",e)}setVibratoDepth(e){this.sendMessage("setVibratoDepth",e)}setNoiseVolume(e){this.sendMessage("setNoiseVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:hd,vibrato_speed:md,vibrato_depth:fd,noise_am:gd,noise_mod:yd,noise_vol:bd,master_freq:vd,stereo_width:xd}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const kd=0;class Sd extends Ar{name="C352Synth";chipName="C352";workletFile="C352.worklet.js";processorName="c352-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ku(fu)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const a=t,n=Math.round(e/a*65536);return Math.max(0,Math.min(65535,n))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,voice:this.currentVoice})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,voice:this.currentVoice})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*255),a=Math.round(e/255*255);this.workletNode.port.postMessage({type:"setPanning",vol_f:t<<8|a,vol_r:t<<8|a,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureVoice(e,t,a,n,s,r,i){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureVoice",voice:e,bank:t,start:a,end:n,loop:s,freq:r,flags:i})}setVoiceVolume(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVoiceVolume",voice:e,vol_f:t,vol_r:a})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",voice:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",voice:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:kd,volume:kd}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(kd,e)}}const Md=0,Nd=1,Cd=2,Ed=3,Pd=4,_d=5,Td=6,Ad=7;class Od extends Ar{name="ES5503Synth";chipName="ES5503";workletFile="ES5503.worklet.js";processorName="es5503-processor";currentOsc=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ku(vu)}();await super.initialize(),this.loadWaveData(e,2048)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),osc:this.currentOsc})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,osc:this.currentOsc})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=894886){const a=Math.round(e*Math.pow(2,17)/t);return Math.max(0,Math.min(131071,a))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,osc:this.currentOsc})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,osc:this.currentOsc})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*7);this.workletNode.port.postMessage({type:"setPanning",channel:t,osc:this.currentOsc})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e,osc:this.currentOsc})}setOscillator(e){this.currentOsc=Math.max(0,Math.min(31,e))}setWaveform(e){this.writeWavetableSelect(e)}setWaveSize(e){this.sendMessage("setWaveSize",e)}setResolution(e){this.sendMessage("setResolution",e)}setOscMode(e){this.sendMessage("setOscMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setReleaseTime(e){this.sendMessage("setReleaseTime",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setNumOscillators(e){this.sendMessage("setNumOscillators",e)}loadWaveData(e,t=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadWaveData",waveData:e.buffer,offset:t})}loadWavePage(e,t){this.loadWaveData(e.slice(0,256),256*t)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={waveform:Md,wave_size:Nd,resolution:Cd,osc_mode:Ed,volume:Pd,num_oscillators:_d,attack_time:Td,release_time:Ad}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Id=0,Dd=1;class Fd extends Ar{name="ICS2115Synth";chipName="ICS2115";workletFile="ICS2115.worklet.js";processorName="ics2115-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ku(yu)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",voice:e,reg:t,data:a})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Id,volume:Id,active_osc:Dd,voices:Dd}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(Id,e)}setActiveOscillators(e){this.setParameterById(Dd,e)}}const Rd=0,jd=1;class Ld extends Ar{name="K054539Synth";chipName="K054539";workletFile="K054539.worklet.js";processorName="k054539-processor";currentChannel=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ku(gu)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=261.63){const a=e/t,n=Math.round(4096*a);return Math.max(0,Math.min(65535,n))}(e);this.workletNode.port.postMessage({type:"setChannelPitch",channel:this.currentChannel,delta:t})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(64*(1-e));this.workletNode.port.postMessage({type:"setChannelVolume",channel:this.currentChannel,volume:t})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*14);this.workletNode.port.postMessage({type:"setChannelPan",channel:this.currentChannel,pan:t})}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureChannel(e,t,a,n=0,s=!1,r=!1){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureChannel",channel:e,startAddr:t,loopAddr:a,sampleType:n,loopEnable:s,reverse:r})}setChannelPitch(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPitch",channel:e,delta:t})}setChannelVolume(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelVolume",channel:e,volume:t})}setChannelPan(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPan",channel:e,pan:t})}setChannelGain(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelGain",channel:e,gain:t})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",channel:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",channel:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Rd,volume:Rd,reverb_enable:jd,reverb:jd}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(Rd,e)}setReverbEnable(e){this.setParameterById(jd,e?1:0)}}const Bd=0,Vd=1,zd=2,Ud=3,Gd=4,Wd=5,Hd=6,Kd=7,$d=8;class qd extends Ar{name="MEA8000Synth";chipName="MEA8000";workletFile="MEA8000.worklet.js";processorName="mea8000-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",f1:e,f2:t,f3:a})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setBandwidth(e){this.setParameterById(Wd,e)}setInterpTime(e){this.setParameterById($d,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Bd,noise_mode:Vd,f1_index:zd,f2_index:Ud,f3_index:Gd,bw_index:Wd,amplitude:Hd,stereo_width:Kd,interp_time:$d}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Xd=0,Yd=1;class Qd extends Ar{name="RF5C400Synth";chipName="RF5C400";workletFile="RF5C400.worklet.js";processorName="rf5c400-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ku(bu)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,data:t})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Xd,volume:Xd,clock:Yd}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(Xd,e)}setClock(e){this.setParameterById(Yd,e)}}const Zd=0,Jd=1,ep=2,tp=3,ap=4,np=5,sp=6,rp=7,ip=8,op=9,lp=10,cp=11,up=12;class dp extends Ar{name="SN76477Synth";chipName="SN76477";workletFile="SN76477.worklet.js";processorName="sn76477-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVCOFreq(e){this.sendMessage("setVCOFreq",e)}setSLFFreq(e){this.sendMessage("setSLFFreq",e)}setNoiseFreq(e){this.sendMessage("setNoiseFreq",e)}setVCODutyCycle(e){this.sendMessage("setVCODutyCycle",e)}setMixerMode(e){this.sendMessage("setMixerMode",e)}setEnvelopeMode(e){this.sendMessage("setEnvelopeMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setDecayTime(e){this.sendMessage("setDecayTime",e)}setOneShotTime(e){this.sendMessage("setOneShotTime",e)}setNoiseFilterFreq(e){this.sendMessage("setNoiseFilterFreq",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setVCOMode(e){this.sendMessage("setVCOMode",e)}setChipEnable(e){this.sendMessage("setEnable",e?0:1)}setVCORes(e){this.sendMessage("setVCORes",e)}setVCOCap(e){this.sendMessage("setVCOCap",e)}setVCOVoltage(e){this.sendMessage("setVCOVoltage",e)}setPitchVoltage(e){this.sendMessage("setPitchVoltage",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}static RES_K(e){return 1e3*e}static RES_M(e){return 1e6*e}static CAP_U(e){return 1e-6*e}static CAP_N(e){return 1e-9*e}static CAP_P(e){return 1e-12*e}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={vco_freq:Zd,slf_freq:Jd,noise_freq:ep,vco_duty_cycle:tp,mixer_mode:ap,envelope_mode:np,attack_time:sp,decay_time:rp,one_shot_time:ip,noise_filter_freq:op,amplitude:lp,vco_mode:cp,enable:up}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const pp=0,hp=1,mp=2,fp=3;class gp extends Ar{name="SNKWaveSynth";chipName="SNKWave";workletFile="SNKWave.worklet.js";processorName="snkwave-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e){this.writeWavetableSelect(e)}setCustomWaveform(e,t,a,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setCustomWaveform",b0:e,b1:t,b2:a,b3:n})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:pp,waveform:hp,stereo_width:mp,detune:fp}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const yp=0,bp=1,vp=2,xp=3,wp=4,kp=5;class Sp extends Ar{name="SP0250Synth";chipName="SP0250";workletFile="SP0250.worklet.js";processorName="sp0250-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVowel(e){this.sendMessage("setVowel",e)}setVoiced(e){this.setParameterById(vp,e?1:0)}setBrightness(e){this.setParameterById(xp,e)}writeFIFO(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeFIFO",index:e,data:t})}setFilterCoeff(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFilterCoeff",filterIdx:e,isB:t,value:a})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:yp,vowel:bp,voiced:vp,brightness:xp,stereo_width:wp,filter_mix:kp}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Mp=0,Np=1,Cp=2,Ep=3,Pp=4,_p=5;class Tp extends Ar{name="TMS36XXSynth";chipName="TMS36XX";workletFile="TMS36XX.worklet.js";processorName="tms36xx-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setStopEnable(e){this.sendMessage("setStopEnable",e)}setOctave(e){this.sendMessage("setOctave",e)}setDecayRate(e){this.setParameterById(Cp,e)}setDetune(e){this.setParameterById(_p,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Mp,stop_enable:Np,decay_rate:Cp,octave:Ep,stereo_width:Pp,detune:_p}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Ap=0,Op=1,Ip=2,Dp=3,Fp=4,Rp=5,jp=6,Lp=7,Bp=8,Vp=9;class zp extends Ar{name="TMS5220Synth";chipName="TMS5220";workletFile="TMS5220.worklet.js";processorName="tms5220-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",k1:e,k2:t,k3:a})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setChirpType(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChirpType",value:e})}setEnergy(e){this.setParameterById(Rp,e)}setBrightness(e){this.setParameterById(Vp,e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Ap,chirp_type:Op,k1_index:Ip,k2_index:Dp,k3_index:Fp,energy_index:Rp,pitch_index:jp,noise_mode:Lp,stereo_width:Bp,brightness:Vp}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Up=0,Gp=1,Wp=2,Hp=3,Kp=4,$p=5,qp=6,Xp=7,Yp=8,Qp=9,Zp=10,Jp=11,eh=12,th={BASS_1:36,SNARE_1:38,SNARE_2:40,LOW_TOM:41,MID_TOM:47,HI_TOM:50,RIMSHOT:37,COWBELL:56,HANDCLAP:39,TAMBOURINE:54,CLOSED_HIHAT:42,OPEN_HIHAT:46,CRASH:49,RIDE:51};class ah extends Ar{name="TR707Synth";chipName="TR707";workletFile="TR707.worklet.js";processorName="tr707-processor";constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(e=!1){if(e)try{return await ku(mu)}catch(t){}return ku(hu)}(!1);await super.initialize(),this.loadCombinedROM(e);for(let t=0;t<10;t++)this.setParameterById(Gp+t,.8);this.setParameterById(Up,.8),this.setParameterById(Jp,.5),this.setParameterById(eh,.5)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"allNotesOff"})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}loadCombinedROM(e){this.loadROM(0,e)}loadROMs(e,t,a){this.loadROM(0,e),this.loadROM(65536,t),this.loadROM(98304,a)}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setVoiceLevel(e,t){this.setParameterById(Gp+e,t)}setAccent(e){this.setParameterById(Jp,e)}setDecay(e){this.setParameterById(eh,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Up,bass:Gp,snare:Wp,low_tom:Hp,mid_tom:Kp,hi_tom:$p,rimshot:qp,handclap:Xp,hihat:Yp,crash:Qp,ride:Zp,accent:Jp,decay:eh}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const nh=0,sh=1,rh=2,ih=3,oh=4,lh=5,ch=6,uh=7;class dh extends Ar{name="UPD931Synth";chipName="UPD931";workletFile="UPD931.worklet.js";processorName="upd931-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveA(e){this.setParameterById(sh,e)}setWaveB(e){this.setParameterById(rh,e)}setMirror(e){this.setParameterById(ih,e?1:0)}setInvert(e){this.setParameterById(oh,e?1:0)}setModeA(e){this.setParameterById(lh,e)}setModeB(e){this.setParameterById(ch,e)}setKeyScaling(e){this.setParameterById(uh,e?1:0)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:nh,wave_a:sh,wave_b:rh,mirror:ih,invert:oh,mode_a:lh,mode_b:ch,key_scaling:uh}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ph=0,hh=1,mh=2,fh=3,gh=4,yh=5,bh=6,vh=7,xh=8,wh=9,kh=10;class Sh extends Ar{name="UPD933Synth";chipName="UPD933";workletFile="UPD933.worklet.js";processorName="upd933-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",wave1:e,wave2:t})}setWindow(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWindow",value:e})}setDCWDepth(e){this.setParameterById(gh,e)}setDCARate(e){this.setParameterById(yh,e)}setDCWRate(e){this.setParameterById(bh,e)}setDCODepth(e){this.setParameterById(xh,e)}setRingMod(e){this.setParameterById(wh,e?1:0)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:ph,waveform1:hh,waveform2:mh,window:fh,dcw_depth:gh,dca_rate:yh,dcw_rate:bh,dco_rate:vh,dco_depth:xh,ring_mod:wh,stereo_width:kh}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Mh=0,Nh=1,Ch=2,Eh=3,Ph=4,_h=5,Th=6;class Ah extends Ar{name="VotraxSynth";chipName="Votrax";workletFile="Votrax.worklet.js";processorName="votrax-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setPhoneme(e){this.sendMessage("setPhoneme",e)}setInflection(e){this.setParameterById(Ch,e)}setF1Override(e){this.setParameterById(Eh,e)}setF2Override(e){this.setParameterById(Ph,e)}setF3Override(e){this.setParameterById(_h,e)}writePhone(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writePhone",value:e})}writeInflection(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeInflection",value:e})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Mh,phoneme:Nh,inflection:Ch,f1_override:Eh,f2_override:Ph,f3_override:_h,stereo_width:Th}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Oh=0,Ih=1,Dh=2,Fh=3,Rh=4,jh=5,Lh=6,Bh=7,Vh=8,zh=9,Uh=10,Gh=11,Wh=12,Hh=13,Kh=14,$h=15;class qh extends Ar{name="YMF271Synth";chipName="YMF271";workletFile="YMF271.worklet.js";processorName="ymf271-processor";currentGroup=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),group:this.currentGroup})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,group:this.currentGroup})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=16384e3){let a=0,n=0;for(a=0;a<8&&(n=Math.round(1024*e*Math.pow(2,20-a)/t),!(n<1024));a++);return{block:Math.min(7,a),fnum:Math.max(0,Math.min(1023,n))}}(e);this.workletNode.port.postMessage({type:"setFrequency",block:t.block,fnum:t.fnum,group:this.currentGroup})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),a=Math.round(127*(1-e));for(const n of t)this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:n,param:"tl",value:a})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,group:this.currentGroup})}getCarrierOperators(){return{0:[3],1:[2,3],2:[2,3],3:[1,3],4:[1,3],5:[0,2,3],6:[0,2,3],7:[0,1,2,3]}[this.currentAlgorithm%8]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Ih,value:e/15})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Dh,value:e/7})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Kh,value:e/7})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:$h,value:e/3})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d1r",value:t})}setOperatorD2R(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d2r",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"dt",value:t})}setOperatorWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"waveform",value:t})}setGroup(e){this.currentGroup=Math.max(0,Math.min(11,e))}setLFOFrequency(e){this.setParameterById(Wh,e/255)}setLFOWaveform(e){this.setParameterById(Hh,e/3)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Oh,volume:Oh,algorithm:Ih,feedback:Dh,waveform:Fh,tl:Rh,total_level:Rh,ar:jh,attack:jh,d1r:Lh,decay1:Lh,d2r:Bh,decay2:Bh,rr:Vh,release:Vh,d1l:zh,decay1_level:zh,multiple:Uh,detune:Gh,lfo_freq:Wh,lfo_wave:Hh,pms:Kh,ams:$h}[e];void 0!==a&&this.setParameterById(a,t)}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setWaveform(e){this.setParameterById(Fh,e/6)}setAttackRate(e){this.setParameterById(jh,e/31)}setDecay1Rate(e){this.setParameterById(Lh,e/31)}setDecay2Rate(e){this.setParameterById(Bh,e/31)}setReleaseRate(e){this.setParameterById(Vh,e/15)}setTotalLevel(e){this.setParameterById(Rh,e/127)}setMultiple(e){this.setParameterById(Uh,e/15)}setMasterVolume(e){this.setParameterById(Oh,e)}}const Xh=0,Yh=1,Qh=2,Zh=3,Jh=4,em=5,tm=6,am=10,nm=11,sm=12,rm=13,im=14,om=15,lm=16,cm=17,um=18,dm=19,pm=20;class hm extends Ar{name="YMOPQSynth";chipName="YMOPQ";workletFile="YMOPQ.worklet.js";processorName="ymopq-processor";currentChannel=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=Tr(e);this.workletNode.port.postMessage({type:"setFrequency",kc:t.kc,kf:t.kf,channel:this.currentChannel})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),a=Math.round(127*(1-e));for(const n of t)this.workletNode.port.postMessage({type:"setOperatorParam",channel:this.currentChannel,op:n,param:"tl",value:a})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,channel:this.currentChannel})}getCarrierOperators(){return{0:[3],1:[3],2:[3],3:[3],4:[1,3],5:[1,2,3],6:[1,2,3],7:[0,1,2,3]}[this.currentAlgorithm]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setAlgorithm",value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFeedback",value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Zh,e/7)}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Jh,e/3)}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+am,t/127)}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+nm,t/31)}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+sm,t/31)}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+im,t/15)}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+om,t/15)}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+lm,t/15)}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+cm,t/7)}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setLFORate(e){this.sendMessage("setLFORate",e)}setVolume(e){this.sendMessage("setVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a=e.match(/^op(\d+)_(.+)$/);if(a)return void this.setOperatorParamByName(parseInt(a[1]),a[2],t);const n={algorithm:Xh,feedback:Yh,lfo_rate:Qh,lfo_pm_sens:Zh,lfo_am_sens:Jh,reverb:em,volume:tm}[e];void 0!==n&&this.setParameterById(n,t)}setOperatorParamByName(e,t,a){const n={total_level:am,attack_rate:nm,decay_rate:sm,sustain_rate:rm,sustain_level:im,release_rate:om,multiple:lm,detune:cm,waveform:um,ksr:dm,am_enable:pm}[t];void 0!==n&&e>=1&&e<=4&&this.setParameterById(100*e+n,a)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const mm=0,fm=1,gm=2,ym=3,bm=4,vm=5,xm=6,wm=7;class km extends Ar{name="VASynthSynth";chipName="VASynth";workletFile="VASynth.worklet.js";processorName="vasynth-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e){return Math.max(20,Math.min(2e4,e))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setOsc1Wave(e){this.setParameterById(fm,e)}setOsc2Wave(e){this.setParameterById(gm,e)}setOscMix(e){this.setParameterById(ym,e)}setOsc2Detune(e){this.setParameterById(bm,e)}setFilterCutoff(e){this.setParameterById(vm,e)}setFilterResonance(e){this.setParameterById(xm,e)}setFilterEnvDepth(e){this.setParameterById(wm,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:mm,osc1_wave:fm,osc2_wave:gm,osc_mix:ym,osc2_detune:bm,filter_cutoff:vm,filter_res:xm,filter_env_depth:wm}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Sm=(e,t,...a)=>{const n=`(${t.toString()})(${a.map(e=>JSON.stringify(e)).join(", ")});`,s=URL.createObjectURL(new Blob([n],{type:"text/javascript"}));return e.addModule(s)},Mm=e=>{const t=globalThis;if(t.AudioWorkletProcessor&&t.webAudioModules)return;const a=new Map,n=new Map;class s{get apiVersion(){return e}getModuleScope(e){return a.has(e)||a.set(e,{}),a.get(e)}getGroup(e,t){const a=n.get(e);if(a.validate(t))return a;throw new Error("Invalid key")}addGroup(e){n.has(e.groupId)||n.set(e.groupId,e)}removeGroup(e){n.delete(e.groupId)}addWam(e){n.get(e.groupId)?.addWam(e)}removeWam(e){n.get(e.groupId)?.removeWam(e)}connectEvents(e,t,a,s=0){n.get(e)?.connectEvents(t,a,s)}disconnectEvents(e,t,a,s){n.get(e)?.disconnectEvents(t,a,s)}emitEvents(e,...t){n.get(e.groupId)?.emitEvents(e,...t)}}t.AudioWorkletProcessor&&(t.webAudioModules||(t.webAudioModules=new s))},Nm=(e,t)=>{const a=globalThis;class n{_groupId;_validate;_processors=new Map;_eventGraph=new Map;constructor(e,t){this._groupId=e,this._validate=e=>e===t}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(e){return this._validate(e)}addWam(e){this._processors.set(e.instanceId,e)}removeWam(e){this._eventGraph.has(e)&&this._eventGraph.delete(e),this._eventGraph.forEach(t=>{t.forEach(t=>{t&&t.delete(e)})}),this._processors.delete(e.instanceId)}connectEvents(e,t,a=0){const n=this._processors.get(e),s=this._processors.get(t);let r;if(this._eventGraph.has(n)?r=this._eventGraph.get(n):(r=[],this._eventGraph.set(n,r)),r[a])r[a].add(s);else{const e=new Set;e.add(s),r[a]=e}}disconnectEvents(e,t,a){const n=this._processors.get(e);if(!this._eventGraph.has(n))return;const s=this._eventGraph.get(n);if(void 0===t)return void s.forEach(e=>{e&&e.clear()});const r=this._processors.get(t);void 0!==a?s[a]&&s[a].delete(r):s.forEach(e=>{e&&e.delete(r)})}emitEvents(e,...t){this._eventGraph.has(e)&&this._eventGraph.get(e).forEach(e=>{e&&e.forEach(e=>e.scheduleEvents(...t))})}}a.AudioWorkletProcessor&&a.webAudioModules.addGroup(new n(e,t))};class Cm{name="WAMSynth";output;_wamInstance=null;_wamNode=null;_config;_isInitialized=!1;_initPromise;_releaseTimers=new Set;_activeNotes=new Set;_audioContext;static _hostInitPromise=null;static initializeHost(e){if(Cm._hostInitPromise)return Cm._hostInitPromise;const t=`devilbox-host-${performance.now()}`,a=performance.now().toString();return Cm._hostInitPromise=(async()=>(await Sm(e.audioWorklet,Mm,"2.0.0-alpha.6"),await Sm(e.audioWorklet,Nm,t,a),[t,a]))(),Cm._hostInitPromise}constructor(e){this._audioContext=Jn(),this.output=this._audioContext.createGain(),this.output.gain.value=1,this._config=e,this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}async _initialize(){if(this._config.moduleUrl)try{const t=this._audioContext,[a]=await Cm.initializeHost(t),{default:n}=await import(this._config.moduleUrl);if(!n||"function"!=typeof n)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const s=/^class\s/.test(n.toString());if(s&&"function"==typeof n.createInstance)this._wamInstance=await n.createInstance(a,t);else if(s){const e=new n(a,t);"function"==typeof e.initialize&&await e.initialize(),this._wamInstance=e}else this._wamInstance=await n(t,a);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");if(this._wamNode.connect(this.output),this._config.pluginState&&this._wamInstance.setState)try{await this._wamInstance.setState(this._config.pluginState)}catch(e){this._config.pluginState=null}this._isInitialized=!0}catch(t){const e=t instanceof Error?t.message:String(t);let a;throw a=e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("net::ERR_")?`Network error loading WAM module. Check that the URL is correct and accessible: ${this._config.moduleUrl}`:e.includes("CORS")||e.includes("cross-origin")||e.includes("has been blocked")?`CORS policy blocked loading this WAM module. The server hosting the plugin must allow cross-origin requests. URL: ${this._config.moduleUrl}`:e.includes("not a valid JavaScript MIME type")||e.includes("SyntaxError")||e.includes("Unexpected token")?"Invalid module format. The URL does not point to a valid WAM 2.0 JavaScript module. Ensure the URL points to the plugin's index.js entry point.":`WAM initialization failed: ${e}`,new Error(a)}}_sendMidi(e,t){this._wamInstance.onMidi?this._wamInstance.onMidi(e,t):this._wamNode?.scheduleEvents?this._wamNode.scheduleEvents({type:"wam-midi",data:{bytes:e},time:t}):this._wamNode?.port&&this._wamNode.port.postMessage({type:"wam-midi",data:{bytes:e},time:t})}triggerAttack(e,t,a=1){if(!this._isInitialized||!this._wamInstance)return this;const n=rs(e),s=Math.round(127*a),r=t??this._audioContext.currentTime;return this._activeNotes.add(n),this._sendMidi([144,n,s],r),this}triggerRelease(e,t){if(!this._isInitialized||!this._wamInstance)return this;const a=t??this._audioContext.currentTime;if(void 0!==e){const t=rs(e);this._activeNotes.delete(t),this._sendMidi([128,t,0],a)}else{for(const e of this._activeNotes)this._sendMidi([128,e,0],a);this._activeNotes.clear(),this._sendMidi([176,123,0],a)}return this}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n);const s=(a??this._audioContext.currentTime)+t,r=setTimeout(()=>{this._releaseTimers.delete(r),this._isInitialized&&this._wamInstance&&this.triggerRelease(e,s)},1e3*t);return this._releaseTimers.add(r),this}releaseAll(e){return this.triggerRelease(void 0,e)}async setPluginState(e){if(this._isInitialized&&this._wamInstance?.setState)try{await this._wamInstance.setState(e),this._config.pluginState=e,this._config.pluginStateTimestamp=Date.now()}catch(t){}else this._config.pluginState=e}async getPluginState(){if(this._isInitialized&&this._wamInstance?.getState){return{state:await this._wamInstance.getState(),timestamp:Date.now(),version:1}}return this._config.pluginState}async setParameter(e,t){if(this._isInitialized&&this._wamInstance&&this._wamInstance.setParameterValues){const a="number"==typeof e?e.toString():e;await this._wamInstance.setParameterValues({[a]:{id:a,value:t}})}}async getParameters(){return this._isInitialized&&this._wamInstance&&this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():{}}async createGui(){return this._isInitialized&&this._wamInstance&&this._wamInstance.createGui?await this._wamInstance.createGui():null}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._activeNotes.clear(),this._wamNode&&this._wamNode.disconnect(),this._wamInstance?.destroy&&this._wamInstance.destroy(),this.output.disconnect()}}const Em=new Map,Pm=new WeakMap;class _m{name;output;_worklet=null;_descriptor;_isReady=!1;_initPromise;_params=[];_paramValues=new Map;_pendingNotes=[];constructor(e,t){this._descriptor=e,this.name=`VSTBridge:${e.id}`;const a=Jn();if(this.output=a.createGain(),e.volumeOffsetDb){const t=Math.pow(10,e.volumeOffsetDb/20);this.output.gain.value=t}this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}getParams(){return this._params}getDescriptor(){return this._descriptor}async _initialize(){try{const e=Jn(),{wasmBinary:t,jsCode:a}=await async function(e,t){const a="/DEViLBOX/";if(!Pm.get(e)){try{await e.audioWorklet.addModule(`${a}vstbridge/VSTBridge.worklet.js`)}catch(s){}Pm.set(e,!0)}const n=t.id;if(!Em.has(n)){const e=(async()=>{const e=`${a}${t.wasmDir}/${t.wasmFile}.wasm`,n=`${a}${t.wasmDir}/${t.wasmFile}.js`,[s,r]=await Promise.all([fetch(e),fetch(n)]);if(!s.ok)throw new Error(`Failed to load ${e}: ${s.status}`);if(!r.ok)throw new Error(`Failed to load ${n}: ${r.status}`);const[i,o]=await Promise.all([s.arrayBuffer(),r.text()]);return{wasmBinary:i,jsCode:vr(o,`${a}${t.wasmDir}/`)}})();Em.set(n,e)}return Em.get(n)}(e,this._descriptor),{workletNode:n,readyPromise:s}=function(e,t,a,n,s){const r=new AudioWorkletNode(e,"vstbridge-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate,synthClassName:t.synthClassName,moduleFactoryName:t.moduleFactoryName}}),i=new Promise((e,a)=>{const n=setTimeout(()=>a(new Error(`VSTBridge ${t.id} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=i=>{"ready"===i.data.type?(clearTimeout(n),e()):"error"===i.data.type&&(clearTimeout(n),a(new Error(i.data.error||`VSTBridge ${t.id} init error`))),s&&s.call(r.port,i)}});r.port.postMessage({type:"init",wasmBinary:a,jsCode:n,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch(o){}return{workletNode:r,readyPromise:i}}(e,this._descriptor,t,a,this.output);this._worklet=n;const r=n.port.onmessage;n.port.onmessage=e=>{if("params"===e.data.type){this._params=e.data.params;for(const e of this._params)this._paramValues.has(e.id)||this._paramValues.set(e.id,e.defaultValue)}r&&r.call(n.port,e)},await s,this._isReady=!0,this._worklet.port.postMessage({type:"getParams"});for(const{note:i,velocity:o}of this._pendingNotes)this._worklet.port.postMessage({type:"noteOn",note:i,velocity:o});this._pendingNotes=[]}catch(e){}}triggerAttack(e,t,a=1){const n=rs(e),s=Math.round(127*a);return this._worklet&&this._isReady?this._worklet.port.postMessage({type:"noteOn",note:n,velocity:s}):this._pendingNotes.push({note:n,velocity:s}),this}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}triggerAttackRelease(e,t,a,n=1){return this.triggerAttack(e,a,n),setTimeout(()=>this.triggerRelease(e),1e3*t),this}set(e,t){if(!this._worklet)return;let a;if(/^\d+$/.test(e))a=parseInt(e,10);else{const t=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!t)return;a=t.id}this._paramValues.set(a,t),this._worklet.port.postMessage({type:"parameter",paramId:a,value:t})}get(e){let t;if(/^\d+$/.test(e))t=parseInt(e,10);else{const a=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!a)return;t=a.id}return this._paramValues.get(t)}setParameter(e,t){this._worklet&&(this._paramValues.set(e,t),this._worklet.port.postMessage({type:"parameter",paramId:e,value:t}))}getParameter(e){return this._paramValues.get(e)}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}programChange(e){this._worklet?.port.postMessage({type:"programChange",program:e})}async sendCommand(e,t){return!(!this._worklet||!this._isReady)&&new Promise(a=>{const n=setTimeout(()=>a(!1),2e3),s=t=>{"commandResult"===t.data.type&&t.data.commandType===e&&(clearTimeout(n),this._worklet?.port.removeEventListener("message",s),a(t.data.handled))};this._worklet.port.addEventListener("message",s),this._worklet.port.postMessage({type:"command",commandType:e,data:t?Array.from(t):[]})})}setVolumeOffset(e){const t=Math.pow(10,e/20);this.output.gain.value=t}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Tm=new Map;function Am(e){Tm.set(e.id,e)}Am({id:"DexedBridge",name:"Dexed DX7 (Bridge)",wasmDir:"dexed",wasmFile:"Dexed",synthClassName:"DexedSynth",moduleFactoryName:"createDexedModule",volumeOffsetDb:41,commands:["loadSysEx","loadPatch"]}),Am({id:"Vital",name:"Vital (Wavetable)",wasmDir:"vital",wasmFile:"Vital",synthClassName:"VitalSynth",moduleFactoryName:"createVitalModule",volumeOffsetDb:0,panelComponent:"VitalControls",commands:["loadWavetable","loadPreset"]}),Am({id:"Odin2",name:"Odin2 (Hybrid)",wasmDir:"odin2",wasmFile:"Odin2",synthClassName:"Odin2Synth",moduleFactoryName:"createOdin2Module",volumeOffsetDb:0,panelComponent:"Odin2Controls",commands:["loadPatch"]}),Am({id:"Surge",name:"Surge XT (Hybrid)",wasmDir:"surge",wasmFile:"Surge",synthClassName:"SurgeSynth",moduleFactoryName:"createSurgeModule",volumeOffsetDb:0,panelComponent:"SurgeControls",commands:["loadPatch","loadWavetable"]}),Am({id:"TonewheelOrgan",name:"Tonewheel Organ",wasmDir:"tonewheel",wasmFile:"Tonewheel",synthClassName:"TonewheelOrganSynth",moduleFactoryName:"createTonewheelModule",volumeOffsetDb:0}),Am({id:"Melodica",name:"Melodica",wasmDir:"melodica",wasmFile:"Melodica",synthClassName:"MelodicaWASMSynth",moduleFactoryName:"createMelodicaModule",volumeOffsetDb:0}),Am({id:"Monique",name:"Monique (Monosynth)",wasmDir:"monique",wasmFile:"Monique",synthClassName:"MoniqueSynth",moduleFactoryName:"createMoniqueModule",volumeOffsetDb:0}),Am({id:"Helm",name:"Helm (Poly)",wasmDir:"helm",wasmFile:"Helm",synthClassName:"HelmSynth",moduleFactoryName:"createHelmModule",volumeOffsetDb:0}),Am({id:"Sorcer",name:"Sorcer (Wavetable)",wasmDir:"sorcer",wasmFile:"Sorcer",synthClassName:"SorcerSynth",moduleFactoryName:"createSorcerModule",volumeOffsetDb:0}),Am({id:"Amsynth",name:"amsynth (Analog)",wasmDir:"amsynth",wasmFile:"Amsynth",synthClassName:"AmsynthSynth",moduleFactoryName:"createAmsynthModule",volumeOffsetDb:0}),Am({id:"OBXf",name:"OB-Xf (Analog)",wasmDir:"obxf",wasmFile:"OBXf",synthClassName:"OBXfSynth",moduleFactoryName:"createOBXfModule",volumeOffsetDb:0});const Om={FurnaceNES:Gi.NES,FurnaceGB:Gi.GB,FurnaceSNES:Gi.SNES,FurnacePCE:Gi.PCE,FurnacePSG:Gi.SMS,FurnaceVB:Gi.VBOY,FurnaceLynx:Gi.LYNX,FurnaceSWAN:Gi.SWAN,FurnaceVRC6:Gi.VRC6,FurnaceN163:Gi.N163,FurnaceFDS:Gi.FDS,FurnaceMMC5:Gi.MMC5,FurnaceGBA:Gi.GBA_DMA,FurnaceNDS:Gi.NDS,FurnacePOKEMINI:Gi.POKEMINI,FurnaceC64:Gi.C64_6581,FurnaceSID6581:Gi.C64_6581,FurnaceSID8580:Gi.C64_8580,FurnaceAY:Gi.AY8910,FurnaceAY8930:Gi.AY8930,FurnaceVIC:Gi.VIC20,FurnaceSAA:Gi.SAA1099,FurnaceTED:Gi.TED,FurnaceVERA:Gi.VERA,FurnaceSCC:Gi.SCC,FurnaceTIA:Gi.TIA,FurnaceAMIGA:Gi.AMIGA,FurnacePET:Gi.PET,FurnacePCSPKR:Gi.PCSPKR,FurnaceZXBEEPER:Gi.SFX_BEEPER,FurnacePOKEY:Gi.POKEY,FurnacePONG:Gi.PONG,FurnacePV1000:Gi.PV1000,FurnaceDAVE:Gi.DAVE,FurnaceSU:Gi.SOUND_UNIT,FurnacePOWERNOISE:Gi.POWERNOISE,FurnaceSEGAPCM:Gi.SEGAPCM,FurnaceQSOUND:Gi.QSOUND,FurnaceES5506:Gi.ES5506,FurnaceRF5C68:Gi.RF5C68,FurnaceC140:Gi.C140,FurnaceK007232:Gi.K007232,FurnaceK053260:Gi.K053260,FurnaceGA20:Gi.GA20,FurnaceOKI:Gi.MSM6295,FurnaceYMZ280B:Gi.YMZ280B,FurnaceX1_010:Gi.X1_010,FurnaceMSM6258:Gi.MSM6258,FurnaceMSM5232:Gi.MSM5232,FurnaceMULTIPCM:Gi.MULTIPCM,FurnaceNAMCO:Gi.NAMCO,FurnacePCMDAC:Gi.PCM_DAC,FurnaceBUBBLE:Gi.BUBSYS_WSG,FurnaceSM8521:Gi.SM8521,FurnaceT6W28:Gi.T6W28,FurnaceSUPERVISION:Gi.SUPERVISION,FurnaceUPD1771:Gi.UPD1771C,FurnaceSCVTONE:Gi.UPD1771C};class Im{static VOLUME_NORMALIZATION_OFFSETS={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7,PolySynth:8,TB303:15,JC303:15,Buzz3o3:5,Furnace:0,FurnaceOPN:7,FurnaceOPM:2,FurnaceOPL:10,FurnaceOPLL:2,FurnaceESFM:0,FurnaceOPZ:0,FurnaceOPNA:5,FurnaceOPNB:5,FurnaceOPL4:6,FurnaceY8950:6,FurnaceVRC7:2,FurnaceOPN2203:0,FurnaceOPNBB:2,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:3,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:6,FurnaceSID6581:6,FurnaceSID8580:6,FurnaceAY:3,FurnaceAY8930:3,FurnaceVIC:3,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:17,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:3,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:3,FurnaceSU:8,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:5,FurnaceES5506:38,FurnaceRF5C68:0,FurnaceC140:8,FurnaceK007232:-4,FurnaceK053260:3,FurnaceGA20:3,FurnaceOKI:44,FurnaceYMZ280B:14,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:14,FurnaceNAMCO:3,FurnacePCMDAC:-5,FurnaceBUBBLE:3,FurnaceSM8521:3,FurnaceT6W28:3,FurnaceSUPERVISION:3,FurnaceUPD1771:3,BuzzKick:3,BuzzKickXP:5,BuzzNoise:7,BuzzTrilok:5,Buzz4FM2F:7,BuzzFreqBomb:4,Buzz3o3DF:8,Synare:7,DubSiren:13,SpaceLaser:24,V2:0,Sam:16,SuperSaw:9,WobbleBass:13,FormantSynth:9,StringMachine:11,PWMSynth:9,ChipSynth:5,Wavetable:5,Organ:3,Sampler:10,Player:10,GranularSynth:-47,DrumMachine:18,ChiptuneModule:-6,DrumKit:0,MAMEVFX:0,MAMEDOC:0,MAMERSA:0,MAMESWP30:0,CZ101:0,Dexed:41,OBXd:9,CEM3394:19,SCSP:15,MAMEAstrocade:18,MAMESN76477:5,MAMEASC:11,MAMEES5503:62,MAMEMEA8000:12,MAMESNKWave:8,MAMESP0250:26,MAMETMS36XX:6,MAMEVotrax:20,MAMEYMOPQ:19,MAMEUPD931:23,MAMEUPD933:28,MAMETMS5220:37,MAMEYMF271:15,MAMETR707:22,MAMEVASynth:20,MAMEAICA:0,MAMEICS2115:35,MAMEK054539:22,MAMEC352:17,MAMERF5C400:0};static getNormalizedVolume(e,t){return(t??-12)+(this.VOLUME_NORMALIZATION_OFFSETS[e]??0)}static createInstrument(e){let t;switch(e.synthType){case"Synth":case"ChiptuneModule":t=this.createSynth(e);break;case"MonoSynth":t=this.createMonoSynth(e);break;case"DuoSynth":t=this.createDuoSynth(e);break;case"FMSynth":t=this.createFMSynth(e);break;case"AMSynth":t=this.createAMSynth(e);break;case"PluckSynth":t=this.createPluckSynth(e);break;case"MetalSynth":t=this.createMetalSynth(e);break;case"MembraneSynth":t=this.createMembraneSynth(e);break;case"NoiseSynth":t=this.createNoiseSynth(e);break;case"TB303":t=this.createTB303(e);break;case"Furnace":t=this.createFurnace(e);break;case"Buzzmachine":t=this.createBuzzmachine(e);break;case"FurnaceOPN":t=this.createFurnaceWithChip(e,Ei.OPN2);break;case"FurnaceOPM":t=this.createFurnaceWithChip(e,Ei.OPM);break;case"FurnaceOPL":t=this.createFurnaceWithChip(e,Ei.OPL3);break;case"FurnaceOPLL":case"FurnaceVRC7":t=this.createFurnaceWithChip(e,Ei.OPLL);break;case"FurnaceESFM":t=this.createFurnaceWithChip(e,Ei.ESFM);break;case"FurnaceOPZ":t=this.createFurnaceWithChip(e,Ei.OPZ);break;case"FurnaceOPNA":t=this.createFurnaceWithChip(e,Ei.OPNA);break;case"FurnaceOPNB":t=this.createFurnaceWithChip(e,Ei.OPNB);break;case"FurnaceOPL4":t=this.createFurnaceWithChip(e,Ei.OPL4);break;case"FurnaceY8950":t=this.createFurnaceWithChip(e,Ei.Y8950);break;case"FurnaceNES":case"FurnaceGB":case"FurnaceSNES":case"FurnacePCE":case"FurnacePSG":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceGBA":case"FurnaceNDS":case"FurnacePOKEMINI":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceAY8930":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSCC":case"FurnaceTIA":case"FurnaceAMIGA":case"FurnacePET":case"FurnacePCSPKR":case"FurnaceZXBEEPER":case"FurnacePOKEY":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceX1_010":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceNAMCO":case"FurnacePCMDAC":case"FurnaceBUBBLE":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":{const a=Om[e.synthType];void 0!==a?(t=new Zi(a),void 0!==e.furnace?.furnaceIndex&&(t.setFurnaceInstrumentIndex(e.furnace.furnaceIndex),t.uploadInstrumentFromConfig(e.furnace,e.name).catch(e=>{}))):t=this.createFurnaceWithChip(e,Ei.OPN2);break}case"FurnaceOPN2203":t=this.createFurnaceWithChip(e,Ei.OPN);break;case"FurnaceOPNBB":t=this.createFurnaceWithChip(e,Ei.OPNB_B);break;case"Sampler":const a=e.metadata?.modPlayback?.usePeriodPlayback;t=a?this.createPlayer(e):this.createSampler(e);break;case"Player":t=this.createPlayer(e);break;case"Wavetable":t=this.createWavetable(e);break;case"GranularSynth":t=this.createGranularSynth(e);break;case"SuperSaw":t=this.createSuperSaw(e);break;case"PolySynth":t=this.createPolySynth(e);break;case"Organ":t=this.createOrgan(e);break;case"DrumMachine":t=this.createDrumMachine(e);break;case"ChipSynth":t=this.createChipSynth(e);break;case"PWMSynth":t=this.createPWMSynth(e);break;case"StringMachine":t=this.createStringMachine(e);break;case"FormantSynth":t=this.createFormantSynth(e);break;case"WobbleBass":t=this.createWobbleBass(e);break;case"DrumKit":t=this.createDrumKit(e);break;case"DubSiren":t=this.createDubSiren(e);break;case"SpaceLaser":t=this.createSpaceLaser(e);break;case"V2":t=this.createV2(e);break;case"Sam":t=this.createSam(e);break;case"Synare":t=this.createSynare(e);break;case"WAM":t=this.createWAM(e);break;case"Dexed":t=this.createDexed(e);break;case"OBXd":t=this.createOBXd(e);break;case"MAMEVFX":case"VFX":t=this.createVFX(e);break;case"D50":t=this.createD50(e);break;case"MAMEDOC":t=new gr({type:"doc"});break;case"MAMERSA":t=this.createRdPiano(e);break;case"MAMESWP30":t=this.createMU2000(e);break;case"CZ101":t=this.createCZ101(e);break;case"CEM3394":t=this.createCEM3394(e);break;case"SCSP":t=this.createSCSP(e);break;case"BuzzDTMF":t=this.createBuzzGenerator(nl.CYANPHASE_DTMF,"BuzzDTMF",e);break;case"BuzzFreqBomb":t=this.createBuzzGenerator(nl.ELENZIL_FREQUENCYBOMB,"BuzzFreqBomb",e);break;case"BuzzKick":t=this.createBuzzGenerator(nl.FSM_KICK,"BuzzKick",e);break;case"BuzzKickXP":t=this.createBuzzGenerator(nl.FSM_KICKXP,"BuzzKickXP",e);break;case"BuzzNoise":t=this.createBuzzGenerator(nl.JESKOLA_NOISE,"BuzzNoise",e);break;case"BuzzTrilok":t=this.createBuzzGenerator(nl.JESKOLA_TRILOK,"BuzzTrilok",e);break;case"Buzz4FM2F":t=this.createBuzzGenerator(nl.MADBRAIN_4FM2F,"Buzz4FM2F",e);break;case"BuzzDynamite6":t=this.createBuzzGenerator(nl.MADBRAIN_DYNAMITE6,"BuzzDynamite6",e);break;case"BuzzM3":t=this.createBuzzGenerator(nl.MAKK_M3,"BuzzM3",e);break;case"Buzz3o3":t=this.createBuzz3o3(e);break;case"Buzz3o3DF":t=this.createBuzz3o3DF(e);break;case"BuzzM4":t=this.createBuzzGenerator(nl.MAKK_M4,"BuzzM4",e);break;case"MAMEAICA":t=this.createMAMEAICA(e);break;case"MAMEASC":t=this.createMAMEASC(e);break;case"MAMEAstrocade":t=this.createMAMEAstrocade(e);break;case"MAMEC352":t=this.createMAMEC352(e);break;case"MAMEES5503":t=this.createMAMEES5503(e);break;case"MAMEICS2115":t=this.createMAMEICS2115(e);break;case"MAMEK054539":t=this.createMAMEK054539(e);break;case"MAMEMEA8000":t=this.createMAMEMEA8000(e);break;case"MAMERF5C400":t=this.createMAMERF5C400(e);break;case"MAMESN76477":t=this.createMAMESN76477(e);break;case"MAMESNKWave":t=this.createMAMESNKWave(e);break;case"MAMESP0250":t=this.createMAMESP0250(e);break;case"MAMETMS36XX":t=this.createMAMETMS36XX(e);break;case"MAMETMS5220":t=this.createMAMETMS5220(e);break;case"MAMETR707":t=this.createMAMETR707(e);break;case"MAMEUPD931":t=this.createMAMEUPD931(e);break;case"MAMEUPD933":t=this.createMAMEUPD933(e);break;case"MAMEVotrax":t=this.createMAMEVotrax(e);break;case"MAMEYMF271":t=this.createMAMEYMF271(e);break;case"MAMEYMOPQ":t=this.createMAMEYMOPQ(e);break;case"MAMEVASynth":t=this.createMAMEVASynth(e);break;default:{const a=Tm.get(e.synthType);t=a?new _m(a,e):this.createSynth(e)}}if(e.synthType.startsWith("Furnace")&&t){const a=this.VOLUME_NORMALIZATION_OFFSETS[e.synthType]??0;0!==a&&"setVolumeOffset"in t&&t.setVolumeOffset(a)}return t}static async createEffectChain(e,t){const a=e.filter(e=>e.enabled);return Promise.all(a.map(e=>this.createEffect(e,t)))}static async createEffect(e,t){const a=e.wet/100;if("neural"===e.category){if(void 0===e.neuralModelIndex)throw new Error("Neural effect requires neuralModelIndex");const t=new Ur({modelIndex:e.neuralModelIndex,wet:a});return await t.loadModel(),Object.entries(e.parameters).forEach(([e,a])=>{t.setParameter(e,a)}),t}let n;switch(e.type){case"Distortion":n=new b({distortion:e.parameters.drive||.4,oversample:e.parameters.oversample||"none",wet:a});break;case"Reverb":{const t=new y({decay:e.parameters.decay||1.5,preDelay:e.parameters.preDelay||.01,wet:a});await t.ready,n=t;break}case"Delay":case"FeedbackDelay":n=new _({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:a});break;case"Chorus":{const t=new q({frequency:e.parameters.frequency||1.5,delayTime:e.parameters.delayTime||3.5,depth:e.parameters.depth||.7,wet:a});t.start(),n=t;break}case"Phaser":n=new w({frequency:e.parameters.frequency||.5,octaves:e.parameters.octaves||3,baseFrequency:e.parameters.baseFrequency||350,wet:a});break;case"Tremolo":{const t=new $({frequency:e.parameters.frequency||10,depth:e.parameters.depth||.5,wet:a});t.start(),n=t;break}case"Vibrato":n=new K({frequency:e.parameters.frequency||5,depth:e.parameters.depth||.1,wet:a});break;case"AutoFilter":{const t=new H({frequency:e.parameters.frequency||1,baseFrequency:e.parameters.baseFrequency||200,octaves:e.parameters.octaves||2.6,filter:{type:e.parameters.filterType||"lowpass",rolloff:-12,Q:1},wet:a});t.start(),n=t;break}case"AutoPanner":{const t=new W({frequency:e.parameters.frequency||1,depth:e.parameters.depth||1,wet:a});t.start(),n=t;break}case"AutoWah":n=new G({baseFrequency:e.parameters.baseFrequency||100,octaves:e.parameters.octaves||6,sensitivity:e.parameters.sensitivity||0,Q:e.parameters.Q||2,gain:e.parameters.gain||2,follower:e.parameters.follower||.1,wet:a});break;case"BitCrusher":n=new U({bits:e.parameters.bits||4,wet:a});break;case"Chebyshev":n=new z({order:e.parameters.order||50,oversample:e.parameters.oversample||"none",wet:a});break;case"FrequencyShifter":n=new V({frequency:e.parameters.frequency||0,wet:a});break;case"PingPongDelay":n=new B({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:a});break;case"PitchShift":n=new L({pitch:e.parameters.pitch||0,windowSize:e.parameters.windowSize||.1,delayTime:e.parameters.delayTime||0,feedback:e.parameters.feedback||0,wet:a});break;case"Compressor":n=new S({threshold:e.parameters.threshold||-24,ratio:e.parameters.ratio||12,attack:e.parameters.attack||.003,release:e.parameters.release||.25});break;case"EQ3":n=new f({low:e.parameters.low||0,mid:e.parameters.mid||0,high:e.parameters.high||0,lowFrequency:e.parameters.lowFrequency||400,highFrequency:e.parameters.highFrequency||2500});break;case"Filter":n=new m({type:e.parameters.type||"lowpass",frequency:e.parameters.frequency||350,rolloff:e.parameters.rolloff||-12,Q:e.parameters.Q||1,gain:e.parameters.gain||0});break;case"JCReverb":n=new j({roomSize:e.parameters.roomSize||.5,wet:a});break;case"StereoWidener":n=new R({width:e.parameters.width||.5});break;case"TapeSaturation":n=new Or({drive:(e.parameters.drive||50)/100,tone:e.parameters.tone||12e3,wet:a});break;case"SidechainCompressor":n=new Ni({threshold:e.parameters.threshold??-24,ratio:e.parameters.ratio??4,attack:e.parameters.attack??.003,release:e.parameters.release??.25,knee:e.parameters.knee??6,sidechainGain:(e.parameters.sidechainGain??100)/100,wet:a});break;case"SpaceEcho":n=new Gr({mode:Number(e.parameters.mode)||4,rate:Number(e.parameters.rate)||300,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,reverbVolume:Number(e.parameters.reverbVolume)||.3,bass:Number(e.parameters.bass)||0,treble:Number(e.parameters.treble)||0,wet:a});break;case"SpaceyDelayer":n=new qr({firstTap:Number(e.parameters.firstTap)||250,tapSize:Number(e.parameters.tapSize)||150,feedback:Number(e.parameters.feedback)||40,multiTap:null!=e.parameters.multiTap?Number(e.parameters.multiTap):1,tapeFilter:Number(e.parameters.tapeFilter)||0,wet:a});break;case"RETapeEcho":n=new Jr({mode:null!=e.parameters.mode?Number(e.parameters.mode):3,repeatRate:Number(e.parameters.repeatRate)||.5,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,wow:Number(e.parameters.wow)||0,flutter:Number(e.parameters.flutter)||0,dirt:Number(e.parameters.dirt)||0,inputBleed:null!=e.parameters.inputBleed?Number(e.parameters.inputBleed):0,loopAmount:Number(e.parameters.loopAmount)||0,playheadFilter:null!=e.parameters.playheadFilter?Number(e.parameters.playheadFilter):1,wet:a});break;case"BiPhase":n=new ei({rateA:Number(e.parameters.rateA)||.5,depthA:Number(e.parameters.depthA)||.6,rateB:Number(e.parameters.rateB)||4,depthB:Number(e.parameters.depthB)||.4,feedback:Number(e.parameters.feedback)||.3,routing:1===Number(e.parameters.routing)?"series":"parallel",wet:a});break;case"DubFilter":n=new ti({cutoff:Number(e.parameters.cutoff)||20,resonance:Number(e.parameters.resonance)||1,gain:Number(e.parameters.gain)||1,wet:a});break;case"BuzzDistortion":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ArguruDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzSVF":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ElakSVF");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzDelay":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzChorus":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMChorus");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzCompressor":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GeonikCompressor");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzOverdrive":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GeonikOverdrive");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzDistortion2":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzCrossDelay":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaCrossDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzPhilta":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMPhilta");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzDist2":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ElakDist2");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzFreeverb":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaFreeverb");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzFreqShift":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("BigyoFrequencyShifter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzNotch":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("CyanPhaseNotch");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzStereoGain":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("DedaCodeStereoGain");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzSoftSat":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GraueSoftSat");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzLimiter":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("LdSLimit");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzExciter":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("OomekExciter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzMasterizer":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("OomekMasterizer");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzStereoDist":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("WhiteNoiseStereoDist");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzWhiteChorus":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("WhiteNoiseWhiteChorus");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzZfilter":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("QZfilter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzChorus2":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMChorus2");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"BuzzPanzerDelay":{const{BuzzmachineSynth:t}=await _a(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-ChGsB0cW.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMPanzerDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),n=a;break}case"MoogFilter":n=new si({cutoff:Number(e.parameters.cutoff)||1e3,resonance:(Number(e.parameters.resonance)||10)/100,drive:Number(e.parameters.drive)||1,model:Number(e.parameters.model)||ai,filterMode:Number(e.parameters.filterMode)||ni,wet:a});break;case"MVerb":n=new oi({damping:Number(e.parameters.damping)??.5,density:Number(e.parameters.density)??.5,bandwidth:Number(e.parameters.bandwidth)??.5,decay:Number(e.parameters.decay)??.7,predelay:Number(e.parameters.predelay)??0,size:Number(e.parameters.size)??.8,gain:Number(e.parameters.gain)??1,mix:Number(e.parameters.mix)??.4,earlyMix:Number(e.parameters.earlyMix)??.5,wet:a});break;case"Leslie":n=new pi({speed:Number(e.parameters.speed)??0,hornRate:Number(e.parameters.hornRate)??6.8,drumRate:Number(e.parameters.drumRate)??5.9,hornDepth:Number(e.parameters.hornDepth)??.7,drumDepth:Number(e.parameters.drumDepth)??.5,doppler:Number(e.parameters.doppler)??.5,width:Number(e.parameters.width)??.8,acceleration:Number(e.parameters.acceleration)??.5,wet:a});break;case"SpringReverb":n=new fi({decay:Number(e.parameters.decay)??.6,damping:Number(e.parameters.damping)??.4,tension:Number(e.parameters.tension)??.5,mix:Number(e.parameters.mix)??.35,drip:Number(e.parameters.drip)??.5,diffusion:Number(e.parameters.diffusion)??.7,wet:a});break;default:n=new p(1)}if(n._fxType=e.type,Si(e.parameters)){const t=wi[e.type];if(t){const a=N().bpm.value,s=Mi(e.parameters);for(const r of t){const t=ki(a,s,r.unit);switch(e.type){case"Delay":case"FeedbackDelay":"time"===r.param&&n instanceof _&&(n.delayTime.value=t);break;case"PingPongDelay":"time"===r.param&&n instanceof B&&(n.delayTime.value=t);break;case"SpaceEcho":"rate"===r.param&&n instanceof Gr&&n.setRate(t);break;case"SpaceyDelayer":"firstTap"===r.param&&n instanceof qr&&n.setFirstTap(t);break;case"RETapeEcho":"repeatRate"===r.param&&n instanceof Jr&&n.setRepeatRate(t);break;case"Chorus":"frequency"===r.param&&n instanceof q&&(n.frequency.value=t);break;case"BiPhase":"rateA"===r.param&&n instanceof ei&&(n.rateA=t)}}}}return n}static connectWithEffects(e,t,a){if(0!==t.length){e.connect(t[0]);for(let e=0;e<t.length-1;e++)t[e].connect(t[e+1]);t[t.length-1].connect(a)}else e.connect(a)}static disposeInstrument(e,t){t.forEach(e=>e.dispose()),e.dispose()}static createSynth(e){const t=new X(Y,{oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("Synth",e.volume)}),a=e.pitchEnvelope;return a?.enabled&&0!==a.amount?{triggerAttackRelease:(e,n,s,r)=>{const i=s??Q();this.applyPitchEnvelope(t,a,i,n),t.triggerAttackRelease(e,n,i,r)},triggerAttack:(e,n,s)=>{const r=n??Q();this.triggerPitchEnvelopeAttack(t,a,r),t.triggerAttack(e,r,s)},triggerRelease:(e,n)=>{const s=n??Q();this.triggerPitchEnvelopeRelease(t,a,s),t.triggerRelease(e,s)},releaseAll:()=>{t.set({detune:0}),t.releaseAll()},connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}:t}static createMonoSynth(e){const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new Z(t)}static createDuoSynth(e){return new J({voice0:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:this.getNormalizedVolume("DuoSynth",e.volume)})}static createFMSynth(e){return new X(O,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},modulationIndex:10,volume:this.getNormalizedVolume("FMSynth",e.volume)})}static createAMSynth(e){return new X(ee,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("AMSynth",e.volume)})}static createPluckSynth(e){return new X(te,{attackNoise:1,dampening:4e3,resonance:.7,volume:this.getNormalizedVolume("PluckSynth",e.volume)})}static createMetalSynth(e){return new ae({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MetalSynth",e.volume)})}static createMembraneSynth(e){return new ne({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MembraneSynth",e.volume)})}static createNoiseSynth(e){return new se({noise:{type:"white"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("NoiseSynth",e.volume)})}static createTB303(e){const t=e.tb303||{...Ln},a=this.getNormalizedVolume("TB303",e.volume);return this.createDB303(t,a)}static createWAM(e){const t=e.wam||{moduleUrl:"",pluginState:null},a=new Cm(t);return a.output.gain.value=re(e.volume??-12),a}static createDB303(e,t){const a=new ur,n=200,s=2e3,r=(e,t,a)=>e>=0&&e<=1?e:a>100?Math.log(e/t)/Math.log(a/t):(e-t)/(a-t);window.DEBUG_TB303_PARAMS,a.setCutoff(r(e.filter.cutoff,314,2394)),a.setResonance(e.filter.resonance>1?e.filter.resonance/100:e.filter.resonance),a.setEnvMod(e.filterEnvelope.envMod>1?e.filterEnvelope.envMod/100:e.filterEnvelope.envMod),a.setDecay(r(e.filterEnvelope.decay,n,s)),a.setAccent(e.accent.amount>1?e.accent.amount/100:e.accent.amount);const i=void 0!==e.oscillator.waveformBlend?e.oscillator.waveformBlend:"square"===e.oscillator.type?1:0;a.setWaveform(i),void 0!==e.oscillator.pulseWidth&&a.setPulseWidth(e.oscillator.pulseWidth>1?e.oscillator.pulseWidth/100:e.oscillator.pulseWidth),void 0!==e.oscillator.subOscGain&&a.setSubOscGain(e.oscillator.subOscGain>1?e.oscillator.subOscGain/100:e.oscillator.subOscGain),void 0!==e.oscillator.subOscBlend&&a.setSubOscBlend(e.oscillator.subOscBlend>1?e.oscillator.subOscBlend/100:e.oscillator.subOscBlend),a.setVegDecay(r(1230,n,s)),void 0!==e.tuning&&a.setTuning(e.tuning>1?(e.tuning-440)/440:e.tuning);const o=e.devilFish;if(o){if(void 0!==o.filterFmDepth&&a.setFilterFmDepth(o.filterFmDepth),void 0!==o.accentSweepEnabled&&a.setAccentSweepEnabled(o.accentSweepEnabled),void 0!==o.accentSoftAttack&&a.setAccentSoftAttack(o.accentSoftAttack>1?o.accentSoftAttack/100:o.accentSoftAttack),void 0!==o.passbandCompensation){const e=o.passbandCompensation>1?o.passbandCompensation/100:o.passbandCompensation;a.setPassbandCompensation(1-e)}if(void 0!==o.resTracking){const e=o.resTracking>1?o.resTracking/100:o.resTracking;a.setResTracking(1-e),a.setKorgIbiasScale(.1+3.9*e)}void 0!==o.duffingAmount&&a.setDuffingAmount(o.duffingAmount>1?o.duffingAmount/100:o.duffingAmount),void 0!==o.lpBpMix&&a.setLpBpMix(o.lpBpMix>1?o.lpBpMix/100:o.lpBpMix),void 0!==o.filterSelect&&a.setFilterSelect(o.filterSelect),void 0!==o.diodeCharacter&&a.setDiodeCharacter(o.diodeCharacter>1?o.diodeCharacter/100:o.diodeCharacter),void 0!==o.filterInputDrive&&a.setFilterInputDrive(o.filterInputDrive>1?o.filterInputDrive/100:o.filterInputDrive),void 0!==o.filterTracking&&a.setFilterTracking(o.filterTracking>1?o.filterTracking/100:o.filterTracking),void 0!==o.stageNLAmount&&a.setStageNLAmount(o.stageNLAmount>1?o.stageNLAmount/100:o.stageNLAmount),void 0!==o.ensembleAmount&&a.setEnsembleAmount(o.ensembleAmount>1?o.ensembleAmount/100:o.ensembleAmount),void 0!==o.oversamplingOrder&&a.setOversamplingOrder(o.oversamplingOrder),void 0!==o.normalDecay&&a.setNormalDecay(r(o.normalDecay,n,s)),void 0!==o.accentDecay&&a.setAccentDecay(r(o.accentDecay,n,s)),void 0!==o.softAttack&&a.setSoftAttack(o.softAttack>1?o.softAttack/100:o.softAttack),void 0!==o.muffler&&a.setMuffler(o.muffler),void 0!==o.sweepSpeed&&a.setSweepSpeed(o.sweepSpeed),void 0!==o.highResonance&&a.setHighResonanceEnabled(o.highResonance)}const l=e.lfo;l&&(void 0!==l.waveform&&a.setLfoWaveform(l.waveform),void 0!==l.rate&&a.setLfoRate(l.rate>1?l.rate/100:l.rate),void 0!==l.contour&&a.setLfoContour(l.contour),void 0!==l.pitchDepth&&a.setLfoPitchDepth(l.pitchDepth>1?l.pitchDepth/100:l.pitchDepth),void 0!==l.pwmDepth&&a.setLfoPwmDepth(l.pwmDepth>1?l.pwmDepth/100:l.pwmDepth),void 0!==l.filterDepth&&a.setLfoFilterDepth(l.filterDepth>1?l.filterDepth/100:l.filterDepth),void 0!==l.stiffDepth&&a.setLfoStiffDepth(l.stiffDepth>1?l.stiffDepth/100:l.stiffDepth));const c=e.chorus;c&&(void 0!==c.enabled&&a.setChorusEnabled(c.enabled),void 0!==c.mode&&a.setChorusMode(c.mode),void 0!==c.mix&&a.setChorusMix(c.mix>1?c.mix/100:c.mix));const u=e.phaser;u&&(void 0!==u.enabled&&a.setPhaserEnabled(u.enabled),void 0!==u.rate&&a.setPhaserRate(u.rate>1?u.rate/100:u.rate),void 0!==u.depth&&a.setPhaserDepth(u.depth>1?u.depth/100:u.depth),void 0!==u.feedback&&a.setPhaserFeedback(u.feedback>1?u.feedback/100:u.feedback),void 0!==u.mix&&a.setPhaserMix(u.mix>1?u.mix/100:u.mix));const d=e.delay;return d&&(void 0!==d.enabled&&a.setDelayEnabled(d.enabled),void 0!==d.time&&a.setDelayTime(d.time>1?d.time/2e3:d.time),void 0!==d.feedback&&a.setDelayFeedback(d.feedback>1?d.feedback/100:d.feedback),void 0!==d.tone&&a.setDelayTone(d.tone>1?d.tone/100:d.tone),void 0!==d.mix&&a.setDelayMix(d.mix>1?d.mix/100:d.mix),void 0!==d.stereo&&a.setDelaySpread(d.stereo>1?d.stereo/100:d.stereo)),void 0!==t&&(a.output.gain.value=re(t)),void 0!==e.volume&&a.setVolume(e.volume),a}static createBuzzGenerator(e,t,a){const n=new il(e),s=this.getNormalizedVolume(t,a.volume);return n.output.gain.value=re(s),n}static createBuzz3o3(e){const t=new il(nl.OOMEK_AGGRESSOR_DF);if(e.tb303){const a=e.tb303;if(t.setCutoff(a.filter.cutoff),t.setResonance(a.filter.resonance),t.setEnvMod(a.filterEnvelope.envMod),t.setDecay(a.filterEnvelope.decay),t.setAccentAmount(a.accent.amount),t.setWaveform(a.oscillator.type),void 0!==a.tuning&&t.setTuning(a.tuning),a.overdrive&&t.setOverdrive(a.overdrive.amount),a.devilFish){const e=a.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:a.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const n=this.getNormalizedVolume("Buzz3o3",e.volume);t.setVolume(n)}return t}static createWavetable(e){const t=e.wavetable||nn,a=new Br(t);return a.output.gain.value=re(this.getNormalizedVolume("Wavetable",e.volume)),a}static createSampler(e){if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new ie({urls:e.sample.multiMap,volume:this.getNormalizedVolume("Sampler",e.volume)});const t=e.parameters?.sampleUrl||e.sample?.url,a=e.sample?.baseNote||"C4";if(!t&&e.metadata,t){const n={};return n[a]=t,new ie({urls:n,volume:this.getNormalizedVolume("Sampler",e.volume)})}return new ie({volume:this.getNormalizedVolume("Sampler",e.volume)})}static createPlayer(e){const t=e.parameters?.sampleUrl,a=e.parameters?.reverseMode||"forward";if(t){return new oe({url:t,volume:this.getNormalizedVolume("Player",e.volume),reverse:"reverse"===a})}return new oe({volume:this.getNormalizedVolume("Player",e.volume)})}static createGranularSynth(e){const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,a=e.granular;if(t){return new le({url:t,grainSize:(a?.grainSize||100)/1e3,overlap:(a?.grainOverlap||50)/100,playbackRate:a?.playbackRate||1,detune:a?.detune||0,reverse:a?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}return new le({grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}static createSuperSaw(e){const t=e.superSaw||un,a=t.detune,n=new X(Y,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??80)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("SuperSaw",e.volume)}),s=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),r=new q({frequency:4,delayTime:2.5,depth:Math.min(1,a/50),wet:.8});r.start(),n.connect(s),s.connect(r);const i=e.pitchEnvelope,o=i?.enabled&&0!==i.amount;return{triggerAttackRelease:(e,t,a,s)=>{const r=a??Q();o&&this.applyPitchEnvelope(n,i,r,t),n.triggerAttackRelease(e,t,r,s)},triggerAttack:(e,t,a)=>{const s=t??Q();o&&this.triggerPitchEnvelopeAttack(n,i,s),n.triggerAttack(e,s,a)},triggerRelease:(e,t)=>{const a=t??Q();o&&this.triggerPitchEnvelopeRelease(n,i,a),n.triggerRelease(e,a)},releaseAll:()=>{n.set({detune:0}),n.releaseAll()},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{n.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||un;n.set({envelope:{attack:(t.envelope.attack||10)/1e3,decay:(t.envelope.decay||100)/1e3,sustain:(t.envelope.sustain||80)/100,release:(t.envelope.release||300)/1e3}}),s.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),r.set({depth:Math.min(1,t.detune/50)})},volume:n.volume}}static createPolySynth(e){const t=e.polySynth||dn;let a=Y;"FMSynth"===t.voiceType?a=O:"AMSynth"===t.voiceType&&(a=ee);const n=new X(a,{maxPolyphony:t.voiceCount,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||50)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||500)/1e3},volume:this.getNormalizedVolume("PolySynth",e.volume)}),s=e.pitchEnvelope;return s?.enabled&&0!==s.amount?{triggerAttackRelease:(e,t,a,r)=>{const i=a??Q();this.applyPitchEnvelope(n,s,i,t),n.triggerAttackRelease(e,t,i,r)},triggerAttack:(e,t,a)=>{const r=t??Q();this.triggerPitchEnvelopeAttack(n,s,r),n.triggerAttack(e,r,a)},triggerRelease:(e,t)=>{const a=t??Q();this.triggerPitchEnvelopeRelease(n,s,a),n.triggerRelease(e,a)},releaseAll:()=>{n.set({detune:0}),n.releaseAll()},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>n.dispose(),volume:n.volume}:n}static createOrgan(e){const t=e.organ||pn,a=t.drawbars||pn.drawbars,n=new p(1),s=new X(Y,{maxPolyphony:32,oscillator:{type:"sine",partials:[a[0]/8,a[1]/8,a[2]/8,a[3]/8,a[4]/8,a[5]/8,a[6]/8,a[7]/8,a[8]/8]},envelope:{attack:.005,decay:.1,sustain:1,release:.1},volume:this.getNormalizedVolume("Organ",e.volume)});let r=null;return t.rotary?.enabled?(r=new $({frequency:"fast"===t.rotary.speed?6:1,depth:.3,wet:.5}),r.start(),s.connect(r),r.connect(n)):s.connect(n),{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(e,t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{s.triggerRelease(e,t)},releaseAll:()=>s.releaseAll(),connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{s.dispose(),r?.dispose(),n.dispose()},applyConfig:e=>{const t=e||pn;s.set({oscillator:{partials:[(t.drawbars[0]||0)/8,(t.drawbars[1]||0)/8,(t.drawbars[2]||0)/8,(t.drawbars[3]||0)/8,(t.drawbars[4]||0)/8,(t.drawbars[5]||0)/8,(t.drawbars[6]||0)/8,(t.drawbars[7]||0)/8,(t.drawbars[8]||0)/8]}}),r&&r.frequency.rampTo("fast"===t.rotary?.speed?6:1,.1)},volume:s.volume}}static createDrumMachine(e){const t=e.drumMachine||hn,a="808"===t.machineType;switch(t.drumType){case"kick":{const n={...a?{pitch:48,pitchDecay:50,tone:40,toneDecay:30,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},...t.kick},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)});let r=s,i=null,o=null;n.drive>0&&(i=new b({distortion:n.drive/100*.5,oversample:"2x",wet:1})),o=new m({type:"lowpass",frequency:n.filterFreq,Q:1,rolloff:-24}),i?(s.connect(i),i.connect(o)):s.connect(o),r=o;const l=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(l,t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(l,t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{s.dispose(),i?.dispose(),o?.dispose()},applyConfig:e=>{const t=(e||hn).kick;t&&(s.set({pitchDecay:t.envDuration/1e3,octaves:2*Math.log2(t.envAmount),envelope:{decay:t.decay/1e3}}),i&&(i.distortion=t.drive/100*.5),o&&o.frequency.rampTo(t.filterFreq,.1))},volume:s.volume}}case"snare":{const n={...a?{pitch:238,tone:35,toneDecay:200,snappy:55,decay:150,envAmount:2.5,envDuration:25,filterType:"lowpass",filterFreq:2500}:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},...t.snare},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3,sustain:0,release:.05},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(n.snappy/15-3)}),i=new m({type:n.filterType,frequency:n.filterFreq,Q:2}),o=new p(1);s.connect(o),r.connect(i),i.connect(o);const l=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(l,t,a,n),r.triggerAttackRelease(t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(l,t,a),r.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose(),o.dispose()},applyConfig:t=>{const a=(t||DEFAULT_DR_MACHINE).snare;a&&(s.set({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),envelope:{decay:a.decay/1e3}}),r.set({envelope:{decay:a.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(a.snappy/15-3)}),i.set({type:a.filterType,frequency:a.filterFreq}))},volume:s.volume}}case"hihat":{const n={...a?{tone:40,decay:80,metallic:70}:{tone:50,decay:100,metallic:50},...t.hihat};return new ae({frequency:a?180+1.5*n.tone:200+2*n.tone,envelope:{attack:.001,decay:n.decay/1e3,release:a?.02:.01},harmonicity:5.1,modulationIndex:32+n.metallic/3,resonance:4e3+40*n.tone,octaves:1.5,volume:e.volume||-12})}case"clap":{const n={...a?{tone:45,decay:120,toneDecay:350,spread:15,filterFreqs:[700,1e3],modulatorFreq:30}:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},...t.clap},s=new p(1),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.05},volume:e.volume??-10}),i=new m({type:"highpass",frequency:n.filterFreqs[0],Q:1.2}),o=new m({type:"bandpass",frequency:n.filterFreqs[1],Q:.7}),l=new m({type:"bandpass",frequency:1e3+24*n.tone,Q:2});r.connect(l),l.connect(i),i.connect(o),o.connect(s);const c=[],u=4;for(let t=0;t<u;t++){const a=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3/(t+1),sustain:0,release:.02},volume:(e.volume??-10)-3*t});a.connect(l),c.push(a)}return{triggerAttackRelease:(e,t,a,s)=>{const i=a??Q(),o=n.spread/1e3;c.forEach((e,a)=>{const n=i+a*o,r=(s??1)*(1-.15*a);e.triggerAttackRelease(t/(a+1),n,r)}),r.triggerAttackRelease(t,i+u*o,s)},triggerAttack:(e,t,a)=>{const s=t??Q(),i=n.spread/1e3;c.forEach((e,t)=>{e.triggerAttack(s+t*i,(a??1)*(1-.15*t))}),r.triggerAttack(s+u*i,a)},triggerRelease:(e,t)=>{r.triggerRelease(t),c.forEach(e=>e.triggerRelease(t))},releaseAll:()=>{try{r.triggerRelease()}catch{}c.forEach(e=>{try{e.triggerRelease()}catch{}})},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{r.dispose(),c.forEach(e=>e.dispose()),i.dispose(),o.dispose(),l.dispose(),s.dispose()},applyConfig:e=>{const t=(e||hn).clap;t&&(r.set({envelope:{decay:t.decay/1e3}}),i.frequency.rampTo(t.filterFreqs[0],.1),o.frequency.rampTo(t.filterFreqs[1],.1),l.frequency.rampTo(1e3+24*t.tone,.1),c.forEach((e,a)=>{e.set({envelope:{decay:t.toneDecay/1e3/(a+1)}})}))},volume:r.volume}}case"tom":{const n={...a?{pitch:160,decay:300,tone:2,toneDecay:50,envAmount:1.5,envDuration:150}:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},...t.tom},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3,sustain:0,release:.02},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+n.tone/5}),i=new p(1);s.connect(i),r.connect(i);const o=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(o,t,a,n),r.triggerAttackRelease(.3*t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(o,t,a),r.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose()},applyConfig:t=>{const a=(t||DEFAULT_DR_MACHINE).tom;a&&(s.set({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),envelope:{decay:a.decay/1e3}}),r.set({envelope:{decay:a.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+a.tone/5}))},volume:s.volume}}case"rimshot":{const n={...a?{decay:45,filterFreqs:[280,450,850],filterQ:8,saturation:2}:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},...t.rimshot},s=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.01},volume:e.volume??-10}),r=new m({type:"bandpass",frequency:n.filterFreqs[0],Q:n.filterQ}),i=new m({type:"bandpass",frequency:n.filterFreqs[1],Q:n.filterQ}),o=new m({type:"bandpass",frequency:n.filterFreqs[2],Q:n.filterQ}),l=new p(1);s.connect(r),s.connect(i),s.connect(o),r.connect(l),i.connect(l),o.connect(l);const c=new b({distortion:n.saturation/5*.8,oversample:"2x",wet:1}),u=new m({type:"highpass",frequency:100,Q:.5});return l.connect(c),c.connect(u),{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>u.connect(e),disconnect:()=>u.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose(),c.dispose(),u.dispose()},applyConfig:e=>{const t=(e||hn).rimshot;t&&(s.set({envelope:{decay:t.decay/1e3}}),r.frequency.rampTo(t.filterFreqs[0],.1),i.frequency.rampTo(t.filterFreqs[1],.1),o.frequency.rampTo(t.filterFreqs[2],.1),r.Q.value=t.filterQ,i.Q.value=t.filterQ,o.Q.value=t.filterQ,c.distortion=t.saturation/5*.8)},volume:s.volume}}case"conga":{const a={pitch:310,decay:180,...t.conga},n=new Y({oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:e.volume??-8}),s=new m({type:"lowpass",frequency:1e4,Q:1});n.connect(s);const r=ce(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(r,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(r,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).conga;t&&n.set({envelope:{decay:t.decay/1e3}})},volume:n.volume}}case"cowbell":{const e={decay:400,filterFreq:2640,...t.cowbell},a=new T({type:"square",frequency:540,volume:-6}),n=new T({type:"square",frequency:800,volume:-6}),s=new p(0),r=new p(0),i=new m({type:"bandpass",frequency:e.filterFreq,Q:1}),o=new p(.3);a.connect(o),n.connect(o),o.connect(s),o.connect(r);const l=new p(1);return s.connect(i),r.connect(i),i.connect(l),a.start(),n.start(),{triggerAttackRelease:(t,a,n,i)=>{const o=n??Q(),l=i??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(0,o),s.gain.linearRampToValueAtTime(.375*l,o+.002),s.gain.linearRampToValueAtTime(0,o+.017),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.001,o+.015),r.gain.exponentialRampToValueAtTime(.125*l,o+.017),r.gain.exponentialRampToValueAtTime(.001,o+.017+e.decay/1e3)},triggerAttack:(t,a,n)=>{const i=a??Q(),o=n??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.375*o,i+.002),s.gain.linearRampToValueAtTime(0,i+.017),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.001,i+.015),r.gain.exponentialRampToValueAtTime(.125*o,i+.017),r.gain.exponentialRampToValueAtTime(.001,i+.017+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{a.stop(),n.stop(),a.dispose(),n.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).cowbell;t&&i.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"clave":{const e={decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450,...t.clave},a=new T({type:"triangle",frequency:e.pitch,volume:-6}),n=new T({type:"sine",frequency:e.pitchSecondary,volume:-8}),s=new p(0),r=new p(0),i=new m({type:"bandpass",frequency:e.filterFreq,Q:5}),o=new b({distortion:.5,oversample:"2x",wet:1}),l=new p(1);return a.connect(s),n.connect(r),s.connect(i),r.connect(i),i.connect(o),o.connect(l),a.start(),n.start(),{triggerAttackRelease:(t,a,n,i)=>{const o=n??Q(),l=i??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(.7*l,o),s.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.5*l,o),r.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3)},triggerAttack:(t,a,n)=>{const i=a??Q(),o=n??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(.7*o,i),s.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.5*o,i),r.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{a.stop(),n.stop(),a.dispose(),n.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).clave;t&&i.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"maracas":{const a={decay:30,filterFreq:5e3,...t.maracas},n=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.01},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),s=new m({type:"highpass",frequency:a.filterFreq,Q:1});return n.connect(s),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).maracas;t&&(n.set({envelope:{decay:t.decay/1e3}}),s.frequency.rampTo(t.filterFreq,.1))},volume:n.volume}}case"cymbal":{const e={tone:50,decay:2e3,...t.cymbal},a=[263,400,421,474,587,845],n=[],s=new p(.3);for(const t of a){const e=new T({type:"square",frequency:t,volume:-10});e.connect(s),e.start(),n.push(e)}const r=new m({type:"bandpass",frequency:5e3,Q:1}),i=new p(0),o=new m({type:"bandpass",frequency:1e4,Q:1}),l=new p(0),c=new m({type:"highpass",frequency:8e3,Q:1}),u=new p(0);s.connect(r),s.connect(o),s.connect(c),r.connect(i),o.connect(l),c.connect(u);const d=new p(1);i.connect(d),l.connect(d),u.connect(d);const h=.666-e.tone/100*.666,f=.333,g=.666-.666*(1-e.tone/100);return{triggerAttackRelease:(t,a,n,s)=>{const r=n??Q(),o=s??1;i.gain.cancelScheduledValues(r),i.gain.setValueAtTime(.001,r),i.gain.exponentialRampToValueAtTime(h*o,r+.01),i.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3),l.gain.cancelScheduledValues(r),l.gain.setValueAtTime(.001,r),l.gain.exponentialRampToValueAtTime(f*o,r+.01),l.gain.exponentialRampToValueAtTime(.001,r+.4),u.gain.cancelScheduledValues(r),u.gain.setValueAtTime(.001,r),u.gain.exponentialRampToValueAtTime(g*o,r+.01),u.gain.exponentialRampToValueAtTime(.001,r+.15)},triggerAttack:(t,a,n)=>{const s=a??Q(),r=n??1;i.gain.cancelScheduledValues(s),i.gain.setValueAtTime(.001,s),i.gain.exponentialRampToValueAtTime(h*r,s+.01),i.gain.exponentialRampToValueAtTime(.001,s+e.decay/1e3),l.gain.cancelScheduledValues(s),l.gain.setValueAtTime(.001,s),l.gain.exponentialRampToValueAtTime(f*r,s+.01),l.gain.exponentialRampToValueAtTime(.001,s+.4),u.gain.cancelScheduledValues(s),u.gain.setValueAtTime(.001,s),u.gain.exponentialRampToValueAtTime(g*r,s+.01),u.gain.exponentialRampToValueAtTime(.001,s+.15)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>d.connect(e),disconnect:()=>d.disconnect(),dispose:()=>{n.forEach(e=>{e.stop(),e.dispose()}),s.dispose(),r.dispose(),o.dispose(),c.dispose(),i.dispose(),l.dispose(),u.dispose(),d.dispose()},applyConfig:e=>{},volume:d.gain}}default:return new ne({pitchDecay:.05,octaves:3,envelope:{attack:.001,decay:.3,sustain:0,release:.1},volume:e.volume||-12})}}static createChipSynth(e){const t=e.chipSynth||mn,a=t.arpeggio;let n="square";if("triangle"===t.channel&&(n="triangle"),"noise"===t.channel){const a=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack||5)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??0)/100,release:(t.envelope?.release||50)/1e3},volume:e.volume||-12}),n=new U({bits:t.bitDepth,wet:1});return a.connect(n),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{a.dispose(),n.dispose()},applyConfig:e=>{const t=e||mn;a.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),n.bits=t.bitDepth},volume:a.volume}}const s=new X(Y,{maxPolyphony:32,oscillator:{type:n},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:this.getNormalizedVolume("ChipSynth",e.volume)}),r=new U({bits:t.bitDepth,wet:1});s.connect(r);let i=null,o=null;a?.enabled&&(i=new Ci({config:a,onNoteOn:(e,t,a,n)=>{o&&s.triggerRelease(o,n),s.triggerAttackRelease(e,a,n,t),o=e},onNoteOff:(e,t)=>{s.triggerRelease(e,t),o===e&&(o=null)}}));return{triggerAttackRelease:(e,t,n,r)=>{if(i&&a?.enabled){if(i.start(e,r??1),t&&"number"==typeof t){const a=(n??Q())+t;N().scheduleOnce(()=>{i.stop(e)},a)}}else s.triggerAttackRelease(e,t,n,r)},triggerAttack:(e,t,n)=>{i&&a?.enabled?i.start(e,n??1):s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{i&&a?.enabled?i.stop(e):s.triggerRelease(e,t)},releaseAll:()=>{i&&i.stopAll(),s.releaseAll(),o=null},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{i&&i.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||mn;s.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),r.bits=t.bitDepth},volume:s.volume,updateArpeggio:e=>{i&&e&&i.updateConfig(e)},getArpeggioEngine:()=>i,getCurrentArpeggioStep:()=>i?.getCurrentStep()??0,isArpeggioPlaying:()=>i?.getIsPlaying()??!1}}static createFurnace(e){if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new Li(e.furnace)}static createBuzzmachine(e){const t=e.buzzmachine?.machineType||"ArguruDistortion",a=new il({ArguruDistortion:nl.ARGURU_DISTORTION,ElakDist2:nl.ELAK_DIST2,JeskolaDistortion:nl.JESKOLA_DISTORTION,GeonikOverdrive:nl.GEONIK_OVERDRIVE,GraueSoftSat:nl.GRAUE_SOFTSAT,WhiteNoiseStereoDist:nl.WHITENOISE_STEREODIST,ElakSVF:nl.ELAK_SVF,CyanPhaseNotch:nl.CYANPHASE_NOTCH,QZfilter:nl.Q_ZFILTER,FSMPhilta:nl.FSM_PHILTA,JeskolaDelay:nl.JESKOLA_DELAY,JeskolaCrossDelay:nl.JESKOLA_CROSSDELAY,JeskolaFreeverb:nl.JESKOLA_FREEVERB,FSMPanzerDelay:nl.FSM_PANZERDELAY,FSMChorus:nl.FSM_CHORUS,FSMChorus2:nl.FSM_CHORUS2,WhiteNoiseWhiteChorus:nl.WHITENOISE_WHITECHORUS,BigyoFrequencyShifter:nl.BIGYO_FREQUENCYSHIFTER,GeonikCompressor:nl.GEONIK_COMPRESSOR,LdSLimit:nl.LD_SLIMIT,OomekExciter:nl.OOMEK_EXCITER,OomekMasterizer:nl.OOMEK_MASTERIZER,DedaCodeStereoGain:nl.DEDACODE_STEREOGAIN,FSMKick:nl.FSM_KICK,FSMKickXP:nl.FSM_KICKXP,JeskolaTrilok:nl.JESKOLA_TRILOK,JeskolaNoise:nl.JESKOLA_NOISE,OomekAggressor:nl.OOMEK_AGGRESSOR,MadBrain4FM2F:nl.MADBRAIN_4FM2F,MadBrainDynamite6:nl.MADBRAIN_DYNAMITE6,MakkM3:nl.MAKK_M3,CyanPhaseDTMF:nl.CYANPHASE_DTMF,ElenzilFrequencyBomb:nl.ELENZIL_FREQUENCYBOMB}[t]??nl.ARGURU_DISTORTION),n=this.getNormalizedVolume("Buzzmachine",e.volume);return a.output.gain.value=re(n),a}static CHIP_DEFAULTS={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]},2:{algorithm:0,feedback:3,operators:[{enabled:!0,mult:2,tl:30,ar:15,dr:4,d2r:0,sl:8,rr:5,dt:0,ws:1,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:2,d2r:0,sl:4,rr:8,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1}]},11:{algorithm:0,feedback:2,operators:[{enabled:!0,mult:4,tl:35,ar:15,dr:5,d2r:0,sl:6,rr:7,dt:0,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:3,d2r:0,sl:3,rr:6,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},4:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},5:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:28,dr:2,d2r:0,sl:2,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},3:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},12:{algorithm:7,feedback:1,operators:[{enabled:!0,mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:50,ar:31,dr:8,d2r:0,sl:8,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},10:{algorithm:4,feedback:4,operators:[{enabled:!0,mult:1,tl:15,ar:25,dr:8,d2r:3,sl:5,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:6,rr:10,dt:1,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},6:{algorithm:6,feedback:2,operators:[{enabled:!0,mult:1,tl:12,ar:31,dr:5,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:0,sl:4,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},9:{algorithm:5,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:31,dr:3,d2r:0,sl:1,rr:10,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:6,d2r:0,sl:3,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},8:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]},15:{algorithm:7,feedback:7,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4,dt:0,am:!1},{enabled:!0,mult:5,tl:45,ar:31,dr:20,d2r:0,sl:10,rr:6,dt:2,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]}};static createFurnaceWithChip(e,t){const a=this.CHIP_DEFAULTS[t]||{algorithm:0,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}]},n={...e.furnace||{algorithm:a.algorithm??0,feedback:a.feedback??0,operators:a.operators||[],macros:[],opMacros:[],wavetables:a.wavetables||[]},chipType:t};return new Li(n)}static createPWMSynth(e){const t=e.pwmSynth||fn,a=new X(Y,{maxPolyphony:32,oscillator:{type:"square"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("PWMSynth",e.volume)}),n=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),s=new q({frequency:t.pwmRate,delayTime:2,depth:t.pwmDepth/100,wet:.6});return s.start(),a.connect(n),n.connect(s),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),n.dispose(),s.dispose()},applyConfig:e=>{const t=e||fn;a.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),n.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),s.set({frequency:t.pwmRate,depth:t.pwmDepth/100})},volume:a.volume}}static createStringMachine(e){const t=e.stringMachine||gn,a=new X(Y,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.attack||100)/1e3,decay:.2,sustain:.9,release:(t.release||500)/1e3},volume:this.getNormalizedVolume("StringMachine",e.volume)}),n=new q({frequency:t.ensemble.rate,delayTime:3.5,depth:t.ensemble.depth/100,wet:.8});n.start();const s=new m({type:"lowpass",frequency:2e3+80*t.brightness,Q:.5,rolloff:-12});return a.connect(s),s.connect(n),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{a.dispose(),n.dispose(),s.dispose()},applyConfig:e=>{const t=e||gn;a.set({envelope:{attack:t.attack/1e3,release:t.release/1e3}}),n.set({frequency:t.ensemble.rate,depth:t.ensemble.depth/100}),s.frequency.rampTo(2e3+80*t.brightness,.1)},volume:a.volume}}static createFormantSynth(e){const t=e.formantSynth||xn,a=yn[t.vowel]||yn.a,n=new X(Y,{maxPolyphony:32,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("FormantSynth",e.volume)}),s=new m({type:"bandpass",frequency:a.f1,Q:3}),r=new m({type:"bandpass",frequency:a.f2,Q:3}),i=new m({type:"bandpass",frequency:a.f3,Q:3}),o=new p(2);return n.connect(s),n.connect(r),n.connect(i),s.connect(o),r.connect(o),i.connect(o),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{n.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose()},applyConfig:e=>{const t=e||xn,a=yn[t.vowel];n.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),s.frequency.rampTo(a.f1,.1),r.frequency.rampTo(a.f2,.1),i.frequency.rampTo(a.f3,.1)},volume:n.volume}}static createWobbleBass(e){const t=e.wobbleBass||bn,a=Math.max(1,t.unison.voices),n=t.unison.detune,s=new X(Y,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc1.level/100*6-6-6}),r=new X(Y,{maxPolyphony:32,oscillator:{type:t.osc2.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc2.level/100*6-6-6});s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune});let i=null;t.sub.enabled&&(i=new X(Y,{maxPolyphony:32,oscillator:{type:"sine"},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.sub.level/100*12-12-6}),i.set({detune:1200*t.sub.octave}));const o=[],l=[];if(a>1)for(let p=1;p<Math.min(a,8);p++){const e=(p/a-.5)*n*2,s=(p/a-.5)*(t.unison.stereoSpread/50),r=new X(Y,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-12-1.5*a});r.set({detune:1200*t.osc1.octave+e});const i=new ue(s);r.connect(i),o.push(r),l.push(i)}let c=null;t.fm.enabled&&t.fm.amount>0&&(c=new X(O,{maxPolyphony:32,modulationIndex:t.fm.amount/10,harmonicity:t.fm.ratio,envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-6}),c.set({detune:1200*t.osc1.octave}));const u=new p(1),d=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:t.filter.rolloff});let h=null;t.filter.drive>0&&(h=new b({distortion:t.filter.drive/100,oversample:"2x"}));const f=t.filterEnvelope.amount/100,g=t.filter.cutoff,y=4*Math.abs(f),x=new de({baseFrequency:g,octaves:y,attack:t.filterEnvelope.attack/1e3,decay:t.filterEnvelope.decay/1e3,sustain:t.filterEnvelope.sustain/100,release:t.filterEnvelope.release/1e3});(!t.wobbleLFO.enabled||t.filterEnvelope.amount>0)&&x.connect(d.frequency);let w=null;if(t.wobbleLFO.enabled){let e=t.wobbleLFO.rate;if("free"!==t.wobbleLFO.sync){e=(N().bpm.value||120)/60*(({"1/1":1,"1/2":2,"1/2T":3,"1/2D":1.5,"1/4":4,"1/4T":6,"1/4D":3,"1/8":8,"1/8T":12,"1/8D":6,"1/16":16,"1/16T":24,"1/16D":12,"1/32":32,"1/32T":48}[t.wobbleLFO.sync]||4)/4)}const a={sine:"sine",triangle:"triangle",saw:"sawtooth",square:"square",sample_hold:"square"},n=4*g,s=Math.max(20,.1*g),r=Math.min(2e4,g+n*(t.wobbleLFO.amount/100));w=new v({frequency:e,type:a[t.wobbleLFO.shape]||"sine",min:s,max:r,phase:t.wobbleLFO.phase}),w.connect(d.frequency),w.start()}let k=null;if(t.distortion.enabled)switch(t.distortion.type){case"soft":k=new b({distortion:t.distortion.drive/100,oversample:"2x"});break;case"hard":k=new z({order:Math.floor(1+t.distortion.drive/100*50)});break;case"fuzz":k=new b({distortion:.5+t.distortion.drive/200,oversample:"4x"});break;case"bitcrush":k=new U({bits:Math.max(2,12-Math.floor(t.distortion.drive/10))})}const S=new m({type:"lowpass",frequency:500+t.distortion.tone/100*15e3,Q:.5});let M=[],C=null;if(t.formant.enabled){const e=yn[t.formant.vowel];M=[new m({type:"bandpass",frequency:e.f1,Q:5}),new m({type:"bandpass",frequency:e.f2,Q:5}),new m({type:"bandpass",frequency:e.f3,Q:5})],C=new p(.5)}const E=new p(1);E.gain.value=Math.pow(10,this.getNormalizedVolume("WobbleBass",e.volume)/20),s.connect(u),r.connect(u),i&&i.connect(u),c&&c.connect(u),l.forEach(e=>e.connect(u)),h?(u.connect(h),h.connect(d)):u.connect(d);let P=d;k&&(P.connect(k),P=k),P.connect(S),P=S,C&&M.length>0?(M.forEach(e=>{P.connect(e),e.connect(C)}),C.connect(E),P.connect(E)):P.connect(E);const _=new Set;return{triggerAttackRelease:(e,a,n,l)=>{const u=n??Q(),d=l??.8;t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(u),s.triggerAttackRelease(e,a,u,d),r.triggerAttackRelease(e,a,u,d),i&&i.triggerAttackRelease(e,a,u,d),c&&c.triggerAttackRelease(e,a,u,d),o.forEach(t=>t.triggerAttackRelease(e,a,u,.6*d))},triggerAttack:(e,a,n)=>{const l=a??Q(),u=n??.8;_.add(e),t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(l),s.triggerAttack(e,l,u),r.triggerAttack(e,l,u),i&&i.triggerAttack(e,l,u),c&&c.triggerAttack(e,l,u),o.forEach(t=>t.triggerAttack(e,l,.6*u))},triggerRelease:(e,t)=>{const a=t??Q();_.delete(e),x.triggerRelease(a),s.triggerRelease(e,a),r.triggerRelease(e,a),i&&i.triggerRelease(e,a),c&&c.triggerRelease(e,a),o.forEach(t=>t.triggerRelease(e,a))},releaseAll:()=>{s.releaseAll(),r.releaseAll(),i&&i.releaseAll(),c&&c.releaseAll(),o.forEach(e=>e.releaseAll()),_.clear()},connect:e=>E.connect(e),disconnect:()=>E.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i&&i.dispose(),c&&c.dispose(),o.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),u.dispose(),d.dispose(),h&&h.dispose(),x.dispose(),w&&w.dispose(),k&&k.dispose(),S.dispose(),M.forEach(e=>e.dispose()),C&&C.dispose(),E.dispose()},applyConfig:e=>{const t=e||bn,a={attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3};s.set({envelope:a}),r.set({envelope:a}),i&&i.set({envelope:a}),c&&c.set({envelope:a}),o.forEach(e=>e.set({envelope:a})),s.volume.rampTo(t.osc1.level/100*6-6-6,.1),r.volume.rampTo(t.osc2.level/100*6-6-6,.1),s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune}),i&&(i.volume.rampTo(t.sub.level/100*12-12-6,.1),i.set({detune:1200*t.sub.octave})),d.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),w&&w.frequency.rampTo(t.wobbleLFO.rate,.1)},volume:s.volume,wobbleLFO:w,filter:d}}static reverseAudioBuffer(e){const t=k().rawContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let a=0;a<e.numberOfChannels;a++){const n=e.getChannelData(a),s=t.getChannelData(a);for(let e=0;e<n.length;e++)s[e]=n[n.length-1-e]}return t}static createDrumKit(e){const t=e.drumKit||Cn;return new Ji(t)}static applyPitchEnvelope(e,t,a,n){const s=100*t.amount,r=t.sustain/100*s,i=t.attack/1e3;t.decay;const o=t.release/1e3,l=e;if(!l.set)return;l.set({detune:s});setTimeout(()=>{l.set&&l.set({detune:r})},1e3*(a+i-Q()));setTimeout(()=>{l.set&&l.set({detune:0})},1e3*(a+n-Q())+1e3*o)}static triggerPitchEnvelopeAttack(e,t,a){const n=100*t.amount,s=t.sustain/100*n,r=t.attack/1e3,i=t.decay/1e3,o=e;if(!o.set)return;o.set({detune:n});setTimeout(()=>{o.set&&o.set({detune:s})},1e3*(r+i))}static createDubSiren(e){const t=e.dubSiren||Pn,a=new ro(t);return a.volume.value=this.getNormalizedVolume("DubSiren",e.volume),a}static createSpaceLaser(e){const t=e.spaceLaser||In,a=new io(t);return a.volume.value=this.getNormalizedVolume("SpaceLaser",e.volume),a}static createV2(e){if(e.v2Speech){const t=new al(e.v2Speech);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}const t=new tl(e.v2||void 0);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}static createSam(e){const t=e.sam||_n,a=new el(t);return a.output.gain.value=re(this.getNormalizedVolume("Sam",e.volume)),a}static createSynare(e){const t=e.synare||Dn,a=new oo(t);return a.volume.value=this.getNormalizedVolume("Synare",e.volume),a}static createDexed(e){const t=e.dexed||{},a=new ql(t);return a.output.gain.value=re(this.getNormalizedVolume("Dexed",e.volume)),a}static createOBXd(e){const t=e.obxd||{},a=new Gc(t);return a.output.gain.value=re(this.getNormalizedVolume("OBXd",e.volume)),a}static createCZ101(e){const t=new Zc;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("CZ101",e.volume)),t}static createCEM3394(e){const t=new uu;return t.output.gain.value=re(this.getNormalizedVolume("CEM3394",e.volume)),t}static createSCSP(e){const t=new pu;return t.output.gain.value=re(this.getNormalizedVolume("SCSP",e.volume)),t}static createVFX(e){const t=new Iu;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMEVFX",e.volume)),t}static createD50(e){const t=new Ru;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),t}static createRdPiano(e){const t=e.rdpiano||{},a=new Xu(t);return a.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),a}static createMU2000(e){const t=new td;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMESWP30",e.volume)),t}static createBuzz3o3DF(e){const t=new il(nl.OOMEK_AGGRESSOR_DF);if(e.tb303){const a=e.tb303;if(t.setCutoff(a.filter.cutoff),t.setResonance(a.filter.resonance),t.setEnvMod(a.filterEnvelope.envMod),t.setDecay(a.filterEnvelope.decay),t.setAccentAmount(a.accent.amount),t.setWaveform(a.oscillator.type),void 0!==a.tuning&&t.setTuning(a.tuning),a.overdrive&&t.setOverdrive(a.overdrive.amount),a.devilFish){const e=a.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:a.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const n=this.getNormalizedVolume("Buzz3o3DF",e.volume);t.setVolume(n)}return t}static applyChipParameters(e,t){const a=t.parameters;if(a){"number"==typeof a._program&&"function"==typeof e.loadPreset&&e.loadPreset(a._program);for(const[t,n]of Object.entries(a))"_program"!==t&&"number"==typeof n&&e.setParam(t,n)}}static createMAMEAICA(e){const t=new nd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAICA",e.volume)),this.applyChipParameters(t,e),t}static createMAMEASC(e){const t=new pd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEASC",e.volume)),this.applyChipParameters(t,e),t}static createMAMEAstrocade(e){const t=new wd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAstrocade",e.volume)),this.applyChipParameters(t,e),t}static createMAMEC352(e){const t=new Sd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEC352",e.volume)),this.applyChipParameters(t,e),t}static createMAMEES5503(e){const t=new Od;return t.output.gain.value=re(this.getNormalizedVolume("MAMEES5503",e.volume)),this.applyChipParameters(t,e),t}static createMAMEICS2115(e){const t=new Fd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEICS2115",e.volume)),this.applyChipParameters(t,e),t}static createMAMEK054539(e){const t=new Ld;return t.output.gain.value=re(this.getNormalizedVolume("MAMEK054539",e.volume)),this.applyChipParameters(t,e),t}static createMAMEMEA8000(e){const t=new qd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEMEA8000",e.volume)),this.applyChipParameters(t,e),t}static createMAMERF5C400(e){const t=new Qd;return t.output.gain.value=re(this.getNormalizedVolume("MAMERF5C400",e.volume)),this.applyChipParameters(t,e),t}static createMAMESN76477(e){const t=new dp;return t.output.gain.value=re(this.getNormalizedVolume("MAMESN76477",e.volume)),this.applyChipParameters(t,e),t}static createMAMESNKWave(e){const t=new gp;return t.output.gain.value=re(this.getNormalizedVolume("MAMESNKWave",e.volume)),this.applyChipParameters(t,e),t}static createMAMESP0250(e){const t=new Sp;return t.output.gain.value=re(this.getNormalizedVolume("MAMESP0250",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS36XX(e){const t=new Tp;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS36XX",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS5220(e){const t=new zp;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS5220",e.volume)),this.applyChipParameters(t,e),t}static createMAMETR707(e){const t=new ah;return t.output.gain.value=re(this.getNormalizedVolume("MAMETR707",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD931(e){const t=new dh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD931",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD933(e){const t=new Sh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD933",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVotrax(e){const t=new Ah;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVotrax",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMF271(e){const t=new qh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMF271",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMOPQ(e){const t=new hm;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMOPQ",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVASynth(e){const t=new km;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVASynth",e.volume)),this.applyChipParameters(t,e),t}static triggerPitchEnvelopeRelease(e,t,a){const n=t.release/1e3,s=e;s.set&&setTimeout(()=>{s.set&&s.set({detune:0})},1e3*n)}}function Dm(e){const t={FurnaceOPN:0,FurnaceOPM:1,FurnaceOPL:2,FurnacePSG:3,FurnaceNES:4,FurnaceGB:5,FurnacePCE:6,FurnaceSCC:7,FurnaceN163:8,FurnaceVRC6:9,FurnaceC64:10,FurnaceOPLL:11,FurnaceAY:12,FurnaceOPNA:13,FurnaceOPNB:14,FurnaceTIA:15,FurnaceFDS:16,FurnaceMMC5:17,FurnaceSAA:18,FurnaceSWAN:19,FurnaceOKI:20,FurnaceES5506:21,FurnaceOPZ:22,FurnaceY8950:23,FurnaceSNES:24,FurnaceLYNX:25,FurnaceOPL4:26,FurnaceSEGAPCM:27,FurnaceYMZ280B:28,FurnaceRF5C68:29,FurnaceGA20:30,FurnaceC140:31,FurnaceQSOUND:32,FurnaceVIC:33,FurnaceTED:34,FurnaceSUPERVISION:35,FurnaceVERA:36,FurnaceSM8521:37,FurnaceBUBBLE:38,FurnaceK007232:39,FurnaceK053260:40,FurnaceX1_010:41,FurnaceUPD1771:42,FurnaceT6W28:43,FurnaceVB:44,FurnaceSID6581:45,FurnaceSID8580:46,FurnaceOPN2203:47,FurnaceOPNBB:48,FurnaceESFM:49,FurnaceAY8930:50,FurnaceNDS:51,FurnaceGBA:52,FurnacePOKEMINI:54,FurnaceNAMCO:55,FurnacePET:56,FurnacePOKEY:57,FurnaceMSM6258:58,FurnaceMSM5232:59,FurnaceMULTIPCM:60,FurnaceAMIGA:61,FurnacePCSPKR:62,FurnacePONG:63,FurnacePV1000:64,FurnaceDAVE:65,FurnaceSU:66,FurnacePOWERNOISE:68,FurnaceZXBEEPER:69,FurnaceSCVTONE:71,FurnacePCMDAC:72,Furnace:0}[e];if(void 0===t)return;const a={...kn,chipType:t,operators:kn.operators.map(e=>({...e}))};return"FurnaceC64"!==e&&"FurnaceSID6581"!==e&&"FurnaceSID8580"!==e||(a.c64={triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:12,r:6,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}),a}const Fm=[[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]];function Rm(e,t=0){if(e>=36&&e<72&&Math.abs(t)<=8){const a=function(e){const t=Math.max(-8,Math.min(7,Math.round(e)));return t<0?t+16:t}(t);return Fm[a][e-36]}const a=e-48+t/128;return Math.round(428/Math.pow(2,a/12))}function jm(e,t=0){if(e<=0)return-1;const a=3546895/e,n=48+12*Math.log2(a/8287.13);return Math.round(n)}class Lm extends d{name="AmigaFilter";hp_a1=0;hp_a2=0;lp1_a1=0;lp1_a2=0;lp2_a1=0;lp2_a2=0;lp2_b1=0;lp2_b2=0;_ledFilterEnabled=!0;_sampleRate;input;output;_worklet=null;_initialized=!1;_initializing=!1;_retryCount=0;static MAX_RETRIES=3;static _loadPromises=new WeakMap;constructor(){super(),this.input=new p,this.output=new p,this._sampleRate=k().sampleRate,this.setupCoefficients(),this.input.connect(this.output),this.tryInitWorklet()}async tryInitWorklet(){if(this._initialized||this._initializing)return;const e=k();if("running"!==e.state){const t=()=>{"running"===e.state&&this.initWorklet()};return e.on("statechange",t),void setTimeout(()=>{"running"!==e.state||this._initialized||this.initWorklet()},100)}await this.initWorklet()}async initWorklet(){if(!(this._initialized||this._initializing||this._retryCount>=Lm.MAX_RETRIES)){this._initializing=!0;try{const t=this.context,a=t.rawContext||t._context;if(!a||!a.audioWorklet)return void(this._initializing=!1);if("running"!==a.state)return void(this._initializing=!1);const n="/DEViLBOX/",s=`?v=${Date.now()}`;let r=Lm._loadPromises.get(a);r||(r=(async()=>{try{await a.audioWorklet.addModule(`${n}AmigaFilter.worklet.js${s}`)}catch(e){if(!(e?.message?.includes("already")||e?.message?.includes("duplicate")))throw Lm._loadPromises.delete(a),e}})(),Lm._loadPromises.set(a,r)),await r;try{this._worklet=new AudioWorkletNode(a,"amiga-filter-processor")}catch(e){if("InvalidStateError"===e?.name)return this._retryCount++,Lm._loadPromises.delete(a),this._initializing=!1,void(this._retryCount<Lm.MAX_RETRIES&&setTimeout(()=>this.initWorklet(),500));throw e}if(this._worklet&&this._worklet.port.postMessage({type:"INIT",coeffs:{hp:{a1:this.hp_a1,a2:this.hp_a2},lp1:{a1:this.lp1_a1,a2:this.lp1_a2},lp2:{a1:this.lp2_a1,a2:this.lp2_a2,b1:this.lp2_b1,b2:this.lp2_b2}}}),this._worklet){try{this.input.disconnect(this.output)}catch{}x(this.input,this._worklet),x(this._worklet,this.output),this._initialized=!0}else this._initializing=!1}catch(e){this._initializing=!1,this._retryCount++}}}setupCoefficients(){const e=this._sampleRate,t=Math.PI,a=2-Math.cos(2*t*5.128/e),n=a-Math.sqrt(a*a-1);this.hp_a1=1-n,this.hp_a2=n;const s=2-Math.cos(2*t*4420.971/e),r=s-Math.sqrt(s*s-1);this.lp1_a1=1-r,this.lp1_a2=r;const i=1/Math.tan(3090.533*t/e),o=1/.660225;this.lp2_a1=1/(1+o*i+i*i),this.lp2_a2=2*this.lp2_a1,this.lp2_b1=2*(1-i*i)*this.lp2_a1,this.lp2_b2=(1-o*i+i*i)*this.lp2_a1}get ledFilterEnabled(){return this._ledFilterEnabled}set ledFilterEnabled(e){this._ledFilterEnabled=e,this._worklet&&this._worklet.port.postMessage({type:"SET_LED",enabled:e})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this}}class Bm{points=[];enabled=!1;sustainPoint=null;loopStart=null;loopEnd=null;tick=0;isKeyOff=!1;currentValue=64;finished=!1;constructor(e){e&&this.init(e)}init(e){this.enabled=e.enabled,this.points=e.points,this.sustainPoint=e.sustainPoint,this.loopStart=e.loopStartPoint,this.loopEnd=e.loopEndPoint,this.reset()}reset(){this.tick=0,this.isKeyOff=!1,this.currentValue=this.points.length>0?this.points[0].value:64,this.finished=!1}keyOff(){this.isKeyOff=!0}tickNext(){if(!this.enabled||0===this.points.length)return 64;if(this.finished)return this.points[this.points.length-1].value;if(!this.isKeyOff&&null!==this.sustainPoint){const e=this.points[this.sustainPoint];if(this.tick>=e.tick)return this.tick=e.tick,this.currentValue=e.value,this.currentValue}if(null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd],t=this.points[this.loopStart];this.tick>=e.tick&&(this.tick=t.tick)}if(this.currentValue=this.interpolate(this.tick),this.tick++,null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd];this.tick>=e.tick&&(this.tick=this.points[this.loopStart].tick)}return this.tick>this.points[this.points.length-1].tick&&(this.finished=!0,this.tick=this.points[this.points.length-1].tick),this.currentValue}interpolate(e){if(0===this.points.length)return 64;if(e<=this.points[0].tick)return this.points[0].value;if(e>=this.points[this.points.length-1].tick)return this.points[this.points.length-1].value;for(let t=0;t<this.points.length-1;t++){const a=this.points[t],n=this.points[t+1];if(e>=a.tick&&e<=n.tick){const t=n.tick-a.tick;if(0===t)return n.value;const s=(n.value-a.value<<16)/t,r=(e-a.tick)*s;return a.value+(r>>16)}}return 64}isEnabled(){return this.enabled}isFinished(){return this.finished}getCurrentValue(){return this.currentValue}}class Vm{input;output;analyser;fft;disposed=!1;cachedWaveform=null;cachedFFT=null;constructor(){this.input=new p(1),this.output=new p(1),this.analyser=new pe("waveform",256),this.fft=new he(1024),this.input.connect(this.analyser),this.input.connect(this.fft),this.input.connect(this.output)}getWaveform(){if(this.disposed)return this.cachedWaveform||new Float32Array(256);const e=this.analyser.getValue();return this.cachedWaveform&&this.cachedWaveform.length===e.length||(this.cachedWaveform=new Float32Array(e.length)),this.cachedWaveform.set(e),this.cachedWaveform}getFFT(){if(this.disposed)return this.cachedFFT||new Float32Array(1024);const e=this.fft.getValue();return this.cachedFFT&&this.cachedFFT.length===e.length||(this.cachedFFT=new Float32Array(e.length)),this.cachedFFT.set(e),this.cachedFFT}getLevel(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let a=0;a<e.length;a++)t+=e[a]*e[a];return Math.sqrt(t/e.length)}getPeak(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let a=0;a<e.length;a++){const n=Math.abs(e[a]);n>t&&(t=n)}return t}hasActivity(){return this.getPeak()>.001}connectInstrument(e){if(!this.disposed)if(Yn(e)){const t=as(this.input);t&&e.output.connect(t)}else e.connect(this.input)}disconnectInstrument(e){if(!this.disposed)try{Yn(e)?e.output.disconnect():e.disconnect(this.input)}catch{}}dispose(){if(!this.disposed){this.disposed=!0;try{this.input.disconnect(),this.analyser.disconnect(),this.fft.disconnect(),this.output.disconnect(),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.fft.dispose()}catch{}this.cachedWaveform=null,this.cachedFFT=null}}}function zm(e,t){let a;try{a=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=a.getItem(e))?t:null;return s instanceof Promise?s.then(n):n(s)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const Um=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>Um(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>Um(e)(a)}}},Gm=(e,t)=>(a,n,s)=>{let r={storage:zm(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1,o=0;const l=new Set,c=new Set;let u=r.storage;if(!u)return e((...e)=>{a(...e)},n,s);const d=()=>{const e=r.partialize({...n()});return u.setItem(r.name,{state:e,version:r.version})},p=s.setState;s.setState=(e,t)=>(p(e,t),d());const h=e((...e)=>(a(...e),d()),n,s);let m;s.getInitialState=()=>h;const f=()=>{var e,t;if(!u)return;const s=++o;i=!1,l.forEach(e=>{var t;return e(null!=(t=n())?t:h)});const p=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=n())?e:h))||void 0;return Um(u.getItem.bind(u))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(s!==o)return;const[i,l]=e;return m=r.merge(l,null!=(t=n())?t:h),a(m,!0),i?d():void 0}).then(()=>{s===o&&(null==p||p(m,void 0),m=n(),i=!0,c.forEach(e=>e(m)))}).catch(e=>{s===o&&(null==p||p(void 0,e))})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>f(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},r.skipHydration||f(),m||h},Wm=n()(Gm(Fa(e=>({amigaLimits:!1,linearInterpolation:!0,masterTuning:440,performanceQuality:"high",audioLatency:"balanced",autoLatency:!0,midiPolyphonic:!0,setAmigaLimits:t=>e(e=>{e.amigaLimits=t}),setLinearInterpolation:t=>e(e=>{e.linearInterpolation=t}),setMasterTuning:t=>e(e=>{e.masterTuning=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setAudioLatency:t=>e(e=>{e.audioLatency=t}),setAutoLatency:t=>e(e=>{e.autoLatency=t}),setMidiPolyphonic:t=>e(e=>{e.midiPolyphonic=t})})),{name:"devilbox-settings",partialize:e=>({amigaLimits:e.amigaLimits,linearInterpolation:e.linearInterpolation,masterTuning:e.masterTuning,performanceQuality:e.performanceQuality,audioLatency:e.audioLatency,autoLatency:e.autoLatency,midiPolyphonic:e.midiPolyphonic})}));class Hm{static instance=null;static itFilterWorkletLoaded=!1;static itFilterWorkletPromise=null;masterInput;synthBus;masterEffectsInput;masterChannel;analyser;fft;_nativeContext=null;wasmInstance=null;instruments;instrumentSynthTypes=new Map;instrumentLoadingPromises=new Map;decodedAudioBuffers=new Map;liveVoiceAllocation=new Map;liveVoicePool=[];static LIVE_VOICE_BASE_CHANNEL=100;static MAX_LIVE_VOICES=16;activeVoices=new Map;masterEffectsNodes=[];masterEffectConfigs=new Map;channelOutputs=new Map;channelMuteStates=new Map;channelPitchState=new Map;channelActivePlayer=new Map;channelLastNote=new Map;static SLIDE_TIME_CONSTANT=.06;static ACCENT_BOOST=1.35;static MIDI_FREQ_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=440*Math.pow(2,(t-69)/12);return e})();static FILTER_CUTOFF_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=100*Math.pow(100,t/127);return e})();static PITCH_CENTS_CACHE=new Map;metronomeSynth=null;metronomeVolume=null;metronomeEnabled=!1;metronomePart=null;amigaFilter;amigaFilterEnabled=!0;instrumentEffectChains=new Map;instrumentEffectNodes=new Map;instrumentAnalysers=new Map;releaseRestoreTimeouts=new Map;preloadGeneration=0;constructor(){var e;this._nativeContext=new AudioContext({sampleRate:44100,latencyHint:"interactive"}),me(this._nativeContext),e=this._nativeContext,Zn=e,this.masterInput=new p(1),this.amigaFilter=new Lm,this.masterChannel=new fe({volume:-6,pan:0}).toDestination(),this.analyser=new pe("waveform",1024),this.fft=new he(1024),this.masterChannel.connect(this.analyser),this.masterChannel.connect(this.fft),this.masterEffectsInput=new p(1),this.masterInput.connect(this.amigaFilter),this.amigaFilter.connect(this.masterEffectsInput),this.masterEffectsInput.connect(this.masterChannel),this.synthBus=new p(1),this.synthBus.connect(this.masterEffectsInput),this.instruments=new Map,this.liveVoicePool=[];for(let t=0;t<Hm.MAX_LIVE_VOICES;t++)this.liveVoicePool.push(Hm.LIVE_VOICE_BASE_CHANNEL+t)}static getInstance(){return Hm.instance||(Hm.instance=new Hm),Hm.instance}get nativeContext(){return this._nativeContext}connectNativeSynth(e,t){const a=as(t);if(a)try{e.connect(a)}catch(n){}else if(t.input)try{e.connect(t.input)}catch(n){}}async decodeAudioData(e){if(e instanceof AudioBuffer)return e;if(e instanceof Uint8Array){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await k().rawContext.decodeAudioData(t)}if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer type: "+typeof e);return await k().rawContext.decodeAudioData(e.slice(0))}async encodeAudioData(e){return e.getChannelData(0).buffer.slice(0)}getDecodedBuffer(e){return this.decodedAudioBuffers.get(e)}getWasmInstance(){return this.wasmInstance}async init(){"suspended"===k().state&&await ge();const e=Wm.getState().audioLatency||"balanced";this.setAudioLatency(e),N().bpm.value=125;const t=this._nativeContext;"running"!==t.state&&await new Promise(e=>{const a=()=>{"running"===t.state?e():setTimeout(a,10)};a()});let a=null;const n=async()=>{if(a)return a;const e=await fetch("/DEViLBOX/DevilboxDSP.wasm");if(e.ok){a=await e.arrayBuffer();try{const e={env:{abort:()=>{}}},{instance:t}=await WebAssembly.instantiate(a,e);this.wasmInstance=t.exports,this.wasmInstance.init&&this.wasmInstance.init()}catch(t){}return a}return null};Hm.itFilterWorkletLoaded||(Hm.itFilterWorkletPromise||(Hm.itFilterWorkletPromise=(async()=>{try{const e="/DEViLBOX/";await t.audioWorklet.addModule(`${e}ITFilter.worklet.js`);const a=await n();if(a){const e=new AudioWorkletNode(t,"it-filter-processor");e.port.postMessage({type:"init",wasmBinary:a}),e.disconnect()}Hm.itFilterWorkletLoaded=!0}catch(e){e?.message?.includes("already")||e?.message?.includes("duplicate")||(Hm.itFilterWorkletPromise=null)}})()),await Hm.itFilterWorkletPromise);try{const e=_i.getInstance();await e.init(k())}catch(s){}}getContextState(){return k().state}async preloadInstruments(e){const t=++this.preloadGeneration;e.forEach(e=>{const t=this.getInstrumentKey(e.id,-1);this.instruments.has(t)&&this.disposeInstrument(e.id)});const a=e.filter(e=>"Sampler"===e.synthType||"Player"===e.synthType),n=e.filter(e=>"Sam"===e.synthType||"V2"===e.synthType&&e.v2Speech);e.filter(e=>"Sampler"!==e.synthType&&"Player"!==e.synthType&&"Sam"!==e.synthType&&!("V2"===e.synthType&&e.v2Speech)).forEach(e=>{this.getInstrument(e.id,e)}),a.forEach(e=>{this.getInstrument(e.id,e)});const s=[];if(n.forEach(e=>{const t=this.getInstrument(e.id,e);t?.ready&&s.push(t.ready())}),a.length>0)try{if(await ye(),t!==this.preloadGeneration)return;const e=Array.from(this.instrumentLoadingPromises.values());if(e.length>0&&(await Promise.all(e),t!==this.preloadGeneration))return}catch(o){}if(s.length>0)try{if(await Promise.all(s),t!==this.preloadGeneration)return}catch(o){}const r=e.filter(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType);if(r.length>0){const e=[];for(const t of r){const a=this.getInstrumentKey(t.id,-1),n=this.instruments.get(a);n?.ensureInitialized&&e.push(n.ensureInitialized())}if(e.length>0)try{if(await Promise.all(e),t!==this.preloadGeneration)return}catch(o){}}const i=["MetalSynth","MembraneSynth","NoiseSynth","FMSynth"];for(const c of e)if(i.includes(c.synthType||"")){const e=this.getInstrumentKey(c.id,-1),t=this.instruments.get(e);if(t&&!Yn(t))try{const e=t.volume.value;t.volume.value=-1/0,"NoiseSynth"===c.synthType||"MetalSynth"===c.synthType?t.triggerAttackRelease(.001,Q()):"MembraneSynth"===c.synthType?t.triggerAttackRelease("C2",.001,Q()):t.triggerAttackRelease?.("C4",.001,Q()),t.volume.value=e}catch(l){}}}async ensureWASMSynthsReady(e){const t=e.filter(e=>["TB303","Buzz3o3","V2","Sam","Synare","DubSiren","SpaceLaser","Dexed","OBXd"].includes(e.synthType||""));if(0===t.length)return;const a=[];for(const n of t){const e=this.getInstrument(n.id,n);e?.ensureInitialized&&a.push(e.ensureInitialized())}a.length>0&&await Promise.all(a)}setMasterVolume(e){this.masterChannel.volume.value=e}setMasterMute(e){this.masterChannel.mute=e}_currentLatency="";setAudioLatency(e){if(this._currentLatency===e)return;this._currentLatency=e;let t=.05;switch(e){case"interactive":t=.01;break;case"balanced":t=.05;break;case"playback":t=.15}k().lookAhead=t}setAmigaFilter(e){this.amigaFilterEnabled=e,this.amigaFilter.ledFilterEnabled=e}getAmigaFilterEnabled(){return this.amigaFilterEnabled}processInstrumentTicks(e=Q()){this.instruments.forEach(t=>{t&&"function"==typeof t.processTick&&t.processTick(e)})}setBPM(e){const t=N();"started"===t.state?t.bpm.rampTo(e,.02):t.bpm.value=e,this.updateBpmSyncedEffects(e)}getBPM(){return N().bpm.value}async start(){"suspended"===k().state&&await ge(),N().start()}stop(){this.releaseAll();const e=this.masterChannel.volume.value;this.masterChannel.volume.value=-1/0,setTimeout(()=>{this.masterChannel.volume.value=e},50),N().stop()}pause(){N().pause()}getPosition(){return N().position}setPosition(e){N().position=e}getInstrumentKey(e,t){return`${e}-${t??-1}`}lastTriggerTime=0;getSafeTime(e){if("running"!==be.state)return null;const t=null==e||isNaN(e)||e<=0?ve():Q();let a;return a=null!=e&&!isNaN(e)&&e>0?e:t+.001,a<=this.lastTriggerTime&&(a=this.lastTriggerTime+5e-4),this.lastTriggerTime=a,a}getImmediateTime(){let e=ve();return e<=this.lastTriggerTime&&(e=this.lastTriggerTime+1e-4),this.lastTriggerTime=e,e}getInstrument(e,t,a){const n=t.synthType?.startsWith("MAME")||"CZ101"===t.synthType||"CEM3394"===t.synthType||"SCSP"===t.synthType,s=t.synthType?.startsWith("Furnace")||"Furnace"===t.synthType,r=t.synthType?.startsWith("Buzz")||"Buzzmachine"===t.synthType,i=["TB303","V2","Sam","DubSiren","SpaceLaser","Synare","Dexed","OBXd","WAM"].includes(t.synthType||""),o=!i&&"string"==typeof t.synthType&&Tm.has(t.synthType),l="Sampler"===t.synthType||"Player"===t.synthType||n||s||r||i||o,c=l?this.getInstrumentKey(e,-1):this.getInstrumentKey(e,a);if(this.instruments.has(c))return this.instruments.get(c);const u=void 0!==a&&a>=Hm.LIVE_VOICE_BASE_CHANNEL,d=this.getInstrumentKey(e,-1);if(!l&&!u&&this.instruments.has(d))return this.instruments.get(d);let p;switch(t.synthType){case"Synth":const a="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:Y,maxPolyphony:a,options:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"MonoSynth":p=new Z({oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume||-12});break;case"DuoSynth":p=new J({voice0:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},vibratoAmount:t.oscillator?.detune?t.oscillator.detune/100:.5,vibratoRate:5,volume:t.volume||-12});break;case"FMSynth":const n="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?6:3;p=new X({voice:O,maxPolyphony:n,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},modulationIndex:10},volume:t.volume||-12});break;case"AMSynth":const s="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:ee,maxPolyphony:s,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"PluckSynth":const r="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:te,maxPolyphony:r,options:{attackNoise:1,dampening:t.filter?.frequency||4e3,resonance:.7},volume:t.volume||-12});break;case"MetalSynth":p=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??100)/1e3,sustain:0,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"MembraneSynth":p=new Y({oscillator:{type:"sine"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??400)/1e3,sustain:.01,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"NoiseSynth":{const e=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume??-12});if(t.filter&&"lowpass"!==t.filter.type){const a=new m({type:t.filter.type,frequency:t.filter.frequency,Q:t.filter.Q||1,rolloff:t.filter.rolloff||-12});e.connect(a),p={triggerAttackRelease:(t,a,n)=>{e.triggerAttackRelease(t,a,n)},triggerAttack:(t,a)=>{e.triggerAttack(t,a)},triggerRelease:t=>{e.triggerRelease(t)},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{e.dispose(),a.dispose()},volume:e.volume}}else p=e;break}case"TB303":case"SuperSaw":case"PolySynth":case"Organ":case"DrumMachine":case"ChipSynth":case"PWMSynth":case"StringMachine":case"FormantSynth":case"Wavetable":case"WobbleBass":case"Furnace":case"FurnaceOPN":case"FurnaceOPM":case"FurnaceOPL":case"FurnaceOPLL":case"FurnaceOPZ":case"FurnaceOPNA":case"FurnaceOPNB":case"FurnaceOPL4":case"FurnaceY8950":case"FurnaceESFM":case"FurnaceNES":case"FurnaceGB":case"FurnacePSG":case"FurnacePCE":case"FurnaceSNES":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceVRC7":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceSCC":case"FurnaceX1_010":case"FurnaceBUBBLE":case"FurnaceTIA":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":case"FurnaceOPN2203":case"FurnaceOPNBB":case"FurnaceAY8930":case"FurnaceNDS":case"FurnaceGBA":case"FurnacePOKEMINI":case"FurnaceNAMCO":case"FurnacePET":case"FurnacePOKEY":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceAMIGA":case"FurnacePCSPKR":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceZXBEEPER":case"FurnaceSCVTONE":case"FurnacePCMDAC":case"DrumKit":case"ChiptuneModule":case"Dexed":case"OBXd":case"MAMEVFX":case"MAMEDOC":case"MAMERSA":case"MAMESWP30":case"CZ101":case"CEM3394":case"SCSP":case"MAMEAICA":case"MAMEASC":case"MAMEAstrocade":case"MAMEC352":case"MAMEES5503":case"MAMEICS2115":case"MAMEK054539":case"MAMEMEA8000":case"MAMEMSM5232":case"MAMERF5C400":case"MAMESN76477":case"MAMESNKWave":case"MAMESP0250":case"MAMETIA":case"MAMETMS36XX":case"MAMETMS5220":case"MAMETR707":case"MAMEUPD931":case"MAMEUPD933":case"MAMEVotrax":case"MAMEYMF271":case"MAMEYMOPQ":case"MAMEVASynth":case"BuzzDTMF":case"BuzzFreqBomb":case"BuzzKick":case"BuzzKickXP":case"BuzzNoise":case"BuzzTrilok":case"Buzz4FM2F":case"BuzzDynamite6":case"BuzzM3":case"Buzz3o3":case"DubSiren":case"SpaceLaser":case"V2":case"Sam":case"Synare":case"WAM":case"Buzzmachine":p=Im.createInstrument(t);break;case"Sampler":{let a=t.parameters?.sampleUrl||t.sample?.url;const n=t.sample?.baseNote||"C4",s=!0===t.sample?.loop,r=t.sample?.loopStart||0,i=t.sample?.loopEnd||0,o=t.sample?.audioBuffer;if(a&&a.startsWith("blob:")&&(a=void 0),a&&(a=Ra(a)),o){let a=o;if("string"==typeof o)try{const e=atob(o),t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);a=t.buffer}catch(h){a=null}if(a){const o=t.metadata?.modPlayback?.usePeriodPlayback;if(o||s){p=new oe({loop:s,volume:t.volume||0}),this.instrumentSynthTypes.set(c,"Player");const n=a,o=p,l=(async()=>{try{const a=await this.decodeAudioData(n);if(o.buffer=new xe(a),s){const e=t.sample?.sampleRate||8363,n=a.duration;o.loopStart=Math.min(r/e,n-1e-4),o.loopEnd=Math.min(i/e,n),o.loopEnd<=o.loopStart&&(o.loopEnd=n)}this.decodedAudioBuffers.set(e,a)}catch(a){}})();this.instrumentLoadingPromises.set(c,l)}else{p=new ie({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"Sampler");const s=a,r=p,i=(async()=>{try{const t=await this.decodeAudioData(s),a=new xe(t);r.add(n,a),this.decodedAudioBuffers.set(e,t)}catch(t){}})();this.instrumentLoadingPromises.set(c,i)}}}if(!p&&a){const o=t.metadata?.modPlayback?.usePeriodPlayback;if(o||s){const n=new oe({url:a,loop:s,volume:t.volume||0,onload:()=>{if(s){const e=t.sample?.sampleRate||8363,a=n.buffer.get(),s=a?a.duration:0;s>0&&(n.loopStart=Math.min(r/e,s-1e-4),n.loopEnd=Math.min(i/e,s),n.loopEnd<=n.loopStart&&(n.loopEnd=s))}const a=n.buffer.get();a&&this.decodedAudioBuffers.set(e,a)},onerror:e=>{}});p=n,this.instrumentSynthTypes.set(c,"Player")}else{const e=t.sample?.multiMap||{};t.sample?.multiMap||(e[n]=a),p=new ie({urls:e,volume:t.volume||-12,onerror:e=>{}}),this.instrumentSynthTypes.set(c,"Sampler")}}p||(p=new ie({volume:t.volume||-12}));break}case"Player":{const e=t.parameters?.sampleUrl;p=new oe(e?{url:e,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{volume:t.volume||-12});break}case"GranularSynth":{const e=t.granular?.sampleUrl||t.parameters?.sampleUrl,a=t.granular;p=new le(e?{url:e,grainSize:(a?.grainSize||100)/1e3,overlap:(a?.grainOverlap||50)/100,playbackRate:a?.playbackRate||1,detune:a?.detune||0,reverse:a?.reverse||!1,loop:!0,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{grainSize:.1,overlap:.5,loop:!0,volume:t.volume||-12});break}default:if(Tm.has(t.synthType||"")){p=Im.createInstrument(t);break}return ji(t.synthType||"Unknown",`Unsupported synth type "${t.synthType}". This instrument cannot produce sound.`,{synthName:t.name,errorType:"init",debugData:{synthType:t.synthType,instrumentId:e}}),null}return p?(t.filter&&p.filter&&(p.filter.type=t.filter.type,p.filter.frequency.value=t.filter.frequency,p.filter.Q.value=t.filter.Q),this.instruments.set(c,p),this.instrumentSynthTypes.has(c)||this.instrumentSynthTypes.set(c,t.synthType),this.buildInstrumentEffectChain(c,t.effects||[],p).catch(e=>{}),p):null}getInstrumentAnalyser(e){let t=this.instrumentAnalysers.get(e);if(t)return t;t=new Vm;let a=this.masterInput;for(const[n,s]of this.instruments)if(n.startsWith(`${e}-`)){Yn(s)&&(a=this.synthBus);break}t.output.connect(a);return this.instrumentEffectChains.forEach((a,n)=>{const[s]=String(n).split("-");if(s===String(e)){try{a.output.disconnect(this.masterInput)}catch{}try{a.output.disconnect(this.synthBus)}catch{}a.output.connect(t.input)}}),this.instrumentAnalysers.set(e,t),t}disposeInstrumentAnalyser(e){const t=this.instrumentAnalysers.get(e);if(!t)return;const a=this.getInstrumentKey(e,-1);let n=this.instruments.get(a);if(!n)for(const[s,r]of this.instruments)if(s.startsWith(`${e}-`)){n=r;break}if(n){const e=Yn(n);try{e?n.output.disconnect():n.disconnect()}catch{}const t=this.instrumentEffectChains.get(a),s=t=>{e?this.connectNativeSynth(n.output,t):n.connect(t)};t?t.effects.length>0?s(t.effects[0]):s(t.output):s(e?this.synthBus:this.masterInput)}t.dispose(),this.instrumentAnalysers.delete(e)}disposeAllInstrumentAnalysers(){this.instrumentAnalysers.forEach((e,t)=>{this.disposeInstrumentAnalyser(t)})}applyAutomation(e,t,a,n){const s=this.getInstrumentKey(e,n),r=this.instruments.get(s);if(!r){const n=this.instruments.get(this.getInstrumentKey(e,-1));if(!n)return;return void this.applyAutomationToInstrument(n,t,a)}this.applyAutomationToInstrument(r,t,a)}applyAutomationToInstrument(e,t,a){const n=this.getSafeTime();if(null!==n)try{switch(t){case"cutoff":if(e instanceof ur){const t=200*Math.pow(100,a);e.setCutoff(t)}else if(e.filter){const t=200*Math.pow(100,a);e.filter.frequency.setValueAtTime(t,n)}break;case"resonance":e instanceof ur?e.setResonance(100*a):e.filter&&e.filter.Q.setValueAtTime(10*a,n);break;case"envMod":e instanceof ur&&e.setEnvMod(100*a);break;case"volume":const s=40*a-40;if(Yn(e)){const t=Math.pow(10,s/20);e.output.gain.setValueAtTime(t,n)}else e.volume&&e.volume.setValueAtTime(s,n);break;case"pan":const r=2*a-1;e.pan&&e.pan.setValueAtTime(r,n);break;case"decay":if(e instanceof ur){const t=30+2970*a;e.setDecay(t)}break;case"accent":e instanceof ur&&e.setAccentAmount(100*a);break;case"tuning":if(e instanceof ur){const t=200*(a-.5);e.setTuning(t)}break;case"overdrive":e instanceof ur&&e.setOverdrive(100*a);break;case"normalDecay":if(e instanceof ur){const t=30+2970*a;e.setNormalDecay(t)}break;case"accentDecay":if(e instanceof ur){const t=30+2970*a;e.setAccentDecay(t)}break;case"vegDecay":if(e instanceof ur){const t=16+2984*a;e.setVegDecay(t)}break;case"vegSustain":e instanceof ur&&e.setVegSustain(100*a);break;case"softAttack":if(e instanceof ur){const t=.3*Math.pow(100,a);e.setSoftAttack(t)}break;case"filterTracking":e instanceof ur&&e.setFilterTracking(200*a);break;case"filterFM":e instanceof ur&&e.setFilterFM(100*a);break;case"distortion":case"delay":case"reverb":break;default:e instanceof Cm?e.setParameter(t,a):"function"==typeof e.setParam&&e.setParam(t,a)}}catch(s){}}applySlideAndAccent(e,t,a,n,s,r,i,o){let l=n;if(s&&(l=Math.min(1,n*Hm.ACCENT_BOOST)),r&&void 0!==i){const n=this.channelLastNote.get(i);if(n&&n.frequency>0){let s=null;if(e.oscillator?.frequency?s=e.oscillator.frequency:e.voice0?.oscillator?.frequency?s=e.voice0.oscillator.frequency:e.frequency&&(s=e.frequency),s)try{s.setValueAtTime(n.frequency,a),s.setTargetAtTime(t,a,Hm.SLIDE_TIME_CONSTANT)}catch(c){}}}return void 0!==i&&void 0!==o&&this.channelLastNote.set(i,{frequency:t,time:a,instrumentId:o}),l}triggerNoteAttack(e,t,a,n=1,s,r,i,o,l,c){const u=this.getInstrument(e,s,l);if(!u)return;if(!(u.triggerAttack||u.start))return;const d=s.isLive?this.getImmediateTime():this.getSafeTime(a);if(null!==d)try{if(u instanceof ur)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,n,i,o);else if(u instanceof ur)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,n,i,o,c);else if("NoiseSynth"===s.synthType)u.triggerAttack(d,n);else if("Sampler"===s.synthType){const a=this.getInstrumentKey(e,void 0);if("Player"===this.instrumentSynthTypes.get(a)){const e=u;if(!e.buffer||!e.buffer.loaded)return;const a=n>0?we(n):-1/0;if(e.volume.value=a,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let a=r;if(0!==t.finetune){const e=jm(r,0);e>=0&&(a=Rm(e,t.finetune))}const n=t.periodMultiplier/a,i=n/(s.sample?.sampleRate||8363);e.playbackRate=i}else{const a=s.sample?.baseNote||"C4",n=ce(a).toFrequency(),r=ce(t).toFrequency()/n;e.playbackRate=r}e.start(d)}else{const e=u;if(!e.loaded)return;e.triggerAttack(t,d,n)}}else if("Player"===s.synthType||"GranularSynth"===s.synthType){const e=u;if(!e.buffer||!e.buffer.loaded)return;const a=n>0?we(n):-1/0;if(e.volume.value=a,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let a=r;if(0!==t.finetune){const e=jm(r,0);e>=0&&(a=Rm(e,t.finetune))}const n=t.periodMultiplier/a,i=n/(s.sample?.sampleRate||8363);e.playbackRate=i}else{const a=s.sample?.baseNote||"C4",n=ce(a).toFrequency(),r=ce(t).toFrequency()/n;e.playbackRate=r}e.start(d)}else if("NoiseSynth"===s.synthType){const e=u,t=i?Math.min(1,n*Hm.ACCENT_BOOST):n;e.triggerAttack(d,t)}else if("MetalSynth"===s.synthType){const e=u,t=i?Math.min(1,n*Hm.ACCENT_BOOST):n;e.triggerAttack(d,t)}else if("MembraneSynth"===s.synthType){const e=u,a=i?Math.min(1,n*Hm.ACCENT_BOOST):n;e.triggerAttack(t,d,a)}else if("BuzzmachineGenerator"===u.constructor.name)u.triggerAttack(t,d,n,i,o);else if(u instanceof Cm)u.triggerAttack(t,d,n);else{const a=ce(t).toFrequency(),s=this.applySlideAndAccent(u,a,d,n,i,o,l,e);u.triggerAttack(t,d,s)}}catch(p){}}triggerNoteRelease(e,t,a,n,s){const r=this.getInstrument(e,n,s);if(!r||!r.triggerRelease)return;const i=n.isLive?this.getImmediateTime():this.getSafeTime(a);if(null!==i)try{if("Sampler"===n.synthType){const e=r;if(!e.loaded)return;return void e.triggerRelease(t,i)}if("Player"===n.synthType||"GranularSynth"===n.synthType){const e=r;return void("started"===e.state&&e.stop(i))}"NoiseSynth"===n.synthType||"MonoSynth"===n.synthType||"DuoSynth"===n.synthType||"MetalSynth"===n.synthType||"MembraneSynth"===n.synthType||"TB303"===n.synthType||"DubSiren"===n.synthType||"Synare"===n.synthType||"Furnace"===n.synthType||"BuzzKick"===n.synthType||"BuzzKickXP"===n.synthType||"BuzzNoise"===n.synthType||"BuzzTrilok"===n.synthType||"Buzz4FM2F"===n.synthType||"BuzzDynamite6"===n.synthType||"BuzzM3"===n.synthType||"Buzz3o3"===n.synthType||"SpaceLaser"===n.synthType||"Sam"===n.synthType||"V2"===n.synthType||"V2Speech"===n.synthType||"MAMEVFX"===n.synthType||"MAMEDOC"===n.synthType||"MAMERSA"===n.synthType||"MAMESWP30"===n.synthType||"CZ101"===n.synthType||"CEM3394"===n.synthType||"SCSP"===n.synthType||n.synthType.startsWith("MAME")?r.triggerRelease(i):r.triggerRelease(t,i)}catch(o){}}static NATIVE_POLY_TYPES=new Set(["Synth","FMSynth","AMSynth","PluckSynth","Sampler","SuperSaw","PolySynth","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth","Wavetable","WobbleBass"]);triggerPolyNoteAttack(e,t,a,n,s=!1,r=!1){!0===n.monophonic&&(r||this.releaseAllPolyNotes(e,n));const i=n.synthType;if((!i||Hm.NATIVE_POLY_TYPES.has(i))&&!0!==n.monophonic){this.liveVoiceAllocation.set(t,-1);const i=n.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,i,a,n,void 0,s,r)}if("TB303"===i||"Buzz3o3"===i){r||this.releaseAllPolyNotes(e,n),this.liveVoiceAllocation.set(t,-1);const i=n.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,i,a,n,void 0,s,r)}if(this.liveVoiceAllocation.has(t)&&(r||this.triggerPolyNoteRelease(e,t,n)),0===this.liveVoicePool.length)return;const o=this.liveVoicePool.shift();this.liveVoiceAllocation.set(t,o);const l=this.getImmediateTime();this.triggerNoteAttack(e,t,l,a,n,void 0,s,r,o)}triggerPolyNoteRelease(e,t,a){const n=this.liveVoiceAllocation.get(t);if(void 0===n)return;this.liveVoiceAllocation.delete(t);const s=a.isLive?this.getImmediateTime():0;-1===n?this.triggerNoteRelease(e,t,s,a):(this.triggerNoteRelease(e,t,s,a,n),this.liveVoicePool.push(n))}releaseAllPolyNotes(e,t){for(const[a,n]of this.liveVoiceAllocation.entries())-1===n?this.triggerNoteRelease(e,a,0,t):(this.triggerNoteRelease(e,a,0,t,n),this.liveVoicePool.push(n));this.liveVoiceAllocation.clear()}hasActivePolyNotes(){return this.liveVoiceAllocation.size>0}releaseNote(e,t,a,n){const s=this.getInstrumentKey(e,n);let r=this.instruments.get(s);if(r||(r=this.instruments.get(this.getInstrumentKey(e,-1))),!r)return;const i=this.getSafeTime(a);if(null===i)return;const o=this.instrumentSynthTypes.get(s)||this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if("Sampler"===o){const e=r;if(e.loaded&&e.triggerRelease)try{e.triggerRelease(t,i)}catch{}return}if("Player"===o||"GranularSynth"===o){const e=r;if("started"===e.state)try{e.stop(i)}catch{}return}if(!r.triggerRelease)return;const l="MonoSynth"===o||"DuoSynth"===o||"MetalSynth"===o||"MembraneSynth"===o||"NoiseSynth"===o||"TB303"===o||"Buzz3o3"===o||"BuzzKick"===o||"BuzzKickXP"===o||"BuzzNoise"===o||"BuzzTrilok"===o||"Buzz4FM2F"===o||"BuzzDynamite6"===o||"BuzzM3"===o||"DubSiren"===o||"Synare"===o;try{l?r.triggerRelease(i):r.triggerRelease(t,i)}catch{try{r.triggerRelease(i)}catch{}}}triggerNote(e,t,a,n,s=1,r,i,o,l,c,u,d=0,p){const h=this.getSafeTime(n);if(null===h)return;const m=this.getInstrument(e,r,l);if(m){if(void 0!==l){let a,n=this.activeVoices.get(l)||[];0===d?(n.forEach(e=>{e.instrument!==m&&this.stopVoice(e,h)}),n=n.filter(e=>e.instrument===m)):n.forEach(e=>{2===d&&e.volumeEnv.keyOff(),3===d&&(e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024))}),"Sampler"===r.synthType||"Player"===r.synthType?(a=new oe(m.buffer),a.loop=m.loop,a.loopStart=m.loopStart,a.loopEnd=m.loopEnd):a="Synth"===r.synthType?new Y(m.get()):m;const p=n.findIndex(e=>e.instrument===a);if(p>=0)n[p].note=t;else{const e=this.createVoice(l,a,t,r);Yn(a)||a.connect(e.nodes.gain),n.push(e)}this.activeVoices.set(l,n);try{if(a instanceof oe){const e=s>0?we(s):-1/0;if(a.volume.value=e,r.metadata?.modPlayback?.usePeriodPlayback&&c){const e=r.metadata.modPlayback.periodMultiplier/c,t=r.sample?.sampleRate||8363;a.playbackRate=e/t}else{const e=r.sample?.baseNote||"C4",n=ce(e).toFrequency(),s=ce(t).toFrequency()/n;a.playbackRate=s}const n=u?u/(a.buffer.sampleRate||44100):0;a.start(h,n)}else if(a.triggerAttack){if(Yn(a)){const e=a.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}if("NoiseSynth"===r.synthType||"MetalSynth"===r.synthType){const e=i?Math.min(1,s*Hm.ACCENT_BOOST):s;a.triggerAttack(h,e)}else if(a instanceof ur)a.triggerAttack(t,h,s,i,o);else if(a instanceof ur)a.triggerAttack(t,h,s,i,o);else{const n=ce(t).toFrequency(),r=this.applySlideAndAccent(a,n,h,s,i,o,l,e);a.triggerAttack(t,h,r)}}}catch(f){}return}if(Yn(m)){const e=m.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}try{if(m instanceof ur)m.triggerAttackRelease(t,a,h,s,i,o);else if(m instanceof ur)m.triggerAttackRelease(t,a,h,s,i,o,p);else if("NoiseSynth"===r.synthType)m.triggerAttackRelease(a,h,s);else if("MetalSynth"===r.synthType)m.triggerAttackRelease(a,h,s);else if("MembraneSynth"===r.synthType)m.triggerAttackRelease(t,a,h,s);else if("GranularSynth"===r.synthType){const e=m;if(e.buffer&&e.buffer.loaded){const n=s>0?we(s):-1/0;if(e.volume.value=n,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let a=c;if(0!==t.finetune){const e=jm(c,0);e>=0&&(a=Rm(e,t.finetune))}const n=t.periodMultiplier/a,s=n/(r.sample?.sampleRate||8363);e.playbackRate=s*(r.granular?.playbackRate||1)}else{const a=ce("C4").toFrequency(),n=ce(t).toFrequency()/a;e.playbackRate=n*(r.granular?.playbackRate||1)}e.start(h),e.stop(h+a)}}else if("Player"===r.synthType||"Sampler"===r.synthType&&r.sample?.loop||"Sampler"===r.synthType&&r.metadata?.modPlayback?.usePeriodPlayback){const e=m;if(e.buffer&&e.buffer.loaded){const n=i?Math.min(1,s*Hm.ACCENT_BOOST):s,o=n>0?we(n):-1/0;if(e.volume.value=o,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let a=c;if(0!==t.finetune){const e=jm(c,0);e>=0&&(a=Rm(e,t.finetune))}const n=t.periodMultiplier/a,s=n/(r.sample?.sampleRate||8363);e.playbackRate=s}else if(r.metadata?.modPlayback?.usePeriodPlayback&&!c);else{const a=ce("C4").toFrequency(),n=ce(t).toFrequency()/a;e.playbackRate=n}const d=u&&u>0?u/(e.buffer?.sampleRate||k().sampleRate):0;if(e.loop){if(void 0!==l){const t=this.channelActivePlayer.get(l);t&&"started"===t.state&&t.stop(h),this.channelActivePlayer.set(l,e)}e.start(h,d)}else e.start(h,d),e.stop(h+a)}}else if("Sampler"!==r.synthType||r.sample?.loop){if("SuperSaw"===r.synthType||"PolySynth"===r.synthType||"Organ"===r.synthType||"ChipSynth"===r.synthType||"PWMSynth"===r.synthType||"StringMachine"===r.synthType||"FormantSynth"===r.synthType){if(m.triggerAttackRelease){const n=ce(t).toFrequency(),r=this.applySlideAndAccent(m,n,h,s,i,o,l,e);m.triggerAttackRelease(t,a,h,r)}}else if(m instanceof Cm)m.triggerAttackRelease(t,a,h,s);else if("DrumMachine"===r.synthType){if(m.triggerAttackRelease){const e=i?Math.min(1,s*Hm.ACCENT_BOOST):s;m.triggerAttackRelease(t,a,h,e)}}else if(m.triggerAttackRelease){const n=ce(t).toFrequency(),r=this.applySlideAndAccent(m,n,h,s,i,o,l,e);m.triggerAttackRelease(t,a,h,r)}}else{const e=m;if(e.loaded)if(u&&u>0){const n=r.sample?.baseNote||"C4",i=e._buffers?.get(n)||e._buffers?._buffers?.[n];if(i&&i.duration){const o=256*u/(i.sampleRate||k().sampleRate),l=Math.min(o,i.duration-.001);try{const e=new oe({url:i,volume:we(s)+(r.volume||-12)}).toDestination(),o=ce(n).toFrequency(),c=ce(t).toFrequency()/o;e.playbackRate=c,e.start(h,l),e.stop(h+a),N().scheduleOnce(()=>{e.dispose()},h+a+.1)}catch(f){e.triggerAttackRelease(t,a,h,s)}}else e.triggerAttackRelease(t,a,h,s)}else e.triggerAttackRelease(t,a,h,s)}}catch(g){}}}schedulePatternEvents(e,t){N().cancel(),e.forEach(e=>{N().schedule(t=>{this.triggerNote(e.instrumentId,e.note,e.duration,t,e.velocity,e.config)},e.time)})}clearSchedule(){N().cancel()}releaseAll(){const e=Q();this.instruments.forEach((t,a)=>{try{if(t instanceof oe||t instanceof le?"started"===t.state&&t.stop(e):t instanceof ur?t.releaseAll():t.releaseAll?t.releaseAll(e):Yn(t)&&t.triggerRelease&&t.triggerRelease(void 0,e),t.volume&&"function"==typeof t.volume.rampTo){const n=t.volume.value;t.volume.rampTo(-1/0,.05,e);const s=this.releaseRestoreTimeouts.get(a);s&&clearTimeout(s);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(a);try{t.volume&&(t.volume.value=n)}catch{}},100);this.releaseRestoreTimeouts.set(a,r)}else if(Yn(t)){const n=t.output.gain,s=this.releaseRestoreTimeouts.get(a);s&&clearTimeout(s),n.cancelScheduledValues(e),n.setValueAtTime(n.value||1,e),n.linearRampToValueAtTime(0,e+.05);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(a);try{n.cancelScheduledValues(0),n.value=1}catch{}},100);this.releaseRestoreTimeouts.set(a,r)}}catch(n){}}),this.channelPitchState.clear(),this.channelActivePlayer.clear()}disposeInstrumentByKey(e){const t=this.instruments.get(e);if(t){this.instruments.delete(e),this.instrumentSynthTypes.delete(e),this.instrumentLoadingPromises.delete(e);try{t.disposed||(t.releaseAll?t.releaseAll():t.triggerRelease&&t.triggerRelease())}catch(a){}this.disposeInstrumentEffectChain(e);try{t.disposed||t.dispose()}catch(a){}}}disposeInstrument(e){const t=[];this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&t.push(n)}),t.forEach(e=>{this.disposeInstrumentByKey(e)})}invalidateInstrument(e){this.disposeInstrument(e)}updateInstrument(e,t){this.disposeInstrument(e),this.getInstrument(e,t)}async previewSlice(e,t,a){await ge();const n=(await _a(()=>Promise.resolve().then(()=>_g),void 0).then(e=>e.useInstrumentStore.getState())).instruments.find(t=>t.id===e),s=n?.sample?.audioBuffer,r=n?.sample?.url;if(s||r)try{let e;if(s)e=await this.decodeAudioData(s);else{const t=await fetch(r),a=await t.arrayBuffer();e=await this.decodeAudioData(a)}const n=e.sampleRate,i=a-t;if(i<=0)return;const o=be.createBuffer(e.numberOfChannels,i,n);for(let a=0;a<e.numberOfChannels;a++){const n=e.getChannelData(a),s=o.getChannelData(a);for(let e=0;e<i;e++)s[e]=n[t+e]}const l=new oe(o).toDestination();l.start();setTimeout(()=>{try{l.stop(),l.dispose()}catch{}},i/n*1e3+100)}catch(i){}}async bakeInstrument(e,t=2,a="C4"){return await ke(async()=>{const t=Im.createInstrument(e);if(e.effects&&e.effects.length>0){const a=await Im.createEffectChain(e.effects);let n;if(Yn(t)){const e=new p(1),a=as(e);a&&t.output.connect(a),n=e}else n=t;let s=n;for(const e of a)s.connect(e),s=e;s.toDestination()}else if(Yn(t)){const e=new p(1),a=as(e);a&&t.output.connect(a),e.toDestination()}else t.toDestination();t.triggerAttack&&(t.triggerAttack(a,0),t.triggerRelease&&t.triggerRelease(1))},t)}updateWAMParameters(e,t){const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t instanceof Cm&&a.push(t)}),0!==a.length?a.forEach(e=>{t.parameterValues&&Object.entries(t.parameterValues).forEach(([t,a])=>{e.setParameter(t,a)}),t.pluginState&&e.setPluginState(t.pluginState)}):this.invalidateInstrument(e)}updateTB303Parameters(e,t){const a=[];if(this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t instanceof ur&&a.push(t)}),0===a.length)return void this.invalidateInstrument(e);const n=200,s=2e3,r=(e,t,a)=>{if(e>=0&&e<=1)return e;const n=Math.max(t,Math.min(a,e));return Math.log(n/t)/Math.log(a/t)},i=e=>e>=0&&e<=1?e:Math.max(0,Math.min(1,e/100));a.forEach(e=>{if(void 0!==t.tuning&&e.setTuning(t.tuning),void 0!==t.volume&&e.setVolume(t.volume),t.filter&&(e.setCutoff(r(t.filter.cutoff,314,2394)),e.setResonance(i(t.filter.resonance))),t.filterEnvelope&&(e.setEnvMod(i(t.filterEnvelope.envMod)),e.setDecay(r(t.filterEnvelope.decay,n,s))),t.accent&&e.setAccentAmount(i(t.accent.amount)),t.slide&&e.setSlideTime(r(t.slide.time,2,360)),t.overdrive&&e.setOverdrive(i(t.overdrive.amount)),t.oscillator){const a=void 0!==t.oscillator.waveformBlend?t.oscillator.waveformBlend:"square"===t.oscillator.type?1:0;e.setWaveform(a),void 0!==t.oscillator.pulseWidth&&e.setPulseWidth(i(t.oscillator.pulseWidth)),void 0!==t.oscillator.subOscGain&&e.setSubOscGain(i(t.oscillator.subOscGain)),void 0!==t.oscillator.subOscBlend&&e.setSubOscBlend(i(t.oscillator.subOscBlend)),void 0!==t.oscillator.pitchToPw&&e.setPitchToPw(t.oscillator.pitchToPw)}if(t.devilFish?.enabled){const a=t.devilFish;if(e.enableDevilFish(!0),e.setNormalDecay(r(a.normalDecay,n,s)),e.setAccentDecay(r(a.accentDecay,n,s)),e.setSoftAttack(i(a.softAttack)),void 0!==a.accentSoftAttack&&e.setAccentSoftAttack(i(a.accentSoftAttack)),e.setVegDecay(r(a.vegDecay,n,s)),e.setVegSustain(i(a.vegSustain)),e.setFilterTracking(i(a.filterTracking)),e.setFilterFmDepth(i(a.filterFmDepth)),void 0!==a.filterInputDrive&&e.setFilterInputDrive(i(a.filterInputDrive)),void 0!==a.passbandCompensation&&e.setPassbandCompensation(1-i(a.passbandCompensation)),void 0!==a.resTracking){const t=i(a.resTracking);e.setResTracking(1-t),e.setKorgIbiasScale(.1+3.9*t)}void 0!==a.duffingAmount&&e.setDuffingAmount(i(a.duffingAmount)),void 0!==a.lpBpMix&&e.setLpBpMix(i(a.lpBpMix)),void 0!==a.filterSelect&&e.setFilterSelect(a.filterSelect),void 0!==a.diodeCharacter&&e.setDiodeCharacter(i(a.diodeCharacter)),void 0!==a.stageNLAmount&&"function"==typeof e.setStageNLAmount&&e.setStageNLAmount(i(a.stageNLAmount)),void 0!==a.ensembleAmount&&"function"==typeof e.setEnsembleAmount&&e.setEnsembleAmount(i(a.ensembleAmount)),void 0!==a.oversamplingOrder&&"function"==typeof e.setOversamplingOrder&&e.setOversamplingOrder(a.oversamplingOrder),void 0!==a.korgBite&&e.setKorgBite(a.korgBite),void 0!==a.korgClip&&e.setKorgClip(a.korgClip),void 0!==a.korgCrossmod&&e.setKorgCrossmod(a.korgCrossmod),void 0!==a.korgQSag&&e.setKorgQSag(a.korgQSag),void 0!==a.korgSharpness&&e.setKorgSharpness(a.korgSharpness),"function"==typeof e.setMuffler&&e.setMuffler(a.muffler),"function"==typeof e.setHighResonance&&e.setHighResonance(a.highResonance)}else t.devilFish&&e.enableDevilFish(!1);if(t.lfo&&(e.setLfoWaveform(t.lfo.waveform),e.setLfoRate(t.lfo.rate),e.setLfoContour(t.lfo.contour),e.setLfoPitchDepth(t.lfo.pitchDepth),e.setLfoPwmDepth(t.lfo.pwmDepth),e.setLfoFilterDepth(t.lfo.filterDepth),void 0!==t.lfo.stiffDepth&&e.setLfoStiffDepth(t.lfo.stiffDepth)),t.chorus){e.setChorusMode(t.chorus.mode);const a=i(t.chorus.mix);e.setChorusMix(t.chorus.enabled?a:0)}if(t.phaser){e.setPhaserRate(i(t.phaser.rate)),e.setPhaserWidth(i(t.phaser.depth)),e.setPhaserFeedback(i(t.phaser.feedback));const a=i(t.phaser.mix);e.setPhaserMix(t.phaser.enabled?a:0)}t.delay&&(e.setDelayTime(t.delay.time>1?t.delay.time/2e3:t.delay.time),e.setDelayFeedback(i(t.delay.feedback)),e.setDelayTone(i(t.delay.tone)),e.setDelayMix(t.delay.enabled?i(t.delay.mix):0),e.setDelaySpread(i(t.delay.stereo)))})}updateFurnaceInstrument(e,t){if(!t.furnace||!t.synthType?.startsWith("Furnace"))return;const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t.uploadInstrumentData&&a.push(t)}),0!==a.length?_a(async()=>{const{updateFurnaceInstrument:e}=await import("./FurnaceInstrumentEncoder-DUItTP_3.js");return{updateFurnaceInstrument:e}},[]).then(({updateFurnaceInstrument:e})=>{const n=t.furnace.furnaceIndex??0,s=e(t.furnace,t.name,n);a.forEach(e=>{e.uploadInstrumentData(s)})}).catch(e=>{}):this.invalidateInstrument(e)}getMAMESynthHandle(e){const t=this.getInstrumentKey(e,-1),a=this.instruments.get(t);return a instanceof gr?a.getHandle():0}getMAMEChipSynth(e){const t=this.getInstrumentKey(e,-1),a=this.instruments.get(t);if(a instanceof Ar)return a;for(const[n,s]of this.instruments)if(n.startsWith(`${e}-`)&&s instanceof Ar)return s;return null}updateMAMEParameters(e,t){const a=this.getInstrumentKey(e,-1);this.instruments.get(a)}updateMAMEChipParam(e,t,a){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);s&&"function"==typeof s.setParam&&s.setParam(t,a)}loadMAMEChipPreset(e,t){const a=this.getInstrumentKey(e,-1),n=this.instruments.get(a);n&&"function"==typeof n.loadPreset&&n.loadPreset(t)}updateMAMEChipTextParam(e,t,a){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);s&&("function"==typeof s.setTextParam?s.setTextParam(t,a):"function"==typeof s.applyConfig&&s.applyConfig({[t]:a}))}loadSynthROM(e,t,a,n){const s=this.getInstrumentKey(e,-1),r=this.instruments.get(s);if(!r)return;const i=r;"MAMERSA"===t?"function"==typeof i.loadROM&&i.loadROM(a,n):"MAMESWP30"===t?"function"==typeof i.loadWaveROM&&i.loadWaveROM(n.buffer):"function"==typeof i.loadROM?i.loadROM(a,n):"function"==typeof i.setRom&&i.setRom(a,n)}updateDubSirenParameters(e,t){let a=!1;this.instruments.forEach((n,s)=>{const[r]=s.split("-");r===String(e)&&n&&"function"==typeof n.applyConfig&&(n.applyConfig(t),a=!0)})}updateSpaceLaserParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateV2Parameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");if(s===String(e)&&a&&"V2Synth"===a.name){const e=a;t.osc1&&(e.setParameter(2,t.osc1.mode),e.setParameter(4,t.osc1.transpose+64),e.setParameter(5,t.osc1.detune+64),e.setParameter(6,t.osc1.color),e.setParameter(7,t.osc1.level)),t.osc2&&(e.setParameter(8,t.osc2.mode),e.setParameter(9,t.osc2.ringMod?1:0),e.setParameter(10,t.osc2.transpose+64),e.setParameter(11,t.osc2.detune+64),e.setParameter(12,t.osc2.color),e.setParameter(13,t.osc2.level)),t.osc3&&(e.setParameter(14,t.osc3.mode),e.setParameter(15,t.osc3.ringMod?1:0),e.setParameter(16,t.osc3.transpose+64),e.setParameter(17,t.osc3.detune+64),e.setParameter(18,t.osc3.color),e.setParameter(19,t.osc3.level)),t.filter1&&(e.setParameter(20,t.filter1.mode),e.setParameter(21,t.filter1.cutoff),e.setParameter(22,t.filter1.resonance)),t.filter2&&(e.setParameter(23,t.filter2.mode),e.setParameter(24,t.filter2.cutoff),e.setParameter(25,t.filter2.resonance)),t.routing&&(e.setParameter(26,t.routing.mode),e.setParameter(27,t.routing.balance)),t.envelope&&(e.setParameter(32,t.envelope.attack),e.setParameter(33,t.envelope.decay),e.setParameter(34,t.envelope.sustain),e.setParameter(36,t.envelope.release)),t.envelope2&&(e.setParameter(38,t.envelope2.attack),e.setParameter(39,t.envelope2.decay),e.setParameter(40,t.envelope2.sustain),e.setParameter(42,t.envelope2.release)),t.lfo1&&(e.setParameter(47,t.lfo1.rate),e.setParameter(50,t.lfo1.depth))}})}updateSynareParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateFurnaceParameters(e,t){this.instruments.forEach((t,a)=>{const[n]=a.split("-");n===String(e)&&t&&"function"==typeof t.updateParameters&&t.updateParameters()})}applyFurnaceEffect(e,t,a,n=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,i]of this.instruments){const[s]=r.split("-");if(s===String(e)){if(i instanceof Zi)return i.applyEffect(t,a,n),!0;if(i instanceof Li)return this.applyFurnaceSynthEffect(i,t,a),!0}}return!1}applyFurnaceExtendedEffect(e,t,a,n=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,i]of this.instruments){const[s]=r.split("-");if(s===String(e)&&i instanceof Zi)return i.applyExtendedEffect(t,a,n),!0}return!1}applyFurnaceSynthEffect(e,t,a){const n=a>>4&15,s=15&a,r=e.getChipType();8!==t?this.isFMChip(r)?this.applyFMEffect(e,t,a,n,s):this.isPSGChip(r)?this.applyPSGEffect(e,t,a,r):this.isWavetableChip(r)?this.applyWavetableEffect(e,t,a,r):this.isC64Chip(r)&&this.applyC64Effect(e,t,a):e.writePanRegister(a)}isFMChip(e){return[Ei.OPN2,Ei.OPM,Ei.OPL3,Ei.OPLL,Ei.OPNA,Ei.OPNB,Ei.OPZ,Ei.Y8950,Ei.OPL4,Ei.OPN,Ei.OPNB_B,Ei.ESFM].includes(e)}isPSGChip(e){return[Ei.NES,Ei.GB,Ei.PSG,Ei.AY,Ei.AY8930,Ei.SAA,Ei.VIC,Ei.TED].includes(e)}isWavetableChip(e){return[Ei.PCE,Ei.SCC,Ei.SWAN,Ei.N163,Ei.NAMCO,Ei.FDS,Ei.BUBBLE,Ei.X1_010,Ei.SM8521].includes(e)}isC64Chip(e){return[Ei.SID,Ei.SID_6581,Ei.SID_8580].includes(e)}applyFMEffect(e,t,a,n,s){switch(t){case 17:e.writeOperatorTL(n,8*s);break;case 18:e.writeOperatorAR(n,2*s);break;case 19:e.writeOperatorDR(n,2*s);break;case 20:e.writeOperatorMult(n,s);break;case 21:e.writeOperatorRR(n,s);break;case 22:e.writeOperatorSL(n,s)}}applyPSGEffect(e,t,a,n){switch(n){case Ei.GB:17===t?e.writeWavetableSelect(a):18===t&&e.writeDutyRegister(3&a);break;case Ei.NES:18===t&&e.writeDutyRegister(a>>6&3)}}applyWavetableEffect(e,t,a,n){switch(n){case Ei.PCE:18===t&&e.writeWavetableSelect(a);break;case Ei.SCC:case Ei.N163:case Ei.NAMCO:16===t&&e.writeWavetableSelect(a);break;case Ei.FDS:break;case Ei.SWAN:case Ei.SM8521:case Ei.BUBBLE:case Ei.X1_010:16!==t&&17!==t||e.writeWavetableSelect(a)}}applyC64Effect(e,t,a){16!==t&&18!==t||e.writeDutyRegister(a)}updateDexedParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateOBXdParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateComplexSynthParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateBuzzmachineParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.setParameter&&Object.entries(t.parameters).forEach(([e,t])=>{a.setParameter(Number(e),t)})})}async updateTB303Pedalboard(e,t){if(!t)return;const a=[];if(this.instruments.forEach((t,n)=>{n.startsWith(`${e}-`)&&t instanceof ur&&a.push(t)}),0===a.length)return;const n=t.enabled&&t.chain.some(e=>e.enabled&&"neural"===e.type);for(const r of a)if(n){const e=t.chain.find(e=>e.enabled&&"neural"===e.type);if(e&&void 0!==e.modelIndex)try{await r.loadGuitarMLModel(e.modelIndex),await r.setGuitarMLEnabled(!0),void 0!==e.parameters?.dryWet&&r.setGuitarMLMix(e.parameters.dryWet)}catch(s){}}else try{await r.setGuitarMLEnabled(!1)}catch(s){}}updateChipSynthArpeggio(e,t){t&&this.instruments.forEach((a,n)=>{n.startsWith(`${e}-`)&&a.updateArpeggio&&a.updateArpeggio(t)})}getChipSynthArpeggioStep(e){for(const[t,a]of this.instruments.entries())if(t.startsWith(`${e}-`)&&a.getCurrentArpeggioStep)return a.getCurrentArpeggioStep();return 0}isChipSynthArpeggioPlaying(e){for(const[t,a]of this.instruments.entries())if(t.startsWith(`${e}-`)&&a.isArpeggioPlaying)return a.isArpeggioPlaying();return!1}initMetronome(){this.metronomeSynth||(this.metronomeSynth=new ne({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}),this.metronomeVolume=new p(.5),this.metronomeSynth.connect(this.metronomeVolume),this.metronomeVolume.connect(this.masterChannel))}setMetronomeEnabled(e){this.metronomeEnabled=e,e&&this.initMetronome()}isMetronomeEnabled(){return this.metronomeEnabled}setMetronomeVolume(e){this.metronomeVolume||this.initMetronome();const t=Math.max(0,Math.min(1,e/100));this.metronomeVolume?.set({gain:t})}triggerMetronomeClick(e,t=!1){if(!this.metronomeEnabled||!this.metronomeSynth)return;const a=t?"C5":"C4",n=t?.8:.5;this.metronomeSynth.triggerAttackRelease(a,"32n",e,n)}stopMetronome(){this.metronomePart&&(this.metronomePart.stop(),this.metronomePart.dispose(),this.metronomePart=null)}disposeMetronome(){this.stopMetronome(),this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.metronomeVolume&&(this.metronomeVolume.dispose(),this.metronomeVolume=null)}dispose(){this.stop(),this.clearSchedule(),this.disposeMetronome(),this.disposeAllInstrumentAnalysers(),this.instrumentEffectChains.forEach((e,t)=>{e.effects.forEach(e=>{try{e.dispose()}catch(t){}});try{e.output.dispose()}catch(a){}}),this.instrumentEffectChains.clear(),this.instrumentEffectNodes.clear(),this.instruments.forEach((e,t)=>{try{e.dispose()}catch(a){}}),this.instruments.clear(),this.disposeChannelOutputs(),this.masterEffectsNodes.forEach(e=>{try{e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.analyser.dispose(),this.fft.dispose(),this.amigaFilter.dispose(),this.synthBus.dispose(),this.masterEffectsInput.dispose(),this.masterInput.dispose(),this.masterChannel.dispose(),Hm.instance=null}async buildInstrumentEffectChain(e,t,a){const n=this.instrumentEffectChains.get(e);if(n){for(const[e,t]of this.instrumentEffectNodes)n.effects.includes(t.node)&&this.instrumentEffectNodes.delete(e);if(n.effects.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),n.bridge)try{n.bridge.disconnect(),n.bridge.dispose()}catch{}n.output.disconnect(),n.output.dispose()}const s=new p(1),r=Yn(a),i=e=>{r?this.connectNativeSynth(a.output,e):a.connect(e)},o=t.filter(e=>e.enabled);if(0===o.length){i(s);const[t]=String(e).split("-"),a=parseInt(t),n=this.instrumentAnalysers.get(a);return n?s.connect(n.input):s.connect(r?this.synthBus:this.masterInput),void this.instrumentEffectChains.set(e,{effects:[],output:s})}const l=await Promise.all(o.map(e=>Im.createEffect(e)));let c;if(l.length>0){r?(c=new p(1),i(c),c.connect(l[0])):a.connect(l[0]);for(let e=0;e<l.length-1;e++)l[e].connect(l[e+1]);l[l.length-1].connect(s)}else i(s);const[u]=String(e).split("-"),d=parseInt(u),h=this.instrumentAnalysers.get(d);h?s.connect(h.input):s.connect(r?this.synthBus:this.masterInput),this.instrumentEffectChains.set(e,{effects:l,output:s,bridge:c}),o.forEach((e,t)=>{this.instrumentEffectNodes.set(e.id,{node:l[t],config:e})})}async rebuildInstrumentEffects(e,t){const a=this.getInstrumentKey(e,-1),n=this.instruments.get(a);if(n){try{Yn(n)?n.output.disconnect():n.disconnect()}catch(s){}await this.buildInstrumentEffectChain(a,t,n)}}throwInstrumentToEffect(e,t,a=1,n=0){const s=[];this.instrumentEffectChains.forEach((t,a)=>{const[n]=String(a).split("-");n===String(e)&&s.push(t)}),0!==s.length&&s.forEach(e=>{const s=e.effects.find(e=>e._fxType===t);if(s&&s.wet){const e=s.wet,t=ve();e.cancelScheduledValues(t),e.rampTo(a,.01,t),n>0&&e.rampTo(0,.1,t+n/1e3)}})}disposeInstrumentEffectChain(e){const t=this.instrumentEffectChains.get(e);if(t){t.effects.forEach(e=>{try{e.dispose()}catch{}});try{t.output.dispose()}catch{}this.instrumentEffectChains.delete(e)}}async rebuildMasterEffects(e){const t=JSON.parse(JSON.stringify(e));this.masterEffectsInput.disconnect(),this.masterEffectsNodes.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear();const a=t.filter(e=>e.enabled);if(0===a.length)return void this.masterEffectsInput.connect(this.masterChannel);(await Promise.all(a.map(e=>Im.createEffect(e)))).forEach((e,t)=>{this.masterEffectsNodes.push(e),this.masterEffectConfigs.set(a[t].id,{node:e,config:a[t]})}),this.masterEffectsInput.connect(this.masterEffectsNodes[0]);for(let n=0;n<this.masterEffectsNodes.length-1;n++)this.masterEffectsNodes[n].connect(this.masterEffectsNodes[n+1]);this.masterEffectsNodes[this.masterEffectsNodes.length-1].connect(this.masterChannel)}updateMasterEffectParams(e,t){const a=this.masterEffectConfigs.get(e);if(!a)return;const{node:n}=a,s=t.wet/100;try{"wet"in n&&n.wet instanceof A&&(n.wet.value=s),this.applyEffectParameters(n,t),a.config=t}catch(r){}}updateInstrumentEffectParams(e,t){const a=this.instrumentEffectNodes.get(e);if(!a)return;const{node:n}=a,s=t.wet/100;try{"wet"in n&&n.wet instanceof A&&(n.wet.value=s),this.applyEffectParameters(n,t),a.config=t}catch(r){}}applyEffectParameters(e,t){const a=t.parameters;switch(t.type){case"Distortion":e instanceof b&&(e.distortion=a.drive??.4,e.oversample=a.oversample??"none");break;case"Reverb":break;case"Delay":case"FeedbackDelay":e instanceof _&&(e.delayTime.value=a.time??.25,e.feedback.value=a.feedback??.5);break;case"Chorus":e instanceof q&&(e.frequency.value=a.frequency??1.5,e.depth=a.depth??.7);break;case"Phaser":e instanceof w&&(e.frequency.value=a.frequency??.5,e.octaves=a.octaves??3);break;case"Tremolo":e instanceof $&&(e.frequency.value=a.frequency??10,e.depth.value=a.depth??.5);break;case"Vibrato":e instanceof K&&(e.frequency.value=a.frequency??5,e.depth.value=a.depth??.1);break;case"BitCrusher":e instanceof U&&(e.bits.value=a.bits??4);break;case"PingPongDelay":e instanceof B&&(e.delayTime.value=a.time??.25,e.feedback.value=a.feedback??.5);break;case"PitchShift":e instanceof L&&(e.pitch=a.pitch??0);break;case"Compressor":e instanceof S&&(e.threshold.value=a.threshold??-24,e.ratio.value=a.ratio??12,e.attack.value=a.attack??.003,e.release.value=a.release??.25);break;case"EQ3":e instanceof f&&(e.low.value=a.low??0,e.mid.value=a.mid??0,e.high.value=a.high??0);break;case"Filter":e instanceof m&&(e.frequency.value=a.frequency??350,e.Q.value=a.Q??1);break;case"AutoFilter":e instanceof H&&(e.frequency.value=a.frequency??1,e.baseFrequency=a.baseFrequency??200,e.octaves=a.octaves??2.6);break;case"AutoPanner":e instanceof W&&(e.frequency.value=a.frequency??1,e.depth.value=a.depth??1);break;case"StereoWidener":e instanceof R&&(e.width.value=a.width??.5);break;case"SpaceyDelayer":e instanceof qr&&(null!=a.firstTap&&e.setFirstTap(Number(a.firstTap)),null!=a.tapSize&&e.setTapSize(Number(a.tapSize)),null!=a.feedback&&e.setFeedback(Number(a.feedback)),null!=a.multiTap&&e.setMultiTap(Number(a.multiTap)),null!=a.tapeFilter&&e.setTapeFilter(Number(a.tapeFilter)));break;case"RETapeEcho":e instanceof Jr&&(null!=a.mode&&e.setMode(Number(a.mode)),null!=a.repeatRate&&e.setRepeatRate(Number(a.repeatRate)),null!=a.intensity&&e.setIntensity(Number(a.intensity)),null!=a.echoVolume&&e.setEchoVolume(Number(a.echoVolume)),null!=a.wow&&e.setWow(Number(a.wow)),null!=a.flutter&&e.setFlutter(Number(a.flutter)),null!=a.dirt&&e.setDirt(Number(a.dirt)),null!=a.inputBleed&&e.setInputBleed(Number(a.inputBleed)),null!=a.loopAmount&&e.setLoopAmount(Number(a.loopAmount)),null!=a.playheadFilter&&e.setPlayheadFilter(Number(a.playheadFilter)));break;case"SpaceEcho":e instanceof Gr&&(null!=a.mode&&e.setMode(Number(a.mode)),null!=a.rate&&e.setRate(Number(a.rate)),null!=a.intensity&&e.setIntensity(Number(a.intensity)),null!=a.echoVolume&&e.setEchoVolume(Number(a.echoVolume)),null!=a.reverbVolume&&e.setReverbVolume(Number(a.reverbVolume)),null!=a.bass&&e.setBass(Number(a.bass)),null!=a.treble&&e.setTreble(Number(a.treble)));break;case"BiPhase":e instanceof ei&&(null!=a.rateA&&(e.rateA=Number(a.rateA)),null!=a.depthA&&(e.depthA=Number(a.depthA)),null!=a.rateB&&(e.rateB=Number(a.rateB)),null!=a.depthB&&(e.depthB=Number(a.depthB)),null!=a.feedback&&(e.feedback=Number(a.feedback)));break;case"DubFilter":e instanceof ti&&(null!=a.cutoff&&(e.cutoff=Number(a.cutoff)),null!=a.resonance&&(e.resonance=Number(a.resonance)),null!=a.gain&&(e.gain=Number(a.gain)));break;case"MoogFilter":e instanceof si&&(null!=a.cutoff&&e.setCutoff(Number(a.cutoff)),null!=a.resonance&&e.setResonance(Number(a.resonance)),null!=a.drive&&e.setDrive(Number(a.drive)),null!=a.model&&e.setModel(Number(a.model)),null!=a.filterMode&&e.setFilterMode(Number(a.filterMode)));break;case"MVerb":e instanceof oi&&(null!=a.damping&&e.setDamping(Number(a.damping)),null!=a.density&&e.setDensity(Number(a.density)),null!=a.bandwidth&&e.setBandwidth(Number(a.bandwidth)),null!=a.decay&&e.setDecay(Number(a.decay)),null!=a.predelay&&e.setPredelay(Number(a.predelay)),null!=a.size&&e.setSize(Number(a.size)),null!=a.gain&&e.setGain(Number(a.gain)),null!=a.mix&&e.setMix(Number(a.mix)),null!=a.earlyMix&&e.setEarlyMix(Number(a.earlyMix)));break;case"Leslie":e instanceof pi&&(null!=a.speed&&e.setSpeed(Number(a.speed)),null!=a.hornRate&&e.setHornRate(Number(a.hornRate)),null!=a.drumRate&&e.setDrumRate(Number(a.drumRate)),null!=a.hornDepth&&e.setHornDepth(Number(a.hornDepth)),null!=a.drumDepth&&e.setDrumDepth(Number(a.drumDepth)),null!=a.doppler&&e.setDoppler(Number(a.doppler)),null!=a.mix&&e.setMix(Number(a.mix)),null!=a.width&&e.setWidth(Number(a.width)),null!=a.acceleration&&e.setAcceleration(Number(a.acceleration)));break;case"SpringReverb":e instanceof fi&&(null!=a.decay&&e.setDecay(Number(a.decay)),null!=a.damping&&e.setDamping(Number(a.damping)),null!=a.tension&&e.setTension(Number(a.tension)),null!=a.mix&&e.setSpringMix(Number(a.mix)),null!=a.drip&&e.setDrip(Number(a.drip)),null!=a.diffusion&&e.setDiffusion(Number(a.diffusion)))}}updateBpmSyncedEffects(e){this.masterEffectConfigs.forEach(({node:t,config:a})=>{if(!Si(a.parameters))return;const n=wi[a.type];if(!n)return;const s=Mi(a.parameters);for(const r of n){const n=ki(e,s,r.unit);this.applyBpmSyncedParam(t,a.type,r.param,n)}});try{const{useInstrumentStore:t}=require("../stores/useInstrumentStore"),a=t.getState().instruments;this.instrumentEffectChains.forEach((t,n)=>{const s="number"==typeof n?n:Number(String(n).split("-")[0]),r=a.find(e=>e.id===s);if(!r?.effects)return;r.effects.filter(e=>e.enabled).forEach((a,n)=>{if(n>=t.effects.length)return;if(!Si(a.parameters))return;const s=wi[a.type];if(!s)return;const r=Mi(a.parameters),i=t.effects[n];for(const t of s){const n=ki(e,r,t.unit);this.applyBpmSyncedParam(i,a.type,t.param,n)}})})}catch{}}applyBpmSyncedParam(e,t,a,n){try{switch(t){case"Delay":case"FeedbackDelay":"time"===a&&e instanceof _&&e.delayTime.rampTo(n,.02);break;case"PingPongDelay":"time"===a&&e instanceof B&&e.delayTime.rampTo(n,.02);break;case"SpaceEcho":"rate"===a&&e instanceof Gr&&e.setRate(n);break;case"SpaceyDelayer":"firstTap"===a&&e instanceof qr&&e.setFirstTap(n);break;case"RETapeEcho":"repeatRate"===a&&e instanceof Jr&&e.setRepeatRate(n);break;case"Chorus":"frequency"===a&&e instanceof q&&e.frequency.rampTo(n,.02);break;case"BiPhase":"rateA"===a&&e instanceof ei&&(e.rateA=n)}}catch(s){}}getChannelOutput(e){if(!this.channelOutputs.has(e)){const t=new p(1),a=new fe({volume:0,pan:0}),n=new M({smoothing:.8});t.connect(a),a.connect(n),a.connect(this.masterInput),this.channelOutputs.set(e,{input:t,channel:a,meter:n})}return this.channelOutputs.get(e).input}createVoice(e,t,a,n){const s=this.channelOutputs.get(e);if(!s)throw new Error(`Channel ${e} not initialized`);const r=new p(1);let i;if("IT"===n.metadata?.importedFrom&&Hm.itFilterWorkletLoaded){const e=this._nativeContext;i=new AudioWorkletNode(e,"it-filter-processor")}else i=new m({type:"lowpass",frequency:2e4,Q:0,rolloff:-12});const o=new ue(0);i instanceof m?(r.connect(i),i.connect(o)):(r.connect(i),x(i,o)),o.connect(s.input);const l=n.metadata?.envelopes?.[n.id],c=new Bm,u=new Bm,d=new Bm;return l?.volumeEnvelope&&c.init(l.volumeEnvelope),l?.panningEnvelope&&u.init(l.panningEnvelope),l?.pitchEnvelope&&d.init(l.pitchEnvelope),{instrument:t,note:a,volumeEnv:c,panningEnv:u,pitchEnv:d,fadeout:65536,fadeoutStep:n.metadata?.modPlayback?.fadeout||0,isKeyOff:!1,isFilterEnvelope:"filter"===l?.pitchEnvelope?.type,lastCutoff:127,lastResonance:0,nodes:{gain:r,filter:i,panner:o}}}stopVoice(e,t){e.instrument.stop?e.instrument.stop(t):e.instrument.triggerRelease&&e.instrument.triggerRelease(t),setTimeout(()=>{e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()},100)}setChannelVolume(e,t){const a=this.activeVoices.get(e);if(a&&a.length>0){const e=Q(),n=t<=-60?0:Math.pow(10,t/20);for(const t of a)t.nodes.gain&&t.nodes.gain.gain.setValueAtTime(n,e)}this.channelOutputs.get(e)}setChannelFilterCutoff(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1];n.lastCutoff=t;const s=n.lastResonance,r=n.nodes.filter,i=Q();if(t>=127&&0===s||255===t)r instanceof m?(r.frequency.setValueAtTime(24e3,i),r.Q.setValueAtTime(0,i)):r instanceof AudioWorkletNode&&(r.parameters.get("cutoff")?.setValueAtTime(127,i),r.parameters.get("resonance")?.setValueAtTime(0,i));else if(r instanceof m){const e=100*Math.pow(100,t/127);r.frequency.setValueAtTime(e,i)}else r instanceof AudioWorkletNode&&r.parameters.get("cutoff")?.setValueAtTime(t,i)}setChannelFilterResonance(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1];n.lastResonance=t;const s=n.lastCutoff,r=n.nodes.filter,i=Q();if(r instanceof m){const e=t/127*(t/127)*25;r.Q.setValueAtTime(e,i)}else r instanceof AudioWorkletNode&&r.parameters.get("resonance")?.setValueAtTime(t,i);t>0&&s>=127&&this.setChannelFilterCutoff(e,s)}setChannelPan(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=(t??0)/100;a[a.length-1].nodes.panner.pan.setValueAtTime(n,Q())}setChannelFunkRepeat(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1].instrument;if(n instanceof oe&&n.loop){if(0===t)return;if(n.buffer.loaded){const e=n._originalLoopStart??n.loopStart;void 0===n._originalLoopStart&&(n._originalLoopStart=n.loopStart);const a=t/128*(n.loopEnd-e);n.loopStart=e+a}}}handlePastNoteAction(e,t){const a=this.activeVoices.get(e);if(!a||a.length<=1)return;const n=a.slice(0,a.length-1),s=a[a.length-1];0===t?(n.forEach(e=>this.stopVoice(e,Q())),this.activeVoices.set(e,[s])):2===t?n.forEach(e=>e.volumeEnv.keyOff()):3===t&&n.forEach(e=>{e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024)})}setChannelPitch(e,t){const a=this.channelPitchState.get(e);if(!a)return;a.currentPitchMult=t;const n=this.activeVoices.get(e);if(!n||0===n.length){const e=this.instruments.get(a.instrumentKey);if(!e)return;return void this.applyPitchToNode(e,t,a.basePlaybackRate,a.instrumentKey)}const s=n[n.length-1];this.applyPitchToNode(s.instrument,t,a.basePlaybackRate,a.instrumentKey)}applyPitchToNode(e,t,a,n){const s=this.instrumentSynthTypes.get(n),r=1200*Math.log2(t);e instanceof oe||e instanceof le?e.playbackRate=a*t:"Sampler"===s?void 0!==e.detune&&(e.detune.value=r):void 0!==e.detune&&e.detune instanceof A?e.detune.value=r:void 0!==e.oscillator?.detune?e.oscillator.detune.value=r:void 0!==e.detune&&(e.detune=r)}setChannelFrequency(e,t){const a=this.channelPitchState.get(e);if(!a||0===a.baseFrequency)return;const n=t/a.baseFrequency;this.setChannelPitch(e,n)}initChannelPitch(e,t,a,n=1){this.channelPitchState.set(e,{instrumentKey:t,basePlaybackRate:n,baseFrequency:a,currentPitchMult:1})}clearChannelPitch(e){this.channelPitchState.get(e)&&(this.setChannelPitch(e,1),this.channelPitchState.delete(e))}setChannelMute(e,t){this.channelOutputs.has(e)||this.getChannelOutput(e);const a=this.channelOutputs.get(e);a&&(a.channel.mute=t)}updateMuteStates(e){const t=e.some(e=>e.solo);e.forEach((e,a)=>{const n=t?!e.solo:e.muted;this.channelMuteStates.set(a,n),this.setChannelMute(a,n)})}isChannelMuted(e){return this.channelMuteStates.get(e)??!1}disposeChannelOutputs(){this.channelOutputs.forEach((e,t)=>{try{e.meter.dispose()}catch(a){}try{e.channel.dispose()}catch(a){}try{e.input.dispose()}catch(a){}}),this.channelOutputs.clear()}getChannelLevels(e){const t=[];for(let a=0;a<e;a++){const e=this.channelOutputs.get(a);if(e){const a=e.meter.getValue(),n=Math.max(0,Math.min(1,(a+60)/60));t.push(n)}else t.push(0)}return t}channelTriggerLevels=new Map;triggerLevelsCache=[];triggerChannelMeter(e,t){this.channelTriggerLevels.set(e,Math.min(1,1.2*t))}getChannelTriggerLevels(e){this.triggerLevelsCache.length!==e&&(this.triggerLevelsCache=new Array(e).fill(0));for(let t=0;t<e;t++){const e=this.channelTriggerLevels.get(t)||0;this.triggerLevelsCache[t]=e,e>0&&this.channelTriggerLevels.set(t,0)}return this.triggerLevelsCache}getWaveform(){return this.analyser.getValue()}getFFT(){return this.fft.getValue()}currentPerformanceQuality="high";setPerformanceQuality(e){if(this.currentPerformanceQuality===e)return;this.currentPerformanceQuality=e,this.instruments.forEach((t,a)=>{t instanceof ur&&t.setQuality(e)});const t=[];this.instruments.forEach((e,a)=>{if(e&&"object"==typeof e&&"maxPolyphony"in e){const e=a.split("-"),n=parseInt(e[0],10),s="-1"===e[1]?void 0:parseInt(e[1],10),r=this.instrumentSynthTypes.get(a);r&&["Synth","FMSynth","AMSynth","PluckSynth"].includes(r)&&t.push({key:a,instrumentId:n,channelIndex:s,config:{synthType:r}})}}),t.length>0&&t.forEach(({key:e})=>{const t=this.instruments.get(e);if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(a){}this.instruments.delete(e),this.instrumentSynthTypes.delete(e)})}updateChannelEnvelopes(e){const t=this.activeVoices.get(e),a=this.channelOutputs.get(e);if(!t||0===t.length||!a)return;const n=Q(),s=a.channel.pan.value;let r=0;const i=t.length;for(let o=0;o<i;o++){const e=t[o],a=e.volumeEnv.tickNext();e.isKeyOff&&e.fadeout>0&&(e.fadeout=Math.max(0,e.fadeout-e.fadeoutStep));const i=a/64*(e.fadeout/65536);e.nodes.gain.gain.setValueAtTime(i,n);const l=e.panningEnv.tickNext();if(32!==l){const t=(l-32)/32,a=Math.max(-1,Math.min(1,s+t));e.nodes.panner.pan.setValueAtTime(a,n)}const c=e.pitchEnv.tickNext();if(e.pitchEnv.isEnabled())if(e.isFilterEnvelope){const t=e.lastCutoff,a=c-32,s=Math.max(0,Math.min(127,t+a));if(e.nodes.filter instanceof m){const t=Hm.FILTER_CUTOFF_LUT[s];e.nodes.filter.frequency.setValueAtTime(t,n)}else e.nodes.filter instanceof AudioWorkletNode&&e.nodes.filter.parameters.get("cutoff")?.setValueAtTime(s,n)}else{const t=(c-32)/32*12;void 0!==e.instrument.detune&&(e.instrument.detune.value=100*t)}e.isKeyOff&&e.fadeout<=0||e.volumeEnv.isFinished()&&e.isKeyOff?(e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()):t[r++]=e}r>0?t.length=r:this.activeVoices.delete(e)}setChannelKeyOff(e){const t=this.activeVoices.get(e);t&&t.forEach(e=>{e.isKeyOff=!0,e.volumeEnv.keyOff(),e.panningEnv.keyOff(),e.pitchEnv.keyOff()})}getPerformanceQuality(){return this.currentPerformanceQuality}}const Km=()=>Hm.getInstance(),$m=Object.freeze(Object.defineProperty({__proto__:null,ToneEngine:Hm,getToneEngine:Km},Symbol.toStringTag,{value:"Module"}));let qm=0;const Xm={generate:(e="id")=>(qm++,`${e}-${qm}-${Date.now()}`),reset(){qm=0}},Ym=16,Qm=31,Zm=(e,t)=>0!==(e&t),Jm=(e,t)=>e^t,ef=(e=64,t=4)=>({id:Xm.generate("pattern"),name:"Untitled Pattern",length:e,channels:Array.from({length:t},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,rows:Array.from({length:e},()=>({...an})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}),tf=n()(Fa((e,t)=>({patterns:[ef()],currentPatternIndex:0,cursor:{channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},selection:null,clipboard:null,trackClipboard:null,followPlayback:!1,showGhostPatterns:!0,columnVisibility:{...tn},copyMask:Qm,pasteMask:Qm,transposeMask:1,macroSlots:Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),insertMode:!1,currentOctave:4,recordMode:!1,editStep:1,multiRecEnabled:!1,multiEditEnabled:!1,multiRecChannels:Array(16).fill(!0),multiKeyJazz:!1,recQuantEnabled:!1,recQuantRes:16,recReleaseEnabled:!1,keyOnTab:Array(16).fill(0),keyOffTime:Array(16).fill(0),keyOffCounter:0,ptnJumpPos:[0,0,0,0],patternOrder:[0],currentPositionIndex:0,originalModuleData:null,setCurrentPattern:t=>e(e=>{t>=0&&t<e.patterns.length&&(e.currentPatternIndex=t)}),moveCursor:t=>e(e=>{const a=e.patterns[e.currentPatternIndex],n=a.channels.length,s=a.length,r=e.cursor.rowIndex,i=e.cursor.channelIndex,o=e.cursor.columnType,l=e.cursor.digitIndex,c={instrument:2,volume:2,effTyp:1,effParam:2,effTyp2:1,effParam2:2,cutoff:2,resonance:2,envMod:2,pan:2,probability:2},u=c[e.cursor.columnType]||0;switch(t){case"up":e.cursor.rowIndex>0?e.cursor.rowIndex--:e.cursor.rowIndex=s-1;break;case"down":e.cursor.rowIndex<s-1?e.cursor.rowIndex++:e.cursor.rowIndex=0;break;case"left":{if(u>0&&e.cursor.digitIndex>0){e.cursor.digitIndex--;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],a=t.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}if(a>0){e.cursor.columnType=t[a-1];const n=c[e.cursor.columnType]||0;e.cursor.digitIndex=n>0?n-1:0}else{e.cursor.channelIndex>0?e.cursor.channelIndex--:e.cursor.channelIndex=n-1,e.cursor.columnType=t[t.length-1];const a=c[e.cursor.columnType]||0;e.cursor.digitIndex=a>0?a-1:0}break}case"right":{if(u>0&&e.cursor.digitIndex<u-1){e.cursor.digitIndex++;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],a=t.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}a<t.length-1?(e.cursor.columnType=t[a+1],e.cursor.digitIndex=0):(e.cursor.channelIndex<n-1?e.cursor.channelIndex++:e.cursor.channelIndex=0,e.cursor.columnType="note",e.cursor.digitIndex=0);break}}if(e.cursor.rowIndex===r&&e.cursor.channelIndex===i&&e.cursor.columnType===o&&e.cursor.digitIndex===l)return e}),moveCursorToRow:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.length&&(e.cursor.rowIndex=t)}),moveCursorToChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&(e.cursor.channelIndex=t)}),moveCursorToColumn:t=>e(e=>{e.cursor.columnType=t,e.cursor.digitIndex=0}),setCell:(t,a,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex];t>=0&&t<s.channels.length&&a>=0&&a<s.length&&Object.assign(s.channels[t].rows[a],n)}),clearCell:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&a>=0&&a<n.length&&(n.channels[t].rows[a]={...an})}),clearChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&(a.channels[t].rows=a.channels[t].rows.map(()=>({...an})))}),clearPattern:()=>e(e=>{e.patterns[e.currentPatternIndex].channels.forEach(e=>{e.rows=e.rows.map(()=>({...an}))})}),insertRow:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length&&a>=0&&a<n.length){const e=n.channels[t].rows;for(let t=n.length-1;t>a;t--)e[t]={...e[t-1]};e[a]={...an}}}),deleteRow:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length&&a>=0&&a<n.length){const e=n.channels[t].rows;for(let t=a;t<n.length-1;t++)e[t]={...e[t+1]};e[n.length-1]={...an}}}),setFollowPlayback:t=>e(e=>{e.followPlayback=t}),setShowGhostPatterns:t=>e(e=>{e.showGhostPatterns=t}),setColumnVisibility:t=>e(e=>{Object.assign(e.columnVisibility,t)}),setCopyMask:t=>e(e=>{e.copyMask=t&Qm}),setPasteMask:t=>e(e=>{e.pasteMask=t&Qm}),setTransposeMask:t=>e(e=>{e.transposeMask=t&Qm}),toggleMaskBit:(t,a)=>e(e=>{"copy"===t?e.copyMask=Jm(e.copyMask,a):"paste"===t?e.pasteMask=Jm(e.pasteMask,a):"transpose"===t&&(e.transposeMask=Jm(e.transposeMask,a))}),setCurrentOctave:t=>e(e=>{e.currentOctave=Math.max(1,Math.min(7,t))}),toggleRecordMode:()=>e(e=>{e.recordMode=!e.recordMode}),setEditStep:t=>e(e=>{e.editStep=Math.max(0,Math.min(16,t))}),toggleInsertMode:()=>e(e=>{e.insertMode=!e.insertMode}),setMultiRecEnabled:t=>e(e=>{e.multiRecEnabled=t}),setMultiEditEnabled:t=>e(e=>{e.multiEditEnabled=t}),toggleMultiRecChannel:t=>e(e=>{t>=0&&t<e.multiRecChannels.length&&(e.multiRecChannels[t]=!e.multiRecChannels[t])}),setMultiKeyJazz:t=>e(e=>{e.multiKeyJazz=t}),setRecQuantEnabled:t=>e(e=>{e.recQuantEnabled=t}),setRecQuantRes:t=>e(e=>{[1,2,4,8,16].includes(t)&&(e.recQuantRes=t)}),setRecReleaseEnabled:t=>e(e=>{e.recReleaseEnabled=t}),setKeyOn:(t,a)=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOnTab[t]=a)}),setKeyOff:t=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOffCounter++,e.keyOnTab[t]=0,e.keyOffTime[t]=e.keyOffCounter)}),findBestChannel:()=>{const e=t(),a=e.patterns[e.currentPatternIndex],n=a?.channels.length||1;if(!e.multiRecEnabled&&!e.multiEditEnabled)return e.cursor.channelIndex;let s=e.cursor.channelIndex,r=1/0;for(let t=0;t<n;t++)e.multiRecChannels[t]&&0===e.keyOnTab[t]&&e.keyOffTime[t]<r&&(s=t,r=e.keyOffTime[t]);return s},resetKeyTracking:()=>e(e=>{e.keyOnTab=e.keyOnTab.map(()=>0),e.keyOffTime=e.keyOffTime.map(()=>0),e.keyOffCounter=0}),setPtnJumpPos:(t,a)=>e(e=>{t>=0&&t<4&&(e.ptnJumpPos[t]=a)}),getPtnJumpPos:e=>{const a=t();return e>=0&&e<4?a.ptnJumpPos[e]:0},startSelection:()=>e(e=>{e.selection={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,columnTypes:[e.cursor.columnType]}}),updateSelection:(t,a)=>e(e=>{e.selection&&(e.selection.endChannel=t,e.selection.endRow=a)}),endSelection:()=>e(e=>{e.selection&&(e.selection.endChannel=e.cursor.channelIndex,e.selection.endRow=e.cursor.rowIndex)}),clearSelection:()=>e(e=>{e.selection=null}),selectColumn:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:n.length-1,columnTypes:[a]}}),selectChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:a.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),selectPattern:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];e.selection={startChannel:0,endChannel:t.channels.length-1,startRow:0,endRow:t.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),copySelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r),u=[];for(let d=i;d<=o;d++){const e=[];for(let a=l;a<=c;a++)e.push({...t.channels[d].rows[a]});u.push(e)}e.clipboard={channels:o-i+1,rows:c-l+1,data:u}}),cutSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r),u=[];for(let d=i;d<=o;d++){const e=[];for(let a=l;a<=c;a++)e.push({...t.channels[d].rows[a]}),t.channels[d].rows[a]={...an};u.push(e)}e.clipboard={channels:o-i+1,rows:c-l+1,data:u},e.selection=null}),paste:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let i=0;i<s.length;i++){const e=a+i;if(e>=t.channels.length)break;for(let a=0;a<s[i].length;a++){const o=n+a;if(o>=t.length)break;const l=s[i][a],c=t.channels[e].rows[o];Zm(r,1)&&(c.note=l.note),Zm(r,2)&&(c.instrument=l.instrument),Zm(r,4)&&(c.volume=l.volume),Zm(r,8)&&(c.effTyp=l.effTyp,c.eff=l.eff),Zm(r,Ym)&&(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteMix:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let i=0;i<s.length;i++){const e=a+i;if(e>=t.channels.length)break;for(let a=0;a<s[i].length;a++){const o=n+a;if(o>=t.length)break;const l=s[i][a],c=t.channels[e].rows[o];Zm(r,1)&&0!==l.note&&0===c.note&&(c.note=l.note),Zm(r,2)&&0!==l.instrument&&0===c.instrument&&(c.instrument=l.instrument),Zm(r,4)&&0!==l.volume&&0===c.volume&&(c.volume=l.volume),!Zm(r,8)||0===l.effTyp&&0===l.eff||0!==c.effTyp||0!==c.eff||(c.effTyp=l.effTyp,c.eff=l.eff),!Zm(r,Ym)||0===l.effTyp2&&0===l.eff2||0!==c.effTyp2||0!==c.eff2||(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteFlood:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,i=s[0]?.length||0;if(0!==i)for(let o=0;o<s.length;o++){const e=a+o;if(e>=t.channels.length)break;let l=n;for(;l<t.length;){for(let a=0;a<s[o].length;a++){const n=l+a;if(n>=t.length)break;const i=s[o][a],c=t.channels[e].rows[n];Zm(r,1)&&(c.note=i.note),Zm(r,2)&&(c.instrument=i.instrument),Zm(r,4)&&(c.volume=i.volume),Zm(r,8)&&(c.effTyp=i.effTyp,c.eff=i.eff),Zm(r,Ym)&&(c.effTyp2=i.effTyp2,c.eff2=i.eff2)}l+=i}}}),pastePushForward:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,i=s[0]?.length||0;if(0!==i)for(let o=0;o<s.length;o++){const e=a+o;if(e>=t.channels.length)break;const l=t.channels[e];for(let a=t.length-1;a>=n+i;a--){const e=a-i;e>=n&&(l.rows[a]={...l.rows[e]})}for(let a=0;a<s[o].length;a++){const e=n+a;if(e>=t.length)break;const i=s[o][a],c=l.rows[e];c.note=0,c.instrument=0,c.volume=0,c.effTyp=0,c.eff=0,c.effTyp2=0,c.eff2=0,Zm(r,1)&&(c.note=i.note),Zm(r,2)&&(c.instrument=i.instrument),Zm(r,4)&&(c.volume=i.volume),Zm(r,8)&&(c.effTyp=i.effTyp,c.eff=i.eff),Zm(r,Ym)&&(c.effTyp2=i.effTyp2,c.eff2=i.eff2)}}}),copyTrack:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t];e.trackClipboard=n.rows.map(e=>({...e}))}),cutTrack:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t];e.trackClipboard=n.rows.map(e=>({...e})),n.rows=n.rows.map(()=>({...an}))}),pasteTrack:t=>e(e=>{if(!e.trackClipboard)return;const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t],{pasteMask:s}=e,r=Math.min(e.trackClipboard.length,a.length);for(let t=0;t<r;t++){const a=e.trackClipboard[t],r=n.rows[t];Zm(s,1)&&(r.note=a.note),Zm(s,2)&&(r.instrument=a.instrument),Zm(s,4)&&(r.volume=a.volume),Zm(s,8)&&(r.effTyp=a.effTyp,r.eff=a.eff),Zm(s,Ym)&&(r.effTyp2=a.effTyp2,r.eff2=a.eff2)}}),writeMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const a=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,r=a.channels[n].rows[s];e.macroSlots[t]={note:r.note,instrument:r.instrument,volume:r.volume,effTyp:r.effTyp,eff:r.eff,effTyp2:r.effTyp2,eff2:r.eff2}}),readMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const a=e.macroSlots[t],n=e.patterns[e.currentPatternIndex],{channelIndex:s,rowIndex:r}=e.cursor,{pasteMask:i}=e;if(e.insertMode){const e=n.channels[s],t={...an};Zm(i,1)&&0!==a.note&&(t.note=a.note),Zm(i,2)&&0!==a.instrument&&(t.instrument=a.instrument),Zm(i,4)&&0!==a.volume&&(t.volume=a.volume),Zm(i,8)&&(t.effTyp=a.effTyp,t.eff=a.eff),!Zm(i,Ym)||0===a.effTyp2&&0===a.eff2||(t.effTyp2=a.effTyp2,t.eff2=a.eff2),e.rows.splice(r,0,t),e.rows.length>n.length&&e.rows.pop()}else{const e=n.channels[s].rows[r];Zm(i,1)&&0!==a.note&&(e.note=a.note),Zm(i,2)&&0!==a.instrument&&(e.instrument=a.instrument),Zm(i,4)&&0!==a.volume&&(e.volume=a.volume),Zm(i,8)&&(e.effTyp=a.effTyp,e.eff=a.eff),!Zm(i,Ym)||0===a.effTyp2&&0===a.eff2||(e.effTyp2=a.effTyp2,e.eff2=a.eff2)}}),transposeSelection:(t,a=!1)=>e(e=>{const n=e.patterns[e.currentPatternIndex],s=a?e.patterns[e.currentPatternIndex].channels[e.cursor.channelIndex].rows[e.cursor.rowIndex].instrument:null;let r,i,o,l;e.selection?(r=Math.min(e.selection.startChannel,e.selection.endChannel),i=Math.max(e.selection.startChannel,e.selection.endChannel),o=Math.min(e.selection.startRow,e.selection.endRow),l=Math.max(e.selection.startRow,e.selection.endRow)):(r=e.cursor.channelIndex,i=e.cursor.channelIndex,o=e.cursor.rowIndex,l=e.cursor.rowIndex);for(let c=r;c<=i;c++)if(!(c>=n.channels.length))for(let e=o;e<=l;e++){if(e>=n.length)continue;const r=n.channels[c].rows[e];if(!r.note||0===r.note||97===r.note)continue;if(a&&null!==s&&r.instrument!==s)continue;const i=qn(r.note);if(null===i)continue;const o=i+t;o>=12&&o<=107&&(r.note=Xn(o))}}),remapInstrument:(t,a,n)=>e(e=>{const s=(e,n,s,r)=>{const i=void 0!==n?n:0,o=void 0!==n?n:e.channels.length-1,l=void 0!==s?s:0,c=void 0!==r?r:e.length-1;for(let u=i;u<=o;u++)for(let n=l;n<=c;n++)e.channels[u].rows[n]?.instrument===t&&(e.channels[u].rows[n].instrument=a)};if("block"===n&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),n=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let i=t;i<=a;i++)s(e.patterns[e.currentPatternIndex],i,n,r)}else"track"===n?s(e.patterns[e.currentPatternIndex],e.cursor.channelIndex):"pattern"===n?s(e.patterns[e.currentPatternIndex]):"song"===n&&e.patterns.forEach(e=>s(e))}),interpolateSelection:(t,a,n,s="linear")=>e(e=>{if(!e.selection)return;const r=e.patterns[e.currentPatternIndex],{startChannel:i,endChannel:o,startRow:l,endRow:c}=e.selection,u=Math.min(i,o),d=Math.max(i,o),p=Math.min(l,c),h=Math.max(l,c),m=h-p+1;if(m<2)return;const f=e=>{switch(s){case"log":return Math.log(1+9*e)/Math.log(10);case"exp":return(Math.pow(10,e)-1)/9;case"scurve":return e*e*(3-2*e);default:return e}};for(let s=u;s<=d;s++)if(!(s>=r.channels.length))for(let e=p;e<=h;e++){if(e>=r.length)continue;const i=r.channels[s].rows[e],o=f((e-p)/(m-1)),l=Math.round(a+(n-a)*o);"volume"===t?i.volume=Math.max(0,Math.min(64,l)):"cutoff"===t?i.cutoff=Math.max(0,Math.min(127,l)):"resonance"===t?i.resonance=Math.max(0,Math.min(127,l)):"envMod"===t?i.envMod=Math.max(0,Math.min(127,l)):"pan"===t&&(i.pan=Math.max(-100,Math.min(100,l)))}}),humanizeSelection:t=>e(e=>{if(!e.selection)return;const a=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:s,startRow:r,endRow:i}=e.selection,o=Math.min(n,s),l=Math.max(n,s),c=Math.min(r,i),u=Math.max(r,i);for(let d=o;d<=l;d++)if(!(d>=a.channels.length))for(let e=c;e<=u;e++){if(e>=a.length)continue;const n=a.channels[d].rows[e];if(!n.note||0===n.note||97===n.note)continue;const s=n.volume>=16&&n.volume<=80?n.volume-16:48,r=Math.floor(s*(t/100)),i=Math.floor(Math.random()*(2*r+1))-r,o=Math.max(0,Math.min(64,s+i));n.volume=16+o}}),strumSelection:(t,a)=>e(e=>{if(!e.selection)return;const n=e.patterns[e.currentPatternIndex],{startChannel:s,endChannel:r,startRow:i,endRow:o}=e.selection,l=Math.min(s,r),c=Math.max(s,r),u=Math.min(i,o),d=Math.max(i,o);for(let p=u;p<=d;p++)if(!(p>=n.length))for(let e=l;e<=c;e++){if(e>=n.channels.length)continue;const s=n.channels[e].rows[p];if(!s.note||0===s.note||97===s.note)continue;const r="down"===a?e-l:c-e,i=Math.min(15,r*t);i>0&&(s.effTyp=14,s.eff=208+i)}}),legatoSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r);for(let u=i;u<=o;u++){if(u>=t.channels.length)continue;let e=-1;for(let a=l;a<=c;a++){if(a>=t.length)continue;const n=t.channels[u].rows[a];n.note>0&&n.note<97&&(e>=0&&a>e+1&&0===n.effTyp&&(n.effTyp=3,n.eff=255),e=a)}}}),scaleVolume:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];(()=>{const a=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),s=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),i=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=s;e++)for(let t=r;t<=i;t++)e<n.channels.length&&t<n.length&&a.push(n.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<n.channels.length&&a.push(...n.channels[t].rows)}else"pattern"===t&&n.channels.forEach(e=>{a.push(...e.rows)});return a})().forEach(e=>{null!==e.volume&&void 0!==e.volume&&(e.volume=Math.min(64,Math.max(0,Math.round(e.volume*a))))})}),fadeVolume:(t,a,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex],r=(()=>{const a=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),n=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),i=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)e<s.channels.length&&t<s.length&&a.push(s.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<s.channels.length&&a.push(...s.channels[t].rows)}else"pattern"===t&&s.channels.forEach(e=>{a.push(...e.rows)});return a})(),i=r.length;i<2||r.forEach((e,t)=>{const s=t/(i-1),r=Math.round(a+s*(n-a));e.volume=Math.min(64,Math.max(0,r))})}),addPattern:(t=64)=>e(e=>{const a=e.patterns[0]?.channels.length||4;e.patterns.push(ef(t,a)),"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN ADDED")})}),deletePattern:t=>e(e=>{e.patterns.length>1&&t>=0&&t<e.patterns.length&&(e.patterns.splice(t,1),e.currentPatternIndex>=e.patterns.length&&(e.currentPatternIndex=e.patterns.length-1),"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN DELETED")}))}),clonePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=JSON.parse(JSON.stringify(a));n.id=Xm.generate("pattern"),n.name=`${a.name} (Copy)`,e.patterns.splice(t+1,0,n),"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN CLONED")})}}),resizePattern:(t,a)=>e(e=>{if(t>=0&&t<e.patterns.length&&a>0){const n=e.patterns[t],s=n.length;n.length=a,n.channels.forEach(e=>{if(a>s)for(let t=s;t<a;t++)e.rows.push({...an});else e.rows.splice(a)})}}),resizeAllPatterns:t=>e(e=>{t>0&&e.patterns.forEach(e=>{const a=e.length;e.length=t,e.channels.forEach(e=>{if(t>a)for(let n=a;n<t;n++)e.rows.push({...an});else e.rows.splice(t)})})}),duplicatePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=JSON.parse(JSON.stringify(a));n.id=Xm.generate("pattern"),n.name=`${a.name} (Copy)`,e.patterns.splice(t+1,0,n),e.currentPatternIndex=t+1}}),expandPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=a.length,s=Math.min(2*n,256);if(s===n)return;a.length=s,a.channels.forEach(e=>{const t=[];for(let a=0;a<n;a++)t.push(e.rows[a]),t.push({...an});e.rows=t})}}),shrinkPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=a.length,s=Math.max(Math.floor(n/2),1);if(s===n)return;a.length=s,a.channels.forEach(e=>{const t=[];for(let a=0;a<s;a++)t.push(e.rows[2*a]);e.rows=t})}}),reorderPatterns:(t,a)=>e(e=>{if(t>=0&&t<e.patterns.length&&a>=0&&a<e.patterns.length&&t!==a){const[n]=e.patterns.splice(t,1);e.patterns.splice(a,0,n),e.currentPatternIndex===t?e.currentPatternIndex=a:t<e.currentPatternIndex&&a>=e.currentPatternIndex?e.currentPatternIndex--:t>e.currentPatternIndex&&a<=e.currentPatternIndex&&e.currentPatternIndex++}}),updatePatternName:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&a.trim()&&(e.patterns[t].name=a.trim())}),addChannel:()=>e(e=>{const t=en.filter(e=>null!==e),a=t[Math.floor(Math.random()*t.length)];e.patterns.forEach(e=>{if(e.channels.length<16){const t=e.channels.length;e.channels.push({id:Xm.generate("channel"),name:`Channel ${t+1}`,rows:Array.from({length:e.length},()=>({...an})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:a})}}),"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL ADDED")})}),removeChannel:t=>e(e=>{e.patterns.forEach(e=>{e.channels.length>1&&t>=0&&t<e.channels.length&&e.channels.splice(t,1)}),e.cursor.channelIndex>=e.patterns[0]?.channels.length&&(e.cursor.channelIndex=Math.max(0,e.patterns[0].channels.length-1)),"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL REMOVED")})}),toggleChannelMute:a=>{let n=!1;e(e=>{e.patterns.forEach(e=>{a>=0&&a<e.channels.length&&(e.channels[a].muted=!e.channels[a].muted,n=e.channels[a].muted)})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Km().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(n?"MUTED":"UNMUTED")})},toggleChannelSolo:a=>{let n=!1;e(e=>{e.patterns.forEach(e=>{if(a>=0&&a<e.channels.length){const t=e.channels[a].solo;e.channels.forEach(e=>{e.solo=!1}),t||(e.channels[a].solo=!0,n=!0)}})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Km().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&_a(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Ag);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(n?"SOLO ON":"SOLO OFF")})},toggleChannelCollapse:t=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].collapsed=!e.channels[t].collapsed)})}),setChannelVolume:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].volume=Math.max(0,Math.min(100,a)))})}),setChannelPan:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].pan=Math.max(-100,Math.min(100,a)))})}),setChannelColor:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].color=a)})}),setChannelRows:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length){const e=[...a];for(;e.length<n.length;)e.push({...an});n.channels[t].rows=e.slice(0,n.length)}}),reorderChannel:(t,a)=>e(e=>{e.patterns.forEach(e=>{if(t>=0&&t<e.channels.length&&a>=0&&a<e.channels.length&&t!==a){const[n]=e.channels.splice(t,1);e.channels.splice(a,0,n)}}),e.cursor.channelIndex===t?e.cursor.channelIndex=a:t<e.cursor.channelIndex&&a>=e.cursor.channelIndex?e.cursor.channelIndex--:t>e.cursor.channelIndex&&a<=e.cursor.channelIndex&&e.cursor.channelIndex++}),setChannelRecordGroup:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].recordGroup=a)})}),getChannelsInRecordGroup:e=>{const a=t(),n=a.patterns[a.currentPatternIndex];return n?n.channels.map((t,a)=>t.recordGroup===e?a:-1).filter(e=>e>=0):[]},loadPatterns:t=>e(e=>{if(t.length>0){const a=t.map(e=>({...e,length:Math.max(1,e.length),channels:e.channels.map(e=>({...e,color:e.color??null}))}));e.patterns=a,e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null}}),setPatternOrder:t=>e(e=>{t.length>0&&(e.patternOrder=t,e.currentPositionIndex=0)}),setOriginalModuleData:t=>e(e=>{e.originalModuleData=t}),importPattern:a=>{const n=t().patterns.length;return e(e=>{const t={...a,length:Math.max(1,a.length),channels:a.channels.map(e=>({...e,color:e.color??null}))};e.patterns.push(t)}),n},replacePattern:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&(e.patterns[t]=JSON.parse(JSON.stringify(a)))}),addToOrder:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&(void 0!==a&&a>=0&&a<=e.patternOrder.length?e.patternOrder.splice(a,0,t):e.patternOrder.push(t))}),removeFromOrder:t=>e(e=>{t>=0&&t<e.patternOrder.length&&e.patternOrder.length>1&&(e.patternOrder.splice(t,1),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1))}),insertInOrder:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&a>=0&&a<=e.patternOrder.length&&e.patternOrder.splice(a,0,t)}),duplicatePosition:t=>e(e=>{if(t>=0&&t<e.patternOrder.length){const a=e.patternOrder[t];e.patternOrder.splice(t+1,0,a)}}),clearOrder:()=>e(e=>{e.patternOrder=[0],e.currentPositionIndex=0}),reorderPositions:(t,a)=>e(e=>{if(t>=0&&t<e.patternOrder.length&&a>=0&&a<e.patternOrder.length){const[n]=e.patternOrder.splice(t,1);e.patternOrder.splice(a,0,n),e.currentPositionIndex===t?e.currentPositionIndex=a:t<e.currentPositionIndex&&a>=e.currentPositionIndex?e.currentPositionIndex--:t>e.currentPositionIndex&&a<=e.currentPositionIndex&&e.currentPositionIndex++}}),setCurrentPosition:t=>e(e=>{t>=0&&t<e.patternOrder.length&&(e.currentPositionIndex=t,e.currentPatternIndex=e.patternOrder[t])}),reset:()=>e(e=>{e.patterns=[ef()],e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null,e.trackClipboard=null,e.currentOctave=4,e.recordMode=!1,e.editStep=1,e.insertMode=!1,e.columnVisibility={...tn},e.copyMask=Qm,e.pasteMask=Qm,e.transposeMask=1,e.macroSlots=Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),e.patternOrder=[0],e.currentPositionIndex=0})}))),af=Object.freeze(Object.defineProperty({__proto__:null,MASK_ALL:Qm,MASK_EFFECT:8,MASK_EFFECT2:Ym,MASK_INSTRUMENT:2,MASK_NOTE:1,MASK_VOLUME:4,hasMaskBit:Zm,toggleMaskBit:Jm,useTrackerStore:tf},Symbol.toStringTag,{value:"Module"})),nf=[{type:"synth",name:"JC303 Default",synthType:"TB303",tb303:{engineType:"jc303",oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.743,filterSelect:1,diodeCharacter:1,duffingAmount:.03,lpBpMix:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,filterTracking:0,filterFmDepth:0,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.1875,feedback:.3,tone:.5,mix:0,stereo:.5}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.65},filterEnvelope:{envMod:.6,decay:.3},accent:{amount:.7},slide:{time:.17,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.82},filterEnvelope:{envMod:.85,decay:.4},accent:{amount:.9},slide:{time:.15,mode:"exponential"}},effects:[],volume:.7,pan:0},{type:"synth",name:"303 Deep Sub",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.15,resonance:.35},filterEnvelope:{envMod:.25,decay:.2},accent:{amount:.45},slide:{time:.3,mode:"exponential"}},effects:[],volume:.8,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:.45,resonance:.68},filterEnvelope:{envMod:.55,decay:.25},accent:{amount:.65},slide:{time:.15,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.75,resonance:.88},filterEnvelope:{envMod:.95,decay:.5},accent:{amount:1},slide:{time:.1,mode:"exponential"}},effects:[{id:"distortion-1",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.6}}],volume:.6,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.8},filterEnvelope:{envMod:.75,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.2,accentDecay:.1,vegDecay:.3,vegSustain:.15,softAttack:.05,filterTracking:.6,filterFmDepth:.5,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:.6,pan:0},{type:"synth",name:"Acid RAT",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.75},filterEnvelope:{envMod:.7,decay:.35},accent:{amount:.85},slide:{time:.12,mode:"exponential"}},effects:[{id:"acid-rat-neural",category:"neural",type:"Neural",enabled:!0,wet:60,parameters:{gain:.55},neuralModelIndex:1,neuralModelName:"ProCo RAT"},{id:"acid-rat-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:.6,pan:0},{type:"synth",name:"Acid DS-1",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.7},filterEnvelope:{envMod:.65,decay:.3},accent:{amount:.8},slide:{time:.15,mode:"exponential"}},effects:[{id:"acid-ds1-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.5,oversample:"2x"}},{id:"acid-ds1-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:0,mid:3,high:1}},{id:"acid-ds1-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:.6,pan:0},{type:"synth",name:"Acid Warm",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.6},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.65},slide:{time:.2,mode:"exponential"}},effects:[{id:"acid-warm-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:60,parameters:{drive:.35,tone:8e3}},{id:"acid-warm-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}}],volume:.7,pan:0},{type:"synth",name:"Acid Dub",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.55},filterEnvelope:{envMod:.45,decay:.5},accent:{amount:.6},slide:{time:.25,mode:"exponential"}},effects:[{id:"acid-dub-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:30,parameters:{drive:.2,tone:1e4}},{id:"acid-dub-echo",category:"tonejs",type:"SpaceEcho",enabled:!0,wet:35,parameters:{mode:4,rate:400,intensity:.5,echoVolume:.7,reverbVolume:.2}},{id:"acid-dub-spring",category:"wasm",type:"SpringReverb",enabled:!0,wet:25,parameters:{decay:.6,damping:.5,tension:.4,mix:.5,drip:.3}}],volume:.7,pan:0},{type:"synth",name:"Acid Trance",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.6,resonance:.72},filterEnvelope:{envMod:.75,decay:.4},accent:{amount:.8},slide:{time:.15,mode:"exponential"}},effects:[{id:"acid-trance-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.35}},{id:"acid-trance-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{time:.375,feedback:.45}},{id:"acid-trance-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:30,parameters:{decay:3,preDelay:.03}}],volume:.65,pan:0},{type:"synth",name:"Acid Techno",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.8},filterEnvelope:{envMod:.85,decay:.35},accent:{amount:.9},slide:{time:.1,mode:"exponential"}},effects:[{id:"acid-techno-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.55}},{id:"acid-techno-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:6,attack:.002,release:.1}},{id:"acid-techno-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:3,high:1}}],volume:.55,pan:0},{type:"synth",name:"Acid Industrial",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.7,resonance:.85},filterEnvelope:{envMod:.9,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"}},effects:[{id:"acid-ind-cheby",category:"tonejs",type:"Chebyshev",enabled:!0,wet:35,parameters:{order:6}},{id:"acid-ind-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.7}},{id:"acid-ind-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}}],volume:.5,pan:0},{type:"synth",name:"Acid Space",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.5},filterEnvelope:{envMod:.4,decay:.55},accent:{amount:.5},slide:{time:.3,mode:"exponential"}},effects:[{id:"acid-space-chorus",category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.4,depth:.4}},{id:"acid-space-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:35,parameters:{time:.5,feedback:.5}},{id:"acid-space-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}}],volume:.65,pan:0}],sf=(e={})=>({enabled:!0,am:!1,ar:31,dr:0,mult:1,rr:15,sl:0,tl:0,dt2:0,rs:0,dt:0,d2r:0,ssg:0,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0,...e}),rf=()=>sf({enabled:!1,tl:127,ar:0,rr:0}),of=[{name:"Genesis Bass",type:"synth",synthType:"FurnaceOPN",volume:-6,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:5,operators:[sf({mult:1,tl:20,ar:31,dr:8,sl:2,rr:8}),sf({mult:2,tl:30,ar:31,dr:12,sl:4,rr:6,dt:3}),sf({mult:1,tl:25,ar:31,dr:10,sl:3,rr:8}),sf({mult:4,tl:35,ar:28,dr:15,sl:5,rr:10,dt:-1})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Lead",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:5,feedback:6,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:1,rr:6}),sf({mult:3,tl:35,ar:31,dr:8,sl:3,rr:8,dt:2}),sf({mult:2,tl:30,ar:31,dr:6,sl:2,rr:8,dt:-2}),sf({mult:1,tl:15,ar:31,dr:10,sl:4,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Brass",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:2,feedback:7,operators:[sf({mult:1,tl:25,ar:28,dr:10,sl:4,rr:8}),sf({mult:1,tl:20,ar:31,dr:8,sl:3,rr:10}),sf({mult:2,tl:30,ar:31,dr:12,sl:5,rr:8,dt:1}),sf({mult:1,tl:15,ar:25,dr:6,sl:2,rr:6})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Bell",type:"synth",synthType:"FurnaceOPN",volume:-10,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:0,operators:[sf({mult:1,tl:15,ar:31,dr:8,sl:0,rr:10}),sf({mult:7,tl:40,ar:31,dr:12,sl:2,rr:12,dt:3}),sf({mult:1,tl:20,ar:31,dr:10,sl:1,rr:10}),sf({mult:14,tl:45,ar:31,dr:15,sl:3,rr:14,dt:-2})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Strings",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:1,feedback:3,operators:[sf({mult:1,tl:20,ar:20,dr:5,sl:2,rr:8}),sf({mult:2,tl:35,ar:25,dr:8,sl:4,rr:10,dt:1}),sf({mult:1,tl:25,ar:22,dr:6,sl:3,rr:8,dt:-1}),sf({mult:3,tl:40,ar:28,dr:10,sl:5,rr:12,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Synth Lead",type:"synth",synthType:"FurnaceOPM",volume:-8,pan:0,effects:[],furnace:{chipType:33,algorithm:5,feedback:6,operators:[sf({mult:1,tl:15,ar:31,dr:5,sl:1,rr:6}),sf({mult:3,tl:40,ar:31,dr:8,sl:3,rr:8,dt:2}),sf({mult:2,tl:35,ar:31,dr:10,sl:4,rr:8,dt:-2}),sf({mult:1,tl:25,ar:31,dr:12,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Electric Piano",type:"synth",synthType:"FurnaceOPM",volume:-10,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:2,operators:[sf({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),sf({mult:14,tl:50,ar:31,dr:15,sl:5,rr:10}),sf({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),sf({mult:1,tl:45,ar:31,dr:18,sl:6,rr:12,dt:1})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Metallic Drum",type:"synth",synthType:"FurnaceOPM",volume:-6,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:7,operators:[sf({mult:1,tl:20,ar:31,dr:15,sl:0,rr:15}),sf({mult:5,tl:30,ar:31,dr:12,sl:0,rr:15,dt:2}),sf({mult:9,tl:40,ar:31,dr:10,sl:0,rr:15,dt:-2}),sf({mult:2,tl:50,ar:31,dr:8,sl:0,rr:15})],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Organ",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:3,operators:[sf({mult:2,tl:30,ar:15,dr:4,sl:8,rr:5,ws:1}),sf({mult:1,tl:0,ar:15,dr:2,sl:4,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Slap Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:5,operators:[sf({mult:4,tl:35,ar:15,dr:6,sl:3,rr:4,ws:0}),sf({mult:1,tl:0,ar:15,dr:3,sl:2,rr:6,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Bass Drum",type:"synth",synthType:"FurnaceOPL",volume:-4,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[sf({mult:1,tl:10,ar:31,dr:6,sl:2,rr:6,ws:0}),sf({mult:0,tl:0,ar:31,dr:8,sl:0,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Snare",type:"synth",synthType:"FurnaceOPL",volume:-6,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:10,sl:0,rr:10,ws:3}),sf({mult:4,tl:20,ar:31,dr:8,sl:0,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[sf({mult:1,tl:25,ar:12,dr:5,sl:5,rr:6,ws:0}),sf({mult:1,tl:5,ar:14,dr:4,sl:3,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:0,ar:31,dr:0,sl:0,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:4,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Triangle",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:2,sl:1,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Pulse",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:5,ar:28,dr:2,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:5,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Arp Lead",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:3,ar:31,dr:3,sl:1,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:4,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:31,dr:6,sl:4,rr:6}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:4,operators:[sf({mult:1,tl:15,ar:25,dr:8,sl:5,rr:8}),sf({mult:2,tl:35,ar:31,dr:10,sl:6,rr:10,dt:1}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Bass",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:5,operators:[sf({mult:1,tl:10,ar:31,dr:6,sl:3,rr:6}),sf({mult:3,tl:40,ar:31,dr:12,sl:8,rr:8,dt:2}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Pad",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:3,algorithm:2,feedback:3,operators:[sf({mult:1,tl:18,ar:18,dr:4,sl:2,rr:10}),sf({mult:2,tl:30,ar:20,dr:6,sl:4,rr:12,dt:-1}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Buzzy Lead",type:"synth",synthType:"FurnaceAY",volume:-8,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:1,operators:[sf({mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6}),sf({mult:3,tl:50,ar:31,dr:8,sl:8,rr:10}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Square Bass",type:"synth",synthType:"FurnaceAY",volume:-6,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:0,operators:[sf({mult:1,tl:15,ar:31,dr:8,sl:5,rr:5}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:4,algorithm:6,feedback:2,operators:[sf({mult:1,tl:12,ar:31,dr:5,sl:2,rr:8}),sf({mult:2,tl:40,ar:31,dr:8,sl:4,rr:10}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:4,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:6,sl:3,rr:6}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Pulse Lead",type:"synth",synthType:"FurnaceVRC6",volume:-8,pan:0,effects:[],furnace:{chipType:21,algorithm:5,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:3,sl:1,rr:10}),sf({mult:2,tl:30,ar:31,dr:6,sl:3,rr:12}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Saw Bass",type:"synth",synthType:"FurnaceVRC6",volume:-6,pan:0,effects:[],furnace:{chipType:21,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:5,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"N163 Wave Lead",type:"synth",synthType:"FurnaceN163",volume:-8,pan:0,effects:[],furnace:{chipType:22,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:4,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]}},{name:"TIA Buzzy",type:"synth",synthType:"FurnaceTIA",volume:-10,pan:0,effects:[],furnace:{chipType:38,algorithm:7,feedback:7,operators:[sf({mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4}),sf({mult:5,tl:45,ar:31,dr:20,sl:10,rr:6,dt:2}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VERA PSG Lead",type:"synth",synthType:"FurnaceVERA",volume:-8,pan:0,effects:[],furnace:{chipType:42,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SCC Wave",type:"synth",synthType:"FurnaceSCC",volume:-8,pan:0,effects:[],furnace:{chipType:10,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:5,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[0,32,64,96,127,96,64,32,0,-32,-64,-96,-127,-96,-64,-32]}]}},{name:"OPLL Piano",type:"synth",synthType:"FurnaceOPLL",volume:-10,pan:0,effects:[],furnace:{chipType:9,algorithm:0,feedback:2,operators:[sf({mult:4,tl:35,ar:15,dr:5,sl:6,rr:7}),sf({mult:1,tl:0,ar:15,dr:3,sl:3,rr:6}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Pad",type:"synth",synthType:"FurnaceSNES",volume:-10,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:20,dr:4,sl:2,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Bass",type:"synth",synthType:"FurnaceSNES",volume:-6,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:6,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"FDS Wave",type:"synth",synthType:"FurnaceFDS",volume:-8,pan:0,effects:[],furnace:{chipType:23,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[32,40,48,56,63,56,48,40,32,24,16,8,0,8,16,24]}]}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:32,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:31,dr:5,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SAA Square",type:"synth",synthType:"FurnaceSAA",volume:-8,pan:0,effects:[],furnace:{chipType:31,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"ESFM Lead",type:"synth",synthType:"FurnaceESFM",volume:-8,pan:0,effects:[],furnace:{chipType:48,algorithm:5,feedback:5,operators:[sf({mult:1,tl:15,ar:15,dr:4,sl:2,rr:6}),sf({mult:3,tl:35,ar:15,dr:6,sl:4,rr:8,dt:1}),sf({mult:2,tl:30,ar:15,dr:5,sl:3,rr:8}),sf({mult:1,tl:20,ar:15,dr:8,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPZ E.Piano",type:"synth",synthType:"FurnaceOPZ",volume:-10,pan:0,effects:[],furnace:{chipType:40,algorithm:4,feedback:3,operators:[sf({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),sf({mult:14,tl:48,ar:31,dr:14,sl:5,rr:10,dt:1}),sf({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),sf({mult:1,tl:45,ar:31,dr:16,sl:6,rr:12})],macros:[],opMacros:[],wavetables:[]}}],lf=[{type:"synth",name:"Classic Siren",synthType:"DubSiren",dubSiren:{...Pn,oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"triangle",rate:2,depth:200},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1.5,wet:.2}},effects:[],volume:-10,pan:0},{type:"synth",name:"Code Red",synthType:"DubSiren",dubSiren:{...Pn,oscillator:{type:"square",frequency:600},lfo:{enabled:!0,type:"square",rate:8,depth:100},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:2,wet:.4}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Echo",synthType:"DubSiren",dubSiren:{...Pn,oscillator:{type:"sawtooth",frequency:220},lfo:{enabled:!0,type:"sine",rate:.5,depth:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},filter:{enabled:!0,type:"highpass",frequency:300,rolloff:-12},reverb:{enabled:!0,decay:4,wet:.6}},effects:[],volume:-12,pan:0},{type:"synth",name:"Air Horn",synthType:"DubSiren",dubSiren:{...Pn,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0}],cf=[{type:"synth",name:"Standard Zap",synthType:"SpaceLaser",spaceLaser:{...In,laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:30,ratio:2},noise:{amount:5,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:30}},effects:[],volume:-10,pan:0},{type:"synth",name:"Cosmic Burst",synthType:"SpaceLaser",spaceLaser:{...In,laser:{startFreq:8e3,endFreq:400,sweepTime:300,sweepCurve:"exponential"},fm:{amount:60,ratio:4.5},noise:{amount:20,type:"pink"},filter:{type:"highpass",cutoff:1e3,resonance:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},reverb:{enabled:!0,decay:4,wet:.4}},effects:[],volume:-12,pan:0},{type:"synth",name:"Anime Pew",synthType:"SpaceLaser",spaceLaser:{...In,laser:{startFreq:6e3,endFreq:2e3,sweepTime:80,sweepCurve:"exponential"},fm:{amount:80,ratio:8},noise:{amount:0,type:"white"},filter:{type:"bandpass",cutoff:4e3,resonance:60},delay:{enabled:!0,time:.1,feedback:.3,wet:.3},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Blaster",synthType:"SpaceLaser",spaceLaser:{...In,laser:{startFreq:1500,endFreq:40,sweepTime:500,sweepCurve:"linear"},fm:{amount:20,ratio:1.5},noise:{amount:40,type:"brown"},filter:{type:"lowpass",cutoff:800,resonance:40},delay:{enabled:!0,time:.33,feedback:.6,wet:.6},reverb:{enabled:!0,decay:2.5,wet:.3}},effects:[],volume:-10,pan:0}],uf={type:"synth",name:"V2 Trance Lead",synthType:"V2",v2:{...On,osc1:{mode:1,detune:0,transpose:0,color:64,level:100},osc2:{mode:1,ringMod:!1,detune:15,transpose:0,color:64,level:80},filter1:{mode:1,cutoff:80,resonance:40},envelope:{attack:5,decay:60,sustain:40,release:40}},effects:[],volume:-10,pan:0},df={type:"synth",name:"V2 Silk Pad",synthType:"V2",v2:{...On,osc1:{mode:1,detune:5,transpose:0,color:64,level:60},osc2:{mode:3,ringMod:!1,detune:0,transpose:12,color:64,level:40},filter1:{mode:1,cutoff:40,resonance:20},envelope:{attack:80,decay:100,sustain:100,release:100}},effects:[],volume:-12,pan:0},pf={type:"synth",name:"V2 4k Bass",synthType:"V2",v2:{...On,osc1:{mode:1,detune:0,transpose:-12,color:64,level:100},osc2:{mode:2,ringMod:!1,detune:0,transpose:-12,color:64,level:60},filter1:{mode:1,cutoff:30,resonance:60},envelope:{attack:0,decay:40,sustain:0,release:10}},effects:[],volume:-8,pan:0},hf={type:"synth",name:"V2 4k Kick",synthType:"V2",v2:{...On,osc1:{mode:3,detune:0,transpose:-24,color:64,level:120},filter1:{mode:1,cutoff:20,resonance:40},envelope:{attack:0,decay:30,sustain:0,release:10}},effects:[],volume:-6,pan:0},mf={type:"synth",name:"V2 Noise Snare",synthType:"V2",v2:{...On,osc1:{mode:4,detune:0,transpose:0,color:64,level:100},filter1:{mode:2,cutoff:60,resonance:20},envelope:{attack:0,decay:45,sustain:0,release:20}},effects:[],volume:-10,pan:0},ff={type:"synth",name:"V2 Metal Hat",synthType:"V2",v2:{...On,osc1:{mode:4,detune:0,transpose:0,color:64,level:80},filter1:{mode:3,cutoff:100,resonance:10},envelope:{attack:0,decay:15,sustain:0,release:10}},effects:[],volume:-14,pan:0},gf=[uf,df,pf,hf,mf,ff,{type:"synth",name:"V2 Retro Zap",synthType:"V2",v2:{...On,osc1:{mode:1,detune:0,transpose:12,color:64,level:100},filter1:{mode:1,cutoff:120,resonance:80},envelope:{attack:0,decay:25,sustain:0,release:10}},effects:[],volume:-10,pan:0},{name:"V2 Speech",type:"synth",synthType:"V2Speech",volume:-6,pan:0,effects:[],parameters:{text:"Ready"}}],yf=[{type:"synth",name:"Disco Tom",synthType:"Synare",synare:{...Dn,oscillator:{type:"square",tune:150,fine:0},sweep:{enabled:!0,amount:24,time:200},envelope:{decay:400,sustain:0},noise:{enabled:!1,type:"white",mix:0,color:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Perc",synthType:"Synare",synare:{...Dn,oscillator:{type:"square",tune:80,fine:0},sweep:{enabled:!0,amount:12,time:100},filter:{cutoff:400,resonance:85,envMod:80,decay:150},envelope:{decay:200,sustain:0},noise:{enabled:!0,type:"white",mix:.1,color:50}},effects:[],volume:-10,pan:0},{type:"synth",name:"Synare Snare",synthType:"Synare",synare:{...Dn,oscillator:{type:"square",tune:220,fine:0},noise:{enabled:!0,type:"white",mix:.6,color:80},filter:{cutoff:2e3,resonance:30,envMod:40,decay:100},envelope:{decay:150,sustain:0},sweep:{enabled:!1,amount:0,time:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Zap",synthType:"Synare",synare:{...Dn,oscillator:{type:"square",tune:600,fine:0},sweep:{enabled:!0,amount:48,time:300},lfo:{enabled:!0,rate:12,depth:50,target:"pitch"},envelope:{decay:500,sustain:0}},effects:[],volume:-12,pan:0}],bf=(e,t,a)=>({id:`map-${e}-${Date.now()}-${Math.random()}`,noteStart:e,noteEnd:e,sampleId:t,sampleName:t,sampleUrl:`data/samples/packs/drumnibus/${a}`,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0}),vf=(e,t)=>({type:"synth",name:e,synthType:"DrumKit",drumKit:{keymap:t,polyphony:"poly",maxVoices:8,noteCut:!0},effects:[],volume:-6,pan:0}),xf=[bf(36,"Kick","kicks/BD_808A1200.wav"),bf(38,"Snare","snares/SD_Analog Noise1.wav"),bf(39,"Clap","percussion/CLAP_Juxtapos.wav"),bf(42,"Closed Hat","hihats/CH_AnalogHihat1.wav"),bf(46,"Open Hat","hihats/OH_AnalogOpenhatwav.wav"),bf(41,"Tom Low","percussion/TOM_Warped.wav"),bf(45,"Tom Mid","percussion/TOM_Stofelectro1.wav"),bf(49,"Crash","hihats/CYM_Synthique.wav"),bf(51,"Ride","hihats/CYM_Magnotron.wav"),bf(60,"FX","fx/FX_AnalogFX1.wav")],wf=[bf(36,"Kick","kicks/BD_Digidap.wav"),bf(38,"Snare","snares/SD_Digidap.wav"),bf(39,"Clap","percussion/CLAP_Punchtron.wav"),bf(42,"Closed Hat","hihats/CH_Digidap.wav"),bf(46,"Open Hat","hihats/OH_Digidap.wav"),bf(41,"Tom","percussion/TOM_Punchtron.wav"),bf(49,"Crash","hihats/CYM_Punchtron.wav"),bf(60,"Zap","fx/FX_Digidap2.wav")],kf=[bf(36,"Kick","kicks/BD_LofiHuman.wav"),bf(38,"Snare","snares/SD_LofiHuman.wav"),bf(39,"Clap","percussion/CLAP_LofiHuman.wav"),bf(42,"Closed Hat","hihats/CH_LofiHuman.wav"),bf(46,"Open Hat","hihats/OH_LofiHuman.wav"),bf(41,"Tom","percussion/TOM_LofiHuman.wav"),bf(60,"Vocal FX","fx/FX_LofiHuman.wav")],Sf=[bf(36,"Kick","kicks/BD_Pziforze.wav"),bf(38,"Snare","snares/SD_Wolf 3.wav"),bf(39,"Clap","percussion/CLAP_Magnotron.wav"),bf(42,"Closed Hat","hihats/CH_Magnotron.wav"),bf(46,"Open Hat","hihats/OH_Magnotron.wav"),bf(41,"Tom Low","percussion/TOM_Magnotron.wav"),bf(49,"Crash","hihats/CYM_Magnotron.wav"),bf(60,"Rumble FX","fx/FX_Magstorm1.wav")],Mf=[vf("Drumnibus Analog",xf),vf("Drumnibus Digital",wf),vf("Drumnibus LoFi",kf),vf("Drumnibus Techno",Sf)],Nf=[{type:"synth",name:"SP_TheProduct",synthType:"V2",v2Speech:{text:"!DHAX_ !prAA_dAHkt",speed:64,pitch:40,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP_Demoscene",synthType:"V2",v2Speech:{text:"!dEH_mOW_sIYn",speed:64,pitch:64,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"KY_Rhodesano0",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:0},osc2:{mode:5,ringMod:!1,transpose:0,detune:9,color:0,level:122},osc3:{mode:0,ringMod:!1,transpose:31,detune:29,color:72,level:0},filter1:{mode:1,cutoff:99,resonance:0},filter2:{mode:0,cutoff:94,resonance:99},routing:{mode:1,balance:64},envelope:{attack:13,decay:104,sustain:0,release:44},envelope2:{attack:4,decay:93,sustain:0,release:64},lfo1:{rate:74,depth:75}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_AnaBass#005",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:7,color:0,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:64,level:125},osc3:{mode:0,ringMod:!1,transpose:-12,detune:0,color:0,level:125},filter1:{mode:1,cutoff:52,resonance:91},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_French HornZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Dry BD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:22,level:122},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:0},filter1:{mode:1,cutoff:122,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:5,release:45},envelope2:{attack:0,decay:35,sustain:0,release:33},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Morseh #000",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:-6,detune:0,color:62,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:94,depth:108}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Transortion",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:63,resonance:95},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:90,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Long Pad007",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:16,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-8,color:64,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:4,cutoff:39,resonance:0},filter2:{mode:1,cutoff:35,resonance:69},routing:{mode:1,balance:64},envelope:{attack:71,decay:94,sustain:96,release:106},envelope2:{attack:114,decay:120,sustain:113,release:112},lfo1:{rate:7,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_JarreStrings",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:12,color:1,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:61,level:34},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:5,cutoff:74,resonance:42},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:26,decay:64,sustain:64,release:49},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:78,depth:2}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_His Shadow's Breath",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:4,level:122},osc2:{mode:4,ringMod:!1,transpose:45,detune:0,color:41,level:77},osc3:{mode:1,ringMod:!1,transpose:12,detune:16,color:3,level:122},filter1:{mode:5,cutoff:67,resonance:97},filter2:{mode:2,cutoff:76,resonance:120},routing:{mode:2,balance:64},envelope:{attack:27,decay:64,sustain:122,release:30},envelope2:{attack:0,decay:102,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Deepness001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:14,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-15,color:0,level:126},filter1:{mode:1,cutoff:76,resonance:47},filter2:{mode:1,cutoff:76,resonance:47},routing:{mode:1,balance:42},envelope:{attack:0,decay:14,sustain:115,release:54},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 SD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Marsian Pan Flute",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:28,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:-27,color:64,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:18,resonance:118},filter2:{mode:1,cutoff:100,resonance:70},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:37,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Lullaby09",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:80,resonance:44},filter2:{mode:2,cutoff:115,resonance:108},routing:{mode:2,balance:64},envelope:{attack:0,decay:64,sustain:64,release:75},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Morpher#072",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-8,color:8,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:12,color:24,level:72},osc3:{mode:1,ringMod:!1,transpose:0,detune:-7,color:97,level:126},filter1:{mode:2,cutoff:0,resonance:86},filter2:{mode:2,cutoff:123,resonance:51},routing:{mode:2,balance:63},envelope:{attack:0,decay:25,sustain:126,release:7},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:24,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Jarresque06",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:124},osc2:{mode:4,ringMod:!1,transpose:23,detune:0,color:98,level:49},osc3:{mode:1,ringMod:!1,transpose:12,detune:10,color:6,level:124},filter1:{mode:2,cutoff:68,resonance:0},filter2:{mode:3,cutoff:120,resonance:0},routing:{mode:2,balance:29},envelope:{attack:75,decay:0,sustain:125,release:98},envelope2:{attack:125,decay:125,sustain:125,release:125},lfo1:{rate:10,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_Awaych #000",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-11,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:12,color:0,level:126},filter1:{mode:2,cutoff:86,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:86,decay:114,sustain:109,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:74,depth:23}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Kicking Saw",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:68,resonance:98},filter2:{mode:1,cutoff:62,resonance:105},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:105,depth:32}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Hiphop BaZZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:42,resonance:0},filter2:{mode:2,cutoff:126,resonance:0},routing:{mode:2,balance:64},envelope:{attack:0,decay:12,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Woodblock",synthType:"V2",v2:{osc1:{mode:3,transpose:12,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:21,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:21,sustain:0,release:25},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Electrons68",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:1,ringMod:!0,transpose:0,detune:-19,color:32,level:125},osc3:{mode:3,ringMod:!0,transpose:31,detune:0,color:114,level:125},filter1:{mode:2,cutoff:67,resonance:95},filter2:{mode:3,cutoff:60,resonance:89},routing:{mode:1,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:91,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Garage Organ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:15,level:125},osc2:{mode:3,ringMod:!1,transpose:48,detune:0,color:32,level:25},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:33},filter1:{mode:1,cutoff:108,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:49,sustain:108,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Lonely Square Lead",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:97},osc2:{mode:2,ringMod:!1,transpose:0,detune:-9,color:64,level:66},osc3:{mode:2,ringMod:!1,transpose:0,detune:6,color:64,level:47},filter1:{mode:2,cutoff:66,resonance:35},filter2:{mode:3,cutoff:98,resonance:10},routing:{mode:2,balance:32},envelope:{attack:0,decay:73,sustain:36,release:55},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Strangeland",synthType:"V2",v2:{osc1:{mode:2,transpose:-12,detune:0,color:2,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:5,color:123,level:126},osc3:{mode:2,ringMod:!1,transpose:0,detune:-9,color:24,level:126},filter1:{mode:3,cutoff:117,resonance:14},filter2:{mode:2,cutoff:91,resonance:15},routing:{mode:2,balance:42},envelope:{attack:10,decay:96,sustain:65,release:102},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:14,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old Saw Percs",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:9,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:23,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:67,resonance:13},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:68},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:50,depth:114}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_SawBass#004",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:4,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-5,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:0,color:6,level:126},filter1:{mode:1,cutoff:64,resonance:7},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:90,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Ridesecken",synthType:"V2",v2:{osc1:{mode:2,transpose:-4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:4,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:2,cutoff:104,resonance:95},routing:{mode:1,balance:64},envelope:{attack:0,decay:26,sustain:57,release:100},envelope2:{attack:0,decay:90,sustain:0,release:95},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Powerbeam15",synthType:"V2",v2:{osc1:{mode:3,transpose:-45,detune:0,color:0,level:124},osc2:{mode:3,ringMod:!0,transpose:-38,detune:0,color:32,level:124},osc3:{mode:5,ringMod:!1,transpose:-2,detune:0,color:67,level:124},filter1:{mode:1,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:125,sustain:0,release:2},envelope2:{attack:0,decay:125,sustain:0,release:0},lfo1:{rate:94,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Glimpse Of a Clavi",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:13,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:82,resonance:102},filter2:{mode:3,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:13},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_PWM Leade)",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:125},osc2:{mode:0,ringMod:!1,transpose:-12,detune:7,color:4,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:73,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:60,decay:114,sustain:80,release:64},envelope2:{attack:126,decay:126,sustain:126,release:0},lfo1:{rate:77,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_LoFi Choir9",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-20,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:82,resonance:98},filter2:{mode:3,cutoff:80,resonance:106},routing:{mode:1,balance:64},envelope:{attack:67,decay:64,sustain:64,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old SawsrnZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_I like to move it",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-13,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:20,color:32,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:58},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:31},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Industrial VeloHammer",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:15,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:61,resonance:113},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:55,sustain:0,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Rave Siren",synthType:"V2",v2:{osc1:{mode:2,transpose:8,detune:4,color:69,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:53,level:107},osc3:{mode:2,ringMod:!1,transpose:-4,detune:5,color:69,level:126},filter1:{mode:3,cutoff:58,resonance:95},filter2:{mode:2,cutoff:100,resonance:90},routing:{mode:1,balance:64},envelope:{attack:0,decay:13,sustain:28,release:86},envelope2:{attack:0,decay:72,sustain:58,release:73},lfo1:{rate:104,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Doj's Organ",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:0,color:32,level:125},osc3:{mode:3,ringMod:!1,transpose:36,detune:0,color:32,level:78},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:38,sustain:107,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Phunny #002",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:26,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:75,resonance:82},filter2:{mode:1,cutoff:64,resonance:0},routing:{mode:2,balance:26},envelope:{attack:7,decay:37,sustain:64,release:53},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:73,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Fairies#001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:63},osc2:{mode:1,ringMod:!1,transpose:0,detune:8,color:0,level:63},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:121},filter1:{mode:3,cutoff:42,resonance:101},filter2:{mode:0,cutoff:108,resonance:0},routing:{mode:0,balance:64},envelope:{attack:72,decay:121,sustain:70,release:100},envelope2:{attack:0,decay:125,sustain:56,release:108},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nastyn-303",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:0,level:125},osc2:{mode:0,ringMod:!1,transpose:0,detune:19,color:0,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:49,resonance:114},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:18},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:61,depth:82}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Squaredance",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:65,level:126},osc3:{mode:2,ringMod:!0,transpose:12,detune:0,color:64,level:22},filter1:{mode:1,cutoff:57,resonance:63},filter2:{mode:2,cutoff:60,resonance:31},routing:{mode:0,balance:64},envelope:{attack:0,decay:26,sustain:100,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Biiiig Drumdamm",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:0,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:81},envelope2:{attack:0,decay:57,sustain:0,release:52},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Random Zaps",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:44,detune:0,color:53,level:126},filter1:{mode:3,cutoff:80,resonance:51},filter2:{mode:1,cutoff:93,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:0},envelope2:{attack:0,decay:0,sustain:46,release:3},lfo1:{rate:22,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_What They Called Pian",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:32,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:34,level:124},filter1:{mode:1,cutoff:95,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:79,sustain:64,release:69},envelope2:{attack:96,decay:0,sustain:124,release:62},lfo1:{rate:76,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Debil? ICH?",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:52,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:97,resonance:62},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:32,sustain:0,release:64},lfo1:{rate:78,depth:113}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Formants From The Cry",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:17,level:126},osc2:{mode:3,ringMod:!0,transpose:36,detune:4,color:112,level:76},osc3:{mode:1,ringMod:!1,transpose:31,detune:0,color:22,level:27},filter1:{mode:2,cutoff:81,resonance:83},filter2:{mode:1,cutoff:73,resonance:104},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_You broke me!bass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:2,level:11},osc2:{mode:1,ringMod:!1,transpose:0,detune:2,color:0,level:10},osc3:{mode:4,ringMod:!1,transpose:6,detune:0,color:53,level:38},filter1:{mode:1,cutoff:78,resonance:30},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:25,depth:117}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Airy HH003",synthType:"V2",v2:{osc1:{mode:4,transpose:35,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:115,resonance:8},filter2:{mode:1,cutoff:116,resonance:24},routing:{mode:1,balance:64},envelope:{attack:0,decay:55,sustain:24,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:97,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Tag You're Its",synthType:"V2",v2:{osc1:{mode:3,transpose:-6,detune:0,color:60,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:61,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:106,resonance:126},filter2:{mode:3,cutoff:95,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:35,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Slow Synthbrass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-9,color:0,level:126},filter1:{mode:1,cutoff:74,resonance:24},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:45,decay:66,sustain:64,release:73},envelope2:{attack:98,decay:91,sustain:121,release:72},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Random Arp3",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:11,color:18,level:98},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:83},filter2:{mode:0,cutoff:58,resonance:0},routing:{mode:0,balance:64},envelope:{attack:4,decay:50,sustain:0,release:57},envelope2:{attack:0,decay:26,sustain:0,release:31},lfo1:{rate:64,depth:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Analog Mod Bass",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:25,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:19,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:39,resonance:105},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:32,decay:64,sustain:64,release:62},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:97}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_HighSnare02",synthType:"V2",v2:{osc1:{mode:3,transpose:3,detune:0,color:0,level:68},osc2:{mode:3,ringMod:!1,transpose:10,detune:0,color:32,level:64},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:23,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:107,sustain:0,release:64},lfo1:{rate:93,depth:25}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Whistling Wind",synthType:"V2",v2:{osc1:{mode:4,transpose:31,detune:0,color:61,level:126},osc2:{mode:4,ringMod:!1,transpose:-10,detune:-13,color:23,level:126},osc3:{mode:0,ringMod:!1,transpose:24,detune:-5,color:96,level:126},filter1:{mode:4,cutoff:62,resonance:40},filter2:{mode:1,cutoff:80,resonance:53},routing:{mode:1,balance:64},envelope:{attack:46,decay:78,sustain:126,release:66},envelope2:{attack:0,decay:0,sustain:11,release:4},lfo1:{rate:5,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Sweeping Dist",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:11,level:126},osc2:{mode:0,ringMod:!1,transpose:38,detune:0,color:65,level:24},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:126},filter2:{mode:0,cutoff:80,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:30}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lofi Squares",synthType:"V2",v2:{osc1:{mode:3,transpose:10,detune:0,color:72,level:126},osc2:{mode:3,ringMod:!0,transpose:12,detune:-1,color:55,level:126},osc3:{mode:2,ringMod:!1,transpose:4,detune:0,color:65,level:126},filter1:{mode:1,cutoff:52,resonance:104},filter2:{mode:2,cutoff:126,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:41,sustain:43,release:8},envelope2:{attack:0,decay:23,sustain:126,release:14},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Not From This World",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:2,color:52,level:126},osc2:{mode:2,ringMod:!0,transpose:4,detune:13,color:23,level:126},osc3:{mode:5,ringMod:!0,transpose:-24,detune:3,color:56,level:126},filter1:{mode:2,cutoff:50,resonance:53},filter2:{mode:2,cutoff:78,resonance:82},routing:{mode:2,balance:63},envelope:{attack:0,decay:83,sustain:126,release:6},envelope2:{attack:0,decay:41,sustain:126,release:10},lfo1:{rate:9,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:-3,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-3,detune:0,color:96,level:126},osc3:{mode:4,ringMod:!1,transpose:21,detune:0,color:36,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:69,sustain:0,release:55},envelope2:{attack:0,decay:32,sustain:0,release:31},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Mod Perc004",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:10,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:60,resonance:110},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:13,decay:39,sustain:24,release:59},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:0,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nice Saws87",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:13,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-13,color:0,level:126},filter1:{mode:1,cutoff:126,resonance:107},filter2:{mode:2,cutoff:113,resonance:65},routing:{mode:2,balance:64},envelope:{attack:0,decay:66,sustain:19,release:70},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:12,depth:102}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Roaar! 007",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:3,color:126,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:-7,color:126,level:26},filter1:{mode:1,cutoff:62,resonance:75},filter2:{mode:3,cutoff:41,resonance:15},routing:{mode:1,balance:64},envelope:{attack:20,decay:64,sustain:126,release:20},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Dist Kick",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_XPlosion007",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:-46,detune:0,color:65,level:126},osc3:{mode:0,ringMod:!1,transpose:-11,detune:0,color:32,level:14},filter1:{mode:1,cutoff:92,resonance:0},filter2:{mode:1,cutoff:25,resonance:10},routing:{mode:1,balance:64},envelope:{attack:0,decay:96,sustain:0,release:96},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Whistlotronic",synthType:"V2",v2:{osc1:{mode:2,transpose:12,detune:0,color:66,level:127},osc2:{mode:0,ringMod:!1,transpose:7,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:4,detune:0,color:27,level:126},filter1:{mode:2,cutoff:86,resonance:0},filter2:{mode:2,cutoff:116,resonance:0},routing:{mode:2,balance:21},envelope:{attack:34,decay:64,sustain:53,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:99,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Tech Arp100",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:13,resonance:32},filter2:{mode:2,cutoff:29,resonance:104},routing:{mode:2,balance:78},envelope:{attack:0,decay:48,sustain:18,release:23},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:1,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Mightyass1",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:9,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:47},filter1:{mode:1,cutoff:25,resonance:69},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:105,sustain:6,release:81},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Rim#003",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:6,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:38,detune:0,color:0,level:121},filter1:{mode:0,cutoff:73,resonance:117},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:11,sustain:0,release:0},envelope2:{attack:0,decay:6,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Hell's Bell",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:91,level:28},osc2:{mode:5,ringMod:!1,transpose:23,detune:50,color:30,level:126},osc3:{mode:3,ringMod:!0,transpose:-64,detune:0,color:102,level:24},filter1:{mode:1,cutoff:80,resonance:106},filter2:{mode:3,cutoff:37,resonance:77},routing:{mode:1,balance:64},envelope:{attack:0,decay:65,sustain:126,release:77},envelope2:{attack:0,decay:46,sustain:15,release:13},lfo1:{rate:28,depth:52}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Farscape04",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:4,ringMod:!1,transpose:-44,detune:-10,color:0,level:6},osc3:{mode:3,ringMod:!1,transpose:0,detune:1,color:32,level:126},filter1:{mode:1,cutoff:86,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:80,decay:64,sustain:112,release:94},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:27,depth:109}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lethal PWM0",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:80,resonance:0},filter2:{mode:5,cutoff:114,resonance:91},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:116,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:68,depth:34}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Soaring#088",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-4,color:126,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:-11,color:0,level:126},filter1:{mode:1,cutoff:33,resonance:51},filter2:{mode:1,cutoff:77,resonance:115},routing:{mode:1,balance:64},envelope:{attack:0,decay:126,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:8,depth:46}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_Trombrato02",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:14,color:0,level:121},osc2:{mode:0,ringMod:!1,transpose:0,detune:-15,color:0,level:82},osc3:{mode:0,ringMod:!1,transpose:12,detune:2,color:0,level:76},filter1:{mode:1,cutoff:70,resonance:0},filter2:{mode:1,cutoff:70,resonance:23},routing:{mode:1,balance:64},envelope:{attack:46,decay:64,sustain:121,release:20},envelope2:{attack:94,decay:125,sustain:125,release:26},lfo1:{rate:0,depth:17}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noiseh #004",synthType:"V2",v2:{osc1:{mode:4,transpose:5,detune:0,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:67,resonance:83},filter2:{mode:2,cutoff:86,resonance:66},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:113,release:26},envelope2:{attack:0,decay:25,sustain:20,release:121},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Disturbing7",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:122},osc2:{mode:4,ringMod:!1,transpose:52,detune:0,color:32,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:122},filter1:{mode:2,cutoff:89,resonance:89},filter2:{mode:2,cutoff:78,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:77,sustain:123,release:0},envelope2:{attack:0,decay:106,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Bontempi002",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:5,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:2,cutoff:45,resonance:0},filter2:{mode:0,cutoff:47,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:41,release:70},envelope2:{attack:0,decay:64,sustain:64,release:90},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_FlangeHats2",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Screeeam!IKAAAA!!!",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-17,color:63,level:55},osc2:{mode:1,ringMod:!1,transpose:12,detune:-43,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:92,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:14,decay:64,sustain:64,release:42},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:82,depth:87}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Kick075",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Synth Jew's Harp",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:5,level:123},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},filter1:{mode:2,cutoff:9,resonance:113},filter2:{mode:1,cutoff:81,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:27},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Snaree",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:124},osc2:{mode:4,ringMod:!1,transpose:25,detune:0,color:102,level:108},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:0,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:39,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Cheap Arp08",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:14,color:0,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:1,cutoff:83,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:42,sustain:38,release:71},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 HHs 104",synthType:"V2",v2:{osc1:{mode:2,transpose:4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:24,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:3,cutoff:104,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_VeloFuzz001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:1,color:0,level:126},osc2:{mode:2,ringMod:!0,transpose:24,detune:14,color:63,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:4,resonance:116},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Hefty Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:-54,detune:3,color:70,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:0,color:65,level:126},filter1:{mode:1,cutoff:122,resonance:11},filter2:{mode:3,cutoff:41,resonance:42},routing:{mode:1,balance:64},envelope:{attack:0,decay:98,sustain:126,release:47},envelope2:{attack:0,decay:54,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_yasgch #005",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:9,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:59},filter2:{mode:0,cutoff:59,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:118,sustain:114,release:35},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Synth Kick",synthType:"V2",v2:{osc1:{mode:1,transpose:-3,detune:0,color:61,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:0,cutoff:27,resonance:56},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:34,sustain:0,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Hihats 2",synthType:"V2",v2:{osc1:{mode:2,transpose:-10,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:91},filter2:{mode:2,cutoff:108,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 1001",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:26,resonance:126},filter2:{mode:2,cutoff:25,resonance:126},routing:{mode:1,balance:64},envelope:{attack:0,decay:61,sustain:0,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 13",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:3,ringMod:!1,transpose:0,detune:7,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:60},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:76,depth:104}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 28",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:70,sustain:0,release:92},envelope2:{attack:0,decay:37,sustain:0,release:40},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistSnare11",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:32,level:0},osc2:{mode:3,ringMod:!1,transpose:8,detune:36,color:32,level:0},osc3:{mode:4,ringMod:!1,transpose:35,detune:0,color:70,level:124},filter1:{mode:5,cutoff:73,resonance:115},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:56,sustain:0,release:65},envelope2:{attack:0,decay:15,sustain:0,release:0},lfo1:{rate:64,depth:105}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 Ride",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:14},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:18},osc3:{mode:4,ringMod:!1,transpose:50,detune:0,color:66,level:123},filter1:{mode:3,cutoff:124,resonance:0},filter2:{mode:2,cutoff:104,resonance:100},routing:{mode:1,balance:64},envelope:{attack:0,decay:54,sustain:0,release:75},envelope2:{attack:0,decay:64,sustain:123,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 HHs + Dis",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 1 #000",synthType:"V2",v2:{osc1:{mode:3,transpose:-7,detune:0,color:32,level:127},osc2:{mode:3,ringMod:!1,transpose:-7,detune:9,color:32,level:127},osc3:{mode:4,ringMod:!1,transpose:29,detune:0,color:64,level:0},filter1:{mode:0,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:47,sustain:0,release:43},envelope2:{attack:0,decay:46,sustain:1,release:75},lfo1:{rate:90,depth:107}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:4,detune:-64,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:-1,detune:-13,color:32,level:91},osc3:{mode:4,ringMod:!1,transpose:-11,detune:44,color:0,level:34},filter1:{mode:1,cutoff:68,resonance:0},filter2:{mode:2,cutoff:84,resonance:63},routing:{mode:2,balance:15},envelope:{attack:0,decay:0,sustain:65,release:64},envelope2:{attack:0,decay:63,sustain:99,release:76},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_March Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:6,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:12,detune:1,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Nice Synth HH",synthType:"V2",v2:{osc1:{mode:4,transpose:53,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:121,resonance:121},filter2:{mode:1,cutoff:117,resonance:114},routing:{mode:2,balance:64},envelope:{attack:0,decay:20,sustain:20,release:8},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Crash",synthType:"V2",v2:{osc1:{mode:4,transpose:62,detune:62,color:106,level:126},osc2:{mode:4,ringMod:!1,transpose:62,detune:50,color:51,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:26,color:108,level:126},filter1:{mode:3,cutoff:126,resonance:55},filter2:{mode:1,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:47,sustain:21,release:77},envelope2:{attack:0,decay:113,sustain:70,release:124},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Open HH",synthType:"V2",v2:{osc1:{mode:4,transpose:36,detune:0,color:82,level:126},osc2:{mode:0,ringMod:!1,transpose:9,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:112,resonance:106},filter2:{mode:0,cutoff:104,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:44,sustain:0,release:32},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Pop BD #003",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:121},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:36,detune:0,color:90,level:0},filter1:{mode:1,cutoff:121,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:0,release:52},envelope2:{attack:0,decay:23,sustain:0,release:0},lfo1:{rate:80,depth:84}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Snappy Snare",synthType:"V2",v2:{osc1:{mode:1,transpose:-10,detune:0,color:72,level:126},osc2:{mode:5,ringMod:!1,transpose:0,detune:0,color:64,level:38},osc3:{mode:4,ringMod:!1,transpose:33,detune:0,color:76,level:126},filter1:{mode:3,cutoff:53,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:45,sustain:0,release:19},envelope2:{attack:0,decay:18,sustain:0,release:0},lfo1:{rate:105,depth:11}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Ver|bt Snare",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:60,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:-21,color:126,level:88},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:82,resonance:126},filter2:{mode:1,cutoff:22,resonance:126},routing:{mode:2,balance:17},envelope:{attack:0,decay:0,sustain:126,release:14},envelope2:{attack:0,decay:83,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #100",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #101",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #102",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #103",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #104",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #105",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #106",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #107",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #108",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #109",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #110",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #111",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #112",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #113",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #114",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #115",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #116",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #117",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #118",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #119",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #120",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #121",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #122",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #123",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #124",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #125",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #126",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #127",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0}],Cf=[{type:"synth",name:"SAM_Classic",synthType:"Sam",sam:{text:"SAM IS BACK",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_C64",synthType:"Sam",sam:{text:"COMMODORE SIXTY FOUR",pitch:64,speed:64,mouth:150,throat:110,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_Robotic",synthType:"Sam",sam:{text:"EXTERMINATE",pitch:40,speed:80,mouth:200,throat:200,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_High",synthType:"Sam",sam:{text:"I HAVE A HIGH VOICE",pitch:100,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0}],Ef=[{type:"synth",name:"Astrocade Clean Square",synthType:"MAMEAstrocade",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Vibrato Lead",synthType:"MAMEAstrocade",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Buzz",synthType:"MAMEAstrocade",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Rumble",synthType:"MAMEAstrocade",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Laser",synthType:"MAMESN76477",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Explosion",synthType:"MAMESN76477",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Engine",synthType:"MAMESN76477",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Siren",synthType:"MAMESN76477",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Organ",synthType:"MAMEMSM5232",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Full Brass",synthType:"MAMEMSM5232",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Strings",synthType:"MAMEMSM5232",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Reedy Combo",synthType:"MAMEMSM5232",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Piano",synthType:"MAMETMS36XX",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Banjo",synthType:"MAMETMS36XX",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Organ",synthType:"MAMETMS36XX",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Sine",synthType:"MAMESNKWave",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Square",synthType:"MAMESNKWave",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Triangle",synthType:"MAMESNKWave",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"YMOPQ E.Piano",synthType:"MAMEYMOPQ",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Brass",synthType:"MAMEYMOPQ",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Strings",synthType:"MAMEYMOPQ",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bass",synthType:"MAMEYMOPQ",parameters:{_program:3},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Organ",synthType:"MAMEYMOPQ",parameters:{_program:4},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Lead",synthType:"MAMEYMOPQ",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Pad",synthType:"MAMEYMOPQ",parameters:{_program:6},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bell",synthType:"MAMEYMOPQ",parameters:{_program:7},effects:[],volume:-8,pan:0},{type:"synth",name:"MEA8000 Vowel A",synthType:"MAMEMEA8000",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel E",synthType:"MAMEMEA8000",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel O",synthType:"MAMEMEA8000",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Nasal",synthType:"MAMEMEA8000",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel AH",synthType:"MAMESP0250",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel EE",synthType:"MAMESP0250",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel OO",synthType:"MAMESP0250",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax EH",synthType:"MAMEVotrax",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AW",synthType:"MAMEVotrax",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AH",synthType:"MAMEVotrax",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax OO",synthType:"MAMEVotrax",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"ES5503 Default",synthType:"MAMEES5503",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"YMF271 FM Piano",synthType:"MAMEYMF271",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Brass",synthType:"MAMEYMF271",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Strings",synthType:"MAMEYMF271",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"TR707 Default Kit",synthType:"MAMETR707",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Bass",synthType:"MAMEVASynth",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Lead",synthType:"MAMEVASynth",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pad",synthType:"MAMEVASynth",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pluck",synthType:"MAMEVASynth",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"TIA Square",synthType:"MAMETIA",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TIA Buzz",synthType:"MAMETIA",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD931 Default",synthType:"MAMEUPD931",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD933 Default",synthType:"MAMEUPD933",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS5220 Speech",synthType:"MAMETMS5220",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Sine",synthType:"MAMEASC",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Square",synthType:"MAMEASC",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"AICA Default",synthType:"MAMEAICA",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"SCSP Default",synthType:"SCSP",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"C352 Default",synthType:"MAMEC352",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"RF5C400 Default",synthType:"MAMERF5C400",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"ICS2115 Default",synthType:"MAMEICS2115",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"K054539 Default",synthType:"MAMEK054539",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Bass",synthType:"CEM3394",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"CEM3394 Lead",synthType:"CEM3394",parameters:{_program:1,volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Pad",synthType:"CEM3394",parameters:{_program:2,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"SCSP Synth Bass",synthType:"SCSP",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"SCSP Poly Pad",synthType:"SCSP",parameters:{_program:1,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"AICA FM Piano",synthType:"MAMEAICA",parameters:{_program:0,volume:.8},effects:[],volume:-10,pan:0}],Pf=(e,t,a=0,n=7)=>({level:e,coarse:t,fine:a,detune:n,egRates:[99,99,99,99],egLevels:[99,99,99,0]}),_f=[{name:"DX7 E.Piano 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["E.PIANO 1"]},{name:"DX7 E.Piano Bright",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{...$l["E.PIANO 1"],feedback:7}},{name:"DX7 Clavinet",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,60,30,60],egLevels:[99,0,0,0]},{level:80,coarse:2,egRates:[99,50,20,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Organ",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:3,feedback:0,operators:[{level:99,coarse:1},{level:90,coarse:2},{level:85,coarse:3},{level:80,coarse:4},Pf(0,1),Pf(0,1)]}},{name:"DX7 Bass 1",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:5,feedback:7,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:75,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:50,coarse:2,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Slap Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:16,feedback:6,operators:[{level:99,coarse:1,egRates:[99,60,40,60],egLevels:[99,95,0,0]},{level:88,coarse:4,egRates:[99,80,60,80],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Solid Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:18,feedback:4,operators:[{level:99,coarse:0,fine:50},{level:80,coarse:1},{level:70,coarse:1},Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Tubular Bells",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:1,feedback:5,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,40,20,50],egLevels:[99,0,0,0]},{level:85,coarse:3,fine:50,detune:7,egRates:[99,60,30,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Marimba",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,70,30,60],egLevels:[99,0,0,0]},{level:80,coarse:4,egRates:[99,60,20,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Brass 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["BRASS 1"]},{name:"DX7 Strings 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["STRINGS 1"]},{name:"DX7 Init Voice",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["INIT VOICE"]}],Tf=[{name:"OB-X Classic Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Classic Brass"]},{name:"OB-X Bright Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{...Uc["Classic Brass"],filterCutoff:.6,filterEnvAmount:.7,unison:!0,unisonDetune:.1}},{name:"OB-X Fat Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Fat Lead"]},{name:"OB-X Sync Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Sync Lead"]},{name:"OB-X Unison Saw",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,unison:!0,unisonDetune:.2,panSpread:.5,filterCutoff:1,ampRelease:.2}},{name:"OB-X Rez Bass",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:1,osc2Detune:.08,filterCutoff:.3,filterResonance:.6,filterEnvAmount:.7,filterAttack:.05,filterDecay:.2,ampAttack:.01,ampDecay:.3}},{name:"OB-X Sub Bass",type:"synth",synthType:"OBXd",volume:-6,pan:0,effects:[],obxd:{osc1Waveform:2,osc2Waveform:0,osc2Octave:-1,filterCutoff:.2,filterResonance:0,filterEnvAmount:.3,filterDecay:.4}},{name:"OB-X PWM Strings",type:"synth",synthType:"OBXd",volume:-12,pan:0,effects:[],obxd:{osc1Waveform:1,osc2Waveform:1,osc1PulseWidth:.5,osc2Detune:.03,lfoRate:.2,lfoPwAmount:.4,filterCutoff:.4,filterResonance:.1,ampAttack:.2,ampRelease:.5}},{name:"OB-X Pulse Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Pulse Pad"]},{name:"OB-X Sweep Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,filterCutoff:.3,filterResonance:.5,lfoRate:.1,lfoFilterAmount:.4,ampAttack:.5,ampRelease:.8}},{name:"OB-X S&H Sci-Fi",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:1,lfoWaveform:4,lfoRate:.7,lfoFilterAmount:.8,lfoOscAmount:.3,filterResonance:.7}},{name:"OB-X Init",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc.Init}],Af=[{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.NES}},{name:"NES Pulse 12.5%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.NES,nes:{dutyNoise:0,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Pulse 25%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.NES,nes:{dutyNoise:1,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Triangle Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.NES}},{name:"NES Noise Drums",type:"synth",synthType:"FurnaceNES",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.NES}},{name:"MMC5 Expansion Init",type:"synth",synthType:"FurnaceMMC5",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.MMC5}},{name:"GB Pulse 50%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"GB Pulse 25%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"GB Noise Snare",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"GB Wave Organ",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"GB Noise HiHat",type:"synth",synthType:"FurnaceGB",volume:-12,pan:0,effects:[],furnace:{chipType:Ei.GB}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.PSG}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.PSG}},{name:"PSG Periodic Noise",type:"synth",synthType:"FurnacePSG",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.PSG}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.PCE}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.PCE}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.VIC}},{name:"VIC Noise",type:"synth",synthType:"FurnaceVIC",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.VIC}},{name:"TIA Square",type:"synth",synthType:"FurnaceTIA",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.TIA}},{name:"TIA Bass",type:"synth",synthType:"FurnaceTIA",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.TIA}},{name:"OPL3 FM Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.OPL3,algorithm:0,feedback:6}},{name:"OPL3 FM Strings",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.OPL3,algorithm:1,feedback:2}},{name:"OPL3 FM Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.OPL3,algorithm:0,feedback:4}},{name:"Amiga ST-01 Bass",type:"synth",synthType:"FurnaceAMIGA",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Lead Strings",type:"synth",synthType:"FurnaceAMIGA",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Poly Pad",type:"synth",synthType:"FurnaceAMIGA",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"PET Bleep",type:"synth",synthType:"FurnacePET",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.PET}},{name:"PC Speaker Beeper",type:"synth",synthType:"FurnacePCSPKR",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.PCSPKR}},{name:"ZX Beeper QuadTone",type:"synth",synthType:"FurnaceZXBEEPER",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.ZXBEEPER_QT}},{name:"SID Pulse PWM",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.SID}},{name:"SID Ring Mod",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.SID}},{name:"GBA Synth Bass",type:"synth",synthType:"FurnaceGBA",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.GBA_DMA}},{name:"GBA Lead Strings",type:"synth",synthType:"FurnaceGBA",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.GBA_DMA}},{name:"NDS Piano",type:"synth",synthType:"FurnaceNDS",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.NDS}},{name:"NDS Pad",type:"synth",synthType:"FurnaceNDS",volume:-12,pan:0,effects:[],furnace:{chipType:Ei.NDS}},{name:"Virtual Boy Lead",type:"synth",synthType:"FurnaceVB",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.VB}},{name:"WonderSwan Wave",type:"synth",synthType:"FurnaceSWAN",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.SWAN}},{name:"Atari Lynx Pulse",type:"synth",synthType:"FurnaceLynx",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.LYNX}},{name:"Neo Geo Pocket Bass",type:"synth",synthType:"FurnaceT6W28",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.T6W28}},{name:"QSound Fat Bass",type:"synth",synthType:"FurnaceQSOUND",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.QSOUND}},{name:"Sega MultiPCM Strings",type:"synth",synthType:"FurnaceMULTIPCM",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.MULTIPCM}},{name:"Sega PCM Lead",type:"synth",synthType:"FurnaceSEGAPCM",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.SEGAPCM}},{name:"Namco C140 Drum",type:"synth",synthType:"FurnaceC140",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.C140}},{name:"OKI MSM6295 Kick",type:"synth",synthType:"FurnaceOKI",volume:-4,pan:0,effects:[],furnace:{chipType:Ei.OKI}},{name:"OKI MSM6258 Snare",type:"synth",synthType:"FurnaceMSM6258",volume:-6,pan:0,effects:[],furnace:{chipType:Ei.MSM6258}},{name:"YM2203 FM Bass",type:"synth",synthType:"FurnaceOPN2203",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.OPN,algorithm:4,feedback:5}},{name:"YM2608 FM Strings",type:"synth",synthType:"FurnaceOPNA",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.OPNA,algorithm:5,feedback:3}},{name:"YM2610 FM Lead",type:"synth",synthType:"FurnaceOPNB",volume:-8,pan:0,effects:[],furnace:{chipType:Ei.OPNB,algorithm:4,feedback:6}},{name:"YMF278B FM Piano",type:"synth",synthType:"FurnaceOPL4",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.OPL4,algorithm:4,feedback:2}},{name:"VRC7 FM Brass",type:"synth",synthType:"FurnaceVRC7",volume:-10,pan:0,effects:[],furnace:{chipType:Ei.OPLL,algorithm:0,feedback:4}}],Of="/data/samples/packs/casio-mt40/leads",If="/data/samples/packs/drumnibus",Df=[{name:"MT-40 Accordion",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/accordion.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/brass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Clarinet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/clarinet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Elec Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/elec piano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Harpsichord",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/harpsichord.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Pipe Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/pipe-organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Trumpet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/trumpet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Violin",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/violin.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Celesta",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Of}/celesta.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Funny Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/funny fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Xylophone",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/xylophone.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Gloken",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Of}/glocken.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Folk Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/folk flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 ST Ensemble",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Of}/st ensemble.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Synth Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Of}/synth fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${If}/kicks/BD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Analog",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${If}/snares/SD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Wolf",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${If}/snares/SD_Wolf1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Percussion Tom",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${If}/percussion/TOM_Magnotron.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus HiHat Digidap",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${If}/hihats/CH_Digidap.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Player Analog Kick",type:"synth",synthType:"Player",volume:-6,pan:0,effects:[],parameters:{sampleUrl:`${If}/kicks/BD_Analog1.wav`}},{name:"Player Analog Snare",type:"synth",synthType:"Player",volume:-8,pan:0,effects:[],parameters:{sampleUrl:`${If}/snares/SD_Analog1.wav`}},{name:"Player Sci-Fi FX",type:"synth",synthType:"Player",volume:-10,pan:0,effects:[],parameters:{sampleUrl:`${If}/fx/FX_AnalogFX1.wav`}},{name:"Granular Casio Flute",type:"synth",synthType:"GranularSynth",volume:-10,pan:0,effects:[],granular:{sampleUrl:`${Of}/flute.wav`,grainSize:100,grainOverlap:50,detune:10,randomPitch:20,density:8,scanSpeed:10,playbackRate:1,randomPosition:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"Granular Drumnibus Texture",type:"synth",synthType:"GranularSynth",volume:-12,pan:0,effects:[],granular:{sampleUrl:`${If}/fx/FX_Blarper.wav`,grainSize:200,grainOverlap:10,detune:-5,randomPosition:30,density:12,scanSpeed:5,playbackRate:1,randomPitch:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"MT-40 Full Lead Set",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:"",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1,multiMap:{C2:`${Of}/bass.wav`,C3:`${Of}/cello.wav`,C4:`${Of}/elec piano.wav`,C5:`${Of}/glocken.wav`,C6:`${Of}/funny fuzz.wav`}}}],Ff=[{name:"Wavetable Bell",type:"synth",synthType:"Wavetable",volume:-12,pan:0,effects:[],wavetable:{wavetableId:"bell-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:1,detune:0,stereoSpread:0},envelope:{attack:10,decay:1e3,sustain:0,release:100},filter:{type:"lowpass",cutoff:12e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Brass",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"brass-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:2,detune:10,stereoSpread:50},envelope:{attack:50,decay:500,sustain:50,release:200},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:30},filterEnvelope:{attack:100,decay:300,sustain:0,release:100}}},{name:"Wavetable Choir",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"choir-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:4,detune:15,stereoSpread:80},envelope:{attack:200,decay:500,sustain:100,release:500},filter:{type:"lowpass",cutoff:4e3,resonance:5,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Heavy Bass",type:"synth",synthType:"Wavetable",volume:-8,pan:0,effects:[],wavetable:{wavetableId:"m4-bass01",morphPosition:0,morphModSource:"envelope",morphModAmount:50,morphLFORate:0,unison:{voices:2,detune:15,stereoSpread:40},envelope:{attack:5,decay:400,sustain:20,release:150},filter:{type:"lowpass",cutoff:2e3,resonance:40,envelopeAmount:60},filterEnvelope:{attack:10,decay:300,sustain:0,release:100}}}],Rf={"Soft Clip":{machineType:nl.ARGURU_DISTORTION,parameters:{0:256,1:1024,2:1024,3:1024,4:0,5:0}},"Hard Clip":{machineType:nl.ARGURU_DISTORTION,parameters:{0:512,1:256,2:256,3:768,4:0,5:0}},"Heavy Saturate":{machineType:nl.ARGURU_DISTORTION,parameters:{0:768,1:512,2:512,3:1280,4:0,5:1}}},jf={"Low Pass":{machineType:nl.ELAK_SVF,parameters:{0:500,1:512}},"Low Pass Resonant":{machineType:nl.ELAK_SVF,parameters:{0:300,1:40960}},"High Pass":{machineType:nl.ELAK_SVF,parameters:{0:700,1:1024}}},Lf={[nl.ARGURU_DISTORTION]:Rf,[nl.ELAK_SVF]:jf,[nl.FSM_KICK]:{"Hard Kick":{machineType:nl.FSM_KICK,parameters:{0:100,1:80}},"Soft Kick":{machineType:nl.FSM_KICK,parameters:{0:60,1:40}},"Long 808-ish":{machineType:nl.FSM_KICK,parameters:{0:80,1:120}}},[nl.FSM_KICKXP]:{"Init KickXP":{machineType:nl.FSM_KICKXP,parameters:{}},"Extreme Kick":{machineType:nl.FSM_KICKXP,parameters:{0:127,1:127}}},[nl.JESKOLA_TRILOK]:{"Punchy BD":{machineType:nl.JESKOLA_TRILOK,parameters:{0:80,1:60}},"Deep BD":{machineType:nl.JESKOLA_TRILOK,parameters:{0:40,1:90}}},[nl.JESKOLA_NOISE]:{"White Noise":{machineType:nl.JESKOLA_NOISE,parameters:{0:0}},"Pink Noise":{machineType:nl.JESKOLA_NOISE,parameters:{0:1}},"Noisy FX":{machineType:nl.JESKOLA_NOISE,parameters:{0:2,1:100}}},[nl.OOMEK_AGGRESSOR]:{"Acid Bass":{machineType:nl.OOMEK_AGGRESSOR,parameters:{1:120,2:96,3:80,4:64}},"Squelchy Lead":{machineType:nl.OOMEK_AGGRESSOR,parameters:{1:160,2:127,3:96,4:80}},"Soft Sub":{machineType:nl.OOMEK_AGGRESSOR,parameters:{1:48,2:32,3:32,4:96}}},[nl.OOMEK_AGGRESSOR_DF]:{"DF Screamer":{machineType:nl.OOMEK_AGGRESSOR_DF,parameters:{1:176,2:127,13:1,15:2}},"DF Infinite":{machineType:nl.OOMEK_AGGRESSOR_DF,parameters:{1:96,10:100,9:127}}},[nl.MADBRAIN_4FM2F]:{"FM Bass":{machineType:nl.MADBRAIN_4FM2F,parameters:{0:10,1:80,2:40}},"FM Lead":{machineType:nl.MADBRAIN_4FM2F,parameters:{0:40,1:100,2:60}},"FM Pad":{machineType:nl.MADBRAIN_4FM2F,parameters:{0:60,1:50,2:100}}},[nl.MADBRAIN_DYNAMITE6]:{"Additive Lead":{machineType:nl.MADBRAIN_DYNAMITE6,parameters:{0:80,1:40}},"Organ-like":{machineType:nl.MADBRAIN_DYNAMITE6,parameters:{0:60,1:100}}},[nl.MAKK_M3]:{"M3 Lead":{machineType:nl.MAKK_M3,parameters:{0:64,1:64}},"M3 Bass":{machineType:nl.MAKK_M3,parameters:{0:127,1:32}}},[nl.MAKK_M4]:{"M4 Wavetable":{machineType:nl.MAKK_M4,parameters:{0:0}},"M4 Sweep":{machineType:nl.MAKK_M4,parameters:{0:50,1:100}}},[nl.CYANPHASE_DTMF]:{"Phone Tones":{machineType:nl.CYANPHASE_DTMF,parameters:{}}},[nl.ELENZIL_FREQUENCYBOMB]:{"Freq Bomb":{machineType:nl.ELENZIL_FREQUENCYBOMB,parameters:{0:100}}},[nl.ELAK_DIST2]:{},[nl.JESKOLA_DISTORTION]:{},[nl.GEONIK_OVERDRIVE]:{},[nl.GRAUE_SOFTSAT]:{},[nl.WHITENOISE_STEREODIST]:{},[nl.CYANPHASE_NOTCH]:{},[nl.Q_ZFILTER]:{},[nl.FSM_PHILTA]:{},[nl.JESKOLA_DELAY]:{},[nl.JESKOLA_CROSSDELAY]:{},[nl.JESKOLA_FREEVERB]:{},[nl.FSM_PANZERDELAY]:{},[nl.FSM_CHORUS]:{},[nl.FSM_CHORUS2]:{},[nl.WHITENOISE_WHITECHORUS]:{},[nl.BIGYO_FREQUENCYSHIFTER]:{},[nl.GEONIK_COMPRESSOR]:{},[nl.LD_SLIMIT]:{},[nl.OOMEK_EXCITER]:{},[nl.OOMEK_MASTERIZER]:{},[nl.DEDACODE_STEREOGAIN]:{}};function Bf(e){return Object.keys(function(e){return Lf[e]||{}}(e))}const Vf=[nl.FSM_KICK,nl.FSM_KICKXP,nl.JESKOLA_TRILOK,nl.JESKOLA_NOISE,nl.OOMEK_AGGRESSOR,nl.OOMEK_AGGRESSOR_DF,nl.MADBRAIN_4FM2F,nl.MADBRAIN_DYNAMITE6,nl.MAKK_M3,nl.MAKK_M4,nl.CYANPHASE_DTMF,nl.ELENZIL_FREQUENCYBOMB],zf=[];for(const ET of Vf){const e=Lf[ET];if(e)for(const[t,a]of Object.entries(e)){const e=`Buzz ${t}`;zf.push({name:e,type:"synth",synthType:`Buzz${Uf(ET)}`,volume:-10,pan:0,effects:[],parameters:a.parameters})}}function Uf(e){switch(e){case nl.FSM_KICK:return"Kick";case nl.FSM_KICKXP:return"KickXP";case nl.JESKOLA_TRILOK:return"Trilok";case nl.JESKOLA_NOISE:return"Noise";case nl.OOMEK_AGGRESSOR:return"Aggressor";case nl.OOMEK_AGGRESSOR:return"3o3";case nl.OOMEK_AGGRESSOR_DF:return"3o3DF";case nl.MADBRAIN_4FM2F:return"4FM2F";case nl.MADBRAIN_DYNAMITE6:return"Dynamite6";case nl.MAKK_M3:return"M3";case nl.MAKK_M4:return"M4";case nl.CYANPHASE_DTMF:return"DTMF";case nl.ELENZIL_FREQUENCYBOMB:return"FreqBomb";default:return e}}const Gf=[{name:"M4 Deep Bass",type:"synth",synthType:"BuzzM4",volume:-8,pan:0,effects:[],parameters:{0:1,1:64,2:32,3:80}},{name:"M4 Sub Bass",type:"synth",synthType:"BuzzM4",volume:-6,pan:0,effects:[],parameters:{0:5,1:0,2:20}},{name:"M4 Rezzy Growl",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:13,1:127,2:45,3:110}},{name:"M4 Sharp Saw",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:20,1:64,2:100,3:20}},{name:"M4 Digi Lead",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:45,1:80,2:120}},{name:"M4 Sync Lead",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:30,1:64,4:12}},{name:"M4 Soft Pad",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:60,1:64,2:60,3:10}},{name:"M4 Metallic Text",type:"synth",synthType:"BuzzM4",volume:-14,pan:0,effects:[],parameters:{0:85,1:100,2:80,3:90}}],Wf=[{type:"synth",name:"Classic Wobble",synthType:"WobbleBass",wobbleBass:{mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Growl Bass",synthType:"WobbleBass",wobbleBass:{mode:"growl",osc1:{type:"sawtooth",octave:-2,detune:0,level:100},osc2:{type:"square",octave:-2,detune:5,level:70},sub:{enabled:!0,octave:-2,level:80},fm:{enabled:!0,amount:40,ratio:1,envelope:60},unison:{voices:2,detune:10,stereoSpread:30},filter:{type:"bandpass",cutoff:600,resonance:40,rolloff:-12,drive:50,keyTracking:20},filterEnvelope:{amount:50,attack:10,decay:400,sustain:40,release:200},wobbleLFO:{enabled:!0,sync:"1/8",rate:4,shape:"saw",amount:60,pitchAmount:0,fmAmount:30,phase:0,retrigger:!0},envelope:{attack:5,decay:300,sustain:60,release:200},distortion:{enabled:!0,type:"hard",drive:60,tone:50},formant:{enabled:!0,vowel:"O",morph:50,lfoAmount:40}},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Wobble",synthType:"WobbleBass",wobbleBass:{mode:"reese",osc1:{type:"sawtooth",octave:-1,detune:-10,level:90},osc2:{type:"sawtooth",octave:-1,detune:10,level:90},sub:{enabled:!0,octave:-2,level:70},fm:{enabled:!1,amount:0,ratio:1,envelope:0},unison:{voices:6,detune:25,stereoSpread:80},filter:{type:"lowpass",cutoff:1200,resonance:30,rolloff:-24,drive:20,keyTracking:0},filterEnvelope:{amount:0,attack:0,decay:0,sustain:0,release:0},wobbleLFO:{enabled:!0,sync:"1/2",rate:1,shape:"triangle",amount:50,pitchAmount:0,fmAmount:0,phase:0,retrigger:!1},envelope:{attack:20,decay:500,sustain:100,release:800},distortion:{enabled:!0,type:"soft",drive:30,tone:60},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Pluck Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:300,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Fat Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:5,octave:-1},envelope:{attack:10,decay:400,sustain:.4,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Sine Sub",synthType:"Synth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:65},filterEnvelope:{envMod:60,decay:200},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:85},filterEnvelope:{envMod:80,decay:150},accent:{amount:80},slide:{time:50,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Deep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:40},filterEnvelope:{envMod:30,decay:300},accent:{amount:60},slide:{time:80,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:700,resonance:60},filterEnvelope:{envMod:50,decay:180},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:92},filterEnvelope:{envMod:95,decay:100},accent:{amount:90},slide:{time:40,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Bubbly",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:75},filterEnvelope:{envMod:70,decay:80},accent:{amount:75},slide:{time:30,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Self-Osc",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:98},filterEnvelope:{envMod:85,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Plastikman",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:40,decay:250},accent:{amount:65},slide:{time:100,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:70},filterEnvelope:{envMod:55,decay:250},accent:{amount:75},slide:{time:50,mode:"exponential"},devilFish:{enabled:!0,normalDecay:300,accentDecay:150,vegDecay:2500,vegSustain:0,softAttack:2,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Infinite Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:30,decay:400},accent:{amount:50},slide:{time:120,mode:"exponential"},devilFish:{enabled:!0,normalDecay:800,accentDecay:600,vegDecay:3e3,vegSustain:100,softAttack:15,filterTracking:50,filterFmDepth:10,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1400,resonance:85},filterEnvelope:{envMod:80,decay:350},accent:{amount:100},slide:{time:30,mode:"exponential"},overdrive:{amount:70,modelIndex:0,drive:70,dryWet:100},devilFish:{enabled:!0,normalDecay:200,accentDecay:100,vegDecay:500,vegSustain:20,softAttack:.5,filterTracking:80,filterFmDepth:80,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!0,muffler:"hard"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Whistler",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1600,resonance:92},filterEnvelope:{envMod:70,decay:500},accent:{amount:80},slide:{time:100,mode:"exponential"},devilFish:{enabled:!0,normalDecay:400,accentDecay:300,vegDecay:1500,vegSustain:30,softAttack:5,filterTracking:150,filterFmDepth:25,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Muffled Punch",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:60},filterEnvelope:{envMod:65,decay:150},accent:{amount:90},slide:{time:45,mode:"exponential"},devilFish:{enabled:!0,normalDecay:100,accentDecay:80,vegDecay:200,vegSustain:0,softAttack:.5,filterTracking:30,filterFmDepth:15,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Acid Low",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:400,resonance:72},filterEnvelope:{envMod:50,decay:300},accent:{amount:80},slide:{time:80,mode:"exponential"},devilFish:{enabled:!0,normalDecay:250,accentDecay:120,vegDecay:800,vegSustain:15,softAttack:1.5,filterTracking:40,filterFmDepth:20,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Resonant Sweep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:88},filterEnvelope:{envMod:90,decay:600},accent:{amount:95},slide:{time:60,mode:"exponential"},devilFish:{enabled:!0,normalDecay:500,accentDecay:400,vegDecay:1200,vegSustain:10,softAttack:3,filterTracking:100,filterFmDepth:35,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Soft Pad",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:700,resonance:40},filterEnvelope:{envMod:20,decay:800},accent:{amount:30},slide:{time:200,mode:"exponential"},devilFish:{enabled:!0,normalDecay:1500,accentDecay:1200,vegDecay:3e3,vegSustain:80,softAttack:25,filterTracking:60,filterFmDepth:5,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Hardstyle",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1800,resonance:75},filterEnvelope:{envMod:85,decay:80},accent:{amount:100},slide:{time:25,mode:"exponential"},overdrive:{amount:60,modelIndex:0,drive:60,dryWet:100},devilFish:{enabled:!0,normalDecay:60,accentDecay:40,vegDecay:150,vegSustain:0,softAttack:.3,filterTracking:50,filterFmDepth:45,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Singing Filter",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2200,resonance:95},filterEnvelope:{envMod:60,decay:700},accent:{amount:70},slide:{time:150,mode:"exponential"},devilFish:{enabled:!0,normalDecay:600,accentDecay:500,vegDecay:2e3,vegSustain:50,softAttack:8,filterTracking:180,filterFmDepth:15,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Gritty Bass",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:500,resonance:65},filterEnvelope:{envMod:45,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"},overdrive:{amount:40,modelIndex:0,drive:40,dryWet:100},devilFish:{enabled:!0,normalDecay:180,accentDecay:100,vegDecay:400,vegSustain:5,softAttack:1,filterTracking:25,filterFmDepth:55,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Bubbly Acid",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:78},filterEnvelope:{envMod:75,decay:50},accent:{amount:90},slide:{time:20,mode:"exponential"},devilFish:{enabled:!0,normalDecay:40,accentDecay:30,vegDecay:100,vegSustain:0,softAttack:.5,filterTracking:70,filterFmDepth:30,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Ambient Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:50},filterEnvelope:{envMod:25,decay:1500},accent:{amount:35},slide:{time:300,mode:"exponential"},devilFish:{enabled:!0,normalDecay:2500,accentDecay:2e3,vegDecay:3e3,vegSustain:95,softAttack:30,filterTracking:80,filterFmDepth:8,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Techno Stab",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:70},filterEnvelope:{envMod:70,decay:100},accent:{amount:100},slide:{time:30,mode:"exponential"},devilFish:{enabled:!0,normalDecay:80,accentDecay:50,vegDecay:180,vegSustain:0,softAttack:.3,filterTracking:45,filterFmDepth:40,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Screaming Lead",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:3e3,resonance:90},filterEnvelope:{envMod:95,decay:400},accent:{amount:100},slide:{time:50,mode:"exponential"},overdrive:{amount:50,modelIndex:0,drive:50,dryWet:100},devilFish:{enabled:!0,normalDecay:350,accentDecay:250,vegDecay:800,vegSustain:25,softAttack:2,filterTracking:150,filterFmDepth:60,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-16,pan:0},{type:"synth",name:"808 Sub",synthType:"MonoSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:1,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:15,octave:0},envelope:{attack:10,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:800,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"House Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Wobble Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:400,sustain:0,release:100},filter:{type:"lowpass",frequency:1e3,Q:8,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Duo Sub Bass",synthType:"DuoSynth",oscillator:{type:"triangle",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:1,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},...nf,...lf],Hf=[{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Pluck Keys",synthType:"PluckSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2500,Q:1,rolloff:-12},effects:[],volume:-10,pan:0},{type:"synth",name:"Guitar Pluck",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:200,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"AM Bell",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"AM Sci-Fi",synthType:"AMSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:.5,release:1e3},effects:[],volume:-6,pan:0},{type:"synth",name:"FM Electric Piano",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:.2,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Saw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:10,decay:200,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Square Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:100,sustain:.8,release:100},effects:[],volume:-10,pan:0},{type:"synth",name:"Supersaw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:20,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Acid Lead",synthType:"MonoSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:350,sustain:0,release:200},filter:{type:"lowpass",frequency:2e3,Q:5,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Sync Lead",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:10,decay:450,sustain:0,release:300},filter:{type:"lowpass",frequency:2500,Q:3,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:3e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Detuned Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:25,octave:0},envelope:{attack:30,decay:450,sustain:0,release:400},filter:{type:"lowpass",frequency:2800,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Filtered Lead",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"AM Tremolo Lead",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"FM Bell Lead",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:1e3,sustain:0,release:800},effects:[],volume:-10,pan:0},{type:"synth",name:"Harp Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:800,sustain:0,release:500},effects:[],volume:-8,pan:0},{type:"synth",name:"Nylon Guitar",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1,decay:1200,sustain:0,release:1e3},effects:[],volume:-8,pan:0},{type:"synth",name:"PWM Solo Lead",synthType:"PWMSynth",pwmSynth:{pulseWidth:20,pwmDepth:40,pwmRate:1.5,pwmWaveform:"sine",oscillators:2,detune:5,envelope:{attack:10,decay:300,sustain:.6,release:200},filter:{type:"lowpass",cutoff:3e3,resonance:30,envelopeAmount:20,keyTracking:50},filterEnvelope:{attack:5,decay:400,sustain:.2,release:100}},effects:[],volume:-10,pan:0},{type:"synth",name:"Poly Brass",synthType:"PolySynth",polySynth:{voiceCount:6,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:50,decay:400,sustain:.7,release:200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SuperSaw Lead",synthType:"SuperSaw",superSaw:{voices:7,detune:40,mix:70,stereoSpread:80,envelope:{attack:10,decay:300,sustain:50,release:200},filter:{type:"lowpass",cutoff:5e3,resonance:20,envelopeAmount:50},filterEnvelope:{attack:5,decay:400,sustain:0,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Robot Talk",synthType:"FormantSynth",formantSynth:{vowel:"E",vowelMorph:{target:"U",amount:80,rate:2,mode:"manual"},oscillator:{type:"square"},formants:{...yn.E,bandwidth:120},envelope:{attack:5,decay:200,sustain:.5,release:100},brightness:80},effects:[],volume:-10,pan:0}],Kf=[{type:"synth",name:"Ambient Pad",synthType:"Synth",oscillator:{type:"sine",detune:3,octave:0},envelope:{attack:800,decay:2e3,sustain:0,release:1500},filter:{type:"lowpass",frequency:1500,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Dark Pad",synthType:"DuoSynth",oscillator:{type:"triangle",detune:8,octave:0},envelope:{attack:1e3,decay:2500,sustain:0,release:2e3},filter:{type:"lowpass",frequency:800,Q:2,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"String Pad",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:500,decay:1800,sustain:0,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1.5,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Noise Sweep",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:1500,sustain:0,release:1e3},filter:{type:"bandpass",frequency:1e3,Q:5,rolloff:-24},effects:[],volume:-18,pan:0},{type:"synth",name:"AM Atmospheric",synthType:"AMSynth",oscillator:{type:"sine",detune:5,octave:0},envelope:{attack:1500,decay:3e3,sustain:.8,release:2e3},effects:[],volume:-12,pan:0},{type:"synth",name:"Wavetable Evolving Pad",synthType:"Wavetable",wavetable:{wavetableId:"evolve-1",morphPosition:0,morphModSource:"lfo",morphModAmount:80,morphLFORate:.1,unison:{voices:4,detune:12,stereoSpread:60},envelope:{attack:1e3,decay:2e3,sustain:.7,release:1500},filter:{type:"lowpass",cutoff:1500,resonance:20,envelopeAmount:30},filterEnvelope:{attack:2e3,decay:1e3,sustain:.5,release:1e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"Poly Soft Strings",synthType:"PolySynth",polySynth:{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:500,decay:1e3,sustain:.8,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-14,pan:0},{type:"synth",name:"PWM Strings",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:30,pwmRate:.5,pwmWaveform:"sine",oscillators:3,detune:12,envelope:{attack:800,decay:1500,sustain:.9,release:1500},filter:{type:"lowpass",cutoff:1200,resonance:15,envelopeAmount:0,keyTracking:30},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Solina Ensemble",synthType:"StringMachine",stringMachine:{sections:{violin:100,viola:80,cello:60,bass:40},ensemble:{depth:70,rate:2.5,voices:4},attack:300,release:1500,brightness:50},effects:[],volume:-10,pan:0},{type:"synth",name:"Ethereal Choir",synthType:"FormantSynth",formantSynth:{vowel:"A",vowelMorph:{target:"O",amount:50,rate:.2,mode:"lfo"},oscillator:{type:"sawtooth"},formants:{...yn.A,bandwidth:80},envelope:{attack:1e3,decay:2e3,sustain:.8,release:2e3},brightness:60},effects:[],volume:-12,pan:0},{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"Wavetable Morph Pad",synthType:"Wavetable",wavetable:{wavetableId:"morph-2",morphPosition:50,morphModSource:"lfo",morphModAmount:40,morphLFORate:.2,unison:{voices:6,detune:20,stereoSpread:90},envelope:{attack:1200,decay:2500,sustain:.8,release:2e3},filter:{type:"lowpass",cutoff:2e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"PWM Soft Pad",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:20,pwmRate:.3,pwmWaveform:"sine",oscillators:2,detune:8,envelope:{attack:1500,decay:2e3,sustain:.9,release:2e3},filter:{type:"lowpass",cutoff:800,resonance:5,envelopeAmount:0,keyTracking:20},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-14,pan:0},{type:"synth",name:"Granular Cloud",synthType:"GranularSynth",granular:{sampleUrl:"",grainSize:.1,grainOverlap:.05,detune:5,playbackRate:1,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:1,reverse:!1,envelope:{attack:10,release:100},filter:{type:"lowpass",cutoff:2e3,resonance:1}},effects:[],volume:-10,pan:0}],$f=[hf,mf,ff,{type:"synth",name:"808 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:100,Q:1,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:300,sustain:0,release:50},filter:{type:"lowpass",frequency:80,Q:2,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"Hardcore Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:150,sustain:0,release:20},filter:{type:"lowpass",frequency:120,Q:3,rolloff:-24},effects:[],volume:-4,pan:0},{type:"synth",name:"DnB Snare",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:300,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Clap",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:150,sustain:0,release:50},filter:{type:"bandpass",frequency:1e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Closed Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:50,sustain:0,release:20},filter:{type:"highpass",frequency:8e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Open Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:200},filter:{type:"highpass",frequency:7e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:1500,sustain:0,release:1e3},filter:{type:"highpass",frequency:6e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Synth Low Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:400,sustain:0,release:100},effects:[],volume:-8,pan:-20},{type:"synth",name:"Synth Mid Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:350,sustain:0,release:80},effects:[],volume:-8,pan:0},{type:"synth",name:"Synth Hi Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:60},effects:[],volume:-8,pan:20},...yf],qf=[{type:"synth",name:"NES Major Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:15,delay:200},arpeggio:{enabled:!0,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"C64 Minor Arp",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:4,depth:10,delay:300},arpeggio:{enabled:!0,speed:12,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"SID Dim7 Pad",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:50,decay:600,sustain:0,release:500},vibrato:{speed:3,depth:8,delay:100},arpeggio:{enabled:!0,speed:8,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:6},{noteOffset:9}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Gameboy Sus4",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:12.5},bitDepth:4,sampleRate:16384,envelope:{attack:1,decay:200,sustain:0,release:100},vibrato:{speed:6,depth:20,delay:150},arpeggio:{enabled:!0,speed:18,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:5},{noteOffset:7}],mode:"loop"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Atari Dom7",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:4,sampleRate:15720,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:20,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Amiga Power Oct",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:8,sampleRate:28867,envelope:{attack:5,decay:300,sustain:0,release:250},vibrato:{speed:4,depth:12,delay:200},arpeggio:{enabled:!0,speed:14,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Fast Maj9 Stab",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:150,sustain:0,release:80},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:30,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:11},{noteOffset:14}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Slow Min7 Sweep",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:100,decay:800,sustain:0,release:600},vibrato:{speed:3,depth:15,delay:500},arpeggio:{enabled:!0,speed:4,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Square Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:200},vibrato:{speed:6,depth:15,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Triangle Bass",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:4,sampleRate:22050,envelope:{attack:1,decay:400,sustain:0,release:150},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12}],mode:"loop"}},effects:[],volume:-6,pan:0},{type:"synth",name:"Noise Snare",synthType:"ChipSynth",chipSynth:{channel:"noise",bitDepth:1,sampleRate:22050,envelope:{attack:1,decay:100,sustain:0,release:50},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Octave Jump",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:10,delay:250},arpeggio:{enabled:!0,speed:10,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12},{noteOffset:24}],mode:"loop"}},effects:[],volume:-10,pan:0}],Xf=[{type:"synth",name:"909 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3}},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",snare:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Rim",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:100,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:300,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:60,decay:50,metallic:65}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:55,decay:350,metallic:60}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Ride",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:800,sustain:.1,release:500},filter:{type:"highpass",frequency:5e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"909 Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:2e3,sustain:.05,release:1500},filter:{type:"highpass",frequency:4e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0}],Yf=[{type:"synth",name:"808 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",machineType:"808",kick:{pitch:48,pitchDecay:110,tone:50,toneDecay:20,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",machineType:"808",snare:{pitch:238,pitchHigh:476,tone:50,toneDecay:75,snappy:50,decay:100,envAmount:1,envDuration:100,filterType:"highpass",filterFreq:1300}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",machineType:"808",clap:{tone:50,decay:115,toneDecay:200,spread:100,filterFreqs:[1e3,1e3],modulatorFreq:10}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Rimshot",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",machineType:"808",rimshot:{decay:40,filterFreqs:[480,1750,2450],filterQ:5,saturation:2.5}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Clave",synthType:"DrumMachine",drumMachine:{drumType:"clave",machineType:"808",clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Cowbell",synthType:"DrumMachine",drumMachine:{drumType:"cowbell",machineType:"808",cowbell:{decay:400,filterFreq:2640}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Maracas",synthType:"DrumMachine",drumMachine:{drumType:"maracas",machineType:"808",maracas:{decay:30,filterFreq:5e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:90,decay:200,tone:20,toneDecay:155,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:140,decay:190,tone:20,toneDecay:130,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:190,decay:180,tone:20,toneDecay:100,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Low Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:190,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:280,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:410,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:50,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:270,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Cymbal",synthType:"DrumMachine",drumMachine:{drumType:"cymbal",machineType:"808",cymbal:{tone:50,decay:3e3}},effects:[],volume:-14,pan:0}],Qf=[{type:"synth",name:"Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"Downlifter",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:2e3,sustain:0,release:100},filter:{type:"lowpass",frequency:5e3,Q:3,rolloff:-24},effects:[],volume:-14,pan:0},{type:"synth",name:"Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:2,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Laser Zap",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-12,pan:0}],Zf=[{type:"synth",name:"Web Audio Module (WAM)",synthType:"WAM",wam:{moduleUrl:"",pluginState:null},effects:[],volume:-12,pan:0}],Jf=[{type:"synth",name:"505 Kick",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Snare",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Clap",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Rim",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"505 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"505 Crash",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"505 Ride",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"505 Low Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 High Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Low Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-20},{type:"synth",name:"505 High Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:20},{type:"synth",name:"505 Timbale",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-timbal.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}],eg=[{type:"synth",name:"707 Kick",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Kick Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Snare",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Clap",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Rim",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Low Tom Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"707 Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-cowbell.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Crash",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"707 Ride",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"707 Tambourine",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tambourine.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0}],tg=[{type:"synth",name:"DN 808 A1200",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN SubThud",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_SubThud.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Punchtron Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN 808 Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Analog Noise",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro 7000",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_electro7000.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Wolf Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Wolf1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Closed Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Open Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Analog Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Cymbal",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CYM_Synthique.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Clap",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Clave",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Tom",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Lazer",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/LAZ_R900.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Sonar",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Sonar.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Laser",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Burst",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Burst1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0}],ag=[{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"VFX Evolving",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},{type:"synth",name:"ESQ-1 Gritty Keys",synthType:"MAMEDOC",effects:[],volume:-10,pan:0},{type:"synth",name:"MKS-20 E.Piano 1",synthType:"MAMERSA",effects:[],volume:-10,pan:0},{type:"synth",name:"RD-1000 Grand",synthType:"MAMERSA",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Grand Piano",synthType:"MAMESWP30",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Synth Brass",synthType:"MAMESWP30",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Brass 1",synthType:"CZ101",effects:[],volume:-8,pan:0},{type:"synth",name:"CZ Electric Piano",synthType:"CZ101",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Synth Bass",synthType:"CZ101",effects:[],volume:-6,pan:0},{type:"synth",name:"CZ Digital Pad",synthType:"CZ101",effects:[],volume:-10,pan:0}],ng=[{type:"synth",name:"Jazz Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!0,volume:60,decay:"fast",harmonic:"third"},keyClick:40,vibrato:{type:"C3",depth:60},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Gospel Organ",synthType:"Organ",organ:{drawbars:[8,8,8,8,8,8,8,8,8],percussion:{enabled:!1,volume:50,decay:"slow",harmonic:"second"},keyClick:20,vibrato:{type:"V3",depth:40},rotary:{enabled:!0,speed:"slow"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Church Organ",synthType:"Organ",organ:{drawbars:[8,0,8,0,8,0,0,8,8],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:0,vibrato:{type:"V1",depth:20},rotary:{enabled:!1,speed:"slow"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Rock Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:80,vibrato:{type:"C3",depth:80},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-8,pan:0}],sg=[{type:"synth",name:"Generic Module",synthType:"ChiptuneModule",effects:[],volume:-6,pan:0}],rg=[...Wf,...Hf,...Kf,...$f,...ag,...Ef,...ng,...sg,...Yf,...Xf,...eg,...Jf,...qf,...of,...Af,...Qf,...Zf,...lf,...cf,...gf,...Nf,...Cf,...tg,...Mf,..._f,...Tf,...Df,...Ff,...zf,...Gf,{type:"synth",name:"Sample Player",synthType:"Player",volume:-6,pan:0,effects:[]}],ig={Bass:Wf,Leads:Hf,Pads:Kf,Drums:$f,MAME:[...ag,...Ef],Keys:ng,Module:sg,"TR-808":Yf,"TR-909":Xf,"TR-707":eg,"TR-505":Jf,Chip:qf,Furnace:[...of,...Af],FX:Qf,WAM:Zf,Dub:[...lf,...cf,...gf,...Nf,...yf],DubSiren:lf,SpaceLaser:cf,V2:[...gf,...Nf],Sam:Cf,Synare:yf,Drumnibus:[...Mf,...tg],Dexed:_f,OBXd:Tf,Samples:Df,Wavetables:Ff,Buzz:zf,Makk:Gf};function og(e){const t=ig[e];if(t&&t.length>0)return t[0];const a=rg.find(t=>t.synthType===e);if(a)return a;const n=nf.find(t=>t.synthType===e);if(n)return n;const s=yf.find(t=>t.synthType===e);return s||null}class lg{view;offset=0;size;constructor(e){e instanceof DataView?this.view=e:this.view=new DataView(e),this.size=this.view.byteLength}getOffset(){return this.offset}setOffset(e){this.offset=e}getSize(){return this.size}seek(e){this.offset=e}skip(e){this.offset+=e}isEOF(){return this.offset>=this.size}readUint8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.view.getInt8(this.offset);return this.offset+=1,e}readUint16(e=!0){const t=this.view.getUint16(this.offset,e);return this.offset+=2,t}readInt16(e=!0){const t=this.view.getInt16(this.offset,e);return this.offset+=2,t}readUint32(e=!0){const t=this.view.getUint32(this.offset,e);return this.offset+=4,t}readInt32(e=!0){const t=this.view.getInt32(this.offset,e);return this.offset+=4,t}readFloat32(e=!0){const t=this.view.getFloat32(this.offset,e);return this.offset+=4,t}readString(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);this.offset+=e;let a=0;for(;a<e&&0!==t[a];)a++;return(new TextDecoder).decode(t.slice(0,a))}readNullTerminatedString(){let e=0;for(;this.offset+e<this.size&&0!==this.view.getUint8(this.offset+e);)e++;const t=this.readString(e);return this.offset<this.size&&this.offset++,t}readPrefixedString(){const e=this.readUint8();return 0===e?"":this.readString(e)}readPrefixedString16(){const e=this.readUint16();return 0===e?"":this.readString(e)}readPrefixedString32(){const e=this.readUint32();return 0===e?"":this.readString(e)}readBytes(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,new Uint8Array(t)}readMagic(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,Array.from(t).map(e=>String.fromCharCode(e)).join("")}}class cg{static parse(e){const t=new lg(e);if(t.readMagic(16).startsWith("-Furnace instr."))return this.parseOldFormat(t);t.seek(0);const a=t.readMagic(4);if("FINS"===a||"INS2"===a||"INST"===a)return this.parseNewFormat(t,a);throw new Error(`Invalid Furnace instrument header: ${a}`)}static parseNewFormat(e,t){"INS2"===t&&e.skip(4),e.skip(2);const a=e.readUint8(),n={...kn,chipType:a,operators:Array.from({length:4},()=>({...kn.operators[0]})),macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]};let s="Furnace Instrument";const r=[];for(;!e.isEOF();)try{if(e.getOffset()+4>e.getSize())break;const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const a=e.readUint16(),i=e.getOffset()+a;if(i>e.getSize())break;switch(t){case"NA":case"NM":s=e.readString(a);break;case"FM":this.readFMFeature(e,n);break;case"WV":case"WL":case"LW":this.readWavePointers(e,r)}e.seek(i)}catch(i){break}return this.loadWavetables(e,r,n),{name:s,config:n}}static parseOldFormat(e){e.seek(16),e.skip(4);const t=e.readUint32(),a=e.readUint16(),n=e.readUint16();e.skip(4);const s=[];for(let l=0;l<a;l++)s.push(e.readUint32());if(e.skip(4*n),t>=e.getSize())throw new Error("Invalid data pointer");if(e.seek(t),"INST"!==e.readMagic(4))throw new Error("Invalid INST block");e.skip(4),e.skip(2);const r=e.readUint8();e.skip(1);const i=e.readNullTerminatedString(),o={...kn,chipType:r,operators:[],macros:[],opMacros:[],wavetables:[]};if(e.getOffset()+8<=e.getSize()){o.algorithm=e.readUint8(),o.feedback=e.readUint8(),e.skip(2);const t=e.readUint8();e.skip(3);for(let a=0;a<4&&!(e.getOffset()+12>e.getSize());a++){const n={enabled:a<t,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.getOffset()+10<=e.getSize()&&e.skip(10),o.operators.push(n)}}return 0===o.operators.length&&(o.operators=Array.from({length:4},()=>({...kn.operators[0]}))),this.loadWavetables(e,s,o),{name:i,config:o}}static readFMFeature(e,t){const a=e.readUint8(),n=15&a,s=a>>4&15;t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),e.skip(2),t.operators=[];for(let r=0;r<n;r++){const a={enabled:!!(s>>r&1),mult:15&e.readUint8(),dt:e.readUint8()>>4&7,dt2:0,tl:e.readUint8(),ar:31&e.readUint8(),dr:31&e.readUint8(),d2r:0,sl:e.readUint8()>>4&15,rr:15&e.readUint8(),rs:0,ssg:15&e.readUint8(),am:!1,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};t.operators.push(a)}}static readWavePointers(e,t){const a=e.readUint16();e.skip(2*a);for(let n=0;n<a;n++)t.push(e.readUint32())}static loadWavetables(e,t,a){for(const n of t)if(n>0&&n<e.getSize()){e.seek(n);const t=this.readWaveBlock(e);t&&a.wavetables.push(t)}}static readWaveBlock(e){if(e.getOffset()+4>e.getSize())return null;if("WAVE"!==e.readMagic(4))return null;e.skip(20);const t=e.readUint32();e.skip(8);const a=[];for(let n=0;n<t&&!(e.getOffset()+4>e.getSize());n++)a.push(e.readInt32());return{id:0,data:a}}}const ug={1:{id:1,name:"YMU759",chipType:19,fmChannels:17,psgChannels:0,totalChannels:17},2:{id:2,name:"Genesis",chipType:0,fmChannels:6,psgChannels:4,totalChannels:10},3:{id:3,name:"SMS",chipType:3,fmChannels:0,psgChannels:4,totalChannels:4},4:{id:4,name:"Game Boy",chipType:5,fmChannels:0,psgChannels:4,totalChannels:4},5:{id:5,name:"PC Engine",chipType:6,fmChannels:0,psgChannels:6,totalChannels:6},6:{id:6,name:"NES",chipType:4,fmChannels:0,psgChannels:5,totalChannels:5},7:{id:7,name:"C64",chipType:10,fmChannels:0,psgChannels:3,totalChannels:3},8:{id:8,name:"Arcade",chipType:1,fmChannels:13,psgChannels:0,totalChannels:13},9:{id:9,name:"Neo Geo",chipType:14,fmChannels:4,psgChannels:7,totalChannels:13},10:{id:10,name:"Genesis Ext",chipType:0,fmChannels:9,psgChannels:4,totalChannels:13},11:{id:11,name:"SMS + OPLL",chipType:11,fmChannels:9,psgChannels:4,totalChannels:13},12:{id:12,name:"NES + VRC7",chipType:4,fmChannels:6,psgChannels:5,totalChannels:11},13:{id:13,name:"NES + FDS",chipType:16,fmChannels:0,psgChannels:6,totalChannels:6}};class dg{static SYSTEM_MAP={1:19,2:0,3:3,4:5,5:6,6:4,7:10,8:1,9:14,10:0,11:11,12:4,13:16};static parse(e,t){const a=new lg(e),n=a.readMagic(16);if("dmf"===t){if(!n.startsWith(".DeFleMask."))throw new Error("Invalid DMF magic");return this.parseDMF(a,n)}if("dmp"===t)return a.seek(0),this.parseDMP(a);if("dmw"===t)return a.seek(0),this.parseDMW(a);throw new Error(`Unknown format: ${t}`)}static parseDMF(e,t){const a=this.extractVersion(t),n=e.readUint8(),s=ug[n]??ug[2],r={version:a,system:s,name:"",author:"",timeBase:0,ticksPerRow:[6,6],framesPerTick:1,patternRows:64,matrixRows:1,arpeggioTickSpeed:1,instruments:[],wavetables:[],patterns:[],patternMatrix:[],channelCount:s.totalChannels};if(a>=17?(r.name=e.readPrefixedString(),r.author=e.readPrefixedString(),e.readUint8(),e.readUint8()):a>=10&&(r.name=e.readNullTerminatedString(),r.author=e.readNullTerminatedString()),r.timeBase=e.readUint8(),r.ticksPerRow=[e.readUint8(),e.readUint8()],a>=14&&(r.framesPerTick=e.readUint8()),a>=19){e.readUint8()&&(e.readUint8(),e.readUint8(),e.readUint8())}r.patternRows=e.readUint32(),r.matrixRows=e.readUint8(),a>=21&&(r.arpeggioTickSpeed=e.readUint8()),r.patternMatrix=[];for(let l=0;l<r.channelCount;l++){const t=[];for(let a=0;a<r.matrixRows;a++)t.push(e.readUint8());r.patternMatrix.push(t)}const i=e.readUint8();for(let l=0;l<i;l++){const t=this.parseInstrument(e,a,s);r.instruments.push(t)}const o=e.readUint8();for(let l=0;l<o;l++){const t=e.readUint32(),a=[];for(let n=0;n<t;n++)a.push(e.readUint32());r.wavetables.push(a)}for(let l=0;l<r.channelCount;l++){const t=e.readUint8();for(let a=0;a<r.matrixRows;a++){const a={rows:[]};for(let n=0;n<r.patternRows;n++){const s={note:e.readUint16(),octave:e.readUint16(),volume:e.readInt16(),instrument:e.readInt16(),effects:[]};for(let a=0;a<t;a++){const t=e.readInt16(),a=e.readInt16();t>=0&&s.effects.push({code:t,value:a})}a.rows[n]||(a.rows[n]=[]),a.rows[n][l]=s}r.patterns.push(a)}}return r}static extractVersion(e){const t=e.match(/\.DeFleMask\.(\d+)/);return t?parseInt(t[1],10):24}static parseInstrument(e,t,a){const n=t>=17?e.readPrefixedString():e.readNullTerminatedString(),s=e.readUint8(),r={...kn,chipType:this.SYSTEM_MAP[a.id]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===s){r.algorithm=e.readUint8(),r.feedback=e.readUint8();const n=11===a.id||12===a.id?2:4;t>=19&&(e.readUint8(),e.readUint8());for(let a=0;a<n;a++){const a=this.parseOperator(e,t);r.operators.push(a)}}else this.readMacros(e,r);return{name:n,config:r}}static parseOperator(e,t){const a={enabled:!0,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt:0,dt2:0,rs:0,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};return t>=11&&(a.dt=e.readInt8(),a.rs=e.readUint8()),t>=12&&e.readUint8(),t>=15&&(a.ssg=e.readUint8()),a}static parseDMP(e){e.readUint8();const t=e.readUint8(),a=e.readUint8(),n={...kn,chipType:this.SYSTEM_MAP[t]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===a){n.algorithm=e.readUint8(),n.feedback=e.readUint8();for(let t=0;t<4;t++){const t={enabled:!0,mult:e.readUint8(),tl:e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,sl:e.readUint8(),rr:e.readUint8(),dt:e.readInt8(),dt2:0,rs:e.readUint8(),am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};n.operators.push(t)}}else this.readMacros(e,n);return{name:"DefleMask Instrument",config:n}}static parseDMW(e){const t=[];for(;!e.isEOF();)t.push(e.readUint8());return t}static readMacros(e,t){const a=["volume","arp","duty","wave","pitch"];for(const n of a){if(e.readUint8()){const s=e.readUint8(),r=e.readUint8(),i=[];for(let t=0;t<s;t++)i.push(e.readInt32());t.macros.push({type:a.indexOf(n),data:i,loop:r,release:-1,mode:0})}}}}function pg(e,t){const a={...e};for(const n of Object.keys(t)){const s=t[n],r=e[n];null!=s&&("object"!=typeof s||Array.isArray(s)||"object"!=typeof r||Array.isArray(r)?a[n]=s:a[n]=pg(r,s))}return a}function hg(e){const t={...e};switch(e.synthType){case"TB303":case"Buzz3o3":t.tb303=pg(Ln,e.tb303||{}),t.tb303?.devilFish&&(void 0===t.tb303.devilFish.filterSelect||t.tb303.devilFish.filterSelect>5)&&(t.tb303.devilFish.filterSelect=1);break;case"DrumMachine":t.drumMachine=pg(hn,e.drumMachine||{});break;case"ChipSynth":t.chipSynth=pg(mn,e.chipSynth||{});break;case"PWMSynth":t.pwmSynth=pg(fn,e.pwmSynth||{});break;case"Wavetable":t.wavetable=pg(nn,e.wavetable||{});break;case"GranularSynth":t.granular=pg(sn,e.granular||{});break;case"SuperSaw":t.superSaw=pg(un,e.superSaw||{});break;case"PolySynth":t.polySynth=pg(dn,e.polySynth||{});break;case"Organ":t.organ=pg(pn,e.organ||{});break;case"StringMachine":t.stringMachine=pg(gn,e.stringMachine||{});break;case"FormantSynth":t.formantSynth=pg(xn,e.formantSynth||{});break;case"WobbleBass":t.wobbleBass=pg(bn,e.wobbleBass||{});break;case"DubSiren":t.dubSiren=pg(Pn,e.dubSiren||{});break;case"SpaceLaser":t.spaceLaser=pg(In,e.spaceLaser||{});break;case"V2":t.v2=pg(On,e.v2||{});break;case"Sam":t.sam=pg(_n,e.sam||{});break;case"Synare":t.synare=pg(Dn,e.synare||{});break;case"Buzzmachine":t.buzzmachine=pg(vn,e.buzzmachine||{});break;case"Dexed":t.dexed=pg(Sn,e.dexed||{});break;case"OBXd":t.obxd=pg(Mn,e.obxd||{});break;case"DrumKit":t.drumKit=pg(Cn,e.drumKit||{});break;case"Furnace":t.furnace=pg(kn,e.furnace||{})}return t}function mg(e){return"string"==typeof e.note}function fg(e){return e.some(e=>{const t=e.id;return 0===t||t>0&&t%100==0&&t<3200})}function gg(e){return 0===e?1:e%100==0&&e<3200?e/100+1:e}function yg(e){const t={...e};if("string"==typeof e.note?t.note=Un(e.note):null!==e.note&&void 0!==e.note||(t.note=0),null===e.instrument||void 0===e.instrument?t.instrument=0:"number"==typeof e.instrument&&(t.instrument=gg(e.instrument)),null===e.volume||void 0===e.volume?t.volume=0:"number"==typeof e.volume&&e.volume<=64&&(t.volume=16+e.volume),"effect"in e&&"string"==typeof e.effect){const a=e.effect;if(a&&"..."!==a&&"000"!==a){const[e,n]=Kn(a);t.effTyp=e,t.eff=n}else t.effTyp=0,t.eff=0;delete t.effect}if(t.effTyp||0===t.effTyp||(t.effTyp=0),t.eff||0===t.eff||(t.eff=0),"effect2"in e&&"string"==typeof e.effect2){const a=e.effect2;if(a&&"..."!==a&&"000"!==a){const[e,n]=Kn(a);t.effTyp2=e,t.eff2=n}else t.effTyp2=0,t.eff2=0;delete t.effect2}return void 0!==t.effTyp2&&null!==t.effTyp2||(t.effTyp2=0),void 0!==t.eff2&&null!==t.eff2||(t.eff2=0),t}function bg(e){return{...e,channels:e.channels.map(e=>({...e,rows:e.rows.map(e=>yg(e)),instrumentId:null!==e.instrumentId&&void 0!==e.instrumentId?gg(e.instrumentId):1}))}}function vg(e){const t=new Map;let a=1;for(const n of e)if(!t.has(n.id)){const e=gg(n.id);Array.from(t.values()).includes(e)?t.set(n.id,a++):(t.set(n.id,e),a=Math.max(a,e+1))}return e.map(e=>{const a=t.get(e.id)??e.id,n="Sampler"===e.synthType||"Player"===e.synthType?"sample":"synth";return{...hg(e),id:a,type:e.type||n}})}function xg(e,t){const a=e.some(e=>e.channels.some(e=>e.rows.some(e=>mg(e)))),n=fg(t),s=t.some(e=>!e.type),r=t.some(e=>function(e){switch(e.synthType){case"TB303":case"Buzz3o3":return!e.tb303||!e.tb303.filter||!e.tb303.filterEnvelope;case"DrumMachine":return!e.drumMachine;case"ChipSynth":return!e.chipSynth||!e.chipSynth.envelope;case"PWMSynth":return!e.pwmSynth||!e.pwmSynth.envelope;case"SuperSaw":return!e.superSaw||!e.superSaw.envelope;case"PolySynth":return!e.polySynth||!e.polySynth.envelope;case"Organ":return!e.organ||!e.organ.drawbars;case"StringMachine":return!e.stringMachine;case"FormantSynth":return!e.formantSynth||!e.formantSynth.envelope;case"WobbleBass":return!e.wobbleBass||!e.wobbleBass.envelope;case"DubSiren":return!e.dubSiren||!e.dubSiren.reverb;case"SpaceLaser":return!e.spaceLaser;case"Dexed":return!e.dexed;case"OBXd":return!e.obxd;case"DrumKit":return!e.drumKit;case"Furnace":return!e.furnace;default:return!1}}(e));return a||n||s||r}function wg(e,t){return{patterns:e.map(e=>bg(e)),instruments:vg(t)}}const kg=Object.freeze(Object.defineProperty({__proto__:null,deepMerge:pg,ensureCompleteInstrumentConfig:hg,hasOldInstrumentIds:fg,isOldFormatCell:mg,migrateCell:yg,migrateInstrumentId:gg,migrateInstruments:vg,migratePattern:bg,migrateProject:wg,needsMigration:xg},Symbol.toStringTag,{value:"Module"}));class Sg{static reverse(e){const t=e.numberOfChannels,a=e.length,n=e.sampleRate,s=new AudioBuffer({length:a,numberOfChannels:t,sampleRate:n});for(let r=0;r<t;r++){const t=e.getChannelData(r),n=s.getChannelData(r);for(let e=0;e<a;e++)n[e]=t[a-1-e]}return s}static normalize(e){const t=e.numberOfChannels,a=e.length,n=e.sampleRate;let s=0;for(let o=0;o<t;o++){const t=e.getChannelData(o);for(let e=0;e<a;e++){const a=Math.abs(t[e]);a>s&&(s=a)}}if(0===s||1===s)return e;const r=1/s,i=new AudioBuffer({length:a,numberOfChannels:t,sampleRate:n});for(let o=0;o<t;o++){const t=e.getChannelData(o),n=i.getChannelData(o);for(let e=0;e<a;e++)n[e]=t[e]*r}return i}static invertLoop(e,t,a){const n=e.numberOfChannels,s=e.length,r=e.sampleRate,i=new AudioBuffer({length:s,numberOfChannels:n,sampleRate:r});for(let o=0;o<n;o++){const n=e.getChannelData(o),r=i.getChannelData(o);for(let e=0;e<t;e++)r[e]=n[e];for(let e=t;e<a&&e<s;e++)r[e]=-n[e];for(let e=a;e<s;e++)r[e]=n[e]}return i}static applyGain(e,t){const a=e.numberOfChannels,n=e.length,s=e.sampleRate,r=new AudioBuffer({length:n,numberOfChannels:a,sampleRate:s});for(let i=0;i<a;i++){const a=e.getChannelData(i),s=r.getChannelData(i);for(let e=0;e<n;e++)s[e]=a[e]*t}return r}static async bufferToWav(e){const t=e.numberOfChannels,a=e.sampleRate,n=e.length,s=2*t,r=a*s,i=n*s,o=44+i,l=new ArrayBuffer(o),c=new DataView(l);this.writeString(c,0,"RIFF"),c.setUint32(4,o-8,!0),this.writeString(c,8,"WAVE"),this.writeString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,a,!0),c.setUint32(28,r,!0),c.setUint16(32,s,!0),c.setUint16(34,16,!0),this.writeString(c,36,"data"),c.setUint32(40,i,!0);let u=44;for(let d=0;d<n;d++)for(let a=0;a<t;a++){let t=e.getChannelData(a)[d];t=Math.max(-1,Math.min(1,t));const n=t<0?32768*t:32767*t;c.setInt16(u,n,!0),u+=2}return l}static writeString(e,t,a){for(let n=0;n<a.length;n++)e.setUint8(t+n,a.charCodeAt(n))}}function Mg(e){e&&(e.url&&URL.revokeObjectURL(e.url),e.multiMap&&Object.values(e.multiMap).forEach(e=>URL.revokeObjectURL(e)))}const Ng=new Set;function Cg(e,t){const a=new Set;return e.forEach(e=>{e.rows.forEach(e=>{e.cells.forEach(e=>{e.instrument===t&&e.note&&a.add(e.note)})})}),Array.from(a).sort()}function Eg(e){for(let t=1;t<=128;t++)if(!e.includes(t))return t;return 1}const Pg=n()(Fa((e,t)=>({instruments:[],currentInstrumentId:0,get currentInstrument(){const e=t();return e.instruments.find(t=>t.id===e.currentInstrumentId)||null},previewInstrument:null,presets:[],setCurrentInstrument:t=>e(e=>{e.instruments.find(e=>e.id===t)&&(e.currentInstrumentId=t)}),setPreviewInstrument:t=>e(e=>{e.previewInstrument=t}),getInstrument:e=>t().instruments.find(t=>t.id===e),updateInstrument:(a,n)=>{const s=t().instruments.find(e=>e.id===a),r=s&&n.synthType&&n.synthType!==s.synthType,i=n.name&&n.synthType,o=!!(n.oscillator||n.envelope||n.filter||n.filterEnvelope||n.superSaw||n.polySynth||n.organ||n.drumMachine||n.chipSynth||n.pwmSynth||n.stringMachine||n.formantSynth||n.wavetable||n.granular||n.furnace||n.dubSiren||n.synare||n.sam||n.v2Speech||n.tb303||n.buzzmachine||n.spaceLaser||n.v2||n.wam);if(e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const{id:e,...a}=n;if(Object.keys(a).forEach(e=>{const n=a[e];n&&"object"==typeof n&&!Array.isArray(n)&&t[e]?t[e]={...t[e],...n}:t[e]=n}),r&&n.synthType?.startsWith("Furnace")){const e=Dm(n.synthType);e&&(t.furnace=e)}if(r&&"DubSiren"===n.synthType&&!t.dubSiren&&(t.dubSiren={...Pn}),r&&"SpaceLaser"===n.synthType&&!t.spaceLaser&&(t.spaceLaser={...In}),r&&"V2"===n.synthType&&!t.v2&&(t.v2={...On}),r&&"Synare"===n.synthType&&!t.synare&&(t.synare={...Dn}),r&&"Sam"===n.synthType&&!t.sam&&(t.sam={..._n}),r&&!i&&n.synthType){const e=t.furnace?.chipType,a=t.buzzmachine?.machineType,s=og(n.synthType);if(s){const{name:r,type:i,synthType:o,...l}=s;Object.keys(l).forEach(e=>{const a=l[e];a&&"object"==typeof a&&!Array.isArray(a)&&t[e]?Object.assign(t[e],a):t[e]=a}),t.synthType=n.synthType,void 0!==e&&t.furnace&&(t.furnace.chipType=e),a&&t.buzzmachine&&(t.buzzmachine.machineType=a)}}}}),!r&&!i)try{const s=Km(),r=t().instruments.find(e=>e.id===a);if(r){if(("TB303"===r.synthType||"Buzz3o3"===r.synthType)&&r.tb303&&n.tb303)return void s.updateTB303Parameters(a,r.tb303);if("DubSiren"===r.synthType&&r.dubSiren&&n.dubSiren)return void s.updateDubSirenParameters(a,r.dubSiren);if("SpaceLaser"===r.synthType&&r.spaceLaser&&n.spaceLaser)return void s.updateSpaceLaserParameters(a,r.spaceLaser);if("V2"===r.synthType&&r.v2&&n.v2)return void s.updateV2Parameters(a,r.v2);if("V2"===r.synthType&&r.v2Speech&&n.v2Speech)return void s.updateComplexSynthParameters(a,r.v2Speech);if("Sam"===r.synthType&&r.sam&&n.sam)return void s.updateComplexSynthParameters(a,r.sam);if("Synare"===r.synthType&&r.synare&&n.synare)return void s.updateSynareParameters(a,r.synare);if(r.synthType?.startsWith("Furnace")&&r.furnace&&n.furnace)return void s.updateFurnaceInstrument(a,r);if("Buzz3o3"===r.synthType&&r.tb303&&n.tb303){const t=r.tb303,n=r.buzzmachine||{machineType:"OomekAggressor",parameters:{}},i={...n.parameters};return i[0]="square"===t.oscillator.type?1:0,i[1]=Math.round(Math.log2(t.filter.cutoff/200)/Math.log2(25)*240),i[2]=Math.round(t.filter.resonance/100*128),i[3]=Math.round(t.filterEnvelope.envMod/100*128),i[4]=Math.round(Math.log2(t.filterEnvelope.decay/30)/Math.log2(100)*128),i[5]=Math.round(t.accent.amount/100*128),i[6]=Math.round((t.tuning||0)+100),e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.buzzmachine={...n,parameters:i})}),void s.updateBuzzmachineParameters(a,{...n,parameters:i})}if(r.synthType.startsWith("Buzz")&&r.buzzmachine&&n.buzzmachine)return void s.updateBuzzmachineParameters(a,r.buzzmachine);if(("Furnace"===r.synthType||r.synthType.startsWith("Furnace"))&&r.furnace&&n.furnace)return void s.updateFurnaceParameters(a,r.furnace);if("WAM"===r.synthType&&r.wam&&n.wam)return void s.updateWAMParameters(a,r.wam);if(["SuperSaw","WobbleBass","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth"].includes(r.synthType)){const e=r.synthType.charAt(0).toLowerCase()+r.synthType.slice(1),t=r[e];if(t&&n[e])return void s.updateComplexSynthParameters(a,t)}}}catch(l){}if(r||i||o)try{Km().invalidateInstrument(a)}catch(l){}},createInstrument:a=>{const n=Eg(t().instruments.map(e=>e.id));return e(e=>{const t={id:s=n,name:`TB303 ${String(s).padStart(2,"0")}`,type:"synth",synthType:"TB303",tb303:{...Ln},oscillator:{...Fn},envelope:{...Rn},filter:{...jn},effects:[],volume:-6,pan:0};var s;const r=a?pg(t,a):t;r.id=n,e.instruments.push(r),e.currentInstrumentId=n}),n},addInstrument:t=>{e(e=>{const a=e.instruments.find(e=>e.id===t.id);a?Object.assign(a,t):e.instruments.push({...t}),e.currentInstrumentId=t.id})},deleteInstrument:t=>e(e=>{const a=e.instruments.findIndex(e=>e.id===t);-1!==a&&e.instruments.length>1&&(Mg(e.instruments[a].sample),e.instruments.splice(a,1),e.currentInstrumentId===t&&(e.currentInstrumentId=e.instruments[0].id))}),cloneInstrument:a=>{const n=t().instruments.find(e=>e.id===a);if(!n)return a;const s=Eg(t().instruments.map(e=>e.id));return e(e=>{const t=JSON.parse(JSON.stringify(n));t.id=s,t.name=`${n.name} (Copy)`,e.instruments.push(t),e.currentInstrumentId=s}),s},resetInstrument:t=>{e(e=>{const a=e.instruments.find(e=>e.id===t);if(a){const e=a.synthType,t=function(e){const t={synthType:e,effects:[],volume:-12,pan:0};switch(e){case"TB303":t.tb303={...Ln};break;case"DrumMachine":t.drumMachine={...hn};break;case"ChipSynth":t.chipSynth={...mn};break;case"PWMSynth":t.pwmSynth={...fn};break;case"Wavetable":t.wavetable={...nn};break;case"GranularSynth":t.granular={...sn};break;case"SuperSaw":t.superSaw={...un};break;case"PolySynth":t.polySynth={...dn};break;case"Organ":t.organ={...pn};break;case"StringMachine":t.stringMachine={...gn};break;case"FormantSynth":t.formantSynth={...xn};break;case"WobbleBass":t.wobbleBass={...bn};break;case"DubSiren":t.dubSiren={...Pn};break;case"SpaceLaser":t.spaceLaser={...In};break;case"V2":t.v2={...On};break;case"Sam":t.sam={..._n};break;case"Synare":t.synare={...Dn};break;case"WAM":t.wam={...Tn};break;case"Buzz3o3":t.tb303={...Ln},t.buzzmachine={...vn,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}};break;case"Buzzmachine":t.buzzmachine={...vn};break;case"Dexed":t.dexed={...Sn};break;case"OBXd":t.obxd={...Mn};break;case"DrumKit":t.drumKit={...Cn};break;case"ChiptuneModule":t.chiptuneModule={...cn};break;case"MAMEVFX":t.mame={...rn};break;case"MAMEDOC":t.mame={...on};break;case"MAMERSA":t.rdpiano={...Nn};break;case"MAMESWP30":t.mame={...ln}}const a=og(e);if(a){const{name:n,type:s,synthType:r,...i}=a;Object.assign(t,i),t.synthType=e}return t}(e);if(Object.assign(a,{...t,synthType:e,name:a.name,tb303:void 0,drumMachine:void 0,chipSynth:void 0,pwmSynth:void 0,wavetable:void 0,granular:void 0,superSaw:void 0,polySynth:void 0,organ:void 0,stringMachine:void 0,formantSynth:void 0,furnace:void 0,chiptuneModule:void 0,wobbleBass:void 0,drumKit:void 0,dubSiren:void 0,spaceLaser:void 0,synare:void 0,v2:void 0}),"TB303"===e||"Buzz3o3"===e)a.tb303={...Ln},"Buzz3o3"===e&&(a.buzzmachine={...vn,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}});else if("DubSiren"===e)a.dubSiren={...Pn};else if("SpaceLaser"===e)a.spaceLaser={...In};else if("V2"===e)a.v2={...On};else if("Synare"===e)a.synare={...Dn};else if(e.startsWith("Furnace")){const t=Dm(e);t&&(a.furnace=t)}}});try{Km().invalidateInstrument(t)}catch(a){}},bakeInstrument:async(a,n="lite")=>{const s=t().instruments.find(e=>e.id===a);if(s&&"Sampler"!==s.synthType&&!Ng.has(a)){Ng.add(a);try{const r=Km();s.sample&&Mg(s.sample);const i=JSON.parse(JSON.stringify(s));if(delete i.metadata,"pro"===n){const n=Cg((await _a(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>af);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,a);if(0===n.length)return t().bakeInstrument(a,"lite");const o={};for(const e of n){const t=await r.bakeInstrument(s,2,e),a=await Sg.bufferToWav(t),n=new Blob([a],{type:"audio/wav"});o[e]=URL.createObjectURL(n)}e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:i,bakeType:"pro"}},t.synthType="Sampler",t.sample={url:"",multiMap:o,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}else{const t=await r.bakeInstrument(s,2,"C4"),n=await Sg.bufferToWav(t),o=new Blob([n],{type:"audio/wav"}),l=URL.createObjectURL(o);e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:i,bakeType:"lite"}},t.synthType="Sampler",t.sample={url:l,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}r.invalidateInstrument(a)}catch(r){}finally{Ng.delete(a)}}},unbakeInstrument:a=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t&&t.metadata?.preservedSynth){const{synthType:e,config:a}=t.metadata.preservedSynth;Mg(t.sample);const n={...t.metadata};delete n.preservedSynth,Object.assign(t,a),t.synthType=e,t.metadata=n,t.sample=void 0}});try{const e=Km();e.invalidateInstrument(a);const n=t().instruments.find(e=>e.id===a);n&&e.rebuildInstrumentEffects(a,n.effects)}catch(n){}},autoBakeInstruments:async()=>{const a=t().instruments.filter(e=>e.metadata?.preservedSynth&&!e.sample?.url&&!e.sample?.multiMap);if(0!==a.length)for(const t of a){const a=t.metadata.preservedSynth,s={...t,...a.config,synthType:a.synthType},r=a.bakeType||"lite";try{const a=Km();if("pro"===r){const n=Cg((await _a(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>af);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,t.id),r={};for(const e of n){const t=await a.bakeInstrument(s,2,e),n=await Sg.bufferToWav(t),i=new Blob([n],{type:"audio/wav"});r[e]=URL.createObjectURL(i)}e(e=>{const a=e.instruments.find(e=>e.id===t.id);a&&a.sample&&(a.sample.multiMap=r)})}else{const n=await a.bakeInstrument(s,2,"C4"),r=await Sg.bufferToWav(n),i=new Blob([r],{type:"audio/wav"}),o=URL.createObjectURL(i);e(e=>{const a=e.instruments.find(e=>e.id===t.id);a&&a.sample&&(a.sample.url=o)})}a.invalidateInstrument(t.id)}catch(n){}}},addEffect:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:n,enabled:!0,wet:50,parameters:{}};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Km();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},addEffectConfig:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e={...n,id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Km();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},removeEffect:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e=t.effects.findIndex(e=>e.id===n);-1!==e&&t.effects.splice(e,1)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Km();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},updateEffect:(a,n,s)=>{if(e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e=t.effects.find(e=>e.id===n);e&&Object.assign(e,s)}}),void 0!==s.enabled){const e=t().instruments.find(e=>e.id===a);e&&(async()=>{try{const t=Km();await t.rebuildInstrumentEffects(a,e.effects)}catch(t){}})()}else{const e=t().instruments.find(e=>e.id===a),s=e?.effects.find(e=>e.id===n);if(s)try{Km().updateInstrumentEffectParams(n,s)}catch{}}const r=t().instruments.find(e=>e.id===a),i=r?.effects.find(e=>e.id===n);if(1===i?.parameters.bpmSync)try{const e=Km(),t=e.getBPM();e.updateBpmSyncedEffects(t)}catch{}},reorderEffects:(a,n,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const[e]=t.effects.splice(n,1);t.effects.splice(s,0,e)}});const r=t().instruments.find(e=>e.id===a);r&&(async()=>{try{const e=Km();await e.rebuildInstrumentEffects(a,r.effects)}catch(e){}})()},loadPreset:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===a);n&&(Object.assign(n,t.config),n.id=a)});try{Km().invalidateInstrument(a)}catch(n){}},saveAsPreset:(t,a,n)=>e(e=>{const s=e.instruments.find(e=>e.id===t);if(s){const t={id:`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:a,category:n,tags:[],author:"User",config:{name:s.name,type:s.type,synthType:s.synthType,oscillator:s.oscillator,envelope:s.envelope,filter:s.filter,filterEnvelope:s.filterEnvelope,tb303:s.tb303,effects:s.effects,volume:s.volume,pan:s.pan}};e.presets.push(t)}}),loadInstruments:a=>{const n=Km();t().instruments.forEach(e=>{try{n.invalidateInstrument(e.id)}catch(t){}});const s=a.map(e=>({...hg(e),synthType:e.tb303&&"TB303"!==e.synthType&&"Buzz3o3"!==e.synthType?"TB303":e.synthType,type:e.type||("Sampler"===e.synthType?"sample":"synth"),effects:e.effects?.map(e=>({...e,category:e.category||"tonejs"}))||[]}));e(e=>{e.instruments=s,e.currentInstrumentId=s.length>0?s[0].id:null}),Km().preloadInstruments(s).catch(e=>{})},loadFurnaceInstrument:a=>{try{const{name:n,config:s}=cg.parse(a),r=Eg(t().instruments.map(e=>e.id));e(e=>{const t={id:r,name:n||"Furnace Patch",type:"synth",synthType:"Furnace",furnace:s,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=r})}catch(n){}},loadDefleMaskInstrument:a=>{try{const n=dg.parse(a,"dmp"),{name:s,config:r}=n,i=Eg(t().instruments.map(e=>e.id));e(e=>{const t={id:i,name:s||"DefleMask Patch",type:"synth",synthType:"Furnace",furnace:r,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=i})}catch(n){}},loadDefleMaskWavetable:a=>{try{const n=dg.parse(a,"dmw"),s=t().currentInstrumentId;if(!s)return;e(e=>{const t=e.instruments.find(e=>e.id===s);"Furnace"===t?.synthType&&t.furnace&&t.furnace.wavetables.push({id:t.furnace.wavetables.length,data:n})})}catch(n){}},transformInstrument:(a,n,s)=>{const r=t().instruments.find(e=>e.id===a);if(!r)return;if("Sampler"!==r.synthType)return;const i=r.sample?{...r.sample,envelope:r.envelope||{...Rn}}:void 0;if(!i)return;let o;function l(t,a,n,s,r){e(e=>{const r=e.instruments.find(e=>e.id===t);if(!r)return;delete r.tb303,delete r.polySynth,delete r.wavetable,delete r.granular,delete r.superSaw,delete r.organ,delete r.drumMachine,delete r.chipSynth,delete r.pwmSynth,delete r.stringMachine,delete r.formantSynth,delete r.sample,r.type="synth",r.synthType=a;r[a.toLowerCase()]=n,r.metadata||(r.metadata={}),r.metadata.preservedSample=s,r.metadata.transformHistory||(r.metadata.transformHistory=[]),r.metadata.transformHistory.push({timestamp:(new Date).toISOString(),fromType:"Sampler",toType:a})});try{Km().invalidateInstrument(t)}catch(i){}}"analyze"===s?_a(async()=>{const{analyzeSample:e,suggestSynthConfig:t}=await Promise.resolve().then(()=>iP);return{analyzeSample:e,suggestSynthConfig:t}},void 0).then(({analyzeSample:e,suggestSynthConfig:t})=>{const s=e({id:a,name:r.name,pcmData:i.audioBuffer||new ArrayBuffer(0),loopStart:i.loopStart,loopLength:i.loopEnd-i.loopStart,loopType:i.loop?"forward":"none",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:44100,length:1e3},r.metadata?.originalEnvelope);o=t(n,s),l(a,n,o,i)}):(o=function(e){switch(e){case"TB303":return{...Ln};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{...Fn},envelope:{...Rn},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{...Rn},filter:{...jn,cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{...Rn}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{...Rn,attack:5,decay:300},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{...Fn},envelope:{...Rn}}}}(n),l(a,n,o,i))},revertToSample:a=>{const n=t().instruments.find(e=>e.id===a);if(!n)return;const s=n.metadata?.preservedSample;if(s){e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(delete t.tb303,delete t.polySynth,delete t.wavetable,delete t.granular,delete t.superSaw,delete t.organ,delete t.drumMachine,delete t.chipSynth,delete t.pwmSynth,delete t.stringMachine,delete t.formantSynth,t.type="sample",t.synthType="Sampler",t.sample={audioBuffer:s.audioBuffer,url:s.url,baseNote:s.baseNote,detune:s.detune,loop:s.loop,loopStart:s.loopStart,loopEnd:s.loopEnd,reverse:!1,playbackRate:1},t.envelope=s.envelope)});try{Km().invalidateInstrument(a)}catch(r){}}},reverseSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer)return;const s=n.sample.audioBuffer,r=await Km().decodeAudioData(s),i=Sg.reverse(r),o=await Km().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Km().invalidateInstrument(a)},normalizeSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer)return;const s=n.sample.audioBuffer,r=await Km().decodeAudioData(s),i=Sg.normalize(r),o=await Km().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Km().invalidateInstrument(a)},invertLoopSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer||!n.sample.loop)return;const s=n.sample.audioBuffer,r=await Km().decodeAudioData(s),i=Sg.invertLoop(r,n.sample.loopStart,n.sample.loopEnd),o=await Km().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Km().invalidateInstrument(a)},updateSampleBuffer:async(a,n)=>{const s=t().instruments.find(e=>e.id===a);if(!s?.sample)return;const r=await Km().encodeAudioData(n);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=r)}),Km().invalidateInstrument(a)},updateSlices:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);n?.sample&&(n.sample.slices=a)})},updateSliceConfig:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);n?.sample&&(n.sample.sliceConfig=a)})},removeSlice:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);if(n?.sample?.slices){const e=n.sample.slices,t=e.findIndex(e=>e.id===a);if(-1!==t&&e.length>1){const a=e[t];t>0?(e[t-1].endFrame=a.endFrame,e[t-1].endTime=a.endTime):t<e.length-1&&(e[t+1].startFrame=a.startFrame,e[t+1].startTime=a.startTime),e.splice(t,1)}}})},createSlicedInstruments:async(a,n,s="Slice")=>{const r=t().instruments.find(e=>e.id===a);if(!r?.sample?.url)return[];const i=[],o=Km();try{const a=await fetch(r.sample.url),l=await a.arrayBuffer(),c=await o.decodeAudioData(l),u=t().instruments.map(e=>e.id);for(let t=0;t<n.length;t++){const a=n[t],l=Eg([...u,...i]);i.push(l);const d=a.endFrame-a.startFrame,p=c.numberOfChannels,h=c.sampleRate,m=new OfflineAudioContext(p,d,h).createBuffer(p,d,h);for(let e=0;e<p;e++){const t=c.getChannelData(e),n=m.getChannelData(e);for(let e=0;e<d;e++)n[e]=t[a.startFrame+e]}const f=await o.encodeAudioData(m),g=new Blob([f],{type:"audio/wav"}),y=await new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(g)}),b=a.label||`${s} ${t+1}`,v=r.name?`${r.name} - ${b}`:b;e(e=>{const t={id:l,name:v.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:y,audioBuffer:f,baseNote:r.sample?.baseNote||"C-4",detune:r.sample?.detune||0,loop:!1,loopStart:0,loopEnd:d,sampleRate:h,reverse:!1,playbackRate:1},envelope:r.envelope||{...Rn},effects:[],volume:r.volume||-6,pan:r.pan||0};e.instruments.push(t)})}return i.length>0&&e(e=>{e.currentInstrumentId=i[0]}),i}catch(l){return[]}},reset:()=>{const a=Km();t().instruments.forEach(e=>{try{a.invalidateInstrument(e.id)}catch(t){}}),e(e=>{e.instruments=[{...nf[0],id:1,type:"synth"}],e.currentInstrumentId=1,e.presets=[]})}}))),_g=Object.freeze(Object.defineProperty({__proto__:null,useInstrumentStore:Pg},Symbol.toStringTag,{value:"Module"})),Tg=n()(Gm(Fa((e,t)=>({visiblePanels:["tracker","oscilloscope","pattern-list"],trackerZoom:100,activePanel:"tracker",modalOpen:null,sidebarCollapsed:!1,useHexNumbers:!0,rowHighlightInterval:4,showBeatLabels:!1,chordEntryMode:!1,blankEmptyCells:!1,tb303Collapsed:!0,oscilloscopeVisible:!0,compactToolbar:!1,autoCompactApplied:!1,showSamplePackModal:!1,uiVersion:8,performanceQuality:"high",statusMessage:"All Right",prevStatusMessage:"All Right",pendingModuleFile:null,togglePanel:t=>e(e=>{const a=e.visiblePanels.indexOf(t);-1!==a?e.visiblePanels.splice(a,1):e.visiblePanels.push(t)}),setActivePanel:t=>e(e=>{e.activePanel=t,e.visiblePanels.includes(t)||e.visiblePanels.push(t)}),setTrackerZoom:t=>e(e=>{e.trackerZoom=Math.max(80,Math.min(200,t))}),openModal:t=>e(e=>{e.modalOpen=t}),closeModal:()=>e(e=>{e.modalOpen=null}),toggleSidebar:()=>e(e=>{e.sidebarCollapsed=!e.sidebarCollapsed}),setSidebarCollapsed:t=>e(e=>{e.sidebarCollapsed=t}),setUseHexNumbers:t=>e(e=>{e.useHexNumbers=t}),setRowHighlightInterval:t=>e(e=>{e.rowHighlightInterval=Math.max(1,Math.min(32,t))}),toggleBeatLabels:()=>e(e=>{e.showBeatLabels=!e.showBeatLabels}),toggleChordEntryMode:()=>e(e=>{e.chordEntryMode=!e.chordEntryMode}),setBlankEmptyCells:t=>e(e=>{e.blankEmptyCells=t}),setStatusMessage:(t,a=!1,n=2e3)=>e(e=>{a&&(e.prevStatusMessage=t),e.statusMessage=t,n>0&&(window._statusTimeout&&clearTimeout(window._statusTimeout),window._statusTimeout=setTimeout(()=>{const e=Tg.getState().prevStatusMessage;Tg.getState().setStatusMessage(e||"All Right",!1,0),window._statusTimeout=null},n))}),toggleTB303Collapsed:()=>e(e=>{e.tb303Collapsed=!e.tb303Collapsed}),setTB303Collapsed:t=>e(e=>{e.tb303Collapsed=t}),toggleOscilloscopeVisible:()=>e(e=>{e.oscilloscopeVisible=!e.oscilloscopeVisible}),setOscilloscopeVisible:t=>e(e=>{e.oscilloscopeVisible=t}),toggleCompactToolbar:()=>e(e=>{e.compactToolbar=!e.compactToolbar}),setCompactToolbar:t=>e(e=>{e.compactToolbar=t}),applyAutoCompact:()=>e(e=>{const t="undefined"!=typeof window?window.innerHeight:1080;e.uiVersion<8&&(e.uiVersion=8,e.tb303Collapsed=!0,e.compactToolbar=!1),e.autoCompactApplied||(e.autoCompactApplied=!0,t<800&&(e.oscilloscopeVisible=!1))}),setShowSamplePackModal:t=>e(e=>{e.showSamplePackModal=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setPendingModuleFile:t=>e(e=>{e.pendingModuleFile=t})})),{name:"devilbox-ui-settings",partialize:e=>({tb303Collapsed:e.tb303Collapsed,oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar,sidebarCollapsed:e.sidebarCollapsed,trackerZoom:e.trackerZoom,useHexNumbers:e.useHexNumbers,rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels,chordEntryMode:e.chordEntryMode,blankEmptyCells:e.blankEmptyCells,performanceQuality:e.performanceQuality,uiVersion:e.uiVersion})})),Ag=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:Tg},Symbol.toStringTag,{value:"Module"}));let Og,Ig=0,Dg=null,Fg=null;const Rg=n()(Fa((e,t)=>({bpm:125,timeSignature:[4,4],swing:100,position:"0:0:0",isPlaying:!1,isPaused:!1,isLooping:!0,currentRow:0,currentPatternIndex:0,continuousRow:0,smoothScrolling:!1,metronomeEnabled:!1,metronomeVolume:75,speed:6,loopStartRow:0,grooveTemplateId:"straight",grooveSteps:2,jitter:0,useMpcScale:!1,setBPM:t=>e(e=>{e.bpm=Math.max(20,Math.min(999,t));try{Tg.getState().setStatusMessage(`BPM ${e.bpm}`,!1,1500)}catch(a){}}),setTimeSignature:(t,a)=>e(e=>{e.timeSignature=[t,a]}),setSwing:t=>e(e=>{e.useMpcScale?e.swing=Math.max(50,Math.min(75,t)):e.swing=Math.max(0,Math.min(200,t))}),setJitter:t=>e(e=>{e.jitter=Math.max(0,Math.min(100,t))}),setUseMpcScale:t=>e(e=>{e.useMpcScale!==t&&(e.useMpcScale=t,e.swing=t?50+e.swing/200*25:(e.swing-50)/25*200)}),setPosition:t=>e(e=>{e.position=t}),play:()=>{Pg.getState().autoBakeInstruments(),e(e=>{e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow})},pause:()=>e(e=>{e.isPlaying=!1,e.isPaused=!0}),stop:()=>e(e=>{e.isPlaying=!1,e.isPaused=!1,e.currentRow=0,e.continuousRow=0,e.position="0:0:0"}),togglePlayPause:()=>{t().isPlaying||Pg.getState().autoBakeInstruments(),e(e=>{e.isPlaying?(e.isPlaying=!1,e.isPaused=!0):(e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow)})},setIsLooping:t=>e(e=>{e.isLooping=t}),setCurrentRow:(t,a)=>e(e=>{const n=e.currentRow;if(e.currentRow=t,t>n)e.continuousRow+=t-n;else if(t===n);else if(t<n){if(a?n-t>=a/2:0===t&&n>2){const s=a||n+1;e.continuousRow+=s-n+t}}}),setCurrentRowThrottled:(e,a)=>{const n=performance.now();Dg=e,Og=a,n-Ig>=20?(Ig=n,t().setCurrentRow(e,a),Dg=null,Og=void 0,null!==Fg&&(window.clearTimeout(Fg),Fg=null)):null===Fg&&(Fg=window.setTimeout(()=>{null!==Dg&&(Ig=performance.now(),t().setCurrentRow(Dg,Og),Dg=null,Og=void 0),Fg=null},20-(n-Ig)))},setCurrentPattern:t=>e(e=>{e.currentPatternIndex=t}),setSmoothScrolling:t=>e(e=>{e.smoothScrolling=t}),setMetronomeEnabled:t=>e(e=>{e.metronomeEnabled=t}),setMetronomeVolume:t=>e(e=>{e.metronomeVolume=Math.max(0,Math.min(100,t))}),toggleMetronome:()=>e(e=>{e.metronomeEnabled=!e.metronomeEnabled}),setSpeed:t=>e(e=>{e.speed=Math.max(1,Math.min(31,t))}),setLoopStartRow:t=>e(e=>{e.loopStartRow=Math.max(0,t)}),setGrooveTemplate:t=>e(e=>{Bn.find(e=>e.id===t)&&(e.grooveTemplateId=t)}),setGrooveSteps:t=>e(e=>{e.grooveSteps=Math.max(1,Math.min(64,t))}),getGrooveTemplate:()=>{const e=t();return Bn.find(t=>t.id===e.grooveTemplateId)||Bn[0]},reset:()=>e(e=>{e.bpm=125,e.timeSignature=[4,4],e.swing=100,e.position="0:0:0",e.isPlaying=!1,e.isPaused=!1,e.isLooping=!0,e.currentRow=0,e.currentPatternIndex=0,e.continuousRow=0,e.speed=6,e.loopStartRow=0,e.grooveTemplateId="straight",e.grooveSteps=2,e.jitter=0,e.useMpcScale=!1})}))),jg=Object.freeze(Object.defineProperty({__proto__:null,useTransportStore:Rg},Symbol.toStringTag,{value:"Module"})),Lg=n()(Fa((e,t)=>({initialized:!1,contextState:"suspended",masterVolume:0,masterMuted:!1,analyserNode:null,fftNode:null,toneEngineInstance:null,masterEffects:[],setInitialized:t=>e(e=>{e.initialized=t}),setContextState:t=>e(e=>{e.contextState=t}),setMasterVolume:a=>e(e=>{e.masterVolume=Math.max(-60,Math.min(0,a));const n=t().toneEngineInstance;n&&n.setMasterVolume(e.masterVolume)}),setMasterMuted:a=>e(e=>{e.masterMuted=a;const n=t().toneEngineInstance;n&&n.setMasterMute(a)}),toggleMasterMute:()=>e(e=>{e.masterMuted=!e.masterMuted;const a=t().toneEngineInstance;a&&a.setMasterMute(e.masterMuted)}),setAnalyserNode:t=>e(e=>{e.analyserNode=t}),setFFTNode:t=>e(e=>{e.fftNode=t}),setToneEngineInstance:t=>e(e=>{e.toneEngineInstance=t}),addMasterEffect:a=>e(e=>{const n={id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:a,enabled:!0,wet:50,parameters:{}};e.masterEffects.push(n);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),addMasterEffectConfig:a=>e(e=>{const n={...a,id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};e.masterEffects.push(n);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),removeMasterEffect:a=>e(e=>{const n=e.masterEffects.findIndex(e=>e.id===a);if(-1!==n){e.masterEffects.splice(n,1);const a=JSON.parse(JSON.stringify(e.masterEffects)),s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(a)}catch(e){}})()}}),updateMasterEffect:(a,n)=>e(e=>{const s=e.masterEffects.find(e=>e.id===a);if(s){Object.assign(s,n);const e=t().toneEngineInstance;if(e&&(e.updateMasterEffectParams(a,s),1===s.parameters.bpmSync)){const t=e.getBPM();e.updateBpmSyncedEffects(t)}}}),reorderMasterEffects:(a,n)=>e(e=>{const[s]=e.masterEffects.splice(a,1);e.masterEffects.splice(n,0,s);const r=JSON.parse(JSON.stringify(e.masterEffects)),i=t().toneEngineInstance;i&&(async()=>{try{await i.rebuildMasterEffects(r)}catch(e){}})()}),setMasterEffects:a=>e(e=>{const n=a.map(e=>({...e,category:e.category||"tonejs"}));e.masterEffects=n;const s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(n)}catch(e){}})()})}))),Bg=n()(Fa((e,t)=>({metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},isDirty:!1,lastSavedAt:null,setMetadata:t=>e(e=>{Object.assign(e.metadata,t),e.metadata.modifiedAt=(new Date).toISOString(),e.isDirty=!0}),setIsDirty:t=>e(e=>{e.isDirty=t}),markAsSaved:()=>e(e=>{e.isDirty=!1,e.lastSavedAt=(new Date).toISOString()}),markAsModified:()=>e(e=>{e.isDirty=!0,e.metadata.modifiedAt=(new Date).toISOString()}),resetProject:()=>e(e=>{e.metadata={id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},e.isDirty=!1,e.lastSavedAt=null})}))),Vg=n()(Fa((e,t)=>({curves:[],selectedCurveId:null,editMode:"pencil",presets:[...Vn],automation:{},channelLanes:new Map,addCurve:(t,a,n)=>{const s={id:`curve-${Date.now()}`,patternId:t,channelIndex:a,parameter:n,mode:"curve",interpolation:"linear",points:[],enabled:!0};return e(e=>{e.curves.push(s),e.selectedCurveId=s.id,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),s.id},removeCurve:t=>e(e=>{const a=e.curves.findIndex(e=>e.id===t);-1!==a&&(e.curves.splice(a,1),e.selectedCurveId===t&&(e.selectedCurveId=null),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),updateCurve:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(Object.assign(n,a),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),setSelectedCurve:t=>e(e=>{e.selectedCurveId=t}),setEditMode:t=>e(e=>{e.editMode=t}),addPoint:(t,a,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.findIndex(e=>e.row===a);-1!==t?s.points[t].value=n:(s.points.push({row:a,value:n}),s.points.sort((e,t)=>e.row-t.row)),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}}),removePoint:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);if(n){const t=n.points.findIndex(e=>e.row===a);-1!==t&&(n.points.splice(t,1),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),updatePoint:(t,a,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.find(e=>e.row===a);t&&(t.value=n,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),clearPoints:t=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(a.points=[],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),applyPreset:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(n.points=[...a.points],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),getCurvesForPattern:(e,a)=>t().curves.filter(t=>t.patternId===e&&t.channelIndex===a),getValueAtRow:(e,a)=>{const n=t().curves.find(t=>t.id===e);if(!n||0===n.points.length)return null;let s=null,r=null;for(let t=0;t<n.points.length;t++)if(n.points[t].row<=a&&(s=n.points[t]),n.points[t].row>=a){r=n.points[t];break}if(s&&s.row===a)return s.value;if(r&&r.row===a)return r.value;if(s&&r&&"linear"===n.interpolation){const e=(a-s.row)/(r.row-s.row);return s.value+(r.value-s.value)*e}if(s&&r&&"exponential"===n.interpolation){const e=(a-s.row)/(r.row-s.row),t=e*e;return s.value+(r.value-s.value)*t}return n.mode,s?s.value:r?r.value:null},getAutomation:(e,a,n)=>{const s=t().curves.find(t=>t.patternId===e&&t.channelIndex===a&&t.parameter===n);return s||{id:`temp-${e}-${a}-${n}`,patternId:e,channelIndex:a,parameter:n,mode:"curve",interpolation:"linear",points:[],enabled:!0}},setAutomation:(t,a,n,s)=>e(e=>{const r=e.curves.findIndex(e=>e.patternId===t&&e.channelIndex===a&&e.parameter===n);-1!==r?e.curves[r]=s:e.curves.push(s),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),buildAutomationData:()=>{const e=t(),a={};return e.curves.forEach(e=>{a[e.patternId]||(a[e.patternId]={}),a[e.patternId][e.channelIndex]||(a[e.patternId][e.channelIndex]={}),a[e.patternId][e.channelIndex][e.parameter]=e}),a},loadCurves:t=>e(e=>{e.curves=t,e.selectedCurveId=null,e.automation={},t.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),getCurves:()=>t().curves,setActiveParameter:(t,a)=>e(e=>{const n=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...n,activeParameter:a})}),getActiveParameter:e=>{const a=t();return a.channelLanes.get(e)?.activeParameter||"cutoff"},setShowLane:(t,a)=>e(e=>{const n=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...n,showLane:a})}),getShowLane:e=>{const a=t();return a.channelLanes.get(e)?.showLane||!1},reset:()=>e(e=>{e.curves=[],e.selectedCurveId=null,e.editMode="pencil",e.automation={},e.channelLanes=new Map})}))),zg=n()(Fa((e,t)=>({undoStack:[],redoStack:[],maxStackSize:100,currentActionId:null,pushAction:(t,a,n,s,r)=>e(e=>{const i={id:`action-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),description:a,patternIndex:n,beforeState:JSON.parse(JSON.stringify(s)),afterState:JSON.parse(JSON.stringify(r))};e.undoStack.push(i),e.undoStack.length>e.maxStackSize&&e.undoStack.shift(),e.redoStack=[],e.currentActionId=i.id}),undo:()=>{const a=t();if(0===a.undoStack.length)return null;const n=a.undoStack[a.undoStack.length-1];return e(e=>{const t=e.undoStack.pop();t&&(e.redoStack.push(t),e.currentActionId=e.undoStack.length>0?e.undoStack[e.undoStack.length-1].id:null)}),n.beforeState},redo:()=>{const a=t();if(0===a.redoStack.length)return null;const n=a.redoStack[a.redoStack.length-1];return e(e=>{const t=e.redoStack.pop();t&&(e.undoStack.push(t),e.currentActionId=t.id)}),n.afterState},canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,clearHistory:()=>e(e=>{e.undoStack=[],e.redoStack=[],e.currentActionId=null}),setMaxStackSize:t=>e(e=>{e.maxStackSize=Math.max(1,t),e.undoStack.length>e.maxStackSize&&(e.undoStack=e.undoStack.slice(-e.maxStackSize)),e.redoStack.length>e.maxStackSize&&(e.redoStack=e.redoStack.slice(-e.maxStackSize))}),getUndoCount:()=>t().undoStack.length,getRedoCount:()=>t().redoStack.length,getLastAction:()=>{const e=t().undoStack;return e.length>0?e[e.length-1]:null},getActionHistory:()=>t().undoStack.slice(-20)}))),Ug=e=>({EDIT_CELL:"Edit Cell",PASTE_BLOCK:"Paste Block",DELETE_BLOCK:"Delete Block",CUT_BLOCK:"Cut Block",TRANSPOSE_BLOCK:"Transpose Block",AMPLIFY_BLOCK:"Amplify Block",INTERPOLATE_BLOCK:"Interpolate Block",CLEAR_CELL:"Clear Cell",CLEAR_ROW:"Clear Row",CLEAR_CHANNEL:"Clear Channel",CLEAR_PATTERN:"Clear Pattern",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",RESIZE_PATTERN:"Resize Pattern"}[e]||e),Gg=e=>{switch(e){case"EDIT_CELL":return"text-blue-400";case"PASTE_BLOCK":case"CUT_BLOCK":case"DELETE_BLOCK":return"text-green-400";case"TRANSPOSE_BLOCK":case"AMPLIFY_BLOCK":case"INTERPOLATE_BLOCK":return"text-yellow-400";case"CLEAR_CELL":case"CLEAR_ROW":case"CLEAR_CHANNEL":case"CLEAR_PATTERN":return"text-red-400";case"INSERT_ROW":case"DELETE_ROW":case"RESIZE_PATTERN":return"text-purple-400";default:return"text-gray-400"}},Wg=()=>{const e=tf.getState(),t=Pg.getState(),a=Vg.getState(),n=Bg.getState(),s=Rg.getState();return{patterns:JSON.parse(JSON.stringify(e.patterns)),currentPatternIndex:e.currentPatternIndex,instruments:JSON.parse(JSON.stringify(t.instruments)),currentInstrumentId:t.currentInstrumentId,automationCurves:JSON.parse(JSON.stringify(a.curves)),metadata:JSON.parse(JSON.stringify(n.metadata)),bpm:s.bpm}},Hg=e=>{const t=Km();try{t.stop()}catch(a){}Rg.getState().reset(),Rg.getState().setBPM(e.bpm),Bg.getState().setMetadata(e.metadata),Bg.getState().setIsDirty(!1),tf.getState().loadPatterns(e.patterns),tf.getState().setCurrentPattern(e.currentPatternIndex),Pg.getState().loadInstruments(e.instruments),null!==e.currentInstrumentId&&Pg.getState().setCurrentInstrument(e.currentInstrumentId),Vg.getState().loadCurves(e.automationCurves)},Kg=()=>({id:`tab-${Date.now()}`,name:"Untitled",isDirty:!1,state:null}),$g=Kg(),qg=n()(Fa((e,t)=>({tabs:[$g],activeTabId:$g.id,addTab:()=>{const a=t().activeTabId,n=Wg();e(e=>{const t=e.tabs.find(e=>e.id===a);t&&(t.state=n);const s=Kg();e.tabs.push(s),e.activeTabId=s.id});const s={patterns:[{id:`pattern-${Date.now()}`,name:"Untitled Pattern",length:64,channels:Array.from({length:4},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}],currentPatternIndex:0,instruments:[{id:0,name:"TB303 Classic",type:"synth",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:15},filterEnvelope:{envMod:50,decay:300},accent:{amount:.8},slide:{time:60,mode:"exponential"}},oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0}],currentInstrumentId:0,automationCurves:[],metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},bpm:125};Hg(s)},closeTab:a=>{const n=t();if(n.tabs.length<=1)return;const s=n.tabs.findIndex(e=>e.id===a);if(-1===s)return;let r=n.activeTabId,i=!1;if(n.activeTabId===a){const e=0===s?1:s-1;r=n.tabs[e].id,i=!0}const o=n.tabs.find(e=>e.id===r),l=o?.state;e(e=>{e.activeTabId=r,e.tabs.splice(s,1);const t=e.tabs.find(e=>e.id===r);t&&(t.state=null)}),i&&l&&Hg(l)},setActiveTab:a=>{const n=t();if(!n.tabs.some(e=>e.id===a))return;if(n.activeTabId===a)return;const s=n.activeTabId,r=Wg(),i=n.tabs.find(e=>e.id===a),o=i?.state;e(e=>{const t=e.tabs.find(e=>e.id===s);t&&(t.state=r),e.activeTabId=a;const n=e.tabs.find(e=>e.id===a);n&&(n.state=null)}),o&&Hg(o)},updateTabName:(t,a)=>e(e=>{const n=e.tabs.find(e=>e.id===t);n&&(n.name=a)}),markTabDirty:(t,a)=>e(e=>{const n=e.tabs.find(e=>e.id===t);n&&(n.isDirty=a)})}))),Xg={id:"devilbox",name:"DEViLBOX",colors:{bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",bgHover:"#262020",bgActive:"#2f2828",border:"#2f2525",borderLight:"#403535",accent:"#ef4444",accentSecondary:"#f97316",accentGlow:"rgba(239, 68, 68, 0.15)",text:"#f2f0f0",textSecondary:"#a8a0a0",textMuted:"#686060",textInverse:"#0b0909",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0f0c0c",trackerRowOdd:"#131010",trackerRowHighlight:"#181414",trackerRowCurrent:"#2a1a1a",trackerRowCursor:"#251010",cellNote:"#f2f0f0",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#ef4444",cellSlide:"#fb7185",cellEmpty:"#484040"}},Yg=[Xg,{id:"neodark",name:"NeoDark",colors:{bg:"#0a0a0b",bgSecondary:"#111113",bgTertiary:"#1a1a1d",bgHover:"#222226",bgActive:"#2a2a2f",border:"#2a2a2f",borderLight:"#3a3a40",accent:"#00d4aa",accentSecondary:"#7c3aed",accentGlow:"rgba(0, 212, 170, 0.15)",text:"#f0f0f2",textSecondary:"#a0a0a8",textMuted:"#606068",textInverse:"#0a0a0b",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0d0d0f",trackerRowOdd:"#111113",trackerRowHighlight:"#151518",trackerRowCurrent:"#1a2a25",trackerRowCursor:"#0d2520",cellNote:"#f0f0f2",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#00d4aa",cellSlide:"#a78bfa",cellEmpty:"#404048"}},{id:"cyan-lineart",name:"Cyan Lineart",colors:{bg:"#030808",bgSecondary:"#051010",bgTertiary:"#071414",bgHover:"#0a1a1a",bgActive:"#0c2020",border:"#00808080",borderLight:"#00b8b8",accent:"#00ffff",accentSecondary:"#00e0e0",accentGlow:"rgba(0, 255, 255, 0.12)",text:"#00ffff",textSecondary:"#00c8c8",textMuted:"#006060",textInverse:"#030808",error:"#ff4080",success:"#00ff88",warning:"#00ffaa",trackerRowEven:"#030808",trackerRowOdd:"#041010",trackerRowHighlight:"#061414",trackerRowCurrent:"#081818",trackerRowCursor:"#0a1c1c",cellNote:"#00ffff",cellInstrument:"#00e8e8",cellVolume:"#00d0d0",cellEffect:"#00b8b8",cellAccent:"#00ffff",cellSlide:"#00a0a0",cellEmpty:"#003838"}}],Qg=e=>{const t=document.documentElement,{colors:a}=e;t.setAttribute("data-theme",e.id),t.style.setProperty("--color-bg",a.bg),t.style.setProperty("--color-bg-secondary",a.bgSecondary),t.style.setProperty("--color-bg-tertiary",a.bgTertiary),t.style.setProperty("--color-bg-hover",a.bgHover),t.style.setProperty("--color-bg-active",a.bgActive),t.style.setProperty("--color-border",a.border),t.style.setProperty("--color-border-light",a.borderLight),t.style.setProperty("--color-accent",a.accent),t.style.setProperty("--color-accent-secondary",a.accentSecondary),t.style.setProperty("--color-accent-glow",a.accentGlow),t.style.setProperty("--color-text",a.text),t.style.setProperty("--color-text-secondary",a.textSecondary),t.style.setProperty("--color-text-muted",a.textMuted),t.style.setProperty("--color-text-inverse",a.textInverse),t.style.setProperty("--color-error",a.error),t.style.setProperty("--color-success",a.success),t.style.setProperty("--color-warning",a.warning),t.style.setProperty("--color-tracker-row-even",a.trackerRowEven),t.style.setProperty("--color-tracker-row-odd",a.trackerRowOdd),t.style.setProperty("--color-tracker-row-highlight",a.trackerRowHighlight),t.style.setProperty("--color-tracker-row-current",a.trackerRowCurrent),t.style.setProperty("--color-tracker-row-cursor",a.trackerRowCursor),t.style.setProperty("--color-cell-note",a.cellNote),t.style.setProperty("--color-cell-instrument",a.cellInstrument),t.style.setProperty("--color-cell-volume",a.cellVolume),t.style.setProperty("--color-cell-effect",a.cellEffect),t.style.setProperty("--color-cell-accent",a.cellAccent),t.style.setProperty("--color-cell-slide",a.cellSlide),t.style.setProperty("--color-cell-empty",a.cellEmpty)},Zg=n()(Gm((e,t)=>({currentThemeId:"devilbox",setTheme:t=>{const a=Yg.find(e=>e.id===t);a&&(Qg(a),e({currentThemeId:t}))},getCurrentTheme:()=>{const{currentThemeId:e}=t();return Yg.find(t=>t.id===e)||Xg}}),{name:"devilbox-theme",onRehydrateStorage:()=>e=>{if(e){const t=Yg.find(t=>t.id===e.currentThemeId)||Xg;Qg(t)}}}));if("undefined"!=typeof window){const e=localStorage.getItem("devilbox-theme");let t="devilbox";if(e)try{const a=JSON.parse(e);t=a.state?.currentThemeId||"devilbox"}catch{}const a=Yg.find(e=>e.id===t)||Xg;Qg(a)}let Jg=0;const ey=n((e,t)=>({notifications:[],addNotification:a=>{const n="notification-"+ ++Jg,s={...a,id:n,duration:a.duration??5e3};return e(e=>({notifications:[...e.notifications,s]})),s.duration&&s.duration>0&&setTimeout(()=>{t().removeNotification(n)},s.duration),n},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),ty={success:(e,t)=>ey.getState().addNotification({type:"success",message:e,duration:t}),error:(e,t)=>ey.getState().addNotification({type:"error",message:e,duration:t??8e3}),warning:(e,t)=>ey.getState().addNotification({type:"warning",message:e,duration:t}),info:(e,t)=>ey.getState().addNotification({type:"info",message:e,duration:t})};class ay{static instance=null;midiAccess=null;inputs=new Map;outputs=new Map;selectedInputId=null;selectedOutputId=null;messageHandlers=new Set;deviceChangeCallbacks=new Set;lastActivityTimestamp=0;boundMessageHandler=null;clockTickCount=0;lastClockTimestamp=0;clockBPM=0;clockSyncEnabled=!1;clockSyncCallbacks=new Set;transportCallbacks=new Set;constructor(){}static getInstance(){return ay.instance||(ay.instance=new ay),ay.instance}isSupported(){return"requestMIDIAccess"in navigator}async init(){if(!this.isSupported())return!1;try{return this.midiAccess=await navigator.requestMIDIAccess({sysex:!0}),this.updateDevices(),this.midiAccess.onstatechange=()=>{this.updateDevices(),this.notifyDeviceChange()},!0}catch(e){return!1}}updateDevices(){if(this.midiAccess){if(this.inputs.clear(),this.outputs.clear(),this.midiAccess.inputs.forEach((e,t)=>{this.inputs.set(t,e)}),this.midiAccess.outputs.forEach((e,t)=>{this.outputs.set(t,e)}),!this.selectedInputId){const e=this.detectTD3Devices().input;e&&this.selectInput(e.id)}if(!this.selectedOutputId){const e=this.detectTD3Devices().output;e&&this.selectOutput(e.id)}}}portToDeviceInfo(e,t){const a=e.name||"Unknown Device",n=e.manufacturer||"";return{id:e.id,name:a,manufacturer:n,type:t,isConnected:"open"===e.connection||"connected"===e.state,isTD3:this.isTD3Device(a,n)}}isTD3Device(e,t){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("td-3")||a.includes("td3")||n.includes("behringer")&&a.includes("303")}getInputDevices(){const e=[];return this.inputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"input"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}getOutputDevices(){const e=[];return this.outputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"output"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}detectTD3Devices(){const e=this.getInputDevices(),t=this.getOutputDevices();return{input:e.find(e=>e.isTD3)||null,output:t.find(e=>e.isTD3)||null}}async selectInput(e){if(this.selectedInputId){const e=this.inputs.get(this.selectedInputId);if(e){e.onmidimessage=null;try{await e.close()}catch{}}}if(this.selectedInputId=e,e){const a=this.inputs.get(e);if(a)try{await a.open(),this.boundMessageHandler=this.handleMIDIMessage.bind(this),a.onmidimessage=this.boundMessageHandler}catch(t){}}}selectOutput(e){this.selectedOutputId=e,e&&this.outputs.get(e)}getSelectedInput(){if(!this.selectedInputId)return null;const e=this.inputs.get(this.selectedInputId);return e?this.portToDeviceInfo(e,"input"):null}getSelectedOutput(){if(!this.selectedOutputId)return null;const e=this.outputs.get(this.selectedOutputId);return e?this.portToDeviceInfo(e,"output"):null}handleMIDIMessage(e){const t=e.data;if(!t||0===t.length)return;const a=t[0];if(248!==a){Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join(" "),t[0]>=240||(176==(240&t[0])||(144==(240&t[0])||(128==(240&t[0])||(224==(240&t[0])||t[0]))))}this.lastActivityTimestamp=Date.now();const n=this.parseMIDIMessage(a,t,e.timeStamp);this.clockSyncEnabled&&("clock"===n.type?this.processClockTick(e.timeStamp):"start"!==n.type&&"stop"!==n.type&&"continue"!==n.type||this.processTransportCommand(n.type)),"cc"===n.type||"noteOn"===n.type||"noteOff"===n.type||"pitchBend"===n.type||n.type,this.messageHandlers.forEach(e=>{try{e(n,this.selectedInputId||"")}catch(t){}})}processClockTick(e){if(this.clockTickCount++,this.lastClockTimestamp>0){const t=e-this.lastClockTimestamp;if(t>0){const e=2500/t;if(0===this.clockBPM?this.clockBPM=e:this.clockBPM=.9*this.clockBPM+.1*e,this.clockTickCount%24==0){const e=Math.round(10*this.clockBPM)/10;this.clockSyncCallbacks.forEach(t=>{try{t(e)}catch(a){}})}}}this.lastClockTimestamp=e}processTransportCommand(e){"start"===e&&(this.clockTickCount=0,this.lastClockTimestamp=0),this.transportCallbacks.forEach(t=>{try{t(e)}catch(a){}})}parseMIDIMessage(e,t,a){let n,s,r,i,o,l,c,u="other";if(e>=240)switch(n=-1,e){case 240:u="sysex";break;case 248:u="clock";break;case 250:u="start";break;case 251:u="continue";break;case 252:u="stop";break;default:u="other"}else{switch(n=15&e,240&e){case 144:u="noteOn",s=t[1],r=t[2],0===r&&(u="noteOff");break;case 128:u="noteOff",s=t[1],r=t[2];break;case 176:u="cc",i=t[1],o=t[2];break;case 192:u="programChange",c=t[1];break;case 224:u="pitchBend",l=(t[2]<<7|t[1])-8192;break;default:u="other"}}return{type:u,channel:n,data:t,timestamp:a,note:s,velocity:r,cc:i,value:o,pitchBend:l,program:c}}addMessageHandler(e){this.messageHandlers.add(e)}removeMessageHandler(e){this.messageHandlers.delete(e)}sendCC(e,t,a){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([176|15&e,127&t,127&a]);n.send(s)}sendSysEx(e){if(!this.selectedOutputId)return;const t=this.outputs.get(this.selectedOutputId);if(t)try{t.send(e)}catch(a){throw a}}sendNoteOn(e,t,a){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([144|15&e,127&t,127&a]);n.send(s)}sendNoteOff(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=new Uint8Array([128|15&e,127&t,0]);a.send(n)}sendPitchBend(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=Math.max(0,Math.min(16383,t+8192)),s=new Uint8Array([224|15&e,127&n,n>>7&127]);a.send(s)}sendProgramChange(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=new Uint8Array([192|15&e,127&t]);a.send(n)}setClockSyncEnabled(e){this.clockSyncEnabled=e,e||(this.clockTickCount=0,this.lastClockTimestamp=0,this.clockBPM=0)}isClockSyncEnabled(){return this.clockSyncEnabled}getClockBPM(){return Math.round(10*this.clockBPM)/10}onClockSync(e){return this.clockSyncCallbacks.add(e),()=>{this.clockSyncCallbacks.delete(e)}}onTransportCommand(e){return this.transportCallbacks.add(e),()=>{this.transportCallbacks.delete(e)}}onDeviceChange(e){return this.deviceChangeCallbacks.add(e),()=>{this.deviceChangeCallbacks.delete(e)}}notifyDeviceChange(){this.deviceChangeCallbacks.forEach(e=>{try{e()}catch(t){}})}getLastActivityTimestamp(){return this.lastActivityTimestamp}isInitialized(){return null!==this.midiAccess}dispose(){this.midiAccess&&(this.midiAccess.onstatechange=null),this.inputs.forEach(e=>{e.onmidimessage=null}),this.inputs.clear(),this.outputs.clear(),this.messageHandlers.clear(),this.deviceChangeCallbacks.clear(),this.clockSyncCallbacks.clear(),this.transportCallbacks.clear(),this.selectedInputId=null,this.selectedOutputId=null,this.midiAccess=null,this.clockSyncEnabled=!1,this.clockBPM=0,this.clockTickCount=0,this.lastClockTimestamp=0}}function ny(){return ay.getInstance()}class sy{static instance=null;mappings=new Map;lastCCValues=new Map;smoothedValues=new Map;globalSensitivity=.3;controlledInstrumentId=null;controlledInstrumentListeners=new Set;learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null};changeCallbacks=new Set;learnListeners=new Set;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return sy.instance||(sy.instance=new sy),sy.instance}init(){if(this.handlerRegistered)return;ny().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("cc"!==e.type||void 0===e.cc||void 0===e.value)return;if(this.learnState.isLearning&&this.learnState.callback)return void this.learnState.callback(e.cc,e.channel);const t=`${e.cc}-${e.channel}`,a=e.value,n=this.smoothedValues.get(t)??a,s=this.globalSensitivity,r=n+(a-n)*s;this.smoothedValues.set(t,r),this.mappings.forEach(t=>{if(t.ccNumber!==e.cc)return;if(void 0!==t.midiChannel&&t.midiChannel!==e.channel)return;const s=t.sensitivity??1,i=s<1?n+(a-n)*s:r,o=this.ccToParameter(i,t);this.notifyParameterChange(t.instrumentId,t.parameterPath,o)})};ccToParameter(e,t){const a=e/127;if("logarithmic"===t.curve){const e=Math.max(1,t.min),n=Math.max(e+1,t.max),s=Math.log(e),r=Math.log(n);return Math.exp(s+a*(r-s))}return t.min+a*(t.max-t.min)}parameterToCC(e,t){let a;if("logarithmic"===t.curve){const n=Math.max(1,t.min),s=Math.max(n+1,t.max),r=Math.log(n),i=Math.log(s);a=(Math.log(Math.max(n,e))-r)/(i-r)}else a=(e-t.min)/(t.max-t.min);return Math.round(Math.max(0,Math.min(127,127*a)))}startLearn(e,t,a,n,s,r="linear"){return new Promise(i=>{this.learnState={isLearning:!0,instrumentId:e,parameterPath:t,displayName:a,min:n,max:s,curve:r,callback:(e,t)=>{this.learnState.isLearning=!1,this.learnState.callback=null,this.notifyLearnChange(!1,null),i({ccNumber:e,channel:t})}},this.notifyLearnChange(!0,t)})}cancelLearn(){this.learnState.isLearning&&(this.learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null},this.notifyLearnChange(!1,null))}isLearning(){return this.learnState.isLearning}getLearningParameter(){return this.learnState.parameterPath}setMapping(e){this.mappings.forEach((t,a)=>{t.instrumentId===e.instrumentId&&t.parameterPath===e.parameterPath&&this.mappings.delete(a)}),this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}removeMappingsForInstrument(e){const t=[];this.mappings.forEach((a,n)=>{a.instrumentId===e&&t.push(n)}),t.forEach(e=>this.mappings.delete(e)),t.length>0&&(this.saveMappings(),this.notifyMappingChange())}getMappingForParameter(e,t){for(const a of this.mappings.values())if(a.instrumentId===e&&a.parameterPath===t)return a}getMappingsForInstrument(e){const t=[];return this.mappings.forEach(a=>{a.instrumentId===e&&t.push(a)}),t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}onParameterChange(e){return this.changeCallbacks.add(e),()=>this.changeCallbacks.delete(e)}onLearnChange(e){return this.learnListeners.add(e),()=>this.learnListeners.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyParameterChange(e,t,a){this.changeCallbacks.forEach(n=>{try{n(e,t,a)}catch(s){}})}notifyLearnChange(e,t){this.learnListeners.forEach(a=>{try{a(e,t)}catch(n){}})}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}setGlobalSensitivity(e){this.globalSensitivity=Math.max(.05,Math.min(1,e))}getGlobalSensitivity(){return this.globalSensitivity}resetSmoothing(){this.smoothedValues.clear(),this.lastCCValues.clear()}setControlledInstrument(e){this.controlledInstrumentId=e,this.resetSmoothing(),this.notifyControlledInstrumentChange(e)}getControlledInstrument(){return this.controlledInstrumentId}onControlledInstrumentChange(e){return this.controlledInstrumentListeners.add(e),()=>this.controlledInstrumentListeners.delete(e)}notifyControlledInstrumentChange(e){this.controlledInstrumentListeners.forEach(t=>{try{t(e)}catch(a){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("cc-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("cc-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){ny().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.changeCallbacks.clear(),this.learnListeners.clear(),this.mappingListeners.clear()}}function ry(){return sy.getInstance()}class iy{static instance=null;mappings=new Map;actionHandlers=new Map;isLearning=!1;learningAction=null;learnCallback=null;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return iy.instance||(iy.instance=new iy),iy.instance}init(){if(this.handlerRegistered)return;ny().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if(this.isLearning&&this.learnCallback)return"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?void this.learnCallback(e.note,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63?void this.learnCallback(-e.cc-1,e.channel):void 0;"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?this.triggerButtonAction(e.note,void 0,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63&&this.triggerButtonAction(void 0,e.cc,e.channel)};triggerButtonAction(e,t,a){for(const n of this.mappings.values()){const s=void 0!==e&&n.midiNote===e,r=void 0!==t&&n.ccNumber===t;if(!s&&!r)continue;if(void 0!==n.midiChannel&&void 0!==a&&n.midiChannel!==a)continue;const i=this.actionHandlers.get(n.action);return void(i&&i())}}startLearn(e){return new Promise(t=>{this.isLearning=!0,this.learningAction=e,this.learnCallback=(e,a)=>{this.isLearning=!1,this.learningAction=null,this.learnCallback=null,t(e<0?{type:"cc",number:-e-1,channel:a}:{type:"note",number:e,channel:a})}})}cancelLearn(){this.isLearning=!1,this.learningAction=null,this.learnCallback=null}isInLearnMode(){return this.isLearning}getLearningAction(){return this.learningAction}setMapping(e){for(const[t,a]of this.mappings.entries())a.action===e.action&&this.mappings.delete(t);this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}getMappingForAction(e){for(const t of this.mappings.values())if(t.action===e)return t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}registerAction(e,t){return this.actionHandlers.set(e,t),()=>this.actionHandlers.delete(e)}unregisterAction(e){this.actionHandlers.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("button-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("button-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){ny().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.actionHandlers.clear(),this.mappingListeners.clear()}}function oy(){return iy.getInstance()}class ly{static instance=null;mappings=new Map;triggerCallbacks=new Set;handlerRegistered=!1;isLearning=!1;learnCallback=null;constructor(){}static getInstance(){return ly.instance||(ly.instance=new ly),ly.instance}init(){if(this.handlerRegistered)return;ny().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("noteOn"!==e.type&&"noteOff"!==e.type)return;if(void 0===e.note)return;if(this.isLearning&&"noteOn"===e.type&&this.learnCallback)return void this.learnCallback(e.note,e.channel);const t=`${e.channel}-${e.note}`,a=this.mappings.get(t);if(a){const t="noteOff"===e.type?0:e.velocity??0;this.notifyTrigger(a,t)}};onTrigger(e){return this.triggerCallbacks.add(e),()=>this.triggerCallbacks.delete(e)}notifyTrigger(e,t){this.triggerCallbacks.forEach(a=>{try{a(e,t)}catch(n){}})}setMapping(e){this.mappings.set(e.id,e),this.saveMappings()}removeMapping(e){this.mappings.delete(e),this.saveMappings()}getMapping(e,t){return this.mappings.get(`${e}-${t}`)}getAllMappings(){return Array.from(this.mappings.values())}clearMappings(){this.mappings.clear(),this.saveMappings()}startLearn(e){this.isLearning=!0,this.learnCallback=(t,a)=>{this.isLearning=!1,this.learnCallback=null,e(t,a)}}cancelLearn(){this.isLearning=!1,this.learnCallback=null}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("pad-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("pad-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>this.mappings.set(e.id,e))}}catch(e){}}dispose(){this.handlerRegistered&&(ny().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1),this.triggerCallbacks.clear()}}function cy(){return ly.getInstance()}const uy={HEADER:new Uint8Array([240,0,32,50,0,1,10]),FOOTER:247,CMD_REQUEST_PATTERN:119,CMD_SEND_PATTERN:120},dy=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function py(e){const{name:t,octave:a}=function(e){const t=Math.floor(e/12)-1;return{name:dy[e%12],octave:t}}(e);return t.includes("#")?`${t}${a}`:`${t}-${a}`}const hy={303:[{cc:70,param:"cutoff",label:"Cutoff"},{cc:71,param:"resonance",label:"Resonance"},{cc:72,param:"envMod",label:"Env Mod"},{cc:73,param:"decay",label:"Decay"},{cc:74,param:"accent",label:"Accent"},{cc:75,param:"overdrive",label:"Drive"},{cc:76,param:"slideTime",label:"Slide"},{cc:77,param:"mixer.volume",label:"Volume"}],Siren:[{cc:70,param:"siren.osc.frequency",label:"Osc Freq"},{cc:71,param:"siren.lfo.rate",label:"LFO Rate"},{cc:72,param:"siren.lfo.depth",label:"LFO Depth"},{cc:73,param:"siren.delay.time",label:"Delay Time"},{cc:74,param:"siren.delay.feedback",label:"Feedback"},{cc:75,param:"siren.delay.wet",label:"Delay Mix"},{cc:76,param:"siren.filter.frequency",label:"Filter"},{cc:77,param:"siren.reverb.wet",label:"Reverb"}],Furnace:[{cc:70,param:"furnace.algorithm",label:"Algorithm"},{cc:71,param:"furnace.feedback",label:"Feedback"},{cc:72,param:"furnace.op1TL",label:"Op1 TL"},{cc:73,param:"furnace.op1AR",label:"Op1 AR"},{cc:74,param:"furnace.op1DR",label:"Op1 DR"},{cc:75,param:"furnace.op1SL",label:"Op1 SL"},{cc:76,param:"furnace.op1RR",label:"Op1 RR"},{cc:77,param:"furnace.fms",label:"FM Sens"}],V2:[{cc:70,param:"v2.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"v2.filter1Cutoff",label:"Cutoff"},{cc:72,param:"v2.filter1Reso",label:"Reso"},{cc:73,param:"v2.envAttack",label:"Attack"},{cc:74,param:"v2.envDecay",label:"Decay"},{cc:75,param:"v2.envSustain",label:"Sustain"},{cc:76,param:"v2.envRelease",label:"Release"},{cc:77,param:"v2.lfo1Depth",label:"LFO Dep"}],Synare:[{cc:70,param:"synare.tune",label:"Tune"},{cc:71,param:"synare.osc2Mix",label:"Osc2 Mix"},{cc:72,param:"synare.filterCutoff",label:"Cutoff"},{cc:73,param:"synare.filterReso",label:"Reso"},{cc:74,param:"synare.filterEnvMod",label:"Env Mod"},{cc:75,param:"synare.filterDecay",label:"Flt Dcy"},{cc:76,param:"synare.sweepAmount",label:"Sweep"},{cc:77,param:"synare.sweepTime",label:"Swp Time"}],Dexed:[{cc:70,param:"dexed.algorithm",label:"Algorithm"},{cc:71,param:"dexed.feedback",label:"Feedback"},{cc:72,param:"dexed.op1Level",label:"Op1 Lvl"},{cc:73,param:"dexed.op1Coarse",label:"Op1 Coarse"},{cc:74,param:"dexed.lfoSpeed",label:"LFO Spd"},{cc:75,param:"dexed.lfoPitchMod",label:"LFO Pitch"},{cc:76,param:"dexed.lfoAmpMod",label:"LFO Amp"},{cc:77,param:"dexed.transpose",label:"Transpose"}],OBXd:[{cc:70,param:"obxd.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"obxd.osc2Level",label:"Osc2 Lvl"},{cc:72,param:"obxd.filterCutoff",label:"Cutoff"},{cc:73,param:"obxd.filterReso",label:"Reso"},{cc:74,param:"obxd.filterEnv",label:"Flt Env"},{cc:75,param:"obxd.ampAttack",label:"Attack"},{cc:76,param:"obxd.ampDecay",label:"Decay"},{cc:77,param:"obxd.volume",label:"Volume"}],SpaceLaser:[{cc:70,param:"spacelaser.startFreq",label:"Start Hz"},{cc:71,param:"spacelaser.endFreq",label:"End Hz"},{cc:72,param:"spacelaser.sweepTime",label:"Sweep"},{cc:73,param:"spacelaser.fmAmount",label:"FM Amt"},{cc:74,param:"spacelaser.fmRatio",label:"FM Ratio"},{cc:75,param:"spacelaser.filterCutoff",label:"Cutoff"},{cc:76,param:"spacelaser.filterReso",label:"Reso"},{cc:77,param:"spacelaser.delayWet",label:"Delay"}],SAM:[{cc:70,param:"sam.pitch",label:"Pitch"},{cc:71,param:"sam.speed",label:"Speed"},{cc:72,param:"sam.mouth",label:"Mouth"},{cc:73,param:"sam.throat",label:"Throat"},{cc:74,param:"mixer.volume",label:"Volume"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],Organ:[{cc:70,param:"organ.drawbar16",label:"16'"},{cc:71,param:"organ.drawbar8",label:"8'"},{cc:72,param:"organ.drawbar4",label:"4'"},{cc:73,param:"organ.percussion",label:"Perc"},{cc:74,param:"organ.vibratoType",label:"Vib Type"},{cc:75,param:"organ.vibratoDepth",label:"Vib Dep"},{cc:76,param:"organ.overdrive",label:"Drive"},{cc:77,param:"organ.volume",label:"Volume"}],Melodica:[{cc:70,param:"melodica.breath",label:"Breath"},{cc:71,param:"melodica.brightness",label:"Bright"},{cc:72,param:"melodica.vibratoRate",label:"Vib Rate"},{cc:73,param:"melodica.vibratoDepth",label:"Vib Dep"},{cc:74,param:"melodica.detune",label:"Detune"},{cc:75,param:"melodica.portamento",label:"Porta"},{cc:76,param:"melodica.attack",label:"Attack"},{cc:77,param:"melodica.volume",label:"Volume"}],FX:[{cc:70,param:"echo.rate",label:"Echo Rate"},{cc:71,param:"echo.intensity",label:"Intensity"},{cc:72,param:"echo.echoVolume",label:"Echo Vol"},{cc:73,param:"echo.reverbVolume",label:"Rev Vol"},{cc:74,param:"echo.mode",label:"Echo Mode"},{cc:75,param:"biphase.rateA",label:"Phase A"},{cc:76,param:"biphase.feedback",label:"Phase FB"},{cc:77,param:"biphase.routing",label:"Routing"}],Mixer:[{cc:70,param:"mixer.volume",label:"Vol 1"},{cc:71,param:"mixer.volume",label:"Vol 2"},{cc:72,param:"mixer.volume",label:"Vol 3"},{cc:73,param:"mixer.volume",label:"Vol 4"},{cc:74,param:"mixer.pan",label:"Pan 1"},{cc:75,param:"mixer.pan",label:"Pan 2"},{cc:76,param:"mixer.pan",label:"Pan 3"},{cc:77,param:"mixer.pan",label:"Pan 4"}]},my={303:{x:{param:"cutoff",min:200,max:5e3,curve:"log"},y:{param:"resonance",min:0,max:100,curve:"linear"}},Siren:{x:{param:"siren.osc.frequency",min:60,max:1500,curve:"linear"},y:{param:"siren.lfo.rate",min:.1,max:20,curve:"linear"}},Furnace:{x:{param:"furnace.fms",min:0,max:7,curve:"linear"},y:{param:"furnace.op1SL",min:0,max:15,curve:"linear"}},V2:{x:{param:"v2.filter1Cutoff",min:0,max:127,curve:"linear"},y:{param:"v2.filter1Reso",min:0,max:127,curve:"linear"}},Synare:{x:{param:"synare.filterCutoff",min:20,max:2e4,curve:"log"},y:{param:"synare.filterEnvMod",min:0,max:100,curve:"linear"}},Dexed:{x:{param:"dexed.lfoPitchMod",min:0,max:99,curve:"linear"},y:{param:"dexed.lfoAmpMod",min:0,max:99,curve:"linear"}},OBXd:{x:{param:"obxd.filterCutoff",min:0,max:1,curve:"linear"},y:{param:"obxd.filterReso",min:0,max:1,curve:"linear"}},SpaceLaser:{x:{param:"spacelaser.fmAmount",min:0,max:100,curve:"linear"},y:{param:"spacelaser.filterCutoff",min:20,max:2e4,curve:"log"}},SAM:{x:{param:"sam.pitch",min:0,max:255,curve:"linear"},y:{param:"sam.speed",min:0,max:255,curve:"linear"}},Organ:{x:{param:"organ.vibratoDepth",min:0,max:1,curve:"linear"},y:{param:"organ.overdrive",min:0,max:1,curve:"linear"}},Melodica:{x:{param:"melodica.vibratoRate",min:0,max:10,curve:"linear"},y:{param:"melodica.brightness",min:0,max:1,curve:"linear"}}};const fy=e=>{const t=`${e}--1`;return Km().instruments.get(t)},gy=(e,t)=>{const a=t/127,n=Pg.getState(),s=n.currentInstrumentId,r=n.instruments.find(e=>e.id===s);if(r)switch(e){case"cutoff":n.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,cutoff:200*Math.pow(25,a)}}});break;case"resonance":n.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,resonance:100*a}}});break;case"envMod":n.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,envMod:100*a}}});break;case"decay":n.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,decay:30+2970*a}}});break;case"accent":n.updateInstrument(r.id,{tb303:{...r.tb303,accent:{amount:100*a}}});break;case"overdrive":n.updateInstrument(r.id,{tb303:{...r.tb303,overdrive:{...r.tb303.overdrive,amount:100*a}}});break;case"slideTime":n.updateInstrument(r.id,{tb303:{...r.tb303,slide:{...r.tb303.slide,time:2+358*a}}});break;case"siren.osc.frequency":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,oscillator:{...r.dubSiren.oscillator,frequency:60+940*a}}});break;case"siren.lfo.rate":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,rate:.1+19.9*a}}});break;case"siren.lfo.depth":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,depth:500*a}}});break;case"siren.delay.time":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,time:.01+.99*a}}});break;case"siren.delay.feedback":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,feedback:.95*a}}});break;case"siren.delay.wet":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,wet:a}}});break;case"siren.filter.frequency":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,filter:{...r.dubSiren.filter,frequency:20+9980*a}}});break;case"siren.reverb.wet":r.dubSiren&&n.updateInstrument(r.id,{dubSiren:{...r.dubSiren,reverb:{...r.dubSiren.reverb,wet:a}}});break;case"furnace.algorithm":r.furnace&&n.updateInstrument(r.id,{furnace:{...r.furnace,algorithm:Math.round(7*a)}});break;case"furnace.feedback":r.furnace&&n.updateInstrument(r.id,{furnace:{...r.furnace,feedback:Math.round(7*a)}});break;case"furnace.op1TL":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],tl:Math.round(127*a)},n.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1AR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],ar:Math.round(31*a)},n.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1DR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],dr:Math.round(31*a)},n.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1SL":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],sl:Math.round(15*a)},n.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1RR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],rr:Math.round(15*a)},n.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.fms":r.furnace&&n.updateInstrument(r.id,{furnace:{...r.furnace,fms:Math.round(7*a)}});break;case"v2.osc1Level":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,osc1:{...r.v2.osc1,level:Math.round(127*a)}}});break;case"v2.filter1Cutoff":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,filter1:{...r.v2.filter1,cutoff:Math.round(127*a)}}});break;case"v2.filter1Reso":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,filter1:{...r.v2.filter1,resonance:Math.round(127*a)}}});break;case"v2.envAttack":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,attack:Math.round(127*a)}}});break;case"v2.envDecay":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,decay:Math.round(127*a)}}});break;case"v2.envSustain":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,sustain:Math.round(127*a)}}});break;case"v2.envRelease":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,release:Math.round(127*a)}}});break;case"v2.lfo1Depth":r.v2&&n.updateInstrument(r.id,{v2:{...r.v2,lfo1:{...r.v2.lfo1,depth:Math.round(127*a)}}});break;case"synare.tune":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,oscillator:{...r.synare.oscillator,tune:20+980*a}}});break;case"synare.osc2Mix":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,oscillator2:{...r.synare.oscillator2,mix:a}}});break;case"synare.filterCutoff":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,cutoff:20*Math.pow(1e3,a)}}});break;case"synare.filterReso":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,resonance:100*a}}});break;case"synare.filterEnvMod":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,envMod:100*a}}});break;case"synare.filterDecay":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,decay:10+1990*a}}});break;case"synare.sweepAmount":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,sweep:{...r.synare.sweep,amount:48*a}}});break;case"synare.sweepTime":r.synare&&n.updateInstrument(r.id,{synare:{...r.synare,sweep:{...r.synare.sweep,time:5+495*a}}});break;case"dexed.algorithm":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,algorithm:Math.round(31*a)}});break;case"dexed.feedback":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,feedback:Math.round(7*a)}});break;case"dexed.op1Level":if(r.dexed?.operators?.[0]){const e=[...r.dexed.operators];e[0]={...e[0],level:Math.round(99*a)},n.updateInstrument(r.id,{dexed:{...r.dexed,operators:e}})}break;case"dexed.op1Coarse":if(r.dexed?.operators?.[0]){const e=[...r.dexed.operators];e[0]={...e[0],coarse:Math.round(31*a)},n.updateInstrument(r.id,{dexed:{...r.dexed,operators:e}})}break;case"dexed.lfoSpeed":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,lfoSpeed:Math.round(99*a)}});break;case"dexed.lfoPitchMod":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,lfoPitchModDepth:Math.round(99*a)}});break;case"dexed.lfoAmpMod":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,lfoAmpModDepth:Math.round(99*a)}});break;case"dexed.transpose":r.dexed&&n.updateInstrument(r.id,{dexed:{...r.dexed,transpose:Math.round(48*a-24)}});break;case"obxd.osc1Level":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,osc1Level:a}});break;case"obxd.osc2Level":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,osc2Level:a}});break;case"obxd.filterCutoff":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,filterCutoff:a}});break;case"obxd.filterReso":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,filterResonance:a}});break;case"obxd.filterEnv":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,filterEnvAmount:a}});break;case"obxd.ampAttack":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,ampAttack:a}});break;case"obxd.ampDecay":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,ampDecay:a}});break;case"obxd.volume":r.obxd&&n.updateInstrument(r.id,{obxd:{...r.obxd,masterVolume:a}});break;case"spacelaser.startFreq":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,startFreq:100+9900*a}}});break;case"spacelaser.endFreq":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,endFreq:20+4980*a}}});break;case"spacelaser.sweepTime":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,sweepTime:10+2990*a}}});break;case"spacelaser.fmAmount":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,fm:{...r.spaceLaser.fm,amount:100*a}}});break;case"spacelaser.fmRatio":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,fm:{...r.spaceLaser.fm,ratio:.5+15.5*a}}});break;case"spacelaser.filterCutoff":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,filter:{...r.spaceLaser.filter,cutoff:20*Math.pow(1e3,a)}}});break;case"spacelaser.filterReso":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,filter:{...r.spaceLaser.filter,resonance:100*a}}});break;case"spacelaser.delayWet":r.spaceLaser&&n.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,delay:{...r.spaceLaser.delay,wet:a}}});break;case"sam.pitch":r.sam&&n.updateInstrument(r.id,{sam:{...r.sam,pitch:Math.round(255*a)}});break;case"sam.speed":r.sam&&n.updateInstrument(r.id,{sam:{...r.sam,speed:Math.round(255*a)}});break;case"sam.mouth":r.sam&&n.updateInstrument(r.id,{sam:{...r.sam,mouth:Math.round(255*a)}});break;case"sam.throat":r.sam&&n.updateInstrument(r.id,{sam:{...r.sam,throat:Math.round(255*a)}});break;case"organ.drawbar16":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(0,8*a);break}case"organ.drawbar8":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(2,8*a);break}case"organ.drawbar4":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(3,8*a);break}case"organ.percussion":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(9,a);break}case"organ.vibratoType":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(13,Math.round(5*a));break}case"organ.vibratoDepth":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(14,a);break}case"organ.overdrive":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(15,a);break}case"organ.volume":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(16,a);break}case"melodica.breath":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(0,a);break}case"melodica.brightness":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(1,a);break}case"melodica.vibratoRate":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(2,10*a);break}case"melodica.vibratoDepth":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(3,a);break}case"melodica.detune":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(4,100*a-50);break}case"melodica.portamento":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(6,a);break}case"melodica.attack":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(7,a);break}case"melodica.volume":{const e=fy(r.id);e&&"setParameter"in e&&e.setParameter(9,a);break}case"echo.rate":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,rate:50+950*a}});break}case"echo.intensity":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,intensity:1.2*a}});break}case"echo.echoVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,echoVolume:a}});break}case"echo.reverbVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,reverbVolume:a}});break}case"echo.mode":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,mode:Math.floor(1+11*a)}});break}case"biphase.rateA":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,rateA:.1+9.9*a}});break}case"biphase.feedback":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,feedback:.95*a}});break}case"biphase.routing":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&n.updateEffect(r.id,e.id,{parameters:{...e.parameters,routing:a>.5?1:0}});break}case"mixer.volume":n.updateInstrument(r.id,{volume:60*a-60});break;case"mixer.pan":n.updateInstrument(r.id,{pan:200*a-100})}};function yy(e,t){return`${e}:${t}`}function by(e,t,a,n){return t+function(e,t="linear"){const a=Math.max(0,Math.min(127,e))/127;switch(t){case"exponential":return Math.pow(a,2);case"logarithmic":return Math.sqrt(a);default:return a}}(e,n)*(a-t)}const vy=[{ccNumber:74,parameter:"cutoff",min:200,max:2e4,curve:"logarithmic"},{ccNumber:71,parameter:"resonance",min:0,max:100,curve:"linear"},{ccNumber:10,parameter:"envMod",min:0,max:100,curve:"linear"},{ccNumber:75,parameter:"decay",min:30,max:3e3,curve:"logarithmic"},{ccNumber:16,parameter:"accent",min:0,max:100,curve:"linear"}],xy=new Map,wy=new Map,ky=n()(Gm(Fa((e,t)=>({isSupported:null,isInitialized:!1,lastError:null,inputDevices:[],outputDevices:[],selectedInputId:null,selectedOutputId:null,ccMappings:[...vy],isLearning:!1,learningParameter:null,lastActivityTimestamp:0,controlledInstrumentId:null,knobBank:"303",padBank:"A",midiOctaveOffset:0,showPatternDialog:!1,showKnobBar:!1,midiOutputEnabled:!0,init:async()=>{const a=ny();if(!a.isSupported())return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported in this browser"}),!1;e(e=>{e.isSupported=!0});try{if(await a.init()){a.addMessageHandler(e=>{const a=t();if(a.updateActivity(),"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){if(cy().getMapping(e.channel,e.note))return;if(36===e.note)return void a.setKnobBank("303");if(37===e.note)return void a.setKnobBank("Siren");if(38===e.note)return void a.setKnobBank("FX");if(39===e.note)return void a.setKnobBank("Mixer");const t=a.midiOctaveOffset||0,s=e.note+12*t,r=py(s).replace("-",""),i=Pg.getState(),o=i.currentInstrumentId,l=i.instruments.find(e=>e.id===o),c=i.previewInstrument||l||i.instruments[0];Math.pow(2,(s-69)/12);if(c){const t="TB303"===(n=c.synthType)||"Buzz3o3"===n||"Buzz3o3DF"===n?"303":"DubSiren"===n?"Siren":n.startsWith("Furnace")?"Furnace":"V2"===n||"V2Speech"===n?"V2":"Synare"===n?"Synare":"Dexed"===n||"DexedBridge"===n?"Dexed":"OBXd"===n?"OBXd":"SpaceLaser"===n?"SpaceLaser":"Sam"===n?"SAM":"TonewheelOrgan"===n?"Organ":"Melodica"===n?"Melodica":null;t&&a.knobBank!==t&&a.setKnobBank(t);const s=Km(),{midiPolyphonic:i}=Wm.getState(),o=e.velocity/127,l=Math.max(.5,Math.sqrt(o));if(wy.set(e.note,r),i)s.triggerPolyNoteAttack(c.id,r,l,c);else{if(wy.size>1){for(const[a,n]of wy.entries())a!==e.note&&s.triggerPolyNoteRelease(c.id,n,c);const t=wy.get(e.note);wy.clear(),t&&wy.set(e.note,t)}s.triggerPolyNoteAttack(c.id,r,l,c)}}return}var n;if("noteOff"===e.type&&void 0!==e.note){if(cy().getMapping(e.channel,e.note))return;const t=wy.get(e.note);if(t){wy.delete(e.note);const a=Pg.getState(),n=a.currentInstrumentId,s=a.instruments.find(e=>e.id===n),r=a.previewInstrument||s||a.instruments[0];if(r){Km().triggerPolyNoteRelease(r.id,t,r)}}return}if("pitchBend"===e.type&&void 0!==e.pitchBend){const t=my[a.knobBank];if(t?.x){const a=Math.round((e.pitchBend+8192)/16383*127);gy(t.x.param,a)}return}if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value){if(1===e.cc){const t=my[a.knobBank];t?.y&&gy(t.y.param,e.value)}if(a.isLearning&&a.learningParameter)return void a.handleLearnedCC(e.cc);if(e.cc>=70&&e.cc<=77){const t=hy[a.knobBank].find(t=>t.cc===e.cc);if(t)return void gy(t.param,e.value)}const t=a.ccMappings.find(t=>t.ccNumber===e.cc);if(t){const a=e.value/127;let n;if("logarithmic"===t.curve){const e=Math.max(1,t.min),s=Math.max(e+1,t.max),r=Math.log(e),i=Math.log(s);n=Math.exp(r+a*(i-r))}else n=t.min+a*(t.max-t.min);const s=xy.get(t.parameter);s&&s(n)}}}),a.onDeviceChange(()=>{t().refreshDevices();const a=t();!a.selectedInputId&&a.inputDevices.length>0&&t().selectInput(a.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0})}),t().refreshDevices();const n=t();!n.selectedInputId&&n.inputDevices.length>0&&await t().selectInput(n.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0});ry().init();return oy().init(),e(e=>{e.isInitialized=!0,e.lastError=null}),!0}return e(e=>{e.lastError="Failed to initialize MIDI access"}),!1}catch(n){return e(e=>{e.lastError=n instanceof Error?n.message:"Unknown error"}),!1}},refreshDevices:()=>{const t=ny();e(e=>{e.inputDevices=t.getInputDevices(),e.outputDevices=t.getOutputDevices();const a=t.getSelectedInput(),n=t.getSelectedOutput();e.selectedInputId=a?.id||null,e.selectedOutputId=n?.id||null})},selectInput:async t=>{const a=ny();await a.selectInput(t),e(e=>{e.selectedInputId=t})},selectOutput:t=>{ny().selectOutput(t),e(e=>{e.selectedOutputId=t})},setMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t.ccNumber&&e.parameter!==t.parameter),e.ccMappings.push(t)})},removeMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t)})},resetMappings:()=>{e(e=>{e.ccMappings=[...vy]})},startLearn:t=>{e(e=>{e.isLearning=!0,e.learningParameter=t})},cancelLearn:()=>{e(e=>{e.isLearning=!1,e.learningParameter=null})},handleLearnedCC:a=>{const{learningParameter:n}=t();if(!n)return;const s=vy.find(e=>e.parameter===n),r=s?{...s,ccNumber:a}:{ccNumber:a,parameter:n,min:0,max:100,curve:"linear"};e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==a&&e.parameter!==n),e.ccMappings.push(r),e.isLearning=!1,e.learningParameter=null})},updateActivity:()=>{const a=Date.now(),n=t().lastActivityTimestamp;a-n>100&&e(e=>{e.lastActivityTimestamp=a})},openPatternDialog:()=>{e(e=>{e.showPatternDialog=!0})},closePatternDialog:()=>{e(e=>{e.showPatternDialog=!1})},registerCCHandler:(e,t)=>{xy.set(e,t)},unregisterCCHandler:e=>{xy.delete(e)},setControlledInstrument:t=>{e(e=>{e.controlledInstrumentId=t})},setKnobBank:t=>e(e=>{e.knobBank=t}),togglePadBank:()=>e(e=>{e.padBank="A"===e.padBank?"B":"A"}),setPadBank:t=>e(e=>{e.padBank=t}),setShowKnobBar:t=>{e(e=>{e.showKnobBar=t})},sendCC:(e,a,n=0)=>{const{midiOutputEnabled:s}=t();if(!s)return;const r=ny(),i=Math.max(0,Math.min(127,Math.round(a)));r.sendCC(n,e,i)},setMidiOutputEnabled:t=>{e(e=>{e.midiOutputEnabled=t})},setMidiOctaveOffset:t=>{e(e=>{e.midiOctaveOffset=Math.max(-4,Math.min(4,t))})},gridMappings:{},gridIsLearning:!1,gridLearningParameter:null,addGridMapping:t=>{t.channel<0||t.channel>15||t.controller<0||t.controller>127||t.min>t.max||e(e=>{const a=yy(t.channel,t.controller);e.gridMappings[a]=t})},removeGridMapping:(t,a)=>{e(e=>{const n=yy(t,a);delete e.gridMappings[n]})},getGridMapping:(e,a)=>{const n=yy(e,a);return t().gridMappings[n]},clearGridMappings:()=>{e(e=>{e.gridMappings={}})},startGridLearning:a=>{t().gridIsLearning||e(e=>{e.gridIsLearning=!0,e.gridLearningParameter=a})},stopGridLearning:()=>{e(e=>{e.gridIsLearning=!1,e.gridLearningParameter=null})},applyGridMIDIValue:(e,a,n)=>{const s=t().getGridMapping(e,a);return s?by(n,s.min,s.max,s.curve):null}})),{name:"midi-settings",partialize:e=>({ccMappings:e.ccMappings,selectedInputId:e.selectedInputId,selectedOutputId:e.selectedOutputId,controlledInstrumentId:e.controlledInstrumentId,knobBank:e.knobBank,showKnobBar:e.showKnobBar,midiOutputEnabled:e.midiOutputEnabled,midiOctaveOffset:e.midiOctaveOffset,gridMappings:e.gridMappings})})),Sy=n((e,t)=>({activeNotes:new Map,adsrStages:new Map,adsrProgress:new Map,lfoPhases:new Map,samplePositions:new Map,setActiveNote:(t,a)=>{e(e=>{const n=new Map(e.activeNotes),s=n.get(t)||[],r=s.findIndex(e=>e.note===a.note);return r>=0?s[r]=a:s.push(a),n.set(t,s),{activeNotes:n}})},clearActiveNote:(t,a)=>{e(e=>{const n=new Map(e.activeNotes),s=(n.get(t)||[]).filter(e=>e.note!==a);return 0===s.length?n.delete(t):n.set(t,s),{activeNotes:n}})},clearChannelNotes:t=>{e(e=>{const a=new Map(e.activeNotes);return a.delete(t),{activeNotes:a}})},clearAllNotes:()=>{e({activeNotes:new Map})},setADSRStage:(t,a,n=0)=>{e(e=>{const s=new Map(e.adsrStages),r=new Map(e.adsrProgress);return s.set(t,a),r.set(t,n),{adsrStages:s,adsrProgress:r}})},setADSRProgress:(t,a)=>{e(e=>{const n=new Map(e.adsrProgress);return n.set(t,a),{adsrProgress:n}})},setLFOPhase:(t,a)=>{e(e=>{const n=new Map(e.lfoPhases);return n.set(t,a),{lfoPhases:n}})},setSamplePosition:(t,a)=>{e(e=>{const n=new Map(e.samplePositions);return n.set(t,Math.max(0,Math.min(1,a))),{samplePositions:n}})},clearSamplePosition:t=>{e(e=>{const a=new Map(e.samplePositions);return a.delete(t),{samplePositions:a}})}})),My=n()(Fa((e,t)=>({isLiveMode:!1,pendingPatternIndex:null,pendingPositionIndex:null,queueMode:"end-of-pattern",channelQueues:new Map,showQueueCountdown:!0,barsUntilSwitch:0,toggleLiveMode:()=>{const a=!t().isLiveMode;e(e=>{e.isLiveMode=a,a||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues=new Map)})},setLiveMode:t=>{e(e=>{e.isLiveMode=t,t||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues.clear())})},queuePattern:t=>{e(e=>{e.pendingPatternIndex=t})},queuePosition:t=>{e(e=>{e.pendingPositionIndex=t})},clearQueue:()=>{e(e=>{e.pendingPatternIndex=null,e.pendingPositionIndex=null})},setQueueMode:t=>{e(e=>{e.queueMode=t})},queueChannelAction:(t,a)=>{e(e=>{const n=e.channelQueues.get(t)||[];n.push(a),e.channelQueues.set(t,n)})},clearChannelQueue:t=>{e(e=>{e.channelQueues.delete(t)})},popChannelAction:a=>{const n=t().channelQueues.get(a);if(!n||0===n.length)return;const s=n.shift();return e(e=>{0===n.length?e.channelQueues.delete(a):e.channelQueues.set(a,n)}),s},updateBarsUntilSwitch:t=>{e(e=>{e.barsUntilSwitch=t})},setShowQueueCountdown:t=>{e(e=>{e.showQueueCountdown=t})}}))),Ny={horizontalZoom:16,verticalZoom:12,scrollX:0,scrollY:48,snapToGrid:!0,gridDivision:4,showVelocity:!0,showVelocityLane:!1,channelIndex:0,multiChannel:!1,scaleKey:"chromatic",scaleRoot:0,noteLengthPreset:0},Cy={notes:new Set,startRow:null,endRow:null,startNote:null,endNote:null},Ey=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Py(e){const t=Math.floor(e/12)-1;return`${Ey[e%12]}${t}`}function _y(e){return[1,3,6,8,10].includes(e%12)}const Ty=[{label:"Grid",value:0},{label:"1/32",value:1},{label:"1/16",value:2},{label:"1/8",value:4},{label:"1/4",value:8},{label:"1/2",value:16},{label:"1/1",value:32}],Ay=n()(Fa((e,t)=>({view:{...Ny},selection:{...Cy,notes:new Set},drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},tool:"select",clipboard:null,contextMenu:{visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},ghostNotes:[],setHorizontalZoom:t=>e(e=>{e.view.horizontalZoom=Math.max(4,Math.min(64,t))}),setVerticalZoom:t=>e(e=>{e.view.verticalZoom=Math.max(8,Math.min(32,t))}),setScroll:(t,a)=>e(e=>{e.view.scrollX=Math.max(0,t),e.view.scrollY=Math.max(0,Math.min(127,a))}),scrollBy:(t,a)=>e(e=>{e.view.scrollX=Math.max(0,e.view.scrollX+t),e.view.scrollY=Math.max(0,Math.min(127,e.view.scrollY+a))}),setSnapToGrid:t=>e(e=>{e.view.snapToGrid=t}),setGridDivision:t=>e(e=>{e.view.gridDivision=t}),setShowVelocity:t=>e(e=>{e.view.showVelocity=t}),setShowVelocityLane:t=>e(e=>{e.view.showVelocityLane=t}),setChannelIndex:t=>e(e=>{e.view.channelIndex=t}),setMultiChannel:t=>e(e=>{e.view.multiChannel=t}),setScaleKey:t=>e(e=>{e.view.scaleKey=t}),setScaleRoot:t=>e(e=>{e.view.scaleRoot=Math.max(0,Math.min(11,t))}),setNoteLengthPreset:t=>e(e=>{e.view.noteLengthPreset=t}),selectNote:(t,a=!1)=>e(e=>{a?e.selection.notes.add(t):e.selection.notes=new Set([t])}),selectNotes:t=>e(e=>{e.selection.notes=new Set(t)}),selectAll:t=>e(e=>{e.selection.notes=new Set(t)}),deselectNote:t=>e(e=>{e.selection.notes.delete(t)}),clearSelection:()=>e(e=>{e.selection.notes=new Set,e.selection.startRow=null,e.selection.endRow=null,e.selection.startNote=null,e.selection.endNote=null}),setSelectionBox:(t,a,n,s)=>e(e=>{e.selection.startRow=t,e.selection.endRow=a,e.selection.startNote=n,e.selection.endNote=s}),startDrag:(t,a,n,s)=>e(e=>{e.drag.isDragging=!0,e.drag.mode=t,e.drag.startX=a,e.drag.startY=n,e.drag.currentX=a,e.drag.currentY=n,e.drag.noteId=s||null}),updateDrag:(t,a)=>e(e=>{e.drag.currentX=t,e.drag.currentY=a}),endDrag:()=>e(e=>{e.drag.isDragging=!1,e.drag.mode="none",e.drag.noteId=null,e.drag.originalNotes=[],e.ghostNotes=[]}),setTool:t=>e(e=>{e.tool=t}),copyNotes:t=>e(e=>{if(0===t.length)return;const a=Math.min(...t.map(e=>e.startRow)),n=Math.min(...t.map(e=>e.midiNote));e.clipboard={notes:t.map(e=>({...e})),minRow:a,minNote:n}}),getClipboard:()=>t().clipboard,showContextMenu:(t,a,n,s,r)=>e(e=>{e.contextMenu={visible:!0,x:t,y:a,noteId:n,row:s,midiNote:r}}),hideContextMenu:()=>e(e=>{e.contextMenu.visible=!1}),setGhostNotes:t=>e(e=>{e.ghostNotes=t}),clearGhostNotes:()=>e(e=>{e.ghostNotes=[]}),resetView:()=>e(e=>{e.view={...Ny},e.selection={...Cy,notes:new Set},e.drag={isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},e.tool="select",e.clipboard=null,e.contextMenu={visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},e.ghostNotes=[]})}))),Oy=0,Iy=1,Dy=2,Fy=3,Ry="Synthesis",jy="Filter",Ly="Envelope",By="LFO",Vy="Effects",zy="Modulation",Uy="Arpeggiator",Gy="Output",Wy=1313559366,Hy=1313428297,Ky=1313426241,$y=1347179847,qy=1,Xy=0,Yy="DEViLBOX",Qy="devilbox-tracker-v1",Zy=[{id:"tb303.cutoff",name:"Cutoff",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:74,isAutomatable:!0},{id:"tb303.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,ccNumber:71,isAutomatable:!0},{id:"tb303.envMod",name:"Env Mod",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,ccNumber:102,isAutomatable:!0},{id:"tb303.decay",name:"Decay",section:Ly,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,ccNumber:103,isAutomatable:!0},{id:"tb303.accent",name:"Accent",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,ccNumber:104,isAutomatable:!0},{id:"tb303.tuning",name:"Tuning",section:Ry,type:Oy,min:-1,max:1,defaultValue:0,unit:"semi",formatString:"%.1f",page:0,index:5,ccNumber:105,isAutomatable:!0},{id:"tb303.waveform",name:"Waveform",section:Ry,type:Fy,min:0,max:1,defaultValue:0,valueStrings:["Saw","Square"],page:0,index:6,ccNumber:106,isAutomatable:!0},{id:"tb303.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"dB",formatString:"%.1f",page:0,index:7,ccNumber:7,isAutomatable:!0},{id:"tb303.distortion",name:"Distortion",section:Vy,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:0,ccNumber:94,isAutomatable:!0},{id:"tb303.delay.time",name:"Delay Time",section:Vy,type:Oy,min:0,max:1,defaultValue:.375,unit:"ms",formatString:"%.0f",page:1,index:1,ccNumber:85,isAutomatable:!0},{id:"tb303.delay.feedback",name:"Delay Fdbk",section:Vy,type:Oy,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,ccNumber:86,isAutomatable:!0},{id:"tb303.delay.mix",name:"Delay Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,ccNumber:87,isAutomatable:!0},{id:"tb303.reverb.size",name:"Reverb Size",section:Vy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:4,ccNumber:91,isAutomatable:!0},{id:"tb303.reverb.mix",name:"Reverb Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:5,ccNumber:92,isAutomatable:!0}],Jy=[{id:"dexed.algorithm",name:"Algorithm",section:Ry,type:Iy,min:0,max:31,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"dexed.feedback",name:"Feedback",section:Ry,type:Iy,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"dexed.lfoSpeed",name:"LFO Speed",section:By,type:Iy,min:0,max:99,defaultValue:35,page:0,index:2,isAutomatable:!0},{id:"dexed.lfoPitchModDepth",name:"LFO Pitch",section:By,type:Iy,min:0,max:99,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"dexed.lfoAmpModDepth",name:"LFO Amp",section:By,type:Iy,min:0,max:99,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"dexed.lfoWave",name:"LFO Wave",section:By,type:Fy,min:0,max:5,defaultValue:0,valueStrings:["Triangle","Saw Down","Saw Up","Square","Sine","S&H"],page:0,index:5,isAutomatable:!0},{id:"dexed.transpose",name:"Transpose",section:Ry,type:Iy,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:6,isAutomatable:!0},{id:"dexed.oscSync",name:"Osc Sync",section:Ry,type:Dy,min:0,max:1,defaultValue:1,page:0,index:7,isAutomatable:!0},...function(){const e=[];for(let t=0;t<6;t++){const a=t+1;e.push({id:`dexed.op${t+1}.level`,name:`OP${t+1} Level`,section:Ry,type:Iy,min:0,max:99,defaultValue:0===t?99:0,page:a,index:0,isAutomatable:!0},{id:`dexed.op${t+1}.coarse`,name:`OP${t+1} Coarse`,section:Ry,type:Iy,min:0,max:31,defaultValue:1,page:a,index:1,isAutomatable:!0},{id:`dexed.op${t+1}.fine`,name:`OP${t+1} Fine`,section:Ry,type:Iy,min:0,max:99,defaultValue:0,page:a,index:2,isAutomatable:!0},{id:`dexed.op${t+1}.detune`,name:`OP${t+1} Detune`,section:Ry,type:Iy,min:0,max:14,defaultValue:7,page:a,index:3,isAutomatable:!0},{id:`dexed.op${t+1}.egRate1`,name:`OP${t+1} R1`,section:Ly,type:Iy,min:0,max:99,defaultValue:99,page:a,index:4,isAutomatable:!0},{id:`dexed.op${t+1}.egRate2`,name:`OP${t+1} R2`,section:Ly,type:Iy,min:0,max:99,defaultValue:99,page:a,index:5,isAutomatable:!0},{id:`dexed.op${t+1}.egRate3`,name:`OP${t+1} R3`,section:Ly,type:Iy,min:0,max:99,defaultValue:99,page:a,index:6,isAutomatable:!0},{id:`dexed.op${t+1}.egRate4`,name:`OP${t+1} R4`,section:Ly,type:Iy,min:0,max:99,defaultValue:99,page:a,index:7,isAutomatable:!0})}return e}()];const eb=[{id:"polysynth.oscillator.type",name:"Waveform",section:Ry,type:Fy,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"polysynth.oscillator.detune",name:"Detune",section:Ry,type:Oy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"polysynth.filter.frequency",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"polysynth.filter.Q",name:"Resonance",section:jy,type:Oy,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"polysynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"polysynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"polysynth.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"polysynth.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"polysynth.maxPolyphony",name:"Voices",section:Ry,type:Iy,min:1,max:32,defaultValue:8,page:1,index:0,isAutomatable:!0},{id:"polysynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0}],tb=[{id:"noisesynth.noise.type",name:"Noise Type",section:Ry,type:Fy,min:0,max:2,defaultValue:0,valueStrings:["White","Pink","Brown"],page:0,index:0,isAutomatable:!0},{id:"noisesynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.005,unit:"s",formatString:"%.3f",page:0,index:1,isAutomatable:!0},{id:"noisesynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"noisesynth.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"noisesynth.envelope.release",name:"Release",section:Ly,type:Oy,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"noisesynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],ab=[{id:"sampler.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:0,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"sampler.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"sampler.baseUrl",name:"Sample",section:Ry,type:Fy,min:0,max:0,defaultValue:0,page:0,index:2,isAutomatable:!1},{id:"sampler.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],nb=[{id:"furnace.algorithm",name:"Algorithm",section:Ry,type:Iy,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"furnace.feedback",name:"Feedback",section:Ry,type:Iy,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"furnace.op1.level",name:"OP1 Level",section:Ry,type:Iy,min:0,max:127,defaultValue:99,page:0,index:2,isAutomatable:!0},{id:"furnace.op1.mult",name:"OP1 Mult",section:Ry,type:Iy,min:0,max:15,defaultValue:1,page:0,index:3,isAutomatable:!0},{id:"furnace.op2.level",name:"OP2 Level",section:Ry,type:Iy,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.op2.mult",name:"OP2 Mult",section:Ry,type:Iy,min:0,max:15,defaultValue:1,page:0,index:5,isAutomatable:!0},{id:"furnace.lfoRate",name:"LFO Rate",section:By,type:Iy,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],sb=[{id:"furnace.duty",name:"Duty Cycle",section:Ry,type:Fy,min:0,max:3,defaultValue:2,valueStrings:["12.5%","25%","50%","75%"],page:0,index:0,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Gy,type:Iy,min:0,max:15,defaultValue:15,page:0,index:1,isAutomatable:!0},{id:"furnace.arpSpeed",name:"Arp Speed",section:Uy,type:Iy,min:0,max:15,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"furnace.pitchSlide",name:"Pitch Slide",section:zy,type:Iy,min:-127,max:127,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"furnace.vibrato",name:"Vibrato",section:By,type:Iy,min:0,max:15,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.noise",name:"Noise",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"furnace.envelope",name:"Env Mode",section:Ly,type:Iy,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0}],rb=[{id:"buzzmachine.param0",name:"Param 1",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"buzzmachine.param1",name:"Param 2",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"buzzmachine.param2",name:"Param 3",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"buzzmachine.param3",name:"Param 4",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"buzzmachine.param4",name:"Param 5",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"buzzmachine.param5",name:"Param 6",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"buzzmachine.param6",name:"Param 7",section:Ly,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"buzzmachine.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ib=[{id:"generic.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:7,isAutomatable:!0},{id:"generic.pan",name:"Pan",section:Gy,type:Oy,min:-1,max:1,defaultValue:0,formatString:"%.2f",page:0,index:1,ccNumber:10,isAutomatable:!0}],ob={TB303:Zy,Dexed:Jy,OBXd:[{id:"obxd.osc1Waveform",name:"Osc1 Wave",section:Ry,type:Fy,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"obxd.osc1Octave",name:"Osc1 Oct",section:Ry,type:Iy,min:-2,max:2,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"obxd.osc1PulseWidth",name:"Osc1 PW",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"obxd.osc1Level",name:"Osc1 Level",section:Ry,type:Oy,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"obxd.osc2Waveform",name:"Osc2 Wave",section:Ry,type:Fy,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:4,isAutomatable:!0},{id:"obxd.osc2Octave",name:"Osc2 Oct",section:Ry,type:Iy,min:-2,max:2,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"obxd.osc2Detune",name:"Osc2 Detune",section:Ry,type:Oy,min:-1,max:1,defaultValue:.1,unit:"semi",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"obxd.osc2Level",name:"Osc2 Level",section:Ry,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"obxd.filterCutoff",name:"Cutoff",section:jy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:0,isAutomatable:!0},{id:"obxd.filterResonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"obxd.filterEnvAmount",name:"Env Amount",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"obxd.filterKeyTrack",name:"Key Track",section:jy,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"obxd.filterAttack",name:"Flt Attack",section:Ly,type:Oy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:1,index:4,isAutomatable:!0},{id:"obxd.filterDecay",name:"Flt Decay",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:5,isAutomatable:!0},{id:"obxd.filterSustain",name:"Flt Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"obxd.filterRelease",name:"Flt Release",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:7,isAutomatable:!0},{id:"obxd.ampAttack",name:"Amp Attack",section:Ly,type:Oy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:2,index:0,isAutomatable:!0},{id:"obxd.ampDecay",name:"Amp Decay",section:Ly,type:Oy,min:0,max:1,defaultValue:.2,unit:"s",formatString:"%.2f",page:2,index:1,isAutomatable:!0},{id:"obxd.ampSustain",name:"Amp Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:2,isAutomatable:!0},{id:"obxd.ampRelease",name:"Amp Release",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:2,index:3,isAutomatable:!0},{id:"obxd.masterVolume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:4,isAutomatable:!0},{id:"obxd.portamento",name:"Portamento",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:2,index:5,isAutomatable:!0},{id:"obxd.unison",name:"Unison",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:2,index:6,isAutomatable:!0},{id:"obxd.unisonDetune",name:"Uni Detune",section:Ry,type:Oy,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:2,index:7,isAutomatable:!0},{id:"obxd.lfoRate",name:"LFO Rate",section:By,type:Oy,min:0,max:1,defaultValue:.2,unit:"Hz",formatString:"%.1f",page:3,index:0,isAutomatable:!0},{id:"obxd.lfoWaveform",name:"LFO Wave",section:By,type:Fy,min:0,max:4,defaultValue:0,valueStrings:["Sine","Triangle","Saw","Square","S&H"],page:3,index:1,isAutomatable:!0},{id:"obxd.lfoOscAmount",name:"LFO>Pitch",section:By,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:2,isAutomatable:!0},{id:"obxd.lfoFilterAmount",name:"LFO>Filter",section:By,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:3,isAutomatable:!0},{id:"obxd.lfoAmpAmount",name:"LFO>Amp",section:By,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:4,isAutomatable:!0},{id:"obxd.lfoPwAmount",name:"LFO>PW",section:By,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:5,isAutomatable:!0},{id:"obxd.oscSync",name:"Osc Sync",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:3,index:6,isAutomatable:!0},{id:"obxd.oscXor",name:"Ring Mod",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:3,index:7,isAutomatable:!0}],DubSiren:[{id:"dubsiren.oscillator.type",name:"Osc Type",section:Ry,type:Fy,min:0,max:3,defaultValue:0,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:0,isAutomatable:!0},{id:"dubsiren.oscillator.frequency",name:"Frequency",section:Ry,type:Oy,min:60,max:1e3,defaultValue:440,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"dubsiren.lfo.enabled",name:"LFO On",section:By,type:Dy,min:0,max:1,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"dubsiren.lfo.type",name:"LFO Type",section:By,type:Fy,min:0,max:3,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:3,isAutomatable:!0},{id:"dubsiren.lfo.rate",name:"LFO Rate",section:By,type:Oy,min:0,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"dubsiren.lfo.depth",name:"LFO Depth",section:By,type:Oy,min:0,max:1e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"dubsiren.filter.enabled",name:"Filter On",section:jy,type:Dy,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"dubsiren.filter.frequency",name:"Filter Freq",section:jy,type:Oy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"dubsiren.delay.enabled",name:"Delay On",section:Vy,type:Dy,min:0,max:1,defaultValue:1,page:1,index:0,isAutomatable:!0},{id:"dubsiren.delay.time",name:"Delay Time",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"dubsiren.delay.feedback",name:"Delay Fdbk",section:Vy,type:Oy,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"dubsiren.delay.wet",name:"Delay Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"dubsiren.reverb.enabled",name:"Reverb On",section:Vy,type:Dy,min:0,max:1,defaultValue:1,page:1,index:4,isAutomatable:!0},{id:"dubsiren.reverb.decay",name:"Reverb Dec",section:Vy,type:Oy,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"dubsiren.reverb.wet",name:"Reverb Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],SpaceLaser:[{id:"spacelaser.laser.startFreq",name:"Start Freq",section:Ry,type:Oy,min:100,max:1e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"spacelaser.laser.endFreq",name:"End Freq",section:Ry,type:Oy,min:20,max:2e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"spacelaser.laser.sweepTime",name:"Sweep Time",section:Ly,type:Oy,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"spacelaser.laser.sweepCurve",name:"Curve",section:Ly,type:Fy,min:0,max:1,defaultValue:0,valueStrings:["Exp","Linear"],page:0,index:3,isAutomatable:!0},{id:"spacelaser.fm.amount",name:"FM Amount",section:zy,type:Oy,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"spacelaser.fm.ratio",name:"FM Ratio",section:zy,type:Oy,min:.5,max:16,defaultValue:1,formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"spacelaser.noise.amount",name:"Noise",section:Ry,type:Oy,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"spacelaser.filter.cutoff",name:"Filter",section:jy,type:Oy,min:20,max:2e4,defaultValue:2e4,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"spacelaser.delay.enabled",name:"Delay On",section:Vy,type:Dy,min:0,max:1,defaultValue:0,page:1,index:0,isAutomatable:!0},{id:"spacelaser.delay.time",name:"Delay Time",section:Vy,type:Oy,min:0,max:1,defaultValue:.25,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"spacelaser.delay.feedback",name:"Delay Fdbk",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"spacelaser.delay.wet",name:"Delay Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"spacelaser.reverb.enabled",name:"Reverb On",section:Vy,type:Dy,min:0,max:1,defaultValue:0,page:1,index:4,isAutomatable:!0},{id:"spacelaser.reverb.decay",name:"Reverb Dec",section:Vy,type:Oy,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"spacelaser.reverb.wet",name:"Reverb Mix",section:Vy,type:Oy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],Synare:[{id:"synare.oscillator.tune",name:"Tune",section:Ry,type:Oy,min:20,max:1e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"synare.oscillator.fine",name:"Fine Tune",section:Ry,type:Oy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"synare.oscillator2.enabled",name:"Osc2 On",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"synare.oscillator2.detune",name:"Osc2 Detune",section:Ry,type:Oy,min:-24,max:24,defaultValue:7,unit:"semi",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"synare.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"synare.filter.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:100,defaultValue:20,unit:"%",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"synare.filter.envMod",name:"Flt Env",section:jy,type:Oy,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"synare.filter.decay",name:"Flt Decay",section:Ly,type:Oy,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"synare.envelope.decay",name:"Amp Decay",section:Ly,type:Oy,min:10,max:2e3,defaultValue:300,unit:"ms",formatString:"%.0f",page:1,index:0,isAutomatable:!0},{id:"synare.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"synare.sweep.enabled",name:"Sweep On",section:zy,type:Dy,min:0,max:1,defaultValue:1,page:1,index:2,isAutomatable:!0},{id:"synare.sweep.amount",name:"Sweep Amt",section:zy,type:Oy,min:0,max:48,defaultValue:12,unit:"semi",formatString:"%.0f",page:1,index:3,isAutomatable:!0},{id:"synare.sweep.time",name:"Sweep Time",section:zy,type:Oy,min:1,max:500,defaultValue:50,unit:"ms",formatString:"%.0f",page:1,index:4,isAutomatable:!0},{id:"synare.noise.enabled",name:"Noise On",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"synare.noise.mix",name:"Noise Mix",section:Ry,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"synare.noise.color",name:"Noise Color",section:Ry,type:Oy,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:1,index:7,isAutomatable:!0}],V2:[{id:"v2.osc1.mode",name:"Osc1 Mode",section:Ry,type:Fy,min:0,max:7,defaultValue:1,valueStrings:["Off","Saw/Tri","Pulse","Sin","Noise","XX","AuxA","AuxB"],page:0,index:0,isAutomatable:!0},{id:"v2.osc1.transpose",name:"Osc1 Trans",section:Ry,type:Iy,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:1,isAutomatable:!0},{id:"v2.osc1.color",name:"Osc1 Color",section:Ry,type:Iy,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"v2.osc1.level",name:"Osc1 Level",section:Ry,type:Iy,min:0,max:127,defaultValue:127,page:0,index:3,isAutomatable:!0},{id:"v2.osc2.mode",name:"Osc2 Mode",section:Ry,type:Fy,min:0,max:7,defaultValue:0,valueStrings:["!Off","Tri","Pulse","Sin","Noise","FM","AuxA","AuxB"],page:0,index:4,isAutomatable:!0},{id:"v2.osc2.transpose",name:"Osc2 Trans",section:Ry,type:Iy,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:5,isAutomatable:!0},{id:"v2.osc2.detune",name:"Osc2 Detune",section:Ry,type:Iy,min:-64,max:63,defaultValue:10,page:0,index:6,isAutomatable:!0},{id:"v2.osc2.level",name:"Osc2 Level",section:Ry,type:Iy,min:0,max:127,defaultValue:0,page:0,index:7,isAutomatable:!0},{id:"v2.filter1.mode",name:"Flt1 Mode",section:jy,type:Fy,min:0,max:7,defaultValue:1,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:0,isAutomatable:!0},{id:"v2.filter1.cutoff",name:"Flt1 Cutoff",section:jy,type:Iy,min:0,max:127,defaultValue:127,page:1,index:1,isAutomatable:!0},{id:"v2.filter1.resonance",name:"Flt1 Reso",section:jy,type:Iy,min:0,max:127,defaultValue:0,page:1,index:2,isAutomatable:!0},{id:"v2.filter2.mode",name:"Flt2 Mode",section:jy,type:Fy,min:0,max:7,defaultValue:0,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:3,isAutomatable:!0},{id:"v2.filter2.cutoff",name:"Flt2 Cutoff",section:jy,type:Iy,min:0,max:127,defaultValue:127,page:1,index:4,isAutomatable:!0},{id:"v2.filter2.resonance",name:"Flt2 Reso",section:jy,type:Iy,min:0,max:127,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"v2.routing.mode",name:"Routing",section:jy,type:Fy,min:0,max:2,defaultValue:0,valueStrings:["Single","Serial","Parallel"],page:1,index:6,isAutomatable:!0},{id:"v2.routing.balance",name:"Balance",section:jy,type:Iy,min:0,max:127,defaultValue:64,page:1,index:7,isAutomatable:!0},{id:"v2.envelope.attack",name:"Amp Attack",section:Ly,type:Iy,min:0,max:127,defaultValue:0,page:2,index:0,isAutomatable:!0},{id:"v2.envelope.decay",name:"Amp Decay",section:Ly,type:Iy,min:0,max:127,defaultValue:64,page:2,index:1,isAutomatable:!0},{id:"v2.envelope.sustain",name:"Amp Sustain",section:Ly,type:Iy,min:0,max:127,defaultValue:127,page:2,index:2,isAutomatable:!0},{id:"v2.envelope.release",name:"Amp Release",section:Ly,type:Iy,min:0,max:127,defaultValue:32,page:2,index:3,isAutomatable:!0},{id:"v2.envelope2.attack",name:"Env2 Attack",section:Ly,type:Iy,min:0,max:127,defaultValue:0,page:2,index:4,isAutomatable:!0},{id:"v2.envelope2.decay",name:"Env2 Decay",section:Ly,type:Iy,min:0,max:127,defaultValue:64,page:2,index:5,isAutomatable:!0},{id:"v2.lfo1.rate",name:"LFO Rate",section:By,type:Iy,min:0,max:127,defaultValue:64,page:2,index:6,isAutomatable:!0},{id:"v2.lfo1.depth",name:"LFO Depth",section:By,type:Iy,min:0,max:127,defaultValue:0,page:2,index:7,isAutomatable:!0}],Sam:[{id:"sam.speed",name:"Speed",section:Ry,type:Iy,min:20,max:200,defaultValue:72,page:0,index:0,isAutomatable:!0},{id:"sam.pitch",name:"Pitch",section:Ry,type:Iy,min:20,max:200,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"sam.mouth",name:"Mouth",section:Ry,type:Iy,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"sam.throat",name:"Throat",section:Ry,type:Iy,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"sam.singMode",name:"Sing Mode",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"sam.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MonoSynth:[{id:"monosynth.oscillator.type",name:"Waveform",section:Ry,type:Fy,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"monosynth.oscillator.detune",name:"Detune",section:Ry,type:Oy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"monosynth.filter.frequency",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"monosynth.filter.Q",name:"Resonance",section:jy,type:Oy,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"monosynth.filterEnvelope.amount",name:"Flt Env",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"monosynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monosynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.2,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"monosynth.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"monosynth.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:1,index:0,isAutomatable:!0},{id:"monosynth.portamento",name:"Portamento",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"monosynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],DuoSynth:[{id:"duosynth.voice0.oscillator.type",name:"V0 Wave",section:Ry,type:Fy,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"duosynth.voice0.filter.frequency",name:"V0 Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"duosynth.voice0.filter.Q",name:"V0 Reso",section:jy,type:Oy,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"duosynth.voice0.envelope.attack",name:"V0 Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"duosynth.voice1.oscillator.type",name:"V1 Wave",section:Ry,type:Fy,min:0,max:4,defaultValue:2,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:4,isAutomatable:!0},{id:"duosynth.voice1.filter.frequency",name:"V1 Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"duosynth.voice1.filter.Q",name:"V1 Reso",section:jy,type:Oy,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"duosynth.harmonicity",name:"Harmonicity",section:Ry,type:Oy,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"duosynth.vibratoRate",name:"Vib Rate",section:By,type:Oy,min:0,max:20,defaultValue:5,unit:"Hz",formatString:"%.1f",page:1,index:0,isAutomatable:!0},{id:"duosynth.vibratoAmount",name:"Vib Amount",section:By,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"duosynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],PolySynth:eb,Synth:eb,FMSynth:[{id:"fmsynth.modulationIndex",name:"Mod Index",section:zy,type:Oy,min:0,max:100,defaultValue:10,formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"fmsynth.harmonicity",name:"Harmonicity",section:Ry,type:Oy,min:.5,max:8,defaultValue:1,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.attack",name:"Mod Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.decay",name:"Mod Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.sustain",name:"Mod Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"fmsynth.envelope.attack",name:"Amp Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"fmsynth.envelope.decay",name:"Amp Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"fmsynth.envelope.sustain",name:"Amp Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],AMSynth:[{id:"amsynth.harmonicity",name:"Harmonicity",section:Ry,type:Oy,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"amsynth.modulationEnvelope.attack",name:"Mod Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"amsynth.modulationEnvelope.decay",name:"Mod Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"amsynth.envelope.attack",name:"Amp Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"amsynth.envelope.decay",name:"Amp Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"amsynth.envelope.sustain",name:"Amp Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"amsynth.envelope.release",name:"Amp Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"amsynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MembraneSynth:[{id:"membranesynth.pitchDecay",name:"Pitch Decay",section:Ly,type:Oy,min:0,max:.5,defaultValue:.05,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"membranesynth.octaves",name:"Octaves",section:Ry,type:Oy,min:.5,max:8,defaultValue:4,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"membranesynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:2,isAutomatable:!0},{id:"membranesynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:.01,max:2,defaultValue:.4,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"membranesynth.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.01,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"membranesynth.envelope.release",name:"Release",section:Ly,type:Oy,min:.01,max:2,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"membranesynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],MetalSynth:[{id:"metalsynth.frequency",name:"Frequency",section:Ry,type:Oy,min:20,max:8e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"metalsynth.harmonicity",name:"Harmonicity",section:Ry,type:Oy,min:1,max:10,defaultValue:5.1,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"metalsynth.modulationIndex",name:"Mod Index",section:zy,type:Oy,min:0,max:100,defaultValue:32,formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"metalsynth.resonance",name:"Resonance",section:Ry,type:Oy,min:0,max:7e3,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"metalsynth.octaves",name:"Octaves",section:Ry,type:Oy,min:.5,max:4,defaultValue:1.5,formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"metalsynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:5,isAutomatable:!0},{id:"metalsynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:.01,max:4,defaultValue:1.4,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"metalsynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],NoiseSynth:tb,PluckSynth:[{id:"plucksynth.attackNoise",name:"Attack Noise",section:Ry,type:Oy,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"plucksynth.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.9,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"plucksynth.dampening",name:"Dampening",section:jy,type:Oy,min:1e3,max:1e4,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"plucksynth.release",name:"Release",section:Ly,type:Oy,min:.1,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"plucksynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0}],Sampler:ab,Player:ab,SuperSaw:[{id:"supersaw.detune",name:"Detune",section:Ry,type:Oy,min:0,max:100,defaultValue:30,unit:"ct",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"supersaw.mix",name:"Mix",section:Ry,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"supersaw.voices",name:"Voices",section:Ry,type:Iy,min:1,max:7,defaultValue:7,page:0,index:2,isAutomatable:!0},{id:"supersaw.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:8e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"supersaw.filter.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"supersaw.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"supersaw.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"supersaw.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Organ:[{id:"organ.drawbar1",name:"16'",section:Ry,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"organ.drawbar2",name:"5 1/3'",section:Ry,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"organ.drawbar3",name:"8'",section:Ry,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"organ.drawbar4",name:"4'",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"organ.drawbar5",name:"2 2/3'",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"organ.drawbar6",name:"2'",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"organ.percussion",name:"Percussion",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"organ.vibrato",name:"Vibrato",section:By,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DrumMachine:[{id:"drummachine.kick.tune",name:"Kick Tune",section:Ry,type:Oy,min:20,max:200,defaultValue:60,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"drummachine.kick.decay",name:"Kick Decay",section:Ly,type:Oy,min:.05,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"drummachine.snare.tune",name:"Snare Tune",section:Ry,type:Oy,min:100,max:400,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"drummachine.snare.snappy",name:"Snare Snap",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"drummachine.hihat.decay",name:"HiHat Decay",section:Ly,type:Oy,min:.01,max:1,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"drummachine.tone",name:"Tone",section:jy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"drummachine.accent",name:"Accent",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"drummachine.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ChipSynth:[{id:"chipsynth.waveform",name:"Waveform",section:Ry,type:Fy,min:0,max:4,defaultValue:1,valueStrings:["Square","Pulse25","Pulse12","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"chipsynth.duty",name:"Duty",section:Ry,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"chipsynth.pitchBend",name:"Pitch Bend",section:Ry,type:Iy,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:2,isAutomatable:!0},{id:"chipsynth.vibrato",name:"Vibrato",section:By,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"chipsynth.arpSpeed",name:"Arp Speed",section:Uy,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"chipsynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"chipsynth.envelope.decay",name:"Decay",section:Ly,type:Oy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"chipsynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],PWMSynth:[{id:"pwmsynth.pulseWidth",name:"Pulse Width",section:Ry,type:Oy,min:.01,max:.99,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"pwmsynth.lfo.rate",name:"LFO Rate",section:By,type:Oy,min:.1,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"pwmsynth.lfo.depth",name:"LFO Depth",section:By,type:Oy,min:0,max:.49,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"pwmsynth.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"pwmsynth.filter.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"pwmsynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"pwmsynth.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"pwmsynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WobbleBass:[{id:"wobblebass.lfo.rate",name:"Wobble Rate",section:By,type:Oy,min:.1,max:20,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"wobblebass.lfo.depth",name:"Wobble Depth",section:By,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"wobblebass.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:5e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wobblebass.filter.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.6,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wobblebass.distortion",name:"Distortion",section:Vy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"wobblebass.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wobblebass.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"wobblebass.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],StringMachine:[{id:"stringmachine.ensemble",name:"Ensemble",section:Vy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"stringmachine.detune",name:"Detune",section:Ry,type:Oy,min:0,max:50,defaultValue:15,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"stringmachine.voices",name:"Voices",section:Ry,type:Iy,min:2,max:8,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"stringmachine.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:1e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"stringmachine.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:3,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"stringmachine.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"stringmachine.chorus",name:"Chorus",section:Vy,type:Oy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"stringmachine.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],FormantSynth:[{id:"formantsynth.vowel",name:"Vowel",section:Ry,type:Fy,min:0,max:4,defaultValue:0,valueStrings:["A","E","I","O","U"],page:0,index:0,isAutomatable:!0},{id:"formantsynth.formant1",name:"Formant 1",section:jy,type:Oy,min:200,max:2e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"formantsynth.formant2",name:"Formant 2",section:jy,type:Oy,min:500,max:4e3,defaultValue:1200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"formantsynth.nasality",name:"Nasality",section:Ry,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"formantsynth.vibrato",name:"Vibrato",section:By,type:Oy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"formantsynth.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"formantsynth.envelope.release",name:"Release",section:Ly,type:Oy,min:0,max:3,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"formantsynth.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],GranularSynth:[{id:"granular.grainSize",name:"Grain Size",section:Ry,type:Oy,min:.01,max:.5,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"granular.overlap",name:"Overlap",section:Ry,type:Oy,min:.1,max:2,defaultValue:.5,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"granular.playbackRate",name:"Speed",section:Ry,type:Oy,min:.25,max:4,defaultValue:1,formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"granular.detune",name:"Detune",section:Ry,type:Iy,min:-1200,max:1200,defaultValue:0,unit:"ct",page:0,index:3,isAutomatable:!0},{id:"granular.drift",name:"Drift",section:zy,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"granular.reverse",name:"Reverse",section:Ry,type:Dy,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"granular.loop",name:"Loop",section:Ry,type:Dy,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"granular.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Wavetable:[{id:"wavetable.tablePosition",name:"Position",section:Ry,type:Oy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"wavetable.morphSpeed",name:"Morph Speed",section:zy,type:Oy,min:0,max:10,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"wavetable.filter.cutoff",name:"Cutoff",section:jy,type:Oy,min:20,max:2e4,defaultValue:1e4,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wavetable.filter.resonance",name:"Resonance",section:jy,type:Oy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wavetable.envelope.attack",name:"Attack",section:Ly,type:Oy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"wavetable.envelope.decay",name:"Decay",section:Ly,type:Oy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wavetable.envelope.sustain",name:"Sustain",section:Ly,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"wavetable.volume",name:"Volume",section:Gy,type:Oy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Buzz3o3:Zy,BuzzM3:rb,Buzz4FM2F:nb,BuzzDynamite6:rb,BuzzKick:rb,BuzzKickXP:rb,BuzzTrilok:rb,BuzzNoise:tb,BuzzFreqBomb:rb,BuzzDTMF:rb,Buzzmachine:rb,Furnace:nb,FurnaceOPN:nb,FurnaceOPN2203:nb,FurnaceOPNA:nb,FurnaceOPNB:nb,FurnaceOPNBB:nb,FurnaceOPM:nb,FurnaceOPL:nb,FurnaceOPLL:nb,FurnaceOPL4:nb,FurnaceOPZ:nb,FurnaceY8950:nb,FurnaceESFM:nb,FurnaceVRC7:nb,FurnaceNES:sb,FurnaceGB:sb,FurnacePSG:sb,FurnacePCE:sb,FurnaceSNES:sb,FurnaceVB:sb,FurnaceLynx:sb,FurnaceSWAN:sb,FurnaceNDS:sb,FurnaceGBA:sb,FurnacePOKEMINI:sb,FurnaceVRC6:sb,FurnaceN163:sb,FurnaceFDS:sb,FurnaceMMC5:sb,FurnaceC64:sb,FurnaceSID6581:sb,FurnaceSID8580:sb,FurnaceAY:sb,FurnaceAY8930:sb,FurnaceVIC:sb,FurnacePET:sb,FurnaceSAA:sb,FurnaceTED:sb,FurnaceDAVE:sb,FurnaceVERA:sb,FurnaceSCC:sb,FurnaceTIA:sb,FurnacePOKEY:sb,FurnaceZXBEEPER:sb,FurnaceAMIGA:sb,FurnacePCSPKR:sb,FurnaceSEGAPCM:ab,FurnaceQSOUND:ab,FurnaceES5506:ab,FurnaceRF5C68:ab,FurnaceC140:ab,FurnaceK007232:ab,FurnaceK053260:ab,FurnaceGA20:ab,FurnaceOKI:ab,FurnaceYMZ280B:ab,FurnaceX1_010:ab,FurnaceBUBBLE:ab,FurnaceMULTIPCM:ab,FurnaceMSM6258:ab,FurnaceMSM5232:ab,FurnaceNAMCO:sb,FurnaceSM8521:sb,FurnaceT6W28:sb,FurnaceSUPERVISION:sb,FurnaceUPD1771:sb,FurnacePONG:sb,FurnacePV1000:sb,FurnaceSU:sb,FurnacePOWERNOISE:tb,FurnaceSCVTONE:sb,FurnacePCMDAC:ab,MAMEVFX:nb,MAMEDOC:nb,MAMERSA:eb,MAMESWP30:nb,CZ101:nb};function lb(e){return ob[e]||ib}function cb(e){const t=new Map;for(const n of e)t.has(n.page)||t.set(n.page,[]),t.get(n.page).push(n);const a=[];for(const[n,s]of t.entries()){s.sort((e,t)=>e.index-t.index);const e=s.map(e=>e.section),t=new Map;for(const a of e)t.set(a,(t.get(a)||0)+1);let r=e[0],i=0;for(const[a,n]of t.entries())n>i&&(r=a,i=n);a.push({id:`page_${n}`,name:`${r} ${n+1}`,parameters:s})}return a.sort((e,t)=>parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])),a}function ub(e,t){switch(e.type){case Dy:return t>=.5?"On":"Off";case Fy:if(e.valueStrings){const a=Math.round(t*(e.valueStrings.length-1));return e.valueStrings[Math.min(a,e.valueStrings.length-1)]||""}return String(Math.round(t));case Iy:return String(Math.round(t*(e.max-e.min)+e.min));default:{const a=t*(e.max-e.min)+e.min,n=e.formatString?e.formatString.replace("%.0f",String(Math.round(a))).replace("%.1f",a.toFixed(1)).replace("%.2f",a.toFixed(2)).replace("%.3f",a.toFixed(3)):a.toFixed(2);return e.unit?`${n}${e.unit}`:n}}}async function db(e){const t=new DataView(e);let a=0;if(t.getUint32(a,!1)!==Wy)throw new Error("Invalid NKSF file: missing magic header");a+=4;const n=t.getUint16(a,!1),s=t.getUint16(a+2,!1);a+=4;const r={vendor:Yy,uuid:Qy,version:`${n}.${s}`},i={};let o;for(;a<e.byteLength;){const n=t.getUint32(a,!1),s=t.getUint32(a+4,!0);a+=8;const c=a,u=a+s;switch(n){case Hy:{const t=mb(new Uint8Array(e,c,s));try{const e=JSON.parse(t);Object.assign(r,e)}catch(l){}break}case Ky:{const t=new DataView(e,c,s);let a=0;const n=t.getUint32(a,!0);a+=4;for(let s=0;s<n;s++){const n=t.getUint8(a);a+=1;const s=new Uint8Array(e,c+a,n),r=(new TextDecoder).decode(s);a+=n;const o=t.getFloat32(a,!0);a+=4,i[r]=o}break}case $y:o=e.slice(c,u)}a=u}return{metadata:r,parameters:i,blob:o}}function pb(e){const t=[],a=JSON.stringify(e.metadata),n=(new TextEncoder).encode(a);t.push(hb(Hy,n.buffer));const s=Object.entries(e.parameters),r=4+s.reduce((e,[t])=>e+1+t.length+4,0),i=new ArrayBuffer(r),o=new DataView(i);let l=0;o.setUint32(l,s.length,!0),l+=4;for(const[h,m]of s){const e=(new TextEncoder).encode(h);o.setUint8(l,e.length),l+=1,new Uint8Array(i,l,e.length).set(e),l+=e.length,o.setFloat32(l,m,!0),l+=4}t.push(hb(Ky,i)),e.blob&&t.push(hb($y,e.blob));const c=8+t.reduce((e,t)=>e+t.byteLength,0),u=new ArrayBuffer(c),d=new DataView(u);let p=0;d.setUint32(p,Wy,!1),p+=4,d.setUint16(p,qy,!1),d.setUint16(p+2,Xy,!1),p+=4;for(const h of t)new Uint8Array(u,p,h.byteLength).set(new Uint8Array(h)),p+=h.byteLength;return u}function hb(e,t){const a=new ArrayBuffer(8+t.byteLength),n=new DataView(a);return n.setUint32(0,e,!1),n.setUint32(4,t.byteLength,!0),new Uint8Array(a,8,t.byteLength).set(new Uint8Array(t)),a}function mb(e){let t=e.indexOf(0);return-1===t&&(t=e.length),(new TextDecoder).decode(e.subarray(0,t))}const fb={Bass:["Bass","Synth Bass"],Lead:["Lead","Synth Lead"],Pad:["Pad","Ambient"],Drum:["Drums","Electronic"],FX:["FX","Sound Design"],User:["User","Custom"]};function gb(e){const t=e[0]?.toLowerCase()||"";return t.includes("bass")?"Bass":t.includes("lead")?"Lead":t.includes("pad")||t.includes("ambient")?"Pad":t.includes("drum")||t.includes("perc")?"Drum":t.includes("fx")||t.includes("effect")?"FX":"User"}function yb(e,t){const a=[];return e&&a.push(...e.map(e=>e.toLowerCase())),t&&a.push(...t.map(e=>e.toLowerCase())),[...new Set(a)]}function bb(e,t){const a=e.synthType,n=function(e,t){const a={},n=e.synthType.toLowerCase();for(const s of t){const t=s.id.replace(`${n}.`,"").split(".");let r=e;const i=e[n];i&&"object"==typeof i&&(r=i);for(const a of t){if(!r||"object"!=typeof r||!(a in r)){if("cutoff"===a&&void 0!==e.filter?.frequency){r=e.filter.frequency;break}if("resonance"===a&&void 0!==e.filter?.Q){r=e.filter.Q;break}if("attack"===a&&void 0!==e.envelope?.attack){r=e.envelope.attack;break}if("decay"===a&&void 0!==e.envelope?.decay){r=e.envelope.decay;break}if("sustain"===a&&void 0!==e.envelope?.sustain){r=e.envelope.sustain;break}if("release"===a&&void 0!==e.envelope?.release){r=e.envelope.release;break}r=void 0;break}r=r[a]}if("number"==typeof r){const e=(r-s.min)/(s.max-s.min);a[s.id]=Math.max(0,Math.min(1,e))}else if("boolean"==typeof r)a[s.id]=r?1:0;else if("string"==typeof r&&s.valueStrings){const e=s.valueStrings.indexOf(r);a[s.id]=-1!==e?e/Math.max(1,s.valueStrings.length-1):s.defaultValue}else a[s.id]=s.defaultValue}return a}(e,lb(a)),{types:s,modes:r}=function(e){const t=[],a=[],n=["bass","lead","pad","drum","fx","synth","keys","strings","brass","vocal"],s=["mono","poly","analog","digital","fm","wavetable","granular","acoustic","electric"];for(const r of e){const e=r.toLowerCase();n.some(t=>e.includes(t))?t.push(r.charAt(0).toUpperCase()+r.slice(1)):s.some(t=>e.includes(t))&&a.push(r.charAt(0).toUpperCase()+r.slice(1))}return{types:t,modes:a}}(t?.tags||[]),i=t?.category?fb[t.category]:["User",e.synthType];return{metadata:{vendor:Yy,uuid:Qy,version:"1.0",name:t?.name||e.name,author:t?.author||"DEViLBOX User",comment:t?.comment||`${a} preset for DEViLBOX`,deviceType:"INST",bankChain:i,types:s.length>0?s:[a],modes:r.length>0?r:void 0,isUser:!0},parameters:n,blob:(new TextEncoder).encode(JSON.stringify(e)).buffer}}function vb(e,t,a){if(e.blob)try{const a=(new TextDecoder).decode(new Uint8Array(e.blob)),n=JSON.parse(a);if(n.synthType)return{...n,id:t,name:e.metadata.name||n.name||"NKS Preset"}}catch{}const n=a||function(e){const t=e.bankChain.join(" ").toLowerCase(),a=(e.types||[]).join(" ").toLowerCase(),n=(e.comment||"").toLowerCase(),s=`${t} ${a} ${n}`;return s.includes("tb303")||s.includes("303")?"TB303":s.includes("tb808")||s.includes("808")?"DrumMachine":s.includes("dub siren")||s.includes("dubsiren")?"DubSiren":s.includes("space laser")||s.includes("spacelaser")?"SpaceLaser":s.includes("fm")||s.includes("dexed")?"FMSynth":s.includes("wavetable")?"Wavetable":s.includes("granular")?"GranularSynth":s.includes("mono")?"MonoSynth":s.includes("poly")?"PolySynth":s.includes("membrane")||s.includes("kick")?"MembraneSynth":s.includes("metal")||s.includes("hihat")||s.includes("cymbal")?"MetalSynth":s.includes("pluck")?"PluckSynth":s.includes("noise")?"NoiseSynth":s.includes("am ")?"AMSynth":s.includes("duo")?"DuoSynth":null}(e.metadata)||"Synth",s=lb(n),r={id:t,name:e.metadata.name||"NKS Preset",type:"synth",synthType:n,effects:[],volume:-6,pan:0};return function(e,t,a){const n=e.synthType.toLowerCase(),s={};for(const r of a){const a=t[r.id];if(void 0===a)continue;const i=a*(r.max-r.min)+r.min,o=r.id.replace(`${n}.`,""),l=o.split(".");let c=s;for(let e=0;e<l.length-1;e++)l[e]in c||(c[l[e]]={}),c=c[l[e]];const u=l[l.length-1];if(r.valueStrings&&r.valueStrings.length>0){const e=Math.round(a*(r.valueStrings.length-1));c[u]=r.valueStrings[Math.min(e,r.valueStrings.length-1)]}else 2===r.type?c[u]=a>=.5:c[u]=i;"cutoff"!==u&&"frequency"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.frequency=i),"resonance"!==u&&"Q"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.Q=i),"attack"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.attack=i),"decay"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.decay=i),"sustain"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.sustain=i),"release"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.release=i)}Object.keys(s).length>0&&(e[n]=s)}(r,e.parameters,s),r}function xb(e){return bb({id:0,...e.config},{name:e.name,category:e.category,tags:e.tags})}function wb(e,t){const a=vb(e,0,t),{id:n,...s}=a;return{name:e.metadata.name||"NKS Preset",category:gb(e.metadata.bankChain),synthType:a.synthType,tags:yb(e.metadata.types,e.metadata.modes),config:s}}function kb(e,t){const a=pb(bb(e,t)),n=new Blob([a],{type:"application/octet-stream"}),s=URL.createObjectURL(n),r=`${t?.name||e.name||"preset"}.nksf`,i=document.createElement("a");i.href=s,i.download=r,i.click(),URL.revokeObjectURL(s)}const Sb=n()(Gm(Fa((e,t)=>({userPresets:[],recentPresetIds:[],savePreset:(t,a,n,s=[])=>{const r=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return e(e=>{const i={id:r,name:a,category:n,synthType:t.synthType,tags:s,createdAt:Date.now(),updatedAt:Date.now(),config:{name:t.name,type:t.type,synthType:t.synthType,oscillator:t.oscillator,envelope:t.envelope,filter:t.filter,filterEnvelope:t.filterEnvelope,tb303:t.tb303,wavetable:t.wavetable,effects:t.effects?[...t.effects]:[],volume:t.volume,pan:t.pan,parameters:t.parameters}};e.userPresets.push(i)}),r},deletePreset:t=>e(e=>{const a=e.userPresets.findIndex(e=>e.id===t);-1!==a&&e.userPresets.splice(a,1);const n=e.recentPresetIds.indexOf(t);-1!==n&&e.recentPresetIds.splice(n,1)}),updatePreset:(t,a)=>e(e=>{const n=e.userPresets.find(e=>e.id===t);n&&(Object.assign(n,a),n.updatedAt=Date.now())}),getPreset:e=>t().userPresets.find(t=>t.id===e),getPresetsByCategory:e=>t().userPresets.filter(t=>t.category===e),getPresetsBySynthType:e=>t().userPresets.filter(t=>t.synthType===e),addToRecent:t=>e(e=>{const a=e.recentPresetIds.indexOf(t);-1!==a&&e.recentPresetIds.splice(a,1),e.recentPresetIds.unshift(t),e.recentPresetIds.length>10&&e.recentPresetIds.pop()}),clearRecent:()=>e(e=>{e.recentPresetIds=[]}),importPresets:t=>e(e=>{t.forEach(t=>{const a=e.userPresets.findIndex(e=>e.id===t.id);-1!==a?e.userPresets[a]=t:e.userPresets.push(t)})}),exportPresets:()=>t().userPresets,exportPresetAsNKSF:e=>{const a=t().getPreset(e);if(a)try{const e=pb(xb(a)),t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`${a.name}.nksf`,s.click(),URL.revokeObjectURL(n)}catch(n){}},exportAllPresetsAsNKSF:e=>{const a=t().userPresets;if(0!==a.length)try{const t=function(e,t){return e.map(e=>{const a=xb(e);return t&&(a.metadata.author=t),{filename:`${e.name}.nksf`,buffer:pb(a)}})}(a,e);t.forEach((e,t)=>{setTimeout(()=>{const t=new Blob([e.buffer],{type:"application/octet-stream"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e.filename,n.click(),URL.revokeObjectURL(a)},100*t)})}catch(n){}},importNKSFFiles:async t=>{const a=[];try{const n=await async function(e){const t=[];for(const n of e)try{const e=await n.arrayBuffer(),a=await db(e);t.push(wb(a))}catch(a){}return t}(t);for(const t of n){const n=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e(e=>{const a={id:n,...t,createdAt:Date.now(),updatedAt:Date.now()};e.userPresets.push(a)}),a.push(n)}}catch(n){}return a}})),{name:"devilbox-user-presets",version:1})),Mb="391",Nb="74ef796",Cb=`1.0.1.${Mb}`,Eb=[{version:"1.0.1",date:"2026-02-11",changes:[{type:"fix",description:"Enable file browser on GitHub Pages via static manifest fallback"},{type:"fix",description:"Remove unused patterns variable from TD-3 import"},{type:"improvement",description:"Chore: update generated changelog"},{type:"fix",description:"Fix knob drag interference on TB-303 panel"},{type:"feature",description:"Add classic acid effect chain presets and fix preset loader"},{type:"fix",description:"Fix TD-3 pattern import and parameter editor null guard"},{type:"fix",description:"Improve master routing and synth engine stability"},{type:"feature",description:"Expand Odin2 WASM engine with full parameter coverage"},{type:"feature",description:"Add Helm, Sorcer, amsynth, and OB-Xf WASM synth engines"},{type:"fix",description:"Resolve Tone.js compatibility issues from DevilboxSynth refactor"},{type:"fix",description:"Load Behringer .sqs/.seq files via file browser"},{type:"fix",description:"Clean up synth controls - fix Odin2 ranges, add OTHER tab, show all params"},{type:"fix",description:"Bridge native DevilboxSynths into Tone.js effect chains"},{type:"fix",description:"Clean up SurgeControls component"},{type:"fix",description:"Clean up VitalControls component"},{type:"fix",description:"Register Vital, Odin2, and Surge panel components in synth registry"},{type:"feature",description:"Test: add swing timing test scripts and XML test patterns"},{type:"feature",description:"Add Tonewheel Organ, Vital, Odin2, Surge, and Melodica controls"},{type:"feature",description:"Add effect engine modules, BPM sync, and compiled WASM binaries"},{type:"feature",description:"Chore: add documentation, changelog, test pages, and gitignore updates"},{type:"feature",description:"Add Moog filters, MVerb, Leslie, Spring reverb, and synth templates"},{type:"feature",description:"Expand knob banks and controller mappings for all synth types"},{type:"feature",description:"Add auto-preview oscilloscope hook and expand synth parameter editors"},{type:"feature",description:"Add BPM sync controls, genre presets, and enhanced visual editors"},{type:"improvement",description:"Decouple synth engines from Tone.js and expand audio architecture"},{type:"feature",description:"Update editors, presets, tracker, and DB303 controls"},{type:"feature",description:"Improve import/export engine and song parser"},{type:"feature",description:"Add WAM host, VST bridge, and JUCE WASM build template"},{type:"improvement",description:"Introduce DevilboxSynth interface and decouple synths from Tone.js"}]},{version:"2026-02-10",date:"2026-02-10",changes:[{type:"fix",description:"Chore(infra): update electron, packages, and local debug tools"},{type:"improvement",description:"Enhance audio engine and fix multiple stability issues"},{type:"feature",description:"Add new channel visualizers and standardize styling"},{type:"feature",description:"Implement 1:1 logic port of FT2 Nibbles"},{type:"feature",description:"Improve TD-3 pattern import/export and audit .seq format"}]},{version:"2026-02-09",date:"2026-02-09",changes:[{type:"fix",description:"Use absolute paths for worklet/wasm loading on GitHub Pages"},{type:"fix",description:"Test page uses direct worklet loading + correct case-sensitive filenames"},{type:"fix",description:"Test page now uses direct worklet loading instead of TypeScript imports"},{type:"fix",description:"Tracker knobs now update live synth + improve test page tracking params"},{type:"feature",description:"Comprehensive parameter testing with smoothing, retrigger, and auto-setup"},{type:"feature",description:"Complete DB303 synth overhaul with full parameter test suite"},{type:"improvement",description:"Update changelog and minor UI refinements"},{type:"improvement",description:"303 UI improvements: full-width responsive layout with collapsible sections"},{type:"fix",description:"Rebrand file formats: .dbx for songs, .dbi for instruments + fix speech synth singing modes"},{type:"improvement",description:"Optimize engine and shared control components"},{type:"improvement",description:"Optimize effect and specialty synth controls"},{type:"improvement",description:"Add refs to high-complexity synth controls"},{type:"improvement",description:"Prevent knob handler re-creation with refs"},{type:"fix",description:"Eliminate stale state bug preventing first drag response"},{type:"fix",description:"Chore: Add demo channel fix script and update build"}]}],Pb=Cb,_b=Cb,Tb=({label:e,devices:t,selectedId:a,onSelect:n,disabled:s=!1})=>{const r=t.find(e=>e.id===a);return xa.jsxs("div",{className:"space-y-1",children:[xa.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:e}),xa.jsxs("div",{className:"relative",children:[xa.jsxs("select",{value:a||"",onChange:e=>n(e.target.value||null),disabled:s,className:`\n            w-full px-3 py-2 pr-8 rounded-md text-sm\n            bg-dark-bgTertiary border border-dark-border\n            text-text-primary appearance-none cursor-pointer\n            hover:border-dark-borderLight focus:border-accent-primary focus:outline-none\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${r?.isTD3?"border-accent-success/50":""}\n          `,children:[xa.jsx("option",{value:"",children:"No device"}),t.map(e=>xa.jsxs("option",{value:e.id,children:[e.isTD3?" ":"",e.name,e.manufacturer?` (${e.manufacturer})`:""]},e.id))]}),xa.jsx(Me,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"})]}),r?.isTD3&&xa.jsxs("div",{className:"flex items-center gap-1 text-xs text-accent-success",children:[xa.jsx(Ne,{size:12}),xa.jsx("span",{children:"TD-3 detected"})]})]})};function Ab(){const[e,t]=s.useState([]),[a,n]=s.useState(!1),[r,i]=s.useState(!1),[o,l]=s.useState(null),c=s.useRef(null),u=s.useRef(null),d=s.useRef(new Set);s.useEffect(()=>{n("requestMIDIAccess"in navigator)},[]);const p=s.useCallback(e=>{const t=function(e){if(e.length<1)return{type:"unknown",channel:0,raw:e};const[t,a=0,n=0]=e,s=15&t;switch(t>>4&15){case 9:return{type:n>0?"noteon":"noteoff",channel:s,note:a,velocity:n,raw:e};case 8:return{type:"noteoff",channel:s,note:a,velocity:n,raw:e};case 11:return{type:"cc",channel:s,controller:a,value:n,raw:e};case 14:return{type:"pitchbend",channel:s,value:n<<7|a,raw:e};case 13:return{type:"aftertouch",channel:s,value:a,raw:e};default:return{type:"unknown",channel:s,raw:e}}}(e.data);l(t),d.current.forEach(e=>{e(t)})},[]),h=s.useCallback(e=>{const a=[];e.inputs.forEach(e=>{a.push({id:e.id,name:e.name||"Unknown Device",manufacturer:e.manufacturer||"Unknown",state:e.state})}),t(a)},[]),m=s.useCallback(async()=>{if(!a)throw new Error("Web MIDI API not supported in this browser");if(!r)try{const e=await navigator.requestMIDIAccess();c.current=e,e.inputs.forEach(e=>{e.addEventListener("midimessage",p)});const t=()=>{h(e),e.inputs.forEach(e=>{e.removeEventListener("midimessage",p),e.addEventListener("midimessage",p)})};u.current=t,e.addEventListener("statechange",t),h(e),i(!0)}catch(e){throw e}},[a,r,p,h]),f=s.useCallback(()=>{c.current&&(c.current.inputs.forEach(e=>{e.removeEventListener("midimessage",p)}),u.current&&(c.current.removeEventListener("statechange",u.current),u.current=null),c.current=null),i(!1),t([]),l(null)},[p]),g=s.useCallback(e=>(d.current.add(e),()=>{d.current.delete(e)}),[]);return s.useEffect(()=>()=>{f()},[f]),{devices:e,isSupported:a,isEnabled:r,lastMessage:o,enableMIDI:m,disableMIDI:f,onMessage:g}}const Ob={1:{mode:92,cc:93,min:94,max:95,name:96},2:{mode:112,cc:113,min:114,max:115,name:116},3:{mode:132,cc:133,min:134,max:135,name:136},4:{mode:152,cc:153,min:154,max:155,name:156},5:{mode:172,cc:173,min:174,max:175,name:176},6:{mode:192,cc:193,min:194,max:195,name:196},7:{mode:212,cc:213,min:214,max:215,name:216},8:{mode:232,cc:233,min:234,max:235,name:236}};class Ib{static instance=null;currentPreset=null;deviceName=null;constructor(){}static getInstance(){return Ib.instance||(Ib.instance=new Ib),Ib.instance}checkConnection(){const e=ny().getInputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return this.deviceName=t.name||"MPK Mini",!0}return this.deviceName=null,!1}getDeviceName(){return this.deviceName}createDefaultPreset(){const e=new Uint8Array(246);e[0]=0;const t=this.stringToBytes("DEViLBOX       ",16);e.set(t,1),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let a=1;a<=8;a++){const t=Ob[a];e[t.mode-7]=0,e[t.cc-7]=70+a-1,e[t.min-7]=0,e[t.max-7]=127;const n=`Knob ${a}        `,s=this.stringToBytes(n,16);e.set(s,t.name-7)}return e}stringToBytes(e,t){const a=new Uint8Array(t);for(let n=0;n<t;n++)n<e.length?a[n]=Math.min(127,e.charCodeAt(n)):a[n]=32;return a}buildSysExMessage(e){const t=e.length,a=t>>7&127,n=127&t,s=new Uint8Array(7+e.length+1);return s[0]=240,s[1]=71,s[2]=127,s[3]=73,s[4]=100,s[5]=a,s[6]=n,s.set(e,7),s[s.length-1]=247,s}findMPKMiniOutputId(){const e=ny().getOutputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return t.id}return null}async sendSysEx(e){const t=ny(),a=this.findMPKMiniOutputId();if(!a)return!1;const n=t.getSelectedOutput(),s=n?.id||null;try{return t.selectOutput(a),t.sendSysEx(e),s&&s!==a&&t.selectOutput(s),!0}catch(r){if(s)try{t.selectOutput(s)}catch{}return!1}}async setKnobName(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const a=Ob[e],n=this.stringToBytes(t,16);this.currentPreset.set(n,a.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async setKnobNames(e){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());for(const[a,n]of Object.entries(e)){const e=parseInt(a);if(e>=1&&e<=8){const t=Ob[e],a=this.stringToBytes(n,16);this.currentPreset.set(a,t.name-7)}}const t=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(t)}async setKnobConfig(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const a=Ob[e];void 0!==t.mode&&(this.currentPreset[a.mode-7]="relative"===t.mode?1:0),void 0!==t.cc&&(this.currentPreset[a.cc-7]=127&t.cc),void 0!==t.min&&(this.currentPreset[a.min-7]=127&t.min),void 0!==t.max&&(this.currentPreset[a.max-7]=127&t.max);const n=this.stringToBytes(t.name,16);this.currentPreset.set(n,a.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async applyDEViLBOXPreset(){return this.setKnobNames({1:"Cutoff",2:"Resonance",3:"Env Mod",4:"Decay",5:"Accent",6:"Overdrive",7:"Slide Time",8:"Filter FM"})}async resetKnobNames(){this.currentPreset=this.createDefaultPreset();const e=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(e)}}function Db(){return Ib.getInstance()}const Fb={"transport.play":{label:"Play",category:"Transport"},"transport.stop":{label:"Stop",category:"Transport"},"transport.pause":{label:"Pause",category:"Transport"},"transport.record":{label:"Record",category:"Transport"},"transport.loop":{label:"Toggle Loop",category:"Transport"},"nav.patternUp":{label:"Pattern Up",category:"Navigation"},"nav.patternDown":{label:"Pattern Down",category:"Navigation"},"nav.positionUp":{label:"Song Position Up",category:"Navigation"},"nav.positionDown":{label:"Song Position Down",category:"Navigation"},"nav.rowUp":{label:"Row Up",category:"Navigation"},"nav.rowDown":{label:"Row Down",category:"Navigation"},"nav.toStart":{label:"Go to Start",category:"Navigation"},"nav.toEnd":{label:"Go to End",category:"Navigation"},"edit.octaveUp":{label:"Octave Up",category:"Editing"},"edit.octaveDown":{label:"Octave Down",category:"Editing"},"edit.instrumentUp":{label:"Instrument Up",category:"Editing"},"edit.instrumentDown":{label:"Instrument Down",category:"Editing"},"edit.undo":{label:"Undo",category:"Editing"},"edit.redo":{label:"Redo",category:"Editing"},"edit.copy":{label:"Copy",category:"Editing"},"edit.paste":{label:"Paste",category:"Editing"},"edit.delete":{label:"Delete",category:"Editing"},"edit.insertRow":{label:"Insert Row",category:"Editing"},"edit.deleteRow":{label:"Delete Row",category:"Editing"},"channel.mute1":{label:"Mute Ch 1",category:"Channels"},"channel.mute2":{label:"Mute Ch 2",category:"Channels"},"channel.mute3":{label:"Mute Ch 3",category:"Channels"},"channel.mute4":{label:"Mute Ch 4",category:"Channels"},"channel.mute5":{label:"Mute Ch 5",category:"Channels"},"channel.mute6":{label:"Mute Ch 6",category:"Channels"},"channel.mute7":{label:"Mute Ch 7",category:"Channels"},"channel.mute8":{label:"Mute Ch 8",category:"Channels"},"channel.solo1":{label:"Solo Ch 1",category:"Channels"},"channel.solo2":{label:"Solo Ch 2",category:"Channels"},"channel.solo3":{label:"Solo Ch 3",category:"Channels"},"channel.solo4":{label:"Solo Ch 4",category:"Channels"},"pattern.new":{label:"New Pattern",category:"Pattern"},"pattern.clone":{label:"Clone Pattern",category:"Pattern"},"pattern.delete":{label:"Delete Pattern",category:"Pattern"},"view.toggleEditor":{label:"Toggle Editor",category:"View"},"view.toggleMixer":{label:"Toggle Mixer",category:"View"}},Rb={"tb303.cutoff":{label:"Cutoff",min:200,max:5e3,category:"303 Main"},"tb303.resonance":{label:"Resonance",min:0,max:100,category:"303 Main"},"tb303.envMod":{label:"Env Mod",min:0,max:100,category:"303 Main"},"tb303.decay":{label:"Decay",min:200,max:2e3,category:"303 Main"},"tb303.accent":{label:"Accent",min:0,max:100,category:"303 Main"},"tb303.slideTime":{label:"Slide Time",min:2,max:360,category:"303 Main"},"tb303.overdrive":{label:"Overdrive",min:0,max:100,category:"303 Main"},"tb303.normalDecay":{label:"Normal Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.accentDecay":{label:"Accent Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.softAttack":{label:"Soft Attack",min:.3,max:30,category:"Devil Fish"},"tb303.vegSustain":{label:"VEG Sustain",min:0,max:100,category:"Devil Fish"},"tb303.filterFM":{label:"Filter FM",min:0,max:100,category:"Devil Fish"},"tb303.filterTracking":{label:"Key Track",min:0,max:200,category:"Devil Fish"}},jb=[{id:"akai-mpk-mini-mk3",name:"MPK Mini MK3",manufacturer:"Akai",detectPatterns:["mpk mini","mpk mini mk3","mpkmini"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime"}}},{id:"akai-mpk-mini-plus",name:"MPK Mini Plus",manufacturer:"Akai",detectPatterns:["mpk mini plus","mpkminiplus"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1}}},{id:"novation-launchkey-mini-mk3",name:"Launchkey Mini MK3",manufacturer:"Novation",detectPatterns:["launchkey mini","launchkey"],knobs:[{cc:21,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:22,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:23,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:24,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:25,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:26,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:27,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:28,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"},{note:44,name:"Pad 9"},{note:45,name:"Pad 10"},{note:46,name:"Pad 11"},{note:47,name:"Pad 12"},{note:48,name:"Pad 13"},{note:49,name:"Pad 14"},{note:50,name:"Pad 15"},{note:51,name:"Pad 16"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}},{id:"arturia-minilab-3",name:"MiniLab 3",manufacturer:"Arturia",detectPatterns:["minilab","arturia minilab"],knobs:[{cc:74,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:71,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:76,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:77,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:93,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:73,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:75,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:114,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:85,name:"Fader 1"},{cc:86,name:"Fader 2"},{cc:87,name:"Fader 3"},{cc:88,name:"Fader 4"}]}},{id:"korg-nanokontrol2",name:"nanoKONTROL2",manufacturer:"Korg",detectPatterns:["nanokontrol","nano kontrol","korg nano"],knobs:[{cc:16,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:17,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:18,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:19,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:20,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:21,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:22,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:23,name:"Knob 8"}],pads:[{cc:32,name:"S1",defaultMapping:"channel.solo1"},{cc:33,name:"S2",defaultMapping:"channel.solo2"},{cc:34,name:"S3",defaultMapping:"channel.solo3"},{cc:35,name:"S4",defaultMapping:"channel.solo4"},{cc:48,name:"M1",defaultMapping:"channel.mute1"},{cc:49,name:"M2",defaultMapping:"channel.mute2"},{cc:50,name:"M3",defaultMapping:"channel.mute3"},{cc:51,name:"M4",defaultMapping:"channel.mute4"},{cc:64,name:"R1"},{cc:65,name:"R2"},{cc:66,name:"R3"},{cc:67,name:"R4"},{cc:41,name:"Play",defaultMapping:"transport.play"},{cc:42,name:"Stop",defaultMapping:"transport.stop"},{cc:43,name:"Rewind",defaultMapping:"nav.toStart"},{cc:44,name:"Forward",defaultMapping:"nav.toEnd"},{cc:45,name:"Record",defaultMapping:"transport.record"},{cc:46,name:"Cycle",defaultMapping:"transport.loop"}],extras:{faders:[{cc:0,name:"Fader 1"},{cc:1,name:"Fader 2"},{cc:2,name:"Fader 3"},{cc:3,name:"Fader 4"},{cc:4,name:"Fader 5"},{cc:5,name:"Fader 6"},{cc:6,name:"Fader 7"},{cc:7,name:"Fader 8"}]}},{id:"behringer-xtouch-mini",name:"X-Touch Mini",manufacturer:"Behringer",detectPatterns:["x-touch","xtouch","behringer x-touch"],knobs:[{cc:1,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:2,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:3,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:4,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:5,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:6,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:7,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:8,name:"Encoder 8"}],pads:[{note:0,name:"Button 1",defaultMapping:"transport.play"},{note:1,name:"Button 2",defaultMapping:"transport.stop"},{note:2,name:"Button 3",defaultMapping:"transport.record"},{note:3,name:"Button 4",defaultMapping:"transport.loop"},{note:4,name:"Button 5"},{note:5,name:"Button 6"},{note:6,name:"Button 7"},{note:7,name:"Button 8"},{note:8,name:"Button 9"},{note:9,name:"Button 10"},{note:10,name:"Button 11"},{note:11,name:"Button 12"},{note:12,name:"Button 13"},{note:13,name:"Button 14"},{note:14,name:"Button 15"},{note:15,name:"Button 16"}],extras:{faders:[{cc:9,name:"Fader"}]}},{id:"generic",name:"Generic MIDI Controller",manufacturer:"Unknown",detectPatterns:[],knobs:[{cc:1,name:"CC 1"},{cc:7,name:"CC 7 (Volume)"},{cc:10,name:"CC 10 (Pan)"},{cc:11,name:"CC 11 (Expression)"},{cc:74,name:"CC 74 (Cutoff)"},{cc:71,name:"CC 71 (Resonance)"}],pads:[],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}}];function Lb(e){const t=e.toLowerCase();for(const a of jb)for(const e of a.detectPatterns)if(t.includes(e.toLowerCase()))return a;return null}const Bb=({isOpen:e,onClose:t})=>{const{devices:a,isSupported:n,isEnabled:r,lastMessage:i,enableMIDI:o}=Ab(),l=ry(),c=Pg(e=>e.instruments);s.useEffect(()=>{e&&r&&l.init()},[e,r,l]);const[u,d]=s.useState("devices"),[p,h]=s.useState(null),[m,f]=s.useState(null),[g,y]=s.useState(!1),[b,v]=s.useState(null),[x,w]=s.useState([]),[k,S]=s.useState(new Set(["Transport","303 Main"])),[M,N]=s.useState(l.getGlobalSensitivity()),[C,E]=s.useState(!1),[P,_]=s.useState("idle"),[T,A]=s.useState(l.getControlledInstrument());s.useEffect(()=>l.onControlledInstrumentChange(e=>{A(e)}),[l]);const O=s.useCallback(e=>{l.setControlledInstrument(e),A(e)},[l]);s.useEffect(()=>{if(r&&a.length>0){const e=Db();E(e.checkConnection())}},[r,a]);const I=s.useCallback(async()=>{const e=Db();if(!e.checkConnection())return void _("error");_("syncing");const t={},a={70:1,71:2,72:3,73:4,74:5,75:6,76:7,77:8};x.forEach(e=>{const n=a[e.ccNumber];n&&e.displayName&&(t[n]=e.displayName.substring(0,16))});try{const a=await e.setKnobNames(t);_(a?"success":"error"),a&&setTimeout(()=>_("idle"),2e3)}catch{_("error")}},[x]),D=s.useCallback(async()=>{const e=Db();_("syncing");try{const t=await e.applyDEViLBOXPreset();_(t?"success":"error"),t&&setTimeout(()=>_("idle"),2e3)}catch{_("error")}},[]),F=s.useCallback(()=>{w(l.getAllMappings())},[l]);s.useEffect(()=>{if(a.length>0){const e=Lb(a[0].name||"");h(e),e&&!m&&f(e)}},[a,m]),s.useEffect(()=>(F(),l.onMappingChange(F)),[l,F]),s.useEffect(()=>{if(!g||!b)return;return l.onLearnChange((e,t)=>{e||(y(!1),v(null),F())})},[g,b,l,F]);const R=async e=>{y(!0),v(e);const t=await l.startLearn(0,e.id,e.label,"parameter"===e.type?e.min:0,"parameter"===e.type?e.max:127,"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear");t&&l.setMapping({id:`${t.channel}-${t.ccNumber}-${e.id}`,ccNumber:t.ccNumber,midiChannel:t.channel,instrumentId:0,parameterPath:e.id,min:"parameter"===e.type?e.min:0,max:"parameter"===e.type?e.max:127,curve:"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear",displayName:e.label}),y(!1),v(null)},j=()=>{m&&(m.knobs.forEach(e=>{if(e.defaultMapping){const t=Rb[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:t.min,max:t.max,curve:e.defaultMapping.includes("cutoff")?"logarithmic":"linear",displayName:t.label})}}),m.pads.forEach(e=>{if(e.defaultMapping&&void 0!==e.cc){const t=Fb[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:0,max:127,curve:"linear",displayName:t.label})}}),F())},L=()=>{l.clearAllMappings(),F()},B=e=>{S(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},V=e=>x.some(t=>t.parameterPath===e),z=e=>x.find(t=>t.parameterPath===e);if(!e)return null;const U=Object.entries(Rb).reduce((e,[t,a])=>{const n=a.category;return e[n]||(e[n]=[]),e[n].push({id:t,...a}),e},{}),G=Object.entries(Fb).reduce((e,[t,a])=>{const n=a.category;return e[n]||(e[n]=[]),e[n].push({id:t,...a}),e},{});return xa.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:xa.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] max-h-[85vh] flex flex-col",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[xa.jsxs("h2",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[xa.jsx(Ce,{size:20}),"MIDI Controller Setup"]}),xa.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors",children:xa.jsx(Ee,{size:20})})]}),g&&b&&xa.jsxs("div",{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-10 rounded-lg",children:[xa.jsx(Pe,{size:48,className:"text-accent-primary animate-spin mb-4"}),xa.jsx("p",{className:"text-text-primary text-lg mb-2",children:"Move a controller to map to:"}),xa.jsx("p",{className:"text-accent-primary text-xl font-bold mb-4",children:b.label}),i&&"cc"===i.type&&xa.jsxs("p",{className:"text-text-muted text-sm mb-4",children:["Last: CH",i.channel+1," CC",i.controller," = ",i.value]}),xa.jsx("button",{onClick:()=>{l.cancelLearn(),y(!1),v(null)},className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Cancel"})]}),xa.jsx("div",{className:"flex border-b border-dark-border",children:[{id:"devices",label:"Devices",icon:Ce},{id:"parameters",label:"TB-303",icon:_e},{id:"actions",label:"Tracker",icon:Te},{id:"mappings",label:"Mappings",icon:Ae},{id:"settings",label:"Settings",icon:Oe}].map(e=>xa.jsxs("button",{onClick:()=>d(e.id),className:`\n                flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors\n                ${u===e.id?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"}\n              `,children:[xa.jsx(e.icon,{size:16}),e.label]},e.id))}),xa.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["devices"===u&&xa.jsx("div",{className:"space-y-4",children:n?r?0===a.length?xa.jsxs("div",{className:"text-center py-8",children:[xa.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),xa.jsx("p",{className:"text-text-secondary",children:"No MIDI devices detected"}),xa.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Connect a MIDI controller and refresh"})]}):xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Connected Devices"}),xa.jsx("div",{className:"space-y-2",children:a.map(e=>xa.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded p-3",children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("span",{className:"w-3 h-3 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),xa.jsxs("div",{children:[xa.jsx("div",{className:"text-text-primary font-medium",children:e.name}),xa.jsx("div",{className:"text-text-muted text-xs",children:e.manufacturer})]})]}),p&&e.name?.toLowerCase().includes(p.detectPatterns[0])&&xa.jsxs("span",{className:"text-xs bg-accent-primary/20 text-accent-primary px-2 py-1 rounded",children:["Auto-detected: ",p.name]})]},e.id))})]}),xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Controller Profile"}),xa.jsxs("select",{value:m?.id||"",onChange:e=>{const t=jb.find(t=>t.id===e.target.value);f(t||null)},className:"w-full bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 text-text-primary",children:[xa.jsx("option",{value:"",children:"Select a profile..."}),jb.map(e=>xa.jsxs("option",{value:e.id,children:[e.manufacturer," ",e.name]},e.id))]})]}),m&&xa.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[xa.jsxs("div",{className:"flex items-center justify-between mb-3",children:[xa.jsxs("h4",{className:"text-sm font-medium text-text-primary",children:[m.manufacturer," ",m.name]}),xa.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white text-sm rounded transition-colors",children:"Apply Suggested Mappings"})]}),xa.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[xa.jsxs("div",{children:[xa.jsx("span",{className:"text-text-muted",children:"Knobs:"})," ",xa.jsx("span",{className:"text-text-secondary",children:m.knobs.length})]}),xa.jsxs("div",{children:[xa.jsx("span",{className:"text-text-muted",children:"Pads:"})," ",xa.jsx("span",{className:"text-text-secondary",children:m.pads.length})]}),m.extras?.faders&&xa.jsxs("div",{children:[xa.jsx("span",{className:"text-text-muted",children:"Faders:"})," ",xa.jsx("span",{className:"text-text-secondary",children:m.extras.faders.length})]})]})]})]}):xa.jsxs("div",{className:"text-center py-8",children:[xa.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),xa.jsx("p",{className:"text-text-secondary mb-4",children:"Enable MIDI to connect your controller"}),xa.jsx("button",{onClick:o,className:"px-6 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded font-medium transition-colors",children:"Enable MIDI"})]}):xa.jsxs("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-4",children:[xa.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[xa.jsx(Ie,{size:20}),xa.jsx("span",{children:"Web MIDI API not supported"})]}),xa.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})}),"parameters"===u&&xa.jsx("div",{className:"space-y-3",children:Object.entries(U).map(([e,t])=>xa.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[xa.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[xa.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?xa.jsx(Me,{size:16,className:"text-text-muted"}):xa.jsx(De,{size:16,className:"text-text-muted"})]}),k.has(e)&&xa.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),a=z(e.id),n=g&&b?.id===e.id;return xa.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${n?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[t&&xa.jsx(Fe,{size:14,className:"text-accent-success"}),xa.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[a&&xa.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",a.ccNumber]}),xa.jsx("button",{onClick:()=>R({type:"parameter",id:e.id,label:e.label,min:e.min,max:e.max,category:e.category}),disabled:g,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${n?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:n?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"actions"===u&&xa.jsx("div",{className:"space-y-3",children:Object.entries(G).map(([e,t])=>xa.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[xa.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[xa.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?xa.jsx(Me,{size:16,className:"text-text-muted"}):xa.jsx(De,{size:16,className:"text-text-muted"})]}),k.has(e)&&xa.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),a=z(e.id),n=g&&b?.id===e.id;return xa.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${n?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[t&&xa.jsx(Fe,{size:14,className:"text-accent-success"}),xa.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[a&&xa.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",a.ccNumber]}),xa.jsx("button",{onClick:()=>R({type:"action",id:e.id,label:e.label,category:e.category}),disabled:g,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${n?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:n?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"mappings"===u&&xa.jsx("div",{className:"space-y-4",children:0===x.length?xa.jsxs("div",{className:"text-center py-8",children:[xa.jsx(Ae,{size:48,className:"mx-auto text-text-muted mb-4"}),xa.jsx("p",{className:"text-text-secondary",children:"No mappings configured"}),xa.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Go to TB-303 or Tracker tabs to create mappings"})]}):xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"flex justify-end",children:xa.jsxs("button",{onClick:L,className:"flex items-center gap-1 text-sm text-accent-error hover:underline",children:[xa.jsx(Re,{size:14}),"Clear All"]})}),xa.jsx("div",{className:"space-y-2",children:x.map(e=>xa.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded px-4 py-3",children:[xa.jsxs("div",{children:[xa.jsx("div",{className:"text-text-primary font-medium",children:e.displayName||e.parameterPath}),xa.jsx("div",{className:"text-text-muted text-xs",children:e.parameterPath})]}),xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsxs("div",{className:"text-right",children:[xa.jsxs("div",{className:"text-text-secondary font-mono text-sm",children:[void 0!==e.midiChannel?`CH${e.midiChannel+1} `:"","CC",e.ccNumber]}),xa.jsxs("div",{className:"text-text-muted text-xs",children:[e.min," - ",e.max," (",e.curve,")"]})]}),xa.jsx("button",{onClick:()=>{return t=e.id,l.removeMapping(t),void F();var t},className:"text-accent-error hover:text-accent-error/80 transition-colors",children:xa.jsx(Re,{size:16})})]})]},e.id))})]})}),"settings"===u&&xa.jsxs("div",{className:"space-y-6",children:[xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Knob Sensitivity"}),xa.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[xa.jsxs("div",{className:"flex items-center justify-between mb-2",children:[xa.jsx("span",{className:"text-text-muted text-sm",children:"Slow (Smooth)"}),xa.jsx("span",{className:"text-text-primary font-mono",children:M.toFixed(2)}),xa.jsx("span",{className:"text-text-muted text-sm",children:"Fast (Direct)"})]}),xa.jsx("input",{type:"range",min:"0.05",max:"1",step:"0.05",value:M,onChange:e=>{return t=parseFloat(e.target.value),N(t),void l.setGlobalSensitivity(t);var t},className:"w-full accent-accent-primary"}),xa.jsx("p",{className:"text-text-muted text-xs mt-2",children:"Lower values make knobs respond more smoothly but slower. Higher values give immediate response."})]})]}),xa.jsxs("div",{children:[xa.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[xa.jsx(_e,{size:16}),"Controlled Instrument"]}),xa.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[xa.jsxs("select",{value:T??"all",onChange:e=>{const t=e.target.value;O("all"===t?null:parseInt(t))},className:"w-full bg-dark-bgTertiary border border-dark-border rounded px-3 py-2 text-text-primary mb-2",children:[xa.jsx("option",{value:"all",children:"All TB-303 Instruments"}),c.map(e=>xa.jsxs("option",{value:e.id,children:[e.id,". ",e.name," (",e.synthType||"Sampler",")"]},e.id))]}),xa.jsx("p",{className:"text-text-muted text-xs",children:'Choose which instrument responds to MIDI CC knobs. "All TB-303" controls every TB-303 synth at once.'})]})]}),xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Quick Setup"}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("button",{onClick:j,disabled:!m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgSecondary disabled:text-text-muted text-white rounded font-medium transition-colors",children:[xa.jsx(Ae,{size:18}),"Apply Suggested Mappings"]}),xa.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:[xa.jsx(Re,{size:18}),"Clear All Mappings"]})]})]}),C&&xa.jsxs("div",{children:[xa.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[xa.jsx(je,{size:16}),"MPK Mini MK3 Display"]}),xa.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4 space-y-3",children:[xa.jsx("p",{className:"text-text-muted text-xs",children:"Sync parameter names to your MPK Mini's OLED display. Names will show when you turn the knobs."}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("button",{onClick:I,disabled:"syncing"===P||0===x.length,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgTertiary disabled:text-text-muted text-white rounded text-sm transition-colors",children:[xa.jsx(je,{size:16}),"syncing"===P?"Syncing...":"Sync Current Mappings"]}),xa.jsxs("button",{onClick:D,disabled:"syncing"===P,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-sm transition-colors",children:[xa.jsx(Ae,{size:16}),"Apply DEViLBOX Preset (TB-303)"]})]}),"success"===P&&xa.jsxs("p",{className:"text-accent-success text-xs flex items-center gap-1",children:[xa.jsx(Fe,{size:12})," Display updated!"]}),"error"===P&&xa.jsxs("p",{className:"text-accent-error text-xs flex items-center gap-1",children:[xa.jsx(Ie,{size:12})," Failed to update display"]})]})]}),xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Supported Controllers"}),xa.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:jb.filter(e=>"generic"!==e.id).map(e=>xa.jsxs("div",{className:"bg-dark-bgSecondary rounded px-3 py-2 text-text-muted",children:[e.manufacturer," ",e.name]},e.id))})]})]})]}),xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-dark-border",children:[xa.jsxs("div",{className:"text-xs text-text-muted",children:[x.length," mapping",1!==x.length?"s":""," active"]}),xa.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Close"})]})]})})},Vb="TB303",zb=lb(Vb),Ub=cb(zb),Gb=n()(Fa((e,t)=>({isConnected:!1,controllerInfo:null,currentSynthType:Vb,currentPreset:null,currentPage:0,pages:Ub,parameters:zb,parameterValues:{},changedParameters:new Set,presets:[],availablePresets:[],currentBank:[],displayInfo:null,lightGuide:[],totalPages:Ub.length,init:async a=>{const n=a||t().currentSynthType,s=lb(n),r=cb(s),i={};for(const e of s)i[e.id]=e.defaultValue;e(e=>{e.currentSynthType=n,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=i,e.changedParameters=new Set,e.currentPage=0}),await async function(){}(),t().updateDisplay()},setSynth:a=>{const{currentSynthType:n}=t();if(a===n)return;const s=lb(a),r=cb(s),i={};for(const e of s)i[e.id]=e.defaultValue;e(e=>{e.currentSynthType=a,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=i,e.changedParameters=new Set,e.currentPage=0,e.currentPreset=null}),t().updateDisplay()},disconnect:()=>{e(e=>{e.isConnected=!1,e.controllerInfo=null})},loadPreset:a=>{e(e=>{e.currentPreset=a,e.parameterValues={...a.parameters},e.changedParameters=new Set,e.currentPage=0}),t().updateDisplay()},loadPresetFromFile:async e=>{try{const a=await e.arrayBuffer(),n=await db(a);t().loadPreset(n)}catch(a){throw a}},savePreset:(a,n)=>{const{parameterValues:s,currentPreset:r}=t(),i={metadata:{...r?.metadata,name:a,vendor:"DEViLBOX",uuid:"devilbox-tracker-v1",version:"1.0",deviceType:"INST",bankChain:n?.bankChain||["User","Saved"],author:n?.author,comment:n?.comment,isUser:!0,...n},parameters:{...s},blob:r?.blob};e(e=>{e.currentPreset=i,e.changedParameters=new Set})},exportPreset:()=>{const{currentPreset:e}=t();if(!e)return;const a=pb(e),n=new Blob([a],{type:"application/octet-stream"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=`${e.metadata.name||"preset"}.nksf`,r.click(),URL.revokeObjectURL(s)},addPreset:t=>{e(e=>{e.presets.push(t)})},setParameterValue:(a,n)=>{const{parameters:s}=t(),r=s.find(e=>e.id===a);if(!r)return;const i=Math.max(0,Math.min(1,n));e(e=>{e.parameterValues[a]=i,Math.abs(i-r.defaultValue)>.001?e.changedParameters.add(a):e.changedParameters.delete(a)}),t().updateDisplay()},resetParameter:e=>{const{parameters:a}=t(),n=a.find(t=>t.id===e);n&&t().setParameterValue(e,n.defaultValue)},resetAllParameters:()=>{const{parameters:a}=t();e(e=>{for(const t of a)e.parameterValues[t.id]=t.defaultValue;e.changedParameters.clear()}),t().updateDisplay()},nextPage:()=>{const{currentPage:e,pages:a}=t(),n=(e+1)%a.length;t().setPage(n)},prevPage:()=>{const{currentPage:e,pages:a}=t(),n=0===e?a.length-1:e-1;t().setPage(n)},setPage:a=>{const{pages:n}=t();a<0||a>=n.length||(e(e=>{e.currentPage=a}),t().updateDisplay())},updateDisplay:()=>{const{currentPreset:a,currentPage:n,pages:s,parameterValues:r,currentSynthType:i}=t(),o=s[n];if(!o)return;const l=[`DEViLBOX - ${i}`,a?.metadata.name||"Untitled"];for(const e of o.parameters.slice(0,4)){const t=ub(e,r[e.id]||e.defaultValue);l.push(`${e.name}: ${t}`)}e(e=>{e.displayInfo=l})},setLightGuide:t=>{e(e=>{e.lightGuide=t})},clearLightGuide:()=>{e(e=>{e.lightGuide=[]})},setDisplayInfo:t=>{e(e=>{e.displayInfo=t})},syncParametersFromConfig:a=>{const{parameters:n,currentSynthType:s}=t(),r={};for(const e of n){const t=e.id.replace(`${s.toLowerCase()}.`,"").split(".");let n=a;for(const e of t){if(!n||"object"!=typeof n||!(e in n)){n=void 0;break}n=n[e]}if("number"==typeof n){const t=(n-e.min)/(e.max-e.min);r[e.id]=Math.max(0,Math.min(1,t))}else if("boolean"==typeof n)r[e.id]=n?1:0;else if("string"==typeof n&&e.valueStrings){const t=e.valueStrings.indexOf(n);-1!==t&&(r[e.id]=t/(e.valueStrings.length-1))}}Object.keys(r).length>0&&(e(e=>{for(const[t,a]of Object.entries(r)){e.parameterValues[t]=a;const s=n.find(e=>e.id===t);s&&Math.abs(a-s.defaultValue)>.001&&e.changedParameters.add(t)}}),t().updateDisplay())}})));const Wb=6092,Hb=2536,Kb=7285,$b=8137,qb=1891,Xb=7285,Yb=8137,Qb=1,Zb=3,Jb=16,ev=17,tv=18,av=240,nv=241,sv={PLAY:1,STOP:2,REC:3,LOOP:4,METRO:5,BROWSE:32,PRESET:34,PAGE_LEFT:48,PAGE_RIGHT:49,SHIFT:80,CLEAR:81,OCTAVE_UP:96,OCTAVE_DOWN:97,SCALE:112};class rv{device=null;deviceInfo=null;knobValues=new Array(8).fill(0);buttonStates=new Map;onKnobChange;onButtonPress;onButtonRelease;constructor(){this.handleInputReport=this.handleInputReport.bind(this)}async requestDevice(){if(!("hid"in navigator))return!1;try{const e=await navigator.hid.requestDevice({filters:[{vendorId:Wb},{vendorId:Hb},{vendorId:Kb},{vendorId:$b},{vendorId:qb},{vendorId:Xb},{vendorId:Yb},{vendorId:15}]});return 0!==e.length&&await this.connect(e[0])}catch(e){return!1}}async connect(e){try{e.opened||await e.open(),this.device=e,this.deviceInfo=this.parseDeviceInfo(e),e.addEventListener("inputreport",this.handleInputReport);try{await this.sendPing()}catch(t){}return!0}catch(a){return!1}}async disconnect(){this.device&&(this.device.removeEventListener("inputreport",this.handleInputReport),this.device.opened&&await this.device.close(),this.device=null,this.deviceInfo=null)}getDeviceInfo(){return this.deviceInfo}parseDeviceInfo(e){const t=e.productId,a=e.vendorId,n=e.productName||"Unknown Controller";let s="Native Instruments";a===Hb?s="Akai":a===Kb?s="Arturia":a===$b?s="Nektar":a===qb?s="M-Audio":a===Xb?s="Studiologic":a===Yb?s="iCON":15===a&&(s="Alesis");let r=!1,i=0,o=0,l=!1,c=0,u=8;[4928,4944,4960,5136].includes(t)?(r=!0,i=2,o=72,l=!0,4928===t?c=25:4944===t?c=49:4960===t?c=61:5136===t&&(c=88)):t>=5664&&t<=5968?(r=!0,i=4,o=144,l=!0,5664===t||5920===t?c=49:5680===t||5936===t?c=61:5712!==t&&5968!==t||(c=88)):t>=5648&&t<=5650?(r=!0,i=2,o=72,l=!0,5648===t?c=25:5649===t?c=49:5650===t&&(c=61)):5632===t?(r=!0,i=2,o=72,l=!0,c=32):2056===t?(r=!0,i=2,o=128,l=!1,u=8):5888===t||5904===t?(r=!0,i=2,o=144,l=!1,u=8):4416===t?(r=!0,i=2,o=160,l=!1,u=8):2067===t||5893===t?(r=!1,i=0,o=0,l=!1,u=8):5376===t&&(r=!0,i=2,o=96,l=!1,u=8);a===Hb&&([309,312].includes(t)||n.toLowerCase().includes("mpk mini"))?(r=!0,i=2,o=16,l=!0,c=8,u=8):a===Hb&&[305,306,307].includes(t)&&(r=!0,i=2,o=80,l=!1,u=8);a===Kb&&[1319,1320,1321].includes(t)?(r=!0,i=2,o=64,l=!1,u=9):a===Kb&&[1553,1554,1555].includes(t)&&(r=!0,i=2,o=80,l=!1,u=9);return a===$b&&[8240,8241,8242,8243].includes(t)?(r=!0,i=2,o=40,l=!1,u=8):a===$b&&[8224,8225].includes(t)&&(r=!0,i=4,o=128,l=!0,c=49,u=8),a===qb&&[405,406,407].includes(t)&&(r=!0,i=2,o=64,l=!1,u=16),a===Xb&&[2048,2064].includes(t)&&(r=!0,i=2,o=40,l=!1,u=8),a===Yb&&[12304,12305].includes(t)&&(r=!0,i=2,o=64,l=!1,u=8),15===a&&[311,312,313].includes(t)&&(r=!1,i=0,o=0,l=!1,u=8),{id:`nks_${a.toString(16)}_${t.toString(16)}`,name:n,vendor:s,hasDisplay:r,displayLines:i,displayChars:o,hasLightGuide:l,lightGuideKeys:c,hasKnobs:!0,knobCount:u,hasButtons:!0,hasPads:5888===t||5904===t,hasTransport:!0,hasJogWheel:5888===t||5904===t,hasBrowserControls:!0,hasTouchStrip:t>=5920&&t<=5968}}async sendDisplayUpdate(e){if(!this.device||!this.deviceInfo?.hasDisplay)return;const t=e.slice(0,this.deviceInfo.displayLines).map(e=>e.padEnd(this.deviceInfo.displayChars," ").substring(0,this.deviceInfo.displayChars)),a=new TextEncoder,n=this.deviceInfo.displayLines*this.deviceInfo.displayChars,s=t.join("").substring(0,n),r=a.encode(s),i=new Uint8Array(64);i[0]=Qb,i[1]=this.deviceInfo.displayLines,i[2]=255&r.length,i[3]=r.length>>8&255,i.set(r.slice(0,60),4);try{await this.device.sendReport(Qb,i)}catch(o){}}async sendLightGuide(e){if(this.device&&this.deviceInfo?.hasLightGuide)try{const t=new Uint8Array(256);for(const a of e){if(a.note<0||a.note>=128)continue;const e=2*a.note;t[e]=a.color,t[e+1]=Math.round(255*a.brightness)}for(let e=0;e<t.length;e+=60){const a=t.slice(e,e+60),n=new Uint8Array(64);n[0]=Zb,n[1]=e/60&255,n[2]=a.length,n.set(a,3),await this.device.sendReport(Zb,n)}}catch(t){}}handleInputReport(e){const{data:t,reportId:a}=e,n=new Uint8Array(t.buffer);switch(a){case Jb:this.handleKnobValues(n);break;case ev:this.handleButtonState(n);break;case tv:this.handleTransport(n);break;case nv:this.handleDeviceInfo(n)}}handleKnobValues(e){const t=e[1];for(let a=0;a<t;a++){const t=2+2*a,n=e[t],s=e[t+1]/127;this.knobValues[n]!==s&&(this.knobValues[n]=s,this.onKnobChange?.(n,s))}}handleButtonState(e){const t=e[1],a=1===e[2];a!==(this.buttonStates.get(t)||!1)&&(this.buttonStates.set(t,a),a?this.onButtonPress?.(t):this.onButtonRelease?.(t))}handleTransport(e){const t=e[1];this.handleButtonState(new Uint8Array([0,t,1]))}handleDeviceInfo(e){}async sendPing(){if(!this.device)return;const e=new Uint8Array(64);e[0]=av,e[1]=1,await this.device.sendReport(av,e)}onKnobChanged(e){this.onKnobChange=e}onButtonPressed(e){this.onButtonPress=e}onButtonReleased(e){this.onButtonRelease=e}getKnobValues(){return[...this.knobValues]}getButtonState(e){return this.buttonStates.get(e)||!1}}function iv(){return"hid"in navigator}const ov=Object.freeze(Object.defineProperty({__proto__:null,AKAI_VENDOR_ID:Hb,ALESIS_VENDOR_ID:15,ARTURIA_VENDOR_ID:Kb,ICON_VENDOR_ID:Yb,M_AUDIO_VENDOR_ID:qb,NEKTAR_VENDOR_ID:$b,NI_VENDOR_ID:Wb,NKSHIDProtocol:rv,NKS_BUTTONS:sv,STUDIOLOGIC_VENDOR_ID:Xb,getPairedDevices:async function(){if(!iv())return[];const e=await navigator.hid.getDevices(),t=[Wb,Hb,Kb,$b,qb,Xb,Yb,15];return e.filter(e=>t.includes(e.vendorId))},isHIDSupported:iv},Symbol.toStringTag,{value:"Module"})),lv=[240,71,127],cv=16,uv=14,dv=32,pv=128,hv=64,mv=[[13,19,25,31,37,43,49],[0,20,26,32,38,44,50],[1,7,27,33,39,45,51],[2,8,14,34,40,46,52],[3,9,15,21,41,47,53],[4,10,16,22,28,48,54],[5,11,17,23,29,35,55],[6,12,18,24,30,36,42]];async function fv(e,t){if(!ky.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const a=await navigator.requestMIDIAccess({sysex:!0}),n=Array.from(a.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(n)try{const a=e.padEnd(16," ").substring(0,16),s=t.padEnd(16," ").substring(0,16),r=Array.from(a).map(e=>e.charCodeAt(0)),i=Array.from(s).map(e=>e.charCodeAt(0)),o=new Uint8Array([...lv,73,cv,0,...r,1,...i,247]);n.send(o)}catch(s){}}async function gv(e,t,a,n){if(!ky.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const s=await navigator.requestMIDIAccess({sysex:!0}),r=Array.from(s.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(r&&!(e<0||e>7))try{const s=Math.max(0,Math.min(127,t)),i=Math.max(0,Math.min(127,a)),o=Math.max(0,Math.min(127,n)),l=new Uint8Array([...lv,73,dv,e,s,i,o,247]);r.send(l)}catch(i){}}async function yv(e){for(const t of e)await gv(t.pad,t.red,t.green,t.blue)}async function bv(e){if(1024!==e.length)return;if(!ky.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const t=await navigator.requestMIDIAccess({sysex:!0}),a=Array.from(t.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(a)try{const t=function(e){const t=[];for(let a=0;a<8;a++)for(let n=0;n<pv;n+=7){const s=new Array(8).fill(0);for(let t=0;t<8;t++){const r=16*(8*a+t)+Math.floor(n/8);for(let a=0;a<7&&n+a<pv;a++){const i=7-(n+a)%8,o=e[r]>>i&1,l=mv[t][a],c=Math.floor(l/7),u=l%7;o&&(s[c]|=1<<u)}}t.push(...s)}return new Uint8Array(t)}(e),n=t.length+4,s=n>>7&127,r=127&n,i=new Uint8Array([...lv,73,uv,s,r,0,7,0,127,...t,247]);a.send(i)}catch(n){}}async function vv(){const e=Array(hv).fill(null).map(()=>Array(pv).fill(!1));for(let n=0;n<pv;n++)e[0][n]=!0,e[63][n]=!0;for(let n=0;n<hv;n++)e[n][0]=!0,e[n][127]=!0;for(let n=0;n<Math.min(pv,hv);n++)e[n][n]=!0,e[n][127-n]=!0;let t=16;for(const n of"DEVILBOX")xv(e,n,t,28),t+=12;const a=function(e){const t=new Uint8Array(1024);for(let a=0;a<hv;a++)for(let n=0;n<pv;n++)if(e[a]&&e[a][n]){const e=7-n%8;t[16*a+Math.floor(n/8)]|=1<<e}return t}(e);await bv(a)}function xv(e,t,a,n){const s={D:[126,66,66,66,66,66,126,0],E:[126,64,64,124,64,64,126,0],V:[66,66,66,36,36,24,24,0],I:[60,24,24,24,24,24,60,0],L:[64,64,64,64,64,64,126,0],B:[124,66,66,124,66,66,124,0],O:[60,66,66,66,66,66,60,0],X:[66,66,36,24,36,66,66,0]},r=s[t.toUpperCase()]||s.O;for(let i=0;i<8;i++)for(let t=0;t<8;t++)if(r[i]>>7-t&1){const s=a+t,r=n+i;s>=0&&s<pv&&r>=0&&r<hv&&(e[r][s]=!0)}}class wv{protocol;updateInterval=null;lightGuideEnabled=!0;isAkaiDevice=!1;constructor(){this.protocol=new rv,this.protocol.onKnobChanged((e,t)=>{this.handleKnobChange(e,t)}),this.protocol.onButtonPressed(e=>{this.handleButtonPress(e)})}async requestConnection(){if(!iv())return!1;const e=await this.protocol.requestDevice();if(e){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return e}async connectToPairedDevice(){if(!iv())return!1;try{const{getPairedDevices:e}=await _a(async()=>{const{getPairedDevices:e}=await Promise.resolve().then(()=>ov);return{getPairedDevices:e}},void 0),t=await e();if(0===t.length)return!1;const a=await this.protocol.connect(t[0]);if(a){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return a}catch(e){return!1}}async disconnect(){this.stopDisplayUpdates(),await this.protocol.disconnect()}getDeviceInfo(){return this.protocol.getDeviceInfo()}isConnected(){return null!==this.protocol.getDeviceInfo()}startDisplayUpdates(){null===this.updateInterval&&(this.updateInterval=window.setInterval(()=>{this.updateDisplay()},100),this.updateDisplay())}stopDisplayUpdates(){null!==this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}async updateDisplay(){const e=Gb.getState().displayInfo;if(e&&0!==e.length)if(this.isAkaiDevice){const t=e[0]||"",a=e[1]||"";await fv(t,a)}else await this.protocol.sendDisplayUpdate(e)}async updateLightGuide(){if(!this.lightGuideEnabled)return;const e=Gb.getState().lightGuide||[];this.isAkaiDevice?await async function(e){const t=[];for(let a=0;a<Math.min(8,e.length);a++){const n=e[a],s=Math.round(127*n.brightness);let r=0,i=0,o=0;switch(n.color){case 0:break;case 1:r=i=o=s;break;case 2:r=s;break;case 3:r=s,i=Math.round(.5*s);break;case 4:r=i=s;break;case 5:i=s;break;case 6:i=o=s;break;case 7:o=s;break;case 8:r=Math.round(.5*s),o=s;break;case 9:r=o=s}t.push({pad:a,red:r,green:i,blue:o})}await yv(t)}(e):await this.protocol.sendLightGuide(e)}handleKnobChange(e,t){const a=Gb.getState(),n=8*a.currentPage+e,s=a.parameters[n];s&&a.setParameterValue(s.id,t)}handleButtonPress(e){const t=Gb.getState();switch(e){case sv.PAGE_LEFT:t.prevPage(),this.updateDisplay();break;case sv.PAGE_RIGHT:t.nextPage(),this.updateDisplay();break;case sv.PRESET:case sv.BROWSE:case sv.SHIFT:break;case sv.CLEAR:const e=8*t.currentPage,a=t.parameters[e];a&&t.setParameterValue(a.id,0);break;case sv.OCTAVE_UP:this.shiftLightGuide(12);break;case sv.OCTAVE_DOWN:this.shiftLightGuide(-12)}}shiftLightGuide(e){const t=Gb.getState(),a=(t.lightGuide||[]).map(t=>({...t,note:Math.max(0,Math.min(127,t.note+e))}));t.setLightGuide(a),this.updateLightGuide()}setScaleLights(e,t){const a=[];for(let n=0;n<11;n++)for(const s of t){const t=12*n+e+s;t>=0&&t<128&&a.push({note:t,color:0===s?2:1,brightness:.5})}Gb.getState().setLightGuide(a),this.updateLightGuide()}clearLightGuide(){Gb.getState().setLightGuide([]),this.updateLightGuide()}setLightGuideEnabled(e){this.lightGuideEnabled=e,e?this.updateLightGuide():this.clearLightGuide()}async syncKnobsToParameters(){await this.updateDisplay()}}let kv=null;function Sv(){return kv||(kv=new wv),kv}function Mv(){return iv()}const Nv=Object.freeze(Object.defineProperty({__proto__:null,NKSHardwareController:wv,connectToNKSPairedDevice:async function(){return Sv().connectToPairedDevice()},getNKSHardwareController:Sv,isNKSHardwareAvailable:Mv},Symbol.toStringTag,{value:"Module"}));function Cv(e){return e.split(".")}function Ev(e,t,a){if(0===t.length)return e;const[n,...s]=t,r=e[n];return 0===s.length?{...e,[n]:a}:{...e,[n]:Ev(r||{},s,a)}}function Pv(){!function(e){const{currentSynthType:t,setSynth:a,parameters:n,syncParametersFromConfig:r}=Gb(),{getInstrument:i,updateInstrument:o}=Pg(),l=s.useRef(""),c=e?i(e):void 0;s.useEffect(()=>{if(!c)return;const e=c.synthType;e!==t&&a(e);const n=e.toLowerCase(),s=c[n];if(s&&"object"==typeof s){const e=JSON.stringify(s);e!==l.current&&(l.current=e,r(s))}},[c,t,a,r]),s.useEffect(()=>{if(e&&c)return Gb.subscribe((t,a)=>{if(t.parameterValues!==a.parameterValues){const n=c.synthType.toLowerCase();let s={},r=!1;for(const e of t.parameters){const i=t.parameterValues[e.id],o=a.parameterValues[e.id];if(void 0!==i&&i!==o){let t;switch(e.type){case 2:t=i>=.5;break;case 3:if(e.valueStrings){const a=Math.round(i*(e.valueStrings.length-1));t=e.valueStrings[a]||e.valueStrings[0]}else t=Math.round(i*(e.max-e.min)+e.min);break;case 1:t=Math.round(i*(e.max-e.min)+e.min);break;default:t=i*(e.max-e.min)+e.min}const a=Cv(e.id);if(a[0]===n&&a.length>1){const e=a.slice(1),i=Ev(c[n]||{},e,t);s={...s,[n]:i},r=!0}}}if(r){const t=JSON.stringify(s[n]);l.current=t,o(e,s)}}})},[e,c,n,o])}(Pg(e=>e.currentInstrumentId))}const _v=(e,t,a)=>{const n=Math.log(t),s=Math.log(a);return(Math.log(e)-n)/(s-n)},Tv=e.memo(({value:e,min:t,max:a,label:n,title:r,unit:i="",onChange:o,logarithmic:l=!1,defaultValue:c,size:u="md",color:d="#00d4aa",displayValue:p,isActive:h=!1,bipolar:m=!1,formatValue:f,step:g,disabled:y=!1})=>{const b=s.useRef(null),[v,x]=s.useState(!1),w=s.useRef(0),k=s.useRef(0),S=s.useRef(null),M=s.useRef(null),N=s.useId(),C=s.useRef(o);C.current=o;const E=s.useRef(t);E.current=t;const P=s.useRef(a);P.current=a;const _=s.useRef(l);_.current=l;const T=s.useRef(g);T.current=g;const A="cyan-lineart"===Zg(e=>e.currentThemeId),O=A?"#00ffff":d,I=A?"#0a3a3a":"#2a2a2a",D=A?"#0a4a4a":"#444",F=A?"#0a4a4a":"#4a4a4a",R=A?"#0a3a3a":"#3a3a3a",j=A?"#0a2a2a":"#2a2a2a",{knob:L,fontSize:B,stroke:V}={sm:{knob:40,fontSize:10,stroke:3},md:{knob:56,fontSize:11,stroke:4},lg:{knob:72,fontSize:12,stroke:5}}[u],z=s.useCallback(()=>l?_v(Math.max(t,Math.min(a,e)),t,a):(e-t)/(a-t),[e,t,a,l]),U=s.useCallback(()=>{const n=void 0!==p?p:e,s=Math.max(t,Math.min(a,n));return l?_v(s,t,a):(s-t)/(a-t)},[p,e,t,a,l])(),G=isNaN(U)||!isFinite(U)?-135:270*U-135,W=f||(e=>isNaN(e)||null==e?"0":e>=1e3?`${(e/1e3).toFixed(1)}k`:e<10?e.toFixed(1):Math.round(e).toString()),H=m?0:-135,K=G,$=(L-2*V)/2,q=L/2,X=e=>{const t=((isNaN(e)||!isFinite(e)?-135:e)-90)*Math.PI/180;return{x:q+$*Math.cos(t),y:q+$*Math.sin(t)}},Y=(e,t)=>{const a=X(e),n=X(t),s=Math.abs(t-e)>180?1:0,r=t>e?1:0;return`M ${a.x} ${a.y} A ${$} ${$} 0 ${s} ${r} ${n.x} ${n.y}`},Q=s.useCallback(e=>{if(y)return;e.preventDefault(),x(!0);const t="touches"in e?e.touches[0].clientY:e.clientY;w.current=t,k.current=z(),document.body.style.cursor="ns-resize";const a=e=>{const t="touches"in e?e.touches[0].clientY:e.clientY,a=(w.current-t)/150,n=Math.max(0,Math.min(1,k.current+a));let s;s=_.current?((e,t,a)=>{const n=Math.log(t),s=Math.log(a);return Math.exp(n+e*(s-n))})(n,E.current,P.current):E.current+n*(P.current-E.current);const r=T.current;s=void 0!==r&&r>0?Math.round(s/r)*r:Math.round(100*s)/100,M.current=s,S.current||(S.current=requestAnimationFrame(()=>{null!==M.current&&(C.current(M.current),M.current=null),S.current=null}))},n=()=>{x(!1),document.body.style.cursor="",window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",n),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",n),S.current&&(cancelAnimationFrame(S.current),S.current=null)};window.addEventListener("mousemove",a),window.addEventListener("mouseup",n),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",n)},[z,y]),Z=s.useCallback(()=>{y||o(void 0!==c?c:m?(a+t)/2:t)},[c,m,t,a,o,y]),J=s.useCallback(e=>{e.preventDefault(),y||o(void 0!==c?c:m?(a+t)/2:t)},[c,m,t,a,o,y]),ee=s.useCallback(n=>{let s=e;const r=g||(l?(a-t)/100:(a-t)/50),i=10*r;switch(n.key){case"ArrowUp":case"ArrowRight":n.preventDefault(),s=Math.min(a,e+(n.shiftKey?i:r));break;case"ArrowDown":case"ArrowLeft":n.preventDefault(),s=Math.max(t,e-(n.shiftKey?i:r));break;case"Home":n.preventDefault(),s=t;break;case"End":n.preventDefault(),s=a;break;case"PageUp":n.preventDefault(),s=Math.min(a,e+i);break;case"PageDown":n.preventDefault(),s=Math.max(t,e-i);break;default:return}s=void 0!==g&&g>0?Math.round(s/g)*g:a-t>100?Math.round(s):Math.round(10*s)/10,o(s)},[e,t,a,l,g,o]);s.useEffect(()=>()=>{S.current&&cancelAnimationFrame(S.current)},[]);const te=X(G),ae={x:q+($-8)*Math.cos((G-90)*Math.PI/180),y:q+($-8)*Math.sin((G-90)*Math.PI/180)};return xa.jsxs("div",{className:"knob-container",style:{width:L+20,opacity:y?.4:1,pointerEvents:y?"none":"auto"},title:r,children:[n&&xa.jsx("div",{className:"knob-label",style:{fontSize:B-1},children:n}),xa.jsx("div",{ref:b,className:"knob-body "+(v?"cursor-grabbing":""),style:{width:L,height:L},onMouseDown:Q,onTouchStart:Q,onDoubleClick:Z,onContextMenu:J,onKeyDown:ee,role:"slider","aria-label":`${n||"Knob"}${i?` (${i})`:""}`,"aria-valuemin":t,"aria-valuemax":a,"aria-valuenow":Math.round(10*e)/10,"aria-valuetext":`${W(void 0!==p?p:e)}${i}`,tabIndex:0,children:xa.jsxs("svg",{width:L,height:L,viewBox:`0 0 ${L} ${L}`,children:[xa.jsx("path",{d:Y(-135,135),fill:"none",stroke:I,strokeWidth:V,strokeLinecap:"round"}),m?.5!==U&&xa.jsx("path",{d:Y(U>.5?H:K,U>.5?K:H),fill:"none",stroke:O,strokeWidth:V,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${O})`:`drop-shadow(0 0 2px ${O})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}):xa.jsx("path",{d:Y(-135,G),fill:"none",stroke:O,strokeWidth:V,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${O})`:`drop-shadow(0 0 2px ${O})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}),xa.jsx("circle",{cx:q,cy:q,r:$-V-4,fill:`url(#kg-${N})`,stroke:D,strokeWidth:"1"}),xa.jsx("line",{x1:ae.x,y1:ae.y,x2:te.x,y2:te.y,stroke:O,strokeWidth:"2",strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 3px ${O})`:"none",transition:void 0!==p?"transform 0.016s linear":"transform 0.1s ease-out"}}),xa.jsx("defs",{children:xa.jsxs("linearGradient",{id:`kg-${N}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[xa.jsx("stop",{offset:"0%",stopColor:F}),xa.jsx("stop",{offset:"50%",stopColor:R}),xa.jsx("stop",{offset:"100%",stopColor:j})]})})]})}),xa.jsxs("div",{className:"knob-value",style:{fontSize:B,color:h?O:void 0,textShadow:h?`0 0 4px ${O}80`:"none"},children:[W(void 0!==p?p:e),i]})]})},(e,t)=>e.value===t.value&&e.displayValue===t.displayValue&&e.isActive===t.isActive&&e.min===t.min&&e.max===t.max&&e.label===t.label&&e.color===t.color&&e.size===t.size&&e.disabled===t.disabled);Tv.displayName="Knob";const Av=()=>{const[e,t]=s.useState(null),[a,n]=s.useState(!1),[r,i]=s.useState(null),o=s.useRef(null);Pv();const{currentPreset:l,currentPage:c,totalPages:u,currentSynthType:d,pages:p,parameterValues:h,setParameterValue:m}=Gb(),f=Sv();s.useEffect(()=>{const e=f.getDeviceInfo();e&&t(e)},[]);return Mv()?xa.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg space-y-4",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{children:[xa.jsx("h3",{className:"text-lg font-semibold text-white",children:"Native Kontrol Standard"}),xa.jsx("div",{className:"text-xs text-cyan-400 mt-0.5",children:d})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("div",{className:"w-2 h-2 rounded-full "+(e?"bg-green-500":"bg-gray-500")}),xa.jsx("span",{className:"text-xs text-gray-400",children:e?"Connected":"Disconnected"})]})]}),e?xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[xa.jsx("div",{className:"text-sm font-medium text-white",children:e.name}),xa.jsx("div",{className:"text-xs text-gray-400",children:e.vendor}),xa.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-400",children:[e.hasDisplay&&xa.jsx("span",{children:" Display"}),e.hasLightGuide&&xa.jsxs("span",{children:[" Light Guide (",e.lightGuideKeys," keys)"]}),e.hasKnobs&&xa.jsxs("span",{children:[" ",e.knobCount," Knobs"]}),e.hasTransport&&xa.jsx("span",{children:" Transport"})]})]}),xa.jsx("button",{onClick:async()=>{await f.disconnect(),t(null)},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"Disconnect"})]}):xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("p",{className:"text-sm text-gray-300",children:"Connect a Native Instruments controller to enable hardware control."}),xa.jsx("button",{onClick:async()=>{n(!0),i(null);try{if(await f.requestConnection()){const e=f.getDeviceInfo();t(e)}else i("Failed to connect to device")}catch(e){i(e instanceof Error?e.message:"Unknown error")}finally{n(!1)}},disabled:a,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:a?"Connecting...":"Connect Hardware"}),r&&xa.jsx("div",{className:"text-xs text-red-400 bg-red-900/20 rounded p-2",children:r})]}),l&&xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Current Preset"}),xa.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[xa.jsx("div",{className:"text-sm font-medium text-white",children:l.metadata.name}),l.metadata.author&&xa.jsxs("div",{className:"text-xs text-gray-400",children:["by ",l.metadata.author]}),l.metadata.comment&&xa.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l.metadata.comment})]}),xa.jsx("button",{onClick:()=>{const e=Gb.getState();e.currentPreset&&e.exportPreset()},className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-sm",children:"Export .nksf File"})]}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("div",{className:"text-xs font-medium text-gray-400 uppercase",children:["Parameter Pages - ",p[c]?.name||"Page"]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("button",{onClick:()=>{Gb.getState().prevPage()},disabled:0===c,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:" Previous"}),xa.jsxs("div",{className:"px-4 py-2 bg-gray-700 rounded text-white text-sm font-mono",children:[c+1," / ",u]}),xa.jsx("button",{onClick:()=>{Gb.getState().nextPage()},disabled:c>=u-1,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:"Next "})]})]}),p[c]&&xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Parameters"}),xa.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3",children:xa.jsx("div",{className:"grid grid-cols-4 gap-3",children:p[c].parameters.slice(0,8).map(e=>{const t=h[e.id]??e.defaultValue,a=ub(e,t);return xa.jsxs("div",{className:"flex flex-col items-center",children:[xa.jsx(Tv,{value:t*(e.max-e.min)+e.min,min:e.min,max:e.max,onChange:t=>{const a=(t-e.min)/(e.max-e.min);m(e.id,a)},label:e.name,color:"#00ffff",size:"sm"}),xa.jsx("div",{className:"text-[10px] text-gray-400 mt-1 text-center truncate w-full",children:a})]},e.id)})})})]}),e?.hasLightGuide&&xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"Pad LEDs":"Light Guide"}),xa.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.vendor.toLowerCase().includes("akai")?xa.jsxs(xa.Fragment,{children:[xa.jsx("button",{onClick:()=>async function(){await yv([{pad:0,red:127,green:0,blue:0},{pad:1,red:127,green:64,blue:0},{pad:2,red:127,green:127,blue:0},{pad:3,red:0,green:127,blue:0},{pad:4,red:0,green:127,blue:127},{pad:5,red:0,green:0,blue:127},{pad:6,red:64,green:0,blue:127},{pad:7,red:127,green:0,blue:127}])}(),className:"px-3 py-2 bg-gradient-to-r from-red-500 via-yellow-500 to-blue-500 hover:opacity-80 text-white rounded transition-colors text-xs font-medium",children:"Rainbow"}),xa.jsx("button",{onClick:()=>async function(){const e=Array.from({length:8},(e,t)=>({pad:t,red:0,green:0,blue:0}));await yv(e)}(),className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear LEDs"})]}):xa.jsxs(xa.Fragment,{children:[xa.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,4,5,7,9,11])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Major Scale"}),xa.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,3,5,7,8,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Minor Scale"}),xa.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,3,5,7,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Pentatonic"}),xa.jsx("button",{onClick:()=>{f.clearLightGuide()},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear"})]})})]}),e?.hasDisplay&&xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"OLED Display (128x64)":"Display Test"}),e.vendor.toLowerCase().includes("akai")?xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsx("button",{onClick:()=>fv("  DEViLBOX  ","  Tracker DAW  "),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Text"}),xa.jsx("button",{onClick:()=>vv(),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Pattern"})]}),xa.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;const a=new Image;a.onload=async()=>{const e=document.createElement("canvas");e.width=128,e.height=64;const t=e.getContext("2d");if(!t)return;t.fillStyle="black",t.fillRect(0,0,128,64);const n=Math.min(128/a.width,64/a.height),s=(128-a.width*n)/2,r=(64-a.height*n)/2;t.drawImage(a,s,r,a.width*n,a.height*n);const o=function(e){const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");const a=t.getImageData(0,0,pv,hv),n=new Uint8Array(1024);for(let s=0;s<hv;s++)for(let e=0;e<pv;e++){const t=4*(s*pv+e);if(a.data[t]>127){const t=7-e%8;n[16*s+Math.floor(e/8)]|=1<<t}}return n}(e);await bv(o),i(null)},a.onerror=()=>{i("Failed to load image")},a.src=URL.createObjectURL(t)},className:"hidden"}),xa.jsx("button",{onClick:()=>{o.current?.click()},className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors text-xs font-medium",children:" Upload Custom Image (128x64)"}),xa.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"Tip: Upload any image - it will be auto-converted to monochrome 12864"})]}):xa.jsx("button",{onClick:()=>{Gb.getState().setDisplayInfo(["    DEViLBOX    ","  Tracker DAW   ","  NKS Active    ","  Connected!    "])},className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Display"})]}),xa.jsx("div",{className:"pt-2 border-t border-gray-700",children:xa.jsxs("div",{className:"text-xs text-gray-500",children:[xa.jsx("p",{children:"NKS enables deep hardware integration with Native Instruments controllers."}),xa.jsx("p",{className:"mt-1",children:"Knobs, displays, and light guides sync automatically."})]})})]}):xa.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg",children:[xa.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Web HID Not Supported"}),xa.jsx("p",{className:"text-sm text-gray-300",children:"Your browser does not support Web HID API. Please use Chrome/Edge 89+ or Opera 75+."})]})},Ov=({onClose:e})=>{const[t,a]=s.useState(""),[n,r]=s.useState("all"),[i,o]=s.useState("name"),{presets:l,loadPreset:c}=Gb(),u=s.useMemo(()=>{let e=[...l];if(t.trim()){const a=t.toLowerCase();e=e.filter(e=>e.metadata.name.toLowerCase().includes(a)||e.metadata.author?.toLowerCase().includes(a)||e.metadata.comment?.toLowerCase().includes(a)||e.metadata.bankChain.some(e=>e.toLowerCase().includes(a)))}return"all"!==n&&(e=e.filter(e=>e.metadata.bankChain.includes(n))),e.sort((e,t)=>{switch(i){case"name":case"date":return e.metadata.name.localeCompare(t.metadata.name);case"author":return(e.metadata.author||"").localeCompare(t.metadata.author||"");default:return 0}}),e},[l,t,n,i]),d=s.useMemo(()=>{const e=new Set;return l.forEach(t=>{t.metadata.bankChain.forEach(t=>e.add(t))}),Array.from(e).sort()},[l]);return xa.jsx("div",{className:"nks-preset-browser fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:xa.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl max-h-[80vh] flex flex-col",children:[xa.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[xa.jsx("h2",{className:"text-xl font-semibold text-white",children:"NKS Preset Browser"}),xa.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:xa.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:xa.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),xa.jsxs("div",{className:"p-4 border-b border-gray-700 space-y-3",children:[xa.jsxs("div",{className:"relative",children:[xa.jsx("input",{type:"text",value:t,onChange:e=>a(e.target.value),placeholder:"Search presets...",className:"w-full px-4 py-2 pl-10 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500 outline-none"}),xa.jsx("svg",{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:xa.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),xa.jsxs("div",{className:"flex gap-3",children:[xa.jsxs("select",{value:n,onChange:e=>r(e.target.value),className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[xa.jsx("option",{value:"all",children:"All Categories"}),d.map(e=>xa.jsx("option",{value:e,children:e},e))]}),xa.jsxs("select",{value:i,onChange:e=>o(e.target.value),className:"px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[xa.jsx("option",{value:"name",children:"Sort by Name"}),xa.jsx("option",{value:"author",children:"Sort by Author"}),xa.jsx("option",{value:"date",children:"Sort by Date"})]}),xa.jsxs("label",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer transition-colors",children:["Import .nksf",xa.jsx("input",{type:"file",accept:".nksf",onChange:async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.arrayBuffer(),a=await db(e);if(a){Gb.getState().addPreset(a),c(a)}}catch(a){alert("Failed to import preset file")}},className:"hidden"})]})]})]}),xa.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===u.length?xa.jsxs("div",{className:"text-center text-gray-400 py-8",children:[xa.jsx("p",{children:"No presets found"}),0===l.length&&xa.jsx("p",{className:"text-sm mt-2",children:"Import .nksf files to get started"})]}):xa.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.map((t,a)=>xa.jsxs("button",{onClick:()=>(t=>{c(t),e?.()})(t),className:"text-left p-4 bg-gray-700 hover:bg-gray-600 rounded transition-colors group",children:[xa.jsxs("div",{className:"flex items-start justify-between",children:[xa.jsxs("div",{className:"flex-1 min-w-0",children:[xa.jsx("div",{className:"font-medium text-white truncate group-hover:text-blue-400 transition-colors",children:t.metadata.name}),t.metadata.author&&xa.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["by ",t.metadata.author]}),t.metadata.bankChain.length>0&&xa.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:t.metadata.bankChain.join("  ")}),t.metadata.comment&&xa.jsx("div",{className:"text-xs text-gray-500 mt-2 line-clamp-2",children:t.metadata.comment})]}),xa.jsx("svg",{className:"w-5 h-5 text-gray-500 group-hover:text-blue-400 transition-colors ml-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:xa.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),xa.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[Object.keys(t.parameters).length," parameters"]})]},`${t.metadata.uuid}-${a}`))})}),xa.jsxs("div",{className:"p-4 border-t border-gray-700 text-xs text-gray-500",children:["Showing ",u.length," of ",l.length," presets"]})]})})},Iv=e.memo(()=>{const[e,t]=s.useState(!1),[a,n]=s.useState(!1),[r,i]=s.useState(!1),[o,l]=s.useState(!1),c=s.useRef(null),u=ky(e=>e.isSupported),d=ky(e=>e.isInitialized),p=ky(e=>e.lastError),h=ky(e=>e.inputDevices),m=ky(e=>e.outputDevices),f=ky(e=>e.selectedInputId),g=ky(e=>e.selectedOutputId),y=ky(e=>e.isLearning),b=ky(e=>e.lastActivityTimestamp),v=ky(e=>e.init),x=ky(e=>e.selectInput),w=ky(e=>e.selectOutput),k=ky(e=>e.cancelLearn),S=ky(e=>e.openPatternDialog);s.useEffect(()=>{d||null!==u||(n(!0),v().finally(()=>n(!1)))},[d,u,v]),s.useEffect(()=>{if(!e)return;const a=e=>{c.current&&!c.current.contains(e.target)&&(t(!1),y&&k())};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[e,y,k]);const[M,N]=s.useState(!1);s.useEffect(()=>{if(b>0){N(!0);const e=setTimeout(()=>N(!1),100);return()=>clearTimeout(e)}},[b]);return xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{className:"relative",ref:c,children:[xa.jsxs("button",{onClick:()=>t(!e),className:`\n          flex items-center gap-2 px-2 py-1 rounded text-sm font-medium\n          transition-all duration-150\n          ${e?"bg-dark-bgActive text-text-primary":"hover:bg-dark-bgHover"}\n          ${null===u||!1===u?"text-text-muted":p?"text-accent-error":d?f||g?"text-accent-success":"text-accent-warning":"text-text-muted"}\n        `,title:u?d?f||g?"MIDI connected":"No MIDI device":"MIDI not initialized":"MIDI not supported",children:[xa.jsxs("div",{className:"relative",children:[xa.jsx(Ce,{size:16}),M&&xa.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-primary rounded-full animate-ping"})]}),xa.jsx("span",{className:"hidden sm:inline",children:"MIDI"})]}),e&&xa.jsxs("div",{className:"absolute right-0 top-full mt-1 w-80 max-h-[80vh] bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl z-50 overflow-y-auto",children:[xa.jsxs("div",{className:"px-4 py-3 border-b border-dark-border bg-dark-bgSecondary",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"MIDI Settings"}),a&&xa.jsx(Le,{size:14,className:"animate-spin text-accent-primary"})]}),p&&xa.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-accent-error",children:[xa.jsx(Ie,{size:12}),xa.jsx("span",{children:p})]})]}),!1===u?xa.jsxs("div",{className:"px-4 py-6 text-center",children:[xa.jsx(Ie,{size:24,className:"mx-auto mb-2 text-text-muted"}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"Web MIDI API is not supported in this browser."}),xa.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Try Chrome, Edge, or Opera."})]}):null===u?xa.jsxs("div",{className:"px-4 py-6 text-center",children:[xa.jsx(Le,{size:24,className:"mx-auto mb-2 text-text-muted animate-spin"}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"Checking MIDI support..."})]}):xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{className:"px-4 py-3 space-y-3 border-b border-dark-border",children:[xa.jsx(Tb,{label:"Input Device",devices:h,selectedId:f,onSelect:x}),xa.jsx(Tb,{label:"Output Device",devices:m,selectedId:g,onSelect:w})]}),xa.jsxs("div",{className:"px-4 py-2 border-b border-dark-border space-y-2",children:[xa.jsxs("button",{onClick:()=>{t(!1),i(!0)},className:"w-full px-3 py-2 text-sm font-medium bg-accent-primary/20 border border-accent-primary/30 rounded flex items-center justify-center gap-2 hover:bg-accent-primary/30 transition-colors text-accent-primary",children:[xa.jsx(Be,{size:14}),"MIDI Controller Setup..."]}),xa.jsxs("button",{onClick:()=>{t(!1),S()},className:"w-full px-3 py-2 text-sm font-medium bg-dark-bgActive rounded flex items-center justify-center gap-2 hover:bg-dark-bgHover transition-colors",children:[xa.jsx(Ve,{size:14}),"TD-3 Patterns..."]})]}),xa.jsx("div",{className:"border-t border-dark-border",children:xa.jsx(Av,{})}),f&&xa.jsx("div",{className:"px-4 py-2 border-t border-dark-border bg-dark-bgSecondary",children:xa.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[xa.jsx(ze,{size:10,className:M?"text-accent-success":"text-text-muted"}),xa.jsx("span",{children:M?"Receiving MIDI...":"Listening for MIDI input"})]})})]})]})]}),o&&xa.jsx(Ov,{onClose:()=>l(!1)}),xa.jsx(Bb,{isOpen:r,onClose:()=>i(!1)})]})}),Dv=({variant:e="default",size:t="md",color:a="default",fullWidth:n=!1,loading:s=!1,icon:r,iconPosition:i="left",children:o,className:l="",disabled:c,...u})=>{const d={primary:"btn-primary",default:"btn",ghost:"btn-ghost",icon:"btn-icon",danger:"btn-danger",ft2:""},p={sm:"btn-sm",md:"btn-md",lg:"btn-lg",icon:""};let h="inline-flex items-center justify-center gap-2 font-medium transition-colors focus:outline-none";if("ft2"===e)h+=` ft2-btn ${{sm:"ft2-btn-small",md:"",lg:"",icon:""}[t]} ${{default:"",red:"ft2-btn-red",green:"ft2-btn-green",yellow:"ft2-btn-yellow",blue:"ft2-btn-blue",purple:"ft2-btn-purple",cyan:"",amber:""}[a]}`;else{h+=` ${d[e]||d.default}`,p[t]&&(h+=` ${p[t]}`)}n&&(h+=" w-full"),(c||s)&&(h+=" opacity-50 cursor-not-allowed"),l&&(h+=` ${l}`);const m=xa.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[xa.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),xa.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return xa.jsxs("button",{...u,className:h,disabled:c||s,children:[s&&m,!s&&r&&"left"===i&&r,o,!s&&r&&"right"===i&&r]})},Fv=({isOpen:e,onClose:t})=>{if(!e)return null;const a=[{name:"Windows",icon:xa.jsx(je,{size:24}),desc:"Installer (.exe) or Portable (.zip)",color:"text-blue-400"},{name:"macOS",icon:xa.jsx(We,{size:24}),desc:"Disk Image (.dmg) for Intel/Apple Silicon",color:"text-gray-300"},{name:"Linux",icon:xa.jsx(He,{size:24}),desc:"AppImage, Debian, or Tarball",color:"text-orange-400"}];return xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100] animate-fade-in",children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden animate-slide-in-up",children:[xa.jsxs("div",{className:"bg-dark-bgTertiary px-6 py-4 flex items-center justify-between border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:xa.jsx(Ue,{size:20})}),xa.jsxs("div",{children:[xa.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Download DEViLBOX"}),xa.jsx("p",{className:"text-xs text-text-muted font-mono",children:"Native Desktop Applications"})]})]}),xa.jsx(Dv,{variant:"icon",size:"icon",onClick:t,"aria-label":"Close dialog",children:xa.jsx(Ee,{size:20})})]}),xa.jsxs("div",{className:"p-6",children:[xa.jsx("p",{className:"text-sm text-text-secondary mb-6 leading-relaxed",children:"Experience DEViLBOX with lower latency, better performance, and offline support. Native apps provide full access to system audio and MIDI resources."}),xa.jsx("div",{className:"space-y-3",children:a.map(e=>xa.jsxs("a",{href:"https://github.com/spotUP/DEViLBOX/releases/latest",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-4 p-4 rounded-xl border border-dark-border bg-dark-bg hover:bg-dark-bgHover hover:border-accent-primary/50 transition-all duration-200 shadow-sm",children:[xa.jsx("div",{className:`p-3 rounded-lg bg-dark-bgSecondary ${e.color} group-hover:scale-110 transition-transform duration-200`,children:e.icon}),xa.jsxs("div",{className:"flex-1",children:[xa.jsx("h3",{className:"font-semibold text-text-primary group-hover:text-accent-primary transition-colors",children:e.name}),xa.jsx("p",{className:"text-xs text-text-muted",children:e.desc})]}),xa.jsx(Ge,{size:16,className:"text-text-muted group-hover:text-text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"})]},e.name))}),xa.jsx("div",{className:"mt-8 pt-6 border-t border-dark-border text-center",children:xa.jsx("p",{className:"text-[10px] text-text-muted font-mono uppercase tracking-widest",children:"Built with Electron & Tone.js"})})]})]})})},Rv={Synth:1,MonoSynth:2,DuoSynth:3,FMSynth:4,AMSynth:5,TB303:10,Sampler:11,WobbleBass:12,DubSiren:13,SpaceLaser:14,V2:20,Synare:15,DrumMachine:16,ChipSynth:17};class jv{static export(e,t,a,n,s){const r=[];r.push(219,88,78,33),r.push(1),r.push(Math.min(255,n)),r.push(Math.min(255,s));const i=this.getUsedInstrumentIds(t,a),o=e.filter(e=>i.has(e.id));r.push(o.length),r.push(a.length),o.forEach(e=>{r.push(e.id),r.push(Rv[e.synthType]||0),r.push(Math.round((e.volume+60)/60*255)),r.push(Math.round((e.pan+100)/200*255));this.packSynthParams(e).forEach(e=>r.push(e))}),a.forEach(e=>r.push(e));const l=Array.from(new Set(a));return r.push(l.length),l.forEach(e=>{const a=t[e];if(a){r.push(e),r.push(a.length);for(let e=0;e<a.length;e++){const t=[];a.channels.forEach((a,n)=>{const s=a.rows[e];s&&this.isCellActive(s)&&t.push({cell:s,channel:n})}),0!==t.length?(r.push(t.length),t.forEach(({cell:e,channel:t})=>{let a=0;e.note>0&&(a|=8),e.instrument>0&&(a|=4),e.volume>0&&(a|=2),e.effTyp>0&&(a|=1),r.push(t<<4|a),8&a&&r.push(e.note),4&a&&r.push(e.instrument),2&a&&r.push(e.volume),1&a&&(r.push(e.effTyp),r.push(e.eff))})):r.push(0)}}}),new Uint8Array(r)}static getUsedInstrumentIds(e,t){const a=new Set;return t.forEach(t=>{const n=e[t];n&&n.channels.forEach(e=>{e.rows.forEach(e=>{e.instrument>0&&a.add(e.instrument)})})}),a}static isCellActive(e){return e.note>0||e.instrument>0||e.volume>0||e.effTyp>0}static packSynthParams(e){const t=new Array(8).fill(0);return"TB303"===e.synthType&&e.tb303?(t[0]=e.tb303.filter.cutoff,t[1]=e.tb303.filter.resonance,t[2]=e.tb303.filterEnvelope.envMod,t[3]=e.tb303.filterEnvelope.decay):"SpaceLaser"===e.synthType&&e.spaceLaser?(t[0]=e.spaceLaser.laser.sweepTime/2e3*255,t[1]=e.spaceLaser.fm.amount,t[2]=10*e.spaceLaser.fm.ratio,t[3]=e.spaceLaser.filter.cutoff/100):"V2"===e.synthType&&e.v2&&(t[0]=e.v2.osc1.transpose+64,t[1]=e.v2.osc1.detune+64,t[2]=e.v2.filter1.cutoff,t[3]=e.v2.filter1.resonance),t.map(e=>Math.floor(Math.min(255,Math.max(0,e))))}}const Lv=({onClose:e})=>{const[t,a]=s.useState(!1),{instruments:n}=Pg(),{patterns:r,patternOrder:i}=tf(),{bpm:o,speed:l}=Rg(),c=s.useMemo(()=>jv.export(n,r,i,o,l),[n,r,i,o,l]),u=s.useMemo(()=>{let e="";const t=new Uint8Array(c),a=t.byteLength;for(let n=0;n<a;n++)e+=String.fromCharCode(t[n]);return window.btoa(e)},[c]),d=s.useMemo(()=>({bytes:c.length,kb:(c.length/1024).toFixed(2),instr:n.length}),[c,n]);return xa.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:xa.jsxs("div",{className:"w-full max-w-2xl bg-[#1a1a1a] border-2 border-amber-500/50 shadow-[0_0_30px_rgba(245,158,11,0.2)] rounded-xl overflow-hidden flex flex-col",children:[xa.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-amber-900/40 to-transparent border-b border-amber-500/30 flex items-center justify-between",children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("div",{className:"p-2 bg-amber-500 rounded-lg",children:xa.jsx(Ae,{size:20,className:"text-black"})}),xa.jsxs("div",{children:[xa.jsx("h2",{className:"text-xl font-bold text-amber-400 tracking-tight",children:"NANO EXPORTER"}),xa.jsx("p",{className:"text-[10px] text-amber-500/60 uppercase font-black tracking-[0.2em]",children:"4k Intro Binary Packing"})]})]}),xa.jsx("button",{onClick:e,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:xa.jsx(Ee,{size:20})})]}),xa.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[xa.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[xa.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[xa.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Total Size"}),xa.jsxs("div",{className:"text-lg font-mono text-white",children:[d.bytes," ",xa.jsx("span",{className:"text-xs text-gray-500",children:"bytes"})]})]}),xa.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[xa.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Kilobytes"}),xa.jsxs("div",{className:"text-lg font-mono text-white",children:[d.kb," ",xa.jsx("span",{className:"text-xs text-gray-500",children:"KB"})]})]}),xa.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[xa.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Target"}),xa.jsx("div",{className:"text-lg font-mono text-green-500",children:"4K OK"})]})]}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Binary Data (Base64)"}),xa.jsxs("div",{className:"relative group",children:[xa.jsx("textarea",{readOnly:!0,value:u,className:"w-full h-32 bg-black/60 border border-white/10 rounded-lg p-4 font-mono text-[10px] text-amber-400/80 resize-none focus:outline-none focus:border-amber-500/50"}),xa.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(u),a(!0),setTimeout(()=>a(!1),2e3)},className:"absolute top-2 right-2 p-2 bg-amber-500 text-black rounded-md hover:bg-amber-400 transition-colors shadow-lg flex items-center gap-2",children:[t?xa.jsx(Fe,{size:14}):xa.jsx(Ke,{size:14}),xa.jsx("span",{className:"text-[10px] font-bold uppercase",children:t?"Copied":"Copy"})]})]})]}),xa.jsxs("div",{className:"bg-amber-500/5 border border-amber-500/20 p-4 rounded-lg",children:[xa.jsx("h4",{className:"text-xs font-bold text-amber-400 uppercase mb-2",children:"How to use in 4k Intro:"}),xa.jsxs("ul",{className:"text-[11px] text-gray-400 space-y-1 list-disc pl-4",children:[xa.jsx("li",{children:"Copy the Base64 string into your source code."}),xa.jsx("li",{children:"Decode it into a Uint8Array at startup."}),xa.jsx("li",{children:"Parse the fixed-length header (8 bytes)."}),xa.jsx("li",{children:"Precalc (Bake) instruments into RAM using the packed parameters."}),xa.jsx("li",{children:"Use a lightweight replay routine to process the 4-byte packed patterns."})]})]})]}),xa.jsxs("div",{className:"p-6 bg-black/20 border-t border-white/5 flex gap-3",children:[xa.jsxs("button",{onClick:()=>{const e=new Blob([new Uint8Array(c)],{type:"application/octet-stream"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="song.nano",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},className:"flex-1 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg font-bold text-xs text-white transition-all flex items-center justify-center gap-2",children:[xa.jsx($e,{size:16}),"DOWNLOAD .NANO"]}),xa.jsx("button",{onClick:e,className:"flex-1 py-3 bg-amber-500 hover:bg-amber-400 text-black rounded-lg font-bold text-xs transition-all",children:"DONE"})]})]})})},Bv=()=>"undefined"!=typeof window&&!0===window.electron?.isElectron,Vv=()=>Bv()&&!!window.electron?.fs,zv=e.memo(()=>{const e=Bg(e=>e.metadata),t=Bg(e=>e.isDirty),a=Lg(e=>e.masterVolume),n=Lg(e=>e.setMasterVolume),r=qg(e=>e.tabs),i=qg(e=>e.activeTabId),o=qg(e=>e.addTab),l=qg(e=>e.closeTab),c=qg(e=>e.setActiveTab),u=qg(e=>e.updateTabName),d=qg(e=>e.markTabDirty),p=Zg(e=>e.currentThemeId),h=Zg(e=>e.setTheme),m=Zg(e=>e.getCurrentTheme),[f,g]=s.useState(!1),[y,b]=s.useState(!1),[v,x]=s.useState(!1),w=m();s.useEffect(()=>{e.name&&i&&u(i,e.name)},[e.name,i,u]),s.useEffect(()=>{i&&d(i,t)},[t,i,d]),s.useEffect(()=>{if(!f)return;const e=e=>{e.target.closest("[data-theme-menu]")||g(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[f]);return xa.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border relative z-40",children:[xa.jsxs("nav",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsx("h1",{className:"font-bold text-lg tracking-tight",children:xa.jsx("span",{className:"text-accent-primary",children:"DEViLBOX"})}),xa.jsxs("span",{className:"text-xs font-medium text-text-inverse bg-accent-primary px-2 py-0.5 rounded cursor-help",title:`${Nb}  2026-02-11`,children:["1.0.",Mb]})]}),xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>x(!0),icon:xa.jsx(Ae,{size:14,className:"text-amber-400"}),className:"text-amber-400 hover:text-amber-300 hover:bg-amber-400/10 border border-amber-400/20",title:"Nano Exporter: Demoscene-grade binary packing",children:"NANO"}),!Bv()&&xa.jsx(Dv,{variant:"primary",size:"sm",onClick:()=>b(!0),icon:xa.jsx(Ue,{size:14}),iconPosition:"left",title:"Download Desktop App",children:xa.jsx("span",{className:"hidden sm:inline uppercase whitespace-nowrap",children:"Desktop App"})}),xa.jsx(Iv,{}),xa.jsxs("div",{className:"relative","data-theme-menu":!0,children:[xa.jsxs("button",{onClick:()=>g(!f),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors whitespace-nowrap",title:"Change theme",children:[xa.jsx(qe,{size:16}),xa.jsx("span",{className:"text-sm",children:w.name})]}),f&&xa.jsx("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[140px]",children:Yg.map(e=>xa.jsxs("button",{onClick:()=>{h(e.id),g(!1)},className:`\n                      w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2\n                      ${p===e.id?"bg-dark-bgActive text-text-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"}\n                    `,children:[xa.jsx("span",{className:"w-3 h-3 rounded-full border border-dark-borderLight",style:{backgroundColor:e.colors.accent}}),e.name]},e.id))})]}),xa.jsx("input",{type:"range",value:a,onChange:e=>{const t=parseInt(e.target.value,10);n(t)},min:"-60",max:"0",step:"1",className:"w-24",title:`Volume: ${a} dB`})]})]}),xa.jsxs("div",{className:"flex items-center px-2 py-1 border-b border-dark-border bg-dark-bgTertiary",children:[xa.jsx("div",{className:"flex items-center gap-1 flex-1 overflow-x-auto scrollbar-none",children:r.map(e=>xa.jsxs("button",{onClick:()=>c(e.id),className:`\n                group flex items-center gap-2 px-3 py-1.5 rounded-t-md text-sm font-medium\n                transition-all duration-150 min-w-0 max-w-[200px]\n                ${i===e.id?"bg-dark-bg text-text-primary border-t border-x border-dark-border -mb-px":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary hover:bg-dark-bg/50"}\n              `,children:[xa.jsxs("span",{className:"truncate",children:[e.name||"Untitled",e.isDirty&&xa.jsx("span",{className:"text-accent-primary ml-1",children:"*"})]}),r.length>1&&xa.jsx("span",{onClick:t=>((e,t)=>{e.stopPropagation(),l(t)})(t,e.id),className:`\n                    flex-shrink-0 p-0.5 rounded hover:bg-dark-border/50\n                    ${i===e.id?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:!opacity-100"}\n                  `,children:xa.jsx(Ee,{size:12})})]},e.id))}),xa.jsx("button",{onClick:()=>{o()},className:"flex-shrink-0 p-1.5 ml-1 rounded hover:bg-dark-border/50 text-text-muted hover:text-text-primary transition-colors",title:"New project tab",children:xa.jsx(Xe,{size:16})})]}),xa.jsx(Fv,{isOpen:y,onClose:()=>b(!1)}),v&&xa.jsx(Lv,{onClose:()=>x(!1)})]})}),Uv=({children:e})=>xa.jsxs("div",{className:"h-screen flex flex-col bg-dark-bg text-text-primary overflow-y-hidden",children:[xa.jsx(zv,{}),xa.jsx("main",{className:"flex-1 flex min-h-0 overflow-y-hidden",children:e})]}),Gv=(e,t)=>{if(!e||0===e.points.length)return null;const a=e.points;let n=null,s=null;for(let r=0;r<a.length;r++)if(a[r].row<=t&&(n=a[r]),a[r].row>=t){s=a[r];break}if(n&&n.row===t)return n.value;if(s&&s.row===t)return s.value;if(!n&&s)return s.value;if(n&&!s)return n.value;if(n&&s){const e=(t-n.row)/(s.row-n.row);return n.value+(s.value-n.value)*e}return null},Wv=20,Hv=({patternId:e,patternLength:t,rowHeight:a,channelCount:n,channelWidth:r,rowNumWidth:i,scrollOffset:o,visibleStart:l,parameter:c="cutoff",prevPatternId:u,prevPatternLength:d,nextPatternId:p,nextPatternLength:h})=>{const m=Vg(e=>e.curves),f=Vg(e=>e.addPoint),g=Vg(e=>e.removePoint),[y,b]=s.useState(null),v=s.useRef(null),x=s.useMemo(()=>{const t=[];for(let a=0;a<n;a++){const n=m.find(t=>t.patternId===e&&t.channelIndex===a&&t.parameter===c);t.push(n&&n.points.length>0?n:null)}return t},[e,n,c,m]),w=s.useMemo(()=>{if(!u)return[];const e=[];for(let t=0;t<n;t++){const a=m.find(e=>e.patternId===u&&e.channelIndex===t&&e.parameter===c);e.push(a&&a.points.length>0?a:null)}return e},[u,n,c,m]),k=s.useMemo(()=>{if(!p)return[];const e=[];for(let t=0;t<n;t++){const a=m.find(e=>e.patternId===p&&e.channelIndex===t&&e.parameter===c);e.push(a&&a.points.length>0?a:null)}return e},[p,n,c,m]),S=(e=>({cutoff:"var(--color-synth-filter)",resonance:"var(--color-synth-filter)",envMod:"var(--color-synth-envelope)",decay:"var(--color-synth-envelope)",accent:"var(--color-synth-accent)",overdrive:"var(--color-synth-drive)",distortion:"var(--color-synth-drive)",volume:"var(--color-synth-volume)",pan:"var(--color-synth-pan)",delay:"var(--color-synth-effects)",reverb:"var(--color-synth-effects)"}[e]||"var(--color-synth-filter)"))(c),M=u?d||t:0,N=p?h||t:0,C=M*a+t*a+N*a;if(!(x.some(e=>null!==e)||w.some(e=>null!==e)||k.some(e=>null!==e)))return null;const E=s.useCallback((e,n,s,r,i)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const o=v.current?.getBoundingClientRect();if(!o)return;const l=e.clientY-o.top-i,c=Math.floor(l/a);if(c<0||c>=t)return;const u=e.clientX-o.left-r,d=Math.max(0,Math.min(1,(u-1)/18));f(n.id,c,d),b({curveId:n.id,row:c,channelIndex:s})},[t,a,f]),P=s.useCallback(e=>{if(!y||!v.current)return;const n=v.current.getBoundingClientRect(),s=x[y.channelIndex];if(!s)return;const i=y.channelIndex*r+r-Wv-4,o=M*a,l=e.clientY-n.top-o,c=Math.floor(l/a);if(c<0||c>=t)return;const u=e.clientX-n.left-i,d=Math.max(0,Math.min(1,(u-1)/18));f(s.id,c,d)},[y,x,r,M,a,t,f]),_=s.useCallback(()=>{b(null)},[]),T=s.useCallback((e,n,s)=>{const r=v.current?.getBoundingClientRect();if(!r)return;const i=e.clientY-r.top-s,o=Math.floor(i/a);if(o<0||o>=t)return;n.points.find(e=>e.row===o)&&g(n.id,o)},[t,a,g]),A=(e,t,n,s,i,o)=>e.map((e,l)=>{if(!e)return null;const c=l*r+r-Wv-4,u=t*a,d=n*a,p=[],h=[`M 20 ${u}`];for(let n=0;n<t;n++){const t=Gv(e,n);if(null!==t){const e=18*t+1,s=n*a+a/2;p.push(`${0===p.length?"M":"L"} ${e} ${s}`)}}for(let n=t-1;n>=0;n--){const t=Gv(e,n);if(null!==t){const e=18*t+1,s=n*a+a/2;h.push(`L ${e} ${s}`)}}return h.push("L 20 0 Z"),xa.jsx("div",{style:{position:"absolute",left:c,top:d,width:Wv,height:u,cursor:o?"crosshair":"default"},onMouseDown:o?t=>E(t,e,l,c,d):void 0,onDoubleClick:o?t=>T(t,e,d):void 0,children:xa.jsxs("svg",{width:Wv,height:u,children:[xa.jsx("path",{d:h.join(" "),fill:S,fillOpacity:.1*s}),xa.jsx("path",{d:p.join(" "),fill:"none",stroke:S,strokeWidth:1.5,strokeOpacity:.6*s,strokeLinecap:"round",strokeLinejoin:"round"}),1===s&&e.points.map((e,t)=>xa.jsx("circle",{cx:18*e.value+1,cy:e.row*a+a/2,r:2,fill:S,fillOpacity:.8},t))]})},`${i}-${l}`)});return xa.jsxs("div",{ref:v,className:"automation-lanes",style:{position:"absolute",top:o-l*a-M*a,left:i,right:0,height:C,zIndex:5},onMouseMove:P,onMouseUp:_,onMouseLeave:_,children:[w.length>0&&A(w,M,0,.5,"prev",!1),A(x,t,M,1,"current",!0),k.length>0&&A(k,N,M+t,.5,"next",!1)]})},Kv=e.memo(({level:e,isActive:t})=>null);Kv.displayName="ChannelVUMeter";const $v=25,qv=(e,t,a=0)=>{if(!t)return{bg:"transparent",glow:"none"};const n=`hsl(${a}, ${180===a?100:75+10*e}%, ${180===a?45+15*e:40+20*e}%)`;return{bg:n,glow:`0 0 6px ${n}`}},Xv=s.memo(({channelWidth:e,scrollLeft:t=0})=>{const{patterns:a,currentPatternIndex:n}=tf(Da(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),r=Zg(e=>e.currentThemeId),i=Tg(e=>e.performanceQuality),o=a[n],l=o?.channels.length||4,c=s.useRef(null),u=s.useRef([]),d=s.useRef([]),p=s.useRef([]),h=s.useRef(null),m=s.useRef(200),f="cyan-lineart"===r?180:0;s.useEffect(()=>{p.current=Array(l).fill(null).map((e,t)=>({level:0,position:(t%2==0?-1:1)*$v*.5,direction:t%2==0?1:-1})),u.current=Array(l).fill(null),d.current=Array(l).fill(null).map(()=>Array(26).fill(null))},[l]),s.useEffect(()=>{const e=()=>{c.current&&(m.current=c.current.clientHeight,u.current.forEach(e=>{e&&(e.style.height=m.current-4+"px")}))};e();const t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);const g=s.useCallback(()=>{const e=Km().getChannelTriggerLevels(l);c.current&&(c.current.style.transform=`translateX(${-t}px)`);for(let t=0;t<l;t++){const a=p.current[t];if(!a)continue;const n=e[t]||0,s=.012*t;if(n>0)a.level=n;else{const e=.92-s;a.level=a.level*e,a.level<.01&&(a.level=0)}if(a.level>.02){const e=Math.abs(a.position)/$v,t=.8*(1-.7*Math.max(0,(e-.7)/.3));a.position+=t*a.direction,a.position>=$v?(a.position=$v,a.direction=-1):a.position<=-25&&(a.position=-25,a.direction=1)}const r=u.current[t];r&&(r.style.transform=`translateX(${a.position}px)`);const i=Math.round(26*a.level),o=d.current[t];if(o)for(let e=0;e<26;e++){const t=o[e];if(!t)continue;const a=e<i,n=e/25,{bg:s,glow:r}=qv(n,a,f);t.style.backgroundColor=s,t.style.boxShadow=r}}h.current=requestAnimationFrame(g)},[l,f,t]);if(s.useEffect(()=>{if("low"!==i)return h.current=requestAnimationFrame(g),()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)};h.current&&(cancelAnimationFrame(h.current),h.current=null)},[g,i]),"low"===i)return null;const y=e||260;return xa.jsx("div",{ref:c,className:"vu-meters-overlay",children:Array(l).fill(0).map((t,a)=>{const n=(t=>{if(e)return t*y+y/2;if(!o)return t*y+y/2;let a=0;for(let e=0;e<t;e++){const t=o.channels[e]?.collapsed;a+=t?60:y}return a+(o.channels[t]?.collapsed?60:y)/2})(a);return xa.jsx("div",{ref:e=>{u.current[a]=e},className:"vu-meter-vertical",style:{left:n-14+"px",width:"28px",height:m.current-4+"px",display:"flex",flexDirection:"column-reverse",alignItems:"stretch",gap:"4px"},children:Array.from({length:26},(e,t)=>xa.jsx("div",{ref:e=>{d.current[a]||(d.current[a]=[]),d.current[a][t]=e},style:{height:"4px",backgroundColor:"transparent",borderRadius:"1px"}},t))},a)})})});Xv.displayName="ChannelVUMeters";var Yv=l();const Qv=({currentColor:e,onColorSelect:t})=>{const[a,n]=s.useState(!1),[r,i]=s.useState({top:0,left:0}),o=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{if(a&&o.current){const e=o.current.getBoundingClientRect();i({top:e.bottom+4,left:e.left})}},[a]),s.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&o.current&&!o.current.contains(e.target)&&n(!1)};if(a)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(!1)};if(a)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);const c=a?xa.jsxs("div",{ref:l,className:"fixed bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-2 animate-fade-in",style:{top:r.top,left:r.left,zIndex:9999,minWidth:"140px"},children:[xa.jsx("div",{className:"text-xs text-text-muted mb-2 px-1",children:"Channel Color"}),xa.jsx("div",{className:"grid grid-cols-4 gap-1",children:en.map((a,s)=>xa.jsx("button",{type:"button",onClick:e=>((e,a)=>{a.stopPropagation(),t(e),n(!1)})(a,e),className:"w-7 h-7 rounded border-2 transition-all flex items-center justify-center "+(e===a?"border-accent-primary scale-110":"border-transparent hover:border-dark-borderLight hover:scale-105"),style:{backgroundColor:a||"transparent"},title:a||"No color",children:null===a&&xa.jsx(Ee,{size:14,className:"text-text-muted"})},s))})]}):null;return xa.jsxs(xa.Fragment,{children:[xa.jsx("button",{ref:o,type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),n(!a)},className:"p-1 rounded transition-colors "+(e?"text-text-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),style:e?{color:e}:void 0,title:"Channel Color",children:xa.jsx(qe,{size:12})}),c&&Yv.createPortal(c,document.body)]})},Zv=({items:e,position:t,onClose:a,className:n=""})=>{const r=s.useRef(null),[i,o]=s.useState(t),[l,c]=s.useState(null),[u,d]=s.useState(null),p=s.useRef(null);s.useEffect(()=>{if(!t||!r.current)return;const e=r.current.getBoundingClientRect(),a=window.innerWidth,n=window.innerHeight;let s=t.x,i=t.y;s+e.width>a-10&&(s=a-e.width-10),s<10&&(s=10),i+e.height>n-10&&(i=n-e.height-10),i<10&&(i=10),o({x:s,y:i})},[t]),s.useEffect(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&a()},t=e=>{"Escape"===e.key&&a()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),p.current&&clearTimeout(p.current)}},[a]);const h=s.useCallback((e,t)=>{p.current&&(clearTimeout(p.current),p.current=null);const a=t.getBoundingClientRect();c(e),d({x:a.right-2,y:a.top-4})},[]),m=s.useCallback(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(null),d(null)},300)},[]),f=s.useCallback(()=>{p.current&&(clearTimeout(p.current),p.current=null)},[]);return t?Yv.createPortal(xa.jsx("div",{ref:r,className:`\n        fixed z-[100] min-w-[180px] py-1\n        bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl\n        ${n}\n      `,style:{left:i?.x??t.x,top:i?.y??t.y},onMouseEnter:f,children:0===e.length?xa.jsx("div",{className:"px-4 py-2 text-xs text-text-muted italic",children:"Empty"}):e.map((e,t)=>{if(!e)return null;if("divider"===e.type)return xa.jsx("div",{className:"h-px bg-dark-border my-1 mx-2"},`divider-${t}`);const n=e.submenu&&e.submenu.length>0;return xa.jsxs("div",{className:`\n                flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer transition-colors\n                ${e.disabled?"opacity-50 cursor-not-allowed":"hover:bg-dark-bgHover"}\n                ${e.danger?"text-accent-error hover:bg-accent-error/10":"text-text-secondary"}\n                ${l===e.id?"bg-dark-bgHover":""}\n              `,onClick:()=>{e.disabled||n||(e.onClick?.(),a())},onMouseEnter:t=>{n?h(e.id,t.currentTarget):(c(null),d(null))},onMouseLeave:()=>{n&&m()},children:[void 0!==e.checked&&xa.jsx("span",{className:"w-4 flex justify-center",children:e.radio?e.checked?xa.jsx(Ye,{size:8,className:"fill-accent-primary text-accent-primary"}):null:e.checked?xa.jsx(Fe,{size:14,className:"text-accent-primary"}):null}),e.icon&&xa.jsx("span",{className:"w-4 flex justify-center",children:e.icon}),xa.jsx("span",{className:"flex-1",children:e.label}),e.shortcut&&xa.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.shortcut}),n&&xa.jsx(De,{size:14,className:"text-text-muted"}),n&&l===e.id&&u&&xa.jsx(Jv,{items:e.submenu,position:u,onClose:a})]},e.id)})}),document.body):null},Jv=e=>xa.jsx(Zv,{...e}),ex=()=>{const[e,t]=s.useState(null);return{position:e,open:s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY})},[]),close:s.useCallback(()=>{t(null)},[]),isOpen:null!==e}},tx=({items:e,children:t,className:a="",disabled:n=!1})=>{const r=s.useRef(null),[i,o]=s.useState(!1),[l,c]=s.useState(null),u=s.useCallback(()=>{if(!n&&r.current){const e=r.current.getBoundingClientRect();c({x:e.left,y:e.bottom+4}),o(!0)}},[n]),d=s.useCallback(()=>{o(!1),c(null)},[]);return xa.jsxs(xa.Fragment,{children:[xa.jsx("button",{ref:r,onClick:u,disabled:n,className:a,children:t}),i&&l&&xa.jsx(Zv,{items:e,position:l,onClose:d})]})},ax=()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),nx=(e,t,a=64,n=!1)=>({note:e,instrument:t,volume:16+a,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:n?1:0});const sx={"4on4":{name:"4/4 Kicks",description:"Every 4 rows on beat",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[];for(let o=0;o<t;o++)if(o%4==0){const e=o%16==0;i.push(nx(n,a,s,r||e))}else i.push(ax());return i}},offbeat:{name:"Offbeat",description:"Every 4 rows, offset by 2",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56,accent:r}=e,i=[];for(let o=0;o<t;o++)(o+2)%4==0?i.push(nx(n,a,s,r)):i.push(ax());return i}},"8ths":{name:"8th Notes",description:"Every 2 rows",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56,accent:r}=e,i=[];for(let o=0;o<t;o++)if(o%2==0){const e=o%8==0;i.push(nx(n,a,e?s:s-8,r))}else i.push(ax());return i}},"16ths":{name:"16th Notes",description:"Every row",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=48,accent:r}=e,i=[];for(let o=0;o<t;o++){const e=o%4==0?s:o%2==0?s-8:s-16;i.push(nx(n,a,Math.max(16,e),r))}return i}},backbeat:{name:"Backbeat (2&4)",description:"Snare on beats 2 and 4",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[];for(let o=0;o<t;o++)o%16==4||o%16==12?i.push(nx(n,a,s,r)):i.push(ax());return i}},random:{name:"Random",description:"30% density random fill",category:"general",generate:e=>function(e,t=.3){const{patternLength:a,instrumentId:n,note:s,velocity:r=64,accent:i}=e,o=[];for(let l=0;l<a;l++)if(Math.random()<t){const e=Math.max(32,r-Math.floor(16*Math.random())),t=i||Math.random()<.25;o.push(nx(s,n,e,t))}else o.push(ax());return o}(e,.3)},build:{name:"Build",description:"Increasing density for transitions",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[],o=t/4;for(let l=0;l<t;l++){const e=Math.floor(l/o);let t;switch(e){case 0:t=8;break;case 1:default:t=4;break;case 2:t=2;break;case 3:t=1}if(l%t===0){const t=Math.min(64,s-16+8*e);i.push(nx(n,a,t,r))}else i.push(ax())}return i}},breakdown:{name:"Breakdown",description:"Sparse, minimal pattern",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=48,accent:r}=e,i=[];for(let o=0;o<t;o++)o%16==0?i.push(nx(n,a,s,r)):i.push(ax());return i}},syncopated:{name:"Syncopated",description:"Offbeat acid pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[],o=[0,3,8,11,14];for(let l=0;l<t;l++){const e=l%16;if(o.includes(e)){const t=3===e||11===e,o=nx(n,a,s,r);o.flag2=t?2:0,i.push(o)}else i.push(ax())}return i}},walking:{name:"Walking Bass",description:"Simple ascending pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56}=e,r=[],i=n||Un("C-4"),o=qn(i);if(null===o)return r;const l=e=>{const t=o+e;return t>=12&&t<=107?Xn(t):i},c=[0,5,7,5];for(let u=0;u<t;u++)if(u%4==0){const e=l(c[Math.floor(u/4)%c.length]);r.push(nx(e,a,s,!1))}else r.push(ax());return r}},hiHats:{name:"Hi-Hats",description:"Open/closed hat pattern",category:"drums",generate:function(e,t){const{patternLength:a,instrumentId:n,note:s,velocity:r=56,accent:i}=e,o=[],l=t||Un("A#3");for(let c=0;c<a;c++)if(c%2==0){const e=(c+4)%8==0,t=e?l:s,a=e?r:r-8;o.push(nx(t,n,a,i))}else o.push(ax());return o}},clear:{name:"Clear",description:"Remove all notes",category:"general",generate:e=>{return t=e.patternLength,Array(t).fill(null).map(()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));var t}}},rx=[{name:"Clean Master",description:"Subtle compression and EQ for polished output",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1,mid:0,high:.5}}]},{name:"Transparent",description:"Very light processing, preserves dynamics",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:2,attack:.02,release:.3}}]},{name:"Stereo Wide",description:"Clean stereo enhancement for wider soundstage",category:"Clean",effects:[{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:2.5,attack:.015,release:.25}}]},{name:"Club Ready",description:"Punchy compression with subs, ready for the dancefloor",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}]},{name:"Techno Master",description:"Hard compression and subs for driving techno",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:15,parameters:{distortion:.15}}]},{name:"Acid House",description:"Warm compression with subtle room reverb",category:"Club",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3.5,attack:.01,release:.2}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:1.5,preDelay:.01}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Deep House",description:"Smooth and warm with controlled dynamics",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:1,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2.5,attack:.02,release:.3}},{category:"tonejs",type:"Chorus",enabled:!0,wet:15,parameters:{frequency:.5,depth:.3}}]},{name:"Lo-Fi Crunch",description:"Bit-crushed and filtered for retro vibes",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:40,parameters:{bits:8}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:8e3,type:"lowpass",Q:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Tape Warmth",description:"Subtle saturation and filtering like vintage tape",category:"Lo-Fi",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.2}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:12e3,type:"lowpass",Q:.7}},{category:"tonejs",type:"Chorus",enabled:!0,wet:8,parameters:{frequency:.2,depth:.15}}]},{name:"VHS Vibe",description:"Wobbly and degraded like old VHS audio",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:25,parameters:{bits:12}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:30,parameters:{frequency:4,depth:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:15,parameters:{decay:1.2,preDelay:.02}}]},{name:"Ambient Space",description:"Lush reverb and delay for atmospheric soundscapes",category:"Ambient",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.4,feedback:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2,attack:.05,release:.4}}]},{name:"Dreamy Haze",description:"Soft and floaty with modulated delays",category:"Ambient",effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:35,parameters:{frequency:.3,depth:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:55,parameters:{decay:6,preDelay:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:5e3,type:"lowpass",Q:.5}}]},{name:"Cathedral",description:"Massive reverb for epic, cavernous sound",category:"Ambient",effects:[{category:"tonejs",type:"JCReverb",enabled:!0,wet:60,parameters:{roomSize:.9}},{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{delayTime:.25,feedback:.3}}]},{name:"Underwater",description:"Filtered and submerged atmospheric effect",category:"Ambient",effects:[{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:1200,type:"lowpass",Q:2}},{category:"tonejs",type:"Chorus",enabled:!0,wet:40,parameters:{frequency:.4,depth:.6}},{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:4,preDelay:.03}}]},{name:"Industrial",description:"Harsh distortion and compression for aggressive sound",category:"Aggressive",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:45,parameters:{distortion:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:2,high:4}}]},{name:"Crushed",description:"Heavy bit-crushing and distortion",category:"Aggressive",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:60,parameters:{bits:6}},{category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:10,attack:.001,release:.05}}]},{name:"Hardstyle",description:"Punchy kick-focused processing for hard dance",category:"Aggressive",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.002,release:.08}},{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.3}}]},{name:"Gabber",description:"Extreme compression and saturation for hardcore",category:"Aggressive",effects:[{category:"tonejs",type:"Chebyshev",enabled:!0,wet:50,parameters:{order:8}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-6,ratio:20,attack:5e-4,release:.03}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:0,high:5}}]},{name:"Dub Station",description:"Space Echo and Bi-Phase for authentic dub vibes",category:"Dub",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:40,parameters:{mode:4,rate:300,intensity:.6,echoVolume:.8,reverbVolume:.2}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0}}]},{name:"Sound System",description:"Heavy subs and performance filtering",category:"Dub",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:-2,high:1}},{category:"tonejs",type:"DubFilter",enabled:!0,wet:100,parameters:{cutoff:20,resonance:15,gain:1.2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Reggae",description:"Dotted-eighth skank echo with warm bass  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:25,parameters:{mode:4,rate:375,intensity:.4,echoVolume:.7,reverbVolume:.15,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:0,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.25}}]},{name:"Dub",description:"Heavy quarter-note echo with phaser swirl  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:45,parameters:{mode:4,rate:500,intensity:.7,echoVolume:.85,reverbVolume:.2,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0,bpmSync:1,syncDivision:"1/2"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:25,parameters:{decay:3,preDelay:.03}}]},{name:"Techno",description:"Driving eighth-note delay with hard compression  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{time:.25,feedback:.35,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:12,parameters:{distortion:.15}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}}]},{name:"House",description:"Ping-pong delay and chorus groove  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:18,parameters:{time:.25,feedback:.4,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:20,parameters:{frequency:1,depth:.4,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3.5,attack:.008,release:.18}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Ambient",description:"Long reverb with dotted-quarter ping-pong  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:6,preDelay:.06}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{time:.375,feedback:.5,bpmSync:1,syncDivision:"1/4d"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.25,depth:.5,bpmSync:1,syncDivision:"1/1"}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}}]},{name:"Lo-Fi Hip Hop",description:"Lazy swing delay with vinyl crunch  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:20,parameters:{bits:10}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:7e3,type:"lowpass",Q:.8}},{category:"tonejs",type:"Delay",enabled:!0,wet:22,parameters:{time:.375,feedback:.3,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:15,parameters:{frequency:4,depth:.06}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.015,release:.25}}]},{name:"Drum & Bass",description:"Tight sixteenth-note delay with sub boost  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:5,attack:.002,release:.08}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:15,parameters:{time:.125,feedback:.3,bpmSync:1,syncDivision:"1/16"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:.8,preDelay:.01}}]}],ix=({channelIndex:e,channel:t,patternId:a,patternLength:n,onFillPattern:r,onClearChannel:i,onCopyChannel:o,onCutChannel:l,onPasteChannel:c,onTranspose:u,onHumanize:d,onInterpolate:p,onAcidGenerator:h})=>{const{isLiveMode:m,queueChannelAction:f}=My(),{toggleChannelMute:g,toggleChannelSolo:y,removeChannel:b,setChannelColor:v,patterns:x}=tf(),{setActiveParameter:w,setShowLane:k,getShowLane:S,removeCurve:M,getCurvesForPattern:N}=Vg(),{updateInstrument:C}=Pg(),E=s.useCallback(a=>{const n=rx.find(e=>e.name===a);if(!n||!t.instrumentId)return;const s=n.effects.map((e,t)=>({...e,id:`channel-fx-${Date.now()}-${t}`}));C(t.instrumentId,{effects:s}),ty.success(`Applied ${n.name} to CH ${(e+1).toString().padStart(2,"0")}`)},[t.instrumentId,e,C]),P=S(e),_=N(a,e),T=_.length>0,A=[{id:"cutoff",label:"Cutoff",color:"#4f9d69"},{id:"resonance",label:"Resonance",color:"#3b82f6"},{id:"envMod",label:"Env Mod",color:"#f59e0b"},{id:"volume",label:"Volume",color:"#ef4444"},{id:"pan",label:"Pan",color:"#8b5cf6"},{id:"decay",label:"Decay",color:"#06b6d4"}],O=s.useMemo(()=>m?[{id:"trigger",label:"Trigger",icon:xa.jsx(Ae,{size:14}),submenu:[{id:"trigger-kicks",label:"4/4 Kicks",onClick:()=>{f(e,{type:"trigger",pattern:"kicks"}),r(e,"4on4")}},{id:"trigger-build",label:"Build",onClick:()=>{f(e,{type:"trigger",pattern:"build"}),r(e,"build")}},{id:"trigger-drop",label:"Drop",onClick:()=>{f(e,{type:"trigger",pattern:"drop"}),r(e,"16ths")}},{id:"trigger-breakdown",label:"Breakdown",onClick:()=>{f(e,{type:"trigger",pattern:"breakdown"}),r(e,"breakdown")}}]},{id:"stutter",label:"Stutter",icon:xa.jsx(Qe,{size:14}),onClick:()=>f(e,{type:"stutter"})},{id:"roll",label:"Roll",icon:xa.jsx(Pe,{size:14}),submenu:[{id:"roll-4",label:"1/4 Note",onClick:()=>f(e,{type:"roll",division:"1/4"})},{id:"roll-8",label:"1/8 Note",onClick:()=>f(e,{type:"roll",division:"1/8"})},{id:"roll-16",label:"1/16 Note",onClick:()=>f(e,{type:"roll",division:"1/16"})}]},{type:"divider"},{id:"automation",label:"Automation",icon:xa.jsx(Ze,{size:14}),submenu:[{id:"auto-sweep-up",label:"Filter Sweep Up",onClick:()=>f(e,{type:"filterSweep",direction:"up",bars:4})},{id:"auto-sweep-down",label:"Filter Sweep Down",onClick:()=>f(e,{type:"filterSweep",direction:"down",bars:4})},{id:"auto-fade-in",label:"Volume Fade In",onClick:()=>f(e,{type:"volumeFade",direction:"in",bars:4})},{id:"auto-fade-out",label:"Volume Fade Out",onClick:()=>f(e,{type:"volumeFade",direction:"out",bars:4})},{type:"divider"},{id:"auto-show-cutoff",label:"Show Cutoff",onClick:()=>{w(e,"cutoff"),k(e,!0)}},{id:"auto-show-volume",label:"Show Volume",onClick:()=>{w(e,"volume"),k(e,!0)}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?xa.jsx(Je,{size:14}):xa.jsx(et,{size:14}),checked:t.muted,onClick:()=>g(e)},{id:"solo",label:"Solo",icon:xa.jsx(tt,{size:14}),checked:t.solo,onClick:()=>y(e)},{id:"kill",label:"Kill",icon:xa.jsx(Ae,{size:14}),danger:!0,onClick:()=>{f(e,{type:"kill"}),g(e)}}]:[{id:"fill",label:"Fill",icon:xa.jsx(Te,{size:14}),submenu:[{id:"fill-4on4",label:sx["4on4"].name,onClick:()=>r(e,"4on4")},{id:"fill-offbeat",label:sx.offbeat.name,onClick:()=>r(e,"offbeat")},{id:"fill-backbeat",label:sx.backbeat.name,onClick:()=>r(e,"backbeat")},{id:"fill-hihats",label:sx.hiHats.name,onClick:()=>r(e,"hiHats")},{type:"divider"},{id:"fill-8ths",label:sx["8ths"].name,onClick:()=>r(e,"8ths")},{id:"fill-16ths",label:sx["16ths"].name,onClick:()=>r(e,"16ths")},{id:"fill-random",label:sx.random.name,onClick:()=>r(e,"random")},{id:"fill-acid",label:" Acid Generator...",icon:xa.jsx(at,{size:14}),onClick:()=>h(e)},{type:"divider"},{id:"fill-syncopated",label:sx.syncopated.name,onClick:()=>r(e,"syncopated")},{id:"fill-walking",label:sx.walking.name,onClick:()=>r(e,"walking")},{type:"divider"},{id:"fill-build",label:sx.build.name,onClick:()=>r(e,"build")},{id:"fill-breakdown",label:sx.breakdown.name,onClick:()=>r(e,"breakdown")}]},{id:"clear",label:"Clear Channel",icon:xa.jsx(Re,{size:14}),onClick:()=>i(e)},{id:"copy",label:"Copy Track",icon:xa.jsx(Ke,{size:14}),onClick:()=>o(e)},{id:"cut",label:"Cut Track",icon:xa.jsx(nt,{size:14}),onClick:()=>l(e)},{id:"paste",label:"Paste Track",icon:xa.jsx(st,{size:14}),onClick:()=>c(e)},{type:"divider"},{id:"fx-presets",label:"FX Presets",icon:xa.jsx(rt,{size:14}),submenu:(()=>{const e={};return rx.forEach(t=>{const a=t.category||"General";e[a]||(e[a]=[]),e[a].push(t)}),Object.keys(e).sort().map(t=>({id:`fx-cat-${t.toLowerCase()}`,label:t,submenu:e[t].map(e=>({id:`fx-preset-${e.name.replace(/\s+/g,"-")}`,label:e.name,onClick:()=>E(e.name)}))}))})()},{type:"divider"},{id:"transpose",label:"Transpose",icon:xa.jsx(Ve,{size:14}),submenu:[{id:"transpose-12",label:"+12 (Octave Up)",onClick:()=>u(e,12)},{id:"transpose-7",label:"+7 (Fifth)",onClick:()=>u(e,7)},{id:"transpose-1",label:"+1 (Semitone)",onClick:()=>u(e,1)},{type:"divider"},{id:"transpose--1",label:"-1 (Semitone)",onClick:()=>u(e,-1)},{id:"transpose--7",label:"-7 (Fifth)",onClick:()=>u(e,-7)},{id:"transpose--12",label:"-12 (Octave Down)",onClick:()=>u(e,-12)}]},{id:"humanize",label:"Humanize",icon:xa.jsx(at,{size:14}),shortcut:"Ctrl+H",onClick:()=>d(e)},{id:"interpolate",label:"Interpolate",icon:xa.jsx(it,{size:14}),shortcut:"Ctrl+I",onClick:()=>p(e)},{type:"divider"},{id:"automation",label:"Automation",icon:xa.jsx(ct,{size:14}),submenu:[...A.map(t=>({id:`auto-${t.id}`,label:t.label,icon:xa.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),onClick:()=>{w(e,t.id),k(e,!0)}})),{type:"divider"},{id:"auto-toggle-lane",label:P?"Hide Lane":"Show Lane",icon:P?xa.jsx(ot,{size:14}):xa.jsx(lt,{size:14}),onClick:()=>k(e,!P)},{id:"auto-clear-all",label:"Clear All Automation",icon:xa.jsx(Re,{size:14}),danger:!0,disabled:!T,onClick:()=>{_.forEach(e=>M(e.id))}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?xa.jsx(Je,{size:14}):xa.jsx(et,{size:14}),checked:t.muted,onClick:()=>g(e)},{id:"solo",label:"Solo",icon:xa.jsx(tt,{size:14}),checked:t.solo,onClick:()=>y(e)},{id:"color",label:"Color",icon:xa.jsx(qe,{size:14}),submenu:en.map((a,n)=>({id:`color-${n}`,label:null===a?"None":"",icon:a?xa.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:a}}):xa.jsx("span",{className:"w-4 h-4 rounded border border-dark-border"}),checked:t.color===a,onClick:()=>v(e,a)}))},{id:"delete",label:"Delete Channel",icon:xa.jsx(ut,{size:14}),danger:!0,disabled:x[0]?.channels.length<=1,onClick:()=>b(e)}],[m,e,t,P,T,_,x,r,i,o,l,c,u,d,p,h,g,y,b,v,f,w,k,M,E]);return xa.jsx(tx,{items:O,className:`\n        p-1 rounded transition-colors\n        ${m?"text-accent-error hover:bg-accent-error/20":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"}\n      `,children:xa.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[xa.jsx("circle",{cx:"12",cy:"12",r:"1"}),xa.jsx("circle",{cx:"12",cy:"5",r:"1"}),xa.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})},ox=({position:e,onClose:t,rowIndex:a,channelIndex:n,onInterpolate:r,onHumanize:i,onStrum:o,onLegato:l,onOpenParameterEditor:c})=>{const{patterns:u,currentPatternIndex:d,setCell:p,cursor:h,selectColumn:m,selectChannel:f}=tf(),g=u[d],y=s.useCallback(()=>{if(!g)return;const e=g.channels[n].rows[a];localStorage.setItem("devilbox-cell-clipboard",JSON.stringify(e))},[g,n,a]),b=s.useCallback(()=>{y(),p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[y,p,n,a]),v=s.useCallback(()=>{const e=localStorage.getItem("devilbox-cell-clipboard");if(e)try{const t=JSON.parse(e);p(n,a,t)}catch(t){}},[p,n,a]),x=s.useCallback(()=>{p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[p,n,a]),w=s.useCallback(()=>{if(g){for(let e=g.length-1;e>a;e--){const t=g.channels[n].rows[e-1];p(n,e,t)}p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[g,n,a,p]),k=s.useCallback(()=>{if(g){for(let e=a;e<g.length-1;e++){const t=g.channels[n].rows[e+1];p(n,e,t)}p(n,g.length-1,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[g,n,a,p]),S=s.useCallback(()=>{m(n,h.columnType),t()},[n,h.columnType,m,t]),M=s.useCallback(()=>{f(n),t()},[n,f,t]),N=s.useMemo(()=>[{id:"cut",label:"Cut",icon:xa.jsx(nt,{size:14}),shortcut:"Ctrl+X",onClick:b},{id:"copy",label:"Copy",icon:xa.jsx(Ke,{size:14}),shortcut:"Ctrl+C",onClick:y},{id:"paste",label:"Paste",icon:xa.jsx(st,{size:14}),shortcut:"Ctrl+V",onClick:v},{id:"clear",label:"Clear",icon:xa.jsx(Re,{size:14}),shortcut:"Del",onClick:x},{type:"divider"},{id:"insert-row",label:"Insert Row",icon:xa.jsx(dt,{size:14}),shortcut:"Ins",onClick:w},{id:"delete-row",label:"Delete Row",icon:xa.jsx(pt,{size:14}),shortcut:"Backspace",onClick:k},{type:"divider"},{id:"interpolate",label:"Interpolate",icon:xa.jsx(it,{size:14}),shortcut:"Ctrl+I",onClick:r},{id:"humanize",label:"Humanize",icon:xa.jsx(at,{size:14}),shortcut:"Ctrl+H",onClick:i},{id:"strum",label:"Strum/Arpeggiate",icon:xa.jsx(Te,{size:14}),onClick:o},{id:"legato",label:"Legato (Connect Notes)",icon:xa.jsx(ht,{size:14}),onClick:l},{type:"divider"},{id:"param-editor",label:"Visual Parameter Editor",icon:xa.jsx(mt,{size:14}),submenu:[{id:"param-volume",label:"Edit Volume...",onClick:()=>c?.("volume")},{id:"param-effect",label:"Edit Effect Type...",onClick:()=>c?.("effect")},{id:"param-effectparam",label:"Edit Effect Parameter...",onClick:()=>c?.("effectParam")}]},{type:"divider"},{id:"select-column",label:"Select Column",icon:xa.jsx(ft,{size:14}),onClick:S},{id:"select-channel",label:"Select Channel",icon:xa.jsx(gt,{size:14}),onClick:M}],[b,y,v,x,w,k,r,i,o,l,c,S,M]);return e?xa.jsx(Zv,{items:N,position:e,onClose:t}):null},lx={volume:{label:"Volume",min:0,max:64,default:64,color:"#22c55e",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effectParam:{label:"Effect Parameter",min:0,max:255,default:0,color:"#f59e0b",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effect:{label:"Effect Type",min:0,max:35,default:0,color:"#8b5cf6",format:e=>e<10?e.toString():String.fromCharCode(55+e)},note:{label:"Note",min:0,max:119,default:48,color:"#3b82f6",format:e=>{const t=Math.floor(e/12);return`${["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"][e%12]}${t}`}},instrument:{label:"Instrument",min:0,max:99,default:1,color:"#ec4899",format:e=>e.toString().padStart(2,"0")}},cx=({onClose:e,channelIndex:t,startRow:a,endRow:n,field:r})=>{const i=s.useRef(null),o=s.useRef(null),[l,c]=s.useState(!1),[u,d]=s.useState("overwrite"),[p,h]=s.useState([]),[m,f]=s.useState(null),g=Tg(e=>e.useHexNumbers),y=tf(e=>e.patterns),b=tf(e=>e.currentPatternIndex),v=tf(e=>e.setCell),x=lx[r],w=n-a+1,k=12,S=20,M=Math.max(400,14*w+40),N=200;s.useEffect(()=>{const e=y[b];if(!e)return;const s=e.channels[t];if(!s)return;const i=[];for(let t=a;t<=n;t++){const e=s.rows[t];if(!e){i.push(x.default);continue}let a=x.default;switch(r){case"volume":a=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(a=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(a=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(a=e.note);break;case"instrument":a=e.instrument??x.default}i.push(a)}h(i)},[y,b,t,a,n,r,x.default]);const C=s.useCallback(()=>{const e=i.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#1a1a2e",t.fillRect(0,0,M,N),t.strokeStyle="#2a2a4a",t.lineWidth=1;for(let a=0;a<=4;a++){const e=S+a/4*160;t.beginPath(),t.moveTo(S,e),t.lineTo(M-S,e),t.stroke();const n=Math.round(x.max-(x.max-x.min)*(a/4));t.fillStyle="#666",t.font="10px monospace",t.textAlign="right",t.fillText(x.format(n),16,e+3)}(m||p).forEach((e,n)=>{const s=S+14*n,r=160*((e-x.min)/(x.max-x.min)),i=180-r,o=t.createLinearGradient(s,i,s,180);o.addColorStop(0,x.color),o.addColorStop(1,x.color+"40"),t.fillStyle=o,t.fillRect(s,i,k,r),t.strokeStyle=x.color,t.lineWidth=1,t.strokeRect(s,i,k,r),(a+n)%4==0&&(t.fillStyle="#888",t.font="9px monospace",t.textAlign="center",t.fillText(g?(a+n).toString(16).toUpperCase().padStart(2,"0"):(a+n).toString().padStart(2,"0"),s+6,196))})},[p,m,M,N,x,a,g]);s.useEffect(()=>{C()},[C]);const E=s.useCallback(e=>{const t=i.current;if(!t)return null;const a=t.getBoundingClientRect(),n=e.clientX-a.left,s=e.clientY-a.top,r=Math.floor((n-S)/14);if(r<0||r>=w)return null;const o=1-(s-S)/160,l=Math.round(x.min+o*(x.max-x.min));return{rowIndex:r,value:Math.max(x.min,Math.min(x.max,l))}},[w,x,N]),P=s.useCallback((e,t,a)=>{h(n=>{const s=[...n],r=s[e];switch(a){case"overwrite":s[e]=t;break;case"fill_blanks":0!==r&&r!==x.default||(s[e]=t);break;case"add":s[e]=Math.max(x.min,Math.min(x.max,r+(t-x.max/2)));break;case"scale":const a=t/x.max;s[e]=Math.round(r*a)}return s})},[x]),_=s.useCallback(e=>{const t=E(e);if(t){if(2===e.button)return e.preventDefault(),void P(t.rowIndex,t.value,"overwrite");c(!0),P(t.rowIndex,t.value,u)}},[E,P,u]),T=s.useCallback(e=>{if(!l){const t=E(e);return void(t&&f(()=>{const e=[...p];return e[t.rowIndex]=t.value,e}))}const t=E(e);t&&P(t.rowIndex,t.value,u)},[l,E,P,u,p]),A=s.useCallback(()=>{c(!1)},[]),O=s.useCallback(()=>{c(!1),f(null)},[]),I=s.useCallback(e=>{e.preventDefault()},[]),D=s.useCallback(()=>{p.forEach((e,n)=>{const s=a+n,i=y[b];if(!i)return;const o=i.channels[t]?.rows[s];if(!o)return;const l={};switch(r){case"volume":l.volume=e;break;case"effect":const t=o.effect||"000",a=t.length>=3?t.substring(1):"00";l.effect=x.format(e)+a;break;case"effectParam":const n=o.effect?.[0]||"0";l.effect=n+e.toString(16).toUpperCase().padStart(2,"0");break;case"note":l.note=e;break;case"instrument":l.instrument=e}v(t,s,l)}),e()},[p,a,y,b,t,r,x,v,e]),F=s.useCallback(e=>{const t=Array(w).fill(0).map((t,a)=>{const n=a/(w-1||1),s=x.max-x.min;switch(e){case"ramp_up":return Math.round(x.min+n*s);case"ramp_down":return Math.round(x.max-n*s);case"triangle":return Math.round(x.min+Math.abs(1-2*n)*s);case"random":return Math.round(x.min+Math.random()*s);case"sine":return Math.round(x.min+(Math.sin(n*Math.PI*2)+1)/2*s);default:return x.default}});h(t)},[w,x]),R=s.useCallback(()=>{if(p.length<2)return;const e=p[0],t=p[p.length-1],a=p.map((a,n)=>{const s=n/(p.length-1);return Math.round(e+(t-e)*s)});h(a)},[p]),j=s.useCallback(()=>{const e=y[b];if(!e)return;const s=e.channels[t];if(!s)return;const i=[];for(let t=a;t<=n;t++){const e=s.rows[t];let a=x.default;if(e)switch(r){case"volume":a=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(a=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(a=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(a=e.note);break;case"instrument":a=e.instrument??x.default}i.push(a)}h(i)},[y,b,t,a,n,r,x.default]);return xa.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:xa.jsxs("div",{ref:o,className:"bg-dark-bg border border-dark-border rounded-lg shadow-2xl max-w-[95vw] overflow-hidden",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-dark-bgSecondary border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsxs("h2",{className:"text-text-primary font-bold",children:[x.label," Editor"]}),xa.jsxs("span",{className:"text-xs text-text-secondary",children:["Channel ",t+1,", Rows ",a,"-",n]})]}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:e,children:xa.jsx(Ee,{size:18})})]}),xa.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-dark-bgSecondary/50 border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[xa.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Mode:"}),["overwrite","fill_blanks","add","scale"].map(e=>xa.jsx("button",{onClick:()=>d(e),className:"px-2 py-1 text-xs rounded "+(u===e?"bg-blue-600 text-white":"bg-dark-bg text-text-secondary hover:bg-dark-bgSecondary"),children:"fill_blanks"===e?"Fill Empty":e.charAt(0).toUpperCase()+e.slice(1)},e))]}),xa.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[xa.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Generate:"}),xa.jsx("button",{onClick:()=>F("ramp_up"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Up",children:""}),xa.jsx("button",{onClick:()=>F("ramp_down"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Down",children:""}),xa.jsx("button",{onClick:()=>F("triangle"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Triangle",children:""}),xa.jsx("button",{onClick:()=>F("sine"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Sine",children:""}),xa.jsx("button",{onClick:()=>F("random"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Random",children:"?"})]}),xa.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:R,title:"Interpolate between first and last",children:xa.jsx(Ve,{size:14})}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:j,title:"Reset to original",children:xa.jsx(yt,{size:14})})]})]}),xa.jsx("div",{className:"p-4 overflow-x-auto",children:xa.jsx("canvas",{ref:i,width:M,height:N,onMouseDown:_,onMouseMove:T,onMouseUp:A,onMouseLeave:O,onContextMenu:I,className:"cursor-crosshair border border-dark-border rounded",style:{minWidth:M}})}),xa.jsxs("div",{className:"px-4 py-2 text-xs text-text-secondary bg-dark-bgSecondary/30 border-t border-dark-border",children:[xa.jsx("span",{className:"font-medium",children:"Tips:"})," Click + drag to paint values. Right-click for single-row precision."]}),xa.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 bg-dark-bgSecondary border-t border-dark-border",children:[xa.jsx(Dv,{variant:"ghost",onClick:e,children:"Cancel"}),xa.jsxs(Dv,{variant:"primary",onClick:D,children:[xa.jsx(at,{size:14,className:"mr-1"}),"Apply"]})]})]})})},ux=640,dx=1024;function px(){const[e,t]=s.useState(()=>"undefined"!=typeof window?window.innerWidth:1024);return s.useEffect(()=>{if("undefined"==typeof window)return;let e;t(window.innerWidth);const a=()=>{clearTimeout(e),e=setTimeout(()=>{t(window.innerWidth)},100)};return window.addEventListener("resize",a),window.addEventListener("orientationchange",a),()=>{clearTimeout(e),window.removeEventListener("resize",a),window.removeEventListener("orientationchange",a)}},[]),s.useMemo(()=>{const t=function(e){return e<ux?"mobile":e<dx?"tablet":"desktop"}(e);return{breakpoint:t,isMobile:"mobile"===t,isTablet:"tablet"===t,isDesktop:"desktop"===t,width:e}},[e])}const hx=s.createContext(null);function mx({children:e}){const t={...px(),isTouch:function(){const[e,t]=s.useState(!1);return s.useEffect(()=>{t("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),e}()};return xa.jsx(hx.Provider,{value:t,children:e})}const fx=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114],gx=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],yx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function bx(e){if(e<=0||e>96)return"C4";const t=e+11,a=Math.floor(t/12)-1;return`${yx[t%12]}${a}`}function vx(e){for(let t=0;t<8;t++)for(let a=0;a<12;a++){const n=12*t+a;if(n<36&&fx[n]<=e)return`${gx[a].replace("-","")}${t+1}`}return"C4"}const xx=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];class wx{song=null;playing=!1;songPos=0;pattPos=0;currentTick=0;speed=6;bpm=125;globalVolume=64;pBreakPos=0;pBreakFlag=!1;posJumpFlag=!1;posJumpPos=0;patternDelay=0;channels=[];masterGain;stateQueue=[];lastDequeuedState=null;static MAX_STATE_QUEUE_SIZE=256;bufferCache=new Map;onRowChange=null;onSongEnd=null;onTickProcess=null;constructor(){this.masterGain=new p(1).toDestination()}loadSong(e){this.stop(),this.song=e,this.bufferCache.clear();for(const a of this.channels){for(const e of a.playerPool)try{e.dispose()}catch(t){}try{a.gainNode.dispose()}catch(t){}try{a.panNode.dispose()}catch(t){}}this.channels=[];for(let a=0;a<e.numChannels;a++)this.channels.push(this.createChannel(a,e.numChannels));this.songPos=0,this.pattPos=0,this.currentTick=0,this.speed=e.initialSpeed,this.bpm=e.initialBPM,this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0}createChannel(e,t){let a=0;a=4===t?0===e||3===e?-.7:.7:e%2==0?-.5:.5;const n=new ue(a),s=new p(1);s.connect(n),n.connect(this.masterGain);const r=[];for(let i=0;i<2;i++){const e=new oe;e.connect(s),r.push(e)}return{note:0,period:0,volume:64,panning:128,sampleNum:0,sampleOffset:0,finetune:0,portaSpeed:0,portaTarget:0,tonePortaSpeed:0,vibratoPos:0,vibratoCmd:0,tremoloPos:0,tremoloCmd:0,waveControl:0,retrigCount:0,retrigVolSlide:0,patternLoopRow:0,patternLoopCount:0,globalVolSlide:0,panSlide:0,macroPos:0,macroReleased:!1,macroPitchOffset:0,macroArpNote:0,macroDuty:0,macroWaveform:0,previousSlideFlag:!1,gateHigh:!1,lastPlayedNoteName:null,xmNote:0,player:null,playerPool:r,activePlayerIdx:0,gainNode:s,panNode:n,instrument:null}}scheduleAheadTime=.1;schedulerInterval=.015;nextScheduleTime=0;startTime=0;totalTicksScheduled=0;lastGrooveTemplateId="straight";lastSwingAmount=100;lastGrooveSteps=2;schedulerTimerId=null;async play(){if(!this.song||this.playing)return;await ge();const e=Km();await e.ensureWASMSynthsReady(this.song.instruments),this.playing=!0;const t=Rg.getState();this.lastGrooveTemplateId=t.grooveTemplateId,this.lastSwingAmount=t.swing,this.lastGrooveSteps=t.grooveSteps,this.startScheduler()}stop(){this.playing=!1,null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null);for(const e of this.channels)this.stopChannel(e);this.songPos=0,this.pattPos=0,this.currentTick=0,this.totalTicksScheduled=0,this.lastGrooveTemplateId="straight",this.lastSwingAmount=100,this.lastGrooveSteps=2,this.clearStateQueue()}pause(){null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1}resume(){this.song&&!this.playing&&(this.playing=!0,this.startScheduler())}startScheduler(){this.startTime=Q()+.02,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0;const e=()=>{if(!this.playing)return;const e=Q(),t=e+this.scheduleAheadTime,a=Rg.getState();(a.grooveTemplateId!==this.lastGrooveTemplateId||a.swing!==this.lastSwingAmount||a.grooveSteps!==this.lastGrooveSteps||Math.abs(a.bpm-this.bpm)>.1)&&(this.startTime=e+.01,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0,this.lastGrooveTemplateId=a.grooveTemplateId,this.lastSwingAmount=a.swing,this.lastGrooveSteps=a.grooveSteps,this.bpm=a.bpm,this.speed=a.speed);const n=2.5/this.bpm;for(;this.nextScheduleTime<t&&this.playing;)this.processTick(this.nextScheduleTime),this.totalTicksScheduled++,this.nextScheduleTime=this.startTime+this.totalTicksScheduled*n};e(),this.schedulerTimerId=setInterval(e,1e3*this.schedulerInterval)}calculateGrooveOffset(e,t,a){const n=Bn.find(e=>e.id===a.grooveTemplateId);if(n&&"straight"!==n.id){const s=a.swing/100,r=function(e,t,a){if(!e.values||0===e.values.length)return 0;const n=t%e.values.length;return e.values[n]/100*a}(n,e,t)*s;return r}{const n=(a.swing-100)/100,s=a.grooveSteps||2,r=e%s>=s/2;if(100!==a.swing&&r){return n*.3333*t}}return 0}processTick(e){if(!this.song||!this.playing)return;if(this.patternDelay>0)return void this.patternDelay--;const t=Rg.getState();t.bpm!==this.bpm&&(this.bpm=t.bpm);const a=2.5/this.bpm;let n=e;if(0===this.currentTick){const e=a*this.speed;n+=this.calculateGrooveOffset(this.pattPos,e,t)}if(t.jitter>0){const e=t.jitter/100*.01;n+=(2*Math.random()-1)*e}const s=this.song.songPositions[this.songPos],r=this.song.patterns[s];if(r){0===this.currentTick&&this.queueDisplayState(n,this.pattPos,s,this.songPos,0);for(let e=0;e<this.channels.length;e++){const t=this.channels[e],s=r.channels[e]?.rows[this.pattPos];s&&(0===this.currentTick?this.processRow(e,t,s,n):this.processEffectTick(e,t,s,n+this.currentTick*a),this.processMacros(t,n+this.currentTick*a))}this.onTickProcess&&this.onTickProcess(this.currentTick,this.pattPos),this.currentTick++,this.currentTick>=this.speed&&(this.currentTick=0,this.advanceRow())}}queueDisplayState(e,t,a,n,s){const r={time:e,row:t,pattern:a,position:n,tick:s};this.stateQueue.length>=wx.MAX_STATE_QUEUE_SIZE&&this.stateQueue.shift(),this.stateQueue.push(r)}getStateAtTime(e,t=!1){if(!this.playing)return this.lastDequeuedState;if(t){let t=this.lastDequeuedState;for(const a of this.stateQueue){if(!(a.time<=e))break;t=a}return t}let a=this.lastDequeuedState;for(;this.stateQueue.length>0;){if(!(this.stateQueue[0].time<=e))break;a=this.stateQueue.shift(),this.lastDequeuedState=a}return a}clearStateQueue(){this.stateQueue=[],this.lastDequeuedState=null}processRow(e,t,a,n){if(!this.song)return;const s=1===a.flag1||1===a.flag2,r=2===a.flag1||2===a.flag2,i=3===a.flag1||3===a.flag2,o=4===a.flag1||4===a.flag2;if(i){if(t.gainNode.gain.setValueAtTime(0,n),t.player){try{t.player.stop(n)}catch(b){}t.player=null}return}const l=a.effTyp??(a.effect?parseInt(a.effect[0],16):0),c=a.eff??(a.effect?parseInt(a.effect.substring(1),16):0),u=a.instrument??0;if(u>0){const e=this.song.instruments.find(e=>e.id===u);e&&(t.instrument=e,t.sampleNum=u,t.volume=64,t.finetune=e.metadata?.modPlayback?.finetune??0,t.gainNode.gain.setValueAtTime(t.volume/64,n))}const d=a.note,p=a.period,h=a.probability,m=void 0!==h&&h>0&&h<100&&100*Math.random()>=h,f=r||o;if(d&&0!==d&&97!==d&&!m){t.xmNote=d;const a=p||this.noteToPeriod(d,t.finetune);if(3===l||5===l)t.portaTarget=a,0!==c&&3===l&&(t.tonePortaSpeed=c);else{t.note=a,t.period=t.note;let r=0;9===l&&(r=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const i=t.previousSlideFlag&&null!==d&&!o,u="TB303"===t.instrument?.synthType||"Buzz3o3"===t.instrument?.synthType;if("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED&&u){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=d?d+11:0,a=Math.floor(t/12)-1;d&&e[t%12]}const p=u?bx(d):vx(a);i&&null!==t.lastPlayedNoteName&&t.lastPlayedNoteName;t.lastPlayedNoteName=p,this.triggerNote(t,n,r,e,s,i,f,o),4&t.waveControl||(t.vibratoPos=0),64&t.waveControl||(t.tremoloPos=0)}}if(d&&97!==d&&(t.previousSlideFlag=(r||o)??!1),97===d){t.previousSlideFlag=!1;"TB303"===t.instrument?.synthType||t.instrument;"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,this.releaseMacros(t),this.stopChannel(t),t.lastPlayedNoteName=null}void 0!==a.volume&&a.volume>=16&&a.volume<=80&&(t.volume=a.volume-16,t.gainNode.gain.setValueAtTime(t.volume/64,n)),this.processEffect0(e,t,l,c,n);const g=a.effTyp2??0,y=a.eff2??0;0===g&&0===y||this.processEffect0(e,t,g,y,n)}processEffect0(e,t,a,n,s){const r=n>>4&15,i=15&n;if(t.instrument?.synthType?.startsWith("Furnace")){const s=Km();11===a||13===a||15===a||(14===a?s.applyFurnaceExtendedEffect(t.instrument.id,r,i,e):s.applyFurnaceEffect(t.instrument.id,a,n,e))}switch(a){case 0:case 5:case 6:case 10:break;case 1:case 2:0!==n&&(t.portaSpeed=n);break;case 3:0!==n&&(t.tonePortaSpeed=n);break;case 4:0!==r&&(t.vibratoCmd=15&t.vibratoCmd|r<<4),0!==i&&(t.vibratoCmd=240&t.vibratoCmd|i);break;case 7:0!==r&&(t.tremoloCmd=15&t.tremoloCmd|r<<4),0!==i&&(t.tremoloCmd=240&t.tremoloCmd|i);break;case 8:t.panning=n,t.panNode.pan.setValueAtTime((n-128)/128,s);break;case 9:0!==n&&(t.sampleOffset=n);break;case 11:this.posJumpPos=n,this.posJumpFlag=!0,this.pBreakFlag=!0;break;case 12:t.volume=Math.min(64,n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 13:this.pBreakPos=10*r+i,this.pBreakPos>63&&(this.pBreakPos=0),this.pBreakFlag=!0;break;case 14:this.processExtendedEffect0(e,t,r,i,s);break;case 15:0===n||(n<32?this.speed!==n&&(this.speed=n,Rg.getState().setSpeed(n)):this.bpm!==n&&(this.bpm=n,Rg.getState().setBPM(n)));break;case 16:this.globalVolume=Math.min(64,n),this.updateAllChannelVolumes(s);break;case 17:0!==n&&(t.globalVolSlide=n);break;case 25:0!==n&&(t.panSlide=n);break;case 27:t.retrigCount=15&n,t.retrigVolSlide=n>>4&15}}processExtendedEffect0(e,t,a,n,s){switch(a){case 1:t.period=Math.max(113,t.period-n),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+n),this.updatePeriod(t);break;case 4:t.waveControl=240&t.waveControl|15&n;break;case 5:t.finetune=n>7?n-16:n;break;case 6:0===n?t.patternLoopRow=this.pattPos:(0===t.patternLoopCount?t.patternLoopCount=n:t.patternLoopCount--,0!==t.patternLoopCount&&(this.pBreakPos=t.patternLoopRow,this.pBreakFlag=!0));break;case 7:t.waveControl=15&t.waveControl|(15&n)<<4;break;case 9:t.retrigCount=n;break;case 10:t.volume=Math.min(64,t.volume+n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 11:t.volume=Math.max(0,t.volume-n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 14:this.patternDelay=n*this.speed}}processEffectTick(e,t,a,n){const s=1===a.flag1||1===a.flag2,r=2===a.flag1||2===a.flag2,i=3===a.flag1||3===a.flag2;if(4===a.flag1||a.flag2,i)return;const o=a.effTyp??(a.effect?parseInt(a.effect[0],16):0),l=a.eff??(a.effect?parseInt(a.effect.substring(1),16):0),c=l>>4&15,u=15&l,d=a.effTyp2??0,p=a.eff2??0;switch(0===d&&0===p||this.processEffectTickSingle(e,t,a,d,p,n),t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,o,l,c,u),o){case 0:0!==l&&this.doArpeggio(t,l);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,l,n);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,l,n);break;case 7:this.doTremolo(t,n);break;case 10:this.doVolumeSlide(t,l,n);break;case 14:if(9===c&&u>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=u,this.triggerNote(t,n,0,e,s,!1,!1));else if(12===c&&u===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,n);else if(13===c&&u===this.currentTick){const a=t.previousSlideFlag;this.triggerNote(t,n,0,e,s,a,r)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,n);break;case 25:this.doPanSlide(t,t.panSlide,n);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&l,this.applyRetrigVolSlide(t,t.retrigVolSlide,n),this.triggerNote(t,n,0,e,s,!1,!1)))}}processEffectTickSingle(e,t,a,n,s,r){const i=1===a.flag1||1===a.flag2,o=2===a.flag1||2===a.flag2,l=s>>4&15,c=15&s;switch(t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,n,s,l,c),n){case 0:0!==s&&this.doArpeggio(t,s);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,s,r);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,s,r);break;case 7:this.doTremolo(t,r);break;case 10:this.doVolumeSlide(t,s,r);break;case 14:if(9===l&&c>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=c,this.triggerNote(t,r,0,e,i,!1,!1));else if(12===l&&c===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,r);else if(13===l&&c===this.currentTick){const a=t.previousSlideFlag;this.triggerNote(t,r,0,e,i,a,o)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,r);break;case 25:this.doPanSlide(t,t.panSlide,r);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&s,this.applyRetrigVolSlide(t,t.retrigVolSlide,r),this.triggerNote(t,r,0,e,i,!1,!1)))}}forwardEffectToFurnace(e,t,a,n,s,r){if(11===a||13===a||15===a||0===a&&0===n)return;const i=Km();14===a?i.applyFurnaceExtendedEffect(e.instrument.id,s,r,t):i.applyFurnaceEffect(e.instrument.id,a,n,t)}doArpeggio(e,t){const a=t>>4&15,n=15&t,s=this.currentTick%3;let r=e.note;1===s?r=this.periodPlusSemitones(e.note,a,e.finetune):2===s&&(r=this.periodPlusSemitones(e.note,n,e.finetune)),this.updatePeriodDirect(e,r)}doTonePortamento(e){0!==e.portaTarget&&e.period!==e.portaTarget&&(e.period<e.portaTarget?(e.period+=e.tonePortaSpeed,e.period>e.portaTarget&&(e.period=e.portaTarget)):(e.period-=e.tonePortaSpeed,e.period<e.portaTarget&&(e.period=e.portaTarget)),this.updatePeriod(e))}doVibrato(e){const t=e.vibratoCmd>>4&15,a=15&e.vibratoCmd,n=3&e.waveControl;let s;0===n?s=xx[31&e.vibratoPos]:1===n?(s=8*(31&e.vibratoPos),e.vibratoPos>=32&&(s=255-s)):s=255;let r=s*a>>7;e.vibratoPos>=32&&(r=-r),this.updatePeriodDirect(e,e.period+r),e.vibratoPos=e.vibratoPos+t&63}doTremolo(e,t){const a=e.tremoloCmd>>4&15,n=15&e.tremoloCmd,s=e.waveControl>>4&3;let r;0===s?r=xx[31&e.tremoloPos]:1===s?(r=8*(31&e.tremoloPos),e.tremoloPos>=32&&(r=255-r)):r=255;let i=r*n>>6;e.tremoloPos>=32&&(i=-i);const o=Math.max(0,Math.min(64,e.volume+i));e.gainNode.gain.setValueAtTime(o/64,t),e.tremoloPos=e.tremoloPos+a&63}doVolumeSlide(e,t,a){const n=t>>4&15,s=15&t;n>0?e.volume=Math.min(64,e.volume+n):s>0&&(e.volume=Math.max(0,e.volume-s)),e.gainNode.gain.setValueAtTime(e.volume/64,a)}doGlobalVolumeSlide(e,t){const a=e>>4&15,n=15&e;a>0?this.globalVolume=Math.min(64,this.globalVolume+a):n>0&&(this.globalVolume=Math.max(0,this.globalVolume-n)),this.updateAllChannelVolumes(t)}doPanSlide(e,t,a){const n=t>>4&15,s=15&t;n>0?e.panning=Math.min(255,e.panning+n):s>0&&(e.panning=Math.max(0,e.panning-s)),e.panNode.pan.setValueAtTime((e.panning-128)/128,a)}applyRetrigVolSlide(e,t,a){switch(t){case 0:case 8:break;case 1:e.volume=Math.max(0,e.volume-1);break;case 2:e.volume=Math.max(0,e.volume-2);break;case 3:e.volume=Math.max(0,e.volume-4);break;case 4:e.volume=Math.max(0,e.volume-8);break;case 5:e.volume=Math.max(0,e.volume-16);break;case 6:e.volume=Math.floor(2*e.volume/3);break;case 7:e.volume=Math.floor(e.volume/2);break;case 9:e.volume=Math.min(64,e.volume+1);break;case 10:e.volume=Math.min(64,e.volume+2);break;case 11:e.volume=Math.min(64,e.volume+4);break;case 12:e.volume=Math.min(64,e.volume+8);break;case 13:e.volume=Math.min(64,e.volume+16);break;case 14:e.volume=Math.min(64,Math.floor(3*e.volume/2));break;case 15:e.volume=Math.min(64,2*e.volume)}e.gainNode.gain.setValueAtTime(e.volume/64,a)}processMacros(e,t){if(!e.instrument?.furnace?.macros)return;const a=e.instrument.furnace.macros;if(0!==a.length){for(const n of a){if(!n.data||0===n.data.length)continue;let a=e.macroPos;const s=n.speed||1;if(this.currentTick%s!==0)continue;e.macroReleased&&n.release>=0&&a<n.release&&(a=n.release),a>=n.data.length&&(a=n.loop>=0&&n.loop<n.data.length?e.macroReleased&&n.release>=0&&n.loop<n.release?n.data.length-1:n.loop:n.data.length-1);const r=n.data[a]??0;this.applyMacroValue(e,n.type,r,t)}e.macroPos++}}applyMacroValue(e,t,a,n){switch(t){case wn.VOL:e.volume=Math.round(a/15*64),e.gainNode.gain.setValueAtTime(e.volume/64*(this.globalVolume/64),n);break;case wn.ARP:if(e.macroArpNote=a>127?a-256:a,e.period>0){const t=Math.pow(2,e.macroArpNote/12),a=Math.round(e.note/t);this.updatePeriodDirect(e,a)}break;case wn.DUTY:e.macroDuty=a;break;case wn.WAVE:e.macroWaveform=a;break;case wn.PITCH:if(e.macroPitchOffset=a>127?a-256:a,e.period>0){const t=e.macroPitchOffset/64,a=Math.round(e.period*(1-.01*t));this.updatePeriodDirect(e,Math.max(113,Math.min(856,a)))}break;case wn.EX1:case wn.EX2:case wn.EX3:case wn.EX4:case wn.EX5:case wn.EX6:case wn.EX7:case wn.EX8:case wn.ALG:case wn.FB:case wn.FMS:case wn.AMS:break;case wn.PAN_L:e.panning=Math.max(0,128-8*a),e.panNode.pan.setValueAtTime((e.panning-128)/128,n);break;case wn.PAN_R:e.panning=Math.min(255,128+8*a),e.panNode.pan.setValueAtTime((e.panning-128)/128,n)}}releaseMacros(e){e.macroReleased=!0}triggerNote(e,t,a,n,s,r,i,o){if(void 0!==n){if(Km().isChannelMuted(n))return}const l=t??Q();if(e.player)try{e.player.stop(l)}catch(E){}if(e.macroPos=0,e.macroReleased=!1,e.macroPitchOffset=0,e.macroArpNote=0,!e.instrument){if(!(this.song&&this.song.instruments.length>0))return;e.instrument=this.song.instruments[0],e.sampleNum=this.song.instruments[0].id,e.volume=64,e.finetune=e.instrument.metadata?.modPlayback?.finetune??0}const c=Km(),u=e.instrument.synthType&&"Sampler"!==e.instrument.synthType&&e.xmNote>0&&e.xmNote<97?bx(e.xmNote):vx(e.period),d=Rg.getState(),p=d.grooveTemplateId,h=Bn.find(e=>e.id===p),m=d.swing/100;let f=0;h&&(f=function(e,t){if(!e.velocityOffsets||0===e.velocityOffsets.length)return 0;const a=t%e.velocityOffsets.length;return e.velocityOffsets[a]}(h,this.pattPos)*m);const g=Math.max(0,Math.min(1,e.volume/64+f));if(100!==d.swing&&this.pattPos,void 0!==n&&Se.schedule(()=>{c.triggerChannelMeter(n,g)},l),e.instrument.synthType&&"Sampler"!==e.instrument.synthType){const t=2.5/this.bpm*this.speed,a=("TB303"===e.instrument.synthType||"Buzz3o3"===e.instrument.synthType)&&!i?.8*t:1.05*t;return void c.triggerNote(e.instrument.id,u,a,l,g,e.instrument,s,r,void 0,e.period,void 0,0,o)}const y=c.getDecodedBuffer(e.instrument.id);if(!y)return;const b=e.instrument.sample;if(!e.period||e.period<=0)return;const v=e.finetune,x=Math.pow(2,v/96),w=428/e.period*x;let k=this.bufferCache.get(e.instrument.id);k||(k=new xe(y),this.bufferCache.set(e.instrument.id,k));const S=(e.activePlayerIdx+1)%e.playerPool.length,M=e.playerPool[S];if(e.activePlayerIdx=S,"started"===M.state)try{M.stop(l)}catch(E){}M.buffer=k;const N=b?.sampleRate||8363,C=y.duration;b?.loop&&(b.loopEnd??0)>(b.loopStart??0)?(M.loop=!0,M.loopStart=Math.min((b.loopStart??0)/N,C-1e-4),M.loopEnd=Math.min((b.loopEnd??0)/N,C),M.loopEnd<=M.loopStart&&(M.loopEnd=C)):M.loop=!1,M.playbackRate=w,e.player=M;try{const e=a>0?a/N:0;M.start(l,Math.min(e,C-1e-4))}catch(E){}}stopChannel(e){for(const a of e.playerPool)try{"started"===a.state&&a.stop()}catch(t){}e.player=null,e.lastPlayedNoteName=null}updatePeriod(e){this.updatePeriodDirect(e,e.period)}updatePeriodDirect(e,t){if(!e.player||0===t)return;const a=e.instrument?.sample?.sampleRate||8363,n=3546895/t;e.player.playbackRate=n/a}updateAllChannelVolumes(e){const t=this.globalVolume/64;for(const a of this.channels){const n=a.volume/64*t;a.gainNode.gain.setValueAtTime(n,e)}}noteToPeriod(e,t){if("number"==typeof e&&e>0){if(e>=113&&e<=856)return e;if(e<97){let a=e-1,n=0;for(;a<12;)a+=12,n--;for(;a>47;)a-=12,n++;if(a-=12,a>=0&&a<36){let e=this.getPeriod(a,t);return n>0?e=Math.round(e/Math.pow(2,n)):n<0&&(e=Math.round(e*Math.pow(2,-n))),e}}}else if("string"==typeof e)return this.noteStringToPeriod(e,t);return 0}noteStringToPeriod(e,t){const a=e.match(/^([A-G][#]?)-?(\d)$/);if(!a)return 0;const n={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11}[a[1]]??0,s=12*(parseInt(a[2],10)-1)+n;return s<0||s>=36?0:this.getPeriod(s,t)}getPeriod(e,t){return fx[36*(t>=0?t:t+16)+Math.min(35,Math.max(0,e))]}periodPlusSemitones(e,t,a){const n=36*(a>=0?a:a+16);let s=0;for(let i=0;i<36;i++)if(fx[n+i]<=e){s=i;break}const r=Math.min(35,Math.max(0,s+t));return fx[n+r]}advanceRow(){if(!this.song)return;this.pBreakFlag?(this.pattPos=this.pBreakPos,this.pBreakFlag=!1,this.pBreakPos=0,this.posJumpFlag||this.songPos++):this.pattPos++,this.posJumpFlag&&(this.songPos=this.posJumpPos,this.posJumpFlag=!1);const e=this.song.songPositions[this.songPos],t=this.song.patterns[e],a=t?.length??64;if(this.pattPos>=a&&(this.pattPos=0,this.songPos++),this.songPos>=this.song.songLength&&(this.songPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0,this.onSongEnd?.()),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}}isPlaying(){return this.playing}getBPM(){return this.bpm}getSpeed(){return this.speed}getCurrentRow(){return this.pattPos}getCurrentPosition(){return this.songPos}getCurrentTick(){return this.currentTick}dispose(){this.stop();for(const t of this.channels){for(const a of t.playerPool)try{a.dispose()}catch(e){}t.gainNode.dispose(),t.panNode.dispose()}this.bufferCache.clear(),this.masterGain.dispose(),this.channels=[],this.song=null}}let kx=null;function Sx(){return kx||(kx=new wx),kx}const Mx=24,Nx=10,Cx=40,Ex=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Px(e){if(0===e)return"---";if(97===e)return"OFF";const t=(e-1)%12,a=Math.floor((e-1)/12);return`${Ex[t]}${a}`}function _x(e){return e.toString(16).toUpperCase().padStart(2,"0")}const Tx=e.memo(({onAcidGenerator:t})=>{const{isMobile:a}=s.useContext(hx)||{breakpoint:"desktop",isMobile:!1,isTablet:!1,isDesktop:!0,width:1024,isTouch:!1},n=s.useRef(null),r=s.useRef(null),i=s.useRef(null),[o,l]=s.useState({width:800,height:600}),[c,u]=s.useState(0),[d,p]=s.useState(0),[h,m]=s.useState(0),[f,g]=s.useState(0),y=s.useRef([]),b=s.useRef({}),v=s.useRef({}),x=s.useRef({}),w=s.useRef(null),{pattern:k,patterns:S,currentPatternIndex:M,addChannel:N,removeChannel:C,toggleChannelMute:E,toggleChannelSolo:P,setChannelColor:_,setCell:T,moveCursorToChannel:A,copyTrack:O,cutTrack:I,pasteTrack:D,mobileChannelIndex:F,cursor:R,selection:j,showGhostPatterns:L}=tf(Da(e=>({pattern:e.patterns[e.currentPatternIndex],patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,addChannel:e.addChannel,removeChannel:e.removeChannel,toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,setChannelColor:e.setChannelColor,setCell:e.setCell,moveCursorToChannel:e.moveCursorToChannel,copyTrack:e.copyTrack,cutTrack:e.cutTrack,pasteTrack:e.pasteTrack,mobileChannelIndex:e.cursor.channelIndex,cursor:e.cursor,selection:e.selection,showGhostPatterns:e.showGhostPatterns}))),{instruments:B}=Pg(Da(e=>({instruments:e.instruments}))),V=s.useRef(null),z=s.useRef(-1),U=s.useRef(0),G=Zg(e=>e.currentThemeId),W=s.useRef(G),H="cyan-lineart"===G,K=(()=>{const[t,a]=e.useState({position:null,rowIndex:0,channelIndex:0}),n=s.useCallback((e,t,n)=>{e.preventDefault(),e.stopPropagation(),a({position:{x:e.clientX,y:e.clientY},rowIndex:t,channelIndex:n})},[]),r=s.useCallback(()=>{a(e=>({...e,position:null}))},[]),i=s.useCallback(e=>{e.preventDefault()},[]);return{...t,openMenu:n,closeMenu:r,isOpen:null!==t.position,handleContextMenu:i,cellInfo:t.position?{rowIndex:t.rowIndex,channelIndex:t.channelIndex}:null}})(),[$,q]=s.useState(null),X=s.useCallback(e=>{if(!k)return;const t=K.cellInfo?.channelIndex??R.channelIndex,a=j?.startRow??R.rowIndex,n=j?.endRow??Math.min(R.rowIndex+15,k.length-1);q({isOpen:!0,field:e,channelIndex:t,startRow:a,endRow:n}),K.closeMenu()},[K,R,j,k]);s.useEffect(()=>{W.current!==G&&(b.current={},v.current={},x.current={},W.current=G)},[G]);const Y=s.useMemo(()=>({bg:"#0a0a0b",rowNormal:"#0d0d0e",rowHighlight:"#111113",centerLine:H?"rgba(0, 255, 255, 0.25)":"rgba(239, 68, 68, 0.25)",cursor:H?"#00ffff":"#ef4444",cursorBg:H?"rgba(0, 255, 255, 0.2)":"rgba(239, 68, 68, 0.2)",text:"#e0e0e0",textMuted:"#505050",textNote:"#909090",textNoteActive:"#ffffff",textInstrument:"#4ade80",textVolume:"#60a5fa",textEffect:"#f97316",border:"#252530",lineNumber:"#707070",lineNumberHighlight:"#f97316"}),[H]),Z=s.useCallback(()=>{if(!k||!a)return;const e=Math.min(k.channels.length-1,F+1);e!==F&&A(e)},[k,a,F,A]),J=s.useCallback(()=>{if(!k||!a)return;const e=Math.max(0,F-1);e!==F&&A(e)},[k,a,F,A]),ee=function({threshold:e=50,onSwipeLeft:t,onSwipeRight:a}){const n=s.useRef(null);return{onTouchStart:s.useCallback(e=>{const t=e.touches[0];n.current={startX:t.clientX,startY:t.clientY,startTime:Date.now()}},[]),onTouchEnd:s.useCallback(s=>{if(!n.current)return;const r=s.changedTouches[0],i=r.clientX-n.current.startX,o=r.clientY-n.current.startY,l=Date.now()-n.current.startTime;Math.abs(i)>e&&Math.abs(i)>1.5*Math.abs(o)&&l<500&&(i>0&&a?a():i<0&&t&&t()),n.current=null},[e,t,a]),onTouchCancel:s.useCallback(()=>{n.current=null},[])}}({threshold:50,onSwipeLeft:Z,onSwipeRight:J}),te=s.useCallback((e,t)=>{if(!k)return;const a=sx[t];if(!a)return;const n=k.channels[e].instrumentId??1;a.generate({patternLength:k.length,instrumentId:n,note:49,velocity:64}).forEach((t,a)=>{T(e,a,t)})},[k,T]),ae=s.useCallback(e=>{if(k){for(let t=0;t<k.length;t++)T(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0});Tg.getState().setStatusMessage("CHANNEL CLEARED")}},[k,T]),ne=s.useCallback(e=>{O(e)},[O]),se=s.useCallback(e=>{I(e)},[I]),re=s.useCallback(e=>{D(e)},[D]),ie=s.useCallback((e,t)=>{if(k){for(let a=0;a<k.length;a++){const n=k.channels[e].rows[a];if(n.note&&0!==n.note&&97!==n.note){let s=n.note+t;s=Math.max(1,Math.min(96,s)),T(e,a,{...n,note:s})}}Tg.getState().setStatusMessage(`TRANSPOSE ${t>0?"+":""}${t}`)}},[k,T]),oe=s.useCallback(e=>{if(k){for(let t=0;t<k.length;t++){const a=k.channels[e].rows[t];if(null!==a.volume&&a.volume>=16){const n=Math.floor(8*Math.random())-4,s=Math.max(16,Math.min(80,a.volume+n));T(e,t,{...a,volume:s})}}Tg.getState().setStatusMessage("HUMANIZED")}},[k,T]),le=s.useCallback(e=>{if(!k)return;const t=k.channels[e];if(!t)return;let a=-1,n=-1,s=0,r=0;for(let o=0;o<k.length;o++){const e=t.rows[o];null!==e.volume&&e.volume>=16&&e.volume<=80&&(-1===a&&(a=o,s=e.volume),n=o,r=e.volume)}if(-1===a||-1===n||n-a<2)return;const i=n-a;for(let o=a+1;o<n;o++){const n=(o-a)/i,l=Math.round(s+(r-s)*n),c=t.rows[o];T(e,o,{...c,volume:l})}Tg.getState().setStatusMessage("INTERPOLATED")},[k,T]);s.useEffect(()=>{k&&(y.current=k.channels.map(()=>({level:0,triggered:!1})))},[k?.channels.length]);const ce=s.useCallback((e,t=!1)=>{const a=`${e}-${t?"a":"n"}`;if(b.current[a])return b.current[a];const n=document.createElement("canvas");n.width=34,n.height=Mx;const s=n.getContext("2d");return s.font='14px "JetBrains Mono", "Fira Code", monospace',s.textBaseline="middle",s.fillStyle=0===e?Y.textMuted:97===e?Y.textEffect:t?Y.textNoteActive:Y.textNote,s.fillText(Px(e),0,12),b.current[a]=n,n},[Y.textMuted,Y.textEffect,Y.textNote,Y.textNoteActive]),ue=s.useCallback((e,t,a,n,s,r,i,o,l,c)=>{const u=`${e}-${t}-${a}-${n}-${s}-${r}-f1${i??"x"}-f2${o??"x"}-p${l??"x"}-${c?"B":""}`;if(v.current[u])return v.current[u];const d=void 0!==i||void 0!==o,p=void 0!==l&&l>0,h=document.createElement("canvas");h.width=116+(d?28:0)+(p?24:0),h.height=Mx;const m=h.getContext("2d");m.font='14px "JetBrains Mono", "Fira Code", monospace',m.textBaseline="middle";let f=0;const g=12;0!==e?(m.fillStyle=Y.textInstrument,m.fillText(_x(e),f,g)):c||(m.fillStyle=Y.textMuted,m.fillText("..",f,g)),f+=24;t>=16&&t<=80?(m.fillStyle=Y.textVolume,m.fillText(_x(t),f,g)):c||(m.fillStyle=Y.textMuted,m.fillText("..",f,g)),f+=24;0!==a||0!==n?(m.fillStyle=Y.textEffect,m.fillText(a.toString(16).toUpperCase()+_x(n),f,g)):c||(m.fillStyle=Y.textMuted,m.fillText("...",f,g)),f+=34;if(0!==s||0!==r?(m.fillStyle=Y.textEffect,m.fillText(s.toString(16).toUpperCase()+_x(r),f,g)):c||(m.fillStyle=Y.textMuted,m.fillText("...",f,g)),f+=34,d&&(1===i?(m.fillStyle="#f59e0b",m.fillText("A",f,g)):2===i?(m.fillStyle="#06b6d4",m.fillText("S",f,g)):3===i?(m.fillStyle="#facc15",m.fillText("M",f,g)):4===i?(m.fillStyle="#22d3ee",m.fillText("H",f,g)):c||(m.fillStyle=Y.textMuted,m.fillText(".",f,g)),f+=14,1===o?(m.fillStyle="#f59e0b",m.fillText("A",f,g)):2===o?(m.fillStyle="#06b6d4",m.fillText("S",f,g)):3===o?(m.fillStyle="#facc15",m.fillText("M",f,g)):4===o?(m.fillStyle="#22d3ee",m.fillText("H",f,g)):c||(m.fillStyle=Y.textMuted,m.fillText(".",f,g)),f+=14),p){const e=Math.min(99,Math.max(0,l)),t=e>=75?"#4ade80":e>=50?"#facc15":e>=25?"#fb923c":"#f87171";m.fillStyle=t,m.fillText(e.toString(10).padStart(2,"0"),f,g)}return v.current[u]=h,h},[Y.textMuted,Y.textInstrument,Y.textVolume,Y.textEffect]),de=s.useCallback((e,t)=>{const a=e%4==0,n=`${e}-${t}-${a}`;if(x.current[n])return x.current[n];const s=document.createElement("canvas");s.width=Cx,s.height=Mx;const r=s.getContext("2d");r.font=a?'bold 12px "JetBrains Mono", monospace':'12px "JetBrains Mono", monospace',r.textBaseline="middle",r.textAlign="center",r.fillStyle=a?Y.lineNumberHighlight:Y.lineNumber;const i=t?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return r.fillText(i,20,12),x.current[n]=s,s},[Y.lineNumber,Y.lineNumberHighlight]),pe=s.useCallback(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const a=tf.getState(),s=Rg.getState(),r=Tg.getState(),i=a.patterns[a.currentPatternIndex],l=s.smoothScrolling,u=a.showGhostPatterns;if(!i)return t.fillStyle=Y.bg,t.fillRect(0,0,o.width,o.height),t.fillStyle=Y.textMuted,t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",void t.fillText("No pattern loaded",o.width/2,o.height/2);const f=a.cursor,y=s.isPlaying,b=r.useHexNumbers,v=r.blankEmptyCells,x=s.speed,w=s.bpm,{width:k,height:N}=o,C=i.length;let E,P=0;if(y){const e=Sx(),t=Q()+.01,a=e.getStateAtTime(t);if(a){if(V.current=a,E=a.row,l){const n=e.getStateAtTime(t+.5,!0);let s;s=n&&n.row!==a.row?n.time-a.time:2.5/w*x;const r=t-a.time;P=Math.min(Math.max(r/s,0),1)*Mx}else P=0;z.current=E,U.current=P}else E=s.currentRow}else E=f.rowIndex,V.current=null,z.current=-1,U.current=0;const _=Math.ceil(N/Mx)+2,T=Math.floor(_/2),A=E-T,O=A+_,I=Math.floor(N/2)-12,D=I-T*Mx-P,F=i.channels.length;(Math.abs(D-d)>.5||A!==h)&&(p(D),m(A),g(e=>e+1));let R=!1,j=!1;for(const n of i.channels){if(R&&j)break;if(!R&&null!==n.instrumentId){const e=B.find(e=>e.id===n.instrumentId);"TB303"!==e?.synthType&&"Buzz3o3"!==e?.synthType||(R=!0)}const e=n.rows[0];e&&(void 0===e.flag1&&void 0===e.flag2||(R=!0),void 0!==e.probability&&(j=!0))}const L=34+(116+(R?28:0)+(j?24:0)+20+4)+20;t.fillStyle=Y.bg,t.fillRect(0,0,k,N);for(let n=h;n<O;n++){let e,a=!1,s=null;if(y)if(u&&n<0)if(M>0){if(s=S[M-1],e=s.length+n,e<0||e>=s.length)continue;a=!0}else{if(!(S.length>1))continue;if(s=S[S.length-1],e=s.length+n,e<0||e>=s.length)continue;a=!0}else if(u&&n>=C)if(M<S.length-1){if(s=S[M+1],e=n-C,e<0||e>=s.length)continue;a=!0}else{if(!(S.length>1))continue;if(s=S[0],e=n-C,e<0||e>=s.length)continue;a=!0}else{if(n<0||n>=C)continue;e=n}else if(u&&n<0)if(M>0){if(s=S[M-1],e=s.length+n,e<0||e>=s.length)continue;a=!0}else{if(!(S.length>1))continue;if(s=S[S.length-1],e=s.length+n,e<0||e>=s.length)continue;a=!0}else if(u&&n>=C)if(M<S.length-1){if(s=S[M+1],e=n-C,e<0||e>=s.length)continue;a=!0}else{if(!(S.length>1))continue;if(s=S[0],e=n-C,e<0||e>=s.length)continue;a=!0}else{if(n<0||n>=C)continue;e=n}const r=D+(n-A)*Mx;if(r<-24||r>N+Mx)continue;const o=e%4==0;a&&(t.globalAlpha=.35),t.fillStyle=o?Y.rowHighlight:Y.rowNormal,t.fillRect(0,r,k,Mx),a&&(t.globalAlpha=1);const l=de(e,b);t.drawImage(l,4,r),a&&(t.globalAlpha=.35);const d=s||i;for(let n=0;n<F;n++){const s=Cx+n*L+8-c;if(s+L<0||s>k)continue;if(!d.channels[n]){t.fillStyle=Y.border,t.fillRect(Cx+(n+1)*L-c,r,1,Mx);continue}const i=d.channels[n].rows[e];if(!i)continue;if(!i)continue;const o=y&&!a&&e===E,l=i.note||0;if(!v||0!==l){const e=ce(l,o&&l>0);t.drawImage(e,s,r)}const u=ue(i.instrument||0,i.volume||0,i.effTyp||0,i.eff||0,i.effTyp2||0,i.eff2||0,i.flag1,i.flag2,i.probability,v);t.drawImage(u,s+34+4,r),t.fillStyle=Y.border,t.fillRect(Cx+(n+1)*L-c,r,1,Mx)}a&&(t.globalAlpha=1)}t.fillStyle=Y.centerLine,t.fillRect(0,I,k,Mx);{const e=Cx+f.channelIndex*L+8-c;let n=0,r=Nx;const o=38,l=0,u=24,d=48,p=82,h=116,m=h+(R?28:0);switch(f.columnType){case"note":r=34;break;case"instrument":n=o+l+f.digitIndex*Nx;break;case"volume":n=o+u+f.digitIndex*Nx;break;case"effTyp":default:n=o+d;break;case"effParam":n=o+d+Nx+f.digitIndex*Nx;break;case"effTyp2":n=o+p;break;case"effParam2":n=o+p+Nx+f.digitIndex*Nx;break;case"flag1":n=o+h;break;case"flag2":n=o+h+Nx+4;break;case"probability":n=o+m+f.digitIndex*Nx}const g=a.recordMode,b=s.isPlaying;let v;v=g?"#ef4444":b?"#22c55e":H?"#00ffff":"#3b82f6";const x=Mx,w=I,k=e+n,S=r;t.clearRect(k,w,S,x),t.fillStyle=v,t.fillRect(k,w,S,x);const M=y?E:f.rowIndex,N=i.channels[f.channelIndex]?.rows[M];if(N){let e="";const a=f.columnType,n=f.digitIndex;if("note"===a)e=Px(N.note??0);else if("instrument"===a){const t=_x(N.instrument??0);e=0===(N.instrument??0)?"..":t,e=e[n]??"."}else if("volume"===a){const t=N.volume??0;e=(t>=16&&t<=80?_x(t):"..")[n]??"."}else if("effTyp"===a){const t=N.effTyp??0,a=N.eff??0;e=0!==t||0!==a?t.toString(16).toUpperCase():"."}else if("effParam"===a){const t=N.effTyp??0,a=N.eff??0;e=(0!==t||0!==a?_x(a):"..")[n]??"."}else if("effTyp2"===a){const t=N.effTyp2??0,a=N.eff2??0;e=0!==t||0!==a?t.toString(16).toUpperCase():"."}else if("effParam2"===a){const t=N.effTyp2??0,a=N.eff2??0;e=(0!==t||0!==a?_x(a):"..")[n]??"."}else if("flag1"===a)e=1===N.flag1?"A":2===N.flag1?"S":".";else if("flag2"===a)e=1===N.flag2?"A":2===N.flag2?"S":".";else if("probability"===a){const t=N.probability??0;e=(t>0?t.toString(10).padStart(2,"0"):"..")[n]??"."}t.font='14px "JetBrains Mono", "Fira Code", monospace',t.textBaseline="middle",t.fillStyle="#ffffff",t.fillText(e,k,w+x/2)}}},[o,Y,ce,ue,de,c,H]),he=s.useCallback(()=>{pe(),w.current=requestAnimationFrame(he)},[pe]);s.useEffect(()=>(w.current=requestAnimationFrame(he),()=>{w.current&&cancelAnimationFrame(w.current)}),[he]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:a}=t.contentRect;e>0&&a>0&&l({width:e,height:a})}});t.observe(e);const a=e.getBoundingClientRect();return a.width>0&&a.height>0&&l({width:a.width,height:a.height}),()=>t.disconnect()},[]),s.useEffect(()=>{const e=n.current;e&&(e.width=o.width,e.height=o.height,b.current={},v.current={},x.current={})},[o]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=e=>{e.preventDefault();if(!Rg.getState().isPlaying)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){const t=2*Math.sign(e.deltaY),a=tf.getState(),n=a.patterns[a.currentPatternIndex];if(!n)return;const s=a.cursor.rowIndex,r=Math.min(n.length+32,s+t);tf.getState().moveCursorToRow(r)}else u(t=>Math.max(0,t+e.deltaX))};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]);const me=s.useCallback(e=>{u(e.currentTarget.scrollLeft)},[]),fe=k?.channels[0]?.rows[0],ge=34+(116+(void 0!==fe?.flag1||void 0!==fe?.flag2?28:0)+(void 0!==fe?.probability?24:0)+20+4)+20+20,ye=k?k.channels.length*ge:0;if(!k)return xa.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const be=k.channels[F],ve=y.current[F]||{level:0,triggered:!1};return xa.jsxs("div",{className:"flex flex-col h-full",...a?ee:{},children:[a&&xa.jsxs("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border relative",children:[xa.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[xa.jsx("button",{onClick:J,disabled:F<=0,className:"p-2 rounded-lg transition-colors "+(F<=0?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:xa.jsx(bt,{size:20})}),xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsxs("span",{className:"font-bold font-mono text-lg",style:{color:be?.color||"var(--color-accent)"},children:["CH ",(F+1).toString().padStart(2,"0")]}),xa.jsxs("span",{className:"text-xs text-text-muted",children:["/ ",k.channels.length.toString().padStart(2,"0")]}),xa.jsx(Kv,{level:ve.level,isActive:ve.triggered})]}),xa.jsx("button",{onClick:Z,disabled:F>=k.channels.length-1,className:"p-2 rounded-lg transition-colors "+(F>=k.channels.length-1?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:xa.jsx(De,{size:20})})]}),xa.jsxs("div",{className:"flex items-center justify-center gap-2 px-3 py-1 border-t border-dark-border/50",children:[xa.jsx("button",{onClick:()=>E(F),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(be?.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:bg-dark-bgHover"),children:be?.muted?xa.jsx(et,{size:14}):xa.jsx(Je,{size:14})}),xa.jsx("button",{onClick:()=>P(F),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(be?.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:bg-dark-bgHover"),children:xa.jsx(tt,{size:14})}),xa.jsx(Qv,{currentColor:be?.color,onColorSelect:e=>_(F,e)})]})]}),!a&&xa.jsx("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border z-20 relative h-[37px]",children:xa.jsxs("div",{className:"flex h-full",children:[xa.jsx("div",{className:"flex-shrink-0 px-2 text-text-muted text-xs font-medium text-center border-r border-dark-border flex items-center justify-center",style:{width:Cx},children:"ROW"}),xa.jsx("div",{ref:i,onScroll:me,className:"overflow-x-auto scrollbar-hidden flex-1","data-vu-scroll":!0,children:xa.jsxs("div",{className:"flex",style:{width:ye},children:[k.channels.map((e,a)=>{const n=y.current[a]||{level:0,triggered:!1};return xa.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between gap-2 px-3 py-1.5\n                        border-r border-dark-border transition-colors relative\n                        ${e.muted?"opacity-50":""}\n                        ${e.solo?"bg-accent-primary/10":""}`,style:{width:ge,backgroundColor:e.color?`${e.color}15`:void 0,boxShadow:e.color?`inset 3px 0 0 ${e.color}`:void 0},children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("span",{className:"font-bold font-mono text-sm",style:{color:e.color||"var(--color-accent)"},children:(a+1).toString().padStart(2,"0")}),xa.jsx(Kv,{level:n.level,isActive:n.triggered})]}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx(ix,{channelIndex:a,channel:e,patternId:k.id,patternLength:k.length,onFillPattern:te,onClearChannel:ae,onCopyChannel:ne,onCutChannel:se,onPasteChannel:re,onTranspose:ie,onHumanize:oe,onInterpolate:le,onAcidGenerator:t||(()=>{})}),xa.jsx(Qv,{currentColor:e.color,onColorSelect:e=>_(a,e)}),xa.jsx("button",{onClick:()=>E(a),className:"p-1 rounded transition-colors "+(e.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.muted?"Unmute":"Mute",children:e.muted?xa.jsx(et,{size:12}):xa.jsx(Je,{size:12})}),xa.jsx("button",{onClick:()=>P(a),className:"p-1 rounded transition-colors "+(e.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.solo?"Unsolo":"Solo",children:xa.jsx(tt,{size:12})}),k.channels.length>1&&xa.jsx("button",{onClick:()=>C(a),className:"p-1 rounded text-text-muted hover:text-accent-error hover:bg-dark-bgHover transition-colors",title:"Remove Channel",children:xa.jsx(ut,{size:12})})]})]},e.id)}),k.channels.length<16&&xa.jsx("button",{onClick:N,className:"flex-shrink-0 w-12 flex items-center justify-center border-r border-dark-border\n                      text-text-muted hover:text-accent-primary hover:bg-dark-bgHover transition-colors",title:"Add Channel",children:xa.jsx(Xe,{size:16})})]})})]})}),xa.jsxs("div",{ref:r,className:"flex-1 relative bg-dark-bg",style:{minHeight:200},tabIndex:0,onContextMenu:K.handleContextMenu,children:[xa.jsx("canvas",{ref:n,style:{width:o.width,height:o.height,display:"block"}}),k&&xa.jsx(Hv,{patternId:k.id,patternLength:k.length,rowHeight:Mx,channelCount:k.channels.length,channelWidth:ge,rowNumWidth:Cx,scrollOffset:d,visibleStart:h,parameter:"cutoff",prevPatternId:L?M>0?S[M-1]?.id:S.length>1?S[S.length-1]?.id:void 0:void 0,prevPatternLength:L?M>0?S[M-1]?.length:S.length>1?S[S.length-1]?.length:void 0:void 0,nextPatternId:L?M<S.length-1?S[M+1]?.id:S.length>1?S[0]?.id:void 0:void 0,nextPatternLength:L?M<S.length-1?S[M+1]?.length:S.length>1?S[0]?.length:void 0:void 0},`automation-${k.id}-${f}`),xa.jsx("div",{className:"absolute right-0 pointer-events-none z-30 overflow-hidden",style:{top:0,left:Cx,height:"calc(50% - 12px)"},children:xa.jsx(Xv,{channelWidth:ge,scrollLeft:c})}),xa.jsx(ox,{isOpen:K.isOpen,position:K.position,onClose:K.closeMenu,channelIndex:K.cellInfo?.channelIndex??0,rowIndex:K.cellInfo?.rowIndex??0,onOpenParameterEditor:X}),$?.isOpen&&xa.jsx(cx,{onClose:()=>q(null),channelIndex:$.channelIndex,startRow:$.startRow,endRow:$.endRow,field:$.field})]})]})}),Ax=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ox={noteIndex:null,octaveShift:0,accent:!1,slide:!1,tie:!1,mute:!1,hammer:!1,velocity:100};function Ix(e,t){if(!e||0===e||97===e)return null;const a=Gn(e).match(/^([A-G])(#?)(-?\d)$/);if(!a)return null;const[,n,s,r]=a,i=parseInt(r,10),o=n+(s||""),l=Ax.indexOf(o);if(-1===l)return null;const c=i-t;return c<-1||c>1?{noteIndex:l,octaveShift:Math.max(-1,Math.min(1,c))}:{noteIndex:l,octaveShift:c}}function Dx(e,t){if(null===e.noteIndex)return 0;const a=Ax[e.noteIndex],n=t+e.octaveShift;let s;return s=a.includes("#")?`${a}${n}`:`${a}-${n}`,Un(s)}function Fx(e){const{patterns:t,currentPatternIndex:a,setCell:n,resizePattern:r,resizeAllPatterns:i}=tf(),[o,l]=s.useState(3),c=t[a],u=c?.channels[e],d=u?.rows||[],p=c?.length||16,h=s.useCallback(e=>{r(a,e)},[a,r]),m=s.useMemo(()=>function(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e[s];if(!a){n.push({...Ox});continue}const r=Ix(a.note,t);let i=!1;if(s>0&&r&&e[s-1]){const a=Ix(e[s-1].note,t);a&&a.noteIndex===r.noteIndex&&a.octaveShift===r.octaveShift&&(i=!0)}n.push({noteIndex:r?.noteIndex??null,octaveShift:r?.octaveShift??0,accent:1===a.flag1||1===a.flag2,slide:2===a.flag1||2===a.flag2,tie:i,mute:3===a.flag1||3===a.flag2,hammer:4===a.flag1||4===a.flag2,velocity:a.volume??100})}return{steps:n,baseOctave:t,length:a}}(d,o,p),[d,o,p]),f=s.useCallback((t,a,s=0)=>{if(t<0||t>=p)return;const r=null!==a?Dx({noteIndex:a,octaveShift:s},o):0,i=d[t];if(0!==r&&0===(i?.instrument||0)){n(e,t,{note:r,instrument:u?.instrumentId??1})}else n(e,t,{note:r})},[e,n,o,p,d,u]),g=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=1===d[t]?.flag1||1===d[t]?.flag2;n(e,t,{flag1:a?0:1})},[e,d,n]),y=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=2===d[t]?.flag1||2===d[t]?.flag2;n(e,t,{flag2:a?0:2})},[e,d,n]),b=s.useCallback((t,a)=>{if(t<0||t>=d.length)return;const s=d[t];if(!s?.note)return;const r=Ix(s.note,o);if(!r)return;const i=Dx({noteIndex:r.noteIndex,octaveShift:a},o);n(e,t,{note:i})},[e,d,n,o]),v=s.useCallback(t=>{t<0||t>=p||n(e,t,{note:0,flag1:0,flag2:0})},[e,n,p]),x=s.useCallback(()=>{for(let t=0;t<p;t++)n(e,t,{note:0,flag1:0,flag2:0})},[e,n,p]),w=s.useCallback((t,a)=>{if(t<0||t>=d.length)return;const s=Math.max(0,Math.min(127,a));n(e,t,{volume:s})},[e,d,n]),k=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=3===d[t]?.flag1||3===d[t]?.flag2;n(e,t,{flag1:a?0:3})},[e,d,n]),S=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=4===d[t]?.flag1||4===d[t]?.flag2;n(e,t,{flag2:a?0:4})},[e,d,n]);return{gridPattern:m,baseOctave:o,setBaseOctave:l,maxSteps:p,setMaxSteps:h,resizeAllPatterns:i,setNote:f,toggleAccent:g,toggleSlide:y,toggleMute:k,toggleHammer:S,setOctaveShift:b,setVelocity:w,clearStep:v,clearAll:x}}const Rx={chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],description:"All notes"},major:{name:"Major",intervals:[0,2,4,5,7,9,11],description:"Ionian mode"},minor:{name:"Natural Minor",intervals:[0,2,3,5,7,8,10],description:"Aeolian mode"},harmonicMinor:{name:"Harmonic Minor",intervals:[0,2,3,5,7,8,11],description:"Minor with raised 7th"},melodicMinor:{name:"Melodic Minor",intervals:[0,2,3,5,7,9,11],description:"Minor with raised 6th and 7th"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],description:"Minor with raised 6th"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],description:"Minor with lowered 2nd"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],description:"Major with raised 4th"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],description:"Major with lowered 7th"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],description:"Diminished scale"},pentatonicMajor:{name:"Pentatonic Major",intervals:[0,2,4,7,9],description:"5-note major scale"},pentatonicMinor:{name:"Pentatonic Minor",intervals:[0,3,5,7,10],description:"5-note minor scale"},blues:{name:"Blues",intervals:[0,3,5,6,7,10],description:"Minor pentatonic + blue note"},wholeTone:{name:"Whole Tone",intervals:[0,2,4,6,8,10],description:"All whole steps"},diminished:{name:"Diminished",intervals:[0,2,3,5,6,8,9,11],description:"Half-whole diminished"}};const jx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Lx=({scaleKey:e,rootNote:t,onScaleChange:a,onRootNoteChange:n})=>{const r=s.useMemo(()=>Object.entries(Rx).map(([e,t])=>({value:e,label:t.name,description:t.description})),[]),i=s.useMemo(()=>Rx[e]||Rx.chromatic,[e]);return xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Root:"}),xa.jsx("select",{value:t,onChange:e=>n(parseInt(e.target.value,10)),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary",children:jx.map((e,t)=>xa.jsx("option",{value:t,children:e},t))})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Scale:"}),xa.jsx("select",{value:e,onChange:e=>a(e.target.value),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary min-w-[140px]",title:i?.description,children:r.map(e=>xa.jsx("option",{value:e.value,title:e.description,children:e.label},e.value))})]}),"Chromatic"!==i.name&&xa.jsxs("span",{className:"text-[10px] text-text-muted",children:["(",i.intervals.length," notes)"]})]})},Bx={baseOctave:{label:"Base Octave",min:1,max:6,group:"General"},velocity:{label:"Velocity",min:0,max:127,group:"General"},cutoff:{label:"Cutoff",min:200,max:5e3,group:"303 Main"},resonance:{label:"Resonance",min:0,max:100,group:"303 Main"},envMod:{label:"Env Mod",min:0,max:100,group:"303 Main"},decay:{label:"Decay",min:200,max:2e3,group:"303 Main"},accent:{label:"Accent",min:0,max:100,group:"303 Main"},slideTime:{label:"Slide Time",min:2,max:360,group:"303 Main"},overdrive:{label:"Overdrive",min:0,max:100,group:"303 Main"},normalDecay:{label:"Normal Decay",min:30,max:3e3,group:"Devil Fish"},accentDecay:{label:"Accent Decay",min:30,max:3e3,group:"Devil Fish"},softAttack:{label:"Soft Attack",min:.3,max:30,group:"Devil Fish"},vegSustain:{label:"VEG Sustain",min:0,max:100,group:"Devil Fish"},filterFM:{label:"Filter FM",min:0,max:100,group:"Devil Fish"},filterTracking:{label:"Key Track",min:0,max:200,group:"Devil Fish"}},Vx=({onClose:e})=>{const{devices:t,isSupported:a,isEnabled:n,lastMessage:r,enableMIDI:i,disableMIDI:o,onMessage:l}=Ab(),{gridMappings:c,gridIsLearning:u,gridLearningParameter:d,addGridMapping:p,removeGridMapping:h,clearGridMappings:m,startGridLearning:f,stopGridLearning:g}=ky(),[y,b]=s.useState(null);s.useEffect(()=>{if(!u||!d)return;return l(e=>{if("cc"===e.type&&void 0!==e.controller&&void 0!==e.value){const t=Bx[d];p({channel:e.channel,controller:e.controller,parameter:d,min:t.min,max:t.max,curve:"linear"}),g()}})},[u,d,l,p,g]);return a?xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4 space-y-4",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[xa.jsx(Ce,{size:16}),"MIDI Learn"]}),e&&xa.jsx("button",{onClick:e,className:"text-text-muted hover:text-text-primary text-xs",children:"Close"})]}),xa.jsx("div",{className:"flex items-center gap-3",children:n?xa.jsxs(xa.Fragment,{children:[xa.jsx("button",{onClick:o,className:"px-3 py-1.5 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-xs transition-colors",children:"Disable MIDI"}),xa.jsxs("span",{className:"flex items-center gap-1 text-xs text-accent-success",children:[xa.jsx("span",{className:"w-2 h-2 bg-accent-success rounded-full animate-pulse"}),"Connected"]})]}):xa.jsx("button",{onClick:async()=>{try{b(null),await i()}catch(e){b(e instanceof Error?e.message:"Failed to enable MIDI")}},className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white rounded text-xs font-medium transition-colors",children:"Enable MIDI"})}),y&&xa.jsx("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-2 text-xs text-accent-error",children:y}),n&&t.length>0&&xa.jsxs("div",{children:[xa.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-2",children:"Connected Devices"}),xa.jsx("div",{className:"space-y-1",children:t.map(e=>xa.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted bg-dark-bgTertiary rounded px-2 py-1",children:[xa.jsx("span",{className:"w-2 h-2 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),xa.jsx("span",{className:"flex-1",children:e.name}),xa.jsx("span",{className:"text-[10px] opacity-60",children:e.manufacturer})]},e.id))})]}),n&&r&&"cc"===r.type&&xa.jsxs("div",{className:"bg-dark-bgTertiary rounded p-2",children:[xa.jsx("div",{className:"text-xs text-text-muted",children:"Last CC Message:"}),xa.jsxs("div",{className:"text-xs font-mono text-text-primary mt-1",children:["CH",r.channel+1," CC",r.controller," = ",r.value]})]}),n&&xa.jsxs("div",{className:"space-y-3",children:[xa.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Map Parameters"}),["General","303 Main","Devil Fish"].map(e=>{const t=Object.keys(Bx).filter(t=>Bx[t].group===e);return 0===t.length?null:xa.jsxs("div",{children:[xa.jsx("div",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide mb-1.5",children:e}),xa.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:t.map(e=>{const t=Object.values(c).some(t=>t.parameter===e),a=u&&d===e;return xa.jsxs("button",{onClick:()=>{a?g():f(e)},className:`\n                          flex items-center gap-2 px-2 py-1.5 rounded text-xs transition-colors\n                          ${a?"bg-accent-primary text-white animate-pulse":t?"bg-accent-success/20 text-accent-success border border-accent-success/30":"bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary"}\n                        `,children:[a&&xa.jsx(Pe,{size:12,className:"animate-spin"}),xa.jsx("span",{className:"flex-1 text-left",children:Bx[e].label}),t&&!a&&xa.jsx("span",{className:"text-[10px]",children:""})]},e)})})]},e)}),u&&xa.jsxs("p",{className:"text-xs text-accent-primary mt-2 animate-pulse",children:["Move a MIDI controller to assign it to ",Bx[d].label,"..."]})]}),n&&Object.keys(c).length>0&&xa.jsxs("div",{children:[xa.jsxs("div",{className:"flex items-center justify-between mb-2",children:[xa.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Active Mappings"}),xa.jsxs("button",{onClick:m,className:"flex items-center gap-1 text-xs text-accent-error hover:underline",children:[xa.jsx(Re,{size:10}),"Clear All"]})]}),xa.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(c).map(([e,t])=>xa.jsxs("div",{className:"flex items-center justify-between bg-dark-bgTertiary rounded px-2 py-1 text-xs",children:[xa.jsx("span",{className:"text-text-primary",children:Bx[t.parameter].label}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsxs("span",{className:"font-mono text-text-muted text-[10px]",children:["CH",t.channel+1," CC",t.controller]}),xa.jsx("button",{onClick:()=>h(t.channel,t.controller),className:"text-accent-error hover:text-accent-error/80",children:xa.jsx(Re,{size:10})})]})]},e))})]})]}):xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4",children:[xa.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[xa.jsx(vt,{size:16}),xa.jsx("span",{className:"text-sm",children:"Web MIDI API not supported in this browser"})]}),xa.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})},zx=({baseOctave:e,onBaseOctaveChange:t,maxSteps:a,onMaxStepsChange:n,onResizeAllPatterns:r,scaleKey:i,rootNote:o,onScaleChange:l,onRootNoteChange:c,onClearAll:u,onRandomize:d,onAcidGenerator:p})=>{const[h,m]=s.useState(!1);return xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{className:"flex items-center gap-4 p-2 bg-dark-bgSecondary border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Octave"}),xa.jsxs("div",{className:"flex items-center",children:[xa.jsx("button",{onClick:()=>t(Math.max(1,e-1)),disabled:e<=1,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:xa.jsx(Me,{size:14})}),xa.jsx("span",{className:"w-8 text-center text-sm font-mono text-text-primary",children:e}),xa.jsx("button",{onClick:()=>t(Math.min(6,e+1)),disabled:e>=6,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:xa.jsx(xt,{size:14})})]}),xa.jsxs("span",{className:"text-xs text-text-muted",children:["C",e," - C",e+2]})]}),xa.jsx("div",{className:"w-px h-6 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Steps"}),xa.jsxs("select",{value:a,onChange:e=>n(Number(e.target.value)),className:"px-2 py-1 text-sm bg-dark-bgTertiary border border-dark-border rounded text-text-primary",children:[xa.jsx("option",{value:4,children:"4"}),xa.jsx("option",{value:8,children:"8"}),xa.jsx("option",{value:12,children:"12"}),xa.jsx("option",{value:16,children:"16"}),xa.jsx("option",{value:24,children:"24"}),xa.jsx("option",{value:32,children:"32"}),xa.jsx("option",{value:64,children:"64"})]}),xa.jsx("button",{onClick:()=>r(a),className:"px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Apply this step count to all patterns",children:"Apply All"})]}),xa.jsx("div",{className:"w-px h-6 bg-dark-border"}),xa.jsx(Lx,{scaleKey:i,rootNote:o,onScaleChange:l,onRootNoteChange:c}),xa.jsx("div",{className:"w-px h-6 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsxs("button",{onClick:()=>m(!h),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors "+(h?"bg-accent-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-dark-bgActive"),title:"MIDI Learn",children:[xa.jsx(Ce,{size:12}),"MIDI"]}),p&&xa.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate 303 acid pattern",children:[xa.jsx(at,{size:12}),"Acid"]}),d&&xa.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate random pattern",children:[xa.jsx(wt,{size:12}),"Random"]}),xa.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-accent-error hover:bg-accent-error/10 rounded transition-colors",title:"Clear all steps",children:[xa.jsx(Re,{size:12}),"Clear"]})]})]}),h&&xa.jsx("div",{className:"border-b border-dark-border p-3 bg-dark-bg",children:xa.jsx(Vx,{onClose:()=>m(!1)})})]})},Ux=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Gx=127,Wx=s.memo(({isActive:e,isCurrentStep:t=!1,onClick:a,color:n="default",size:s="normal"})=>{const r="small"===s?"w-5 h-5":"w-7 h-7";return xa.jsx("button",{onClick:a,className:`\n        ${r} rounded transition-all duration-75 border\n        ${(()=>{if(!e)return"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border";switch(n){case"accent":return"bg-accent-warning hover:bg-accent-warning/80 border-accent-warning/50";case"slide":return"bg-accent-secondary hover:bg-accent-secondary/80 border-accent-secondary/50";case"octave":return"bg-accent-primary/50 hover:bg-accent-primary/70 border-accent-primary/50";default:return"bg-accent-primary hover:bg-accent-primary/80 border-accent-primary/50"}})()}\n        ${t?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":""}\n        ${e?"shadow-sm":""}\n      `})}),Hx=({x:e,y:t,accent:a,slide:n,mute:r,hammer:i,octaveShift:o,velocity:l,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:p,onSetOctave:h,onSetVelocity:m,onClose:f})=>{const[g,y]=s.useState(l);return s.useEffect(()=>{const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"fixed inset-0 z-40",onClick:f}),xa.jsxs("div",{className:"fixed z-50 bg-dark-bgSecondary border border-dark-border rounded shadow-lg py-1 min-w-[160px]",style:{left:e,top:t},children:[xa.jsxs("button",{onClick:()=>{c(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(a?"text-accent-warning":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(a?"bg-accent-warning":"border border-text-muted")}),"Accent ",a&&""]}),xa.jsxs("button",{onClick:()=>{u(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(n?"text-accent-secondary":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 "+(n?"text-accent-secondary":"text-text-muted"),children:""}),"Slide ",n&&""]}),xa.jsx("div",{className:"border-t border-dark-border my-1"}),xa.jsxs("button",{onClick:()=>{d(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(r?"text-yellow-400":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(r?"bg-yellow-400":"border border-text-muted")}),"Mute ",r&&""]}),xa.jsxs("button",{onClick:()=>{p(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(i?"text-cyan-400":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(i?"bg-cyan-400":"border border-text-muted")}),"Hammer ",i&&""]}),xa.jsx("div",{className:"border-t border-dark-border my-1"}),xa.jsxs("button",{onClick:()=>{h(1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(1===o?"text-cyan-400":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(1===o?"bg-accent-primary ring-2 ring-cyan-400 ring-inset":"border border-text-muted")}),"Oct+ ",1===o&&""]}),xa.jsxs("button",{onClick:()=>{h(0),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(0===o?"text-accent-primary":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(0===o?"bg-accent-primary":"border border-text-muted")}),"Normal ",0===o&&""]}),xa.jsxs("button",{onClick:()=>{h(-1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(-1===o?"text-pink-400":"text-text-secondary"),children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm "+(-1===o?"bg-accent-primary ring-2 ring-pink-400 ring-inset":"border border-text-muted")}),"Oct- ",-1===o&&""]}),xa.jsx("div",{className:"border-t border-dark-border my-1"}),xa.jsxs("div",{className:"px-3 py-2",children:[xa.jsxs("div",{className:"flex items-center justify-between mb-1",children:[xa.jsx("span",{className:"text-xs text-text-secondary",children:"Velocity"}),xa.jsx("span",{className:"text-xs text-text-primary font-mono",children:g})]}),xa.jsx("input",{type:"range",min:1,max:Gx,value:g,onChange:e=>{const t=parseInt(e.target.value,10);y(t),m(t)},className:"w-full h-1 bg-dark-bgTertiary rounded-lg appearance-none cursor-pointer accent-accent-primary"}),xa.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-text-muted",children:[xa.jsx("button",{onClick:()=>{m(64),y(64)},className:"hover:text-text-secondary",children:"50%"}),xa.jsx("button",{onClick:()=>{m(100),y(100)},className:"hover:text-text-secondary",children:"Default"}),xa.jsx("button",{onClick:()=>{m(Gx),y(Gx)},className:"hover:text-text-secondary",children:"Max"})]})]})]})]})},Kx=s.memo(({noteIndex:e,stepIndex:t,isActive:a,isCurrentStep:n,isTriggered:r=!1,isFocused:i=!1,accent:o=!1,slide:l=!1,mute:c=!1,hammer:u=!1,octaveShift:d=0,velocity:p=100,onClick:h,onToggleAccent:m,onToggleSlide:f,onToggleMute:g,onToggleHammer:y,onSetOctave:b,onSetVelocity:v,onFocus:x})=>{const[w,k]=s.useState(null),S=s.useCallback(n=>{if(a){if(n.shiftKey&&m)return void m(t);if((n.ctrlKey||n.metaKey)&&f)return void f(t);if(n.altKey&&b){return void b(t,0===d?1:1===d?-1:0)}}h(e,t,{shift:n.shiftKey,ctrl:n.ctrlKey||n.metaKey,alt:n.altKey})},[h,e,t,a,m,f,b,d]),M=s.useCallback(e=>{a&&(e.preventDefault(),k({x:e.clientX,y:e.clientY}))},[a]),N=s.useCallback(()=>{k(null)},[]),C=s.useCallback(()=>{m?.(t)},[m,t]),E=s.useCallback(()=>{f?.(t)},[f,t]),P=s.useCallback(()=>{g?.(t)},[g,t]),_=s.useCallback(()=>{y?.(t)},[y,t]),T=s.useCallback(e=>{b?.(t,e)},[b,t]),A=s.useCallback(e=>{v?.(t,e)},[v,t]),O=s.useCallback(e=>{if(!a||!v)return;e.preventDefault();const n=e.deltaY>0?-5:5,s=Math.max(1,Math.min(Gx,p+n));v(t,s)},[a,v,t,p]),I=s.useCallback(()=>{x?.()},[x]);return xa.jsxs(xa.Fragment,{children:[xa.jsxs("button",{onClick:S,onContextMenu:M,onWheel:O,onFocus:I,tabIndex:i?0:-1,className:`\n          w-7 h-7 rounded transition-all duration-75 border relative\n          ${a?o?"bg-accent-warning hover:brightness-110 border-accent-warning/50":"bg-accent-primary hover:brightness-110 border-accent-primary/50":"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border"}\n          ${n?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":a&&0!==d?d>0?"ring-2 ring-cyan-400 ring-inset":"ring-2 ring-pink-400 ring-inset":""}\n          ${i&&!n?"ring-2 ring-text-secondary ring-offset-1 ring-offset-dark-bg":""}\n          ${a?"shadow-sm":""}\n          ${r&&a?"!bg-white scale-110 shadow-lg shadow-white/50":""}\n          ${!a||p>=100?"":p<50?"ring-1 ring-inset ring-black/30":p<80?"ring-1 ring-inset ring-black/15":""}\n          focus:outline-none\n        `,title:a?`Velocity: ${p} | Shift+click: accent, Ctrl+click: slide, Alt+click: octave, Scroll: velocity`:"","aria-label":`Step ${t+1}, Note ${Ux[e]}${a?", Active":""}`,"aria-pressed":a,children:[a&&l&&!c&&xa.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-xs font-bold",children:""}),a&&c&&xa.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400 text-xs font-bold",children:"M"}),a&&u&&!c&&xa.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-cyan-400 text-xs font-bold",children:"H"})]}),w&&xa.jsx(Hx,{x:w.x,y:w.y,accent:o,slide:l,mute:c,hammer:u,octaveShift:d,velocity:p,onToggleAccent:C,onToggleSlide:E,onToggleMute:P,onToggleHammer:_,onSetOctave:T,onSetVelocity:A,onClose:N})]})});s.memo(({stepIndex:t,isActive:a,isCurrentStep:n,color:s,onClick:r})=>{const i=e.useCallback(()=>{r(t)},[r,t]);return xa.jsx(Wx,{isActive:a,isCurrentStep:n,onClick:i,color:s})});const $x=["MINOR","MAJOR","DORIAN","MIXOLYDIAN","PHRYGIAN","HARMONIC_MINOR","PHRYGIAN_DOMINANT","MELODIC_MINOR","LYDIAN_DOMINANT","HUNGARIAN_MINOR"],qx={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]};function Xx(e,t){return Math.floor(Math.random()*(t-e+1))+e}function Yx(e,t){const a=[...e],n=[],s=Math.min(t,e.length);for(let r=0;r<s;r++){const e=Math.floor(Math.random()*(a.length-r))+r;[a[r],a[e]]=[a[e],a[r]],n.push(a[r])}return n}function Qx(e={}){const{patternLength:t=16,density:a=60,spread:n=60,accentsDensity:s=50,slidesDensity:r=40,scale:i="MINOR",rootNote:o="C2",instrumentId:l=1}=e,c=function(e){const{patternLength:t,density:a,spread:n,accentsDensity:s,slidesDensity:r}=e,i=Array.from({length:t},(e,t)=>t),o=Math.round(t*(a/100)),l=Xx(Math.round(o/2),o),c=Yx(i,l),u=Math.max(1,Math.round(l/2*(s/100))),d=Math.round(l/2*(r/100)),p=Yx(c,Xx(1,u)),h=Yx(c,Xx(0,d)),m=Math.round(n/100*6),f=Yx(Array.from({length:7},(e,t)=>t),Math.max(1,m)),g=Yx(c,Xx(0,l));return i.map(e=>{if(!c.includes(e))return{note:null,octave:null,accent:null,slide:null};const t=Xx(-1,1);return{note:g.includes(e)&&f.length>0?f[Xx(0,f.length-1)]:0,octave:t,accent:p.includes(e),slide:h.includes(e)}})}({patternLength:t,density:a,spread:n,accentsDensity:s,slidesDensity:r}),u=qx[i],d=function(e){const t=e.match(/^([A-G][b#]?)(-?\d+)$/);if(!t)return 36;const[,a,n]=t,s=parseInt(n,10),r={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a];return void 0===r?36:r+12*(s+1)}(o);return c.map(e=>{if(null===e.note||null===e.octave)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const t=function(e,t,a,n){return t[e]+a+12*n}(e.note,u,d,e.octave),a=Xn(t),n=e.accent?64:Xx(48,56);return{note:a,instrument:l,volume:16+n,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:void 0,flag2:e.slide?2:void 0}})}function Zx(e){return{MINOR:"Minor (Natural)",MAJOR:"Major",DORIAN:"Dorian",MIXOLYDIAN:"Mixolydian",PHRYGIAN:"Phrygian",HARMONIC_MINOR:"Harmonic Minor",PHRYGIAN_DOMINANT:"Phrygian Dominant",MELODIC_MINOR:"Melodic Minor",LYDIAN_DOMINANT:"Lydian Dominant",HUNGARIAN_MINOR:"Hungarian Minor"}[e]}const Jx=({channelIndex:e,onClose:t})=>{const{patterns:a,currentPatternIndex:n,setChannelRows:r}=tf(),i=a[n],o=i?.channels[e],l=o?.instrumentId??0,[c,u]=s.useState(60),[d,p]=s.useState(60),[h,m]=s.useState(50),[f,g]=s.useState(40),[y,b]=s.useState("MINOR"),[v,x]=s.useState("C2"),w=["C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"];return o?xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(at,{size:18,className:"text-accent-primary"}),xa.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"Acid Pattern Generator"})]}),xa.jsx("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:xa.jsx(Ee,{size:18})})]}),xa.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[xa.jsx("div",{className:"bg-dark-bgTertiary p-3 rounded border border-ft2-border",children:xa.jsxs("div",{className:"text-sm text-ft2-textDim",children:["Generating for: ",xa.jsx("span",{className:"font-bold text-ft2-text",children:o.name}),xa.jsx("br",{}),"Pattern Length: ",xa.jsxs("span",{className:"font-mono",children:[i.length," steps"]})]})}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Scale"}),xa.jsx("select",{value:y,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:$x.map(e=>xa.jsx("option",{value:e,children:Zx(e)},e))})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Root Note"}),xa.jsx("select",{value:v,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:w.map(e=>xa.jsx("option",{value:e,children:e},e))})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Density: ",xa.jsxs("span",{className:"font-mono text-accent-primary",children:[c,"%"]})]}),xa.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:e=>u(parseInt(e.target.value)),className:"w-full"}),xa.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many notes in the pattern (sparse   dense)"})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Spread: ",xa.jsxs("span",{className:"font-mono text-accent-primary",children:[d,"%"]})]}),xa.jsx("input",{type:"range",min:"0",max:"100",value:d,onChange:e=>p(parseInt(e.target.value)),className:"w-full"}),xa.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"Note range variety (narrow   wide)"})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Accents: ",xa.jsxs("span",{className:"font-mono text-accent-primary",children:[h,"%"]})]}),xa.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:e=>m(parseInt(e.target.value)),className:"w-full"}),xa.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many accented notes (subtle   punchy)"})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Slides: ",xa.jsxs("span",{className:"font-mono text-accent-primary",children:[f,"%"]})]}),xa.jsx("input",{type:"range",min:"0",max:"100",value:f,onChange:e=>g(parseInt(e.target.value)),className:"w-full"}),xa.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many slides/portamento (few   many)"})]})]}),xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[xa.jsxs("button",{onClick:()=>{u(Math.floor(60*Math.random())+40),p(Math.floor(60*Math.random())+40),m(Math.floor(60*Math.random())+20),g(Math.floor(60*Math.random())+20),b($x[Math.floor(Math.random()*$x.length)]);const e=w[Math.floor(Math.random()*w.length)];x(e)},className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[xa.jsx(kt,{size:14}),"Randomize"]}),xa.jsxs("div",{className:"flex gap-2",children:[xa.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"}),xa.jsx("button",{onClick:()=>{(()=>{if(!o)return;const t=Qx({patternLength:i.length,density:c,spread:d,accentsDensity:h,slidesDensity:f,scale:y,rootNote:v,instrumentId:l});r(e,t)})(),t()},className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Generate Pattern"})]})]})]})}):null},ew=["B","A#","A","G#","G","F#","F","E","D#","D","C#","C"],tw=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],aw=[11,10,9,8,7,6,5,4,3,2,1,0],nw=({channelIndex:e})=>{const{gridPattern:t,baseOctave:a,setBaseOctave:n,maxSteps:r,setMaxSteps:i,resizeAllPatterns:o,setNote:l,toggleAccent:c,toggleSlide:u,toggleMute:d,toggleHammer:p,setOctaveShift:h,setVelocity:m,clearAll:f}=Fx(e),{currentRow:g,isPlaying:y,smoothScrolling:b,bpm:v,speed:x}=Rg(),w=y?g%r:-1,k=s.useRef(null),S=s.useRef(-1),M=s.useRef(0),N=s.useRef(0),C=s.useRef(0),E=s.useRef(t.steps);E.current=t.steps;const[P,_]=s.useState(null),T=s.useRef(null),[A,O]=s.useState("chromatic"),[I,D]=s.useState(0),[F,R]=s.useState(!1),{onMessage:j}=Ab(),{applyGridMIDIValue:L}=ky();s.useEffect(()=>{null===P&&r>0&&_({noteIndex:11,stepIndex:0})},[P,r]),s.useEffect(()=>{if(!y||!b)return S.current=-1,M.current=0,void(C.current&&(cancelAnimationFrame(C.current),C.current=0));const e=k.current;if(!e)return;const t=2.5/v*x*1e3,a=()=>{const n=performance.now();w!==S.current&&(S.current=w,M.current=n);const s=n-M.current,r=Math.min(s/t,1),i=48+32*(w+r),o=e.clientWidth,l=Math.max(0,i-.4*o);N.current+=.15*(l-N.current),e.scrollLeft=N.current,C.current=requestAnimationFrame(a)};return N.current=e.scrollLeft,C.current=requestAnimationFrame(a),()=>{C.current&&(cancelAnimationFrame(C.current),C.current=0)}},[y,b,v,x,w]),s.useEffect(()=>j(e=>{if("cc"!==e.type||void 0===e.controller||void 0===e.value)return;const t=L(e.channel,e.controller,e.value);if(null===t)return;const a=ky.getState().getGridMapping(e.channel,e.controller);if(a&&"baseOctave"===a.parameter)n(Math.round(t))}),[j,L,n]);const[B]=s.useState(!0),V=s.useCallback((t,n=0,s=!1,r=!1)=>{if(B)try{const i=Km();if(!i)return;const{patterns:o,currentPatternIndex:l}=tf.getState(),c=o[l],u=c?.channels[e],d=u?.instrumentId??1,p=Pg.getState().instruments.find(e=>e.id===d);if(p){const e=`${tw[t]}${a+n}`;i.triggerNote(d,e,.2,Q(),.8,p,s,r)}}catch(i){}},[B,e,a]),z=s.useCallback((e,t)=>{const a=E.current[t];if(a?.noteIndex===e)l(t,null);else{const n=null!==a?.noteIndex?a.octaveShift:0;l(t,e,n),V(e,n,a?.accent||!1,a?.slide||!1)}},[l,V]),U=s.useCallback((e,t)=>{h(e,t)},[h]),G=s.useCallback(()=>{for(let e=0;e<r;e++)if(Math.random()<.7){const t=Math.floor(12*Math.random()),a=Math.random()<.3?Math.random()<.5?-1:1:0;l(e,t,a),Math.random()<.25&&c(e),e>0&&Math.random()<.2&&u(e)}else l(e,null)},[r,l,c,u]),W=s.useCallback(()=>{R(!0)},[]),H=s.useMemo(()=>Array.from({length:r},(e,t)=>t),[r]),K=s.useMemo(()=>{const e=Rx[A];return e&&"chromatic"!==A?aw.filter(t=>function(e,t,a){if(e<0||e>11)return!1;if(t<0||t>11)return!1;const n=(e-t+12)%12;return a.intervals.includes(n)}(t,I,e)):aw},[A,I]),$=s.useCallback(e=>{if(!P)return;const{noteIndex:t,stepIndex:a}=P,n=E.current[a],s=n?.noteIndex===t;if("ArrowRight"===e.key)e.preventDefault(),_({noteIndex:t,stepIndex:Math.min(a+1,r-1)});else if("ArrowLeft"===e.key)e.preventDefault(),_({noteIndex:t,stepIndex:Math.max(a-1,0)});else if("ArrowDown"===e.key){e.preventDefault();const n=aw.indexOf(t),s=Math.min(n+1,aw.length-1);_({noteIndex:aw[s],stepIndex:a})}else if("ArrowUp"===e.key){e.preventDefault();const n=aw.indexOf(t),s=Math.max(n-1,0);_({noteIndex:aw[s],stepIndex:a})}else if("Enter"===e.key||" "===e.key)e.preventDefault(),z(t,a);else if(s)if("a"===e.key||"A"===e.key)e.preventDefault(),c(a);else if("s"===e.key||"S"===e.key)e.preventDefault(),u(a);else if("m"===e.key||"M"===e.key)e.preventDefault(),d(a);else if("h"===e.key||"H"===e.key)e.preventDefault(),p(a);else if("o"===e.key||"O"===e.key){e.preventDefault();const t=n?.octaveShift??0;h(a,0===t?1:1===t?-1:0)}else if("v"===e.key||"V"===e.key)e.preventDefault(),m(a,100);else if("+"===e.key||"="===e.key){e.preventDefault();const t=n?.velocity??100;m(a,Math.min(127,t+10))}else if("-"===e.key||"_"===e.key){e.preventDefault();const t=n?.velocity??100;m(a,Math.max(1,t-10))}},[P,z,r,c,u,d,p,h,m]);return xa.jsxs("div",{className:"flex flex-col h-full bg-dark-bg",children:[xa.jsx(zx,{baseOctave:a,onBaseOctaveChange:n,maxSteps:r,onMaxStepsChange:i,onResizeAllPatterns:o,scaleKey:A,rootNote:I,onScaleChange:O,onRootNoteChange:D,onClearAll:f,onRandomize:G,onAcidGenerator:W}),xa.jsxs("div",{ref:k,className:"flex-1 overflow-auto p-2",children:[xa.jsxs("div",{ref:T,className:"inline-block min-w-full",role:"grid","aria-label":"TB-303 Pattern Grid",onKeyDown:$,tabIndex:0,children:[xa.jsx("div",{className:"flex items-center mb-1 pl-12",role:"row",children:H.map(e=>xa.jsx("div",{className:`w-7 h-4 flex items-center justify-center text-[10px] font-mono mx-0.5\n                  ${e%4==0?"text-text-primary":"text-text-muted"}\n                  ${w===e?"text-accent-primary font-bold":""}\n                `,children:(e+1).toString().padStart(2,"0")},e))}),K.map(e=>{const a=aw.indexOf(e),n=e===I;return xa.jsxs("div",{className:"flex items-center mb-0.5",role:"row",children:[xa.jsxs("div",{className:`w-10 mr-2 text-right text-xs font-mono\n                    ${n?"text-accent-primary font-bold":ew[a].includes("#")?"text-text-muted":"text-text-secondary"}\n                  `,"aria-label":`Note ${ew[a]}${n?" (Root)":""}`,children:[ew[a],n&&xa.jsx("span",{className:"ml-0.5 text-[8px]",children:""})]}),H.map(a=>{const n=t.steps[a],s=n?.noteIndex===e,r=P?.noteIndex===e&&P?.stepIndex===a;return xa.jsx("div",{className:"mx-0.5",role:"gridcell",children:xa.jsx(Kx,{noteIndex:e,stepIndex:a,isActive:s,isCurrentStep:w===a,isTriggered:w===a&&s,isFocused:r,accent:!!s&&n?.accent,slide:!!s&&n?.slide,mute:!!s&&n?.mute,hammer:!!s&&n?.hammer,octaveShift:s?n?.octaveShift:0,velocity:s?n?.velocity:100,onClick:z,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:p,onSetOctave:U,onSetVelocity:m,onFocus:()=>_({noteIndex:e,stepIndex:a})})},a)})]},e)})]}),xa.jsxs("div",{className:"mt-4 pt-3 border-t border-dark-border space-y-2",children:[xa.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[xa.jsx("span",{children:"Click: note"}),xa.jsxs("span",{className:"flex items-center gap-1",children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-warning/80"})," Shift+click: accent"]}),xa.jsxs("span",{className:"flex items-center gap-1",children:[xa.jsx("span",{className:"text-accent-secondary",children:""})," Ctrl+click: slide"]}),xa.jsxs("span",{className:"flex items-center gap-1",children:[xa.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-cyan-400 ring-inset"}),xa.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-pink-400 ring-inset"}),"Alt+click: octave"]}),xa.jsx("span",{children:"Right-click: menu"}),xa.jsx("span",{children:"Scroll: velocity"})]}),xa.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[xa.jsx("span",{className:"font-semibold text-text-secondary",children:"Keyboard:"}),xa.jsx("span",{children:"Arrows: navigate"}),xa.jsx("span",{children:"Enter/Space: toggle"}),xa.jsx("span",{children:"A: accent"}),xa.jsx("span",{children:"S: slide"}),xa.jsx("span",{children:"M: mute"}),xa.jsx("span",{children:"H: hammer"}),xa.jsx("span",{children:"O: octave"}),xa.jsx("span",{children:"V: velocity reset"}),xa.jsx("span",{children:"+/-: velocity 10"})]})]})]}),F&&xa.jsx(Jx,{channelIndex:e,onClose:()=>R(!1)})]})},sw={z:{note:"C",octaveOffset:0},s:{note:"C#",octaveOffset:0},x:{note:"D",octaveOffset:0},d:{note:"D#",octaveOffset:0},c:{note:"E",octaveOffset:0},v:{note:"F",octaveOffset:0},g:{note:"F#",octaveOffset:0},b:{note:"G",octaveOffset:0},h:{note:"G#",octaveOffset:0},n:{note:"A",octaveOffset:0},j:{note:"A#",octaveOffset:0},m:{note:"B",octaveOffset:0},",":{note:"C",octaveOffset:1},q:{note:"C",octaveOffset:1},2:{note:"C#",octaveOffset:1},w:{note:"D",octaveOffset:1},3:{note:"D#",octaveOffset:1},e:{note:"E",octaveOffset:1},r:{note:"F",octaveOffset:1},5:{note:"F#",octaveOffset:1},t:{note:"G",octaveOffset:1},6:{note:"G#",octaveOffset:1},y:{note:"A",octaveOffset:1},7:{note:"A#",octaveOffset:1},u:{note:"B",octaveOffset:1},i:{note:"C",octaveOffset:2},9:{note:"C#",octaveOffset:2},o:{note:"D",octaveOffset:2},0:{note:"D#",octaveOffset:2},p:{note:"E",octaveOffset:2}},rw={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7},iw={a:8,s:9,d:10,f:11,g:12,h:13,j:14,k:15},ow="0123456789ABCDEFabcdef",lw={0:0,1:1,2:2,3:3,4:4,"-":6,"+":7,d:8,u:9,s:10,v:11,p:12,l:13,r:14,m:15},cw={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35};const uw=({isOpen:e,onClose:t,children:a,theme:n="modern",size:r="md",backdropOpacity:i="medium",rounded:o=!0,closeOnBackdropClick:l=!0,closeOnEscape:c=!0,animation:u="fade",className:d=""})=>{s.useEffect(()=>{if(!e||!c)return;const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,c,t]);if(!e)return null;const p=`\n    fixed inset-0 z-50 flex items-center justify-center p-4\n    ${{light:"bg-black/50",medium:"bg-black/60",dark:"bg-black/80"}[i]}\n  `,h=`\n    ${{sm:"w-80 max-w-sm",md:"w-96 max-w-md",lg:"max-w-2xl w-full",xl:"max-w-4xl w-full",fullscreen:"w-full h-full"}[r]}\n    ${"retro"===n?"bg-ft2-bg border-ft2-border":"bg-dark-bg border-dark-border"}\n    ${"retro"===n?"border-2":"border"}\n    ${o?"rounded-lg":""}\n    ${{fade:"animate-fade-in",slide:"animate-slide-in-up",scale:"animate-scale-in"}[u]}\n    ${"fullscreen"!==r?"shadow-xl max-h-[90vh] overflow-hidden":""}\n    ${d}\n    flex flex-col\n  `;return xa.jsx("div",{className:p,onClick:e=>{l&&e.target===e.currentTarget&&t()},children:xa.jsx("div",{className:h,children:a})})},dw=({title:e,subtitle:t,icon:a,onClose:n,theme:s="modern",showCloseButton:r=!0})=>{const i="retro"===s?"bg-ft2-header border-ft2-border text-ft2-highlight":"bg-dark-bgSecondary border-dark-border text-text-primary",o="retro"===s?"border-b-2":"border-b",l="retro"===s?"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none":"p-2 rounded-lg hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors focus:outline-none";return xa.jsxs("div",{className:`flex items-center justify-between px-4 py-3 ${o} ${i}`,children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[a&&xa.jsx("div",{className:"text-accent-primary",children:a}),xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("h2",{className:"font-bold tracking-wide "+("retro"===s?"text-sm":"text-base"),children:e}),t&&xa.jsx("p",{className:"text-text-secondary "+("retro"===s?"text-xs":"text-sm"),children:t})]})]}),r&&n&&xa.jsx("button",{onClick:n,className:l,"aria-label":"Close",title:"Close (Esc)",children:xa.jsx(Ee,{size:16})})]})},pw=({children:e,theme:t="modern",align:a="right"})=>{const n="retro"===t?"bg-ft2-header border-ft2-border":"bg-dark-bgSecondary border-dark-border",s="retro"===t?"border-t-2":"border-t";return xa.jsx("div",{className:`flex gap-2 px-4 py-3 ${s} ${n} ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[a]}`,children:e})},hw=[{value:"volume",label:"Volume",min:0,max:64},{value:"cutoff",label:"Cutoff",min:0,max:127},{value:"resonance",label:"Resonance",min:0,max:127},{value:"envMod",label:"Env Mod",min:0,max:127},{value:"pan",label:"Pan",min:-100,max:100}],mw=[{value:"linear",label:"Linear",description:"Constant rate of change"},{value:"log",label:"Logarithmic",description:"Fast start, gradual end"},{value:"exp",label:"Exponential",description:"Gradual start, fast end"},{value:"scurve",label:"S-Curve",description:"Smooth ease in/out"}],fw=({isOpen:e,onClose:t})=>{const{selection:a,interpolateSelection:n}=tf(),[r,i]=s.useState("volume"),[o,l]=s.useState(64),[c,u]=s.useState(0),[d,p]=s.useState("linear"),h=hw.find(e=>e.value===r);return xa.jsxs(uw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[xa.jsx(dw,{title:"Interpolate Selection",icon:xa.jsx(it,{size:18}),onClose:t,theme:"modern"}),xa.jsxs("div",{className:"p-4 space-y-4",children:[xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Column"}),xa.jsx("select",{value:r,onChange:e=>(e=>{i(e);const t=hw.find(t=>t.value===e);"pan"===e?(l(-100),u(100)):(l(t.max),u(0))})(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:hw.map(e=>xa.jsx("option",{value:e.value,children:e.label},e.value))})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["Start Value (",h.min," - ",h.max,")"]}),xa.jsx("input",{type:"number",value:o,onChange:e=>l(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["End Value (",h.min," - ",h.max,")"]}),xa.jsx("input",{type:"number",value:c,onChange:e=>u(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Curve"}),xa.jsx("div",{className:"grid grid-cols-4 gap-1",children:mw.map(e=>xa.jsx("button",{onClick:()=>p(e.value),className:"px-2 py-1.5 text-xs rounded border transition-colors "+(d===e.value?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),title:e.description,children:e.label},e.value))}),xa.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:mw.find(e=>e.value===d)?.description})]}),!a&&xa.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),xa.jsxs(pw,{theme:"modern",align:"right",children:[xa.jsx(Dv,{variant:"ghost",onClick:t,children:"Cancel"}),xa.jsx(Dv,{variant:"primary",onClick:()=>{a?(n(r,o,c,d),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},gw=({isOpen:e,onClose:t})=>{const{selection:a,humanizeSelection:n}=tf(),[r,i]=s.useState(15);return xa.jsxs(uw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[xa.jsx(dw,{title:"Humanize Selection",icon:xa.jsx(rt,{size:18}),onClose:t,theme:"modern"}),xa.jsxs("div",{className:"p-4 space-y-4",children:[xa.jsx("p",{className:"text-xs text-text-muted",children:"Add random variation to volume values to create a more human feel."}),xa.jsxs("div",{children:[xa.jsxs("label",{className:"block text-xs text-text-muted mb-2",children:["Volume Variation: ",xa.jsxs("span",{className:"text-accent-primary font-mono",children:[r,"%"]})]}),xa.jsx("input",{type:"range",value:r,onChange:e=>i(parseInt(e.target.value)),min:0,max:50,className:"w-full accent-accent-primary"}),xa.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-1",children:[xa.jsx("span",{children:"0% (none)"}),xa.jsx("span",{children:"50% (max)"})]})]}),xa.jsx("div",{className:"bg-dark-bg rounded p-3 text-xs text-text-secondary",children:xa.jsxs("p",{children:["Each note's volume will be randomly adjusted by up to ",r,"% of its current value."]})}),!a&&xa.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),xa.jsxs(pw,{theme:"modern",align:"right",children:[xa.jsx(Dv,{variant:"ghost",onClick:t,children:"Cancel"}),xa.jsx(Dv,{variant:"primary",onClick:()=>{a?(n(r),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},yw=({isOpen:e,onClose:t})=>{const{patterns:a,currentPatternIndex:n,selection:r}=tf(),[i,o]=s.useState("note"),[l,c]=s.useState("pattern"),[u,d]=s.useState(""),[p,h]=s.useState(""),[m,f]=s.useState(null),[g,y]=s.useState(null),b=a[n];return xa.jsxs(uw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[xa.jsx(dw,{title:"Find & Replace",icon:xa.jsx(St,{size:18}),onClose:t,theme:"modern"}),xa.jsxs("div",{className:"p-4 space-y-4",children:[xa.jsx("div",{className:"flex gap-2",children:["note","instrument","effect"].map(e=>xa.jsx("button",{onClick:()=>o(e),className:"flex-1 px-3 py-2 text-xs rounded transition-colors "+(i===e?"bg-accent-primary text-white":"bg-dark-bg text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Scope"}),xa.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[xa.jsxs("option",{value:"selection",disabled:!r,children:["Selection ",!r&&"(none)"]}),xa.jsx("option",{value:"pattern",children:"Current Pattern"}),xa.jsx("option",{value:"all",children:"All Patterns"})]})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Find"}),xa.jsxs("div",{className:"relative",children:[xa.jsx(St,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),xa.jsx("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"note"===i?"e.g., C-4":"instrument"===i?"e.g., 01":"e.g., A0F",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Replace with (empty to clear)"}),xa.jsxs("div",{className:"relative",children:[xa.jsx(Mt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),xa.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"Leave empty to clear",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),null!==m&&xa.jsxs("p",{className:"text-xs text-accent-primary",children:["Found ",m," match",1!==m?"es":""]}),null!==g&&xa.jsxs("p",{className:"text-xs text-accent-success",children:["Replaced ",g," occurrence",1!==g?"s":""]})]}),xa.jsxs(pw,{theme:"modern",align:"right",children:[xa.jsx(Dv,{variant:"ghost",onClick:t,children:"Close"}),xa.jsx(Dv,{variant:"default",onClick:()=>{let e=0;const t="all"===l?a:[b];for(const a of t)for(const t of a.channels)for(let n=0;n<a.length;n++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),s=Math.max(r.startChannel,r.endChannel),i=Math.min(r.startRow,r.endRow),o=Math.max(r.startRow,r.endRow),l=a.channels.indexOf(t);if(l<e||l>s||n<i||n>o)continue}const s=t.rows[n];if("note"===i&&s.note&&0!==s.note&&97!==s.note){Gn(s.note).toLowerCase().includes(u.toLowerCase())&&e++}else if("instrument"===i&&0!==s.instrument){s.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&e++}else if("effect"===i&&(0!==s.effTyp||0!==s.eff)){$n(s.effTyp,s.eff).toLowerCase().includes(u.toLowerCase())&&e++}}f(e),y(null)},disabled:!u,children:"Find"}),xa.jsx(Dv,{variant:"primary",onClick:()=>{if(!u)return;let e=0;tf.setState(t=>{const a="all"===l?t.patterns:[t.patterns[n]];for(const n of a)for(let t=0;t<n.channels.length;t++){const a=n.channels[t];for(let s=0;s<n.length;s++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),a=Math.max(r.startChannel,r.endChannel),n=Math.min(r.startRow,r.endRow),i=Math.max(r.startRow,r.endRow);if(t<e||t>a||s<n||s>i)continue}const n=a.rows[s];if("note"===i&&n.note&&0!==n.note&&97!==n.note){Gn(n.note).toLowerCase().includes(u.toLowerCase())&&(n.note=""===p?0:Un(p.toUpperCase()),e++)}else if("instrument"===i&&0!==n.instrument){n.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&(n.instrument=""===p?0:parseInt(p,16)||0,e++)}else if("effect"===i&&(0!==n.effTyp||0!==n.eff)){if($n(n.effTyp,n.eff).toLowerCase().includes(u.toLowerCase())){if(""===p)n.effTyp=0,n.eff=0;else{const[e,t]=Kn(p.toUpperCase());n.effTyp=e,n.eff=t}e++}}}}}),y(e),f(null)},disabled:!u,children:"Replace All"})]})]})};class bw{context=null;gain=null;processNode=null;config;handlers=new Map;initialized=!1;initError=null;initPromise=null;meta=null;duration=0;currentTime=0;order=0;pattern=0;row=0;constructor(e={}){this.config={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,...e}}async ensureInitialized(){return!!this.initialized||!this.initError&&(this.initPromise?(await this.initPromise,this.initialized):(this.initPromise=this.initWorklet(),await this.initPromise,this.initialized))}async initWorklet(){try{this.context=new AudioContext,this.gain=this.context.createGain(),this.gain.gain.value=1;const e="/DEViLBOX/";await this.context.audioWorklet.addModule(`${e}chiptune3/chiptune3.worklet.js`),this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.processNode.connect(this.gain),this.gain.connect(this.context.destination),this.initialized=!0,this.fireEvent("onInitialized")}catch(e){const t=e instanceof Error?e.message:String(e);this.initError=t,this.fireEvent("onError",{type:"init",message:t})}}handleMessage(e){const{cmd:t,meta:a,pos:n,order:s,pattern:r,row:i,val:o}=e.data;switch(t){case"meta":this.meta=a,this.duration=a?.dur||0,this.fireEvent("onMetadata",a);break;case"pos":this.currentTime=n,this.order=s,this.pattern=r,this.row=i,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:o})}}fireEvent(e,t){const a=this.handlers.get(e);a&&a.forEach(e=>e(t))}addHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}onInitialized(e){this.initialized?e():this.initError?this.fireEvent("onError",{type:"init",message:this.initError}):(this.addHandler("onInitialized",e),this.ensureInitialized())}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}async play(e){await this.ensureInitialized()&&this.processNode&&this.context?("suspended"===this.context.state&&await this.context.resume(),this.processNode.port.postMessage({cmd:"play",val:e})):this.fireEvent("onError",{type:"not_initialized"})}stop(){this.processNode?.port.postMessage({cmd:"stop"})}pause(){this.processNode?.port.postMessage({cmd:"pause"})}unpause(){this.processNode?.port.postMessage({cmd:"unpause"})}setVol(e){this.gain&&(this.gain.gain.value=e)}setPos(e){this.processNode?.port.postMessage({cmd:"setPos",val:e})}setRepeatCount(e){this.processNode?.port.postMessage({cmd:"repeatCount",val:e})}isAvailable(){return this.initialized&&!this.initError}getInitError(){return this.initError}}async function vw(e){const t=new DataView(e);let a=0;const n=function(e,t){const a=Nw(e,t,17);if("Extended Module: "!==a)throw new Error("Invalid XM file: incorrect header signature");const n=Nw(e,t+17,20).trim();t+=38;const s=Nw(e,t,20).trim();t+=20;const r=e.getUint16(t,!0);t+=2;const i=e.getUint32(t,!0);t+=4;const o=e.getUint16(t,!0);t+=2;const l=e.getUint16(t,!0);t+=2;const c=e.getUint16(t,!0);t+=2;const u=e.getUint16(t,!0);t+=2;const d=e.getUint16(t,!0);t+=2;const p=e.getUint16(t,!0);t+=2;const h=e.getUint16(t,!0);t+=2;const m=e.getUint16(t,!0);t+=2;const f=[];for(let g=0;g<256;g++)f.push(e.getUint8(t+g));return{idText:a,moduleName:n,trackerName:s,versionNumber:r,headerSize:i,songLength:o,restartPosition:l,channelCount:c,patternCount:u,instrumentCount:d,flags:p,defaultTempo:h,defaultBPM:m,patternOrderTable:f}}(t,a);a+=n.headerSize;const s=[];for(let o=0;o<n.patternCount;o++){const e=xw(t,a,n.channelCount);s.push(e.notes),a+=e.totalSize}const r=[];for(let o=0;o<n.instrumentCount;o++){const e=ww(t,a);e.parsed.id=o+1,e.parsed.samples.forEach((e,t)=>{e.id=o+1}),r.push(e.parsed),a+=e.totalSize}const i={sourceFormat:"XM",sourceFile:n.moduleName,importedAt:(new Date).toISOString(),originalChannelCount:n.channelCount,originalPatternCount:n.patternCount,originalInstrumentCount:n.instrumentCount,modData:{moduleType:"XM",initialSpeed:n.defaultTempo,initialBPM:n.defaultBPM,amigaPeriods:!(1&n.flags),channelNames:Array.from({length:n.channelCount},(e,t)=>`Channel ${t+1}`),songLength:n.songLength,restartPosition:n.restartPosition,patternOrderTable:n.patternOrderTable},xmData:{frequencyType:1&n.flags?"linear":"amiga",defaultPanning:Array.from({length:n.channelCount},()=>128)},originalSamples:{},envelopes:{}};return r.forEach(e=>{e.samples.forEach(e=>{i.originalSamples[e.id]=e}),i.envelopes[e.id]={volumeEnvelope:e.volumeEnvelope,panningEnvelope:e.panningEnvelope,autoVibrato:e.autoVibrato,fadeout:e.fadeout}}),{header:n,patterns:s,instruments:r,metadata:i}}function xw(e,t,a){const n=t;e.getUint32(t,!0),t+=4,e.getUint8(t),t+=1;const s=e.getUint16(t,!0)||64;t+=2;const r=e.getUint16(t,!0);t+=2;const i=[],o=new Uint8Array(e.buffer,t,r);t+=r;let l=0;for(let c=0;c<s;c++){const e=[];for(let t=0;t<a;t++){const t={note:0,instrument:0,volume:0,effectType:0,effectParam:0};if(l>=o.length){e.push(t);continue}const a=o[l++];128&a?(1&a&&(t.note=o[l++]),2&a&&(t.instrument=o[l++]),4&a&&(t.volume=o[l++]),8&a&&(t.effectType=o[l++]),16&a&&(t.effectParam=o[l++])):(t.note=a,t.instrument=o[l++],t.volume=o[l++],t.effectType=o[l++],t.effectParam=o[l++]),e.push(t)}i.push(e)}return{notes:i,totalSize:t-n}}function ww(e,t){const a=t,n=e.getUint32(t,!0),s=Nw(e,t+=4,22).trim();t+=22,e.getUint8(t),t+=1;const r=e.getUint16(t,!0);t+=2;let i,o,l,c=0,u=[],d=0;if(r>0){c=e.getUint32(t,!0),t+=4,u=[];for(let i=0;i<96;i++)u.push(e.getUint8(t+i));i=kw(e,t+=96),o=kw(e,t+=48),t+=48;const a=e.getUint8(t);t+=1;const n=e.getUint8(t);t+=1,i.enabled=!!(1&a),o.enabled=!!(1&n);const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const p=e.getUint8(t);t+=1;const h=e.getUint8(t);t+=1,l={type:["sine","square","rampDown","rampUp"][s],sweep:r,depth:p,rate:h},d=e.getUint16(t,!0),t+=2,t+=22}t=a+n;const p=[];for(let m=0;m<r;m++)p.push(Sw(e,t)),t+=c;const h=[];for(let m=0;m<r;m++){const a=p[m],n=Mw(e,t,a);t+=a.length,h.push({id:m,name:a.name,pcmData:n,loopStart:a.loopStart/(16&a.type?2:1),loopLength:a.loopLength/(16&a.type?2:1),loopType:3&a.type?1==(3&a.type)?"forward":"pingpong":"none",volume:a.volume,finetune:a.finetune,relativeNote:a.relativeNote,panning:a.panning,bitDepth:16&a.type?16:8,sampleRate:44100,length:a.length/(16&a.type?2:1)})}return{parsed:{id:0,name:s,samples:h,volumeEnvelope:i,panningEnvelope:o,autoVibrato:l,fadeout:d,volumeType:"envelope",panningType:"envelope"},totalSize:t-a}}function kw(e,t){const a=[];for(let o=0;o<12;o++){const n=e.getUint16(t+4*o,!0),s=e.getUint16(t+4*o+2,!0);a.push({tick:n,value:s})}const n=e.getUint8(t+48),s=e.getUint8(t+49),r=e.getUint8(t+50),i=e.getUint8(t+51);return{enabled:!1,points:a.slice(0,n),sustainPoint:n>0?s:null,loopStartPoint:n>0?r:null,loopEndPoint:n>0?i:null}}function Sw(e,t){return{length:e.getUint32(t,!0),loopStart:e.getUint32(t+4,!0),loopLength:e.getUint32(t+8,!0),volume:e.getUint8(t+12),finetune:e.getInt8(t+13),type:e.getUint8(t+14),panning:e.getUint8(t+15),relativeNote:e.getInt8(t+16),reserved:e.getUint8(t+17),name:Nw(e,t+18,22).trim()}}function Mw(e,t,a){const n=!!(16&a.type),s=a.length;if(n){const a=new Int16Array(s/2);let n=0;for(let s=0;s<a.length;s++){n+=e.getInt16(t+2*s,!0),a[s]=n}return a.buffer}{const a=new Int8Array(s);let n=0;for(let s=0;s<a.length;s++){n+=e.getInt8(t+s),a[s]=n}return a.buffer}}function Nw(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e.getUint8(t+s);if(0===a)break;n.push(a)}return String.fromCharCode(...n)}const Cw={"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,"4CHN":4,"6CHN":6,"8CHN":8,OCTA:8,CD81:8,"2CHN":2,TDZ1:1,TDZ2:2,TDZ3:3};async function Ew(e){const t=new DataView(e);let a=0;const n=function(e){let t=0;const a=Tw(e,t,20).trim();t+=20;const n=[];for(let c=0;c<31;c++){const a=Tw(e,t,22).trim(),s=e.getUint16(t+22,!1),r=15&e.getUint8(t+24),i=Math.min(e.getUint8(t+25),64),o=e.getUint16(t+26,!1),l=e.getUint16(t+28,!1);n.push({name:a,length:s,finetune:r>7?r-16:r,volume:i,loopStart:o,loopLength:l}),t+=30}const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const i=[];let o=0;for(let c=0;c<128;c++){const a=e.getUint8(t+c);i.push(a),c<s&&a>o&&(o=a)}t+=128;const l=Tw(e,t,4);return{title:a,samples:n,songLength:s,restartPosition:r,patternOrderTable:i,formatTag:l,channelCount:Cw[l]||4,patternCount:o+1}}(t);a=1084;const s=[];for(let c=0;c<n.patternCount;c++){const e=Pw(t,a,n.channelCount);s.push(e),a+=64*n.channelCount*4}const{initialSpeed:r,initialBPM:i}=function(e,t){let a=6,n=125,s=!1,r=!1;const i=[];for(let u=0;u<e.length;u++){const t=e[u];if(t)for(let e=0;e<t.length;e++){const a=t[e];if(a)for(let t=0;t<a.length;t++){const n=a[t];15===n.effect&&0!==n.effectParam&&i.push({pat:u,row:e,ch:t,param:n.effectParam})}}}i.length;const o=t[0],l=e[o];if(!l)return{initialSpeed:a,initialBPM:n};const c=Math.min(16,l.length);for(let u=0;u<c&&(!s||!r);u++){const e=l[u];if(e)for(const t of e)if(15===t.effect){const e=t.effectParam;if(0===e)continue;e<32?s||(a=e,s=!0):r||(n=e,r=!0)}}return{initialSpeed:a,initialBPM:n}}(s,n.patternOrderTable),o=[];for(let c=0;c<31;c++){const e=n.samples[c];if(0===e.length)continue;const s=_w(t,a,e);a+=2*e.length;const r=2*e.loopStart,i=2*e.loopLength,l=c+1,u={id:l,name:e.name,pcmData:s,loopStart:r,loopLength:i,loopType:e.loopLength>1?"forward":"none",volume:e.volume,finetune:e.finetune,relativeNote:0,panning:128,bitDepth:8,sampleRate:8363,length:2*e.length};o.push({id:l,name:e.name,samples:[u],fadeout:0,volumeType:"none",panningType:"none"})}const l={sourceFormat:"MOD",sourceFile:n.title,importedAt:(new Date).toISOString(),originalChannelCount:n.channelCount,originalPatternCount:n.patternCount,originalInstrumentCount:o.length,modData:{moduleType:n.formatTag,initialSpeed:r,initialBPM:i,amigaPeriods:!0,channelNames:Array.from({length:n.channelCount},(e,t)=>`Channel ${t+1}`),songLength:n.songLength,restartPosition:n.restartPosition,patternOrderTable:n.patternOrderTable},originalSamples:{},envelopes:{}};return o.forEach(e=>{e.samples.forEach(e=>{l.originalSamples[e.id]=e})}),{header:n,patterns:s,instruments:o,metadata:l}}function Pw(e,t,a){const n=[];for(let s=0;s<64;s++){const s=[];for(let n=0;n<a;n++){const a=e.getUint8(t++),n=e.getUint8(t++),r=e.getUint8(t++),i=(15&a)<<8|n,o=240&a|(240&r)>>4,l=15&r,c=e.getUint8(t++);s.push({period:i,instrument:o,effect:l,effectParam:c})}n.push(s)}return n}function _w(e,t,a){const n=2*a.length,s=new Int8Array(n);for(let r=0;r<n;r++)s[r]=e.getInt8(t+r);return s.buffer}function Tw(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e.getUint8(t+s);if(0===a)break;n.push(a)}return String.fromCharCode(...n)}function Aw(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ow=256,Iw=286,Dw=30,Fw=15,Rw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jw=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Lw=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Bw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vw=new Array(576);Aw(Vw);const zw=new Array(60);Aw(zw);const Uw=new Array(512);Aw(Uw);const Gw=new Array(256);Aw(Gw);const Ww=new Array(29);Aw(Ww);const Hw=new Array(Dw);function Kw(e,t,a,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let $w,qw,Xw;function Yw(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Aw(Hw);const Qw=e=>e<256?Uw[e]:Uw[256+(e>>>7)],Zw=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Jw=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,Zw(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},ek=(e,t,a)=>{Jw(e,a[2*t],a[2*t+1])},tk=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},ak=(e,t,a)=>{const n=new Array(16);let s,r,i=0;for(s=1;s<=Fw;s++)i=i+a[s-1]<<1,n[s]=i;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=tk(n[t]++,t))}},nk=e=>{let t;for(t=0;t<Iw;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Dw;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},sk=e=>{e.bi_valid>8?Zw(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},rk=(e,t,a,n)=>{const s=2*t,r=2*a;return e[s]<e[r]||e[s]===e[r]&&n[t]<=n[a]},ik=(e,t,a)=>{const n=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&rk(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!rk(t,n,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=n},ok=(e,t,a)=>{let n,s,r,i,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,s=e.pending_buf[e.sym_buf+o++],0===n?ek(e,s,t):(r=Gw[s],ek(e,r+Ow+1,t),i=Rw[r],0!==i&&(s-=Ww[r],Jw(e,s,i)),n--,r=Qw(n),ek(e,r,a),i=jw[r],0!==i&&(n-=Hw[r],Jw(e,n,i)))}while(o<e.sym_next);ek(e,256,t)},lk=(e,t)=>{const a=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let i,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<r;i++)0!==a[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,a[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=n[2*l+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)ik(e,a,i);l=r;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ik(e,a,1),o=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=o,a[2*l]=a[2*i]+a[2*o],e.depth[l]=(e.depth[i]>=e.depth[o]?e.depth[i]:e.depth[o])+1,a[2*i+1]=a[2*o+1]=l,e.heap[1]=l++,ik(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,d,p,h,m,f=0;for(p=0;p<=Fw;p++)e.bl_count[p]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],p=a[2*a[2*u+1]+1]+1,p>l&&(p=l,f++),a[2*u+1]=p,u>n||(e.bl_count[p]++,h=0,u>=o&&(h=i[u-o]),m=a[2*u],e.opt_len+=m*(p+h),r&&(e.static_len+=m*(s[2*u+1]+h)));if(0!==f){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(p=l;0!==p;p--)for(u=e.bl_count[p];0!==u;)d=e.heap[--c],d>n||(a[2*d+1]!==p&&(e.opt_len+=(p-a[2*d+1])*a[2*d],a[2*d+1]=p),u--)}})(e,t),ak(a,c,e.bl_count)},ck=(e,t,a)=>{let n,s,r=-1,i=t[1],o=0,l=7,c=4;for(0===i&&(l=138,c=3),t[2*(a+1)+1]=65535,n=0;n<=a;n++)s=i,i=t[2*(n+1)+1],++o<l&&s===i||(o<c?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===i?(l=138,c=3):s===i?(l=6,c=3):(l=7,c=4))},uk=(e,t,a)=>{let n,s,r=-1,i=t[1],o=0,l=7,c=4;for(0===i&&(l=138,c=3),n=0;n<=a;n++)if(s=i,i=t[2*(n+1)+1],!(++o<l&&s===i)){if(o<c)do{ek(e,s,e.bl_tree)}while(0!==--o);else 0!==s?(s!==r&&(ek(e,s,e.bl_tree),o--),ek(e,16,e.bl_tree),Jw(e,o-3,2)):o<=10?(ek(e,17,e.bl_tree),Jw(e,o-3,3)):(ek(e,18,e.bl_tree),Jw(e,o-11,7));o=0,r=s,0===i?(l=138,c=3):s===i?(l=6,c=3):(l=7,c=4)}};let dk=!1;const pk=(e,t,a,n)=>{Jw(e,0+(n?1:0),3),sk(e),Zw(e,a),Zw(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var hk={_tr_init:e=>{dk||((()=>{let e,t,a,n,s;const r=new Array(16);for(a=0,n=0;n<28;n++)for(Ww[n]=a,e=0;e<1<<Rw[n];e++)Gw[a++]=n;for(Gw[a-1]=n,s=0,n=0;n<16;n++)for(Hw[n]=s,e=0;e<1<<jw[n];e++)Uw[s++]=n;for(s>>=7;n<Dw;n++)for(Hw[n]=s<<7,e=0;e<1<<jw[n]-7;e++)Uw[256+s++]=n;for(t=0;t<=Fw;t++)r[t]=0;for(e=0;e<=143;)Vw[2*e+1]=8,e++,r[8]++;for(;e<=255;)Vw[2*e+1]=9,e++,r[9]++;for(;e<=279;)Vw[2*e+1]=7,e++,r[7]++;for(;e<=287;)Vw[2*e+1]=8,e++,r[8]++;for(ak(Vw,287,r),e=0;e<Dw;e++)zw[2*e+1]=5,zw[2*e]=tk(e,5);$w=new Kw(Vw,Rw,257,Iw,Fw),qw=new Kw(zw,jw,0,Dw,Fw),Xw=new Kw(new Array(0),Lw,0,19,7)})(),dk=!0),e.l_desc=new Yw(e.dyn_ltree,$w),e.d_desc=new Yw(e.dyn_dtree,qw),e.bl_desc=new Yw(e.bl_tree,Xw),e.bi_buf=0,e.bi_valid=0,nk(e)},_tr_stored_block:pk,_tr_flush_block:(e,t,a,n)=>{let s,r,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ow;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),lk(e,e.l_desc),lk(e,e.d_desc),i=(e=>{let t;for(ck(e,e.dyn_ltree,e.l_desc.max_code),ck(e,e.dyn_dtree,e.d_desc.max_code),lk(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Bw[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=a+5,a+4<=s&&-1!==t?pk(e,t,a,n):4===e.strategy||r===s?(Jw(e,2+(n?1:0),3),ok(e,Vw,zw)):(Jw(e,4+(n?1:0),3),((e,t,a,n)=>{let s;for(Jw(e,t-257,5),Jw(e,a-1,5),Jw(e,n-4,4),s=0;s<n;s++)Jw(e,e.bl_tree[2*Bw[s]+1],3);uk(e,e.dyn_ltree,t-1),uk(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),ok(e,e.dyn_ltree,e.dyn_dtree)),nk(e),n&&sk(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(Gw[a]+Ow+1)]++,e.dyn_dtree[2*Qw(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Jw(e,2,3),ek(e,256,Vw),(e=>{16===e.bi_valid?(Zw(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var mk=(e,t,a,n)=>{let s=65535&e,r=e>>>16&65535,i=0;for(;0!==a;){i=a>2e3?2e3:a,a-=i;do{s=s+t[n++]|0,r=r+s|0}while(--i);s%=65521,r%=65521}return s|r<<16};const fk=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var gk=(e,t,a,n)=>{const s=fk,r=n+a;e^=-1;for(let i=n;i<r;i++)e=e>>>8^s[255&(e^t[i])];return-1^e},yk={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},bk={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vk,_tr_stored_block:xk,_tr_flush_block:wk,_tr_tally:kk,_tr_align:Sk}=hk,{Z_NO_FLUSH:Mk,Z_PARTIAL_FLUSH:Nk,Z_FULL_FLUSH:Ck,Z_FINISH:Ek,Z_BLOCK:Pk,Z_OK:_k,Z_STREAM_END:Tk,Z_STREAM_ERROR:Ak,Z_DATA_ERROR:Ok,Z_BUF_ERROR:Ik,Z_DEFAULT_COMPRESSION:Dk,Z_FILTERED:Fk,Z_HUFFMAN_ONLY:Rk,Z_RLE:jk,Z_FIXED:Lk,Z_DEFAULT_STRATEGY:Bk,Z_UNKNOWN:Vk,Z_DEFLATED:zk}=bk,Uk=258,Gk=262,Wk=42,Hk=113,Kk=666,$k=(e,t)=>(e.msg=yk[t],t),qk=e=>2*e-(e>4?9:0),Xk=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Yk=e=>{let t,a,n,s=e.w_size;t=e.hash_size,n=t;do{a=e.head[--n],e.head[n]=a>=s?a-s:0}while(--t);t=s,n=t;do{a=e.prev[--n],e.prev[n]=a>=s?a-s:0}while(--t)};let Qk=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const Zk=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},Jk=(e,t)=>{wk(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Zk(e.strm)},eS=(e,t)=>{e.pending_buf[e.pending++]=t},tS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},aS=(e,t,a,n)=>{let s=e.avail_in;return s>n&&(s=n),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=mk(e.adler,t,s,a):2===e.state.wrap&&(e.adler=gk(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},nS=(e,t)=>{let a,n,s=e.max_chain_length,r=e.strstart,i=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-Gk?e.strstart-(e.w_size-Gk):0,c=e.window,u=e.w_mask,d=e.prev,p=e.strstart+Uk;let h=c[r+i-1],m=c[r+i];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,c[a+i]===m&&c[a+i-1]===h&&c[a]===c[r]&&c[++a]===c[r+1]){r+=2,a++;do{}while(c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&r<p);if(n=Uk-(p-r),r=p-Uk,n>i){if(e.match_start=t,i=n,n>=o)break;h=c[r+i-1],m=c[r+i]}}}while((t=d[t&u])>l&&0!==--s);return i<=e.lookahead?i:e.lookahead},sS=e=>{const t=e.w_size;let a,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Gk)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Yk(e),n+=t),0===e.strm.avail_in)break;if(a=aS(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Qk(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Qk(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Gk&&0!==e.strm.avail_in)},rS=(e,t)=>{let a,n,s,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i=0,o=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,n=e.strstart-e.block_start,a>n+e.strm.avail_in&&(a=n+e.strm.avail_in),a>s&&(a=s),a<r&&(0===a&&t!==Ek||t===Mk||a!==n+e.strm.avail_in))break;i=t===Ek&&a===n+e.strm.avail_in?1:0,xk(e,0,0,i),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,Zk(e.strm),n&&(n>a&&(n=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,a-=n),a&&(aS(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===i);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?4:t!==Mk&&t!==Ek&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(aS(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,n=e.strstart-e.block_start,(n>=r||(n||t===Ek)&&t!==Mk&&0===e.strm.avail_in&&n<=s)&&(a=n>s?s:n,i=t===Ek&&0===e.strm.avail_in&&a===n?1:0,xk(e,e.block_start,a,i),e.block_start+=a,Zk(e.strm)),i?3:1)},iS=(e,t)=>{let a,n;for(;;){if(e.lookahead<Gk){if(sS(e),e.lookahead<Gk&&t===Mk)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-Gk&&(e.match_length=nS(e,a)),e.match_length>=3)if(n=kk(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+1]);else n=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2},oS=(e,t)=>{let a,n,s;for(;;){if(e.lookahead<Gk){if(sS(e),e.lookahead<Gk&&t===Mk)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-Gk&&(e.match_length=nS(e,a),e.match_length<=5&&(e.strategy===Fk||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,n=kk(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Jk(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=kk(e,0,e.window[e.strstart-1]),n&&Jk(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=kk(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2};function lS(e,t,a,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=n,this.func=s}const cS=[new lS(0,0,0,0,rS),new lS(4,4,8,4,iS),new lS(4,5,16,8,iS),new lS(4,6,32,32,iS),new lS(4,4,16,16,oS),new lS(8,16,32,32,oS),new lS(8,16,128,128,oS),new lS(8,32,128,256,oS),new lS(32,128,258,1024,oS),new lS(32,258,258,4096,oS)];function uS(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=zk,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Xk(this.dyn_ltree),Xk(this.dyn_dtree),Xk(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Xk(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Xk(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Wk&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Hk&&t.status!==Kk?1:0},pS=e=>{if(dS(e))return $k(e,Ak);e.total_in=e.total_out=0,e.data_type=Vk;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Wk:Hk,e.adler=2===t.wrap?0:1,t.last_flush=-2,vk(t),_k},hS=e=>{const t=pS(e);var a;return t===_k&&((a=e.state).window_size=2*a.w_size,Xk(a.head),a.max_lazy_match=cS[a.level].max_lazy,a.good_match=cS[a.level].good_length,a.nice_match=cS[a.level].nice_length,a.max_chain_length=cS[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},mS=(e,t,a,n,s,r)=>{if(!e)return Ak;let i=1;if(t===Dk&&(t=6),n<0?(i=0,n=-n):n>15&&(i=2,n-=16),s<1||s>9||a!==zk||n<8||n>15||t<0||t>9||r<0||r>Lk||8===n&&1!==i)return $k(e,Ak);8===n&&(n=9);const o=new uS;return e.state=o,o.strm=e,o.status=Wk,o.wrap=i,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=r,o.method=a,hS(e)};var fS={deflateInit:(e,t)=>mS(e,t,zk,15,8,Bk),deflateInit2:mS,deflateReset:hS,deflateResetKeep:pS,deflateSetHeader:(e,t)=>dS(e)||2!==e.state.wrap?Ak:(e.state.gzhead=t,_k),deflate:(e,t)=>{if(dS(e)||t>Pk||t<0)return e?$k(e,Ak):Ak;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===Kk&&t!==Ek)return $k(e,0===e.avail_out?Ik:Ak);const n=a.last_flush;if(a.last_flush=t,0!==a.pending){if(Zk(e),0===e.avail_out)return a.last_flush=-1,_k}else if(0===e.avail_in&&qk(t)<=qk(n)&&t!==Ek)return $k(e,Ik);if(a.status===Kk&&0!==e.avail_in)return $k(e,Ik);if(a.status===Wk&&0===a.wrap&&(a.status=Hk),a.status===Wk){let t=zk+(a.w_bits-8<<4)<<8,n=-1;if(n=a.strategy>=Rk||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=n<<6,0!==a.strstart&&(t|=32),t+=31-t%31,tS(a,t),0!==a.strstart&&(tS(a,e.adler>>>16),tS(a,65535&e.adler)),e.adler=1,a.status=Hk,Zk(e),0!==a.pending)return a.last_flush=-1,_k}if(57===a.status)if(e.adler=0,eS(a,31),eS(a,139),eS(a,8),a.gzhead)eS(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),eS(a,255&a.gzhead.time),eS(a,a.gzhead.time>>8&255),eS(a,a.gzhead.time>>16&255),eS(a,a.gzhead.time>>24&255),eS(a,9===a.level?2:a.strategy>=Rk||a.level<2?4:0),eS(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(eS(a,255&a.gzhead.extra.length),eS(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=gk(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(eS(a,0),eS(a,0),eS(a,0),eS(a,0),eS(a,0),eS(a,9===a.level?2:a.strategy>=Rk||a.level<2?4:0),eS(a,3),a.status=Hk,Zk(e),0!==a.pending)return a.last_flush=-1,_k;if(69===a.status){if(a.gzhead.extra){let t=a.pending,n=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+n>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=gk(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,Zk(e),0!==a.pending)return a.last_flush=-1,_k;t=0,n-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending+=n,a.gzhead.hcrc&&a.pending>t&&(e.adler=gk(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=gk(e.adler,a.pending_buf,a.pending-n,n)),Zk(e),0!==a.pending)return a.last_flush=-1,_k;n=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,eS(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=gk(e.adler,a.pending_buf,a.pending-n,n)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=gk(e.adler,a.pending_buf,a.pending-n,n)),Zk(e),0!==a.pending)return a.last_flush=-1,_k;n=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,eS(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=gk(e.adler,a.pending_buf,a.pending-n,n))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(Zk(e),0!==a.pending))return a.last_flush=-1,_k;eS(a,255&e.adler),eS(a,e.adler>>8&255),e.adler=0}if(a.status=Hk,Zk(e),0!==a.pending)return a.last_flush=-1,_k}if(0!==e.avail_in||0!==a.lookahead||t!==Mk&&a.status!==Kk){let n=0===a.level?rS(a,t):a.strategy===Rk?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(sS(e),0===e.lookahead)){if(t===Mk)return 1;break}if(e.match_length=0,a=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===jk?((e,t)=>{let a,n,s,r;const i=e.window;for(;;){if(e.lookahead<=Uk){if(sS(e),e.lookahead<=Uk&&t===Mk)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,n=i[s],n===i[++s]&&n===i[++s]&&n===i[++s])){r=e.strstart+Uk;do{}while(n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&s<r);e.match_length=Uk-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=kk(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2})(a,t):cS[a.level].func(a,t);if(3!==n&&4!==n||(a.status=Kk),1===n||3===n)return 0===e.avail_out&&(a.last_flush=-1),_k;if(2===n&&(t===Nk?Sk(a):t!==Pk&&(xk(a,0,0,!1),t===Ck&&(Xk(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Zk(e),0===e.avail_out))return a.last_flush=-1,_k}return t!==Ek?_k:a.wrap<=0?Tk:(2===a.wrap?(eS(a,255&e.adler),eS(a,e.adler>>8&255),eS(a,e.adler>>16&255),eS(a,e.adler>>24&255),eS(a,255&e.total_in),eS(a,e.total_in>>8&255),eS(a,e.total_in>>16&255),eS(a,e.total_in>>24&255)):(tS(a,e.adler>>>16),tS(a,65535&e.adler)),Zk(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?_k:Tk)},deflateEnd:e=>{if(dS(e))return Ak;const t=e.state.status;return e.state=null,t===Hk?$k(e,Ok):_k},deflateSetDictionary:(e,t)=>{let a=t.length;if(dS(e))return Ak;const n=e.state,s=n.wrap;if(2===s||1===s&&n.status!==Wk||n.lookahead)return Ak;if(1===s&&(e.adler=mk(e.adler,t,a,0)),n.wrap=0,a>=n.w_size){0===s&&(Xk(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(a-n.w_size,a),0),t=e,a=n.w_size}const r=e.avail_in,i=e.next_in,o=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,sS(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=Qk(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,sS(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=i,e.input=o,e.avail_in=r,n.wrap=s,_k},deflateInfo:"pako deflate (from Nodeca project)"};const gS=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yS=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)gS(a,t)&&(e[t]=a[t])}}return e},bS=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const a=new Uint8Array(t);for(let n=0,s=0,r=e.length;n<r;n++){let t=e[n];a.set(t,s),s+=t.length}return a};let vS=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(CT){vS=!1}const xS=new Uint8Array(256);for(let ET=0;ET<256;ET++)xS[ET]=ET>=252?6:ET>=248?5:ET>=240?4:ET>=224?3:ET>=192?2:1;xS[254]=xS[254]=1;var wS=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,n,s,r,i=e.length,o=0;for(s=0;s<i;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<i&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<i&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),a<128?t[r++]=a:a<2048?(t[r++]=192|a>>>6,t[r++]=128|63&a):a<65536?(t[r++]=224|a>>>12,t[r++]=128|a>>>6&63,t[r++]=128|63&a):(t[r++]=240|a>>>18,t[r++]=128|a>>>12&63,t[r++]=128|a>>>6&63,t[r++]=128|63&a);return t},kS=(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,s;const r=new Array(2*a);for(s=0,n=0;n<a;){let t=e[n++];if(t<128){r[s++]=t;continue}let i=xS[t];if(i>4)r[s++]=65533,n+=i-1;else{for(t&=2===i?31:3===i?15:7;i>1&&n<a;)t=t<<6|63&e[n++],i--;i>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&vS)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let n=0;n<t;n++)a+=String.fromCharCode(e[n]);return a})(r,s)},SS=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+xS[e[a]]>t?a:t};var MS=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const NS=Object.prototype.toString,{Z_NO_FLUSH:CS,Z_SYNC_FLUSH:ES,Z_FULL_FLUSH:PS,Z_FINISH:_S,Z_OK:TS,Z_STREAM_END:AS,Z_DEFAULT_COMPRESSION:OS,Z_DEFAULT_STRATEGY:IS,Z_DEFLATED:DS}=bk;function FS(e){this.options=yS({level:OS,method:DS,chunkSize:16384,windowBits:15,memLevel:8,strategy:IS},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MS,this.strm.avail_out=0;let a=fS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==TS)throw new Error(yk[a]);if(t.header&&fS.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?wS(t.dictionary):"[object ArrayBuffer]"===NS.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=fS.deflateSetDictionary(this.strm,e),a!==TS)throw new Error(yk[a]);this._dict_set=!0}}function RS(e,t){const a=new FS(t);if(a.push(e,!0),a.err)throw a.msg||yk[a.err];return a.result}FS.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?_S:CS,"string"==typeof e?a.input=wS(e):"[object ArrayBuffer]"===NS.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),(r===ES||r===PS)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=fS.deflate(a,r),s===AS)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=fS.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===TS;if(0!==a.avail_out){if(r>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},FS.prototype.onData=function(e){this.chunks.push(e)},FS.prototype.onEnd=function(e){e===TS&&(this.result=bS(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jS={Deflate:FS,deflate:RS,deflateRaw:function(e,t){return(t=t||{}).raw=!0,RS(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,RS(e,t)}};const LS=16209;var BS=function(e,t){let a,n,s,r,i,o,l,c,u,d,p,h,m,f,g,y,b,v,x,w,k,S,M,N;const C=e.state;a=e.next_in,M=e.input,n=a+(e.avail_in-5),s=e.next_out,N=e.output,r=s-(t-e.avail_out),i=s+(e.avail_out-257),o=C.dmax,l=C.wsize,c=C.whave,u=C.wnext,d=C.window,p=C.hold,h=C.bits,m=C.lencode,f=C.distcode,g=(1<<C.lenbits)-1,y=(1<<C.distbits)-1;e:do{h<15&&(p+=M[a++]<<h,h+=8,p+=M[a++]<<h,h+=8),b=m[p&g];t:for(;;){if(v=b>>>24,p>>>=v,h-=v,v=b>>>16&255,0===v)N[s++]=65535&b;else{if(!(16&v)){if(64&v){if(32&v){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=LS;break e}b=m[(65535&b)+(p&(1<<v)-1)];continue t}for(x=65535&b,v&=15,v&&(h<v&&(p+=M[a++]<<h,h+=8),x+=p&(1<<v)-1,p>>>=v,h-=v),h<15&&(p+=M[a++]<<h,h+=8,p+=M[a++]<<h,h+=8),b=f[p&y];;){if(v=b>>>24,p>>>=v,h-=v,v=b>>>16&255,16&v){if(w=65535&b,v&=15,h<v&&(p+=M[a++]<<h,h+=8,h<v&&(p+=M[a++]<<h,h+=8)),w+=p&(1<<v)-1,w>o){e.msg="invalid distance too far back",C.mode=LS;break e}if(p>>>=v,h-=v,v=s-r,w>v){if(v=w-v,v>c&&C.sane){e.msg="invalid distance too far back",C.mode=LS;break e}if(k=0,S=d,0===u){if(k+=l-v,v<x){x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}}else if(u<v){if(k+=l+u-v,v-=u,v<x){x-=v;do{N[s++]=d[k++]}while(--v);if(k=0,u<x){v=u,x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}}}else if(k+=u-v,v<x){x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}for(;x>2;)N[s++]=S[k++],N[s++]=S[k++],N[s++]=S[k++],x-=3;x&&(N[s++]=S[k++],x>1&&(N[s++]=S[k++]))}else{k=s-w;do{N[s++]=N[k++],N[s++]=N[k++],N[s++]=N[k++],x-=3}while(x>2);x&&(N[s++]=N[k++],x>1&&(N[s++]=N[k++]))}break}if(64&v){e.msg="invalid distance code",C.mode=LS;break e}b=f[(65535&b)+(p&(1<<v)-1)]}}break}}while(a<n&&s<i);x=h>>3,a-=x,h-=x<<3,p&=(1<<h)-1,e.next_in=a,e.next_out=s,e.avail_in=a<n?n-a+5:5-(a-n),e.avail_out=s<i?i-s+257:257-(s-i),C.hold=p,C.bits=h};const VS=15,zS=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),US=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),GS=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),WS=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var HS=(e,t,a,n,s,r,i,o)=>{const l=o.bits;let c,u,d,p,h,m,f=0,g=0,y=0,b=0,v=0,x=0,w=0,k=0,S=0,M=0,N=null;const C=new Uint16Array(16),E=new Uint16Array(16);let P,_,T,A=null;for(f=0;f<=VS;f++)C[f]=0;for(g=0;g<n;g++)C[t[a+g]]++;for(v=l,b=VS;b>=1&&0===C[b];b--);if(v>b&&(v=b),0===b)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(y=1;y<b&&0===C[y];y++);for(v<y&&(v=y),k=1,f=1;f<=VS;f++)if(k<<=1,k-=C[f],k<0)return-1;if(k>0&&(0===e||1!==b))return-1;for(E[1]=0,f=1;f<VS;f++)E[f+1]=E[f]+C[f];for(g=0;g<n;g++)0!==t[a+g]&&(i[E[t[a+g]]++]=g);if(0===e?(N=A=i,m=20):1===e?(N=zS,A=US,m=257):(N=GS,A=WS,m=0),M=0,g=0,f=y,h=r,x=v,w=0,d=-1,S=1<<v,p=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){P=f-w,i[g]+1<m?(_=0,T=i[g]):i[g]>=m?(_=A[i[g]-m],T=N[i[g]-m]):(_=96,T=0),c=1<<f-w,u=1<<x,y=u;do{u-=c,s[h+(M>>w)+u]=P<<24|_<<16|T}while(0!==u);for(c=1<<f-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,g++,0===--C[f]){if(f===b)break;f=t[a+i[g]]}if(f>v&&(M&p)!==d){for(0===w&&(w=v),h+=y,x=f-w,k=1<<x;x+w<b&&(k-=C[x+w],!(k<=0));)x++,k<<=1;if(S+=1<<x,1===e&&S>852||2===e&&S>592)return 1;d=M&p,s[d]=v<<24|x<<16|h-r}}return 0!==M&&(s[h+M]=f-w<<24|64<<16),o.bits=v,0};const{Z_FINISH:KS,Z_BLOCK:$S,Z_TREES:qS,Z_OK:XS,Z_STREAM_END:YS,Z_NEED_DICT:QS,Z_STREAM_ERROR:ZS,Z_DATA_ERROR:JS,Z_MEM_ERROR:eM,Z_BUF_ERROR:tM,Z_DEFLATED:aM}=bk,nM=16180,sM=16190,rM=16191,iM=16192,oM=16194,lM=16199,cM=16200,uM=16206,dM=16209,pM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function hM(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mM=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<nM||t.mode>16211?1:0},fM=e=>{if(mM(e))return ZS;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=nM,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,XS},gM=e=>{if(mM(e))return ZS;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,fM(e)},yM=(e,t)=>{let a;if(mM(e))return ZS;const n=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ZS:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,gM(e))},bM=(e,t)=>{if(!e)return ZS;const a=new hM;e.state=a,a.strm=e,a.window=null,a.mode=nM;const n=yM(e,t);return n!==XS&&(e.state=null),n};let vM,xM,wM=!0;const kM=e=>{if(wM){vM=new Int32Array(512),xM=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(HS(1,e.lens,0,288,vM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;HS(2,e.lens,0,32,xM,0,e.work,{bits:5}),wM=!1}e.lencode=vM,e.lenbits=9,e.distcode=xM,e.distbits=5},SM=(e,t,a,n)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(a-r.wsize,a),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(t.subarray(a-n,a-n+s),r.wnext),(n-=s)?(r.window.set(t.subarray(a-n,a),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var MM={inflateReset:gM,inflateReset2:yM,inflateResetKeep:fM,inflateInit:e=>bM(e,15),inflateInit2:bM,inflate:(e,t)=>{let a,n,s,r,i,o,l,c,u,d,p,h,m,f,g,y,b,v,x,w,k,S,M=0;const N=new Uint8Array(4);let C,E;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mM(e)||!e.output||!e.input&&0!==e.avail_in)return ZS;a=e.state,a.mode===rM&&(a.mode=iM),i=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,c=a.hold,u=a.bits,d=o,p=l,S=XS;e:for(;;)switch(a.mode){case nM:if(0===a.wrap){a.mode=iM;break}for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(2&a.wrap&&35615===c){0===a.wbits&&(a.wbits=15),a.check=0,N[0]=255&c,N[1]=c>>>8&255,a.check=gk(a.check,N,2,0),c=0,u=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",a.mode=dM;break}if((15&c)!==aM){e.msg="unknown compression method",a.mode=dM;break}if(c>>>=4,u-=4,k=8+(15&c),0===a.wbits&&(a.wbits=k),k>15||k>a.wbits){e.msg="invalid window size",a.mode=dM;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&c?16189:rM,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(a.flags=c,(255&a.flags)!==aM){e.msg="unknown compression method",a.mode=dM;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=dM;break}a.head&&(a.head.text=c>>8&1),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=gk(a.check,N,2,0)),c=0,u=0,a.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.head&&(a.head.time=c),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,a.check=gk(a.check,N,4,0)),c=0,u=0,a.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.head&&(a.head.xflags=255&c,a.head.os=c>>8),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=gk(a.check,N,2,0)),c=0,u=0,a.mode=16184;case 16184:if(1024&a.flags){for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.length=c,a.head&&(a.head.extra_len=c),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=gk(a.check,N,2,0)),c=0,u=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(h=a.length,h>o&&(h=o),h&&(a.head&&(k=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(n.subarray(r,r+h),k)),512&a.flags&&4&a.wrap&&(a.check=gk(a.check,n,h,r)),o-=h,r+=h,a.length-=h),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break e;h=0;do{k=n[r+h++],a.head&&k&&a.length<65536&&(a.head.name+=String.fromCharCode(k))}while(k&&h<o);if(512&a.flags&&4&a.wrap&&(a.check=gk(a.check,n,h,r)),o-=h,r+=h,k)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break e;h=0;do{k=n[r+h++],a.head&&k&&a.length<65536&&(a.head.comment+=String.fromCharCode(k))}while(k&&h<o);if(512&a.flags&&4&a.wrap&&(a.check=gk(a.check,n,h,r)),o-=h,r+=h,k)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(4&a.wrap&&c!==(65535&a.check)){e.msg="header crc mismatch",a.mode=dM;break}c=0,u=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=rM;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}e.adler=a.check=pM(c),c=0,u=0,a.mode=sM;case sM:if(0===a.havedict)return e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,QS;e.adler=a.check=1,a.mode=rM;case rM:if(t===$S||t===qS)break e;case iM:if(a.last){c>>>=7&u,u-=7&u,a.mode=uM;break}for(;u<3;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}switch(a.last=1&c,c>>>=1,u-=1,3&c){case 0:a.mode=16193;break;case 1:if(kM(a),a.mode=lM,t===qS){c>>>=2,u-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=dM}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",a.mode=dM;break}if(a.length=65535&c,c=0,u=0,a.mode=oM,t===qS)break e;case oM:a.mode=16195;case 16195:if(h=a.length,h){if(h>o&&(h=o),h>l&&(h=l),0===h)break e;s.set(n.subarray(r,r+h),i),o-=h,r+=h,l-=h,i+=h,a.length-=h;break}a.mode=rM;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(a.nlen=257+(31&c),c>>>=5,u-=5,a.ndist=1+(31&c),c>>>=5,u-=5,a.ncode=4+(15&c),c>>>=4,u-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=dM;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;u<3;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.lens[P[a.have++]]=7&c,c>>>=3,u-=3}for(;a.have<19;)a.lens[P[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,C={bits:a.lenbits},S=HS(0,a.lens,0,19,a.lencode,0,a.work,C),a.lenbits=C.bits,S){e.msg="invalid code lengths set",a.mode=dM;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;M=a.lencode[c&(1<<a.lenbits)-1],g=M>>>24,y=M>>>16&255,b=65535&M,!(g<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(b<16)c>>>=g,u-=g,a.lens[a.have++]=b;else{if(16===b){for(E=g+2;u<E;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(c>>>=g,u-=g,0===a.have){e.msg="invalid bit length repeat",a.mode=dM;break}k=a.lens[a.have-1],h=3+(3&c),c>>>=2,u-=2}else if(17===b){for(E=g+3;u<E;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=g,u-=g,k=0,h=3+(7&c),c>>>=3,u-=3}else{for(E=g+7;u<E;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=g,u-=g,k=0,h=11+(127&c),c>>>=7,u-=7}if(a.have+h>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=dM;break}for(;h--;)a.lens[a.have++]=k}}if(a.mode===dM)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=dM;break}if(a.lenbits=9,C={bits:a.lenbits},S=HS(1,a.lens,0,a.nlen,a.lencode,0,a.work,C),a.lenbits=C.bits,S){e.msg="invalid literal/lengths set",a.mode=dM;break}if(a.distbits=6,a.distcode=a.distdyn,C={bits:a.distbits},S=HS(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,C),a.distbits=C.bits,S){e.msg="invalid distances set",a.mode=dM;break}if(a.mode=lM,t===qS)break e;case lM:a.mode=cM;case cM:if(o>=6&&l>=258){e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,BS(e,p),i=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,c=a.hold,u=a.bits,a.mode===rM&&(a.back=-1);break}for(a.back=0;M=a.lencode[c&(1<<a.lenbits)-1],g=M>>>24,y=M>>>16&255,b=65535&M,!(g<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(y&&!(240&y)){for(v=g,x=y,w=b;M=a.lencode[w+((c&(1<<v+x)-1)>>v)],g=M>>>24,y=M>>>16&255,b=65535&M,!(v+g<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=v,u-=v,a.back+=v}if(c>>>=g,u-=g,a.back+=g,a.length=b,0===y){a.mode=16205;break}if(32&y){a.back=-1,a.mode=rM;break}if(64&y){e.msg="invalid literal/length code",a.mode=dM;break}a.extra=15&y,a.mode=16201;case 16201:if(a.extra){for(E=a.extra;u<E;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.length+=c&(1<<a.extra)-1,c>>>=a.extra,u-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;M=a.distcode[c&(1<<a.distbits)-1],g=M>>>24,y=M>>>16&255,b=65535&M,!(g<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(!(240&y)){for(v=g,x=y,w=b;M=a.distcode[w+((c&(1<<v+x)-1)>>v)],g=M>>>24,y=M>>>16&255,b=65535&M,!(v+g<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=v,u-=v,a.back+=v}if(c>>>=g,u-=g,a.back+=g,64&y){e.msg="invalid distance code",a.mode=dM;break}a.offset=b,a.extra=15&y,a.mode=16203;case 16203:if(a.extra){for(E=a.extra;u<E;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.offset+=c&(1<<a.extra)-1,c>>>=a.extra,u-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=dM;break}a.mode=16204;case 16204:if(0===l)break e;if(h=p-l,a.offset>h){if(h=a.offset-h,h>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=dM;break}h>a.wnext?(h-=a.wnext,m=a.wsize-h):m=a.wnext-h,h>a.length&&(h=a.length),f=a.window}else f=s,m=i-a.offset,h=a.length;h>l&&(h=l),l-=h,a.length-=h;do{s[i++]=f[m++]}while(--h);0===a.length&&(a.mode=cM);break;case 16205:if(0===l)break e;s[i++]=a.length,l--,a.mode=cM;break;case uM:if(a.wrap){for(;u<32;){if(0===o)break e;o--,c|=n[r++]<<u,u+=8}if(p-=l,e.total_out+=p,a.total+=p,4&a.wrap&&p&&(e.adler=a.check=a.flags?gk(a.check,s,p,i-p):mk(a.check,s,p,i-p)),p=l,4&a.wrap&&(a.flags?c:pM(c))!==a.check){e.msg="incorrect data check",a.mode=dM;break}c=0,u=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(4&a.wrap&&c!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=dM;break}c=0,u=0}a.mode=16208;case 16208:S=YS;break e;case dM:S=JS;break e;case 16210:return eM;default:return ZS}return e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,(a.wsize||p!==e.avail_out&&a.mode<dM&&(a.mode<uM||t!==KS))&&SM(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,a.total+=p,4&a.wrap&&p&&(e.adler=a.check=a.flags?gk(a.check,s,p,e.next_out-p):mk(a.check,s,p,e.next_out-p)),e.data_type=a.bits+(a.last?64:0)+(a.mode===rM?128:0)+(a.mode===lM||a.mode===oM?256:0),(0===d&&0===p||t===KS)&&S===XS&&(S=tM),S},inflateEnd:e=>{if(mM(e))return ZS;let t=e.state;return t.window&&(t.window=null),e.state=null,XS},inflateGetHeader:(e,t)=>{if(mM(e))return ZS;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,XS):ZS},inflateSetDictionary:(e,t)=>{const a=t.length;let n,s,r;return mM(e)?ZS:(n=e.state,0!==n.wrap&&n.mode!==sM?ZS:n.mode===sM&&(s=1,s=mk(s,t,a,0),s!==n.check)?JS:(r=SM(e,t,a,a),r?(n.mode=16210,eM):(n.havedict=1,XS)))},inflateInfo:"pako inflate (from Nodeca project)"};var NM=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const CM=Object.prototype.toString,{Z_NO_FLUSH:EM,Z_FINISH:PM,Z_OK:_M,Z_STREAM_END:TM,Z_NEED_DICT:AM,Z_STREAM_ERROR:OM,Z_DATA_ERROR:IM,Z_MEM_ERROR:DM}=bk;function FM(e){this.options=yS({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MS,this.strm.avail_out=0;let a=MM.inflateInit2(this.strm,t.windowBits);if(a!==_M)throw new Error(yk[a]);if(this.header=new NM,MM.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=wS(t.dictionary):"[object ArrayBuffer]"===CM.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=MM.inflateSetDictionary(this.strm,t.dictionary),a!==_M)))throw new Error(yk[a])}function RM(e,t){const a=new FM(t);if(a.push(e),a.err)throw a.msg||yk[a.err];return a.result}FM.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let r,i,o;if(this.ended)return!1;for(i=t===~~t?t:!0===t?PM:EM,"[object ArrayBuffer]"===CM.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),r=MM.inflate(a,i),r===AM&&s&&(r=MM.inflateSetDictionary(a,s),r===_M?r=MM.inflate(a,i):r===IM&&(r=AM));a.avail_in>0&&r===TM&&a.state.wrap>0&&0!==e[a.next_in];)MM.inflateReset(a),r=MM.inflate(a,i);switch(r){case OM:case IM:case AM:case DM:return this.onEnd(r),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||r===TM))if("string"===this.options.to){let e=SS(a.output,a.next_out),t=a.next_out-e,s=kS(a.output,e);a.next_out=t,a.avail_out=n-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(r!==_M||0!==o){if(r===TM)return r=MM.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},FM.prototype.onData=function(e){this.chunks.push(e)},FM.prototype.onEnd=function(e){e===_M&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=bS(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jM={Inflate:FM,inflate:RM,inflateRaw:function(e,t){return(t=t||{}).raw=!0,RM(e,t)},ungzip:RM};const{Deflate:LM,deflate:BM,deflateRaw:VM,gzip:zM}=jS,{Inflate:UM,inflate:GM,inflateRaw:WM,ungzip:HM}=jM;var KM={Deflate:LM,deflate:BM,deflateRaw:VM,gzip:zM,Inflate:UM,inflate:GM,inflateRaw:WM,ungzip:HM,constants:bk};const $M={0:"ChipSynth",1:"FurnaceOPN",2:"FurnaceGB",3:"FurnaceC64",4:"Sampler",5:"FurnacePCE",6:"FurnaceAY",7:"FurnaceAY",8:"FurnaceTIA",9:"FurnaceSAA",10:"FurnaceVIC",11:"ChipSynth",12:"FurnaceVRC6",13:"FurnaceOPLL",14:"FurnaceOPL",15:"FurnaceFDS",16:"FurnaceVB",17:"FurnaceN163",18:"FurnaceSCC",19:"FurnaceOPZ",20:"ChipSynth",21:"ChipSynth",22:"FurnaceSWAN",23:"FurnaceLynx",24:"FurnaceVERA",25:"FurnaceX1_010",26:"FurnaceVRC6",27:"FurnaceES5506",28:"Sampler",29:"FurnaceSNES",30:"ChipSynth",31:"ChipSynth",32:"FurnaceOPL",33:"FurnaceOPM",34:"FurnaceNES",35:"Sampler",36:"FurnaceOKI",37:"Sampler",38:"Sampler",39:"FurnaceSEGAPCM",40:"FurnaceQSOUND",41:"FurnaceYMZ280B",42:"FurnaceRF5C68",43:"ChipSynth",44:"FurnaceT6W28",45:"FurnaceK007232",46:"FurnaceGA20",47:"ChipSynth",48:"FurnaceSM8521",49:"ChipSynth",50:"FurnaceK053260",52:"FurnaceTED",53:"FurnaceC140",54:"Sampler",55:"FurnaceESFM",56:"ChipSynth",57:"ChipSynth",58:"ChipSynth",59:"Sampler",60:"Sampler",61:"Sampler",62:"ChipSynth",63:"FurnaceC64",64:"FurnaceSUPERVISION",65:"FurnaceUPD1771",66:"FurnaceC64"};const qM=[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],XM=[250,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],YM={2:1,3:0,4:2,5:5,6:34,7:3,71:3,128:6,129:4,130:33,131:1,132:8,133:10,135:29,136:12,137:13,138:15,141:1,142:1,143:14,144:14,145:14,151:9,152:19,154:7,160:1},QM={0:0,1:17,2:10,3:4,4:4,5:6,6:5,7:3,71:3,128:3,129:4,130:8,131:6,132:2,133:4,134:1,135:8,136:3,137:9,138:1,139:3,140:8,141:6,142:16,143:9,144:9,145:18,146:28,147:1,148:4,149:8,150:4,151:6,152:8,153:1,154:3,155:16,156:6,157:6,158:16,159:6,160:9,161:5,162:11,163:11,164:20,165:14,166:17,167:11,168:4,170:4,171:1,172:17,173:2,174:42,175:44,176:16,177:32,178:10,179:12,180:5,181:8,182:9,183:19,184:8,185:3,186:8,187:8,188:8,189:11,190:7,191:4,192:1,193:10,194:18,195:10,196:20,197:20,198:2,199:4,200:3,202:5,203:3,204:4,205:2,206:24,207:16,209:18,212:4,213:6,214:16,215:2,216:16,217:4,222:19,224:19,226:4,227:4,229:4,240:3,241:5,245:7,252:1,253:8};function ZM(e){let t="";for(;!e.isEOF();){const a=e.readUint8();if(0===a)break;t+=String.fromCharCode(a)}return t}async function JM(e){const t=function(e){if(120===e[0])try{return KM.inflate(e)}catch(t){throw new Error("Failed to decompress Furnace file: "+t)}return e}(new Uint8Array(e)),a=new lg(t.buffer),n=a.readMagic(16);if(!n.startsWith("-Furnace module-"))throw new Error(`Invalid Furnace file header: "${n}"`);const s=a.readUint16();a.skip(2);const r=a.readUint32();a.seek(r);const i={name:"",author:"",category:"",systemName:"",tuning:440,masterVol:1,version:s,systemLen:0,systems:[],systemChans:[],systemVol:[],systemPan:[],systemPanFR:[],chans:0,subsongs:[],instruments:[],wavetables:[],samples:[],patterns:new Map,comment:""};return s>=240?await async function(e,t,a){const n=e.readMagic(4);if("INF2"!==n)throw new Error(`Expected INF2 block, got: "${n}"`);if(e.readUint32(),t.name=ZM(e),t.author=ZM(e),t.systemName=ZM(e),t.category=ZM(e),ZM(e),ZM(e),ZM(e),ZM(e),t.tuning=e.readFloat32(),e.readUint8(),t.masterVol=e.readFloat32(),t.chans=e.readUint16(),t.systemLen=e.readUint16(),t.systemLen<1)throw new Error("Zero chips in module!");let s=0;for(let h=0;h<t.systemLen;h++){const a=e.readUint16();t.systems.push(a);const n=e.readUint16();t.systemChans.push(n),s+=n,t.systemVol.push(e.readFloat32()),t.systemPan.push(e.readFloat32()),t.systemPanFR.push(e.readFloat32())}t.chans!==s&&(t.chans=s);const r=e.readUint32();e.skip(4*r),e.readUint8();const i=[],o=[],l=[],c=[],u=[];let d=0,p=!0;for(;p;){switch(e.readUint8()){case 0:p=!1;break;case 1:{const t=e.readUint32();for(let a=0;a<t;a++)c.push(e.readUint32());break}case 2:{const t=e.readUint32();e.skip(4*t);break}case 3:{const t=e.readUint32();e.skip(4*t);break}case 4:{const t=e.readUint32();for(let a=0;a<t;a++)i.push(e.readUint32());break}case 5:{const t=e.readUint32();for(let a=0;a<t;a++)o.push(e.readUint32());break}case 6:{const t=e.readUint32();for(let a=0;a<t;a++)l.push(e.readUint32());break}case 7:{const t=e.readUint32();for(let a=0;a<t;a++)u.push(e.readUint32());break}case 8:e.readUint32(),e.readUint32();break;case 9:e.readUint32(),d=e.readUint32();break;case 10:{const t=e.readUint32();e.skip(4*t);break}default:{const t=e.readUint32();e.skip(4*t);break}}}for(const h of c){e.seek(h);const n=eN(e,t.chans,a);t.subsongs.push(n)}for(let h=0;h<i.length;h++){const a=i[h];e.seek(a);const n=e.getOffset(),s=tN(e),r=e.getOffset()-n;e.seek(n);const o=e.readBytes(r);s.rawBinaryData=o,t.instruments.push(s)}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],a=YM[e]??0;t.instruments.push({name:"Default",type:a,macros:[],samples:[],wavetables:[]})}for(const h of o){e.seek(h);const a=sN(e);t.wavetables.push(a)}for(const h of l){e.seek(h);const n=rN(e,a);t.samples.push(n)}for(const h of u){e.seek(h);const n=iN(e,t.chans,t.subsongs,a),s=`${n.subsong}_${n.channel}_${n.index}`;if(t.patterns.set(s,n),t.patterns.size<=3){if(n.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)){n.rows.findIndex(e=>e.note>=0||e.instrument>=0)}}}if(d>0){e.seek(d);"CMNT"===e.readMagic(4)&&(e.readUint32(),t.comment=ZM(e))}}(a,i,s,t.buffer):await async function(e,t,a){const n=e.readMagic(4);if("INFO"!==n)throw new Error(`Expected INFO block, got: "${n}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8();const r=e.readUint16(),i=e.readUint16(),o=e.readUint16(),l=e.readUint32();const c=[];for(let g=0;g<32;g++){const t=e.readUint8();0!==t&&c.push(t)}t.systems=c.filter(e=>0!==e),t.systemLen=t.systems.length;for(let g=0;g<32;g++){const a=e.readInt8();g<t.systemLen&&t.systemVol.push(a/64)}for(let g=0;g<32;g++){const a=e.readInt8();g<t.systemLen&&t.systemPan.push(a/127)}e.skip(128);t.name=ZM(e),t.author=ZM(e),t.tuning=e.readFloat32(),e.skip(20);const u=[],d=[],p=[],h=[];for(let g=0;g<r;g++)u.push(e.readUint32());for(let g=0;g<i;g++)d.push(e.readUint32());for(let g=0;g<o;g++)p.push(e.readUint32());let m=0;for(const g of t.systems){const e=QM[g]||4;t.systemChans.push(e),m+=e}t.chans=m;for(let g=0;g<l;g++)h.push(e.readUint32());s.orders=[];for(let g=0;g<t.chans;g++){const t=[];for(let a=0;a<s.ordersLen;a++)t.push(e.readUint8());s.orders.push(t)}s.effectColumns=[];for(let g=0;g<t.chans;g++)s.effectColumns.push(e.readUint8());if(a>=39){e.skip(2*t.chans);for(let a=0;a<t.chans;a++)s.channelNames.push(ZM(e));for(let a=0;a<t.chans;a++)s.channelShortNames.push(ZM(e));t.comment=ZM(e)}t.masterVol=a>=59?e.readFloat32():2;a>=70&&e.skip(28);a>=96?(s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16()):e.skip(4);if(a>=95){ZM(e),ZM(e);const t=e.readUint8();e.skip(3);for(let a=0;a<t;a++)e.readUint32()}a>=103&&(ZM(e),ZM(e),ZM(e),ZM(e),ZM(e),ZM(e));if(a>=135){for(let n=0;n<t.systems.length;n++)e.skip(12);const a=e.readUint32();e.skip(4*a)}a>=136&&e.readUint8();a>=138&&e.skip(8);if(a>=139){e.skip(17);const t=e.readUint8();for(let a=0;a<t;a++)e.skip(17)}a>=156&&e.skip(12);t.subsongs.push(s);for(let g=0;g<u.length;g++){const n=u[g];if(0===n)continue;e.seek(n);const s=e.getOffset();try{const n=tN(e,a),r=e.getOffset()-s;e.seek(s);const i=e.readBytes(r);n.rawBinaryData=i,t.instruments.push(n)}catch(f){t.instruments.push({name:"Error",type:0,macros:[],samples:[],wavetables:[]})}}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],a=YM[e]??0;t.instruments.push({name:"Default",type:a,macros:[],samples:[],wavetables:[]})}for(const g of d)if(0!==g){e.seek(g);try{const a=sN(e);t.wavetables.push(a)}catch(f){}}for(const g of p)if(0!==g){e.seek(g);try{const n=rN(e,a);t.samples.push(n)}catch(f){}}for(const g of h)if(0!==g){e.seek(g);try{const n=iN(e,t.chans,t.subsongs,a),s=`${n.subsong}_${n.channel}_${n.index}`;if(t.patterns.set(s,n),t.patterns.size<=3){n.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)}}catch(f){}}}(a,i,s,t.buffer),i}function eN(e,t,a){const n=e.readMagic(4);if("SNG2"!==n&&"SONG"!==n)throw new Error(`Expected SNG2/SONG block, got: "${n}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};if("SNG2"===n){s.hz=e.readFloat32(),s.arpLen=e.readUint8(),e.readUint8(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16();const t=e.readUint8(),a=[];for(let n=0;n<16;n++)a.push(e.readUint16());s.speed1=a[0]||6,s.speed2=t>1?a[1]:s.speed1,s.name=ZM(e),s.comment=ZM(e)}else s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16(),s.name=ZM(e),s.comment=ZM(e);for(let r=0;r<t;r++){const t=[];for(let a=0;a<s.ordersLen;a++)t.push(e.readUint8());s.orders.push(t)}for(let r=0;r<t;r++)s.effectColumns.push(e.readUint8());e.skip(2*t);for(let r=0;r<t;r++)s.channelNames.push(ZM(e));for(let r=0;r<t;r++)s.channelShortNames.push(ZM(e));return a>=240&&e.skip(4*t),s}function tN(e,t){const a=e.readMagic(4),n={name:"",type:0,macros:[],samples:[],wavetables:[]};if("INS2"===a||"FINS"===a)for("INS2"===a&&e.readUint32(),e.readUint16(),n.type=e.readUint16();!e.isEOF();){const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const a=e.readUint16(),s=e.getOffset()+a;switch(t){case"NA":n.name=ZM(e);break;case"FM":n.fm=aN(e);break;case"MA":nN(e,n);break;case"SM":{const t=e.readInt16(),a=e.readUint8(),s=e.readUint8(),r=!!(1&a),i=!!(2&a),o=!!(4&a);if(t>=0&&n.samples.push(t),n.amiga={initSample:t,useNoteMap:r,useSample:i,useWave:o,waveLen:s},r){n.amiga.noteMap=[];const t=new Set(n.samples);for(let a=0;a<120;a++){const a=e.readInt16(),s=e.readInt16();n.amiga.noteMap.push({freq:a,map:s}),s>=0&&!t.has(s)&&(t.add(s),n.samples.push(s))}}break}case"SL":case"LS":{const a="LS"===t?e.readUint16():e.readUint8();for(let s=0;s<a;s++)"LS"===t?n.samples.push(e.readUint16()):n.samples.push(e.readUint8());break}case"WL":case"LW":{const a="LW"===t?e.readUint16():e.readUint8();for(let s=0;s<a;s++)"LW"===t?n.wavetables.push(e.readUint16()):n.wavetables.push(e.readUint8());break}case"GB":{const t=e.readUint8(),a=e.readUint8(),s=e.readUint8(),r=e.readUint8(),i=[];for(let n=0;n<r;n++)i.push({cmd:e.readUint8(),data:e.readInt16()});n.gb={envVol:15&t,envDir:16&t?1:0,envLen:t>>5&7,soundLen:a,softEnv:!!(1&s),alwaysInit:!!(2&s),doubleWave:!!(4&s),hwSeqLen:r,hwSeq:i};break}case"64":{const t=e.readUint8(),a=e.readUint8(),s=e.readUint8(),r=e.readUint8(),i=4095&e.readUint16(),o=e.readUint16();n.c64={triOn:!!(1&t),sawOn:!!(2&t),pulseOn:!!(4&t),noiseOn:!!(8&t),toFilter:!!(16&t),initFilter:!!(64&t),dutyIsAbs:!!(128&t),lp:!!(1&a),bp:!!(4&a),hp:!!(2&a),ch3off:!!(8&a),filterIsAbs:!!(16&a),noTest:!!(32&a),ringMod:!!(64&a),oscSync:!!(128&a),a:s>>4&15,d:15&s,s:r>>4&15,r:15&r,duty:i,cut:4095&o,res:o>>12};break}case"SN":{const t=e.readUint8(),a=e.readUint8(),s=e.readUint8(),r=e.readUint8();n.snes={a:15&t,d:t>>4&7,s:a>>5&7,r:31&a,useEnv:!!(16&s),sus:8&s?1:0,gainMode:7&s,gain:r,d2:0};break}case"N1":{const t=e.readInt32(),a=e.readUint8(),s=e.readUint8(),r=e.readUint8();n.n163={wave:t,wavePos:a,waveLen:s,waveMode:r};break}case"FD":{const t=e.readInt32(),a=e.readInt32(),s=0!==e.readUint8(),r=[];for(let n=0;n<32;n++)r.push(e.readUint8());n.fds={modSpeed:t,modDepth:a,initModTableWithFirstWave:s,modTable:r};break}}e.seek(s)}else{if("INST"!==a)throw new Error(`Unknown instrument format: "${a}"`);e.readUint32(),e.readUint16(),n.type=e.readUint8(),e.readUint8(),n.name=ZM(e),0!==n.type&&1!==n.type||(n.fm=function(e){const t={...kn,operators:[],macros:[],opMacros:[],wavetables:[]};t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),t.fms=7&e.readUint8(),t.ams=3&e.readUint8();const a=e.readUint8();t.ops=a,t.opllPreset=31&e.readUint8(),e.skip(2);for(let n=0;n<4;n++){const s={enabled:n<a,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.skip(10),t.operators.push(s)}return t}(e))}return n}function aN(e,t){const a={...kn,operators:[],macros:[],opMacros:[],wavetables:[]},n=e.readUint8(),s=15&n,r=n>>4&15;a.ops=s;const i=e.readUint8();a.algorithm=i>>4&7,a.feedback=7&i;const o=e.readUint8();a.fms2=o>>5&7,a.ams=o>>3&3,a.fms=7&o;const l=e.readUint8();a.ams2=l>>6&3,a.opllPreset=31&l;for(let c=0;c<s;c++){const t=e.readUint8(),n=e.readUint8(),s=e.readUint8(),i=e.readUint8(),o=e.readUint8(),l=e.readUint8(),u=e.readUint8(),d=e.readUint8(),p={enabled:!!(r>>c&1),mult:15&t,dt:t>>4&7,ksr:!!(t>>7&1),tl:127&n,sus:!!(n>>7&1),ar:31&s,vib:!!(s>>5&1),rs:s>>6&3,dr:31&i,ksl:i>>5&3,am:!!(i>>7&1),egt:!!(o>>7&1),kvs:o>>5&3,d2r:31&o,sl:l>>4&15,rr:15&l,dvb:u>>4&15,ssg:15&u,dam:d>>5&7,dt2:d>>3&3,ws:7&d};a.operators.push(p)}return a}function nN(e,t,a){const n=e.readUint16(),s=e.getOffset()+n;for(;e.getOffset()<s;){const a=e.readUint8();if(255===a)break;const n={code:a,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},s=n.type>>6&3;for(let t=0;t<n.length;t++)switch(s){case 0:n.data.push(e.readUint8());break;case 1:n.data.push(e.readInt8());break;case 2:n.data.push(e.readInt16());break;case 3:n.data.push(e.readInt32())}t.macros.push(n)}}function sN(e){const t=e.readMagic(4);if("WAVE"!==t)throw new Error(`Expected WAVE block, got: "${t}"`);e.readUint32();const a={name:ZM(e),width:e.readUint32(),height:0,data:[]};e.readUint32(),a.height=e.readUint32();for(let n=0;n<a.width;n++)a.data.push(e.readInt32());return a}function rN(e,t){const a=e.readMagic(4),n={name:"",length:0,compatRate:0,c4Rate:0,depth:16,loopStart:-1,loopEnd:-1,loopDirection:0,data:new Int16Array(0)};if("SMP2"===a)if(e.readUint32(),n.name=ZM(e),n.length=e.readUint32(),n.compatRate=e.readUint32(),n.c4Rate=e.readUint32(),n.depth=e.readUint8(),n.loopDirection=t>=123?e.readUint8():0,e.readUint8(),e.readUint8(),n.loopStart=e.readInt32(),n.loopEnd=e.readInt32(),e.skip(16),16===n.depth){const t=new Int16Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt16();n.data=t}else if(8===n.depth){const t=new Int8Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt8();n.data=t}else n.data=e.readBytes(n.length);else{if("SMPL"!==a)throw new Error(`Unknown sample format: "${a}"`);{e.readUint32(),n.name=ZM(e),n.length=e.readUint32(),n.compatRate=e.readUint32(),t<58?(e.readUint16(),e.readUint16()):e.skip(4),n.depth=e.readUint8(),e.readUint8(),t>=32&&(n.c4Rate=e.readUint16()),t>=19&&(n.loopStart=e.readInt32());const a=t<58?2*n.length:n.length;if(16===n.depth){const t=new Int16Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt16();n.data=t}else{const t=new Int8Array(a);for(let n=0;n<a;n++)t[n]=e.readInt8();n.data=t}}}return n}function iN(e,t,a,n){const s=e.readMagic(4),r={subsong:0,channel:0,index:0,name:"",rows:[]};if("PATN"===s){e.readUint32(),r.subsong=e.readUint8(),r.channel=e.readUint8(),r.index=e.readUint16(),n>=51&&(r.name=ZM(e));const t=a[r.subsong]||a[0],s=t?.patLen||64;t?.effectColumns[r.channel];for(let e=0;e<s;e++)r.rows.push({note:-1,octave:0,instrument:-1,volume:-1,effects:[]});let i=0;for(;i<s&&!e.isEOF();){const t=e.readUint8();if(255===t)break;if(128&t){i+=2+(127&t);continue}if(0===t){i++;continue}const a=r.rows[i],n=!!(1&t),s=!!(2&t),o=!!(4&t),l=!!(8&t),c=!!(16&t),u=!!(64&t);let d=0,p=0;if(!!(32&t)&&(d=e.readUint8()),u&&(p=e.readUint8()),n){const t=e.readUint8();t>=180?(a.note=t,a.octave=0):t<180&&(a.note=qM[t]||0,a.octave=XM[t]||0,a.octave>=250&&(a.octave=a.octave-256))}if(s&&(a.instrument=e.readUint8()),o&&(a.volume=e.readUint8()),l){const t=e.readUint8(),n=c?e.readUint8():0;a.effects.push({type:t,value:n})}else c&&e.readUint8();for(let r=1;r<=3;r++){const t=!!(d&1<<2*r+1);if(!!(d&1<<2*r)){const n=e.readUint8(),s=t?e.readUint8():0;a.effects.push({type:n,value:s})}else t&&e.readUint8()}for(let r=4;r<=7;r++){const t=!!(p&1<<2*(r-4)+1);if(!!(p&1<<2*(r-4))){const n=e.readUint8(),s=t?e.readUint8():0;a.effects.push({type:n,value:s})}else t&&e.readUint8()}i++}}else{if("PATR"!==s)throw new Error(`Unknown pattern format: "${s}"`);{e.readUint32(),r.channel=e.readUint16(),r.index=e.readUint16(),n>=95&&(r.subsong=e.readUint16()),e.skip(2);const t=a[r.subsong]||a[0],s=t?.patLen||64,i=t?.effectColumns[r.channel]||1;for(let a=0;a<s;a++){const t={note:e.readInt16(),octave:e.readInt16(),instrument:e.readInt16(),volume:e.readInt16(),effects:[]};0===t.note&&0===t.octave?t.note=-1:100===t.note?(t.note=180,t.octave=0):101===t.note?(t.note=181,t.octave=0):102===t.note?(t.note=182,t.octave=0):12===t.note?(t.note=12,t.octave++):t.note>=1&&t.note<=11&&t.octave>=128&&(t.octave=t.octave-256);for(let a=0;a<i;a++){const a=e.readInt16(),n=e.readInt16();a>=0&&t.effects.push({type:a,value:n>=0?n:0})}r.rows.push(t)}n>=51&&(r.name=ZM(e))}}return r}function oN(e){const t=e.instruments.map((t,a)=>{const n=[],s=(r=t.type,$M[r]||"ChipSynth");var r;const i="Sampler"===s||"Player"===s;if(t.samples&&t.samples.length>0){for(const c of t.samples)if(c<e.samples.length){const t=e.samples[c];n.push(cN(t,c))}}else if(i&&a<e.samples.length){const t=e.samples[a];n.push(cN(t,a))}const o={chipType:t.type,synthType:s,macros:t.macros.map(e=>({type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed,mode:e.mode,delay:e.delay})),wavetables:t.wavetables.filter(t=>t<e.wavetables.length).map(t=>{const a=e.wavetables[t];return{id:t,data:[...a.data],len:a.width,max:a.height}})};t.fm&&(o.fm={algorithm:t.fm.algorithm,feedback:t.fm.feedback,fms:t.fm.fms,ams:t.fm.ams,ops:t.fm.ops,opllPreset:t.fm.opllPreset,operators:t.fm.operators.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2,rs:e.rs,am:e.am,ksr:e.ksr,ksl:e.ksl,sus:e.sus,vib:e.vib,ws:e.ws,ssg:e.ssg,egt:e.egt,kvs:e.kvs,dvb:e.dvb,dam:e.dam}))});const l={};return t.gb&&(l.gb=t.gb),t.c64&&(l.c64=t.c64),t.snes&&(l.snes=t.snes),t.n163&&(l.n163=t.n163),t.fds&&(l.fds=t.fds),Object.keys(l).length>0&&(o.chipConfig=l),{id:a+1,name:t.name||`Instrument ${a+1}`,samples:n,fadeout:0,volumeType:"none",panningType:"none",furnace:o,rawBinaryData:t.rawBinaryData}}),a=[],n=e.subsongs[0];if(!n)return{instruments:t,patterns:[],metadata:lN(e)};for(let s=0;s<n.ordersLen;s++){const t=[];for(let a=0;a<n.patLen;a++){const r=[];for(let t=0;t<e.chans;t++){const i=`0_${t}_${n.orders[t]?.[s]??0}`,o=e.patterns.get(i);if(o&&o.rows[a]){const e=uN(o.rows[a]);r.push(e)}else r.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0,effectType2:0,effectParam2:0})}t.push(r)}a.push(t)}a.filter(e=>e.some(e=>e.some(e=>e.note>0||e.instrument>0||e.effectType>0)));return{instruments:t,patterns:a,metadata:lN(e)}}function lN(e){const t=e.subsongs[0],a=t?.virtualTempo||150,n=t?.virtualTempoD||150,s=t?.hz||60,r=t?.speed1||6,i=Math.round(2.5*s*(a/n));return{sourceFormat:"XM",sourceFile:e.name||"Furnace Module",importedAt:(new Date).toISOString(),originalChannelCount:e.chans,originalPatternCount:e.patterns.size,originalInstrumentCount:e.instruments.length,modData:{moduleType:"FUR",initialSpeed:r,initialBPM:i,amigaPeriods:!1,channelNames:t?.channelNames||Array.from({length:e.chans},(e,t)=>`Ch ${t+1}`),songLength:t?.ordersLen||1,restartPosition:0,patternOrderTable:Array.from({length:t?.ordersLen||1},(e,t)=>t),songMessage:e.comment}}}function cN(e,t){let a;if(16===e.depth&&e.data instanceof Int16Array)a=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);else if(e.data instanceof Int8Array){const t=new Int16Array(e.length);for(let a=0;a<e.length;a++)t[a]=256*e.data[a];a=t.buffer}else a=new ArrayBuffer(2*e.length);return{id:t,name:e.name,pcmData:a,loopStart:e.loopStart>=0?e.loopStart:0,loopLength:e.loopEnd>e.loopStart?e.loopEnd-e.loopStart:0,loopType:e.loopStart<0?"none":2===e.loopDirection?"pingpong":"forward",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:e.c4Rate||e.compatRate||22050,length:e.length}}function uN(e){let t=0;if(180===e.note||181===e.note||182===e.note)t=97;else if(e.note>=0&&e.note<=12){const a=12===e.note?0:e.note,n=12===e.note?e.octave+1:e.octave;t=12*(n<0?0:n)+a+1-24,t>96&&(t=96),t<1&&(t=0)}let a=0;e.volume>=0&&(a=16+Math.min(64,Math.floor(e.volume/2)));let n=0,s=0,r=0,i=0;if(e.effects.length>0){const t=e.effects[0];if(n=dN(t.type),s=255&t.value,n>=224&&n<=239){const e=15&n;n=14,s=e<<4|15&s}}if(e.effects.length>1){const t=e.effects[1];if(r=dN(t.type),i=255&t.value,r>=224&&r<=239){const e=15&r;r=14,i=e<<4|15&i}}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:a,effectType:n,effectParam:s,effectType2:r,effectParam2:i}}function dN(e){return{0:0,1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:8,9:15,10:10,11:11,12:233,13:13,15:15,16:16,17:17,128:8,129:8,130:8,131:25,132:25,136:8,137:8,138:8,144:9,145:9,146:9,147:9,148:9,149:9,150:9,151:9,152:9,153:9,154:9,155:9,156:9,157:9,158:9,159:9,192:15,193:15,194:15,195:15,211:10,212:10,220:236,224:0,225:225,226:226,227:228,228:4,229:0,230:3,231:0,232:3,233:3,234:0,235:0,236:236,237:237,238:0,240:15,241:225,242:226,243:234,244:235,245:0,246:0,247:0,248:234,249:235,250:10,252:236,253:15,254:15,255:0}[e]??e}const pN=Object.freeze(Object.defineProperty({__proto__:null,convertFurnaceToDevilbox:oN,parseFurnaceSong:JM},Symbol.toStringTag,{value:"Module"}));async function hN(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=async n=>{const s=n.target?.result;if(!s)return void a(new Error("Failed to read file"));const r=e.name.toLowerCase().slice(e.name.lastIndexOf(".")),i=".xm"===r||".mod"===r||".fur"===r||".dmf"===r;try{if(i)try{const a=await async function(e,t){try{if(".xm"===t){const t=await vw(e);return{format:"XM",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".mod"===t){const t=await Ew(e);return{format:"MOD",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".fur"===t){const t=oN(await JM(e));return{format:"FUR",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".dmf"===t){const t=function(e){const t=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,samples:[],fadeout:0,volumeType:"none",panningType:"none"})),a=[];for(let i=0;i<e.matrixRows;i++){const t=[];for(let a=0;a<e.patternRows;a++){const n=[];for(let t=0;t<e.channelCount;t++){const s=e.patternMatrix[t]?.[i]||0,r=t*e.matrixRows+s,o=e.patterns[r],l=o?.rows?.[a]?.[t];l?n.push(vN(l)):n.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(n)}a.push(t)}const n=60,s=Math.round(2.5*n/(e.timeBase+1)/e.ticksPerRow[0]*4),r={sourceFormat:"XM",sourceFile:e.name||"DefleMask Module",importedAt:(new Date).toISOString(),originalChannelCount:e.channelCount,originalPatternCount:a.length,originalInstrumentCount:e.instruments.length,modData:{moduleType:"DMF",initialSpeed:e.ticksPerRow[0],initialBPM:s>0?s:125,amigaPeriods:!1,channelNames:Array.from({length:e.channelCount},(e,t)=>`Ch ${t+1}`),songLength:e.matrixRows,restartPosition:0,patternOrderTable:Array.from({length:e.matrixRows},(e,t)=>t),songMessage:`${e.name} by ${e.author}`}};return{instruments:t,patterns:a,metadata:r}}(dg.parse(e,"dmf"));return{format:"DMF",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}}catch(a){return null}return null}(s,r,e.name);if(a){const n={title:a.importMetadata.sourceFile,type:".fur"===r?"Furnace":".dmf"===r?"DefleMask":a.format,channels:a.importMetadata.originalChannelCount,patterns:a.importMetadata.originalPatternCount,orders:a.importMetadata.modData?.songLength||1,instruments:a.importMetadata.originalInstrumentCount,samples:a.importMetadata.originalInstrumentCount,duration:0,message:a.importMetadata.modData?.songMessage};let i;return".fur"!==r&&".dmf"!==r&&(i=await gN(s,e)),void t({metadata:n,arrayBuffer:s,player:i,file:e,nativeData:a})}}catch(o){if(".fur"===r||".dmf"===r)return void a(new Error(`Failed to parse ${r} file: ${o instanceof Error?o.message:"unknown error"}`))}const n=await gN(s,e),l=await new Promise((t,a)=>{const s=setTimeout(()=>{a(new Error("Timeout waiting for metadata"))},5e3);n.onMetadata(a=>{let n;clearTimeout(s),a.song&&(n={channels:a.song.channels||[],instruments:a.song.instruments||[],samples:a.song.samples||[],orders:a.song.orders||[],patterns:a.song.patterns||[],numSubsongs:a.song.numSubsongs||1}),t({title:a.title||e.name.replace(/\.[^/.]+$/,""),type:a.type||"Unknown",channels:a.song?.channels?.length||a.channels||4,patterns:a.song?.patterns?.length||a.totalPatterns||a.patterns||1,orders:a.song?.orders?.length||a.totalOrders||a.orders||1,instruments:a.song?.instruments?.length||a.instruments||0,samples:a.song?.samples?.length||a.samples||0,duration:a.dur||0,message:a.message,song:n})}),n.onError(e=>{clearTimeout(s),a(new Error(`Failed to load module: ${e.type||e.message||"unknown error"}`))})});t({metadata:l,arrayBuffer:s,player:n,file:e})}catch(l){a(l)}},n.onerror=()=>a(new Error("Failed to read file")),n.readAsArrayBuffer(e)})}async function mN(e){e.player&&await e.player.play(e.arrayBuffer)}function fN(e){e.player&&e.player.stop()}async function gN(e,t){const a=new bw({repeatCount:0});if(!(await new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4);a.onInitialized(()=>{clearTimeout(t),e(!0)}),a.onError(a=>{"init"===a.type&&(clearTimeout(t),e(!1))})})))throw new Error("Module player not available. The audio worklet failed to load.");return await a.play(e),a.stop(),a}function yN(){return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"]}function bN(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].includes(t)}function vN(e){let t=0;if(100===e.note)t=97;else if(e.note>=0&&e.note<=11){t=12*Math.max(0,Math.min(7,e.octave))+e.note+1,t>96&&(t=96),t<1&&(t=0)}let a=0;e.volume>=0&&(a=16+Math.floor(4*e.volume));let n=0,s=0;if(e.effects.length>0){const t=e.effects[0];n={0:0,1:1,2:2,3:3,4:4,7:7,8:8,9:9,10:10,11:11,12:12,13:13,15:15,16:16,225:225,226:226,233:233,234:234,235:235,236:236,237:237}[t.code]??0,s=255&t.value}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:a,effectType:n,effectParam:s}}const xN=Object.freeze(Object.defineProperty({__proto__:null,getSupportedExtensions:yN,isSupportedModule:bN,loadModuleFile:hN,previewModule:mN,stopPreview:fN},Symbol.toStringTag,{value:"Module"})),wN=({isOpen:e,onClose:t,onImport:a,initialFile:n})=>{const[r,i]=s.useState(null),[o,l]=s.useState(!1),[c,u]=s.useState(null),[d,p]=s.useState(!1),[h,m]=s.useState(!0),f=s.useRef(null),g=s.useCallback(async e=>{if(bN(e.name)){l(!0),u(null),i(null);try{const t=await hN(e);i(t)}catch(t){u(t instanceof Error?t.message:"Failed to load module")}finally{l(!1)}}else u(`Unsupported file format. Supported: ${[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].slice(0,5).join(", ")}...`)},[]);s.useEffect(()=>{n&&e&&g(n)},[n,e,g]);const y=s.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&g(t)},[g]),b=s.useCallback(e=>{e.preventDefault()},[]),v=s.useCallback(e=>{const t=e.target.files?.[0];t&&g(t)},[g]),x=s.useCallback(()=>{r&&(d?(fN(r),p(!1)):(mN(r),p(!0)))},[r,d]),w=s.useCallback(()=>{r&&(d&&(fN(r),p(!1)),a(r,{useLibopenmpt:h}),t())},[r,d,a,t,h]),k=s.useCallback(()=>{r&&d&&fN(r),i(null),u(null),p(!1),t()},[r,d,t]);return e?xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[80vh] overflow-hidden",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(Nt,{size:18,className:"text-accent-primary"}),xa.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Tracker Module"})]}),xa.jsx(Dv,{variant:"icon",size:"icon",onClick:k,"aria-label":"Close dialog",children:xa.jsx(Ee,{size:16})})]}),xa.jsxs("div",{className:"p-4 space-y-4",children:[xa.jsxs("div",{onDrop:y,onDragOver:b,onClick:()=>f.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${o?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[xa.jsx("input",{ref:f,type:"file",accept:[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].join(","),onChange:v,className:"hidden"}),o?xa.jsxs("div",{className:"flex flex-col items-center gap-2",children:[xa.jsx("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),xa.jsx("p",{className:"text-sm text-text-muted",children:"Loading module..."})]}):xa.jsxs("div",{className:"flex flex-col items-center gap-2",children:[xa.jsx(Ct,{size:32,className:"text-text-muted"}),xa.jsx("p",{className:"text-sm text-text-primary",children:"Drop a tracker file here or click to browse"}),xa.jsx("p",{className:"text-xs text-text-muted",children:"Supports MOD, XM, IT, S3M and 20+ other formats"})]})]}),c&&xa.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[xa.jsx(Ie,{size:16}),c]}),r&&xa.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(Te,{size:16,className:"text-accent-primary"}),xa.jsx("span",{className:"font-medium text-text-primary",children:r.metadata.title})]}),xa.jsx("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:r.metadata.type})]}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Channels:"}),xa.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.channels})]}),xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Patterns:"}),xa.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.patterns})]}),xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Instruments:"}),xa.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.instruments})]}),xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Samples:"}),xa.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.samples})]}),xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Orders:"}),xa.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.orders})]}),xa.jsxs("div",{className:"flex justify-between text-text-muted",children:[xa.jsx("span",{children:"Duration:"}),xa.jsxs("span",{className:"text-text-primary font-mono",children:[Math.floor(r.metadata.duration/60),":",String(Math.floor(r.metadata.duration%60)).padStart(2,"0")]})]})]}),r.metadata.message&&xa.jsx("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap",children:r.metadata.message}),xa.jsx(Dv,{variant:"ghost",fullWidth:!0,onClick:x,icon:d?xa.jsx(Et,{size:14}):xa.jsx(Pt,{size:14}),className:d?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:d?"Stop Preview":"Preview"})]}),r&&xa.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("input",{type:"checkbox",id:"useLibopenmpt",checked:h,onChange:e=>m(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bgSecondary accent-accent-primary"}),xa.jsx("label",{htmlFor:"useLibopenmpt",className:"text-sm text-text-primary cursor-pointer",children:"Use libopenmpt for sample-accurate playback"})]}),xa.jsxs("div",{className:"flex items-start gap-2 text-xs text-text-muted",children:[xa.jsx(_t,{size:12,className:"mt-0.5 flex-shrink-0"}),xa.jsx("span",{children:"When enabled, uses libopenmpt WASM for authentic tracker effects (smooth vibrato, portamento). Editing will use Tone.js approximation."})]})]}),r&&!h&&xa.jsx("p",{className:"text-xs text-text-muted",children:"Note: Importing will create patterns and sampler instruments from this module. Complex effects may not translate perfectly."})]}),xa.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border",children:[xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:k,children:"Cancel"}),xa.jsx(Dv,{variant:"primary",size:"sm",onClick:w,disabled:!r,children:"Import Module"})]})]})}):null},kN=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(1),i=()=>{t(n)};return xa.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:xa.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),i()):"Escape"===e.key&&(e.preventDefault(),a())},children:[xa.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Scale Volume (",e,")"]}),xa.jsxs("div",{className:"space-y-4",children:[xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Scale Factor"}),xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsx("input",{type:"range",min:"0",max:"2",step:"0.05",value:n,onChange:e=>r(parseFloat(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),xa.jsxs("span",{className:"text-neutral-100 font-mono text-sm w-20 text-right",children:[n.toFixed(2)," (",Math.round(100*n),"%)"]})]}),xa.jsxs("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[xa.jsx("span",{children:"0 (silence)"}),xa.jsx("span",{children:"1 (unchanged)"}),xa.jsx("span",{children:"2 (double)"})]})]}),xa.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[xa.jsxs("p",{className:"mb-1",children:[xa.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Scale volume multiplies all volume values by the factor."]}),xa.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[xa.jsx("li",{children:"0.5 = half volume (50%)"}),xa.jsx("li",{children:"1.0 = no change (100%)"}),xa.jsx("li",{children:"2.0 = double volume (200%, clamped to max)"})]})]})]}),xa.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[xa.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",xa.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),xa.jsxs("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",xa.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},SN=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(64),[i,o]=s.useState(0),l=()=>{t(n,i)};return xa.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:xa.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),a())},children:[xa.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Fade Volume (",e,")"]}),xa.jsxs("div",{className:"space-y-4",children:[xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Start Volume"}),xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:n,onChange:e=>r(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),xa.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:n.toString().padStart(2,"0")})]})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"End Volume"}),xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:i,onChange:e=>o(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),xa.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:i.toString().padStart(2,"0")})]})]}),xa.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3",children:xa.jsxs("div",{className:"text-xs text-neutral-400 space-y-2",children:[xa.jsxs("p",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Fade Direction:"})," ",n>i?xa.jsx("span",{className:"text-red-400",children:"Fade out (loud  quiet)"}):n<i?xa.jsx("span",{className:"text-green-400",children:"Fade in (quiet  loud)"}):xa.jsx("span",{className:"text-neutral-400",children:"No change (flat)"})]}),xa.jsxs("p",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Fade volume applies linear interpolation from start to end across all rows in the ",e,"."]})]})})]}),xa.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[xa.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",xa.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),xa.jsxs("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",xa.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},MN=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(0),[i,o]=s.useState(0),l=()=>{t(n,i)};return xa.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:xa.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),a())},children:[xa.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Remap Instrument (",e,")"]}),xa.jsxs("div",{className:"space-y-4",children:[xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Source Instrument"}),xa.jsx("input",{type:"number",min:"0",max:"255",value:n,onChange:e=>r(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),xa.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to find (0-255)"})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Destination Instrument"}),xa.jsx("input",{type:"number",min:"0",max:"255",value:i,onChange:e=>o(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"}),xa.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to replace with (0-255)"})]}),xa.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[xa.jsxs("p",{className:"mb-1",children:[xa.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Remap instrument replaces all occurrences of the source instrument ID with the destination ID."]}),xa.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[xa.jsxs("li",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Block:"})," Only in selected region"]}),xa.jsxs("li",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Track:"})," Entire current channel"]}),xa.jsxs("li",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Pattern:"})," Entire current pattern"]}),xa.jsxs("li",{children:[xa.jsx("strong",{className:"text-neutral-300",children:"Song:"})," All patterns"]})]})]}),n===i&&xa.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded p-3 text-xs text-yellow-300",children:" Source and destination are the same - no changes will be made."})]}),xa.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[xa.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",xa.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),xa.jsxs("button",{onClick:l,disabled:n===i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Remap ",xa.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},NN=({onClose:e})=>{const t=tf(e=>e.patternOrder),a=tf(e=>e.currentPositionIndex),n=tf(e=>e.currentPatternIndex),r=tf(e=>e.addToOrder),i=tf(e=>e.removeFromOrder),o=tf(e=>e.duplicatePosition),l=tf(e=>e.clearOrder),c=tf(e=>e.reorderPositions),u=tf(e=>e.setCurrentPosition),[d,p]=s.useState(null),h=e=>{e.currentTarget.classList.remove("bg-accent-primary/20")},m=()=>{p(null),document.querySelectorAll(".bg-accent-primary\\/20").forEach(e=>{e.classList.remove("bg-accent-primary/20")})};return xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center justify-between bg-ft2-header",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("span",{className:"text-lg font-bold text-ft2-text",children:"Pattern Order"}),xa.jsxs("span",{className:"text-sm text-ft2-textDim",children:["(",t.length," positions)"]})]}),xa.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-dark-bgHover transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:xa.jsx(Ee,{size:20})})]}),xa.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center gap-2 bg-dark-bgTertiary",children:[xa.jsxs("button",{onClick:()=>{r(n),ty.success(`Added Pattern ${n.toString(16).padStart(2,"0").toUpperCase()}`,2e3)},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Add current pattern to order",children:[xa.jsx(Xe,{size:14}),"Add Current Pattern"]}),xa.jsxs("button",{onClick:()=>{confirm("Clear all positions? This will reset to just the first pattern.")&&(l(),ty.info("Pattern order cleared",2e3))},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Clear all positions",children:[xa.jsx(Re,{size:14}),"Clear All"]}),xa.jsxs("div",{className:"ml-auto text-xs text-ft2-textDim",children:["Current Pattern: ",n.toString(16).padStart(2,"0").toUpperCase()]})]}),xa.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-ft2-bg",children:xa.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 xl:grid-cols-16 gap-2",children:t.map((e,n)=>xa.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{p(t),e.dataTransfer.effectAllowed="move"})(e,n),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==d&&d!==t&&e.currentTarget.classList.add("bg-accent-primary/20")})(e,n),onDragLeave:h,onDrop:e=>((e,t)=>{e.preventDefault(),e.currentTarget.classList.remove("bg-accent-primary/20"),null!==d&&d!==t&&(c(d,t),p(null),ty.success("Position reordered",2e3))})(e,n),onDragEnd:m,onClick:()=>u(n),onContextMenu:e=>{e.preventDefault(),e.shiftKey?(o(n),ty.success("Position duplicated",2e3)):(e.ctrlKey||e.metaKey)&&(e=>{t.length>1?(i(e),ty.info("Position removed",2e3)):ty.warning("Cannot remove last position",2e3)})(n)},className:`\n                  relative px-3 py-2 rounded border cursor-pointer transition-all\n                  ${n===a?"bg-dark-bgActive border-accent-primary text-accent-primary font-bold":"bg-dark-bgTertiary border-dark-border text-text-secondary hover:bg-dark-bgHover hover:border-dark-borderLight"}\n                  ${d===n?"opacity-50":""}\n                `,title:`Position ${n.toString(16).padStart(2,"0").toUpperCase()}: Pattern ${e.toString(16).padStart(2,"0").toUpperCase()}\nClick to select\nShift+Click to duplicate\nCtrl+Click to remove\nDrag to reorder`,children:[xa.jsx("div",{className:"text-xs text-center leading-none opacity-60",children:n.toString(16).padStart(2,"0").toUpperCase()}),xa.jsx("div",{className:"text-lg text-center font-mono leading-none mt-1",children:e.toString(16).padStart(2,"0").toUpperCase()})]},`pos-${n}`))})}),xa.jsxs("div",{className:"px-4 py-3 border-t border-ft2-border text-sm text-ft2-textDim bg-dark-bgTertiary",children:[xa.jsx("strong",{children:"Controls:"})," Click: Select  Drag: Reorder  Shift+Click: Duplicate  Ctrl+Click: Remove"]})]})})},CN=({isOpen:e,onClose:t})=>{const{selection:a,strumSelection:n}=tf(),[r,i]=s.useState(1),[o,l]=s.useState("down");return xa.jsxs(uw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[xa.jsx(dw,{title:"Strum / Arpeggiate",icon:xa.jsx(Te,{size:18}),onClose:t,theme:"modern"}),xa.jsxs("div",{className:"p-4 space-y-4",children:[xa.jsx("div",{className:"text-xs text-text-secondary",children:"Add incremental note delays (EDx) across channels to create a strum or arpeggio effect."}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Ticks per channel (1-15)"}),xa.jsx("input",{type:"number",value:r,onChange:e=>i(Math.max(1,Math.min(15,parseInt(e.target.value)||1))),min:1,max:15,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),xa.jsxs("div",{children:[xa.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Direction"}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsx("button",{onClick:()=>l("down"),className:"px-3 py-2 text-xs rounded border transition-colors "+("down"===o?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Down (left to right)"}),xa.jsx("button",{onClick:()=>l("up"),className:"px-3 py-2 text-xs rounded border transition-colors "+("up"===o?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Up (right to left)"})]})]}),!a&&xa.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),xa.jsxs(pw,{theme:"modern",align:"right",children:[xa.jsx(Dv,{variant:"ghost",onClick:t,children:"Cancel"}),xa.jsx(Dv,{variant:"primary",onClick:()=>{a?(n(r,o),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},EN=()=>{const e=tf(e=>e.macroSlots),t=tf(e=>e.writeMacroSlot),a=tf(e=>e.readMacroSlot),n=e=>null==e?"..":"string"==typeof e?e:e.toString(16).padStart(2,"0").toUpperCase();return xa.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4",children:[xa.jsxs("div",{className:"flex items-center justify-between mb-3",children:[xa.jsx("h4",{className:"text-sm font-semibold text-neutral-100",children:"Macro Slots"}),xa.jsx("span",{className:"text-xs text-neutral-500",children:"FT2-Style Quick Entry"})]}),xa.jsx("div",{className:"space-y-2",children:e.map((e,s)=>{const r=0===e.note&&0===e.instrument&&0===e.volume&&0===e.effTyp&&0===e.eff&&0===e.effTyp2&&0===e.eff2;return xa.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:[xa.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-neutral-700 border border-neutral-600 rounded text-xs font-bold text-neutral-300",children:s+1}),xa.jsxs("div",{className:"flex-1 font-mono text-xs text-neutral-300 flex items-center gap-1",children:[xa.jsx("span",{className:e.note?"text-blue-400":"text-neutral-600",children:e.note||"..."}),xa.jsx("span",{className:null!==e.instrument?"text-green-400":"text-neutral-600",children:n(e.instrument)}),xa.jsx("span",{className:null!==e.volume?"text-yellow-400":"text-neutral-600",children:n(e.volume)}),xa.jsx("span",{className:0!==e.effTyp||0!==e.eff?"text-purple-400":"text-neutral-600",children:0!==e.effTyp||0!==e.eff?`${e.effTyp.toString(16).toUpperCase()}${e.eff.toString(16).padStart(2,"0").toUpperCase()}`:"..."}),xa.jsx("span",{className:0!==e.effTyp2||0!==e.eff2?"text-pink-400":"text-neutral-600",children:0!==e.effTyp2||0!==e.eff2?`${e.effTyp2.toString(16).toUpperCase()}${e.eff2.toString(16).padStart(2,"0").toUpperCase()}`:"..."})]}),xa.jsxs("div",{className:"flex gap-1",children:[xa.jsx("button",{onClick:()=>t(s),className:"px-2 py-1 text-xs font-medium text-neutral-300 bg-neutral-700 border border-neutral-600 rounded hover:bg-neutral-600 transition-colors",title:`Write current cell to slot ${s+1} (Ctrl+Shift+${s+1})`,children:"Write"}),xa.jsx("button",{onClick:()=>a(s),disabled:r,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:`Paste macro slot ${s+1} (Ctrl+${s+1})`,children:"Read"})]})]},s)})}),xa.jsxs("div",{className:"mt-4 p-3 bg-neutral-800/50 border border-neutral-700 rounded text-xs text-neutral-400",children:[xa.jsx("div",{className:"font-semibold text-neutral-300 mb-2",children:"Keyboard Shortcuts:"}),xa.jsxs("div",{className:"space-y-1",children:[xa.jsxs("div",{className:"flex justify-between",children:[xa.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+1-8"}),xa.jsx("span",{children:"Read macro slot 1-8"})]}),xa.jsxs("div",{className:"flex justify-between",children:[xa.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+Shift+1-8"}),xa.jsx("span",{children:"Write current cell to slot 1-8"})]})]}),xa.jsx("p",{className:"mt-2 text-neutral-500",children:"Macros store cell data for quick entry. Perfect for repeated patterns!"})]})]})},PN=({onClose:e,onShowScaleVolume:t,onShowFadeVolume:a,onShowRemapInstrument:n,onExportPattern:r,onExportTrack:i,onReverse:o,onExpand:l,onShrink:c,onDuplicate:u,onMath:d})=>{const{selection:p}=tf(),[h,m]=s.useState("macros"),[f,g]=s.useState(1),[y,b]=s.useState("volume"),v=null!==p,x=e=>{m(h===e?null:e)};return xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(_e,{size:18,className:"text-accent-primary"}),xa.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"FT2 Advanced Edit"})]}),xa.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:xa.jsx(Ee,{size:20})})]}),xa.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[xa.jsxs("div",{className:"border border-ft2-border rounded",children:[xa.jsxs("button",{onClick:()=>x("volume"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[xa.jsx("span",{children:"Volume Operations"}),xa.jsx("span",{children:"volume"===h?"":""})]}),"volume"===h&&xa.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[xa.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform volume values across selection, track, or pattern"}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsx("button",{onClick:()=>t?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Scale Block"}),xa.jsx("button",{onClick:()=>a?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Fade Block"}),xa.jsx("button",{onClick:()=>t?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Track"}),xa.jsx("button",{onClick:()=>a?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Track"}),xa.jsx("button",{onClick:()=>t?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Pattern"}),xa.jsx("button",{onClick:()=>a?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Pattern"})]})]})]}),xa.jsxs("div",{className:"border border-ft2-border rounded",children:[xa.jsxs("button",{onClick:()=>x("blockops"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[xa.jsxs("span",{className:"flex items-center gap-2",children:[xa.jsx(Ve,{size:14}),"Block Operations"]}),xa.jsx("span",{children:"blockops"===h?"":""})]}),"blockops"===h&&xa.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[xa.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform selected block content"}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsxs("button",{onClick:o,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[xa.jsx(Ve,{size:12}),"Reverse"]}),xa.jsxs("button",{onClick:u,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[xa.jsx(Ke,{size:12}),"Duplicate"]}),xa.jsxs("button",{onClick:l,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[xa.jsx(Tt,{size:12}),"Expand 2x"]}),xa.jsxs("button",{onClick:c,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[xa.jsx(At,{size:12}),"Shrink 2x"]})]}),xa.jsxs("div",{className:"mt-3 pt-2 border-t border-ft2-border",children:[xa.jsxs("div",{className:"text-xs text-ft2-textDim mb-2 flex items-center gap-1",children:[xa.jsx(Ot,{size:12}),"Math Operations"]}),xa.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[xa.jsxs("select",{value:y,onChange:e=>b(e.target.value),className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text",children:[xa.jsx("option",{value:"volume",children:"Volume"}),xa.jsx("option",{value:"eff",children:"Effect"})]}),xa.jsx("input",{type:"number",value:f,onChange:e=>{const t=Number(e.target.value);isNaN(t)||g(Math.max(0,Math.min(255,t)))},className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text w-16",min:0,max:255})]}),xa.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[xa.jsx("button",{onClick:()=>d?.("add",f,y),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"}),xa.jsx("button",{onClick:()=>d?.("sub",f,y),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),xa.jsx("button",{onClick:()=>d?.("mul",f,y),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),xa.jsx("button",{onClick:()=>d?.("div",f,y),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""})]})]}),xa.jsx("div",{className:"text-[10px] text-ft2-textDim mt-1",children:"Alt+R = Reverse | Alt+D = Duplicate"})]})]}),xa.jsxs("div",{className:"border border-ft2-border rounded",children:[xa.jsxs("button",{onClick:()=>x("remap"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[xa.jsxs("span",{className:"flex items-center gap-2",children:[xa.jsx(wt,{size:14}),"Instrument Remap"]}),xa.jsx("span",{children:"remap"===h?"":""})]}),"remap"===h&&xa.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[xa.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Find and replace instrument IDs"}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsx("button",{onClick:()=>n?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Remap Block"}),xa.jsx("button",{onClick:()=>n?.("track"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Track"}),xa.jsx("button",{onClick:()=>n?.("pattern"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Pattern"}),xa.jsx("button",{onClick:()=>n?.("song"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Song"})]})]})]}),xa.jsxs("div",{className:"border border-ft2-border rounded",children:[xa.jsxs("button",{onClick:()=>x("export"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[xa.jsxs("span",{className:"flex items-center gap-2",children:[xa.jsx(Ue,{size:14}),"Export/Import"]}),xa.jsx("span",{children:"export"===h?"":""})]}),"export"===h&&xa.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[xa.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Export patterns and tracks as FT2-compatible files"}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[xa.jsxs("button",{onClick:r,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[xa.jsx(Ue,{size:12}),"Pattern (.xp)"]}),xa.jsxs("button",{onClick:i,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[xa.jsx(Ue,{size:12}),"Track (.xt)"]})]}),xa.jsx("div",{className:"text-xs text-ft2-textDim mt-2",children:"Import: Use File  Open Module"})]})]}),xa.jsxs("div",{className:"border border-ft2-border rounded",children:[xa.jsxs("button",{onClick:()=>x("macros"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[xa.jsx("span",{children:"Macro Slots"}),xa.jsx("span",{children:"macros"===h?"":""})]}),"macros"===h&&xa.jsx("div",{className:"p-3 bg-dark-bgSecondary",children:xa.jsx(EN,{})})]})]})]})})},_N=[{title:"Navigation",shortcuts:[{keys:"Arrow Up/Down",action:"Move cursor up/down"},{keys:"Arrow Left/Right",action:"Move cursor left/right"},{keys:"Tab / Shift+Tab",action:"Next/prev channel"},{keys:"PageUp / PageDown",action:"Jump 16 rows"},{keys:"Home / End",action:"Jump to first/last row"},{keys:"F9-F12",action:"Jump to 0%/25%/50%/75%"},{keys:"Shift+Arrow L/R",action:"Prev/next pattern"},{keys:"Alt+Q-I",action:"Jump to tracks 0-7"},{keys:"Alt+A-K",action:"Jump to tracks 8-15"}]},{title:"Playback",shortcuts:[{keys:"Space",action:"Stop / toggle edit mode"},{keys:"Right Shift",action:"Record + play pattern"},{keys:"Right Ctrl",action:"Play song"},{keys:"Right Alt",action:"Play pattern"},{keys:"Ctrl+Enter",action:"Play song"}]},{title:"Note Entry",shortcuts:[{keys:"Z-M (bottom row)",action:"Notes C-B (lower octave)"},{keys:"Q-P (top row)",action:"Notes C-E (upper octave)"},{keys:"F1-F7",action:"Select octave 1-7"},{keys:"Numpad +/-",action:"Octave up/down"},{keys:"CapsLock",action:"Note off"},{keys:"` / ~",action:"Edit step +1 / -1"}]},{title:"Editing",shortcuts:[{keys:"Delete",action:"Delete at cursor"},{keys:"Shift+Delete",action:"Delete entire cell"},{keys:"Backspace",action:"Delete previous & move up"},{keys:"Insert",action:"Insert row / toggle insert mode"},{keys:"Shift+Insert",action:"Insert entire line"}]},{title:"Block Operations",shortcuts:[{keys:"Alt+B / Alt+E",action:"Mark block start/end"},{keys:"Ctrl+C / Ctrl+X",action:"Copy / Cut"},{keys:"Ctrl+V",action:"Paste"},{keys:"Ctrl+Shift+V",action:"Mix paste (fill empty)"},{keys:"Ctrl+Shift+F",action:"Flood paste (to end)"},{keys:"F3 / F4 / F5",action:"Cut / Copy / Paste (FT2)"},{keys:"Alt+Arrow keys",action:"Extend selection"}]},{title:"Transpose",shortcuts:[{keys:"Ctrl+Up/Down",action:"Transpose 1 semitone"},{keys:"Ctrl+Shift+Up/Down",action:"Transpose 1 octave"},{keys:"Alt+T / Alt+Shift+T",action:"Block transpose 1"}]},{title:"Macros & Dialogs",shortcuts:[{keys:"Ctrl+1-8",action:"Recall macro slot"},{keys:"Ctrl+Shift+1-8",action:"Save macro slot"},{keys:"Ctrl+I",action:"Interpolate"},{keys:"Ctrl+H",action:"Humanize"},{keys:"Ctrl+F",action:"Find & Replace"},{keys:"Ctrl+O",action:"Import module"},{keys:"?",action:"This shortcut sheet"}]},{title:"Effect Commands",shortcuts:[{keys:"0xy",action:"Arpeggio"},{keys:"1/2xx",action:"Pitch slide up/down"},{keys:"3xx",action:"Tone portamento"},{keys:"4xy",action:"Vibrato"},{keys:"Axy",action:"Volume slide"},{keys:"Cxx",action:"Set volume (00-40)"},{keys:"Fxx",action:"Speed (01-1F) / BPM (20-FF)"},{keys:"Exy",action:"Extended commands"}]}],TN=({isOpen:e,onClose:t})=>{const a=s.useRef(null),[n,r]=s.useState("");if(s.useEffect(()=>{if(!e)return;const a=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[e,t]),!e)return null;const i=n.toLowerCase(),o=_N.map(e=>({...e,shortcuts:e.shortcuts.filter(e=>e.keys.toLowerCase().includes(i)||e.action.toLowerCase().includes(i))})).filter(e=>e.shortcuts.length>0);return xa.jsx("div",{ref:a,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:t,children:xa.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[720px] max-w-[90vw] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-neutral-700",children:[xa.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"Keyboard Shortcuts"}),xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("input",{type:"text",placeholder:"Filter...",value:n,onChange:e=>r(e.target.value),className:"bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 w-32 focus:outline-none focus:border-blue-500",autoFocus:!0,"aria-label":"Filter keyboard shortcuts"}),xa.jsx("button",{onClick:t,className:"text-neutral-400 hover:text-neutral-200 transition-colors",children:xa.jsx(Ee,{size:18})})]})]}),xa.jsx("div",{className:"overflow-y-auto p-5",children:xa.jsx("div",{className:"grid grid-cols-2 gap-4",children:o.map(e=>xa.jsxs("div",{className:"space-y-1",children:[xa.jsx("h3",{className:"text-xs font-bold text-blue-400 uppercase tracking-wide mb-2",children:e.title}),e.shortcuts.map((t,a)=>xa.jsxs("div",{className:"flex items-center justify-between gap-2 py-0.5",children:[xa.jsx("kbd",{className:"text-[10px] font-mono bg-neutral-800 border border-neutral-600 rounded px-1.5 py-0.5 text-yellow-300 whitespace-nowrap",children:t.keys}),xa.jsx("span",{className:"text-[11px] text-neutral-300 text-right",children:t.action})]},`${e.title}-${a}`))]},e.title))})}),xa.jsxs("div",{className:"px-5 py-2 border-t border-neutral-700 text-[10px] text-neutral-500 text-center",children:["Press ",xa.jsx("kbd",{className:"bg-neutral-800 border border-neutral-600 rounded px-1 text-yellow-400",children:"Esc"})," to close"," "," | Ctrl/Cmd shown as Ctrl (use Cmd on macOS)"]})]})})},AN={0:{command:"0xy",name:"Arpeggio",description:"Rapidly cycle between note, note+x semitones, note+y semitones",parameters:"x=1st offset (0-F hex), y=2nd offset (0-F hex)",tick:"tick-N",category:"misc"},1:{command:"1xx",name:"Pitch Slide Up",description:"Slide pitch upward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},2:{command:"2xx",name:"Pitch Slide Down",description:"Slide pitch downward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},3:{command:"3xx",name:"Tone Portamento",description:"Slide pitch toward target note",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},4:{command:"4xy",name:"Vibrato",description:"Oscillate pitch up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"pitch"},5:{command:"5xy",name:"Tone Porta + Vol Slide",description:"Continue tone portamento while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},6:{command:"6xy",name:"Vibrato + Vol Slide",description:"Continue vibrato while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},7:{command:"7xy",name:"Tremolo",description:"Oscillate volume up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"volume"},8:{command:"8xx",name:"Set Panning",description:"Set channel panning position",parameters:"xx=position (00=left, 80=center, FF=right)",tick:"tick-0",category:"panning"},9:{command:"9xx",name:"Sample Offset",description:"Start sample playback at offset",parameters:"xx=offset (multiply by 256 samples)",tick:"tick-0",category:"sample"},A:{command:"Axy",name:"Volume Slide",description:"Slide volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"volume"},B:{command:"Bxx",name:"Position Jump",description:"Jump to pattern in order list",parameters:"xx=position (00-FF hex)",tick:"tick-0",category:"global"},C:{command:"Cxx",name:"Set Volume",description:"Set channel volume directly",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"volume"},D:{command:"Dxx",name:"Pattern Break",description:"Break pattern and jump to row in next pattern",parameters:"xx=row (00-3F hex, 0-63 decimal)",tick:"tick-0",category:"global"},E:{command:"Exy",name:"Extended Command",description:"Extended effects (see E-commands)",parameters:"x=sub-command (0-F), y=parameter",tick:"both",category:"misc"},F:{command:"Fxx",name:"Set Speed/BPM",description:"Set speed (01-1F) or BPM (20-FF)",parameters:"xx=speed/BPM (01-1F=speed, 20-FF=BPM)",tick:"tick-0",category:"global"},G:{command:"Gxx",name:"Set Global Volume",description:"Set global volume for all channels",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"global"},H:{command:"Hxy",name:"Global Volume Slide",description:"Slide global volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"global"}},ON={E0:{command:"E0x",name:"Set Filter (Amiga)",description:"Enable/disable Amiga LED filter",parameters:"x=0 (filter on) or 1 (filter off)",tick:"tick-0",category:"misc"},E1:{command:"E1x",name:"Fine Pitch Slide Up",description:"Slide pitch up once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E2:{command:"E2x",name:"Fine Pitch Slide Down",description:"Slide pitch down once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E3:{command:"E3x",name:"Glissando Control",description:"Enable/disable glissando (semitone portamento)",parameters:"x=0 (off) or 1 (on)",tick:"tick-0",category:"pitch"},E4:{command:"E4x",name:"Set Vibrato Waveform",description:"Set vibrato waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"pitch"},E5:{command:"E5x",name:"Set Finetune",description:"Set sample finetune",parameters:"x=finetune (-8 to +7, stored as 0-F)",tick:"tick-0",category:"sample"},E6:{command:"E6x",name:"Pattern Loop",description:"Loop pattern section",parameters:"x=0 (set loop start) or 1-F (loop count)",tick:"tick-0",category:"global"},E7:{command:"E7x",name:"Set Tremolo Waveform",description:"Set tremolo waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"volume"},E8:{command:"E8x",name:"Set Panning (Fine)",description:"Set panning with fine control",parameters:"x=panning (0=left, 8=center, F=right)",tick:"tick-0",category:"panning"},E9:{command:"E9x",name:"Retrigger Note",description:"Retrigger note every x ticks",parameters:"x=retrigger rate (1-F ticks)",tick:"tick-N",category:"timing"},EA:{command:"EAx",name:"Fine Volume Slide Up",description:"Slide volume up once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EB:{command:"EBx",name:"Fine Volume Slide Down",description:"Slide volume down once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EC:{command:"ECx",name:"Note Cut",description:"Cut note (set volume to 0) at tick x",parameters:"x=tick to cut (0=immediate, 1-F=delayed)",tick:"both",category:"timing"},ED:{command:"EDx",name:"Note Delay",description:"Delay note trigger by x ticks",parameters:"x=delay in ticks (0-F)",tick:"tick-N",category:"timing"},EE:{command:"EEx",name:"Pattern Delay",description:"Delay pattern by x rows",parameters:"x=rows to delay (0-F)",tick:"tick-0",category:"global"},EF:{command:"EFx",name:"Funk Repeat (Invert Loop)",description:"Invert sample loop at speed x (Amiga)",parameters:"x=invert speed (0-F)",tick:"tick-N",category:"sample"}},IN={10:{command:"10xx",name:"Set LFO Speed",description:"Set the LFO speed for FM chip vibrato/tremolo",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set TL (Total Level)",description:"Set operator total level (volume)",parameters:"xx=TL value (00-7F, lower=louder)",tick:"tick-0",category:"volume"},12:{command:"12xx",name:"Set AR (Attack Rate)",description:"Set operator attack rate",parameters:"xx=AR value (00-1F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set DR (Decay Rate)",description:"Set operator decay rate",parameters:"xx=DR value (00-1F)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set MULT (Multiplier)",description:"Set operator frequency multiplier",parameters:"xx=MULT value (00-0F)",tick:"tick-0",category:"pitch"},15:{command:"15xx",name:"Set RR (Release Rate)",description:"Set operator release rate",parameters:"xx=RR value (00-0F)",tick:"tick-0",category:"misc"},16:{command:"16xx",name:"Set SL (Sustain Level)",description:"Set operator sustain level",parameters:"xx=SL value (00-0F)",tick:"tick-0",category:"volume"},17:{command:"17xx",name:"Set DT (Detune)",description:"Set operator detune",parameters:"xx=DT value (00-07)",tick:"tick-0",category:"pitch"},18:{command:"18xx",name:"Set SSG-EG",description:"Set SSG envelope generator mode",parameters:"xx=SSG-EG mode (00-0F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"Set Algorithm",description:"Set FM algorithm (operator routing)",parameters:"xx=algorithm (00-07)",tick:"tick-0",category:"misc"},"1A":{command:"1Axx",name:"Set Feedback",description:"Set operator 1 feedback level",parameters:"xx=feedback (00-07)",tick:"tick-0",category:"misc"},"1B":{command:"1Bxy",name:"Set AM/PM Depth",description:"Set amplitude/phase modulation depth",parameters:"x=AM depth (0-3), y=PM depth (0-7)",tick:"tick-0",category:"misc"},"1C":{command:"1Cxx",name:"FM Hard Reset",description:"Force hard reset on note (key-off before key-on)",parameters:"xx=01 (enable), 00 (disable)",tick:"tick-0",category:"misc"}},DN={10:{command:"10xx",name:"Set Filter Cutoff",description:"Set SID filter cutoff frequency",parameters:"xx=cutoff (00-FF, 11-bit scaled)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Filter Resonance",description:"Set SID filter resonance",parameters:"xx=resonance (00-0F)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Filter Mode",description:"Set SID filter mode",parameters:"xx: 0=off, 1=LP, 2=BP, 4=HP (can combine)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Ring Mod",description:"Enable/disable ring modulation",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Hard Sync",description:"Enable/disable oscillator hard sync",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pulse Width",description:"Set pulse wave width",parameters:"xx=pulse width (00-FF, scaled to 12-bit)",tick:"tick-0",category:"misc"}},FN={11:{command:"11xx",name:"Set DMC",description:"Set DMC sample parameters",parameters:"xx=DMC control value",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty/Noise",description:"Set pulse duty or noise mode",parameters:"xx: pulse 0-3=duty, noise 0=short 1=long",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (pulse channels)",parameters:"x=period, y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Envelope Mode",description:"Set envelope/length counter mode",parameters:"xx=envelope settings",tick:"tick-0",category:"misc"},18:{command:"18xx",name:"FDS Mod Depth",description:"Set FDS modulation depth",parameters:"xx=mod depth (00-3F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"FDS Mod Speed High",description:"Set FDS modulation speed (high byte)",parameters:"xx=speed high byte",tick:"tick-0",category:"misc"}},RN={10:{command:"10xx",name:"Set Envelope Shape",description:"Set AY envelope shape",parameters:"xx=shape (00-0F)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Envelope Period Low",description:"Set AY envelope period (low byte)",parameters:"xx=period low byte",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Envelope Period High",description:"Set AY envelope period (high byte)",parameters:"xx=period high byte",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Auto-Envelope",description:"Enable auto-envelope (track note pitch)",parameters:"xx=auto-envelope numerator",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Noise Freq",description:"Set noise frequency",parameters:"xx=noise period (00-1F)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Noise Mode",description:"Set noise/tone mixing mode",parameters:"xx=mode bits (tone/noise enable)",tick:"tick-0",category:"misc"}},jN={10:{command:"10xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Wave Position",description:"Set wave position in RAM",parameters:"xx=position (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave Length",description:"Set wave length",parameters:"xx=length (must be power of 2)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Wave Load",description:"Load wave from position",parameters:"xx=load parameters",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Channel Limit",description:"Set max active channels (N163)",parameters:"xx=channel count (1-8)",tick:"tick-0",category:"misc"}},LN={10:{command:"10xx",name:"Set Sample Mode",description:"Set sample playback mode",parameters:"xx=mode (chip-specific)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Sample Bank",description:"Set sample bank",parameters:"xx=bank number",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Direction",description:"Set sample playback direction",parameters:"xx: 0=forward, 1=reverse",tick:"tick-0",category:"sample"},20:{command:"20xx",name:"ES5506 Filter Mode",description:"Set ES5506 filter mode",parameters:"xx=filter mode (00-03)",tick:"tick-0",category:"misc"},21:{command:"21xx",name:"ES5506 Filter K1",description:"Set ES5506 filter K1 coefficient",parameters:"xx=K1 value",tick:"tick-0",category:"misc"},22:{command:"22xx",name:"ES5506 Filter K2",description:"Set ES5506 filter K2 coefficient",parameters:"xx=K2 value",tick:"tick-0",category:"misc"},30:{command:"30xx",name:"QSound Echo",description:"Set QSound echo feedback",parameters:"xx=echo feedback",tick:"tick-0",category:"misc"},31:{command:"31xx",name:"QSound Surround",description:"Set QSound surround/3D position",parameters:"xx=surround position",tick:"tick-0",category:"panning"}},BN={FurnaceOPN:IN,FurnaceOPN2:IN,FurnaceOPM:IN,FurnaceOPL:IN,FurnaceOPL2:IN,FurnaceOPL3:IN,FurnaceOPLL:IN,FurnaceOPZ:IN,FurnaceESFM:IN,FurnaceC64:DN,FurnaceSID2:DN,FurnaceSID3:DN,FurnaceGB:{10:{command:"10xx",name:"Set Envelope",description:"Set volume envelope (NRx2 register)",parameters:"xx: high nibble=volume, low nibble=direction+period",tick:"tick-0",category:"volume"},11:{command:"11xx",name:"Set Wave",description:"Load wavetable into wave channel",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty",description:"Set pulse wave duty cycle",parameters:"xx: 0=12.5%, 1=25%, 2=50%, 3=75%",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (channel 1 only)",parameters:"x=period (0-7), y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Noise Mode",description:"Set noise channel width mode",parameters:"xx: 0=15-bit (normal), 1=7-bit (metallic)",tick:"tick-0",category:"misc"}},FurnaceNES:FN,FurnaceFDS:FN,FurnaceVRC6:FN,Furnace5E01:FN,FurnacePCE:{10:{command:"10xx",name:"Set LFO Mode",description:"Set PCE LFO mode",parameters:"xx=LFO mode (00-03)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set LFO Speed",description:"Set PCE LFO speed",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"}},FurnaceAY:RN,FurnaceAY8930:RN,FurnaceSAA:RN,FurnaceSMS:RN,FurnaceT6W28:RN,FurnaceN163:jN,FurnaceSCC:jN,FurnaceVB:jN,FurnaceSWAN:jN,FurnaceX1_010:jN,FurnaceSNES:{10:{command:"10xx",name:"Set Echo Enable",description:"Enable/disable echo for channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Echo Delay",description:"Set echo delay time",parameters:"xx=delay (00-0F, 16ms steps)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Echo Feedback",description:"Set echo feedback amount",parameters:"xx=feedback (-80 to 7F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Echo Volume",description:"Set echo volume",parameters:"xx=volume (-80 to 7F)",tick:"tick-0",category:"volume"},14:{command:"14xx",name:"Set Echo FIR",description:"Set echo FIR filter coefficient",parameters:"xx=coefficient index and value",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pitch Mod",description:"Enable pitch modulation from prev channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"pitch"},16:{command:"16xx",name:"Set Gain Mode",description:"Set ADSR/gain mode",parameters:"xx=gain mode (see SNES docs)",tick:"tick-0",category:"misc"},17:{command:"17xx",name:"Set Invert",description:"Invert waveform phase",parameters:"xx: 1=left, 2=right, 3=both",tick:"tick-0",category:"misc"}},FurnaceAmiga:LN,FurnaceSEGAPCM:LN,FurnaceQSOUND:LN,FurnaceES5506:LN,FurnaceRF5C68:LN,FurnaceC140:LN,FurnaceC219:LN,FurnaceK054539:LN,FurnaceYMZ280B:LN,FurnaceGA20:LN,FurnaceK007232:LN,FurnaceK053260:LN,FurnaceOKI:LN};const VN={pitch:"Pitch",volume:"Volume",panning:"Panning",timing:"Timing",global:"Global",sample:"Sample",misc:"Misc",chip:"Chip"},zN=["pitch","volume","panning","timing","global","sample","misc"],UN={pitch:"text-blue-400",volume:"text-emerald-400",panning:"text-purple-400",timing:"text-yellow-400",global:"text-red-400",sample:"text-cyan-400",misc:"text-orange-400",chip:"text-pink-400"},GN=({isOpen:e,position:t,onSelect:a,onClose:n,synthType:r})=>{const[i,o]=s.useState(""),[l,c]=s.useState("all"),u=s.useRef(null),d=s.useRef(null);s.useEffect(()=>{e&&d.current&&d.current.focus()},[e]),s.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&(e.preventDefault(),n())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]);const p=r&&function(e){return e.startsWith("Furnace")||e in BN}(r),h=s.useMemo(()=>{const e=[];if(Object.entries(AN).forEach(([t,a])=>{e.push({...a,key:t,isExtended:!1,isFurnace:!1})}),Object.entries(ON).forEach(([t,a])=>{e.push({...a,key:t,isExtended:!0,isFurnace:!1})}),p&&r){const t=function(e){return e&&BN[e]?Object.values(BN[e]):Object.values(IN)}(r);t.forEach(t=>{const a=t.command.substring(0,2);e.push({...t,key:a,isExtended:!1,isFurnace:!0,category:"misc"})})}return e},[p,r]),m=s.useMemo(()=>{const e=i.toLowerCase();return h.filter(t=>{if("chip"===l){if(!t.isFurnace)return!1}else if("all"!==l){if(t.isFurnace)return!1;if(t.category!==l)return!1}return!i||(t.name.toLowerCase().includes(e)||t.command.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))})},[h,i,l]);if(!e)return null;const f=t?{position:"fixed",left:Math.max(0,Math.min(t.x,window.innerWidth-400)),top:Math.max(0,Math.min(t.y,window.innerHeight-500)),zIndex:60}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:60};return xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"fixed inset-0 bg-black/40 z-50",onClick:n}),xa.jsxs("div",{ref:u,className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[380px] max-h-[480px] flex flex-col z-[60]",style:f,children:[xa.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[xa.jsx("h3",{className:"text-sm font-semibold text-neutral-100",children:"Effect Commands"}),xa.jsx("button",{onClick:n,className:"text-neutral-400 hover:text-neutral-200","aria-label":"Close effect picker",children:xa.jsx(Ee,{size:16})})]}),xa.jsx("div",{className:"px-3 py-2 border-b border-neutral-800",children:xa.jsx("input",{ref:d,type:"text",placeholder:"Search effects...",value:i,onChange:e=>o(e.target.value),className:"w-full bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 focus:outline-none focus:border-blue-500","aria-label":"Search effects"})}),xa.jsxs("div",{className:"flex flex-wrap gap-1 px-3 py-1.5 border-b border-neutral-800",children:[xa.jsx("button",{onClick:()=>c("all"),className:"px-2 py-0.5 text-[10px] rounded "+("all"===l?"bg-neutral-700 text-white":"text-neutral-400 hover:text-neutral-200"),children:"All"}),zN.map(e=>xa.jsx("button",{onClick:()=>c(e),className:"px-2 py-0.5 text-[10px] rounded "+(l===e?"bg-neutral-700 text-white":`${UN[e]} hover:opacity-80`),children:VN[e]},e)),p&&xa.jsxs("button",{onClick:()=>c("chip"),className:"px-2 py-0.5 text-[10px] rounded "+("chip"===l?"bg-pink-700 text-white":`${UN.chip} hover:opacity-80`),children:[VN.chip," (",r?.replace("Furnace",""),")"]})]}),xa.jsx("div",{className:"overflow-y-auto flex-1 p-1",children:0===m.length?xa.jsx("div",{className:"text-center text-neutral-500 text-xs py-4",children:"No effects match"}):m.map(e=>{const t=e.isFurnace?UN.chip:UN[e.category];return xa.jsxs("button",{onClick:()=>(e=>{if(e.isExtended){const t=parseInt(e.key.substring(1),16);a(14,t<<4)}else if(e.isFurnace){const t=parseInt(e.key,16);a(t,0)}else{const t=parseInt(e.key,16);a(t,0)}n()})(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-800 transition-colors text-left group",children:[xa.jsx("span",{className:`font-mono text-xs font-bold w-8 ${t}`,children:e.command.substring(0,3)}),xa.jsxs("div",{className:"flex-1 min-w-0",children:[xa.jsxs("div",{className:"text-xs text-neutral-200 truncate",children:[e.name,e.isFurnace&&xa.jsx("span",{className:"ml-1 text-[9px] text-pink-400",children:"(Chip)"})]}),xa.jsx("div",{className:"text-[10px] text-neutral-500 truncate",children:e.description})]}),xa.jsx("span",{className:"text-[9px] text-neutral-600 group-hover:text-neutral-400",children:"tick-0"===e.tick?"T0":"tick-N"===e.tick?"TN":"T*"})]},e.isFurnace?`f-${e.key}`:e.isExtended?`e-${e.key}`:`n-${e.key}`)})})]})]})},WN={"text-blue-400":"bg-blue-400","text-green-400":"bg-green-400","text-yellow-400":"bg-yellow-400","text-red-400":"bg-red-400","text-purple-400":"bg-purple-400","text-orange-400":"bg-orange-400","text-cyan-400":"bg-cyan-400","text-neutral-400":"bg-neutral-400"},HN=e=>WN[e]||"bg-neutral-400",KN=({isOpen:e,onClose:t})=>{const{undoStack:a,redoStack:n,undo:s,redo:r}=zg();if(!e)return null;const i=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return xa.jsxs("div",{className:"absolute right-0 top-0 w-64 h-full bg-neutral-900 border-l border-neutral-700 flex flex-col z-30 shadow-xl",children:[xa.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(It,{size:14,className:"text-neutral-400"}),xa.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"History"})]}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx("button",{onClick:s,disabled:0===a.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Undo","aria-label":"Undo",children:xa.jsx(Dt,{size:12,className:"text-neutral-400"})}),xa.jsx("button",{onClick:r,disabled:0===n.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Redo","aria-label":"Redo",children:xa.jsx(Ft,{size:12,className:"text-neutral-400"})}),xa.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors text-xs","aria-label":"Close history panel",children:"x"})]})]}),xa.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n.length>0&&xa.jsxs("div",{className:"opacity-40",children:[xa.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Redo (",n.length,")"]}),[...n].reverse().map((e,t)=>xa.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>r(),title:"Redo one step",children:[xa.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${HN(Gg(e.type))}`}),xa.jsx("div",{className:"flex-1 min-w-0",children:xa.jsx("div",{className:"text-[10px] text-neutral-400 truncate",children:Ug(e.type)})}),xa.jsx("span",{className:"text-[9px] text-neutral-600",children:i(e.timestamp)})]},`redo-${e.id}-${t}`))]}),xa.jsx("div",{className:"px-3 py-1 bg-blue-900/30 border-y border-blue-800/50",children:xa.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"Current State"})}),a.length>0?xa.jsxs("div",{children:[xa.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Undo (",a.length,")"]}),[...a].reverse().map((e,t)=>xa.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>s(),title:"Undo one step",children:[xa.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${HN(Gg(e.type))}`}),xa.jsxs("div",{className:"flex-1 min-w-0",children:[xa.jsx("div",{className:"text-[10px] text-neutral-300 truncate",children:Ug(e.type)}),e.description&&xa.jsx("div",{className:"text-[9px] text-neutral-500 truncate",children:e.description})]}),xa.jsx("span",{className:"text-[9px] text-neutral-600",children:i(e.timestamp)})]},`undo-${e.id}-${t}`))]}):xa.jsx("div",{className:"text-center text-neutral-600 text-xs py-8",children:"No history yet"})]}),xa.jsx("div",{className:"px-3 py-1.5 border-t border-neutral-700 text-[9px] text-neutral-600 text-center",children:"Ctrl+Z undo | Ctrl+Y redo"})]})},$N=({isOpen:e,onClose:t})=>{const{patterns:a,patternOrder:n,currentPositionIndex:r,setCurrentPosition:i,addToOrder:o,removeFromOrder:l}=tf(Da(e=>({patterns:e.patterns,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,addToOrder:e.addToOrder,removeFromOrder:e.removeFromOrder}))),c=s.useCallback(e=>{i(e)},[i]),u=s.useCallback(()=>{o(0)},[o]),d=s.useCallback(e=>{n.length>1&&l(e)},[l,n.length]),p=s.useCallback((e,t)=>{tf.setState(a=>{const n=[...a.patternOrder];return n[e]=t,{patternOrder:n}})},[]);return e?xa.jsxs("div",{className:"absolute left-0 top-0 w-56 h-full bg-neutral-900 border-r border-neutral-700 flex flex-col z-30 shadow-xl",children:[xa.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[xa.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"Pattern Matrix"}),xa.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors",children:xa.jsx(Ee,{size:14})})]}),xa.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:xa.jsxs("table",{className:"w-full border-collapse",children:[xa.jsx("thead",{children:xa.jsxs("tr",{children:[xa.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pos"}),xa.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pattern"}),xa.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-right",children:"Len"}),xa.jsx("th",{className:"w-6"})]})}),xa.jsx("tbody",{children:n.map((e,t)=>{const s=t===r,i=a[e];return xa.jsxs("tr",{className:"cursor-pointer transition-colors "+(s?"bg-blue-900/40 text-blue-300":"hover:bg-neutral-800 text-neutral-300"),onClick:()=>c(t),children:[xa.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-neutral-500",children:t.toString(16).toUpperCase().padStart(2,"0")}),xa.jsx("td",{className:"px-1 py-0.5",children:xa.jsx("select",{value:e,onChange:e=>{e.stopPropagation(),p(t,parseInt(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-full bg-transparent text-[10px] font-mono cursor-pointer focus:outline-none "+(s?"text-blue-300":"text-neutral-300"),children:a.map((e,t)=>xa.jsxs("option",{value:t,className:"bg-neutral-900 text-neutral-200",children:[t.toString(16).toUpperCase().padStart(2,"0"),a[t]?.name?` ${a[t].name}`:""]},t))})}),xa.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-right text-neutral-500",children:i?.length||"?"}),xa.jsx("td",{className:"px-0.5 py-0.5",children:xa.jsx("button",{onClick:e=>{e.stopPropagation(),d(t)},className:"p-0.5 rounded hover:bg-red-900/50 text-neutral-600 hover:text-red-400 transition-colors",title:"Remove position",disabled:n.length<=1,children:xa.jsx(Ee,{size:10})})})]},t)})})]})}),xa.jsxs("div",{className:"px-3 py-2 border-t border-neutral-700 flex items-center justify-between",children:[xa.jsxs("span",{className:"text-[9px] text-neutral-500",children:[n.length," positions | ",a.length," patterns"]}),xa.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-[10px] bg-neutral-800 hover:bg-neutral-700 text-neutral-300 rounded transition-colors",children:[xa.jsx(Xe,{size:10}),"Add"]})]})]}):null},qN=({label:e,value:t,onChange:a,min:n=0,max:r=999,step:i=1,format:o="decimal",throttleMs:l=0,presets:c})=>{const u=s.useRef(null),d=s.useRef(null),p=s.useRef(t),h=s.useRef(0),m=s.useRef(null),[f,g]=s.useState(!1),[y,b]=s.useState({x:0,y:0});s.useEffect(()=>{p.current=t},[t]),s.useEffect(()=>()=>{u.current&&clearInterval(u.current),d.current&&clearTimeout(d.current)},[]),s.useEffect(()=>{if(!f)return;const e=e=>{m.current&&!m.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const v=s.useCallback(e=>{c&&0!==c.length&&(e.preventDefault(),b({x:e.clientX,y:e.clientY}),g(!0))},[c]),x=s.useCallback(e=>{a(e),g(!1)},[a]),w=s.useCallback(e=>{const t=Date.now();l>0&&t-h.current<l||(h.current=t,a(e))},[a,l]),k=s.useCallback(()=>{const e=Math.min(r,p.current+i);p.current=e,w(e)},[r,i,w]),S=s.useCallback(()=>{const e=Math.max(n,p.current-i);p.current=e,w(e)},[n,i,w]),M=s.useCallback(e=>{e(),d.current&&clearTimeout(d.current),u.current&&clearInterval(u.current),d.current=window.setTimeout(()=>{u.current=window.setInterval(e,80)},300)},[]),N=s.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u.current&&(clearInterval(u.current),u.current=null)},[]);return xa.jsxs("div",{ref:m,className:"ft2-numeric-group",onContextMenu:v,title:c?"Right-click for presets":void 0,children:[xa.jsxs("span",{className:"ft2-numeric-label",children:[e,":"]}),xa.jsx("span",{className:"ft2-numeric-value",children:(C=t,"hex"===o?C.toString(16).toUpperCase().padStart(2,"0"):C.toString().padStart(3,"0"))}),xa.jsxs("div",{className:"ft2-numeric-arrows",children:[xa.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>M(k),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(k),onTouchEnd:N,title:`Increase ${e}`,children:xa.jsx("span",{className:"ft2-arrow-icon",children:""})}),xa.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>M(S),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(S),onTouchEnd:N,title:`Decrease ${e}`,children:xa.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),f&&c&&xa.jsx("div",{className:"ft2-presets-menu",style:{position:"fixed",left:y.x,top:y.y,zIndex:1e3,backgroundColor:"#1a1a1d",border:"1px solid #333",borderRadius:"4px",padding:"4px 0",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",minWidth:"100px"},children:c.map(e=>xa.jsx("button",{onClick:()=>x(e.value),className:"ft2-preset-item",style:{display:"block",width:"100%",padding:"6px 12px",textAlign:"left",background:t===e.value?"#333":"transparent",border:"none",color:t===e.value?"#ef4444":"#e0e0e0",cursor:"pointer",fontSize:"12px",fontFamily:"monospace"},onMouseEnter:e=>e.currentTarget.style.background="#2a2a2d",onMouseLeave:a=>a.currentTarget.style.background=t===e.value?"#333":"transparent",children:e.label},e.value))})]});var C},XN={TB303:{type:"TB303",name:"TB-303",shortName:"303",description:"Classic acid bass synthesizer with resonant filter and slide",bestFor:["Acid bass","Squelchy lines","Techno","House"],icon:"Zap",color:"text-accent-primary"},MonoSynth:{type:"MonoSynth",name:"Mono Synth",shortName:"Mono",description:"Single-voice synth with oscillator, filter, and envelope",bestFor:["Bass","Lead lines","Portamento"],icon:"AudioLines",color:"text-blue-400"},Synth:{type:"Synth",name:"Basic Synth",shortName:"Synth",description:"Simple polyphonic synthesizer with amplitude envelope",bestFor:["Pads","Chords","Simple sounds"],icon:"Music2",color:"text-purple-400"},DuoSynth:{type:"DuoSynth",name:"Duo Synth",shortName:"Duo",description:"Two-voice synth with harmonics and vibratoesque LFO",bestFor:["Rich leads","Detuned sounds","Fat bass"],icon:"Layers",color:"text-indigo-400"},FMSynth:{type:"FMSynth",name:"FM Synth",shortName:"FM",description:"Frequency modulation synth for complex harmonic tones",bestFor:["Bells","Electric piano","Metallic sounds"],icon:"Radio",color:"text-cyan-400"},AMSynth:{type:"AMSynth",name:"AM Synth",shortName:"AM",description:"Amplitude modulation synth with ring modulation character",bestFor:["Tremolo effects","Ring mod","Atmospheric"],icon:"Activity",color:"text-teal-400"},PluckSynth:{type:"PluckSynth",name:"Pluck Synth",shortName:"Pluck",description:"Karplus-Strong string synthesis for plucked strings",bestFor:["Guitar","Harp","Pizzicato","String plucks"],icon:"Guitar",color:"text-amber-400"},MembraneSynth:{type:"MembraneSynth",name:"Membrane Synth",shortName:"Membrane",description:"Drum membrane simulation for kicks and toms",bestFor:["Kick drums","Toms","Percussion"],icon:"Circle",color:"text-orange-400"},MetalSynth:{type:"MetalSynth",name:"Metal Synth",shortName:"Metal",description:"Metallic percussion synthesis with harmonics",bestFor:["Hi-hats","Cymbals","Bells","Metallic hits"],icon:"Hexagon",color:"text-yellow-400"},NoiseSynth:{type:"NoiseSynth",name:"Noise Synth",shortName:"Noise",description:"Filtered noise generator with envelope",bestFor:["Snares","Hi-hats","Risers","FX"],icon:"Hash",color:"text-gray-400"},Wavetable:{type:"Wavetable",name:"Wavetable",shortName:"Wave",description:"Wavetable synth with morphing and unison",bestFor:["Evolving pads","Modern bass","Complex timbres"],icon:"Waves",color:"text-pink-400"},Sampler:{type:"Sampler",name:"Sampler",shortName:"Sampler",description:"Multi-sample playback with velocity layers",bestFor:["Realistic instruments","Sample kits","One-shots"],icon:"FileAudio",color:"text-rose-400"},Player:{type:"Player",name:"Sample Player",shortName:"Player",description:"Simple one-shot sample playback",bestFor:["Loops","One-shots","Vocal samples"],icon:"Play",color:"text-lime-400"},GranularSynth:{type:"GranularSynth",name:"Granular Synth",shortName:"Granular",description:"Sample-based granular synthesis with grain manipulation",bestFor:["Textures","Pads","Ambient","Sound design","Glitch"],icon:"Sparkles",color:"text-violet-400"},SuperSaw:{type:"SuperSaw",name:"SuperSaw",shortName:"SSaw",description:"Massive detuned saw waves for trance and EDM",bestFor:["Trance leads","EDM drops","Big chords","Supersaw stabs"],icon:"Layers",color:"text-orange-500"},PolySynth:{type:"PolySynth",name:"Poly Synth",shortName:"Poly",description:"True polyphonic synth with voice management",bestFor:["Chords","Pads","Polyphonic parts","Layered sounds"],icon:"LayoutGrid",color:"text-blue-500"},Organ:{type:"Organ",name:"Drawbar Organ",shortName:"Organ",description:"Hammond-style tonewheel organ with drawbars",bestFor:["House","Gospel","Jazz","Rock organ"],icon:"Piano",color:"text-amber-600"},DrumMachine:{type:"DrumMachine",name:"Roland TR-808/909",shortName:"808/909",description:"Analog drum synthesis (808/909 style)",bestFor:["Kicks","Snares","Hi-hats","Electronic drums"],icon:"Disc",color:"text-red-500"},ChipSynth:{type:"ChipSynth",name:"Chip Synth",shortName:"Chip",description:"8-bit video game console sounds",bestFor:["Chiptune","Retro","Lo-fi","Arpeggios"],icon:"Gamepad2",color:"text-green-400"},PWMSynth:{type:"PWMSynth",name:"PWM Synth",shortName:"PWM",description:"Pulse width modulation for rich analog tones",bestFor:["Analog pads","Warm leads","Classic synth"],icon:"Waves",color:"text-emerald-400"},StringMachine:{type:"StringMachine",name:"String Machine",shortName:"Strings",description:"Vintage ensemble strings (Solina-style)",bestFor:["Lush pads","Disco strings","Ambient","Retro"],icon:"Music4",color:"text-rose-400"},FormantSynth:{type:"FormantSynth",name:"Formant Synth",shortName:"Vocal",description:"Vowel synthesis for vocal-like sounds",bestFor:["Vocal pads","Talk box","Choir","Robotic"],icon:"Mic",color:"text-fuchsia-400"},Furnace:{type:"Furnace",name:"Furnace FM",shortName:"FUI",description:"FM engine compatible with Furnace Tracker (.fui) instruments",bestFor:["Genesis bass","FM bells","Retro arcade","4-op FM"],icon:"Cpu",color:"text-amber-500"},FurnaceOPN:{type:"FurnaceOPN",name:"Sega Genesis (YM2612)",shortName:"Genesis",description:"Sega Genesis / Mega Drive YM2612 - 6 channels of 4-op FM",bestFor:["Genesis bass","FM leads","Slap bass","16-bit game music"],icon:"Gamepad2",color:"text-blue-500"},FurnaceOPM:{type:"FurnaceOPM",name:"Arcade / X68000 (YM2151)",shortName:"OPM",description:"Yamaha YM2151 - Sharp X68000, arcade machines",bestFor:["Arcade FM","Bright leads","Brass","Game music"],icon:"Cpu",color:"text-cyan-500"},FurnaceOPL:{type:"FurnaceOPL",name:"AdLib / Sound Blaster (OPL3)",shortName:"OPL3",description:"Yamaha YMF262 - AdLib, Sound Blaster, DOS games",bestFor:["DOS game music","MIDI synth","Organs","PC gaming"],icon:"Monitor",color:"text-yellow-500"},FurnaceOPLL:{type:"FurnaceOPLL",name:"MSX / Sega (OPLL)",shortName:"OPLL",description:"Yamaha YM2413 - MSX, SMS FM unit, budget FM",bestFor:["MSX music","SMS FM","Lo-fi FM","Simple FM"],icon:"Radio",color:"text-orange-400"},FurnaceESFM:{type:"FurnaceESFM",name:"ESFM",shortName:"ESFM",description:"Enhanced Sound FM - advanced OPL3 with operator detune",bestFor:["Modern retro","Enhanced FM","Detuned sounds"],icon:"Zap",color:"text-purple-500"},FurnaceOPZ:{type:"FurnaceOPZ",name:"Yamaha TX81Z (OPZ)",shortName:"OPZ",description:"Yamaha YM2414 - TX81Z, DX11, advanced FM",bestFor:["Lately bass","DX bells","Complex FM","E-piano"],icon:"Piano",color:"text-indigo-500"},FurnaceNES:{type:"FurnaceNES",name:"Nintendo NES (2A03)",shortName:"NES",description:"Nintendo Entertainment System - 2 pulse, triangle, noise, DPCM",bestFor:["NES chiptune","8-bit melodies","Retro drums","Famicom"],icon:"Gamepad2",color:"text-red-500"},FurnaceGB:{type:"FurnaceGB",name:"Nintendo Game Boy",shortName:"GB",description:"Nintendo Game Boy - 2 pulse, wave, noise channels",bestFor:["Game Boy music","Lo-fi chiptune","Portable gaming"],icon:"Smartphone",color:"text-green-500"},FurnaceC64:{type:"FurnaceC64",name:"Commodore 64 (SID)",shortName:"SID",description:"Commodore 64 SID chip - 3 voices with filters",bestFor:["SID leads","Arpeggios","Filter sweeps","Demoscene"],icon:"Terminal",color:"text-violet-500"},FurnaceAY:{type:"FurnaceAY",name:"ZX Spectrum / Amstrad (AY)",shortName:"AY",description:"General Instrument AY - ZX Spectrum, MSX, Atari ST",bestFor:["ZX Spectrum","MSX","Amstrad CPC","Envelope tricks"],icon:"Tv",color:"text-sky-500"},FurnaceTIA:{type:"FurnaceTIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 - primitive but distinctive sound",bestFor:["Atari 2600","Primitive bleeps","Retro FX"],icon:"Joystick",color:"text-amber-600"},FurnaceVERA:{type:"FurnaceVERA",name:"Commander X16 (VERA)",shortName:"VERA",description:"Commander X16 - modern retro 16 channels PSG + PCM",bestFor:["Modern retro","X16 music","Rich PSG"],icon:"Cpu",color:"text-teal-500"},FurnaceSAA:{type:"FurnaceSAA",name:"SAM Coup (SAA1099)",shortName:"SAA",description:"Philips SAA1099 - Sam Coup, some PC sound cards",bestFor:["Sam Coup","Stereo chips","European home computers"],icon:"Speaker",color:"text-pink-500"},FurnacePSG:{type:"FurnacePSG",name:"Sega Master System (PSG)",shortName:"PSG",description:"TI SN76489 - Master System, Game Gear, BBC Micro",bestFor:["Master System","Colecovision","Square wave PSG"],icon:"SquareStack",color:"text-emerald-500"},FurnaceVIC:{type:"FurnaceVIC",name:"Commodore VIC-20",shortName:"VIC",description:"Commodore VIC-20 - 3 square + noise",bestFor:["VIC-20 music","Early 80s","Simple tones"],icon:"Monitor",color:"text-lime-500"},FurnaceLynx:{type:"FurnaceLynx",name:"Atari Lynx",shortName:"Lynx",description:"Atari Lynx - 4 channel wavetable",bestFor:["Lynx music","Portable gaming","Wavetable"],icon:"Gamepad",color:"text-rose-500"},FurnaceSID6581:{type:"FurnaceSID6581",name:"SID 6581",shortName:"6581",description:"Classic C64 SID - warm, gritty original chip",bestFor:["Authentic C64","Warm bass","Classic demoscene"],icon:"Terminal",color:"text-violet-400"},FurnaceSID8580:{type:"FurnaceSID8580",name:"SID 8580",shortName:"8580",description:"Revised SID - cleaner filter, brighter sound",bestFor:["Clean SID","Later C64/C128","Clearer filters"],icon:"Terminal",color:"text-violet-600"},FurnaceOPNA:{type:"FurnaceOPNA",name:"NEC PC-98 (OPNA)",shortName:"OPNA",description:"YM2608 - NEC PC-98, arcade machines",bestFor:["PC-98 music","Touhou-style","Japanese arcade"],icon:"Cpu",color:"text-blue-400"},FurnaceOPNB:{type:"FurnaceOPNB",name:"SNK Neo Geo (OPNB)",shortName:"OPNB",description:"YM2610 - SNK Neo Geo",bestFor:["Neo Geo music","Fighting games","SNK"],icon:"Gamepad2",color:"text-red-400"},FurnaceOPL4:{type:"FurnaceOPL4",name:"Yamaha OPL4",shortName:"OPL4",description:"Yamaha YMF278 - FM + wavetable hybrid",bestFor:["Advanced OPL","FM + samples","Late DOS"],icon:"Layers",color:"text-yellow-400"},FurnaceY8950:{type:"FurnaceY8950",name:"MSX-Audio (Y8950)",shortName:"Y8950",description:"Yamaha Y8950 - MSX-Audio, OPL + ADPCM",bestFor:["MSX-Audio","OPL with drums","Japanese PC"],icon:"Radio",color:"text-orange-300"},FurnacePCE:{type:"FurnacePCE",name:"PC Engine / TurboGrafx",shortName:"PCE",description:"PC Engine / TurboGrafx-16 - 6 channel wavetable",bestFor:["PC Engine","TurboGrafx","HuCard games"],icon:"Tv",color:"text-orange-500"},FurnaceSNES:{type:"FurnaceSNES",name:"Super Nintendo (SPC700)",shortName:"SNES",description:"Super Nintendo - Sony SPC700 8-channel BRR",bestFor:["SNES music","16-bit classics","BRR samples"],icon:"Gamepad2",color:"text-purple-400"},FurnaceVB:{type:"FurnaceVB",name:"Nintendo Virtual Boy",shortName:"VB",description:"Nintendo Virtual Boy - 6 channel wavetable",bestFor:["Virtual Boy","Stereo 3D audio","Nintendo VB"],icon:"Glasses",color:"text-red-600"},FurnaceSWAN:{type:"FurnaceSWAN",name:"Bandai WonderSwan",shortName:"SWAN",description:"Bandai WonderSwan - 4 channel wavetable + PCM",bestFor:["WonderSwan","Portable gaming","Bandai"],icon:"Smartphone",color:"text-cyan-400"},FurnaceVRC6:{type:"FurnaceVRC6",name:"Famicom (VRC6)",shortName:"VRC6",description:"Konami VRC6 - 2 pulse + saw (Castlevania 3 JP)",bestFor:["Castlevania 3","Konami NES","Extra channels"],icon:"Zap",color:"text-amber-400"},FurnaceVRC7:{type:"FurnaceVRC7",name:"Famicom (VRC7)",shortName:"VRC7",description:"Konami VRC7 - OPLL clone (Lagrange Point)",bestFor:["Lagrange Point","FM on NES","Konami FM"],icon:"Radio",color:"text-amber-500"},FurnaceN163:{type:"FurnaceN163",name:"Namco Arcade (N163)",shortName:"N163",description:"Namco 163 - 8 channel wavetable",bestFor:["Namco NES","Wavetable","Complex tones"],icon:"Waves",color:"text-green-400"},FurnaceFDS:{type:"FurnaceFDS",name:"Famicom Disk System",shortName:"FDS",description:"Famicom Disk System - wavetable + modulation",bestFor:["FDS games","Wavy bass","Zelda FDS"],icon:"Disc",color:"text-yellow-500"},FurnaceMMC5:{type:"FurnaceMMC5",name:"Famicom (MMC5)",shortName:"MMC5",description:"MMC5 - 2 extra pulse channels",bestFor:["Castlevania 3 US","Extra NES pulse","CV3"],icon:"Plus",color:"text-blue-300"},FurnaceTED:{type:"FurnaceTED",name:"Commodore Plus/4 (TED)",shortName:"TED",description:"Commodore Plus/4 TED - 2 square + noise",bestFor:["Plus/4 music","Commodore 16","Budget C64"],icon:"Monitor",color:"text-violet-400"},FurnaceSEGAPCM:{type:"FurnaceSEGAPCM",name:"Sega Arcade (SegaPCM)",shortName:"SEGAPCM",description:"Sega System 16/18 - 16 channel PCM",bestFor:["OutRun","After Burner","Sega arcade"],icon:"Speaker",color:"text-blue-500"},FurnaceQSOUND:{type:"FurnaceQSOUND",name:"Capcom Arcade (QSound)",shortName:"QSound",description:"Capcom QSound - CPS1/CPS2 with 3D audio",bestFor:["Street Fighter","CPS games","3D positioning"],icon:"Headphones",color:"text-purple-500"},FurnaceES5506:{type:"FurnaceES5506",name:"ES5506",shortName:"ES5506",description:"Ensoniq ES5506 - 32 voice wavetable",bestFor:["Taito F3","Ensoniq synths","High quality"],icon:"AudioLines",color:"text-pink-400"},FurnaceRF5C68:{type:"FurnaceRF5C68",name:"RF5C68",shortName:"RF5C68",description:"Ricoh RF5C68 - Sega CD, 8 channel PCM",bestFor:["Sega CD","Mega CD","CD audio"],icon:"Disc",color:"text-cyan-500"},FurnaceC140:{type:"FurnaceC140",name:"C140",shortName:"C140",description:"Namco C140 - System 2, 24 channel PCM",bestFor:["Namco arcade","System 2","Assault"],icon:"Cpu",color:"text-yellow-400"},FurnaceK007232:{type:"FurnaceK007232",name:"K007232",shortName:"K007232",description:"Konami K007232 - 2 channel PCM",bestFor:["Contra arcade","Konami PCM","TMNT"],icon:"Speaker",color:"text-red-400"},FurnaceK053260:{type:"FurnaceK053260",name:"K053260",shortName:"K053260",description:"Konami K053260 - 4 channel PCM with ADPCM",bestFor:["Sunset Riders","Simpsons","Konami 90s"],icon:"Speaker",color:"text-orange-400"},FurnaceGA20:{type:"FurnaceGA20",name:"GA20",shortName:"GA20",description:"Irem GA20 - 4 channel PCM",bestFor:["R-Type Leo","Irem arcade","In the Hunt"],icon:"Cpu",color:"text-teal-400"},FurnaceOKI:{type:"FurnaceOKI",name:"OKI MSM6295",shortName:"OKI",description:"OKI MSM6295 - 4 channel ADPCM",bestFor:["Neo Geo","Data East","ADPCM drums"],icon:"Volume2",color:"text-gray-400"},FurnaceYMZ280B:{type:"FurnaceYMZ280B",name:"YMZ280B",shortName:"YMZ280B",description:"Yamaha YMZ280B - 8 channel ADPCM",bestFor:["Cave shmups","Late arcade","High quality"],icon:"AudioLines",color:"text-indigo-400"},FurnaceSCC:{type:"FurnaceSCC",name:"Konami SCC",shortName:"SCC",description:"Konami SCC - 5 channel wavetable (MSX)",bestFor:["Gradius","Snatcher","MSX Konami"],icon:"Waves",color:"text-green-500"},FurnaceX1_010:{type:"FurnaceX1_010",name:"X1-010",shortName:"X1-010",description:"Seta X1-010 - 16 channel wavetable",bestFor:["Seta arcade","Wavetable","Twin Eagle"],icon:"Waves",color:"text-lime-400"},FurnaceBUBBLE:{type:"FurnaceBUBBLE",name:"Bubble System",shortName:"BUBBLE",description:"Konami Bubble System - wavetable",bestFor:["Konami arcade","Bubble System","Wavetable"],icon:"Circle",color:"text-sky-400"},FurnaceSM8521:{type:"FurnaceSM8521",name:"SM8521",shortName:"SM8521",description:"Sharp SM8521 - Game.com",bestFor:["Game.com","Tiger electronics","Obscure"],icon:"Smartphone",color:"text-gray-500"},FurnaceT6W28:{type:"FurnaceT6W28",name:"T6W28",shortName:"T6W28",description:"NEC T6W28 - PC-6001, stereo PSG",bestFor:["NEC PC-6001","Japanese PC","Stereo PSG"],icon:"Monitor",color:"text-blue-300"},FurnaceSUPERVISION:{type:"FurnaceSUPERVISION",name:"Supervision",shortName:"SV",description:"Watara Supervision - 4 channel + noise/DMA",bestFor:["Supervision","Portable gaming","Watara"],icon:"Gamepad",color:"text-emerald-400"},FurnaceUPD1771:{type:"FurnaceUPD1771",name:"PD1771",shortName:"UPD1771",description:"NEC PD1771 - Epoch Super Cassette Vision",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-400"},FurnaceOPN2203:{type:"FurnaceOPN2203",name:"YM2203 / OPN",shortName:"OPN",description:"YM2203 - PC-88/98, simpler 3-channel FM + SSG",bestFor:["PC-88 music","Japanese PC games","Simpler FM"],icon:"Cpu",color:"text-blue-300"},FurnaceOPNBB:{type:"FurnaceOPNBB",name:"YM2610B",shortName:"OPNB-B",description:"YM2610B - Extended Neo Geo with more FM channels",bestFor:["Neo Geo CD","Extended OPNB","SNK"],icon:"Gamepad2",color:"text-red-300"},FurnaceAY8930:{type:"FurnaceAY8930",name:"AY-8930",shortName:"AY+",description:"Enhanced AY-3-8910 with expanded features",bestFor:["Enhanced chiptune","Extended AY","Microchip"],icon:"Tv",color:"text-sky-400"},FurnaceNDS:{type:"FurnaceNDS",name:"Nintendo DS",shortName:"NDS",description:"Nintendo DS - 16 channel PCM/PSG",bestFor:["NDS music","Portable gaming","Modern chiptune"],icon:"Smartphone",color:"text-slate-400"},FurnaceGBA:{type:"FurnaceGBA",name:"Game Boy Advance",shortName:"GBA",description:"GBA DMA Sound - 2 channel direct PCM",bestFor:["GBA music","Portable gaming","PCM"],icon:"Gamepad",color:"text-purple-300"},FurnacePOKEMINI:{type:"FurnacePOKEMINI",name:"Pokemon Mini",shortName:"PKMN",description:"Pokemon Mini - tiny handheld sound",bestFor:["Pokemon Mini","Tiny tunes","Lo-fi"],icon:"Star",color:"text-yellow-300"},FurnaceNAMCO:{type:"FurnaceNAMCO",name:"Namco WSG",shortName:"WSG",description:"Namco WSG - Pac-Man, Galaga wavetable",bestFor:["Pac-Man","Galaga","Classic arcade"],icon:"Circle",color:"text-yellow-400"},FurnacePET:{type:"FurnacePET",name:"Commodore PET",shortName:"PET",description:"Commodore PET - single voice shift register",bestFor:["PET music","Early 80s","Primitive"],icon:"Monitor",color:"text-green-300"},FurnacePOKEY:{type:"FurnacePOKEY",name:"Atari POKEY",shortName:"POKEY",description:"Atari POKEY - Atari 800/5200/arcade",bestFor:["Atari 8-bit","Atari arcade","Classic chiptune"],icon:"Joystick",color:"text-orange-400"},FurnaceMSM6258:{type:"FurnaceMSM6258",name:"MSM6258",shortName:"MSM6258",description:"OKI MSM6258 - 4-bit ADPCM voice",bestFor:["Voice samples","ADPCM","Japanese arcade"],icon:"Mic",color:"text-pink-300"},FurnaceMSM5232:{type:"FurnaceMSM5232",name:"MSM5232",shortName:"MSM5232",description:"OKI MSM5232 - 8-voice PSG synthesizer",bestFor:["Early arcade","Organ sounds","8-voice"],icon:"Music2",color:"text-amber-300"},FurnaceMULTIPCM:{type:"FurnaceMULTIPCM",name:"Sega MultiPCM",shortName:"MPCM",description:"Sega MultiPCM - System 32, Model 1/2",bestFor:["Virtua Racing","Sega arcade","High quality PCM"],icon:"Headphones",color:"text-blue-400"},FurnaceAMIGA:{type:"FurnaceAMIGA",name:"Amiga Paula",shortName:"PAULA",description:"Amiga Paula - 4 channel 8-bit PCM",bestFor:["Amiga MODs","Demoscene","Classic samples"],icon:"Disc",color:"text-slate-300"},FurnacePCSPKR:{type:"FurnacePCSPKR",name:"PC Speaker",shortName:"PCSPK",description:"PC Speaker - internal IBM PC beeper",bestFor:["DOS games","Beeper music","Lo-fi PC"],icon:"Volume2",color:"text-gray-400"},FurnacePONG:{type:"FurnacePONG",name:"AY-3-8500",shortName:"PONG",description:"AY-3-8500 - original Pong chip sound",bestFor:["Pong","Retro bleeps","Primitive"],icon:"Circle",color:"text-white"},FurnacePV1000:{type:"FurnacePV1000",name:"Casio PV-1000",shortName:"PV1K",description:"Casio PV-1000 - 3 channel PSG",bestFor:["PV-1000","Obscure","Japanese"],icon:"Tv",color:"text-green-400"},FurnaceDAVE:{type:"FurnaceDAVE",name:"Enterprise DAVE",shortName:"DAVE",description:"Enterprise DAVE - 3 channel + noise",bestFor:["Enterprise 64/128","Hungarian","European"],icon:"Monitor",color:"text-red-300"},FurnaceSU:{type:"FurnaceSU",name:"Sound Unit",shortName:"SU",description:"Commander X16 Sound Unit",bestFor:["X16 music","Modern retro","Sound Unit"],icon:"Speaker",color:"text-teal-300"},FurnacePOWERNOISE:{type:"FurnacePOWERNOISE",name:"Power Noise",shortName:"PNOISE",description:"Power Noise - noise generator chip",bestFor:["Noise music","Experimental","Harsh sounds"],icon:"Zap",color:"text-violet-400"},FurnaceZXBEEPER:{type:"FurnaceZXBEEPER",name:"ZX Beeper",shortName:"BEEP",description:"ZX Spectrum beeper - 1-bit audio",bestFor:["ZX Spectrum","Beeper music","1-bit audio"],icon:"Speaker",color:"text-cyan-300"},FurnaceSCVTONE:{type:"FurnaceSCVTONE",name:"SCV Tone",shortName:"SCV",description:"Epoch SCV tone generator",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-300"},FurnacePCMDAC:{type:"FurnacePCMDAC",name:"PCM DAC",shortName:"DAC",description:"Generic PCM DAC output",bestFor:["PCM output","Generic DAC","Simple samples"],icon:"AudioLines",color:"text-gray-300"},ChiptuneModule:{type:"ChiptuneModule",name:"Chiptune Module",shortName:"MOD",description:"Libopenmpt-powered playback for MOD/XM/IT/S3M files",bestFor:["Tracker modules","Retro game music","Sample-accurate playback"],icon:"Gamepad2",color:"text-lime-400"},WobbleBass:{type:"WobbleBass",name:"Wobble Bass",shortName:"Wobble",description:"Dubstep/DnB bass with tempo-synced LFO, Reese detuning, FM growl",bestFor:["Dubstep","DnB","Jungle","Neurofunk","Riddim"],icon:"Waves",color:"text-fuchsia-500"},DrumKit:{type:"DrumKit",name:"Drum Kit",shortName:"Kit",description:"Multi-sample instrument with keymap - assign different samples to different notes",bestFor:["Drum kits","Instrument layers","Velocity splits","Sample mapping"],icon:"Piano",color:"text-amber-500"},Buzzmachine:{type:"Buzzmachine",name:"Buzzmachine",shortName:"Buzz",description:"Jeskola Buzz machines - classic tracker effects and generators from the Buzz ecosystem",bestFor:["Effects","Generators","Classic tracker sounds","Buzz compatibility"],icon:"Cpu",color:"text-yellow-500"},BuzzDTMF:{type:"BuzzDTMF",name:"CyanPhase DTMF",shortName:"DTMF",description:"Phone dial tone generator - classic DTMF tones",bestFor:["Phone tones","Retro effects","Experimental"],icon:"Phone",color:"text-cyan-400"},BuzzFreqBomb:{type:"BuzzFreqBomb",name:"Frequency Bomb",shortName:"FreqBomb",description:"Elenzil Frequency Bomb - chaotic frequency modulation",bestFor:["Noise","Chaos","Experimental"],icon:"Bomb",color:"text-red-500"},BuzzKick:{type:"BuzzKick",name:"FSM Kick",shortName:"Kick",description:"FSM Kick drum synthesizer",bestFor:["Kick drums","Bass drums","Percussion"],icon:"Drum",color:"text-orange-500"},BuzzKickXP:{type:"BuzzKickXP",name:"FSM KickXP",shortName:"KickXP",description:"Extended FSM Kick with more parameters",bestFor:["Kick drums","Deep bass","EDM kicks"],icon:"Drum",color:"text-orange-600"},BuzzNoise:{type:"BuzzNoise",name:"Jeskola Noise",shortName:"Noise",description:"Jeskola Noise generator",bestFor:["Noise","Hi-hats","Textures"],icon:"Waves",color:"text-gray-400"},BuzzTrilok:{type:"BuzzTrilok",name:"Jeskola Trilok",shortName:"Trilok",description:"Jeskola Trilok bass drum synthesizer",bestFor:["Bass drums","Toms","Percussion"],icon:"Drum",color:"text-amber-500"},Buzz4FM2F:{type:"Buzz4FM2F",name:"MadBrain 4FM2F",shortName:"4FM2F",description:"4-operator FM synthesizer with 2 filters",bestFor:["FM sounds","Complex timbres","DX-style"],icon:"Radio",color:"text-purple-500"},BuzzDynamite6:{type:"BuzzDynamite6",name:"MadBrain Dynamite6",shortName:"Dyn6",description:"6-voice additive synthesizer",bestFor:["Additive synthesis","Organs","Complex sounds"],icon:"Zap",color:"text-yellow-500"},BuzzM3:{type:"BuzzM3",name:"Makk M3",shortName:"M3",description:"Dual-oscillator mono synth",bestFor:["Bass","Leads","Classic synth"],icon:"AudioLines",color:"text-green-500"},Buzz3o3:{type:"Buzz3o3",name:"Oomek Aggressor 3o3",shortName:"3o3",description:"TB-303 style acid synth clone",bestFor:["Acid bass","Squelchy lines","Techno"],icon:"Zap",color:"text-lime-500"},MAMEVFX:{type:"MAMEVFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq ES5506 (OTTO) 32-voice wavetable synthesis",bestFor:["Evolving pads","90s digital","Cinematic","Layers"],icon:"AudioLines",color:"text-pink-400"},MAMEDOC:{type:"MAMEDOC",name:"Ensoniq ESQ-1",shortName:"DOC",description:"Ensoniq ES5503 (DOC) 8-bit wavetable synthesis",bestFor:["Lo-fi digital","ESQ-1 pads","Gritty bass","80s digital"],icon:"Waves",color:"text-amber-400"},MAMERSA:{type:"MAMERSA",name:"Roland SA",shortName:"MKS20",description:"Roland Structured Adaptive Synthesis (MKS-20/RD-1000)",bestFor:["Electric piano","Authentic piano","80s keys"],icon:"Piano",color:"text-sky-400"},MAMESWP30:{type:"MAMESWP30",name:"Yamaha SWP30",shortName:"AWM2",description:"Yamaha SWP30 (AWM2) 64-voice ROMpler/DSP engine",bestFor:["Realistic instruments","90s ROMpler","Advanced effects","AWM2 sounds"],icon:"Cpu",color:"text-emerald-400"},CZ101:{type:"CZ101",name:"Casio CZ-101",shortName:"CZ",description:"Casio Phase Distortion synthesis - 8 voices, dual oscillator with DCO/DCW/DCA envelopes",bestFor:["Digital bass","Metallic leads","Synth brass","80s digital","Phase distortion"],icon:"Activity",color:"text-violet-400"},CEM3394:{type:"CEM3394",name:"CEM3394 (Curtis)",shortName:"CEM",description:"Curtis Electromusic analog synth voice - used in Prophet VS, Matrix-6, ESQ-1, Six-Trak",bestFor:["Analog bass","Warm pads","Classic leads","80s analog","Prophet sounds"],icon:"Waves",color:"text-emerald-400"},SCSP:{type:"SCSP",name:"Sega Saturn SCSP",shortName:"SCSP",description:"Yamaha YMF292-F 32-voice sound processor - Sega Saturn, Model 2/3 arcade",bestFor:["Arcade sounds","90s gaming","Saturn pads","Virtua sounds","Sega classics"],icon:"Gamepad2",color:"text-blue-500"},DubSiren:{type:"DubSiren",name:"Dub Siren",shortName:"Siren",description:"Classic dub sound system siren with LFO and delay",bestFor:["Dub FX","Reggae","Sound system","Alerts"],icon:"Megaphone",color:"text-red-500"},SpaceLaser:{type:"SpaceLaser",name:"Space Laser",shortName:"Laser",description:"FM-based cosmic zap generator for classic reggae and anime effects",bestFor:["Laser shots","Anime FX","Reggae dubs","Sci-fi"],icon:"Zap",color:"text-green-500"},V2:{type:"V2",name:"Farbrausch V2 Synth",shortName:"V2",description:"Authentic 4k/64k demoscene synthesis with multi-voice subtractive engine.",bestFor:["Demoscene","Trance","Techno","Leads"],icon:"Radio",color:"amber"},V2Speech:{type:"V2Speech",name:"V2 Speech",shortName:"V2Sp",description:"Farbrausch V2 speech synthesis module for robotic and vocoder-style voices.",bestFor:["Speech","Robotic Voices","Demoscene","FX"],icon:"Radio",color:"amber"},Sam:{type:"Sam",name:"Commodore SAM",shortName:"SAM",description:"Software Automatic Mouth - classic 8-bit speech synthesizer from 1982.",bestFor:["Speech","Robotic Voices","Lo-Fi","FX"],icon:"MessageSquare",color:"amber"},Synare:{type:"Synare",name:"Synare 3",shortName:"Synare",description:'Classic electronic percussion synthesizer for "disco tom" and dub sounds',bestFor:["Dub percussion","Disco toms","Electronic drums","SFX"],icon:"Drum",color:"text-yellow-500"},WAM:{type:"WAM",name:"Web Audio Module",shortName:"WAM",description:"Load external audio plugins from URL (standard WAM 2.0 format)",bestFor:["External plugins","Community synths","Rich UI"],icon:"Globe",color:"text-cyan-400"},Dexed:{type:"Dexed",name:"Dexed (DX7)",shortName:"DX7",description:"Yamaha DX7 FM synthesizer emulation - 6-operator FM with 32 algorithms",bestFor:["FM Bass","Electric Piano","Bells","Pads","Classic FM sounds"],icon:"Piano",color:"text-blue-400"},OBXd:{type:"OBXd",name:"OBXd (Oberheim)",shortName:"OBXd",description:"Oberheim OB-X analog polysynth emulation - classic warm analog sounds",bestFor:["Pads","Brass","Strings","Warm leads","Analog sounds"],icon:"Waves",color:"text-amber-400"},DexedBridge:{type:"DexedBridge",name:"Dexed DX7 (Bridge)",shortName:"DX7B",description:"Dexed DX7 via VSTBridge generic framework - test/validation of the bridge",bestFor:["FM Bass","Electric Piano","Bells","Bridge testing"],icon:"Plug",color:"text-purple-400"},Vital:{type:"Vital",name:"Vital (Wavetable)",shortName:"Vital",description:"Spectral warping wavetable synthesizer - 3 oscillators with spectral morphing, 13 morph types, phase distortion",bestFor:["Wavetable","Spectral","Modern bass","Pads","Leads","Sound design"],icon:"Waves",color:"text-violet-400"},Odin2:{type:"Odin2",name:"Odin2 (Hybrid)",shortName:"Odin2",description:"Semi-modular hybrid synth - 11 oscillator types (analog, wavetable, FM, vector, chiptune), 9 filter types, modulation matrix",bestFor:["Hybrid synthesis","Analog","Wavetable","FM","Vector","Chiptune"],icon:"Zap",color:"text-emerald-400"},Surge:{type:"Surge",name:"Surge XT (Hybrid)",shortName:"Surge",description:"Professional hybrid synth - dual scenes, 12 oscillator types, 32 effect types, 765 parameters, open source since 2018",bestFor:["Professional","Hybrid","Sound design","Bass","Pads","Leads","FX"],icon:"Activity",color:"text-cyan-400"},TonewheelOrgan:{type:"TonewheelOrgan",name:"Tonewheel Organ",shortName:"Organ",description:"Hammond-style tonewheel organ - 9 drawbars, key click, percussion, vibrato/chorus scanner, overdrive",bestFor:["Reggae organ","Gospel","Jazz","Blues","Rock organ","Ska"],icon:"Music",color:"text-amber-400"},Melodica:{type:"Melodica",name:"Melodica",shortName:"Melod",description:"Monophonic reed instrument physical model - breath dynamics, body resonance, vibrato, portamento",bestFor:["Reggae melodica","Dub","Ska","Augustus Pablo","Lead melodies"],icon:"Wind",color:"text-teal-400"},Monique:{type:"Monique",name:"Monique (Monosynth)",shortName:"Moniq",description:"Morphing monosynth - 3 oscillators, 3 cross-routed filters, 4 tempo-synced MFOs, distortion, delay, arpeggiator",bestFor:["Wobble bass","Dubstep","DnB bass","Acid","Mono leads","Bass"],icon:"AudioLines",color:"text-rose-400"},Buzz3o3DF:{type:"Buzz3o3DF",name:"Aggressor Devil Fish",shortName:"3o3DF",description:"Enhanced TB-303 clone with Devil Fish mods - accent decay, VEG, filter tracking, muffler",bestFor:["Acid bass","Deep acid","Experimental","Devil Fish tones"],icon:"Zap",color:"text-lime-400"},BuzzM4:{type:"BuzzM4",name:"Makk M4",shortName:"M4",description:"Wavetable synth with 100+ waveforms, dual oscillators, sub osc, and dual LFOs",bestFor:["Wavetable","Leads","Pads","Bass"],icon:"Layers",color:"text-sky-400"},MAMEAICA:{type:"MAMEAICA",name:"Sega AICA",shortName:"AICA",description:"Sega Dreamcast/Naomi AICA - 64-voice ADPCM+FM sound processor",bestFor:["Dreamcast sounds","Arcade PCM","90s gaming","ADPCM samples"],icon:"Gamepad2",color:"text-blue-400"},MAMEASC:{type:"MAMEASC",name:"Apple Sound Chip",shortName:"ASC",description:"Apple ASC - 4-voice wavetable synthesis from Apple IIGS and Mac",bestFor:["Retro Mac","Wavetable","IIGS sounds","80s digital"],icon:"Cpu",color:"text-gray-400"},MAMEAstrocade:{type:"MAMEAstrocade",name:"Bally Astrocade",shortName:"Astro",description:"Bally Astrocade custom sound - 3 voices + noise, vibrato modulation",bestFor:["Retro arcade","Lo-fi","Noise FX","Vintage gaming"],icon:"Gamepad2",color:"text-purple-400"},MAMEC352:{type:"MAMEC352",name:"Namco C352",shortName:"C352",description:"Namco System 22/23 - 32-voice PCM with built-in effects (needs ROM)",bestFor:["Namco arcade","Ridge Racer","Tekken sounds","Arcade PCM"],icon:"Gamepad2",color:"text-red-400"},MAMEES5503:{type:"MAMEES5503",name:"Ensoniq ES5503",shortName:"ES5503",description:"Ensoniq DOC - 32-oscillator wavetable chip (Apple IIGS, ESQ-1, Mirage)",bestFor:["Wavetable","Lo-fi digital","80s synth","IIGS music"],icon:"Waves",color:"text-amber-400"},MAMEICS2115:{type:"MAMEICS2115",name:"ICS WaveFront",shortName:"ICS",description:"ICS 2115 WaveFront - 32-voice wavetable with interpolation (needs ROM)",bestFor:["Wavetable","90s soundcard","GUS compatible","Tracker music"],icon:"Cpu",color:"text-teal-400"},MAMEK054539:{type:"MAMEK054539",name:"Konami K054539",shortName:"K054",description:"Konami 054539 - 8-channel PCM for Konami arcade (needs ROM)",bestFor:["Konami arcade","TMNT","Gradius","Arcade samples"],icon:"Gamepad2",color:"text-yellow-400"},MAMEMEA8000:{type:"MAMEMEA8000",name:"Philips MEA8000",shortName:"MEA",description:"Philips MEA8000 - LPC speech synthesis with formant modeling",bestFor:["Speech","Robotic voice","Retro talking","Voice FX"],icon:"Mic",color:"text-green-400"},MAMEMSM5232:{type:"MAMEMSM5232",name:"OKI MSM5232",shortName:"MSM",description:"OKI MSM5232 - 8-voice PSG organ/synth chip (MAME native emulation)",bestFor:["Organ","Arcade melody","Retro synth","Simple tones"],icon:"Cpu",color:"text-orange-400"},MAMERF5C400:{type:"MAMERF5C400",name:"Ricoh RF5C400",shortName:"RF5C",description:"Ricoh RF5C400 - 32-voice PCM with digital filtering (needs ROM)",bestFor:["Seta arcade","PCM playback","Arcade samples"],icon:"Cpu",color:"text-indigo-400"},MAMESN76477:{type:"MAMESN76477",name:"TI SN76477",shortName:"SN77",description:"TI SN76477 Complex Sound Generator - VCO, noise, envelope, mixer",bestFor:["Sci-fi FX","Laser sounds","Space Invaders","Retro arcade FX"],icon:"Zap",color:"text-green-500"},MAMESNKWave:{type:"MAMESNKWave",name:"SNK Wave",shortName:"SNK",description:"SNK custom wavetable sound generator - Neo Geo era",bestFor:["Retro arcade","Wavetable","SNK sounds","Lo-fi"],icon:"Gamepad2",color:"text-red-500"},MAMESP0250:{type:"MAMESP0250",name:"GI SP0250",shortName:"SP02",description:"General Instrument SP0250 - LPC speech synthesis for arcade machines",bestFor:["Arcade speech","Robotic voice","Q*bert sounds","Retro talking"],icon:"Mic",color:"text-yellow-500"},MAMETIA:{type:"MAMETIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 TIA - MAME-accurate 2-voice with 16 distortion modes",bestFor:["Atari sounds","2600 bleeps","Lo-fi","Retro FX"],icon:"Gamepad2",color:"text-amber-500"},MAMETMS36XX:{type:"MAMETMS36XX",name:"TMS36XX Organ",shortName:"TMS3",description:"TI TMS3615/3617 - electronic organ chip with 13 chromatic notes",bestFor:["Electronic organ","Retro tones","Circus music","Simple melody"],icon:"Music2",color:"text-rose-400"},MAMETMS5220:{type:"MAMETMS5220",name:"Speak & Spell",shortName:"TMS5",description:"TI TMS5220 LPC speech - the Speak & Spell chip, phoneme-based voice",bestFor:["Speech","Speak & Spell","Robotic voice","LPC vocoder"],icon:"Mic",color:"text-orange-500"},MAMETR707:{type:"MAMETR707",name:"Roland TR-707",shortName:"707",description:"Roland TR-707 PCM drum machine - 10 voices with analog filtering (needs ROM)",bestFor:["House drums","Electro beats","80s rhythm","Classic drum machine"],icon:"Disc",color:"text-red-400"},MAMEUPD931:{type:"MAMEUPD931",name:"NEC uPD931",shortName:"931",description:"NEC uPD931 - speech synthesis processor with LPC coding",bestFor:["Japanese speech","Arcade voice","Retro talking","Speech FX"],icon:"Mic",color:"text-cyan-400"},MAMEUPD933:{type:"MAMEUPD933",name:"NEC uPD933",shortName:"933",description:"NEC uPD933 raw phase distortion chip - the core of the Casio CZ series",bestFor:["Phase distortion","CZ sounds","Digital bass","Metallic leads"],icon:"Activity",color:"text-violet-400"},MAMEVotrax:{type:"MAMEVotrax",name:"Votrax SC-01",shortName:"Vtrx",description:"Votrax SC-01 - classic 1980s phoneme speech synthesizer chip",bestFor:["Robotic speech","Arcade talking","Q*bert","Retro voice"],icon:"Mic",color:"text-emerald-400"},MAMEYMF271:{type:"MAMEYMF271",name:"Yamaha OPX",shortName:"OPX",description:"Yamaha YMF271 OPX - 12-voice FM+PCM synthesis for arcade hardware",bestFor:["Arcade FM","FM+PCM","Jaleco sounds","Complex FM"],icon:"Radio",color:"text-blue-500"},MAMEYMOPQ:{type:"MAMEYMOPQ",name:"Yamaha OPQ",shortName:"OPQ",description:"Yamaha YM3806 OPQ - 4-op FM synthesis for Yamaha keyboards",bestFor:["FM synthesis","Yamaha sounds","Vintage FM","Keyboard sounds"],icon:"Radio",color:"text-indigo-500"},MAMEVASynth:{type:"MAMEVASynth",name:"Virtual Analog",shortName:"VA",description:"Virtual Analog modeling synthesizer - subtractive with multi-waveform oscillators",bestFor:["Analog modeling","Bass","Leads","Pads","Classic analog"],icon:"Waves",color:"text-pink-500"}},YN=[{id:"bass",name:"Bass",description:"Deep and punchy bass synths",synths:[XN.TB303,XN.MonoSynth,XN.WobbleBass]},{id:"lead",name:"Lead",description:"Melodic lead synthesizers",synths:[XN.Synth,XN.DuoSynth,XN.FMSynth,XN.AMSynth,XN.PluckSynth,XN.SuperSaw,XN.ChipSynth,XN.PWMSynth,XN.FormantSynth,XN.V2]},{id:"drums",name:"Drums",description:"Percussion and drum synthesis",synths:[XN.MembraneSynth,XN.MetalSynth,XN.NoiseSynth,XN.DrumMachine,XN.DrumKit,XN.Synare,XN.MAMETR707]},{id:"pads",name:"Pads",description:"Evolving textures and pads",synths:[XN.Wavetable,XN.GranularSynth,XN.PolySynth,XN.StringMachine,XN.V2]},{id:"dub",name:"Dub & FX",description:"Classic sound system and special effects",synths:[XN.DubSiren,XN.SpaceLaser,XN.V2,XN.Synare]},{id:"vintage",name:"Keys",description:"Keyboard instruments",synths:[XN.Organ]},{id:"samples",name:"Samples",description:"Sample-based instruments",synths:[XN.Sampler,XN.Player]},{id:"plugins",name:"Plugins",description:"External Web Audio Modules (WAM 2.0)",synths:[XN.WAM]},{id:"fx",name:"FX",description:"Sound effects and noise generators",synths:[XN.DubSiren]},{id:"furnace",name:" Furnace Chips",description:"All Furnace chip emulations - 70+ authentic retro sound chips",synths:[XN.FurnaceOPN,XN.FurnaceOPN2203,XN.FurnaceOPNA,XN.FurnaceOPNB,XN.FurnaceOPNBB,XN.FurnaceOPM,XN.FurnaceOPL,XN.FurnaceOPLL,XN.FurnaceOPL4,XN.FurnaceOPZ,XN.FurnaceY8950,XN.FurnaceESFM,XN.FurnaceVRC7,XN.FurnaceNES,XN.FurnaceGB,XN.FurnaceSNES,XN.FurnacePCE,XN.FurnacePSG,XN.FurnaceVB,XN.FurnaceLynx,XN.FurnaceSWAN,XN.FurnaceNDS,XN.FurnaceGBA,XN.FurnacePOKEMINI,XN.FurnaceVRC6,XN.FurnaceN163,XN.FurnaceFDS,XN.FurnaceMMC5,XN.FurnaceC64,XN.FurnaceSID6581,XN.FurnaceSID8580,XN.FurnaceAY,XN.FurnaceAY8930,XN.FurnaceVIC,XN.FurnacePET,XN.FurnaceSAA,XN.FurnaceTED,XN.FurnaceDAVE,XN.FurnaceVERA,XN.FurnaceSCC,XN.FurnaceTIA,XN.FurnacePOKEY,XN.FurnaceZXBEEPER,XN.FurnaceAMIGA,XN.FurnacePCSPKR,XN.FurnaceSEGAPCM,XN.FurnaceQSOUND,XN.FurnaceES5506,XN.FurnaceRF5C68,XN.FurnaceC140,XN.FurnaceK007232,XN.FurnaceK053260,XN.FurnaceGA20,XN.FurnaceOKI,XN.FurnaceYMZ280B,XN.FurnaceX1_010,XN.FurnaceBUBBLE,XN.FurnaceMULTIPCM,XN.FurnaceMSM6258,XN.FurnaceMSM5232,XN.FurnaceNAMCO,XN.FurnaceSM8521,XN.FurnaceT6W28,XN.FurnaceSUPERVISION,XN.FurnaceUPD1771,XN.FurnacePONG,XN.FurnacePV1000,XN.FurnaceSU,XN.FurnacePOWERNOISE,XN.FurnaceSCVTONE,XN.FurnacePCMDAC,XN.Furnace]},{id:"chiptune-fm",name:"FM Chips",description:"Yamaha FM synthesis chips (OPN, OPL, OPM families)",synths:[XN.FurnaceOPN,XN.FurnaceOPN2203,XN.FurnaceOPNA,XN.FurnaceOPNB,XN.FurnaceOPNBB,XN.FurnaceOPM,XN.FurnaceOPL,XN.FurnaceOPLL,XN.FurnaceOPL4,XN.FurnaceOPZ,XN.FurnaceY8950,XN.FurnaceESFM,XN.FurnaceVRC7]},{id:"chiptune-console",name:"Console Chips",description:"Game console sound chips (Nintendo, Sega, etc.)",synths:[XN.FurnaceNES,XN.FurnaceGB,XN.FurnaceSNES,XN.FurnacePCE,XN.FurnacePSG,XN.FurnaceVB,XN.FurnaceLynx,XN.FurnaceSWAN,XN.FurnaceNDS,XN.FurnaceGBA,XN.FurnacePOKEMINI,XN.FurnaceVRC6,XN.FurnaceN163,XN.FurnaceFDS,XN.FurnaceMMC5]},{id:"chiptune-computer",name:"Computer Chips",description:"Home computer sound chips (C64, Spectrum, etc.)",synths:[XN.FurnaceC64,XN.FurnaceSID6581,XN.FurnaceSID8580,XN.FurnaceAY,XN.FurnaceAY8930,XN.FurnaceVIC,XN.FurnacePET,XN.FurnaceSAA,XN.FurnaceTED,XN.FurnaceDAVE,XN.FurnaceVERA,XN.FurnaceSCC,XN.FurnaceTIA,XN.FurnacePOKEY,XN.FurnaceZXBEEPER,XN.FurnaceAMIGA,XN.FurnacePCSPKR]},{id:"chiptune-arcade",name:"Arcade PCM",description:"Arcade game PCM/ADPCM chips (Sega, Namco, Konami, Capcom)",synths:[XN.FurnaceSEGAPCM,XN.FurnaceQSOUND,XN.FurnaceES5506,XN.FurnaceRF5C68,XN.FurnaceC140,XN.FurnaceK007232,XN.FurnaceK053260,XN.FurnaceGA20,XN.FurnaceOKI,XN.FurnaceYMZ280B,XN.FurnaceX1_010,XN.FurnaceBUBBLE,XN.FurnaceMULTIPCM,XN.FurnaceMSM6258,XN.FurnaceMSM5232,XN.FurnaceNAMCO]},{id:"chiptune-other",name:"Other Chips",description:"Obscure and miscellaneous sound chips",synths:[XN.FurnaceSM8521,XN.FurnaceT6W28,XN.FurnaceSUPERVISION,XN.FurnaceUPD1771,XN.FurnacePONG,XN.FurnacePV1000,XN.FurnaceSU,XN.FurnacePOWERNOISE,XN.FurnaceSCVTONE,XN.FurnacePCMDAC,XN.Furnace]},{id:"buzzmachines",name:"Buzzmachines",description:"Jeskola Buzz machines - classic tracker synths and drums",synths:[XN.Buzz3o3,XN.Buzz3o3DF,XN.BuzzM3,XN.BuzzM4,XN.Buzz4FM2F,XN.BuzzDynamite6,XN.BuzzKick,XN.BuzzKickXP,XN.BuzzTrilok,XN.BuzzNoise,XN.BuzzFreqBomb,XN.BuzzDTMF]},{id:"mame-synths",name:"MAME Hardware Synths",description:"Hardware-accurate synth and keyboard chip emulations",synths:[XN.MAMEVFX,XN.MAMEDOC,XN.MAMEES5503,XN.MAMERSA,XN.MAMESWP30,XN.CZ101,XN.MAMEUPD933,XN.CEM3394,XN.SCSP,XN.MAMEVASynth,XN.MAMEYMF271,XN.MAMEYMOPQ]},{id:"mame-arcade",name:"MAME Arcade & Retro",description:"Arcade game and retro computer sound chips (MAME-emulated)",synths:[XN.MAMEAICA,XN.MAMEASC,XN.MAMEAstrocade,XN.MAMEC352,XN.MAMEICS2115,XN.MAMEK054539,XN.MAMEMSM5232,XN.MAMERF5C400,XN.MAMESN76477,XN.MAMESNKWave,XN.MAMETIA,XN.MAMETMS36XX]},{id:"speech",name:"Speech & Voice",description:"Speech synthesis and voice generation",synths:[XN.MAMETMS5220,XN.MAMEVotrax,XN.MAMEMEA8000,XN.MAMESP0250,XN.MAMEUPD931,XN.Sam,XN.V2]},{id:"juce-synths",name:" JUCE Synths",description:"Professional quality WASM-based synth emulations",synths:[XN.Dexed,XN.OBXd]},{id:"vstbridge",name:" VST Bridge",description:"Open-source synths ported via the generic VSTBridge framework",synths:[XN.Vital,XN.Surge,XN.Odin2,XN.DexedBridge,XN.TonewheelOrgan,XN.Melodica,XN.Monique]}],QN=Object.keys(XN).sort((e,t)=>XN[e].shortName.localeCompare(XN[t].shortName));function ZN(e){return XN[e]}const JN=({compact:e=!1})=>{const{instruments:t,currentInstrumentId:a,setCurrentInstrument:n}=Pg(),r=Tg(e=>e.useHexNumbers),[i,o]=s.useState(!1),l=s.useRef(null),c=s.useRef(a??0);s.useEffect(()=>{c.current=a??0},[a]);const u=[...t].sort((e,t)=>e.id-t.id),d=t.find(e=>e.id===a);s.useEffect(()=>{if(!i)return;const e=e=>{l.current&&!l.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const p=s.useCallback(e=>{const t=u.findIndex(e=>e.id===c.current);if(-1===t)return;const a=t+e;if(a>=0&&a<u.length){const e=u[a].id;c.current=e,n(e)}},[u,n]),h=s.useRef(null),m=s.useRef(null);s.useEffect(()=>()=>{h.current&&clearInterval(h.current),m.current&&clearTimeout(m.current)},[]);const f=s.useCallback(e=>{e(),m.current&&clearTimeout(m.current),h.current&&clearInterval(h.current),m.current=window.setTimeout(()=>{h.current=window.setInterval(e,80)},300)},[]),g=s.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null),h.current&&(clearInterval(h.current),h.current=null)},[]),y=e=>r?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return xa.jsxs("div",{className:"ft2-numeric-group relative",ref:l,children:[xa.jsx("span",{className:"ft2-numeric-label",children:"Instr:"}),xa.jsx("button",{className:"ft2-numeric-value cursor-pointer hover:bg-dark-bgHover rounded px-1",onClick:()=>o(!i),title:d?.name||"Select instrument",children:y(a??0)}),!e&&d&&xa.jsx("span",{className:"ml-1 text-[10px] text-text-muted truncate max-w-[60px]",title:d.name,children:d.name.slice(0,8)}),xa.jsxs("div",{className:"ft2-numeric-arrows",children:[xa.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>f(()=>p(-1)),onMouseUp:g,onMouseLeave:g,onTouchStart:()=>f(()=>p(-1)),onTouchEnd:g,title:"Previous instrument",children:xa.jsx("span",{className:"ft2-arrow-icon",children:""})}),xa.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>f(()=>p(1)),onMouseUp:g,onMouseLeave:g,onTouchStart:()=>f(()=>p(1)),onTouchEnd:g,title:"Next instrument",children:xa.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),i&&xa.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 max-h-64 overflow-y-auto bg-dark-bgTertiary border border-dark-border rounded shadow-xl z-50 scrollbar-modern",children:u.map(e=>{const t=ZN(e.synthType),s=(r=t.icon,Rt[r]||jt);var r;const i=e.id===a;return xa.jsxs("div",{onClick:()=>{return t=e.id,n(t),void o(!1);var t},className:`\n                  flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors\n                  ${i?"bg-accent-primary/20 text-text-primary":"hover:bg-dark-bgHover text-text-secondary"}\n                `,children:[xa.jsx("span",{className:"font-mono text-xs w-5 text-text-muted",children:y(e.id)}),xa.jsx(s,{size:12,className:t.color}),xa.jsx("span",{className:"flex-1 text-xs truncate",children:e.name}),xa.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:t.shortName})]},e.id)})})]})};const eC=({width:e=800,height:t=120,mode:a="waveform"})=>{const n=s.useRef(null),r=s.useRef(null),i=s.useRef(),{analyserNode:o,fftNode:l}=Lg(),[c,u]=s.useState("number"==typeof e?e:800);s.useEffect(()=>{if("auto"!==e)return void u(e);const t=n.current;if(!t)return;const a=()=>{const e=t.getBoundingClientRect();u(Math.floor(e.width))};a();const s=new ResizeObserver(a);return s.observe(t),()=>s.disconnect()},[e]);const{currentThemeId:d}=Zg(),p="cyan-lineart"===d,h=Rg(e=>e.isPlaying);return s.useEffect(()=>{const e=r.current;if(!e)return;const n=e.getContext("2d");if(!n)return;if(e.width=c,e.height=t,!h){const e=p?"#030808":"#0a0a0b",a=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",s=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)";n.fillStyle=e,n.fillRect(0,0,c,t),n.strokeStyle=a,n.lineWidth=1;for(let r=0;r<c;r+=50)n.beginPath(),n.moveTo(r,0),n.lineTo(r,t),n.stroke();for(let r=0;r<t;r+=30)n.beginPath(),n.moveTo(0,r),n.lineTo(c,r),n.stroke();return n.strokeStyle=s,n.beginPath(),n.moveTo(0,t/2),n.lineTo(c,t/2),void n.stroke()}let s=!0,u=0;const d=1e3/30,m=p?"#030808":"#0a0a0b",f=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",g=p?"#00ffff":"#00d4aa",y=p?"#00ffff":"#7c3aed",b=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)",v=n.createLinearGradient(0,0,c,0);v.addColorStop(0,g),v.addColorStop(.5,g),v.addColorStop(1,y);const x=[];if("spectrum"===a)for(let t=0;t<1024;t++)if(p)x.push("rgba(0, 255, 255, 0.75)");else{const e=160+t/1024*120;x.push(`hsla(${e}, 80%, 50%, 0.8)`)}const w=r=>{if(!s||!e||!n)return;const h=r-u;if(h<d)i.current=requestAnimationFrame(w);else{u=r-h%d,n.fillStyle=m,n.fillRect(0,0,c,t),n.strokeStyle=f,n.lineWidth=1;for(let e=0;e<c;e+=50)n.beginPath(),n.moveTo(e,0),n.lineTo(e,t),n.stroke();for(let e=0;e<t;e+=30)n.beginPath(),n.moveTo(0,e),n.lineTo(c,e),n.stroke();if("waveform"===a&&o){const e=o.getValue();n.strokeStyle=v,n.lineWidth=2,n.beginPath();const a=c/e.length;let s=0;for(let r=0;r<e.length;r++){const i=(e[r]+1)/2*t;0===r?n.moveTo(s,i):n.lineTo(s,i),s+=a}n.stroke(),n.strokeStyle=b,n.lineWidth=1,n.beginPath(),n.moveTo(0,t/2),n.lineTo(c,t/2),n.stroke()}else if("spectrum"===a&&l){const e=l.getValue(),a=c/e.length;let s=0;for(let r=0;r<e.length;r++){const i=(e[r]+100)/100,o=i*t;p?(n.globalAlpha=.5+.5*i,n.fillStyle="rgb(0, 255, 255)"):n.fillStyle=x[r]||x[x.length-1],n.fillRect(s,t-o,a-1,o),s+=a}n.globalAlpha=1}i.current=requestAnimationFrame(w)}};return i.current=requestAnimationFrame(w),()=>{s=!1,i.current&&cancelAnimationFrame(i.current)}},[c,t,a,o,l,p,h]),xa.jsx("div",{ref:n,className:"auto"===e?"w-full":"",children:xa.jsx("canvas",{ref:r,style:{width:"auto"===e?"100%":`${c}px`,height:`${t}px`}})})},tC=({height:e=100,width:t="auto"})=>{const a=s.useRef(null),n=s.useRef(null),r=s.useRef(null),i=s.useRef([]),o=s.useRef([]),{patterns:l,currentPatternIndex:c}=tf(),u=Rg(e=>e.isPlaying),{currentThemeId:d}=Zg(),p=l[c],h=p?.channels.length||4,m="cyan-lineart"===d;s.useEffect(()=>{i.current=new Array(h).fill(0),o.current=new Array(h).fill(null).map(()=>({level:0,frames:0}))},[h]);const f=s.useCallback(t=>{const s=n.current,l=a.current;if(!s||!l)return void(r.current=requestAnimationFrame(f));const c=s.getContext("2d");if(!c)return void(r.current=requestAnimationFrame(f));const u=l.clientWidth;s.width===u&&s.height===e||(s.width=u,s.height=e);const d=Km().getChannelTriggerLevels(h);for(let e=0;e<h;e++){const t=d[e]||0,a=i.current[e]||0;t>a?i.current[e]=a+.7*(t-a):(i.current[e]=.88*a,i.current[e]<.01&&(i.current[e]=0));const n=o.current[e];i.current[e]>=n.level?(n.level=i.current[e],n.frames=30):n.frames>0?n.frames--:(n.level*=.95,n.level<.01&&(n.level=0))}const p=m?"#030808":"#0a0a0b";c.fillStyle=p,c.fillRect(0,0,u,e);const g=Math.max(6,(e-24-3*(h-1))/h),y=u-40;for(let e=0;e<h;e++){const t=12+e*(g+3),a=i.current[e],n=o.current[e],s=a*y,r=20+n.level*y;if(c.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",c.font="9px monospace",c.textAlign="left",c.fillText(`${e+1}`,4,t+g-1),c.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",c.fillRect(20,t,y,g),s>0){const e=c.createLinearGradient(20,0,20+y,0);m?(e.addColorStop(0,"rgba(0, 200, 200, 0.8)"),e.addColorStop(.7,"rgba(0, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 100, 100, 1)")):(e.addColorStop(0,"rgba(0, 180, 140, 0.8)"),e.addColorStop(.7,"rgba(0, 212, 170, 1)"),e.addColorStop(1,"rgba(255, 80, 80, 1)")),c.fillStyle=e,c.fillRect(20,t,s,g)}n.level>.02&&(c.fillStyle=m?"#00ffff":"#ff4444",c.fillRect(r-1,t,2,g))}c.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",c.font="10px sans-serif",c.textAlign="center",c.fillText("Channel Levels",u/2,e-3),r.current=requestAnimationFrame(f)},[h,e,m]);return s.useEffect(()=>{if(!u){r.current&&(cancelAnimationFrame(r.current),r.current=null);const t=n.current,s=a.current;if(t&&s){const a=t.getContext("2d");if(a){const n=s.clientWidth;t.width=n,t.height=e;const r=m?"#030808":"#0a0a0b";a.fillStyle=r,a.fillRect(0,0,n,e);const i=Math.max(6,(e-24-3*(h-1))/h),o=n-40,l=12;for(let e=0;e<h;e++){const t=l+e*(i+3);a.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",a.font="9px monospace",a.textAlign="left",a.fillText(`${e+1}`,4,t+i-1),a.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",a.fillRect(20,t,o,i)}a.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",a.font="10px sans-serif",a.textAlign="center",a.fillText("Channel Levels",n/2,e-3)}}return i.current=new Array(h).fill(0),void(o.current=new Array(h).fill(null).map(()=>({level:0,frames:0})))}return r.current=requestAnimationFrame(f),()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)}},[f,u,h,e,m]),xa.jsx("div",{ref:a,className:"auto"===t?"w-full":"",children:xa.jsx("canvas",{ref:n,style:{width:"100%",height:`${e}px`}})})},aC=e.memo(({height:e=100,onComplete:t})=>{const a=s.useRef(null),n=s.useRef(null),[r,i]=s.useState(null),o=s.useRef(null),l=s.useRef(null),c=s.useRef(t);s.useEffect(()=>{c.current=t},[t]);const u=s.useRef(!1),{currentThemeId:d}=Zg(),p="cyan-lineart"===d;s.useEffect(()=>{fetch("/DEViLBOX/assets/up-rough-logo.svg").then(e=>e.text()).then(e=>{let t=e;t=t.replace(/stroke="#000"/g,'stroke="currentColor"'),t=t.replace(/stroke-width="0"/g,'stroke-width="0" fill="currentColor"'),i(t)}).catch(e=>{})},[]);const h=s.useCallback(()=>{if(!n.current)return;const e=n.current.querySelector("svg");if(e){e.querySelectorAll("*").forEach(e=>{e.style.animationPlayState="paused"}),e.style.animationPlayState="paused"}},[]);s.useEffect(()=>(u.current=!1,l.current=setTimeout(()=>{h(),u.current=!0,c.current?.()},1e4),()=>{l.current&&clearTimeout(l.current)}),[h]);const m=s.useCallback(()=>{if(!n.current)return void(o.current=requestAnimationFrame(m));const e=n.current,t=p?"#00ffff":"#00d4aa";e.style.color=t,e.style.transform="scale(1.5)",e.style.filter="",o.current=requestAnimationFrame(m)},[p]);s.useEffect(()=>(o.current=requestAnimationFrame(m),()=>{o.current&&(cancelAnimationFrame(o.current),o.current=null)}),[m]);const f=p?"#00ffff":"#00d4aa";return xa.jsx("div",{ref:a,className:"w-full flex items-center justify-center overflow-hidden",style:{height:`${e}px`},onClick:e=>{e.stopPropagation(),l.current&&clearTimeout(l.current),o.current&&cancelAnimationFrame(o.current),c.current?.()},title:"Click to skip",children:r?xa.jsx("div",{ref:n,className:"flex items-center justify-center",style:{height:"100%",width:"100%",color:f,transformOrigin:"center center",transform:"scale(1.5)"},dangerouslySetInnerHTML:{__html:r}}):xa.jsx("span",{className:"text-text-muted text-sm",children:"Loading..."})})}),nC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;s.width=n*i,s.height=e*i,r.scale(i,i);const o=n/2,l=e/2,c=.4*Math.min(n,e),u=()=>{r.clearRect(0,0,n,e);const t=Km().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}r.strokeStyle="#333",r.lineWidth=2,r.beginPath(),r.arc(o,l,c,0,2*Math.PI),r.stroke();for(let e=0;e<3;e++){const t=c*(.4+.2*e),a=Math.max(0,s-.3*e);if(a>0){const e=2*Math.PI*Math.min(2*a,1),n=r.createLinearGradient(o-t,l,o+t,l);n.addColorStop(0,"#00d4aa"),n.addColorStop(.5,"#00ffff"),n.addColorStop(1,"#00d4aa"),r.strokeStyle=n,r.lineWidth=8,r.lineCap="round",r.beginPath(),r.arc(o,l,t,-Math.PI/2,-Math.PI/2+e),r.stroke()}}r.fillStyle=s>.5?"#00ffff":"#333",r.beginPath(),r.arc(o,l,4,0,2*Math.PI),r.fill(),a.current=requestAnimationFrame(u)};return u(),()=>{a.current&&cancelAnimationFrame(a.current)}},[n,e]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},sC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;s.width=n*i,s.height=e*i,r.scale(i,i);const o=n/32,l=new Array(32).fill(0),c=()=>{r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Km().getFFT();if(t){const a=t,n=Math.floor(a.length/32);for(let t=0;t<32;t++){const s=(a[t*n]+140)/140,i=Math.max(0,Math.min(1,s))*e*.9;l[t]+=.3*(i-l[t]);const c=t*o,u=l[t],d=r.createLinearGradient(c,e-u,c,e);d.addColorStop(0,"#00ffff"),d.addColorStop(.5,"#00d4aa"),d.addColorStop(1,"#006655"),r.fillStyle=d,r.fillRect(c+1,e-u,o-2,u),r.fillStyle="rgba(0, 255, 255, 0.5)",r.fillRect(c+1,e-u,o-2,2),r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(c+o-2,e-u,1,u)}}a.current=requestAnimationFrame(c)};return c(),()=>{a.current&&cancelAnimationFrame(a.current)}},[n,e]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},rC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),n=s.useRef([]),[r,i]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const i=s.getContext("2d");if(!i)return;const o=window.devicePixelRatio||1;s.width=r*o,s.height=e*o,i.scale(o,o);const l=n.current,c=(e,t,a)=>({x:e,y:t,vx:(Math.random()-.5)*a*4,vy:(Math.random()-.5)*a*4,size:3*Math.random()+1,life:1}),u=()=>{i.fillStyle="rgba(10, 10, 11, 0.15)",i.fillRect(0,0,r,e);const t=Km().getWaveform();let n=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);n=Math.min(1,10*e)}if(n>.1&&l.length<150){const t=Math.floor(8*n);for(let a=0;a<t;a++)l.push(c(r/2+40*(Math.random()-.5),e/2+40*(Math.random()-.5),n))}for(let a=l.length-1;a>=0;a--){const t=l[a];t.x+=t.vx,t.y+=t.vy,t.life-=.015;const s=r/2-t.x,o=e/2-t.y,c=Math.sqrt(s*s+o*o);if(c>20&&(t.vx+=s/c*.05,t.vy+=o/c*.05),t.vx*=.98,t.vy*=.98,t.life<=0){l.splice(a,1);continue}const u=t.life,d=(60*t.life+160)%360;i.fillStyle=`hsla(${d}, 100%, 60%, ${u})`,i.beginPath(),i.arc(t.x,t.y,t.size*t.life,0,2*Math.PI),i.fill(),n>.5&&(i.fillStyle=`hsla(${d}, 100%, 80%, ${.3*u})`,i.beginPath(),i.arc(t.x,t.y,t.size*t.life*2,0,2*Math.PI),i.fill())}a.current=requestAnimationFrame(u)};return u(),()=>{a.current&&cancelAnimationFrame(a.current),n.current=[]}},[r,e]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},iC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,h=e/d,m=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Km().getWaveform();if(t){const e=t;for(let t=0;t<c;t++){const a=Math.floor(t/u),n=t%u*p,s=a*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(n,s,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,n+4,s+10);const i=4,o=h-2*i-12,d=s+i+12,m=Math.max(1,Math.floor(e.length/(p-2*i))),f=Math.floor(t/c*e.length),g=123*t%e.length;r.strokeStyle=l?.channels[t]?.muted?"#333":"#00d4aa",r.lineWidth=1.5,r.beginPath();for(let l=0;l<p-2*i;l++){let a=e[(f+l*m+g)%e.length];a=a*(.3+t/c*.5)*(1+t%3);const s=n+i+l,u=d+o/2+a*o*.4;0===l?r.moveTo(s,u):r.lineTo(s,u)}r.stroke()}}a.current=requestAnimationFrame(m)};return m(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},oC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4,u=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(8,c),p=Math.ceil(c/d),h=n/d,m=e/p,f=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Km().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),a=e%d*h,n=t*m,i=Date.now()/1e3,o=2.1*e,c=.4*Math.sin(2*i+o)+.3*Math.cos(1.3*i+.7*o),p=.5+e%4*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*p+c));u.current[e]+=.2*(f-u.current[e]);const g=u.current[e],y=2;r.fillStyle="#111",r.fillRect(a+y,n+y,h-2*y,m-2*y);const b=(m-2*y)*g,v=r.createLinearGradient(a,n+m,a,n+m-b);g>.8?(v.addColorStop(0,"#ff0000"),v.addColorStop(.3,"#ffff00"),v.addColorStop(1,"#00ff00")):g>.5?(v.addColorStop(0,"#ffff00"),v.addColorStop(1,"#00ff00")):(v.addColorStop(0,"#00ff00"),v.addColorStop(1,"#00d4aa")),r.fillStyle=v,r.fillRect(a+y,n+m-y-b,h-2*y,b),r.fillStyle=g>.5?"#000":"#666",r.font="9px monospace",r.textAlign="center",r.fillText((e+1).toString(),a+h/2,n+m/2+3),r.strokeStyle=l?.channels[e]?.solo?"#00ffff":"#222",r.lineWidth=l?.channels[e]?.solo?2:1,r.strokeRect(a+y,n+y,h-2*y,m-2*y)}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},lC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,h=e/d,m=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Km().getFFT();if(t){const e=t,a=16;for(let t=0;t<c;t++){const n=Math.floor(t/u),s=t%u*p,i=n*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(s,i,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,s+4,i+10);const o=4,d=(p-2*o)/a,m=h-2*o-12;for(let u=0;u<a;u++){const n=Math.floor(t/c*e.length*.6),p=(e[(Math.floor(u/a*e.length)+n)%e.length]+140)/140,h=Math.max(0,Math.min(1,p))*m,f=Date.now()/1e3,g=1.7*t,y=.4+t%3*.3,b=h*(l?.channels[t]?.muted?0:.3*Math.sin(1.5*f+g+.4*u)+y),v=s+o+u*d,x=i+o+12+m-b,w=u/a*180+180;r.fillStyle=`hsl(${w}, 80%, 50%)`,r.fillRect(v,x,d-1,b)}}}a.current=requestAnimationFrame(m)};return m(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},cC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,h=e/d,m=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Km().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/u),a=e%u*p,n=t*h,i=Date.now()/1e3,o=2.5*e,d=.3*Math.sin(2*i+o),m=.6+e%3*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*m+d));r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(a,n,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${e+1}`,a+4,n+10);const g=a+p/2,y=n+h/2,b=Math.min(p,h)/2-12;r.strokeStyle="#333",r.lineWidth=1,r.beginPath(),r.arc(g,y,b,0,2*Math.PI),r.stroke();const v=2;for(let s=0;s<v;s++){const t=b*(.5+.3*s),a=Math.max(0,f-.4*s);if(a>0){const n=2*Math.PI*Math.min(1.5*a,1),s=(i+.3*e)%(2*Math.PI),o=160+e/c*60;r.strokeStyle=`hsl(${o}, 80%, 50%)`,r.lineWidth=4,r.lineCap="round",r.beginPath(),r.arc(g,y,t,-Math.PI/2+s,-Math.PI/2+s+n),r.stroke()}}r.fillStyle=f>.5?"#00ffff":"#333",r.beginPath(),r.arc(g,y,3,0,2*Math.PI),r.fill()}a.current=requestAnimationFrame(m)};return m(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},uC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),n=s.useRef([]),[r,i]=s.useState(300),{patterns:o,currentPatternIndex:l}=tf(),c=o[l],u=c?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const i=s.getContext("2d");if(!i)return;let o=!0;const l=window.devicePixelRatio||1;s.width=r*l,s.height=e*l,i.scale(l,l);const d=Math.min(4,u),p=Math.ceil(u/d),h=r/d,m=e/p;n.current=Array(u).fill(0).map(()=>[]);const f=()=>{if(!o)return;i.fillStyle="#0a0a0b",i.fillRect(0,0,r,e);const t=Km().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<u;e++){const t=Math.floor(e/d),a=e%d*h,r=t*m,o=Date.now()/1e3,l=2.3*e,p=.35*Math.sin(2.5*o+l),f=.5+e%4*.25,g=c?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*f+p));i.strokeStyle="#222",i.lineWidth=1,i.strokeRect(a,r,h,m),i.fillStyle="#555",i.font="8px monospace",i.fillText(`CH${e+1}`,a+4,r+10);const y=a+h/2,b=r+m/2,v=20,x=n.current[e];if(g>.1&&x.length<v){const t=Math.floor(3*g);for(let a=0;a<t;a++){const t=Math.random()*Math.PI*2,a=.5+1.5*Math.random();x.push({x:y,y:b,vx:Math.cos(t)*a,vy:Math.sin(t)*a,life:1,maxLife:.5+.5*Math.random(),channelIndex:e})}}for(let n=x.length-1;n>=0;n--){const t=x[n];t.x+=t.vx,t.y+=t.vy;const a=y-t.x,s=b-t.y;if(Math.sqrt(a*a+s*s)>5&&(t.vx+=.01*a,t.vy+=.01*s),t.vx*=.98,t.vy*=.98,t.life-=.02,t.life<=0){x.splice(n,1);continue}const r=t.life,o=160+e/u*60,l=2+2*r;i.fillStyle=`hsla(${o}, 80%, 50%, ${.8*r})`,i.beginPath(),i.arc(t.x,t.y,l,0,2*Math.PI),i.fill(),i.fillStyle=`hsla(${o}, 80%, 50%, ${.2*r})`,i.beginPath(),i.arc(t.x,t.y,2*l,0,2*Math.PI),i.fill()}}a.current=requestAnimationFrame(f)};return f(),()=>{o=!1,a.current&&cancelAnimationFrame(a.current)}},[r,e,u,c]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},dC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4,u=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(4,c),p=Math.ceil(c/d),h=n/d,m=e/p,f=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Km().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),a=e%d*h,n=t*m,i=Date.now()/1e3,o=1.5*e,p=.2*Math.sin(3*i+o),f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s+p));u.current[e]+=.15*(f-u.current[e]);const g=u.current[e],y=a+h/2,b=n+m/2,v=Math.min(h,m)/2-10;r.fillStyle="#333",r.font="8px monospace",r.fillText((e+1).toString(),a+4,n+10);const x=3;for(let s=0;s<x;s++){const t=Math.max(0,g-.2*s),a=v/x*(s+1)+10*t,n=.2+.8*t,i=180+e/c*120+20*s;r.beginPath(),r.arc(y,b,a,0,2*Math.PI),r.strokeStyle=`hsla(${i}, 80%, 50%, ${n})`,r.lineWidth=1+3*t,r.stroke(),t>.3&&(r.shadowBlur=10*t,r.shadowColor=`hsla(${i}, 100%, 50%, 0.5)`,r.stroke(),r.shadowBlur=0)}r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.moveTo(y-5,b),r.lineTo(y+5,b),r.moveTo(y,b-5),r.lineTo(y,b+5),r.stroke()}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},pC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4,u=s.useRef(0);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(4,c),p=Math.ceil(c/d),h=n/d,m=e/p,f=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Km().getFFT();u.current+=.05;for(let e=0;e<c;e++){const a=Math.floor(e/d),n=e%d*h,s=a*m,i=n+h/2,o=s+m/2;let p=0;if(t&&t.length>0){const a=e*Math.floor(t.length/c);let n=0;for(let e=0;e<10;e++)n+=(t[a+e]+140)/140;p=Math.max(0,Math.min(1,n/10))}l?.channels[e]?.muted&&(p=0);const f=8;for(let t=0;t<f;t++){const a=(t/f+u.current%(1/f))%1,l=1-a,d=.8*a,g=200+e/c*100+50*a;r.strokeStyle=`hsla(${g}, 80%, 50%, ${d})`,r.lineWidth=1+2*p;const y=h*l,b=m*l;r.strokeRect(i-y/2,o-b/2,y,b),0===t&&p>.5&&(r.beginPath(),r.moveTo(n,s),r.lineTo(i-y/2,o-b/2),r.moveTo(n+h,s),r.lineTo(i+y/2,o-b/2),r.moveTo(n,s+m),r.lineTo(i-y/2,o+b/2),r.moveTo(n+h,s+m),r.lineTo(i+y/2,o+b/2),r.stroke())}const g=r.createRadialGradient(i,o,0,i,o,10+20*p),y=180+e/c*60;g.addColorStop(0,`hsla(${y}, 100%, 70%, ${.5*p})`),g.addColorStop(1,"transparent"),r.fillStyle=g,r.fillRect(n,s,h,m)}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},hC=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=tf(),l=i[o],c=l?.channels.length||4,u=s.useRef(0),d=s.useRef([]);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const p=Math.min(4,c),h=Math.ceil(c/p),m=n/p,f=e/h;d.current.length!==c&&(d.current=Array(c).fill(0).map(()=>[]));const g=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Km().getWaveform();u.current+=.05;for(let e=0;e<c;e++){const a=Math.floor(e/p),n=e%p*m+m/2,s=a*f+f/2,i=Math.min(m,f)/2-5;r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.arc(n,s,i,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(n,s,.6*i,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(n,s,.3*i,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(n-i,s),r.lineTo(n+i,s),r.moveTo(n,s-i),r.lineTo(n,s+i),r.stroke();let o=0;if(t&&t.length>0){const a=Math.floor(e/c*t.length),n=Math.floor((e+1)/c*t.length);let s=0;for(let e=a;e<n;e+=10)s+=Math.abs(t[e]);o=Math.min(1,s/((n-a)/10)*5)}if(l?.channels[e]?.muted&&(o=0),o>.3){const t=u.current%(2*Math.PI),a=(.2+.8*Math.random())*i;d.current[e].push({x:n+Math.cos(t)*a,y:s+Math.sin(t)*a,age:1,hue:120+e/c*100})}for(let t=d.current[e].length-1;t>=0;t--){const a=d.current[e][t];r.fillStyle=`hsla(${a.hue}, 100%, 50%, ${a.age})`,r.beginPath(),r.arc(a.x,a.y,2*a.age,0,2*Math.PI),r.fill(),a.age-=.01,a.age<=0&&d.current[e].splice(t,1)}const h=r.createConicGradient(u.current,n,s),g=120+e/c*100;h.addColorStop(0,`hsla(${g}, 100%, 50%, 0.5)`),h.addColorStop(.1,`hsla(${g}, 100%, 50%, 0)`),h.addColorStop(1,`hsla(${g}, 100%, 50%, 0)`),r.fillStyle=h,r.beginPath(),r.moveTo(n,s),r.arc(n,s,i,u.current,u.current-.5,!0),r.fill(),r.strokeStyle=`hsla(${g}, 100%, 70%, 0.8)`,r.lineWidth=2,r.beginPath(),r.moveTo(n,s),r.lineTo(n+Math.cos(u.current)*i,s+Math.sin(u.current)*i),r.stroke()}a.current=requestAnimationFrame(g)};return g(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center",children:xa.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},mC=[{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,2,2,2,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,9,8,9,9,8,9,9,9,9,9,10,9,10,10,9,10,10,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,10,10,9,10,10,9,10,9,9,9,9,9,8,9,9,8,9,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,8,1,8,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,1,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,2,3,2,3,4,3,4,4,4,3,4,3,2,3,2,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,10,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,10,9,10,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,9,10,9,9,9,8,8,9,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,8,8,9,9,9,10,9,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,3,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,1,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,1,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,1,1,1,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,1,0,0,0,0,0,0,0,0,0,0,2,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,4,4,4,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,9,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,1,8,8,8,9,9,9,10,9,10,10,10,10,9,10,9,9,9,8,9,8,8,8,1,8,1,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,1,4,1,4,4,3,4,3,3,3,4,3,4,4,1,4,1,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,1,1,4,1,4,4,3,4,3,3,2,2,3,4,3,4,4,1,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:0,p2Dir:5,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,3,4,4,4,4,4,0,0,2,2,2,3,4,4,4,4,4,0,0,9,9,9,9,9,10,10,10,0,0,9,9,9,9,9,10,10,10,0,0,0,7,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,4,0,0,2,0,0,0,0,0,0,0,4,0,0,9,0,0,0,0,9,10,10,0,0,9,0,0,0,0,9,10,10,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0],[0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,10,10,9,0,0,0,0,0,9,0,0,10,10,9,0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,2,0,0,4,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,6,0,0,10,10,10,9,9,9,9,9,9,0,0,10,10,10,9,9,9,9,9,9,0,0,4,4,4,4,3,2,2,2,0,0,4,4,4,4,3,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,3,3,4,4,1,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,0,1,0,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,1,4,4,3,3,2,2,2,2],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,4,4,3,3,2,2,2,2,3,3,4,0,0,0,0,0,0,0,4,3,3,2,2,2,2,3,3,4,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,1,0,1,0,4,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,7,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,0,8,8,8,8,0,8,8,8,8,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,8,8,8,8,0,8,8,8,8,0,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,3,2,2,2,2,2,3,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0],[0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0],[0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,9,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,1,9,0,0,0,0,0,0,10,1,10,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,9,9,9,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,8,8,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,8,8,8,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,10,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,1,9,0,0,0,0,0],[0,0,10,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,0,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,2,0,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,0,0,0,0,3,3,3,3,3,3,0,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,0,3,2,2,2,3,3,0,3,4,4,4,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,0,2,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,1,0,4,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,2,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,4,1,0,1,4,4,0,3,3,3,0,2,2,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,2,2,2,0,3,3,4,4,4,0,1,1,1,4,4,0,3,3,3,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,10,10,10,10,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,8,8,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,0,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,7,0],[0,0,0,0,0,8,0,9,0,1,0,9,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,2,0,3,0,4,0,1,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,9,0,10,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,4,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,8,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,4,0,3,0,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,2,0,4,0,2,2,2,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,9,0,1,0,10,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,1,0,9,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,3,0,4,4,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,9,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,3,3,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,4,0,1,0,3,0,2,0,0,0,0,0],[0,0,0,0,0,9,0,8,0,9,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,9,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,0,1,0,4,0,2,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,3,0,4,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,8,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,3,3,0,4,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,8,0,9,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,0,9,9,9,0,8,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,0,2,0,3,0,0,0,0,0],[0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,2,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,3,0,1,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[6,0,0,0,0,3,4,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,2,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,3,0,1,0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,1,0,0,0,3,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,3,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,3,0,3,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,3,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,1,4,0],[0,4,3,0,1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,2,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,4,1,4,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,2,0,0,0,3,0,0,0,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,1,0,0,0,0,0,0,2,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,3,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,1,0,7]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,9,9,9,9,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,4,4,4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}],fC="nibbles";const gC=new class{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise||(this.initPromise=new Promise((e,t)=>{const a=indexedDB.open("devilbox-scores",1);a.onerror=()=>{t(a.error)},a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(fC)){const e=t.createObjectStore(fC,{keyPath:"id",autoIncrement:!0});e.createIndex("score","score",{unique:!1}),e.createIndex("date","date",{unique:!1})}}})),this.initPromise}async ensureDb(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async saveScore(e){const t=await this.ensureDb(),a={...e,date:new Date};return new Promise((e,n)=>{const s=t.transaction([fC],"readwrite").objectStore(fC).add(a);s.onsuccess=()=>{e(s.result)},s.onerror=()=>{n(s.error)}})}async getTopScores(e=10){const t=await this.ensureDb();return new Promise((a,n)=>{const s=t.transaction([fC],"readonly").objectStore(fC).index("score").openCursor(null,"prev"),r=[];s.onsuccess=()=>{const t=s.result;t&&r.length<e?(r.push(t.value),t.continue()):a(r)},s.onerror=()=>{n(s.error)}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,a)=>{const n=e.transaction([fC],"readwrite").objectStore(fC).clear();n.onsuccess=()=>t(),n.onerror=()=>a(n.error)})}},yC=[12,8,6,4],bC=51,vC=23,xC=["#000000","#5397FF","#000067","#4BFFFF","#AB7787","#FFFFFF","#7F7F7F","#ABCDEF","#733747","#F7CBDB","#434343","#D3D3D3","#FFFF00"],wC=({height:t=100,onExit:a})=>{const n=s.useRef(null),r=s.useRef(null),[i,o]=s.useState(408),[l,c]=s.useState({level:0,score1:0,score2:0,lives1:3,lives2:3,isPlaying:!1,showMenu:!1,showHighScores:!1}),[u,d]=s.useState(1),[p,h]=s.useState(1),[m,f]=s.useState(!1),[g,y]=s.useState(!0),[b,v]=s.useState(!1),[x,w]=s.useState([]),k=s.useRef(0),S=s.useRef(0),M=s.useRef(0),N=s.useRef(3),C=s.useRef(3),E=s.useRef(!1),P=s.useRef([]),_=s.useRef([]),T=s.useRef([]),A=s.useRef(0),O=s.useRef(0),I=s.useRef(5),D=s.useRef(5),F=s.useRef(0),R=s.useRef(0),j=s.useRef(0),L=s.useRef([]),B=s.useRef([]),V=s.useRef(null),z=s.useCallback(()=>{c({level:k.current,score1:S.current,score2:M.current,lives1:N.current,lives2:C.current,isPlaying:E.current,showMenu:!1,showHighScores:!1})},[]),U=e=>c(t=>({...t,showMenu:e})),G=e=>c(t=>({...t,showHighScores:e})),W=e=>{E.current=e,c(t=>({...t,isPlaying:e}))},H=s.useCallback(async()=>{const e=await gC.getTopScores(10);w(e)},[]);s.useEffect(()=>{H()},[H]);const K=s.useCallback(async()=>{W(!1);const e=S.current,t=M.current,a=k.current,n=x.length<10?0:x[x.length-1].score;if(e>n){const t=prompt("Player 1 - Enter your name for the highscore:","Player 1");t&&await gC.saveScore({name:t,score:e,level:a+1,players:p,speed:u})}if(2===p&&t>n){const e=prompt("Player 2 - Enter your name for the highscore:","Player 2");e&&await gC.saveScore({name:e,score:t,level:a+1,players:p,speed:u})}H(),G(!0),k.current=0,S.current=0,M.current=0,N.current=3,C.current=3,$(0),z()},[p,u,x,H,z]);s.useEffect(()=>{const e=()=>{r.current&&o(r.current.clientWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const $=s.useCallback(e=>{const t=mC[e%mC.length],a=t.grid.map(e=>[...e]);let n=2,s=2,r=48,i=20;for(let l=0;l<vC;l++)for(let e=0;e<bC;e++){const t=a[l][e];6===t&&(n=e,s=l,a[l][e]=0),7===t&&(r=e,i=l,a[l][e]=0)}P.current=a;const o=e=>0===e?2:5===e?3:6===e?0:7===e?1:0;A.current=o(t.p1Dir),O.current=o(t.p2Dir),_.current=Array(256).fill(null).map(()=>({x:n,y:s})),T.current=Array(256).fill(null).map(()=>({x:r,y:i})),I.current=5,D.current=5,F.current=0,R.current=0,j.current=0,P.current[s][n]=6,2===p&&(P.current[i][r]=7),L.current=[],B.current=[],b||q()},[p,b]),q=()=>{let e=0;for(;e<1e3;){const t=Math.floor(Math.random()*bC),a=Math.floor(Math.random()*vC);if(0===P.current[a][t]&&(22===a||0===P.current[a+1][t]))return j.current++,void(P.current[a][t]=16+j.current);e++}},X=(e,t,a)=>{if(!m&&(0===e&&2===a||50===e&&0===a||0===t&&1===a||22===t&&3===a))return!0;const n=P.current[t][e];return n>=1&&n<=15},Y=s.useCallback(()=>{if(!E.current)return;if(L.current.length>0){const e=L.current.shift();0===e&&2===A.current||2===e&&0===A.current||1===e&&3===A.current||3===e&&1===A.current||(A.current=e)}if(2===p&&B.current.length>0){const e=B.current.shift();0===e&&2===O.current||2===e&&0===O.current||1===e&&3===O.current||3===e&&1===O.current||(O.current=e)}const e=(e,t)=>{let{x:a,y:n}=e;return 0===t?a++:1===t?n--:2===t?a--:3===t&&n++,a<0&&(a=50),a>=bC&&(a=0),n<0&&(n=22),n>=vC&&(n=0),{x:a,y:n}},t=e(_.current[0],A.current),a=2===p?e(T.current[0],O.current):null,n=X(t.x,t.y,A.current),s=!!a&&X(a.x,a.y,O.current),r=a&&t.x===a.x&&t.y===a.y;if(n||s||r)return N.current-=n||r?1:0,C.current-=s||r?1:0,void(N.current<=0||2===p&&C.current<=0?K():(W(!1),$(k.current),z()));let i=!1,o=!1;const l=P.current[t.y][t.x];if(l>=16&&(S.current+=999*(l-16)*(k.current+1),F.current=I.current>>1,i=!0),a){const e=P.current[a.y][a.x];e>=16&&(M.current+=999*(e-16)*(k.current+1),R.current=D.current>>1,o=!0)}if(i||o){if(9===j.current)return k.current++,$(k.current),void z();q()}for(let c=255;c>0;c--)_.current[c]=_.current[c-1]?{..._.current[c-1]}:null,2===p&&(T.current[c]=T.current[c-1]?{...T.current[c-1]}:null);if(_.current[0]=t,a&&(T.current[0]=a),!b){if(F.current>0&&I.current<255)F.current--,I.current++;else{const e=_.current[I.current];e&&(P.current[e.y][e.x]=0)}if(2===p)if(R.current>0&&D.current<255)R.current--,D.current++;else{const e=T.current[D.current];e&&(P.current[e.y][e.x]=0)}}S.current=Math.max(0,S.current-17),2===p&&(M.current=Math.max(0,M.current-17)),P.current[t.y][t.x]=6,a&&(P.current[a.y][a.x]=7),z()},[p,m,b,$,K,z]);return s.useEffect(()=>{let e=0;const t=a=>{E.current&&a-e>=16.67*yC[u]&&(e=a,Y()),V.current=requestAnimationFrame(t)};return V.current=requestAnimationFrame(t),()=>{V.current&&cancelAnimationFrame(V.current)}},[u,Y]),s.useEffect(()=>{const e=e=>{E.current&&("ArrowRight"===e.key&&(e.preventDefault(),L.current.push(0)),"ArrowUp"===e.key&&(e.preventDefault(),L.current.push(1)),"ArrowLeft"===e.key&&(e.preventDefault(),L.current.push(2)),"ArrowDown"===e.key&&(e.preventDefault(),L.current.push(3)),"d"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(0)),"w"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(1)),"a"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(2)),"s"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(3)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),s.useEffect(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d");if(!t)return;let a=!0;const s=()=>{if(!a)return;if(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),l.showMenu||l.showHighScores)return void(V.current=requestAnimationFrame(s));const n=Math.min(e.width/bC,e.height/vC),r=(e.width-bC*n)/2,i=(e.height-vC*n)/2;for(let e=0;e<vC;e++)for(let a=0;a<bC;a++){const s=P.current[e]?.[a];if(void 0===s||0===s)continue;const o=r+a*n,l=i+e*n;s>=16?(t.fillStyle=xC[5],t.font=`bold ${Math.floor(.8*n)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText((s-16).toString(),o+n/2,l+n/2+1)):g?(t.fillStyle="#222",t.fillRect(o,l,n,n),t.fillStyle=xC[s]||"#fff",t.fillRect(o+1,l+1,n-1,n-1)):(t.fillStyle=xC[s]||"#fff",t.fillRect(o,l,n,n))}V.current=requestAnimationFrame(s)},r=requestAnimationFrame(s);return()=>{a=!1,cancelAnimationFrame(r)}},[g,l.showMenu,l.showHighScores]),s.useEffect(()=>{$(0),z()},[$,z]),xa.jsxs("div",{ref:r,className:"w-full h-full flex flex-col items-center relative group overflow-hidden",style:{height:`${t}px`},onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"absolute top-0 left-0 w-full flex justify-between px-2 py-0.5 pointer-events-none z-10 bg-black/40 backdrop-blur-sm transition-opacity opacity-0 "+(l.isPlaying?"group-hover:opacity-100":""),children:[xa.jsxs("div",{className:"font-mono text-[8px] text-white uppercase",children:["P1: ",l.score1," | L:",l.lives1]}),xa.jsxs("div",{className:"font-mono text-[8px] text-accent-primary font-bold",children:["LVL ",l.level+1]}),xa.jsxs("div",{className:"font-mono text-[8px] text-white uppercase",children:["P2: ",l.score2," | L:",l.lives2]})]}),xa.jsx("canvas",{ref:n,width:i,height:t,className:"cursor-pointer",onClick:e=>{e.stopPropagation(),l.isPlaying||W(!0)}}),!l.isPlaying&&!l.showMenu&&!l.showHighScores&&xa.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-20",children:xa.jsxs("div",{className:"flex flex-col items-center gap-2 scale-75 md:scale-100",children:[xa.jsx("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"NIBBLES"}),xa.jsx("button",{onClick:e=>{e.stopPropagation(),W(!0)},className:"bg-accent-primary hover:bg-accent-secondary text-white px-6 py-1 rounded-full text-xs font-bold uppercase transition-all shadow-glow-sm",children:"Start Game"}),xa.jsxs("div",{className:"flex gap-4",children:[xa.jsx("button",{onClick:e=>{e.stopPropagation(),U(!0)},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"Options"}),xa.jsx("button",{onClick:e=>{e.stopPropagation(),G(!0),H()},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"High Scores"}),xa.jsx("button",{onClick:e=>{e.stopPropagation(),a?.()},className:"text-red-400/70 hover:text-red-400 text-[9px] uppercase font-mono",children:"Exit"})]})]})}),l.showHighScores&&!l.isPlaying&&xa.jsxs("div",{className:"absolute inset-0 bg-black z-40 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[xa.jsx("span",{className:"text-accent-primary font-bold text-[10px] uppercase tracking-wider",children:"Fasttracker Nibbles Highscore"}),xa.jsx("button",{onClick:e=>{e.stopPropagation(),G(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),xa.jsx("div",{className:"flex-1 flex flex-col gap-1 mt-1",children:0===x.length?xa.jsx("div",{className:"text-center text-text-muted py-4 text-[9px] uppercase font-mono",children:"No high scores yet!"}):xa.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto] gap-x-4 gap-y-1",children:[xa.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30",children:"Player"}),xa.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Score"}),xa.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Lvl"}),x.map((t,a)=>xa.jsxs(e.Fragment,{children:[xa.jsx("div",{className:"text-text-primary text-[9px] truncate font-mono",children:t.name}),xa.jsx("div",{className:"text-accent-secondary text-[9px] font-mono text-right",children:t.score.toLocaleString()}),xa.jsx("div",{className:"text-text-secondary text-[9px] font-mono text-right",children:t.level})]},t.id||a))]})}),xa.jsx("button",{onClick:async e=>{e.stopPropagation(),confirm("Are you sure you want to clear all high scores?")&&(await gC.clearAll(),H())},className:"text-red-500/50 hover:text-red-500 uppercase text-[8px] font-mono mt-auto pt-2",children:"Clear All"})]}),l.showMenu&&!l.isPlaying&&xa.jsxs("div",{className:"absolute inset-0 bg-black z-30 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[xa.jsx("span",{className:"text-white font-bold text-[10px] uppercase",children:"Options"}),xa.jsx("button",{onClick:e=>{e.stopPropagation(),U(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),xa.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[9px] font-mono uppercase text-text-secondary",children:[xa.jsxs("div",{className:"flex flex-col gap-1",children:[xa.jsx("span",{children:"Speed:"}),xa.jsxs("select",{value:u,onChange:e=>{e.stopPropagation(),d(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[xa.jsx("option",{value:0,children:"Novice"}),xa.jsx("option",{value:1,children:"Average"}),xa.jsx("option",{value:2,children:"Pro"}),xa.jsx("option",{value:3,children:"Up Rough"})]})]}),xa.jsxs("div",{className:"flex flex-col gap-1",children:[xa.jsx("span",{children:"Players:"}),xa.jsxs("select",{value:p,onChange:e=>{e.stopPropagation(),h(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[xa.jsx("option",{value:1,children:"1 Player"}),xa.jsx("option",{value:2,children:"2 Players"})]})]})]}),xa.jsxs("div",{className:"flex flex-wrap gap-3 mt-1",children:[xa.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[xa.jsx("input",{type:"checkbox",checked:m,onChange:e=>{e.stopPropagation(),f(e.target.checked)},className:"accent-accent-primary"}),"Wrap"]}),xa.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[xa.jsx("input",{type:"checkbox",checked:g,onChange:e=>{e.stopPropagation(),y(e.target.checked)},className:"accent-accent-primary"}),"Grid"]}),xa.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[xa.jsx("input",{type:"checkbox",checked:b,onChange:e=>{e.stopPropagation(),v(e.target.checked)},className:"accent-accent-primary"}),"Surround"]})]})]})]})},kC=({height:e=100,text:t="*** GREETINGS FLIES OUT TO....     AEROSOL   AFRIKA   ANDROMEDA   ATE BIT   ATLANTIS   BLACK MAIDEN   BOOZE DESIGN   BOOZOHOLICS   BYTERAPERS   CENSOR DESIGN   DA JORMAS  DCS   DEKADENCE   DEPTH   DESIRE   DIVINE STYLERS   DUREX   ELCREW   ELUDE   EPHIDRENA   EPSILON DESIGN   FAIRLIGHT   FATZONE   FIT   FLUSH  FUNKTION   GENESIS PROJECT   HACK N TRADE   HAUJOBB   HARD BOYLING BOYS   HOAXERS   LFT  IMPURE ASCII 1940  INSANE   INSTINCT   IRIS  JOSSYSTEM   JUDAS   KESO   LA PAZ   LAXATIVE EFFECTS   LEMON  LOONIES     MAHONEY   MANKIND  MAWI   MOODS PLATEAU   NATURE  NONAMENO   NUKLEUS   OFFENCE  ONSALA SECTOR     ONSLAUGHT   OUTBREAK   OXYRON   PACIF!C   PANDA DESIGN   PARADOX   PERFOMERS   PLANET JAZZ   POWERLINE   RAZOR 1911   REALITY   RELAPSE  RNO   RESISTANCE SCARAB   SCENESAT   SCOOPEX   SHARE AND ENJOY   SHAPE   SIGFLUP   SPACEBALLS   STRUTS SUBSPACE   STYLE   THE ELECTRONIC KNIGHTS   THE BLACK LOTUS   THE GANG   TITAN   TPOLM   TRAKTOR   TRIAD   TRSI   TULOU   UK SCENE ALLSTARS   UNIQUE   UNSTABLE LABEL   Y-CREW   AND   ZENON ***"})=>{const a=s.useRef(null),n=s.useRef(void 0),r=s.useRef(0),[i,o]=s.useState(800),{bpm:l,isPlaying:c}=Rg();return s.useEffect(()=>{const e=a.current;if(!e)return;const t=e.parentElement;if(!t)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(t),()=>n.disconnect()},[]),s.useEffect(()=>{const s=a.current;if(!s)return;const o=s.getContext("2d");if(!o)return;const u=window.devicePixelRatio||1;s.width=i*u,s.height=e*u,o.scale(u,u);let d=!0;const p=[];for(let t=0;t<200;t++)p.push({x:(Math.random()-.5)*i*2,y:(Math.random()-.5)*e*2,z:1e3*Math.random(),speed:.5+1.5*Math.random()});const h=Math.min(.4*e,32),m=.6*h,f=.2*e,g=2*(c?l/125:1);let y=0,b=1,v=0;const x=(t+"     ").repeat(5),w=()=>{if(!d)return;const a=Km().getWaveform();let s=0;if(a&&a.length>0&&c){const e=Math.sqrt(a.reduce((e,t)=>e+t*t,0)/a.length);s=Math.min(1,10*e)}v+=.15*(s-v),o.fillStyle="#0a0a0b",o.fillRect(0,0,i,e);const l=i/2,u=e/2;for(const t of p){t.z-=t.speed*(1+1*v),t.z<=0&&(t.x=(Math.random()-.5)*i*2,t.y=(Math.random()-.5)*e*2,t.z=1e3);const a=200/t.z,n=l+t.x*a,s=u+t.y*a;if(n<0||n>i||s<0||s>e)continue;const r=Math.max(1,3*(1-t.z/1e3)),c=Math.floor(255*(1-t.z/1e3));o.fillStyle=`rgb(${.8*c}, ${.9*c}, ${c})`,o.beginPath(),o.arc(n,s,r,0,2*Math.PI),o.fill()}const k=Date.now()/1e3;b=1+.8*v,y=Math.sin(.5*k*b)*e*.3;const S=f;r.current+=g,r.current>m*(t.length+5)&&(r.current=0),o.font=`bold ${h}px monospace`,o.textBaseline="middle";for(let t=0;t<x.length;t++){const a=x[t];if(" "===a)continue;const n=i+t*m-r.current;if(n<-m||n>i+m)continue;const s=.035*(r.current+t*m),l=e/2+Math.sin(s)*S,c=o.createLinearGradient(0,y,0,e+y),u=30*k*b%360;c.addColorStop(0,`hsl(${u}, 100%, 60%)`),c.addColorStop(.25,`hsl(${(u+60)%360}, 100%, 70%)`),c.addColorStop(.5,`hsl(${(u+120)%360}, 100%, 70%)`),c.addColorStop(.75,`hsl(${(u+180)%360}, 100%, 70%)`),c.addColorStop(1,`hsl(${(u+240)%360}, 100%, 60%)`);const d=(u+.3*n)%360,p=10+8*v;o.shadowColor=`hsla(${d}, 100%, 50%, ${.5+.3*v})`,o.shadowBlur=p,o.fillStyle=c,o.fillText(a,n,l),o.shadowBlur=0,o.strokeStyle="rgba(0, 0, 0, 0.6)",o.lineWidth=2,o.strokeText(a,n,l)}n.current=requestAnimationFrame(w)};return w(),()=>{d=!1,n.current&&cancelAnimationFrame(n.current)}},[i,e,t]),xa.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:xa.jsx("canvas",{ref:a,style:{width:`${i}px`,height:`${e}px`}})})},SC=e.memo(({label:e,value:t,onChange:a,color:n="#00d4aa",size:s="md",disabled:r=!1,title:i})=>{const o="cyan-lineart"===Zg(e=>e.currentThemeId),l=o?"#00ffff":n,c=o?"#0a1a1f":"#1a1a1f",u=o?"#0a3333":"#333",d=o?"#0a6666":"#666",{width:p,height:h,fontSize:m}={sm:{width:36,height:18,fontSize:9},md:{width:44,height:22,fontSize:10}}[s];return xa.jsxs("div",{className:"toggle-container",style:{width:p+10,opacity:r?.4:1},children:[xa.jsx("div",{className:"toggle-label",style:{fontSize:m-1},children:e}),xa.jsx("button",{className:"toggle-switch "+(t?"toggle-on":"toggle-off"),onClick:()=>!r&&a(!t),disabled:r,title:i,style:{width:p,height:h,borderRadius:h/2,backgroundColor:t?l:c,border:`2px solid ${t?l:u}`,cursor:r?"not-allowed":"pointer"},children:xa.jsx("div",{className:"toggle-thumb",style:{width:h-6,height:h-6,borderRadius:"50%",backgroundColor:t?"#fff":d,transform:`translateX(${t?p-h+2:0}px)`,transition:"transform 0.15s ease-out, background-color 0.15s",boxShadow:t?`0 0 6px ${l}`:"none"}})})]})},(e,t)=>e.value===t.value&&e.label===t.label&&e.disabled===t.disabled&&e.color===t.color&&e.size===t.size);SC.displayName="Toggle";const MC=({onClose:e})=>{const{useHexNumbers:t,setUseHexNumbers:a,blankEmptyCells:n,setBlankEmptyCells:r,tb303Collapsed:i,setTB303Collapsed:o,oscilloscopeVisible:l,setOscilloscopeVisible:c,compactToolbar:u,setCompactToolbar:d}=Tg(),{currentThemeId:p,setTheme:h}=Zg(),{amigaLimits:m,setAmigaLimits:f,linearInterpolation:g,setLinearInterpolation:y,audioLatency:b,setAudioLatency:v,autoLatency:x,setAutoLatency:w,midiPolyphonic:k,setMidiPolyphonic:S}=Wm(),[M,N]=s.useState(!!document.fullscreenElement);s.useEffect(()=>{const e=()=>{N(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);return xa.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:xa.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-lg shadow-xl",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[xa.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-wide",children:"SETTINGS"}),xa.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none","aria-label":"Close",children:xa.jsx(Ee,{size:16})})]}),xa.jsxs("div",{className:"p-4 space-y-6 max-h-[70vh] overflow-y-auto scrollbar-ft2",children:[xa.jsxs("section",{children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DISPLAY"}),xa.jsxs("div",{className:"space-y-3",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Theme:"}),xa.jsx("select",{value:p,onChange:e=>h(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:Yg.map(e=>xa.jsx("option",{value:e.id,className:"bg-ft2-bg text-ft2-text",children:e.name},e.id))})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Number Format:"}),xa.jsxs("select",{value:t?"hex":"dec",onChange:e=>a("hex"===e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[xa.jsx("option",{value:"hex",className:"bg-ft2-bg text-ft2-text",children:"Hexadecimal (01, 02, 0A, 0F)"}),xa.jsx("option",{value:"dec",className:"bg-ft2-bg text-ft2-text",children:"Decimal (01, 02, 10, 15)"})]})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Blank Empty Cells:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Hide ---, .., ... on empty rows"})]}),xa.jsx(SC,{label:"",value:n,onChange:r,size:"sm"})]})]})]}),xa.jsxs("section",{children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"LAYOUT"}),xa.jsxs("div",{className:"space-y-3",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"TB-303 Panel:"}),xa.jsx(SC,{label:"",value:!i,onChange:e=>o(!e),size:"sm"})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Oscilloscope:"}),xa.jsx(SC,{label:"",value:l,onChange:c,size:"sm"})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Compact Toolbar:"}),xa.jsx(SC,{label:"",value:u,onChange:d,size:"sm"})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx(Tt,{size:14,className:"text-ft2-textDim"}),xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Fullscreen:"})]}),xa.jsx(SC,{label:"",value:M,onChange:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},size:"sm"})]})]})]}),xa.jsxs("section",{children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"MIDI"}),xa.jsx("div",{className:"space-y-3",children:xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Polyphonic Mode:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Play multiple notes simultaneously"})]}),xa.jsx(SC,{label:"",value:k,onChange:S,size:"sm"})]})})]}),xa.jsxs("section",{children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"ENGINE"}),xa.jsxs("div",{className:"space-y-3",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Amiga Limits:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Clamp periods to 113-856"})]}),xa.jsx(SC,{label:"",value:m,onChange:f,size:"sm"})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Sample Interpolation:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Linear (clean) vs None (crunchy)"})]}),xa.jsx(SC,{label:"",value:g,onChange:y,size:"sm"})]}),xa.jsxs("div",{className:"flex items-center justify-between border-t border-ft2-border/30 pt-3",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Audio Latency Mode:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Low latency for live jamming vs stable playback"})]}),xa.jsxs("select",{value:b,onChange:e=>v(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[xa.jsx("option",{value:"interactive",children:"Interactive (10ms)"}),xa.jsx("option",{value:"balanced",children:"Balanced (50ms)"}),xa.jsx("option",{value:"playback",children:"Stable (150ms)"})]})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Dynamic Latency:"}),xa.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Instant (10ms) when stopped, stable when playing"})]}),xa.jsx(SC,{label:"",value:x,onChange:w,size:"sm"})]})]})]}),xa.jsx("section",{className:"pt-4 border-t border-ft2-border",children:xa.jsxs("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1",children:[xa.jsx("div",{children:"DEViLBOX v1.0.0"}),xa.jsx("div",{children:"TB-303 Acid Tracker"}),xa.jsx("div",{className:"text-ft2-highlight",children:"Settings are saved automatically"})]})})]}),xa.jsx("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-end",children:xa.jsx("button",{onClick:e,className:"px-4 py-1.5 bg-ft2-cursor border border-ft2-cursor text-ft2-bg text-xs font-bold hover:bg-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none",children:"CLOSE"})})]})})},NC=({onClose:e})=>{const{swing:t,setSwing:a,grooveSteps:n,setGrooveSteps:s,jitter:r,setJitter:i,useMpcScale:o,setUseMpcScale:l,grooveTemplateId:c,setGrooveTemplate:u}=Rg();return xa.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 backdrop-blur-sm",children:xa.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[xa.jsx("div",{className:"flex items-center gap-2",children:xa.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-widest uppercase",children:"Groove & Swing Settings"})}),xa.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none",children:xa.jsx(Ee,{size:18})})]}),xa.jsxs("div",{className:"flex-1 overflow-hidden p-0 flex flex-col md:flex-row min-h-0",children:[xa.jsx("div",{className:"w-full md:w-72 flex flex-col bg-dark-bgSecondary border-r border-ft2-border min-h-0",children:xa.jsxs("section",{className:"flex flex-col flex-1 min-h-0 p-6",children:[xa.jsx("h3",{className:"flex-shrink-0 text-ft2-highlight text-xs font-bold mb-4 tracking-wider uppercase flex items-center gap-2",children:"Groove Templates"}),xa.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-ft2 space-y-4",children:["straight","shuffle","swing","funk","hip-hop","custom"].map(e=>{const t=Bn.filter(t=>t.category===e);return 0===t.length?null:xa.jsxs("div",{className:"space-y-1",children:[xa.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase px-1 pb-1 border-b border-dark-border",children:e}),xa.jsx("div",{className:"grid grid-cols-1 gap-1 pt-1",children:t.map(e=>xa.jsxs("button",{onClick:()=>u(e.id),className:"w-full text-left px-3 py-2 text-xs font-mono transition-all rounded "+(e.id===c?"bg-accent-primary text-white font-bold shadow-glow-sm":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary bg-dark-bgSecondary border border-transparent hover:border-ft2-border"),children:[xa.jsxs("div",{className:"flex justify-between items-center",children:[xa.jsx("span",{children:e.name}),e.id===c&&xa.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]}),e.description&&xa.jsx("div",{className:"text-[10px] mt-0.5 leading-tight "+(e.id===c?"text-white":"opacity-60"),children:e.description})]},e.id))})]},e)})})]})}),xa.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-ft2 p-6 space-y-8 min-h-0",children:[xa.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Global Intensity"}),xa.jsx("div",{className:"flex items-center gap-2",children:xa.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer group bg-dark-bgTertiary px-2 py-1 rounded border border-ft2-border hover:border-accent-primary transition-colors",title:"Use authentic MPC 50-75% scale",children:[xa.jsx("input",{type:"checkbox",checked:o,onChange:e=>l(e.target.checked),className:"w-3 h-3 accent-accent-primary"}),xa.jsx("span",{className:"text-[10px] text-text-muted group-hover:text-text-secondary font-bold uppercase",children:"MPC SCALE"})]})})]}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsxs("div",{className:"flex justify-between items-end",children:[xa.jsx("span",{className:"text-[10px] text-text-secondary font-mono uppercase",children:"Groove Amount"}),xa.jsx("span",{className:"text-xl font-mono text-accent-primary font-bold leading-none",children:o?t:`${t}%`})]}),xa.jsx("input",{type:"range",min:o?50:0,max:o?75:200,value:t,onChange:e=>a(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),a(o?50:100)},className:"w-full h-2 accent-accent-primary cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),xa.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[xa.jsx("span",{children:o?"50%":"Fixed"}),xa.jsx("span",{children:o?"66%":"100%"}),xa.jsx("span",{children:o?"75%":"200%"})]}),xa.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:o?"Authentic MPC timing. 66% is the perfect triplet ratio. Right-click to reset.":"Scales template intensity. 100% is standard. Right-click to reset."})]})]}),xa.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[xa.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Swing Resolution"}),xa.jsx("div",{className:"grid grid-cols-3 gap-2",children:[2,4,8,16,32,64].map(e=>xa.jsxs("button",{onClick:()=>{s(e),"straight"!==c&&u("straight")},className:"px-2 py-2 text-[10px] font-mono border rounded transition-all "+(n===e&&"straight"===c?"bg-accent-primary border-accent-primary text-white font-bold":"bg-dark-bgTertiary border-ft2-border text-text-secondary hover:border-text-muted"),children:[2===e?"16th":4===e?"8th":8===e?"4th":e/16+"b",xa.jsxs("div",{className:"text-[8px] opacity-60",children:["(",e," stp)"]})]},e))}),xa.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed",children:"Determines which notes in the pattern cycle are swung. 16th is standard for electronic music."})]}),xa.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("h3",{className:"text-cyan-400 text-xs font-bold tracking-wider uppercase",children:"Humanization (Jitter)"}),xa.jsxs("span",{className:"text-lg font-mono text-cyan-400 font-bold leading-none",children:[r,"%"]})]}),xa.jsxs("div",{className:"space-y-2",children:[xa.jsx("input",{type:"range",min:"0",max:"100",value:r,onChange:e=>i(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),i(0)},className:"w-full h-2 accent-cyan-500 cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),xa.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[xa.jsx("span",{children:"Robotic"}),xa.jsx("span",{children:"Loose"}),xa.jsx("span",{children:"Drunken"})]}),xa.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:"Adds random micro-timing offsets (0-10ms) to every note. Simulates unstable vintage clocks or human performance."})]})]})]})]}),xa.jsxs("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-between items-center",children:[xa.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[xa.jsx(_t,{size:12,className:"text-ft2-highlight"}),xa.jsx("span",{children:"Groove affects all patterns globally"})]}),xa.jsx("button",{onClick:e,className:"px-6 py-1.5 bg-accent-primary border border-accent-primary text-white text-xs font-bold hover:bg-accent-secondary hover:border-accent-secondary transition-all rounded shadow-glow-sm focus:outline-none uppercase tracking-widest",children:"Accept"})]})]})})};e.createContext,s.createContext();const CC=e=>"string"==typeof e,EC=()=>{let e,t;const a=new Promise((a,n)=>{e=a,t=n});return a.resolve=e,a.reject=t,a},PC=e=>null==e?"":""+e,_C=/###/g,TC=e=>e&&e.indexOf("###")>-1?e.replace(_C,"."):e,AC=e=>!e||CC(e),OC=(e,t,a)=>{const n=CC(t)?t.split("."):t;let s=0;for(;s<n.length-1;){if(AC(e))return{};const t=TC(n[s]);!e[t]&&a&&(e[t]=new a),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return AC(e)?{}:{obj:e,k:TC(n[s])}},IC=(e,t,a)=>{const{obj:n,k:s}=OC(e,t,Object);if(void 0!==n||1===t.length)return void(n[s]=a);let r=t[t.length-1],i=t.slice(0,t.length-1),o=OC(e,i,Object);for(;void 0===o.obj&&i.length;)r=`${i[i.length-1]}.${r}`,i=i.slice(0,i.length-1),o=OC(e,i,Object),null!=o&&o.obj&&typeof o.obj[`${o.k}.${r}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${r}`]=a},DC=(e,t)=>{const{obj:a,k:n}=OC(e,t);if(a&&Object.prototype.hasOwnProperty.call(a,n))return a[n]},FC=(e,t,a)=>{for(const n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?CC(e[n])||e[n]instanceof String||CC(t[n])||t[n]instanceof String?a&&(e[n]=t[n]):FC(e[n],t[n],a):e[n]=t[n]);return e},RC=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var jC={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const LC=e=>CC(e)?e.replace(/[&<>"'\/]/g,e=>jC[e]):e;const BC=[" ",",","?","!",";"],VC=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const a=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,a),this.regExpQueue.push(e),a}}(20),zC=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(a);let s=e;for(let r=0;r<n.length;){if(!s||"object"!=typeof s)return;let e,t="";for(let i=r;i<n.length;++i)if(i!==r&&(t+=a),t+=n[i],e=s[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&i<n.length-1)continue;r+=i-r+1;break}s=e}return s},UC=e=>null==e?void 0:e.replace("_","-"),GC={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var a,n;null==(n=null==(a=null==console?void 0:console[e])?void 0:a.apply)||n.call(a,console,t)}};class WC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||GC,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,a,n){return n&&!this.debug?null:(CC(e[0])&&(e[0]=`${a}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new WC(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new WC(this.logger,e)}}var HC=new WC;class KC{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const a=this.observers[e].get(t)||0;this.observers[e].set(t,a+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,n]=e;for(let s=0;s<n;s++)t(...a)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[n,s]=t;for(let r=0;r<s;r++)n.apply(n,[e,...a])})}}class $C extends KC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,a){var n,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,o=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],a&&(Array.isArray(a)?l.push(...a):CC(a)&&i?l.push(...a.split(i)):l.push(a)));const c=DC(this.data,l);return!c&&!t&&!a&&e.indexOf(".")>-1&&(e=l[0],t=l[1],a=l.slice(2).join(".")),!c&&o&&CC(a)?zC(null==(s=null==(n=this.data)?void 0:n[e])?void 0:s[t],a,i):c}addResource(e,t,a,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const r=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator;let i=[e,t];a&&(i=i.concat(r?a.split(r):a)),e.indexOf(".")>-1&&(i=e.split("."),n=t,t=i[1]),this.addNamespaces(t),IC(this.data,i,n),s.silent||this.emit("added",e,t,a,n)}addResources(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const s in a)(CC(a[s])||Array.isArray(a[s]))&&this.addResource(e,t,s,a[s],{silent:!0});n.silent||this.emit("added",e,t,a)}addResourceBundle(e,t,a,n,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},i=[e,t];e.indexOf(".")>-1&&(i=e.split("."),n=a,a=t,t=i[1]),this.addNamespaces(t);let o=DC(this.data,i)||{};r.skipCopy||(a=JSON.parse(JSON.stringify(a))),n?FC(o,a,s):o={...o,...a},IC(this.data,i,o),r.silent||this.emit("added",e,t,a)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var qC={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,a,n,s){return e.forEach(e=>{var r;t=(null==(r=this.processors[e])?void 0:r.process(t,a,n,s))??t}),t}};const XC={},YC=e=>!CC(e)&&"boolean"!=typeof e&&"number"!=typeof e;class QC extends KC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),((e,t,a)=>{e.forEach(e=>{t[e]&&(a[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=HC.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const a=this.resolve(e,t);return void 0!==(null==a?void 0:a.res)}extractFromKey(e,t){let a=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===a&&(a=":");const n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const r=a&&e.indexOf(a)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,a)=>{t=t||"",a=a||"";const n=BC.filter(e=>t.indexOf(e)<0&&a.indexOf(e)<0);if(0===n.length)return!0;const s=VC.getRegExp(`(${n.map(e=>"?"===e?"\\?":e).join("|")})`);let r=!s.test(e);if(!r){const t=e.indexOf(a);t>0&&!s.test(e.substring(0,t))&&(r=!0)}return r})(e,a,n));if(r&&!i){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:CC(s)?[s]:s};const r=e.split(a);(a!==n||a===n&&this.options.ns.indexOf(r[0])>-1)&&(s=r.shift()),e=r.join(n)}return{key:e,namespaces:CC(s)?[s]:s}}translate(e,t,a){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const n=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:r,namespaces:i}=this.extractFromKey(e[e.length-1],t),o=i[i.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return n?{res:`${o}${e}${r}`,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:`${o}${e}${r}`}return n?{res:r,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:o,usedParams:this.getUsedParamsDetails(t)}:r}const u=this.resolve(e,t);let d=null==u?void 0:u.res;const p=(null==u?void 0:u.usedKey)||r,h=(null==u?void 0:u.exactUsedKey)||r,m=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,f=!this.i18nFormat||this.i18nFormat.handleAsObject,g=void 0!==t.count&&!CC(t.count),y=QC.hasDefaultValue(t),b=g?this.pluralResolver.getSuffix(l,t.count,t):"",v=t.ordinal&&g?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",x=g&&!t.ordinal&&0===t.count,w=x&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${b}`]||t[`defaultValue${v}`]||t.defaultValue;let k=d;f&&!d&&y&&(k=w);const S=YC(k),M=Object.prototype.toString.apply(k);if(!(f&&k&&S&&["[object Number]","[object Function]","[object RegExp]"].indexOf(M)<0)||CC(m)&&Array.isArray(k))if(f&&CC(m)&&Array.isArray(d))d=d.join(m),d&&(d=this.extendTranslation(d,e,t,a));else{let n=!1,i=!1;!this.isValidLookup(d)&&y&&(n=!0,d=w),this.isValidLookup(d)||(i=!0,d=r);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:d,p=y&&w!==d&&this.options.updateMissing;if(i||n||p){if(this.logger.log(p?"updateKey":"missingKey",l,o,r,p?w:d),s){const e=this.resolve(r,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const a=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&a&&a[0])for(let t=0;t<a.length;t++)e.push(a[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const n=(e,a,n)=>{var s;const r=y&&n!==d?n:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,o,a,r,p,t):null!=(s=this.backendConnector)&&s.saveMissing&&this.backendConnector.saveMissing(e,o,a,r,p,t),this.emit("missingKey",e,o,a,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&g?e.forEach(e=>{const a=this.pluralResolver.getSuffixes(e,t);x&&t[`defaultValue${this.options.pluralSeparator}zero`]&&a.indexOf(`${this.options.pluralSeparator}zero`)<0&&a.push(`${this.options.pluralSeparator}zero`),a.forEach(a=>{n([e],r+a,t[`defaultValue${a}`]||w)})}):n(e,r,w))}d=this.extendTranslation(d,e,t,u,a),i&&d===r&&this.options.appendNamespaceToMissingKey&&(d=`${o}:${r}`),(i||n)&&this.options.parseMissingKeyHandler&&(d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${o}:${r}`:r,n?d:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,k,{...t,ns:i}):`key '${r} (${this.language})' returned an object instead of string.`;return n?(u.res=e,u.usedParams=this.getUsedParamsDetails(t),u):e}if(s){const e=Array.isArray(k),a=e?[]:{},n=e?h:p;for(const r in k)if(Object.prototype.hasOwnProperty.call(k,r)){const e=`${n}${s}${r}`;a[r]=y&&!d?this.translate(e,{...t,defaultValue:YC(w)?w[r]:void 0,joinArrays:!1,ns:i}):this.translate(e,{...t,joinArrays:!1,ns:i}),a[r]===e&&(a[r]=k[r])}d=a}}return n?(u.res=d,u.usedParams=this.getUsedParamsDetails(t),u):d}extendTranslation(e,t,a,n,s){var r,i,o=this;if(null!=(r=this.i18nFormat)&&r.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...a},a.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!a.skipInterpolation){a.interpolation&&this.interpolator.init({...a,interpolation:{...this.options.interpolation,...a.interpolation}});const r=CC(e)&&(void 0!==(null==(i=null==a?void 0:a.interpolation)?void 0:i.skipOnVariables)?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(r){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=a.replace&&!CC(a.replace)?a.replace:a;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,a.lng||this.language||n.usedLng,a),r){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(a.nest=!1)}!a.lng&&n&&n.res&&(a.lng=this.language||n.usedLng),!1!==a.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(null==s?void 0:s[0])!==n[0]||a.context?o.translate(...n,t):(o.logger.warn(`It seems you are nesting recursively key: ${n[0]} in key: ${t[0]}`),null)},a)),a.interpolation&&this.interpolator.reset()}const l=a.postProcess||this.options.postProcess,c=CC(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==a.applyPostProcessor&&(e=qC.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(a)},...a}:a,this)),e}resolve(e){let t,a,n,s,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return CC(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const o=this.extractFromKey(e,i),l=o.key;a=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==i.count&&!CC(i.count),d=u&&!i.ordinal&&0===i.count,p=void 0!==i.context&&(CC(i.context)||"number"==typeof i.context)&&""!==i.context,h=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);c.forEach(e=>{var o,c;this.isValidLookup(t)||(r=e,!XC[`${h[0]}-${e}`]&&null!=(o=this.utils)&&o.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(r))&&(XC[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${a}" for languages "${h.join(", ")}" won't get resolved as namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(a=>{var r;if(this.isValidLookup(t))return;s=a;const o=[l];if(null!=(r=this.i18nFormat)&&r.addLookupKeys)this.i18nFormat.addLookupKeys(o,l,a,e,i);else{let e;u&&(e=this.pluralResolver.getSuffix(a,i.count,i));const t=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(o.push(l+e),i.ordinal&&0===e.indexOf(n)&&o.push(l+e.replace(n,this.options.pluralSeparator)),d&&o.push(l+t)),p){const a=`${l}${this.options.contextSeparator}${i.context}`;o.push(a),u&&(o.push(a+e),i.ordinal&&0===e.indexOf(n)&&o.push(a+e.replace(n,this.options.pluralSeparator)),d&&o.push(a+t))}}let c;for(;c=o.pop();)this.isValidLookup(t)||(n=c,t=this.getResource(a,e,c,i))}))})}),{res:t,usedKey:a,exactUsedKey:n,usedLng:s,usedNS:r}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,a){var n;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(n=this.i18nFormat)&&n.getResource?this.i18nFormat.getResource(e,t,a,s):this.resourceStore.getResource(e,t,a,s)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],a=e.replace&&!CC(e.replace);let n=a?e.replace:e;if(a&&typeof e.count<"u"&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!a){n={...n};for(const e of t)delete n[e]}return n}static hasDefaultValue(e){const t="defaultValue";for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t===a.substring(0,12)&&void 0!==e[a])return!0;return!1}}class ZC{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=HC.create("languageUtils")}getScriptPartFromCode(e){if(!(e=UC(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=UC(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(CC(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const a=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(a))&&(t=a)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const a=this.getScriptPartFromCode(e);if(this.isSupportedCode(a))return t=a;const n=this.getLanguagePartFromCode(e);if(this.isSupportedCode(n))return t=n;t=this.options.supportedLngs.find(e=>e===n?e:e.indexOf("-")<0&&n.indexOf("-")<0||!(e.indexOf("-")>0&&n.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===n||0===e.indexOf(n)&&n.length>1)?void 0:e)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),CC(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let a=e[t];return a||(a=e[this.getScriptPartFromCode(t)]),a||(a=e[this.formatLanguageCode(t)]),a||(a=e[this.getLanguagePartFromCode(t)]),a||(a=e.default),a||[]}toResolveHierarchy(e,t){const a=this.getFallbackCodes(t||this.options.fallbackLng||[],e),n=[],s=e=>{e&&(this.isSupportedCode(e)?n.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return CC(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):CC(e)&&s(this.formatLanguageCode(e)),a.forEach(e=>{n.indexOf(e)<0&&s(this.formatLanguageCode(e))}),n}}const JC={zero:0,one:1,two:2,few:3,many:4,other:5},eE={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class tE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=HC.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=UC("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:a,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let r;try{r=new Intl.PluralRules(a,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),eE;if(!e.match(/-|_/))return eE;const a=this.languageUtils.getLanguagePartFromCode(e);r=this.getRule(a,t)}return this.pluralRulesCache[s]=r,r}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),(null==a?void 0:a.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,a).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),a?a.resolvedOptions().pluralCategories.sort((e,t)=>JC[e]-JC[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=this.getRule(e,a);return n?`${this.options.prepend}${a.ordinal?`ordinal${this.options.prepend}`:""}${n.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,a))}}const aE=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=((e,t,a)=>{const n=DC(e,a);return void 0!==n?n:DC(t,a)})(e,t,a);return!r&&s&&CC(a)&&(r=zC(e,a,n),void 0===r&&(r=zC(t,a,n))),r},nE=e=>e.replace(/\$/g,"$$$$");class sE{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=HC.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:a,useRawValueToEscape:n,prefix:s,prefixEscaped:r,suffix:i,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:p,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:f,maxReplaces:g,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:LC,this.escapeValue=void 0===a||a,this.useRawValueToEscape=void 0!==n&&n,this.prefix=s?RC(s):r||"{{",this.suffix=i?RC(i):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?RC(d):p||RC("$t("),this.nestingSuffix=h?RC(h):m||RC(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=g||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,a,n){var s;let r,i,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const s=aE(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(s,void 0,a,{...n,...t,interpolationkey:e}):s}const s=e.split(this.formatSeparator),r=s.shift().trim(),i=s.join(this.formatSeparator).trim();return this.format(aE(t,l,r,this.options.keySeparator,this.options.ignoreJSONStructure),i,a,{...n,...t,interpolationkey:r})};this.resetRegExp();const u=(null==n?void 0:n.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=void 0!==(null==(s=null==n?void 0:n.interpolation)?void 0:s.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>nE(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?nE(this.escape(e)):nE(e)}].forEach(t=>{for(o=0;r=t.regex.exec(e);){const a=r[1].trim();if(i=c(a),void 0===i)if("function"==typeof u){const t=u(e,r,n);i=CC(t)?t:""}else if(n&&Object.prototype.hasOwnProperty.call(n,a))i="";else{if(d){i=r[0];continue}this.logger.warn(`missed to pass in variable ${a} for interpolating ${e}`),i=""}else!CC(i)&&!this.useRawValueToEscape&&(i=PC(i));const s=t.safeValue(i);if(e=e.replace(r[0],s),d?(t.regex.lastIndex+=i.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t){let a,n,s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(e,t)=>{const a=this.nestingOptionsSeparator;if(e.indexOf(a)<0)return e;const n=e.split(new RegExp(`${a}[ ]*{`));let r=`{${n[1]}`;e=n[0],r=this.interpolate(r,s);const i=r.match(/'/g),o=r.match(/"/g);(((null==i?void 0:i.length)??0)%2==0&&!o||o.length%2!=0)&&(r=r.replace(/'/g,'"'));try{s=JSON.parse(r),t&&(s={...t,...s})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${a}${r}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;a=this.nestingRegexp.exec(e);){let o=[];s={...r},s=s.replace&&!CC(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let l=!1;if(-1!==a[0].indexOf(this.formatSeparator)&&!/{.*}/.test(a[1])){const e=a[1].split(this.formatSeparator).map(e=>e.trim());a[1]=e.shift(),o=e,l=!0}if(n=t(i.call(this,a[1].trim(),s),s),n&&a[0]===e&&!CC(n))return n;CC(n)||(n=PC(n)),n||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),n=""),l&&(n=o.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:a[1].trim()}),n.trim())),e=e.replace(a[0],n),this.regexp.lastIndex=0}return e}}const rE=e=>{const t={};return(a,n,s)=>{let r=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(r={...r,[s.interpolationkey]:void 0});const i=n+JSON.stringify(r);let o=t[i];return o||(o=e(UC(n),s),t[i]=o),o(a)}};class iE{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=HC.create("formatter"),this.options=e,this.formats={number:rE((e,t)=>{const a=new Intl.NumberFormat(e,{...t});return e=>a.format(e)}),currency:rE((e,t)=>{const a=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>a.format(e)}),datetime:rE((e,t)=>{const a=new Intl.DateTimeFormat(e,{...t});return e=>a.format(e)}),relativetime:rE((e,t)=>{const a=new Intl.RelativeTimeFormat(e,{...t});return e=>a.format(e,t.range||"day")}),list:rE((e,t)=>{const a=new Intl.ListFormat(e,{...t});return e=>a.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=rE(t)}format(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(e=>e.indexOf(")")>-1)){const e=s.findIndex(e=>e.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,e)].join(this.formatSeparator)}return s.reduce((e,t)=>{var s;const{formatName:r,formatOptions:i}=(e=>{let t=e.toLowerCase().trim();const a={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);"currency"===t&&s.indexOf(":")<0?a.currency||(a.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?a.range||(a.range=s.trim()):s.split(";").forEach(e=>{if(e){const[t,...n]=e.split(":"),s=n.join(":").trim().replace(/^'+|'+$/g,""),r=t.trim();a[r]||(a[r]=s),"false"===s&&(a[r]=!1),"true"===s&&(a[r]=!0),isNaN(s)||(a[r]=parseInt(s,10))}})}return{formatName:t,formatOptions:a}})(t);if(this.formats[r]){let t=e;try{const o=(null==(s=null==n?void 0:n.formatParams)?void 0:s[n.interpolationkey])||{},l=o.locale||o.lng||n.locale||n.lng||a;t=this.formats[r](e,l,{...i,...n,...o})}catch(o){this.logger.warn(o)}return t}return this.logger.warn(`there was no format function for ${r}`),e},e)}}class oE extends KC{constructor(e,t,a){var n,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=a,this.languageUtils=a.languageUtils,this.options=r,this.logger=HC.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],null==(s=null==(n=this.backend)?void 0:n.init)||s.call(n,a,r.backend,r)}queueLoad(e,t,a,n){const s={},r={},i={},o={};return e.forEach(e=>{let n=!0;t.forEach(t=>{const i=`${e}|${t}`;!a.reload&&this.store.hasResourceBundle(e,t)?this.state[i]=2:this.state[i]<0||(1===this.state[i]?void 0===r[i]&&(r[i]=!0):(this.state[i]=1,n=!1,void 0===r[i]&&(r[i]=!0),void 0===s[i]&&(s[i]=!0),void 0===o[t]&&(o[t]=!0)))}),n||(i[e]=!0)}),(Object.keys(s).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(r),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(o)}}loaded(e,t,a){const n=e.split("|"),s=n[0],r=n[1];t&&this.emit("failedLoading",s,r,t),!t&&a&&this.store.addResourceBundle(s,r,a,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&a&&(this.state[e]=0);const i={};this.queue.forEach(a=>{((e,t,a)=>{const{obj:n,k:s}=OC(e,t,Object);n[s]=n[s]||[],n[s].push(a)})(a.loaded,[s],r),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(a,e),t&&a.errors.push(t),0===a.pendingCount&&!a.done&&(Object.keys(a.loaded).forEach(e=>{i[e]||(i[e]={});const t=a.loaded[e];t.length&&t.forEach(t=>{void 0===i[e][t]&&(i[e][t]=!0)})}),a.done=!0,a.errors.length?a.callback(a.errors):a.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(e=>!e.done)}read(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,r=arguments.length>5?arguments[5]:void 0;if(!e.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:a,tried:n,wait:s,callback:r});this.readingCalls++;const i=(i,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}i&&o&&n<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,a,n+1,2*s,r)},s):r(i,o)},o=this.backend[a].bind(this.backend);if(2!==o.length)return o(e,t,i);try{const a=o(e,t);a&&"function"==typeof a.then?a.then(e=>i(null,e)).catch(i):i(null,a)}catch(l){i(l)}}prepareLoading(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();CC(e)&&(e=this.languageUtils.toResolveHierarchy(e)),CC(t)&&(t=[t]);const s=this.queueLoad(e,t,a,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,a){this.prepareLoading(e,t,{},a)}reload(e,t,a){this.prepareLoading(e,t,{reload:!0},a)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=e.split("|"),n=a[0],s=a[1];this.read(n,s,"read",void 0,void 0,(a,r)=>{a&&this.logger.warn(`${t}loading namespace ${s} for language ${n} failed`,a),!a&&r&&this.logger.log(`${t}loaded namespace ${s} for language ${n}`,r),this.loaded(e,a,r)})}saveMissing(e,t,a,n,s){var r,i,o,l,c;let u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(i=null==(r=this.services)?void 0:r.utils)||!i.hasLoadedNamespace||null!=(l=null==(o=this.services)?void 0:o.utils)&&l.hasLoadedNamespace(t)){if(null!=a&&""!==a){if(null!=(c=this.backend)&&c.create){const r={...u,isUpdate:s},i=this.backend.create.bind(this.backend);if(i.length<6)try{let s;s=5===i.length?i(e,t,a,n,r):i(e,t,a,n),s&&"function"==typeof s.then?s.then(e=>d(null,e)).catch(d):d(null,s)}catch(p){d(p)}else i(e,t,a,n,d,r)}!e||!e[0]||this.store.addResource(e[0],t,a,n)}}else this.logger.warn(`did not save key "${a}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const lE=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),CC(e[1])&&(t.defaultValue=e[1]),CC(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const a=e[3]||e[2];Object.keys(a).forEach(e=>{t[e]=a[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),cE=e=>{var t,a;return CC(e.ns)&&(e.ns=[e.ns]),CC(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),CC(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(a=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:a.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},uE=()=>{};class dE extends KC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=cE(e),this.services={},this.logger=HC,this.modules={external:[]},a=this,Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(e=>{"function"==typeof a[e]&&(a[e]=a[e].bind(a))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}var a}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(a=t,t={}),null==t.defaultNS&&t.ns&&(CC(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=lE();this.options={...n,...this.options,...cE(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?HC.init(s(this.modules.logger),this.options):HC.init(null,this.options),t=this.modules.formatter?this.modules.formatter:iE;const a=new ZC(this.options);this.store=new $C(this.options.resources,this.options);const r=this.services;r.logger=HC,r.resourceStore=this.store,r.languageUtils=a,r.pluralResolver=new tE(a,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(r.formatter=s(t),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new sE(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new oE(s(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",function(t){for(var a=arguments.length,n=new Array(a>1?a-1:0),s=1;s<a;s++)n[s-1]=arguments[s];e.emit(t,...n)}),this.modules.languageDetector&&(r.languageDetector=s(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=s(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new QC(this.services,this.options),this.translator.on("*",function(t){for(var a=arguments.length,n=new Array(a>1?a-1:0),s=1;s<a;s++)n[s-1]=arguments[s];e.emit(t,...n)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,a||(a=uE),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const r=EC(),i=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),r.resolve(t),a(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?i():setTimeout(i,0),r}loadResources(e){var t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uE;const s=CC(e)?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==s?void 0:s.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return n();const e=[],r=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};s?r(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>r(e)),null==(a=null==(t=this.options.preload)?void 0:t.forEach)||a.call(t,e=>r(e)),this.services.backendConnector.load(e,this.options.ns,e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(e)})}else n(null)}reloadResources(e,t,a){const n=EC();return"function"==typeof e&&(a=e,e=void 0),"function"==typeof t&&(a=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),a||(a=uE),this.services.backendConnector.reload(e,t,e=>{n.resolve(),a(e)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&qC.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}}changeLanguage(e,t){var a=this;this.isLanguageChangingTo=e;const n=EC();this.emit("languageChanging",e);const s=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},r=(r,i)=>{i?this.isLanguageChangingTo===e&&(s(i),this.translator.changeLanguage(i),this.isLanguageChangingTo=void 0,this.emit("languageChanged",i),this.logger.log("languageChanged",i)):this.isLanguageChangingTo=void 0,n.resolve(function(){return a.t(...arguments)}),t&&t(r,function(){return a.t(...arguments)})},i=t=>{var a,n;!e&&!t&&this.services.languageDetector&&(t=[]);const i=this.services.languageUtils.getBestMatchFromCodes(CC(t)?[t]:t);i&&(this.language||s(i),this.translator.language||this.translator.changeLanguage(i),null==(n=null==(a=this.services.languageDetector)?void 0:a.cacheUserLanguage)||n.call(a,i)),this.loadResources(i,e=>{r(e,i)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),n}getFixedT(e,t,a){var n=this;const s=function(e,t){let r;if("object"!=typeof t){for(var i=arguments.length,o=new Array(i>2?i-2:0),l=2;l<i;l++)o[l-2]=arguments[l];r=n.options.overloadTranslationOptionHandler([e,t].concat(o))}else r={...t};r.lng=r.lng||s.lng,r.lngs=r.lngs||s.lngs,r.ns=r.ns||s.ns,""!==r.keyPrefix&&(r.keyPrefix=r.keyPrefix||a||s.keyPrefix);const c=n.options.keySeparator||".";let u;return u=r.keyPrefix&&Array.isArray(e)?e.map(e=>`${r.keyPrefix}${c}${e}`):r.keyPrefix?`${r.keyPrefix}${c}${e}`:e,n.t(u,r)};return CC(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=a,s}t(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return null==(e=this.translator)?void 0:e.translate(...a)}exists(){for(var e,t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return null==(e=this.translator)?void 0:e.exists(...a)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const a=t.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===a.toLowerCase())return!0;const r=(e,t)=>{const a=this.services.backendConnector.state[`${e}|${t}`];return-1===a||0===a||2===a};if(t.precheck){const e=t.precheck(this,r);if(void 0!==e)return e}return!!(this.hasResourceBundle(a,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(a,e)&&(!n||r(s,e)))}loadNamespaces(e,t){const a=EC();return this.options.ns?(CC(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}loadLanguages(e,t){const a=EC();CC(e)&&(e=[e]);const n=this.options.preload||[],s=e.filter(e=>n.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return s.length?(this.options.preload=n.concat(s),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}dir(e){var t,a;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const n=(null==(a=this.services)?void 0:a.languageUtils)||new ZC(lE());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(n.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new dE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uE;const a=e.forkResourceStore;a&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},s=new dE(n);if((void 0!==e.debug||void 0!==e.prefix)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(e=>{s[e]=this[e]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},a){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce((a,n)=>(a[n]={...e[t][n]},a),{})),{});s.store=new $C(e,n),s.services.resourceStore=s.store}return s.translator=new QC(s.services,n),s.translator.on("*",function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];s.emit(e,...a)}),s.init(n,t),s.translator.options=n,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const pE=dE.createInstance();function hE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}pE.createInstance=dE.createInstance,pE.createInstance,pE.dir,pE.init,pE.loadResources,pE.reloadResources,pE.use,pE.changeLanguage,pE.getFixedT,pE.t,pE.exists,pE.setDefaultNamespace,pE.hasLoadedNamespace,pE.loadNamespaces,pE.loadLanguages,s.createContext(()=>e=>e),s.createContext(),s.createContext(),s.createContext(),s.createContext();var mE,fE,gE,yE,bE,vE={exports:{}};function xE(){if(fE)return mE;fE=1;return mE="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function wE(){if(yE)return gE;yE=1;var e=xE();function t(){}function a(){}return a.resetWarningCache=t,gE=function(){function n(t,a,n,s,r,i){if(i!==e){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function s(){return n}n.isRequired=n;var r={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:a,resetWarningCache:t};return r.PropTypes=r,r}}function kE(){return bE||(bE=1,vE.exports=wE()()),vE.exports}const SE=hE(kE());SE.bool.isRequired,SE.func.isRequired;const ME=(e,t,a)=>{const n=e[t];try{return void new URL(n)}catch{return new Error(`Invalid prop \`${t}\` supplied to \`${a}\`. Expected a valid URL but received \`${n}\`.`)}};SE.arrayOf(SE.shape({name:SE.string.isRequired,isDirectory:SE.bool.isRequired,path:SE.string.isRequired,updatedAt:(e,t,a)=>{const n=e[t];if(n&&isNaN(Date.parse(n)))return new Error(`Invalid prop \`${t}\` supplied to \`${a}\`. Expected a valid date string (ISO 8601) but received \`${n}\`.`)},size:SE.number})).isRequired,SE.shape({url:ME,headers:SE.objectOf(SE.string),method:SE.oneOf(["POST","PUT"])}),SE.bool,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.oneOf(["grid","list"]),SE.number,SE.bool,SE.string,SE.oneOfType([SE.string,SE.number]),SE.oneOfType([SE.string,SE.number]),SE.string,SE.func,SE.string,SE.string,SE.string,SE.shape({create:SE.bool,upload:SE.bool,move:SE.bool,copy:SE.bool,rename:SE.bool,download:SE.bool,delete:SE.bool}),SE.bool,SE.bool,SE.string,SE.object,SE.func;const NE=()=>"showOpenFilePicker"in window&&"showDirectoryPicker"in window;let CE=null;function EE(){return CE}async function PE(e,t){const a=await e.createWritable();await a.write(t),await a.close()}const _E=JSON.parse('["/public/data/instruments/furnace/AY/Closed Hat.fui","/public/data/instruments/furnace/AY/Hat-EnvBass.fui","/public/data/instruments/furnace/AY/Heavy Kick and Snare.fui","/public/data/instruments/furnace/AY/Heavy Kick.fui","/public/data/instruments/furnace/AY/Kick E-1.fui","/public/data/instruments/furnace/AY/Open Hat.fui","/public/data/instruments/furnace/AY/Snare A#3.fui","/public/data/instruments/furnace/AY/kick.fui","/public/data/instruments/furnace/AY/snare.fui","/public/data/instruments/furnace/C64/C64Lead.fui","/public/data/instruments/furnace/C64/C64_Bass.fui","/public/data/instruments/furnace/C64/Castanets.fui","/public/data/instruments/furnace/C64/Closed_Hi-hat.fui","/public/data/instruments/furnace/C64/Gunshot.fui","/public/data/instruments/furnace/C64/Open_Hi-hat.fui","/public/data/instruments/furnace/C64/Side_Stick.fui","/public/data/instruments/furnace/C64/Snare.fui","/public/data/instruments/furnace/C64/string_c64.fui","/public/data/instruments/furnace/ESFM/ESFM Guitar Power Chord (note cut for palm mute).fui","/public/data/instruments/furnace/ESFM/Hi-Hat_ESFM.fui","/public/data/instruments/furnace/ESFM/Synth Bass.fui","/public/data/instruments/furnace/ESFM/deep_bass.fui","/public/data/instruments/furnace/ESFM/delayed.fui","/public/data/instruments/furnace/ESFM/djtBMX_1chostinato.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings2.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings3.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings4.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opRubbaBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRAS.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRASSSECT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMGIT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMPWM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMSYN.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell-short.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresopipe.fui","/public/data/instruments/furnace/ESFM/djtBMX_PULSELESSBUZZER.fui","/public/data/instruments/furnace/ESFM/djtBMX_analogoctbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_bells.fui","/public/data/instruments/furnace/ESFM/djtBMX_brarsesin.fui","/public/data/instruments/furnace/ESFM/djtBMX_brassin.fui","/public/data/instruments/furnace/ESFM/djtBMX_bwaro.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorbel.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorpad.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger2.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger3.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger4.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-basskick.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-closehh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-marimba.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-openhh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-padbrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-sinetom.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-snare.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-springbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compileagogo.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilebrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilefartbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_didgeritune.fui","/public/data/instruments/furnace/ESFM/djtBMX_drlead.fui","/public/data/instruments/furnace/ESFM/djtBMX_egless-kick.fui","/public/data/instruments/furnace/ESFM/djtBMX_explosion.fui","/public/data/instruments/furnace/ESFM/djtBMX_falcomkey.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn3.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn4.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitsyn2.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitty.fui","/public/data/instruments/furnace/ESFM/djtBMX_hammeredkeypad.fui","/public/data/instruments/furnace/ESFM/djtBMX_kikbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_lfotest.fui","/public/data/instruments/furnace/ESFM/djtBMX_lofibrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_lylemays.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino2.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino3.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino4.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino5.fui","/public/data/instruments/furnace/ESFM/djtBMX_nearest-drone.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick2.fui","/public/data/instruments/furnace/ESFM/djtBMX_noisytom.fui","/public/data/instruments/furnace/ESFM/djtBMX_panfluter.fui","/public/data/instruments/furnace/ESFM/djtBMX_pianoyorgan.fui","/public/data/instruments/furnace/ESFM/djtBMX_piezoclavi.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspulse.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm2.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm3.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwminv.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope3.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizeddrone2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedhorn.fui","/public/data/instruments/furnace/ESFM/djtBMX_santur.fui","/public/data/instruments/furnace/ESFM/djtBMX_santurys.fui","/public/data/instruments/furnace/ESFM/djtBMX_segapiano.fui","/public/data/instruments/furnace/ESFM/djtBMX_shttomsz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sinusoidgit.fui","/public/data/instruments/furnace/ESFM/djtBMX_sitardrone.fui","/public/data/instruments/furnace/ESFM/djtBMX_slapbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_softstar-string-enhanced.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_squeiuz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass5.fui","/public/data/instruments/furnace/ESFM/djtBMX_superpwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_sync-invtest.fui","/public/data/instruments/furnace/ESFM/djtBMX_syncpwm-abuse.fui","/public/data/instruments/furnace/ESFM/djtBMX_tabla.fui","/public/data/instruments/furnace/ESFM/djtBMX_tarnceseq.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20square.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20squaretest.fui","/public/data/instruments/furnace/ESFM/djtBMX_wurly.fui","/public/data/instruments/furnace/ESFM/fakebits.fui","/public/data/instruments/furnace/ESFM/maj_chord.fui","/public/data/instruments/furnace/ESFM/min_chord.fui","/public/data/instruments/furnace/ESFM/obligatory_supersaw.fui","/public/data/instruments/furnace/ESFM/phat_square.fui","/public/data/instruments/furnace/ESFM/sine_w_reverb.fui","/public/data/instruments/furnace/ESFM/squishsine_organ.fui","/public/data/instruments/furnace/ESFM/stereo_brass_or_strings.fui","/public/data/instruments/furnace/ESFM/weird_bass.fui","/public/data/instruments/furnace/ESFM/wood_block.fui","/public/data/instruments/furnace/GB/GB_Kick.fui","/public/data/instruments/furnace/GB/GB_Lead.fui","/public/data/instruments/furnace/GB/GB_Snare.fui","/public/data/instruments/furnace/GB/closed hi-hat.fui","/public/data/instruments/furnace/GB/kick.fui","/public/data/instruments/furnace/GB/open hihat.fui","/public/data/instruments/furnace/GB/snare.fui","/public/data/instruments/furnace/GB/square fade-in.fui","/public/data/instruments/furnace/Lynx/harmonica.fui","/public/data/instruments/furnace/NES/0-2-5_arp_lead.fui","/public/data/instruments/furnace/NES/0-3-5_arp_lead.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Closed.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Open.fui","/public/data/instruments/furnace/NES/Noise Kick.fui","/public/data/instruments/furnace/NES/Noise Snare.fui","/public/data/instruments/furnace/NES/Triangle Kick+Bass.fui","/public/data/instruments/furnace/NES/Triangle Kick.fui","/public/data/instruments/furnace/NES/Triangle Snare+Bass.fui","/public/data/instruments/furnace/NES/Triangle Snare.fui","/public/data/instruments/furnace/OPL/2-OP OPL3 Slap Bass.fui","/public/data/instruments/furnace/OPL/2-op strings.fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 1).fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 2).fui","/public/data/instruments/furnace/OPL/4op Bass.fui","/public/data/instruments/furnace/OPL/Chorus Organ.fui","/public/data/instruments/furnace/OPL/Closed Hi-hat.fui","/public/data/instruments/furnace/OPL/Crystal.fui","/public/data/instruments/furnace/OPL/DX7 Electric Piano.fui","/public/data/instruments/furnace/OPL/Distortion Guitar.fui","/public/data/instruments/furnace/OPL/Guitar 2.fui","/public/data/instruments/furnace/OPL/Guitar.fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Sine Carrier).fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Square Carrier).fui","/public/data/instruments/furnace/OPL/OPL-ClickKik.fui","/public/data/instruments/furnace/OPL/OPL-RhythmTemplate.fui","/public/data/instruments/furnace/OPL/OPL-RollingDrum.fui","/public/data/instruments/furnace/OPL/OPL1_Ride_Closed.fui","/public/data/instruments/furnace/OPL/OPL2-TwinkleBlare.fui","/public/data/instruments/furnace/OPL/OPL3-4opbrass11.fui","/public/data/instruments/furnace/OPL/OPL3-4opharmonica.fui","/public/data/instruments/furnace/OPL/OPL3-4opsitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomGuitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomString.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick3-60hz-.fui","/public/data/instruments/furnace/OPL/OPL3-MajorSquare.fui","/public/data/instruments/furnace/OPL/OPL3-PWM.fui","/public/data/instruments/furnace/OPL/OPL3-PeriodicNoise.fui","/public/data/instruments/furnace/OPL/OPL3-SegaBass.fui","/public/data/instruments/furnace/OPL/OPL3-SyncDuck.fui","/public/data/instruments/furnace/OPL/OPL3-TwinkleKey.fui","/public/data/instruments/furnace/OPL/OPL3-clap.fui","/public/data/instruments/furnace/OPL/OPL3-easyhoova.fui","/public/data/instruments/furnace/OPL/OPL3_-_C64_like_sqr_snare.fui","/public/data/instruments/furnace/OPL/OPL3_-_PWM_Lead.fui","/public/data/instruments/furnace/OPL/OPL3_BigBass.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Kick_or_Snare_Start.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Snare_Carry.fui","/public/data/instruments/furnace/OPL/OPL3_Slap_Bass.fui","/public/data/instruments/furnace/OPL/OPL3_Springybass.fui","/public/data/instruments/furnace/OPL/OPL_GoodPanFlute.fui","/public/data/instruments/furnace/OPL/OPL_KoreanSquare.fui","/public/data/instruments/furnace/OPL/OPL_SupersawUnit.fui","/public/data/instruments/furnace/OPL/OPL_horn.fui","/public/data/instruments/furnace/OPL/Open Hi-hat.fui","/public/data/instruments/furnace/OPL/Overdriven Guitar.fui","/public/data/instruments/furnace/OPL/Psuedo-PoKEY Perodic Noise (4OP).fui","/public/data/instruments/furnace/OPL/Snare Drum 2.fui","/public/data/instruments/furnace/OPL/Snare Drum.fui","/public/data/instruments/furnace/OPL/Synth Brass.fui","/public/data/instruments/furnace/OPL/Synth Guitar.fui","/public/data/instruments/furnace/OPL/Timpani (OPL3).fui","/public/data/instruments/furnace/OPL/Violin.fui","/public/data/instruments/furnace/OPL/asterix gb clarinet.fui","/public/data/instruments/furnace/OPL/clavinetmaybe.fui","/public/data/instruments/furnace/OPL/detuneexample.fui","/public/data/instruments/furnace/OPL/grand piano.fui","/public/data/instruments/furnace/OPL/kalimba or plain sine i cant tell.fui","/public/data/instruments/furnace/OPL/key.fui","/public/data/instruments/furnace/OPL/marimba.fui","/public/data/instruments/furnace/OPL/opl1 square.fui","/public/data/instruments/furnace/OPL/opl1-hat.fui","/public/data/instruments/furnace/OPL/opl1-kick.fui","/public/data/instruments/furnace/OPL/opl1-snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_3.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_kick.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_power_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_tom.fui","/public/data/instruments/furnace/OPL/opl3_4op_growl_synth.fui","/public/data/instruments/furnace/OPL/opl3_4op_lead_guitar.fui","/public/data/instruments/furnace/OPL/opl3_4op_piano_bell.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_strings.fui","/public/data/instruments/furnace/OPL/sax.fui","/public/data/instruments/furnace/OPL/tuba trumpet thing.fui","/public/data/instruments/furnace/OPLL/Acoustic Bass.fui","/public/data/instruments/furnace/OPLL/Almost_Sine.fui","/public/data/instruments/furnace/OPLL/Alt_Oboe.fui","/public/data/instruments/furnace/OPLL/Better_Electric_Guitar.fui","/public/data/instruments/furnace/OPLL/Chime.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_2.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_3.fui","/public/data/instruments/furnace/OPLL/Finger_Bass.fui","/public/data/instruments/furnace/OPLL/Glass_and_Wood.fui","/public/data/instruments/furnace/OPLL/Half_Sine.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Hi-Hat.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Kick.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Snare.fui","/public/data/instruments/furnace/OPLL/Hihat_Plus_Brass.fui","/public/data/instruments/furnace/OPLL/OPLL_Clickik.fui","/public/data/instruments/furnace/OPLL/Overdriven_Guitar.fui","/public/data/instruments/furnace/OPLL/Rainbow_Bell.fui","/public/data/instruments/furnace/OPLL/Reedlike_Sound.fui","/public/data/instruments/furnace/OPLL/Soft_Bass.fui","/public/data/instruments/furnace/OPLL/Soft_Clarinet.fui","/public/data/instruments/furnace/OPLL/Soft_EP.fui","/public/data/instruments/furnace/OPLL/Soft_Flute.fui","/public/data/instruments/furnace/OPLL/Steel_Guitar.fui","/public/data/instruments/furnace/OPLL/Synth_Marimba.fui","/public/data/instruments/furnace/OPLL/Triangle_Recorder.fui","/public/data/instruments/furnace/OPLL/Weeppiko-piano_guitar_idk.fui","/public/data/instruments/furnace/OPM/Acid_Bass.fui","/public/data/instruments/furnace/OPM/OPM Power Snare.fui","/public/data/instruments/furnace/OPM/OPMSquare.fui","/public/data/instruments/furnace/OPM/OPMTrumpet.fui","/public/data/instruments/furnace/OPM/Picked_Bass.fui","/public/data/instruments/furnace/OPM/Timpani (OPM).fui","/public/data/instruments/furnace/OPM/dx7tubularbell_opm.fui","/public/data/instruments/furnace/OPN/bass/4-OP_Vowel_Bass.fui","/public/data/instruments/furnace/OPN/bass/4_OP_Funky_Bass.fui","/public/data/instruments/furnace/OPN/bass/A.Bass1.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/Algorithmic Bass.fui","/public/data/instruments/furnace/OPN/bass/Bass.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass1.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass2.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass3.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3f.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3g.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass5.fui","/public/data/instruments/furnace/OPN/bass/E.Bass6.fui","/public/data/instruments/furnace/OPN/bass/E.Bass7.fui","/public/data/instruments/furnace/OPN/bass/FM_CriminalBass.fui","/public/data/instruments/furnace/OPN/bass/Finger Bass.fui","/public/data/instruments/furnace/OPN/bass/FingerBass.fui","/public/data/instruments/furnace/OPN/bass/House Bass 2.fui","/public/data/instruments/furnace/OPN/bass/House Bass.fui","/public/data/instruments/furnace/OPN/bass/House_Bass.fui","/public/data/instruments/furnace/OPN/bass/PickBass.fui","/public/data/instruments/furnace/OPN/bass/PickMD.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 2.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 3.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 4.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass.fui","/public/data/instruments/furnace/OPN/bass/bass1.fui","/public/data/instruments/furnace/OPN/bass/bass2.fui","/public/data/instruments/furnace/OPN/bass/bass3.fui","/public/data/instruments/furnace/OPN/bass/bass4.fui","/public/data/instruments/furnace/OPN/bass/bass5.fui","/public/data/instruments/furnace/OPN/bass/bass6.fui","/public/data/instruments/furnace/OPN/bass/bass_acoustic_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_01.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_02.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_03_muffled.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_04.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_05_amp.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_00_wobbly.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_01_wobbly2.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_02_wobbly3.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_00.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_01_snappy.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_02.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_00.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_01.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_02.fui","/public/data/instruments/furnace/OPN/bass/fm_bass1.fui","/public/data/instruments/furnace/OPN/bass/fm_bass2.fui","/public/data/instruments/furnace/OPN/bass/fm_bass3.fui","/public/data/instruments/furnace/OPN/bass/opm_nestri.fui","/public/data/instruments/furnace/OPN/bass/tarylbass1.fui","/public/data/instruments/furnace/OPN/default.fui","/public/data/instruments/furnace/OPN/drums/4-7 Snare.fui","/public/data/instruments/furnace/OPN/drums/Compressed Clap.fui","/public/data/instruments/furnace/OPN/drums/Compressed FM Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Cymbal.fui","/public/data/instruments/furnace/OPN/drums/Drum.fui","/public/data/instruments/furnace/OPN/drums/GB Tom.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick+Snare F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy Kick.fui","/public/data/instruments/furnace/OPN/drums/Kick Drum.fui","/public/data/instruments/furnace/OPN/drums/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/drums/Single Clap.fui","/public/data/instruments/furnace/OPN/drums/Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Squishy Snare.fui","/public/data/instruments/furnace/OPN/drums/crash_00.fui","/public/data/instruments/furnace/OPN/drums/fmbigkick.fui","/public/data/instruments/furnace/OPN/drums/fmclap.fui","/public/data/instruments/furnace/OPN/drums/fmclap2.fui","/public/data/instruments/furnace/OPN/drums/fmhat.fui","/public/data/instruments/furnace/OPN/drums/fmopenhat.fui","/public/data/instruments/furnace/OPN/drums/hihat_00.fui","/public/data/instruments/furnace/OPN/drums/idk_something_percussion.fui","/public/data/instruments/furnace/OPN/drums/kick_00_classic.fui","/public/data/instruments/furnace/OPN/drums/kick_01_power.fui","/public/data/instruments/furnace/OPN/drums/kick_02_power2.fui","/public/data/instruments/furnace/OPN/drums/kick_03_muffled.fui","/public/data/instruments/furnace/OPN/drums/kick_04_bassdrum.fui","/public/data/instruments/furnace/OPN/drums/kick_05_noisy.fui","/public/data/instruments/furnace/OPN/drums/kick_06_fat.fui","/public/data/instruments/furnace/OPN/drums/kick_07_fat2.fui","/public/data/instruments/furnace/OPN/drums/powersnare.fui","/public/data/instruments/furnace/OPN/drums/snare_00_simple.fui","/public/data/instruments/furnace/OPN/drums/snare_01_curvy.fui","/public/data/instruments/furnace/OPN/drums/snare_02_weak.fui","/public/data/instruments/furnace/OPN/drums/snare_03_weak2.fui","/public/data/instruments/furnace/OPN/drums/snare_04_muffled.fui","/public/data/instruments/furnace/OPN/drums/snare_05_intense.fui","/public/data/instruments/furnace/OPN/drums/snareclap_G-2.fui","/public/data/instruments/furnace/OPN/effect/Wind.fui","/public/data/instruments/furnace/OPN/effect/fm_propeller.fui","/public/data/instruments/furnace/OPN/effect/weird.fui","/public/data/instruments/furnace/OPN/guitar/ElectricGuitar.fui","/public/data/instruments/furnace/OPN/guitar/Funk Guitar.fui","/public/data/instruments/furnace/OPN/guitar/Hard Guitar.fui","/public/data/instruments/furnace/OPN/guitar/YM2151_DistGuitar.fui","/public/data/instruments/furnace/OPN/guitar/distguitar_00.fui","/public/data/instruments/furnace/OPN/guitar/distortion2.fui","/public/data/instruments/furnace/OPN/guitar/powerchord.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 1.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 2.fui","/public/data/instruments/furnace/OPN/horn/SynthBrass.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 1.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 2.fui","/public/data/instruments/furnace/OPN/horn/Tuba.fui","/public/data/instruments/furnace/OPN/horn/brass_00_wobbly.fui","/public/data/instruments/furnace/OPN/horn/brass_01_bassish.fui","/public/data/instruments/furnace/OPN/horn/brass_02_boring.fui","/public/data/instruments/furnace/OPN/horn/brass_03_boring2.fui","/public/data/instruments/furnace/OPN/keys/Acoustic E-Piano.fui","/public/data/instruments/furnace/OPN/keys/Circus Organ.fui","/public/data/instruments/furnace/OPN/keys/Digital Clav 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 2.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 3.fui","/public/data/instruments/furnace/OPN/keys/ElisOrgan.fui","/public/data/instruments/furnace/OPN/keys/Organ 3.fui","/public/data/instruments/furnace/OPN/keys/Organ 4.fui","/public/data/instruments/furnace/OPN/keys/Piano.fui","/public/data/instruments/furnace/OPN/keys/PianoMD.fui","/public/data/instruments/furnace/OPN/keys/YM2151_E-PIANO.fui","/public/data/instruments/furnace/OPN/keys/fmpiano.fui","/public/data/instruments/furnace/OPN/percussion/BellMD.fui","/public/data/instruments/furnace/OPN/percussion/ChurchBell.fui","/public/data/instruments/furnace/OPN/percussion/Dangerously Cheap Timpani.fui","/public/data/instruments/furnace/OPN/percussion/Kalimba.fui","/public/data/instruments/furnace/OPN/percussion/Marimba.fui","/public/data/instruments/furnace/OPN/percussion/MusicBox.fui","/public/data/instruments/furnace/OPN/percussion/Music_Box.fui","/public/data/instruments/furnace/OPN/percussion/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/percussion/Timpani (OPN).fui","/public/data/instruments/furnace/OPN/percussion/agogo.fui","/public/data/instruments/furnace/OPN/percussion/bell_00_glockenspiel.fui","/public/data/instruments/furnace/OPN/percussion/bell_01_glockenspiel_echoing.fui","/public/data/instruments/furnace/OPN/percussion/bell_02_glockenspiel_wobbly.fui","/public/data/instruments/furnace/OPN/percussion/dx7tubularbell_opn.fui","/public/data/instruments/furnace/OPN/percussion/fm_cowbell.fui","/public/data/instruments/furnace/OPN/percussion/octave_8_bell.fui","/public/data/instruments/furnace/OPN/strings/5thsPad.fui","/public/data/instruments/furnace/OPN/strings/Slow Strings.fui","/public/data/instruments/furnace/OPN/strings/String.fui","/public/data/instruments/furnace/OPN/strings/Violin.fui","/public/data/instruments/furnace/OPN/strings/ViolinMD.fui","/public/data/instruments/furnace/OPN/strings/strings_00.fui","/public/data/instruments/furnace/OPN/synth/Cricket Chorus.fui","/public/data/instruments/furnace/OPN/synth/FM_noname1.fui","/public/data/instruments/furnace/OPN/synth/Kirby SNES Synth Pad.fui","/public/data/instruments/furnace/OPN/synth/Metallic FM Lead.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square2.fui","/public/data/instruments/furnace/OPN/synth/Reverby_Live_Chords.fui","/public/data/instruments/furnace/OPN/synth/Saw Lead.fui","/public/data/instruments/furnace/OPN/synth/Square.fui","/public/data/instruments/furnace/OPN/synth/dodo.fui","/public/data/instruments/furnace/OPN/synth/fm_grinder.fui","/public/data/instruments/furnace/OPN/synth/fm_horror.fui","/public/data/instruments/furnace/OPN/synth/fm_noname2.fui","/public/data/instruments/furnace/OPN/synth/fm_noname3.fui","/public/data/instruments/furnace/OPN/synth/fm_noname4.fui","/public/data/instruments/furnace/OPN/synth/fm_noname5.fui","/public/data/instruments/furnace/OPN/synth/fm_noname6.fui","/public/data/instruments/furnace/OPN/synth/fm_noname7.fui","/public/data/instruments/furnace/OPN/synth/growl.fui","/public/data/instruments/furnace/OPN/synth/pateta.fui","/public/data/instruments/furnace/OPN/wind/BottleBlow.fui","/public/data/instruments/furnace/OPN/wind/Clarinet.fui","/public/data/instruments/furnace/OPN/wind/FM_4OP_-_Tenor_Sax.fui","/public/data/instruments/furnace/OPN/wind/Harmonica 2.fui","/public/data/instruments/furnace/OPN/wind/Sax 1.fui","/public/data/instruments/furnace/OPN/wind/Sax 2 (Bari).fui","/public/data/instruments/furnace/OPN/wind/bassoon.fui","/public/data/instruments/furnace/OPN/wind/bassoon_clarinet.fui","/public/data/instruments/furnace/OPN/wind/fm_pipeflute.fui","/public/data/instruments/furnace/OPN/wind/woodwind_00.fui","/public/data/instruments/furnace/OPZ/Another_Synth_Bass.fui","/public/data/instruments/furnace/OPZ/Banjo.fui","/public/data/instruments/furnace/OPZ/Fake SNES Bass_OPZ.fui","/public/data/instruments/furnace/OPZ/Fake_Famicom_Tri.fui","/public/data/instruments/furnace/OPZ/Funky_Bass.fui","/public/data/instruments/furnace/OPZ/Heavy_synth_bass.fui","/public/data/instruments/furnace/OPZ/Organ_OPZ.fui","/public/data/instruments/furnace/OPZ/Synth Bass.fui","/public/data/instruments/furnace/OPZ/accordion.fui","/public/data/instruments/furnace/OPZ/accordion2.fui","/public/data/instruments/furnace/OPZ/bagpipe.fui","/public/data/instruments/furnace/OPZ/distortedhalfsinepad.fui","/public/data/instruments/furnace/OPZ/funkysynthbass.fui","/public/data/instruments/furnace/OPZ/halfsine_pad.fui","/public/data/instruments/furnace/OPZ/horrorpad.fui","/public/data/instruments/furnace/OPZ/overdriven_guitar.fui","/public/data/instruments/furnace/OPZ/pickbass.fui","/public/data/instruments/furnace/OPZ/reedorgan.fui","/public/data/instruments/furnace/OPZ/rimshot.fui","/public/data/instruments/furnace/OPZ/sitar.fui","/public/data/instruments/furnace/OPZ/synthdulcimer.fui","/public/data/instruments/furnace/OPZ/timpani_oct2.fui","/public/data/instruments/furnace/SAA/EnvBass.fui","/public/data/instruments/furnace/SAA/RanedomHatC.fui","/public/data/instruments/furnace/SAA/RanedomKick.fui","/public/data/instruments/furnace/SAA/RanedomSnare.fui","/public/data/instruments/furnace/SN7/0-2-5_arp_lead.fui","/public/data/instruments/furnace/SN7/0-3-5_arp_lead.fui","/public/data/instruments/furnace/SN7/Echo.fui","/public/data/instruments/furnace/SN7/Flute.fui","/public/data/instruments/furnace/SN7/Follin Guitar 2.fui","/public/data/instruments/furnace/SN7/Follin Guitar.fui","/public/data/instruments/furnace/SN7/Guitar.fui","/public/data/instruments/furnace/SN7/Octave Arp.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Hat] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [KickSnare] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Nothing] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Closed CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Open CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Kick CH4 [C].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc KickSnare CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Snare CH4 [D].fui","/public/data/instruments/furnace/SN7/compatibility.fui","/public/data/instruments/furnace/TIA/Bass Drum.fui","/public/data/instruments/furnace/TIA/Clap.fui","/public/data/instruments/furnace/TIA/Hi-Hat Long.fui","/public/data/instruments/furnace/TIA/Hi-Hat.fui","/public/data/instruments/furnace/TIA/Snare Drum.fui","/public/data/instruments/furnace/TODO/(WSG) Supersaw.fui","/public/data/instruments/furnace/TODO/FDS-oneofthosejapaneseguitarsidkhowtheyarecalledyeah.fui","/public/data/instruments/furnace/TODO/FDS-overfuckingholyshitdriven-guitar.fui","/public/data/instruments/furnace/TODO/FDS-slapassbass.fui","/public/data/instruments/furnace/VERA/0-2-5_arp_lead.fui","/public/data/instruments/furnace/VERA/0-3-5_arp_lead.fui","/public/data/instruments/furnace/VERA/Noise_Kick.fui","/public/data/instruments/furnace/VERA/Noise_Snare.fui","/public/data/instruments/furnace/VIC/kick.fui","/public/data/samples/packs/casio-mt40/leads/accordion.wav","/public/data/samples/packs/casio-mt40/leads/banjo.wav","/public/data/samples/packs/casio-mt40/leads/bass.wav","/public/data/samples/packs/casio-mt40/leads/brass.wav","/public/data/samples/packs/casio-mt40/leads/celesta.wav","/public/data/samples/packs/casio-mt40/leads/cello.wav","/public/data/samples/packs/casio-mt40/leads/clarinet.wav","/public/data/samples/packs/casio-mt40/leads/elec piano.wav","/public/data/samples/packs/casio-mt40/leads/flute.wav","/public/data/samples/packs/casio-mt40/leads/folk flute.wav","/public/data/samples/packs/casio-mt40/leads/funny fuzz.wav","/public/data/samples/packs/casio-mt40/leads/glocken.wav","/public/data/samples/packs/casio-mt40/leads/guitar.wav","/public/data/samples/packs/casio-mt40/leads/harpsichord.wav","/public/data/samples/packs/casio-mt40/leads/organ.wav","/public/data/samples/packs/casio-mt40/leads/oriental.wav","/public/data/samples/packs/casio-mt40/leads/pipe-organ.wav","/public/data/samples/packs/casio-mt40/leads/recorder.wav","/public/data/samples/packs/casio-mt40/leads/st ensemble.wav","/public/data/samples/packs/casio-mt40/leads/synth fuzz.wav","/public/data/samples/packs/casio-mt40/leads/trumpet.wav","/public/data/samples/packs/casio-mt40/leads/violin.wav","/public/data/samples/packs/casio-mt40/leads/xylophone.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX1.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX2.wav","/public/data/samples/packs/drumnibus/fx/FX_Blarper.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst3.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst1.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Chainmalz.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap2.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap3.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia2.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx1.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx3.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman2.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm1.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiElastiek.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSnip.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSpring.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni1.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni2.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni3.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sloiz.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon1.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon2.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3B.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon5.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum1.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum3.wav","/public/data/samples/packs/drumnibus/fx/FX_Timpio.wav","/public/data/samples/packs/drumnibus/hihats/CH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/CH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/CH_Fantio_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Filtix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/CH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rezmatix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/CH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CH_Sizzel_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Synthique.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogOpenhatwav.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogVeryLongHat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/OH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/OH_Drumaxia.wav","/public/data/samples/packs/drumnibus/hihats/OH_Fantio_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Filtix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/OH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/OH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat_Long.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/OH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/OH_Sizzel_Open_Hat.wav","/public/data/samples/packs/drumnibus/kicks/BB_Electro1short.wav","/public/data/samples/packs/drumnibus/kicks/BD_808A1200.wav","/public/data/samples/packs/drumnibus/kicks/BD_DiggerLong.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digidap.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digimozzy.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dikkie.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dome_Long.wav","/public/data/samples/packs/drumnibus/kicks/BD_Drumaxia.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam1.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav","/public/data/samples/packs/drumnibus/kicks/BD_Juxtapos.wav","/public/data/samples/packs/drumnibus/kicks/BD_Lite2021.wav","/public/data/samples/packs/drumnibus/kicks/BD_LofiHuman.wav","/public/data/samples/packs/drumnibus/kicks/BD_Losamplix.wav","/public/data/samples/packs/drumnibus/kicks/BD_Magnotron..wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Plastiklog.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pufsub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchtron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchysplur.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pziforze.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ritmo.wav","/public/data/samples/packs/drumnibus/kicks/BD_Romkick1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Rubydub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ruflex.wav","/public/data/samples/packs/drumnibus/kicks/BD_Simpletron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Springworth.wav","/public/data/samples/packs/drumnibus/kicks/BD_Spriverbion.wav","/public/data/samples/packs/drumnibus/kicks/BD_Stuf.wav","/public/data/samples/packs/drumnibus/kicks/BD_SubThud.wav","/public/data/samples/packs/drumnibus/kicks/BD_Zistort.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Darkgong.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Filterbell.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal2.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal3.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox2.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Singalique.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Syntheticblox.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Lowpark.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/COW_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Chewy1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Digidap.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Drumaxia.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_R900.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix3.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Losimple.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker1.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker2.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker3.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_Ritmo.wav","/public/data/samples/packs/drumnibus/percussion/SNAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TABLA_Mamba.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_Tamb&Shaker.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake1.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake2.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmoHi.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92high.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Druimaxia.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TOM_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Osciaz.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Stofelectro1.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom2.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Warped.wav","/public/data/samples/packs/drumnibus/percussion/TOM_digger.wav","/public/data/samples/packs/drumnibus/snares/SD_808A1200.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_2.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_4.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_5.wav","/public/data/samples/packs/drumnibus/snares/SD_CompuCrunchy.wav","/public/data/samples/packs/drumnibus/snares/SD_Digidap.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis1.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis2.wav","/public/data/samples/packs/drumnibus/snares/SD_Drumaxia.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram1.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram2.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram3.wav","/public/data/samples/packs/drumnibus/snares/SD_Hark.wav","/public/data/samples/packs/drumnibus/snares/SD_Juxtapos.wav","/public/data/samples/packs/drumnibus/snares/SD_Kitcatlitter.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_1.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_2.wav","/public/data/samples/packs/drumnibus/snares/SD_LofiHuman.wav","/public/data/samples/packs/drumnibus/snares/SD_Magnotron.wav","/public/data/samples/packs/drumnibus/snares/SD_Mamba.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare2.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnare.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareLazer.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareWhip.wav","/public/data/samples/packs/drumnibus/snares/SD_Punchtron..wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz1.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz2.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz3.wav","/public/data/samples/packs/drumnibus/snares/SD_Ritmo.wav","/public/data/samples/packs/drumnibus/snares/SD_Rubydubwav.wav","/public/data/samples/packs/drumnibus/snares/SD_Ruflex.wav","/public/data/samples/packs/drumnibus/snares/SD_Strakker.wav","/public/data/samples/packs/drumnibus/snares/SD_Turbosound.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf1.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf2.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_3.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_5.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_6.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_7.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_8.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_9.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolfsweep1.wav","/public/data/samples/packs/drumnibus/snares/SD_electro7000.wav","/public/data/samples/tr505/tr505-clap.wav","/public/data/samples/tr505/tr505-conga-h.wav","/public/data/samples/tr505/tr505-conga-l.wav","/public/data/samples/tr505/tr505-cowb-h.wav","/public/data/samples/tr505/tr505-cowb-l.wav","/public/data/samples/tr505/tr505-crash.wav","/public/data/samples/tr505/tr505-hihat-closed.wav","/public/data/samples/tr505/tr505-hihat-open.wav","/public/data/samples/tr505/tr505-kick.wav","/public/data/samples/tr505/tr505-ride.wav","/public/data/samples/tr505/tr505-rim.wav","/public/data/samples/tr505/tr505-snare.wav","/public/data/samples/tr505/tr505-timbal.wav","/public/data/samples/tr505/tr505-tom-h.wav","/public/data/samples/tr505/tr505-tom-l.wav","/public/data/samples/tr505/tr505-tom-m.wav","/public/data/samples/tr707/tr707-clap.wav","/public/data/samples/tr707/tr707-cowbell.wav","/public/data/samples/tr707/tr707-crash.wav","/public/data/samples/tr707/tr707-hihat-closed.wav","/public/data/samples/tr707/tr707-hihat-open.wav","/public/data/samples/tr707/tr707-kick-rumble.wav","/public/data/samples/tr707/tr707-kick.wav","/public/data/samples/tr707/tr707-ride.wav","/public/data/samples/tr707/tr707-rim.wav","/public/data/samples/tr707/tr707-snare.wav","/public/data/samples/tr707/tr707-tambourine.wav","/public/data/samples/tr707/tr707-tom-h.wav","/public/data/samples/tr707/tr707-tom-l-rumble.wav","/public/data/samples/tr707/tr707-tom-l.wav","/public/data/samples/tr707/tr707-tom-m.wav","/public/data/songs/303-feature-test.dbx","/public/data/songs/acid-bassline.xml","/public/data/songs/acid-core.dbx","/public/data/songs/christophe-just-i-m-a-disco-dancer-part-1-.dbx","/public/data/songs/christophe-just-i-m-a-disco-dancer-part-2-.dbx","/public/data/songs/classic-303.xml","/public/data/songs/claustrophobic-sting-the-prodigy.dbx","/public/data/songs/comprehensive-feature-test.dbx","/public/data/songs/cut-paste-forget-it-part-1-.dbx","/public/data/songs/db303-default-pattern.xml","/public/data/songs/db303-default-preset.xml","/public/data/songs/deep-house.dbx","/public/data/songs/dittytoy-303.dbx","/public/data/songs/dj-tim-misjah-access.dbx","/public/data/songs/edge-of-motion-setup-707.dbx","/public/data/songs/fast-eddie-acid-thunder.dbx","/public/data/songs/fatboy-slim-everybody-needs-a-303.dbx","/public/data/songs/fatboy-slim-everyone-needs-303_.dbx","/public/data/songs/furnace/a2600/Balmeranda.fur","/public/data/songs/furnace/a2600/Funky_Afternoon.fur","/public/data/songs/furnace/a2600/Slam_the_Door.fur","/public/data/songs/furnace/a2600/Watch My Tone.fur","/public/data/songs/furnace/a2600/morepain.fur","/public/data/songs/furnace/a2600/twin.fur","/public/data/songs/furnace/amiga/Ibiza.fur","/public/data/songs/furnace/amiga/a_wave_powerhouse.fur","/public/data/songs/furnace/amiga/bruno_time.fur","/public/data/songs/furnace/amiga/m7 vibe.fur","/public/data/songs/furnace/amiga/serendipid.fur","/public/data/songs/furnace/arcade/Changsha_DnB_Inferno_NamcoNA1.fur","/public/data/songs/furnace/arcade/Crystal Dimension Section 2 WSG Mix.fur","/public/data/songs/furnace/arcade/Destiny_Islands_Irem_M92.fur","/public/data/songs/furnace/arcade/Eternal_Forest_TaitoArcade.fur","/public/data/songs/furnace/arcade/Grape_Jelly_Alpha5232.fur","/public/data/songs/furnace/arcade/Hexionology.fur","/public/data/songs/furnace/arcade/Ice_Wind_SegaPCM.fur","/public/data/songs/furnace/arcade/JoyfulStart_Seta.fur","/public/data/songs/furnace/arcade/Mars_Bar_On_Mars_NamcoWSG.fur","/public/data/songs/furnace/arcade/Maximum_Overdrive_NamcoWSG.fur","/public/data/songs/furnace/arcade/Phoenix_cover_NamcoWSG.fur","/public/data/songs/furnace/arcade/Physics_Exam_TaitoArcade.fur","/public/data/songs/furnace/arcade/Point_of_No_Return_SegaPCM.fur","/public/data/songs/furnace/arcade/QSound_smile.fur","/public/data/songs/furnace/arcade/REPROGRAMMED.fur","/public/data/songs/furnace/arcade/SHIN_YA.fur","/public/data/songs/furnace/arcade/Salamander_Starfield.fur","/public/data/songs/furnace/arcade/Slow Brew.fur","/public/data/songs/furnace/arcade/Some_Creatures_SegaPCM.fur","/public/data/songs/furnace/arcade/The_Good_Times_SegaPCM.fur","/public/data/songs/furnace/arcade/ToHeart_QoH98_TPower_Asuka120Style.fur","/public/data/songs/furnace/arcade/Tubelectric_Fictional_Arcade.fur","/public/data/songs/furnace/arcade/U.N. Owen Was Her (NS2).fur","/public/data/songs/furnace/arcade/UT99_Run_TaitoArcade.fur","/public/data/songs/furnace/arcade/WSG_Loop_Tune_NamcoWSG.fur","/public/data/songs/furnace/arcade/eek_qsound.fur","/public/data/songs/furnace/arcade/ice_cap_NamcoC30.fur","/public/data/songs/furnace/arcade/last_day_of_summer_NamcoC15.fur","/public/data/songs/furnace/arcade/living crystal cave.fur","/public/data/songs/furnace/arcade/the_machines_are_socialising_SegaPCM.fur","/public/data/songs/furnace/arcade/trance_TaitoArcade.fur","/public/data/songs/furnace/ay8910/AY-3-8910_Jam.fur","/public/data/songs/furnace/ay8910/AyMate.fur","/public/data/songs/furnace/ay8910/Drifting in Colour.fur","/public/data/songs/furnace/ay8910/Flat Wave Society.fur","/public/data/songs/furnace/ay8910/Second_Addition.fur","/public/data/songs/furnace/ay8910/cardboardmywater.fur","/public/data/songs/furnace/ay8910/demoscenetypebeat.fur","/public/data/songs/furnace/ay8910/remark_music.fur","/public/data/songs/furnace/ay8910/vibe_zone.fur","/public/data/songs/furnace/ay8930/AY8930Shuffle.fur","/public/data/songs/furnace/ay8930/Obscure_Temptation.fur","/public/data/songs/furnace/ay8930/One_Minute_Waltz.fur","/public/data/songs/furnace/ay8930/Playing_On_The_Stairs.fur","/public/data/songs/furnace/ay8930/Red_Planet.fur","/public/data/songs/furnace/ay8930/duty fun.fur","/public/data/songs/furnace/ay8930/joyful.fur","/public/data/songs/furnace/ay8930/powerful-sample-generator.fur","/public/data/songs/furnace/blank/5 AM Sunrise.fur","/public/data/songs/furnace/blank/Electric Blanket.fur","/public/data/songs/furnace/blank/Electrical Inteference.fur","/public/data/songs/furnace/blank/Empty Aquatic.fur","/public/data/songs/furnace/blank/Exquisite Invitation.fur","/public/data/songs/furnace/blank/For the 19 bonus points NES DPCM only.fur","/public/data/songs/furnace/blank/Planet Zero-Algorima.fur","/public/data/songs/furnace/blank/SURVIVE.fur","/public/data/songs/furnace/blank/Super_Instrumentless_Echo_Synth_Demonstration.fur","/public/data/songs/furnace/blank/The Emptyness.fur","/public/data/songs/furnace/blank/WHERE DID I PUT IT.fur","/public/data/songs/furnace/blank/Wandering.fur","/public/data/songs/furnace/blank/emotional_blackmail.fur","/public/data/songs/furnace/blank/enterthering.fur","/public/data/songs/furnace/blank/hope_in_a_time_of_monsters.fur","/public/data/songs/furnace/blank/map01.fur","/public/data/songs/furnace/blank/samba_do_SID.fur","/public/data/songs/furnace/blank/sawvibes.fur","/public/data/songs/furnace/blank/they dont know im empty inside.fur","/public/data/songs/furnace/blank/waytoohard.fur","/public/data/songs/furnace/c64/C64 junk.fur","/public/data/songs/furnace/c64/ChaosTune.fur","/public/data/songs/furnace/c64/FairlightC64.fur","/public/data/songs/furnace/c64/Hellcharger.fur","/public/data/songs/furnace/c64/LowBeatz.fur","/public/data/songs/furnace/c64/PICOHOTCREDITS.fur","/public/data/songs/furnace/c64/deadlock.fur","/public/data/songs/furnace/c64/yeah!.fur","/public/data/songs/furnace/esfm/AAAA.fur","/public/data/songs/furnace/esfm/ALCATRAZ_ALWAYS.fur","/public/data/songs/furnace/esfm/CampingJourney.fur","/public/data/songs/furnace/esfm/Deadline.fur","/public/data/songs/furnace/esfm/Devil_Detective.fur","/public/data/songs/furnace/esfm/EdgeRunning_2078.fur","/public/data/songs/furnace/esfm/Fighting_the_Dimensions_Big_Bad_Because_its_Fun.fur","/public/data/songs/furnace/esfm/I_Cant_Escape_Your_Memory.fur","/public/data/songs/furnace/esfm/Just_me_and_my_Brain.fur","/public/data/songs/furnace/esfm/Ken_Stage.fur","/public/data/songs/furnace/esfm/Magician_Lake_Cover.fur","/public/data/songs/furnace/esfm/Napalm-Loader.fur","/public/data/songs/furnace/esfm/Perilous059.fur","/public/data/songs/furnace/esfm/Poets_I.fur","/public/data/songs/furnace/esfm/Redial.fur","/public/data/songs/furnace/esfm/SearchPrincess.fur","/public/data/songs/furnace/esfm/Second_Start.fur","/public/data/songs/furnace/esfm/Strange_Sunset.fur","/public/data/songs/furnace/esfm/Tangent_to_a_Segue.fur","/public/data/songs/furnace/esfm/TheOneWayFuture.fur","/public/data/songs/furnace/esfm/Unconscious_Unravelling.fur","/public/data/songs/furnace/esfm/Unknown_Location.fur","/public/data/songs/furnace/esfm/WalkInThePark.fur","/public/data/songs/furnace/esfm/WindFjordsESFM.fur","/public/data/songs/furnace/esfm/act_of_fighter.fur","/public/data/songs/furnace/esfm/cielos_esfumados.fur","/public/data/songs/furnace/esfm/experiment.fur","/public/data/songs/furnace/esfm/flashback.fur","/public/data/songs/furnace/esfm/frosty_dusk.fur","/public/data/songs/furnace/esfm/haunted_castle.fur","/public/data/songs/furnace/esfm/her_wishes.fur","/public/data/songs/furnace/esfm/ledstorm.fur","/public/data/songs/furnace/esfm/loneguitarist.fur","/public/data/songs/furnace/esfm/moon_closedspace.fur","/public/data/songs/furnace/esfm/pcbend.fur","/public/data/songs/furnace/esfm/sticker1.fur","/public/data/songs/furnace/esfm/synthy.fur","/public/data/songs/furnace/esfm/wack.fur","/public/data/songs/furnace/esfm/x_evil_soul.fur","/public/data/songs/furnace/gameboy/GB_WaitForMe.fur","/public/data/songs/furnace/gameboy/On_Hold.fur","/public/data/songs/furnace/gameboy/Pleasure_of_Tension.fur","/public/data/songs/furnace/gameboy/You\'re_Doing_Well!.fur","/public/data/songs/furnace/gameboy/cheap.fur","/public/data/songs/furnace/gameboy/contested.fur","/public/data/songs/furnace/gameboy/dancing_to_the_death.fur","/public/data/songs/furnace/gameboy/finger.fur","/public/data/songs/furnace/gameboy/lagtrain.fur","/public/data/songs/furnace/gameboy/minos.fur","/public/data/songs/furnace/gameboy/puggs_in_space.fur","/public/data/songs/furnace/gameboy/snowdin.fur","/public/data/songs/furnace/gameboy/spreadtro.fur","/public/data/songs/furnace/genesis/All Good Times.fur","/public/data/songs/furnace/genesis/ChocolateFactory.fur","/public/data/songs/furnace/genesis/Electric Keet - Imperfectionist.fur","/public/data/songs/furnace/genesis/Equinox Intro.fur","/public/data/songs/furnace/genesis/Fancy_Promenard.fur","/public/data/songs/furnace/genesis/Kobito_of_the_Shining_Needle.fur","/public/data/songs/furnace/genesis/MegadriveOverdrive.fur","/public/data/songs/furnace/genesis/Plok_Beach.fur","/public/data/songs/furnace/genesis/Puyopuyo~n_DopplegangerArle-TsuuStyle.fur","/public/data/songs/furnace/genesis/RaveOfDoom.fur","/public/data/songs/furnace/genesis/RubyIllusions_Genesis.fur","/public/data/songs/furnace/genesis/Shovel_Knight_Title.fur","/public/data/songs/furnace/genesis/Solar_Man.fur","/public/data/songs/furnace/genesis/SpareHalloween2.fur","/public/data/songs/furnace/genesis/Stereotactics_Rewritten.fur","/public/data/songs/furnace/genesis/darkstar.fur","/public/data/songs/furnace/genesis/djtBMX_zweitrigger_bluesky_badfmmix.fur","/public/data/songs/furnace/genesis/eternallydoomedtogroove.fur","/public/data/songs/furnace/genesis/flatulence mountain\'s fm orchestra.fur","/public/data/songs/furnace/genesis/golden_shit.fur","/public/data/songs/furnace/genesis/highscorefollin.fur","/public/data/songs/furnace/genesis/imaginarium.fur","/public/data/songs/furnace/genesis/mm5_boss.fur","/public/data/songs/furnace/genesis/newer_song_lol.fur","/public/data/songs/furnace/genesis/notime.fur","/public/data/songs/furnace/genesis/shiningcrystal_cave.fur","/public/data/songs/furnace/genesis/the_serenity_of_lonliness.fur","/public/data/songs/furnace/genesis/waterfall.fur","/public/data/songs/furnace/genesis/wwfrtw_credits_arrange.fur","/public/data/songs/furnace/lynx/LedStorm.fur","/public/data/songs/furnace/lynx/Road_Rash_Grass_Valley.fur","/public/data/songs/furnace/lynx/Tyrian-Camanis.fur","/public/data/songs/furnace/lynx/chippylotus.fur","/public/data/songs/furnace/lynx/insert_title_here.fur","/public/data/songs/furnace/misc/Back_In_Detroit_Supervision.fur","/public/data/songs/furnace/misc/CORRUPT.FUR","/public/data/songs/furnace/misc/Dreamliner_FMTowns.fur","/public/data/songs/furnace/misc/FiveTwoThreeTwo_MSM5232.fur","/public/data/songs/furnace/misc/Fly_to_the_Sky_Sharp_X1.fur","/public/data/songs/furnace/misc/Galactic_Melody_PowerNoise.fur","/public/data/songs/furnace/misc/GreenIdeas_PET.fur","/public/data/songs/furnace/misc/Inner Machinations YM2610B.fur","/public/data/songs/furnace/misc/IntoTheLight_CapcomQSound.fur","/public/data/songs/furnace/misc/Miami_Ice_Sharp_X1.fur","/public/data/songs/furnace/misc/Playground_2xT6W28.fur","/public/data/songs/furnace/misc/Someting_I_can_feel_MSM5232.fur","/public/data/songs/furnace/misc/Special Stage Sonic 3 (GBA).fur","/public/data/songs/furnace/misc/SplittersGroove_bifurcator.fur","/public/data/songs/furnace/misc/StrobesPowerNoise.fur","/public/data/songs/furnace/misc/T_Six_T6W28.fur","/public/data/songs/furnace/misc/TerminalZone_SM8521.fur","/public/data/songs/furnace/misc/Weightlessness_ES5506.fur","/public/data/songs/furnace/misc/Yellow_Desert_bifurcator.fur","/public/data/songs/furnace/misc/ZX Extinction Sequence.fur","/public/data/songs/furnace/misc/ZetaForceLevel2.fur","/public/data/songs/furnace/misc/beeper_torture.fur","/public/data/songs/furnace/misc/biffy_bifurcator.fur","/public/data/songs/furnace/misc/combat_vehicle_pokey.fur","/public/data/songs/furnace/misc/cutbluetape_PV1000.fur","/public/data/songs/furnace/misc/david.fur","/public/data/songs/furnace/misc/deepmist_dave.fur","/public/data/songs/furnace/misc/feeding_my_pet_peeve_PV1000.fur","/public/data/songs/furnace/misc/firetrucking_PV1000.fur","/public/data/songs/furnace/misc/fragments_turbosound.fur","/public/data/songs/furnace/misc/fursuits_for_the_suspiciously_rich_MSM5232.fur","/public/data/songs/furnace/misc/hittingtherevlimiter_RF5C68.fur","/public/data/songs/furnace/misc/horizon_beyond_gba.fur","/public/data/songs/furnace/misc/mainframe_pokemini.fur","/public/data/songs/furnace/misc/meaningful_connection_es5506.fur","/public/data/songs/furnace/misc/midnight_freeze_bifurcator.fur","/public/data/songs/furnace/misc/mushroomhill_SM8521.fur","/public/data/songs/furnace/misc/nails_PV1000.fur","/public/data/songs/furnace/misc/navi_clash_GBA.fur","/public/data/songs/furnace/misc/pseudogba_pwaa_godot.fur","/public/data/songs/furnace/misc/sawmen_break_SM8521.fur","/public/data/songs/furnace/misc/space_mackerel_bifurcator.fur","/public/data/songs/furnace/misc/sparkling_aria_pokemini.fur","/public/data/songs/furnace/misc/spite_is_the_best_motivator_PV1000.fur","/public/data/songs/furnace/misc/sucked_something_zx.fur","/public/data/songs/furnace/misc/tech_low_qual_era_RF5C68.fur","/public/data/songs/furnace/misc/teddy_bear_midnight_jam_ted.fur","/public/data/songs/furnace/misc/teknofurcator.fur","/public/data/songs/furnace/misc/this_is_kind_of_better_PV1000.fur","/public/data/songs/furnace/misc/walkontheroof_T6W28.fur","/public/data/songs/furnace/msx/2024 BOTB MSX-MUSIC GRINDCORE LIVE ON STAGE (MSX-MUSIC).fur","/public/data/songs/furnace/msx/21492413.fur","/public/data/songs/furnace/msx/BREEZE_SENSATION.fur","/public/data/songs/furnace/msx/Gyruss_Stage_2.fur","/public/data/songs/furnace/msx/Juice_Stand.fur","/public/data/songs/furnace/msx/Morning_Alarm.fur","/public/data/songs/furnace/msx/Nemesis2AirBattle.fur","/public/data/songs/furnace/msx/OPLL_High_and_Rising.fur","/public/data/songs/furnace/msx/OPLL_OperationPleaseLeaveLeave.fur","/public/data/songs/furnace/msx/Port Sun.fur","/public/data/songs/furnace/msx/Princess_of_the_Dead.fur","/public/data/songs/furnace/msx/Striking_Towards_Opposition.fur","/public/data/songs/furnace/multichip/1_bit_bros.fur","/public/data/songs/furnace/multichip/Between_the_Circuits.fur","/public/data/songs/furnace/multichip/CR_yasui_cs.fur","/public/data/songs/furnace/multichip/Chip_Duel_AY-3-8910+SN76489.fur","/public/data/songs/furnace/multichip/Cossack Stage Boss.fur","/public/data/songs/furnace/multichip/Entry_2xSID3+ES5506.fur","/public/data/songs/furnace/multichip/FamiMega Aliance.fur","/public/data/songs/furnace/multichip/Fantasy_Chip_Christmas.fur","/public/data/songs/furnace/multichip/Fight Against the Dark Matter.fur","/public/data/songs/furnace/multichip/Furnace-tan VS the spirit of the Mask.fur","/public/data/songs/furnace/multichip/Fusion.fur","/public/data/songs/furnace/multichip/HoldOn.fur","/public/data/songs/furnace/multichip/Jet_Pack_Adventure_GBAesque.fur","/public/data/songs/furnace/multichip/MegaMari-Cirno.fur","/public/data/songs/furnace/multichip/Melancholy_Girl_multichip.fur","/public/data/songs/furnace/multichip/MetalSlug_BaseCamp_SMS_TIA.fur","/public/data/songs/furnace/multichip/Namco_C30_C219_Loop.fur","/public/data/songs/furnace/multichip/OPL3_SegaPCM_Xeno_Crisis_-_Facility_Area_2.fur","/public/data/songs/furnace/multichip/PinBot-C30C140.fur","/public/data/songs/furnace/multichip/Sunset Hill Zone Act 2.fur","/public/data/songs/furnace/multichip/TheOnlyWayIsForward.fur","/public/data/songs/furnace/multichip/WakeUpAndDance_MMC5_SM8521.fur","/public/data/songs/furnace/multichip/all_old_zero_new.fur","/public/data/songs/furnace/multichip/collab.fur","/public/data/songs/furnace/multichip/cueball.fur","/public/data/songs/furnace/multichip/double-dragon-stage1.fur","/public/data/songs/furnace/multichip/government funding breakcore-ish remix.fur","/public/data/songs/furnace/multichip/invicibility_mmc5_n163_fds.fur","/public/data/songs/furnace/multichip/meteor_shower.fur","/public/data/songs/furnace/multichip/one.fur","/public/data/songs/furnace/multichip/pont of noreturn.fur","/public/data/songs/furnace/multichip/ridiculous_game.fur","/public/data/songs/furnace/multichip/satellite_interconnects.fur","/public/data/songs/furnace/multichip/second_dimension_demo.fur","/public/data/songs/furnace/multichip/silverlining.fur","/public/data/songs/furnace/multichip/skate_or_die.fur","/public/data/songs/furnace/multichip/splashingwater.fur","/public/data/songs/furnace/multichip/steak.fur","/public/data/songs/furnace/multichip/sunlight.fur","/public/data/songs/furnace/multichip/super_fantasy_zone_mango.fur","/public/data/songs/furnace/multichip/the tempest\'s melody.fur","/public/data/songs/furnace/multichip/track8_n163_k053260.fur","/public/data/songs/furnace/multichip/urgency.fur","/public/data/songs/furnace/nes/Byte-Sized Bop.fur","/public/data/songs/furnace/nes/Famitune1.fur","/public/data/songs/furnace/nes/Fur_Nes.fur","/public/data/songs/furnace/nes/Future_Re-ference.fur","/public/data/songs/furnace/nes/Rise_against_the_ashes_to_the_new_dawn.fur","/public/data/songs/furnace/nes/Sky Sanctuary Zone.fur","/public/data/songs/furnace/nes/Super cool and awesome samurai.fur","/public/data/songs/furnace/nes/Super_Space_Invaders_Title.fur","/public/data/songs/furnace/nes/The Cheetahmen.fur","/public/data/songs/furnace/nes/The East.fur","/public/data/songs/furnace/nes/blanketcritter release ver.fur","/public/data/songs/furnace/nes/carve_your_own_path.fur","/public/data/songs/furnace/nes/christmas-fever.fur","/public/data/songs/furnace/nes/going_up_a_step_at_time.fur","/public/data/songs/furnace/nes/infinity.fur","/public/data/songs/furnace/nes/oby1_ingame.fur","/public/data/songs/furnace/nes/one_sided_love.fur","/public/data/songs/furnace/nes/smashtv.fur","/public/data/songs/furnace/nes/sweatsmile_bossfight.fur","/public/data/songs/furnace/nes/the_best-1990.fur","/public/data/songs/furnace/nes/turtle_byte.fur","/public/data/songs/furnace/opl/Air_Combat_Over_the_Vast_Mountain.fur","/public/data/songs/furnace/opl/Contraduct Design OPL3 Cover.fur","/public/data/songs/furnace/opl/Egyptian_Rule.fur","/public/data/songs/furnace/opl/Memories_of_Triumph.fur","/public/data/songs/furnace/opl/Midnight_Dog_Orchestra.fur","/public/data/songs/furnace/opl/Moon.fur","/public/data/songs/furnace/opl/Oh no, more sine waves.fur","/public/data/songs/furnace/opl/One_Sided_Love_Again.fur","/public/data/songs/furnace/opl/Perpetual_Motion.fur","/public/data/songs/furnace/opl/PhantomBreakerBattleGrounds_ShinjukuStage-OPL3.fur","/public/data/songs/furnace/opl/Sliding_on_a_Rainbow.fur","/public/data/songs/furnace/opl/TeamInnocent-BGM4-OPL3Plus.fur","/public/data/songs/furnace/opl/Time_Is_Lost_OPL4.fur","/public/data/songs/furnace/opl/Waterworld_-_Map.fur","/public/data/songs/furnace/opl/femteknyl.fur","/public/data/songs/furnace/opl/fight and flight.fur","/public/data/songs/furnace/opl/green_biker_dude_opl.fur","/public/data/songs/furnace/opl/home_wfl_opl3.fur","/public/data/songs/furnace/opl/rain.cloud.sunset.fur","/public/data/songs/furnace/opl/the_foggy_cave_in_the_darkness.fur","/public/data/songs/furnace/opm/hope_for_the_dream.fur","/public/data/songs/furnace/opm/lagrange_point_2023.fur","/public/data/songs/furnace/opm/the_king_of_crisp.fur","/public/data/songs/furnace/opm/vortex.fur","/public/data/songs/furnace/opm/waterworld_map.fur","/public/data/songs/furnace/opz/\'90 lost media.fur","/public/data/songs/furnace/opz/Clashing Angels.fur","/public/data/songs/furnace/opz/Fly to the Leaden Sky.fur","/public/data/songs/furnace/opz/Glacier BM0.fur","/public/data/songs/furnace/opz/The Hedgehog Knows One Thing.fur","/public/data/songs/furnace/opz/The bongos and teh base OPZx2.fur","/public/data/songs/furnace/opz/boost.fur","/public/data/songs/furnace/opz/goodbye my dreams.fur","/public/data/songs/furnace/opz/massive_x_opz.fur","/public/data/songs/furnace/opz/myst_grove.fur","/public/data/songs/furnace/opz/only_dream_opz.fur","/public/data/songs/furnace/opz/sea of crises.fur","/public/data/songs/furnace/pc98/Blue_Nebula.fur","/public/data/songs/furnace/pc98/CT_maintheme.fur","/public/data/songs/furnace/pc98/Counterattack.fur","/public/data/songs/furnace/pc98/atomic_failure.fur","/public/data/songs/furnace/pce/Contest thing 2025.fur","/public/data/songs/furnace/pce/Fake Gameboy.fur","/public/data/songs/furnace/pce/Final_Fight_Metro_City_Slums.fur","/public/data/songs/furnace/pce/Ma-Da-Ra.fur","/public/data/songs/furnace/pce/Peace.fur","/public/data/songs/furnace/pce/Processing Plant 2025 Edit.fur","/public/data/songs/furnace/pce/Warpdrive_Engage.fur","/public/data/songs/furnace/pce/continuity_error.fur","/public/data/songs/furnace/pce/fd_PCB.fur","/public/data/songs/furnace/pce/pcengineasdmo.fur","/public/data/songs/furnace/quickstart.fur","/public/data/songs/furnace/sn7/456nm_TI994A.fur","/public/data/songs/furnace/sn7/FlowOfSN7.fur","/public/data/songs/furnace/sn7/Last Frecuency System.fur","/public/data/songs/furnace/sn7/Night_Market_TI994A.fur","/public/data/songs/furnace/sn7/Protaras.fur","/public/data/songs/furnace/sn7/Tidal_Tempest_Zone.fur","/public/data/songs/furnace/sn7/Updraft Flight.fur","/public/data/songs/furnace/sn7/doorintosummer.fur","/public/data/songs/furnace/sn7/gg_silver_surfer_st1.fur","/public/data/songs/furnace/sn7/gg_soniccd_collision_chaos.fur","/public/data/songs/furnace/sn7/thunderblade-type-ii.fur","/public/data/songs/furnace/snes/64kb.fur","/public/data/songs/furnace/snes/Breezy.fur","/public/data/songs/furnace/snes/Cosmic_Warehouse.fur","/public/data/songs/furnace/snes/Dear Blue SNES.fur","/public/data/songs/furnace/snes/IMU Caf.fur","/public/data/songs/furnace/snes/MM8_Frost_Man.fur","/public/data/songs/furnace/snes/ManbowSMW.fur","/public/data/songs/furnace/snes/Sadness.fur","/public/data/songs/furnace/snes/Sunken Lights.fur","/public/data/songs/furnace/snes/Unreal_Something_SNES.fur","/public/data/songs/furnace/snes/XCDunes_SNES.fur","/public/data/songs/furnace/snes/XCHQ_SPC700.fur","/public/data/songs/furnace/snes/amalgam.fur","/public/data/songs/furnace/snes/analog.fur","/public/data/songs/furnace/snes/aurora.fur","/public/data/songs/furnace/snes/changeyourheart.fur","/public/data/songs/furnace/snes/encjslt.fur","/public/data/songs/furnace/snes/segacd.fur","/public/data/songs/furnace/snes/sound processing unit.fur","/public/data/songs/furnace/snes/spd10.fur","/public/data/songs/furnace/snes/spd24.fur","/public/data/songs/furnace/snes/tetristheme.fur","/public/data/songs/furnace/snes/time_of_the_dreamwatch.fur","/public/data/songs/furnace/snes/very chill snes.fur","/public/data/songs/furnace/snes/wonders_of_synthia.fur","/public/data/songs/furnace/specs2/Tim_Follin.fur","/public/data/songs/furnace/specs2/acidic_juice_of_hell.fur","/public/data/songs/furnace/specs2/atmosphere.fur","/public/data/songs/furnace/specs2/back_into_adventure.fur","/public/data/songs/furnace/specs2/object.fur","/public/data/songs/furnace/specs2/rastaline_dub.fur","/public/data/songs/furnace/specs2/spa.fur","/public/data/songs/furnace/specs2/thick bass test.fur","/public/data/songs/furnace/vic20/BlueBolt.fur","/public/data/songs/furnace/vic20/h.fur","/public/data/songs/furnace/virtualboy/4_dimensionnal_goddess_of_existance.fur","/public/data/songs/furnace/virtualboy/Cherry_Vertex.fur","/public/data/songs/furnace/virtualboy/Dimensional.fur","/public/data/songs/furnace/virtualboy/Double_Puzzle_Trouble.fur","/public/data/songs/furnace/virtualboy/DoublingDown.fur","/public/data/songs/furnace/virtualboy/God_Rest_Ye_Deadly_Gentlemen.fur","/public/data/songs/furnace/virtualboy/Iridion_3D_Stage_3.fur","/public/data/songs/furnace/virtualboy/LN2StreetLoader-VB.fur","/public/data/songs/furnace/virtualboy/La_Folia_ground_bass.fur","/public/data/songs/furnace/virtualboy/No_Such_Thing.fur","/public/data/songs/furnace/virtualboy/Professional_Beat.fur","/public/data/songs/furnace/virtualboy/Rave_Dancetune.fur","/public/data/songs/furnace/virtualboy/Red_And_Black_Orchid.fur","/public/data/songs/furnace/virtualboy/Red_Revolver.fur","/public/data/songs/furnace/virtualboy/Redworld.fur","/public/data/songs/furnace/virtualboy/Scarlet_Horizons.fur","/public/data/songs/furnace/virtualboy/SeeingRed.fur","/public/data/songs/furnace/virtualboy/StuckTerminologyRealVB.fur","/public/data/songs/furnace/virtualboy/Virtual_Promises.fur","/public/data/songs/furnace/virtualboy/air_fight.fur","/public/data/songs/furnace/virtualboy/blueseed.fur","/public/data/songs/furnace/virtualboy/devil_crash.fur","/public/data/songs/furnace/virtualboy/eek.fur","/public/data/songs/furnace/virtualboy/ghx_melodic.fur","/public/data/songs/furnace/virtualboy/groove_in_the_virtual_realm.fur","/public/data/songs/furnace/virtualboy/honeydippedkiwis.fur","/public/data/songs/furnace/virtualboy/lastninja-sewersloader.fur","/public/data/songs/furnace/virtualboy/mission_breafing.fur","/public/data/songs/furnace/virtualboy/needforspeed2semainmenu.fur","/public/data/songs/furnace/virtualboy/red_joke.fur","/public/data/songs/furnace/virtualboy/redboas.fur","/public/data/songs/furnace/virtualboy/redshift.fur","/public/data/songs/furnace/virtualboy/virtual_namachuukei_pennant_race.fur","/public/data/songs/furnace/wonderswan/Bullet_Hell.fur","/public/data/songs/furnace/wonderswan/Rusty_-_Queen_in_the_Dark_Night.fur","/public/data/songs/furnace/wonderswan/Space Station of Enormous Proportions.fur","/public/data/songs/furnace/wonderswan/TimeTrial.fur","/public/data/songs/furnace/wonderswan/sijofsjfsoeife.fur","/public/data/songs/furnace/wonderswan/thesign_ws.fur","/public/data/songs/furnace/x16/Cafe - 010 Editor 2.0kg.fur","/public/data/songs/furnace/x16/Exerion_II_Tune.fur","/public/data/songs/furnace/x16/Identity_Believer.fur","/public/data/songs/furnace/x16/Shades of Blue.fur","/public/data/songs/furnace/x16/TFV_Rise.fur","/public/data/songs/furnace/x16/dance with me.fur","/public/data/songs/furnace/x16/her11.fur","/public/data/songs/furnace/x16/keygen19.fur","/public/data/songs/furnace/x16/richca.fur","/public/data/songs/furnace/x16/watching_paint_dry.fur","/public/data/songs/furnace/x68000/LN2_Office_Loader.fur","/public/data/songs/furnace/x68000/Optimistic.fur","/public/data/songs/furnace/x68000/TimeMan.fur","/public/data/songs/furnace/x68000/Wicked_Express.fur","/public/data/songs/furnace/x68000/boomer.fur","/public/data/songs/furnace/ymz280b/evilevilsong.fur","/public/data/songs/furnace/ymz280b/notreallyfm.fur","/public/data/songs/hardfloor-funalogue.dbx","/public/data/songs/josh-wink-are-you-there.dbx","/public/data/songs/josh-wink-high-state-of-consciousness.dbx","/public/data/songs/josh-wink-higher-state.dbx","/public/data/songs/midi/Samplab_mathew.mid","/public/data/songs/midi/mathew.mid","/public/data/songs/midi/pattern07 (1).mid","/public/data/songs/midi/pattern07 (2).mid","/public/data/songs/midi/pattern07.mid","/public/data/songs/midi/pattern14 (1).mid","/public/data/songs/midi/pattern14.mid","/public/data/songs/midi/pattern19 (1).mid","/public/data/songs/midi/pattern19.mid","/public/data/songs/midi/pattern23 (1).mid","/public/data/songs/midi/pattern23 (2).mid","/public/data/songs/midi/pattern23.mid","/public/data/songs/mod/break the box.mod","/public/data/songs/modules.json","/public/data/songs/mr-oizo-flat-beat.dbx","/public/data/songs/new-order-confusion.dbx","/public/data/songs/paste-forget-it-part-2-.dbx","/public/data/songs/phuture-acid-tracks.dbx","/public/data/songs/public-energy-three-o-three-part-1-.dbx","/public/data/songs/public-energy-three-o-three-part-2-.dbx","/public/data/songs/sam-mary-lamb.dbx","/public/data/songs/samplab-mathew-303.dbx","/public/data/songs/samplab-mathew-full.dbx","/public/data/songs/sliding-sequence.xml","/public/data/songs/slow-creaky-acid-authentic.dbx","/public/data/songs/slow-creaky-acid-tempo-relative.dbx","/public/data/songs/speech-duet.dbx","/public/data/songs/test.xml","/public/data/songs/v2-twinkle-star.dbx"]'),TE="http://localhost:3001";function AE(){return Array.isArray(_E)&&_E.length>0}async function OE(e){const t=e.replace(/^\/+/,""),a=await fetch(`${TE}/api/files/${t}`);if(!a.ok)throw new Error(`Failed to read file: ${a.statusText}`);return a.arrayBuffer()}async function IE(e){const t=`/DEViLBOX/data/${e.replace(/^\/+/,"")}`,a=await fetch(t);if(!a.ok)throw new Error(`Failed to fetch static file: ${a.status} ${t}`);return a.arrayBuffer()}const DE=[".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx"],FE=[...DE,".sqs",".seq"];function RE(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return DE.includes(t)}const jE=({isOpen:e,onClose:t,onLoad:a,onLoadTrackerModule:n,mode:r,currentProjectData:i,suggestedFilename:o="untitled.dbx"})=>{const[l,c]=s.useState([]),[u,d]=s.useState(!1),[p,h]=s.useState(null),[m,f]=s.useState(null),[g,y]=s.useState(o),[b,v]=s.useState(!1),[x,w]=s.useState(!1),[k,S]=s.useState(""),[M,N]=s.useState(null);s.useEffect(()=>{e&&(()=>{const e=Vv(),t=NE()&&!!EE();v(e||t)})()},[e]);const C=s.useCallback(async()=>{d(!0),h(null);try{let t=[];if(Vv()&&window.electron?.fs){if(!M)return void d(!1);const e=M||k;if(e){t=(await window.electron.fs.readdir(e,[])).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),t.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}}else{if(!x){const e=await async function(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),a=await fetch(`${TE}/api/files/songs`,{method:"HEAD",signal:e.signal});return clearTimeout(t),a.ok}catch{return!1}}();w(e)}if(x)try{const e=k||"songs";t=(await async function(e){const t=e.replace(/^\/+/,""),a=await fetch(`${TE}/api/files/${t}`);if(!a.ok)throw new Error(`Failed to list directory: ${a.statusText}`);return(await a.json()).items||[]}(e)).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),t.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}catch(e){w(!1)}if(0===t.length&&AE()){const e=function(e){const t=e.replace(/^\/+/,"").replace(/\/+$/,""),a=new Set,n=[];for(const r of _E){const e=r.replace(/^\/public\/data\//,"");if(t&&!e.startsWith(t+"/"))continue;const s=t?e.slice(t.length+1):e;if(!s)continue;const i=s.indexOf("/");if(-1!==i){const e=s.slice(0,i);a.add(e)}else n.push({name:s,path:t?`${t}/${s}`:s,isDirectory:!1})}const s=Array.from(a).sort().map(e=>({name:e,path:t?`${t}/${e}`:e,isDirectory:!0}));return n.sort((e,t)=>e.name.localeCompare(t.name)),[...s,...n]}(k||"");t=e.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,source:"filesystem"}))}if(0===t.length){const e=EE();if(e){const a=await async function(e,t){const a=e||CE;if(!a)throw new Error("No directory handle available");const n=[];for await(const[s,r]of a.entries()){const e="directory"===r.kind;let i,o;if(!e&&t&&t.length>0){const e="."+s.split(".").pop()?.toLowerCase();if(!t.includes(e))continue}if(!e)try{const e=await r.getFile();i=e.size,o=new Date(e.lastModified)}catch{}n.push({name:s,path:`${a.name}/${s}`,isDirectory:e,size:i,modifiedAt:o,handle:r})}return n.sort((e,t)=>e.isDirectory!==t.isDirectory?e.isDirectory?-1:1:e.name.localeCompare(t.name)),n}(e,[]);t=a.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt,source:"filesystem",handle:e.handle}))}}}c(t)}catch(e){h(e instanceof Error?e.message:"Failed to load files")}finally{d(!1)}},[k,M,x]);s.useEffect(()=>{e&&C()},[e,C]);const E=async()=>{const e=await async function(){if(!NE())return null;try{const e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return CE=e,e}catch(p){if("AbortError"===p.name)return null;throw p}}();e&&v(!0)},P=async()=>{if(m){d(!0),h(null);try{if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return FE.includes(t)}(m.name)){if(!n)throw new Error("Binary file loading not supported");let e;if("filesystem"!==m.source)throw new Error("Cannot read tracker module");if(Vv()&&window.electron?.fs&&m.path)e=await window.electron.fs.readFile(m.path);else if(x&&m.path)e=await OE(m.path);else if(m.handle){const t=await m.handle.getFile();e=await t.arrayBuffer()}else{if(!m.path||!AE())throw new Error("Cannot read tracker module");e=await IE(m.path)}return await n(e,m.name),void t()}let e;const s=m.name.toLowerCase().endsWith(".xml");if(Vv()&&window.electron?.fs&&m.path){const t=await window.electron.fs.readFile(m.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}else if(x&&m.path){const t=await OE(m.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}else if(m.handle){const t=await async function(e){return(await e.getFile()).text()}(m.handle);e=s?t:JSON.parse(t)}else{if(!m.path||!AE())throw new Error("Cannot read file");{const t=await IE(m.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}}a(e,m.name),t()}catch(e){h(e instanceof Error?e.message:"Failed to load file")}finally{d(!1)}}},_=async e=>{if(confirm(`Delete "${e.name}"?`))try{const t=EE();t&&await async function(e,t){const a=t||CE;if(!a)throw new Error("No directory handle available");await a.removeEntry(e)}(e.name,t),C()}catch(t){h(t instanceof Error?t.message:"Failed to delete file")}};return e?xa.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:t,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[800px] max-w-[90vw] h-[600px] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[xa.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"load"===r?"Load Module":"Save Module"}),xa.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary","aria-label":"Close",children:xa.jsx(Ee,{size:18})})]}),xa.jsx("div",{className:"flex border-b border-dark-border",children:xa.jsx("button",{onClick:()=>b?null:E(),className:"px-4 py-2 text-sm font-medium "+(b?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-primary"),children:b?"Filesystem":"Open Folder..."})}),k&&xa.jsx("div",{className:"px-4 py-2 bg-dark-bgTertiary border-b border-dark-border",children:xa.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted font-mono truncate",children:[xa.jsx(Lt,{size:14})," ",k]})}),xa.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[p&&xa.jsx("div",{className:"bg-red-900/30 border border-red-500 text-red-300 px-4 py-2 rounded mb-4",children:p}),u?xa.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"Loading..."}):0===l.length?xa.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[xa.jsx("p",{className:"mb-4",children:"No files found"}),!Vv()&&!x&&!b&&xa.jsx("button",{onClick:E,className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Open Folder"}),Vv()&&!M&&xa.jsx("button",{onClick:async()=>{if(window.electron?.fs){const e=await window.electron.fs.openDirectory();e&&(N(e),S(e),C())}},className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Select Folder"})]}):xa.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[""!==k&&(Vv()||x)&&xa.jsxs("div",{onClick:()=>{if(Vv()&&k){const e=k.split("/").slice(0,-1).join("/")||"/";S(e),N(e)}else if(x&&k){const e=k.split("/").slice(0,-1).join("/")||"songs";S(e)}f(null)},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors bg-dark-bgSecondary hover:bg-dark-bgHover border border-dark-border",children:[xa.jsx(Bt,{size:18,className:"text-text-muted"}),xa.jsx("div",{className:"flex-1",children:xa.jsx("div",{className:"font-medium text-text-primary",children:".. (back)"})})]}),l.map(e=>xa.jsxs("div",{onClick:()=>f(e),onDoubleClick:()=>{e.isDirectory?Vv()?(S(e.path),N(e.path),f(null)):x&&(S(e.path),f(null)):(f(e),"load"===r&&P())},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors "+(m?.id===e.id?"bg-accent-primary/20 border border-accent-primary":"bg-dark-bgTertiary hover:bg-dark-bgHover border border-transparent"),children:[xa.jsx("div",{className:"text-text-muted flex-shrink-0",children:e.isDirectory?xa.jsx(Vt,{size:18}):RE(e.name)?xa.jsx(Nt,{size:18}):xa.jsx(zt,{size:18})}),xa.jsxs("div",{className:"flex-1 min-w-0",children:[xa.jsx("div",{className:"font-medium text-text-primary truncate",children:e.name}),xa.jsxs("div",{className:"text-xs text-text-muted",children:[e.size?`${(e.size/1024).toFixed(1)} KB`:"",e.modifiedAt&&`  ${e.modifiedAt.toLocaleDateString()}`]})]}),xa.jsx("button",{onClick:t=>{t.stopPropagation(),_(e)},className:"text-text-muted hover:text-red-400 p-1",title:"Delete","aria-label":"Delete",children:xa.jsx(Re,{size:14})})]},e.id))]})]}),xa.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 border-t border-dark-border",children:["save"===r&&xa.jsx("input",{type:"text",value:g,onChange:e=>y(e.target.value),placeholder:"Filename",className:"flex-1 px-3 py-2 bg-dark-bgTertiary border border-dark-border rounded text-text-primary"}),xa.jsx("div",{className:"flex-1"}),xa.jsx("button",{onClick:t,className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"Cancel"}),xa.jsx("button",{onClick:"load"===r?P:async()=>{if(i){d(!0),h(null);try{const e=i(),a=g.endsWith(".dbx")?g:`${g}.dbx`;if(Vv()&&window.electron?.fs){const t=`${M||k}/${a}`,n=JSON.stringify(e,null,2),s=(new TextEncoder).encode(n);await window.electron.fs.writeFile(t,s)}else if(x){const t=k?`${k}/${a}`:`songs/${a}`,n=JSON.stringify(e,null,2),s=(new TextEncoder).encode(n);await async function(e,t){const a=e.replace(/^\/+/,""),n=t instanceof ArrayBuffer?new Uint8Array(t):t,s=btoa(String.fromCharCode(...n)),r=await fetch(`${TE}/api/files/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})});if(!r.ok)throw new Error(`Failed to write file: ${r.statusText}`)}(t,s)}else{const t=EE();if(t)await async function(e,t,a){const n=a||CE;if(!n)throw new Error("No directory handle available");const s=await n.getFileHandle(e,{create:!0});return await PE(s,t),s}(a,JSON.stringify(e,null,2),t);else{const t=await async function(e,t){if(!NE())throw new Error("File System Access API not supported");try{return await window.showSaveFilePicker({suggestedName:e,types:t??[{description:"DEViLBOX Module",accept:{"application/json":[".dbox"]}}]})}catch(p){if("AbortError"===p.name)return null;throw p}}(a);t&&await PE(t,JSON.stringify(e,null,2))}}C(),t()}catch(e){h(e instanceof Error?e.message:"Failed to save file")}finally{d(!1)}}},disabled:"load"===r&&(!m||m.isDirectory),className:"px-6 py-2 rounded font-medium "+("load"!==r||m&&!m.isDirectory?"bg-accent-primary text-white hover:bg-accent-primaryHover":"bg-dark-bgTertiary text-text-muted cursor-not-allowed"),children:"load"===r?"Load":"Save"})]})]})}):null};var LE=r();function BE(e,t,a,n,s,r,i,o,l={},c){const u={format:"devilbox-song",version:_b,metadata:e,bpm:t,instruments:a,patterns:n,sequence:s,...r&&Object.keys(r).length>0?{automation:r}:{},...o&&o.length>0?{automationCurves:o}:{},...i&&i.length>0?{masterEffects:i}:{},...c&&"straight"!==c?{grooveTemplateId:c}:{}},d=l.prettify?JSON.stringify(u,null,2):JSON.stringify(u),p=new Blob([d],{type:"application/json"}),h=`${KE(e.name)}.dbx`;LE.saveAs(p,h)}function VE(e,t,a,n,s={}){const r={format:"devilbox-sfx",version:_b,name:e,instrument:t,pattern:a,bpm:n},i=s.prettify?JSON.stringify(r,null,2):JSON.stringify(r),o=new Blob([i],{type:"application/json"}),l=`${KE(e)}.sfx.json`;LE.saveAs(o,l)}function zE(e,t={}){const a={format:"devilbox-instrument",version:_b,instrument:e},n=t.prettify?JSON.stringify(a,null,2):JSON.stringify(a),s=new Blob([n],{type:"application/json"}),r=`${KE(e.name)}.dbi`;LE.saveAs(s,r)}async function UE(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-song"!==a.format)throw new Error("Invalid song format");return a}catch(t){return null}}async function GE(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-sfx"!==a.format)throw new Error("Invalid SFX format");return a}catch(t){return null}}async function WE(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-instrument"!==a.format)throw new Error("Invalid instrument format");return a}catch(t){return null}}async function HE(e){try{const t=await e.text(),a=JSON.parse(t);return"devilbox-song"===a.format?"song":"devilbox-sfx"===a.format?"sfx":"devilbox-instrument"===a.format?"instrument":"unknown"}catch{return"unknown"}}function KE(e){return e.replace(/[^a-z0-9_-]/gi,"_").replace(/_{2,}/g,"_").toLowerCase()}function $E(e){const t=new Uint8Array(e),a=[];for(let n=0;n<t.length;n+=32768){const e=t.subarray(n,Math.min(n+32768,t.length));a.push(String.fromCharCode.apply(null,e))}return btoa(a.join(""))}function qE(e){const[t,a,n,s,r,i]=e;let o=0;t>0&&t<=120?o=Math.max(1,t-12):254!==t&&255!==t||(o=97);return{note:o,instrument:a>0?a:0,volume:r>0?Math.min(16+Math.min(r,64),80):0,effTyp:s,eff:i,effTyp2:0,eff2:0}}function XE(e){const t=e.note,a=e.effectType,n=e.effectParam,s=e.volume,r=e.instrument;let i=0,o=0;if(s>=96){const e=function(e){const t=15&e;switch(e>>4){case 6:return[10,t];case 7:return[10,t<<4];case 8:return[14,176+t];case 9:return[14,160+t];case 11:return[4,t];case 12:return[8,17*t];case 13:return[25,t];case 14:return[25,t<<4];case 15:return[3,t>0?16*t:0];default:return null}}(s);null!==e&&(i=e[0],o=e[1])}return{note:t,instrument:r,volume:s,effTyp:a,eff:n,effTyp2:i,eff2:o}}function YE(e){const t=function(e){if(0===e)return 0;const t=[1712,1616,1525,1440,1357,1281,1209,1141,1077,1017,961,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];let a=0,n=1/0;for(let r=0;r<t.length;r++){const s=Math.abs(t[r]-e);s<n&&(n=s,a=r+1)}const s=a+24;return Math.min(96,Math.max(1,s))}(e.period),a=e.instrument,n=(s=e.effect,r=e.effectParam,`${s.toString(16).toUpperCase()}${r.toString(16).padStart(2,"0").toUpperCase()}`);var s,r;const[i,o]=n?Kn(n):[0,0];return{note:t,instrument:a,volume:0,effTyp:i,eff:o,effTyp2:0,eff2:0,period:e.period}}function QE(e){return e.instruments||[]}function ZE(e){return e.samples||[]}function JE(e){const t=function(e){if(!e.patterns||0===e.patterns.length)return[];const t=[],a=e.channels.length;for(let n=0;n<e.patterns.length;n++){const s=e.patterns[n],r=s.rows.length;if(0===r)continue;const i=[];for(let t=0;t<a;t++){const a=e.channels[t]||`Channel ${t+1}`,o=[];let l=null;for(let e=0;e<r;e++){const a=s.rows[e];if(a&&a[t]){const e=qE(a[t]);0!==e.instrument&&(l=e.instrument),o.push(e)}else o.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const c=null!==l&&0!==l?l:1;i.push({id:`import-ch-${n}-${t}-${Date.now()}`,name:a||`Ch ${t+1}`,rows:o,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:c,color:null})}const o=s.name||`Pattern ${n}`;t.push({id:`import-pat-${n}-${Date.now()}`,name:o,length:r,channels:i})}return t}(e),a=function(e){return e.orders?e.orders.map(e=>e.pat):[]}(e);let n;return n=a.length>0?a.map((e,a)=>{const n=t[e];return n?{...n,id:`import-pos-${a}-pat-${e}-${Date.now()}`,name:`${String(a).padStart(2,"0")}: ${n.name}`,channels:n.channels.map(e=>({...e,id:`${e.id}-pos-${a}`,rows:[...e.rows]}))}:t[0]}):t,{patterns:n,order:a,instrumentNames:QE(e),sampleNames:ZE(e),channelCount:e.channels?.length||4}}function eP(e,t,a,n,s){const r=[];for(let u=0;u<e.length;u++){const n=e[u],s=n.length,i=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let a=0;a<s;a++){const s=n[a]?.[e];if(s){const e=XE(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const o=null!==r?r:0;i.push({id:`xm-ch-${u}-${e}-${Date.now()}`,name:a.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:o,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`xm-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:s,channels:i,importMetadata:a})}const i=a.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),o=a.modData?.songLength||i.length,l=i.slice(0,o);let c;return s&&(c={base64:$E(s),format:"XM",sourceFile:a.sourceFile}),{patterns:r,order:l,instrumentNames:n,sampleNames:n,channelCount:t,metadata:a,originalModuleData:c}}function tP(e,t,a,n,s){const r=[];for(let u=0;u<e.length;u++){const n=e[u],s=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let a=0;a<64;a++){const s=n[a]?.[e];if(s){const e=YE(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const i=null!==r?r:0;s.push({id:`mod-ch-${u}-${e}-${Date.now()}`,name:a.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:i,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`mod-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:64,channels:s,importMetadata:a})}const i=a.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),o=a.modData?.songLength||i.length,l=i.slice(0,o);let c;return s&&(c={base64:$E(s),format:"MOD",sourceFile:a.sourceFile}),{patterns:r,order:l,instrumentNames:n,sampleNames:n,channelCount:t,metadata:a,originalModuleData:c}}function aP(e,t=0){const a={attack:10,decay:500,sustain:t,release:100};if(!e||!e.enabled||e.points.length<2)return a;const n=e.points;try{const t=function(e){if(0===e.length)return 10;const t=e[0];let a=0,n=e[0].value;for(let o=1;o<e.length;o++)if(e[o].value>n)n=e[o].value,a=o;else if(e[o].value<n-5)break;const s=e[a],r=s.tick-t.tick,i=32;return Math.max(1,r*i)}(n),{decay:a,sustain:s}=function(e,t,a){if(0===e.length)return{decay:500,sustain:0};let n=0,s=e[0].value;for(let d=0;d<e.length;d++)e[d].value>s&&(s=e[d].value,n=d);let r=a??n,i=e[r]?.value??s;if(null!==a&&a<e.length)i=e[a].value;else for(let d=n+1;d<e.length;d++){if(Math.abs(e[d].value-e[d-1].value)<6){r=d,i=e[d].value;break}}const o=e[r].tick-e[n].tick,l=32,c=Math.max(0,o*l),u=i/64*100;return{decay:c,sustain:u}}(n,0,e.sustainPoint),r=function(e,t){if(0===e.length)return 100;const a=t??Math.max(0,e.length-2);if(a>=e.length-1)return 100;let n=e.length-1;for(let i=a+1;i<e.length;i++)if(e[i].value<5){n=i;break}const s=e[n].tick-e[a].tick,r=32;return Math.max(10,s*r)}(n,e.sustainPoint);return{attack:Math.max(0,Math.min(2e3,t)),decay:Math.max(0,Math.min(2e3,a)),sustain:Math.max(0,Math.min(100,s)),release:Math.max(0,Math.min(5e3,r))}}catch(s){return a}}function nP(e,t,a){const n=[];if(e.furnace){const s=e.furnace.synthType;if("Sampler"===s||"Player"===s){if(e.samples.length>0)for(let s=0;s<e.samples.length;s++){const r=rP(e.samples[s],e,t+s,a);n.push(r)}else{const a=sP(e,t);n.push(a)}return n}const r=sP(e,t);n.push(r);for(let i=0;i<e.samples.length;i++){const s=rP(e.samples[i],e,t+i+1,a);n.push(s)}return n}for(let s=0;s<e.samples.length;s++){const r=rP(e.samples[s],e,t+s,a);n.push(r)}return n}function sP(e,t){const a=e.furnace,n=a.synthType,s={chipType:a.chipType,furnaceIndex:e.id-1,rawBinaryData:e.rawBinaryData,algorithm:a.fm?.algorithm??0,feedback:a.fm?.feedback??0,fms:a.fm?.fms??0,ams:a.fm?.ams??0,ops:a.fm?.ops??4,opllPreset:a.fm?.opllPreset??0,operators:a.fm?.operators?.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r??0,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2??0,rs:e.rs??0,am:e.am??!1,ksr:e.ksr??!1,ksl:e.ksl??0,sus:e.sus??!1,vib:e.vib??!1,ws:e.ws??0,ssg:e.ssg??0}))??[],macros:a.macros.map(e=>({code:e.type,type:e.type,data:[...e.data],loop:e.loop,release:e.release,mode:e.mode??0,delay:e.delay,speed:e.speed})),opMacros:[],wavetables:a.wavetables.map(e=>({id:e.id,data:[...e.data],len:e.len,max:e.max}))};return{id:t,name:e.name||`Furnace Inst ${t}`,type:"synth",synthType:n,envelope:{attack:10,decay:100,sustain:80,release:100},effects:[],volume:0,pan:0,metadata:{importedFrom:"FUR"},furnace:s,parameters:{}}}function rP(e,t,a,n){const{audioBuffer:s,blobUrl:r}=function(e){const t=e.sampleRate||8363,a=e.length,n=new Int16Array(a);if(8===e.bitDepth){const t=e.pcmData instanceof Float32Array?new Float32Array(e.pcmData):new Int8Array(e.pcmData);for(let e=0;e<a;e++)t instanceof Float32Array?n[e]=Math.round(32767*t[e]):n[e]=256*t[e]}else if(16===e.bitDepth){const t=new Int16Array(e.pcmData);for(let e=0;e<a;e++)n[e]=t[e]}const s="none"!==e.loopType?{start:e.loopStart,end:e.loopStart+e.loopLength}:void 0,r=function(e,t,a){const n=1,s=2*e.length,r=a?68:0,i=44+s+r,o=new ArrayBuffer(i),l=new DataView(o),c=(e,t)=>{for(let a=0;a<t.length;a++)l.setUint8(e+a,t.charCodeAt(a))};c(0,"RIFF"),l.setUint32(4,i-8,!0),c(8,"WAVE"),c(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,n,!0),l.setUint32(24,t,!0),l.setUint32(28,t*n*2,!0),l.setUint16(32,2*n,!0),l.setUint16(34,16,!0),c(36,"data"),l.setUint32(40,s,!0);let u=44;for(let d=0;d<e.length;d++)l.setInt16(u,e[d],!0),u+=2;a&&(c(u,"smpl"),l.setUint32(u+4,60,!0),l.setUint32(u+8,0,!0),l.setUint32(u+12,0,!0),l.setUint32(u+16,Math.floor(1e9/t),!0),l.setUint32(u+20,60,!0),l.setUint32(u+24,0,!0),l.setUint32(u+28,0,!0),l.setUint32(u+32,0,!0),l.setUint32(u+36,1,!0),l.setUint32(u+40,0,!0),l.setUint32(u+44,0,!0),l.setUint32(u+48,0,!0),l.setUint32(u+52,a.start,!0),l.setUint32(u+56,a.end-1,!0),l.setUint32(u+60,0,!0),l.setUint32(u+64,0,!0));return o}(n,t,s),i=function(e){const t=new Uint8Array(e);let a="";for(let n=0;n<t.byteLength;n++)a+=String.fromCharCode(t[n]);return btoa(a)}(r);return{audioBuffer:r,blobUrl:`data:audio/wav;base64,${i}`}}(e),i=(e.sampleRate,function(e){const t=48+e,a=Math.floor(t/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}${a}`}(e.relativeNote,e.finetune)),o=100*e.finetune/128,l=aP(t.volumeEnvelope),c=e.sampleRate||8363,u={audioBuffer:s,url:r,baseNote:i,detune:o,loop:"none"!==e.loopType,loopStart:e.loopStart,loopEnd:e.loopStart+e.loopLength,sampleRate:c,reverse:!1,playbackRate:1},d={importedFrom:"FUR"===n||"DMF"===n?"FUR":n,originalEnvelope:t.volumeEnvelope,autoVibrato:t.autoVibrato,preservedSample:{audioBuffer:u.audioBuffer,url:u.url,baseNote:u.baseNote,detune:u.detune,loop:u.loop,loopStart:u.loopStart,loopEnd:u.loopEnd,envelope:l},modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:e.finetune,defaultVolume:e.volume}};return{id:a,name:e.name||t.name||`Instrument ${a}`,type:"sample",synthType:"Sampler",sample:u,envelope:l,effects:[],volume:0,pan:(e.panning-128)/127*100,metadata:d,parameters:{sampleUrl:r}}}const iP=Object.freeze(Object.defineProperty({__proto__:null,analyzeSample:function(e,t){const a=function(e){if(!e||!e.enabled||e.points.length<2)return{type:"unknown",hasQuickAttack:!1,hasSustain:!1,hasLongRelease:!1};const t=aP(e),a=t.attack<20,n=t.sustain>20,s=t.release>500;let r="unknown";return a&&!n&&t.decay<300?r="pluck":a&&!n&&t.decay<100?r="percussive":!a&&n?r="pad":a&&n&&(r="sustained"),{type:r,hasQuickAttack:a,hasSustain:n,hasLongRelease:s}}(t),n="none"!==e.loopType,s=0!==e.relativeNote||n;return{dominantFrequency:s?440:null,harmonicContent:e.length<8e3&&!n&&"percussive"===a.type?"noise":s?"rich":"pure",envelopeShape:a.type,hasLoop:n,isPitched:s,bandwidth:1e3}},convertToInstrument:nP,suggestSynthConfig:function(e,t){switch(e){case"TB303":return{oscillator:{type:"rich"===t.harmonicContent?"sawtooth":"square"},filter:{cutoff:t.dominantFrequency?500:1e3,resonance:70},filterEnvelope:{envMod:60,decay:"pluck"===t.envelopeShape?200:500},accent:{amount:70},slide:{time:60,mode:"exponential"}};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:"pad"===t.envelopeShape?200:50,decay:500,sustain:t.hasLoop?50:0,release:100},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:"rich"===t.harmonicContent?3:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:"percussive"===t.envelopeShape?100:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100}}}}},Symbol.toStringTag,{value:"Module"}));var oP,lP,cP,uP,dP,pP={},hP={};function mP(){if(lP)return oP;function e(e){for(var a,n=new t(e),s=[];!n.eof();){var r=i();s.push(r)}return s;function i(){var e={};e.deltaTime=n.readVarInt();var t=n.readUInt8();if(240&~t){var s;if(128&t)s=n.readUInt8(),a=t;else{if(null===a)throw"Running status byte encountered before status byte";s=t,t=a,e.running=!0}var r=t>>4;switch(e.channel=15&t,r){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=n.readUInt8(),e;case 9:var i=n.readUInt8();return e.type=0===i?"noteOff":"noteOn",e.noteNumber=s,e.velocity=i,0===i&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=n.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=n.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(n.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+r}}else{if(255!==t){if(240==t){e.type="sysEx";l=n.readVarInt();return e.data=n.readBytes(l),e}if(247==t){e.type="endSysEx";l=n.readVarInt();return e.data=n.readBytes(l),e}throw"Unrecognised MIDI event type byte: "+t}e.meta=!0;var o=n.readUInt8(),l=n.readVarInt();switch(o){case 0:if(e.type="sequenceNumber",2!==l)throw"Expected length for sequenceNumber event is 2, got "+l;return e.number=n.readUInt16(),e;case 1:return e.type="text",e.text=n.readString(l),e;case 2:return e.type="copyrightNotice",e.text=n.readString(l),e;case 3:return e.type="trackName",e.text=n.readString(l),e;case 4:return e.type="instrumentName",e.text=n.readString(l),e;case 5:return e.type="lyrics",e.text=n.readString(l),e;case 6:return e.type="marker",e.text=n.readString(l),e;case 7:return e.type="cuePoint",e.text=n.readString(l),e;case 32:if(e.type="channelPrefix",1!=l)throw"Expected length for channelPrefix event is 1, got "+l;return e.channel=n.readUInt8(),e;case 33:if(e.type="portPrefix",1!=l)throw"Expected length for portPrefix event is 1, got "+l;return e.port=n.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=l)throw"Expected length for endOfTrack event is 0, got "+l;return e;case 81:if(e.type="setTempo",3!=l)throw"Expected length for setTempo event is 3, got "+l;return e.microsecondsPerBeat=n.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=l)throw"Expected length for smpteOffset event is 5, got "+l;var c=n.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&c],e.hour=31&c,e.min=n.readUInt8(),e.sec=n.readUInt8(),e.frame=n.readUInt8(),e.subFrame=n.readUInt8(),e;case 88:if(e.type="timeSignature",2!=l&&4!=l)throw"Expected length for timeSignature event is 4 or 2, got "+l;return e.numerator=n.readUInt8(),e.denominator=1<<n.readUInt8(),4===l?(e.metronome=n.readUInt8(),e.thirtyseconds=n.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=l)throw"Expected length for keySignature event is 2, got "+l;return e.key=n.readInt8(),e.scale=n.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=n.readBytes(l),e;default:return e.type="unknownMeta",e.data=n.readBytes(l),e.metatypeByte=o,e}}}}function t(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}return lP=1,t.prototype.eof=function(){return this.pos>=this.bufferLen},t.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},t.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},t.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},t.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},t.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},t.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},t.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},t.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},oP=function(a){var n=new t(a),s=n.readChunk();if("MThd"!=s.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var r=function(e){var a=new t(e),n=a.readUInt16(),s=a.readUInt16(),r={format:n,numTracks:s},i=a.readUInt16();32768&i?(r.framesPerSecond=256-(i>>8),r.ticksPerFrame=255&i):r.ticksPerBeat=i;return r}(s.data),i=[],o=0;!n.eof()&&o<r.numTracks;o++){var l=n.readChunk();if("MTrk"!=l.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var c=e(l.data);i.push(c)}return{header:r,tracks:i}}}function fP(){if(uP)return cP;function e(e,n,s){var r,i=new a,o=n.length,l=null;for(r=0;r<o;r++)!1!==s.running&&(s.running||n[r].running)||(l=null),l=t(i,n[r],l,s.useByte9ForNoteOff);e.writeChunk("MTrk",i.buffer)}function t(e,t,a,n){var s=t.type,r=t.deltaTime,i=t.text||"",o=t.data||[],l=null;switch(e.writeVarInt(r),s){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(i.length),e.writeString(i);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(i.length),e.writeString(i);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(i.length),e.writeString(i);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(i.length),e.writeString(i);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(i.length),e.writeString(i);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(i.length),e.writeString(i);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(i.length),e.writeString(i);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var u=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(u),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(o.length),e.writeBytes(o);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(o.length),e.writeBytes(o));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(o.length),e.writeBytes(o);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(o.length),e.writeBytes(o);break;case"noteOff":(l=(!1!==n&&t.byte9||n&&0==t.velocity?144:128)|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(l=144|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(l=160|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(l=176|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(l=192|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(l=208|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":(l=224|t.channel)!==a&&e.writeUInt8(l);var d=8192+t.value,p=127&d,h=d>>7&127;e.writeUInt8(p),e.writeUInt8(h);break;default:throw"Unrecognized event type: "+s}return l}function a(){this.buffer=[]}return uP=1,a.prototype.writeUInt8=function(e){this.buffer.push(255&e)},a.prototype.writeInt8=a.prototype.writeUInt8,a.prototype.writeUInt16=function(e){var t=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(a)},a.prototype.writeInt16=a.prototype.writeUInt16,a.prototype.writeUInt24=function(e){var t=e>>16&255,a=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(a),this.writeUInt8(n)},a.prototype.writeInt24=a.prototype.writeUInt24,a.prototype.writeUInt32=function(e){var t=e>>24&255,a=e>>16&255,n=e>>8&255,s=255&e;this.writeUInt8(t),this.writeUInt8(a),this.writeUInt8(n),this.writeUInt8(s)},a.prototype.writeInt32=a.prototype.writeUInt32,a.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},a.prototype.writeString=function(e){var t,a=e.length,n=[];for(t=0;t<a;t++)n.push(e.codePointAt(t));this.writeBytes(n)},a.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,a=[];for(a.push(127&t),t>>=7;t;){var n=127&t|128;a.push(n),t>>=7}this.writeBytes(a.reverse())}},a.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},cP=function(t,n){if("object"!=typeof t)throw"Invalid MIDI data";n=n||{};var s,r=t.header||{},i=t.tracks||[],o=i.length,l=new a;for(function(e,t,n){var s=null==t.format?1:t.format,r=128;t.timeDivision?r=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?r=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(r=32767&t.ticksPerBeat);var i=new a;i.writeUInt16(s),i.writeUInt16(n),i.writeUInt16(r),e.writeChunk("MThd",i.buffer)}(l,r,o),s=0;s<o;s++)e(l,i[s],n);return l.buffer}}function gP(){return dP||(dP=1,hP.parseMidi=mP(),hP.writeMidi=fP()),hP}var yP,bP,vP={},xP={};function wP(){if(yP)return xP;function e(e,t,a){void 0===a&&(a="ticks");var n=0,s=e.length,r=s;if(s>0&&e[s-1][a]<=t)return s-1;for(;n<r;){var i=Math.floor(n+(r-n)/2),o=e[i],l=e[i+1];if(o[a]===t){for(var c=i;c<e.length;c++){e[c][a]===t&&(i=c)}return i}if(o[a]<t&&l[a]>t)return i;o[a]>t?r=i:o[a]<t&&(n=i+1)}return-1}return yP=1,Object.defineProperty(xP,"__esModule",{value:!0}),xP.insert=xP.search=void 0,xP.search=e,xP.insert=function(t,a,n){if(void 0===n&&(n="ticks"),t.length){var s=e(t,a[n],n);t.splice(s+1,0,a)}else t.push(a)},xP}function kP(){return bP||(bP=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=wP(),a=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var n=function(){function n(t){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",a.set(this,480),t){a.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?n.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?n.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&n.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var s=0;t.tracks[0].forEach(function(e){s+=e.deltaTime,e.meta&&("trackName"===e.type?n.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||n.meta.push({text:e.text,ticks:s,type:e.type}))}),this.update()}}return n.prototype.update=function(){var e=this,t=0,a=0;this.tempos.sort(function(e,t){return e.ticks-t.ticks}),this.tempos.forEach(function(n,s){var r=s>0?e.tempos[s-1].bpm:e.tempos[0].bpm,i=n.ticks/e.ppq-a,o=60/r*i;n.time=o+t,t=n.time,a+=i}),this.timeSignatures.sort(function(e,t){return e.ticks-t.ticks}),this.timeSignatures.forEach(function(t,a){var n=a>0?e.timeSignatures[a-1]:e.timeSignatures[0],s=(t.ticks-n.ticks)/e.ppq/n.timeSignature[0]/(n.timeSignature[1]/4);n.measures=n.measures||0,t.measures=s+n.measures})},n.prototype.ticksToSeconds=function(e){var a=(0,t.search)(this.tempos,e);if(-1!==a){var n=this.tempos[a],s=n.time,r=(e-n.ticks)/this.ppq;return s+60/n.bpm*r}return.5*(e/this.ppq)},n.prototype.ticksToMeasures=function(e){var a=(0,t.search)(this.timeSignatures,e);if(-1!==a){var n=this.timeSignatures[a],s=(e-n.ticks)/this.ppq;return n.measures+s/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return a.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(e){var a=(0,t.search)(this.tempos,e,"time");if(-1!==a){var n=this.tempos[a],s=(e-n.time)/(60/n.bpm);return Math.round(n.ticks+s*this.ppq)}var r=e/.5;return Math.round(r*this.ppq)},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(e){return Object.assign({},e)}),this.timeSignatures=e.timeSignatures.map(function(e){return Object.assign({},e)}),this.keySignatures=e.keySignatures.map(function(e){return Object.assign({},e)}),this.meta=e.meta.map(function(e){return Object.assign({},e)}),a.set(this,e.ppq),this.update()},n.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},n}();e.Header=n}(vP)),vP}var SP,MP={},NP={};function CP(){return SP||(SP=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,a){return t[e.controlChangeNames[a]]=a,t},{});var t=new WeakMap,a=new WeakMap,n=function(){function n(e,n){t.set(this,n),a.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(n.prototype,"number",{get:function(){return a.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return t.get(this).ticksToSeconds(this.ticks)},set:function(e){var a=t.get(this);this.ticks=a.secondsToTicks(e)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();e.ControlChange=n}(NP)),NP}var EP,PP={};var _P,TP={};var AP,OP,IP={},DP={};function FP(){if(OP)return IP;OP=1,Object.defineProperty(IP,"__esModule",{value:!0}),IP.Instrument=void 0;var e=(AP||(AP=1,Object.defineProperty(DP,"__esModule",{value:!0}),DP.DrumKitByPatchID=DP.InstrumentFamilyByID=DP.instrumentByPatchID=void 0,DP.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],DP.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],DP.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),DP),t=new WeakMap,a=function(){function a(e,a){if(this.number=0,t.set(this,a),this.number=0,e){var n=e.find(function(e){return"programChange"===e.type});n&&(this.number=n.programNumber)}}return Object.defineProperty(a.prototype,"name",{get:function(){return this.percussion?e.DrumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var a=e.instrumentByPatchID.indexOf(t);-1!==a&&(this.number=a)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"family",{get:function(){return this.percussion?"drums":e.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"percussion",{get:function(){return 9===t.get(this).channel},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},a.prototype.fromJSON=function(e){this.number=e.number},a}();return IP.Instrument=a,IP}var RP,jP,LP={};function BP(){if(RP)return LP;function e(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}RP=1,Object.defineProperty(LP,"__esModule",{value:!0}),LP.Note=void 0;var t=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(a){var n=e.exec(a),s=n[1],r=n[2];return t[s.toLowerCase()]+12*(parseInt(r,10)+1)}}(),a=new WeakMap,n=function(){function n(e,t,n){a.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(n.prototype,"name",{get:function(){return t=this.midi,a=Math.floor(t/12)-1,e(t)+a.toString();var t,a},set:function(e){this.midi=t(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pitch",{get:function(){return e(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){var e=a.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return a.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bars",{get:function(){return a.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},n}();return LP.Note=n,LP}function VP(){if(jP)return MP;jP=1,Object.defineProperty(MP,"__esModule",{value:!0}),MP.Track=void 0;var e=wP(),t=CP(),a=function(){if(EP)return PP;EP=1,Object.defineProperty(PP,"__esModule",{value:!0}),PP.createControlChanges=void 0;var e=CP();return PP.createControlChanges=function(){return new Proxy({},{get:function(t,a){return t[a]?t[a]:e.controlChangeIds.hasOwnProperty(a)?t[e.controlChangeIds[a]]:void 0},set:function(t,a,n){return e.controlChangeIds.hasOwnProperty(a)?t[e.controlChangeIds[a]]=n:t[a]=n,!0}})},PP}(),n=function(){if(_P)return TP;_P=1,Object.defineProperty(TP,"__esModule",{value:!0}),TP.PitchBend=void 0;var e=new WeakMap,t=function(){function t(t,a){e.set(this,a),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return e.get(this).ticksToSeconds(this.ticks)},set:function(t){var a=e.get(this);this.ticks=a.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return TP.PitchBend=t,TP}(),s=FP(),r=BP(),i=new WeakMap,o=function(){function o(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,a.createControlChanges)(),this.pitchBends=[],i.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(e){return"noteOn"===e.type}),l=e.filter(function(e){return"noteOff"===e.type}),c=function(){var e=o.shift();u.channel=e.channel;var t=l.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var a=l.splice(t,1)[0];u.addNote({durationTicks:a.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:a.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},u=this;o.length;)c();e.filter(function(e){return"controller"===e.type}).forEach(function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})});var d=e.find(function(e){return"endOfTrack"===e.type});this.endOfTrackTicks=void 0!==d?d.absoluteTime:void 0}}return o.prototype.addNote=function(t){var a=i.get(this),n=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},a);return Object.assign(n,t),(0,e.insert)(this.notes,n,"ticks"),this},o.prototype.addCC=function(a){var n=i.get(this),s=new t.ControlChange({controllerType:a.number},n);return delete a.number,Object.assign(s,a),Array.isArray(this.controlChanges[s.number])||(this.controlChanges[s.number]=[]),(0,e.insert)(this.controlChanges[s.number],s,"ticks"),this},o.prototype.addPitchBend=function(t){var a=i.get(this),s=new n.PitchBend({},a);return Object.assign(s,t),(0,e.insert)(this.pitchBends,s,"ticks"),this},Object.defineProperty(o.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var a=this.notes[t].time+this.notes[t].duration;e<a&&(e=a)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var a=this.notes[t].ticks+this.notes[t].durationTicks;e<a&&(e=a)}return e},enumerable:!1,configurable:!0}),o.prototype.fromJSON=function(e){var t=this;for(var a in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[a]&&e.controlChanges[a].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},o.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));var a={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})};return void 0!==this.endOfTrackTicks&&(a.endOfTrackTicks=this.endOfTrackTicks),a},o}();return MP.Track=o,MP}var zP={};function UP(e,t){for(var a=0;a<e.length;a++){var n=e[a];Array.isArray(n)?UP(n,t):t.push(n)}}const GP=u(Object.freeze(Object.defineProperty({__proto__:null,flatten:function(e){var t=[];return UP(e,t),t}},Symbol.toStringTag,{value:"Module"})));var WP,HP;function KP(){if(WP)return zP;WP=1;var e=zP&&zP.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var n,s=0,r=t.length;s<r;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(zP,"__esModule",{value:!0}),zP.encode=void 0;var t=gP(),a=kP(),n=GP;function s(e){return(0,n.flatten)(e.notes.map(function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)}))}function r(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function i(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}return zP.encode=function(n){var o={header:{format:1,numTracks:n.tracks.length+1,ticksPerBeat:n.header.ppq},tracks:e([e(e(e(e([{absoluteTime:0,deltaTime:0,meta:!0,text:n.header.name,type:"trackName"}],n.header.keySignatures.map(function(e){return function(e){var t=a.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)}),!0),n.header.meta.map(function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t}),!0),n.header.tempos.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)}),!0),n.header.timeSignatures.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)}),!0)],n.tracks.map(function(t){return e(e(e([(a=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:a,type:"trackName"}),i(t)],s(t),!0),function(e){for(var t=[],a=0;a<127;a++)e.controlChanges.hasOwnProperty(a)&&e.controlChanges[a].forEach(function(a){t.push(r(a,e.channel))});return t}(t),!0),function(e){var t=[];return e.pitchBends.forEach(function(a){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(a,e.channel))}),t}(t),!0);var a}),!0)};return o.tracks=o.tracks.map(function(e){e=e.sort(function(e,t){return e.absoluteTime-t.absoluteTime});var t=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array((0,t.writeMidi)(o))},zP}var $P=(HP||(HP=1,function(e){var t=pP&&pP.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,r){function i(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,o)}l((n=n.apply(e,t||[])).next())})},a=pP&&pP.__generator||function(e,t){var a,n,s,r,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,n=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){i=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){i.label=r[1];break}if(6===r[0]&&i.label<s[1]){i.label=s[1],s=r;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(r);break}s[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(o){r=[6,o],n=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var n=gP(),s=kP(),r=VP(),i=KP(),o=function(){function e(e){var t=this,a=null;if(e){var i=e instanceof ArrayBuffer?new Uint8Array(e):e;(a=(0,n.parseMidi)(i)).tracks.forEach(function(e){var t=0;e.forEach(function(e){t+=e.deltaTime,e.absoluteTime=t})}),a.tracks=function(e){for(var t=[],a=0;a<e.length;a++)for(var n=t.length,s=new Map,r=Array(16).fill(0),i=0,o=e[a];i<o.length;i++){var l=o[i],c=n,u=l.channel;if(void 0!==u){"programChange"===l.type&&(r[u]=l.programNumber);var d=r[u],p="".concat(d," ").concat(u);s.has(p)?c=s.get(p):(c=n+s.size,s.set(p,c))}t[c]||t.push([]),t[c].push(l)}return t}(a.tracks)}this.header=new s.Header(a),this.tracks=[],e&&(this.tracks=a.tracks.map(function(e){return new r.Track(e,t.header)}),1===a.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(n){return t(this,void 0,void 0,function(){var t;return a(this,function(a){switch(a.label){case 0:return[4,fetch(n)];case 1:return(t=a.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new e(a.sent())];case 3:throw new Error("Could not load '".concat(n,"'"))}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map(function(e){return e.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(e){return e.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new r.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,i.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(e){var a=new r.Track(void 0,t.header);return a.fromJSON(e),a})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();e.Midi=o;var l=VP();Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=kP();Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}})}(pP)),pP);function qP(e="id"){return`${e}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const XP={quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64};async function YP(e,t={}){const a={...XP,...t},n=await e.arrayBuffer(),s=new $P.Midi(n),r=s.header.ppq||480;if(0===r)throw new Error("Invalid MIDI file: PPQ (pulses per quarter note) cannot be zero");const i=s.header.tempos.length>0?Math.round(s.header.tempos[0].bpm):120,o=s.header.timeSignatures.length>0?[s.header.timeSignatures[0].timeSignature[0],s.header.timeSignatures[0].timeSignature[1]]:[4,4],l=[];if(a.mergeChannels){const e=function(e,t,a,n){const s=e.duration*(e.header.tempos[0]?.bpm||120)/60,r=Math.min(256,Math.max(t.defaultPatternLength||64,Math.ceil(s*n))),i=new Map;e.tracks.forEach(e=>{e.notes.forEach(e=>{const t=e.midi%16;i.has(t)||i.set(t,[]),i.get(t).push({tick:e.ticks,note:e})})});const o=Array.from(i.entries()).sort((e,t)=>e[0]-t[0]).map(([e,s])=>{const i=Array.from({length:r},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return s.forEach(({tick:e,note:s})=>{const o=ZP(e,a,n,t.quantize);if(o<0||o>=r)return;const l=Xn(s.midi);if(!l)return;if(i[o].note=l,t.velocityToVolume){const e=JP(127*s.velocity);i[o].volume=16+Math.round(e/64*64)}const c=ZP(e+s.durationTicks,a,n,t.quantize);c<r&&c>o&&(i[c].note=97)}),{id:qP("channel"),name:`Ch ${e+1}`,instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:i}});return{id:qP("pattern"),name:e.name||"MIDI Import",length:r,channels:o}}(s,a,r,4);l.push(e)}else for(let c=0;c<s.tracks.length;c++){const e=s.tracks[c];if(0===e.notes.length)continue;const t=QP(e,c,a,r,4);l.push(t)}return{patterns:l,bpm:i,timeSignature:o,metadata:{name:s.name||e.name.replace(/\.[^/.]+$/,""),tracks:s.tracks.length,totalTicks:s.durationTicks}}}function QP(e,t,a,n,s){const r=e.notes.length>0?e.notes[e.notes.length-1]:null,i=ZP(r?r.ticks+r.durationTicks:0,n,s,0),o=Math.min(256,Math.max(a.defaultPatternLength||64,64*Math.ceil(i/64))),l=Array.from({length:o},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return e.notes.forEach(e=>{const t=ZP(e.ticks,n,s,a.quantize);if(t<0||t>=o)return;const r=Xn(e.midi);if(!r)return;if(l[t].note=r,a.velocityToVolume){const a=JP(127*e.velocity);l[t].volume=16+Math.round(a/64*64)}const i=ZP(e.ticks+e.durationTicks,n,s,a.quantize);i<o&&i>t&&(l[i].note=97)}),{id:qP("pattern"),name:e.name||`Track ${t+1}`,length:o,channels:[{id:qP("channel"),name:"Channel 1",instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:l}]}}function ZP(e,t,a,n=0){if(0===t)return 0;const s=Math.round(e/t*a);return n>0?Math.round(s/n)*n:s}function JP(e){return Math.round(e/127*64)}function e_(e,t="DB303 Pattern",a=1){const n=(new DOMParser).parseFromString(e,"text/xml"),s=n.querySelector("parsererror");if(s)throw new Error("Invalid XML: "+s.textContent);const r=n.querySelector("db303-pattern");if(!r)throw new Error("Invalid pattern XML: missing db303-pattern element");const i=parseInt(r.getAttribute("numSteps")||"16",10),o=Math.max(1,Math.min(256,isNaN(i)?16:i)),l=parseInt(r.getAttribute("rootNote")||"36",10),c=r.getAttribute("tempo")?parseInt(r.getAttribute("tempo"),10):void 0,u=r.getAttribute("swing")?parseFloat(r.getAttribute("swing")):void 0,d=[];n.querySelectorAll("step").forEach(e=>{const t=parseInt(e.getAttribute("index")||"0",10),a=parseInt(e.getAttribute("key")||"0",10),n=parseInt(e.getAttribute("octave")||"0",10),s="true"===e.getAttribute("gate"),r="true"===e.getAttribute("accent"),i="true"===e.getAttribute("slide"),o="true"===e.getAttribute("mute"),l="true"===e.getAttribute("hammer");d.push({index:t,key:a,octave:n,gate:s,accent:r,slide:i,mute:o,hammer:l})}),d.sort((e,t)=>e.index-t.index);const p=new Map(d.map(e=>[e.index,e])),h=[];let m=-1;for(let f=0;f<o;f++){const e=p.get(f);if(e){let t=0;if(e.gate){t=l+e.key+12*e.octave-11,t=Math.max(1,Math.min(96,t)),m=f}else m>=0&&(t=97);h.push({note:t,instrument:e.gate?a:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:e.mute?3:e.hammer?4:void 0,flag2:e.slide?2:!e.hammer||e.accent||e.mute?void 0:4})}else h.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}return{pattern:{id:`db303-${Date.now()}`,name:t,length:o,channels:[{id:"ch-1",name:"TB-303",rows:h,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:"#22c55e"}]},tempo:c,swing:u}}function t_(e,t=120,a=0,n=36){const s=[];s.push('<?xml version="1.0" encoding="UTF-8"?>');const r=e.channels?.[0];if(!r)throw new Error("Pattern has no channels to export");const i=Math.min(e.length,32),o=a>0?` swing="${a.toFixed(2)}"`:"";s.push(`<db303-pattern version="1.0" numSteps="${i}" tempo="${Math.round(t)}"${o} rootNote="${n}">`);for(let l=0;l<i;l++){const e=r?.rows[l];if(!e){s.push(`  <step index="${l}" key="0" octave="0" gate="false" accent="false" slide="false" mute="false" hammer="false"/>`);continue}const t=e.note>0&&e.note<=96,a=t,i=1===e.flag1||1===e.flag2,o=2===e.flag1||2===e.flag2,c=3===e.flag1||3===e.flag2,u=4===e.flag1||4===e.flag2;let d=0,p=0;if(t){const t=e.note-1-n;p=Math.floor(t/12),d=(t%12+12)%12,p=Math.max(-1,Math.min(1,p))}s.push(`  <step index="${l}" key="${d}" octave="${p}" gate="${a}" accent="${i}" slide="${o}" mute="${c}" hammer="${u}"/>`)}return s.push("</db303-pattern>"),s.join("\n")}function a_(e,t="pattern",a=120,n=0,s=36){const r=t_(e,a,n,s),i=new Blob([r],{type:"application/xml"}),o=URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=`${t}.xml`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}async function n_(e=0,t){const{useTrackerStore:a}=await _a(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>af);return{useTrackerStore:e}},void 0),{useTransportStore:n}=await _a(async()=>{const{useTransportStore:e}=await Promise.resolve().then(()=>jg);return{useTransportStore:e}},void 0),s=a.getState(),r=n.getState(),i=s.patterns,o=s.currentPatternIndex;if(!i||0===i.length)return;const l=i[o];if(!l)return;let c=l;e>0&&l.channels[e]&&(c={...l,channels:[l.channels[e]]});const u=r.bpm||120,d=r.swing||0;a_(c,t||l.name?.replace(/[^a-zA-Z0-9-_]/g,"_")||"pattern",u,d,36)}"undefined"!=typeof window&&(window.exportCurrentPatternToDb303=n_,window.convertToDb303Pattern=t_,window.downloadDb303Pattern=a_);const s_=Object.freeze(Object.defineProperty({__proto__:null,convertToDb303Pattern:t_,downloadDb303Pattern:a_,exportCurrentPatternToDb303:n_,parseDb303Pattern:e_},Symbol.toStringTag,{value:"Module"})),r_=[".json",".song.json",".dbx",".xml",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".mid",".midi"].join(",");function i_(e,t,a){const n=new Set;for(const i of e)for(const e of i.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&n.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const i of Array.from(n).sort((e,t)=>e-t)){const e=t[i-1]||`Instrument ${i}`;{const t=r[(i-1)%r.length];s.push({id:i,name:e.trim()||`Instrument ${i}`,type:"synth",synthType:"Synth",oscillator:{...Fn,type:t},envelope:{...Rn},filter:{...jn},effects:[],volume:-6,pan:0})}}for(const i of[0,1])n.has(i)||s.push({id:i,name:0===i?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Fn,type:"sawtooth"},envelope:{...Rn},filter:{...jn},effects:[],volume:-6,pan:0});return s.sort((e,t)=>e.id-t.id),s}const o_=({onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,onShowPatternOrder:i,onShowDrumpads:o,showMasterFX:l})=>{const{patterns:c,currentPatternIndex:u,setCurrentPattern:d,deletePattern:p,addPattern:h,expandPattern:m,shrinkPattern:f,resizePattern:g,loadPatterns:y,setPatternOrder:b,patternOrder:v,currentPositionIndex:x,setCurrentPosition:w,recordMode:k,editStep:S,toggleRecordMode:M,setEditStep:N,reset:C,duplicatePosition:E,removeFromOrder:P}=tf(),{isPlaying:_,isLooping:T,bpm:A,setBPM:O,speed:I,setSpeed:D,setIsLooping:F,play:R,stop:j,grooveTemplateId:L,setGrooveTemplate:B,swing:V,jitter:z,useMpcScale:U,reset:G}=Rg(),{isDirty:W,setMetadata:H,metadata:K}=Bg(),{instruments:$,loadInstruments:q,updateInstrument:X,addInstrument:Y,reset:Q}=Pg(),{masterEffects:Z}=Lg(),{compactToolbar:J,toggleCompactToolbar:ee,oscilloscopeVisible:te}=Tg(),{curves:ae}=Vg(),ne=qg(e=>e.addTab),se=Km(),re=s.useRef(null),[ie,oe]=s.useState(!1),[le,ce]=s.useState("logo"),{tap:ue,tapCount:de,isActive:pe}=function(e){const[t,a]=s.useState(0),[n,r]=s.useState(null),[i,o]=s.useState(!1),l=s.useRef([]),c=s.useRef(null),u=s.useCallback(()=>{l.current=[],a(0),r(null),o(!1),c.current&&(clearTimeout(c.current),c.current=null)},[]);return s.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),{bpm:n,tapCount:t,isActive:i,tap:s.useCallback(()=>{const t=performance.now();c.current&&clearTimeout(c.current);const n=l.current[l.current.length-1];n&&t-n>2e3&&(l.current=[]),l.current.push(t),o(!0),l.current.length>8&&(l.current=l.current.slice(-8));const s=l.current;if(a(s.length),s.length>=2){const t=[];for(let e=1;e<s.length;e++)t.push(s[e]-s[e-1]);const a=t.reduce((e,t)=>e+t,0)/t.length;let n=Math.round(6e4/a);n=Math.max(20,Math.min(999,n)),r(n),e&&e(n)}c.current=setTimeout(()=>{o(!1)},2e3)},[e]),reset:u}}(O),[he,me]=s.useState(!1),[fe,ge]=s.useState(!1),[ye,be]=s.useState(!1),[ve,xe]=s.useState(!1),[we,ke]=s.useState(!1),[Se,Ne]=s.useState(!1),[Ce,Ee]=s.useState(!!document.fullscreenElement),Pe=s.useCallback(()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("logo")+1)%e.length;ce(e[t])},[]);e.useEffect(()=>{const e=()=>{Ee(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),e.useEffect(()=>{},[]);const _e=s.useRef(null);e.useEffect(()=>{if(!he)return;const e=e=>{he&&_e.current&&!_e.current.contains(e.target)&&me(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[he]);const Te=()=>{try{const e=c.map(e=>e.id),t={};c.forEach(e=>{e.channels.forEach((a,n)=>{const s=ae.filter(t=>t.patternId===e.id&&t.channelIndex===n);s.length>0&&(t[e.id]||(t[e.id]={}),t[e.id][n]=s.reduce((e,t)=>(e[t.parameter]=t,e),{}))})}),BE(K,A,$,c,e,Object.keys(t).length>0?t:void 0,Z.length>0?Z:void 0,ae.length>0?ae:void 0,{prettify:!0},L),ty.success("Song downloaded!",2e3)}catch(e){ty.error("Failed to download file")}},Ae=async e=>{_&&j(),se.releaseAll(),oe(!0);try{let t,a;if(e.nativeData?.patterns){const{format:a,patterns:n,importMetadata:s,instruments:r}=e.nativeData,i=s.originalChannelCount,o=r?.map(e=>e.name)||[];if("XM"===a)t=eP(n,i,s,o,e.arrayBuffer);else if("MOD"===a)t=tP(n,i,s,o,e.arrayBuffer);else{if("FUR"!==a&&"DMF"!==a)return void ty.error(`Unsupported native format: ${a}`);{const e=s.modData?.patternOrderTable||[],a=n[0]?.length||64,r=s.originalChannelCount||n[0]?.[0]?.length||4;t={patterns:n.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:a,importMetadata:s,channels:Array.from({length:r},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:o}}}}else{if(!e.metadata.song)return void ty.error(`Module "${e.metadata.title}" has no pattern data`);t=JE(e.metadata.song)}if(e.nativeData?.instruments){const t=e.nativeData.instruments,n=e.nativeData.format;a=t.flatMap(e=>nP(e,e.id,n))}else a=i_(t.patterns,t.instrumentNames);q(a),y(t.patterns),t.order&&t.order.length>0&&(b(t.order),d(t.order[0])),H({name:e.metadata.title,author:"",description:`Imported from ${e.metadata.type}`});const n=e.nativeData?.importMetadata.modData?.initialBPM;n&&O(n);const s=e.nativeData?.importMetadata.modData?.initialSpeed;s&&D(s),ty.success(`Imported ${e.metadata.type}: ${e.metadata.title}`,3e3),await se.preloadInstruments(a)}catch(t){ty.error("Failed to import module")}finally{oe(!1)}},Oe=c[u],Ie=Oe?.length||64,De=c.length,Fe=_&&!T,Re=_&&T;return xa.jsxs("div",{className:"ft2-toolbar "+(J?"ft2-toolbar-compact":""),children:[xa.jsx("button",{className:"panel-collapse-toggle",onClick:ee,children:J?xa.jsx(Me,{size:12}):xa.jsx(xt,{size:12})}),xa.jsxs("div",{className:"flex min-w-0 overflow-hidden",children:[xa.jsxs("div",{className:"flex-shrink min-w-0",children:[xa.jsxs("div",{className:"ft2-toolbar-row",children:[xa.jsxs("div",{className:"ft2-section ft2-col-1",children:[xa.jsx(qN,{label:"Position",value:x,onChange:e=>{w(e)},min:0,max:v.length-1,format:"hex"}),xa.jsxs("div",{className:"flex gap-1 ml-auto",children:[xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>E(x),className:"min-w-[32px]",children:"Ins"}),xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>{v.length>1&&P(x)},disabled:v.length<=1,className:"min-w-[32px]",children:"Del"})]})]}),xa.jsxs("div",{className:"ft2-section ft2-col-2",children:[xa.jsx(qN,{label:"BPM",value:A,onChange:O,min:32,max:255,throttleMs:50}),xa.jsx(Dv,{variant:pe?"primary":"default",size:"sm",onClick:ue,title:`Tap Tempo (${de} taps)`,className:"min-w-[40px] ml-1",children:xa.jsx(Ut,{size:14})})]}),xa.jsx("div",{className:"ft2-section ft2-col-3",children:xa.jsx(qN,{label:"Pattern",value:v[x]??u,onChange:e=>{const t=[...v];t[x]=e,b(t),d(e)},min:0,max:c.length-1,format:"hex"})}),xa.jsx("div",{className:"ft2-section ft2-col-instrument",children:xa.jsx(JN,{})}),xa.jsxs("div",{className:"ft2-section ft2-section-playback",children:[xa.jsx(Dv,{variant:Fe?"danger":"primary",size:"sm",onClick:async()=>{_&&!T?j():(_&&j(),F(!1),await se.init(),R())},className:"min-w-[72px]",children:Fe?"Stop Song":"Play Song"}),xa.jsx(Dv,{variant:Re?"danger":"primary",size:"sm",onClick:async()=>{_&&T?j():(_&&j(),F(!0),await se.init(),R())},className:"min-w-[88px]",children:Re?"Stop Pattern":"Play Pattern"}),xa.jsx(Dv,{variant:k?"danger":"default",size:"sm",className:"min-w-[48px]",onClick:M,children:k?" Rec":"Rec"})]})]}),!J&&xa.jsxs("div",{className:"ft2-toolbar-row",children:[xa.jsx("div",{className:"ft2-section ft2-col-1",children:xa.jsx(qN,{label:"Song Len",value:De,onChange:e=>{const t=c.length;if(e>t)for(let a=t;a<e;a++)h(Ie);else if(e<t&&e>=1)for(let a=t-1;a>=e;a--)p(a)},min:1,max:256,format:"hex"})}),xa.jsxs("div",{className:"ft2-section ft2-col-2",children:[xa.jsx(qN,{label:"Speed",value:I,onChange:D,min:1,max:31,format:"hex"}),xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>ge(!0),title:`Groove & Swing Settings (Current: ${Bn.find(e=>e.id===L)?.name||"None"})`,className:"min-w-[32px] ml-1 "+("straight"!==L||V!==(U?50:100)||z>0?"text-accent-primary font-bold shadow-glow-sm border-accent-primary/50":""),children:"Groove"}),fe&&xa.jsx(NC,{onClose:()=>ge(!1)})]}),xa.jsx("div",{className:"ft2-section ft2-col-3",children:xa.jsx(qN,{label:"Length",value:Ie,onChange:e=>{e>=1&&e<=256&&g(u,e)},min:1,max:256,format:"hex",presets:[{label:"16 rows",value:16},{label:"32 rows",value:32},{label:"48 rows",value:48},{label:"64 rows (default)",value:64},{label:"96 rows",value:96},{label:"128 rows",value:128},{label:"192 rows",value:192},{label:"256 rows (max)",value:256}]})}),xa.jsx("div",{className:"ft2-section ft2-col-4"})]}),!J&&xa.jsxs("div",{className:"ft2-toolbar-row",children:[xa.jsx("div",{className:"ft2-section ft2-col-1",children:xa.jsx(qN,{label:"Edit Step",value:S,onChange:N,min:0,max:16,format:"hex"})}),xa.jsx("div",{className:"ft2-section ft2-col-2",children:xa.jsxs("div",{className:"ft2-numeric-group",children:[xa.jsx("span",{className:"ft2-numeric-label",children:"Modify:"}),xa.jsxs("div",{className:"flex gap-1 ml-1",children:[xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>m?.(u),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Expand"}),xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>f?.(u),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Shrink"})]})]})}),xa.jsx("div",{className:"ft2-section ft2-col-3"}),xa.jsx("div",{className:"ft2-section ft2-col-4"})]}),xa.jsx("div",{className:"ft2-toolbar-row ft2-toolbar-row-menu",children:xa.jsxs("div",{className:"ft2-section",children:[xa.jsx("input",{ref:re,type:"file",accept:r_,onChange:async e=>{const t=e.target.files?.[0];if(t)if(e.target.value="",bN(t.name))xe(!0);else{_&&(j(),se.releaseAll()),oe(!0);try{if(t.name.toLowerCase().endsWith(".xml")){const e=await t.text(),a=t.name.replace(".xml","")||"Imported Pattern",{pattern:n}=e_(e,a),s=[...c,n];return y(s),d(s.length-1),ty.success(`Loaded DB303 pattern: ${n.name}`),void oe(!1)}if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return".mid"===t||".midi"===t}(t.name)){const e=await YP(t,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64}),a=i_(e.patterns,[]);y(e.patterns),q(a),H({name:e.metadata.name,author:"",description:`Imported from ${t.name} (${e.metadata.tracks} tracks)`}),O(e.bpm),ty.success(`Loaded MIDI: ${e.metadata.name}`)}else{const e=await UE(t);if(!e)return void ty.error("Failed to import song");const{needsMigration:a,migrateProject:n}=await _a(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>kg);return{needsMigration:e,migrateProject:t}},void 0);let s=e.patterns,r=e.instruments;if(a(s,r)){const e=n(s,r);s=e.patterns,r=e.instruments}if(y(s),e.sequence&&Array.isArray(e.sequence)){const t=new Map(s.map((e,t)=>[e.id,t])),a=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);a.length>0&&b(a)}r&&q(r),e.masterEffects&&Lg.getState().setMasterEffects(e.masterEffects),O(e.bpm),H(e.metadata),B(e.grooveTemplateId||"straight"),ty.success(`Loaded: ${e.metadata?.name||t.name}`)}}catch(a){ty.error(`Failed to load ${t.name}`)}finally{oe(!1)}}},className:"hidden"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>ke(!0),disabled:ie,loading:ie,children:"Load"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:Te,children:W?"Save*":"Save"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:Te,children:"Download"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:t,children:"Export"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>ne(),icon:xa.jsx(Gt,{size:14}),iconPosition:"left",children:"New"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>Ne(!0),children:"Clear"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:i,children:"Order"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:r,children:"Instruments"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:o,children:"Pads"}),xa.jsx(Dv,{variant:l?"primary":"ghost",size:"sm",onClick:n,children:"Master FX"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:a,children:"Help"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>be(!0),children:"Settings"}),xa.jsx(Dv,{variant:Ce?"primary":"ghost",size:"sm",onClick:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},title:Ce?"Exit Fullscreen (F11)":"Enter Fullscreen (F11)",children:Ce?xa.jsx(At,{size:14}):xa.jsx(Tt,{size:14})})]})})]}),xa.jsxs("div",{className:"flex-1 min-w-[120px] flex items-center justify-center border-l border-dark-border px-2 cursor-pointer relative group bg-black overflow-hidden rounded-[6px] m-1",onClick:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf(le)+1)%e.length;ce(e[t])},children:[xa.jsxs("div",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-text-muted opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["v",Pb]}),te&&xa.jsxs(xa.Fragment,{children:[("waveform"===le||"spectrum"===le)&&xa.jsx(eC,{width:"auto",height:J?70:100,mode:le}),"channels"===le&&xa.jsx(tC,{height:J?70:100}),"logo"===le&&xa.jsx(aC,{height:J?70:100,onComplete:Pe}),"circular"===le&&xa.jsx(nC,{height:J?70:100}),"bars"===le&&xa.jsx(sC,{height:J?70:100}),"particles"===le&&xa.jsx(rC,{height:J?70:100}),"chanWaves"===le&&xa.jsx(iC,{height:J?70:100}),"chanActivity"===le&&xa.jsx(oC,{height:J?70:100}),"chanSpectrum"===le&&xa.jsx(lC,{height:J?70:100}),"chanCircular"===le&&xa.jsx(cC,{height:J?70:100}),"chanParticles"===le&&xa.jsx(uC,{height:J?70:100}),"chanRings"===le&&xa.jsx(dC,{height:J?70:100}),"chanTunnel"===le&&xa.jsx(pC,{height:J?70:100}),"chanRadar"===le&&xa.jsx(hC,{height:J?70:100}),"chanNibbles"===le&&xa.jsx(wC,{height:J?70:100,onExit:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("chanNibbles")+1)%e.length;ce(e[t])}}),"sineScroll"===le&&xa.jsx(kC,{height:J?70:100})]})]})]}),ye&&xa.jsx(MC,{onClose:()=>be(!1)}),xa.jsx(wN,{isOpen:ve,onClose:()=>xe(!1),onImport:Ae}),xa.jsx(jE,{isOpen:we,onClose:()=>ke(!1),mode:"load",onLoad:async(e,t)=>{_&&(j(),se.releaseAll());try{if("string"==typeof e&&t.toLowerCase().endsWith(".xml"))try{const a=e.includes("<db303-preset"),n=e.includes("<db303-pattern");if(a){const{parseDb303Preset:a}=await _a(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-BMwWFetk.js");return{parseDb303Preset:e}},[]),n=a(e);let s=$.find(e=>"TB303"===e.synthType);if(!s){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();Y(t),s=t}const r={...s.tb303,...n};X(s.id,{tb303:r});$.find(e=>e.id===s.id);return void ty.success(`Loaded DB303 preset: ${t.replace(".xml","")}`)}if(n){const a=t.replace(".xml","")||"Imported Pattern";let n=$.find(e=>"TB303"===e.synthType);if(!n){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();Y(t),n=t}const{pattern:s,tempo:r}=e_(e,a,n.id);s.channels[0].instrumentId=n.id;const i=[...c,s];return y(i),d(i.length-1),b([i.length-1]),void 0!==r&&O(r),void ty.success(`Loaded DB303 pattern: ${s.name} (${s.length} steps${r?`, ${r} BPM`:""})`)}return void ty.error("Unknown XML format. Expected db303-pattern or db303-preset.")}catch(a){return void ty.error(`Failed to parse XML: ${a instanceof Error?a.message:"Unknown error"}`)}const{needsMigration:n,migrateProject:s}=await _a(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>kg);return{needsMigration:e,migrateProject:t}},void 0);let r=e.patterns,i=e.instruments;if(n(r,i)){const e=s(r,i);r=e.patterns,i=e.instruments}if(r&&(y(r),e.sequence&&Array.isArray(e.sequence))){const t=new Map(r.map((e,t)=>[e.id,t])),a=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);a.length>0&&b(a)}i&&q(i),e.metadata&&H(e.metadata),e.bpm&&O(e.bpm),B(e.grooveTemplateId||"straight"),ty.success(`Loaded: ${e.metadata?.name||t}`)}catch(n){ty.error("Failed to load file")}},onLoadTrackerModule:async(e,t)=>{_&&(j(),se.releaseAll());try{const a=t.toLowerCase();if(a.endsWith(".sqs")||a.endsWith(".seq")){const{parseTD3File:t}=await _a(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:a}=await _a(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-Cc64HjVE.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{loadPatterns:n,setCurrentPattern:s,setPatternOrder:r}=tf.getState(),{instruments:i,addInstrument:o}=Pg.getState();let l=i.find(e=>"TB303"===e.synthType);if(!l){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();o(t),l=t}const c=await t(e);if(0===c.patterns.length)return void ty.error("No patterns found in file");const u=l.id,d=c.patterns.map((e,t)=>{const n=a(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${l.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:l.id,color:"#ec4899",rows:n.slice(0,s).map(e=>({...e,instrument:e.note?u:0}))}]}});n(d),s(0),r(d.map((e,t)=>t)),ty.success(`Imported ${d.length} TD-3 pattern(s)`)}else{const{loadModuleFile:a}=await _a(async()=>{const{loadModuleFile:e}=await Promise.resolve().then(()=>xN);return{loadModuleFile:e}},void 0),n=await a(new File([e],t));n&&await Ae(n)}}catch(a){ty.error("Failed to load file")}}}),Se&&xa.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60",children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl",children:[xa.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Clear Project"}),xa.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"What would you like to clear?"}),xa.jsxs("div",{className:"flex flex-col gap-2",children:[xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>{_&&(j(),se.releaseAll()),Q(),Ne(!1),ty.success("Instruments cleared")},children:"Clear Instruments"}),xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>{_&&(j(),se.releaseAll()),C(),Ne(!1),ty.success("Song data cleared")},children:"Clear Song Data"}),xa.jsx(Dv,{variant:"default",size:"sm",onClick:()=>{_&&(j(),se.releaseAll()),Q(),C(),Ne(!1),ty.success("Project cleared")},children:"Clear Both"}),xa.jsx(Dv,{variant:"danger",size:"sm",onClick:()=>{_&&(j(),se.releaseAll()),Q(),C(),G(),Ne(!1),ty.success("Reset to defaults")},children:"Reset to Defaults"}),xa.jsx(Dv,{variant:"ghost",size:"sm",onClick:()=>Ne(!1),children:"Cancel"})]})]})})]})},l_=200,c_=s.memo(({config:e,onChange:t,onPresetLoad:a,isBuzz3o3:n=!1})=>{const r=s.useRef(null),[i,o]=s.useState({mods:!1,lfo:!1,effects:!1}),l=s.useRef(e);l.current=e;const[c,u]=s.useState(1200);s.useLayoutEffect(()=>{const e=()=>{if(r.current?.parentElement){const e=r.current.parentElement.clientWidth-32;u(Math.max(1e3,e))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const d=(e,a)=>{t({filter:{...l.current.filter,[e]:a}})},p=(e,a)=>{t({filterEnvelope:{...l.current.filterEnvelope,[e]:a}})},h=(e,a)=>{const n=l.current.devilFish||{enabled:!1,normalDecay:.5,accentDecay:.5,vegDecay:.5,vegSustain:0,softAttack:0,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"};t({devilFish:{...n,[e]:a}})},m=(e,a)=>{t({oscillator:{...l.current.oscillator,[e]:a}})},f=(e,a)=>{const n=l.current.lfo||{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0};t({lfo:{...n,[e]:a}})},g=(e,a)=>{const n=l.current.chorus||{enabled:!1,mode:1,mix:.3};t({chorus:{...n,[e]:a}})},y=(e,a)=>{const n=l.current.phaser||{enabled:!1,rate:.5,depth:.5,feedback:.3,mix:.3};t({phaser:{...n,[e]:a}})},b=(e,a)=>{const n=l.current.delay||{enabled:!1,time:.25,feedback:.3,tone:.7,mix:.25,stereo:.5};t({delay:{...n,[e]:a}})},v=({label:e,expanded:t,onToggle:a,x:n,y:s,width:r,colorClass:i="text-accent-primary"})=>xa.jsx("div",{style:{left:`${n}px`,top:`${s}px`,width:`${r}px`,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",zIndex:10,pointerEvents:"auto"},onClick:a,className:"group",children:xa.jsxs("div",{className:Wt("flex items-center gap-2 px-4 py-1.5 rounded-full bg-black/60 border border-white/10 group-hover:border-white/30 group-hover:bg-black/80 transition-all shadow-lg",i,t?"opacity-100":"opacity-70"),children:[t?xa.jsx(Me,{size:14}):xa.jsx(De,{size:14}),xa.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.15em]",children:e})]})}),x=(e,t,a,n,s=0)=>({left:`${e}px`,top:`${t+s}px`,width:`${a}px`,height:`${n}px`,position:"absolute"}),w=(e,t,a,n=0)=>({left:`${e}px`,top:`${t+n}px`,width:`${a}px`,position:"absolute",textAlign:"center",fontSize:"10px",fontWeight:"bold",color:"#888",textTransform:"uppercase",letterSpacing:"0.08em"}),k=40,S=230,M=165,N=i.mods,C=!n&&i.lfo,E=!n&&i.effects,P=N?0:-230,_=P+(C?0:-165),T=325+(N?S:0)+(n?0:k+(C?M:0))+(n?0:k+(E?175:0));return xa.jsx("div",{ref:r,className:"w-full overflow-visible flex justify-center py-4 select-none",style:{minHeight:`${T+32}px`,transition:"min-height 0.3s ease-out"},children:xa.jsxs("div",{className:"relative bg-[#1a1a1a] rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border-b-8 border-r-4 border-black/40 overflow-hidden",style:{width:`${c}px`,height:`${T}px`,background:"linear-gradient(180deg, #252525 0%, #1a1a1a 100%)",transition:"all 0.3s ease-out"},children:[xa.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[xa.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-black/20"}),xa.jsx("div",{className:"absolute top-[110px] left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]"}),xa.jsx("div",{style:w(40,115,400),className:"text-accent-primary opacity-80",children:"Filter & Envelope"}),xa.jsx("div",{style:w(670,115,80),className:"text-accent-primary opacity-80",children:"Output"}),xa.jsx("div",{style:{...w(c-360,115,320),textAlign:"right",paddingRight:"20px"},className:"text-cyan-400 opacity-80",children:"Oscillator"}),xa.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:"285px"}}),xa.jsx(v,{label:"Modifications",expanded:N,onToggle:()=>o(e=>({...e,mods:!e.mods})),x:40,y:292,width:c-80,colorClass:"text-red-500"}),!n&&xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${325+(N?S:0)}px`,transition:"top 0.3s ease-out"}}),xa.jsx(v,{label:"LFO (Modulation)",expanded:i.lfo,onToggle:()=>o(e=>({...e,lfo:!e.lfo})),x:40,y:332+(N?S:0),width:c-80,colorClass:"text-purple-500"})]}),!n&&xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${325+(N?S:0)+k+(C?M:0)}px`,transition:"top 0.3s ease-out"}}),xa.jsx(v,{label:"Built-in Effects",expanded:i.effects,onToggle:()=>o(e=>({...e,effects:!e.effects})),x:40,y:332+(N?S:0)+k+(C?M:0),width:c-80,colorClass:"text-green-500"})]})]}),xa.jsx("div",{style:x(40,145,65,80),children:xa.jsx(Tv,{value:e.tuning??.5,min:0,max:1,defaultValue:.5,bipolar:!0,onChange:e=>{t({tuning:e})},label:"Tune",size:"md",color:"#ffcc00",formatValue:e=>(e-.5>0?"+":"")+Math.round(100*(e-.5))+"c"})}),xa.jsx("div",{style:x(145,145,65,80),children:xa.jsx(Tv,{value:e.filter.cutoff,min:0,max:1,defaultValue:.5,onChange:e=>d("cutoff",e),label:"Cutoff",size:"md",color:"#ffcc00",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"})}),xa.jsx("div",{style:x(250,145,65,80),children:xa.jsx(Tv,{value:e.filter.resonance,min:0,max:1,defaultValue:0,onChange:e=>d("resonance",e),label:"Reso",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(355,145,65,80),children:xa.jsx(Tv,{value:e.filterEnvelope.envMod,min:0,max:1,defaultValue:.5,onChange:e=>p("envMod",e),label:"EnvMod",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(460,145,65,80),children:xa.jsx(Tv,{value:e.filterEnvelope.decay,min:0,max:1,defaultValue:.5,onChange:e=>p("decay",e),label:"Decay",size:"md",color:"#ffcc00",formatValue:e=>Math.round(l_*Math.pow(10,e))+" ms"})}),xa.jsx("div",{style:x(565,145,65,80),children:xa.jsx(Tv,{value:e.accent.amount,min:0,max:1,defaultValue:.5,onChange:e=>{return a="amount",n=e,void t({accent:{...l.current.accent,[a]:n}});var a,n},label:"Accent",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(670,145,65,80),children:xa.jsx(Tv,{value:e.volume??.75,min:0,max:1,defaultValue:.75,onChange:e=>t({volume:e}),label:"Level",size:"md",color:"#00ffff",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsxs("div",{style:{...x(c-360,145,320,80),display:"flex",alignItems:"center",gap:"12px",justifyContent:"flex-end",paddingRight:"20px"},children:[xa.jsx("div",{style:{width:"65px"},children:xa.jsx(Tv,{value:e.oscillator.pulseWidth??1,min:0,max:1,defaultValue:1,onChange:e=>m("pulseWidth",e),label:"PWM",size:"md",color:"#00cccc",formatValue:e=>Math.round(50+49*e)+"%"})}),xa.jsx("div",{style:{width:"65px"},children:xa.jsx(Tv,{value:e.oscillator.subOscGain??0,min:0,max:1,defaultValue:0,onChange:e=>m("subOscGain",e),label:"SubG",size:"md",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:{width:"65px"},children:xa.jsx(Tv,{value:e.oscillator.subOscBlend??1,min:0,max:1,defaultValue:1,onChange:e=>m("subOscBlend",e),label:"SubB",size:"md",color:"#00cccc",formatValue:e=>e<.5?"Mix":"Add"})}),xa.jsx("div",{style:{width:"65px"},children:xa.jsx(Tv,{value:e.oscillator.pitchToPw??0,min:0,max:1,defaultValue:0,onChange:e=>m("pitchToPw",e),label:"PPW",size:"md",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsxs("div",{className:"flex flex-col items-center justify-center",style:{minWidth:"60px"},children:[xa.jsx("span",{className:Wt("text-[9px] font-bold mb-1 transition-colors","sawtooth"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SAW"}),xa.jsx(SC,{label:"",value:"square"===e.oscillator.type,onChange:e=>{return a=e?"square":"sawtooth",void t({oscillator:{...l.current.oscillator,type:a}});var a},color:"#00ffff",size:"sm"}),xa.jsx("span",{className:Wt("text-[9px] font-bold mt-1 transition-colors","square"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SQR"})]})]}),N&&xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{style:x(52,325,50,45),className:"flex flex-col items-center",children:[xa.jsx(SC,{label:"",value:e.devilFish?.enabled||!1,onChange:e=>h("enabled",e),color:"#ff3333",size:"sm"}),xa.jsx("span",{className:"text-[8px] font-bold text-red-500 mt-1",children:"ENABLE"})]}),xa.jsx("div",{style:x(82,295,12,12),className:Wt("rounded-full border border-black/40 transition-all duration-300",e.devilFish?.enabled?"bg-red-500 shadow-[0_0_10px_#ef4444]":"bg-red-950")}),xa.jsx("div",{style:x(125,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.normalDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("normalDecay",e),label:"N.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(l_*Math.pow(10,e))+" ms"})}),xa.jsx("div",{style:x(195,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.accentDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("accentDecay",e),label:"A.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(l_*Math.pow(10,e))+" ms"})}),xa.jsx("div",{style:x(265,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.softAttack??0,min:0,max:1,defaultValue:0,onChange:e=>h("softAttack",e),label:"S.Atk",size:"sm",color:"#ff3333",formatValue:e=>(.3*Math.pow(100,e)).toFixed(1)+" ms"})}),xa.jsx("div",{style:x(335,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.accentSoftAttack??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("accentSoftAttack",e),label:"A.Atk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(405,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.passbandCompensation??.9,min:0,max:1,defaultValue:.9,onChange:e=>h("passbandCompensation",e),label:"Comp",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(475,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.resTracking??.7,min:0,max:1,defaultValue:.7,onChange:e=>h("resTracking",e),label:"R.Trk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(545,325,40,40),children:xa.jsx(Tv,{value:e.slide?.time??.17,min:0,max:1,defaultValue:.17,onChange:e=>{t({slide:{...l.current.slide,time:e}})},label:"Slide",size:"sm",color:"#ff3333",formatValue:e=>Math.round(2*Math.pow(180,e))+" ms"})}),xa.jsx("div",{style:x(615,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.filterInputDrive??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterInputDrive",e),label:"Drive",size:"sm",color:"#ff3333",formatValue:e=>(10*e).toFixed(1)})}),xa.jsx("div",{style:x(680,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.diodeCharacter??0,min:0,max:1,defaultValue:0,onChange:e=>h("diodeCharacter",e),label:"Diode",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(740,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.duffingAmount??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>h("duffingAmount",e),label:"Duff",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(800,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.filterFmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterFmDepth",e),label:"F.FM",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(860,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.lpBpMix??0,min:0,max:1,defaultValue:0,onChange:e=>h("lpBpMix",e),label:"LP/BP",size:"sm",color:"#ff9900",formatValue:e=>e<.05?"LP":e>.95?"BP":"Mix"})}),xa.jsx("div",{style:x(920,325,40,40),children:xa.jsx(Tv,{value:e.devilFish?.filterTracking??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterTracking",e),label:"K.Trk",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsxs("div",{style:x(980,320,80,50),className:"flex flex-col",children:[xa.jsx("label",{className:"text-[8px] font-bold text-orange-500/70 mb-1 ml-1",children:"FILTER"}),xa.jsxs("select",{value:e.devilFish?.filterSelect??1,onChange:e=>h("filterSelect",parseInt(e.target.value)),className:"bg-[#111] text-[10px] text-orange-400 border border-orange-900/30 rounded px-1 py-1 outline-none focus:border-orange-500",children:[xa.jsx("option",{value:1,children:"303 Lowpass"}),xa.jsx("option",{value:5,children:"Korg Ladder"})]})]}),xa.jsx("div",{style:w(40,380,200),className:"text-cyan-400/60 text-[9px]",children:"KORG FILTER"}),xa.jsx("div",{style:x(60,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.korgBite??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgBite",e),label:"Bite",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),xa.jsx("div",{style:x(120,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.korgClip??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgClip",e),label:"Clip",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),xa.jsx("div",{style:x(180,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.korgCrossmod??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgCrossmod",e),label:"XMod",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),xa.jsx("div",{style:x(240,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.korgQSag??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgQSag",e),label:"Q.Sag",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),xa.jsx("div",{style:x(300,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.korgSharpness??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("korgSharpness",e),label:"Sharp",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),xa.jsx("div",{style:w(400,380,200),className:"text-yellow-400/60 text-[9px]",children:"EXTRAS"}),xa.jsx("div",{style:x(420,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.stageNLAmount??0,min:0,max:1,defaultValue:0,onChange:e=>h("stageNLAmount",e),label:"StgNL",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(480,395,40,40),children:xa.jsx(Tv,{value:e.devilFish?.ensembleAmount??0,min:0,max:1,defaultValue:0,onChange:e=>h("ensembleAmount",e),label:"Ensem",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:w(560,380,200),className:"text-gray-400/60 text-[9px]",children:"QUALITY"}),xa.jsxs("div",{style:x(580,390,90,45),className:"flex flex-col",children:[xa.jsx("label",{className:"text-[8px] font-bold text-gray-400/70 mb-1",children:"OVERSAMPLE"}),xa.jsxs("select",{value:e.devilFish?.oversamplingOrder??0,onChange:e=>h("oversamplingOrder",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-gray-300 border border-gray-700 rounded px-1 py-0.5 outline-none focus:border-gray-500",children:[xa.jsx("option",{value:0,children:"Off"}),xa.jsx("option",{value:1,children:"2"}),xa.jsx("option",{value:2,children:"4"}),xa.jsx("option",{value:3,children:"8"}),xa.jsx("option",{value:4,children:"16"})]})]})]}),C&&xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{style:x(60,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.rate??0,min:0,max:1,defaultValue:0,onChange:e=>f("rate",e),label:"Rate",size:"md",color:"#a855f7",formatValue:e=>{const t=.05*Math.pow(400,e);return t>=10?t.toFixed(1)+"Hz":t.toFixed(2)+"Hz"}})}),xa.jsx("div",{style:x(170,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.contour??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>f("contour",e),label:"Contour",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(280,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.pitchDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("pitchDepth",e),label:"Pitch",size:"md",color:"#a855f7",formatValue:e=>"+"+Math.round(12*e)+" semi"})}),xa.jsx("div",{style:x(390,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.pwmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("pwmDepth",e),label:"PWM",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(500,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.filterDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("filterDepth",e),label:"Filter",size:"md",color:"#a855f7",formatValue:e=>"+"+(2*e).toFixed(1)+" oct"})}),xa.jsx("div",{style:x(610,480,65,65,P),children:xa.jsx(Tv,{value:e.lfo?.stiffDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("stiffDepth",e),label:"Stiff",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(720,483,150,50,P),className:"flex gap-2 items-center",children:[0,1,2].map(t=>xa.jsx("button",{onClick:()=>f("waveform",t),className:Wt("px-2 py-1 text-[10px] font-bold rounded border transition-all",e.lfo?.waveform===t?"bg-purple-500 text-white border-purple-400":"bg-black/40 text-purple-500/60 border-purple-900/30"),children:["SIN","TRI","SQR"][t]},t))})]}),E&&xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{style:w(40,615,120,_),className:"text-green-400/60 text-[10px]",children:"CHORUS"}),xa.jsx("div",{style:x(60,635,40,40,_),children:xa.jsx(SC,{value:e.chorus?.enabled??!1,onChange:e=>g("enabled",e),label:"On",size:"sm"})}),xa.jsxs("div",{style:x(100,632,50,45,_),className:"flex flex-col",children:[xa.jsxs("select",{value:e.chorus?.mode??1,onChange:e=>g("mode",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-green-400 border border-green-900/30 rounded px-1 py-0.5 outline-none focus:border-green-500",children:[xa.jsx("option",{value:0,children:"Subtle"}),xa.jsx("option",{value:1,children:"Medium"}),xa.jsx("option",{value:2,children:"Wide"})]}),xa.jsx("span",{className:"text-[7px] text-gray-500 mt-0.5 text-center",children:"MODE"})]}),xa.jsx("div",{style:x(155,635,40,40,_),children:xa.jsx(Tv,{value:e.chorus?.mix??.5,min:0,max:1,defaultValue:.5,onChange:e=>g("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:w(200,615,120,_),className:"text-green-400/60 text-[10px]",children:"PHASER"}),xa.jsx("div",{style:x(220,635,40,40,_),children:xa.jsx(Tv,{value:e.phaser?.rate??.5,min:0,max:1,defaultValue:.5,onChange:e=>y("rate",e),label:"Rate",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(270,635,40,40,_),children:xa.jsx(Tv,{value:e.phaser?.depth??.7,min:0,max:1,defaultValue:.7,onChange:e=>y("depth",e),label:"Width",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(320,635,40,40,_),children:xa.jsx(Tv,{value:e.phaser?.feedback??0,min:0,max:1,defaultValue:0,onChange:e=>y("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(370,635,40,40,_),children:xa.jsx(Tv,{value:e.phaser?.mix??0,min:0,max:1,defaultValue:0,onChange:e=>y("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:w(460,615,120,_),className:"text-green-400/60 text-[10px]",children:"DELAY"}),xa.jsx("div",{style:x(480,635,40,40,_),children:xa.jsx(Tv,{value:e.delay?.time??.5,min:0,max:1,defaultValue:.5,onChange:e=>b("time",e),label:"Time",size:"sm",color:"#22c55e",formatValue:e=>(.25+15.75*e).toFixed(2)})}),xa.jsx("div",{style:x(530,635,40,40,_),children:xa.jsx(Tv,{value:e.delay?.feedback??0,min:0,max:1,defaultValue:0,onChange:e=>b("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(580,635,40,40,_),children:xa.jsx(Tv,{value:e.delay?.tone??.5,min:0,max:1,defaultValue:.5,onChange:e=>b("tone",e),label:"Tone",size:"sm",color:"#22c55e",formatValue:e=>e<.4?"LP":e>.6?"HP":"Bypass"})}),xa.jsx("div",{style:x(630,635,40,40,_),children:xa.jsx(Tv,{value:e.delay?.mix??0,min:0,max:1,defaultValue:0,onChange:e=>b("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),xa.jsx("div",{style:x(680,635,40,40,_),children:xa.jsx(Tv,{value:e.delay?.stereo??.75,min:0,max:1,defaultValue:.75,onChange:e=>b("stereo",e),label:"Spread",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})})]}),xa.jsxs("div",{className:"absolute top-4 left-6 flex items-center gap-4",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("div",{className:"bg-accent-primary p-1 rounded",children:xa.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"3",children:xa.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),xa.jsxs("div",{className:"flex flex-col -space-y-1",children:[xa.jsx("span",{className:"text-white font-black italic text-xl tracking-tighter",children:"DB-303"}),xa.jsx("span",{className:"text-[8px] text-gray-500 font-bold uppercase tracking-widest",children:"TB-303 WASM Engine"})]})]}),xa.jsx("div",{className:"h-8 w-px bg-gray-800"}),xa.jsxs("div",{className:"flex flex-col",children:[xa.jsx("label",{className:"text-[8px] font-bold text-gray-500 mb-1",children:"PRESET"}),xa.jsxs("select",{value:"",onChange:e=>{const n=nf.find(t=>t.name===e.target.value);n&&(a?a(n):n.tb303&&t(n.tb303))},className:"bg-[#111] text-[10px] text-accent-primary border border-gray-800 rounded px-2 py-1 outline-none focus:border-accent-primary transition-colors max-w-[160px]",children:[xa.jsx("option",{value:"",disabled:!0,children:"Load Preset..."}),nf.map(e=>xa.jsxs("option",{value:e.name,children:[e.name,e.effects?.length?` [${e.effects.length} FX]`:""]},e.name))]})]})]}),xa.jsxs("div",{className:"absolute bottom-2 right-4 text-[8px] text-gray-600 font-mono",children:["V",Pb,"-WASM"]})]})})});c_.displayName="JC303StyledKnobPanel";const u_=s.memo(()=>{const{instruments:e,updateInstrument:t}=Pg(Da(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument}))),{tb303Collapsed:a,toggleTB303Collapsed:n}=Tg(Da(e=>({tb303Collapsed:e.tb303Collapsed,toggleTB303Collapsed:e.toggleTB303Collapsed}))),{controlledInstrumentId:r}=ky(),i=r?e.find(e=>e.id===r&&"TB303"===e.synthType):e.find(e=>"TB303"===e.synthType),o=s.useCallback(async e=>{if(!i)return;const a={...i.tb303,...e};t(i.id,{tb303:a});const{getToneEngine:n}=await _a(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>$m);return{getToneEngine:e}},void 0),s=n().getInstrument(i.id,i);s&&"setCutoff"in s&&Object.entries(e).forEach(([e,t])=>{if(!t||"object"!=typeof t)return void("tuning"===e?s.setTuning(t):"volume"===e&&s.setVolume(t));const a=t;"filter"===e?("cutoff"in a&&s.setCutoff(a.cutoff),"resonance"in a&&s.setResonance(a.resonance)):"filterEnvelope"===e?("envMod"in a&&s.setEnvMod(a.envMod),"decay"in a&&s.setDecay(a.decay)):"accent"===e?"amount"in a&&s.setAccent(a.amount):"oscillator"===e?("type"in a&&s.setWaveform("square"===a.type?1:0),"pulseWidth"in a&&s.setPulseWidth(a.pulseWidth),"subOscGain"in a&&s.setSubOscGain(a.subOscGain),"subOscBlend"in a&&s.setSubOscBlend(a.subOscBlend),"pitchToPw"in a&&s.setPitchToPw(a.pitchToPw)):"slide"===e?"time"in a&&s.setSlideTime(a.time):"devilFish"===e?("enabled"in a&&s.enableDevilFish(a.enabled),"normalDecay"in a&&s.setNormalDecay(a.normalDecay),"accentDecay"in a&&s.setAccentDecay(a.accentDecay),"softAttack"in a&&s.setSoftAttack(a.softAttack),"accentSoftAttack"in a&&s.setAccentSoftAttack(a.accentSoftAttack),"passbandCompensation"in a&&s.setPassbandCompensation(a.passbandCompensation),"resTracking"in a&&s.setResTracking(a.resTracking),"filterInputDrive"in a&&s.setFilterInputDrive(a.filterInputDrive),"diodeCharacter"in a&&s.setDiodeCharacter(a.diodeCharacter),"duffingAmount"in a&&s.setDuffingAmount(a.duffingAmount),"filterFmDepth"in a&&s.setFilterFmDepth(a.filterFmDepth),"lpBpMix"in a&&s.setLpBpMix(a.lpBpMix),"filterTracking"in a&&s.setFilterTracking(a.filterTracking),"filterSelect"in a&&s.setFilterSelect(a.filterSelect),"korgBite"in a&&s.setKorgBite(a.korgBite),"korgClip"in a&&s.setKorgClip(a.korgClip),"korgCrossmod"in a&&s.setKorgCrossmod(a.korgCrossmod),"korgQSag"in a&&s.setKorgQSag(a.korgQSag),"korgSharpness"in a&&s.setKorgSharpness(a.korgSharpness),"stageNLAmount"in a&&s.setStageNLAmount(a.stageNLAmount),"ensembleAmount"in a&&s.setEnsembleAmount(a.ensembleAmount),"oversamplingOrder"in a&&s.setOversamplingOrder(a.oversamplingOrder)):"lfo"===e?("waveform"in a&&s.setLfoWaveform(a.waveform),"rate"in a&&s.setLfoRate(a.rate),"contour"in a&&s.setLfoContour(a.contour),"pitchDepth"in a&&s.setLfoPitchDepth(a.pitchDepth),"pwmDepth"in a&&s.setLfoPwmDepth(a.pwmDepth),"filterDepth"in a&&s.setLfoFilterDepth(a.filterDepth),"stiffDepth"in a&&s.setLfoStiffDepth(a.stiffDepth)):"chorus"===e?("mode"in a&&s.setChorusMode(a.mode),"mix"in a&&s.setChorusMix(a.mix)):"phaser"===e?("rate"in a&&s.setPhaserRate(a.rate),"depth"in a&&s.setPhaserWidth(a.depth),"feedback"in a&&s.setPhaserFeedback(a.feedback),"mix"in a&&s.setPhaserMix(a.mix)):"delay"===e&&("time"in a&&s.setDelayTime(a.time),"feedback"in a&&s.setDelayFeedback(a.feedback),"tone"in a&&s.setDelayTone(a.tone),"mix"in a&&s.setDelayMix(a.mix),"stereo"in a&&s.setDelaySpread(a.stereo))})},[i,t]),l=s.useCallback(async e=>{if(i&&(e.tb303&&o(e.tb303),void 0!==e.effects)){const a=e.effects.map((e,t)=>({...e,id:e.id||`tb303-fx-${Date.now()}-${t}`}));t(i.id,{effects:a});const{getToneEngine:n}=await _a(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>$m);return{getToneEngine:e}},void 0),s=n();await s.rebuildInstrumentEffects(i.id,a)}},[i,o,t]);return i&&i.tb303?a?xa.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[xa.jsx("div",{className:"absolute top-0 right-0 z-50",children:xa.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:n,title:"Expand synth panel",children:xa.jsx(Me,{size:16})})}),xa.jsxs("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[xa.jsx("span",{className:"font-bold",children:"TB-303"}),xa.jsxs("span",{className:"text-gray-500",children:["CH",String(e.indexOf(i)+1).padStart(2,"0")]}),xa.jsx("span",{className:"text-gray-400",children:i.name})]})]}):xa.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",maxHeight:"400px",background:"#1a1a1a",borderTop:"1px solid #333",overflow:"auto"},children:[xa.jsxs("div",{className:"sticky top-0 right-0 z-50 flex justify-end gap-1 bg-black/80 p-1",children:[xa.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80",onClick:n,title:"Collapse synth panel",children:xa.jsx(xt,{size:16})}),xa.jsx("button",{className:"p-2 text-gray-400 hover:text-red-400 bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:()=>Tg.getState().setTB303Collapsed(!0),title:"Close synth panel",children:xa.jsx(Ee,{size:16})})]}),xa.jsx("div",{children:xa.jsx(c_,{config:i.tb303,onChange:o,onPresetLoad:l},i.id)})]}):null});u_.displayName="TB303KnobPanel";const d_=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],p_=[1,3,6,8,10],h_=({step:e,stepIndex:t,position:a,onChange:n,onClose:r,onNavigate:i,unitId:o=1})=>{const[l,c]=s.useState(!0),u=s.useRef(null);s.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]);const d=s.useCallback(t=>{if(n({note:t}),l)try{const a=Km(),n=Pg.getState().instruments.find(e=>e.id===o);if(n&&a){const s=`${t}${e.octave??2}`;a.triggerNote(o,s,.2,Q(),.8,n,e.accent,e.slide)}}catch(a){}},[n,l,o,e.octave,e.accent,e.slide]),p=s.useCallback(t=>{const a=e.octave===t?2:t;n({octave:a})},[e.octave,n]),h=s.useCallback(t=>{n({[t]:!e[t]})},[e,n]),m={position:"fixed",left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%) translateY(-10px)",zIndex:1e4};return xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"piano-popover-overlay"}),xa.jsxs("div",{ref:u,className:"piano-popover",style:m,children:[xa.jsxs("div",{className:"popover-header",children:[xa.jsxs("div",{className:"step-navigation",children:[xa.jsx("button",{className:"nav-btn",onClick:()=>i("prev"),"aria-label":"Previous step",children:""}),xa.jsxs("div",{className:"step-indicator",children:["Step ",(t+1).toString().padStart(2,"0")]}),xa.jsx("button",{className:"nav-btn",onClick:()=>i("next"),"aria-label":"Next step",children:""})]}),xa.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:""})]}),xa.jsxs("div",{className:"popover-controls",children:[xa.jsxs("div",{className:"control-group",children:[xa.jsx("div",{className:"control-label",children:"Octave"}),xa.jsxs("div",{className:"octave-selector",children:[xa.jsx("button",{className:"octave-select-btn "+(1===e.octave?"active":""),onClick:()=>p(1),children:"DN"}),xa.jsx("button",{className:"octave-select-btn "+(2===e.octave?"active":""),onClick:()=>p(2),children:"MID"}),xa.jsx("button",{className:"octave-select-btn "+(3===e.octave?"active":""),onClick:()=>p(3),children:"UP"})]})]}),xa.jsxs("div",{className:"control-group",children:[xa.jsx("div",{className:"control-label",children:"Modifiers"}),xa.jsxs("div",{className:"modifier-toggles",children:[xa.jsx("button",{className:"modifier-btn accent "+(e.accent?"active":""),onClick:()=>h("accent"),children:xa.jsx("span",{children:"AC"})}),xa.jsx("button",{className:"modifier-btn slide "+(e.slide?"active":""),onClick:()=>h("slide"),children:xa.jsx("span",{children:"SL"})})]})]}),xa.jsxs("div",{className:"control-group",children:[xa.jsx("div",{className:"control-label",children:"TT-303"}),xa.jsxs("div",{className:"modifier-toggles",children:[xa.jsx("button",{className:"modifier-btn mute "+(e.mute?"active":""),onClick:()=>h("mute"),title:"Mute - silent step, data preserved",children:xa.jsx("span",{children:"MT"})}),xa.jsx("button",{className:"modifier-btn hammer "+(e.hammer?"active":""),onClick:()=>h("hammer"),title:"Hammer - legato without pitch glide",children:xa.jsx("span",{children:"HM"})})]})]}),xa.jsxs("div",{className:"preview-toggle",children:[xa.jsx("input",{type:"checkbox",id:`preview-${o}-${t}`,checked:l,onChange:e=>c(e.target.checked)}),xa.jsx("label",{htmlFor:`preview-${o}-${t}`,children:"Preview Sound"})]})]}),xa.jsx("div",{className:"piano-keyboard",children:d_.map((t,a)=>{const n=p_.includes(a),s=e.note===t;return xa.jsx("div",{className:`\n                  piano-key\n                  ${n?"black":"white"}\n                  ${s?"selected":""}\n                `,onClick:()=>d(t),children:xa.jsx("div",{className:"key-label",children:t})},t)})})]})]})},m_=({steps:e,currentStep:t=-1,isPlaying:a=!1,onStepChange:n,onStepToggle:r,unitId:i=1})=>{const[o,l]=s.useState(null),c=s.useRef(null),u=s.useCallback(e=>{r&&r(e)},[r]),d=s.useCallback((e,t)=>{e.stopPropagation();const a=e.target.getBoundingClientRect();l({visible:!0,stepIndex:t,x:a.left+a.width/2,y:a.top})},[]),p=s.useCallback((t,a,s)=>{if(t.stopPropagation(),!n)return;const r=e[a],i=r.octave===s?2:s;n(a,{...r,octave:i})},[e,n]),h=s.useCallback((t,a,s)=>{if(t.stopPropagation(),!n)return;const r=e[a];n(a,{...r,[s]:!r[s]})},[e,n]),m=s.useCallback((t,a)=>{if(!n)return;const s=e[t];n(t,{...s,...a})},[e,n]),f=s.useCallback(()=>{l(null)},[]),g=s.useCallback(e=>{if(!o)return;const t="prev"===e?(o.stepIndex-1+16)%16:(o.stepIndex+1)%16;l({...o,stepIndex:t})},[o]);return xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{ref:c,className:"tb303-sequencer",children:e.map((e,n)=>xa.jsxs("div",{className:`\n              tb303-step\n              ${e.active?"active":""}\n              ${a&&n===t?"current":""}\n            `,onClick:()=>u(n),children:[xa.jsx("div",{className:"step-led"}),xa.jsx("div",{className:"step-note",onClick:e=>d(e,n),children:e.note}),xa.jsxs("div",{className:"step-octave-btns",children:[xa.jsx("div",{className:"octave-btn "+(1===e.octave?"active":""),onClick:e=>p(e,n,1),children:"DN"}),xa.jsx("div",{className:"octave-btn "+(3===e.octave?"active":""),onClick:e=>p(e,n,3),children:"UP"})]}),xa.jsxs("div",{className:"step-toggles",children:[xa.jsx("div",{className:"toggle-btn accent "+(e.accent?"active":""),onClick:e=>h(e,n,"accent"),children:"AC"}),xa.jsx("div",{className:"toggle-btn slide "+(e.slide?"active":""),onClick:e=>h(e,n,"slide"),children:"SL"})]})]},n))}),o?.visible&&xa.jsx(h_,{step:e[o.stepIndex],stepIndex:o.stepIndex,position:{x:o.x,y:o.y},onChange:e=>m(o.stepIndex,e),onClose:f,onNavigate:g,unitId:i})]})},f_=e=>{if("number"==typeof e){if(0===e||97===e)return{note:"C",octave:2};const t=Gn(e),a=t.substring(0,2),n=t.substring(2),s=parseInt(n,10);let r=2;s<=2?r=1:s>=4&&(r=3);return{note:a.replace("-",""),octave:r}}if("string"==typeof e){if(!e||"..."===e||"==="===e)return{note:"C",octave:2};const t=e.substring(0,2),a=e.substring(2),n=parseInt(a,10);let s=2;n<=2?s=1:n>=4&&(s=3);return{note:t.replace("-",""),octave:s}}return{note:"C",octave:2}},g_=(e,t)=>{const a=1===t?2:2===t?3:4;return Un(`${1===e.length?`${e}-`:e}${a}`)},y_=({channelIndex:e=0})=>{const{patterns:t,currentPatternIndex:a,setCell:n}=tf(),{instruments:r,updateInstrument:i}=Pg(),{isPlaying:o,currentRow:l,bpm:c}=Rg(),u=t[a],d=u?.channels[e],p=d?.instrumentId??0,h=r.find(e=>e.id===p),m=o?l%16:-1,[f,g]=s.useState(!1),y=s.useRef(h),b=s.useRef(h?.tb303);y.current=h,b.current=h?.tb303;const v=s.useRef(null),x=s.useCallback(e=>{v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{i(p,e),v.current=null},300)},[p,i]),w=h?.tb303,k="square"===w?.oscillator.type?1:0,S=w?.filter.cutoff??1e3,M=w?.filter.resonance??50,N=w?.filterEnvelope.envMod??50,C=w?.filterEnvelope.decay??300,E=w?.accent.amount??50,P=s.useMemo(()=>{if(!u||!u.channels[e])return Array.from({length:16},()=>({active:!1,note:"C",octave:2,accent:!1,slide:!1}));const t=u.channels[e],a=[];for(let e=0;e<16;e++){const n=t.rows[e],s=!(!n||!n.note||0===n.note||97===n.note),{note:r,octave:i}=s?f_(n.note):{note:"C",octave:2};a.push({active:s,note:r,octave:i,accent:!(1!==n?.flag1&&1!==n?.flag2),slide:!(2!==n?.flag1&&2!==n?.flag2)})}return a},[u,e]),_=s.useCallback(e=>{h&&w&&i(p,{tb303:{...w,oscillator:{...w.oscillator,type:e<.5?"sawtooth":"square"}}})},[p,h,w,i]),T=s.useCallback(e=>{const t=b.current;if(!y.current||!t)return;const a={...t,filter:{...t.filter,cutoff:e}};Km().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),A=s.useCallback(e=>{const t=b.current;if(!y.current||!t)return;const a={...t,filter:{...t.filter,resonance:e}};Km().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),O=s.useCallback(e=>{const t=b.current;if(!y.current||!t)return;const a={...t,filterEnvelope:{...t.filterEnvelope,envMod:e}};Km().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),I=s.useCallback(e=>{const t=b.current;if(!y.current||!t)return;const a={...t,filterEnvelope:{...t.filterEnvelope,decay:e}};Km().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),D=s.useCallback(e=>{const t=b.current;if(!y.current||!t)return;const a={...t,accent:{...t.accent,amount:e}};Km().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),F=s.useCallback((t,a)=>{n(e,t,{note:a.active?g_(a.note,a.octave):0,flag1:a.accent?1:void 0,flag2:a.slide?2:void 0})},[e,n]),R=s.useCallback(t=>{const a=P[t],s=!a.active;n(e,t,{note:s?g_(a.note,a.octave):0,flag1:a.accent?1:void 0,flag2:a.slide?2:void 0})},[e,n,P]);return h?w||"TB303"===h.synthType||"Buzz3o3"===h.synthType?xa.jsxs("div",{className:"tb303-view",children:[xa.jsxs(xa.Fragment,{children:[xa.jsxs("div",{className:"tb303-transport",children:[o&&xa.jsxs("div",{className:"transport-step",children:["Step ",(m+1).toString().padStart(2,"0"),"/16 @ ",c," BPM"]}),xa.jsx("div",{className:"transport-spacer"}),xa.jsxs("button",{onClick:()=>g(!0),className:"pattern-btn acid",children:[xa.jsx(at,{size:16}),xa.jsx("span",{children:"Acid"})]}),xa.jsxs("button",{onClick:()=>{const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let a=0;a<16;a++){const s=Math.random()>.3,r=t[Math.floor(Math.random()*t.length)],i=Math.floor(3*Math.random())+1,o=Math.random()>.7,l=Math.random()>.8;n(e,a,{note:s?g_(r,i):0,flag1:o?1:0,flag2:l?2:0})}},className:"pattern-btn randomize",children:[xa.jsx(wt,{size:16}),xa.jsx("span",{children:"Random"})]}),xa.jsxs("button",{onClick:()=>{for(let t=0;t<16;t++)n(e,t,{note:0,flag1:0,flag2:0})},className:"pattern-btn clear",children:[xa.jsx(Re,{size:16}),xa.jsx("span",{children:"Clear"})]})]}),xa.jsxs("div",{className:"tb303-sequencer-section",children:[xa.jsx("h3",{className:"section-title",children:"Pattern Sequencer"}),xa.jsx(m_,{steps:P,currentStep:m,isPlaying:o,onStepChange:F,onStepToggle:R,unitId:1})]}),xa.jsxs("div",{className:"tb303-params-section",children:[xa.jsx("h3",{className:"section-title",children:"TB-303 Parameters"}),xa.jsxs("div",{className:"params-grid",children:[xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Waveform",value:k,min:0,max:1,step:.01,onChange:_,bipolar:!1,size:"md"}),xa.jsx("div",{className:"param-value",children:k<.5?"Saw":"Square"})]}),xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Cutoff",value:S,min:200,max:5e3,logarithmic:!0,onChange:T,bipolar:!1,size:"md"}),xa.jsxs("div",{className:"param-value",children:[Math.round(S),"Hz"]})]}),xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Resonance",value:M,min:0,max:100,onChange:A,bipolar:!1,size:"md"}),xa.jsxs("div",{className:"param-value",children:[M,"%"]})]}),xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Env Mod",value:N,min:0,max:100,onChange:O,bipolar:!1,size:"md"}),xa.jsxs("div",{className:"param-value",children:[N,"%"]})]}),xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Decay",value:C,min:200,max:2e3,logarithmic:!0,onChange:I,bipolar:!1,size:"md"}),xa.jsxs("div",{className:"param-value",children:[Math.round(C),"ms"]})]}),xa.jsxs("div",{className:"param-item",children:[xa.jsx(Tv,{label:"Accent",value:E,min:0,max:100,onChange:D,bipolar:!1,size:"md"}),xa.jsxs("div",{className:"param-value",children:[E,"%"]})]})]})]})]}),f&&xa.jsx(Jx,{channelIndex:e,onClose:()=>g(!1)})]}):xa.jsx("div",{className:"tb303-view",children:xa.jsxs("div",{className:"tb303-error",children:["Channel ",e+1," is using ",h.synthType,", not TB-303"]})}):xa.jsx("div",{className:"tb303-view",children:xa.jsxs("div",{className:"tb303-error",children:["No instrument assigned to channel ",e+1]})})},b_=[{id:"pattern",label:"Pattern",icon:xa.jsx(Ht,{size:20})},{id:"instruments",label:"Instruments",icon:xa.jsx(jt,{size:20})},{id:"controls",label:"Controls",icon:xa.jsx(Kt,{size:20})}],v_=({activeTab:e,onTabChange:t})=>xa.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-dark-bgSecondary border-t border-dark-border safe-area-bottom",children:xa.jsx("div",{className:"flex items-stretch",children:b_.filter(e=>e&&e.icon).map(a=>{const n=e===a.id;return xa.jsxs("button",{onClick:()=>t(a.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-1\n                py-2 min-h-[56px] transition-colors\n                ${n?"text-accent-primary bg-accent-primary/10":"text-text-muted hover:text-text-secondary active:bg-dark-bgTertiary"}\n              `,"aria-current":n?"page":void 0,children:[xa.jsx("span",{className:n?"scale-110 transition-transform":"",children:a.icon}),xa.jsx("span",{className:"text-[10px] font-medium",children:a.label})]},a.id)})})}),x_=({isOpen:e,currentName:t,onConfirm:a,onClose:n})=>{const[r,i]=s.useState(t),o=s.useRef(null);s.useEffect(()=>{e&&(i(t),setTimeout(()=>o.current?.select(),0))},[e,t]);return e?Yv.createPortal(xa.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:n,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between mb-4",children:[xa.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Instrument"}),xa.jsx("button",{onClick:n,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:xa.jsx(Ee,{size:14})})]}),xa.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&r!==t&&a(r.trim()),n()},children:[xa.jsx("input",{ref:o,type:"text",value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Escape"===e.key&&n()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter instrument name",autoFocus:!0}),xa.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[xa.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),xa.jsx("button",{type:"submit",disabled:!r.trim()||r===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})]})]})]})}),document.body):null},w_=({isOpen:e,title:t,message:a,confirmLabel:n="Confirm",danger:r=!1,onConfirm:i,onClose:o})=>{const l=s.useCallback(e=>{"Escape"===e.key?o():"Enter"===e.key&&(i(),o())},[o,i]);return s.useEffect(()=>{if(e)return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,l]),e?Yv.createPortal(xa.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:o,children:xa.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[xa.jsxs("div",{className:"flex items-center justify-between mb-3",children:[xa.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:t}),xa.jsx("button",{onClick:o,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:xa.jsx(Ee,{size:14})})]}),xa.jsx("p",{className:"text-sm text-text-secondary mb-4",children:a}),xa.jsxs("div",{className:"flex justify-end gap-2",children:[xa.jsx("button",{onClick:o,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),xa.jsx("button",{onClick:()=>{i(),o()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(r?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:n})]})]})}),document.body):null},k_=({instrumentId:e,onEdit:t,onSavePreset:a,children:n})=>{const{position:r,open:i,close:o,isOpen:l}=ex(),{instruments:c,setCurrentInstrument:u,cloneInstrument:d,deleteInstrument:p,updateInstrument:h}=Pg(),[m,f]=s.useState(!1),[g,y]=s.useState(!1),b=c.find(t=>t.id===e),v=c.length>1,x=s.useCallback(t=>{h(e,{name:t})},[e,h]),w=s.useCallback(()=>{h(e,{synthType:"Synth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0})},[e,h]),k=s.useMemo(()=>b?[{id:"edit",label:"Edit",icon:xa.jsx($t,{size:14}),onClick:()=>{u(e),t?.()}},{type:"divider"},{id:"duplicate",label:"Duplicate",icon:xa.jsx(Ke,{size:14}),onClick:()=>d(e)},{id:"delete",label:"Delete",icon:xa.jsx(Re,{size:14}),danger:!0,disabled:!v,onClick:()=>p(e)},{type:"divider"},{id:"rename",label:"Rename",icon:xa.jsx(qt,{size:14}),onClick:()=>f(!0)},{type:"divider"},{id:"copy-settings",label:"Copy Settings",icon:xa.jsx(Xt,{size:14}),onClick:()=>{localStorage.setItem("devilbox-instrument-clipboard",JSON.stringify(b))}},{id:"paste-settings",label:"Paste Settings",icon:xa.jsx(st,{size:14}),onClick:()=>{const t=localStorage.getItem("devilbox-instrument-clipboard");if(t)try{const a=JSON.parse(t),{id:n,name:s,...r}=a;h(e,r)}catch(a){}}},{type:"divider"},{id:"save-preset",label:"Save as Preset",icon:xa.jsx($e,{size:14}),onClick:()=>{a?.()}},{id:"reset",label:"Reset to Default",icon:xa.jsx(yt,{size:14}),danger:!0,onClick:()=>y(!0)}]:[],[b,e,v,u,d,p,h,t,a]);return xa.jsxs("div",{onContextMenu:i,children:[n,l&&xa.jsx(Zv,{items:k,position:r,onClose:o}),xa.jsx(x_,{isOpen:m,currentName:b?.name||"",onConfirm:x,onClose:()=>f(!1)}),xa.jsx(w_,{isOpen:g,title:"Reset Instrument",message:"Reset this instrument to default settings? This cannot be undone.",confirmLabel:"Reset",danger:!0,onConfirm:w,onClose:()=>y(!1)})]})},S_=({onClose:e})=>{const{currentInstrumentId:t,updateInstrument:a,setPreviewInstrument:n}=Pg(),{userPresets:r,deletePreset:i,addToRecent:o,exportPresets:l,importPresets:c,importNKSFFiles:u,exportAllPresetsAsNKSF:d}=Sb(),[p,h]=s.useState("factory"),[m,f]=s.useState("Bass"),[g,y]=s.useState("All"),[b,v]=s.useState(""),[x,w]=s.useState(null),[k,S]=s.useState(null),M=s.useRef(null),N=s.useRef(null),C=Object.keys(ig),E=e=>{h(e),w(null),S(null),v("")},P=s.useMemo(()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);return e?e.config:null}return"factory"===p&&x&&ig[m].find(e=>e.name===x)||null},[p,x,m,k,r]);s.useEffect(()=>{const t=t=>{"Escape"===t.key&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),s.useEffect(()=>{if(P){const t={...P,id:999,isLive:!0};n(t);try{Km().invalidateInstrument(999)}catch(e){}}else n(null);return()=>{n(null)}},[P,n]),s.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=Km(),a={...P,id:999,isLive:!0};e.triggerPolyNoteAttack(999,t,1,a)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=Km(),a={...P,id:999,isLive:!0};e.triggerPolyNoteRelease(999,t,a)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[P]);const _=e=>Rt[e]||jt,T=s.useMemo(()=>{const e=ig[m]||[];if(!b.trim())return e;const t=b.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(t)||e.synthType?.toLowerCase().includes(t))},[m,b]),A=s.useMemo(()=>{let e=r;if("All"!==g&&(e=e.filter(e=>e.category===g)),!b.trim())return e;const t=b.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.synthType.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},[r,g,b]),O=n=>{null!==t&&(a(t,n),e())},I=(n,s)=>{null!==t&&(o(n),a(t,s),e())},D=e=>({Bass:"text-blue-400",Leads:"text-yellow-400",Pads:"text-purple-400",Drums:"text-red-400","TR-808":"text-red-500","TR-909":"text-orange-400","TR-707":"text-rose-400","TR-505":"text-amber-400",Chip:"text-cyan-400",Furnace:"text-teal-400",FX:"text-green-400",Dub:"text-green-400",DubSiren:"text-red-500",SpaceLaser:"text-green-500",V2:"text-amber-500",Sam:"text-amber-500",Synare:"text-yellow-500",Drumnibus:"text-emerald-400",Keys:"text-amber-600",MAME:"text-pink-400",Module:"text-lime-400",Lead:"text-yellow-400",Pad:"text-purple-400",Drum:"text-red-400",User:"text-gray-400",All:"text-ft2-highlight"}[e]||"text-ft2-highlight"),F="factory"===p?T.length:A.length;return xa.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:[xa.jsxs("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden",children:[xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[xa.jsxs("div",{children:[xa.jsx("h2",{className:"text-ft2-highlight font-bold text-sm uppercase tracking-widest",children:"LOAD PRESET"}),xa.jsx("p",{className:"text-ft2-textDim text-[10px]",children:"Browse, Jam and Load sounds"})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsxs("div",{className:"flex bg-ft2-bg rounded overflow-hidden border border-ft2-border",children:[xa.jsx("button",{onClick:()=>E("factory"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("factory"===p?"bg-ft2-cursor text-ft2-bg":"text-ft2-textDim hover:text-ft2-text"),children:"Factory"}),xa.jsxs("button",{onClick:()=>E("user"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("user"===p?"bg-amber-500 text-black":"text-ft2-textDim hover:text-ft2-text"),children:["User (",r.length,")"]})]}),xa.jsx("button",{onClick:e,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:xa.jsx(Ee,{size:20})})]})]}),xa.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border",children:xa.jsxs("div",{className:"relative",children:[xa.jsx(St,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"}),xa.jsx("input",{type:"text",value:b,onChange:e=>v(e.target.value),placeholder:"factory"===p?"Search factory presets...":"Search user presets by name, synth type, or tag...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none placeholder:text-ft2-textDim/50",autoFocus:!0})]})}),xa.jsx("div",{className:"flex flex-wrap gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border",children:"factory"===p?C.map(e=>{const t=m===e;return xa.jsx("button",{onClick:()=>(e=>{f(e),w(null),v("")})(e),className:`\n                    px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                    ${t?"bg-ft2-cursor text-ft2-bg shadow-[0_0_15px_rgba(255,255,255,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${D(e)}`}\n                  `,children:e},e)}):xa.jsxs(xa.Fragment,{children:[["All","Bass","Lead","Pad","Drum","FX","User"].map(e=>{const t=g===e;return xa.jsx("button",{onClick:()=>{y(e),S(null)},className:`\n                      px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                      ${t?"bg-amber-500 text-black shadow-[0_0_15px_rgba(245,158,11,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-amber-500/50 ${D(e)}`}\n                    `,children:e},e)}),xa.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[xa.jsxs("button",{onClick:()=>M.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import presets from JSON file",children:[xa.jsx(Ct,{size:10})," Import"]}),xa.jsxs("button",{onClick:()=>N.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import .nksf preset files",children:[xa.jsx(Ct,{size:10})," NKSF"]}),xa.jsxs("button",{onClick:()=>{const e=l();if(0===e.length)return void ty.warning("No user presets to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="devilbox-presets.json",n.click(),URL.revokeObjectURL(a),ty.success(`Exported ${e.length} presets`,2e3)},className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all user presets as JSON",children:[xa.jsx(Ue,{size:10})," Export"]}),xa.jsxs("button",{onClick:()=>d("DEViLBOX User"),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all presets as .nksf files",children:[xa.jsx(Ue,{size:10})," NKS"]})]})]})}),xa.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:"factory"===p?0===T.length?xa.jsxs("div",{className:"flex items-center justify-center h-full text-ft2-textDim font-mono text-sm uppercase",children:['No presets found matching "',b,'"']}):xa.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:T.map((e,t)=>{const a=ZN(e.synthType||"Synth"),n=_(a.icon),s=x===e.name;return xa.jsxs("button",{onClick:()=>(e=>{w(e.name||null),S(null);const t=Km(),a={...e,id:999,isLive:!0};t.triggerPolyNoteAttack(999,"C4",1,a),setTimeout(()=>{t.triggerPolyNoteRelease(999,"C4",a)},300)})(e),onDoubleClick:()=>O(e),className:`\n                        p-3 rounded border-2 text-left transition-all group\n                        ${s?"bg-ft2-cursor text-ft2-bg border-ft2-cursor shadow-[0_0_20px_rgba(255,255,255,0.1)]":"bg-ft2-header border-ft2-border hover:border-ft2-highlight hover:bg-ft2-bg"}\n                      `,children:[xa.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[xa.jsx(n,{size:14,className:s?"text-ft2-bg":a.color}),xa.jsx("span",{className:"font-bold text-sm truncate "+(s?"text-ft2-bg":"text-ft2-text"),children:e.name})]}),xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsx("span",{className:"text-[10px] font-mono uppercase "+(s?"text-ft2-bg/80":"text-ft2-textDim"),children:e.synthType}),e.effects&&e.effects.length>0&&xa.jsxs("span",{className:"text-[9px] px-1.5 font-bold rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-green-600/20 text-green-400"),children:[e.effects.length," FX"]})]})]},`${m}-${e.name}-${t}`)})}):0===A.length?xa.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-ft2-textDim",children:[xa.jsx("span",{className:"font-mono text-sm uppercase",children:0===r.length?"No user presets yet":`No presets matching "${b}"`}),0===r.length&&xa.jsx("p",{className:"text-xs text-center max-w-md",children:"Save presets from the instrument editor to build your library. You can also import presets using the buttons above."})]}):xa.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:A.map(e=>{const t=ZN(e.synthType),a=_(t.icon),n=k===e.id;return xa.jsxs("div",{onClick:()=>((e,t)=>{S(e),w(null);const a=Km(),n={...t,id:999,isLive:!0};a.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{a.triggerPolyNoteRelease(999,"C4",n)},300)})(e.id,e.config),onDoubleClick:()=>I(e.id,e.config),className:`\n                        p-3 rounded border-2 text-left transition-all group cursor-pointer relative\n                        ${n?"bg-amber-500 text-black border-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]":"bg-ft2-header border-ft2-border hover:border-amber-500/50 hover:bg-ft2-bg"}\n                      `,children:[xa.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),i(t),k===t&&S(null),ty.success("Preset deleted",2e3)})(t,e.id),className:"absolute top-1 right-1 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(n?"hover:bg-black/20 text-black/60":"hover:bg-red-500/20 text-red-400/60 hover:text-red-400"),title:"Delete preset",children:xa.jsx(Re,{size:12})}),xa.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[xa.jsx(a,{size:14,className:n?"text-black":t.color}),xa.jsx("span",{className:"font-bold text-sm truncate "+(n?"text-black":"text-ft2-text"),children:e.name})]}),xa.jsxs("div",{className:"flex items-center justify-between mb-1",children:[xa.jsx("span",{className:"text-[10px] font-mono uppercase "+(n?"text-black/70":"text-ft2-textDim"),children:e.synthType}),xa.jsx("span",{className:"text-[9px] px-1.5 font-bold rounded "+(n?"bg-black/10 text-black/70":"bg-amber-500/10 text-amber-400"),children:e.category})]}),e.tags.length>0&&xa.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,3).map(e=>xa.jsxs("span",{className:"text-[8px] px-1 rounded flex items-center gap-0.5 "+(n?"bg-black/10 text-black/60":"bg-ft2-bg text-ft2-textDim"),children:[xa.jsx(Yt,{size:7}),e]},e))})]},e.id)})})},`${p}-${m}-${g}`),xa.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-t-2 border-ft2-border",children:[xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsxs("div",{className:"text-ft2-textDim text-xs font-mono",children:[F," PRESET",1!==F?"S":"","  ","factory"===p?m.toUpperCase():"All"===g?"ALL USER":g.toUpperCase(),(x||k)&&xa.jsx("span",{className:"ml-2 text-ft2-text",children:" DOUBLE-CLICK TO APPLY"})]}),P&&xa.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[xa.jsx(Ae,{size:12,className:"text-amber-400 fill-amber-400"}),xa.jsx("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"})]})]}),xa.jsxs("div",{className:"flex gap-2",children:[xa.jsx("button",{onClick:e,className:"px-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors font-bold text-xs uppercase",children:"Cancel"}),xa.jsxs("button",{onClick:()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);e&&I(e.id,e.config)}else P&&O(P)},disabled:!P,className:"flex items-center gap-2 px-6 py-2 bg-ft2-cursor text-ft2-bg font-black hover:bg-ft2-highlight rounded transition-all disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs",children:[xa.jsx(Fe,{size:16}),"Load Preset"]})]})]})]}),xa.jsx("input",{ref:M,type:"file",accept:".json",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=()=>{try{const e=JSON.parse(a.result);Array.isArray(e)?(c(e),ty.success(`Imported ${e.length} presets`,2e3)):ty.error("Invalid preset file format")}catch{ty.error("Failed to parse preset file")}},a.readAsText(t),M.current&&(M.current.value="")}}),xa.jsx("input",{ref:N,type:"file",accept:".nksf",multiple:!0,className:"hidden",onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=await u(Array.from(t));a.length>0?ty.success(`Imported ${a.length} NKSF presets`,2e3):ty.error("Failed to import NKSF files"),N.current&&(N.current.value="")}})]})},M_=s.memo(({compact:e=!1,maxHeight:t="300px",showActions:a=!0,onInstrumentChange:n,showPreviewOnClick:r=!1,showSamplePackButton:i=!1,showPresetButton:o=!1,showEditButton:l=!1,onEditInstrument:c,variant:u="default",onCreateNew:d})=>{const{instruments:p,currentInstrumentId:h,setCurrentInstrument:m,createInstrument:f,deleteInstrument:g,cloneInstrument:y,updateInstrument:b}=Pg(Da(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument,createInstrument:e.createInstrument,deleteInstrument:e.deleteInstrument,cloneInstrument:e.cloneInstrument,updateInstrument:e.updateInstrument}))),{useHexNumbers:v,setShowSamplePackModal:x}=Tg(Da(e=>({useHexNumbers:e.useHexNumbers,setShowSamplePackModal:e.setShowSamplePackModal}))),w=s.useRef(null),k=s.useRef(null),S=s.useRef(null),M=s.useRef(null),[N,C]=s.useState(!1),[E,P]=s.useState(null),[_,T]=s.useState(""),A="ft2"===u;s.useEffect(()=>{k.current&&w.current&&k.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[h]);const O=s.useCallback(async e=>{if(r)try{await ge(),S.current&&window.clearTimeout(S.current);const t=Km(),a="TB303"===e.synthType||e.name.toLowerCase().includes("bass")?"C3":"C4",n=Q();t.triggerNoteAttack(e.id,a,n,.8,e),S.current=window.setTimeout(()=>{t.triggerNoteRelease(e.id,a,Q(),e)},300)}catch(t){}},[r]),I=(e,t)=>{m(e),n?.(e),r&&O(t)},D=(e,t)=>{e.stopPropagation(),p.length>1&&g(t)},F=(e,t)=>{e.stopPropagation(),y(t)},R=(e,t,a)=>{e.stopPropagation(),P(t),T(a),setTimeout(()=>M.current?.focus(),0)},j=()=>{null!==E&&_.trim()&&b(E,{name:_.trim()}),P(null),T("")},L=e=>{"Enter"===e.key?j():"Escape"===e.key&&(P(null),T(""))},B=[...p].sort((e,t)=>e.id-t.id),V=A&&(o||i||l);return xa.jsxs("div",{className:"flex flex-col h-full "+(A?"bg-ft2-bg border-l border-ft2-border":""),children:[V&&xa.jsx("div",{className:"px-2 py-2 bg-ft2-header border-b border-ft2-border flex-shrink-0",children:xa.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[xa.jsxs("button",{onClick:()=>{if(A){f(Wf[0])}else f()},className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Add new instrument (303 Classic)",children:[xa.jsx(Xe,{size:14}),xa.jsx("span",{className:"text-[8px] font-bold",children:"ADD"})]}),o&&xa.jsxs("button",{onClick:()=>C(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Load preset into current instrument",children:[xa.jsx(Lt,{size:14}),xa.jsx("span",{className:"text-[8px] font-bold",children:"PRESET"})]}),i&&xa.jsxs("button",{onClick:()=>x(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-green-600 text-green-400 hover:bg-green-600 hover:text-ft2-bg transition-colors",title:"Browse sample packs",children:[xa.jsx(Qt,{size:14}),xa.jsx("span",{className:"text-[8px] font-bold",children:"SAMPLE"})]}),l&&xa.jsxs("button",{onClick:()=>c?.(h),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Edit current instrument",children:[xa.jsx(Zt,{size:14}),xa.jsx("span",{className:"text-[8px] font-bold",children:"EDIT"})]})]})}),xa.jsx("div",{ref:w,className:"flex-1 overflow-y-auto "+(A?"scrollbar-ft2 min-h-0":"scrollbar-modern"),style:A?void 0:{maxHeight:t},children:xa.jsx("div",{className:"flex flex-col divide-y divide-ft2-border/30",children:B.map(t=>{const n=ZN(t.synthType),s=t.id===h,r=Rt[n?.icon||"Music2"]||jt;return A?xa.jsxs("div",{ref:s?k:void 0,onClick:()=>I(t.id,t),className:`\n                  instrument-list-item\n                  flex items-center gap-2 px-2 py-1.5 cursor-pointer border-b border-ft2-border\n                  transition-colors group\n                  ${s?"bg-ft2-cursor text-ft2-bg":"hover:bg-ft2-header text-ft2-text"}\n                `,children:[xa.jsx("span",{className:"font-mono text-xs font-bold w-6 "+(s?"text-ft2-bg":"text-ft2-highlight"),children:v?t.id.toString(16).toUpperCase().padStart(2,"0"):t.id.toString(10).padStart(2,"0")}),xa.jsx(r,{size:12,className:s?"text-ft2-bg":n?.color||"text-ft2-highlight"}),E===t.id?xa.jsx("input",{ref:M,type:"text",value:_,onChange:e=>T(e.target.value),onBlur:j,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-xs font-mono bg-ft2-bg border border-ft2-cursor px-1 py-0.5 rounded text-ft2-text focus:outline-none w-24",autoFocus:!0}):xa.jsx("span",{className:"text-xs font-mono whitespace-nowrap cursor-text",onDoubleClick:e=>R(e,t.id,t.name),title:"Double-click to rename",children:t.name}),xa.jsx("span",{className:"text-[9px] px-1 rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-ft2-header text-ft2-textDim"),children:n?.shortName||t.synthType}),a&&xa.jsxs("div",{className:`instrument-action-buttons flex gap-0.5 ${s?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[xa.jsx("button",{onClick:e=>F(e,t.id),className:"p-0.5 rounded "+(s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"),title:"Duplicate",children:xa.jsx(Ke,{size:10})}),p.length>1&&xa.jsx("button",{onClick:e=>D(e,t.id),className:`p-0.5 rounded ${s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-red-400`,title:"Delete",children:xa.jsx(Re,{size:10})})]})]},t.id):xa.jsx(k_,{instrumentId:t.id,children:xa.jsxs("div",{ref:s?k:void 0,onClick:()=>I(t.id,t),className:`\n                  group flex items-center gap-2 px-3 py-2 cursor-pointer transition-all\n                  ${s?"bg-accent-primary/20 border-l-2 border-accent-primary":"hover:bg-dark-bgHover border-l-2 border-transparent"}\n                `,children:[xa.jsx("span",{className:`\n                    font-mono text-xs w-6 text-center\n                    ${s?"text-accent-primary":"text-text-muted"}\n                  `,children:String(t.id).padStart(2,"0")}),xa.jsx(r,{size:e?12:14,className:n?.color||"text-accent-primary"}),E===t.id?xa.jsx("input",{ref:M,type:"text",value:_,onChange:e=>T(e.target.value),onBlur:j,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-sm bg-dark-bg border border-accent-primary px-1 py-0.5 rounded text-text-primary focus:outline-none w-28",autoFocus:!0}):xa.jsx("span",{className:`\n                      text-sm whitespace-nowrap cursor-text\n                      ${s?"text-text-primary":"text-text-secondary"}\n                    `,onDoubleClick:e=>R(e,t.id,t.name),title:"Double-click to rename",children:t.name}),!e&&xa.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:n?.shortName||t.synthType}),t.sample?.loop&&xa.jsx("span",{className:"text-text-muted ml-auto",title:"pingpong"===t.sample.loopType?"Ping-pong loop":"Forward loop",children:"pingpong"===t.sample.loopType?xa.jsx(Qe,{size:10,className:"text-blue-400"}):xa.jsx(Jt,{size:10,className:"text-green-400"})}),a&&xa.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[xa.jsx("button",{onClick:e=>F(e,t.id),className:"p-1 text-text-muted hover:text-accent-primary",title:"Clone instrument",children:xa.jsx(Ke,{size:12})}),p.length>1&&xa.jsx("button",{onClick:e=>D(e,t.id),className:"p-1 text-text-muted hover:text-accent-error",title:"Delete instrument",children:xa.jsx(Re,{size:12})})]})]})},t.id)})})}),xa.jsx("div",{className:A?"px-3 py-1.5 bg-ft2-header border-t border-ft2-border":"px-3 py-1 border-t border-dark-border bg-dark-bgSecondary",children:xa.jsxs("span",{className:A?"text-ft2-textDim text-[10px] font-mono":"text-[10px] text-text-muted",children:[p.length," instrument",1!==p.length?"s":""]})}),N&&xa.jsx(S_,{onClose:()=>C(!1)})]})});M_.displayName="InstrumentList";const N_=({onShowPatterns:e,onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,showPatterns:i,showMasterFX:o})=>{const[l,c]=s.useState("pattern"),{isPlaying:u,togglePlayPause:d}=Rg(),{patterns:p,currentPatternIndex:h}=tf(),m=p[h];return xa.jsxs("div",{className:"flex flex-col flex-1 min-h-0 bg-dark-bg",children:[xa.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-3 py-2 bg-dark-bgSecondary border-b border-dark-border",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("span",{className:"text-xs text-text-muted",children:"PAT"}),xa.jsx("span",{className:"text-sm font-bold text-accent-primary",children:(h+1).toString().padStart(2,"0")}),xa.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:m?.name||"Untitled"})]}),xa.jsx("div",{className:"flex items-center gap-1",children:xa.jsx("button",{onClick:d,className:`\n              p-2 rounded-lg transition-colors touch-target\n              ${u?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-primary hover:bg-dark-bgHover"}\n            `,children:u?xa.jsx(Et,{size:18}):xa.jsx(Pt,{size:18})})})]}),xa.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden mobile-bottom-padding",children:["pattern"===l&&xa.jsx(Tx,{}),"instruments"===l&&xa.jsx("div",{className:"h-full overflow-y-auto",children:xa.jsx(M_,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})}),"controls"===l&&xa.jsxs("div",{className:"h-full overflow-y-auto",children:[xa.jsx("div",{className:"p-4 border-b border-dark-border",children:xa.jsx(u_,{})}),xa.jsx("div",{className:"p-2",children:xa.jsx(o_,{onShowPatterns:e,onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,showPatterns:i,showMasterFX:o})})]})]}),xa.jsx(v_,{activeTab:l,onTabChange:c})]})};const C_=e.memo(({verticalZoom:e,scrollY:t,visibleNotes:a,containerHeight:n,activeNotes:r=new Set,scaleNotes:i,onNoteClick:o,onNotePreview:l,onNoteRelease:c})=>{const u=s.useCallback(e=>{l?.(e),o?.(e)},[o,l]),d=s.useCallback(()=>{c?.()},[c]),p=s.useMemo(()=>{const e=[],n=Math.min(127,t+a),s=Math.max(0,t);for(let t=n;t>=s;t--){const a=t%12,n=!i||i.has(a);e.push({midiNote:t,isBlack:_y(t),name:Py(t),inScale:n})}return e},[t,a,i]);return xa.jsx("div",{className:"flex flex-col bg-gray-900 border-r border-dark-border overflow-hidden shrink-0",style:{width:48,height:n||"auto"},role:"group","aria-label":"Piano keyboard",children:p.map(({midiNote:t,isBlack:a,name:n,inScale:s})=>{const i=t%12==0,o=r.has(t),l=!s;return xa.jsx("div",{className:`\n              flex items-center justify-end pr-1 text-[9px] font-mono cursor-pointer\n              select-none border-b transition-all duration-75 shrink-0\n              ${o?"bg-accent-primary text-text-inverse border-accent-primary brightness-110 shadow-lg":a?"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 "+(l?"opacity-40":""):"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 "+(l?"opacity-40":"")}\n              ${i?"font-bold":""}\n            `,style:{height:e,transform:o?"translateX(2px)":"translateX(0)"},onMouseDown:()=>u(t),onMouseUp:d,onMouseLeave:d,title:n,role:"button","aria-label":`Play ${n}`,"aria-pressed":o,children:i?n:""},t)})})}),E_=e.memo(({note:e,horizontalZoom:t,verticalZoom:a,scrollX:n,scrollY:r,isSelected:i,showVelocity:o,isGhost:l=!1,onSelect:c,onDragStart:u})=>{const d=(e.startRow-n)*t,p=(e.endRow-e.startRow)*t,h=(r+60-e.midiNote)*a;if(d+p<-50||d>3e3||h<-50||h>2e3)return null;const m=s.useCallback(t=>{if(l)return;t.stopPropagation();const a=t.currentTarget.getBoundingClientRect(),n=t.clientX-a.left>p-8;c?.(e.id,t.shiftKey||t.ctrlKey||t.metaKey),u&&u(e.id,n?"resize-end":"move",t)},[e.id,p,l,c,u]),f=e.velocity/127*100,g=["bg-cyan-500","bg-purple-500","bg-green-500","bg-amber-500","bg-pink-500","bg-blue-500","bg-red-500","bg-teal-500"],y=g[e.channelIndex%g.length],b=p>30&&a>=10,v=Py(e.midiNote);return l?xa.jsx("div",{className:`absolute rounded-sm pointer-events-none ${y}`,style:{left:d,top:h,width:Math.max(4,p-1),height:a-1,opacity:.3,border:"1px dashed rgba(255,255,255,0.5)"}}):xa.jsxs("div",{className:`\n        absolute rounded-sm cursor-move select-none\n        ${y}\n        ${i?"ring-2 ring-accent-primary ring-opacity-100 brightness-125 z-10":"ring-1 ring-black/30"}\n        hover:brightness-125 hover:ring-accent-primary/50 hover:z-20\n        transition-all duration-75\n        shadow-md hover:shadow-lg\n      `,style:{left:d,top:h,width:Math.max(4,p-1),height:a-1,opacity:.8+e.velocity/127*.2},onMouseDown:m,title:`${v} vel:${e.velocity}${e.slide?" [SLIDE]":""}${e.accent?" [ACCENT]":""}`,role:"button","aria-label":`Note ${v}, velocity ${e.velocity}${e.slide?", slide":""}${e.accent?", accent":""}`,tabIndex:0,children:[b&&xa.jsx("span",{className:"absolute left-1 top-0 text-[8px] text-white/80 font-mono leading-none pointer-events-none",style:{lineHeight:a-1+"px"},children:v}),o&&p>20&&xa.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/30 pointer-events-none",style:{height:100-f+"%"}}),e.slide&&xa.jsx("div",{className:"absolute top-0 right-3 w-1.5 h-full bg-yellow-400/60 pointer-events-none"}),e.accent&&xa.jsx("div",{className:"absolute top-0 left-0 w-0 h-0 pointer-events-none",style:{borderLeft:"6px solid rgba(255,100,0,0.8)",borderBottom:"6px solid transparent"}}),xa.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 transition-colors"})]})}),P_=e.memo(({notes:t,patternLength:a,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,gridDivision:l,showVelocity:c,selectedNotes:u,playheadRow:d,containerHeight:p,scaleNotes:h,onNoteSelect:m,onNoteDragStart:f,onGridClick:g,onGridRightClick:y,onScroll:b,onSelectionBoxStart:v})=>{const x=s.useRef(null),w=Ay(e=>e.ghostNotes),k=Ay(e=>e.drag),[S,M]=e.useState(800);e.useEffect(()=>{const e=()=>{x.current&&M(x.current.clientWidth)};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]);const N=s.useMemo(()=>Math.ceil(S/n)+2,[n,S]),C=s.useMemo(()=>{const e=p||x.current?.clientHeight||400;return Math.ceil(e/r)+2},[r,p]),E=s.useCallback(e=>{e.preventDefault();const t=e.shiftKey?e.deltaY:e.deltaX,a=e.shiftKey?0:e.deltaY;b(t/n,-a/r)},[n,r,b]),P=s.useCallback(e=>{if(!x.current)return;if(2===e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);g(Math.max(0,l),Math.max(0,Math.min(127,c)))},[n,r,i,o,g]),_=s.useCallback(e=>{if(e.preventDefault(),!x.current)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);y(Math.max(0,l),Math.max(0,Math.min(127,c)),e.clientX,e.clientY)},[n,r,i,o,y]),T=s.useCallback(e=>{if(!x.current||0!==e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);v(Math.max(0,l),Math.max(0,Math.min(127,c)),e)},[n,r,i,o,v]),A=s.useMemo(()=>{const e=[],t=a*n,s=Math.max(S,t),c=Math.floor(i),u=Math.ceil(i+N),d=4/l,p=Math.max(u,Math.ceil(S/n+i));for(let r=c;r<=p;r++){const t=(r-i)*n,s=r%4==0,o=r%16==0,l=r>a;(r%d===0||s||o)&&e.push(xa.jsx("div",{className:"absolute top-0 bottom-0 "+(l?"bg-gray-700/20":o?"bg-gray-500/50":s?"bg-gray-600/40":"bg-gray-700/30"),style:{left:t,width:1}},`v-${r}`))}for(let a=0;a<C;a++){const t=o+60-a;if(t<0||t>127)continue;const n=a*r,i=t%12==0,l=_y(t),c=t%12,u=h&&!h.has(c);e.push(xa.jsx("div",{className:`absolute left-0 ${u?"bg-gray-900/70":l?"bg-gray-800/50":"bg-gray-900/30"} ${i?"border-t border-gray-500/50":""}`,style:{top:n,height:r,width:s}},`h-${t}`))}return e},[i,o,n,r,a,N,C,l,S,h]),O=null!==d?(d-i)*n:null,I=Ay(e=>e.tool),D="draw"===I?"cursor-crosshair":"erase"===I?"cursor-not-allowed":"cursor-default",F=s.useMemo(()=>{if("select-box"!==k.mode||!k.isDragging)return null;if(!x.current)return null;const e=x.current.getBoundingClientRect();return{left:Math.min(k.startX,k.currentX)-e.left,top:Math.min(k.startY,k.currentY)-e.top,width:Math.abs(k.currentX-k.startX),height:Math.abs(k.currentY-k.startY)}},[k]);return xa.jsxs("div",{ref:x,className:`flex-1 w-full h-full relative overflow-hidden bg-gray-900 ${D}`,onWheel:E,onClick:P,onContextMenu:_,onMouseDown:T,role:"grid","aria-label":"Piano roll note grid",children:[xa.jsx("div",{className:"absolute inset-0 pointer-events-none",children:A}),w.map(e=>xa.jsx(E_,{note:e,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,isSelected:!1,showVelocity:!1,isGhost:!0},`ghost-${e.id}`)),t.map(e=>xa.jsx(E_,{note:e,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,isSelected:u.has(e.id),showVelocity:c,onSelect:m,onDragStart:f},e.id)),F&&xa.jsx("div",{className:"absolute border-2 border-accent-primary/60 bg-accent-primary/10 pointer-events-none z-20",style:F}),null!==O&&O>=0&&xa.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent-primary pointer-events-none z-10",style:{left:O}}),xa.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-red-500/50 pointer-events-none",style:{left:(a-i)*n}})]})}),__=e.memo(({notes:e,horizontalZoom:t,scrollX:a,selectedNotes:n,onVelocityChange:r,onMultiVelocityChange:i,onBeginDrag:o,onDragVelocity:l,onDragMultiVelocity:c,onEndDrag:u})=>{const d=s.useRef(null),[p,h]=s.useState(null),[m,f]=s.useState(null),g=s.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),y=s.useCallback((e,t)=>{if(t.preventDefault(),t.stopPropagation(),h(e),o(),!d.current)return;const a=d.current.getBoundingClientRect(),s=t.clientY-a.top,r=g(s);n.has(e)&&n.size>1?c(Array.from(n),r):l(e,r)},[n,o,l,c,g]),b=s.useCallback(e=>{if(!p||!d.current)return;const t=d.current.getBoundingClientRect(),a=e.clientY-t.top,s=g(a);n.has(p)&&n.size>1?c(Array.from(n),s):l(p,s)},[p,n,l,c,g]),v=s.useCallback(()=>{p&&u(),h(null)},[p,u]),x=s.useMemo(()=>e.map(e=>{const s=(e.startRow-a)*t,r=(e.endRow-e.startRow)*t;if(s+r<0||s>2e3)return null;const i=e.velocity/127*80,o=n.has(e.id),l=m===e.id,c=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],u=c[e.channelIndex%c.length];return xa.jsx("div",{className:"absolute bottom-0 cursor-ns-resize",style:{left:s,width:Math.max(3,r-1),height:i,backgroundColor:u,opacity:o?1:l?.9:.7,border:o?"1px solid #facc15":"none",borderRadius:"2px 2px 0 0",transition:"opacity 75ms"},onMouseDown:t=>y(e.id,t),onMouseEnter:()=>f(e.id),onMouseLeave:()=>f(null),title:`Velocity: ${e.velocity}`},e.id)}).filter(Boolean),[e,t,a,n,m,y]),w=s.useMemo(()=>{const e=[];return[32,64,96,127].forEach((t,a)=>{const n=80-t/127*80;e.push(xa.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:n},children:[xa.jsx("div",{className:"border-t border-gray-700/40 w-full"}),xa.jsx("span",{className:"absolute left-1 text-[8px] text-text-muted/40 -translate-y-full",children:t})]},t))}),e},[]);return xa.jsxs("div",{ref:d,className:"relative bg-gray-900/80 border-t border-dark-border overflow-hidden shrink-0",style:{height:80},onMouseMove:b,onMouseUp:v,onMouseLeave:v,children:[w,xa.jsx("div",{className:"absolute top-1 left-1 text-[9px] text-text-muted/50 pointer-events-none z-10",children:"VEL"}),x]})}),T_=({onCopy:e,onCut:t,onPaste:a,onDelete:n,onSelectAll:r,onQuantize:i,onToggleSlide:o,onToggleAccent:l,hasSelection:c,hasClipboard:u})=>{const{contextMenu:d,hideContextMenu:p}=Ay(),h=s.useRef(null);if(s.useEffect(()=>{if(!d.visible)return;const e=e=>{h.current&&!h.current.contains(e.target)&&p()},t=e=>{"Escape"===e.key&&p()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[d.visible,p]),!d.visible)return null;const m=Math.min(d.x,window.innerWidth-200),f=Math.min(d.y,window.innerHeight-260),g={position:"fixed",left:Math.max(0,m),top:Math.max(0,f),zIndex:100},y=({icon:e,label:t,shortcut:a,onClick:n,disabled:s})=>xa.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-1.5 text-xs text-left rounded transition-colors\n        "+(s?"text-text-muted/50 cursor-not-allowed":"text-text-primary hover:bg-dark-bgTertiary"),onClick:()=>{s||(n(),p())},disabled:s,children:[e,xa.jsx("span",{className:"flex-1",children:t}),a&&xa.jsx("span",{className:"text-text-muted text-[10px]",children:a})]}),b=()=>xa.jsx("div",{className:"h-px bg-dark-border mx-2 my-1"});return xa.jsxs("div",{ref:h,className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl py-1 min-w-[180px]",style:g,children:[xa.jsx(y,{icon:xa.jsx(Ke,{size:12}),label:"Copy",shortcut:"Ctrl+C",onClick:e,disabled:!c}),xa.jsx(y,{icon:xa.jsx(nt,{size:12}),label:"Cut",shortcut:"Ctrl+X",onClick:t,disabled:!c}),xa.jsx(y,{icon:xa.jsx(st,{size:12}),label:"Paste",shortcut:"Ctrl+V",onClick:a,disabled:!u}),xa.jsx(y,{icon:xa.jsx(Re,{size:12}),label:"Delete",shortcut:"Del",onClick:n,disabled:!c}),xa.jsx(b,{}),xa.jsx(y,{icon:xa.jsx(ea,{size:12}),label:"Select All",shortcut:"Ctrl+A",onClick:r}),xa.jsx(b,{}),xa.jsx(y,{icon:xa.jsx(Ht,{size:12}),label:"Quantize",shortcut:"Q",onClick:i,disabled:!c}),xa.jsx(b,{}),xa.jsx(y,{icon:xa.jsx(ta,{size:12}),label:"Toggle Slide",shortcut:"S",onClick:o,disabled:!c}),xa.jsx(y,{icon:xa.jsx(Ae,{size:12}),label:"Toggle Accent",shortcut:"A",onClick:l,disabled:!c})]})};function A_(e,t){return`${e}-${t}`}function O_(e,t,a){for(let n=t+1;n<a;n++){const a=e[n];if(97===a.note)return n-t;if(a.note&&0!==a.note&&97!==a.note)return n-t}return a-t}function I_(e){return JSON.parse(JSON.stringify(e))}function D_(e,t,a,n){(0,zg.getState().pushAction)("EDIT_CELL",n,a,e,JSON.parse(JSON.stringify(t)))}function F_(e){const{patterns:t,currentPatternIndex:a,setCell:n}=tf(),r=t[a],i=s.useMemo(()=>r?function(e,t){const a=[];return(void 0!==t?[e.channels[t]].filter(Boolean):e.channels).forEach((n,s)=>{const r=void 0!==t?t:s;for(let t=0;t<n.rows.length;t++){const s=n.rows[t];if(!s.note||0===s.note||97===s.note)continue;const i=qn(s.note);if(null===i)continue;const o=O_(n.rows,t,e.length),l=s.volume>=16&&s.volume<=80?Math.round((s.volume-16)/64*127):100;a.push({id:A_(r,t),channelIndex:r,startRow:t,endRow:t+o,midiNote:i,velocity:l,instrument:s.instrument,slide:2===s.flag1||2===s.flag2,accent:1===s.flag1||1===s.flag2})}}),a}(r,e):[],[r,e]),o=s.useCallback((t,s,i,o=100,l)=>{const c=l??e??0;if(!r)return;const u=I_(r),d=Xn(t),p=Math.round(o/127*64);n(c,s,{note:d,volume:16+p}),s+i<(r?.length||64)&&n(c,s+i,{note:97});const h=tf.getState().patterns[a];h&&D_(u,h,a,"Add note")},[e,r,a,n]),l=s.useCallback(e=>{const[t,s]=e.split("-"),o=parseInt(t,10),l=parseInt(s,10),c=i.find(t=>t.id===e);if(!c||!r)return;const u=I_(r);if(n(o,l,{note:0,volume:0}),c.endRow<(r?.length||64)){const e=r?.channels[o]?.rows[c.endRow];97===e?.note&&n(o,c.endRow,{note:0})}const d=tf.getState().patterns[a];d&&D_(u,d,a,"Delete note")},[i,r,a,n]),c=s.useCallback(e=>{if(!r||0===e.length)return;const t=I_(r);e.forEach(e=>{const[t,s]=e.split("-"),o=parseInt(t,10),l=parseInt(s,10),c=i.find(t=>t.id===e);if(c&&(n(o,l,{note:0,volume:0}),c.endRow<(r?.length||64))){const e=tf.getState().patterns[a],t=e?.channels[o]?.rows[c.endRow];97===t?.note&&n(o,c.endRow,{note:0})}});const s=tf.getState().patterns[a];s&&D_(t,s,a,`Delete ${e.length} notes`)},[i,r,a,n]),u=s.useCallback((e,t,s)=>{const o=i.find(t=>t.id===e);if(!o||!r)return;const l=I_(r),c=Math.max(0,o.startRow+t),u=Math.max(0,Math.min(127,o.midiNote+s)),d=o.endRow-o.startRow,[p,h]=e.split("-"),m=parseInt(p,10),f=parseInt(h,10);if(n(m,f,{note:0,volume:0}),o.endRow<(r?.length||64)){const e=r?.channels[m]?.rows[o.endRow];97===e?.note&&n(m,o.endRow,{note:0})}const g=Xn(u),y=16+Math.round(o.velocity/127*64);n(o.channelIndex,c,{note:g,volume:y}),c+d<(r?.length||64)&&n(o.channelIndex,c+d,{note:97});const b=tf.getState().patterns[a];b&&D_(l,b,a,"Move note")},[i,r,a,n]),d=s.useCallback((e,t)=>{const s=i.find(t=>t.id===e);if(!s||!r)return;const o=I_(r),l=Math.max(1,t-s.startRow),[c,u]=e.split("-"),d=parseInt(c,10),p=parseInt(u,10);if(n(d,p,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=r?.channels[d]?.rows[s.endRow];97===e?.note&&n(d,s.endRow,{note:0})}const h=Xn(s.midiNote),m=16+Math.round(s.velocity/127*64);n(s.channelIndex,s.startRow,{note:h,volume:m}),s.startRow+l<(r?.length||64)&&n(s.channelIndex,s.startRow+l,{note:97});const f=tf.getState().patterns[a];f&&D_(o,f,a,"Resize note")},[i,r,a,n]),p=s.useCallback((e,t)=>{const[s,i]=e.split("-"),o=parseInt(s,10),l=parseInt(i,10);if(!r)return;const c=I_(r),u=Math.round(t/127*64);n(o,l,{volume:16+u});const d=tf.getState().patterns[a];d&&D_(c,d,a,"Set velocity")},[r,a,n]),h=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=I_(r),i=16+Math.round(t/127*64);e.forEach(e=>{const[t,a]=e.split("-"),s=parseInt(t,10),r=parseInt(a,10);n(s,r,{volume:i})});const o=tf.getState().patterns[a];o&&D_(s,o,a,`Set velocity (${e.length} notes)`)},[r,a,n]),m=s.useRef(null),f=s.useCallback(()=>{r&&(m.current=I_(r))},[r]),g=s.useCallback((e,t)=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10),o=Math.round(t/127*64);n(r,i,{volume:16+o})},[n]),y=s.useCallback((e,t)=>{const a=16+Math.round(t/127*64);e.forEach(e=>{const[t,s]=e.split("-"),r=parseInt(t,10),i=parseInt(s,10);n(r,i,{volume:a})})},[n]),b=s.useCallback(()=>{if(!m.current)return;const e=tf.getState().patterns[a];e&&D_(m.current,e,a,"Adjust velocity"),m.current=null},[a]),v=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=I_(r);e.forEach(e=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10);n(r,i,{flag2:t?2:0})});const i=tf.getState().patterns[a];i&&D_(s,i,a,"Toggle slide")},[r,a,n]),x=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=I_(r);e.forEach(e=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10);n(r,i,{flag1:t?1:0})});const i=tf.getState().patterns[a];i&&D_(s,i,a,"Toggle accent")},[r,a,n]),w=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=I_(r),o=Math.max(1,Math.floor(4/t));e.forEach(e=>{const t=i.find(t=>t.id===e);if(!t)return;const s=Math.round(t.startRow/o)*o;if(s===t.startRow)return;const l=t.endRow-t.startRow,[c,u]=e.split("-"),d=parseInt(c,10),p=parseInt(u,10);if(n(d,p,{note:0,volume:0}),t.endRow<(r?.length||64)){const e=tf.getState().patterns[a],s=e?.channels[d]?.rows[t.endRow];97===s?.note&&n(d,t.endRow,{note:0})}const h=Xn(t.midiNote),m=16+Math.round(t.velocity/127*64);n(t.channelIndex,s,{note:h,volume:m}),s+l<(r?.length||64)&&n(t.channelIndex,s+l,{note:97})});const l=tf.getState().patterns[a];l&&D_(s,l,a,"Quantize notes")},[i,r,a,n]),k=s.useCallback((t,s,i,o)=>{if(!r||0===t.notes.length)return;const l=I_(r),c=s-t.minRow,u=i-t.minNote,d=o??e??0;t.notes.forEach(e=>{const t=e.startRow+c,a=Math.max(0,Math.min(127,e.midiNote+u)),s=e.endRow-e.startRow;if(t<0||t>=(r?.length||64))return;const i=Xn(a),o=Math.round(e.velocity/127*64);n(d,t,{note:i,volume:16+o}),t+s<(r?.length||64)&&n(d,t+s,{note:97})});const p=tf.getState().patterns[a];p&&D_(l,p,a,"Paste notes")},[e,r,a,n]);return{notes:i,pattern:r,addNote:o,deleteNote:l,deleteNotes:c,moveNote:u,resizeNote:d,setNoteVelocity:p,setMultipleVelocities:h,beginVelocityDrag:f,setVelocityNoUndo:g,setMultipleVelocitiesNoUndo:y,endVelocityDrag:b,toggleSlide:v,toggleAccent:x,quantizeNotes:w,pasteNotes:k}}const R_={z:0,s:1,x:2,d:3,c:4,v:5,g:6,b:7,h:8,n:9,j:10,m:11,q:12,2:13,w:14,3:15,e:16,r:17,5:18,t:19,6:20,y:21,7:22,u:23,i:24,9:25,o:26,0:27,p:28},j_=({channelIndex:e})=>{const{view:t,selection:a,tool:n,drag:r,clipboard:i,setHorizontalZoom:o,setVerticalZoom:l,setScroll:c,setSnapToGrid:u,setGridDivision:d,setShowVelocity:p,setShowVelocityLane:h,setChannelIndex:m,setMultiChannel:f,setScaleKey:g,setScaleRoot:y,setNoteLengthPreset:b,selectNote:v,selectNotes:x,selectAll:w,clearSelection:k,setTool:S,startDrag:M,updateDrag:N,endDrag:C,copyNotes:E,showContextMenu:P,hideContextMenu:_,setGhostNotes:T}=Ay(),{notes:A,pattern:O,addNote:I,deleteNote:D,deleteNotes:F,moveNote:R,resizeNote:j,setNoteVelocity:L,setMultipleVelocities:B,beginVelocityDrag:V,setVelocityNoUndo:z,setMultipleVelocitiesNoUndo:U,endVelocityDrag:G,toggleSlide:W,toggleAccent:H,quantizeNotes:K,pasteNotes:$}=F_(t.multiChannel?void 0:e??t.channelIndex),q=Rg(e=>e.isPlaying),X=Rg(e=>e.currentRow),{instruments:Y,currentInstrumentId:Z}=Pg(),J=s.useRef(null),[ee,te]=s.useState(400),[ae,ne]=s.useState(!1),se=s.useRef(null);s.useEffect(()=>{void 0!==e&&m(e)},[e,m]);const re=s.useRef(null),ie=s.useRef(null);s.useEffect(()=>{if(q&&null!==X){if(ie.current!==O)Ay.setState({view:{...Ay.getState().view,scrollX:0}}),ie.current=O,re.current=X;else if(null===re.current||X>=re.current){const e=48;if((X-t.scrollX)*t.horizontalZoom>e+t.horizontalZoom){const a=X-e/t.horizontalZoom;Ay.setState({view:{...Ay.getState().view,scrollX:Math.max(0,a)}})}re.current=X}}else re.current=null,ie.current=null},[q,X,O,t.scrollX,t.horizontalZoom]),s.useEffect(()=>{const e=()=>{if(J.current){const e=J.current.clientHeight-44;te(Math.max(200,e))}};e();const t=new ResizeObserver(e);return J.current&&t.observe(J.current),()=>t.disconnect()},[]);const oe=s.useMemo(()=>Math.ceil(ee/t.verticalZoom)+2,[ee,t.verticalZoom]),le=s.useMemo(()=>Math.floor(oe/12),[oe]),ce=s.useMemo(()=>{if(!q||null===X)return new Set;const e=new Set;return A.forEach(t=>{X>=t.startRow&&X<t.endRow&&e.add(t.midiNote)}),e},[q,X,A]),ue=s.useMemo(()=>{if("chromatic"===t.scaleKey)return;const e=Rx[t.scaleKey];return e?new Set(function(e,t){return e<0||e>11?[]:t.intervals.map(t=>(e+t)%12)}(t.scaleRoot,e)):void 0},[t.scaleKey,t.scaleRoot]),de=s.useCallback(()=>t.noteLengthPreset>0?t.noteLengthPreset:t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,[t.noteLengthPreset,t.snapToGrid,t.gridDivision]),pe=s.useCallback(e=>{if(!ue)return e;if(ue.has(e%12))return e;for(let t=1;t<=6;t++){if(ue.has((e+t)%12))return e+t;if(ue.has((e-t+12)%12))return e-t}return e},[ue]),he=s.useCallback(e=>{if(null===Z)return;const t=Km(),a=Y.find(e=>e.id===Z);if(!a)return;const n=Py(e);se.current=n,t.triggerNoteAttack(Z,n,Q(),.8,a)},[Z,Y]),me=s.useCallback(()=>{if(se.current&&null!==Z){Km().releaseNote(Z,se.current),se.current=null}},[Z]),fe=s.useCallback((e,t)=>{"erase"===n?D(e):v(e,t)},[n,D,v]),ge=s.useCallback((e,t,a)=>{M(t,a.clientX,a.clientY,e)},[M]),ye=s.useCallback((e,a)=>{if(_(),"draw"===n){const n=pe(a),s=de();I(n,e,s,100,t.channelIndex)}else"select"===n&&(r.isDragging||k())},[n,t.channelIndex,I,k,_,r.isDragging,pe,de]),be=s.useCallback((e,t,n,s)=>{const r=A.find(a=>e>=a.startRow&&e<a.endRow&&t===a.midiNote);r&&!a.notes.has(r.id)&&v(r.id,!1),P(n,s,r?.id||null,e,t)},[A,a.notes,v,P]),ve=s.useCallback((e,t,a)=>{if("select"!==n)return;A.find(a=>e>=a.startRow&&e<a.endRow&&t===a.midiNote)||M("select-box",a.clientX,a.clientY)},[n,A,M]),xe=s.useRef(t.scrollX),we=s.useRef(t.scrollY),ke=s.useRef(null),Se=s.useRef(t.scrollX),Me=s.useRef(t.scrollY);s.useEffect(()=>{t.scrollX!==Se.current&&(xe.current=t.scrollX),t.scrollY!==Me.current&&(we.current=t.scrollY),Se.current=t.scrollX,Me.current=t.scrollY},[t.scrollX,t.scrollY]),s.useEffect(()=>()=>{null!==ke.current&&cancelAnimationFrame(ke.current)},[]);const Ne=s.useCallback(()=>{const e=Ay.getState().view.scrollX,t=Ay.getState().view.scrollY,a=xe.current,n=we.current,s=a-e,r=n-t;if(Math.abs(s)<.1&&Math.abs(r)<.1)return c(a,n),Se.current=a,Me.current=n,void(ke.current=null);const i=e+.25*s,o=t+.25*r;c(i,o),Se.current=i,Me.current=o,ke.current=requestAnimationFrame(Ne)},[c]),Ce=s.useCallback((e,t)=>{xe.current=Math.max(0,xe.current+e),we.current=Math.max(0,Math.min(127,we.current+t)),null===ke.current&&(ke.current=requestAnimationFrame(Ne))},[Ne]);s.useEffect(()=>{const e=e=>{const a=Ay.getState().drag;if(a.isDragging){if(N(e.clientX,e.clientY),"move"===a.mode&&a.noteId){const n=e.clientX-a.startX,s=e.clientY-a.startY,r=Math.round(n/t.horizontalZoom),i=-Math.round(s/t.verticalZoom);if(0!==r||0!==i){const e=A.find(e=>e.id===a.noteId);if(e){const t=Ay.getState().selection.notes,a=(t.has(e.id)?Array.from(t):[e.id]).map(e=>{const t=A.find(t=>t.id===e);return t?{...t,startRow:Math.max(0,t.startRow+r),endRow:Math.max(1,t.endRow+r),midiNote:Math.max(0,Math.min(127,t.midiNote+i))}:null}).filter(Boolean);T(a)}}}if("select-box"===a.mode){const n=document.querySelector('[role="grid"]');if(!n)return;const s=n.getBoundingClientRect(),r=Math.min(a.startX,e.clientX)-s.left,i=Math.max(a.startX,e.clientX)-s.left,o=Math.min(a.startY,e.clientY)-s.top,l=Math.max(a.startY,e.clientY)-s.top,c=Math.floor(r/t.horizontalZoom)+t.scrollX,u=Math.ceil(i/t.horizontalZoom)+t.scrollX,d=t.scrollY+60-Math.floor(l/t.verticalZoom),p=t.scrollY+60-Math.floor(o/t.verticalZoom),h=A.filter(e=>e.startRow<u&&e.endRow>c&&e.midiNote>=d&&e.midiNote<=p).map(e=>e.id);x(h)}}},a=e=>{const a=Ay.getState().drag;if(!a.isDragging)return;if("select-box"===a.mode)return void C();if(!a.noteId)return void C();const n=a.currentX-a.startX,s=a.currentY-a.startY,r=Math.round(n/t.horizontalZoom),i=-Math.round(s/t.verticalZoom);if("move"!==a.mode||0===r&&0===i){if("resize-end"===a.mode){const e=A.find(e=>e.id===a.noteId);e&&j(a.noteId,e.endRow+r)}}else R(a.noteId,r,i);C()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",a)}},[t.horizontalZoom,t.verticalZoom,t.scrollX,t.scrollY,A,R,j,N,C,x,T]);const Ee=s.useCallback(()=>{const e=A.filter(e=>a.notes.has(e.id));e.length>0&&E(e)},[A,a.notes,E]),Pe=s.useCallback(()=>{Ee();const e=Array.from(a.notes);F(e),k()},[Ee,a.notes,F,k]),_e=s.useCallback(()=>{const e=Ay.getState().clipboard;e&&$(e,Math.floor(t.scrollX),Math.round(t.scrollY+60),t.channelIndex)},[$,t.scrollX,t.scrollY,t.channelIndex]),Ae=s.useCallback(()=>{const e=Array.from(a.notes);F(e),k()},[a.notes,F,k]),Oe=s.useCallback(()=>{w(A.map(e=>e.id))},[A,w]),Ie=s.useCallback(()=>{const e=Array.from(a.notes);K(e,t.gridDivision)},[a.notes,K,t.gridDivision]),De=s.useCallback(()=>{const e=Array.from(a.notes),t=A.filter(e=>a.notes.has(e.id)).some(e=>e.slide);W(e,!t)},[A,a.notes,W]),Fe=s.useCallback(()=>{const e=Array.from(a.notes),t=A.filter(e=>a.notes.has(e.id)).some(e=>e.accent);H(e,!t)},[A,a.notes,H]),Re=s.useCallback(()=>{const e=zg.getState().undo();e&&tf.getState().replacePattern(tf.getState().currentPatternIndex,e)},[]),je=s.useCallback(()=>{const e=zg.getState().redo();e&&tf.getState().replacePattern(tf.getState().currentPatternIndex,e)},[]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if(e.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const s=e.key,r=s.toLowerCase();if((e.ctrlKey||e.metaKey)&&"z"===r&&!e.shiftKey)return e.preventDefault(),void Re();if((e.ctrlKey||e.metaKey)&&("y"===r||"z"===r&&e.shiftKey))return e.preventDefault(),void je();if((e.ctrlKey||e.metaKey)&&"c"===r)return e.preventDefault(),void Ee();if((e.ctrlKey||e.metaKey)&&"x"===r)return e.preventDefault(),void Pe();if((e.ctrlKey||e.metaKey)&&"v"===r)return e.preventDefault(),void _e();if((e.ctrlKey||e.metaKey)&&"a"===r)return e.preventDefault(),void Oe();if("Delete"===s||"Backspace"===s)return e.preventDefault(),void Ae();if("Escape"===s)return e.preventDefault(),k(),void _();if(!e.ctrlKey&&!e.metaKey&&!e.altKey){if("q"===r&&a.notes.size>0&&"select"===n)return e.preventDefault(),void Ie();if("s"===r&&a.notes.size>0&&"select"===n&&!e.shiftKey&&"select"===n)return e.preventDefault(),void De();if("a"===r&&a.notes.size>0&&"select"===n&&!e.shiftKey)return e.preventDefault(),void Fe();if("draw"!==n){if("1"===s)return S("select"),void e.preventDefault();if("2"===s)return S("draw"),void e.preventDefault();if("3"===s)return S("erase"),void e.preventDefault()}}if(!("draw"!==n||e.ctrlKey||e.metaKey||e.altKey||e.repeat)){const a=R_[r];if(void 0!==a){e.preventDefault();const n=tf.getState().currentOctave||4,s=pe(12*n+a),r=Math.floor(t.scrollX),i=de();return I(s,r,i,100,t.channelIndex),void he(s)}}},s=e=>{const t=e.key.toLowerCase();"draw"===n&&void 0!==R_[t]&&me()};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[n,a.notes,t.scrollX,t.channelIndex,t.gridDivision,A,I,Ee,Pe,_e,Ae,Oe,Ie,De,Fe,Re,je,k,_,S,pe,de,he,me]);const Le=s.useMemo(()=>t.showVelocityLane?ee-80:ee,[ee,t.showVelocityLane]),Be=O?.length||64,Ve=s.useMemo(()=>Object.entries(Rx).map(([e,t])=>({value:e,label:t.name})),[]);return xa.jsxs("div",{ref:J,className:"flex flex-col h-full w-full bg-dark-bgSecondary",role:"application","aria-label":"Piano roll editor",children:[xa.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-border bg-dark-bgTertiary shrink-0 flex-wrap",children:[xa.jsxs("div",{className:"flex items-center bg-dark-bg rounded-md p-0.5",role:"toolbar","aria-label":"Editing tools",children:[xa.jsx("button",{onClick:()=>S("select"),className:"p-1.5 rounded transition-colors "+("select"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Select (1)","aria-pressed":"select"===n,children:xa.jsx(aa,{size:14})}),xa.jsx("button",{onClick:()=>S("draw"),className:"p-1.5 rounded transition-colors "+("draw"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Draw (2)","aria-pressed":"draw"===n,children:xa.jsx(Zt,{size:14})}),xa.jsx("button",{onClick:()=>S("erase"),className:"p-1.5 rounded transition-colors "+("erase"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Erase (3)","aria-pressed":"erase"===n,children:xa.jsx(na,{size:14})})]}),xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx("span",{className:"text-[10px] text-text-muted",children:"H"}),xa.jsx("button",{onClick:()=>o(.8*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out horizontally",children:xa.jsx(sa,{size:14})}),xa.jsx("span",{className:"text-xs text-text-muted w-6 text-center",children:Math.round(t.horizontalZoom)}),xa.jsx("button",{onClick:()=>o(1.25*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in horizontally",children:xa.jsx(ra,{size:14})})]}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx("span",{className:"text-[10px] text-text-muted",children:"V"}),xa.jsx("button",{onClick:()=>l(t.verticalZoom-2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out vertically",children:xa.jsx(At,{size:14})}),xa.jsxs("span",{className:"text-xs text-text-muted w-10 text-center",title:`${le} octaves visible`,children:[le,"oct"]}),xa.jsx("button",{onClick:()=>l(t.verticalZoom+2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in vertically",children:xa.jsx(Tt,{size:14})})]}),xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("button",{onClick:()=>u(!t.snapToGrid),className:"p-1 rounded transition-colors "+(t.snapToGrid?"text-accent-primary":"text-text-muted"),title:"Snap to grid","aria-pressed":t.snapToGrid,children:xa.jsx(Ht,{size:14})}),xa.jsxs("select",{value:t.gridDivision,onChange:e=>d(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Grid division","aria-label":"Grid division",children:[xa.jsx("option",{value:1,children:"1/1"}),xa.jsx("option",{value:2,children:"1/2"}),xa.jsx("option",{value:4,children:"1/4"}),xa.jsx("option",{value:8,children:"1/8"}),xa.jsx("option",{value:16,children:"1/16"})]})]}),xa.jsx("select",{value:t.noteLengthPreset,onChange:e=>b(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Note length","aria-label":"Note length preset",children:Ty.map(e=>xa.jsx("option",{value:e.value,children:e.label},e.value))}),xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx(Te,{size:12,className:"text-text-muted"}),xa.jsx("select",{value:t.scaleRoot,onChange:e=>y(Number(e.target.value)),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary w-10",title:"Root note","aria-label":"Scale root note",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e,t)=>xa.jsx("option",{value:t,children:e},t))}),xa.jsx("select",{value:t.scaleKey,onChange:e=>g(e.target.value),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Scale","aria-label":"Scale type",children:Ve.map(e=>xa.jsx("option",{value:e.value,children:e.label},e.value))})]}),xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsx("button",{onClick:()=>p(!t.showVelocity),className:"p-1 rounded transition-colors "+(t.showVelocity?"text-accent-primary":"text-text-muted"),title:"Show velocity on notes","aria-pressed":t.showVelocity,children:t.showVelocity?xa.jsx(lt,{size:14}):xa.jsx(ot,{size:14})}),xa.jsx("button",{onClick:()=>h(!t.showVelocityLane),className:"p-1 rounded transition-colors "+(t.showVelocityLane?"text-accent-primary":"text-text-muted"),title:"Velocity editing lane","aria-pressed":t.showVelocityLane,children:xa.jsx(mt,{size:14})}),xa.jsx("button",{onClick:()=>f(!t.multiChannel),className:"p-1 rounded transition-colors "+(t.multiChannel?"text-accent-primary":"text-text-muted"),title:"Show all channels","aria-pressed":t.multiChannel,children:xa.jsx(ea,{size:14})}),xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsxs("button",{onClick:()=>ne(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-text-primary rounded transition-colors",title:"Generate 303 acid pattern",children:[xa.jsx(at,{size:12}),"Acid"]}),!t.multiChannel&&void 0===e&&O&&xa.jsxs(xa.Fragment,{children:[xa.jsx("div",{className:"w-px h-4 bg-dark-border"}),xa.jsxs("div",{className:"flex items-center gap-1.5",children:[xa.jsx("span",{className:"text-xs text-text-muted",children:"CH"}),xa.jsx("select",{value:t.channelIndex,onChange:e=>m(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary","aria-label":"Channel",children:O.channels.map((e,t)=>xa.jsxs("option",{value:t,children:[String(t+1).padStart(2,"0")," ",e.name?`- ${e.name}`:""]},t))})]})]}),xa.jsx("div",{className:"flex-1"}),xa.jsxs("span",{className:"text-xs text-text-muted",children:[A.length," notes",a.notes.size>0&&` (${a.notes.size} sel)`,i&&` | clip:${i.notes.length}`]})]}),xa.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:[xa.jsxs("div",{className:"flex-1 flex w-full overflow-hidden min-h-0",children:[xa.jsx(C_,{verticalZoom:t.verticalZoom,scrollY:t.scrollY,visibleNotes:oe,containerHeight:Le,activeNotes:ce,scaleNotes:ue,onNotePreview:he,onNoteRelease:me}),xa.jsx(P_,{notes:A,patternLength:Be,horizontalZoom:t.horizontalZoom,verticalZoom:t.verticalZoom,scrollX:t.scrollX,scrollY:t.scrollY,gridDivision:t.gridDivision,showVelocity:t.showVelocity,selectedNotes:a.notes,playheadRow:q?X:null,containerHeight:Le,scaleNotes:ue,onNoteSelect:fe,onNoteDragStart:ge,onGridClick:ye,onGridRightClick:be,onScroll:Ce,onSelectionBoxStart:ve})]}),t.showVelocityLane&&xa.jsxs("div",{className:"flex w-full shrink-0",children:[xa.jsx("div",{className:"shrink-0",style:{width:48}})," ",xa.jsx(__,{notes:A,horizontalZoom:t.horizontalZoom,scrollX:t.scrollX,selectedNotes:a.notes,onVelocityChange:L,onMultiVelocityChange:B,onBeginDrag:V,onDragVelocity:z,onDragMultiVelocity:U,onEndDrag:G})]})]}),xa.jsx(T_,{onCopy:Ee,onCut:Pe,onPaste:_e,onDelete:Ae,onSelectAll:Oe,onQuantize:Ie,onToggleSlide:De,onToggleAccent:Fe,hasSelection:a.notes.size>0,hasClipboard:null!==i}),ae&&xa.jsx(Jx,{channelIndex:e??t.channelIndex,onClose:()=>ne(!1)})]})},L_=({curve:e,parameter:t,patternLength:a,onChange:n})=>{const r=s.useRef(null),i=s.useRef(null),[o,l]=s.useState("pencil"),[c,u]=s.useState(!1),[d,p]=s.useState(null),[h,m]=s.useState(800),f=200,g=35,y=10,b="cyan-lineart"===Zg(e=>e.currentThemeId),v=b?"#00ffff":"#00d4aa",x=b?"#00ffff":"#7c3aed",w=b?"rgba(0, 255, 255, 0.3)":"rgba(0, 212, 170, 0.3)",k=b?"#0a2020":"#1a1a1d",S=b?"#0f3030":"#252528",M=b?"#030808":"#0a0a0b",N=b?"#00a0a0":"#606068";s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e)m(t.contentRect.width)});return t.observe(e),m(e.clientWidth),()=>t.disconnect()},[]);const C=h-g-10,E=165,P=s.useCallback(e=>g+e/a*C,[a,C]),_=s.useCallback(e=>y+(1-e)*E,[E]),T=s.useCallback(e=>{const t=(e-g)/C;return Math.round(t*a)},[a,C]),A=s.useCallback(e=>{const t=1-(e-y)/E;return Math.max(0,Math.min(1,t))},[E]),O=s.useCallback(()=>{const t=i.current;if(!t)return;const n=t.getContext("2d");if(n){n.fillStyle=M,n.fillRect(0,0,h,f);for(let e=0;e<=a;e++){const t=P(e),s=e%16==0,r=e%4==0;n.strokeStyle=s?S:k,n.lineWidth=s?1.5:.5,(a<=64||r)&&(n.beginPath(),n.moveTo(t,y),n.lineTo(t,175),n.stroke()),s&&e<a&&(n.fillStyle=N,n.font="9px JetBrains Mono, monospace",n.textAlign="center",n.fillText(e.toString(),t,192))}n.strokeStyle=k,n.lineWidth=.5;for(let e=0;e<=4;e++){const t=y+e/4*E,a=2===e;n.strokeStyle=a?S:k,n.lineWidth=a?1:.5,n.beginPath(),n.moveTo(g,t),n.lineTo(h-10,t),n.stroke()}if(n.fillStyle=N,n.font="9px JetBrains Mono, monospace",n.textAlign="right",n.fillText("1.0",30,14),n.fillText("0.5",30,95.5),n.fillText("0.0",30,178),e.points.length>0){const t=n.createLinearGradient(g,0,h-10,0);t.addColorStop(0,v),t.addColorStop(1,x),n.strokeStyle=t,n.lineWidth=2,n.beginPath();const a=[...e.points].sort((e,t)=>e.row-t.row);a.forEach((t,s)=>{const r=P(t.row),i=_(t.value);if(0===s)n.moveTo(r,i);else if("linear"===e.interpolation)n.lineTo(r,i);else if("exponential"===e.interpolation){const e=a[s-1],t=P(e.row),o=t+.5*(r-t),l=_(e.value);n.quadraticCurveTo(o,l,r,i)}}),n.stroke(),a.forEach((e,t)=>{const a=P(e.row),s=_(e.value);t===d&&(n.fillStyle=w,n.beginPath(),n.arc(a,s,10,0,2*Math.PI),n.fill()),n.fillStyle=t===d?v:x,n.beginPath(),n.arc(a,s,5,0,2*Math.PI),n.fill(),n.fillStyle="#ffffff",n.beginPath(),n.arc(a,s,2,0,2*Math.PI),n.fill()})}}},[e,a,d,P,_,v,x,w,h,M,k,S,N,C,E]);s.useEffect(()=>{O()},[O]);const[I,D]=s.useState(!1),F=()=>{u(!1),D(!1)},R=s.useCallback(t=>{if(("Delete"===t.key||"Backspace"===t.key)&&null!==d){const t=e.points.filter((e,t)=>t!==d);n({...e,points:t}),p(null)}},[d,e,n]);s.useEffect(()=>(window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)),[R]);const j=(t,s)=>{if(t<0||t>a)return;const r=[...e.points],i=r.findIndex(e=>e.row===t);i>=0?r[i].value=s:r.push({row:t,value:s}),n({...e,points:r.sort((e,t)=>e.row-t.row)})},L=t=>{const s=[];for(let e=0;e<=a;e+=4){let n=0;switch(t){case"rampUp":n=e/a;break;case"rampDown":n=1-e/a;break;case"triangle":n=e<a/2?e/a*2:2-e/a*2;break;case"sine":n=(Math.sin(e/a*Math.PI*2-Math.PI/2)+1)/2;break;case"saw":n=e%(a/4)/(a/4);break;case"square":n=e<a/2?1:0;break;case"random":n=Math.random()}s.push({row:e,value:n})}n({...e,points:s})};return xa.jsxs("div",{className:"bg-dark-bg p-4",children:[xa.jsx("div",{className:"text-accent-primary text-sm font-semibold mb-3",children:t.toUpperCase()}),xa.jsxs("div",{className:"flex gap-2 mb-3 flex-wrap",children:[xa.jsxs("div",{className:"flex gap-1 flex-wrap",children:[xa.jsx("button",{onClick:()=>L("rampUp"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Up"}),xa.jsx("button",{onClick:()=>L("rampDown"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Down"}),xa.jsx("button",{onClick:()=>L("triangle"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Triangle"}),xa.jsx("button",{onClick:()=>L("sine"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Sine"}),xa.jsx("button",{onClick:()=>L("random"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Random"})]}),xa.jsx("div",{className:"w-px bg-dark-border mx-1"}),xa.jsx("button",{onClick:()=>{n({...e,points:[]})},className:"px-3 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-accent-error border border-dark-border hover:border-accent-error transition-colors",children:"Clear"})]}),xa.jsx("div",{ref:r,className:"w-full",children:xa.jsx("canvas",{ref:i,width:h,height:f,onMouseDown:t=>{const a=i.current;if(!a)return;const n=a.getBoundingClientRect(),s=a.width/n.width,r=a.height/n.height,l=(t.clientX-n.left)*s,c=(t.clientY-n.top)*r,d=T(l),h=A(c),m=e.points.findIndex(e=>{const t=P(e.row),a=_(e.value);return Math.hypot(t-l,a-c)<15});if(m>=0)return p(m),void D(!0);"pencil"===o?(u(!0),j(d,h)):"select"===o&&p(null)},onMouseMove:t=>{const s=i.current;if(!s)return;const r=s.getBoundingClientRect(),l=s.width/r.width,u=s.height/r.height,h=(t.clientX-r.left)*l,m=(t.clientY-r.top)*u,f=T(h),g=A(m);if(I&&null!==d){const t=[...e.points],s=Math.max(0,Math.min(a,f));t[d]={row:s,value:g};const r=t.sort((e,t)=>e.row-t.row),i=r.findIndex(e=>e.row===s&&Math.abs(e.value-g)<.001);n({...e,points:r}),i>=0&&i!==d&&p(i)}else"pencil"===o&&c&&j(f,g)},onMouseUp:F,onMouseLeave:F,onContextMenu:t=>{t.preventDefault();const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),r=a.width/s.width,o=a.height/s.height,l=(t.clientX-s.left)*r,c=(t.clientY-s.top)*o,u=e.points.findIndex(e=>{const t=P(e.row),a=_(e.value);return Math.hypot(t-l,a-c)<15});if(u>=0){const t=e.points.filter((e,t)=>t!==u);n({...e,points:t}),p(null)}},className:"w-full rounded-lg border border-dark-border "+(I?"cursor-grabbing":"cursor-crosshair"),style:{height:f},tabIndex:0})}),xa.jsxs("div",{className:"mt-3 flex gap-2 items-center",children:[xa.jsx("span",{className:"text-text-muted text-xs",children:"Interpolation:"}),xa.jsx("button",{onClick:()=>n({...e,interpolation:"linear"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("linear"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Linear"}),xa.jsx("button",{onClick:()=>n({...e,interpolation:"exponential"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("exponential"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Exponential"})]})]})},B_=[{label:"TB-303 Filter",params:[{id:"cutoff",name:"Cutoff",description:"Filter frequency"},{id:"resonance",name:"Resonance",description:"Filter resonance"},{id:"envMod",name:"Env Mod",description:"Envelope depth"},{id:"decay",name:"Decay",description:"Envelope decay time"}]},{label:"TB-303 Character",params:[{id:"accent",name:"Accent",description:"Accent intensity"},{id:"tuning",name:"Tuning",description:"Pitch detune"},{id:"overdrive",name:"Overdrive",description:"Saturation drive"}]},{label:"Mixer",params:[{id:"volume",name:"Volume",description:"Channel volume"},{id:"pan",name:"Pan",description:"Stereo panning"}]},{label:"Effects",params:[{id:"distortion",name:"Distortion",description:"Drive amount"},{id:"delay",name:"Delay",description:"Delay wet mix"},{id:"reverb",name:"Reverb",description:"Reverb wet mix"}]}],V_=()=>{const{patterns:e,currentPatternIndex:t}=tf(),{getAutomation:a,setAutomation:n}=Vg(),[r,i]=s.useState("cutoff"),[o,l]=s.useState(0),c="cyan-lineart"===Zg(e=>e.currentThemeId),u=c?"bg-cyan-500/20":"bg-orange-500/20",d=c?"text-cyan-400":"text-orange-400",p=c?"border-cyan-500":"border-orange-500",h=c?"hover:bg-cyan-500/30":"hover:bg-orange-500/30",m=c?"bg-cyan-500":"bg-orange-500",f=e[t],g=f?.channels.length||4,y=Math.min(o,g-1);if(!f)return xa.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const b=a(f.id,y,r);return xa.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-dark-bg",children:[xa.jsx("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:xa.jsxs("div",{className:"flex items-center justify-between",children:[xa.jsxs("div",{className:"flex items-center gap-3",children:[xa.jsx("span",{className:"text-text-secondary text-sm",children:"Automation"}),xa.jsxs("span",{className:"text-text-primary font-medium",children:["Pattern ",String(t).padStart(2,"0"),": ",f.name]})]}),xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsx("span",{className:"text-text-muted text-xs",children:"Channel:"}),xa.jsx("div",{className:"flex gap-1",children:Array.from({length:g},(e,t)=>{const a=f.channels[t];return xa.jsx("button",{onClick:()=>l(t),className:`\n                      w-8 h-7 text-xs font-mono rounded border transition-all\n                      ${y===t?"text-text-inverse border-transparent":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"}\n                    `,style:y===t?{backgroundColor:a?.color||"#22c55e"}:void 0,title:a?.name||`Channel ${t+1}`,children:t+1},t)})})]})]})}),xa.jsx("div",{className:"border-b border-dark-border bg-dark-bgSecondary p-3",children:xa.jsx("div",{className:"flex gap-6 flex-wrap",children:B_.map(e=>xa.jsxs("div",{className:"flex flex-col gap-1.5",children:[xa.jsx("div",{className:"text-text-muted text-[10px] font-medium uppercase tracking-wider",children:e.label}),xa.jsx("div",{className:"flex gap-1.5",children:e.params.map(e=>{const t=a(f.id,y,e.id).points.length>0,n=r===e.id;return xa.jsxs("button",{onClick:()=>i(e.id),className:`\n                        relative px-3 py-1.5 text-xs rounded-md border transition-all duration-150\n                        ${n?"bg-accent-primary text-text-inverse border-accent-primary shadow-glow-sm":t?`${u} ${d} ${p} ${h}`:"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight hover:text-text-primary"}\n                      `,title:e.description+(t?" (has automation)":""),children:[e.name,t&&!n&&xa.jsx("span",{className:`absolute -top-1 -right-1 w-2 h-2 ${m} rounded-full`})]},e.id)})})]},e.label))})}),xa.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:xa.jsx(L_,{curve:b,parameter:r,patternLength:f.length,onChange:e=>{n(f.id,y,r,e)}})})]})};function z_(e,t,a){let n="";for(let s=0;s<a;s++){const a=e[t+s];if(0===a)break;n+=String.fromCharCode(a)}return n.trim()}function U_(e,t){return e[t]|e[t+1]<<8}function G_(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}async function W_(e){const t=await e.arrayBuffer(),a=new Uint8Array(t),n=function(e){if(e.length>1084){const t=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);if(["M.K.","M!K!","4CHN","6CHN","8CHN","FLT4","FLT8"].includes(t))return"MOD";if(t.match(/^\d\dCH$/))return"MOD"}if(e.length>17&&"Extended Module: "===String.fromCharCode(...e.slice(0,17)))return"XM";if(e.length>48&&26===e[44]&&16===e[45]&&16===e[29])return"S3M";if(e.length>4&&"IMPM"===String.fromCharCode(e[0],e[1],e[2],e[3]))return"IT";return null}(a);if(!n)throw new Error("Unknown or unsupported module format");switch(n){case"MOD":return function(e){const t=z_(e,0,20),a=[],n=[];for(let u=0;u<31;u++){const t=20+30*u,a=z_(e,t,22),s=2*(e[t+22]<<8|e[t+23]),r=15&e[t+24],i=e[t+25],o=2*(e[t+26]<<8|e[t+27]),l=2*(e[t+28]<<8|e[t+29]);n.push({name:a,length:s,fineTune:r,volume:i,loopStart:o,loopLength:l})}const s=e[950],r=e.slice(952,1080);let i=0;for(let u=0;u<s;u++)r[u]>i&&(i=r[u]);const o=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);let l=4;"6CHN"===o?l=6:"8CHN"===o||"FLT8"===o?l=8:o.match(/^\d\dCH$/)&&(l=parseInt(o.substring(0,2),10));let c=1084+64*(i+1)*l*4;for(let u=0;u<31;u++){const t=n[u];if(0===t.length)continue;const s=new Float32Array(t.length);for(let a=0;a<t.length;a++){const t=e[c+a],n=t>127?t-256:t;s[a]=n/128}let r="none";t.loopLength>2&&(r="forward"),a.push({name:t.name||`Sample ${u+1}`,sampleRate:8363,channels:1,bitDepth:8,pcmData:s,loopStart:t.loopStart,loopEnd:t.loopStart+t.loopLength,loopType:r,baseNote:"C-4",fineTune:t.fineTune>7?t.fineTune-16:t.fineTune,volume:t.volume}),c+=t.length}return{samples:a,format:"MOD",title:t}}(a);case"XM":return function(e){const t=z_(e,17,20),a=[],n=G_(e,60),s=U_(e,72);let r=60+n;for(let i=0;i<s&&!(r>=e.length);i++){const t=G_(e,r),n=z_(e,r+4,22),s=U_(e,r+27);if(0===s){r+=t;continue}const i=G_(e,r+29);r+=t;const o=[];for(let a=0;a<s&&!(r+40>e.length);a++)o.push({length:G_(e,r),loopStart:G_(e,r+4),loopLength:G_(e,r+8),volume:e[r+12],fineTune:e[r+13]>127?e[r+13]-256:e[r+13],type:e[r+14],pan:e[r+15],relNote:e[r+16]>127?e[r+16]-256:e[r+16],name:z_(e,r+18,22)}),r+=i;for(let l=0;l<s;l++){const t=o[l];if(0===t.length)continue;const s=!!(16&t.type),i=s?t.length/2:t.length,c=new Float32Array(i);if(s){let a=0;for(let t=0;t<i;t++){const n=U_(e,r+2*t);a+=n>32767?n-65536:n,a>32767&&(a-=65536),a<-32768&&(a+=65536),c[t]=a/32768}r+=t.length}else{let a=0;for(let n=0;n<t.length;n++){const t=e[r+n];a+=t>127?t-256:t,a>127&&(a-=256),a<-128&&(a+=256),c[n]=a/128}r+=t.length}let u="none";1==(3&t.type)?u="forward":2==(3&t.type)&&(u="pingpong"),a.push({name:t.name||n||`Sample ${a.length+1}`,sampleRate:8363,channels:1,bitDepth:s?16:8,pcmData:c,loopStart:s?t.loopStart/2:t.loopStart,loopEnd:s?(t.loopStart+t.loopLength)/2:t.loopStart+t.loopLength,loopType:u,baseNote:"C-4",fineTune:t.fineTune,volume:t.volume})}}return{samples:a,format:"XM",title:t}}(a);case"S3M":return function(e){const t=z_(e,0,28),a=[],n=U_(e,34),s=[];for(let r=0;r<n;r++)s.push(16*U_(e,96+2*r));for(let r=0;r<n;r++){const t=s[r];if(0===t||t>=e.length)continue;if(1!==e[t])continue;const n=z_(e,t+48,28),i=U_(e,t+16)|e[t+18]<<16,o=U_(e,t+20)|e[t+22]<<16,l=U_(e,t+24)|e[t+26]<<16,c=e[t+28],u=e[t+31],d=G_(e,t+32),p=16*(e[t+13]<<16|U_(e,t+14));if(0===i||p>=e.length)continue;const h=!!(4&u),m=!!(1&u),f=i/((h?2:1)*(2&u?2:1)),g=new Float32Array(f);if(h)for(let a=0;a<f;a++){const t=U_(e,p+2*a);g[a]=(t-32768)/32768}else for(let a=0;a<f;a++){const t=e[p+a];g[a]=(t-128)/128}a.push({name:n||`Sample ${r+1}`,sampleRate:d||8363,channels:1,bitDepth:h?16:8,pcmData:g,loopStart:m?h?o/2:o:void 0,loopEnd:m?h?l/2:l:void 0,loopType:m?"forward":"none",baseNote:"C-4",volume:c})}return{samples:a,format:"S3M",title:t}}(a);case"IT":throw new Error("IT format sample extraction not yet implemented");default:throw new Error(`Unsupported format: ${n}`)}}function H_(e){const{pcmData:t,sampleRate:a,channels:n}=e,s=t.length,r=2*n,i=a*r,o=2*s,l=44+o,c=new ArrayBuffer(l),u=new DataView(c);K_(u,0,"RIFF"),u.setUint32(4,l-8,!0),K_(u,8,"WAVE"),K_(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,n,!0),u.setUint32(24,a,!0),u.setUint32(28,i,!0),u.setUint16(32,r,!0),u.setUint16(34,16,!0),K_(u,36,"data"),u.setUint32(40,o,!0);let d=44;for(let m=0;m<s;m++){const e=Math.max(-1,Math.min(1,t[m])),a=Math.round(32767*e);u.setInt16(d,a,!0),d+=2}const p=new Uint8Array(c);let h="";for(let m=0;m<p.length;m++)h+=String.fromCharCode(p[m]);return`data:audio/wav;base64,${btoa(h)}`}function K_(e,t,a){for(let n=0;n<a.length;n++)e.setUint8(t+n,a.charCodeAt(n))}function $_(e,t){const a=function(e){const t={version:1,name:e.name,rows:e.length,channels:e.channels.length,data:e.channels.map(e=>e.rows)},a=JSON.stringify(t,null,2);return new Blob([a],{type:"application/json"})}(e),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=`${e.name}.xp`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}function q_(e,t,a){const n=t.channels[e];if(!n)throw new Error(`Channel ${e} not found in pattern`);const s=function(e,t){const a=t.channels[e];if(!a)throw new Error(`Channel ${e} not found in pattern`);const n={version:1,name:a.name,rows:t.length,data:a.rows},s=JSON.stringify(n,null,2);return new Blob([s],{type:"application/json"})}(e,t),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`${n.name}.xt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}const X_=({onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstrumentFX:n,onShowInstruments:r,onShowImportModule:i,onShowDrumpads:o,showMasterFX:l,showInstrumentFX:c,showImportModule:u})=>{const{isMobile:d,width:p}=function(){const[e,t]=s.useState(()=>{const e="undefined"!=typeof window?window.innerWidth:1024;return{width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024}});return s.useEffect(()=>{const e=()=>{const e=window.innerWidth;t({width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),{patterns:h,currentPatternIndex:m,cursor:f,showGhostPatterns:g,loadPatterns:y,setPatternOrder:b,setOriginalModuleData:v,setShowGhostPatterns:x,scaleVolume:w,fadeVolume:k,remapInstrument:S}=tf(Da(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,showGhostPatterns:e.showGhostPatterns,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,setOriginalModuleData:e.setOriginalModuleData,setShowGhostPatterns:e.setShowGhostPatterns,scaleVolume:e.scaleVolume,fadeVolume:e.fadeVolume,remapInstrument:e.remapInstrument}))),{loadInstruments:M}=Pg(Da(e=>({loadInstruments:e.loadInstruments}))),{setMetadata:N}=Bg(Da(e=>({setMetadata:e.setMetadata}))),{setBPM:C,setSpeed:E,smoothScrolling:P,setSmoothScrolling:_,grooveTemplateId:T,swing:A,jitter:O,useMpcScale:I}=Rg(Da(e=>({setBPM:e.setBPM,setSpeed:e.setSpeed,smoothScrolling:e.smoothScrolling,setSmoothScrolling:e.setSmoothScrolling,grooveTemplateId:e.grooveTemplateId,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale}))),{masterMuted:D,toggleMasterMute:F}=Lg(Da(e=>({masterMuted:e.masterMuted,toggleMasterMute:e.toggleMasterMute}))),R=Tg(e=>e.statusMessage),j=Tg(e=>e.pendingModuleFile),L=Tg(e=>e.setPendingModuleFile),[B,V]=s.useState("tracker"),[z,U]=s.useState(0),[G,W]=s.useState(!1),[H,K]=s.useState(!1),[$,q]=s.useState(!1),[X,Y]=s.useState(!1),[Q,Z]=s.useState(!1),[J,ee]=s.useState(!1),[te,ae]=s.useState(!1),[ne,se]=s.useState(!1),[re,ie]=s.useState(!1),[oe,le]=s.useState(!1),[ce,ue]=s.useState(!1),[de,pe]=s.useState(!1),[he,me]=s.useState(!1),[fe,ge]=s.useState("block"),[ye,be]=s.useState("block"),[ve,xe]=s.useState(!1),[we,ke]=s.useState(0),[Se,Me]=s.useState(!1),Ne=u??oe,Ce=i??le,[Ee,_e]=s.useState(!0),[Te,Oe]=s.useState(!1),[Ie,De]=s.useState(!1),{fps:Fe,averageFps:Re,quality:je}={fps:60,averageFps:60,quality:Tg(e=>e.performanceQuality)};s.useEffect(()=>{"grid"===B&&requestAnimationFrame(()=>{U(f.channelIndex)})},[B,f.channelIndex]);const Le=s.useCallback(e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return!e.ctrlKey&&!e.metaKey||"i"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"h"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"f"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"o"!==e.key.toLowerCase()||e.shiftKey||e.altKey?"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey?!e.ctrlKey&&!e.metaKey||"e"!==e.key.toLowerCase()||e.shiftKey||e.altKey?(e.ctrlKey||e.metaKey)&&"h"===e.key.toLowerCase()&&e.shiftKey&&!e.altKey?(e.preventDefault(),void ae(e=>!e)):!e.ctrlKey&&!e.metaKey||"m"!==e.key.toLowerCase()||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void se(e=>!e)):(e.preventDefault(),void ee(e=>!e)):(e.preventDefault(),void Y(e=>!e)):(e.preventDefault(),void Ce(!0)):(e.preventDefault(),void q(!0)):(e.preventDefault(),void K(!0)):(e.preventDefault(),void W(!0))},[Ce,W,K,q]);s.useEffect(()=>(window.addEventListener("keydown",Le),()=>window.removeEventListener("keydown",Le)),[Le]),s.useEffect(()=>{j&&Ce(!0)},[j,Ce]),(()=>{const{cursor:e,patterns:t,currentPatternIndex:a,selection:n,currentOctave:r,recordMode:i,editStep:o,insertMode:l,multiRecEnabled:c,multiEditEnabled:u,multiRecChannels:d,recReleaseEnabled:p}=tf(Da(e=>({cursor:e.cursor,patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,selection:e.selection,currentOctave:e.currentOctave,recordMode:e.recordMode,editStep:e.editStep,insertMode:e.insertMode,multiRecEnabled:e.multiRecEnabled,multiEditEnabled:e.multiEditEnabled,multiRecChannels:e.multiRecChannels,recReleaseEnabled:e.recReleaseEnabled}))),h=tf(e=>e.moveCursor),m=tf(e=>e.moveCursorToRow),f=tf(e=>e.moveCursorToChannel),g=tf(e=>e.moveCursorToColumn),y=tf(e=>e.setCell),b=tf(e=>e.clearCell),v=tf(e=>e.setCurrentPattern),x=tf(e=>e.startSelection),w=tf(e=>e.endSelection),k=tf(e=>e.clearSelection),S=tf(e=>e.copySelection),M=tf(e=>e.cutSelection),N=tf(e=>e.paste),C=tf(e=>e.pasteMix),E=tf(e=>e.pasteFlood),P=tf(e=>e.pastePushForward),_=tf(e=>e.setCurrentOctave),T=tf(e=>e.transposeSelection),A=tf(e=>e.interpolateSelection),O=tf(e=>e.humanizeSelection),I=tf(e=>e.toggleRecordMode),D=tf(e=>e.setEditStep),F=tf(e=>e.writeMacroSlot),R=tf(e=>e.readMacroSlot),j=tf(e=>e.toggleInsertMode),L=tf(e=>e.setKeyOn),B=tf(e=>e.setKeyOff),V=tf(e=>e.findBestChannel),z=tf(e=>e.insertRow),U=tf(e=>e.deleteRow),G=tf(e=>e.setPtnJumpPos),W=tf(e=>e.getPtnJumpPos),{isPlaying:H,currentRow:K,stop:$,play:q,togglePlayPause:X}=Rg(Da(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow,stop:e.stop,play:e.play,togglePlayPause:e.togglePlayPause}))),{instruments:Y,currentInstrumentId:Q,setCurrentInstrument:Z}=Pg(),J=t[a],ee=s.useRef(new Map),te=s.useCallback(()=>u&&i&&!H||c&&i&&H?V():e.channelIndex,[e.channelIndex,i,H,u,c,V]),ae=s.useCallback((e,t,a)=>{if(null===Q)return;const n=Km(),s=Y.find(e=>e.id===Q);if(!s)return;const r=`${e}${t}`,i=Un(`${e}-${t}`);if(ee.current.has(a))return;const o=ee.current.size>0,l="TB303"===s.synthType||"Buzz3o3"===s.synthType,c=o&&l,u=!1,d=te(),{midiPolyphonic:p}=Wm.getState();p?n.triggerPolyNoteAttack(Q,r,1,s,u,c):n.triggerNoteAttack(Q,r,void 0,1,s,void 0,u,c),ee.current.set(a,{note:r,xmNote:i,instrumentId:Q,channelIndex:d}),L(d,i)},[Q,Y,te,L]),ne=s.useCallback(e=>{const t=ee.current.get(e);if(!t)return;const a=Km(),n=Y.find(e=>e.id===t.instrumentId),{midiPolyphonic:s}=Wm.getState();s&&n?a.triggerPolyNoteRelease(t.instrumentId,t.note,n):a.releaseNote(t.instrumentId,t.note),B(t.channelIndex),p&&i&&H&&y(t.channelIndex,K,{note:97}),ee.current.delete(e)},[Y,B,p,i,H,y,K]),se=s.useCallback((t,a,n)=>{const s=Un(`${t}-${a}`);if(0===s)return;const r=void 0!==n?n:te(),c=i&&H?K:e.rowIndex;if(l&&!H&&z(r,c),y(r,c,{note:s,instrument:null!==Q?Q:void 0}),Tg.getState().chordEntryMode&&!H&&void 0===n){const t=J.channels.length,a=e.channelIndex+1;if(a<t)return void f(a)}o>0&&!H&&m((e.rowIndex+o)%J.length)},[e,y,i,o,J,m,f,H,K,l,z,te]),re=s.useCallback(()=>{z(e.channelIndex,e.rowIndex)},[e,z]),ie=s.useCallback(()=>{U(e.channelIndex,e.rowIndex)},[e,U]),oe=s.useCallback(s=>{if(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const l=s.key,c=l.toLowerCase();if("F9"===l){if(s.preventDefault(),s.shiftKey)G(0,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(0);m(e),q()}else m(0);return}if("F10"===l){if(s.preventDefault(),s.shiftKey)G(1,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(1);m(e),q()}else m(Math.floor(.25*J.length));return}if("F11"===l){if(s.preventDefault(),s.shiftKey)G(2,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(2);m(e),q()}else m(Math.floor(.5*J.length));return}if("F12"===l){if(s.preventDefault(),s.shiftKey)G(3,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(3);m(e),q()}else m(Math.floor(.75*J.length));return}if("PageUp"===l)return s.preventDefault(),void m(Math.max(0,e.rowIndex-16));if("PageDown"===l)return s.preventDefault(),void m(Math.min(J.length-1,e.rowIndex+16));if("Home"===l)return s.preventDefault(),void m(0);if("End"===l)return s.preventDefault(),void m(J.length-1);if("Tab"===l)return s.preventDefault(),s.shiftKey?"note"===e.columnType&&(e.channelIndex>0?f(e.channelIndex-1):f(J.channels.length-1)):e.channelIndex<J.channels.length-1?f(e.channelIndex+1):f(0),void g("note");if(s.altKey&&void 0!==rw[c]){s.preventDefault();const e=rw[c]%J.channels.length;return f(e),void g("note")}if(s.altKey&&void 0!==iw[c]){s.preventDefault();const e=iw[c]%J.channels.length;return f(e),void g("note")}if((s.ctrlKey||s.metaKey)&&l>="1"&&l<="8"&&!s.altKey){s.preventDefault();const e=parseInt(l)-1;return void(s.shiftKey?F(e):R(e))}if("Insert"===l)return s.preventDefault(),void(i?(s.shiftKey,re()):j());if(i&&(s.ctrlKey||s.metaKey)&&"ArrowUp"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?T(12):T(1));if(i&&(s.ctrlKey||s.metaKey)&&"ArrowDown"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?T(-12):T(-1));if("ArrowUp"===l)return s.preventDefault(),void(s.altKey?(n||x(),h("up"),w()):h("up"));if("ArrowDown"===l)return s.preventDefault(),void(s.altKey?(n||x(),h("down"),w()):h("down"));if("ArrowLeft"===l)return s.preventDefault(),void(s.altKey?(n||x(),h("left"),w()):h("left"));if("ArrowRight"===l)return s.preventDefault(),void(s.altKey?(n||x(),h("right"),w()):h("right"));if("Delete"===l&&i)return s.preventDefault(),s.shiftKey?y(e.channelIndex,e.rowIndex,{note:0,instrument:0,volume:0,effTyp:0,eff:0}):s.ctrlKey||s.metaKey?y(e.channelIndex,e.rowIndex,{volume:0,effTyp:0,eff:0}):s.altKey?y(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"note"===e.columnType?y(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?y(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?y(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?y(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?y(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?y(e.channelIndex,e.rowIndex,{probability:void 0}):b(e.channelIndex,e.rowIndex),void(o>0&&!H&&m((e.rowIndex+o)%J.length));if("Backspace"===l&&i)return s.preventDefault(),void(s.shiftKey?e.rowIndex>0&&(h("up"),ie()):e.rowIndex>0&&(h("up"),b(e.channelIndex,e.rowIndex)));if("F3"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&M());if("F4"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&S());if("F5"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&N());if((s.ctrlKey||s.metaKey)&&"c"===c&&!s.altKey)return s.preventDefault(),S(),void Tg.getState().setStatusMessage("COPY");if((s.ctrlKey||s.metaKey)&&"x"===c&&!s.altKey)return s.preventDefault(),M(),void Tg.getState().setStatusMessage("CUT");if((s.ctrlKey||s.metaKey)&&"v"===c&&!s.altKey)return s.preventDefault(),void(s.shiftKey?(C(),Tg.getState().setStatusMessage("MIX PASTE")):(N(),Tg.getState().setStatusMessage("PASTE")));if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"f"===c)return s.preventDefault(),void E();if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"i"===c)return s.preventDefault(),void P();if("Escape"===l)return s.preventDefault(),void k();if("Shift"===s.key&&2===s.location)return s.preventDefault(),i||I(),void q();if("Control"===s.key&&2===s.location)return s.preventDefault(),void q();if("Alt"===s.key&&2===s.location)return s.preventDefault(),void q();if(" "===l){if(s.preventDefault(),H)$(),Tg.getState().setStatusMessage("STOPPED");else{I();const e=tf.getState().recordMode;Tg.getState().setStatusMessage(e?"RECORD ON":"RECORD OFF")}return}if("Enter"===l&&(s.ctrlKey||s.metaKey))return s.preventDefault(),q(),void Tg.getState().setStatusMessage("PLAYING");if("CapsLock"===l){if(s.preventDefault(),"note"===e.columnType){const t=i&&H?K:e.rowIndex;y(e.channelIndex,t,{note:97}),o>0&&!H&&m((e.rowIndex+o)%J.length)}return}if(l>="F1"&&l<="F7"){s.preventDefault();const e=parseInt(l.substring(1));return _(e),void Tg.getState().setStatusMessage(`OCTAVE ${e}`)}if("`"===l||"~"===l){let e;return s.preventDefault(),e=s.shiftKey?0===o?16:o-1:16===o?0:o+1,D(e),void Tg.getState().setStatusMessage(`EDIT STEP ${e}`)}if("NumpadAdd"===s.code||"+"===l&&!s.shiftKey&&3===s.location)return s.preventDefault(),void(r<7&&_(r+1));if("NumpadSubtract"===s.code||"-"===l&&3===s.location)return s.preventDefault(),void(r>1&&_(r-1));if(s.shiftKey&&"ArrowLeft"===l)return s.preventDefault(),void(a>0&&v(a-1));if(s.shiftKey&&"ArrowRight"===l)return s.preventDefault(),void(a<t.length-1&&v(a+1));if(s.shiftKey&&"ArrowUp"===l){if(s.preventDefault(),null!==Q&&Q>0){const e=Y.find(e=>e.id===Q-1);e&&Z(e.id)}return}if(s.shiftKey&&"ArrowDown"===l){if(s.preventDefault(),null!==Q){const e=Y.find(e=>e.id===Q+1);e&&Z(e.id)}return}if(sw[c]&&!s.altKey&&!s.ctrlKey&&!s.metaKey&&!s.repeat&&"note"===e.columnType){s.preventDefault();const{note:e,octaveOffset:t}=sw[c],a=r+t;if(ae(e,a,c),i){const t=ee.current.get(c),n=t?.channelIndex;se(e,a,n)}return}if(sw[c]&&s.repeat&&"note"===e.columnType){if(s.preventDefault(),i&&!H){const{note:e,octaveOffset:t}=sw[c],a=r+t,n=ee.current.get(c);se(e,a,n?.channelIndex)}return}const u=J.channels[e.channelIndex].rows[e.rowIndex];if(i&&"instrument"===e.columnType&&ow.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.instrument||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,n>128&&(n=128),y(e.channelIndex,e.rowIndex,{instrument:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&"volume"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=u.volume||0;if(0===e.digitIndex){const a=lw[c];if(void 0!==a){s.preventDefault();let n=a<<4|15&t;return n>=81&&n<=95&&(n=80),y(e.channelIndex,e.rowIndex,{volume:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}}else if(ow.includes(l)){s.preventDefault();const a=parseInt(l,16);let n;return n=t<16?16+a:240&t|a,n>=81&&n<=95&&(n=80),y(e.channelIndex,e.rowIndex,{volume:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}}if(i&&"effTyp"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=cw[c];if(void 0!==t)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{effTyp:t}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&"effParam"===e.columnType&&ow.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.eff||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,y(e.channelIndex,e.rowIndex,{eff:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&"effTyp2"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=cw[c];if(void 0!==t)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{effTyp2:t}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&("flag1"===e.columnType||"flag2"===e.columnType)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=e.columnType;if("a"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:1}),void(o>0&&!H&&m((e.rowIndex+o)%J.length));if("s"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:2}),void(o>0&&!H&&m((e.rowIndex+o)%J.length));if("m"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:3}),void(o>0&&!H&&m((e.rowIndex+o)%J.length));if("h"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:4}),void(o>0&&!H&&m((e.rowIndex+o)%J.length));if("0"===l||"."===l)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:0}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&"effParam2"===e.columnType&&ow.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.eff2||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,y(e.channelIndex,e.rowIndex,{eff2:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}if(i&&"probability"===e.columnType&&/^[0-9]$/.test(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,10),a=u.probability||0;let n;return n=0===e.digitIndex?10*t+a%10:10*Math.floor(a/10)+t,n=Math.min(99,Math.max(0,n)),y(e.channelIndex,e.rowIndex,{probability:n}),void(o>0&&!H&&m((e.rowIndex+o)%J.length))}},[e,J,t,a,H,K,r,Q,Y,n,i,I,o,D,h,m,f,g,y,b,v,Z,$,q,x,w,k,S,M,N,C,E,P,ae,se,re,ie,T,A,O,G,W]),le=s.useCallback(e=>{const t=e.key.toLowerCase();sw[t]&&ne(t)},[ne]);s.useEffect(()=>(window.addEventListener("keydown",oe,{capture:!0}),window.addEventListener("keyup",le,{capture:!0}),()=>{window.removeEventListener("keydown",oe,{capture:!0}),window.removeEventListener("keyup",le,{capture:!0})}),[oe,le])})();const Be=(()=>{const{cursor:e,selection:t,clipboard:a,patterns:n,currentPatternIndex:r,startSelection:i,endSelection:o,clearSelection:l,copySelection:c,cutSelection:u,paste:d,setCell:p}=tf(),[h,m]=s.useState({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}),f=n[r],g=s.useCallback(()=>{i(),m(e=>({...e,blockStartMarked:!0,blockEndMarked:!1,isBlockSelected:!1}))},[i,e]),y=s.useCallback(()=>{o(),m(e=>({...e,blockEndMarked:!0,isBlockSelected:!0}))},[o,e]),b=s.useCallback(()=>{t&&c()},[t,c]),v=s.useCallback(()=>{a&&d()},[a,d,e]),x=s.useCallback(()=>{t&&(u(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}))},[t,u]),w=s.useCallback(()=>{l(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1})},[l]),k=s.useCallback(()=>t?{startChannel:Math.min(t.startChannel,t.endChannel),endChannel:Math.max(t.startChannel,t.endChannel),startRow:Math.min(t.startRow,t.endRow),endRow:Math.max(t.startRow,t.endRow)}:null,[t]),S=s.useCallback((e,t)=>{const a=k();return!!a&&e>=a.startChannel&&e<=a.endChannel&&t>=a.startRow&&t<=a.endRow},[k]),M=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++)for(let n=t.startRow;n<=t.endRow;n++){const t=f.channels[a].rows[n];if(t.note&&0!==t.note&&97!==t.note){const s=qn(t.note);if(null!==s){const t=s+e;if(t>=12&&t<=107){const e=Xn(t);p(a,n,{note:e})}}}}},[k,f,p]),N=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++)for(let n=t.startRow;n<=t.endRow;n++){const t=f.channels[a].rows[n];if(null!==t.volume){const s=Math.min(64,Math.max(0,Math.round(t.volume*e)));p(a,n,{volume:s})}}},[k,f,p]),C=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++){const n=f.channels[a].rows[t.startRow],s=f.channels[a].rows[t.endRow],r=n[e]||0,i=s[e]||0,o=t.endRow-t.startRow;if(!(o<=1))for(let l=1;l<o;l++){const n=l/o,s=Math.round(r+(i-r)*n),c=t.startRow+l;p(a,c,{[e]:s})}}},[k,f,p]),E=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const a=[];for(let n=e.startChannel;n<=e.endChannel;n++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[n].rows[a]});a.push(t)}for(let n=e.startChannel;n<=e.endChannel;n++){const s=n-e.startChannel;for(let r=0;r<t;r++){const i=a[s][t-1-r];p(n,e.startRow+r,{note:i.note,instrument:i.instrument,volume:i.volume,effTyp:i.effTyp,eff:i.eff,effTyp2:i.effTyp2,eff2:i.eff2,flag1:i.flag1,flag2:i.flag2})}}},[k,f,p]),P=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,a=f.channels[0]?.rows.length||64,n=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[s].rows[a]});n.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const r=s-e.startChannel;for(let i=0;i<2*t;i++){const t=e.startRow+i;if(t>=a)break;if(i%2==0){const e=n[r][i/2];p(s,t,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(s,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}e.startRow},[k,f,p]),_=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const a=[];for(let n=e.startChannel;n<=e.endChannel;n++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[n].rows[a]});a.push(t)}for(let n=e.startChannel;n<=e.endChannel;n++){const s=n-e.startChannel;for(let r=0;r<t;r++){const i=e.startRow+r,o=2*r;if(o<t){const e=a[s][o];p(n,i,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(n,i,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[k,f,p]),T=s.useCallback((e,t,a)=>{const n=k();if(n)for(let s=n.startChannel;s<=n.endChannel;s++)for(let r=n.startRow;r<=n.endRow;r++){const n=f.channels[s].rows[r][a];if(0===n&&"volume"===a)continue;let i;switch(e){case"add":i=n+t;break;case"sub":i=n-t;break;case"mul":i=Math.round(n*t);break;case"div":i=0!==t?Math.round(n/t):n}const o="volume"===a?80:255;i=Math.max(0,Math.min(o,i)),p(s,r,{[a]:i})}},[k,f,p]),A=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,a=f.channels[0]?.rows.length||64,n=[];for(let r=e.startChannel;r<=e.endChannel;r++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[r].rows[a]});n.push(t)}let s=e.endRow+1;for(;s<a;){for(let a=e.startChannel;a<=e.endChannel;a++){const r=a-e.startChannel,i=(s-e.endRow-1)%t,o=n[r][i];p(a,s,{note:o.note,instrument:o.instrument,volume:o.volume,effTyp:o.effTyp,eff:o.eff,effTyp2:o.effTyp2,eff2:o.eff2,flag1:o.flag1,flag2:o.flag2})}s++}},[k,f,p]);return s.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return e.altKey&&"b"===e.key.toLowerCase()?(e.preventDefault(),void g()):e.altKey&&"e"===e.key.toLowerCase()?(e.preventDefault(),void y()):e.altKey&&"c"===e.key.toLowerCase()?(e.preventDefault(),void b()):!e.altKey||"v"!==e.key.toLowerCase()&&"p"!==e.key.toLowerCase()?e.altKey&&"x"===e.key.toLowerCase()?(e.preventDefault(),void x()):"Escape"===e.key&&t?(e.preventDefault(),void w()):e.altKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(1)):e.altKey&&e.shiftKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(-1)):!e.altKey||"r"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?!e.altKey||"d"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?void 0:(e.preventDefault(),void A()):(e.preventDefault(),void E()):(e.preventDefault(),void v())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,y,b,v,x,w,M,E,A,t]),{blockState:h,selection:t,clipboard:a,markBlockStart:g,markBlockEnd:y,copyBlock:b,pasteBlock:v,cutBlock:x,clearBlock:w,isCellInBlock:S,getBlockBounds:k,transposeBlock:M,amplifyBlock:N,interpolateBlock:C,reverseBlock:E,expandBlock:P,shrinkBlock:_,mathBlock:T,duplicateBlock:A}})();(()=>{const{patterns:e,currentPatternIndex:t,setCurrentPattern:a,patternOrder:n,currentPositionIndex:r,setCurrentPosition:i}=tf(),{isPlaying:o,isLooping:l,bpm:c,setCurrentRow:u,setCurrentRowThrottled:d}=Rg(),{instruments:p}=Pg(),{automation:h}=Vg(),{masterEffects:m}=Lg(),f=n[r]??t,g=e[f],y=Km(),b=Sx(),v=s.useRef(!1);s.useEffect(()=>{y.setBPM(c)},[c]),s.useEffect(()=>{y.rebuildMasterEffects(m)},[m]),s.useEffect(()=>{g&&(g.channels.forEach((e,t)=>{const a=e.volume>0?e.volume/100*60-60:-1/0;y.setChannelVolume(t,a),y.setChannelPan(t,e.pan)}),y.updateMuteStates(g.channels.map(e=>({muted:e.muted,solo:e.solo}))))},[g]),s.useEffect(()=>{if(o&&g&&!v.current){v.current=!0;const s=g.importMetadata?.sourceFormat??"XM",r=g.importMetadata?.modData,o=l?[t]:n;b.loadSong({name:g.importMetadata?.sourceFile??g.name??"Untitled",format:s,patterns:e,instruments:p,songPositions:o,songLength:l?1:r?.songLength??n.length,restartPosition:0,numChannels:g.channels.length,initialSpeed:r?.initialSpeed??6,initialBPM:r?.initialBPM??c});let u=-1,h=-1;b.onRowChange=(t,n,s)=>{d(t,e[n]?.length??64),0!==t||n===u&&s===h||(u=n,h=s,queueMicrotask(()=>{a(n),i(s)}))},b.onSongEnd=()=>{},b.play().catch(e=>{})}else!o&&v.current&&(v.current=!1,b.stop(),b.onRowChange=null,b.onSongEnd=null,u(0));return()=>{!o&&v.current&&(b.stop(),b.onRowChange=null,b.onSongEnd=null)}},[o,l,g,p,n,e,c,t,a,i,u,d])})();const Ve=s.useCallback(async(e,t)=>{const{useLibopenmpt:a}=t;if(Km().releaseAll(),e.nativeData){const{format:t,importMetadata:n,instruments:s,patterns:r}=e.nativeData;let i;if("XM"===t)i=eP(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);else if("MOD"===t)i=tP(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);else if("FUR"===t||"DMF"===t){const e=n.modData?.patternOrderTable||[],t=r[0]?.length||64,a=n.originalChannelCount||r[0]?.[0]?.length||4;i={patterns:r.map((e,s)=>({id:`pattern-${s}`,name:`Pattern ${s}`,length:t,importMetadata:n,channels:Array.from({length:a},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:s.map(e=>e.name)}}else i=tP(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);if(0===i.patterns.length)return void ty.error(`Module "${e.metadata.title}" contains no patterns to import.`);const o=[];for(let e=0;e<s.length;e++){const a=nP(s[e],s[e].id,t);o.push(...a)}M(o),y(i.patterns),i.order&&i.order.length>0&&b(i.order),i.originalModuleData?v(i.originalModuleData):v(null),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"} (${t})`}),C(n.modData?.initialBPM||125),E(n.modData?.initialSpeed||6);return o.filter(e=>"Sampler"===e.synthType).length>0&&await Km().preloadInstruments(o),void ty.success(`Imported "${e.metadata.title}" - ${i.patterns.length} patterns, ${o.length} instruments`)}if(!e.metadata.song)return void ty.error(`Module "${e.metadata.title}" loaded but no pattern data found.`);const n=JE(e.metadata.song);if(0===n.patterns.length)return void ty.error(`Module "${e.metadata.title}" contains no patterns to import.`);let s;if(e.file&&function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".s3m"].includes(t)}(e.file.name))try{const t=await W_(e.file);s=new Map;for(let e=0;e<t.samples.length;e++){const a=t.samples[e];if(a.pcmData.length>0){const t=H_(a);s.set(e+1,t)}}}catch(i){}const r=function(e,t,a){const n=new Set;for(const i of e)for(const e of i.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&n.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const i of Array.from(n).sort((e,t)=>e-t)){const e=t[i-1]||`Instrument ${i}`,n=a?.get(i);if(n)s.push({id:i,name:e.trim()||`Sample ${i}`,type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:n}});else{const t=r[(i-1)%r.length];s.push({id:i,name:e.trim()||`Instrument ${i}`,type:"synth",synthType:"Synth",oscillator:{...Fn,type:t},envelope:{...Rn},filter:{...jn},effects:[],volume:-6,pan:0})}}for(const i of[0,1])if(!n.has(i)){const e=a?.get(i);e?s.push({id:i,name:0===i?"Default":"Sample 01",type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:e}}):s.push({id:i,name:0===i?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Fn,type:"sawtooth"},envelope:{...Rn},filter:{...jn},effects:[],volume:-6,pan:0})}return s.sort((e,t)=>e.id-t.id),s}(n.patterns,n.instrumentNames,s);M(r),y(n.patterns),n.order&&n.order.length>0&&b(n.order),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"}`}),C(125);r.filter(e=>"Sampler"===e.synthType).length>0&&await Km().preloadInstruments(r),ty.success(`Imported "${e.metadata.title}" - ${n.patterns.length} patterns, ${r.length} instruments`)},[M,y,N,C,E,b,v]),ze=s.useCallback(e=>{ke(e),xe(!0)},[]),Ue=h[m];return d?xa.jsxs(xa.Fragment,{children:[xa.jsx(N_,{onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstruments:r,showMasterFX:l}),xa.jsx(fw,{isOpen:G,onClose:()=>W(!1)}),xa.jsx(gw,{isOpen:H,onClose:()=>K(!1)}),xa.jsx(yw,{isOpen:$,onClose:()=>q(!1)}),xa.jsx(TN,{isOpen:X,onClose:()=>Y(!1)}),xa.jsx(CN,{isOpen:Q,onClose:()=>Z(!1)}),xa.jsx(GN,{isOpen:J,onSelect:(e,t)=>{const{cursor:a,setCell:n}=tf.getState();n(a.channelIndex,a.rowIndex,{effTyp:e,eff:t}),ee(!1)},onClose:()=>ee(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:a}=tf.getState(),n=t[a];if(!n)return;const s=n.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Pg.getState().getInstrument(s.instrument);return r?.synthType})()}),xa.jsx(KN,{isOpen:te,onClose:()=>ae(!1)}),xa.jsx($N,{isOpen:ne,onClose:()=>se(!1)}),xa.jsx(wN,{isOpen:Ne,onClose:()=>{Ce(!1),L(null)},onImport:Ve,initialFile:j}),ce&&xa.jsx(kN,{scope:fe,onConfirm:e=>{w(fe,e),ue(!1)},onCancel:()=>ue(!1)}),de&&xa.jsx(SN,{scope:fe,onConfirm:(e,t)=>{k(fe,e,t),pe(!1)},onCancel:()=>pe(!1)}),he&&xa.jsx(MN,{scope:ye,onConfirm:(e,t)=>{S(e,t,ye),me(!1)},onCancel:()=>me(!1)}),ve&&xa.jsx(Jx,{channelIndex:we,onClose:()=>xe(!1)})]}):xa.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-dark-bg overflow-y-hidden",children:[xa.jsx("div",{className:"flex-shrink min-h-[80px]",children:xa.jsx(o_,{onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstrumentFX:n,onShowInstruments:r,onShowPatternOrder:()=>Me(!0),onShowDrumpads:o,showMasterFX:l,showInstrumentFX:c})}),"tb303"!==B&&xa.jsx("div",{className:"flex-shrink-0",children:xa.jsx(u_,{})}),xa.jsxs("div",{className:"flex-shrink flex items-center justify-between px-2 py-1 bg-dark-bgTertiary border-b border-dark-border min-h-[28px]",children:[xa.jsxs("div",{className:"flex items-center gap-2",children:[xa.jsxs("div",{className:"flex items-center gap-1",children:["tracker"===B&&xa.jsx(ia,{size:14,className:"text-text-secondary"}),"grid"===B&&xa.jsx(Ht,{size:14,className:"text-text-secondary"}),"pianoroll"===B&&xa.jsx(oa,{size:14,className:"text-text-secondary"}),"tb303"===B&&xa.jsx(Pe,{size:14,className:"text-text-secondary"}),xa.jsxs("select",{value:B,onChange:e=>V(e.target.value),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",title:"Select editor view",children:[xa.jsx("option",{value:"tracker",children:"Tracker"}),xa.jsx("option",{value:"grid",children:"Grid"}),xa.jsx("option",{value:"pianoroll",children:"Piano Roll"}),xa.jsx("option",{value:"tb303",children:"TB-303"})]})]}),("grid"===B||"pianoroll"===B)&&Ue&&xa.jsxs(xa.Fragment,{children:[xa.jsx("span",{className:"text-text-secondary text-[10px] font-medium",children:"CH:"}),xa.jsx("select",{value:z,onChange:e=>U(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",children:Ue.channels.map((e,t)=>xa.jsx("option",{value:t,children:(t+1).toString().padStart(2,"0")},t))})]}),"tracker"===B&&xa.jsxs("button",{onClick:()=>x(!g),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${g?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:g?"Hide ghost patterns":"Show ghost patterns",children:[g?xa.jsx(lt,{size:12}):xa.jsx(ot,{size:12}),xa.jsx("span",{children:"Ghosts"})]}),"tracker"===B&&xa.jsxs("button",{onClick:()=>Oe(!Te),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${Te?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Advanced Edit Panel",children:[xa.jsx(Ae,{size:12}),xa.jsx("span",{children:"Edit"})]}),"tracker"===B&&xa.jsxs("button",{onClick:()=>De(!0),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Automation Editor",children:[xa.jsx(Ze,{size:12}),xa.jsx("span",{children:"Auto"})]}),xa.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Drumpad Editor",children:[xa.jsx(gt,{size:12}),xa.jsx("span",{children:"Pads"})]}),xa.jsx("div",{className:"w-px h-4 bg-dark-border mx-1"}),xa.jsx("button",{onClick:F,className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${D?"bg-accent-error/20 text-accent-error":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:D?"Unmute master output":"Mute master output",children:D?"Unmute":"Mute"}),xa.jsx("button",{onClick:()=>_(!P),className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${P?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:P?"Switch to stepped scrolling":"Switch to smooth scrolling",children:P?"Smooth":"Stepped"}),xa.jsxs("div",{className:"flex items-center gap-1 ml-1 pl-2 border-l border-dark-border",children:[xa.jsx("button",{onClick:()=>ie(!0),className:"px-2 py-1 text-[10px] rounded font-mono font-bold transition-colors "+("straight"!==T||A!==(I?50:100)||O>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/50":"bg-dark-bgSecondary text-text-secondary border border-dark-border hover:text-text-primary"),title:`Groove Settings (Current: ${Bn.find(e=>e.id===T)?.name||"None"})`,children:"GROOVE"}),re&&xa.jsx(NC,{onClose:()=>ie(!1)})]}),R&&xa.jsx("div",{className:"flex items-center px-3 ml-2 pl-3 border-l border-dark-border",children:xa.jsx("span",{className:"text-accent-primary font-bold tracking-[0.3em] text-[11px] animate-pulse font-mono",children:R.toUpperCase()})})]}),xa.jsxs("div",{className:`\n            flex items-center gap-1 px-2 py-0.5 text-xs rounded font-mono\n            ${"low"===je?"bg-accent-error/20 text-accent-error":"medium"===je?"bg-orange-500/20 text-orange-400":"bg-green-500/20 text-green-400"}\n          `,title:`Performance: ${je.toUpperCase()} | Avg FPS: ${Re} | Current: ${Fe}`,children:[xa.jsx("span",{className:"font-bold",children:Re}),xa.jsx("span",{className:"text-[10px] opacity-70",children:"FPS"}),xa.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${"low"===je?"bg-accent-error":"medium"===je?"bg-orange-400":"bg-green-400"} animate-pulse`})]})]}),xa.jsxs("div",{className:"flex-1 min-h-0 min-w-0 relative z-10 flex overflow-hidden",children:[xa.jsx("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col overflow-hidden",children:"tracker"===B?xa.jsx(Tx,{onAcidGenerator:ze}):"grid"===B?xa.jsx(nw,{channelIndex:z}):"pianoroll"===B?xa.jsx(j_,{channelIndex:z}):xa.jsx("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden bg-dark-bgPrimary",children:xa.jsx(y_,{channelIndex:z})})}),p>=900&&xa.jsx("button",{onClick:()=>_e(!Ee),className:`\n              flex-shrink-0 w-6 flex items-center justify-center\n              bg-ft2-header border-l border-ft2-border\n              hover:bg-ft2-border transition-colors\n              ${Ee?"text-ft2-highlight":"text-ft2-textDim"}\n            `,title:Ee?"Hide Instruments":"Show Instruments",children:xa.jsx(jt,{size:14,className:Ee?"":"rotate-180"})}),p>=900&&Ee&&xa.jsx("div",{className:"flex-shrink-0 w-fit min-w-48 max-w-80 border-l border-ft2-border flex flex-col overflow-hidden animate-fade-in",children:xa.jsx(M_,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})})]}),xa.jsx(fw,{isOpen:G,onClose:()=>W(!1)}),xa.jsx(gw,{isOpen:H,onClose:()=>K(!1)}),xa.jsx(yw,{isOpen:$,onClose:()=>q(!1)}),xa.jsx(TN,{isOpen:X,onClose:()=>Y(!1)}),xa.jsx(CN,{isOpen:Q,onClose:()=>Z(!1)}),xa.jsx(GN,{isOpen:J,onSelect:(e,t)=>{const{cursor:a,setCell:n}=tf.getState();n(a.channelIndex,a.rowIndex,{effTyp:e,eff:t}),ee(!1)},onClose:()=>ee(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:a}=tf.getState(),n=t[a];if(!n)return;const s=n.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Pg.getState().getInstrument(s.instrument);return r?.synthType})()}),xa.jsx(KN,{isOpen:te,onClose:()=>ae(!1)}),xa.jsx($N,{isOpen:ne,onClose:()=>se(!1)}),xa.jsx(wN,{isOpen:Ne,onClose:()=>{Ce(!1),L(null)},onImport:Ve,initialFile:j}),ce&&xa.jsx(kN,{scope:fe,onConfirm:e=>{w(fe,e),ue(!1)},onCancel:()=>ue(!1)}),de&&xa.jsx(SN,{scope:fe,onConfirm:(e,t)=>{k(fe,e,t),pe(!1)},onCancel:()=>pe(!1)}),he&&xa.jsx(MN,{scope:ye,onConfirm:(e,t)=>{S(e,t,ye),me(!1)},onCancel:()=>me(!1)}),Se&&xa.jsx(NN,{onClose:()=>Me(!1)}),Te&&xa.jsx(PN,{onClose:()=>Oe(!1),onShowScaleVolume:e=>{ge(e),ue(!0)},onShowFadeVolume:e=>{ge(e),pe(!0)},onShowRemapInstrument:e=>{be(e),me(!0)},onExportPattern:()=>{$_(h[m])},onExportTrack:()=>{const e=h[m];q_(f.channelIndex,e)},onReverse:Be.reverseBlock,onExpand:Be.expandBlock,onShrink:Be.shrinkBlock,onDuplicate:Be.duplicateBlock,onMath:Be.mathBlock}),ve&&xa.jsx(Jx,{channelIndex:we,onClose:()=>xe(!1)}),Ie&&xa.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:xa.jsxs("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[xa.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-bgSecondary",children:[xa.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center gap-2",children:[xa.jsx(Ze,{size:20,className:"text-accent-primary"}),"Automation Editor"]}),xa.jsx("button",{onClick:()=>De(!1),className:"p-2 rounded hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors",title:"Close",children:xa.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:xa.jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})]}),xa.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:xa.jsx(V_,{})})]})})]})},Y_=e.memo(({onShowTips:e})=>{const t=tf(e=>e.cursor),a=tf(e=>e.currentOctave),n=tf(e=>e.insertMode),s=tf(e=>e.recordMode),r=tf(e=>e.patterns[e.currentPatternIndex]?.length||64),{isPlaying:i,currentRow:o}=Rg(),{contextState:l}=Lg(),{knobBank:c,setKnobBank:u,isInitialized:d,inputDevices:p,selectedInputId:h,showKnobBar:m,setShowKnobBar:f}=ky(),g=i?o:t.rowIndex,y=`${String(g).padStart(2,"0")}/${String(r-1).padStart(2,"0")}`,b=`Ch ${t.channelIndex+1}`,v=d&&p.length>0,x=v?p.find(e=>e.id===h)||p[0]:null,w=x?.name||"MIDI Controller",k=[{id:"303",label:"303/Synth",icon:Oe},{id:"Siren",label:"Dub Siren",icon:Ze},{id:"FX",label:"Effects",icon:ct},{id:"Mixer",label:"Mixer",icon:_e}],S=v?hy[c]:[];return xa.jsxs("div",{className:"flex flex-col",children:[v&&m&&xa.jsxs("div",{className:"bg-dark-bgTertiary border-t border-dark-border px-4 py-2 flex flex-col gap-2",children:[xa.jsxs("div",{className:"flex items-center gap-1",children:[xa.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase mr-2 tracking-widest",children:"Knob Bank:"}),k.map(e=>{const t=e.icon,a=c===e.id;return xa.jsxs("button",{onClick:()=>u(e.id),className:`\n                    flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase transition-all border\n                    ${a?"bg-accent-primary text-dark-bg border-accent-primary shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-dark-bgSecondary text-text-muted border-dark-border hover:border-text-muted"}\n                  `,children:[xa.jsx(t,{size:12}),e.label]},e.id)})]}),xa.jsx("div",{className:"grid grid-cols-8 gap-2",children:S.map((e,t)=>xa.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border relative group overflow-hidden",children:[xa.jsx("div",{className:"absolute top-0 left-0 w-full h-[2px] bg-accent-primary/20 group-hover:bg-accent-primary/50 transition-colors"}),xa.jsxs("span",{className:"text-[8px] font-mono text-text-muted mb-1 flex items-center gap-1",children:[xa.jsx(la,{size:8})," K",t+1," (CC ",e.cc,")"]}),xa.jsx("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label})]},t))})]}),xa.jsxs("div",{className:"bg-dark-bgSecondary border-t border-dark-border flex items-center justify-between px-4 py-1.5 text-xs font-mono",children:[xa.jsxs("div",{className:"flex items-center gap-4",children:[xa.jsxs("span",{className:"text-text-secondary",children:["Row ",xa.jsx("span",{className:"text-accent-primary font-semibold",children:y})]}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"}),xa.jsx("span",{className:"text-text-secondary",children:b}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"}),xa.jsx("span",{className:"text-text-secondary capitalize",children:t.columnType}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"}),xa.jsxs("span",{className:"text-text-secondary",children:["Oct ",xa.jsx("span",{className:"text-accent-primary font-semibold",children:a})]}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"}),xa.jsxs("span",{className:"text-text-secondary",title:n?"Insert mode: new data shifts rows down":"Overwrite mode: new data replaces existing",children:["Mode: ",xa.jsx("span",{className:n?"text-accent-warning":"text-accent-primary",children:n?"INS":"OVR"})]}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"}),xa.jsx("span",{className:"px-2 py-0.5 rounded "+(s?"bg-accent-error/20 text-accent-error":"text-text-muted"),children:s?"REC":"EDIT"})]}),xa.jsxs("div",{className:"flex items-center gap-4",children:[v&&xa.jsxs(xa.Fragment,{children:[xa.jsxs("button",{onClick:()=>f(!m),className:"flex items-center gap-1.5 text-[10px] text-text-muted hover:text-accent-primary transition-colors",title:m?"Hide MIDI controls":"Show MIDI controls",children:[xa.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"}),xa.jsx("span",{className:"font-bold uppercase",children:w}),m?xa.jsx(Me,{size:12}):xa.jsx(xt,{size:12})]}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),e&&xa.jsxs(xa.Fragment,{children:[xa.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-accent-warning/10 text-accent-warning hover:bg-accent-warning/20 transition-colors",title:"Tip of the Day",children:[xa.jsx(ca,{size:12}),xa.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Tips"})]}),xa.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),xa.jsxs("span",{className:"flex items-center gap-1.5 "+("running"===l?"text-accent-success":"text-text-muted"),children:[xa.jsx("span",{className:"w-2 h-2 rounded-full "+("running"===l?"bg-accent-success":"bg-text-muted")}),"running"===l?"Audio Active":"Audio Off"]})]})]})]})});const Q_="devilbox-project";function Z_(){try{const e=tf.getState(),t=Pg.getState(),a=Bg.getState(),n=Rg.getState(),s=Vg.getState(),r=Lg.getState(),i={version:"1.0.0",schemaVersion:2,savedAt:(new Date).toISOString(),metadata:a.metadata,bpm:n.bpm,patterns:e.patterns,patternOrder:e.patternOrder,instruments:t.instruments.map(e=>{if(e.metadata?.preservedSynth&&e.sample?.url?.startsWith("blob:")){const t={...e};return t.sample={...e.sample,url:""},t}return e}),automation:s.curves,masterEffects:r.masterEffects,..."straight"!==n.grooveTemplateId?{grooveTemplateId:n.grooveTemplateId}:{}};return!i.instruments.some(e=>"MOD"===e.metadata?.importedFrom||"XM"===e.metadata?.importedFrom||"IT"===e.metadata?.importedFrom||"S3M"===e.metadata?.importedFrom)&&(localStorage.setItem(Q_,JSON.stringify(i)),a.markAsSaved(),!0)}catch(e){return!1}}function J_(){try{const e=localStorage.getItem(Q_);if(!e)return!1;const t=JSON.parse(e);if(!t.version||!t.patterns||!t.instruments)return!1;if(!t.schemaVersion||t.schemaVersion<2)return localStorage.removeItem(Q_),!1;if(xg(t.patterns,t.instruments)){const e=wg(t.patterns,t.instruments);t.patterns=e.patterns,t.instruments=e.instruments}const a=tf.getState(),n=Pg.getState(),s=Bg.getState(),r=Rg.getState(),i=Vg.getState(),o=Lg.getState();return a.loadPatterns(t.patterns),t.patternOrder&&t.patternOrder.length>0&&a.setPatternOrder(t.patternOrder),n.loadInstruments(t.instruments),s.setMetadata(t.metadata),r.setBPM(t.bpm),t.automation&&i.loadCurves(t.automation),t.masterEffects&&o.setMasterEffects(t.masterEffects),r.setGrooveTemplate(t.grooveTemplateId||"straight"),n.autoBakeInstruments(),s.markAsSaved(),!0}catch(e){return!1}}function eT(){try{return null!==localStorage.getItem(Q_)}catch{return!1}}function tT(){try{localStorage.removeItem(Q_)}catch(e){}}const aT={success:xa.jsx(da,{size:18}),error:xa.jsx(Ie,{size:18}),warning:xa.jsx(ua,{size:18}),info:xa.jsx(_t,{size:18})},nT={success:"text-accent-success border-accent-success/30 bg-accent-success/10",error:"text-accent-error border-accent-error/30 bg-accent-error/10",warning:"text-accent-warning border-accent-warning/30 bg-accent-warning/10",info:"text-accent-primary border-accent-primary/30 bg-accent-primary/10"},sT=()=>{const{notifications:e,removeNotification:t}=ey();return 0===e.length?null:xa.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:e.map(e=>xa.jsxs("div",{className:`\n            flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg\n            animate-slide-in-right\n            ${nT[e.type]}\n          `,role:"alert",children:[xa.jsx("span",{className:"flex-shrink-0 mt-0.5",children:aT[e.type]}),xa.jsx("p",{className:"flex-1 text-sm font-medium text-text-primary",children:e.message}),xa.jsx("button",{onClick:()=>t(e.id),className:"flex-shrink-0 p-0.5 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss notification",children:xa.jsx(Ee,{size:14,className:"text-text-muted"})})]},e.id))})},rT=({onRefresh:e,onDismiss:t,currentVersion:a,latestVersion:n})=>xa.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[60] max-w-md w-full px-4",children:xa.jsxs("div",{className:"\n          flex items-center gap-3 px-4 py-3 rounded-lg border shadow-2xl\n          bg-accent-primary/20 border-accent-primary/40 backdrop-blur-sm\n          animate-slide-in-top\n        ",role:"alert",children:[xa.jsx(kt,{size:20,className:"text-accent-primary flex-shrink-0 animate-pulse"}),xa.jsxs("div",{className:"flex-1 min-w-0",children:[xa.jsx("p",{className:"text-sm font-semibold text-text-primary mb-1",children:"Update Available"}),xa.jsxs("p",{className:"text-xs text-text-muted",children:["Version ",n," is now available (current: ",a,")"]})]}),xa.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[xa.jsx(Dv,{onClick:e,className:"px-3 py-1.5 text-xs bg-accent-primary hover:bg-accent-primary/80 text-white font-medium rounded",children:"Refresh"}),xa.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss update notification",children:xa.jsx(Ee,{size:16,className:"text-text-muted"})})]})]})}),iT=()=>{const{activeError:e,dismissError:t,copyToClipboard:a,getDebugString:n}=Ri(),[r,i]=s.useState(!1),[o,l]=s.useState(!1);if(!e)return null;const c=()=>{t(e.id),i(!1),l(!1)};return xa.jsxs(uw,{isOpen:!0,onClose:c,size:"lg",closeOnBackdropClick:!1,closeOnEscape:!0,children:[xa.jsx(dw,{title:"Synth Error",subtitle:{init:"Initialization Error",wasm:"WASM Engine Error",runtime:"Runtime Error",audio:"Audio Context Error"}[e.errorType],icon:xa.jsx(ua,{className:"w-6 h-6 text-red-500"})}),xa.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[xa.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4",children:xa.jsx("div",{className:"flex items-start gap-3",children:xa.jsxs("div",{className:"flex-1",children:[xa.jsxs("p",{className:"font-mono text-sm text-red-300",children:[xa.jsx("span",{className:"text-red-400 font-bold",children:e.synthType}),e.synthName&&xa.jsxs("span",{className:"text-red-300/70",children:[" (",e.synthName,")"]})]}),xa.jsx("p",{className:"mt-2 text-white",children:e.message})]})})}),xa.jsxs("button",{onClick:()=>l(!o),className:"flex items-center gap-2 text-sm text-dark-text-secondary hover:text-white transition-colors",children:[o?xa.jsx(xt,{size:16}):xa.jsx(Me,{size:16}),o?"Hide":"Show"," Debug Details"]}),o&&xa.jsxs("div",{className:"bg-dark-surface rounded-lg p-4 space-y-3",children:[xa.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary",children:"Timestamp:"}),xa.jsx("p",{className:"font-mono text-xs",children:e.debugData.timestamp})]}),xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary",children:"AudioContext:"}),xa.jsx("p",{className:"font-mono text-xs",children:e.debugData.audioContextState})]}),xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary",children:"WASM Supported:"}),xa.jsx("p",{className:"font-mono text-xs",children:e.debugData.wasmSupported?"Yes":"No"})]}),xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary",children:"Error Type:"}),xa.jsx("p",{className:"font-mono text-xs",children:e.errorType})]})]}),e.stack&&xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Stack Trace:"}),xa.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-red-300 overflow-x-auto max-h-32 overflow-y-auto",children:e.stack})]}),xa.jsxs("div",{children:[xa.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Full Debug Report:"}),xa.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-dark-text-secondary overflow-x-auto max-h-40 overflow-y-auto whitespace-pre-wrap",children:n(e)})]})]}),xa.jsx("p",{className:"text-sm text-dark-text-secondary",children:"This synth failed to initialize properly. Please copy the debug information and report this issue. The synth will not be available until the error is resolved."})]}),xa.jsx(pw,{children:xa.jsxs("div",{className:"flex justify-between w-full",children:[xa.jsx("button",{onClick:async()=>{await a(e)&&(i(!0),setTimeout(()=>i(!1),2e3))},className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:r?xa.jsxs(xa.Fragment,{children:[xa.jsx(Fe,{size:16,className:"text-green-500"}),xa.jsx("span",{className:"text-green-500",children:"Copied!"})]}):xa.jsxs(xa.Fragment,{children:[xa.jsx(Ke,{size:16}),xa.jsx("span",{children:"Copy Debug Info"})]})}),xa.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition-colors",children:[xa.jsx(Ee,{size:16}),xa.jsx("span",{children:"Dismiss"})]})]})})]})};const oT=[".dbx",".dbi",".xml",".sqs",".seq",".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx",".mid",".midi",".wav",".mp3",".ogg",".flac",".aiff",".aif"];const lT=({onFileLoaded:e,children:t})=>{const[a,n]=s.useState(!1),[r,i]=s.useState(0),o=s.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),i(e=>e+1),e.dataTransfer.items&&e.dataTransfer.items.length>0){Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&n(!0)}},[]),l=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),i(e=>{const t=e-1;return 0===t&&n(!1),t})},[]),c=s.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),u=s.useCallback(async t=>{t.preventDefault(),t.stopPropagation(),n(!1),i(0);const a=Array.from(t.dataTransfer.files);if(0===a.length)return;const s=a.find(e=>function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return oT.includes(t)}(e.name));if(s)try{await e(s)}catch(r){}},[e]);return xa.jsxs("div",{onDragEnter:o,onDragLeave:l,onDragOver:c,onDrop:u,className:"relative w-full h-full",children:[t,a&&xa.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center pointer-events-none animate-fade-in",children:xa.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary border-dashed rounded-xl p-12 flex flex-col items-center gap-4 shadow-2xl",children:[xa.jsx(Ct,{size:64,className:"text-accent-primary animate-bounce"}),xa.jsxs("div",{className:"text-center",children:[xa.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"}),xa.jsx("p",{className:"text-text-muted text-sm",children:"Supports .dbx, .dbi, .xml, .mod, .xm, .it, .s3m, .fur, .mid, and more"})]})]})})]})},cT=s.lazy(()=>_a(()=>import("./HelpModal-vmkQ_ely.js"),__vite__mapDeps([7,1,2,4,3])).then(e=>({default:e.HelpModal}))),uT=s.lazy(()=>_a(()=>import("./ExportDialog-SJaiZKXm.js"),__vite__mapDeps([8,1,2,3,4])).then(e=>({default:e.ExportDialog}))),dT=s.lazy(()=>_a(()=>import("./EditInstrumentModal-DkxQa2I3.js"),__vite__mapDeps([9,1,2,4,3,10])).then(e=>({default:e.EditInstrumentModal}))),pT=s.lazy(()=>_a(()=>import("./index-CnBEUN5i.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.MasterEffectsModal}))),hT=s.lazy(()=>_a(()=>import("./index-CnBEUN5i.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.InstrumentEffectsModal}))),mT=s.lazy(()=>_a(()=>import("./index-CnBEUN5i.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.EffectParameterEditor}))),fT=s.lazy(()=>_a(()=>import("./TD3PatternDialog-g8rYzrk4.js"),__vite__mapDeps([12,1,2,5,3,4,6,13])).then(e=>({default:e.TD3PatternDialog}))),gT=s.lazy(()=>_a(()=>import("./DrumpadEditorModal-D8LtTBcP.js"),__vite__mapDeps([14,1,2,4,3])).then(e=>({default:e.DrumpadEditorModal}))),yT=s.lazy(()=>_a(()=>import("./TipOfTheDay-TW0KIsBA.js"),__vite__mapDeps([15,1,2,4,3])).then(e=>({default:e.TipOfTheDay}))),bT=s.lazy(()=>_a(()=>import("./PatternManagement-COMI5JI7.js"),__vite__mapDeps([16,1,2,10,4,3])).then(e=>({default:e.PatternManagement}))),vT=s.lazy(()=>_a(()=>import("./SamplePackBrowser-f0K3iy_9.js"),__vite__mapDeps([17,1,2,3,4])).then(e=>({default:e.SamplePackBrowser})));function xT(){const{updateAvailable:e,latestVersion:t,currentVersion:a,refresh:n}=function(e=3e5){const[t,a]=s.useState(!1),[n,r]=s.useState(null),i=async()=>{try{const e=`/DEViLBOX/version.json?t=${Date.now()}`,t=await fetch(e,{cache:"no-cache"});if(!t.ok)return;const n=await t.json();r(n),n.buildHash!==Nb&&a(!0)}catch(e){}};return s.useEffect(()=>{i();const t=setInterval(i,e);return()=>clearInterval(t)},[e]),{updateAvailable:t,latestVersion:n,currentVersion:{buildNumber:Mb,buildHash:Nb},refresh:()=>{window.location.reload()}}}(),[r,i]=s.useState(!1),{initialized:o,contextState:l,setInitialized:c,setContextState:u,setToneEngineInstance:d,setAnalyserNode:p,setFFTNode:h}=Lg(Da(e=>({initialized:e.initialized,contextState:e.contextState,setInitialized:e.setInitialized,setContextState:e.setContextState,setToneEngineInstance:e.setToneEngineInstance,setAnalyserNode:e.setAnalyserNode,setFFTNode:e.setFFTNode}))),{showSamplePackModal:m,setShowSamplePackModal:f,applyAutoCompact:g}=Tg(),[y,b]=s.useState(null),[v,x]=s.useState(!1),[w,k]=s.useState(!1),[S,M]=s.useState(!1),[N,C]=s.useState(!1),[E,P]=s.useState(!1),[_,T]=s.useState(!1),[A,O]=s.useState(!1),[I,D]=s.useState(!1),[F,R]=s.useState("tips"),[j,L]=s.useState(null),[B,V]=s.useState(!1),[z,U]=s.useState(null),[G,W]=s.useState(!1),{showPatternDialog:H,closePatternDialog:K,showKnobBar:$,setShowKnobBar:q}=ky();s.useEffect(()=>{const e=localStorage.getItem("devilbox-seen-version"),t="false"!==localStorage.getItem("show-tips-at-startup");e!==a.buildNumber?(R("changelog"),D(!0)):t&&(R("tips"),D(!0))},[a.buildNumber]),function(){const{isPlaying:e,togglePlayPause:t,stop:a}=Rg(),{currentPatternIndex:n,patterns:r,setCurrentPattern:i,currentOctave:o,setCurrentOctave:l,cursor:c,moveCursorToChannel:u}=tf();s.useEffect(()=>{const e=oy();e.init();const s=[];return s.push(e.registerAction("transport.play",()=>{t()})),s.push(e.registerAction("transport.stop",()=>{a()})),s.push(e.registerAction("transport.playFromStart",()=>{a(),setTimeout(()=>t(),50)})),s.push(e.registerAction("pattern.next",()=>{n<r.length-1&&i(n+1)})),s.push(e.registerAction("pattern.previous",()=>{n>0&&i(n-1)})),s.push(e.registerAction("pattern.first",()=>{i(0)})),s.push(e.registerAction("pattern.last",()=>{i(r.length-1)})),s.push(e.registerAction("octave.up",()=>{o<8&&l(o+1)})),s.push(e.registerAction("octave.down",()=>{o>0&&l(o-1)})),s.push(e.registerAction("channel.next",()=>{const e=r[n];e&&c.channelIndex<e.channels.length-1&&u(c.channelIndex+1)})),s.push(e.registerAction("channel.previous",()=>{c.channelIndex>0&&u(c.channelIndex-1)})),()=>{s.forEach(e=>e())}},[e,t,a,n,r,i,o,l,c,u])}(),function(){const e=s.useCallback(e=>{const{patterns:t,currentPatternIndex:a,setCurrentPattern:n,currentOctave:s,setCurrentOctave:r}=tf.getState(),{isPlaying:i,isLooping:o,play:l,stop:c,pause:u,setIsLooping:d,currentRow:p,setCurrentRow:h}=Rg.getState(),{currentInstrumentId:m,setCurrentInstrument:f,instruments:g}=Pg.getState(),{undo:y,redo:b}=zg.getState();switch(e){case"transport.play":i||l();break;case"transport.stop":c();break;case"transport.pause":u();break;case"transport.loop":d(!o);break;case"nav.patternUp":a<t.length-1&&n(a+1);break;case"nav.patternDown":a>0&&n(a-1);break;case"nav.rowUp":p>0&&h(p-1);break;case"nav.rowDown":const e=t[a];e&&p<e.length-1&&h(p+1);break;case"nav.toStart":h(0);break;case"nav.toEnd":const v=t[a];v&&h(v.length-1);break;case"edit.octaveUp":s<8&&r(s+1);break;case"edit.octaveDown":s>0&&r(s-1);break;case"edit.instrumentUp":if(null!==m){const e=m+1;g.some(t=>t.id===e)&&f(e)}break;case"edit.instrumentDown":if(null!==m&&m>1){const e=m-1;g.some(t=>t.id===e)&&f(e)}break;case"edit.undo":y();break;case"edit.redo":b()}},[]),t=s.useCallback((e,t)=>{const{instruments:a}=Pg.getState(),n=Km(),s=ry().getControlledInstrument();let r=a.filter(e=>("TB303"===e.synthType||"Buzz3o3"===e.synthType)&&e.tb303);if(null!==s){const e=a.find(e=>e.id===s);if(e&&e.tb303)r=[e];else if(e)return}0!==r.length&&r.forEach(a=>{if(!a.tb303)return;const s=JSON.parse(JSON.stringify(a.tb303));switch(e){case"cutoff":s.filter&&(s.filter.cutoff=t);break;case"resonance":s.filter&&(s.filter.resonance=t);break;case"envMod":s.filterEnvelope&&(s.filterEnvelope.envMod=t);break;case"decay":s.filterEnvelope&&(s.filterEnvelope.decay=t);break;case"accent":s.accent&&(s.accent.amount=t);break;case"slideTime":s.slide&&(s.slide.time=t);break;case"overdrive":s.overdrive&&(s.overdrive.amount=t);break;case"normalDecay":s.devilFish&&(s.devilFish.normalDecay=t);break;case"accentDecay":s.devilFish&&(s.devilFish.accentDecay=t);break;case"softAttack":s.devilFish&&(s.devilFish.softAttack=t);break;case"vegSustain":s.devilFish&&(s.devilFish.vegSustain=t);break;case"filterFM":s.devilFish&&(s.devilFish.filterFM=t);break;case"filterTracking":s.devilFish&&(s.devilFish.filterTracking=t)}n.updateTB303Parameters(a.id,s)})},[]),a=s.useCallback((a,n,s)=>{if(n.startsWith("transport.")||n.startsWith("nav.")||n.startsWith("edit.")||n.startsWith("channel.")||n.startsWith("pattern.")||n.startsWith("view."))s>64&&e(n);else if(n.startsWith("tb303.")){const e=n.replace("tb303.","");return void t(e,s)}},[e,t]);s.useEffect(()=>ry().onParameterChange(a),[a])}(),s.useEffect(()=>{const e=cy(),t=Hm.getInstance();e.init();const a=(e,a)=>{const n=Pg.getState().instruments.find(t=>t.id===e.targetInstrumentId);if(!n)return;const s=e.targetNote??60,r=ce(s,"midi").toNote(),i=2===r.length?r.charAt(0)+"-"+r.charAt(1):r,o=a/127;if(a>0){t.triggerPolyNoteAttack(n.id,r,o,{...n,isLive:!0});const e=tf.getState(),a=Rg.getState();if(e.recordMode){const t=a.isPlaying?a.currentRow:e.cursor.rowIndex;let s=e.cursor.channelIndex;e.multiRecEnabled&&a.isPlaying&&(s=e.findBestChannel());const r=Un(i);if(e.setCell(s,t,{note:r,instrument:n.id}),!a.isPlaying&&e.editStep>0){const a=e.patterns[e.currentPatternIndex];if(a){const n=(t+e.editStep)%a.length;e.moveCursorToRow(n)}}}}else{t.triggerPolyNoteRelease(n.id,r,{...n,isLive:!0});const e=tf.getState(),a=Rg.getState();e.recordMode&&a.isPlaying&&e.recReleaseEnabled}},n=e.onTrigger(a),s=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const n=ky.getState();if("NumpadEnter"===t.code||"Enter"===t.key&&3===t.location)return t.preventDefault(),void n.togglePadBank();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===n.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&a(r,127)}},r=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const n=ky.getState();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===n.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&a(r,0)}};return window.addEventListener("keydown",s),window.addEventListener("keyup",r),()=>{n(),window.removeEventListener("keydown",s),window.removeEventListener("keyup",r)}},[]),s.useEffect(()=>{(async()=>{try{const{connectToNKSPairedDevice:e}=await _a(async()=>{const{connectToNKSPairedDevice:e}=await Promise.resolve().then(()=>Nv);return{connectToNKSPairedDevice:e}},void 0);await e()}catch(e){}})()},[]);const{updateMasterEffect:X}=Lg();s.useEffect(()=>{g()},[g]);const{save:Y}=function(){const{isDirty:e,markAsModified:t}=Bg(),a=s.useRef(null),n=s.useRef(!1),r=s.useRef(!0);s.useEffect(()=>{!n.current&&eT()&&(n.current=!0,J_())},[]),s.useEffect(()=>tf.subscribe((e,a)=>{r.current?r.current=!1:e.patterns!==a.patterns&&t()}),[t]),s.useEffect(()=>Pg.subscribe((e,a)=>{e.instruments!==a.instruments&&t()}),[t]),s.useEffect(()=>Rg.subscribe((e,a)=>{e.bpm===a.bpm&&e.grooveTemplateId===a.grooveTemplateId||t()}),[t]);const i=s.useCallback(()=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{e&&Z_()},3e4)},[e]);return s.useEffect(()=>(e&&i(),()=>{a.current&&clearTimeout(a.current)}),[e,i]),s.useEffect(()=>{const t=t=>{e&&(Z_(),t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),{save:s.useCallback(()=>Z_(),[]),load:s.useCallback(()=>J_(),[]),hasSaved:eT(),clear:tT,isDirty:e}}();s.useEffect(()=>{(async()=>{try{const e=Km();d(e),p(e.analyser),h(e.fft),u(e.getContextState()),c(!0)}catch(e){b(e instanceof Error?e.message:"Unknown error")}})()},[]);const{undo:Q,redo:Z,canUndo:J,canRedo:ee}=zg(),{replacePattern:te,currentPatternIndex:ae}=tf(),ne=s.useCallback(()=>{if(!J())return;const e=Q();e&&te(ae,e)},[Q,J,te,ae]),se=s.useCallback(()=>{if(!ee())return;const e=Z();e&&te(ae,e)},[Z,ee,te,ae]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey)return e.preventDefault(),void ne();if((e.ctrlKey||e.metaKey)&&"z"===e.key&&e.shiftKey||(e.ctrlKey||e.metaKey)&&"y"===e.key)return e.preventDefault(),void se();if((e.ctrlKey||e.metaKey)&&"s"===e.key)return e.preventDefault(),void Y();if("Escape"===e.key)return e.preventDefault(),void(w?k(!1):S?M(!1):N&&C(!1));if(e.shiftKey&&"?"===e.key)return e.preventDefault(),void k(!0);if(e.ctrlKey&&e.shiftKey&&"E"===e.key)return e.preventDefault(),void M(!0);if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return e.preventDefault(),void C(!N);if((e.ctrlKey||e.metaKey)&&"k"===e.key)return e.preventDefault(),void q(!$);if((e.ctrlKey||e.metaKey)&&"i"===e.key&&!e.shiftKey)return e.preventDefault(),void V(!B);if((e.ctrlKey||e.metaKey)&&"m"===e.key&&!e.shiftKey)return e.preventDefault(),void P(!E);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key)return e.preventDefault(),void T(!_);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key)return e.preventDefault(),void Lg.getState().toggleMasterMute();if(!("l"!==e.key&&"L"!==e.key||e.ctrlKey||e.metaKey||e.altKey))return e.preventDefault(),void My.getState().toggleLiveMode();const t=parseInt(e.key);if(!isNaN(t)&&t>=1&&t<=9){const a=My.getState();if(a.isLiveMode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();const n=t-1;return void(n<tf.getState().patterns.length&&a.queuePattern(n))}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[N,w,S,B,E,_,ne,se,Y]);s.useEffect(()=>{const e=async()=>{if("running"!==l)try{const e=Km();await e.init(),u(e.getContextState())}catch(t){}window.removeEventListener("click",e),window.removeEventListener("keydown",e)};return window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[l,u]);const re=s.useCallback(async e=>{const{loadPatterns:t,setPatternOrder:a}=tf.getState(),{loadInstruments:n}=Pg.getState(),{setBPM:s,setGrooveTemplate:r}=Rg.getState(),{setMetadata:i}=Bg.getState();try{const o=e.name.toLowerCase();if(o.endsWith(".mid")||o.endsWith(".midi")){const a=await YP(e,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});t(a.patterns);n(a.patterns.map((e,t)=>({id:t+1,name:`Track ${t+1}`,type:"synth",synthType:"Synth",effects:[],volume:-6,pan:0}))),i({name:a.metadata.name,author:"",description:`Imported from ${e.name} (${a.metadata.tracks} tracks)`}),s(a.bpm),ty.success(`Loaded MIDI: ${a.metadata.name}`)}else if(o.endsWith(".fur")||o.endsWith(".dmf")){const{parseFurnaceSong:r,convertFurnaceToDevilbox:o}=await _a(async()=>{const{parseFurnaceSong:e,convertFurnaceToDevilbox:t}=await Promise.resolve().then(()=>pN);return{parseFurnaceSong:e,convertFurnaceToDevilbox:t}},void 0),{convertToInstrument:l}=await _a(async()=>{const{convertToInstrument:e}=await Promise.resolve().then(()=>iP);return{convertToInstrument:e}},void 0),c=await e.arrayBuffer(),u=o(await r(c)),d=u.instruments.map((e,t)=>l(e,t+1,"FUR")).flat().map((e,t)=>({...e,id:t+1})),p=u.metadata.modData?.patternOrderTable||[],h=u.patterns,m=h[0]?.length||64,f=h[0]?.[0]?.length||4,g=h.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:m,channels:Array.from({length:f},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:0,eff2:0}})}))}));n(d),t(g),p.length>0&&a(p),s(u.metadata.modData?.initialBPM||150),i({name:u.metadata.sourceFile.replace(/\.[^/.]+$/,""),author:"",description:`Imported from ${e.name} (Furnace)`}),ty.success(`Loaded Furnace: ${e.name} (${d.length} instruments, ${g.length} patterns)`)}else if(o.match(/\.(mod|xm|it|s3m|mptm|669|amf|ams|dbm|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))Tg.getState().setPendingModuleFile(e),ty.info(`Opening import dialog for ${e.name}...`);else if(o.endsWith(".dbx")){const o=await e.text(),l=JSON.parse(o),{needsMigration:c,migrateProject:u}=await _a(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>kg);return{needsMigration:e,migrateProject:t}},void 0);let d=l.patterns,p=l.instruments;if(c(d,p)){const e=u(d,p);d=e.patterns,p=e.instruments}if(t(d),l.sequence&&Array.isArray(l.sequence)){const e=new Map(d.map((e,t)=>[e.id,t])),t=l.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&a(t)}p&&n(p),l.masterEffects&&Lg.getState().setMasterEffects(l.masterEffects),s(l.bpm),i(l.metadata),r(l.grooveTemplateId||"straight"),ty.success(`Loaded: ${l.metadata?.name||e.name}`)}}catch(o){ty.error(`Failed to load ${e.name}`)}},[]),ie=s.useCallback(async e=>{const{addInstrument:t}=Pg.getState();try{const a=e.name.toLowerCase();if(a.match(/\.(dbx|mid|midi|mod|xm|it|s3m|fur|mptm|669|amf|ams|dbm|dmf|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))return U(e),void W(!0);if(a.endsWith(".dbi")){const a=await WE(e);a?.instrument?(t(a.instrument),ty.success(`Loaded instrument: ${a.instrument.name||"Untitled"}`)):ty.error(`Failed to load instrument: ${e.name}`)}else if(a.endsWith(".xml")){const t=await e.text(),a=t.includes("<db303-preset"),n=t.includes("<db303-pattern");if(a){const{parseDb303Preset:a}=await _a(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-BMwWFetk.js");return{parseDb303Preset:e}},[]),{instruments:n,updateInstrument:s,addInstrument:r}=Pg.getState(),i=a(t);let o=n.find(e=>"TB303"===e.synthType);if(!o){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();r(t),o=t}s(o.id,{tb303:{...o.tb303,...i}}),ty.success(`Loaded DB303 preset: ${e.name}`)}else if(n){const{parseDb303Pattern:a}=await _a(async()=>{const{parseDb303Pattern:e}=await Promise.resolve().then(()=>s_);return{parseDb303Pattern:e}},void 0),{patterns:n,loadPatterns:s,setCurrentPattern:r,setPatternOrder:i}=tf.getState(),{instruments:o,addInstrument:l}=Pg.getState(),{setBPM:c}=Rg.getState();let u=o.find(e=>"TB303"===e.synthType);if(!u){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),u=t}const d=e.name.replace(".xml","")||"Imported Pattern",{pattern:p,tempo:h}=a(t,d,u.id);p.channels[0].instrumentId=u.id;const m=[...n,p];s(m),r(m.length-1),i([m.length-1]),void 0!==h&&c(h),ty.success(`Loaded DB303 pattern: ${p.name}`)}else ty.error("Unknown XML format. Expected db303-pattern or db303-preset.")}else if(a.endsWith(".sqs")||a.endsWith(".seq")){const{parseTD3File:t}=await _a(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:a}=await _a(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-Cc64HjVE.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{patterns:n,loadPatterns:s,setCurrentPattern:r,setPatternOrder:i}=tf.getState(),{instruments:o,addInstrument:l}=Pg.getState();let c=o.find(e=>"TB303"===e.synthType);if(!c){const{createDefaultTB303Instrument:e}=await _a(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-8LiacaiB.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),c=t}const u=await e.arrayBuffer(),d=await t(u);if(0===d.patterns.length)return void ty.error("No patterns found in SQS file");const p=Pg.getState().instruments.findIndex(e=>e.id===c.id)+1||1,h=d.patterns.map((e,t)=>{const n=a(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${c.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:c.id,color:"#ec4899",rows:n.slice(0,s).map(e=>({...e,instrument:e.note?p:0}))}]}});s([...n,...h]),r(n.length),i(h.map((e,t)=>n.length+t)),ty.success(`Loaded ${h.length} TD-3 pattern(s) from ${e.name}`)}else a.match(/\.(wav|mp3|ogg|flac|aiff|aif)$/)?(ty.info(`Audio sample: ${e.name}. Opening instrument editor...`),V(!0)):ty.warning(`Unsupported file format: ${e.name}`)}catch(a){ty.error(`Failed to handle ${e.name}`)}},[]),oe=async()=>{try{const e=Km();await e.init(),u(e.getContextState()),x(!1)}catch(e){b(e instanceof Error?e.message:"Unknown error")}};return y?xa.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:xa.jsxs("div",{className:"panel p-8 max-w-md",children:[xa.jsx("h2",{className:"text-xl font-bold text-accent-error mb-4",children:"Audio Initialization Error"}),xa.jsx("p",{className:"text-text-secondary mb-4",children:y}),xa.jsx(Dv,{variant:"primary",onClick:()=>window.location.reload(),children:"Reload Application"})]})}):o?v&&"running"!==l?xa.jsx(Uv,{children:xa.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:xa.jsxs("div",{className:"text-center max-w-2xl",children:[xa.jsxs("div",{className:"mb-8",children:[xa.jsx("h1",{className:"text-5xl font-bold text-text-primary mb-2 tracking-tight",children:"DEViLBOX"}),xa.jsx("p",{className:"text-lg text-text-secondary",children:"TB-303 Acid Tracker with Devil Fish Mod"})]}),xa.jsx(Dv,{variant:"primary",size:"lg",onClick:oe,icon:xa.jsx(Ae,{size:20}),className:"shadow-glow animate-pulse-glow",children:"Start Audio Engine"}),xa.jsxs("div",{className:"mt-12 grid grid-cols-2 gap-4 text-left",children:[xa.jsxs("div",{className:"card p-4",children:[xa.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[xa.jsx("div",{className:"p-2 rounded-md bg-accent-primary/20 text-accent-primary",children:xa.jsx(Te,{size:18})}),xa.jsx("h3",{className:"font-semibold text-text-primary",children:"22 Synth Engines"})]}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"Including authentic TB-303 with accent and slide"})]}),xa.jsxs("div",{className:"card p-4",children:[xa.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[xa.jsx("div",{className:"p-2 rounded-md bg-accent-secondary/20 text-accent-secondary",children:xa.jsx(ia,{size:18})}),xa.jsx("h3",{className:"font-semibold text-text-primary",children:"Pattern Editor"})]}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"4-16 channels with FT2-style keyboard layout"})]}),xa.jsxs("div",{className:"card p-4",children:[xa.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[xa.jsx("div",{className:"p-2 rounded-md bg-accent-warning/20 text-accent-warning",children:xa.jsx(_e,{size:18})}),xa.jsx("h3",{className:"font-semibold text-text-primary",children:"Automation"})]}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"Real-time parameter curves for filter sweeps"})]}),xa.jsxs("div",{className:"card p-4",children:[xa.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[xa.jsx("div",{className:"p-2 rounded-md bg-accent-success/20 text-accent-success",children:xa.jsx(Ue,{size:18})}),xa.jsx("h3",{className:"font-semibold text-text-primary",children:"36+ Presets"})]}),xa.jsx("p",{className:"text-sm text-text-secondary",children:"Factory sounds for instant acid basslines"})]})]}),xa.jsxs("p",{className:"mt-8 text-sm text-text-muted",children:["Press ",xa.jsx("kbd",{className:"px-2 py-0.5 rounded bg-dark-bgTertiary border border-dark-border text-text-secondary",children:"?"})," anytime for help"]})]})})}):xa.jsx(lT,{onFileLoaded:ie,children:xa.jsxs(Uv,{children:[xa.jsxs("div",{className:"flex flex-col flex-1 min-h-0 min-w-0 overflow-y-hidden",children:[xa.jsx("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-y-hidden",children:xa.jsxs("div",{className:"flex flex-col min-h-0 min-w-0 flex-1",children:[N&&xa.jsx("div",{className:"h-48 border-b border-dark-border animate-fade-in",children:xa.jsx(s.Suspense,{fallback:xa.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"Loading patterns..."}),children:xa.jsx(bT,{})})}),xa.jsx("div",{className:"flex-1 min-h-0 min-w-0 flex flex-col",children:xa.jsx(X_,{onShowPatterns:()=>C(!N),onShowExport:()=>M(!0),onShowHelp:()=>k(!0),onShowMasterFX:()=>P(!E),onShowInstrumentFX:()=>T(!_),onShowInstruments:()=>V(!0),onShowDrumpads:()=>O(!0),showPatterns:N,showMasterFX:E,showInstrumentFX:_})})]})}),xa.jsx(Y_,{onShowTips:()=>D(!0)})]}),xa.jsxs(s.Suspense,{fallback:null,children:[w&&xa.jsx(cT,{isOpen:w,onClose:()=>k(!1)}),S&&xa.jsx(uT,{isOpen:S,onClose:()=>M(!1)}),B&&xa.jsx(dT,{isOpen:B,onClose:()=>V(!1)}),E&&xa.jsx(pT,{isOpen:E,onClose:()=>P(!1)}),_&&xa.jsx(hT,{isOpen:_,onClose:()=>T(!1)}),H&&xa.jsx(fT,{isOpen:H,onClose:K}),A&&xa.jsx(gT,{isOpen:A,onClose:()=>O(!1)}),m&&xa.jsx(vT,{onClose:()=>f(!1)}),I&&xa.jsx(yT,{isOpen:I,onClose:()=>D(!1),initialTab:F}),j&&xa.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:xa.jsx("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:xa.jsx(mT,{effect:j.effect,onUpdateParameter:(e,t)=>{if(!j)return;const a={...j.effect.parameters,[e]:t};X(j.effect.id,{parameters:a}),L({...j,effect:{...j.effect,parameters:a}})},onUpdateWet:e=>{j&&(X(j.effect.id,{wet:e}),L({...j,effect:{...j.effect,wet:e}}))},onClose:()=>L(null)})})}),G&&z&&xa.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:xa.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md mx-4 animate-slide-in-up shadow-2xl",children:[xa.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Load Song File?"}),xa.jsxs("p",{className:"text-text-secondary mb-6",children:["Loading ",xa.jsx("span",{className:"text-accent-primary font-mono",children:z.name})," will replace your current project."]}),xa.jsx("p",{className:"text-text-muted text-sm mb-6",children:"Make sure you've saved any unsaved changes before continuing."}),xa.jsxs("div",{className:"flex gap-3 justify-end",children:[xa.jsx(Dv,{variant:"ghost",onClick:()=>{W(!1),U(null)},children:"Cancel"}),xa.jsx(Dv,{variant:"primary",onClick:async()=>{z&&await re(z),W(!1),U(null)},children:"Load File"})]})]})})]}),xa.jsx(sT,{}),xa.jsx(iT,{}),e&&!r&&xa.jsx(rT,{onRefresh:n,onDismiss:()=>i(!0),currentVersion:a.buildNumber,latestVersion:t?.buildNumber||"unknown"})]})}):xa.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:xa.jsx("div",{className:"panel p-8",children:xa.jsxs("div",{className:"flex items-center gap-3 text-accent-primary",children:[xa.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),xa.jsx("span",{children:"Initializing audio engine..."})]})})})}class wT extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:xa.jsx("div",{className:"min-h-screen bg-bg flex items-center justify-center p-4",children:xa.jsxs("div",{className:"max-w-lg w-full bg-bg-secondary rounded-lg border border-border p-6 text-center",children:[xa.jsx("div",{className:"text-6xl mb-4",children:""}),xa.jsx("h1",{className:"text-2xl font-bold text-text mb-2",children:"Something went wrong"}),xa.jsx("p",{className:"text-text-secondary mb-4",children:"DEViLBOX encountered an unexpected error. Your work may have been auto-saved."}),!1,xa.jsxs("div",{className:"flex gap-3 justify-center",children:[xa.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-bg-tertiary hover:bg-border rounded text-text transition-colors",children:"Try Again"}),xa.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 bg-accent hover:bg-accent-hover rounded text-white transition-colors",children:"Reload App"})]})]})}):this.props.children}}const kT=["ChiptuneModule","Player","Sampler","DrumKit"];async function ST(e){const t=XN[e],a={synthType:e,name:t?.name||e,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,loadTimeMs:0};if(kT.includes(e))return a.error="Skipped (requires external resources)",a;const n=performance.now();try{const t={id:999,name:`Test ${e}`,type:"synth",synthType:e,effects:[],volume:-12,pan:0},r=Im.createInstrument(t);if(a.loadTimeMs=performance.now()-n,!r)return a.error="createInstrument returned null",a;a.loaded=!0;const i=new pe("waveform",256);if(Yn(r)){const e=as(i);e&&r.output.connect(e)}else r.connect(i);i.toDestination();try{"triggerAttack"in r&&"function"==typeof r.triggerAttack?(r.triggerAttack("C4",Q(),.8),a.noteOnWorked=!0):"triggerAttackRelease"in r&&"function"==typeof r.triggerAttackRelease&&(r.triggerAttackRelease("C4","8n",Q(),.8),a.noteOnWorked=!0)}catch(s){a.error=`Note trigger error: ${s}`}await new Promise(e=>setTimeout(e,100));try{const e=i.getValue().some(e=>Math.abs(e)>.001);a.producedSound=e}catch(s){}try{"triggerRelease"in r&&"function"==typeof r.triggerRelease&&(r.triggerRelease("C4",Q()),a.noteOffWorked=!0)}catch(s){}await new Promise(e=>setTimeout(e,50));try{if(Yn(r))try{r.output.disconnect()}catch{}else r.disconnect();i.disconnect(),"dispose"in r&&"function"==typeof r.dispose&&r.dispose(),i.dispose()}catch(s){}}catch(s){a.error=`${s}`,a.loadTimeMs=performance.now()-n}return a}async function MT(e={}){const{verbose:t=!0,filter:a,timeout:n=5e3}=e;await ge();const s=a?QN.filter(a):QN,r=[];for(const u of s){const e=await Promise.race([ST(u),new Promise(e=>setTimeout(()=>e({synthType:u,name:XN[u]?.name||u,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,error:"Timeout",loadTimeMs:n}),n))]);if(r.push(e),t){e.loaded&&e.producedSound}}const i=r.filter(e=>e.loaded&&e.noteOnWorked),o=r.filter(e=>!e.loaded&&!kT.includes(e.synthType)),l=r.filter(e=>kT.includes(e.synthType)),c={total:r.length,passed:i.length,failed:o.length,skipped:l.length,results:r,failedSynths:o.map(e=>e.synthType),passedSynths:i.map(e=>e.synthType),timestamp:(new Date).toISOString()};if(t){c.failedSynths.length>0&&c.failedSynths.forEach(e=>{r.find(t=>t.synthType===e)});const e=r.filter(e=>e.loaded&&!e.producedSound&&!kT.includes(e.synthType));e.length>0&&e.forEach(e=>{})}return c}"undefined"!=typeof window&&(window.testAllSynths=MT,window.testToneSynths=async function(){const e=["Synth","MonoSynth","DuoSynth","FMSynth","AMSynth","PluckSynth","MetalSynth","MembraneSynth","NoiseSynth","PolySynth"];return MT({filter:t=>e.includes(t)})},window.testCustomSynths=async function(){const e=["TB303","DubSiren","SpaceLaser","Synare","V2","Sam","Dexed","OBXd","SuperSaw","Organ","DrumMachine","ChipSynth","PWMSynth","WobbleBass","StringMachine","FormantSynth","GranularSynth","Wavetable"];return MT({filter:t=>e.includes(t)})},window.testFurnaceSynths=async function(){return MT({filter:e=>e.startsWith("Furnace"),timeout:1e4})},window.testBuzzmachineSynths=async function(){return MT({filter:e=>e.startsWith("Buzz")})},window.quickTestSynths=async function(){return MT({timeout:2e3})}),i(),Wm.subscribe(e=>{try{const t=Rg.getState().isPlaying;e.autoLatency&&!t||Km().setAudioLatency(e.audioLatency)}catch(t){}});let NT=Rg.getState().isPlaying;Rg.subscribe(e=>{if(e.isPlaying!==NT){NT=e.isPlaying;try{const t=Wm.getState();if(t.autoLatency){const a=Km();e.isPlaying?a.setAudioLatency(t.audioLatency):a.setAudioLatency("interactive")}}catch(t){}}}),window.addEventListener("error",e=>{}),window.addEventListener("unhandledrejection",e=>{}),Ea.createRoot(document.getElementById("root")).render(xa.jsx(s.StrictMode,{children:xa.jsx(wT,{children:xa.jsx(mx,{children:xa.jsx(xT,{})})})}));export{Bf as $,Pn as A,Dv as B,Cn as C,Dn as D,bn as E,Ei as F,xn as G,gn as H,pn as I,dn as J,un as K,sn as L,uw as M,jv as N,nn as O,fn as P,mn as Q,hn as R,YN as S,Hm as T,Ln as U,kn as V,vn as W,c_ as X,wn as Y,Tv as Z,nl as _,_i as a,Lf as a0,sl as a1,Zg as a2,Jo as a3,fr as a4,Ua as a5,Cm as a6,qi as a7,xr as a8,En as a9,ky as aA,ny as aB,LE as aC,cy as aD,Ab as aE,Lb as aF,th as aG,Mb as aH,Pb as aI,Eb as aJ,ex as aK,My as aL,Zv as aM,Yv as aN,Za as aO,Ja as aP,Ra as aQ,Gn as aR,Un as aS,rl as aT,Jn as aU,ji as aV,yn as aa,On as ab,on as ac,rn as ad,Sn as ae,Mn as af,pg as ag,An as ah,_n as ai,Sr as aj,Tm as ak,Wm as al,cn as am,QN as an,XN as ao,M_ as ap,og as aq,jn as ar,Rn as as,Fn as at,rx as au,vi as av,xi as aw,Si as ax,Mi as ay,uy as az,Pg as b,Bg as c,Rg as d,Vg as e,Lg as f,Km as g,HE as h,WE as i,xa as j,GE as k,UE as l,zE as m,ty as n,VE as o,BE as p,Sb as q,dw as r,pw as s,kb as t,tf as u,rg as v,ZN as w,qn as x,Sy as y,In as z};
