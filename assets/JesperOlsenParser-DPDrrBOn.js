function n(n,t){return(n[t]<<8|n[t+1])>>>0}function t(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}function e(e){const r=e instanceof Uint8Array?e:new Uint8Array(e);if(r.length<20)return!1;const i=n(r,0);if(24576!==i){if(i<4||i>512)return!1;if(1&i)return!1;const t=(i>>>1)-1;for(let e=0;e<=t;e++){const t=2+2*e;if(t+2>r.length)return!1;const i=n(r,t);if(0===i||32768&i)return!1;if(1&i)return!1;const o=i-2;if(o<0||o+2>r.length)return!1;if(32767!==n(r,o))return!1}return!0}let o=0;for(let t=0;t<=2;t++){if(o+4>r.length)return!1;if(24576!==n(r,o))return!1;const t=n(r,o+2);if(0===t||32768&t)return!1;if(1&t)return!1;o+=4}let l=6;if(l+2>r.length)return!1;if(l+=n(r,l),l+8>r.length)return!1;if(1245735680===t(r,l)){if(410106!==t(r,l+4))return!1;if(l+=8,l+2>r.length)return!1;if(l+=n(r,l),l+6>r.length)return!1;return 98303===t(r,l+4)}let f=l;if(f+2<=r.length&&49404===n(r,f)){f+=2;const n=f+900;for(let e=f+800;e<n&&e+4<=r.length;e+=2)if(1793090784===t(r,e))return!0;return!1}let u=-1;for(let n=0;n<=15&&f+4<=r.length;n++,f+=2)if(41943040===t(r,f)){u=f;break}if(u<0)return!1;if(f=u+4,f+4>r.length)return!1;if(16761084!==t(r,f))return!1;f+=4;const a=f+900;for(let n=f+800;n<a&&n+4<=r.length;n+=2)if(1793090784===t(r,n))return!0;return!1}function r(n,t){if(!e(new Uint8Array(n)))throw new Error("Not a Jesper Olsen module");const r=t.split("/").pop()??t,i=r.replace(/^jo\./i,"")||r,o=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${i} [Jesper Olsen]`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(n,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===t||3===t?-50:50,instrumentId:null,color:null,rows:o})),importMetadata:{sourceFormat:"MOD",sourceFile:t,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:0}}],instruments:[{id:1,name:"Sample 1",type:"synth",synthType:"Synth",effects:[],volume:0,pan:0}],songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{e as isJesperOlsenFormat,r as parseJesperOlsenFile};
