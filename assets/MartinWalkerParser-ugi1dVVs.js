function n(n,t){return t<0||t+1>=n.length?0:function(n,t){return(n[t]<<8|n[t+1])>>>0}(n,t)}function t(n,t){return t<0||t+3>=n.length?0:function(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}(n,t)}function e(e,r){const i=1223163134;if(3913379840!==t(e,r+4))return!1;if(16890!==n(e,r+8))return!1;const o=t(e,r+148),a=t(e,r+164),f=t(e,r+168);return o===i||a===i||f===i}function r(r){const i=r instanceof Uint8Array?r:new Uint8Array(r);if(i.length<300)return!1;const o=1223163134;if(t(i,0)===o)if(17914===n(i,220));else if(e(i,0))return!0;if(789070330===t(i,0)){const t=4+n(i,4)+28;return 17914===n(i,t+220)&&e(i,t)}if(t(i,28)===o){const t=28;return 17914===n(i,t+220)&&e(i,t)}if(24576===n(i,0)){const r=24576;let a=!0;for(let t=4;t<=28;t+=4)if(n(i,t)!==r){a=!1;break}if(a){if(n(i,32)!==r);else if(n(i,36)!==r)return!1;const a=14+n(i,14);if(t(i,a)===o)return(17914===n(i,a+268)||59714===n(i,a+274))&&e(i,a);const f=26+n(i,26);return t(i,f)===o&&17402===n(i,f+4)}}for(let a=0;a<=8;a+=2)if(789070330===t(i,a+28))for(let r=0;r<=150;r+=2){const f=a+r;if(t(i,f)===o)return(17914===n(i,f+268)||59714===n(i,f+274))&&e(i,f)}return!1}function i(n,t){if(!r(new Uint8Array(n)))throw new Error("Not a Martin Walker module");const e=t.split("/").pop()??t,i=e.replace(/^(avp|mw)\./i,"")||e,o=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${i} [Martin Walker]`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(n,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===t||3===t?-50:50,instrumentId:null,color:null,rows:o})),importMetadata:{sourceFormat:"MOD",sourceFile:t,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:0}}],instruments:[{id:1,name:"Sample 1",type:"synth",synthType:"Synth",effects:[],volume:0,pan:0}],songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{r as isMartinWalkerFormat,i as parseMartinWalkerFile};
