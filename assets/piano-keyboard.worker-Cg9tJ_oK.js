!function(){"use strict";const e=72,t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function l(e){return[1,3,6,8,10].includes(e%12)}function i(e){const l=Math.floor(e/12)-1;return`${t[e%12]}${l}`}let a=null,c=null,n=1,s=300,o=12,r=0,h=new Set,f=null,d=null,g=null,m={bg:"#111",whiteKey:"#e8e8ec",blackKey:"#22242a",whiteKeyDimmed:"#333338",blackKeyDimmed:"#1a1a1c",activeKey:"#06b6d4",divider:"#888",dividerLight:"#333",labelDark:"#333",labelLight:"#888"},u=!0;function y(e){o=e.verticalZoom,r=e.scrollY,s=e.containerHeight,h=new Set(e.activeNotes),f=e.scaleNotes?new Set(e.scaleNotes):null,d=e.dragTargetMidi}self.onmessage=b=>{const M=b.data;switch(M.type){case"init":a=M.canvas,n=M.dpr,y(M.state),a.width=Math.ceil(e*n),a.height=Math.ceil(s*n),c=a.getContext("2d"),u=!0,function(){const a=()=>{u&&function(){if(!c)return;u=!1,c.setTransform(n,0,0,n,0,0),c.fillStyle=m.bg,c.fillRect(0,0,e,s);const a=60,y=r+a,b=Math.min(127,Math.ceil(y)+2),M=Math.max(0,Math.floor(y)-Math.ceil(s/o)-2);for(let n=b;n>=M;n--){const u=(r+a-n)*o;if(u+o<0||u>s)continue;const y=o,b=l(n),M=n%12==0,w=h.has(n),S=d===n,k=n%12,v=null!==f&&!f.has(k),K=g===n,p=b?Math.floor(47.52):e;c.fillStyle=w||S?m.activeKey:b?v?m.blackKeyDimmed:m.blackKey:v?m.whiteKeyDimmed:m.whiteKey,c.fillRect(0,u,p,y),c.fillStyle=b?m.dividerLight:m.divider,c.fillRect(0,u+y-.5,p,.5),!v||w||S||(c.globalAlpha=.4,c.fillStyle="#000",c.fillRect(0,u,p,y),c.globalAlpha=1),!K||w||S||(c.fillStyle="rgba(59,130,246,0.15)",c.fillRect(0,u,p,y));if(M||o>=14&&!b){const e=M?i(n):t[k];c.fillStyle=w||S?"#fff":b?m.labelLight:m.labelDark,c.font=`${M?"bold ":""}${Math.min(10,y-2)}px Inter, system-ui, sans-serif`,c.textAlign="left",c.textBaseline="middle",c.fillText(e,6,u+y/2)}(w||S)&&(c.fillStyle="rgba(255,255,255,0.15)",c.fillRect(2,u+1,p-4,y-2))}c.fillStyle="rgba(255,255,255,0.12)",c.fillRect(71,0,1,s)}(),requestAnimationFrame(a)};requestAnimationFrame(a)}(),self.postMessage({type:"ready"});break;case"state":if(y(M.state),a){const t=Math.ceil(e*n),l=Math.ceil(s*n);a.width===t&&a.height===l||(a.width=t,a.height=l)}u=!0;break;case"hover":g!==M.midi&&(g=M.midi,u=!0);break;case"resize":n=M.dpr,s=M.h,a&&(a.width=Math.ceil(e*n),a.height=Math.ceil(s*n)),u=!0;break;case"colors":m=M.colors,u=!0}}}();
