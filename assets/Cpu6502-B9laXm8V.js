class t{mem;A=0;X=0;Y=0;SP=253;PC=0;N=0;V=0;B=1;D=0;I=1;Z=0;C=0;constructor(t){this.mem=t}reset(t,s=253){this.PC=t,this.SP=s,this.A=0,this.X=0,this.Y=0,this.N=0,this.V=0,this.B=1,this.D=0,this.I=1,this.Z=1,this.C=0}getA(){return this.A}getX(){return this.X}getY(){return this.Y}getPC(){return this.PC}getSP(){return this.SP}setA(t){this.A=255&t}setX(t){this.X=255&t}setY(t){this.Y=255&t}setPC(t){this.PC=65535&t}rd(t){return 255&this.mem.read(65535&t)}wr(t,s){this.mem.write(65535&t,255&s)}rd16wrap(t){return this.rd(t)|this.rd(65280&t|t+1&255)<<8}fetch(){return this.rd(this.PC++)}fetch16(){return this.fetch()|this.fetch()<<8}push(t){this.wr(256|this.SP,t),this.SP=this.SP-1&255}pop(){return this.SP=this.SP+1&255,this.rd(256|this.SP)}getP(){return this.N<<7|this.V<<6|32|this.B<<4|this.D<<3|this.I<<2|this.Z<<1|this.C}setP(t){this.N=t>>7&1,this.V=t>>6&1,this.B=t>>4&1,this.D=t>>3&1,this.I=t>>2&1,this.Z=t>>1&1,this.C=1&t}nz(t){this.N=t>>7&1,this.Z=0===t?1:0}adc(t){const s=this.A+t+this.C;this.V=(this.A^~t)&(this.A^s)&128?1:0,this.C=s>255?1:0,this.A=255&s,this.nz(this.A)}sbc(t){this.adc(255^t)}cmp(t,s){const h=t-s;this.N=h>>7&1,this.Z=255&h?0:1,this.C=t>=s?1:0}branch(t){const s=this.fetch();t&&(this.PC=this.PC+(s<128?s:s-256)&65535)}asl(t){return this.C=t>>7&1,t=t<<1&255,this.nz(t),t}lsr(t){return this.C=1&t,t>>=1,this.nz(t),t}rol(t){const s=this.C;return this.C=t>>7&1,t=255&(t<<1|s),this.nz(t),t}ror(t){const s=this.C;return this.C=1&t,t=t>>1|s<<7,this.nz(t),t}step(){switch(this.fetch()){case 169:{const t=this.fetch();return this.A=t,this.nz(t),2}case 165:{const t=this.rd(this.fetch());return this.A=t,this.nz(t),3}case 181:{const t=this.rd(this.fetch()+this.X&255);return this.A=t,this.nz(t),4}case 173:{const t=this.rd(this.fetch16());return this.A=t,this.nz(t),4}case 189:{const t=this.rd(this.fetch16()+this.X);return this.A=t,this.nz(t),4}case 185:{const t=this.rd(this.fetch16()+this.Y);return this.A=t,this.nz(t),4}case 161:{const t=this.fetch()+this.X&255,s=this.rd(this.rd16wrap(t));return this.A=s,this.nz(s),6}case 177:{const t=this.fetch(),s=this.rd(this.rd16wrap(t)+this.Y);return this.A=s,this.nz(s),5}case 162:{const t=this.fetch();return this.X=t,this.nz(t),2}case 166:{const t=this.rd(this.fetch());return this.X=t,this.nz(t),3}case 182:{const t=this.rd(this.fetch()+this.Y&255);return this.X=t,this.nz(t),4}case 174:{const t=this.rd(this.fetch16());return this.X=t,this.nz(t),4}case 190:{const t=this.rd(this.fetch16()+this.Y);return this.X=t,this.nz(t),4}case 160:{const t=this.fetch();return this.Y=t,this.nz(t),2}case 164:{const t=this.rd(this.fetch());return this.Y=t,this.nz(t),3}case 180:{const t=this.rd(this.fetch()+this.X&255);return this.Y=t,this.nz(t),4}case 172:{const t=this.rd(this.fetch16());return this.Y=t,this.nz(t),4}case 188:{const t=this.rd(this.fetch16()+this.X);return this.Y=t,this.nz(t),4}case 133:return this.wr(this.fetch(),this.A),3;case 149:return this.wr(this.fetch()+this.X&255,this.A),4;case 141:return this.wr(this.fetch16(),this.A),4;case 157:return this.wr(this.fetch16()+this.X,this.A),5;case 153:return this.wr(this.fetch16()+this.Y,this.A),5;case 129:{const t=this.fetch()+this.X&255;return this.wr(this.rd16wrap(t),this.A),6}case 145:{const t=this.fetch();return this.wr(this.rd16wrap(t)+this.Y,this.A),6}case 134:return this.wr(this.fetch(),this.X),3;case 150:return this.wr(this.fetch()+this.Y&255,this.X),4;case 142:return this.wr(this.fetch16(),this.X),4;case 132:return this.wr(this.fetch(),this.Y),3;case 148:return this.wr(this.fetch()+this.X&255,this.Y),4;case 140:return this.wr(this.fetch16(),this.Y),4;case 170:return this.X=this.A,this.nz(this.X),2;case 168:return this.Y=this.A,this.nz(this.Y),2;case 138:return this.A=this.X,this.nz(this.A),2;case 152:return this.A=this.Y,this.nz(this.A),2;case 186:return this.X=this.SP,this.nz(this.X),2;case 154:return this.SP=this.X,2;case 72:return this.push(this.A),3;case 104:return this.A=this.pop(),this.nz(this.A),4;case 8:return this.push(16|this.getP()),3;case 40:return this.setP(this.pop()),4;case 105:return this.adc(this.fetch()),2;case 101:return this.adc(this.rd(this.fetch())),3;case 117:return this.adc(this.rd(this.fetch()+this.X&255)),4;case 109:return this.adc(this.rd(this.fetch16())),4;case 125:return this.adc(this.rd(this.fetch16()+this.X)),4;case 121:return this.adc(this.rd(this.fetch16()+this.Y)),4;case 97:{const t=this.fetch()+this.X&255;return this.adc(this.rd(this.rd16wrap(t))),6}case 113:{const t=this.fetch();return this.adc(this.rd(this.rd16wrap(t)+this.Y)),5}case 233:return this.sbc(this.fetch()),2;case 229:return this.sbc(this.rd(this.fetch())),3;case 245:return this.sbc(this.rd(this.fetch()+this.X&255)),4;case 237:return this.sbc(this.rd(this.fetch16())),4;case 253:return this.sbc(this.rd(this.fetch16()+this.X)),4;case 249:return this.sbc(this.rd(this.fetch16()+this.Y)),4;case 225:{const t=this.fetch()+this.X&255;return this.sbc(this.rd(this.rd16wrap(t))),6}case 241:{const t=this.fetch();return this.sbc(this.rd(this.rd16wrap(t)+this.Y)),5}case 41:return this.A&=this.fetch(),this.nz(this.A),2;case 37:return this.A&=this.rd(this.fetch()),this.nz(this.A),3;case 53:return this.A&=this.rd(this.fetch()+this.X&255),this.nz(this.A),4;case 45:return this.A&=this.rd(this.fetch16()),this.nz(this.A),4;case 61:return this.A&=this.rd(this.fetch16()+this.X),this.nz(this.A),4;case 57:return this.A&=this.rd(this.fetch16()+this.Y),this.nz(this.A),4;case 33:{const t=this.fetch()+this.X&255;return this.A&=this.rd(this.rd16wrap(t)),this.nz(this.A),6}case 49:{const t=this.fetch();return this.A&=this.rd(this.rd16wrap(t)+this.Y),this.nz(this.A),5}case 9:return this.A|=this.fetch(),this.nz(this.A),2;case 5:return this.A|=this.rd(this.fetch()),this.nz(this.A),3;case 21:return this.A|=this.rd(this.fetch()+this.X&255),this.nz(this.A),4;case 13:return this.A|=this.rd(this.fetch16()),this.nz(this.A),4;case 29:return this.A|=this.rd(this.fetch16()+this.X),this.nz(this.A),4;case 25:return this.A|=this.rd(this.fetch16()+this.Y),this.nz(this.A),4;case 1:{const t=this.fetch()+this.X&255;return this.A|=this.rd(this.rd16wrap(t)),this.nz(this.A),6}case 17:{const t=this.fetch();return this.A|=this.rd(this.rd16wrap(t)+this.Y),this.nz(this.A),5}case 73:return this.A^=this.fetch(),this.nz(this.A),2;case 69:return this.A^=this.rd(this.fetch()),this.nz(this.A),3;case 85:return this.A^=this.rd(this.fetch()+this.X&255),this.nz(this.A),4;case 77:return this.A^=this.rd(this.fetch16()),this.nz(this.A),4;case 93:return this.A^=this.rd(this.fetch16()+this.X),this.nz(this.A),4;case 89:return this.A^=this.rd(this.fetch16()+this.Y),this.nz(this.A),4;case 65:{const t=this.fetch()+this.X&255;return this.A^=this.rd(this.rd16wrap(t)),this.nz(this.A),6}case 81:{const t=this.fetch();return this.A^=this.rd(this.rd16wrap(t)+this.Y),this.nz(this.A),5}case 201:return this.cmp(this.A,this.fetch()),2;case 197:return this.cmp(this.A,this.rd(this.fetch())),3;case 213:return this.cmp(this.A,this.rd(this.fetch()+this.X&255)),4;case 205:return this.cmp(this.A,this.rd(this.fetch16())),4;case 221:return this.cmp(this.A,this.rd(this.fetch16()+this.X)),4;case 217:return this.cmp(this.A,this.rd(this.fetch16()+this.Y)),4;case 193:{const t=this.fetch()+this.X&255;return this.cmp(this.A,this.rd(this.rd16wrap(t))),6}case 209:{const t=this.fetch();return this.cmp(this.A,this.rd(this.rd16wrap(t)+this.Y)),5}case 224:return this.cmp(this.X,this.fetch()),2;case 228:return this.cmp(this.X,this.rd(this.fetch())),3;case 236:return this.cmp(this.X,this.rd(this.fetch16())),4;case 192:return this.cmp(this.Y,this.fetch()),2;case 196:return this.cmp(this.Y,this.rd(this.fetch())),3;case 204:return this.cmp(this.Y,this.rd(this.fetch16())),4;case 36:{const t=this.rd(this.fetch());return this.Z=this.A&t?0:1,this.N=t>>7&1,this.V=t>>6&1,3}case 44:{const t=this.rd(this.fetch16());return this.Z=this.A&t?0:1,this.N=t>>7&1,this.V=t>>6&1,4}case 230:{const t=this.fetch(),s=this.rd(t)+1&255;return this.wr(t,s),this.nz(s),5}case 246:{const t=this.fetch()+this.X&255,s=this.rd(t)+1&255;return this.wr(t,s),this.nz(s),6}case 238:{const t=this.fetch16(),s=this.rd(t)+1&255;return this.wr(t,s),this.nz(s),6}case 254:{const t=this.fetch16()+this.X,s=this.rd(t)+1&255;return this.wr(t,s),this.nz(s),7}case 198:{const t=this.fetch(),s=this.rd(t)-1&255;return this.wr(t,s),this.nz(s),5}case 214:{const t=this.fetch()+this.X&255,s=this.rd(t)-1&255;return this.wr(t,s),this.nz(s),6}case 206:{const t=this.fetch16(),s=this.rd(t)-1&255;return this.wr(t,s),this.nz(s),6}case 222:{const t=this.fetch16()+this.X,s=this.rd(t)-1&255;return this.wr(t,s),this.nz(s),7}case 232:return this.X=this.X+1&255,this.nz(this.X),2;case 202:return this.X=this.X-1&255,this.nz(this.X),2;case 200:return this.Y=this.Y+1&255,this.nz(this.Y),2;case 136:return this.Y=this.Y-1&255,this.nz(this.Y),2;case 10:return this.A=this.asl(this.A),2;case 6:{const t=this.fetch();return this.wr(t,this.asl(this.rd(t))),5}case 22:{const t=this.fetch()+this.X&255;return this.wr(t,this.asl(this.rd(t))),6}case 14:{const t=this.fetch16();return this.wr(t,this.asl(this.rd(t))),6}case 30:{const t=this.fetch16()+this.X;return this.wr(t,this.asl(this.rd(t))),7}case 74:return this.A=this.lsr(this.A),2;case 70:{const t=this.fetch();return this.wr(t,this.lsr(this.rd(t))),5}case 86:{const t=this.fetch()+this.X&255;return this.wr(t,this.lsr(this.rd(t))),6}case 78:{const t=this.fetch16();return this.wr(t,this.lsr(this.rd(t))),6}case 94:{const t=this.fetch16()+this.X;return this.wr(t,this.lsr(this.rd(t))),7}case 42:return this.A=this.rol(this.A),2;case 38:{const t=this.fetch();return this.wr(t,this.rol(this.rd(t))),5}case 54:{const t=this.fetch()+this.X&255;return this.wr(t,this.rol(this.rd(t))),6}case 46:{const t=this.fetch16();return this.wr(t,this.rol(this.rd(t))),6}case 62:{const t=this.fetch16()+this.X;return this.wr(t,this.rol(this.rd(t))),7}case 106:return this.A=this.ror(this.A),2;case 102:{const t=this.fetch();return this.wr(t,this.ror(this.rd(t))),5}case 118:{const t=this.fetch()+this.X&255;return this.wr(t,this.ror(this.rd(t))),6}case 110:{const t=this.fetch16();return this.wr(t,this.ror(this.rd(t))),6}case 126:{const t=this.fetch16()+this.X;return this.wr(t,this.ror(this.rd(t))),7}case 76:return this.PC=this.fetch16(),3;case 108:return this.PC=this.rd16wrap(this.fetch16()),5;case 32:{const t=this.fetch16(),s=this.PC-1;return this.push(s>>8&255),this.push(255&s),this.PC=t,6}case 96:{const t=this.pop(),s=this.pop();return this.PC=1+(t|s<<8),6}case 64:{this.setP(this.pop());const t=this.pop(),s=this.pop();return this.PC=t|s<<8,6}case 144:return this.branch(0===this.C),2;case 176:return this.branch(1===this.C),2;case 240:return this.branch(1===this.Z),2;case 208:return this.branch(0===this.Z),2;case 48:return this.branch(1===this.N),2;case 16:return this.branch(0===this.N),2;case 112:return this.branch(1===this.V),2;case 80:return this.branch(0===this.V),2;case 24:return this.C=0,2;case 56:return this.C=1,2;case 88:return this.I=0,2;case 120:return this.I=1,2;case 216:return this.D=0,2;case 248:return this.D=1,2;case 184:return this.V=0,2;case 234:case 26:case 58:case 90:case 122:case 218:case 250:default:return 2;case 128:case 130:case 137:case 194:case 226:return this.fetch(),2;case 4:case 68:case 100:return this.fetch(),3;case 12:case 28:case 60:case 92:case 124:case 220:case 252:return this.fetch16(),4;case 20:case 52:case 84:case 116:case 212:case 244:return this.fetch(),4;case 0:return this.fetch(),2e5}}runSteps(t){for(let s=0;s<t;s++)this.step()}runUntilPC(t,s){let h=0;for(;h<s&&this.PC!==t;)h+=this.step();return h}callSubroutine(t,s=2e5){const h=this.SP;this.push(255),this.push(254),this.PC=t;let i=0;for(;i<s&&(i+=this.step(),!(this.SP>=h)););}runPlayer(t,s,h,i,r,e=2e5){this.setA(h),this.setX(i),this.callSubroutine(t);for(let c=0;c<r;c++)this.callSubroutine(s,e)}}export{t as C};
