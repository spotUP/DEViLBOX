import{ch as e,j as s,aH as t,ci as o}from"./index-zx6LJBPK.js";import{r,R as n}from"./vendor-utils-XMmR-oGw.js";import{a as i,M as l}from"./modularPresets-CRQ9c6cZ.js";import{l as a,f as d,T as m,a2 as u,c,X as p,at as x,au as v,av as b,k as N}from"./vendor-ui-uomqNFY-.js";import{b as h,C as f,u as g,a as y,s as E,K as V,P as w,D,c as C,S as M,v as k,d as L}from"./sortable.esm-Nw3Rboz6.js";import"./vendor-react-DkDaD07v.js";import"./vendor-tone-CADp_hfL.js";const j={source:"Sources",filter:"Filters",amplifier:"Amplifiers",modulator:"Modulators",envelope:"Envelopes",utility:"Utility",io:"I/O"},B=({onAddModule:t})=>{const[o,n]=r.useState(!1),i=e.getAll(),l=Object.keys(j),m=l.reduce((e,s)=>(e[s]=i.filter(e=>e.category===s),e),{});return s.jsxDEV("div",{className:"relative",children:[s.jsxDEV("button",{onClick:()=>n(!o),className:"flex items-center gap-2 px-3 py-1.5 bg-accent-primary hover:bg-accent-secondary text-white rounded text-sm font-bold transition-all shadow-md active:scale-95",children:[s.jsxDEV(a,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:53,columnNumber:9},void 0),"Add Module",s.jsxDEV(d,{className:"w-4 h-4 transition-transform "+(o?"rotate-180":"")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:55,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:49,columnNumber:7},void 0),o&&s.jsxDEV("div",{className:"absolute top-full left-0 mt-1 w-64 bg-dark-bgSecondary border border-dark-border rounded-lg shadow-2xl z-[9999] max-h-96 overflow-y-auto scrollbar-modern",children:l.map(e=>{const o=m[e];return 0===o.length?null:s.jsxDEV("div",{className:"border-b border-dark-border last:border-b-0",children:[s.jsxDEV("div",{className:"px-3 py-2 bg-dark-bgTertiary text-xs font-bold text-text-secondary uppercase tracking-widest border-b border-dark-border/50",children:j[e]},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:68,columnNumber:17},void 0),s.jsxDEV("div",{className:"py-1",children:o.map(e=>s.jsxDEV("button",{onClick:()=>{return s=e.id,t(s),void n(!1);var s},className:"w-full px-4 py-2 text-left hover:bg-dark-bgHover transition-colors text-sm group",children:s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV("div",{className:"w-2 h-2 rounded-full shadow-sm group-hover:scale-125 transition-transform",style:{backgroundColor:e.color||"#6b7280"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:82,columnNumber:25},void 0),s.jsxDEV("span",{className:"text-text-primary group-hover:text-accent-primary transition-colors",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:86,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:80,columnNumber:23},void 0)},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:75,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:73,columnNumber:17},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:66,columnNumber:15},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:60,columnNumber:9},void 0),o&&s.jsxDEV("div",{className:"fixed inset-0 z-[9998]",onClick:()=>n(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:99,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModuleShelf.tsx",lineNumber:47,columnNumber:5},void 0)},O=({config:e,onChange:t})=>s.jsxDEV("div",{className:"flex items-center gap-3 px-4 py-2 bg-dark-bgSecondary border-b border-dark-border text-text-primary",children:[s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV("span",{className:"text-xs text-text-secondary",children:"Preset:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:63,columnNumber:9},void 0),s.jsxDEV("select",{onChange:e=>(e=>{const s=i[e];s&&t(s)})(e.target.value),value:"",className:"px-2 py-1 bg-dark-bgTertiary border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[s.jsxDEV("option",{value:"",disabled:!0,className:"bg-dark-bgSecondary",children:"Load preset..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:69,columnNumber:11},void 0),s.jsxDEV("option",{value:"init",className:"bg-dark-bgSecondary",children:"Init"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:72,columnNumber:11},void 0),s.jsxDEV("option",{value:"bass",className:"bg-dark-bgSecondary",children:"Bass"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:73,columnNumber:11},void 0),s.jsxDEV("option",{value:"pad",className:"bg-dark-bgSecondary",children:"Pad"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:74,columnNumber:11},void 0),s.jsxDEV("option",{value:"percussion",className:"bg-dark-bgSecondary",children:"Percussion"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:75,columnNumber:11},void 0),s.jsxDEV("option",{value:"fmBell",className:"bg-dark-bgSecondary",children:"FM Bell"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:76,columnNumber:11},void 0),s.jsxDEV("option",{value:"lead",className:"bg-dark-bgSecondary",children:"Lead"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:77,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:64,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:62,columnNumber:7},void 0),s.jsxDEV(B,{onAddModule:s=>{const o={id:`mod_${Date.now()}`,descriptorId:s,parameters:{},position:{x:100,y:100},rackSlot:e.modules.length};t({...e,modules:[...e.modules,o]})}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:82,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV("span",{className:"text-xs text-text-secondary",children:"Voices:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:86,columnNumber:9},void 0),s.jsxDEV("select",{value:e.polyphony,onChange:s=>{return o=parseInt(s.target.value,10),void t({...e,polyphony:o});var o},className:"px-2 py-1 bg-dark-bgTertiary border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[1,2,4,8].map(e=>s.jsxDEV("option",{value:e,className:"bg-dark-bgSecondary",children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:93,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:87,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:85,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex items-center gap-2",children:[s.jsxDEV("span",{className:"text-xs text-text-secondary",children:"View:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:102,columnNumber:9},void 0),s.jsxDEV("div",{className:"flex gap-1 bg-dark-bgTertiary rounded p-0.5 border border-dark-border",children:["rack","canvas","matrix"].map(o=>s.jsxDEV("button",{onClick:()=>{return s=o,void t({...e,viewMode:s});var s},className:`\n                px-3 py-1 text-xs rounded transition-colors capitalize\n                ${e.viewMode===o?"bg-accent-primary text-white font-bold":"text-text-secondary hover:text-text-primary hover:bg-dark-bgHover"}\n              `,children:o},o,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:105,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:103,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:101,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:123,columnNumber:7},void 0),s.jsxDEV("button",{onClick:()=>{confirm("Clear all modules and connections?")&&t({...e,modules:[],connections:[]})},className:"flex items-center gap-1 px-2 py-1 hover:bg-dark-bgHover rounded text-sm text-text-secondary hover:text-accent-error transition-colors",title:"Clear patch",children:[s.jsxDEV(m,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:131,columnNumber:9},void 0),"Clear"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:126,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularToolbar.tsx",lineNumber:60,columnNumber:5},void 0),X={audio:"#10b981",cv:"#eab308",gate:"#ef4444",trigger:"#3b82f6"},U=({portRef:e,name:t,direction:o,signal:n,isHovered:i=!1,isConnected:l=!1,isWiringSource:a=!1,onPortClick:d,onPortHover:m,registerPosition:u})=>{const c=r.useRef(null),p=`${e.moduleId}.${e.portId}`;r.useEffect(()=>{u(p,c.current)},[p,u]);const x=X[n],v="input"===o;return s.jsxDEV("div",{className:"flex items-center gap-1 "+(v?"flex-row":"flex-row-reverse"),title:`${t} (${n})`,children:[s.jsxDEV("div",{ref:c,className:`\n          relative w-4 h-4 rounded-full cursor-pointer border-2 transition-all flex items-center justify-center\n          ${a?"ring-2 ring-white ring-offset-1":""}\n          ${i?"scale-125 shadow-lg":""}\n        `,style:{backgroundColor:"#1f2937",borderColor:x,boxShadow:a?`0 0 8px ${x}`:l?`0 0 4px ${x}80`:"none"},onClick:s=>{s.stopPropagation(),d(e)},onMouseEnter:()=>{m(e)},onMouseLeave:()=>{m(null)},children:s.jsxDEV("div",{className:"w-1.5 h-1.5 rounded-full bg-black shadow-inner",style:{backgroundColor:l?x:"#000",opacity:l?.8:.5}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/JackPort.tsx",lineNumber:90,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/JackPort.tsx",lineNumber:73,columnNumber:7},void 0),s.jsxDEV("span",{className:"text-[10px] font-mono tracking-tight text-text-secondary",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/JackPort.tsx",lineNumber:100,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/JackPort.tsx",lineNumber:68,columnNumber:5},void 0)},S=({module:o,isSelected:n=!1,isConnected:i=()=>!1,isWiringSource:l=()=>!1,isPortHovered:a=()=>!1,onModuleClick:m,onModuleDelete:x,onPortClick:v,onPortHover:b,onParameterChange:N,registerPortPosition:g})=>{const[y,E]=r.useState(o.collapsed||!1),V=e.get(o.descriptorId),{attributes:w,listeners:D,setNodeRef:C,transform:M,transition:k}=h({id:o.id}),L={transform:f.Transform.toString(M),transition:k};if(!V)return s.jsxDEV("div",{className:"p-2 bg-dark-bgSecondary rounded border border-dark-border",children:s.jsxDEV("span",{className:"text-xs text-text-muted",children:["Unknown module: ",o.descriptorId]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:60,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:59,columnNumber:7},void 0);const j=V.ports.filter(e=>"input"===e.direction),B=V.ports.filter(e=>"output"===e.direction);return s.jsxDEV("div",{ref:C,style:L,className:`\n        flex flex-col bg-dark-bgSecondary rounded-lg border-2 overflow-hidden\n        ${n?"border-accent-primary shadow-[0_0_10px_rgba(var(--color-accent-rgb),0.3)]":"border-dark-border"}\n        hover:border-accent-primary/50 transition-colors\n      `,onClick:()=>{m(o.id)},children:[s.jsxDEV("div",{className:"flex items-center gap-2 px-3 py-2",style:{backgroundColor:V.color||"#374151",backgroundImage:"linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%)"},children:[s.jsxDEV("div",{...w,...D,className:"cursor-grab active:cursor-grabbing",children:s.jsxDEV(u,{className:"w-4 h-4 text-white/70"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:103,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:102,columnNumber:9},void 0),s.jsxDEV("button",{onClick:e=>{e.stopPropagation(),E(!y)},className:"p-0.5 hover:bg-black/20 rounded transition-colors",children:y?s.jsxDEV(c,{className:"w-4 h-4 text-white/70"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:112,columnNumber:13},void 0):s.jsxDEV(d,{className:"w-4 h-4 text-white/70"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:114,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:107,columnNumber:9},void 0),s.jsxDEV("span",{className:"flex-1 text-xs font-bold text-white uppercase tracking-wider truncate drop-shadow-md",children:o.label||V.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:119,columnNumber:9},void 0),s.jsxDEV("button",{onClick:e=>{e.stopPropagation(),x(o.id)},className:"p-0.5 hover:bg-accent-error/20 rounded text-white/50 hover:text-accent-error transition-colors",children:s.jsxDEV(p,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:128,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:124,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:94,columnNumber:7},void 0),!y&&s.jsxDEV("div",{className:"flex items-center gap-4 px-3 py-3 relative",children:[s.jsxDEV("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E\")"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:136,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex flex-col gap-2 relative z-10",children:j.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:e.name,direction:"input",signal:e.signal,isHovered:a(t),isConnected:i(t),isWiringSource:l(t),onPortClick:v,onPortHover:b,registerPosition:g},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:146,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:142,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex-1 flex gap-3 justify-center relative z-10",children:V.parameters.map(e=>s.jsxDEV("div",{className:"flex flex-col items-center gap-1",children:[s.jsxDEV(t,{value:o.parameters[e.id]??e.default,min:e.min,max:e.max,onChange:s=>N(o.id,e.id,s),size:"sm",label:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:167,columnNumber:17},void 0),s.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono",children:[(o.parameters[e.id]??e.default).toFixed(2),e.unit||""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:175,columnNumber:17},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:166,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:164,columnNumber:11},void 0),s.jsxDEV("div",{className:"flex flex-col gap-2 relative z-10",children:B.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:e.name,direction:"output",signal:e.signal,isHovered:a(t),isConnected:i(t),isWiringSource:l(t),onPortClick:v,onPortHover:b,registerPosition:g},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:188,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:184,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:134,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/RackStrip.tsx",lineNumber:83,columnNumber:5},void 0)};function P(e,s,t,o,r=!0,n=8,i=0,l=[]){if(!r){const r=t-e,n=Math.min(.5*Math.abs(r),100);return`M ${e},${s} C ${e+n},${s} ${t-n},${o} ${t},${o}`}const a=function(e,s,t={}){const{horizontalFirst:o=!0,laneOffset:r=0,obstacles:n=[]}=t,i=[e],l=s.x-e.x,a=s.y-e.y;if(Math.abs(a)<5)return i.push(s),i;if(Math.abs(l)<5)return i.push(s),i;const d=l>0,m=30+10*Math.abs(r),u=Math.min(e.x,s.x)-20,c=Math.max(e.x,s.x)+20,p=n.filter(e=>e.x+e.w>u&&e.x<c);let x;if(0===p.length)x=(e.y+s.y)/2;else{const t=Math.min(...p.map(e=>e.y))-20,o=Math.max(...p.map(e=>e.y+e.h))+20,n=(e.y+s.y)/2;x=Math.abs(n-t)<Math.abs(n-o)?t-5*Math.abs(r):o+5*Math.abs(r)}return o&&d||o&&!d?(i.push({x:e.x+m,y:e.y}),i.push({x:e.x+m,y:x}),i.push({x:s.x-m,y:x}),i.push({x:s.x-m,y:s.y})):(i.push({x:e.x,y:x}),i.push({x:s.x,y:x})),i.push(s),i}({x:e,y:s},{x:t,y:o},{horizontalFirst:!0,laneOffset:i,obstacles:l});return function(e,s=0){if(e.length<2)return"";if(0===s||2===e.length)return e.map((e,s)=>0===s?`M ${e.x},${e.y}`:`L ${e.x},${e.y}`).join(" ");const t=[];t.push(`M ${e[0].x},${e[0].y}`);for(let r=1;r<e.length-1;r++){const o=e[r-1],n=e[r],i=e[r+1],l=n.x-o.x,a=n.y-o.y,d=i.x-n.x,m=i.y-n.y,u=Math.sqrt(l*l+a*a),c=Math.sqrt(d*d+m*m),p=Math.min(u,c)/2,x=Math.min(s,p);if(x<1){t.push(`L ${n.x},${n.y}`);continue}const v=n.x-l/u*x,b=n.y-a/u*x,N=n.x+d/c*x,h=n.y+m/c*x;t.push(`L ${v},${b}`),t.push(`Q ${n.x},${n.y} ${N},${h}`)}const o=e[e.length-1];return t.push(`L ${o.x},${o.y}`),t.join(" ")}(a,n)}const I={audio:"#10b981",cv:"#eab308",gate:"#ef4444",trigger:"#3b82f6"},$=({x1:e,y1:t,x2:o,y2:r,color:n,signal:i="audio",isSelected:l=!1,onClick:a,onContextMenu:d,useOrthogonal:m=!0,laneOffset:u=0,obstacles:c=[]})=>{const p=P(e,t,o,r,m,8,u,c),x=n||I[i];return s.jsxDEV("g",{onClick:a,onContextMenu:d,className:"cursor-pointer",children:[s.jsxDEV("path",{d:p,stroke:"transparent",strokeWidth:"12",fill:"none",className:"pointer-events-auto"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/PatchCable.tsx",lineNumber:60,columnNumber:7},void 0),s.jsxDEV("path",{d:p,stroke:x,strokeWidth:l?"4":"3",fill:"none",className:"transition-all pointer-events-none",style:{filter:l?`drop-shadow(0 0 4px ${x})`:"none"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/PatchCable.tsx",lineNumber:69,columnNumber:7},void 0),s.jsxDEV("circle",{cx:e,cy:t,r:"2",fill:x,className:"pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/PatchCable.tsx",lineNumber:81,columnNumber:7},void 0),s.jsxDEV("circle",{cx:o,cy:r,r:"2",fill:x,className:"pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/PatchCable.tsx",lineNumber:82,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/PatchCable.tsx",lineNumber:54,columnNumber:5},void 0)},R=e=>{const[s,t]=r.useState(new Map),o=r.useRef(new Map),n=r.useRef(null),i=r.useCallback((s,r)=>{if(!r)return o.current.delete(s),void t(e=>{const t=new Map(e);return t.delete(s),t});o.current.set(s,r);const n=r.getBoundingClientRect(),i=n.left+n.width/2,l=n.top+n.height/2;let a=i,d=l;if(e?.current){const s=e.current.getBoundingClientRect();a=i-s.left,d=l-s.top}t(e=>{const t=new Map(e);return t.set(s,{x:a,y:d}),t})},[e]),l=r.useCallback((e,s)=>{i(e,s)},[i]),a=r.useCallback(()=>{o.current.forEach((e,s)=>{i(s,e)})},[i]);return r.useEffect(()=>(n.current=new ResizeObserver(()=>{a()}),n.current.observe(document.body),()=>{n.current?.disconnect()}),[a]),r.useEffect(()=>{const s=()=>{a()},t=e?.current||window;return t.addEventListener("scroll",s,!0),()=>{t.removeEventListener("scroll",s,!0)}},[a,e]),{positions:s,registerPort:l,recalculateAll:a}},z=()=>{const[e,s]=r.useState(null),[t,o]=r.useState(null),[n,i]=r.useState(null),[l,a]=r.useState(null),[d,m]=r.useState(null);return{selectedModuleId:e,hoveredPortId:t,wiringSource:n,wiringPreview:l,selectedConnectionId:d,startWiring:r.useCallback(e=>{i(e),a(null)},[]),updateWiringPreview:r.useCallback((e,s)=>{a({x:e,y:s})},[]),endWiring:r.useCallback(()=>{i(null),a(null)},[]),selectModule:r.useCallback(e=>{s(e)},[]),selectConnection:r.useCallback(e=>{m(e)},[]),hoverPort:r.useCallback(e=>{o(e)},[])}},T=({config:t,onChange:o})=>{const i=n.useRef(null),l=n.useRef(null),a=n.useRef(t);n.useEffect(()=>{a.current=t},[t]);const{positions:d,registerPort:m,recalculateAll:u}=R(i),{selectedModuleId:c,wiringSource:p,wiringPreview:x,selectedConnectionId:v,startWiring:b,updateWiringPreview:N,endWiring:h,selectModule:f,selectConnection:j,hoverPort:B}=z(),O=g(y(w),y(V,{coordinateGetter:E})),X=r.useCallback(e=>{if(p){if(`${p.moduleId}.${p.portId}`===`${e.moduleId}.${e.portId}`)return void h();const s={id:`conn_${Date.now()}`,source:p,target:e,amount:1};o({...a.current,connections:[...a.current.connections,s]}),h()}else b(e)},[p,b,h,o,t]),U=r.useCallback((e,s,t)=>{const r=a.current.modules.map(o=>o.id===e?{...o,parameters:{...o.parameters,[s]:t}}:o);o({...a.current,modules:r})},[o]),P=r.useCallback(e=>{const s=a.current.modules.filter(s=>s.id!==e),t=a.current.connections.filter(s=>s.source.moduleId!==e&&s.target.moduleId!==e);o({...a.current,modules:s,connections:t})},[o]),I=r.useCallback(e=>{j(e)},[j]),T=r.useCallback(()=>{if(v){const e=a.current.connections.filter(e=>e.id!==v);o({...a.current,connections:e}),j(null)}},[v,o,j]);n.useEffect(()=>{const e=l.current;if(!e)return;const s=()=>{u()};return e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)},[u]),n.useEffect(()=>{const e=e=>{"Delete"!==e.key&&"Backspace"!==e.key||v&&T(),"Escape"===e.key&&(h(),j(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[v,T,h,j]),n.useEffect(()=>{if(!p||!i.current)return;const e=e=>{const s=i.current.getBoundingClientRect(),t=e.clientX-s.left,o=e.clientY-s.top;N(t,o)};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[p,N]);const H=e=>`${e.moduleId}.${e.portId}`,W=e=>t.connections.some(s=>H(s.source)===H(e)||H(s.target)===H(e)),F=e=>!!p&&H(p)===H(e),A=r.useCallback(()=>{const e=new Map,s=[];a.current.connections.forEach(e=>{const t=d.get(H(e.source)),o=d.get(H(e.target));if(!t||!o)return;const r=Math.min(t.y,o.y),n=Math.max(t.y,o.y),i=t.x>o.x?"right":"left";s.push({conn:e,yMin:r,yMax:n,side:i})});const t=[];return s.forEach(e=>{const s=[];if(t.forEach((t,o)=>{t.some(s=>{return s.side===e.side&&(t=e.yMin,o=e.yMax,r=s.yMin,n=s.yMax,t<=n&&r<=o);var t,o,r,n})&&t[0].side===e.side&&s.push(o)}),0===s.length)t.push([e]);else if(1===s.length)t[s[0]].push(e);else{const o=[e];for(let e=s.length-1;e>=0;e--){const r=s[e];o.push(...t[r]),t.splice(r,1)}t.push(o)}}),t.forEach(s=>{const t=s.length;s.forEach((s,o)=>{const r=o-(t-1)/2;e.set(s.conn.id,r)})}),e},[d])();return s.jsxDEV("div",{ref:i,className:"relative flex flex-col h-full bg-dark-bg overflow-hidden",children:[s.jsxDEV("svg",{className:"absolute inset-0 pointer-events-none z-10",style:{width:"100%",height:"100%"},children:[t.connections.map(t=>{const o=d.get(H(t.source)),r=d.get(H(t.target));if(!o||!r)return null;const n=A.get(t.id)||0,i=a.current.modules.find(e=>e.id===t.source.moduleId),l=i?e.get(i.descriptorId):null,m=l?.ports.find(e=>e.id===t.source.portId),u=m?.signal||"audio";return s.jsxDEV($,{x1:o.x,y1:o.y,x2:r.x,y2:r.y,color:t.color,signal:u,isSelected:t.id===v,onClick:()=>I(t.id),laneOffset:n},t.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:334,columnNumber:13},void 0)}),p&&x&&d.get(H(p))&&s.jsxDEV($,{x1:d.get(H(p)).x,y1:d.get(H(p)).y,x2:x.x,y2:x.y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:351,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:315,columnNumber:7},void 0),s.jsxDEV("div",{ref:l,className:"flex-1 overflow-y-auto p-4",children:[s.jsxDEV(D,{sensors:O,collisionDetection:C,onDragEnd:e=>{const{active:s,over:r}=e;if(r&&s.id!==r.id){const e=t.modules.findIndex(e=>e.id===s.id),n=t.modules.findIndex(e=>e.id===r.id),i=L(t.modules,e,n).map((e,s)=>({...e,rackSlot:s}));o({...a.current,modules:i}),u()}},children:s.jsxDEV(M,{items:t.modules.map(e=>e.id),strategy:k,children:s.jsxDEV("div",{className:"flex flex-col gap-12 px-20 max-w-5xl mx-auto",children:t.modules.map(e=>s.jsxDEV(S,{module:e,isSelected:e.id===c,isConnected:W,isWiringSource:F,onModuleClick:f,onModuleDelete:P,onPortClick:X,onPortHover:B,onParameterChange:U,registerPortPosition:m},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:366,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:364,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:363,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:362,columnNumber:9},void 0),0===t.modules.length&&s.jsxDEV("div",{className:"flex items-center justify-center h-full text-text-muted",children:s.jsxDEV("p",{className:"text-sm",children:'No modules yet. Click "Add Module" to get started.'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:387,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:386,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:361,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularRackView.tsx",lineNumber:313,columnNumber:5},void 0)},H=({module:o,isSelected:n=!1,zoom:i,isConnected:l=()=>!1,isWiringSource:a=()=>!1,isPortHovered:m=()=>!1,onModuleClick:x,onModuleDelete:v,onModuleDragStart:b,onModuleDrag:N,onModuleDragEnd:h,onPortClick:f,onPortHover:g,onParameterChange:y,registerPortPosition:E})=>{const[V,w]=r.useState(o.collapsed||!1),[D,C]=r.useState(!1),M=r.useRef(null),k=e.get(o.descriptorId);if(r.useEffect(()=>{if(!D)return;const e=e=>{if(M.current){const s=(e.clientX-M.current.x)/i,t=(e.clientY-M.current.y)/i;N(s,t),M.current={x:e.clientX,y:e.clientY}}},s=()=>{C(!1),M.current=null,h()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",s),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",s)}},[D,i,N,h]),!k)return s.jsxDEV("div",{className:"absolute bg-dark-bgSecondary rounded border border-dark-border p-2 z-50",style:{left:o.position?.x||0,top:o.position?.y||0},children:s.jsxDEV("span",{className:"text-xs text-text-muted",children:["Unknown module: ",o.descriptorId]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:96,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:89,columnNumber:7},void 0);const L=k.ports.filter(e=>"input"===e.direction),j=k.ports.filter(e=>"output"===e.direction);return s.jsxDEV("div",{className:`\n        absolute flex flex-col bg-dark-bgSecondary rounded-sm border border-black/50 overflow-hidden\n        ${n?"ring-2 ring-accent-primary":""}\n        shadow-xl transition-shadow\n        ${D?"cursor-grabbing shadow-2xl scale-[1.02] z-50":"cursor-default"}\n        pointer-events-auto\n      `,style:{left:o.position?.x||0,top:o.position?.y||0,width:V?"120px":"180px",transformOrigin:"top left",background:"linear-gradient(180deg, #2a2a2e 0%, #202024 100%)",boxShadow:"inset 1px 1px 0 rgba(255,255,255,0.1), inset -1px -1px 0 rgba(0,0,0,0.3), 0 4px 12px rgba(0,0,0,0.5)"},onClick:()=>{x(o.id)},children:[s.jsxDEV("div",{className:"absolute top-1 left-1 w-1.5 h-1.5 rounded-full bg-stone-400 shadow-inner opacity-50 pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:146,columnNumber:7},void 0),s.jsxDEV("div",{className:"absolute top-1 right-1 w-1.5 h-1.5 rounded-full bg-stone-400 shadow-inner opacity-50 pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:147,columnNumber:7},void 0),s.jsxDEV("div",{className:"absolute bottom-1 left-1 w-1.5 h-1.5 rounded-full bg-stone-400 shadow-inner opacity-50 pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:148,columnNumber:7},void 0),s.jsxDEV("div",{className:"absolute bottom-1 right-1 w-1.5 h-1.5 rounded-full bg-stone-400 shadow-inner opacity-50 pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:149,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex items-center gap-2 px-2 py-1.5 border-b border-black/20 cursor-grab active:cursor-grabbing",style:{backgroundColor:k.color||"#374151",backgroundImage:"linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%)"},onMouseDown:e=>{0===e.button&&(e.stopPropagation(),C(!0),M.current={x:e.clientX,y:e.clientY},b(o.id,e.clientX,e.clientY))},children:[s.jsxDEV(u,{className:"w-3 h-3 text-white/50 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:160,columnNumber:9},void 0),s.jsxDEV("button",{onClick:e=>{e.stopPropagation(),w(!V)},className:"p-0.5 hover:bg-black/20 rounded flex-shrink-0 text-white/70 hover:text-white transition-colors",children:V?s.jsxDEV(c,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:167,columnNumber:13},void 0):s.jsxDEV(d,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:169,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:162,columnNumber:9},void 0),s.jsxDEV("span",{className:"flex-1 text-[10px] font-bold text-white uppercase tracking-wider truncate drop-shadow-md",children:o.label||k.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:173,columnNumber:9},void 0),s.jsxDEV("button",{onClick:e=>{e.stopPropagation(),v(o.id)},className:"p-0.5 hover:bg-red-500/80 rounded text-white/50 hover:text-white flex-shrink-0 transition-colors",children:s.jsxDEV(p,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:181,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:177,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:152,columnNumber:7},void 0),!V&&s.jsxDEV("div",{className:"flex flex-col gap-3 p-3 relative",children:[s.jsxDEV("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E\")"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:189,columnNumber:11},void 0),L.length>0&&s.jsxDEV("div",{className:"flex flex-col gap-1",children:[s.jsxDEV("span",{className:"text-xs text-text-muted uppercase",children:"Inputs"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:197,columnNumber:15},void 0),L.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:e.name,direction:"input",signal:e.signal,isHovered:m(t),isConnected:l(t),isWiringSource:a(t),onPortClick:f,onPortHover:g,registerPosition:E},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:201,columnNumber:19},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:196,columnNumber:13},void 0),k.parameters.length>0&&s.jsxDEV("div",{className:"flex flex-col gap-2",children:[s.jsxDEV("span",{className:"text-xs text-text-muted uppercase",children:"Parameters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:222,columnNumber:15},void 0),s.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:k.parameters.map(e=>s.jsxDEV("div",{className:"flex flex-col items-center gap-1",children:[s.jsxDEV(t,{value:o.parameters[e.id]??e.default,min:e.min,max:e.max,onChange:s=>y(o.id,e.id,s),size:"sm",label:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:226,columnNumber:21},void 0),s.jsxDEV("span",{className:"text-xs text-text-muted",children:(o.parameters[e.id]??e.default).toFixed(2)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:234,columnNumber:21},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:225,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:223,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:221,columnNumber:13},void 0),j.length>0&&s.jsxDEV("div",{className:"flex flex-col gap-1",children:[s.jsxDEV("span",{className:"text-xs text-text-muted uppercase",children:"Outputs"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:246,columnNumber:15},void 0),j.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:e.name,direction:"output",signal:e.signal,isHovered:m(t),isConnected:l(t),isWiringSource:a(t),onPortClick:f,onPortHover:g,registerPosition:E},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:250,columnNumber:19},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:245,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:187,columnNumber:9},void 0),V&&s.jsxDEV("div",{className:"flex flex-col gap-2 p-2 relative",children:[s.jsxDEV("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E\")"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:274,columnNumber:11},void 0),L.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:"",direction:"input",signal:e.signal,isHovered:m(t),isConnected:l(t),isWiringSource:a(t),onPortClick:f,onPortHover:g,registerPosition:E},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:282,columnNumber:15},void 0)}),j.map(e=>{const t={moduleId:o.id,portId:e.id};return s.jsxDEV(U,{portRef:t,name:"",direction:"output",signal:e.signal,isHovered:m(t),isConnected:l(t),isWiringSource:a(t),onPortClick:f,onPortHover:g,registerPosition:E},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:300,columnNumber:15},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:272,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/widgets/ModulePanel.tsx",lineNumber:127,columnNumber:5},void 0)},W=({zoom:e,offsetX:t,offsetY:o})=>{const r=16*e;return s.jsxDEV("svg",{className:"absolute inset-0 pointer-events-none",style:{width:"100%",height:"100%"},children:[s.jsxDEV("defs",{children:s.jsxDEV("pattern",{id:"canvas-grid",width:r,height:r,patternUnits:"userSpaceOnUse",x:t,y:o,children:s.jsxDEV("circle",{cx:r/2,cy:r/2,r:Math.max(.8,1.2*e),fill:"var(--color-text-muted)",opacity:"0.3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/CanvasGrid.tsx",lineNumber:33,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/CanvasGrid.tsx",lineNumber:25,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/CanvasGrid.tsx",lineNumber:24,columnNumber:7},void 0),s.jsxDEV("rect",{width:"100%",height:"100%",fill:"url(#canvas-grid)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/CanvasGrid.tsx",lineNumber:42,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/CanvasGrid.tsx",lineNumber:20,columnNumber:5},void 0)};class F{state;minZoom=.1;maxZoom=2;constructor(e){this.state=e||{x:0,y:0,zoom:1}}getState(){return{...this.state}}setState(e){this.state={x:e.x??this.state.x,y:e.y??this.state.y,zoom:e.zoom??this.state.zoom},this.clampZoom()}pan(e,s){this.state.x+=e,this.state.y+=s}zoomAt(e,s,t){const o=this.state.zoom,r=Math.max(this.minZoom,Math.min(this.maxZoom,o*(1+t))),n=(e-this.state.x)/o,i=(s-this.state.y)/o;this.state.zoom=r,this.state.x=e-n*r,this.state.y=s-i*r}setZoom(e){this.state.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,e))}reset(){this.state={x:0,y:0,zoom:1}}fitToView(e,s,t){if(0===e.length)return void this.reset();let o=1/0,r=1/0,n=-1/0,i=-1/0;e.forEach(e=>{const s=e.position||{x:0,y:0};o=Math.min(o,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x+200),i=Math.max(i,s.y+300)});const l=s/(n-o+100),a=t/(i-r+100),d=Math.min(l,a,this.maxZoom),m=(o+n)/2,u=(r+i)/2;this.state.zoom=d,this.state.x=s/2-m*d,this.state.y=t/2-u*d}screenToWorld(e,s){return{x:(e-this.state.x)/this.state.zoom,y:(s-this.state.y)/this.state.zoom}}worldToScreen(e,s){return{x:e*this.state.zoom+this.state.x,y:s*this.state.zoom+this.state.y}}getCSSTransform(){return`translate(${this.state.x}px, ${this.state.y}px) scale(${this.state.zoom})`}clampZoom(){this.state.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.state.zoom))}}const A=({config:e,onChange:t})=>{const o=r.useRef(null),n=r.useRef(new F(e.camera)),[i,l]=r.useState(n.current.getState()),[a,d]=r.useState(!1),[m,u]=r.useState(null),{positions:c,registerPort:p,recalculateAll:h}=R(o),{selectedModuleId:f,hoveredPortId:g,wiringSource:y,wiringPreview:E,selectedConnectionId:V,startWiring:w,updateWiringPreview:D,endWiring:C,selectModule:M,selectConnection:k,hoverPort:L}=z();r.useEffect(()=>{if(!e.camera){const s=setTimeout(()=>{if(o.current&&e.modules.length>0){const s=o.current.getBoundingClientRect();s.width>0&&s.height>0&&(n.current.fitToView(e.modules,s.width,s.height),l(n.current.getState()))}},100);return()=>clearTimeout(s)}n.current.setState(e.camera),l(n.current.getState())},[e.camera]),r.useEffect(()=>{const s=n.current.getState();s.x===e.camera?.x&&s.y===e.camera?.y&&s.zoom===e.camera?.zoom||t({...e,camera:s})},[i]);const j=r.useCallback((e,s)=>n.current.screenToWorld(e+(o.current?.getBoundingClientRect().left||0),s+(o.current?.getBoundingClientRect().top||0)),[]);r.useEffect(()=>{const e=e=>{(1===e.button||0===e.button&&e.shiftKey)&&(e.preventDefault(),d(!0))},s=e=>{a&&(n.current.pan(e.movementX,e.movementY),l(n.current.getState()))},t=()=>{d(!1)};return window.addEventListener("mousedown",e),window.addEventListener("mousemove",s),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",t)}},[a]),r.useEffect(()=>{const e=e=>{if(o.current){if(e.preventDefault(),e.ctrlKey||e.metaKey){const s=.001*-e.deltaY;n.current.zoomAt(e.clientX,e.clientY,s)}else e.shiftKey?n.current.pan(-e.deltaY,0):n.current.pan(-e.deltaX,-e.deltaY);l(n.current.getState())}},s=o.current;return s?.addEventListener("wheel",e,{passive:!1}),()=>{s?.removeEventListener("wheel",e)}},[]);r.useEffect(()=>{const e=e=>{"Delete"!==e.key&&"Backspace"!==e.key||V&&T(),"Escape"===e.key&&(C(),k(null)),"f"!==e.key&&"F"!==e.key||_(),"0"===e.key&&(n.current.reset(),l(n.current.getState()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[V,C,k]),r.useEffect(()=>{if(!y)return;const e=e=>{if(!o.current)return;const s=o.current.getBoundingClientRect(),t=e.clientX-s.left,r=e.clientY-s.top;D(t,r)};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[y,D]);const B=r.useCallback(s=>{if(y){if(`${y.moduleId}.${y.portId}`===`${s.moduleId}.${s.portId}`)return void C();const o={id:`conn_${Date.now()}`,source:y,target:s,amount:1};t({...e,connections:[...e.connections,o]}),C()}else w(s)},[y,w,C,t,e]),O=r.useCallback((s,o,r)=>{const n=e.modules.map(e=>e.id===s?{...e,parameters:{...e.parameters,[o]:r}}:e);t({...e,modules:n})},[e,t]),X=r.useCallback(s=>{const o=e.modules.filter(e=>e.id!==s),r=e.connections.filter(e=>e.source.moduleId!==s&&e.target.moduleId!==s);t({...e,modules:o,connections:r})},[e,t]),U=r.useCallback((e,s,t)=>{u(e)},[]),S=r.useCallback((s,o)=>{if(!m)return;const r=e.modules.map(e=>e.id===m?{...e,position:{x:(e.position?.x||0)+s,y:(e.position?.y||0)+o}}:e);t({...e,modules:r}),h()},[m,e,t,h]),P=r.useCallback(()=>{u(null)},[]),I=r.useCallback(e=>{k(e)},[k]),T=r.useCallback(s=>{const o=s||V;if(o){const s=e.connections.filter(e=>e.id!==o);t({...e,connections:s}),V===o&&k(null)}},[V,e,t,k]),A=r.useCallback(()=>{if(!o.current)return;const e=o.current.getBoundingClientRect();n.current.zoomAt(e.left+e.width/2,e.top+e.height/2,.2),l(n.current.getState())},[]),Z=r.useCallback(()=>{if(!o.current)return;const e=o.current.getBoundingClientRect();n.current.zoomAt(e.left+e.width/2,e.top+e.height/2,-.2),l(n.current.getState())},[]),Y=r.useCallback(()=>{n.current.reset(),l(n.current.getState())},[]),_=r.useCallback(()=>{if(!o.current)return;const s=o.current.getBoundingClientRect();n.current.fitToView(e.modules,s.width,s.height),l(n.current.getState())},[e.modules]),G=e=>`${e.moduleId}.${e.portId}`,q=r.useMemo(()=>e.modules.map(e=>({x:e.position?.x||0,y:e.position?.y||0,w:e.collapsed?120:180,h:200})),[e.modules]),K=s=>e.connections.some(e=>G(e.source)===G(s)||G(e.target)===G(s)),J=e=>!!y&&G(y)===G(e),Q=e=>null!==g&&G(g)===G(e);return s.jsxDEV("div",{ref:o,className:"relative flex flex-col h-full bg-dark-bg overflow-hidden",style:{cursor:a?"grabbing":"default"},onMouseDown:e=>{e.target!==e.currentTarget&&"rect"!==e.target.tagName||0===e.button&&d(!0)},children:[s.jsxDEV(W,{zoom:i.zoom,offsetX:i.x,offsetY:i.y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:368,columnNumber:7},void 0),s.jsxDEV("div",{className:"absolute inset-0",style:{transform:n.current.getCSSTransform(),transformOrigin:"top left"},children:[s.jsxDEV("svg",{className:"absolute inset-0 pointer-events-auto z-0",style:{width:"100%",height:"100%"},children:[e.connections.map((e,t)=>{const o=c.get(G(e.source)),r=c.get(G(e.target));if(!o||!r)return null;const n=j(o.x,o.y),i=j(r.x,r.y);return s.jsxDEV($,{x1:n.x,y1:n.y,x2:i.x,y2:i.y,color:e.color,isSelected:e.id===V,onClick:()=>I(e.id),onContextMenu:s=>{s.preventDefault(),s.stopPropagation(),T(e.id)},obstacles:q,laneOffset:t%8},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:391,columnNumber:15},void 0)}),y&&E&&c.get(G(y))&&(()=>{const e=c.get(G(y)),t=j(e.x,e.y),o=j(E.x,E.y);return s.jsxDEV($,{x1:t.x,y1:t.y,x2:o.x,y2:o.y,obstacles:q},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:419,columnNumber:17},void 0)})()]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:379,columnNumber:9},void 0),s.jsxDEV("div",{className:"absolute inset-0 pointer-events-none z-10",children:e.modules.map(e=>s.jsxDEV(H,{module:e,isSelected:e.id===f,zoom:i.zoom,isConnected:K,isWiringSource:J,isPortHovered:Q,onModuleClick:M,onModuleDelete:X,onModuleDragStart:U,onModuleDrag:S,onModuleDragEnd:P,onPortClick:B,onPortHover:L,onParameterChange:O,registerPortPosition:p},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:434,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:432,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:371,columnNumber:7},void 0),0===e.modules.length&&s.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center text-text-muted pointer-events-none",children:s.jsxDEV("div",{className:"text-center",children:[s.jsxDEV("p",{className:"text-sm",children:'No modules yet. Click "Add Module" to get started.'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:460,columnNumber:13},void 0),s.jsxDEV("p",{className:"text-xs mt-2 opacity-50",children:"Middle-click to pan â€¢ Scroll to zoom â€¢ F to fit all"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:461,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:459,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:458,columnNumber:9},void 0),s.jsxDEV("div",{className:"absolute bottom-4 right-4 flex items-center gap-2 bg-dark-bgSecondary/90 backdrop-blur-md border border-dark-border p-1 rounded-lg shadow-xl z-50",children:[s.jsxDEV("div",{className:"px-2 text-[10px] font-mono text-text-secondary border-r border-dark-border mr-1",children:[Math.round(100*i.zoom),"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:470,columnNumber:9},void 0),s.jsxDEV("button",{onClick:Z,className:"p-1.5 hover:bg-dark-bgHover rounded text-text-secondary hover:text-text-primary transition-colors",title:"Zoom Out",children:s.jsxDEV(x,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:479,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:474,columnNumber:9},void 0),s.jsxDEV("button",{onClick:A,className:"p-1.5 hover:bg-dark-bgHover rounded text-text-secondary hover:text-text-primary transition-colors",title:"Zoom In",children:s.jsxDEV(v,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:487,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:482,columnNumber:9},void 0),s.jsxDEV("div",{className:"w-px h-4 bg-dark-border mx-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:490,columnNumber:9},void 0),s.jsxDEV("button",{onClick:_,className:"p-1.5 hover:bg-dark-bgHover rounded text-text-secondary hover:text-text-primary transition-colors",title:"Fit All Modules (F)",children:s.jsxDEV(b,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:497,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:492,columnNumber:9},void 0),s.jsxDEV("button",{onClick:Y,className:"p-1.5 hover:bg-dark-bgHover rounded text-text-secondary hover:text-text-primary transition-colors",title:"Reset View (0)",children:s.jsxDEV(N,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:505,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:500,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:469,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularCanvasView.tsx",lineNumber:361,columnNumber:5},void 0)},Z=({config:o,onChange:n})=>{const[i,l]=r.useState(null),{inputPorts:a,outputPorts:d}=r.useMemo(()=>{const s=[],t=[];return o.modules.forEach(o=>{const r=e.get(o.descriptorId);r&&r.ports.forEach(e=>{const n={moduleId:o.id,moduleName:o.label||r.name,portId:e.id,portName:e.name,signal:e.signal,color:Y(e.signal)};"input"===e.direction?s.push(n):t.push(n)})}),{inputPorts:s,outputPorts:t}},[o.modules]),m=r.useCallback((e,s)=>o.connections.find(t=>t.source.moduleId===s.moduleId&&t.source.portId===s.portId&&t.target.moduleId===e.moduleId&&t.target.portId===e.portId)||null,[o.connections]),u=r.useCallback((e,s)=>{const t=m(e,s);if(t){const e=o.connections.filter(e=>e.id!==t.id);n({...o,connections:e})}else{const t={id:`conn_${Date.now()}`,source:{moduleId:s.moduleId,portId:s.portId},target:{moduleId:e.moduleId,portId:e.portId},amount:1};n({...o,connections:[...o.connections,t]})}},[o,n,m]),c=r.useCallback((e,s)=>{const t=o.connections.map(t=>t.id===e.id?{...t,amount:s}:t);n({...o,connections:t})},[o,n]),p=r.useCallback((e,s,t)=>{const r=o.modules.map(o=>o.id===e?{...o,parameters:{...o.parameters,[s]:t}}:o);n({...o,modules:r})},[o,n]),x=r.useMemo(()=>i&&o.modules.find(e=>e.id===i)||null,[i,o.modules]),v=r.useMemo(()=>x&&e.get(x.descriptorId)||null,[x]);return s.jsxDEV("div",{className:"flex h-full bg-dark-bg overflow-hidden",children:[s.jsxDEV("div",{className:"flex-1 overflow-auto scrollbar-modern",children:[s.jsxDEV("table",{className:"w-full border-collapse text-xs",children:[s.jsxDEV("thead",{className:"sticky top-0 bg-dark-bgSecondary z-10",children:s.jsxDEV("tr",{children:[s.jsxDEV("th",{className:"border border-dark-border p-2 text-left min-w-[120px] text-text-primary",children:"Input \\ Output"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:144,columnNumber:15},void 0),d.map(e=>s.jsxDEV("th",{className:"border border-dark-border p-2 text-center min-w-[80px] max-w-[120px]",children:[s.jsxDEV("div",{className:"truncate text-text-secondary",children:e.moduleName},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:150,columnNumber:19},void 0),s.jsxDEV("div",{className:"truncate text-text-muted mt-1",style:{color:e.color},children:e.portName},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:151,columnNumber:19},void 0)]},`${e.moduleId}.${e.portId}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:146,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:143,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:142,columnNumber:11},void 0),s.jsxDEV("tbody",{children:a.map(e=>s.jsxDEV("tr",{className:"hover:bg-dark-bgHover/30 transition-colors",children:[s.jsxDEV("td",{className:"border border-dark-border p-2 sticky left-0 bg-dark-bgSecondary",children:[s.jsxDEV("div",{className:"truncate text-text-secondary",children:e.moduleName},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:165,columnNumber:19},void 0),s.jsxDEV("div",{className:"truncate text-text-muted mt-1",style:{color:e.color},children:e.portName},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:166,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:164,columnNumber:17},void 0),d.map(t=>{const o=m(e,t),r=!!o;return s.jsxDEV("td",{className:`\n                        border border-dark-border p-1 text-center cursor-pointer\n                        ${r?"bg-accent-primary/20":"bg-dark-bg"}\n                        hover:bg-accent-primary/30 transition-colors\n                      `,onClick:()=>u(e,t),children:r&&s.jsxDEV("div",{className:"flex items-center justify-center gap-1",children:[s.jsxDEV("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:186,columnNumber:27},void 0),("cv"===e.signal||"cv"===t.signal)&&o&&s.jsxDEV("input",{type:"range",min:"0",max:"1",step:"0.01",value:o.amount,onChange:e=>{e.stopPropagation(),c(o,parseFloat(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-12 h-1 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:192,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:185,columnNumber:25},void 0)},`${t.moduleId}.${t.portId}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:175,columnNumber:21},void 0)})]},`${e.moduleId}.${e.portId}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:163,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:161,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:141,columnNumber:9},void 0),0===o.modules.length&&s.jsxDEV("div",{className:"flex items-center justify-center h-full text-text-muted",children:s.jsxDEV("p",{className:"text-sm",children:'No modules yet. Click "Add Module" to get started.'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:219,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:218,columnNumber:11},void 0),o.modules.length>0&&0===a.length&&0===d.length&&s.jsxDEV("div",{className:"flex items-center justify-center h-full text-text-muted",children:s.jsxDEV("p",{className:"text-sm",children:"No ports available. Add modules with inputs/outputs."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:226,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:225,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:140,columnNumber:7},void 0),s.jsxDEV("div",{className:"w-64 border-l border-dark-border bg-dark-bgSecondary overflow-y-auto scrollbar-modern",children:s.jsxDEV("div",{className:"p-4",children:[s.jsxDEV("h3",{className:"text-sm font-medium text-text-primary mb-4",children:"Module Parameters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:234,columnNumber:11},void 0),s.jsxDEV("select",{value:i||"",onChange:e=>l(e.target.value||null),className:"w-full px-2 py-1.5 mb-4 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[s.jsxDEV("option",{value:"",className:"bg-dark-bgSecondary",children:"Select module..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:242,columnNumber:13},void 0),o.modules.map(t=>{const o=e.get(t.descriptorId);return s.jsxDEV("option",{value:t.id,className:"bg-dark-bgSecondary",children:t.label||o?.name||t.id},t.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:246,columnNumber:17},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:237,columnNumber:11},void 0),x&&v&&s.jsxDEV("div",{className:"space-y-4",children:[0===v.parameters.length&&s.jsxDEV("p",{className:"text-xs text-text-muted",children:"No parameters available."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:257,columnNumber:17},void 0),v.parameters.map(e=>s.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[s.jsxDEV(t,{value:x.parameters[e.id]??e.default,min:e.min,max:e.max,onChange:s=>p(x.id,e.id,s),size:"sm",label:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:262,columnNumber:19},void 0),s.jsxDEV("div",{className:"text-xs text-text-muted",children:[(x.parameters[e.id]??e.default).toFixed(2),e.unit&&` ${e.unit}`]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:270,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:261,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:255,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:233,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:232,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/views/ModularMatrixView.tsx",lineNumber:138,columnNumber:5},void 0)};function Y(e){switch(e){case"audio":return"#10b981";case"cv":return"#eab308";case"gate":return"#ef4444";case"trigger":return"#3b82f6";default:return"#6b7280"}}o();const _=({config:e,onChange:t})=>{const o=e.modularSynth||l,n=r.useCallback(s=>{t({...e,modularSynth:s})},[e,t]);return s.jsxDEV("div",{className:"flex flex-col h-full bg-dark-bg",children:[s.jsxDEV(O,{config:o,onChange:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:42,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex-1 overflow-hidden",children:["rack"===o.viewMode&&s.jsxDEV(T,{config:o,onChange:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:47,columnNumber:11},void 0),"canvas"===o.viewMode&&s.jsxDEV(A,{config:o,onChange:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:51,columnNumber:11},void 0),"matrix"===o.viewMode&&s.jsxDEV(Z,{config:o,onChange:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:55,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:45,columnNumber:7},void 0),s.jsxDEV("div",{className:"flex items-center gap-4 px-4 py-1.5 bg-dark-bgSecondary border-t border-dark-border text-xs text-text-muted",children:[s.jsxDEV("span",{children:["Modules: ",o.modules.length]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:61,columnNumber:9},void 0),s.jsxDEV("span",{children:["Connections: ",o.connections.length]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:62,columnNumber:9},void 0),s.jsxDEV("span",{children:["Polyphony: ",o.polyphony]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:63,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:60,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/synths/modular/ModularSynthEditor.tsx",lineNumber:40,columnNumber:5},void 0)};export{_ as ModularSynthControls};
