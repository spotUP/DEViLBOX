import{aB as e}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";const t=3546895,n=[0,13696,12928,12192,11520,10848,10240,9664,9120,8608,8128,7680,7248,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3624,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1812,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];function o(e,t){return e[t]}function r(e,t){return e[t]<<8|e[t+1]}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function l(e){return e<128?e:e-256}function a(e,t,n){let o="";for(let r=0;r<n;r++){const n=e[t+r];if(0===n)break;o+=String.fromCharCode(n)}return o.trim()}function f(e){return e<=0||e>=n.length?0:Math.min(96,e+12)}function i(e){return!(e.length<204)&&(73===e[0]&&83===e[1]&&77===e[2]&&33===e[3]&&86===e[4]&&49===e[5]&&46===e[6]&&50===e[7])}function u(n,u){if(!i(n))return null;let p=8;const g=r(n,p);p+=2;const d=r(n,p);p+=2,p+=4;const y=o(n,p++),v=o(n,p++),T=o(n,p++),w=o(n,p++),b=o(n,p++),S=o(n,p++);p+=14;const M=a(n,p,28);p+=28,p+=140;const P=[];for(let e=0;e<y;e++){if(p+28>n.length)return null;p+=1;const e=a(n,p,23);p+=23,p+=4,P.push({name:e,length:0})}for(let e=0;e<y;e++){if(p+4>n.length)return null;P[e].length=s(n,p),p+=4}p+=128*b,p+=256*S;const C=[];for(let e=0;e<T;e++){if(p+28>n.length)return null;const e=o(n,p++),t=0!==o(n,p++),s=r(n,p);p+=2;const a=r(n,p);p+=2;const f=o(n,p++),i=l(n[p++]),u=0!==o(n,p++),h=o(n,p++),c=r(n,p);p+=2,p+=2;const m=0!==o(n,p++);p+=5;const g=o(n,p++),d=o(n,p++),y=o(n,p++),v=o(n,p++),T=o(n,p++),w=o(n,p++),b=r(n,p);p+=2,C.push({waveformNumber:e,synthesisEnabled:t,waveformLength:s,repeatLength:a,volume:f,portamentoSpeed:i,adsrEnabled:u,adsrTableNumber:h,adsrTableLength:c,portamentoEnabled:m,vibratoDelay:g,vibratoSpeed:d,vibratoLevel:y,egcOffset:v,egcMode:T,egcTableNumber:w,egcTableLength:b})}p+=256;const L=[];for(let e=0;e<w;e++){if(p+14>n.length)return null;p+=4;const e=o(n,p++),t=o(n,p++),s=r(n,p);p+=2;const l=r(n,p);p+=2;const a=r(n,p);p+=2,p+=2,L.push({startSpeed:e,rowsPerTrack:t,firstPosition:s,lastPosition:l,restartPosition:a})}p+=14;const $=[];for(let e=0;e<v&&!(p+256>n.length);e++){const e=new Int8Array(256);for(let t=0;t<256;t++)e[t]=l(n[p+t]);$.push(e),p+=256}const A=[];for(let e=0;e<g&&!(p+16>n.length);e++){const e=[];for(let t=0;t<4;t++){const t=r(n,p);p+=2;const o=l(n[p++]),s=l(n[p++]);e.push({startTrackRow:t,soundTranspose:o,noteTranspose:s})}A.push(e)}const I=d+64,x=[];for(let e=0;e<I;e++){if(p+4>n.length){x.push({note:0,instrument:0,arpeggio:0,effect:0,effectArg:0});continue}const e=n[p++],t=n[p++],o=n[p++],r=n[p++];x.push({note:e,instrument:t,arpeggio:(240&o)>>4,effect:15&o,effectArg:r})}const N=[];for(let e=0;e<y;e++){const t=P[e].length;if(t>0&&p+t<=n.length){const e=new Uint8Array(t);for(let o=0;o<t;o++)e[o]=n[p+o];N.push(e),p+=t}else N.push(null)}const j=Math.round(t/428),k=Math.round(t/1712),E=[];for(let t=0;t<C.length;t++){const n=C[t],o=t+1;if(n.synthesisEnabled){const r=n.waveformNumber<$.length?n.waveformNumber:0;if($.length>0&&r<$.length){const s=$[r],l=Math.min(Math.max(2,n.waveformLength),256),a=new Uint8Array(l);for(let e=0;e<l;e++)a[e]=255&s[e%256];E.push(e(o,`Synth ${t}`,a,n.volume,k,0,l))}else E.push(c(o,`Synth ${t}`))}else{const r=63&n.waveformNumber,s=r<N.length?N[r]:null;if(s&&s.length>0){let l=0,a=0;2!==n.repeatLength&&(0===n.repeatLength?(l=0,a=s.length):(l=n.waveformLength,a=n.waveformLength+n.repeatLength)),E.push(e(o,P[r]?.name||`Sample ${t}`,s,n.volume,j,l,a))}else E.push(c(o,`Sample ${t}`))}}if(0===L.length)return null;const F=L[0],D=Math.max(1,F.rowsPerTrack),O=F.firstPosition,B=F.lastPosition,R=[];for(let e=O;e<=B&&!(e>=A.length);e++){const t=A[e],n=[[],[],[],[]];for(let e=0;e<D;e++)for(let o=0;o<4;o++){const r=t[o],s=r.startTrackRow+e,l=s<x.length?x[s]:null;if(!l||0===l.note){n[o].push(h());continue}if(127===l.note){n[o].push({note:97,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});continue}const a=Math.max(1,Math.min(108,l.note+r.noteTranspose)),i=l.instrument>0?Math.max(1,Math.min(255,l.instrument+r.soundTranspose)):0,u=f(a),c=i>0&&i<=C.length?i:0,{effTyp:p,eff:g}=m(l.effect,l.effectArg);n[o].push({note:u,instrument:c,volume:0,effTyp:p,eff:g,effTyp2:0,eff2:0})}const o=e-O;R.push({id:`pattern-${o}`,name:`Position ${o}`,length:D,channels:n.map((e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===t||3===t?-50:50,instrumentId:null,color:null,rows:e})),importMetadata:{sourceFormat:"IS10",sourceFile:u,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:A.length,originalInstrumentCount:C.length}})}0===R.length&&R.push(function(e,t,n){return{id:"pattern-0",name:"Pattern 0",length:n,channels:Array.from({length:t},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:Array.from({length:n},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}))})),importMetadata:{sourceFormat:"IS10",sourceFile:e,importedAt:(new Date).toISOString(),originalChannelCount:t,originalPatternCount:0,originalInstrumentCount:0}}}(u,4,D));return{name:M||u.replace(/\.[^/.]+$/,""),format:"IS10",patterns:R,instruments:E,songPositions:R.map((e,t)=>t),songLength:R.length,restartPosition:0,numChannels:4,initialSpeed:Math.max(1,F.startSpeed),initialBPM:125,linearPeriods:!1}}function h(){return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}}function c(e,t){return{id:e,name:t,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0}}function m(e,t){switch(e){case 7:return{effTyp:12,eff:Math.min(64,63&t)};case 15:return t>0&&t<=31?{effTyp:15,eff:t}:{effTyp:0,eff:0};default:return{effTyp:0,eff:0}}}export{i as isInStereo1Format,u as parseInStereo1File};
