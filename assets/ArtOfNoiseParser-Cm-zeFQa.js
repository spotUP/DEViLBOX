import{aB as e}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";const n=[[3434,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1812,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[3400,3208,3028,2860,2696,2548,2404,2268,2140,2020,1908,1800,1700,1604,1514,1430,1348,1274,1202,1134,1070,1010,954,900,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[3376,3184,3008,2836,2680,2528,2388,2252,2128,2008,1896,1788,1688,1592,1504,1418,1340,1264,1194,1126,1064,1004,948,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[3352,3164,2984,2816,2660,2512,2368,2236,2112,1992,1880,1776,1676,1582,1492,1408,1330,1256,1184,1118,1056,996,940,888,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[3328,3140,2964,2796,2640,2492,2352,2220,2096,1980,1868,1764,1664,1570,1482,1398,1320,1246,1176,1110,1048,990,934,882,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[3304,3116,2944,2776,2620,2476,2336,2204,2080,1964,1852,1748,1652,1558,1472,1388,1310,1238,1168,1102,1040,982,926,874,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[3280,3096,2920,2756,2604,2456,2320,2188,2064,1948,1840,1736,1640,1548,1460,1378,1302,1228,1160,1094,1032,974,920,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[3256,3072,2900,2736,2584,2440,2300,2172,2052,1936,1828,1724,1628,1536,1450,1368,1292,1220,1150,1086,1026,968,914,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[3628,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1814,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[3600,3400,3208,3028,2860,2700,2544,2404,2268,2140,2020,1908,1800,1700,1604,1514,1430,1350,1272,1202,1134,1070,1010,954,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[3576,3376,3184,3008,2836,2680,2528,2388,2252,2128,2008,1896,1788,1688,1592,1504,1418,1340,1264,1194,1126,1064,1004,948,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[3548,3352,3164,2984,2816,2660,2512,2368,2236,2112,1992,1880,1774,1676,1582,1492,1408,1330,1256,1184,1118,1056,996,940,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[3524,3328,3140,2964,2796,2640,2492,2352,2220,2096,1976,1868,1762,1664,1570,1482,1398,1320,1246,1176,1110,1048,988,934,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[3500,3304,3116,2944,2776,2620,2476,2336,2204,2080,1964,1852,1750,1652,1558,1472,1388,1310,1238,1168,1102,1040,982,926,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[3472,3280,3096,2920,2756,2604,2456,2320,2188,2064,1948,1840,1736,1640,1548,1460,1378,1302,1228,1160,1094,1032,974,920,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[3448,3256,3072,2900,2736,2584,2440,2300,2172,2052,1936,1828,1724,1628,1536,1450,1368,1292,1220,1150,1086,1026,968,914,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]];function t(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function o(e){return e<128?e:e-256}function r(e,n){return String.fromCharCode(e[n],e[n+1],e[n+2],e[n+3])}function l(e,n,t){let o=n;for(;o<n+t&&0!==e[o];)o++;let r="";for(let l=n;l<o;l++){const n=e[l];r+=n>=32?String.fromCharCode(n):""}return r}function a(e,n){if(0===e)return 0;const t=e-1-24+37;return Math.max(1,Math.min(96,t))}function s(e){return Math.round(3546895/(2*e))}function u(e){if(e.length<54)return!1;const n=r(e,0);return"AON4"===n||"AON8"===n}function i(i,c){if(!u(i))return null;const h="AON8"===r(i,0)?8:4;let p=46,m="",g=0,v=0,d=null,b=null,y=null,k=null,w=null;for(;p+8<=i.length;){const e=r(i,p),n=t(i,p+4);if(p+=8,p>i.length)break;const a=p+n;if(a>i.length)break;switch(e){case"NAME":m=l(i,p,n);break;case"AUTH":case"RMRK":break;case"INFO":if(n<3)break;g=i[p+1],v=i[p+2],v>=g&&(v=0);break;case"ARPG":d=[];for(let e=0;e<16;e++){const n=[];for(let t=0;t<4;t++)n.push(i[p+4*e+t]);d.push(n)}break;case"PLST":b=[];for(let e=0;e<n;e++)b.push(i[p+e]);break;case"PATT":{const e=Math.floor(n/(4*h*64));y=[];let t=p;for(let n=0;n<e;n++){const e=[];for(let n=0;n<64;n++){const n=[];for(let e=0;e<h;e++){const e=i[t],o=i[t+1],r=i[t+2],l=i[t+3];t+=4,n.push({instrument:63&o,note:63&e,arpeggio:(192&r)>>4|(192&o)>>6,effect:63&r,effectArg:l})}e.push(n)}y.push({rows:e})}break}case"INST":{const e=Math.floor(n/32);k=[];let o=p;for(let n=0;n<e;n++){const e=i[o],n=i[o+1],r=i[o+2],l=i[o+3];let a;if(o+=4,0===e){const e=t(i,o),s=t(i,o+4),u=t(i,o+8),f=t(i,o+12);o+=20;const c=i[o],h=i[o+1],p=i[o+2],m=i[o+3];o+=4,a={type:"sample",name:"",volume:n,fineTune:r,waveForm:l,startOffset:e,length:s,loopStart:u,loopLength:f,envelopeStart:c,envelopeAdd:h,envelopeEnd:p,envelopeSub:m}}else{if(1!==e){o+=28;continue}{const e=i[o];o+=1,o+=5;const t=i[o],s=i[o+1],u=i[o+2],f=i[o+3],c=i[o+4],h=i[o+5],p=i[o+6],m=i[o+7];o+=8,o+=10;const g=i[o],v=i[o+1],d=i[o+2],b=i[o+3];o+=4,a={type:"synth",name:"",volume:n,fineTune:r,waveForm:l,length:e,vibParam:t,vibDelay:s,vibWave:u,waveSpeed:f,waveLength:c,waveLoopStart:h,waveLoopLength:p,waveLoopControl:m,envelopeStart:g,envelopeAdd:v,envelopeEnd:d,envelopeSub:b}}}k.push(a)}break}case"INAM":if(k){let e=p;for(let n=0;n<k.length&&e+32<=a;n++)k[n].name=l(i,e,32),e+=32}break;case"WLEN":{const e=Math.floor(n/4);w=[];let o=p;for(let n=0;n<e;n++){const e=t(i,o);o+=4,w.push(e>0?new Int8Array(e):new Int8Array(0))}break}case"WAVE":if(w){let e=p;for(let n=0;n<w.length;n++){const t=w[n];if(t.length>0)for(let n=0;n<t.length&&e<a;n++)t[n]=o(i[e++])}}}p=a}if(!(0!==g&&d&&b&&y&&k&&w))return null;const A=function(e,n){let o=46;for(;o+8<=e.length;){const a=r(e,o),s=t(e,o+4);if(o+=8,o+s>e.length)break;if("INST"===a){const a=Math.min(n,Math.floor(s/32)),u=[];let i=o;for(let n=0;n<a;n++){const n=i,o=e[i],r=e[i+1],l=e[i+2],a=e[i+3];i+=4;let s=null;if(0===o){const n=t(e,i),o=t(e,i+4),u=t(e,i+8),f=t(e,i+12);i+=16,i+=8;const c=e[i],h=e[i+1],p=e[i+2],m=e[i+3];i+=4,s={type:"sample",name:"",volume:r,fineTune:l,waveForm:a,startOffset:n,length:o,loopStart:u,loopLength:f,envelopeStart:c,envelopeAdd:h,envelopeEnd:p,envelopeSub:m}}else if(1===o){const n=e[i];i+=1,i+=5;const t=e[i],o=e[i+1],u=e[i+2],f=e[i+3],c=e[i+4],h=e[i+5],p=e[i+6],m=e[i+7];i+=8,i+=10;const g=e[i],v=e[i+1],d=e[i+2],b=e[i+3];i+=4,s={type:"synth",name:"",volume:r,fineTune:l,waveForm:a,length:n,vibParam:t,vibDelay:o,vibWave:u,waveSpeed:f,waveLength:c,waveLoopStart:h,waveLoopLength:p,waveLoopControl:m,envelopeStart:g,envelopeAdd:v,envelopeEnd:d,envelopeSub:b}}32!==i-n&&(i=n+32),s&&u.push(s)}let f=46;for(;f+8<=e.length;){const n=r(e,f),o=t(e,f+4);if(f+=8,"INAM"===n){for(let n=0;n<u.length&&f+32<=f+o;n++)u[n].name=l(e,f+32*n,32);break}if(f+=o,f>e.length)break}return u}o+=s}return null}(i,k.length),S=null!==A?A:k,T=[];for(let t=0;t<S.length;t++){const o=S[t],r=t+1;if("sample"===o.type&&w){const l=o,a=l.waveForm,u=a<w.length?w[a]:null;if(u&&u.length>0&&l.length>0){const a=2*l.startOffset,i=2*l.length,f=2*l.loopStart,c=2*l.loopLength,h=Math.min(a+i,u.length),p=Math.max(0,h-a),m=new Uint8Array(p);for(let e=0;e<p;e++)m[e]=255&(e+a<u.length?u[e+a]:0);const g=l.fineTune<16?l.fineTune:0,v=s(n[g][24]),d=c>1,b=d?f:0,y=d?f+c:0;T.push(e(r,o.name||`Sample ${t}`,m,l.volume,v,b,y))}else T.push(f(r,o.name||`Instrument ${t}`))}else if("synth"===o.type&&w){const l=o,a=l.waveForm,u=a<w.length?w[a]:null;if(u&&u.length>0){const a=2*l.length,i=Math.max(1,Math.min(a,u.length)),f=new Uint8Array(i);for(let e=0;e<i;e++)f[e]=255&u[e%u.length];const c=l.fineTune<16?l.fineTune:0,h=s(n[c][24]);T.push(e(r,o.name||`Synth ${t}`,f,l.volume,h,0,i))}else T.push(f(r,o.name||`Instrument ${t}`))}else T.push(f(r,o.name||`Instrument ${t}`))}const M=[];for(let e=0;e<g;e++){const n=b[e],t=n<y.length?y[n]:null,o=Array.from({length:h},()=>[]);for(let e=0;e<64;e++)for(let n=0;n<h;n++){const r=t?t.rows[e][n]:null;if(!r){o[n].push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});continue}const l=r.instrument>0?r.instrument:0;l>0&&l-1<S.length&&S[l-1].fineTune;const s=a(r.note);let u=0,i=0;const f=r.effectArg;switch(r.effect){case 0:break;case 1:u=1,i=f;break;case 2:u=2,i=f;break;case 3:u=3,i=f;break;case 4:u=4,i=f;break;case 5:u=5,i=f;break;case 6:u=6,i=f;break;case 9:u=9,i=f;break;case 10:u=10,i=f;break;case 11:u=11,i=f;break;case 12:u=12,i=Math.min(64,f);break;case 13:u=13,i=f;break;case 14:u=14,i=f;break;case 15:u=15,i=f}o[n].push({note:s,instrument:l,volume:0,effTyp:u,eff:i,effTyp2:0,eff2:0})}M.push({id:`pattern-${e}`,name:`Position ${e}`,length:64,channels:o.map((e,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:8===h?[-50,-50,50,50,50,50,-50,-50][n]??0:[-50,50,50,-50][n]??0,instrumentId:null,color:null,rows:e})),importMetadata:{sourceFormat:"AON",sourceFile:c,importedAt:(new Date).toISOString(),originalChannelCount:h,originalPatternCount:y.length,originalInstrumentCount:S.length}})}0===M.length&&M.push(function(e,n,t){return{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:n},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:8===n?[-50,-50,50,50,50,50,-50,-50][t]??0:[-50,50,50,-50][t]??0,instrumentId:null,color:null,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}))})),importMetadata:{sourceFormat:"AON",sourceFile:e,importedAt:(new Date).toISOString(),originalChannelCount:n,originalPatternCount:0,originalInstrumentCount:t}}}(c,h,S.length));return{name:(m||c).replace(/\.[^/.]+$/,""),format:"AON",patterns:M,instruments:T,songPositions:M.map((e,n)=>n),songLength:M.length,restartPosition:v,numChannels:h,initialSpeed:6,initialBPM:125,linearPeriods:!1}}function f(e,n){return{id:e,name:n.replace(/\0/g,"").trim()||`Instrument ${e}`,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0}}export{u as isArtOfNoiseFormat,i as parseArtOfNoiseFile};
