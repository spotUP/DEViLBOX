import{aF as e,aG as t,u as n,j as r,aH as s,aI as a}from"./index-DWtmwK1e.js";import{r as i}from"./vendor-utils-Cm-70yv0.js";import{u as o,a as l,D as d,c,S as x,v as m,P as p,b as u,C as b}from"./sortable.esm-DeI3I-SF.js";import{b5 as h,ai as g,k as j,T as v,aj as f,a6 as y,a7 as k,D as C,X as N,m as P,a4 as w,b4 as E,e as S,b9 as z}from"./vendor-ui-CuKercQz.js";import"./vendor-react-LeNVipsj.js";import"./vendor-tone-C_GMrdAr.js";const D=({isOpen:e,currentName:t,onConfirm:n,onClose:s})=>{const[o,l]=i.useState(t),d=i.useRef(null);i.useEffect(()=>{e&&(l(t),setTimeout(()=>d.current?.select(),0))},[e,t]);return e?a.createPortal(r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:s,children:r.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Pattern"}),r.jsx("button",{onClick:s,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:r.jsx(N,{size:14})})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&o!==t&&n(o.trim()),s()},children:[r.jsx("input",{ref:d,type:"text",value:o,onChange:e=>l(e.target.value),onKeyDown:e=>{"Escape"===e.key&&s()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter pattern name",autoFocus:!0}),r.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[r.jsx("button",{type:"button",onClick:s,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:!o.trim()||o===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})]})]})]})}),document.body):null},L=({isOpen:e,title:t,message:n,confirmLabel:s="Confirm",danger:o=!1,onConfirm:l,onClose:d})=>{const c=i.useCallback(e=>{"Escape"===e.key?d():"Enter"===e.key&&(l(),d())},[d,l]);return i.useEffect(()=>{if(e)return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[e,c]),e?a.createPortal(r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:d,children:r.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:t}),r.jsx("button",{onClick:d,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:r.jsx(N,{size:14})})]}),r.jsx("p",{className:"text-sm text-text-secondary mb-4",children:n}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:d,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),r.jsx("button",{onClick:()=>{l(),d()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(o?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:s})]})]})}),document.body):null},R=({patternIndex:a,children:o})=>{const{position:l,open:d,close:c,isOpen:x}=e(),{isLiveMode:m,queuePattern:p,pendingPatternIndex:u}=t(),{patterns:b,currentPatternIndex:N,setCurrentPattern:P,duplicatePattern:w,deletePattern:E,expandPattern:S,shrinkPattern:z,resizePattern:R,updatePatternName:T}=n(),[I,A]=i.useState(!1),[O,Q]=i.useState(!1),U=b[a],$=u===a,M=N===a,F=b.length>1,K=i.useCallback(e=>{T?.(a,e)},[a,T]),q=i.useCallback(()=>{E(a)},[a,E]),B=i.useCallback(e=>{R?.(a,e)},[a,R]),G=i.useMemo(()=>{const e=[];return m&&e.push({id:"queue",label:$?"Cancel Queue":"Queue Pattern",icon:r.jsx(h,{size:14}),onClick:()=>{$?t.getState().clearQueue():p(a)}}),e.push({id:"edit",label:"Edit Pattern",icon:r.jsx(g,{size:14}),disabled:M,onClick:()=>P(a)}),e.push({type:"divider"}),e.push({id:"duplicate",label:"Duplicate",icon:r.jsx(j,{size:14}),onClick:()=>w(a)}),e.push({id:"delete",label:"Delete",icon:r.jsx(v,{size:14}),danger:!0,disabled:!F,onClick:()=>Q(!0)}),e.push({type:"divider"}),e.push({id:"rename",label:"Rename",icon:r.jsx(f,{size:14}),onClick:()=>A(!0)}),e.push({id:"length",label:"Set Length",icon:r.jsx(y,{size:14}),submenu:[{id:"length-16",label:"16 rows",checked:16===U?.length,onClick:()=>B(16)},{id:"length-32",label:"32 rows",checked:32===U?.length,onClick:()=>B(32)},{id:"length-64",label:"64 rows",checked:64===U?.length,onClick:()=>B(64)},{id:"length-128",label:"128 rows",checked:128===U?.length,onClick:()=>B(128)}]}),e.push({id:"expand",label:"Expand (2x)",icon:r.jsx(y,{size:14}),onClick:()=>S?.(a)}),e.push({id:"shrink",label:"Shrink (1/2)",icon:r.jsx(k,{size:14}),onClick:()=>z?.(a)}),e.push({type:"divider"}),e.push({id:"export",label:"Export Pattern",icon:r.jsx(C,{size:14}),onClick:()=>{const e=JSON.stringify(U,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${U?.name||"pattern"}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}}),e},[m,$,M,F,a,U,p,P,w,S,z,B]);return r.jsxs("div",{onContextMenu:d,children:[o,x&&r.jsx(s,{items:G,position:l,onClose:c}),r.jsx(D,{isOpen:I,currentName:U?.name||"",onConfirm:K,onClose:()=>A(!1)}),r.jsx(L,{isOpen:O,title:"Delete Pattern",message:`Delete pattern "${U?.name}"? This cannot be undone.`,confirmLabel:"Delete",danger:!0,onConfirm:q,onClose:()=>Q(!1)})]})},T=({pattern:e,index:t,isActive:n,isQueued:s,isEditing:a,editName:i,onSelect:o,onStartEdit:l,onSaveEdit:d,onCancelEdit:c,onEditNameChange:x,onClone:m,onDelete:p})=>{const{attributes:h,listeners:g,setNodeRef:f,transform:y,transition:k,isDragging:C}=u({id:e.id}),P={transform:b.Transform.toString(y),transition:k,opacity:C?.5:1};return r.jsx(R,{patternIndex:t,children:r.jsxs("div",{ref:f,style:P,className:`\n          flex items-center gap-2 px-3 py-2 border-b border-dark-border\n          ${n?"bg-accent-primary text-text-inverse":"bg-dark-bg text-text-primary hover:bg-dark-bgHover"}\n          ${s?"ring-2 ring-orange-500 ring-inset animate-pulse":""}\n          transition-colors cursor-pointer\n        `,children:[r.jsx("div",{...h,...g,className:"cursor-grab active:cursor-grabbing "+(n?"text-text-inverse/70":"text-text-muted hover:text-text-primary"),children:r.jsx(E,{size:14})}),r.jsx("div",{onClick:o,className:"flex-shrink-0 w-6 text-xs font-mono font-bold text-center",children:t.toString().padStart(2,"0")}),a?r.jsxs("div",{className:"flex-1 flex items-center gap-1",children:[r.jsx("input",{type:"text",value:i,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&d(),"Escape"===e.key&&c()},className:"flex-1 px-2 py-0.5 text-xs font-mono bg-dark-bg border border-accent-primary text-text-primary rounded focus:outline-none",autoFocus:!0,onClick:e=>e.stopPropagation()}),r.jsx("button",{onClick:e=>{e.stopPropagation(),d()},className:"p-0.5 hover:text-accent-success",title:"Save",children:r.jsx(S,{size:12})}),r.jsx("button",{onClick:e=>{e.stopPropagation(),c()},className:"p-0.5 hover:text-accent-error",title:"Cancel",children:r.jsx(N,{size:12})})]}):r.jsx("div",{onClick:o,className:"flex-1 text-xs font-mono truncate",children:e.name}),r.jsx("div",{onClick:o,className:"flex-shrink-0 text-xs font-mono "+(n?"text-text-inverse/70":"text-text-muted"),children:e.length}),!a&&r.jsxs("div",{className:"flex items-center gap-1",children:[s&&r.jsx("span",{className:"text-orange-500 text-xs mr-1",title:"Queued",children:"â³"}),r.jsx("button",{onClick:e=>{e.stopPropagation(),l()},className:"p-0.5 "+(n?"hover:text-text-inverse":"hover:text-accent-primary"),title:"Rename",children:r.jsx(z,{size:12})}),r.jsx("button",{onClick:e=>{e.stopPropagation(),m()},className:"p-0.5 "+(n?"hover:text-text-inverse":"hover:text-accent-primary"),title:"Clone",children:r.jsx(j,{size:12})}),r.jsx("button",{onClick:e=>{e.stopPropagation(),p()},className:"p-0.5 hover:text-accent-error",title:"Delete",children:r.jsx(v,{size:12})})]})]})})},I=()=>{const{patterns:e,currentPatternIndex:s,setCurrentPattern:a,addPattern:u,deletePattern:b,clonePattern:h,resizePattern:g,reorderPatterns:j,updatePatternName:v}=n(),{pendingPatternIndex:f}=t(),[y,k]=i.useState(null),[C,N]=i.useState(""),[E,S]=i.useState(64),[z,D]=i.useState(null),L=o(l(p,{activationConstraint:{distance:8}})),R=()=>{null!==y&&C.trim()&&v(y,C.trim()),k(null),N("")},I=()=>{k(null),N("")};return r.jsxs("div",{className:"flex flex-col h-full bg-dark-bg border-l border-dark-border",children:[r.jsx("div",{className:"bg-dark-bgTertiary border-b border-dark-border px-4 py-3",children:r.jsx("div",{className:"font-mono text-sm text-text-primary font-semibold tracking-wide",children:"PATTERN MANAGER"})}),r.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("label",{className:"text-xs font-mono text-text-secondary",children:"Size:"}),r.jsxs("select",{value:E,onChange:e=>S(Number(e.target.value)),className:"flex-1 input text-xs font-mono",children:[r.jsx("option",{value:16,children:"16 rows"}),r.jsx("option",{value:32,children:"32 rows"}),r.jsx("option",{value:64,children:"64 rows"}),r.jsx("option",{value:128,children:"128 rows"})]})]}),r.jsxs("button",{onClick:()=>{u(E)},className:"w-full btn-primary flex items-center justify-center gap-2 py-2.5",children:[r.jsx(P,{size:16}),r.jsx("span",{className:"font-semibold",children:"Add Pattern"})]})]}),r.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:[r.jsx("div",{className:"text-xs font-mono text-text-muted mb-2",children:"Current Pattern"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-mono text-accent-primary font-bold",children:e[s]?.name||"None"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs font-mono text-text-muted",children:"Resize:"}),r.jsxs("select",{value:e[s]?.length||64,onChange:e=>{return t=s,n=Number(e.target.value),void g(t,n);var t,n},className:"input px-2 py-1 text-xs font-mono",children:[r.jsx("option",{value:16,children:"16"}),r.jsx("option",{value:32,children:"32"}),r.jsx("option",{value:64,children:"64"}),r.jsx("option",{value:128,children:"128"})]})]})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:r.jsx(d,{sensors:L,collisionDetection:c,onDragEnd:t=>{const{active:n,over:r}=t;if(r&&n.id!==r.id){const t=e.findIndex(e=>e.id===n.id),s=e.findIndex(e=>e.id===r.id);j(t,s)}},children:r.jsx(x,{items:e.map(e=>e.id),strategy:m,children:e.map((t,n)=>r.jsx(T,{pattern:t,index:n,isActive:n===s,isQueued:f===n,isEditing:y===n,editName:C,onSelect:()=>a(n),onStartEdit:()=>(t=>{k(t),N(e[t].name)})(n),onSaveEdit:R,onCancelEdit:I,onEditNameChange:N,onClone:()=>(e=>{h(e)})(n),onDelete:()=>(t=>{1!==e.length?z===t?(b(t),D(null)):(D(t),setTimeout(()=>D(null),3e3)):alert("Cannot delete the last pattern")})(n)},t.id))})})}),r.jsxs("div",{className:"bg-dark-bgSecondary border-t border-dark-border p-4",children:[r.jsx("div",{className:"text-xs font-mono text-text-muted mb-3",children:"PLAYBACK SEQUENCE"}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.map((e,t)=>r.jsx("div",{className:`\n                px-2.5 py-1.5 text-xs font-mono rounded-md border transition-all\n                ${t===s?"bg-accent-primary text-text-inverse border-accent-primary glow-sm":"bg-dark-bg text-text-primary border-dark-border hover:border-dark-borderLight"}\n                cursor-pointer\n              `,onClick:()=>a(t),title:e.name,children:t.toString().padStart(2,"0")},e.id))}),r.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs font-mono text-text-muted",children:[r.jsx(w,{size:12}),r.jsx("span",{children:"Drag patterns to reorder playback"})]})]}),null!==z&&r.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-accent-error text-white px-4 py-2 rounded-lg shadow-lg font-mono text-xs animate-fade-in",children:"Click DELETE again to confirm"})]})};export{I as PatternManagement};
