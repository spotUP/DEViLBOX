const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BuzzmachineSynth-CjI0uLt_.js","assets/vendor-tone-C_GMrdAr.js","assets/vendor-utils-Cm-70yv0.js","assets/vendor-react-LeNVipsj.js","assets/vendor-ui-CuKercQz.js","assets/HelpModal-Ds6ippU1.js","assets/ExportDialog-DzKQkHPU.js","assets/EditInstrumentModal-Ca4JjPkb.js","assets/sortable.esm-DeI3I-SF.js","assets/index-CCgYOEo1.js","assets/TD3PatternDialog-CMFEggM-.js","assets/DrumpadEditorModal-cNxoSLd5.js","assets/TipOfTheDay-CXMJTuSK.js","assets/PatternManagement-CS7XqpRQ.js","assets/SamplePackBrowser-DSApFmEk.js"])))=>i.map(i=>d[i]);
import{R as e,p as t,a as n,c as a,r as s,b as r,e as o}from"./vendor-utils-Cm-70yv0.js";import{r as i,a as l,g as c,b as d}from"./vendor-react-LeNVipsj.js";import{T as u,G as p,W as h,C as m,P as f,F as y,a as g,c as v,b,n as x,d as w,L as k,E as S,O as M,e as N,f as C,D as E,R as P,g as T,h as A,i as I,M as _,j as O,k as F,l as D,m as R,o as j,V as L,S as B,p as V,N as z,A as U,q as G,r as K,J as H,s as W,t as $,u as q,v as Y,B as X,w as Q,x as Z,y as J,z as ee,H as te,I as ne,K as ae,Q as se,U as re,X as oe,Y as ie,Z as le,_ as ce,$ as de,a0 as ue,a1 as pe,a2 as he,a3 as me,a4 as fe,a5 as ye,a6 as ge,a7 as ve,a8 as be,a9 as xe,aa as we,ab as ke,ac as Se,ad as Me,ae as Ne}from"./vendor-tone-C_GMrdAr.js";import{C as Ce,U as Ee,a as Pe,X as Te,R as Ae,S as Ie,M as _e,Z as Oe,b as Fe,c as De,d as Re,e as je,T as Le,f as Be,L as Ve,g as ze,A as Ue,h as Ge,D as Ke,E as He,i as We,j as $e,k as qe,l as Ye,P as Xe,m as Qe,n as Ze,o as Je,p as et,V as tt,q as nt,H as at,W as st,r as rt,s as ot,t as it,u as lt,v as ct,w as dt,x as ut,y as pt,z as ht,B as mt,F as ft,G as yt,I as gt,J as vt,K as bt,N as xt,O as wt,Q as kt,Y as St,_ as Mt,$ as Nt,a0 as Ct,a1 as Et,a2 as Pt,a3 as Tt,a4 as At,a5 as It,a6 as _t,a7 as Ot,a8 as Ft,a9 as Dt,aa as Rt,ab as jt,ac as Lt,ad as Bt,ae as Vt,af as zt,ag as Ut,ah as Gt,ai as Kt,aj as Ht,ak as Wt,al as $t,am as qt,an as Yt,ao as Xt,ap as Qt,aq as Zt,ar as Jt,as as en,at as tn,au as nn,av as an,aw as sn,ax as rn,ay as on,az as ln,aA as cn,aB as dn}from"./vendor-ui-CuKercQz.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var un,pn,hn={exports:{}},mn={};var fn,yn,gn,vn,bn=(pn||(pn=1,hn.exports=function(){if(un)return mn;un=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(t,n,a){var s=null;if(void 0!==a&&(s=""+a),void 0!==n.key&&(s=""+n.key),"key"in n)for(var r in a={},n)"key"!==r&&(a[r]=n[r]);else a=n;return n=a.ref,{$$typeof:e,type:t,key:s,ref:void 0!==n?n:null,props:a}}return mn.Fragment=t,mn.jsx=n,mn.jsxs=n,mn}()),hn.exports),xn={exports:{}},wn={},kn={exports:{}},Sn={};function Mn(){return yn||(yn=1,kn.exports=(fn||(fn=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var a=n-1>>>1,r=e[a];if(!(0<s(r,t)))break e;e[a]=t,e[n]=r,n=a}}function n(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var a=0,r=e.length,o=r>>>1;a<o;){var i=2*(a+1)-1,l=e[i],c=i+1,d=e[c];if(0>s(l,n))c<r&&0>s(d,l)?(e[a]=d,e[c]=n,a=c):(e[a]=l,e[i]=n,a=i);else{if(!(c<r&&0>s(d,n)))break e;e[a]=d,e[c]=n,a=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var r=performance;e.unstable_now=function(){return r.now()}}else{var o=Date,i=o.now();e.unstable_now=function(){return o.now()-i}}var l=[],c=[],d=1,u=null,p=3,h=!1,m=!1,f=!1,y=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var s=n(c);null!==s;){if(null===s.callback)a(c);else{if(!(s.startTime<=e))break;a(c),s.sortIndex=s.expirationTime,t(l,s)}s=n(c)}}function w(e){if(f=!1,x(e),!m)if(null!==n(l))m=!0,S||(S=!0,k());else{var t=n(c);null!==t&&I(w,t.startTime-e)}}var k,S=!1,M=-1,N=5,C=-1;function E(){return!(!y&&e.unstable_now()-C<N)}function P(){if(y=!1,S){var t=e.unstable_now();C=t;var s=!0;try{e:{m=!1,f&&(f=!1,v(M),M=-1),h=!0;var r=p;try{t:{for(x(t),u=n(l);null!==u&&!(u.expirationTime>t&&E());){var o=u.callback;if("function"==typeof o){u.callback=null,p=u.priorityLevel;var i=o(u.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof i){u.callback=i,x(t),s=!0;break t}u===n(l)&&a(l),x(t)}else a(l);u=n(l)}if(null!==u)s=!0;else{var d=n(c);null!==d&&I(w,d.startTime-t),s=!1}}break e}finally{u=null,p=r,h=!1}s=void 0}}finally{s?k():S=!1}}}if("function"==typeof b)k=function(){b(P)};else if("undefined"!=typeof MessageChannel){var T=new MessageChannel,A=T.port2;T.port1.onmessage=P,k=function(){A.postMessage(null)}}else k=function(){g(P,0)};function I(t,n){M=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(N=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_requestPaint=function(){y=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_scheduleCallback=function(a,s,r){var o=e.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?o+r:o,a){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return a={id:d++,callback:s,priorityLevel:a,startTime:r,expirationTime:i=r+i,sortIndex:-1},r>o?(a.sortIndex=r,t(c,a),null===n(l)&&a===n(c)&&(f?(v(M),M=-1):f=!0,I(w,r-o))):(a.sortIndex=i,t(l,a),m||h||(m=!0,S||(S=!0,k()))),a},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}}(Sn)),Sn)),kn.exports}function Nn(){if(gn)return wn;gn=1;var e=Mn(),t=i(),n=l();function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function r(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function o(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(r(e)!==e)throw Error(a(188))}function u(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=u(e)))return t;e=e.sibling}return null}var p=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),E=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function T(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var A=Symbol.for("react.client.reference");function I(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===A?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case y:return"Fragment";case v:return"Profiler";case g:return"StrictMode";case k:return"Suspense";case S:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case f:return"Portal";case x:return e.displayName||"Context";case b:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:I(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return I(e(t))}catch(n){}}return null}var _=Array.isArray,O=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D={pending:!1,data:null,method:null,action:null},R=[],j=-1;function L(e){return{current:e}}function B(e){0>j||(e.current=R[j],R[j]=null,j--)}function V(e,t){j++,R[j]=e.current,e.current=t}var z,U,G=L(null),K=L(null),H=L(null),W=L(null);function $(e,t){switch(V(H,t),V(K,e),V(G,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?bu(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=xu(t=bu(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(G),V(G,e)}function q(){B(G),B(K),B(H)}function Y(e){null!==e.memoizedState&&V(W,e);var t=G.current,n=xu(t,e.type);t!==n&&(V(K,e),V(G,n))}function X(e){K.current===e&&(B(G),B(K)),W.current===e&&(B(W),pp._currentValue=D)}function Q(e){if(void 0===z)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||"",U=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+z+e+U}var Z=!1;function J(e,t){if(!e||Z)return"";Z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var a={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(s){var a=s}Reflect.construct(e,[],n)}else{try{n.call()}catch(r){a=r}e.call(n.prototype)}}else{try{throw Error()}catch(o){a=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(i){if(i&&a&&"string"==typeof i.stack)return[i.stack,a.stack]}return[null,null]}};a.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(a.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(a.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=a.DetermineComponentFrameRoot(),o=r[0],i=r[1];if(o&&i){var l=o.split("\n"),c=i.split("\n");for(s=a=0;a<l.length&&!l[a].includes("DetermineComponentFrameRoot");)a++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(a===l.length||s===c.length)for(a=l.length-1,s=c.length-1;1<=a&&0<=s&&l[a]!==c[s];)s--;for(;1<=a&&0<=s;a--,s--)if(l[a]!==c[s]){if(1!==a||1!==s)do{if(a--,0>--s||l[a]!==c[s]){var d="\n"+l[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=a&&0<=s);break}}}finally{Z=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Q(n):""}function ee(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return J(e.type,!1);case 11:return J(e.type.render,!1);case 1:return J(e.type,!0);case 31:return Q("Activity");default:return""}}function te(e){try{var t="",n=null;do{t+=ee(e,n),n=e,e=e.return}while(e);return t}catch(a){return"\nError generating stack: "+a.message+"\n"+a.stack}}var ne=Object.prototype.hasOwnProperty,ae=e.unstable_scheduleCallback,se=e.unstable_cancelCallback,re=e.unstable_shouldYield,oe=e.unstable_requestPaint,ie=e.unstable_now,le=e.unstable_getCurrentPriorityLevel,ce=e.unstable_ImmediatePriority,de=e.unstable_UserBlockingPriority,ue=e.unstable_NormalPriority,pe=e.unstable_LowPriority,he=e.unstable_IdlePriority,me=e.log,fe=e.unstable_setDisableYieldValue,ye=null,ge=null;function ve(e){if("function"==typeof me&&fe(e),ge&&"function"==typeof ge.setStrictMode)try{ge.setStrictMode(ye,e)}catch(t){}}var be=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/we|0)|0},xe=Math.log,we=Math.LN2;var ke=256,Se=262144,Me=4194304;function Ne(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t,n){var a=e.pendingLanes;if(0===a)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var i=134217727&a;return 0!==i?0!==(a=i&~r)?s=Ne(a):0!==(o&=i)?s=Ne(o):n||0!==(n=i&~e)&&(s=Ne(n)):0!==(i=a&~r)?s=Ne(i):0!==o?s=Ne(o):n||0!==(n=a&~e)&&(s=Ne(n)),0===s?0:0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(n=t&-t)||32===r&&4194048&n)?t:s}function Ee(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Pe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Te(){var e=Me;return!(62914560&(Me<<=1))&&(Me=4194304),e}function Ae(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ie(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function _e(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var a=31-be(t);e.entangledLanes|=t,e.entanglements[a]=1073741824|e.entanglements[a]|261930&n}function Oe(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var a=31-be(n),s=1<<a;s&t|e[a]&t&&(e[a]|=t),n&=~s}}function Fe(e,t){var n=t&-t;return 0!==((n=42&n?1:De(n))&(e.suspendedLanes|t))?0:n}function De(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Re(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function je(){var e=F.p;return 0!==e?e:void 0===(e=window.event)?32:Pp(e.type)}function Le(e,t){var n=F.p;try{return F.p=e,t()}finally{F.p=n}}var Be=Math.random().toString(36).slice(2),Ve="__reactFiber$"+Be,ze="__reactProps$"+Be,Ue="__reactContainer$"+Be,Ge="__reactEvents$"+Be,Ke="__reactListeners$"+Be,He="__reactHandles$"+Be,We="__reactResources$"+Be,$e="__reactMarker$"+Be;function qe(e){delete e[Ve],delete e[ze],delete e[Ge],delete e[Ke],delete e[He]}function Ye(e){var t=e[Ve];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ue]||n[Ve]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Lu(e);null!==e;){if(n=e[Ve])return n;e=Lu(e)}return t}n=(e=n).parentNode}return null}function Xe(e){if(e=e[Ve]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Ze(e){var t=e[We];return t||(t=e[We]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Je(e){e[$e]=!0}var et=new Set,tt={};function nt(e,t){at(e,t),at(e+"Capture",t)}function at(e,t){for(tt[e]=t,e=0;e<t.length;e++)et.add(t[e])}var st=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},ot={};function it(e,t,n){if(s=t,ne.call(ot,s)||!ne.call(rt,s)&&(st.test(s)?ot[s]=!0:(rt[s]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var a=t.toLowerCase().slice(0,5);if("data-"!==a&&"aria-"!==a)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var s}function lt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ct(e,t,n,a){if(null===a)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+a)}}function dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=ut(e)?"checked":"value";e._valueTracker=function(e,t,n){var a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==a&&"function"==typeof a.get&&"function"==typeof a.set){var s=a.get,r=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=ut(e)?e.checked?"true":"false":e.value),(e=a)!==n&&(t.setValue(e),!0)}function mt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function yt(e){return e.replace(ft,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,a,s,r,o,i){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+dt(t)):e.value!==""+dt(t)&&(e.value=""+dt(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?bt(e,o,dt(t)):null!=n?bt(e,o,dt(n)):null!=a&&e.removeAttribute("value"),null==s&&null!=r&&(e.defaultChecked=!!r),null!=s&&(e.checked=s&&"function"!=typeof s&&"symbol"!=typeof s),null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?e.name=""+dt(i):e.removeAttribute("name")}function vt(e,t,n,a,s,r,o,i){if(null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&(e.type=r),null!=t||null!=n){if(("submit"===r||"reset"===r)&&null==t)return void pt(e);n=null!=n?""+dt(n):"",t=null!=t?""+dt(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}a="function"!=typeof(a=null!=a?a:s)&&"symbol"!=typeof a&&!!a,e.checked=i?e.checked:!!a,e.defaultChecked=!!a,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o),pt(e)}function bt(e,t,n){"number"===t&&mt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function xt(e,t,n,a){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&a&&(e[n].defaultSelected=!0)}else{for(n=""+dt(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(a&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+dt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+dt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function kt(e,t,n,s){if(null==t){if(null!=s){if(null!=n)throw Error(a(92));if(_(s)){if(1<s.length)throw Error(a(93));s=s[0]}n=s}null==n&&(n=""),t=n}n=dt(t),e.defaultValue=n,(s=e.textContent)===n&&""!==s&&null!==s&&(e.value=s),pt(e)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Mt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,n){var a=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?a?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":a?e.setProperty(t,n):"number"!=typeof n||0===n||Mt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ct(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var s in n)!n.hasOwnProperty(s)||null!=t&&t.hasOwnProperty(s)||(0===s.indexOf("--")?e.setProperty(s,""):"float"===s?e.cssFloat="":e[s]="");for(var r in t)s=t[r],t.hasOwnProperty(r)&&n[r]!==s&&Nt(e,r,s)}else for(var o in t)t.hasOwnProperty(o)&&Nt(e,o,t[o])}function Et(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function At(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function It(){}var _t=null;function Ot(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ft=null,Dt=null;function Rt(e){var t=Xe(e);if(t&&(e=t.stateNode)){var n=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=s[ze]||null;if(!r)throw Error(a(90));gt(s,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(s=n[t]).form===e.form&&ht(s)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&xt(e,!!n.multiple,t,!1)}}}var jt=!1;function Lt(e,t,n){if(jt)return e(t,n);jt=!0;try{return e(t)}finally{if(jt=!1,(null!==Ft||null!==Dt)&&(td(),Ft&&(t=Ft,e=Dt,Dt=Ft=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Bt(e,t){var n=e.stateNode;if(null===n)return null;var s=n[ze]||null;if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Vt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),zt=!1;if(Vt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Jp){zt=!1}var Gt=null,Kt=null,Ht=null;function Wt(){if(Ht)return Ht;var e,t,n=Kt,a=n.length,s="value"in Gt?Gt.value:Gt.textContent,r=s.length;for(e=0;e<a&&n[e]===s[e];e++);var o=a-e;for(t=1;t<=o&&n[a-t]===s[r-t];t++);return Ht=s.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Yt(){return!1}function Xt(e){function t(t,n,a,s,r){for(var o in this._reactName=t,this._targetInst=a,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?qt:Yt,this.isPropagationStopped=Yt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var Qt,Zt,Jt,en={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tn=Xt(en),nn=p({},en,{view:0,detail:0}),an=Xt(nn),sn=p({},nn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Qt=e.screenX-Jt.screenX,Zt=e.screenY-Jt.screenY):Zt=Qt=0,Jt=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),rn=Xt(sn),on=Xt(p({},sn,{dataTransfer:0})),ln=Xt(p({},nn,{relatedTarget:0})),cn=Xt(p({},en,{animationName:0,elapsedTime:0,pseudoElement:0})),dn=Xt(p({},en,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),un=Xt(p({},en,{data:0})),pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=mn[e])&&!!t[e]}function yn(){return fn}var vn=Xt(p({},nn,{key:function(e){if(e.key){var t=pn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),bn=Xt(p({},sn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=Xt(p({},nn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yn})),kn=Xt(p({},en,{propertyName:0,elapsedTime:0,pseudoElement:0})),Sn=Xt(p({},sn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Nn=Xt(p({},en,{newState:0,oldState:0})),Cn=[9,13,27,32],En=Vt&&"CompositionEvent"in window,Pn=null;Vt&&"documentMode"in document&&(Pn=document.documentMode);var Tn=Vt&&"TextEvent"in window&&!Pn,An=Vt&&(!En||Pn&&8<Pn&&11>=Pn),In=String.fromCharCode(32),_n=!1;function On(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Dn=!1;var Rn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Rn[e.type]:"textarea"===t}function Ln(e,t,n,a){Ft?Dt?Dt.push(a):Dt=[a]:Ft=a,0<(t=ru(t,"onChange")).length&&(n=new tn("onChange","change",null,n,a),e.push({event:n,listeners:t}))}var Bn=null,Vn=null;function zn(e){Qd(e,0)}function Un(e){if(ht(Qe(e)))return e}function Gn(e,t){if("change"===e)return t}var Kn=!1;if(Vt){var Hn;if(Vt){var Wn="oninput"in document;if(!Wn){var $n=document.createElement("div");$n.setAttribute("oninput","return;"),Wn="function"==typeof $n.oninput}Hn=Wn}else Hn=!1;Kn=Hn&&(!document.documentMode||9<document.documentMode)}function qn(){Bn&&(Bn.detachEvent("onpropertychange",Yn),Vn=Bn=null)}function Yn(e){if("value"===e.propertyName&&Un(Vn)){var t=[];Ln(t,Vn,e,Ot(e)),Lt(zn,t)}}function Xn(e,t,n){"focusin"===e?(qn(),Vn=n,(Bn=t).attachEvent("onpropertychange",Yn)):"focusout"===e&&qn()}function Qn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Un(Vn)}function Zn(e,t){if("click"===e)return Un(t)}function Jn(e,t){if("input"===e||"change"===e)return Un(t)}var ea="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ta(e,t){if(ea(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var s=n[a];if(!ne.call(t,s)||!ea(e[s],t[s]))return!1}return!0}function na(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function aa(e,t){var n,a=na(e);for(e=0;a;){if(3===a.nodeType){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=na(a)}}function sa(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?sa(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ra(e){for(var t=mt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(a){n=!1}if(!n)break;t=mt((e=t.contentWindow).document)}return t}function oa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ia=Vt&&"documentMode"in document&&11>=document.documentMode,la=null,ca=null,da=null,ua=!1;function pa(e,t,n){var a=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ua||null==la||la!==mt(a)||("selectionStart"in(a=la)&&oa(a)?a={start:a.selectionStart,end:a.selectionEnd}:a={anchorNode:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset},da&&ta(da,a)||(da=a,0<(a=ru(ca,"onSelect")).length&&(t=new tn("onSelect","select",null,t,n),e.push({event:t,listeners:a}),t.target=la)))}function ha(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ma={animationend:ha("Animation","AnimationEnd"),animationiteration:ha("Animation","AnimationIteration"),animationstart:ha("Animation","AnimationStart"),transitionrun:ha("Transition","TransitionRun"),transitionstart:ha("Transition","TransitionStart"),transitioncancel:ha("Transition","TransitionCancel"),transitionend:ha("Transition","TransitionEnd")},fa={},ya={};function ga(e){if(fa[e])return fa[e];if(!ma[e])return e;var t,n=ma[e];for(t in n)if(n.hasOwnProperty(t)&&t in ya)return fa[e]=n[t];return e}Vt&&(ya=document.createElement("div").style,"AnimationEvent"in window||(delete ma.animationend.animation,delete ma.animationiteration.animation,delete ma.animationstart.animation),"TransitionEvent"in window||delete ma.transitionend.transition);var va=ga("animationend"),ba=ga("animationiteration"),xa=ga("animationstart"),wa=ga("transitionrun"),ka=ga("transitionstart"),Sa=ga("transitioncancel"),Ma=ga("transitionend"),Na=new Map,Ca="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ea(e,t){Na.set(e,t),nt(t,[e])}Ca.push("scrollEnd");var Pa="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},Ta=[],Aa=0,Ia=0;function _a(){for(var e=Aa,t=Ia=Aa=0;t<e;){var n=Ta[t];Ta[t++]=null;var a=Ta[t];Ta[t++]=null;var s=Ta[t];Ta[t++]=null;var r=Ta[t];if(Ta[t++]=null,null!==a&&null!==s){var o=a.pending;null===o?s.next=s:(s.next=o.next,o.next=s),a.pending=s}0!==r&&Ra(n,s,r)}}function Oa(e,t,n,a){Ta[Aa++]=e,Ta[Aa++]=t,Ta[Aa++]=n,Ta[Aa++]=a,Ia|=a,e.lanes|=a,null!==(e=e.alternate)&&(e.lanes|=a)}function Fa(e,t,n,a){return Oa(e,t,n,a),ja(e)}function Da(e,t){return Oa(e,null,null,t),ja(e)}function Ra(e,t,n){e.lanes|=n;var a=e.alternate;null!==a&&(a.lanes|=n);for(var s=!1,r=e.return;null!==r;)r.childLanes|=n,null!==(a=r.alternate)&&(a.childLanes|=n),22===r.tag&&(null===(e=r.stateNode)||1&e._visibility||(s=!0)),e=r,r=r.return;return 3===e.tag?(r=e.stateNode,s&&null!==t&&(s=31-be(n),null===(a=(e=r.hiddenUpdates)[s])?e[s]=[t]:a.push(t),t.lane=536870912|n),r):null}function ja(e){if(50<Wc)throw Wc=0,$c=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var La={};function Ba(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Va(e,t,n,a){return new Ba(e,t,n,a)}function za(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ua(e,t){var n=e.alternate;return null===n?((n=Va(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ga(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ka(e,t,n,s,r,o){var i=0;if(s=e,"function"==typeof e)za(e)&&(i=1);else if("string"==typeof e)i=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,G.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Va(31,n,t,r)).elementType=C,e.lanes=o,e;case y:return Ha(n.children,r,o,t);case g:i=8,r|=24;break;case v:return(e=Va(12,n,t,2|r)).elementType=v,e.lanes=o,e;case k:return(e=Va(13,n,t,r)).elementType=k,e.lanes=o,e;case S:return(e=Va(19,n,t,r)).elementType=S,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:i=10;break e;case b:i=9;break e;case w:i=11;break e;case M:i=14;break e;case N:i=16,s=null;break e}i=29,n=Error(a(130,null===e?"null":typeof e,"")),s=null}return(t=Va(i,n,t,r)).elementType=e,t.type=s,t.lanes=o,t}function Ha(e,t,n,a){return(e=Va(7,e,a,t)).lanes=n,e}function Wa(e,t,n){return(e=Va(6,e,null,t)).lanes=n,e}function $a(e){var t=Va(18,null,null,0);return t.stateNode=e,t}function qa(e,t,n){return(t=Va(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Ya=new WeakMap;function Xa(e,t){if("object"==typeof e&&null!==e){var n=Ya.get(e);return void 0!==n?n:(t={value:e,source:t,stack:te(t)},Ya.set(e,t),t)}return{value:e,source:t,stack:te(t)}}var Qa=[],Za=0,Ja=null,es=0,ts=[],ns=0,as=null,ss=1,rs="";function os(e,t){Qa[Za++]=es,Qa[Za++]=Ja,Ja=e,es=t}function is(e,t,n){ts[ns++]=ss,ts[ns++]=rs,ts[ns++]=as,as=e;var a=ss;e=rs;var s=32-be(a)-1;a&=~(1<<s),n+=1;var r=32-be(t)+s;if(30<r){var o=s-s%5;r=(a&(1<<o)-1).toString(32),a>>=o,s-=o,ss=1<<32-be(t)+s|n<<s|a,rs=r+e}else ss=1<<r|n<<s|a,rs=e}function ls(e){null!==e.return&&(os(e,1),is(e,1,0))}function cs(e){for(;e===Ja;)Ja=Qa[--Za],Qa[Za]=null,es=Qa[--Za],Qa[Za]=null;for(;e===as;)as=ts[--ns],ts[ns]=null,rs=ts[--ns],ts[ns]=null,ss=ts[--ns],ts[ns]=null}function ds(e,t){ts[ns++]=ss,ts[ns++]=rs,ts[ns++]=as,ss=t.id,rs=t.overflow,as=e}var us=null,ps=null,hs=!1,ms=null,fs=!1,ys=Error(a(519));function gs(e){throw Ss(Xa(Error(a(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),ys}function vs(e){var t=e.stateNode,n=e.type,a=e.memoizedProps;switch(t[Ve]=e,t[ze]=a,n){case"dialog":Zd("cancel",t),Zd("close",t);break;case"iframe":case"object":case"embed":Zd("load",t);break;case"video":case"audio":for(n=0;n<Yd.length;n++)Zd(Yd[n],t);break;case"source":Zd("error",t);break;case"img":case"image":case"link":Zd("error",t),Zd("load",t);break;case"details":Zd("toggle",t);break;case"input":Zd("invalid",t),vt(t,a.value,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name,!0);break;case"select":Zd("invalid",t);break;case"textarea":Zd("invalid",t),kt(t,a.value,a.defaultValue,a.children)}"string"!=typeof(n=a.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===a.suppressHydrationWarning||uu(t.textContent,n)?(null!=a.popover&&(Zd("beforetoggle",t),Zd("toggle",t)),null!=a.onScroll&&Zd("scroll",t),null!=a.onScrollEnd&&Zd("scrollend",t),null!=a.onClick&&(t.onclick=It),t=!0):t=!1,t||gs(e,!0)}function bs(e){for(us=e.return;us;)switch(us.tag){case 5:case 31:case 13:return void(fs=!1);case 27:case 3:return void(fs=!0);default:us=us.return}}function xs(e){if(e!==us)return!1;if(!hs)return bs(e),hs=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||wu(e.type,e.memoizedProps)),t=!t),t&&ps&&gs(e),bs(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ps=ju(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ps=ju(e)}else 27===n?(n=ps,Pu(e.type)?(e=Ru,Ru=null,ps=e):ps=n):ps=us?Du(e.stateNode.nextSibling):null;return!0}function ws(){ps=us=null,hs=!1}function ks(){var e=ms;return null!==e&&(null===_c?_c=e:_c.push.apply(_c,e),ms=null),e}function Ss(e){null===ms?ms=[e]:ms.push(e)}var Ms=L(null),Ns=null,Cs=null;function Es(e,t,n){V(Ms,t._currentValue),t._currentValue=n}function Ps(e){e._currentValue=Ms.current,B(Ms)}function Ts(e,t,n){for(;null!==e;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==a&&(a.childLanes|=t)):null!==a&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===n)break;e=e.return}}function As(e,t,n,s){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var i=r.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ts(o.return,n,e),s||(i=null);break e}o=l.next}}else if(18===r.tag){if(null===(i=r.return))throw Error(a(341));i.lanes|=n,null!==(o=i.alternate)&&(o.lanes|=n),Ts(i,n,e),i=null}else i=r.child;if(null!==i)i.return=r;else for(i=r;null!==i;){if(i===e){i=null;break}if(null!==(r=i.sibling)){r.return=i.return,i=r;break}i=i.return}r=i}}function Is(e,t,n,s){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(524288&r.flags)o=!0;else if(262144&r.flags)break;if(10===r.tag){var i=r.alternate;if(null===i)throw Error(a(387));if(null!==(i=i.memoizedProps)){var l=r.type;ea(r.pendingProps.value,i.value)||(null!==e?e.push(l):e=[l])}}else if(r===W.current){if(null===(i=r.alternate))throw Error(a(387));i.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(pp):e=[pp])}r=r.return}null!==e&&As(t,e,n,s),t.flags|=262144}function _s(e){for(e=e.firstContext;null!==e;){if(!ea(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Os(e){Ns=e,Cs=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Fs(e){return Rs(Ns,e)}function Ds(e,t){return null===Ns&&Os(e),Rs(e,t)}function Rs(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Cs){if(null===e)throw Error(a(308));Cs=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Cs=Cs.next=t;return n}var js="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ls=e.unstable_scheduleCallback,Bs=e.unstable_NormalPriority,Vs={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zs(){return{controller:new js,data:new Map,refCount:0}}function Us(e){e.refCount--,0===e.refCount&&Ls(Bs,function(){e.controller.abort()})}var Gs=null,Ks=0,Hs=0,Ws=null;function $s(){if(0===--Ks&&null!==Gs){null!==Ws&&(Ws.status="fulfilled");var e=Gs;Gs=null,Hs=0,Ws=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var qs=O.S;O.S=function(e,t){Dc=ie(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Gs){var n=Gs=[];Ks=0,Hs=Kd(),Ws={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ks++,t.then($s,$s)}(0,t),null!==qs&&qs(e,t)};var Ys=L(null);function Xs(){var e=Ys.current;return null!==e?e:yc.pooledCache}function Qs(e,t){V(Ys,null===t?Ys.current:t.pool)}function Zs(){var e=Xs();return null===e?null:{parent:Vs._currentValue,pool:e}}var Js=Error(a(460)),er=Error(a(474)),tr=Error(a(542)),nr={then:function(){}};function ar(e){return"fulfilled"===(e=e.status)||"rejected"===e}function sr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(It,It),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e;default:if("string"==typeof t.status)t.then(It,It);else{if(null!==(e=yc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e}throw or=t,Js}}function rr(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw or=t,Js;throw t}}var or=null;function ir(){if(null===or)throw Error(a(459));var e=or;return or=null,e}function lr(e){if(e===Js||e===tr)throw Error(a(483))}var cr=null,dr=0;function ur(e){var t=dr;return dr+=1,null===cr&&(cr=[]),sr(cr,e,t)}function pr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function hr(e,t){if(t.$$typeof===h)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mr(e){function t(t,n){if(e){var a=t.deletions;null===a?(t.deletions=[n],t.flags|=16):a.push(n)}}function n(n,a){if(!e)return null;for(;null!==a;)t(n,a),a=a.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Ua(e,t)).index=0,e.sibling=null,e}function o(t,n,a){return t.index=a,e?null!==(a=t.alternate)?(a=a.index)<n?(t.flags|=67108866,n):a:(t.flags|=67108866,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,a){return null===t||6!==t.tag?((t=Wa(n,e.mode,a)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,a){var s=n.type;return s===y?u(e,t,n.props.children,a,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===N&&rr(s)===t.type)?(pr(t=r(t,n.props),n),t.return=e,t):(pr(t=Ka(n.type,n.key,n.props,null,e.mode,a),n),t.return=e,t)}function d(e,t,n,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qa(n,e.mode,a)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,a,s){return null===t||7!==t.tag?((t=Ha(n,e.mode,a,s)).return=e,t):((t=r(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Wa(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case m:return pr(n=Ka(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case f:return(t=qa(t,e.mode,n)).return=e,t;case N:return p(e,t=rr(t),n)}if(_(t)||T(t))return(t=Ha(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return p(e,ur(t),n);if(t.$$typeof===x)return p(e,Ds(e,t),n);hr(e,t)}return null}function h(e,t,n,a){var s=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==s?null:l(e,t,""+n,a);if("object"==typeof n&&null!==n){switch(n.$$typeof){case m:return n.key===s?c(e,t,n,a):null;case f:return n.key===s?d(e,t,n,a):null;case N:return h(e,t,n=rr(n),a)}if(_(n)||T(n))return null!==s?null:u(e,t,n,a,null);if("function"==typeof n.then)return h(e,t,ur(n),a);if(n.$$typeof===x)return h(e,t,Ds(e,n),a);hr(e,n)}return null}function g(e,t,n,a,s){if("string"==typeof a&&""!==a||"number"==typeof a||"bigint"==typeof a)return l(t,e=e.get(n)||null,""+a,s);if("object"==typeof a&&null!==a){switch(a.$$typeof){case m:return c(t,e=e.get(null===a.key?n:a.key)||null,a,s);case f:return d(t,e=e.get(null===a.key?n:a.key)||null,a,s);case N:return g(e,t,n,a=rr(a),s)}if(_(a)||T(a))return u(t,e=e.get(n)||null,a,s,null);if("function"==typeof a.then)return g(e,t,n,ur(a),s);if(a.$$typeof===x)return g(e,t,n,Ds(t,a),s);hr(t,a)}return null}function v(l,c,d,u){if("object"==typeof d&&null!==d&&d.type===y&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case m:e:{for(var b=d.key;null!==c;){if(c.key===b){if((b=d.type)===y){if(7===c.tag){n(l,c.sibling),(u=r(c,d.props.children)).return=l,l=u;break e}}else if(c.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===N&&rr(b)===c.type){n(l,c.sibling),pr(u=r(c,d.props),d),u.return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}d.type===y?((u=Ha(d.props.children,l.mode,u,d.key)).return=l,l=u):(pr(u=Ka(d.type,d.key,d.props,null,l.mode,u),d),u.return=l,l=u)}return i(l);case f:e:{for(b=d.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===d.containerInfo&&c.stateNode.implementation===d.implementation){n(l,c.sibling),(u=r(c,d.children||[])).return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}(u=qa(d,l.mode,u)).return=l,l=u}return i(l);case N:return v(l,c,d=rr(d),u)}if(_(d))return function(a,r,i,l){for(var c=null,d=null,u=r,m=r=0,f=null;null!==u&&m<i.length;m++){u.index>m?(f=u,u=null):f=u.sibling;var y=h(a,u,i[m],l);if(null===y){null===u&&(u=f);break}e&&u&&null===y.alternate&&t(a,u),r=o(y,r,m),null===d?c=y:d.sibling=y,d=y,u=f}if(m===i.length)return n(a,u),hs&&os(a,m),c;if(null===u){for(;m<i.length;m++)null!==(u=p(a,i[m],l))&&(r=o(u,r,m),null===d?c=u:d.sibling=u,d=u);return hs&&os(a,m),c}for(u=s(u);m<i.length;m++)null!==(f=g(u,a,m,i[m],l))&&(e&&null!==f.alternate&&u.delete(null===f.key?m:f.key),r=o(f,r,m),null===d?c=f:d.sibling=f,d=f);return e&&u.forEach(function(e){return t(a,e)}),hs&&os(a,m),c}(l,c,d,u);if(T(d)){if("function"!=typeof(b=T(d)))throw Error(a(150));return function(r,i,l,c){if(null==l)throw Error(a(151));for(var d=null,u=null,m=i,f=i=0,y=null,v=l.next();null!==m&&!v.done;f++,v=l.next()){m.index>f?(y=m,m=null):y=m.sibling;var b=h(r,m,v.value,c);if(null===b){null===m&&(m=y);break}e&&m&&null===b.alternate&&t(r,m),i=o(b,i,f),null===u?d=b:u.sibling=b,u=b,m=y}if(v.done)return n(r,m),hs&&os(r,f),d;if(null===m){for(;!v.done;f++,v=l.next())null!==(v=p(r,v.value,c))&&(i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return hs&&os(r,f),d}for(m=s(m);!v.done;f++,v=l.next())null!==(v=g(m,r,f,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?f:v.key),i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return e&&m.forEach(function(e){return t(r,e)}),hs&&os(r,f),d}(l,c,d=b.call(d),u)}if("function"==typeof d.then)return v(l,c,ur(d),u);if(d.$$typeof===x)return v(l,c,Ds(l,d),u);hr(l,d)}return"string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d?(d=""+d,null!==c&&6===c.tag?(n(l,c.sibling),(u=r(c,d)).return=l,l=u):(n(l,c),(u=Wa(d,l.mode,u)).return=l,l=u),i(l)):n(l,c)}return function(e,t,n,a){try{dr=0;var s=v(e,t,n,a);return cr=null,s}catch(o){if(o===Js||o===tr)throw o;var r=Va(29,o,null,e.mode);return r.lanes=a,r.return=e,r}}}var fr=mr(!0),yr=mr(!1),gr=!1;function vr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function br(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function xr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wr(e,t,n){var a=e.updateQueue;if(null===a)return null;if(a=a.shared,2&fc){var s=a.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),a.pending=t,t=ja(e),Ra(e,null,n),t}return Oa(e,a,t,n),ja(e)}function kr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,Oe(e,n)}}function Sr(e,t){var n=e.updateQueue,a=e.alternate;if(null!==a&&n===(a=a.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===r?s=r=o:r=r.next=o,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:a.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:a.shared,callbacks:a.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Mr=!1;function Nr(){if(Mr){if(null!==Ws)throw Ws}}function Cr(e,t,n,a){Mr=!1;var s=e.updateQueue;gr=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,i=s.shared.pending;if(null!==i){s.shared.pending=null;var l=i,c=l.next;l.next=null,null===o?r=c:o.next=c,o=l;var d=e.alternate;null!==d&&((i=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===i?d.firstBaseUpdate=c:i.next=c,d.lastBaseUpdate=l))}if(null!==r){var u=s.baseState;for(o=0,d=c=l=null,i=r;;){var h=-536870913&i.lane,m=h!==i.lane;if(m?(vc&h)===h:(a&h)===h){0!==h&&h===Hs&&(Mr=!0),null!==d&&(d=d.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{var f=e,y=i;h=t;var g=n;switch(y.tag){case 1:if("function"==typeof(f=y.payload)){u=f.call(g,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=y.payload)?f.call(g,u,h):f))break e;u=p({},u,h);break e;case 2:gr=!0}}null!==(h=i.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=s.callbacks)?s.callbacks=[h]:m.push(h))}else m={lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,o|=h;if(null===(i=i.next)){if(null===(i=s.shared.pending))break;i=(m=i).next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null===r&&(s.shared.lanes=0),Cc|=o,e.lanes=o,e.memoizedState=u}}function Er(e,t){if("function"!=typeof e)throw Error(a(191,e));e.call(t)}function Pr(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Er(n[e],t)}var Tr=L(null),Ar=L(0);function Ir(e,t){V(Ar,e=Mc),V(Tr,t),Mc=e|t.baseLanes}function _r(){V(Ar,Mc),V(Tr,Tr.current)}function Or(){Mc=Ar.current,B(Tr),B(Ar)}var Fr=L(null),Dr=null;function Rr(e){var t=e.alternate;V(zr,1&zr.current),V(Fr,e),null===Dr&&(null===t||null!==Tr.current||null!==t.memoizedState)&&(Dr=e)}function jr(e){V(zr,zr.current),V(Fr,e),null===Dr&&(Dr=e)}function Lr(e){22===e.tag?(V(zr,zr.current),V(Fr,e),null===Dr&&(Dr=e)):Br()}function Br(){V(zr,zr.current),V(Fr,Fr.current)}function Vr(e){B(Fr),Dr===e&&(Dr=null),B(zr)}var zr=L(0);function Ur(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Ou(n)||Fu(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gr=0,Kr=null,Hr=null,Wr=null,$r=!1,qr=!1,Yr=!1,Xr=0,Qr=0,Zr=null,Jr=0;function eo(){throw Error(a(321))}function to(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ea(e[n],t[n]))return!1;return!0}function no(e,t,n,a,s,r){return Gr=r,Kr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,O.H=null===e||null===e.memoizedState?vi:bi,Yr=!1,r=n(a,s),Yr=!1,qr&&(r=so(t,n,a,s)),ao(e),r}function ao(e){O.H=gi;var t=null!==Hr&&null!==Hr.next;if(Gr=0,Wr=Hr=Kr=null,$r=!1,Qr=0,Zr=null,t)throw Error(a(300));null===e||Di||null!==(e=e.dependencies)&&_s(e)&&(Di=!0)}function so(e,t,n,s){Kr=e;var r=0;do{if(qr&&(Zr=null),Qr=0,qr=!1,25<=r)throw Error(a(301));if(r+=1,Wr=Hr=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}O.H=xi,o=t(n,s)}while(qr);return o}function ro(){var e=O.H,t=e.useState()[0];return t="function"==typeof t.then?po(t):t,e=e.useState()[0],(null!==Hr?Hr.memoizedState:null)!==e&&(Kr.flags|=1024),t}function oo(){var e=0!==Xr;return Xr=0,e}function io(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function lo(e){if($r){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}$r=!1}Gr=0,Wr=Hr=Kr=null,qr=!1,Qr=Xr=0,Zr=null}function co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Wr?Kr.memoizedState=Wr=e:Wr=Wr.next=e,Wr}function uo(){if(null===Hr){var e=Kr.alternate;e=null!==e?e.memoizedState:null}else e=Hr.next;var t=null===Wr?Kr.memoizedState:Wr.next;if(null!==t)Wr=t,Hr=e;else{if(null===e){if(null===Kr.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(Hr=e).memoizedState,baseState:Hr.baseState,baseQueue:Hr.baseQueue,queue:Hr.queue,next:null},null===Wr?Kr.memoizedState=Wr=e:Wr=Wr.next=e}return Wr}function po(e){var t=Qr;return Qr+=1,null===Zr&&(Zr=[]),e=sr(Zr,e,t),t=Kr,null===(null===Wr?t.memoizedState:Wr.next)&&(t=t.alternate,O.H=null===t||null===t.memoizedState?vi:bi),e}function ho(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return po(e);if(e.$$typeof===x)return Fs(e)}throw Error(a(438,String(e)))}function mo(e){var t=null,n=Kr.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var a=Kr.alternate;null!==a&&(null!==(a=a.updateQueue)&&(null!=(a=a.memoCache)&&(t={data:a.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Kr.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),a=0;a<e;a++)n[a]=E;return t.index++,n}function fo(e,t){return"function"==typeof t?t(e):t}function yo(e){return go(uo(),Hr,e)}function go(e,t,n){var s=e.queue;if(null===s)throw Error(a(311));s.lastRenderedReducer=n;var r=e.baseQueue,o=s.pending;if(null!==o){if(null!==r){var i=r.next;r.next=o.next,o.next=i}t.baseQueue=r=o,s.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var l=i=null,c=null,d=t=r.next,u=!1;do{var p=-536870913&d.lane;if(p!==d.lane?(vc&p)===p:(Gr&p)===p){var h=d.revertLane;if(0===h)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),p===Hs&&(u=!0);else{if((Gr&h)===h){d=d.next,h===Hs&&(u=!0);continue}p={lane:0,revertLane:d.revertLane,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=p,i=o):c=c.next=p,Kr.lanes|=h,Cc|=h}p=d.action,Yr&&n(o,p),o=d.hasEagerState?d.eagerState:n(o,p)}else h={lane:p,revertLane:d.revertLane,gesture:d.gesture,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=h,i=o):c=c.next=h,Kr.lanes|=p,Cc|=p;d=d.next}while(null!==d&&d!==t);if(null===c?i=o:c.next=l,!ea(o,e.memoizedState)&&(Di=!0,u&&null!==(n=Ws)))throw n;e.memoizedState=o,e.baseState=i,e.baseQueue=c,s.lastRenderedState=o}return null===r&&(s.lanes=0),[e.memoizedState,s.dispatch]}function vo(e){var t=uo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var i=r=r.next;do{o=e(o,i.action),i=i.next}while(i!==r);ea(o,t.memoizedState)||(Di=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function bo(e,t,n){var s=Kr,r=uo(),o=hs;if(o){if(void 0===n)throw Error(a(407));n=n()}else n=t();var i=!ea((Hr||r).memoizedState,n);if(i&&(r.memoizedState=n,Di=!0),r=r.queue,Ko(ko.bind(null,s,r,e),[e]),r.getSnapshot!==t||i||null!==Wr&&1&Wr.memoizedState.tag){if(s.flags|=2048,Bo(9,{destroy:void 0},wo.bind(null,s,r,n,t),null),null===yc)throw Error(a(349));o||127&Gr||xo(s,t,n)}return n}function xo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Kr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Kr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function wo(e,t,n,a){t.value=n,t.getSnapshot=a,So(t)&&Mo(e)}function ko(e,t,n){return n(function(){So(t)&&Mo(e)})}function So(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ea(e,n)}catch(a){return!0}}function Mo(e){var t=Da(e,2);null!==t&&Xc(t,e,2)}function No(e){var t=co();if("function"==typeof e){var n=e;if(e=n(),Yr){ve(!0);try{n()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:e},t}function Co(e,t,n,a){return e.baseState=n,go(e,Hr,"function"==typeof a?a:fo)}function Eo(e,t,n,s,r){if(mi(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==O.T?n(!0):o.isTransition=!1,s(o),null===(n=t.pending)?(o.next=t.pending=o,Po(t,o)):(o.next=n.next,t.pending=n.next=o)}}function Po(e,t){var n=t.action,a=t.payload,s=e.state;if(t.isTransition){var r=O.T,o={};O.T=o;try{var i=n(s,a),l=O.S;null!==l&&l(o,i),To(e,t,i)}catch(c){Io(e,t,c)}finally{null!==r&&null!==o.types&&(r.types=o.types),O.T=r}}else try{To(e,t,r=n(s,a))}catch(d){Io(e,t,d)}}function To(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Ao(e,t,n)},function(n){return Io(e,t,n)}):Ao(e,t,n)}function Ao(e,t,n){t.status="fulfilled",t.value=n,_o(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Po(e,n)))}function Io(e,t,n){var a=e.pending;if(e.pending=null,null!==a){a=a.next;do{t.status="rejected",t.reason=n,_o(t),t=t.next}while(t!==a)}e.action=null}function _o(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Oo(e,t){return t}function Fo(e,t){if(hs){var n=yc.formState;if(null!==n){e:{var a=Kr;if(hs){if(ps){t:{for(var s=ps,r=fs;8!==s.nodeType;){if(!r){s=null;break t}if(null===(s=Du(s.nextSibling))){s=null;break t}}s="F!"===(r=s.data)||"F"===r?s:null}if(s){ps=Du(s.nextSibling),a="F!"===s.data;break e}}gs(a)}a=!1}a&&(t=n[0])}}return(n=co()).memoizedState=n.baseState=t,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oo,lastRenderedState:t},n.queue=a,n=ui.bind(null,Kr,a),a.dispatch=n,a=No(!1),r=hi.bind(null,Kr,!1,a.queue),s={state:t,dispatch:null,action:e,pending:null},(a=co()).queue=s,n=Eo.bind(null,Kr,s,r,n),s.dispatch=n,a.memoizedState=e,[t,n,!1]}function Do(e){return Ro(uo(),Hr,e)}function Ro(e,t,n){if(t=go(e,t,Oo)[0],e=yo(fo)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var a=po(t)}catch(o){if(o===Js)throw tr;throw o}else a=t;var s=(t=uo()).queue,r=s.dispatch;return n!==t.memoizedState&&(Kr.flags|=2048,Bo(9,{destroy:void 0},jo.bind(null,s,n),null)),[a,r,e]}function jo(e,t){e.action=t}function Lo(e){var t=uo(),n=Hr;if(null!==n)return Ro(t,n,e);uo(),t=t.memoizedState;var a=(n=uo()).queue.dispatch;return n.memoizedState=e,[t,a,!1]}function Bo(e,t,n,a){return e={tag:e,create:n,deps:a,inst:t,next:null},null===(t=Kr.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Kr.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e),e}function Vo(){return uo().memoizedState}function zo(e,t,n,a){var s=co();Kr.flags|=e,s.memoizedState=Bo(1|t,{destroy:void 0},n,void 0===a?null:a)}function Uo(e,t,n,a){var s=uo();a=void 0===a?null:a;var r=s.memoizedState.inst;null!==Hr&&null!==a&&to(a,Hr.memoizedState.deps)?s.memoizedState=Bo(t,r,n,a):(Kr.flags|=e,s.memoizedState=Bo(1|t,r,n,a))}function Go(e,t){zo(8390656,8,e,t)}function Ko(e,t){Uo(2048,8,e,t)}function Ho(e){var t=uo().memoizedState;return function(e){Kr.flags|=4;var t=Kr.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Kr.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&fc)throw Error(a(440));return t.impl.apply(void 0,arguments)}}function Wo(e,t){return Uo(4,2,e,t)}function $o(e,t){return Uo(4,4,e,t)}function qo(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Yo(e,t,n){n=null!=n?n.concat([e]):null,Uo(4,4,qo.bind(null,t,e),n)}function Xo(){}function Qo(e,t){var n=uo();t=void 0===t?null:t;var a=n.memoizedState;return null!==t&&to(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function Zo(e,t){var n=uo();t=void 0===t?null:t;var a=n.memoizedState;if(null!==t&&to(t,a[1]))return a[0];if(a=e(),Yr){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[a,t],a}function Jo(e,t,n){return void 0===n||1073741824&Gr&&!(261930&vc)?e.memoizedState=t:(e.memoizedState=n,e=Yc(),Kr.lanes|=e,Cc|=e,n)}function ei(e,t,n,a){return ea(n,t)?n:null!==Tr.current?(e=Jo(e,n,a),ea(e,t)||(Di=!0),e):42&Gr&&(!(1073741824&Gr)||261930&vc)?(e=Yc(),Kr.lanes|=e,Cc|=e,t):(Di=!0,e.memoizedState=n)}function ti(e,t,n,a,s){var r=F.p;F.p=0!==r&&8>r?r:8;var o,i,l,c=O.T,d={};O.T=d,hi(e,!1,t,n);try{var u=s(),p=O.S;if(null!==p&&p(d,u),null!==u&&"object"==typeof u&&"function"==typeof u.then)pi(e,t,(o=a,i=[],l={status:"pending",value:null,reason:null,then:function(e){i.push(e)}},u.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<i.length;e++)(0,i[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<i.length;e++)(0,i[e])(void 0)}),l),qc());else pi(e,t,a,qc())}catch(h){pi(e,t,{then:function(){},status:"rejected",reason:h},qc())}finally{F.p=r,null!==c&&null!==d.types&&(c.types=d.types),O.T=c}}function ni(){}function ai(e,t,n,s){if(5!==e.tag)throw Error(a(476));var r=si(e).queue;ti(e,r,t,D,null===n?ni:function(){return ri(e),n(s)})}function si(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:D},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ri(e){var t=si(e);null===t.next&&(t=e.alternate.memoizedState),pi(e,t.next.queue,{},qc())}function oi(){return Fs(pp)}function ii(){return uo().memoizedState}function li(){return uo().memoizedState}function ci(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=qc(),a=wr(t,e=xr(n),n);return null!==a&&(Xc(a,t,n),kr(a,t,n)),t={cache:zs()},void(e.payload=t)}t=t.return}}function di(e,t,n){var a=qc();n={lane:a,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},mi(e)?fi(t,n):null!==(n=Fa(e,t,n,a))&&(Xc(n,e,a),yi(n,t,a))}function ui(e,t,n){pi(e,t,n,qc())}function pi(e,t,n,a){var s={lane:a,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(mi(e))fi(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var o=t.lastRenderedState,i=r(o,n);if(s.hasEagerState=!0,s.eagerState=i,ea(i,o))return Oa(e,t,s,0),null===yc&&_a(),!1}catch(l){}if(null!==(n=Fa(e,t,s,a)))return Xc(n,e,a),yi(n,t,a),!0}return!1}function hi(e,t,n,s){if(s={lane:2,revertLane:Kd(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},mi(e)){if(t)throw Error(a(479))}else null!==(t=Fa(e,n,s,2))&&Xc(t,e,2)}function mi(e){var t=e.alternate;return e===Kr||null!==t&&t===Kr}function fi(e,t){qr=$r=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function yi(e,t,n){if(4194048&n){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,Oe(e,n)}}var gi={readContext:Fs,use:ho,useCallback:eo,useContext:eo,useEffect:eo,useImperativeHandle:eo,useLayoutEffect:eo,useInsertionEffect:eo,useMemo:eo,useReducer:eo,useRef:eo,useState:eo,useDebugValue:eo,useDeferredValue:eo,useTransition:eo,useSyncExternalStore:eo,useId:eo,useHostTransitionStatus:eo,useFormState:eo,useActionState:eo,useOptimistic:eo,useMemoCache:eo,useCacheRefresh:eo};gi.useEffectEvent=eo;var vi={readContext:Fs,use:ho,useCallback:function(e,t){return co().memoizedState=[e,void 0===t?null:t],e},useContext:Fs,useEffect:Go,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,zo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){zo(4,2,e,t)},useMemo:function(e,t){var n=co();t=void 0===t?null:t;var a=e();if(Yr){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[a,t],a},useReducer:function(e,t,n){var a=co();if(void 0!==n){var s=n(t);if(Yr){ve(!0);try{n(t)}finally{ve(!1)}}}else s=t;return a.memoizedState=a.baseState=s,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},a.queue=e,e=e.dispatch=di.bind(null,Kr,e),[a.memoizedState,e]},useRef:function(e){return e={current:e},co().memoizedState=e},useState:function(e){var t=(e=No(e)).queue,n=ui.bind(null,Kr,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Xo,useDeferredValue:function(e,t){return Jo(co(),e,t)},useTransition:function(){var e=No(!1);return e=ti.bind(null,Kr,e.queue,!0,!1),co().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var s=Kr,r=co();if(hs){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===yc)throw Error(a(349));127&vc||xo(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Go(ko.bind(null,s,o,e),[e]),s.flags|=2048,Bo(9,{destroy:void 0},wo.bind(null,s,o,n,t),null),n},useId:function(){var e=co(),t=yc.identifierPrefix;if(hs){var n=rs;t="_"+t+"R_"+(n=(ss&~(1<<32-be(ss)-1)).toString(32)+n),0<(n=Xr++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Jr++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:oi,useFormState:Fo,useActionState:Fo,useOptimistic:function(e){var t=co();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=hi.bind(null,Kr,!0,n),n.dispatch=t,[e,t]},useMemoCache:mo,useCacheRefresh:function(){return co().memoizedState=ci.bind(null,Kr)},useEffectEvent:function(e){var t=co(),n={impl:e};return t.memoizedState=n,function(){if(2&fc)throw Error(a(440));return n.impl.apply(void 0,arguments)}}},bi={readContext:Fs,use:ho,useCallback:Qo,useContext:Fs,useEffect:Ko,useImperativeHandle:Yo,useInsertionEffect:Wo,useLayoutEffect:$o,useMemo:Zo,useReducer:yo,useRef:Vo,useState:function(){return yo(fo)},useDebugValue:Xo,useDeferredValue:function(e,t){return ei(uo(),Hr.memoizedState,e,t)},useTransition:function(){var e=yo(fo)[0],t=uo().memoizedState;return["boolean"==typeof e?e:po(e),t]},useSyncExternalStore:bo,useId:ii,useHostTransitionStatus:oi,useFormState:Do,useActionState:Do,useOptimistic:function(e,t){return Co(uo(),0,e,t)},useMemoCache:mo,useCacheRefresh:li};bi.useEffectEvent=Ho;var xi={readContext:Fs,use:ho,useCallback:Qo,useContext:Fs,useEffect:Ko,useImperativeHandle:Yo,useInsertionEffect:Wo,useLayoutEffect:$o,useMemo:Zo,useReducer:vo,useRef:Vo,useState:function(){return vo(fo)},useDebugValue:Xo,useDeferredValue:function(e,t){var n=uo();return null===Hr?Jo(n,e,t):ei(n,Hr.memoizedState,e,t)},useTransition:function(){var e=vo(fo)[0],t=uo().memoizedState;return["boolean"==typeof e?e:po(e),t]},useSyncExternalStore:bo,useId:ii,useHostTransitionStatus:oi,useFormState:Lo,useActionState:Lo,useOptimistic:function(e,t){var n=uo();return null!==Hr?Co(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:mo,useCacheRefresh:li};function wi(e,t,n,a){n=null==(n=n(a,t=e.memoizedState))?t:p({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}xi.useEffectEvent=Ho;var ki={enqueueSetState:function(e,t,n){e=e._reactInternals;var a=qc(),s=xr(a);s.payload=t,null!=n&&(s.callback=n),null!==(t=wr(e,s,a))&&(Xc(t,e,a),kr(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var a=qc(),s=xr(a);s.tag=1,s.payload=t,null!=n&&(s.callback=n),null!==(t=wr(e,s,a))&&(Xc(t,e,a),kr(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=qc(),a=xr(n);a.tag=2,null!=t&&(a.callback=t),null!==(t=wr(e,a,n))&&(Xc(t,e,n),kr(t,e,n))}};function Si(e,t,n,a,s,r,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(a,r,o):!t.prototype||!t.prototype.isPureReactComponent||(!ta(n,a)||!ta(s,r))}function Mi(e,t,n,a){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,a),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&ki.enqueueReplaceState(t,t.state,null)}function Ni(e,t){var n=t;if("ref"in t)for(var a in n={},t)"ref"!==a&&(n[a]=t[a]);if(e=e.defaultProps)for(var s in n===t&&(n=p({},n)),e)void 0===n[s]&&(n[s]=e[s]);return n}function Ci(e){Pa(e)}function Ei(e){}function Pi(e){Pa(e)}function Ti(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Ai(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function Ii(e,t,n){return(n=xr(n)).tag=3,n.payload={element:null},n.callback=function(){Ti(e,t)},n}function _i(e){return(e=xr(e)).tag=3,e}function Oi(e,t,n,a){var s=n.type.getDerivedStateFromError;if("function"==typeof s){var r=a.value;e.payload=function(){return s(r)},e.callback=function(){Ai(t,n,a)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){Ai(t,n,a),"function"!=typeof s&&(null===Lc?Lc=new Set([this]):Lc.add(this));var e=a.stack;this.componentDidCatch(a.value,{componentStack:null!==e?e:""})})}var Fi=Error(a(461)),Di=!1;function Ri(e,t,n,a){t.child=null===e?yr(t,null,n,a):fr(t,e.child,n,a)}function ji(e,t,n,a,s){n=n.render;var r=t.ref;if("ref"in a){var o={};for(var i in a)"ref"!==i&&(o[i]=a[i])}else o=a;return Os(t),a=no(e,t,n,o,r,s),i=oo(),null===e||Di?(hs&&i&&ls(t),t.flags|=1,Ri(e,t,a,s),t.child):(io(e,t,s),ol(e,t,s))}function Li(e,t,n,a,s){if(null===e){var r=n.type;return"function"!=typeof r||za(r)||void 0!==r.defaultProps||null!==n.compare?((e=Ka(n.type,null,a,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Bi(e,t,r,a,s))}if(r=e.child,!il(e,s)){var o=r.memoizedProps;if((n=null!==(n=n.compare)?n:ta)(o,a)&&e.ref===t.ref)return ol(e,t,s)}return t.flags|=1,(e=Ua(r,a)).ref=t.ref,e.return=t,t.child=e}function Bi(e,t,n,a,s){if(null!==e){var r=e.memoizedProps;if(ta(r,a)&&e.ref===t.ref){if(Di=!1,t.pendingProps=a=r,!il(e,s))return t.lanes=e.lanes,ol(e,t,s);131072&e.flags&&(Di=!0)}}return Wi(e,t,n,a,s)}function Vi(e,t,n,a){var s=a.children,r=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===a.mode){if(128&t.flags){if(r=null!==r?r.baseLanes|n:n,null!==e){for(a=t.child=e.child,s=0;null!==a;)s=s|a.lanes|a.childLanes,a=a.sibling;a=s&~r}else a=0,t.child=null;return Ui(e,t,r,n,a)}if(!(536870912&n))return a=t.lanes=536870912,Ui(e,t,null!==r?r.baseLanes|n:n,n,a);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Qs(0,null!==r?r.cachePool:null),null!==r?Ir(t,r):_r(),Lr(t)}else null!==r?(Qs(0,r.cachePool),Ir(t,r),Br(),t.memoizedState=null):(null!==e&&Qs(0,null),_r(),Br());return Ri(e,t,s,n),t.child}function zi(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ui(e,t,n,a,s){var r=Xs();return r=null===r?null:{parent:Vs._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Qs(0,null),_r(),Lr(t),null!==e&&Is(e,t,a,!0),t.childLanes=s,null}function Gi(e,t){return(t=tl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Ki(e,t,n){return fr(t,e.child,null,n),(e=Gi(t,t.pendingProps)).flags|=2,Vr(t),t.memoizedState=null,e}function Hi(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Wi(e,t,n,a,s){return Os(t),n=no(e,t,n,a,void 0,s),a=oo(),null===e||Di?(hs&&a&&ls(t),t.flags|=1,Ri(e,t,n,s),t.child):(io(e,t,s),ol(e,t,s))}function $i(e,t,n,a,s,r){return Os(t),t.updateQueue=null,n=so(t,a,n,s),ao(e),a=oo(),null===e||Di?(hs&&a&&ls(t),t.flags|=1,Ri(e,t,n,r),t.child):(io(e,t,r),ol(e,t,r))}function qi(e,t,n,a,s){if(Os(t),null===t.stateNode){var r=La,o=n.contextType;"object"==typeof o&&null!==o&&(r=Fs(o)),r=new n(a,r),t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=ki,t.stateNode=r,r._reactInternals=t,(r=t.stateNode).props=a,r.state=t.memoizedState,r.refs={},vr(t),o=n.contextType,r.context="object"==typeof o&&null!==o?Fs(o):La,r.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(wi(t,n,o,a),r.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(o=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),o!==r.state&&ki.enqueueReplaceState(r,r.state,null),Cr(t,a,r,s),Nr(),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308),a=!0}else if(null===e){r=t.stateNode;var i=t.memoizedProps,l=Ni(n,i);r.props=l;var c=r.context,d=n.contextType;o=La,"object"==typeof d&&null!==d&&(o=Fs(d));var u=n.getDerivedStateFromProps;d="function"==typeof u||"function"==typeof r.getSnapshotBeforeUpdate,i=t.pendingProps!==i,d||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(i||c!==o)&&Mi(t,r,a,o),gr=!1;var p=t.memoizedState;r.state=p,Cr(t,a,r,s),Nr(),c=t.memoizedState,i||p!==c||gr?("function"==typeof u&&(wi(t,n,u,a),c=t.memoizedState),(l=gr||Si(t,n,l,a,p,c,o))?(d||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4194308)):("function"==typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=c),r.props=a,r.state=c,r.context=o,a=l):("function"==typeof r.componentDidMount&&(t.flags|=4194308),a=!1)}else{r=t.stateNode,br(e,t),d=Ni(n,o=t.memoizedProps),r.props=d,u=t.pendingProps,p=r.context,c=n.contextType,l=La,"object"==typeof c&&null!==c&&(l=Fs(c)),(c="function"==typeof(i=n.getDerivedStateFromProps)||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o!==u||p!==l)&&Mi(t,r,a,l),gr=!1,p=t.memoizedState,r.state=p,Cr(t,a,r,s),Nr();var h=t.memoizedState;o!==u||p!==h||gr||null!==e&&null!==e.dependencies&&_s(e.dependencies)?("function"==typeof i&&(wi(t,n,i,a),h=t.memoizedState),(d=gr||Si(t,n,d,a,p,h,l)||null!==e&&null!==e.dependencies&&_s(e.dependencies))?(c||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(a,h,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(a,h,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=h),r.props=a,r.state=h,r.context=l,a=d):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),a=!1)}return r=a,Hi(e,t),a=!!(128&t.flags),r||a?(r=t.stateNode,n=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render(),t.flags|=1,null!==e&&a?(t.child=fr(t,e.child,null,s),t.child=fr(t,null,n,s)):Ri(e,t,n,s),t.memoizedState=r.state,e=t.child):e=ol(e,t,s),e}function Yi(e,t,n,a){return ws(),t.flags|=256,Ri(e,t,n,a),t.child}var Xi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qi(e){return{baseLanes:e,cachePool:Zs()}}function Zi(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Tc),e}function Ji(e,t,n){var s,r=t.pendingProps,o=!1,i=!!(128&t.flags);if((s=i)||(s=(null===e||null!==e.memoizedState)&&!!(2&zr.current)),s&&(o=!0,t.flags&=-129),s=!!(32&t.flags),t.flags&=-33,null===e){if(hs){if(o?Rr(t):Br(),(e=ps)?null!==(e=null!==(e=_u(e,fs))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==as?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(n=$a(e)).return=t,t.child=n,us=t,ps=null):e=null,null===e)throw gs(t);return Fu(e)?t.lanes=32:t.lanes=536870912,null}var l=r.children;return r=r.fallback,o?(Br(),l=tl({mode:"hidden",children:l},o=t.mode),r=Ha(r,o,n,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(r=t.child).memoizedState=Qi(n),r.childLanes=Zi(e,s,n),t.memoizedState=Xi,zi(null,r)):(Rr(t),el(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(i)256&t.flags?(Rr(t),t.flags&=-257,t=nl(e,t,n)):null!==t.memoizedState?(Br(),t.child=e.child,t.flags|=128,t=null):(Br(),l=r.fallback,o=t.mode,r=tl({mode:"visible",children:r.children},o),(l=Ha(l,o,n,null)).flags|=2,r.return=t,l.return=t,r.sibling=l,t.child=r,fr(t,e.child,null,n),(r=t.child).memoizedState=Qi(n),r.childLanes=Zi(e,s,n),t.memoizedState=Xi,t=zi(null,r));else if(Rr(t),Fu(l)){if(s=l.nextSibling&&l.nextSibling.dataset)var d=s.dgst;s=d,(r=Error(a(419))).stack="",r.digest=s,Ss({value:r,source:null,stack:null}),t=nl(e,t,n)}else if(Di||Is(e,t,n,!1),s=0!==(n&e.childLanes),Di||s){if(null!==(s=yc)&&(0!==(r=Fe(s,n))&&r!==c.retryLane))throw c.retryLane=r,Da(e,r),Xc(s,e,r),Fi;Ou(l)||ld(),t=nl(e,t,n)}else Ou(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ps=Du(l.nextSibling),us=t,hs=!0,ms=null,fs=!1,null!==e&&ds(t,e),(t=el(t,r.children)).flags|=4096);return t}return o?(Br(),l=r.fallback,o=t.mode,d=(c=e.child).sibling,(r=Ua(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==d?l=Ua(d,l):(l=Ha(l,o,n,null)).flags|=2,l.return=t,r.return=t,r.sibling=l,t.child=r,zi(null,r),r=t.child,null===(l=e.child.memoizedState)?l=Qi(n):(null!==(o=l.cachePool)?(c=Vs._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=Zs(),l={baseLanes:l.baseLanes|n,cachePool:o}),r.memoizedState=l,r.childLanes=Zi(e,s,n),t.memoizedState=Xi,zi(e.child,r)):(Rr(t),e=(n=e.child).sibling,(n=Ua(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function el(e,t){return(t=tl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function tl(e,t){return(e=Va(22,e,null,t)).lanes=0,e}function nl(e,t,n){return fr(t,e.child,null,n),(e=el(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function al(e,t,n){e.lanes|=t;var a=e.alternate;null!==a&&(a.lanes|=t),Ts(e.return,t,n)}function sl(e,t,n,a,s,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:s,treeForkCount:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=a,o.tail=n,o.tailMode=s,o.treeForkCount=r)}function rl(e,t,n){var a=t.pendingProps,s=a.revealOrder,r=a.tail;a=a.children;var o=zr.current,i=!!(2&o);if(i?(o=1&o|2,t.flags|=128):o&=1,V(zr,o),Ri(e,t,a,n),a=hs?es:0,!i&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&al(e,n,t);else if(19===e.tag)al(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===Ur(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),sl(t,!1,s,n,r,a);break;case"backwards":case"unstable_legacy-backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Ur(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}sl(t,!0,n,null,r,a);break;case"together":sl(t,!1,null,null,void 0,a);break;default:t.memoizedState=null}return t.child}function ol(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Is(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ua(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ua(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function il(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!_s(e))}function ll(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Di=!0;else{if(!(il(e,n)||128&t.flags))return Di=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),Es(0,Vs,e.memoizedState.cache),ws();break;case 27:case 5:Y(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:Es(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,jr(t),null;break;case 13:var a=t.memoizedState;if(null!==a)return null!==a.dehydrated?(Rr(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ji(e,t,n):(Rr(t),null!==(e=ol(e,t,n))?e.sibling:null);Rr(t);break;case 19:var s=!!(128&e.flags);if((a=0!==(n&t.childLanes))||(Is(e,t,n,!1),a=0!==(n&t.childLanes)),s){if(a)return rl(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),V(zr,zr.current),a)break;return null;case 22:return t.lanes=0,Vi(e,t,n,t.pendingProps);case 24:Es(0,Vs,e.memoizedState.cache)}return ol(e,t,n)}(e,t,n);Di=!!(131072&e.flags)}else Di=!1,hs&&1048576&t.flags&&is(t,es,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=rr(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var r=e.$$typeof;if(r===w){t.tag=11,t=ji(null,t,e,s,n);break e}if(r===M){t.tag=14,t=Li(null,t,e,s,n);break e}}throw t=I(e)||e,Error(a(306,t,""))}za(e)?(s=Ni(e,s),t.tag=1,t=qi(null,t,e,s,n)):(t.tag=0,t=Wi(null,t,e,s,n))}return t;case 0:return Wi(e,t,t.type,t.pendingProps,n);case 1:return qi(e,t,s=t.type,r=Ni(s,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(a(387));s=t.pendingProps;var o=t.memoizedState;r=o.element,br(e,t),Cr(t,s,null,n);var i=t.memoizedState;if(s=i.cache,Es(0,Vs,s),s!==o.cache&&As(t,[Vs],n,!0),Nr(),s=i.element,o.isDehydrated){if(o={element:s,isDehydrated:!1,cache:i.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Yi(e,t,s,n);break e}if(s!==r){Ss(r=Xa(Error(a(424)),t)),t=Yi(e,t,s,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ps=Du(e.firstChild),us=t,hs=!0,ms=null,fs=!0,n=yr(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ws(),s===r){t=ol(e,t,n);break e}Ri(e,t,s,n)}t=t.child}return t;case 26:return Hi(e,t),null===e?(n=$u(t.type,null,t.pendingProps,null))?t.memoizedState=n:hs||(n=t.type,e=t.pendingProps,(s=vu(H.current).createElement(n))[Ve]=t,s[ze]=e,mu(s,n,e),Je(s),t.stateNode=s):t.memoizedState=$u(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Y(t),null===e&&hs&&(s=t.stateNode=Bu(t.type,t.pendingProps,H.current),us=t,fs=!0,r=ps,Pu(t.type)?(Ru=r,ps=Du(s.firstChild)):ps=r),Ri(e,t,t.pendingProps.children,n),Hi(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&hs&&((r=s=ps)&&(null!==(s=function(e,t,n,a){for(;1===e.nodeType;){var s=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!a&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(a){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(r=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(r!==s.rel||e.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||e.getAttribute("title")!==(null==s.title?null:s.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((r=e.getAttribute("src"))!==(null==s.src?null:s.src)||e.getAttribute("type")!==(null==s.type?null:s.type)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&r&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var r=null==s.name?null:""+s.name;if("hidden"===s.type&&e.getAttribute("name")===r)return e}if(null===(e=Du(e.nextSibling)))break}return null}(s,t.type,t.pendingProps,fs))?(t.stateNode=s,us=t,ps=Du(s.firstChild),fs=!1,r=!0):r=!1),r||gs(t)),Y(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,wu(r,o)?s=null:null!==i&&wu(r,i)&&(t.flags|=32),null!==t.memoizedState&&(r=no(e,t,ro,null,null,n),pp._currentValue=r),Hi(e,t),Ri(e,t,s,n),t.child;case 6:return null===e&&hs&&((e=n=ps)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Du(e.nextSibling)))return null}return e}(n,t.pendingProps,fs))?(t.stateNode=n,us=t,ps=null,e=!0):e=!1),e||gs(t)),null;case 13:return Ji(e,t,n);case 4:return $(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=fr(t,null,s,n):Ri(e,t,s,n),t.child;case 11:return ji(e,t,t.type,t.pendingProps,n);case 7:return Ri(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ri(e,t,t.pendingProps.children,n),t.child;case 10:return s=t.pendingProps,Es(0,t.type,s.value),Ri(e,t,s.children,n),t.child;case 9:return r=t.type._context,s=t.pendingProps.children,Os(t),s=s(r=Fs(r)),t.flags|=1,Ri(e,t,s,n),t.child;case 14:return Li(e,t,t.type,t.pendingProps,n);case 15:return Bi(e,t,t.type,t.pendingProps,n);case 19:return rl(e,t,n);case 31:return function(e,t,n){var s=t.pendingProps,r=!!(128&t.flags);if(t.flags&=-129,null===e){if(hs){if("hidden"===s.mode)return e=Gi(t,s),t.lanes=536870912,zi(null,e);if(jr(t),(e=ps)?null!==(e=null!==(e=_u(e,fs))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==as?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(n=$a(e)).return=t,t.child=n,us=t,ps=null):e=null,null===e)throw gs(t);return t.lanes=536870912,null}return Gi(t,s)}var o=e.memoizedState;if(null!==o){var i=o.dehydrated;if(jr(t),r)if(256&t.flags)t.flags&=-257,t=Ki(e,t,n);else{if(null===t.memoizedState)throw Error(a(558));t.child=e.child,t.flags|=128,t=null}else if(Di||Is(e,t,n,!1),r=0!==(n&e.childLanes),Di||r){if(null!==(s=yc)&&0!==(i=Fe(s,n))&&i!==o.retryLane)throw o.retryLane=i,Da(e,i),Xc(s,e,i),Fi;ld(),t=Ki(e,t,n)}else e=o.treeContext,ps=Du(i.nextSibling),us=t,hs=!0,ms=null,fs=!1,null!==e&&ds(t,e),(t=Gi(t,s)).flags|=4096;return t}return(e=Ua(e.child,{mode:s.mode,children:s.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Vi(e,t,n,t.pendingProps);case 24:return Os(t),s=Fs(Vs),null===e?(null===(r=Xs())&&(r=yc,o=zs(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=n),r=o),t.memoizedState={parent:s,cache:r},vr(t),Es(0,Vs,r)):(0!==(e.lanes&n)&&(br(e,t),Cr(t,null,null,n),Nr()),r=e.memoizedState,o=t.memoizedState,r.parent!==s?(r={parent:s,cache:s},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),Es(0,Vs,s)):(s=o.cache,Es(0,Vs,s),s!==r.cache&&As(t,[Vs],n,!0))),Ri(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function cl(e){e.flags|=4}function dl(e,t,n,a,s){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&s)===s)if(e.stateNode.complete)e.flags|=8192;else{if(!rd())throw or=nr,er;e.flags|=8192}}else e.flags&=-16777217}function ul(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!op(t)){if(!rd())throw or=nr,er;e.flags|=8192}}function pl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Te():536870912,e.lanes|=t,Ac|=t)}function hl(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;null!==n;)null!==n.alternate&&(a=n),n=n.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function ml(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,a=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=65011712&s.subtreeFlags,a|=65011712&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=s.subtreeFlags,a|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=a,e.childLanes=n,t}function fl(e,t,n){var s=t.pendingProps;switch(cs(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return ml(t),null;case 3:return n=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Ps(Vs),q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(xs(t)?cl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,ks())),ml(t),null;case 26:var r=t.type,o=t.memoizedState;return null===e?(cl(t),null!==o?(ml(t),ul(t,o)):(ml(t),dl(t,r,0,0,n))):o?o!==e.memoizedState?(cl(t),ml(t),ul(t,o)):(ml(t),t.flags&=-16777217):((e=e.memoizedProps)!==s&&cl(t),ml(t),dl(t,r,0,0,n)),null;case 27:if(X(t),n=H.current,r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return ml(t),null}e=G.current,xs(t)?vs(t):(e=Bu(r,s,n),t.stateNode=e,cl(t))}return ml(t),null;case 5:if(X(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return ml(t),null}if(o=G.current,xs(t))vs(t);else{var i=vu(H.current);switch(o){case 1:o=i.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:o=i.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":o=i.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":o=i.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(o=i.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o="string"==typeof s.is?i.createElement("select",{is:s.is}):i.createElement("select"),s.multiple?o.multiple=!0:s.size&&(o.size=s.size);break;default:o="string"==typeof s.is?i.createElement(r,{is:s.is}):i.createElement(r)}}o[Ve]=t,o[ze]=s;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)o.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=o;e:switch(mu(o,r,s),r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&cl(t)}}return ml(t),dl(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if("string"!=typeof s&&null===t.stateNode)throw Error(a(166));if(e=H.current,xs(t)){if(e=t.stateNode,n=t.memoizedProps,s=null,null!==(r=us))switch(r.tag){case 27:case 5:s=r.memoizedProps}e[Ve]=t,(e=!!(e.nodeValue===n||null!==s&&!0===s.suppressHydrationWarning||uu(e.nodeValue,n)))||gs(t,!0)}else(e=vu(e).createTextNode(s))[Ve]=t,t.stateNode=e}return ml(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(s=xs(t),null!==n){if(null===e){if(!s)throw Error(a(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(557));e[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),e=!1}else n=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(Vr(t),t):(Vr(t),null);if(128&t.flags)throw Error(a(558))}return ml(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=xs(t),null!==s&&null!==s.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),r=!1}else r=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(Vr(t),t):(Vr(t),null)}return Vr(t),128&t.flags?(t.lanes=n,t):(n=null!==s,e=null!==e&&null!==e.memoizedState,n&&(r=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(r=s.alternate.memoizedState.cachePool.pool),o=null,null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(o=s.memoizedState.cachePool.pool),o!==r&&(s.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),pl(t,t.updateQueue),ml(t),null);case 4:return q(),null===e&&tu(t.stateNode.containerInfo),ml(t),null;case 10:return Ps(t.type),ml(t),null;case 19:if(B(zr),null===(s=t.memoizedState))return ml(t),null;if(r=!!(128&t.flags),null===(o=s.rendering))if(r)hl(s,!1);else{if(0!==Nc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Ur(e))){for(t.flags|=128,hl(s,!1),e=o.updateQueue,t.updateQueue=e,pl(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ga(n,e),n=n.sibling;return V(zr,1&zr.current|2),hs&&os(t,s.treeForkCount),t.child}e=e.sibling}null!==s.tail&&ie()>Rc&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ur(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,pl(t,e),hl(s,!0),null===s.tail&&"hidden"===s.tailMode&&!o.alternate&&!hs)return ml(t),null}else 2*ie()-s.renderingStartTime>Rc&&536870912!==n&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=s.last)?e.sibling=o:t.child=o,s.last=o)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ie(),e.sibling=null,n=zr.current,V(zr,r?1&n|2:1&n),hs&&os(t,s.treeForkCount),e):(ml(t),null);case 22:case 23:return Vr(t),Or(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?!!(536870912&n)&&!(128&t.flags)&&(ml(t),6&t.subtreeFlags&&(t.flags|=8192)):ml(t),null!==(n=t.updateQueue)&&pl(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==n&&(t.flags|=2048),null!==e&&B(Ys),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Ps(Vs),ml(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function yl(e,t){switch(cs(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ps(Vs),q(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return X(t),null;case 31:if(null!==t.memoizedState){if(Vr(t),null===t.alternate)throw Error(a(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Vr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(zr),null;case 4:return q(),null;case 10:return Ps(t.type),null;case 22:case 23:return Vr(t),Or(),null!==e&&B(Ys),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Ps(Vs),null;default:return null}}function gl(e,t){switch(cs(t),t.tag){case 3:Ps(Vs),q();break;case 26:case 27:case 5:X(t);break;case 4:q();break;case 31:null!==t.memoizedState&&Vr(t);break;case 13:Vr(t);break;case 19:B(zr);break;case 10:Ps(t.type);break;case 22:case 23:Vr(t),Or(),null!==e&&B(Ys);break;case 24:Ps(Vs)}}function vl(e,t){try{var n=t.updateQueue,a=null!==n?n.lastEffect:null;if(null!==a){var s=a.next;n=s;do{if((n.tag&e)===e){a=void 0;var r=n.create,o=n.inst;a=r(),o.destroy=a}n=n.next}while(n!==s)}}catch(i){Nd(t,t.return,i)}}function bl(e,t,n){try{var a=t.updateQueue,s=null!==a?a.lastEffect:null;if(null!==s){var r=s.next;a=r;do{if((a.tag&e)===e){var o=a.inst,i=o.destroy;if(void 0!==i){o.destroy=void 0,s=t;var l=n,c=i;try{c()}catch(d){Nd(s,l,d)}}}a=a.next}while(a!==r)}}catch(d){Nd(t,t.return,d)}}function xl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Pr(t,n)}catch(a){Nd(e,e.return,a)}}}function wl(e,t,n){n.props=Ni(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(a){Nd(e,t,a)}}function kl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var a=e.stateNode;break;default:a=e.stateNode}"function"==typeof n?e.refCleanup=n(a):n.current=a}}catch(s){Nd(e,t,s)}}function Sl(e,t){var n=e.ref,a=e.refCleanup;if(null!==n)if("function"==typeof a)try{a()}catch(s){Nd(e,t,s)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(r){Nd(e,t,r)}else n.current=null}function Ml(e){var t=e.type,n=e.memoizedProps,a=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&a.focus();break e;case"img":n.src?a.src=n.src:n.srcSet&&(a.srcset=n.srcSet)}}catch(s){Nd(e,e.return,s)}}function Nl(e,t,n){try{var s=e.stateNode;!function(e,t,n,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,i=null,l=null,c=null,d=null,u=null;for(m in n){var p=n[m];if(n.hasOwnProperty(m)&&null!=p)switch(m){case"checked":case"value":break;case"defaultValue":c=p;default:s.hasOwnProperty(m)||pu(e,t,m,null,s,p)}}for(var h in s){var m=s[h];if(p=n[h],s.hasOwnProperty(h)&&(null!=m||null!=p))switch(h){case"type":o=m;break;case"name":r=m;break;case"checked":d=m;break;case"defaultChecked":u=m;break;case"value":i=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(a(137,t));break;default:m!==p&&pu(e,t,h,m,s,p)}}return void gt(e,i,l,c,d,u,o,r);case"select":for(o in m=i=l=h=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":m=c;default:s.hasOwnProperty(o)||pu(e,t,o,null,s,c)}for(r in s)if(o=s[r],c=n[r],s.hasOwnProperty(r)&&(null!=o||null!=c))switch(r){case"value":h=o;break;case"defaultValue":l=o;break;case"multiple":i=o;default:o!==c&&pu(e,t,r,o,s,c)}return t=l,n=i,s=m,void(null!=h?xt(e,!!n,h,!1):!!s!=!!n&&(null!=t?xt(e,!!n,t,!0):xt(e,!!n,n?[]:"",!1)));case"textarea":for(l in m=h=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!s.hasOwnProperty(l))switch(l){case"value":case"children":break;default:pu(e,t,l,null,s,r)}for(i in s)if(r=s[i],o=n[i],s.hasOwnProperty(i)&&(null!=r||null!=o))switch(i){case"value":h=r;break;case"defaultValue":m=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==o&&pu(e,t,i,r,s,o)}return void wt(e,h,m);case"option":for(var f in n)if(h=n[f],n.hasOwnProperty(f)&&null!=h&&!s.hasOwnProperty(f))if("selected"===f)e.selected=!1;else pu(e,t,f,null,s,h);for(c in s)if(h=s[c],m=n[c],s.hasOwnProperty(c)&&h!==m&&(null!=h||null!=m))if("selected"===c)e.selected=h&&"function"!=typeof h&&"symbol"!=typeof h;else pu(e,t,c,h,s,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var y in n)h=n[y],n.hasOwnProperty(y)&&null!=h&&!s.hasOwnProperty(y)&&pu(e,t,y,null,s,h);for(d in s)if(h=s[d],m=n[d],s.hasOwnProperty(d)&&h!==m&&(null!=h||null!=m))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(a(137,t));break;default:pu(e,t,d,h,s,m)}return;default:if(Et(t)){for(var g in n)h=n[g],n.hasOwnProperty(g)&&void 0!==h&&!s.hasOwnProperty(g)&&hu(e,t,g,void 0,s,h);for(u in s)h=s[u],m=n[u],!s.hasOwnProperty(u)||h===m||void 0===h&&void 0===m||hu(e,t,u,h,s,m);return}}for(var v in n)h=n[v],n.hasOwnProperty(v)&&null!=h&&!s.hasOwnProperty(v)&&pu(e,t,v,null,s,h);for(p in s)h=s[p],m=n[p],!s.hasOwnProperty(p)||h===m||null==h&&null==m||pu(e,t,p,h,s,m)}(s,e.type,n,t),s[ze]=t}catch(r){Nd(e,e.return,r)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Pu(e.type)||4===e.tag}function El(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Pu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Pl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=It));else if(4!==a&&(27===a&&Pu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Pl(e,t,n),e=e.sibling;null!==e;)Pl(e,t,n),e=e.sibling}function Tl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==a&&(27===a&&Pu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Tl(e,t,n),e=e.sibling;null!==e;)Tl(e,t,n),e=e.sibling}function Al(e){var t=e.stateNode,n=e.memoizedProps;try{for(var a=e.type,s=t.attributes;s.length;)t.removeAttributeNode(s[0]);mu(t,a,n),t[Ve]=e,t[ze]=n}catch(r){Nd(e,e.return,r)}}var Il=!1,_l=!1,Ol=!1,Fl="function"==typeof WeakSet?WeakSet:Set,Dl=null;function Rl(e,t,n){var a=n.flags;switch(n.tag){case 0:case 11:case 15:Xl(e,n),4&a&&vl(5,n);break;case 1:if(Xl(e,n),4&a)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){Nd(n,n.return,o)}else{var s=Ni(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(s,t,e.__reactInternalSnapshotBeforeUpdate)}catch(i){Nd(n,n.return,i)}}64&a&&xl(n),512&a&&kl(n,n.return);break;case 3:if(Xl(e,n),64&a&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Pr(e,t)}catch(o){Nd(n,n.return,o)}}break;case 27:null===t&&4&a&&Al(n);case 26:case 5:Xl(e,n),null===t&&4&a&&Ml(n),512&a&&kl(n,n.return);break;case 12:Xl(e,n);break;case 31:Xl(e,n),4&a&&Ul(e,n);break;case 13:Xl(e,n),4&a&&Gl(e,n),64&a&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var a=function(){t(),n.removeEventListener("DOMContentLoaded",a)};n.addEventListener("DOMContentLoaded",a),e._reactRetry=a}}(e,n=Td.bind(null,n))));break;case 22:if(!(a=null!==n.memoizedState||Il)){t=null!==t&&null!==t.memoizedState||_l,s=Il;var r=_l;Il=a,(_l=t)&&!r?Zl(e,n,!!(8772&n.subtreeFlags)):Xl(e,n),Il=s,_l=r}break;case 30:break;default:Xl(e,n)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ll=null,Bl=!1;function Vl(e,t,n){for(n=n.child;null!==n;)zl(e,t,n),n=n.sibling}function zl(e,t,n){if(ge&&"function"==typeof ge.onCommitFiberUnmount)try{ge.onCommitFiberUnmount(ye,n)}catch(r){}switch(n.tag){case 26:_l||Sl(n,t),Vl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:_l||Sl(n,t);var a=Ll,s=Bl;Pu(n.type)&&(Ll=n.stateNode,Bl=!1),Vl(e,t,n),Vu(n.stateNode),Ll=a,Bl=s;break;case 5:_l||Sl(n,t);case 6:if(a=Ll,s=Bl,Ll=null,Vl(e,t,n),Bl=s,null!==(Ll=a))if(Bl)try{(9===Ll.nodeType?Ll.body:"HTML"===Ll.nodeName?Ll.ownerDocument.body:Ll).removeChild(n.stateNode)}catch(o){Nd(n,t,o)}else try{Ll.removeChild(n.stateNode)}catch(o){Nd(n,t,o)}break;case 18:null!==Ll&&(Bl?(Tu(9===(e=Ll).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Wp(e)):Tu(Ll,n.stateNode));break;case 4:a=Ll,s=Bl,Ll=n.stateNode.containerInfo,Bl=!0,Vl(e,t,n),Ll=a,Bl=s;break;case 0:case 11:case 14:case 15:bl(2,n,t),_l||bl(4,n,t),Vl(e,t,n);break;case 1:_l||(Sl(n,t),"function"==typeof(a=n.stateNode).componentWillUnmount&&wl(n,t,a)),Vl(e,t,n);break;case 21:Vl(e,t,n);break;case 22:_l=(a=_l)||null!==n.memoizedState,Vl(e,t,n),_l=a;break;default:Vl(e,t,n)}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Wp(e)}catch(n){Nd(t,t.return,n)}}}function Gl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Wp(e)}catch(n){Nd(t,t.return,n)}}function Kl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Fl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Fl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var a=Ad.bind(null,e,t);t.then(a,a)}})}function Hl(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var r=n[s],o=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 27:if(Pu(l.type)){Ll=l.stateNode,Bl=!1;break e}break;case 5:Ll=l.stateNode,Bl=!1;break e;case 3:case 4:Ll=l.stateNode.containerInfo,Bl=!0;break e}l=l.return}if(null===Ll)throw Error(a(160));zl(o,i,r),Ll=null,Bl=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)$l(t,e),t=t.sibling}var Wl=null;function $l(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Hl(t,e),ql(e),4&s&&(bl(3,e,e.return),vl(3,e),bl(5,e,e.return));break;case 1:Hl(t,e),ql(e),512&s&&(_l||null===n||Sl(n,n.return)),64&s&&Il&&(null!==(e=e.updateQueue)&&(null!==(s=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?s:n.concat(s))));break;case 26:var r=Wl;if(Hl(t,e),ql(e),512&s&&(_l||null===n||Sl(n,n.return)),4&s){var o=null!==n?n.memoizedState:null;if(s=e.memoizedState,null===n)if(null===s)if(null===e.stateNode){e:{s=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(s){case"title":(!(o=r.getElementsByTagName("title")[0])||o[$e]||o[Ve]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(s),r.head.insertBefore(o,r.querySelector("head > title"))),mu(o,s,n),o[Ve]=e,Je(o),s=o;break e;case"link":var i=sp("link","href",r).get(s+(n.href||""));if(i)for(var l=0;l<i.length;l++)if((o=i[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){i.splice(l,1);break t}mu(o=r.createElement(s),s,n),r.head.appendChild(o);break;case"meta":if(i=sp("meta","content",r).get(s+(n.content||"")))for(l=0;l<i.length;l++)if((o=i[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){i.splice(l,1);break t}mu(o=r.createElement(s),s,n),r.head.appendChild(o);break;default:throw Error(a(468,s))}o[Ve]=e,Je(o),s=o}e.stateNode=s}else rp(r,e.type,e.stateNode);else e.stateNode=Ju(r,s,e.memoizedProps);else o!==s?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===s?rp(r,e.type,e.stateNode):Ju(r,s,e.memoizedProps)):null===s&&null!==e.stateNode&&Nl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Hl(t,e),ql(e),512&s&&(_l||null===n||Sl(n,n.return)),null!==n&&4&s&&Nl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Hl(t,e),ql(e),512&s&&(_l||null===n||Sl(n,n.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(f){Nd(e,e.return,f)}}4&s&&null!=e.stateNode&&Nl(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&s&&(Ol=!0);break;case 6:if(Hl(t,e),ql(e),4&s){if(null===e.stateNode)throw Error(a(162));s=e.memoizedProps,n=e.stateNode;try{n.nodeValue=s}catch(f){Nd(e,e.return,f)}}break;case 3:if(ap=null,r=Wl,Wl=Gu(t.containerInfo),Hl(t,e),Wl=r,ql(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Wp(t.containerInfo)}catch(f){Nd(e,e.return,f)}Ol&&(Ol=!1,Yl(e));break;case 4:s=Wl,Wl=Gu(e.stateNode.containerInfo),Hl(t,e),ql(e),Wl=s;break;case 12:default:Hl(t,e),ql(e);break;case 31:case 19:Hl(t,e),ql(e),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Kl(e,s)));break;case 13:Hl(t,e),ql(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Fc=ie()),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Kl(e,s)));break;case 22:r=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,d=Il,u=_l;if(Il=d||r,_l=u||c,Hl(t,e),_l=u,Il=d,ql(e),8192&s)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||c||Il||_l||Ql(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,r)"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{l=c.stateNode;var p=c.memoizedProps.style,h=null!=p&&p.hasOwnProperty("display")?p.display:null;l.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(f){Nd(c,c.return,f)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(f){Nd(c,c.return,f)}}}else if(18===t.tag){if(null===n){c=t;try{var m=c.stateNode;r?Au(m,!0):Au(c.stateNode,!1)}catch(f){Nd(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&s&&(null!==(s=e.updateQueue)&&(null!==(n=s.retryQueue)&&(s.retryQueue=null,Kl(e,n))));case 30:case 21:}}function ql(e){var t=e.flags;if(2&t){try{for(var n,s=e.return;null!==s;){if(Cl(s)){n=s;break}s=s.return}if(null==n)throw Error(a(160));switch(n.tag){case 27:var r=n.stateNode;Tl(e,El(e),r);break;case 5:var o=n.stateNode;32&n.flags&&(St(o,""),n.flags&=-33),Tl(e,El(e),o);break;case 3:case 4:var i=n.stateNode.containerInfo;Pl(e,El(e),i);break;default:throw Error(a(161))}}catch(l){Nd(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Yl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Yl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Xl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Rl(e,t.alternate,t),t=t.sibling}function Ql(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:bl(4,t,t.return),Ql(t);break;case 1:Sl(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&wl(t,t.return,n),Ql(t);break;case 27:Vu(t.stateNode);case 26:case 5:Sl(t,t.return),Ql(t);break;case 22:null===t.memoizedState&&Ql(t);break;default:Ql(t)}e=e.sibling}}function Zl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var a=t.alternate,s=e,r=t,o=r.flags;switch(r.tag){case 0:case 11:case 15:Zl(s,r,n),vl(4,r);break;case 1:if(Zl(s,r,n),"function"==typeof(s=(a=r).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){Nd(a,a.return,c)}if(null!==(s=(a=r).updateQueue)){var i=a.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)Er(l[s],i)}catch(c){Nd(a,a.return,c)}}n&&64&o&&xl(r),kl(r,r.return);break;case 27:Al(r);case 26:case 5:Zl(s,r,n),n&&null===a&&4&o&&Ml(r),kl(r,r.return);break;case 12:Zl(s,r,n);break;case 31:Zl(s,r,n),n&&4&o&&Ul(s,r);break;case 13:Zl(s,r,n),n&&4&o&&Gl(s,r);break;case 22:null===r.memoizedState&&Zl(s,r,n),kl(r,r.return);break;case 30:break;default:Zl(s,r,n)}t=t.sibling}}function Jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Us(n))}function ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e))}function tc(e,t,n,a){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)nc(e,t,n,a),t=t.sibling}function nc(e,t,n,a){var s=t.flags;switch(t.tag){case 0:case 11:case 15:tc(e,t,n,a),2048&s&&vl(9,t);break;case 1:case 31:case 13:default:tc(e,t,n,a);break;case 3:tc(e,t,n,a),2048&s&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e)));break;case 12:if(2048&s){tc(e,t,n,a),e=t.stateNode;try{var r=t.memoizedProps,o=r.id,i=r.onPostCommit;"function"==typeof i&&i(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Nd(t,t.return,l)}}else tc(e,t,n,a);break;case 23:break;case 22:r=t.stateNode,o=t.alternate,null!==t.memoizedState?2&r._visibility?tc(e,t,n,a):sc(e,t):2&r._visibility?tc(e,t,n,a):(r._visibility|=2,ac(e,t,n,a,!!(10256&t.subtreeFlags)||!1)),2048&s&&Jl(o,t);break;case 24:tc(e,t,n,a),2048&s&&ec(t.alternate,t)}}function ac(e,t,n,a,s){for(s=s&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var r=e,o=t,i=n,l=a,c=o.flags;switch(o.tag){case 0:case 11:case 15:ac(r,o,i,l,s),vl(8,o);break;case 23:break;case 22:var d=o.stateNode;null!==o.memoizedState?2&d._visibility?ac(r,o,i,l,s):sc(r,o):(d._visibility|=2,ac(r,o,i,l,s)),s&&2048&c&&Jl(o.alternate,o);break;case 24:ac(r,o,i,l,s),s&&2048&c&&ec(o.alternate,o);break;default:ac(r,o,i,l,s)}t=t.sibling}}function sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,a=t,s=a.flags;switch(a.tag){case 22:sc(n,a),2048&s&&Jl(a.alternate,a);break;case 24:sc(n,a),2048&s&&ec(a.alternate,a);break;default:sc(n,a)}t=t.sibling}}var rc=8192;function oc(e,t,n){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)ic(e,t,n),e=e.sibling}function ic(e,t,n){switch(e.tag){case 26:oc(e,t,n),e.flags&rc&&null!==e.memoizedState&&function(e,t,n,a){if(!("stylesheet"!==n.type||"string"==typeof a.media&&!1===matchMedia(a.media).matches||4&n.state.loading)){if(null===n.instance){var s=qu(a.href),r=t.querySelector(Yu(s));if(r)return null!==(t=r._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=lp.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=r,void Je(r);r=t.ownerDocument||t,a=Xu(a),(s=zu.get(s))&&tp(a,s),Je(r=r.createElement("link"));var o=r;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),mu(r,"link",a),n.instance=r}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=lp.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Wl,e.memoizedState,e.memoizedProps);break;case 5:default:oc(e,t,n);break;case 3:case 4:var a=Wl;Wl=Gu(e.stateNode.containerInfo),oc(e,t,n),Wl=a;break;case 22:null===e.memoizedState&&(null!==(a=e.alternate)&&null!==a.memoizedState?(a=rc,rc=16777216,oc(e,t,n),rc=a):oc(e,t,n))}}function lc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];Dl=a,pc(a,e)}lc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)dc(e),e=e.sibling}function dc(e){switch(e.tag){case 0:case 11:case 15:cc(e),2048&e.flags&&bl(9,e,e.return);break;case 3:case 12:default:cc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,uc(e)):cc(e)}}function uc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];Dl=a,pc(a,e)}lc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:bl(8,t,t.return),uc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,uc(t));break;default:uc(t)}e=e.sibling}}function pc(e,t){for(;null!==Dl;){var n=Dl;switch(n.tag){case 0:case 11:case 15:bl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var a=n.memoizedState.cachePool.pool;null!=a&&a.refCount++}break;case 24:Us(n.memoizedState.cache)}if(null!==(a=n.child))a.return=n,Dl=a;else e:for(n=e;null!==Dl;){var s=(a=Dl).sibling,r=a.return;if(jl(a),a===n){Dl=null;break e}if(null!==s){s.return=r,Dl=s;break e}Dl=r}}}var hc={getCacheForType:function(e){var t=Fs(Vs),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Fs(Vs).controller.signal}},mc="function"==typeof WeakMap?WeakMap:Map,fc=0,yc=null,gc=null,vc=0,bc=0,xc=null,wc=!1,kc=!1,Sc=!1,Mc=0,Nc=0,Cc=0,Ec=0,Pc=0,Tc=0,Ac=0,Ic=null,_c=null,Oc=!1,Fc=0,Dc=0,Rc=1/0,jc=null,Lc=null,Bc=0,Vc=null,zc=null,Uc=0,Gc=0,Kc=null,Hc=null,Wc=0,$c=null;function qc(){return 2&fc&&0!==vc?vc&-vc:null!==O.T?Kd():je()}function Yc(){if(0===Tc)if(536870912&vc&&!hs)Tc=536870912;else{var e=Se;!(3932160&(Se<<=1))&&(Se=262144),Tc=e}return null!==(e=Fr.current)&&(e.flags|=32),Tc}function Xc(e,t,n){(e!==yc||2!==bc&&9!==bc)&&null===e.cancelPendingCommit||(ad(e,0),ed(e,vc,Tc,!1)),Ie(e,n),2&fc&&e===yc||(e===yc&&(!(2&fc)&&(Ec|=n),4===Nc&&ed(e,vc,Tc,!1)),jd(e))}function Qc(e,t,n){if(6&fc)throw Error(a(327));for(var s=!n&&!(127&t)&&0===(t&e.expiredLanes)||Ee(e,t),r=s?function(e,t){var n=fc;fc|=2;var s=od(),r=id();yc!==e||vc!==t?(jc=null,Rc=ie()+500,ad(e,t)):kc=Ee(e,t);e:for(;;)try{if(0!==bc&&null!==gc){t=gc;var o=xc;t:switch(bc){case 1:bc=0,xc=null,md(e,t,o,1);break;case 2:case 9:if(ar(o)){bc=0,xc=null,hd(t);break}t=function(){2!==bc&&9!==bc||yc!==e||(bc=7),jd(e)},o.then(t,t);break e;case 3:bc=7;break e;case 4:bc=5;break e;case 7:ar(o)?(bc=0,xc=null,hd(t)):(bc=0,xc=null,md(e,t,o,7));break;case 5:var i=null;switch(gc.tag){case 26:i=gc.memoizedState;case 5:case 27:var l=gc;if(i?op(i):l.stateNode.complete){bc=0,xc=null;var c=l.sibling;if(null!==c)gc=c;else{var d=l.return;null!==d?(gc=d,fd(d)):gc=null}break t}}bc=0,xc=null,md(e,t,o,5);break;case 6:bc=0,xc=null,md(e,t,o,6);break;case 8:nd(),Nc=6;break e;default:throw Error(a(462))}}ud();break}catch(u){sd(e,u)}return Cs=Ns=null,O.H=s,O.A=r,fc=n,null!==gc?0:(yc=null,vc=0,_a(),Nc)}(e,t):cd(e,t,!0),o=s;;){if(0===r){kc&&!s&&ed(e,t,0,!1);break}if(n=e.current.alternate,!o||Jc(n)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){t=i;e:{var l=e;r=Ic;var c=l.current.memoizedState.isDehydrated;if(c&&(ad(l,i).flags|=256),2!==(i=cd(l,i,!1))){if(Sc&&!c){l.errorRecoveryDisabledLanes|=o,Ec|=o,r=4;break e}o=_c,_c=r,null!==o&&(null===_c?_c=o:_c.push.apply(_c,o))}r=i}if(o=!1,2!==r)continue}}if(1===r){ad(e,0),ed(e,t,0,!0);break}e:{switch(s=e,o=r){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:ed(s,t,Tc,!wc);break e;case 2:_c=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(r=Fc+300-ie())){if(ed(s,t,Tc,!wc),0!==Ce(s,0,!0))break e;Uc=t,s.timeoutHandle=Su(Zc.bind(null,s,n,_c,jc,Oc,t,Tc,Ec,Ac,wc,o,"Throttled",-0,0),r)}else Zc(s,n,_c,jc,Oc,t,Tc,Ec,Ac,wc,o,null,-0,0)}break}r=cd(e,t,!1),o=!1}jd(e)}function Zc(e,t,n,a,s,r,o,i,l,c,d,u,p,h){if(e.timeoutHandle=-1,8192&(u=t.subtreeFlags)||!(16785408&~u)){ic(t,r,u={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:It});var m=(62914560&r)===r?Fc-ie():(4194048&r)===r?Dc-ie():0;if(null!==(m=function(e,t){return e.stylesheets&&0===e.count&&dp(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var a=setTimeout(function(){if(e.stylesheets&&dp(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===ip&&(ip=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),a=0;a<n.length;a++){var s=n[a],r=s.transferSize,o=s.initiatorType,i=s.duration;if(r&&i&&fu(o)){for(o=0,i=s.responseEnd,a+=1;a<n.length;a++){var l=n[a],c=l.startTime;if(c>i)break;var d=l.transferSize,u=l.initiatorType;d&&fu(u)&&(o+=d*((l=l.responseEnd)<i?1:(i-c)/(l-c)))}if(--a,t+=8*(r+o)/(s.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var s=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&dp(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>ip?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(a),clearTimeout(s)}}:null}(u,m)))return Uc=r,e.cancelPendingCommit=m(gd.bind(null,e,t,r,n,a,s,o,i,l,d,u,null,p,h)),void ed(e,r,o,!c)}gd(e,t,r,n,a,s,o,i,l)}function Jc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var a=0;a<n.length;a++){var s=n[a],r=s.getSnapshot;s=s.value;try{if(!ea(r(),s))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ed(e,t,n,a){t&=~Pc,t&=~Ec,e.suspendedLanes|=t,e.pingedLanes&=~t,a&&(e.warmLanes|=t),a=e.expirationTimes;for(var s=t;0<s;){var r=31-be(s),o=1<<r;a[r]=-1,s&=~o}0!==n&&_e(e,n,t)}function td(){return!!(6&fc)||(Ld(0),!1)}function nd(){if(null!==gc){if(0===bc)var e=gc.return;else Cs=Ns=null,lo(e=gc),cr=null,dr=0,e=gc;for(;null!==e;)gl(e.alternate,e),e=e.return;gc=null}}function ad(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Mu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Uc=0,nd(),yc=e,gc=n=Ua(e.current,null),vc=t,bc=0,xc=null,wc=!1,kc=Ee(e,t),Sc=!1,Ac=Tc=Pc=Ec=Cc=Nc=0,_c=Ic=null,Oc=!1,8&t&&(t|=32&t);var a=e.entangledLanes;if(0!==a)for(e=e.entanglements,a&=t;0<a;){var s=31-be(a),r=1<<s;t|=e[s],a&=~r}return Mc=t,_a(),n}function sd(e,t){Kr=null,O.H=gi,t===Js||t===tr?(t=ir(),bc=3):t===er?(t=ir(),bc=4):bc=t===Fi?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,xc=t,null===gc&&(Nc=1,Ti(e,Xa(t,e.current)))}function rd(){var e=Fr.current;return null===e||((4194048&vc)===vc?null===Dr:!!((62914560&vc)===vc||536870912&vc)&&e===Dr)}function od(){var e=O.H;return O.H=gi,null===e?gi:e}function id(){var e=O.A;return O.A=hc,e}function ld(){Nc=4,wc||(4194048&vc)!==vc&&null!==Fr.current||(kc=!0),!(134217727&Cc)&&!(134217727&Ec)||null===yc||ed(yc,vc,Tc,!1)}function cd(e,t,n){var a=fc;fc|=2;var s=od(),r=id();yc===e&&vc===t||(jc=null,ad(e,t)),t=!1;var o=Nc;e:for(;;)try{if(0!==bc&&null!==gc){var i=gc,l=xc;switch(bc){case 8:nd(),o=6;break e;case 3:case 2:case 9:case 6:null===Fr.current&&(t=!0);var c=bc;if(bc=0,xc=null,md(e,i,l,c),n&&kc){o=0;break e}break;default:c=bc,bc=0,xc=null,md(e,i,l,c)}}dd(),o=Nc;break}catch(d){sd(e,d)}return t&&e.shellSuspendCounter++,Cs=Ns=null,fc=a,O.H=s,O.A=r,null===gc&&(yc=null,vc=0,_a()),o}function dd(){for(;null!==gc;)pd(gc)}function ud(){for(;null!==gc&&!re();)pd(gc)}function pd(e){var t=ll(e.alternate,e,Mc);e.memoizedProps=e.pendingProps,null===t?fd(e):gc=t}function hd(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=$i(n,t,t.pendingProps,t.type,void 0,vc);break;case 11:t=$i(n,t,t.pendingProps,t.type.render,t.ref,vc);break;case 5:lo(t);default:gl(n,t),t=ll(n,t=gc=Ga(t,Mc),Mc)}e.memoizedProps=e.pendingProps,null===t?fd(e):gc=t}function md(e,t,n,s){Cs=Ns=null,lo(t),cr=null,dr=0;var r=t.return;try{if(function(e,t,n,s,r){if(n.flags|=32768,null!==s&&"object"==typeof s&&"function"==typeof s.then){if(null!==(t=n.alternate)&&Is(t,n,r,!0),null!==(n=Fr.current)){switch(n.tag){case 31:case 13:return null===Dr?ld():null===n.alternate&&0===Nc&&(Nc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,s===nr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([s]):t.add(s),Cd(e,s,r)),!1;case 22:return n.flags|=65536,s===nr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([s]):n.add(s),Cd(e,s,r)),!1}throw Error(a(435,n.tag))}return Cd(e,s,r),ld(),!1}if(hs)return null!==(t=Fr.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,s!==ys&&Ss(Xa(e=Error(a(422),{cause:s}),n))):(s!==ys&&Ss(Xa(t=Error(a(423),{cause:s}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,s=Xa(s,n),Sr(e,r=Ii(e.stateNode,s,r)),4!==Nc&&(Nc=2)),!1;var o=Error(a(520),{cause:s});if(o=Xa(o,n),null===Ic?Ic=[o]:Ic.push(o),4!==Nc&&(Nc=2),null===t)return!0;s=Xa(s,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,Sr(n,e=Ii(n.stateNode,s,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==Lc&&Lc.has(o))))return n.flags|=65536,r&=-r,n.lanes|=r,Oi(r=_i(r),e,n,s),Sr(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,vc))return Nc=1,Ti(e,Xa(n,e.current)),void(gc=null)}catch(o){if(null!==r)throw gc=r,o;return Nc=1,Ti(e,Xa(n,e.current)),void(gc=null)}32768&t.flags?(hs||1===s?e=!0:kc||536870912&vc?e=!1:(wc=e=!0,(2===s||9===s||3===s||6===s)&&(null!==(s=Fr.current)&&13===s.tag&&(s.flags|=16384))),yd(t,e)):fd(t)}function fd(e){var t=e;do{if(32768&t.flags)return void yd(t,wc);e=t.return;var n=fl(t.alternate,t,Mc);if(null!==n)return void(gc=n);if(null!==(t=t.sibling))return void(gc=t);gc=t=e}while(null!==t);0===Nc&&(Nc=5)}function yd(e,t){do{var n=yl(e.alternate,e);if(null!==n)return n.flags&=32767,void(gc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(gc=e);gc=e=n}while(null!==e);Nc=6,gc=null}function gd(e,t,n,s,r,o,i,l,c){e.cancelPendingCommit=null;do{kd()}while(0!==Bc);if(6&fc)throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(o=t.lanes|t.childLanes,function(e,t,n,a,s,r){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var d=31-be(n),u=1<<d;i[d]=0,l[d]=-1;var p=c[d];if(null!==p)for(c[d]=null,d=0;d<p.length;d++){var h=p[d];null!==h&&(h.lane&=-536870913)}n&=~u}0!==a&&_e(e,a,0),0!==r&&0===s&&0!==e.tag&&(e.suspendedLanes|=r&~(o&~t))}(e,n,o|=Ia,i,l,c),e===yc&&(gc=yc=null,vc=0),zc=t,Vc=e,Uc=n,Gc=o,Kc=r,Hc=s,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ae(ue,function(){return Sd(),null})):(e.callbackNode=null,e.callbackPriority=0),s=!!(13878&t.flags),13878&t.subtreeFlags||s){s=O.T,O.T=null,r=F.p,F.p=2,i=fc,fc|=4;try{!function(e,t){if(e=e.containerInfo,yu=wp,oa(e=ra(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch(y){n=null;break e}var i=0,l=-1,c=-1,d=0,u=0,p=e,h=null;t:for(;;){for(var m;p!==n||0!==r&&3!==p.nodeType||(l=i+r),p!==o||0!==s&&3!==p.nodeType||(c=i+s),3===p.nodeType&&(i+=p.nodeValue.length),null!==(m=p.firstChild);)h=p,p=m;for(;;){if(p===e)break t;if(h===n&&++d===r&&(l=i),h===o&&++u===s&&(c=i),null!==(m=p.nextSibling))break;h=(p=h).parentNode}p=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(gu={focusedElem:e,selectionRange:n},wp=!1,Dl=t;null!==Dl;)if(e=(t=Dl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Dl=e;else for(;null!==Dl;){switch(o=(t=Dl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(r=e[n]).ref.impl=r.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==o){e=void 0,n=t,r=o.memoizedProps,o=o.memoizedState,s=n.stateNode;try{var f=Ni(n.type,r);e=s.getSnapshotBeforeUpdate(f,o),s.__reactInternalSnapshotBeforeUpdate=e}catch(g){Nd(n,n.return,g)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Iu(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Iu(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Dl=e;break}Dl=t.return}}(e,t)}finally{fc=i,F.p=r,O.T=s}}Bc=1,vd(),bd(),xd()}}function vd(){if(1===Bc){Bc=0;var e=Vc,t=zc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=O.T,O.T=null;var a=F.p;F.p=2;var s=fc;fc|=4;try{$l(t,e);var r=gu,o=ra(e.containerInfo),i=r.focusedElem,l=r.selectionRange;if(o!==i&&i&&i.ownerDocument&&sa(i.ownerDocument.documentElement,i)){if(null!==l&&oa(i)){var c=l.start,d=l.end;if(void 0===d&&(d=c),"selectionStart"in i)i.selectionStart=c,i.selectionEnd=Math.min(d,i.value.length);else{var u=i.ownerDocument||document,p=u&&u.defaultView||window;if(p.getSelection){var h=p.getSelection(),m=i.textContent.length,f=Math.min(l.start,m),y=void 0===l.end?f:Math.min(l.end,m);!h.extend&&f>y&&(o=y,y=f,f=o);var g=aa(i,f),v=aa(i,y);if(g&&v&&(1!==h.rangeCount||h.anchorNode!==g.node||h.anchorOffset!==g.offset||h.focusNode!==v.node||h.focusOffset!==v.offset)){var b=u.createRange();b.setStart(g.node,g.offset),h.removeAllRanges(),f>y?(h.addRange(b),h.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),h.addRange(b))}}}}for(u=[],h=i;h=h.parentNode;)1===h.nodeType&&u.push({element:h,left:h.scrollLeft,top:h.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<u.length;i++){var x=u[i];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}wp=!!yu,gu=yu=null}finally{fc=s,F.p=a,O.T=n}}e.current=t,Bc=2}}function bd(){if(2===Bc){Bc=0;var e=Vc,t=zc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=O.T,O.T=null;var a=F.p;F.p=2;var s=fc;fc|=4;try{Rl(e,t.alternate,t)}finally{fc=s,F.p=a,O.T=n}}Bc=3}}function xd(){if(4===Bc||3===Bc){Bc=0,oe();var e=Vc,t=zc,n=Uc,a=Hc;10256&t.subtreeFlags||10256&t.flags?Bc=5:(Bc=0,zc=Vc=null,wd(e,e.pendingLanes));var s=e.pendingLanes;if(0===s&&(Lc=null),Re(n),t=t.stateNode,ge&&"function"==typeof ge.onCommitFiberRoot)try{ge.onCommitFiberRoot(ye,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==a){t=O.T,s=F.p,F.p=2,O.T=null;try{for(var r=e.onRecoverableError,o=0;o<a.length;o++){var i=a[o];r(i.value,{componentStack:i.stack})}}finally{O.T=t,F.p=s}}3&Uc&&kd(),jd(e),s=e.pendingLanes,261930&n&&42&s?e===$c?Wc++:(Wc=0,$c=e):Wc=0,Ld(0)}}function wd(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Us(t)))}function kd(){return vd(),bd(),xd(),Sd()}function Sd(){if(5!==Bc)return!1;var e=Vc,t=Gc;Gc=0;var n=Re(Uc),s=O.T,r=F.p;try{F.p=32>n?32:n,O.T=null,n=Kc,Kc=null;var o=Vc,i=Uc;if(Bc=0,zc=Vc=null,Uc=0,6&fc)throw Error(a(331));var l=fc;if(fc|=4,dc(o.current),nc(o,o.current,i,n),fc=l,Ld(0,!1),ge&&"function"==typeof ge.onPostCommitFiberRoot)try{ge.onPostCommitFiberRoot(ye,o)}catch(c){}return!0}finally{F.p=r,O.T=s,wd(e,t)}}function Md(e,t,n){t=Xa(n,t),null!==(e=wr(e,t=Ii(e.stateNode,t,2),2))&&(Ie(e,2),jd(e))}function Nd(e,t,n){if(3===e.tag)Md(e,e,n);else for(;null!==t;){if(3===t.tag){Md(t,e,n);break}if(1===t.tag){var a=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof a.componentDidCatch&&(null===Lc||!Lc.has(a))){e=Xa(n,e),null!==(a=wr(t,n=_i(2),2))&&(Oi(n,a,t,e),Ie(a,2),jd(a));break}}t=t.return}}function Cd(e,t,n){var a=e.pingCache;if(null===a){a=e.pingCache=new mc;var s=new Set;a.set(t,s)}else void 0===(s=a.get(t))&&(s=new Set,a.set(t,s));s.has(n)||(Sc=!0,s.add(n),e=Ed.bind(null,e,t,n),t.then(e,e))}function Ed(e,t,n){var a=e.pingCache;null!==a&&a.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,yc===e&&(vc&n)===n&&(4===Nc||3===Nc&&(62914560&vc)===vc&&300>ie()-Fc?!(2&fc)&&ad(e,0):Pc|=n,Ac===vc&&(Ac=0)),jd(e)}function Pd(e,t){0===t&&(t=Te()),null!==(e=Da(e,t))&&(Ie(e,t),jd(e))}function Td(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Pd(e,n)}function Ad(e,t){var n=0;switch(e.tag){case 31:case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==s&&s.delete(t),Pd(e,n)}var Id=null,_d=null,Od=!1,Fd=!1,Dd=!1,Rd=0;function jd(e){e!==_d&&null===e.next&&(null===_d?Id=_d=e:_d=_d.next=e),Fd=!0,Od||(Od=!0,Cu(function(){6&fc?ae(ce,Bd):Vd()}))}function Ld(e,t){if(!Dd&&Fd){Dd=!0;do{for(var n=!1,a=Id;null!==a;){if(0!==e){var s=a.pendingLanes;if(0===s)var r=0;else{var o=a.suspendedLanes,i=a.pingedLanes;r=(1<<31-be(42|e)+1)-1,r=201326741&(r&=s&~(o&~i))?201326741&r|1:r?2|r:0}0!==r&&(n=!0,Gd(a,r))}else r=vc,!(3&(r=Ce(a,a===yc?r:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle)))||Ee(a,r)||(n=!0,Gd(a,r));a=a.next}}while(n);Dd=!1}}function Bd(){Vd()}function Vd(){Fd=Od=!1;var e=0;0!==Rd&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ku&&(ku=e,!0);return ku=null,!1}()&&(e=Rd);for(var t=ie(),n=null,a=Id;null!==a;){var s=a.next,r=zd(a,t);0===r?(a.next=null,null===n?Id=s:n.next=s,null===s&&(_d=n)):(n=a,(0!==e||3&r)&&(Fd=!0)),a=s}0!==Bc&&5!==Bc||Ld(e),0!==Rd&&(Rd=0)}function zd(e,t){for(var n=e.suspendedLanes,a=e.pingedLanes,s=e.expirationTimes,r=-62914561&e.pendingLanes;0<r;){var o=31-be(r),i=1<<o,l=s[o];-1===l?0!==(i&n)&&0===(i&a)||(s[o]=Pe(i,t)):l<=t&&(e.expiredLanes|=i),r&=~i}if(n=vc,n=Ce(e,e===(t=yc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),a=e.callbackNode,0===n||e===t&&(2===bc||9===bc)||null!==e.cancelPendingCommit)return null!==a&&null!==a&&se(a),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Ee(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==a&&se(a),Re(n)){case 2:case 8:n=de;break;case 32:default:n=ue;break;case 268435456:n=he}return a=Ud.bind(null,e),n=ae(n,a),e.callbackPriority=t,e.callbackNode=n,t}return null!==a&&null!==a&&se(a),e.callbackPriority=2,e.callbackNode=null,2}function Ud(e,t){if(0!==Bc&&5!==Bc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(kd()&&e.callbackNode!==n)return null;var a=vc;return 0===(a=Ce(e,e===yc?a:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Qc(e,a,t),zd(e,ie()),null!=e.callbackNode&&e.callbackNode===n?Ud.bind(null,e):null)}function Gd(e,t){if(kd())return null;Qc(e,t,!0)}function Kd(){if(0===Rd){var e=Hs;0===e&&(e=ke,!(261888&(ke<<=1))&&(ke=256)),Rd=e}return Rd}function Hd(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:At(""+e)}function Wd(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var $d=0;$d<Ca.length;$d++){var qd=Ca[$d];Ea(qd.toLowerCase(),"on"+(qd[0].toUpperCase()+qd.slice(1)))}Ea(va,"onAnimationEnd"),Ea(ba,"onAnimationIteration"),Ea(xa,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(wa,"onTransitionRun"),Ea(ka,"onTransitionStart"),Ea(Sa,"onTransitionCancel"),Ea(Ma,"onTransitionEnd"),at("onMouseEnter",["mouseout","mouseover"]),at("onMouseLeave",["mouseout","mouseover"]),at("onPointerEnter",["pointerout","pointerover"]),at("onPointerLeave",["pointerout","pointerover"]),nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yd));function Qd(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var a=e[n],s=a.event;a=a.listeners;e:{var r=void 0;if(t)for(var o=a.length-1;0<=o;o--){var i=a[o],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==r&&s.isPropagationStopped())break e;r=i,s.currentTarget=c;try{r(s)}catch(d){Pa(d)}s.currentTarget=null,r=l}else for(o=0;o<a.length;o++){if(l=(i=a[o]).instance,c=i.currentTarget,i=i.listener,l!==r&&s.isPropagationStopped())break e;r=i,s.currentTarget=c;try{r(s)}catch(d){Pa(d)}s.currentTarget=null,r=l}}}}function Zd(e,t){var n=t[Ge];void 0===n&&(n=t[Ge]=new Set);var a=e+"__bubble";n.has(a)||(nu(t,e,2,!1),n.add(a))}function Jd(e,t,n){var a=0;t&&(a|=4),nu(n,e,a,t)}var eu="_reactListening"+Math.random().toString(36).slice(2);function tu(e){if(!e[eu]){e[eu]=!0,et.forEach(function(t){"selectionchange"!==t&&(Xd.has(t)||Jd(t,!1,e),Jd(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[eu]||(t[eu]=!0,Jd("selectionchange",!1,t))}}function nu(e,t,n,a){switch(Pp(t)){case 2:var s=kp;break;case 8:s=Sp;break;default:s=Mp}n=s.bind(null,t,n,e),s=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),a?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function au(e,t,n,a,s){var o=a;if(!(1&t||2&t||null===a))e:for(;;){if(null===a)return;var i=a.tag;if(3===i||4===i){var l=a.stateNode.containerInfo;if(l===s)break;if(4===i)for(i=a.return;null!==i;){var c=i.tag;if((3===c||4===c)&&i.stateNode.containerInfo===s)return;i=i.return}for(;null!==l;){if(null===(i=Ye(l)))return;if(5===(c=i.tag)||6===c||26===c||27===c){a=o=i;continue e}l=l.parentNode}}a=a.return}Lt(function(){var a=o,s=Ot(n),i=[];e:{var l=Na.get(e);if(void 0!==l){var c=tn,d=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":c=vn;break;case"focusin":d="focus",c=ln;break;case"focusout":d="blur",c=ln;break;case"beforeblur":case"afterblur":c=ln;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=xn;break;case va:case ba:case xa:c=cn;break;case Ma:c=kn;break;case"scroll":case"scrollend":c=an;break;case"wheel":c=Sn;break;case"copy":case"cut":case"paste":c=dn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=bn;break;case"toggle":case"beforetoggle":c=Nn}var u=!!(4&t),p=!u&&("scroll"===e||"scrollend"===e),h=u?null!==l?l+"Capture":null:l;u=[];for(var m,f=a;null!==f;){var y=f;if(m=y.stateNode,5!==(y=y.tag)&&26!==y&&27!==y||null===m||null===h||null!=(y=Bt(f,h))&&u.push(su(f,y,m)),p)break;f=f.return}0<u.length&&(l=new c(l,d,null,n,s),i.push({event:l,listeners:u}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===_t||!(d=n.relatedTarget||n.fromElement)||!Ye(d)&&!d[Ue])&&(c||l)&&(l=s.window===s?s:(l=s.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=a,null!==(d=(d=n.relatedTarget||n.toElement)?Ye(d):null)&&(p=r(d),u=d.tag,d!==p||5!==u&&27!==u&&6!==u)&&(d=null)):(c=null,d=a),c!==d)){if(u=rn,y="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=bn,y="onPointerLeave",h="onPointerEnter",f="pointer"),p=null==c?l:Qe(c),m=null==d?l:Qe(d),(l=new u(y,f+"leave",c,n,s)).target=p,l.relatedTarget=m,y=null,Ye(s)===a&&((u=new u(h,f+"enter",d,n,s)).target=m,u.relatedTarget=p,y=u),p=y,c&&d)e:{for(u=ou,f=d,m=0,y=h=c;y;y=u(y))m++;y=0;for(var g=f;g;g=u(g))y++;for(;0<m-y;)h=u(h),m--;for(;0<y-m;)f=u(f),y--;for(;m--;){if(h===f||null!==f&&h===f.alternate){u=h;break e}h=u(h),f=u(f)}u=null}else u=null;null!==c&&iu(i,l,c,u,!1),null!==d&&null!==p&&iu(i,p,d,u,!0)}if("select"===(c=(l=a?Qe(a):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var v=Gn;else if(jn(l))if(Kn)v=Jn;else{v=Qn;var b=Xn}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?a&&Et(a.elementType)&&(v=Gn):v=Zn;switch(v&&(v=v(e,a))?Ln(i,v,n,s):(b&&b(e,l,a),"focusout"===e&&a&&"number"===l.type&&null!=a.memoizedProps.value&&bt(l,"number",l.value)),b=a?Qe(a):window,e){case"focusin":(jn(b)||"true"===b.contentEditable)&&(la=b,ca=a,da=null);break;case"focusout":da=ca=la=null;break;case"mousedown":ua=!0;break;case"contextmenu":case"mouseup":case"dragend":ua=!1,pa(i,n,s);break;case"selectionchange":if(ia)break;case"keydown":case"keyup":pa(i,n,s)}var x;if(En)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Dn?On(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(An&&"ko"!==n.locale&&(Dn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Dn&&(x=Wt()):(Kt="value"in(Gt=s)?Gt.value:Gt.textContent,Dn=!0)),0<(b=ru(a,w)).length&&(w=new un(w,e,null,n,s),i.push({event:w,listeners:b}),x?w.data=x:null!==(x=Fn(n))&&(w.data=x))),(x=Tn?function(e,t){switch(e){case"compositionend":return Fn(t);case"keypress":return 32!==t.which?null:(_n=!0,In);case"textInput":return(e=t.data)===In&&_n?null:e;default:return null}}(e,n):function(e,t){if(Dn)return"compositionend"===e||!En&&On(e,t)?(e=Wt(),Ht=Kt=Gt=null,Dn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return An&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=ru(a,"onBeforeInput")).length&&(b=new un("onBeforeInput","beforeinput",null,n,s),i.push({event:b,listeners:w}),b.data=x)),function(e,t,n,a,s){if("submit"===t&&n&&n.stateNode===s){var r=Hd((s[ze]||null).action),o=a.submitter;o&&null!==(t=(t=o[ze]||null)?Hd(t.formAction):o.getAttribute("formAction"))&&(r=t,o=null);var i=new tn("action","action",null,a,s);e.push({event:i,listeners:[{instance:null,listener:function(){if(a.defaultPrevented){if(0!==Rd){var e=o?Wd(s,o):new FormData(s);ai(n,{pending:!0,data:e,method:s.method,action:r},null,e)}}else"function"==typeof r&&(i.preventDefault(),e=o?Wd(s,o):new FormData(s),ai(n,{pending:!0,data:e,method:s.method,action:r},r,e))},currentTarget:s}]})}}(i,e,a,n,s)}Qd(i,t)})}function su(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ru(e,t){for(var n=t+"Capture",a=[];null!==e;){var s=e,r=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===r||(null!=(s=Bt(e,n))&&a.unshift(su(e,s,r)),null!=(s=Bt(e,t))&&a.push(su(e,s,r))),3===e.tag)return a;e=e.return}return[]}function ou(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function iu(e,t,n,a,s){for(var r=t._reactName,o=[];null!==n&&n!==a;){var i=n,l=i.alternate,c=i.stateNode;if(i=i.tag,null!==l&&l===a)break;5!==i&&26!==i&&27!==i||null===c||(l=c,s?null!=(c=Bt(n,r))&&o.unshift(su(n,c,l)):s||null!=(c=Bt(n,r))&&o.push(su(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var lu=/\r\n?/g,cu=/\u0000|\uFFFD/g;function du(e){return("string"==typeof e?e:""+e).replace(lu,"\n").replace(cu,"")}function uu(e,t){return t=du(t),du(e)===t}function pu(e,t,n,s,r,o){switch(n){case"children":"string"==typeof s?"body"===t||"textarea"===t&&""===s||St(e,s):("number"==typeof s||"bigint"==typeof s)&&"body"!==t&&St(e,""+s);break;case"className":lt(e,"class",s);break;case"tabIndex":lt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":lt(e,n,s);break;case"style":Ct(e,s,o);break;case"data":if("object"!==t){lt(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==s||"function"==typeof s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}s=At(""+s),e.setAttribute(n,s);break;case"action":case"formAction":if("function"==typeof s){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&pu(e,t,"name",r.name,r,null),pu(e,t,"formEncType",r.formEncType,r,null),pu(e,t,"formMethod",r.formMethod,r,null),pu(e,t,"formTarget",r.formTarget,r,null)):(pu(e,t,"encType",r.encType,r,null),pu(e,t,"method",r.method,r,null),pu(e,t,"target",r.target,r,null))),null==s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}s=At(""+s),e.setAttribute(n,s);break;case"onClick":null!=s&&(e.onclick=It);break;case"onScroll":null!=s&&Zd("scroll",e);break;case"onScrollEnd":null!=s&&Zd("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"muted":e.muted=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"==typeof s||"boolean"==typeof s||"symbol"==typeof s){e.removeAttribute("xlink:href");break}n=At(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,""+s):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===s?e.setAttribute(n,""):!1!==s&&null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,s):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&!isNaN(s)&&1<=s?e.setAttribute(n,s):e.removeAttribute(n);break;case"rowSpan":case"start":null==s||"function"==typeof s||"symbol"==typeof s||isNaN(s)?e.removeAttribute(n):e.setAttribute(n,s);break;case"popover":Zd("beforetoggle",e),Zd("toggle",e),it(e,"popover",s);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":it(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&it(e,n=Pt.get(n)||n,s)}}function hu(e,t,n,s,r,o){switch(n){case"style":Ct(e,s,o);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"==typeof s?St(e,s):("number"==typeof s||"bigint"==typeof s)&&St(e,""+s);break;case"onScroll":null!=s&&Zd("scroll",e);break;case"onScrollEnd":null!=s&&Zd("scrollend",e);break;case"onClick":null!=s&&(e.onclick=It);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:tt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"==typeof(o=null!=(o=e[ze]||null)?o[n]:null)&&e.removeEventListener(t,o,r),"function"!=typeof s)?n in e?e[n]=s:!0===s?e.setAttribute(n,""):it(e,n,s):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,s,r)))}}function mu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zd("error",e),Zd("load",e);var s,r=!1,o=!1;for(s in n)if(n.hasOwnProperty(s)){var i=n[s];if(null!=i)switch(s){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:pu(e,t,s,i,n,null)}}return o&&pu(e,t,"srcSet",n.srcSet,n,null),void(r&&pu(e,t,"src",n.src,n,null));case"input":Zd("invalid",e);var l=s=i=o=null,c=null,d=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(null!=u)switch(r){case"name":o=u;break;case"type":i=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":s=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:pu(e,t,r,u,n,null)}}return void vt(e,s,l,c,d,i,o,!1);case"select":for(o in Zd("invalid",e),r=i=s=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":s=l;break;case"defaultValue":i=l;break;case"multiple":r=l;default:pu(e,t,o,l,n,null)}return t=s,n=i,e.multiple=!!r,void(null!=t?xt(e,!!r,t,!1):null!=n&&xt(e,!!r,n,!0));case"textarea":for(i in Zd("invalid",e),s=o=r=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":r=l;break;case"defaultValue":o=l;break;case"children":s=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:pu(e,t,i,l,n,null)}return void kt(e,r,o,s);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!=typeof r&&"symbol"!=typeof r;else pu(e,t,c,r,n,null);return;case"dialog":Zd("beforetoggle",e),Zd("toggle",e),Zd("cancel",e),Zd("close",e);break;case"iframe":case"object":Zd("load",e);break;case"video":case"audio":for(r=0;r<Yd.length;r++)Zd(Yd[r],e);break;case"image":Zd("error",e),Zd("load",e);break;case"details":Zd("toggle",e);break;case"embed":case"source":case"link":Zd("error",e),Zd("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(r=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:pu(e,t,d,r,n,null)}return;default:if(Et(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(r=n[u])&&hu(e,t,u,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&pu(e,t,l,r,n,null))}function fu(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var yu=null,gu=null;function vu(e){return 9===e.nodeType?e:e.ownerDocument}function bu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xu(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function wu(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ku=null;var Su="function"==typeof setTimeout?setTimeout:void 0,Mu="function"==typeof clearTimeout?clearTimeout:void 0,Nu="function"==typeof Promise?Promise:void 0,Cu="function"==typeof queueMicrotask?queueMicrotask:void 0!==Nu?function(e){return Nu.resolve(null).then(e).catch(Eu)}:Su;function Eu(e){setTimeout(function(){throw e})}function Pu(e){return"head"===e}function Tu(e,t){var n=t,a=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)||"/&"===n){if(0===a)return e.removeChild(s),void Wp(t);a--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)a++;else if("html"===n)Vu(e.ownerDocument.documentElement);else if("head"===n){Vu(n=e.ownerDocument.head);for(var r=n.firstChild;r;){var o=r.nextSibling,i=r.nodeName;r[$e]||"SCRIPT"===i||"STYLE"===i||"LINK"===i&&"stylesheet"===r.rel.toLowerCase()||n.removeChild(r),r=o}}else"body"===n&&Vu(e.ownerDocument.body);n=s}while(n);Wp(t)}function Au(e,t){var n=e;e=0;do{var a=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=a}while(n)}function Iu(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Iu(n),qe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function _u(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Du(e.nextSibling)))return null}return e}function Ou(e){return"$?"===e.data||"$~"===e.data}function Fu(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Du(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Ru=null;function ju(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Du(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Lu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Bu(e,t,n){switch(t=vu(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function Vu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);qe(e)}var zu=new Map,Uu=new Set;function Gu(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Ku=F.d;F.d={f:function(){var e=Ku.f(),t=td();return e||t},r:function(e){var t=Xe(e);null!==t&&5===t.tag&&"form"===t.type?ri(t):Ku.r(e)},D:function(e){Ku.D(e),Wu("dns-prefetch",e,null)},C:function(e,t){Ku.C(e,t),Wu("preconnect",e,t)},L:function(e,t,n){Ku.L(e,t,n);var a=Hu;if(a&&e&&t){var s='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(s+='[imagesrcset="'+yt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(s+='[imagesizes="'+yt(n.imageSizes)+'"]')):s+='[href="'+yt(e)+'"]';var r=s;switch(t){case"style":r=qu(e);break;case"script":r=Qu(e)}zu.has(r)||(e=p({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),zu.set(r,e),null!==a.querySelector(s)||"style"===t&&a.querySelector(Yu(r))||"script"===t&&a.querySelector(Zu(r))||(mu(t=a.createElement("link"),"link",e),Je(t),a.head.appendChild(t)))}},m:function(e,t){Ku.m(e,t);var n=Hu;if(n&&e){var a=t&&"string"==typeof t.as?t.as:"script",s='link[rel="modulepreload"][as="'+yt(a)+'"][href="'+yt(e)+'"]',r=s;switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Qu(e)}if(!zu.has(r)&&(e=p({rel:"modulepreload",href:e},t),zu.set(r,e),null===n.querySelector(s))){switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Zu(r)))return}mu(a=n.createElement("link"),"link",e),Je(a),n.head.appendChild(a)}}},X:function(e,t){Ku.X(e,t);var n=Hu;if(n&&e){var a=Ze(n).hoistableScripts,s=Qu(e),r=a.get(s);r||((r=n.querySelector(Zu(s)))||(e=p({src:e,async:!0},t),(t=zu.get(s))&&np(e,t),Je(r=n.createElement("script")),mu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},a.set(s,r))}},S:function(e,t,n){Ku.S(e,t,n);var a=Hu;if(a&&e){var s=Ze(a).hoistableStyles,r=qu(e);t=t||"default";var o=s.get(r);if(!o){var i={loading:0,preload:null};if(o=a.querySelector(Yu(r)))i.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},n),(n=zu.get(r))&&tp(e,n);var l=o=a.createElement("link");Je(l),mu(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){i.loading|=1}),l.addEventListener("error",function(){i.loading|=2}),i.loading|=4,ep(o,t,a)}o={type:"stylesheet",instance:o,count:1,state:i},s.set(r,o)}}},M:function(e,t){Ku.M(e,t);var n=Hu;if(n&&e){var a=Ze(n).hoistableScripts,s=Qu(e),r=a.get(s);r||((r=n.querySelector(Zu(s)))||(e=p({src:e,async:!0,type:"module"},t),(t=zu.get(s))&&np(e,t),Je(r=n.createElement("script")),mu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},a.set(s,r))}}};var Hu="undefined"==typeof document?null:document;function Wu(e,t,n){var a=Hu;if(a&&"string"==typeof t&&t){var s=yt(t);s='link[rel="'+e+'"][href="'+s+'"]',"string"==typeof n&&(s+='[crossorigin="'+n+'"]'),Uu.has(s)||(Uu.add(s),e={rel:e,crossOrigin:n,href:t},null===a.querySelector(s)&&(mu(t=a.createElement("link"),"link",e),Je(t),a.head.appendChild(t)))}}function $u(e,t,n,s){var r,o,i,l,c=(c=H.current)?Gu(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=qu(n.href),(s=(n=Ze(c).hoistableStyles).get(t))||(s={type:"style",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=qu(n.href);var d=Ze(c).hoistableStyles,u=d.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=c.querySelector(Yu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),zu.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},zu.set(e,n),d||(r=c,o=e,i=n,l=u.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=r.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),mu(o,"link",i),Je(o),r.head.appendChild(o))))),t&&null===s)throw Error(a(528,""));return u}if(t&&null!==s)throw Error(a(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Qu(n),(s=(n=Ze(c).hoistableScripts).get(t))||(s={type:"script",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function qu(e){return'href="'+yt(e)+'"'}function Yu(e){return'link[rel="stylesheet"]['+e+"]"}function Xu(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Qu(e){return'[src="'+yt(e)+'"]'}function Zu(e){return"script[async]"+e}function Ju(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+yt(n.href)+'"]');if(s)return t.instance=s,Je(s),s;var r=p({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Je(s=(e.ownerDocument||e).createElement("style")),mu(s,"style",r),ep(s,n.precedence,e),t.instance=s;case"stylesheet":r=qu(n.href);var o=e.querySelector(Yu(r));if(o)return t.state.loading|=4,t.instance=o,Je(o),o;s=Xu(n),(r=zu.get(r))&&tp(s,r),Je(o=(e.ownerDocument||e).createElement("link"));var i=o;return i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),mu(o,"link",s),t.state.loading|=4,ep(o,n.precedence,e),t.instance=o;case"script":return o=Qu(n.src),(r=e.querySelector(Zu(o)))?(t.instance=r,Je(r),r):(s=n,(r=zu.get(o))&&np(s=p({},n),r),Je(r=(e=e.ownerDocument||e).createElement("script")),mu(r,"link",s),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(s=t.instance,t.state.loading|=4,ep(s,n.precedence,e));return t.instance}function ep(e,t,n){for(var a=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=a.length?a[a.length-1]:null,r=s,o=0;o<a.length;o++){var i=a[o];if(i.dataset.precedence===t)r=i;else if(r!==s)break}r?r.parentNode.insertBefore(e,r.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function tp(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function np(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var ap=null;function sp(e,t,n){if(null===ap){var a=new Map,s=ap=new Map;s.set(n,a)}else(a=(s=ap).get(n))||(a=new Map,s.set(n,a));if(a.has(e))return a;for(a.set(e,null),n=n.getElementsByTagName(e),s=0;s<n.length;s++){var r=n[s];if(!(r[$e]||r[Ve]||"link"===e&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var o=r.getAttribute(t)||"";o=e+o;var i=a.get(o);i?i.push(r):a.set(o,[r])}}return a}function rp(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function op(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var ip=0;function lp(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)dp(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var cp=null;function dp(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cp=new Map,t.forEach(up,e),cp=null,lp.call(e))}function up(e,t){if(!(4&t.state.loading)){var n=cp.get(e);if(n)var a=n.get(null);else{n=new Map,cp.set(e,n);for(var s=e.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var o=s[r];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),a=o)}a&&n.set(null,a)}o=(s=t.instance).getAttribute("data-precedence"),(r=n.get(o)||a)===a&&n.set(null,s),n.set(o,s),this.count++,a=lp.bind(this),s.addEventListener("load",a),s.addEventListener("error",a),r?r.parentNode.insertBefore(s,r.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(s,e.firstChild),t.state.loading|=4}}var pp={$$typeof:x,Provider:null,Consumer:null,_currentValue:D,_currentValue2:D,_threadCount:0};function hp(e,t,n,a,s,r,o,i,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ae(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ae(0),this.hiddenUpdates=Ae(null),this.identifierPrefix=a,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function mp(e,t,n,a,s,r,o,i,l,c,d,u){return e=new hp(e,t,n,o,l,c,d,u,i),t=1,!0===r&&(t|=24),r=Va(3,null,null,t),e.current=r,r.stateNode=e,(t=zs()).refCount++,e.pooledCache=t,t.refCount++,r.memoizedState={element:a,isDehydrated:n,cache:t},vr(r),e}function fp(e){return e?e=La:La}function yp(e,t,n,a,s,r){s=fp(s),null===a.context?a.context=s:a.pendingContext=s,(a=xr(t)).payload={element:n},null!==(r=void 0===r?null:r)&&(a.callback=r),null!==(n=wr(e,a,t))&&(Xc(n,0,t),kr(n,e,t))}function gp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function vp(e,t){gp(e,t),(e=e.alternate)&&gp(e,t)}function bp(e){if(13===e.tag||31===e.tag){var t=Da(e,67108864);null!==t&&Xc(t,0,67108864),vp(e,67108864)}}function xp(e){if(13===e.tag||31===e.tag){var t=qc(),n=Da(e,t=De(t));null!==n&&Xc(n,0,t),vp(e,t)}}var wp=!0;function kp(e,t,n,a){var s=O.T;O.T=null;var r=F.p;try{F.p=2,Mp(e,t,n,a)}finally{F.p=r,O.T=s}}function Sp(e,t,n,a){var s=O.T;O.T=null;var r=F.p;try{F.p=8,Mp(e,t,n,a)}finally{F.p=r,O.T=s}}function Mp(e,t,n,a){if(wp){var s=Np(a);if(null===s)au(e,t,a,Cp,n),jp(e,a);else if(function(e,t,n,a,s){switch(t){case"focusin":return Ap=Lp(Ap,e,t,n,a,s),!0;case"dragenter":return Ip=Lp(Ip,e,t,n,a,s),!0;case"mouseover":return _p=Lp(_p,e,t,n,a,s),!0;case"pointerover":var r=s.pointerId;return Op.set(r,Lp(Op.get(r)||null,e,t,n,a,s)),!0;case"gotpointercapture":return r=s.pointerId,Fp.set(r,Lp(Fp.get(r)||null,e,t,n,a,s)),!0}return!1}(s,e,t,n,a))a.stopPropagation();else if(jp(e,a),4&t&&-1<Rp.indexOf(e)){for(;null!==s;){var r=Xe(s);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var o=Ne(r.pendingLanes);if(0!==o){var i=r;for(i.pendingLanes|=2,i.entangledLanes|=2;o;){var l=1<<31-be(o);i.entanglements[1]|=l,o&=~l}jd(r),!(6&fc)&&(Rc=ie()+500,Ld(0))}}break;case 31:case 13:null!==(i=Da(r,2))&&Xc(i,0,2),td(),vp(r,2)}if(null===(r=Np(a))&&au(e,t,a,Cp,n),r===s)break;s=r}null!==s&&a.stopPropagation()}else au(e,t,a,null,n)}}function Np(e){return Ep(e=Ot(e))}var Cp=null;function Ep(e){if(Cp=null,null!==(e=Ye(e))){var t=r(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=o(t)))return e;e=null}else if(31===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Cp=e,null}function Pp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case ce:return 2;case de:return 8;case ue:case pe:return 32;case he:return 268435456;default:return 32}default:return 32}}var Tp=!1,Ap=null,Ip=null,_p=null,Op=new Map,Fp=new Map,Dp=[],Rp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jp(e,t){switch(e){case"focusin":case"focusout":Ap=null;break;case"dragenter":case"dragleave":Ip=null;break;case"mouseover":case"mouseout":_p=null;break;case"pointerover":case"pointerout":Op.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fp.delete(t.pointerId)}}function Lp(e,t,n,a,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:a,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=Xe(t))&&bp(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Bp(e){var t=Ye(e.target);if(null!==t){var n=r(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=o(n)))return e.blockedOn=t,void Le(e.priority,function(){xp(n)})}else if(31===t){if(null!==(t=c(n)))return e.blockedOn=t,void Le(e.priority,function(){xp(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Vp(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Np(e.nativeEvent);if(null!==n)return null!==(t=Xe(n))&&bp(t),e.blockedOn=n,!1;var a=new(n=e.nativeEvent).constructor(n.type,n);_t=a,n.target.dispatchEvent(a),_t=null,t.shift()}return!0}function zp(e,t,n){Vp(e)&&n.delete(t)}function Up(){Tp=!1,null!==Ap&&Vp(Ap)&&(Ap=null),null!==Ip&&Vp(Ip)&&(Ip=null),null!==_p&&Vp(_p)&&(_p=null),Op.forEach(zp),Fp.forEach(zp)}function Gp(t,n){t.blockedOn===n&&(t.blockedOn=null,Tp||(Tp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Up)))}var Kp=null;function Hp(t){Kp!==t&&(Kp=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Kp===t&&(Kp=null);for(var e=0;e<t.length;e+=3){var n=t[e],a=t[e+1],s=t[e+2];if("function"!=typeof a){if(null===Ep(a||n))continue;break}var r=Xe(n);null!==r&&(t.splice(e,3),e-=3,ai(r,{pending:!0,data:s,method:n.method,action:a},a,s))}}))}function Wp(e){function t(t){return Gp(t,e)}null!==Ap&&Gp(Ap,e),null!==Ip&&Gp(Ip,e),null!==_p&&Gp(_p,e),Op.forEach(t),Fp.forEach(t);for(var n=0;n<Dp.length;n++){var a=Dp[n];a.blockedOn===e&&(a.blockedOn=null)}for(;0<Dp.length&&null===(n=Dp[0]).blockedOn;)Bp(n),null===n.blockedOn&&Dp.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(a=0;a<n.length;a+=3){var s=n[a],r=n[a+1],o=s[ze]||null;if("function"==typeof r)o||Hp(n);else if(o){var i=null;if(r&&r.hasAttribute("formAction")){if(s=r,o=r[ze]||null)i=o.formAction;else if(null!==Ep(s))continue}else i=o.action;"function"==typeof i?n[a+1]=i:(n.splice(a,3),a-=3),Hp(n)}}}function $p(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return s=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==s&&(s(),s=null),a||setTimeout(n,20)}function n(){if(!a&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var a=!1,s=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){a=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==s&&(s(),s=null)}}}function qp(e){this._internalRoot=e}function Yp(e){this._internalRoot=e}Yp.prototype.render=qp.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));yp(t.current,qc(),e,t,null,null)},Yp.prototype.unmount=qp.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;yp(e.current,2,null,e,null,null),td(),t[Ue]=null}},Yp.prototype.unstable_scheduleHydration=function(e){if(e){var t=je();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dp.length&&0!==t&&t<Dp[n].priority;n++);Dp.splice(n,0,e),0===n&&Bp(e)}};var Xp=t.version;if("19.2.3"!==Xp)throw Error(a(527,Xp,"19.2.3"));F.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=r(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(s=o.return)){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return d(o),e;if(i===s)return d(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==s.return)n=o,s=i;else{for(var l=!1,c=o.child;c;){if(c===n){l=!0,n=o,s=i;break}if(c===s){l=!0,s=o,n=i;break}c=c.sibling}if(!l){for(c=i.child;c;){if(c===n){l=!0,n=i,s=o;break}if(c===s){l=!0,s=i,n=o;break}c=c.sibling}if(!l)throw Error(a(189))}}if(n.alternate!==s)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?u(e):null)?null:e.stateNode};var Qp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.2.3"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{ye=Zp.inject(Qp),ge=Zp}catch(eh){}}return wn.createRoot=function(e,t){if(!s(e))throw Error(a(299));var n=!1,r="",o=Ci,i=Ei,l=Pi;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=mp(e,1,!1,null,0,n,r,null,o,i,l,$p),e[Ue]=t.current,tu(e),new qp(t)},wn.hydrateRoot=function(e,t,n){if(!s(e))throw Error(a(299));var r=!1,o="",i=Ci,l=Ei,c=Pi,d=null;return null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(d=n.formState)),(t=mp(e,1,!0,t,0,r,o,d,i,l,c,$p)).context=fp(null),n=t.current,(o=xr(r=De(r=qc()))).callback=null,wr(n,o,r),n=r,t.current.lanes=n,Ie(t,n),jd(t),e[Ue]=t.current,tu(e),new Yp(t)},wn.version="19.2.3",wn}var Cn=(vn||(vn=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),xn.exports=Nn()),xn.exports);const En={},Pn=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=n?.nonce||n?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/DEViLBOX/"+e}(e))in En)return;En[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},Tn=e=>Symbol.iterator in e,An=e=>"entries"in e,In=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),a=t instanceof Map?t:new Map(t.entries());if(n.size!==a.size)return!1;for(const[s,r]of n)if(!a.has(s)||!Object.is(r,a.get(s)))return!1;return!0};function _n(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(Tn(e)&&Tn(t)?An(e)&&An(t)?In(e,t):((e,t)=>{const n=e[Symbol.iterator](),a=t[Symbol.iterator]();let s=n.next(),r=a.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=n.next(),r=a.next()}return!!s.done&&!!r.done})(e,t):In({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function On(t){const n=e.useRef(void 0);return e=>{const a=t(e);return _n(n.current,a)?n.current:n.current=a}}const Fn=e=>(n,a,s)=>(s.setState=(e,a,...s)=>{const r="function"==typeof e?t(e):e;return n(r,a,...s)},e(s.setState,a,s));function Dn(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t="/DEViLBOX/",n=t.endsWith("/")?t.slice(0,-1):t;if(""===n||"/"===n)return e;const a=e.startsWith("/")?e:"/"+e;if(a.startsWith(n))return a;return n+a}function Rn(e,t,n){const a=e.replace(/\.wav$/i,"");return{filename:e,name:a.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/\s+/g," ").trim()||a,category:t,url:Dn(`${n}/${t}/${encodeURIComponent(e)}`)}}const jn="data/samples/packs/drumnibus",Ln={id:"drumnibus",name:"Drumnibus Electro Drums",author:"Legowelt",description:"A collection of 229 electro drum machine samples. Classic analog-style kicks, snares, hi-hats, percussion and FX sounds perfect for electro, techno, and electronic music production.",coverImage:Dn("data/samples/packs/drumnibus/cover.png"),basePath:jn,categories:["kicks","snares","hihats","percussion","fx"],samples:{kicks:["BB_Electro1short.wav","BD_Drumaxia.wav","BD_Pufsub.wav","BD_808A1200.wav","BD_DiggerLong.wav","BD_Digidap.wav","BD_Digimozzy.wav","BD_Dikkie.wav","BD_Dome_Long.wav","BD_EchoRam1.wav","BD_EchoRam2.wav","BD_Electro1shorter.wav","BD_Juxtapos.wav","BD_Lite2021.wav","BD_LofiHuman.wav","BD_Losamplix.wav","BD_Magnotron..wav","BD_Matrixtape1.wav","BD_Matrixtape2.wav","BD_Plastiklog.wav","BD_Punchtron.wav","BD_Punchysplur.wav","BD_Pziforze.wav","BD_Ritmo.wav","BD_Romkick1.wav","BD_Rubydub.wav","BD_Ruflex.wav","BD_Simpletron.wav","BD_Springworth.wav","BD_Spriverbion.wav","BD_Stuf.wav","BD_SubThud.wav","BD_Zistort.wav"].map(e=>Rn(e,"kicks",jn)),snares:["SD_808A1200.wav","SD_Analog_Noise_2.wav","SD_Analog_Noise_4.wav","SD_Analog_Noise_5.wav","SD_Analog_Noise1.wav","SD_CompuCrunchy.wav","SD_Digidap.wav","SD_Draconis1.wav","SD_Draconis2.wav","SD_Drumaxia.wav","SD_Echoram1.wav","SD_Echoram2.wav","SD_Echoram3.wav","SD_electro7000.wav","SD_Hark.wav","SD_Juxtapos.wav","SD_Kitcatlitter.wav","SD_LoDigital_1.wav","SD_LoDigital_2.wav","SD_LofiHuman.wav","SD_Magnotron.wav","SD_Mamba.wav","SD_Mambalazesnare.wav","SD_Mambalazesnare2.wav","SD_NomiSnare.wav","SD_NomiSnareLazer.wav","SD_NomiSnareWhip.wav","SD_Punchtron..wav","SD_Reverz1.wav","SD_Reverz2.wav","SD_Reverz3.wav","SD_Ritmo.wav","SD_Rubydubwav.wav","SD_Ruflex.wav","SD_Strakker.wav","SD_Turbosound.wav","SD_Wolf_3.wav","SD_Wolf_5.wav","SD_Wolf_6.wav","SD_Wolf_7.wav","SD_Wolf_8.wav","SD_Wolf_9.wav","SD_Wolf1.wav","SD_Wolf2.wav","SD_Wolfsweep1.wav"].map(e=>Rn(e,"snares",jn)),hihats:["CH_Digidap.wav","CH_DistortedRitmo.wav","CH_DraconisD921.wav","CH_DraconisD922.wav","CH_Fantio_Closed_Hat.wav","CH_Filtix_Closed_Hat.wav","CH_Juxtapos.wav","CH_LofiHuman.wav","CH_Magnotron.wav","CH_Punchtron.wav","CH_Rezmatix_Closed_Hat.wav","CH_Rubydub.wav","CH_Ruflex.wav","CH_Sizzel_Closed_Hat.wav","CYM_Juxtapos.wav","CYM_Magnotron.wav","CYM_Punchtron.wav","CYM_Ruflex.wav","CYM_Synthique.wav","OH_AnalogHihat1.wav","OH_AnalogOpenhatwav.wav","OH_AnalogVeryLongHat.wav","OH_Digidap.wav","OH_DistortedRitmo.wav","OH_DraconisD921.wav","OH_DraconisD922.wav","OH_Drumaxia.wav","OH_Fantio_Open_Hat.wav","OH_Filtix_Open_Hat.wav","OH_Juxtapos.wav","OH_LofiHuman.wav","OH_Magnotron.wav","OH_Punchtron.wav","OH_Rezmatix_Open_Hat_Long.wav","OH_Rezmatix_Open_Hat.wav","OH_Rubydub.wav","OH_Ruflex.wav","OH_Sizzel_Open_Hat.wav"].map(e=>Rn(e,"hihats",jn)),claps:[],percussion:["BELL_Darkgong.wav","BELL_Filterbell.wav","BELL_Hypnoschaal.wav","BELL_Hypnoschaal2.wav","BELL_Hypnoschaal3.wav","BONGO_Ryhtmbox.wav","BONGO_Ryhtmbox2.wav","BONGO_Simple.wav","CLAP_Juxtapos.wav","CLAP_LofiHuman.wav","CLAP_Magnotron.wav","CLAP_Punchtron.wav","CLAP_Rubydub.wav","CLAP_Ruflex.wav","CLAVE_Punchtron.wav","CLAVE_Simple.wav","CLAVE_Singalique.wav","CLAVE_Syntheticblox.wav","CONGA_Lowpark.wav","CONGA_Syntique.wav","COW_Syntique.wav","LAZ_Drumaxia.wav","LAZ_Blip1.wav","LAZ_Blip2.wav","LAZ_Blip3.wav","LAZ_Chewy1.wav","LAZ_Digidap.wav","LAZ_Lectrophy.wav","LAZ_Lectrophy2.wav","LAZ_lowvix1.wav","LAZ_lowvix2.wav","LAZ_lowvix3.wav","LAZ_Mambalazesnare.wav","LAZ_R900.wav","LAZ_Softrond.wav","LAZ_Softrond2.wav","LAZ_Softrond3.wav","RIM_Losimple.wav","RIM_Magnotron.wav","RIM_Rubydub.wav","SHAKE_AnalogShaker1.wav","SHAKE_AnalogShaker2.wav","SHAKE_AnalogShaker3.wav","SHAKE_Ritmo.wav","SNAP_Juxtapos.wav","TABLA_Mamba.wav","TAMB_Tamb&Shaker.wav","TAMB_TapeShake1.wav","TAMB_TapeShake2.wav","TAMB_TapeShake3.wav","TOM_digger.wav","TOM_DistortedRitmo.wav","TOM_DistortedRitmoHi.wav","TOM_DraconisDS92.wav","TOM_DraconisDS92high.wav","TOM_Druimaxia.wav","TOM_Juxtapos.wav","TOM_LofiHuman.wav","TOM_Magnotron.wav","TOM_Osciaz.wav","TOM_Punchtron.wav","TOM_Rubydub.wav","TOM_Ruflex.wav","TOM_Stofelectro1.wav","TOM_TamborineTom.wav","TOM_TamborineTom2.wav","TOM_TamborineTom3.wav","TOM_Warped.wav"].map(e=>Rn(e,"percussion",jn)),fx:["FX_AnalogFX1.wav","FX_AnalogFX2.wav","FX_Blarper.wav","FX_Briesherfst.wav","FX_Briesherfst2.wav","FX_Briesherfst3.wav","FX_Burst1.wav","FX_Burst2.wav","FX_Chainmalz.wav","FX_Digidap2.wav","FX_Digidap3.wav","FX_Drumaxia.wav","FX_Drumaxia2.wav","FX_ElectroIsland.wav","FX_ElectroIsland2.wav","FX_Emerx1.wav","FX_Emerx2.wav","FX_Emerx3.wav","FX_LofiHuman.wav","FX_LofiHuman2.wav","FX_Magstorm1.wav","FX_Magstorm2.wav","FX_NomiElastiek.wav","FX_NomiLaser1.wav","FX_NomiLectric.wav","FX_NomiLectric2.wav","FX_NomiSnip.wav","FX_NomiSpring.wav","FX_Poni1.wav","FX_Poni2.wav","FX_Poni3.wav","FX_Quarkulator.wav","FX_Quarkulator2.wav","FX_Sloiz.wav","FX_Snakamon1.wav","FX_Snakamon2.wav","FX_Snakamon3.wav","FX_Snakamon3B.wav","FX_Snakamon5.wav","FX_Sonar.wav","FX_Sonar2.wav","FX_Sydrum1.wav","FX_Sydrum2.wav","FX_Sydrum3.wav","FX_Timpio.wav"].map(e=>Rn(e,"fx",jn)),bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:229},Bn="data/samples/packs/casio-mt40",Vn=[Ln,{id:"casio-mt40",name:"Casio MT-40",author:"Casio",description:"Classic 8-bit instrument sounds from the legendary Casio MT-40 keyboard. Home of the Sleng Teng riddim.",coverImage:Dn("data/samples/packs/casio-mt40/cover.jpg"),basePath:Bn,categories:["leads"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:["accordion.wav","banjo.wav","bass.wav","brass.wav","celesta.wav","cello.wav","clarinet.wav","elec piano.wav","flute.wav","folk flute.wav","funny fuzz.wav","glocken.wav","guitar.wav","harpsichord.wav","organ.wav","oriental.wav","pipe-organ.wav","recorder.wav","st ensemble.wav","synth fuzz.wav","trumpet.wav","violin.wav","xylophone.wav"].map(e=>Rn(e,"leads",Bn)),pads:[],loops:[],vocals:[],other:[]},sampleCount:23}];const zn=c(n()),Un={kicks:"kicks",kick:"kicks",bd:"kicks",bassdrum:"kicks","bass drum":"kicks",snares:"snares",snare:"snares",sd:"snares",hihats:"hihats",hihat:"hihats","hi-hats":"hihats","hi-hat":"hihats",hh:"hihats",claps:"claps",clap:"claps",cp:"claps",percussion:"percussion",perc:"percussion",fx:"fx",effects:"fx",sfx:"fx",bass:"bass",leads:"leads",lead:"leads",pads:"pads",pad:"pads",loops:"loops",loop:"loops",vocals:"vocals",vocal:"vocals",vox:"vocals",toms:"percussion",tom:"percussion",cymbals:"hihats",cymbal:"hihats",rides:"hihats",ride:"hihats",crash:"hihats",open:"hihats",closed:"hihats",oh:"hihats",ch:"hihats"},Gn=[".wav",".mp3",".ogg",".flac",".aiff",".aif"],Kn=[".png",".jpg",".jpeg",".webp"];function Hn(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Gn.includes(t)}function Wn(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Kn.includes(t)}function $n(e){const t=e.toLowerCase();return t.includes("cover")||t.includes("folder")||t.includes("front")||t.includes("artwork")}function qn(e,t){const n=e.toLowerCase();return".ds_store"===n||"thumbs.db"===n||n.startsWith("._")||t.includes("__MACOSX")||e.startsWith(".")}function Yn(e){const t=e.toLowerCase().trim();return Un[t]||"other"}function Xn(e){const t=e.replace(/\.(wav|mp3|ogg|flac|aiff|aif)$/i,"");return t.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim()||t}const Qn=a()(Fn((e,t)=>({userPacks:[],uploadZip:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let n,a=e.name.replace(/\.zip$/i,""),s=[];const r=new Set;try{const l=await zn.loadAsync(e),c=Object.entries(l.files);let d=0;for(const[e,n]of c){if(n.dir)continue;const a=e.split("/").filter(e=>e.length>0);if(0===a.length)continue;const i=a[a.length-1];if(qn(i,e))continue;if(Wn(i)){const t=$n(i)?2:a.length<=2?1:0;s.push({path:e,filename:i,priority:t});continue}if(!Hn(i))continue;let l="other";a.length>=2&&(l=Yn(a[a.length-2]));try{const e=await n.async("blob"),a=URL.createObjectURL(e),s={filename:i,name:Xn(i),category:l,url:a};t[l].push(s),r.add(l),d++}catch(o){}}if(s.length>0){s.sort((e,t)=>t.priority-e.priority);const e=s[0],t=l.files[e.path];if(t)try{const e=await t.async("blob");n=URL.createObjectURL(e)}catch(i){}}const u=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===u)throw new Error("No audio files found in the ZIP.");return{id:`user-${Date.now()}`,name:a,author:"User Upload",description:`User-uploaded sample pack with ${u} samples`,coverImage:n,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:u,isUserUploaded:!0}}catch(l){throw l}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},uploadDirectory:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let n,a="",s=[];const r=new Set;for(let l=0;l<e.length;l++){const n=e[l],o=n.webkitRelativePath||n.name;if(qn(n.name,o))continue;const c=o.split("/").filter(e=>e.length>0),d=c[c.length-1];if(c.length>1&&!a&&(a=c[0]),Wn(d)){const e=$n(d)?2:c.length<=2?1:0;s.push({file:n,priority:e});continue}if(!Hn(d))continue;let u="other";c.length>=2&&(u=Yn(c.length>=3?c[c.length-2]:c[1]));try{const e=URL.createObjectURL(n),a={filename:d,name:Xn(d),category:u,url:e};t[u].push(a),r.add(u)}catch(i){}}if(a||(a="Uploaded Pack"),s.length>0){s.sort((e,t)=>t.priority-e.priority);try{n=URL.createObjectURL(s[0].file)}catch(i){}}const o=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===o)throw new Error("No audio files found in the directory.");return{id:`user-${Date.now()}`,name:a,author:"User Upload",description:`User-uploaded sample pack with ${o} samples`,coverImage:n,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:o,isUserUploaded:!0}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},removeUserPack:t=>{e(e=>{e.userPacks=e.userPacks.filter(e=>e.id!==t)})},clearUserPacks:()=>{e(e=>{e.userPacks=[]})}}))),Zn=()=>{const e=Qn(e=>e.userPacks);return[...Vn,...e]},Jn=[null,"#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],ea={note:!0,instrument:!0,volume:!0,effect:!0,effect2:!0,flag1:!1,flag2:!1,cutoff:!1,resonance:!1,envMod:!1,pan:!1,probability:!1},ta={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},na={wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},aa={sampleUrl:"",grainSize:100,grainOverlap:50,playbackRate:1,detune:0,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:4,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}},sa={type:"vfx",clock:16e6,romsLoaded:!1,registers:{}},ra={type:"doc",clock:1e6,romsLoaded:!1,registers:{}},oa={type:"swp30",clock:33868800,romsLoaded:!1,registers:{}},ia={moduleData:"",format:"UNKNOWN",useLibopenmpt:!0,repeatCount:0,stereoSeparation:100,interpolationFilter:0},la={voices:7,detune:30,mix:50,stereoSpread:80,envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ca={voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100},portamento:0},da={drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:50,decay:"fast",harmonic:"third"},keyClick:30,vibrato:{type:"C3",depth:50},rotary:{enabled:!0,speed:"slow"}},ua={drumType:"kick",machineType:"909",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},snare:{pitch:220,pitchHigh:476,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},hihat:{tone:50,decay:100,metallic:50},clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},conga:{pitch:310,decay:180,tuning:50},cowbell:{decay:400,filterFreq:2640},rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450},maracas:{decay:30,filterFreq:5e3},cymbal:{tone:50,decay:2e3}},pa={channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop",swing:0}},ha={pulseWidth:50,pwmDepth:30,pwmRate:2,pwmWaveform:"sine",oscillators:2,detune:10,envelope:{attack:50,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:4e3,resonance:20,envelopeAmount:30,keyTracking:50},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ma={sections:{violin:100,viola:70,cello:50,bass:30},ensemble:{depth:60,rate:3,voices:4},attack:200,release:1e3,brightness:60},fa={A:{f1:800,f2:1200,f3:2500},E:{f1:400,f2:2e3,f3:2600},I:{f1:300,f2:2300,f3:3e3},O:{f1:500,f2:800,f3:2500},U:{f1:350,f2:600,f3:2400}},ya={mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},ga={machineType:"ArguruDistortion",parameters:{}},va={vowel:"A",vowelMorph:{target:"O",amount:0,rate:1,mode:"manual"},oscillator:{type:"sawtooth"},formants:{...fa.A,bandwidth:100},envelope:{attack:50,decay:500,sustain:0,release:100},brightness:70},ba={VOL:0,ARP:1,DUTY:2,WAVE:3,PITCH:4,EX1:5,EX2:6,EX3:7,ALG:8,FB:9,FMS:10,AMS:11,PAN_L:12,PAN_R:13,PHASE_RESET:14,EX4:15,EX5:16,EX6:17,EX7:18,EX8:19},xa={chipType:1,algorithm:4,feedback:4,fms:0,ams:0,fms2:0,ams2:0,ops:4,opllPreset:0,fixedDrums:!1,operators:[{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:50,ar:28,dr:6,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:10,d2r:4,sl:2,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:8,d2r:3,sl:3,rr:5,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0}],macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]},wa={algorithm:0,feedback:0,oscSync:!0,operators:Array.from({length:6},()=>({level:99,coarse:1,fine:0,detune:7,mode:"ratio",egRates:[99,99,99,99],egLevels:[99,99,99,0],breakPoint:0,leftDepth:0,rightDepth:0,leftCurve:0,rightCurve:0,rateScaling:0,ampModSens:0,velocitySens:0})),pitchEgRates:[99,99,99,99],pitchEgLevels:[50,50,50,50],lfoSpeed:35,lfoDelay:0,lfoPitchModDepth:0,lfoAmpModDepth:0,lfoSync:!1,lfoWave:"triangle",lfoPitchModSens:0,transpose:0,name:"INIT VOICE"},ka={osc1Waveform:"saw",osc1Octave:0,osc1Detune:0,osc1PulseWidth:.5,osc1Level:1,osc2Waveform:"saw",osc2Octave:0,osc2Detune:.1,osc2PulseWidth:.5,osc2Level:.7,oscSync:!1,oscXor:!1,filterCutoff:.7,filterResonance:.3,filterType:"lp24",filterEnvAmount:.5,filterKeyTrack:0,filterVelocity:.3,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:"sine",lfoDelay:0,lfoOscAmount:0,lfoFilterAmount:0,lfoAmpAmount:0,lfoPwAmount:0,masterVolume:.7,voices:8,unison:!1,unisonDetune:.1,portamento:0,panSpread:.3,velocitySensitivity:.5,noiseLevel:0,subOscLevel:0,subOscOctave:-1,drift:.02},Sa={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1},Ma={keymap:[],polyphony:"poly",maxVoices:8,noteCut:!1},Na={enabled:!1,waveform:"sine",rate:5,sync:!1,syncDivision:"1/4",filterAmount:0,filterTarget:"cutoff",pitchAmount:0,volumeAmount:0,phase:0,retrigger:!0},Ca={oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"square",rate:2,depth:100},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:1.5,wet:.1}},Ea={text:"COMMODORE SIXTY FOUR",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},Pa={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0},Ta={osc1:{mode:1,transpose:0,detune:0,color:64,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:10,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:-10,color:64,level:0},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:127,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:32},envelope2:{attack:0,decay:64,sustain:127,release:32},lfo1:{rate:64,depth:0}},Aa={laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:40,ratio:2.5},noise:{amount:10,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:40},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:2,wet:.2}},Ia={oscillator:{type:"square",tune:200,fine:0},oscillator2:{enabled:!1,detune:0,mix:.5},noise:{enabled:!0,type:"white",mix:.2,color:100},filter:{cutoff:800,resonance:60,envMod:70,decay:200},lfo:{enabled:!1,rate:5,depth:0,target:"pitch"},envelope:{decay:300,sustain:0},sweep:{enabled:!0,amount:24,time:150}},_a={type:"sawtooth",detune:0,octave:0},Oa={attack:10,decay:500,sustain:0,release:100},Fa={type:"lowpass",frequency:2e3,Q:1,rolloff:-24},Da={engineType:"db303",volume:.8,oscillator:{type:"sawtooth",pulseWidth:1,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.5},slide:{time:.17,mode:"exponential"},overdrive:{amount:0},devilFish:{enabled:!0,normalDecay:.5,accentDecay:.1,softAttack:0,accentSoftAttack:.5,passbandCompensation:.9,resTracking:.7,filterInputDrive:0,filterSelect:1,diodeCharacter:0,duffingAmount:0,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.5,feedback:0,tone:.5,mix:0,stereo:.75}},Ra=[{id:"straight",name:"Straight",category:"straight",description:"No groove, all rows on the grid",values:[0,0]},{id:"light-shuffle",name:"Light Shuffle",category:"shuffle",description:"Subtle rhythmic bounce (16th)",values:[0,8],velocityOffsets:[0,-.05]},{id:"medium-shuffle",name:"Medium Shuffle",category:"shuffle",description:"Classic bouncy shuffle feel",values:[0,16],velocityOffsets:[0,-.1]},{id:"heavy-shuffle",name:"Heavy Shuffle",category:"shuffle",description:"Strong triplet-style bounce",values:[0,25],velocityOffsets:[0,-.15]},{id:"triplet",name:"Full Triplet",category:"shuffle",description:"True 2:1 triplet timing (66%)",values:[0,33],velocityOffsets:[0,-.2]},{id:"mpc-50",name:"MPC 50%",category:"swing",description:"MPC straight (no swing)",values:[0,0]},{id:"mpc-54",name:"MPC 54%",category:"swing",description:"MPC light swing",values:[0,8],velocityOffsets:[0,-.08]},{id:"mpc-58",name:"MPC 58%",category:"swing",description:"MPC medium swing",values:[0,16],velocityOffsets:[0,-.12]},{id:"mpc-62",name:"MPC 62%",category:"swing",description:"MPC heavy swing",values:[0,25],velocityOffsets:[0,-.18]},{id:"mpc-66",name:"MPC 66%",category:"swing",description:"MPC maximum swing",values:[0,33],velocityOffsets:[0,-.25]},{id:"funk-16th",name:"Funk 16th",category:"funk",description:"16th note funk groove",values:[0,5,-3,10],velocityOffsets:[.1,-.2,.05,-.3],suggestedBpmRange:[90,130]},{id:"funk-lazy",name:"Lazy Funk",category:"funk",description:"Relaxed funk feel, everything slightly late",values:[3,8,5,12],velocityOffsets:[.05,-.1,.05,-.15],suggestedBpmRange:[80,110]},{id:"funk-tight",name:"Tight Funk",category:"funk",description:"Rushed funk feel, snappy timing",values:[-2,5,-5,8],velocityOffsets:[.15,-.15,.1,-.2],suggestedBpmRange:[100,140]},{id:"boom-bap",name:"Boom Bap",category:"hip-hop",description:"Classic 90s hip-hop swing",values:[0,12,0,8],velocityOffsets:[.1,-.15,.05,-.1],suggestedBpmRange:[85,100]},{id:"lo-fi",name:"Lo-Fi",category:"hip-hop",description:"Drunk/loose timing for lo-fi beats",values:[5,15,-3,18],velocityOffsets:[-.05,-.2,-.1,-.25],suggestedBpmRange:[70,95]},{id:"trap-triplet",name:"Trap Triplet",category:"hip-hop",description:"Triplet hi-hat groove for trap",values:[0,22,11,33,0,22],velocityOffsets:[.1,-.2,-.1,-.3,.05,-.25],suggestedBpmRange:[130,160]},{id:"drunken",name:"Drunken Master",category:"custom",description:"Irregular timing for experimental feel",values:[0,8,-5,15,3,20,-8,12],velocityOffsets:[0,-.1,.05,-.2,.1,-.15,.05,-.3]},{id:"push-pull",name:"Push-Pull",category:"custom",description:"Alternating early/late for tension",values:[-10,10,-10,10],velocityOffsets:[.1,-.1,.1,-.1]}];const ja=[{id:"ramp-up",name:"Ramp Up",shape:"rampUp",points:[{row:0,value:0},{row:63,value:1}]},{id:"ramp-down",name:"Ramp Down",shape:"rampDown",points:[{row:0,value:1},{row:63,value:0}]},{id:"triangle",name:"Triangle",shape:"triangle",points:[{row:0,value:0},{row:31,value:1},{row:63,value:0}]},{id:"sine",name:"Sine Wave",shape:"sine",points:Array.from({length:64},(e,t)=>({row:t,value:(Math.sin(t/64*Math.PI*2)+1)/2}))}];(new Date).toISOString(),(new Date).toISOString();const La=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Ba(e){if(null===e||""===e||"..."===e)return 0;if("==="===e||"OFF"===e)return 97;const t=e.match(/^([A-G])([#-])(\d)$/);if(!t)return 0;const[,n,a,s]=t,r=parseInt(s,10),o=n+a,i=La.indexOf(o);if(-1===i)return 0;const l=12*r+i+1;return l<1||l>96?0:l}function Va(e){if(0===e)return"...";if(97===e)return"===";if(e<1||e>96)return"...";const t=e-1,n=Math.floor(t/12);return`${La[t%12]}${n}`}const za={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,K:20,L:21,P:25,R:27,T:29,X:33},Ua=Object.fromEntries(Object.entries(za).map(([e,t])=>[t,e]));function Ga(e){if(!e||"..."===e||"000"===e)return[0,0];const t=e.match(/^([0-9A-Z])([0-9A-F]{2})$/i);if(!t)return[0,0];const[,n,a]=t;return[za[n.toUpperCase()]??0,parseInt(a,16)]}function Ka(e,t){if(0===e&&0===t)return"...";return`${Ua[e]??"0"}${t.toString(16).toUpperCase().padStart(2,"0")}`}function Ha(e){return 0===e||97===e||e<1||e>96?null:e+11}function Wa(e){const t=e-11;return Math.min(96,Math.max(1,t))}const $a=globalThis.BaseAudioContext||globalThis.AudioContext||globalThis.webkitAudioContext;function qa(e){if(!e)return null;if($a&&e instanceof $a)return e;let t=[e],n=new Set,a=0;for(;t.length>0&&a<50;){const e=t.shift();if(e&&!n.has(e)){if(n.add(e),a++,$a&&e instanceof $a)return e;e.rawContext&&t.push(e.rawContext),e._nativeAudioContext&&t.push(e._nativeAudioContext),e.nativeContext&&t.push(e.nativeContext),e.baseAudioContext&&t.push(e.baseAudioContext),e.context&&t.push(e.context),e._context&&t.push(e._context)}}return e}function Ya(e){if(!e||"object"!=typeof e)return!1;if(!("function"==typeof e.connect&&"function"==typeof e.disconnect&&"number"==typeof e.numberOfInputs&&"number"==typeof e.numberOfOutputs&&void 0!==e.context))return!1;const t=e.constructor?.name||"",n=t.endsWith("Node")||"AudioNode"===t,a="function"==typeof e.toDestination||"function"==typeof e.toMaster;return n&&!a}function Xa(e){if(!e)return null;if(Ya(e))return e;if(e.input&&Ya(e.input))return e.input;if(e.output&&Ya(e.output))return e.output;const t=[e._gainNode,e._node,e._input,e._output,e._nativeNode];for(const n of t)if(Ya(n))return n;if(e.input&&"object"==typeof e.input&&!Ya(e.input)){const t=[e.input._gainNode,e.input._node,e.input.input];for(const e of t)if(Ya(e))return e}return null}const Qa="cutoff",Za="cutoffHz",Ja="resonance",es="envMod",ts="envModPercent",ns="decay",as="accent",ss="waveform",rs="pulseWidth",os="pitchToPw",is="subOscGain",ls="subOscBlend",cs="normalDecay",ds="accentDecay",us="softAttack",ps="accentSoftAttack",hs="passbandCompensation",ms="resTracking",fs="filterInputDrive",ys="filterSelect",gs="diodeCharacter",vs="duffingAmount",bs="filterFmDepth",xs="korgBite",ws="korgClip",ks="korgCrossmod",Ss="korgQSag",Ms="korgSharpness",Ns="lpBpMix",Cs="filterTracking",Es="stageNLAmount",Ps="ensembleAmount",Ts="slideTime",As="lfoRate",Is="lfoContour",_s="lfoPitchDepth",Os="lfoPwmDepth",Fs="lfoFilterDepth",Ds="lfoStiffDepth",Rs="chorusMix",js="phaserLfoRate",Ls="phaserLfoWidth",Bs="phaserFeedback",Vs="phaserMix",zs="delayTime",Us="delayFeedback",Gs="delayTone",Ks="delayMix",Hs="delaySpread",Ws="tuning",$s="volume",qs="lfoWaveform",Ys="chorusMode",Xs="oversamplingOrder";class Qs extends u{name="DB303Synth";input;output;workletNode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;overdrive;overdriveGain;overdriveAmount=0;chorus;phaser;delay;delayFilter;effectsChain;config={};audioContext;_disposed=!1;_initPromise;_resolveInit=null;_pendingParams=[];_releaseTimeout=null;constructor(){super(),this.audioContext=qa(this.context),this.output=new p(1),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.overdriveGain=new p(1),this.overdrive=new h(e=>{const t=1+8*this.overdriveAmount;return Math.tanh(e*t)/Math.tanh(t)},4096),this.chorus=new m({frequency:1.5,delayTime:3.5,depth:.7,wet:0}),this.phaser=new f({frequency:.5,octaves:3,baseFrequency:350,wet:0}),this.delayFilter=new y({type:"lowpass",frequency:5e3}),this.delay=new g({delayTime:.25,feedback:.3,wet:0,maxDelay:2}),this.effectsChain=new p(1),this.overdriveGain.connect(this.chorus),this.chorus.connect(this.phaser),this.phaser.connect(this.delay),this.delay.connect(this.delayFilter),this.delayFilter.connect(this.effectsChain),this.effectsChain.connect(this.output),this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.context,t=e.rawContext||e._context||qa(this.context);if(!t)throw new Error("Could not get native AudioContext");if(await Qs.ensureInitialized(t),this._disposed)return;this.createNode()}catch(e){}}static wasmBinary=null;static jsCode=null;static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}db303/DB303.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode){const[e,n]=await Promise.all([fetch(`${t}db303/DB303.wasm`),fetch(`${t}db303/DB303.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar DB303 = createDB303Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){if(this._disposed)return;const e=this.context,t=e.rawContext||e._context;if(this.workletNode=v(t,"db303-processor",{outputChannelCount:[2],processorOptions:{sampleRate:t.sampleRate}}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?this._resolveInit&&(this._resolveInit(),this._resolveInit=null):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:t.sampleRate,wasmBinary:Qs.wasmBinary,jsCode:Qs.jsCode}),this._pendingParams.length>0){for(const{paramId:e,value:t}of this._pendingParams)this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t});this._pendingParams=[]}const n=this.overdriveGain.input;this.workletNode.connect(n);try{const e=t.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(t.destination)}catch(a){}}_savedSlideTime=.5;_currentSlideTime=.5;triggerAttack(e,t,n=1,a=!1,s=!1,r=!1){if(!this.workletNode||this._disposed)return;null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null);const o="string"==typeof e?b(e).toMidi():Math.round(12*Math.log2(e/440)+69);let i=Math.floor(127*n);a&&i<100&&(i=127),!a&&i>=100&&(i=99),r&&(this._savedSlideTime=this._currentSlideTime,this.setSlideTime(0));const l=t??x();this.workletNode.port.postMessage({type:"noteOn",time:l,note:o,velocity:i,slide:s}),r&&setTimeout(()=>{this._disposed||this.setSlideTime(this._savedSlideTime)},50)}triggerRelease(e){if(!this.workletNode||this._disposed)return;const t=e??x();this.workletNode.port.postMessage({type:"gateOff",time:t})}releaseAll(){this.workletNode&&!this._disposed&&(null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode.port.postMessage({type:"allNotesOff"}))}noteOn(e,t,n,a){const s=b(e,"midi").toFrequency();this.triggerAttack(s,void 0,t/127,n,a,!1)}noteOff(){this.triggerRelease()}triggerAttackRelease(e,t,n,a,s=!1,r=!1,o=!1){if(this._disposed)return;const i=n??x();this.triggerAttack(e,i,a||1,s,r,o);const l=1e3*(i+w(t).toSeconds()-x());null!==this._releaseTimeout&&clearTimeout(this._releaseTimeout),this._releaseTimeout=setTimeout(()=>{this._releaseTimeout=null,this._disposed||this.triggerRelease()},Math.max(0,l))}setParameterByName(e,t){if(!this._disposed){if(!this.workletNode){const n=this._pendingParams.findIndex(t=>t.paramId===e);return void(n>=0?this._pendingParams[n].value=t:this._pendingParams.push({paramId:e,value:t}))}this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}}setParam(e,t){switch(e){case"cutoff":this.setCutoff(t);break;case"cutoff_hz":this.setCutoffHz(t);break;case"resonance":this.setResonance(t);break;case"env_mod":this.setEnvMod(t);break;case"env_mod_percent":this.setEnvModPercent(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"waveform":this.setWaveform(t);break;case"pulse_width":this.setPulseWidth(t);break;case"pitch_to_pw":this.setPitchToPw(t);break;case"sub_osc_gain":this.setSubOscGain(t);break;case"sub_osc_blend":this.setSubOscBlend(t);break;case"normal_decay":this.setNormalDecay(t);break;case"accent_decay":this.setAccentDecay(t);break;case"soft_attack":this.setSoftAttack(t);break;case"accent_soft_attack":this.setAccentSoftAttack(t);break;case"passband_compensation":this.setPassbandCompensation(t);break;case"res_tracking":this.setResTracking(t);break;case"filter_input_drive":this.setFilterInputDrive(t);break;case"filter_select":this.setFilterSelect(t);break;case"diode_character":this.setDiodeCharacter(t);break;case"duffing_amount":this.setDuffingAmount(t);break;case"filter_fm_depth":this.setFilterFmDepth(t);break;case"korg_bite":this.setKorgBite(t);break;case"korg_clip":this.setKorgClip(t);break;case"korg_crossmod":this.setKorgCrossmod(t);break;case"korg_q_sag":this.setKorgQSag(t);break;case"korg_sharpness":this.setKorgSharpness(t);break;case"lp_bp_mix":this.setLpBpMix(t);break;case"filter_tracking":this.setFilterTracking(t);break;case"stage_nl_amount":this.setStageNLAmount(t);break;case"ensemble_amount":this.setEnsembleAmount(t);break;case"slide_time":this.setSlideTime(t);break;case"lfo_rate":this.setLfoRate(t);break;case"lfo_contour":this.setLfoContour(t);break;case"lfo_pitch_depth":this.setLfoPitchDepth(t);break;case"lfo_pwm_depth":this.setLfoPwmDepth(t);break;case"lfo_filter_depth":this.setLfoFilterDepth(t);break;case"lfo_stiff_depth":this.setLfoStiffDepth(t);break;case"chorus_mix":this.setChorusMix(t);break;case"phaser_rate":this.setPhaserRate(t);break;case"phaser_width":this.setPhaserWidth(t);break;case"phaser_feedback":this.setPhaserFeedback(t);break;case"phaser_mix":this.setPhaserMix(t);break;case"delay_time":this.setDelayTime(t);break;case"delay_feedback":this.setDelayFeedback(t);break;case"delay_tone":this.setDelayTone(t);break;case"delay_mix":this.setDelayMix(t);break;case"delay_spread":this.setDelaySpread(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"lfo_waveform":this.setLfoWaveform(t);break;case"chorus_mode":this.setChorusMode(t);break;case"oversampling_order":this.setOversamplingOrder(t)}}setCutoff(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Qa,t)}setResonance(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ja,t)}setEnvMod(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(es,t)}setDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ns,t)}setAccent(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(as,t)}setAccentAmount(e){this.setAccent(e)}setSlideTime(e){const t=Math.max(0,Math.min(1,e));this._currentSlideTime=e,this.setParameterByName(Ts,t)}setVolume(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName($s,t)}setWaveform(e){this.setParameterByName(ss,e)}setTuning(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ws,t)}setLfoWaveform(e){this.setParameterByName(qs,e)}setLfoRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(As,t)}setLfoContour(e){this.setParameterByName(Is,e)}setLfoPitchDepth(e){this.setParameterByName(_s,e)}setLfoPwmDepth(e){this.setParameterByName(Os,e)}setLfoFilterDepth(e){this.setParameterByName(Fs,e)}setLfoStiffDepth(e){this.setParameterByName(Ds,e)}setNormalDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(cs,t)}setAccentDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ds,t)}setSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(us,t)}setAccentSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ps,t)}setPassbandCompensation(e){this.setParameterByName(hs,e)}setFeedbackHighpass(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName("feedbackHighpass",t)}setResTracking(e){this.setParameterByName(ms,e)}setFilterInputDrive(e){this.setParameterByName(fs,e)}setFilterSelect(e){this.setParameterByName(ys,e)}setDiodeCharacter(e){this.setParameterByName(gs,e)}setDuffingAmount(e){let t;if(Math.abs(e)<.16)t=0;else{t=(e>0?1:-1)*(Math.abs(e)-.16)/.84}this.setParameterByName(vs,t)}setFilterFmDepth(e){this.setParameterByName(bs,e)}setLpBpMix(e){this.setParameterByName(Ns,e)}setFilterTracking(e){this.setParameterByName(Cs,e)}setKorgBite(e){this.setParameterByName(xs,e)}setKorgClip(e){this.setParameterByName(ws,e)}setKorgCrossmod(e){this.setParameterByName(ks,e)}setKorgQSag(e){this.setParameterByName(Ss,e)}setKorgSharpness(e){this.setParameterByName(Ms,e)}setPitchToPw(e){this.setParameterByName(os,e)}setCutoffHz(e){this.setParameterByName(Za,Math.max(10,Math.min(5e3,e)))}setEnvModPercent(e){this.setParameterByName(ts,Math.max(0,Math.min(300,e)))}setStageNLAmount(e){this.setParameterByName(Es,e)}setEnsembleAmount(e){this.setParameterByName(Ps,e)}setChorusMode(e){this.setParameterByName(Ys,e)}setOversamplingOrder(e){this.setParameterByName(Xs,e)}setPulseWidth(e){this.setParameterByName(rs,e)}setSubOscGain(e){this.setParameterByName(is,e)}setSubOscBlend(e){this.setParameterByName(ls,e)}setChorusMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Rs,t),this.chorus.wet.value=t}setPhaserRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(js,t);const n=.1+9.9*t;try{this.phaser.frequency.exponentialRampToValueAtTime(Math.max(.01,n),this.context.currentTime+.1)}catch{this.phaser.frequency.value=Math.max(.01,n)}}setPhaserWidth(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ls,t),this.phaser.octaves=1+4*t}setPhaserFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Bs,t);const n=20*t;try{this.phaser.Q.linearRampToValueAtTime(Math.min(30,n),this.context.currentTime+.1)}catch{this.phaser.Q.value=Math.min(30,n)}}setPhaserMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Vs,t),this.phaser.wet.value=t}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(zs,t);const n=.1+1.9*t;try{this.delay.delayTime.linearRampToValueAtTime(n,this.context.currentTime+.1)}catch{this.delay.delayTime.value=n}}setDelayFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Us,t),this.delay.feedback.value=.95*t}setDelayTone(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Gs,t);const n=200+7800*t;try{this.delayFilter.frequency.exponentialRampToValueAtTime(Math.max(20,n),this.context.currentTime+.1)}catch{this.delayFilter.frequency.value=Math.max(20,n)}}setDelayMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ks,t),this.delay.wet.value=t}setDelaySpread(e){this.setParameterByName(Hs,e)}setOverdrive(e){if(!this._disposed)if(this.overdriveAmount=Math.min(Math.max(e,0),100)/100,this.overdriveAmount>0){const e=new Float32Array(4096),n=1+8*this.overdriveAmount;for(let t=0;t<4096;t++){const a=t/4096*2-1;e[t]=Math.tanh(a*n)/Math.tanh(n)}if(this.overdrive.curve=e,this.overdriveGain.gain.linearRampTo(1+2*this.overdriveAmount,.03),this.overdriveGain.numberOfOutputs>0)try{this.overdriveGain.disconnect(this.chorus),this.overdriveGain.connect(this.overdrive),this.overdrive.connect(this.chorus)}catch(t){}}else try{this.overdrive.disconnect(this.chorus),this.overdriveGain.disconnect(this.overdrive),this.overdriveGain.connect(this.chorus),this.overdriveGain.gain.linearRampTo(1,.03)}catch(t){}}setVegDecay(e){}setVegSustain(e){}setFilterFM(e){this.setFilterFmDepth(e/100)}setMuffler(e){switch(e){case"soft":this.setOverdrive(15);break;case"hard":this.setOverdrive(45);break;case"dark":this.setOverdrive(30);break;case"mid":this.setOverdrive(25);break;case"bright":this.setOverdrive(35);break;default:this.setOverdrive(0)}}setSweepSpeed(e){}setHighResonanceEnabled(e){}setAccentSweepEnabled(e){}setChorusEnabled(e){e||(this.chorus.wet.value=0)}setPhaserEnabled(e){e||(this.phaser.wet.value=0)}setPhaserDepth(e){this.phaser.octaves=1+4*e}setDelayEnabled(e){e||(this.delay.wet.value=0)}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}enableDevilFish(e){}setHighResonance(e){}dispose(){return this._disposed=!0,null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.overdriveGain.dispose(),this.overdrive.dispose(),this.chorus.dispose(),this.phaser.dispose(),this.delay.dispose(),this.delayFilter.dispose(),this.effectsChain.dispose(),this.output.dispose(),super.dispose(),this}}const Zs="vfx",Js="rsa",er="swp30",tr={vfx:0,doc:1,rsa:2,swp30:3,segapcm:4,ga20:5,upd933:6};class nr{static instance;module=null;isInitialized=!1;heapU8=null;constructor(){}static getInstance(){return nr.instance||(nr.instance=new nr),nr.instance}async init(){if(this.isInitialized)return;const e="/DEViLBOX/";try{const t=await fetch(`${e}mame/MAMEChips.js`),n=await t.text(),a=new Function(`${n}; return MAMEChips;`)(),s=await fetch(`${e}mame/MAMEChips.wasm`),r=await s.arrayBuffer();this.module=await a({wasmBinary:r}),this.module.wasmMemory&&(this.heapU8=new Uint8Array(this.module.wasmMemory.buffer)),this.isInitialized=!0}catch(t){throw new Error(`MAMEChips WASM failed to load: ${t}`)}}createInstance(e,t){if(!this.isInitialized)return 0;const n=tr[e];return this.module._mame_create_instance(n,t)}deleteInstance(e){this.isInitialized&&0!==e&&this.module._mame_delete_instance(e)}write(e,t,n){this.isInitialized&&0!==e&&this.module._mame_write(e,t,n)}write16(e,t,n){this.isInitialized&&0!==e&&this.module._mame_write16(e,t,n)}read(e,t){return this.isInitialized&&0!==e?this.module._mame_read(e,t):0}setRom(e,t){if(!this.isInitialized||!this.heapU8)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_set_rom(e,n,t.length)}addMidiEvent(e,t){if(!this.isInitialized||0===e||!this.heapU8)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_add_midi_event(e,n,t.length),this.module._free(n)}rsaLoadRoms(e,t,n,a){if(!this.isInitialized||0===e||!this.heapU8)return;const s=this.module._malloc(t.length),r=this.module._malloc(n.length),o=this.module._malloc(a.length);this.heapU8.set(t,s),this.heapU8.set(n,r),this.heapU8.set(a,o),this.module._rsa_load_roms(e,s,r,o)}render(e,t=128){if(!this.isInitialized||0===e||!this.module.wasmMemory)return{left:new Float32Array(t),right:new Float32Array(t)};const n=this.module._malloc(4*t),a=this.module._malloc(4*t);this.module._mame_render(e,n,a,t);const s=this.module.wasmMemory.buffer,r=new Float32Array(s,n,t).slice(),o=new Float32Array(s,a,t).slice();return this.module._free(n),this.module._free(a),{left:r,right:o}}}class ar extends u{name="MAMESynth";input;output;engine=nr.getInstance();outputGain;config;isInitialized=!1;initInProgress=!1;handle=0;voices=[];numHardwareVoices=32;constructor(e){super(),this.config=e,this.outputGain=new p(1),this.output=this.outputGain,"rsa"===e.type?this.numHardwareVoices=16:"swp30"===e.type&&(this.numHardwareVoices=64);for(let t=0;t<this.numHardwareVoices;t++)this.voices.push({note:"",active:!1,voiceIndex:t,startTime:0});this.initEngine()}async ensureInitialized(){if(!this.isInitialized)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.isInitialized&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.isInitialized){this.initInProgress=!0;try{await this.engine.init();let e=16e6;"rsa"===this.config.type?e=2e7:"swp30"===this.config.type&&(e=33868800);const t=this.config.clock||e;if(this.handle=this.engine.createInstance(this.config.type,t),this.config.roms)for(const n of this.config.roms)this.engine.setRom(n.bank,n.data);this.isInitialized=!0,"vfx"===this.config.type&&(this.engine.write(this.handle,88,31),this.engine.write(this.handle,96,1)),this.startRendering()}catch(e){}finally{this.initInProgress=!1}}}startRendering(){const e=qa(this.context);if(!e||!e.createScriptProcessor)return;const t=e.createScriptProcessor(512,0,2);t.onaudioprocess=e=>{if(!this.isInitialized||0===this.handle)return;const t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1),{left:a,right:s}=this.engine.render(this.handle,512);t.set(a),n.set(s)};const n=e.createGain();t.connect(n);const a=Xa(this.outputGain);if(a)try{n.connect(a)}catch{n.connect(e.destination)}else n.connect(e.destination);this._nativeGain=n}getHandle(){return this.handle}write(e,t){this.isInitialized&&0!==this.handle&&this.engine.write(this.handle,e,t)}write16(e,t){this.isInitialized&&0!==this.handle&&this.engine.write16(this.handle,e,t)}read(e){return this.isInitialized&&0!==this.handle?this.engine.read(this.handle,e):0}findFreeVoice(){const e=this.voices.find(e=>!e.active);return e||this.voices.sort((e,t)=>e.startTime-t.startTime)[0]}triggerAttack(e,t,n=1){if(!this.isInitialized||0===this.handle)return this;const a=b(e).toFrequency(),s=this.findFreeVoice();s.note=e,s.active=!0,s.startTime=Date.now();const r=s.voiceIndex;if("vfx"===this.config.type){this.engine.write(this.handle,120,r),this.engine.write16(this.handle,0,1);const e=44100,t=Math.floor(2048*a*32/e);this.engine.write16(this.handle,8,65535&t),this.engine.write(this.handle,10,t>>16&255),this.engine.write16(this.handle,136,0),this.engine.write16(this.handle,144,8192);const s=Math.floor(65535*n);this.engine.write16(this.handle,16,s),this.engine.write16(this.handle,0,0)}else if("doc"===this.config.type){this.engine.write(this.handle,224,0),this.engine.write(this.handle,0+r,0);const e=Math.floor(65536*a/1e3);this.engine.write(this.handle,0+r,255&e),this.engine.write(this.handle,32+r,e>>8&255),this.engine.write(this.handle,64+r,Math.floor(255*n)),this.engine.write(this.handle,128+r,0)}else if("rsa"===this.config.type){const e=Math.floor(16384*a/32e3);for(let t=0;t<10;t++){const n=256*r+16*t;this.engine.write(this.handle,n+0,255&e),this.engine.write(this.handle,n+1,e>>8&255),this.engine.write(this.handle,n+5,127)}}else if("swp30"===this.config.type){const e=r<<6,t=Math.floor(1024*a/44100);this.engine.write16(this.handle,10|e,t)}return this}triggerRelease(e,t){if(!this.isInitialized||0===this.handle)return this;const n=this.voices.find(t=>t.active&&t.note===e);if(!n)return this;n.active=!1;const a=n.voiceIndex;if("vfx"===this.config.type)this.engine.write(this.handle,120,a),this.engine.write16(this.handle,0,1);else if("doc"===this.config.type)this.engine.write(this.handle,128+a,1);else if("rsa"===this.config.type)for(let s=0;s<10;s++){const e=256*a+16*s;this.engine.write(this.handle,e+5,255)}return this}dispose(){return 0!==this.handle&&(this.engine.deleteInstance(this.handle),this.handle=0),super.dispose(),this.outputGain.dispose(),this}}const sr=new Map,rr=new WeakMap;const or={VOLUME:0,ARPEGGIO:1,DUTY:2,WAVETABLE:3,PITCH:4,PANNING:5,PHASE_RESET:6,ALG:7,FB:8,FMS:9,AMS:10};const ir={numVoices:1,numOperators:0,hasFM:!1,hasAlgorithm:!1,hasFeedback:!1,hasVibrato:!1,hasTremolo:!1,hasPitchLFO:!1,hasAmpLFO:!1,hasWavetable:!1,hasPCM:!1,hasNoise:!1,hasADSR:!0,hasSSG:!1,hasPanning:!1,hasStereo:!1,hasDSP:!1,hasReverb:!1,sampleRAMSize:0},lr={AICA:{numVoices:64,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:2097152},SCSP:{numVoices:32,numOperators:4,hasFM:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:524288},C352:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},ES5503:{numVoices:32,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:65536},YMF271:{numVoices:12,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:4194304},YMOPQ:{numVoices:8,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasADSR:!0,hasPanning:!1,hasStereo:!1},K054539:{numVoices:8,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:8388608},ICS2115:{numVoices:32,hasWavetable:!0,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},RF5C400:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},SN76477:{numVoices:1,hasNoise:!0,hasVibrato:!0},TMS36XX:{numVoices:6,hasADSR:!1},TMS5220:{numVoices:1},MEA8000:{numVoices:1},Votrax:{numVoices:1},Astrocade:{numVoices:3,hasNoise:!0,hasVibrato:!0},SNKWave:{numVoices:3,hasWavetable:!0},SP0250:{numVoices:1},UPD931:{numVoices:1},UPD933:{numVoices:8,hasWavetable:!0,hasADSR:!0},TR707:{numVoices:15,hasPCM:!0,sampleRAMSize:32768},VASynth:{numVoices:16,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0},CEM3394:{numVoices:1,hasADSR:!0,hasVibrato:!0},ASC:{numVoices:4,hasWavetable:!0,hasStereo:!0}};function cr(e){return{...ir,...lr[e]||{}}}const dr=0,ur=1,pr=2,hr=3;class mr{channelMemory=new Map;speed=6;bpm=125;constructor(){}getChannelMemory(e){return this.channelMemory.has(e)||this.channelMemory.set(e,{arpeggioX:0,arpeggioY:0,arpeggioTick:0,pitchSlideUp:0,pitchSlideDown:0,tonePortamento:0,tonePortamentoTarget:null,vibratoSpeed:0,vibratoDepth:0,vibratoPhase:0,vibratoWaveform:0,tremoloSpeed:0,tremoloDepth:0,tremoloPhase:0,tremoloWaveform:0,volumeSlide:0,currentVolume:64,currentPanning:128,currentPitch:440,currentPitchOffset:0,noteCutTick:-1,noteDelayTick:-1,retriggerTick:0,retriggerVolume:0,sampleOffset:0,loopStart:0,loopCount:0,loopRow:0}),this.channelMemory.get(e)}setSpeed(e){this.speed=Math.max(1,Math.min(31,e))}setBPM(e){this.bpm=Math.max(32,Math.min(255,e))}getSpeed(){return this.speed}getBPM(){return this.bpm}processTickZero(e,t,n,a,s){const r=this.getChannelMemory(t),o={positionJump:null,patternBreak:null,patternDelay:0};if(!e||e.length<3)return o;const i=e.charAt(0).toUpperCase(),l=parseInt(e.substring(1),16),c=l>>4&15,d=15&l;switch(n>0&&(r.currentPitch=n),i){case"0":l>0&&(r.arpeggioX=c,r.arpeggioY=d,r.arpeggioTick=0);break;case"1":l>0&&(r.pitchSlideUp=l);break;case"2":l>0&&(r.pitchSlideDown=l);break;case"3":l>0&&(r.tonePortamento=l),n>0&&(r.tonePortamentoTarget=n);break;case"4":c>0&&(r.vibratoSpeed=c),d>0&&(r.vibratoDepth=d);break;case"5":case"6":case"A":l>0&&(r.volumeSlide=l);break;case"7":c>0&&(r.tremoloSpeed=c),d>0&&(r.tremoloDepth=d);break;case"8":r.currentPanning=l,s.setPanning(l);break;case"9":l>0&&(r.sampleOffset=l),s.setSampleOffset(256*r.sampleOffset);break;case"B":o.positionJump=l;break;case"C":r.currentVolume=Math.min(l,64),s.setVolume(r.currentVolume);break;case"D":o.patternBreak=10*c+d;break;case"E":this.processExtendedTick0(l,t,a,s,o);break;case"F":0===l||(l<32?this.speed=l:this.bpm=l)}return o}processExtendedTick0(e,t,n,a,s){const r=this.getChannelMemory(t),o=15&e;switch(e>>4&15){case 1:r.currentPitchOffset+=4*o,a.setPitchOffset(r.currentPitchOffset);break;case 2:r.currentPitchOffset-=4*o,a.setPitchOffset(r.currentPitchOffset);break;case 3:case 5:break;case 4:r.vibratoWaveform=3&o;break;case 6:0===o?r.loopStart=n:0===r.loopCount?(r.loopCount=o,r.loopRow=r.loopStart):(r.loopCount--,r.loopCount>0&&(r.loopRow=r.loopStart));break;case 7:r.tremoloWaveform=3&o;break;case 8:r.currentPanning=17*o,a.setPanning(r.currentPanning);break;case 9:o>0&&(r.retriggerTick=o);break;case 10:r.currentVolume=Math.min(r.currentVolume+o,64),a.setVolume(r.currentVolume);break;case 11:r.currentVolume=Math.max(r.currentVolume-o,0),a.setVolume(r.currentVolume);break;case 12:r.noteCutTick=o,0===o&&a.cutNote();break;case 13:r.noteDelayTick=o;break;case 14:s.patternDelay=o}}processTickN(e,t,n,a){const s=this.getChannelMemory(t);if(!e)return;switch(e.charAt(0).toUpperCase()){case"0":this.processArpeggio(s,n,a);break;case"1":this.processPitchSlideUp(s,a);break;case"2":this.processPitchSlideDown(s,a);break;case"3":this.processTonePortamento(s,a);break;case"4":this.processVibrato(s,a);break;case"5":this.processTonePortamento(s,a),this.processVolumeSlide(s,a);break;case"6":this.processVibrato(s,a),this.processVolumeSlide(s,a);break;case"7":this.processTremolo(s,a);break;case"A":this.processVolumeSlide(s,a);break;case"E":this.processExtendedTickN(e,s,n,a)}}processExtendedTickN(e,t,n,a){switch(parseInt(e.substring(1),16)>>4&15){case 9:t.retriggerTick>0&&n%t.retriggerTick===0&&a.retriggerNote(t.currentVolume/64);break;case 12:n===t.noteCutTick&&a.cutNote()}}processArpeggio(e,t,n){if(0===e.arpeggioX&&0===e.arpeggioY)return;let a=0;switch(t%3){case 0:a=0;break;case 1:a=e.arpeggioX;break;case 2:a=e.arpeggioY}const s=e.currentPitch*Math.pow(2,a/12);n.setFrequency(s)}processPitchSlideUp(e,t){e.pitchSlideUp>0&&(e.currentPitchOffset+=4*e.pitchSlideUp,t.setPitchOffset(e.currentPitchOffset))}processPitchSlideDown(e,t){e.pitchSlideDown>0&&(e.currentPitchOffset-=4*e.pitchSlideDown,t.setPitchOffset(e.currentPitchOffset))}processTonePortamento(e,t){if(0===e.tonePortamento||null===e.tonePortamentoTarget)return;const n=e.tonePortamentoTarget-e.currentPitch,a=4*e.tonePortamento;Math.abs(n)<a?e.currentPitch=e.tonePortamentoTarget:e.currentPitch+=n>0?a:-a,t.setFrequency(e.currentPitch)}processVibrato(e,t){if(0===e.vibratoDepth)return;const n=4*this.calculateWaveformValue(e.vibratoWaveform,e.vibratoPhase,e.vibratoDepth);t.setPitchOffset(e.currentPitchOffset+n),e.vibratoPhase=e.vibratoPhase+e.vibratoSpeed&63}processTremolo(e,t){if(0===e.tremoloDepth)return;const n=this.calculateWaveformValue(e.tremoloWaveform,e.tremoloPhase,e.tremoloDepth),a=Math.round(n),s=Math.max(0,Math.min(64,e.currentVolume+a));t.setVolume(s),e.tremoloPhase=e.tremoloPhase+e.tremoloSpeed&63}processVolumeSlide(e,t){if(0===e.volumeSlide)return;const n=e.volumeSlide>>4&15,a=15&e.volumeSlide;n>0?e.currentVolume=Math.min(e.currentVolume+n,64):a>0&&(e.currentVolume=Math.max(e.currentVolume-a,0)),t.setVolume(e.currentVolume)}calculateWaveformValue(e,t,n){const a=t/64*Math.PI*2;switch(e){case dr:return Math.sin(a)*n;case ur:return((64-t)/32-1)*n;case pr:return(t<32?1:-1)*n;case hr:return(2*Math.random()-1)*n;default:return 0}}hasNoteDelay(e){return!!e&&(e.toUpperCase().startsWith("ED")&&"ED0"!==e)}getNoteDelayTick(e){return e&&e.toUpperCase().startsWith("ED")&&parseInt(e.substring(2),16)||0}reset(){this.channelMemory.clear(),this.speed=6,this.bpm=125}resetChannel(e){const t=this.getChannelMemory(e);t.currentPitchOffset=0,t.arpeggioX=0,t.arpeggioY=0,t.arpeggioTick=0,t.pitchSlideUp=0,t.pitchSlideDown=0,t.tonePortamentoTarget=null,t.vibratoPhase=0,t.tremoloPhase=0,t.noteCutTick=-1,t.noteDelayTick=-1}}function fr(e,t){const n=t/64;return e*Math.pow(2,n/12)}function yr(e){const t=function(e){return 69+12*Math.log2(e/440)}(e),n=Math.floor(t),a=t-n,s=Math.max(0,Math.min(127,n)),r=Math.round(64*a);return{kc:s,kf:Math.max(0,Math.min(63,r))}}class gr extends u{input;output;workletNode=null;_initPromise;_pendingCalls=[];_isReady=!1;_disposed=!1;capabilities;config={};currentNote=60;currentFreq=261.63;currentVelocity=1;isNoteOn=!1;noteOnTime=0;static MIN_GATE_TIME=50;macros=new Map;opMacros=[];effectRouter;channelIndex=0;basePitchOffset=0;effectPitchOffset=0;oscBuffer=null;oscCallbacks=new Set;constructor(){super(),this.output=new p(1),this.effectRouter=new mr,this.capabilities=cr("default")}initSynth(){this.capabilities=cr(this.chipName),this._initPromise=this.initialize(),this.capabilities.numOperators>0&&(this.opMacros=Array.from({length:this.capabilities.numOperators},()=>({})))}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.context,t=e.rawContext||e._context,{wasmBinary:n,jsCode:a}=await async function(e,t,n){const a="/DEViLBOX/";let s=rr.get(e);if(s||(s=new Set,rr.set(e,s)),!s.has("__mame_init_helper__")){try{await e.audioWorklet.addModule(`${a}mame/mame-worklet-init.js`)}catch(r){}s.add("__mame_init_helper__")}if(!s.has(t)){try{await e.audioWorklet.addModule(`${a}mame/${n}`)}catch(r){}s.add(t)}if(!sr.has(t)){const e=(async()=>{const[e,n]=await Promise.all([fetch(`${a}mame/${t}.wasm`),fetch(`${a}mame/${t}.js`)]);if(!e.ok)throw new Error(`Failed to load ${t}.wasm: ${e.status}`);if(!n.ok)throw new Error(`Failed to load ${t}.js: ${n.status}`);const[s,r]=await Promise.all([e.arrayBuffer(),n.text()]),o=function(e,t){return e.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory')}(r,`${a}mame/`);return{wasmBinary:s,jsCode:o}})();sr.set(t,e)}return sr.get(t)}(t,this.chipName,this.workletFile);if(this._disposed)return;const s=this.output.input,{workletNode:r,readyPromise:o}=function(e,t,n,a,s){const r=v(e,t,{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),o=new Promise((e,n)=>{const a=setTimeout(()=>n(new Error(`${t} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=o=>{"ready"===o.data.type?(clearTimeout(a),e()):"error"===o.data.type&&(clearTimeout(a),n(new Error(o.data.message||`${t} init error`))),s&&s.call(r.port,o)}});r.port.postMessage({type:"init",wasmBinary:n,jsCode:a,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch(i){}return{workletNode:r,readyPromise:o}}(t,this.processorName,n,a,s);this.workletNode=r;const i=this.workletNode.port.onmessage;this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data),i&&i.call(this.workletNode.port,e)},await o}catch(e){}}handleWorkletMessage(e){switch(e.type){case"ready":this._isReady=!0;for(const e of this._pendingCalls)this.processPendingCall(e);this._pendingCalls=[];break;case"oscData":e.buffer&&(this.oscBuffer=new Float32Array(e.buffer),this.oscCallbacks.forEach(e=>e(this.oscBuffer)))}}processPendingCall(e){"setParam"===e.method&&this.setParam(e.args[0],e.args[1])}triggerAttack(e,t,n=1){this._disposed||(this.currentNote="string"==typeof e?function(e){const t=e.match(/^([A-Ga-g][#b]?)[-]?(\d)$/);if(!t)return 60;const n=t[1].toUpperCase(),a=parseInt(t[2]),s={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===s?60:12*(a+1)+s}(e):e>127?Math.round(12*Math.log2(e/440)+69):e,this.currentFreq=function(e){return 440*Math.pow(2,(e-69)/12)}(this.currentNote),this.currentVelocity=n,this.isNoteOn=!0,this.noteOnTime=Date.now(),this.resetMacros(),this.effectRouter.resetChannel(this.channelIndex),this.writeKeyOn(this.currentNote,n))}triggerRelease(e){if(this._disposed)return;const t=Date.now()-this.noteOnTime;t<gr.MIN_GATE_TIME?setTimeout(()=>this.triggerRelease(e),gr.MIN_GATE_TIME-t):(this.isNoteOn=!1,this.releaseMacros(),this.writeKeyOff())}triggerAttackRelease(e,t,n,a){if(this._disposed)return;this.triggerAttack(e,n,a||1);const s=w(t).toSeconds();setTimeout(()=>{this._disposed||this.triggerRelease()},1e3*s)}releaseAll(){this.workletNode&&!this._disposed&&(this.workletNode.port.postMessage({type:"allNotesOff"}),this.isNoteOn=!1)}setFrequency(e){this.currentFreq=e,this.writeFrequency(e)}setPitchOffset(e){this.effectPitchOffset=e;const t=fr(this.currentFreq,this.basePitchOffset+e);this.writeFrequency(t)}setVolume(e){const t=e/64;this.writeVolume(t*this.currentVelocity)}setPanning(e){this.writePanning(e)}setSampleOffset(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setSampleOffset",offset:e})}retriggerNote(e){this.writeKeyOn(this.currentNote,e)}cutNote(){this.writeVolume(0),this.isNoteOn=!1}writeDuty(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:100,value:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"selectWavetable",index:e})}writePhaseReset(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"phaseReset"})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dr",value:t})}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"sl",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dt",value:t})}setMacro(e){const t={type:e.type,data:e.data,loop:e.loop??-1,release:e.release??-1,position:0,active:e.data.length>0,released:!1};this.macros.set(e.type,t)}setMacros(e){for(const t of e)this.setMacro(t)}clearMacros(){this.macros.clear()}resetMacros(){this.macros.forEach(e=>{e.position=0,e.released=!1});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.position=0,n.released=!1)}}releaseMacros(){this.macros.forEach(e=>{e.released=!0,e.release>=0&&e.release<e.data.length&&(e.position=e.release)});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.released=!0,n.release>=0&&n.release<n.data.length&&(n.position=n.release))}}processTick(e=x()){this.isNoteOn&&(this.macros.forEach((e,t)=>{if(!e.active||0===e.data.length)return;let n=e.position;n>=e.data.length&&(n=e.data.length-1);const a=e.data[n];this.applyMacroValue(t,a),n++,n>=e.data.length&&(n=e.loop>=0?e.loop:e.data.length-1),e.position=n}),this.processOperatorMacros())}applyMacroValue(e,t){switch(e){case or.VOLUME:const e=t/127*this.currentVelocity;this.writeVolume(e);break;case or.ARPEGGIO:const n=t>127?t-256:t,a=this.currentFreq*Math.pow(2,n/12);this.writeFrequency(a);break;case or.DUTY:this.writeDuty(t);break;case or.WAVETABLE:this.writeWavetableSelect(t);break;case or.PITCH:const s=t>127?t-256:t;this.basePitchOffset=s;const r=fr(this.currentFreq,this.basePitchOffset+this.effectPitchOffset);this.writeFrequency(r);break;case or.PANNING:const o=t>127?t-256:t;this.writePanning(128+o);break;case or.PHASE_RESET:0!==t&&this.writePhaseReset();break;case or.ALG:this.setFMAlgorithm(t);break;case or.FB:this.setFMFeedback(t);break;case or.FMS:this.setFMSensitivity(t);break;case or.AMS:this.setAMSensitivity(t)}}processOperatorMacros(){for(let e=0;e<this.opMacros.length;e++){const t=this.opMacros[e];if(t){if(t.tl?.active){const n=this.advanceOpMacro(t.tl);this.setOperatorTL(e,n)}if(t.ar?.active){const n=this.advanceOpMacro(t.ar);this.setOperatorAR(e,n)}if(t.dr?.active){const n=this.advanceOpMacro(t.dr);this.setOperatorDR(e,n)}if(t.sl?.active){const n=this.advanceOpMacro(t.sl);this.setOperatorSL(e,n)}if(t.rr?.active){const n=this.advanceOpMacro(t.rr);this.setOperatorRR(e,n)}if(t.mult?.active){const n=this.advanceOpMacro(t.mult);this.setOperatorMult(e,n)}if(t.dt?.active){const n=this.advanceOpMacro(t.dt);this.setOperatorDetune(e,n)}}}}advanceOpMacro(e){if(!e.active||0===e.data.length)return 0;let t=e.position;t>=e.data.length&&(t=e.data.length-1);const n=e.data[t];return t++,t>=e.data.length&&(t=e.loop>=0?e.loop:e.data.length-1),e.position=t,n}setFMAlgorithm(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:200,value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:201,value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:202,value:e})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:203,value:e})}processEffectTick0(e,t,n){return this.effectRouter.processTickZero(e,this.channelIndex,t,n,this)}processEffectTickN(e,t){this.effectRouter.processTickN(e,this.channelIndex,t,this)}hasNoteDelay(e){return this.effectRouter.hasNoteDelay(e)}getNoteDelayTick(e){return this.effectRouter.getNoteDelayTick(e)}setChannelIndex(e){this.channelIndex=e}getOscData(){return this.oscBuffer}onOscData(e){return this.oscCallbacks.add(e),this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!0}),()=>{this.oscCallbacks.delete(e),0===this.oscCallbacks.size&&this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!1})}}setParam(e,t){this._isReady||this._pendingCalls.push({method:"setParam",args:[e,t]})}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r??0})}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.oscCallbacks.clear(),this.output.dispose(),super.dispose(),this}}class vr extends u{name="TapeSaturation";inputGain;saturation;toneFilter;outputGain;dryGain;wetGain;_drive;_tone;_wet;input;output;constructor(e={}){super(),this._drive=e.drive??.5,this._tone=e.tone??12e3,this._wet=e.wet??1,this.input=new p(1),this.output=new p(1),this.inputGain=new p(this.calculateInputGain(this._drive)),this.saturation=new h(this.createSaturationCurve(this._drive),4096),this.toneFilter=new y({type:"lowpass",frequency:this._tone,rolloff:-12,Q:.7}),this.outputGain=new p(this.calculateMakeupGain(this._drive)),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.input.connect(this.inputGain),this.inputGain.connect(this.saturation),this.saturation.connect(this.toneFilter),this.toneFilter.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output)}createSaturationCurve(e){const t=new Float32Array(4096),n=1+8*e;for(let a=0;a<4096;a++){const e=a/4096*2-1;t[a]=e>=0?.95*Math.tanh(e*n)+.02*e:Math.tanh(e*n*.85)}return t}calculateInputGain(e){return 1+2*e}calculateMakeupGain(e){return 1/(1+.5*e)}get drive(){return this._drive}set drive(e){this._drive=Math.max(0,Math.min(1,e)),this.inputGain.gain.value=this.calculateInputGain(this._drive),this.saturation.curve=this.createSaturationCurve(this._drive),this.outputGain.gain.value=this.calculateMakeupGain(this._drive)}get tone(){return this._tone}set tone(e){this._tone=Math.max(2e3,Math.min(2e4,e)),this.toneFilter.frequency.value=this._tone}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.inputGain.dispose(),this.saturation.dispose(),this.toneFilter.dispose(),this.outputGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this}}const br=2048;function xr(e){const t=new Float32Array(br),n=new Float32Array(br);switch(e){case"sine":n[1]=1;break;case"saw":for(let e=1;e<1024;e++)n[e]=2/(e*Math.PI)*(e%2==0?1:-1);break;case"square":for(let e=1;e<1024;e+=2)n[e]=4/(e*Math.PI);break;case"triangle":for(let e=1;e<1024;e+=2)n[e]=8/(Math.PI*Math.PI*e*e)*((e-1)/2%2==0?1:-1)}return{real:t,imag:n}}function wr(e){const t=new Float32Array(br),n=new Float32Array(br);for(let a=1;a<1024;a++)n[a]=2/(a*Math.PI)*Math.sin(a*Math.PI*e);return{real:t,imag:n}}function kr(e,t,n){const a=new Float32Array(br),s=new Float32Array(br),r=[e,t,n],o=[100,150,200];for(let i=1;i<1024;i++){const e=100*i;let t=0;for(let n=0;n<r.length;n++){const a=Math.abs(e-r[n]);t+=Math.exp(-a*a/(2*o[n]*o[n]))}s[i]=t/(.5*i+1)}return{real:a,imag:s}}const Sr=[{id:"basic-saw",name:"Saw",category:"Basic",frames:[xr("saw")]},{id:"basic-square",name:"Square",category:"Basic",frames:[xr("square")]},{id:"basic-triangle",name:"Triangle",category:"Basic",frames:[xr("triangle")]},{id:"basic-sine",name:"Sine",category:"Basic",frames:[xr("sine")]},{id:"analog-sweep",name:"Analog Sweep",category:"Analog",frames:[xr("sine"),xr("triangle"),xr("saw"),xr("square")]},{id:"pwm",name:"PWM",category:"Analog",frames:[wr(.1),wr(.25),wr(.5),wr(.75),wr(.9)]},{id:"saw-stack",name:"Saw Stack",category:"Analog",frames:[xr("saw"),(()=>{const e=xr("saw");for(let t=1;t<1024;t++){const n=.1*Math.PI*t,a=Math.cos(n),s=Math.sin(n),r=e.real[t],o=e.imag[t];e.real[t]=r*a-o*s,e.imag[t]=r*s+o*a}return e})()]},{id:"digital-harmonics",name:"Digital",category:"Digital",frames:[(()=>{const e=new Float32Array(br),t=new Float32Array(br);for(let n=1;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})(),(()=>{const e=new Float32Array(br),t=new Float32Array(br);for(let n=2;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})()]},{id:"vocal-a",name:"Vocal A",category:"Vocal",frames:[kr(800,1200,2800)]},{id:"vocal-morph",name:"Vocal Morph",category:"Vocal",frames:[kr(300,2300,3e3),kr(500,1800,2500),kr(800,1200,2800),kr(450,800,2500),kr(300,600,2300)]},{id:"metallic",name:"Metallic",category:"FX",frames:[(()=>{const e=new Float32Array(br),t=new Float32Array(br);return[1,2.756,5.404,8.933,13.344].forEach((e,n)=>{const a=Math.round(e);a<1024&&(t[a]=1/(n+1))}),{real:e,imag:t}})()]}];function Mr(e,t){if(1===e.frames.length)return e.frames[0];const n=t*(e.frames.length-1),a=Math.floor(n),s=n-a;return a>=e.frames.length-1?e.frames[e.frames.length-1]:function(e,t,n){const a=new Float32Array(br),s=new Float32Array(br);for(let r=0;r<br;r++)a[r]=e.real[r]*(1-n)+t.real[r]*n,s[r]=e.imag[r]*(1-n)+t.imag[r]*n;return{real:a,imag:s}}(e.frames[a],e.frames[a+1],s)}class Nr extends u{name="WavetableSynth";voices=new Map;voicePool=[];config;morphLFO;morphEnvelope;filter;filterEnvelope;outputGain;input;output;baseMorphPosition=0;constructor(e){super(),this.config=e,this.input=new p(1),this.output=new p(1),this.morphLFO=new k({frequency:e.morphLFORate,type:"sine",min:0,max:1}),this.morphEnvelope=new S({attack:e.envelope.attack/1e3,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain/100,release:e.envelope.release/1e3}),this.filter=new y({type:e.filter.type,frequency:e.filter.cutoff,Q:e.filter.resonance/10,rolloff:-24}),this.filterEnvelope=new S({attack:e.filterEnvelope.attack/1e3,decay:e.filterEnvelope.decay/1e3,sustain:e.filterEnvelope.sustain/100,release:e.filterEnvelope.release/1e3}),this.outputGain=new p(2),this.filter.connect(this.outputGain),this.outputGain.connect(this.output),"lfo"===e.morphModSource&&this.morphLFO.start();for(let t=0;t<8;t++)this.voicePool.push(this.createVoice());this.baseMorphPosition=e.morphPosition/100}createVoice(){return new Cr(this.config,this.filter)}getCurrentMorphPosition(){return Math.max(0,Math.min(1,this.baseMorphPosition))}triggerAttack(e,t,n=1){const a=t??x(),s="string"==typeof e?b(e).toFrequency():e,r="string"==typeof e?b(e).toMidi():Math.round(69+12*Math.log2(e/440));let o=this.voicePool.pop();if(!o){const e=this.voices.keys().next().value;void 0!==e&&(o=this.voices.get(e),this.voices.delete(e))}if(o){const e=this.getCurrentMorphPosition();if(o.setMorphPosition(e),o.triggerAttack(s,a,n),this.voices.set(r,o),0!==this.config.filter.envelopeAmount){const e=this.config.filter.cutoff;this.filter.frequency.setValueAtTime(e,a),this.filterEnvelope.triggerAttack(a)}}return this}triggerRelease(e,t){const n=t??x(),a="string"==typeof e?b(e).toMidi():Math.round(69+12*Math.log2(e/440)),s=this.voices.get(a);return s&&(s.triggerRelease(n),this.voices.delete(a),setTimeout(()=>{this.voicePool.push(s)},this.config.envelope.release+100)),this}triggerAttackRelease(e,t,n,a=1){const s=n??x(),r="string"==typeof t?w(t).toSeconds():t;return this.triggerAttack(e,s,a),this.triggerRelease(e,s+r),this}setMorphPosition(e){this.baseMorphPosition=Math.max(0,Math.min(1,e));const t=this.getCurrentMorphPosition();this.voices.forEach(e=>{e.setMorphPosition(t)})}setMorphLFORate(e){this.config.morphLFORate=e,this.morphLFO.frequency.value=e}setFilterCutoff(e){this.config.filter.cutoff=e,this.filter.frequency.value=e}setFilterResonance(e){this.config.filter.resonance=e,this.filter.Q.value=e/10}updateConfig(e){this.config={...this.config,...e},void 0!==e.morphLFORate&&(this.morphLFO.frequency.value=e.morphLFORate),e.filter&&(e.filter.type&&(this.filter.type=e.filter.type),void 0!==e.filter.cutoff&&(this.filter.frequency.value=e.filter.cutoff),void 0!==e.filter.resonance&&(this.filter.Q.value=e.filter.resonance/10))}dispose(){return super.dispose(),this.voices.forEach(e=>e.dispose()),this.voicePool.forEach(e=>e.dispose()),this.morphLFO.dispose(),this.morphEnvelope.dispose(),this.filter.dispose(),this.filterEnvelope.dispose(),this.outputGain.dispose(),this}}class Cr{oscillators=[];gains=[];panners=[];envelope;config;constructor(e,t){this.config=e,this.envelope=new S({attack:e.envelope.attack/1e3,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain/100,release:e.envelope.release/1e3});const n=e.unison.voices,a=e.unison.detune,s=e.unison.stereoSpread/100;for(let r=0;r<n;r++){let e=0;n>1&&(e=(r/(n-1)*2-1)*a);let o=0;n>1&&(o=(r/(n-1)*2-1)*s);const i=new M({type:"sine",detune:e}),l=new p(0),c=new N(o);i.connect(l),this.envelope.connect(l.gain),l.connect(c),c.connect(t),this.oscillators.push(i),this.gains.push(l),this.panners.push(c)}this.setMorphPosition(e.morphPosition/100)}setMorphPosition(e){const t=(n=this.config.wavetableId,Sr.find(e=>e.id===n));var n;if(!t)return;const a=Mr(t,e),s=[];for(let r=1;r<Math.min(32,a.imag.length);r++)s.push(a.imag[r]);this.oscillators.forEach(e=>{e.partials=s})}triggerAttack(e,t,n){this.oscillators.forEach(n=>{n.frequency.setValueAtTime(e,t),n.start(t)}),this.gains.forEach(e=>{e.gain.setValueAtTime(0,t)}),this.envelope.triggerAttack(t)}triggerRelease(e){this.envelope.triggerRelease(e);const t=e+this.config.envelope.release/1e3+.1;this.oscillators.forEach(e=>{e.stop(t)})}dispose(){this.envelope.dispose(),this.oscillators.forEach(e=>e.dispose()),this.gains.forEach(e=>e.dispose()),this.panners.forEach(e=>e.dispose())}}class Er{audioContext;workletNode=null;isInitialized=!1;currentModel=null;outputGain;static BUILT_IN_MODELS=[{name:"Ibanez TS9",fileName:"TS9_DriveKnob.json",type:"pedal"},{name:"Ibanez Mostortion Clone",fileName:"Ibanez_Mostortion_Clone_GainKnob.json",type:"pedal"},{name:"Mooer CaliMkIV",fileName:"Mooer_CaliMkIV_GainKnob.json",type:"pedal"},{name:"Boss MT2",fileName:"BossMT2_PedalHighGain.json",type:"pedal"},{name:"Pro Co RAT Distortion",fileName:"ProcoRatPedal_HighGain.json",type:"pedal"},{name:"MXR 78",fileName:"MXR78_pedal_DistKnob.json",type:"pedal"},{name:"Ibanez TS808",fileName:"Ibanez808TubeScreamer.json",type:"pedal"},{name:"RevvG3 Pedal",fileName:"RevvG3_Pedal_GainKnob.json",type:"pedal"},{name:"Jeckyl and Hyde Distortion",fileName:"Jeckyl_and_Hyde_Distortion_DriveKnob.json",type:"pedal"},{name:"Friedman BEOD Pedal",fileName:"Friedman_BEOD_Pedal_GainKnob.json",type:"pedal"},{name:"Blackstar HT40 Clean",fileName:"BlackstarHT40_AmpClean.json",type:"amp"},{name:"Mesa Mini Rec High Gain",fileName:"MesaMiniRec_HighGain_DirectOut.json",type:"amp"},{name:"Splawn OD High Gain",fileName:"Splawn_OD_FractalFM3_HighGain.json",type:"amp"},{name:"Ethos Lead Channel",fileName:"EthosLeadChan_GainKnob.json",type:"amp"},{name:"Princeton Amp Clean",fileName:"PrincetonAmp_Clean.json",type:"amp"},{name:"Dumble Kit High Gain",fileName:"DumbleKit_HighG_DirectOut.json",type:"amp"},{name:"Blackstar HT40 Gain",fileName:"BlackstarHT40_GainKnob_SM57mic.json",type:"amp"},{name:"T-Rex Mudhoney + Pork Loin",fileName:"TRexMudhoney_plus_PorkLoin_HighGain.json",type:"pedal"},{name:"Prince Of Tone OD",fileName:"PrinceOfToneClone_OD_Knob.json",type:"pedal"},{name:"Pork Loin Pedal",fileName:"PorkLoinPedal_LowGain.json",type:"pedal"},{name:"Prince Of Tone Dist",fileName:"PrinceOfToneClone_Dist_Knob.json",type:"pedal"},{name:"Aguilar Agro Bright Bass",fileName:"AguilarAgro_Bright_Bass.json",type:"bass"},{name:"Aguilar Agro Dark Bass",fileName:"AguilarAgro_Dark_Bass.json",type:"bass"},{name:"BadCat50 Med Gain",fileName:"BadCat50_MedGain_PREAMP.json",type:"amp"},{name:"ShiftTwin Clean2",fileName:"ShiftTwin_Clean2_PREAMP.json",type:"amp"},{name:"Sovtek50 Med Gain",fileName:"Sovtek50_MedGain_DIRECT.json",type:"amp"},{name:"ShiftTwin StampedeDT",fileName:"ShiftTwin_StampedeDT_PREAMP.json",type:"amp"},{name:"Sovtek50 Dod FX56B",fileName:"Sovtek50_DodFX56B_DIRECT.json",type:"amp"},{name:"ENGL E645 Clean",fileName:"ENGL_E645_Clean_EdoardoNapoli.json",type:"amp"},{name:"Filmosound with Cab",fileName:"Filmosound_with_cab.json",type:"amp"},{name:"ENGL E430 Clean",fileName:"ENGL_E430_Clean_EdoardoNapoli.json",type:"amp"},{name:"El Coyote Trainwreck",fileName:"ElCoyote_Trainwreck_Crunch.json",type:"amp"},{name:"Supro Bold Drive",fileName:"Supro_Bold_DriveKnob.json",type:"amp"},{name:"Goat Pedal High Gain",fileName:"GoatPedal_HighGain.json",type:"pedal"},{name:"Protein Blue Pedal",fileName:"ProteinBlue_pedal_DriveKnob.json",type:"pedal"},{name:"Little Big Muff",fileName:"LittleBigMuff_HighGainPedal.json",type:"pedal"},{name:"Big Muff V6",fileName:"BigMuff_V6_T3_S5.json",type:"pedal"}];constructor(e){this.audioContext=e,this.outputGain=e.createGain(),this.outputGain.gain.value=1}async initialize(){if(!this.isInitialized)try{const e="/DEViLBOX/";await this.audioContext.audioWorklet.addModule(`${e}GuitarML.worklet.js`),this.workletNode=new AudioWorkletNode(this.audioContext,"guitarml-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]}),this.workletNode.connect(this.outputGain),this.workletNode.port.onmessage=e=>this.handleWorkletMessage(e.data),this.isInitialized=!0}catch(e){throw e}}handleWorkletMessage(e){if("modelLoaded"===e.type)e.success}async loadModel(e){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");if(e<0||e>=Er.BUILT_IN_MODELS.length)throw new Error(`Invalid model index: ${e}`);const t=Er.BUILT_IN_MODELS[e];try{const e="/DEViLBOX/",n=await fetch(`${e}models/guitarml/${t.fileName}`);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const a=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:a}),this.currentModel=t}catch(n){throw n}}async loadModelFromURL(e,t){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const a=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:a}),this.currentModel={name:t,fileName:e,type:"pedal"}}catch(n){throw n}}setParameter(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setGain(e){this.setParameter("gain",e)}setCondition(e){this.setParameter("condition",e)}setDryWet(e){this.setParameter("dryWet",e)}setEnabled(e){this.setParameter("enabled",e?1:0)}setUseSRCFilter(e){this.setParameter("useSRCFilter",e?1:0)}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}connect(e){this.outputGain.connect(e)}disconnect(){this.outputGain.disconnect()}getInput(){if(!this.workletNode)throw new Error("GuitarML not initialized - call initialize() first");return this.workletNode}getOutput(){return this.outputGain}isReady(){return this.isInitialized}getCurrentModel(){return this.currentModel}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.outputGain.disconnect(),this.isInitialized=!1}}class Pr extends u{name="NeuralEffectWrapper";input;output;guitarML;_wet;dryGain;wetGain;modelIndex;neuralOutputGain;eq3;presenceFilter;constructor(e){super(),this.modelIndex=e.modelIndex,this._wet=e.wet??1;const t=qa(this.context);this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.guitarML=new Er(t),this.neuralOutputGain=new p(1),this.eq3=new C({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500}),this.presenceFilter=new y({type:"highshelf",frequency:4e3,gain:0,Q:.7}),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.neuralOutputGain.connect(this.eq3),this.eq3.connect(this.presenceFilter),this.presenceFilter.connect(this.wetGain),this.wetGain.connect(this.output)}async loadModel(){await this.guitarML.initialize();const e=Xa(this.input),t=e?._nativeAudioNode||e;t&&t.connect(this.guitarML.getInput());const n=Xa(this.neuralOutputGain),a=n?._nativeAudioNode||n;a&&this.guitarML.getOutput().connect(a),await this.guitarML.loadModel(this.modelIndex)}setParameter(e,t){const n=Math.max(0,Math.min(100,t))/100;switch(e){case"drive":case"gain":case"condition":this.guitarML.setCondition(n);break;case"dryWet":this.guitarML.setDryWet(n);break;case"level":case"output":this.wetGain.gain.value=n*this._wet;break;case"tone":case"presence":this.presenceFilter.gain.value=20*(n-.5);break;case"bass":this.eq3.low.value=30*(n-.5);break;case"mid":this.eq3.mid.value=30*(n-.5);break;case"treble":this.eq3.high.value=30*(n-.5)}}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.guitarML.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.neuralOutputGain.dispose(),this.eq3.dispose(),this.presenceFilter.dispose(),this}}class Tr extends u{name="SpaceEcho";input;output;head1;head2;head3;head1Gain;head2Gain;head3Gain;feedbackGain;saturation;eq;reverb;reverbGain;echoGain;wowLFO;wowGain;dryGain;wetGain;_options;constructor(e={}){super(),this._options={mode:e.mode??4,rate:e.rate??300,intensity:e.intensity??.5,echoVolume:e.echoVolume??.8,reverbVolume:e.reverbVolume??.3,bass:e.bass??0,treble:e.treble??0,wow:e.wow??.15,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.head1=new E(this._options.rate/1e3),this.head2=new E(2*this._options.rate/1e3),this.head3=new E(3*this._options.rate/1e3),this.head1Gain=new p(0),this.head2Gain=new p(0),this.head3Gain=new p(0),this.reverb=new P({decay:2.5,preDelay:.01}),this.reverb.generate(),this.reverbGain=new p(this._options.reverbVolume),this.echoGain=new p(this._options.echoVolume),this.feedbackGain=new p(this._options.intensity),this.saturation=new T(.1),this.eq=new C({low:this._options.bass,mid:0,high:this._options.treble,lowFrequency:200,highFrequency:2500}),this.wowLFO=new k(.5+.2*Math.random(),-.002,.002),this.wowLFO.type="sine",this.wowGain=new p(this._options.wow),this.wowLFO.connect(this.wowGain),this.wowLFO.start(),this.wowGain.connect(this.head1.delayTime),this.wowGain.connect(this.head2.delayTime),this.wowGain.connect(this.head3.delayTime),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.head1),this.input.connect(this.head2),this.input.connect(this.head3),this.input.connect(this.reverb),this.head1.connect(this.head1Gain),this.head2.connect(this.head2Gain),this.head3.connect(this.head3Gain);const t=new p(1);this.head1Gain.connect(t),this.head2Gain.connect(t),this.head3Gain.connect(t),t.connect(this.echoGain),this.echoGain.connect(this.eq),this.eq.connect(this.saturation),this.saturation.connect(this.feedbackGain),this.feedbackGain.connect(this.head1),this.feedbackGain.connect(this.head2),this.feedbackGain.connect(this.head3),this.reverb.connect(this.reverbGain),this.eq.connect(this.wetGain),this.reverbGain.connect(this.wetGain),this.wetGain.connect(this.output),this.setMode(this._options.mode)}setMode(e){this._options.mode=e;const t=[1,5,8,10,11].includes(e),n=[2,4,6,8,9,11].includes(e),a=[3,4,7,9,10,11].includes(e);this.head1Gain.gain.rampTo(t?1:0,.1),this.head2Gain.gain.rampTo(n?1:0,.1),this.head3Gain.gain.rampTo(a?1:0,.1);const s=e>=5;this.reverbGain.gain.rampTo(s?this._options.reverbVolume:0,.1)}setRate(e){this._options.rate=e,this.head1.delayTime.rampTo(e/1e3,.1),this.head2.delayTime.rampTo(2*e/1e3,.1),this.head3.delayTime.rampTo(3*e/1e3,.1)}setIntensity(e){this._options.intensity=e,this.feedbackGain.gain.rampTo(e,.1)}setEchoVolume(e){this._options.echoVolume=e,this.echoGain.gain.rampTo(e,.1)}setReverbVolume(e){this._options.reverbVolume=e,this._options.mode>=5&&this.reverbGain.gain.rampTo(e,.1)}setBass(e){this._options.bass=e,this.eq.low.value=e}setTreble(e){this._options.treble=e,this.eq.high.value=e}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.head1.dispose(),this.head2.dispose(),this.head3.dispose(),this.head1Gain.dispose(),this.head2Gain.dispose(),this.head3Gain.dispose(),this.feedbackGain.dispose(),this.reverb.dispose(),this.reverbGain.dispose(),this.echoGain.dispose(),this.eq.dispose(),this.saturation.dispose(),this.wowLFO.dispose(),this.wowGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}let Ar=null,Ir=null,_r=!1,Or=null;class Fr extends u{name="SpaceyDelayer";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={firstTap:e.firstTap??250,tapSize:e.tapSize??150,feedback:Math.min(e.feedback??40,95),multiTap:e.multiTap??1,tapeFilter:e.tapeFilter??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=qa(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await Fr.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"spacey-delayer-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("firstTap",this._options.firstTap),this.sendParam("tapSize",this._options.tapSize),this.sendParam("feedback",this._options.feedback),this.sendParam("multiTap",this._options.multiTap),this.sendParam("tapeFilter",this._options.tapeFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Ar,jsCode:Ir}),A(this.input,this.workletNode),A(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!_r){if(Or)return Or;Or=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}spacey-delayer/SpaceyDelayer.worklet.js`)}catch(n){const e=n?.message||String(n);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load SpaceyDelayer worklet: ${e}`)}if(!Ar||!Ir){const[e,n]=await Promise.all([fetch(`${t}spacey-delayer/SpaceyDelayer.wasm`),fetch(`${t}spacey-delayer/SpaceyDelayer.js`)]);if(!e.ok||!n.ok)throw Or=null,new Error(`Failed to fetch SpaceyDelayer WASM/JS: wasm=${e.status} js=${n.status}`);Ar=await e.arrayBuffer();let a=await n.text();a=a.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),a+="\nvar createSpaceyDelayer = createSpaceyDelayer || Module;",Ir=a}_r=!0})();try{await Or}catch(t){throw Or=null,_r=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setFirstTap(e){this._options.firstTap=Math.max(10,Math.min(e,2e3)),this.sendParam("firstTap",this._options.firstTap)}setTapSize(e){this._options.tapSize=Math.max(10,Math.min(e,1e3)),this.sendParam("tapSize",this._options.tapSize)}setFeedback(e){this._options.feedback=Math.max(0,Math.min(e,95)),this.sendParam("feedback",this._options.feedback)}setMultiTap(e){this._options.multiTap=e?1:0,this.sendParam("multiTap",e?1:0)}setTapeFilter(e){this._options.tapeFilter=e?1:0,this.sendParam("tapeFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}let Dr=null,Rr=null,jr=!1,Lr=null;class Br extends u{name="RETapeEcho";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={mode:Math.max(0,Math.min(e.mode??3,5)),repeatRate:Math.max(0,Math.min(e.repeatRate??.5,1)),intensity:Math.max(0,Math.min(e.intensity??.5,1)),echoVolume:Math.max(0,Math.min(e.echoVolume??.8,1)),wow:Math.max(0,Math.min(e.wow??0,1)),flutter:Math.max(0,Math.min(e.flutter??0,1)),dirt:Math.max(0,Math.min(e.dirt??0,1)),inputBleed:e.inputBleed??0,loopAmount:Math.max(0,Math.min(e.loopAmount??0,1)),playheadFilter:e.playheadFilter??1,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=qa(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await Br.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"re-tape-echo-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("mode",this._options.mode),this.sendParam("repeatRate",this._options.repeatRate),this.sendParam("intensity",this._options.intensity),this.sendParam("echoVolume",this._options.echoVolume),this.sendParam("wow",this._options.wow),this.sendParam("flutter",this._options.flutter),this.sendParam("dirt",this._options.dirt),this.sendParam("inputBleed",this._options.inputBleed),this.sendParam("loopAmount",this._options.loopAmount),this.sendParam("playheadFilter",this._options.playheadFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Dr,jsCode:Rr}),A(this.input,this.workletNode),A(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!jr){if(Lr)return Lr;Lr=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}re-tape-echo/RETapeEcho.worklet.js`)}catch(n){const e=n?.message||String(n);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load RETapeEcho worklet: ${e}`)}if(!Dr||!Rr){const[e,n]=await Promise.all([fetch(`${t}re-tape-echo/RETapeEcho.wasm`),fetch(`${t}re-tape-echo/RETapeEcho.js`)]);if(!e.ok||!n.ok)throw Lr=null,new Error(`Failed to fetch RETapeEcho WASM/JS: wasm=${e.status} js=${n.status}`);Dr=await e.arrayBuffer();let a=await n.text();a=a.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),a+="\nvar createRETapeEcho = createRETapeEcho || Module;",Rr=a}jr=!0})();try{await Lr}catch(t){throw Lr=null,jr=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setMode(e){this._options.mode=Math.max(0,Math.min(Math.round(e),5)),this.sendParam("mode",this._options.mode)}setRepeatRate(e){this._options.repeatRate=Math.max(0,Math.min(e,1)),this.sendParam("repeatRate",this._options.repeatRate)}setIntensity(e){this._options.intensity=Math.max(0,Math.min(e,1)),this.sendParam("intensity",this._options.intensity)}setEchoVolume(e){this._options.echoVolume=Math.max(0,Math.min(e,1)),this.sendParam("echoVolume",this._options.echoVolume)}setWow(e){this._options.wow=Math.max(0,Math.min(e,1)),this.sendParam("wow",this._options.wow)}setFlutter(e){this._options.flutter=Math.max(0,Math.min(e,1)),this.sendParam("flutter",this._options.flutter)}setDirt(e){this._options.dirt=Math.max(0,Math.min(e,1)),this.sendParam("dirt",this._options.dirt)}setInputBleed(e){this._options.inputBleed=e?1:0,this.sendParam("inputBleed",e?1:0)}setLoopAmount(e){this._options.loopAmount=Math.max(0,Math.min(e,1)),this.sendParam("loopAmount",this._options.loopAmount)}setPlayheadFilter(e){this._options.playheadFilter=e?1:0,this.sendParam("playheadFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class Vr extends u{name="BiPhase";input;output;phaserA;phaserB;parallelInB;seriesInB;outputA;outputB;dryGain;wetGain;_options;constructor(e={}){super(),this._options={rateA:e.rateA??.5,depthA:e.depthA??.6,rateB:e.rateB??4,depthB:e.depthB??.4,feedback:e.feedback??.3,routing:e.routing??"parallel",wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.phaserA=new f({frequency:this._options.rateA,octaves:5*this._options.depthA,baseFrequency:350,stages:6,Q:20*this._options.feedback}),this.phaserB=new f({frequency:this._options.rateB,octaves:5*this._options.depthB,baseFrequency:450,stages:6,Q:20*this._options.feedback}),this.parallelInB=new p(0),this.seriesInB=new p(0),this.outputA=new p(1),this.outputB=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.phaserA),this.input.connect(this.parallelInB),this.parallelInB.connect(this.phaserB),this.phaserA.connect(this.seriesInB),this.seriesInB.connect(this.phaserB),this.phaserA.connect(this.outputA),this.outputA.connect(this.wetGain),this.phaserB.connect(this.outputB),this.outputB.connect(this.wetGain),this.wetGain.connect(this.output),this.setRouting(this._options.routing)}setRouting(e){this._options.routing=e,"parallel"===e?(this.parallelInB.gain.rampTo(1,.1),this.seriesInB.gain.rampTo(0,.1),this.outputA.gain.rampTo(1,.1),this.outputB.gain.rampTo(1,.1)):(this.parallelInB.gain.rampTo(0,.1),this.seriesInB.gain.rampTo(1,.1),this.outputA.gain.rampTo(0,.1),this.outputB.gain.rampTo(1,.1))}setRateA(e){this._options.rateA=e,this.phaserA.frequency.rampTo(e,.1)}setDepthA(e){this._options.depthA=e,this.phaserA.octaves=5*e}setRateB(e){this._options.rateB=e,this.phaserB.frequency.rampTo(e,.1)}setDepthB(e){this._options.depthB=e,this.phaserB.octaves=5*e}setFeedback(e){this._options.feedback=e;const t=20*e;this.phaserA.Q.value=t,this.phaserB.Q.value=t}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.phaserA.dispose(),this.phaserB.dispose(),this.parallelInB.dispose(),this.seriesInB.dispose(),this.outputA.dispose(),this.outputB.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}class zr extends u{name="DubFilter";input;output;filter;drive;gainNode;dryGain;wetGain;_options;constructor(e={}){super(),this._options={cutoff:e.cutoff??20,resonance:e.resonance??1,gain:e.gain??1,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.filter=new y({frequency:this._options.cutoff,type:"highpass",rolloff:-24,Q:this._options.resonance/100*20}),this.drive=new T({distortion:.1,wet:.5}),this.gainNode=new p(this._options.gain),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.filter),this.filter.connect(this.drive),this.drive.connect(this.gainNode),this.gainNode.connect(this.wetGain),this.wetGain.connect(this.output)}setCutoff(e){this._options.cutoff=e,this.filter.frequency.rampTo(e,.05)}setResonance(e){this._options.resonance=e;const t=e/100*20;this.filter.Q.rampTo(t,.1)}setGain(e){this._options.gain=e,this.gainNode.gain.rampTo(e,.1)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.filter.dispose(),this.drive.dispose(),this.gainNode.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}class Ur extends u{name="SidechainCompressor";compressor;dryGain;wetGain;sidechainInput;sidechainGainNode;sidechainAnalyser;_threshold;_ratio;_attack;_release;_knee;_sidechainGain;_wet;animationFrame=null;baseThreshold;input;output;constructor(e={}){super(),this._threshold=e.threshold??-24,this._ratio=e.ratio??4,this._attack=e.attack??.003,this._release=e.release??.25,this._knee=e.knee??6,this._sidechainGain=e.sidechainGain??1,this._wet=e.wet??1,this.baseThreshold=this._threshold,this.input=new p(1),this.output=new p(1),this.compressor=new I({threshold:this._threshold,ratio:this._ratio,attack:this._attack,release:this._release,knee:this._knee}),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.sidechainInput=new p(1),this.sidechainGainNode=new p(this._sidechainGain),this.sidechainAnalyser=new _({smoothing:.8,normalRange:!1}),this.input.connect(this.compressor),this.compressor.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.sidechainInput.connect(this.sidechainGainNode),this.sidechainGainNode.connect(this.sidechainAnalyser),this.startSidechainPolling()}getSidechainInput(){return this.sidechainInput}startSidechainPolling=()=>{this.updateSidechain()};updateSidechain=()=>{const e=this.sidechainAnalyser.getValue(),t="number"==typeof e?e:e[0];if(t>-60){const e=24*Math.min(1,Math.max(0,(t+60)/60))*this._sidechainGain;this.compressor.threshold.value=this.baseThreshold-e}else this.compressor.threshold.value=this.baseThreshold;this.animationFrame=requestAnimationFrame(this.updateSidechain)};get threshold(){return this._threshold}set threshold(e){this._threshold=Math.max(-60,Math.min(0,e)),this.baseThreshold=this._threshold,this.compressor.threshold.value=this._threshold}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.max(1,Math.min(20,e)),this.compressor.ratio.value=this._ratio}get attack(){return this._attack}set attack(e){this._attack=Math.max(.001,Math.min(.5,e)),this.compressor.attack.value=this._attack}get release(){return this._release}set release(e){this._release=Math.max(.01,Math.min(1,e)),this.compressor.release.value=this._release}get knee(){return this._knee}set knee(e){this._knee=Math.max(0,Math.min(40,e)),this.compressor.knee.value=this._knee}get sidechainGain(){return this._sidechainGain}set sidechainGain(e){this._sidechainGain=Math.max(0,Math.min(2,e)),this.sidechainGainNode.gain.value=this._sidechainGain}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}getReduction(){return this.compressor.reduction}dispose(){return null!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),super.dispose(),this.compressor.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.sidechainInput.dispose(),this.sidechainGainNode.dispose(),this.sidechainAnalyser.dispose(),this}}class Gr{config;loop=null;currentStepIndex=0;pingPongDirection=1;baseNote="C4";baseVelocity=1;isPlaying=!1;heldNotes=new Set;onStep;onNoteOn;onNoteOff;currentPlayingNote=null;constructor(e){this.config={...e.config},this.onStep=e.onStep,this.onNoteOn=e.onNoteOn,this.onNoteOff=e.onNoteOff}getSteps(){return this.config.steps&&this.config.steps.length>0?this.config.steps:this.config.pattern&&this.config.pattern.length>0?this.config.pattern.map(e=>({noteOffset:e})):[{noteOffset:0}]}getInterval(){const{speed:e,speedUnit:t}=this.config,n=O().bpm.value;switch(t){case"hz":return 1/Math.max(1,Math.min(60,e));case"ticks":return 60/n*(e/48);case"division":return{1:"1n",2:"2n",4:"4n",8:"8n",16:"16n",32:"32n",64:"64n"}[e]||`${e}n`;default:return 1/15}}getSwingAdjustedTime(e,t){const n=(this.config.swing??0)/100;if(0===n)return e;if(t%2==0){return e+("number"==typeof this.getInterval()?this.getInterval():.066)*n*.5}return e}getNextStepIndex(){const e=this.getSteps().length;switch(this.config.mode){case"loop":default:return(this.currentStepIndex+1)%e;case"pingpong":let t=this.currentStepIndex+this.pingPongDirection;return t>=e?(this.pingPongDirection=-1,t=e-2):t<0&&(this.pingPongDirection=1,t=1),e<=2?(this.currentStepIndex+1)%e:Math.max(0,Math.min(e-1,t));case"oneshot":const n=this.currentStepIndex+1;return n>=e?(this.isPlaying=!1,e-1):n;case"random":return Math.floor(Math.random()*e)}}midiToNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}noteNameToMidi(e){const t=e.match(/^([A-Ga-g][#b]?)(-?\d+)$/);if(!t)return 60;const n=t[1].charAt(0).toUpperCase()+t[1].slice(1);return 12*(parseInt(t[2],10)+1)+({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n]??0)}processStep(e){if(!this.isPlaying)return;const t=this.getSteps()[this.currentStepIndex];if(!t)return;if("skip"===t.effect)return void(this.currentStepIndex=this.getNextStepIndex());const n=this.noteNameToMidi(this.baseNote)+t.noteOffset,a=this.midiToNoteName(n),s=(t.volume??100)/100,r="accent"===t.effect?1.2:1,o=Math.min(1,this.baseVelocity*s*r),i=(t.gate??100)/100,l=("number"==typeof this.getInterval()?this.getInterval():w(this.getInterval()).toSeconds())*i*.95;this.currentPlayingNote&&this.onNoteOff&&this.onNoteOff(this.currentPlayingNote),this.onNoteOn&&this.onNoteOn(a,o,l),this.currentPlayingNote=a,this.onStep&&this.onStep(this.currentStepIndex,t,t.noteOffset),this.currentStepIndex=this.getNextStepIndex()}start(e,t=1){if(this.isPlaying)return this.baseNote=e,this.baseVelocity=t,void this.heldNotes.add(e);this.baseNote=e,this.baseVelocity=t,this.currentStepIndex=0,this.pingPongDirection=1,this.isPlaying=!0,this.heldNotes.add(e);const n=this.getInterval();this.loop=new F(e=>{this.processStep(e)},n),this.loop.start(0)}stop(e){if(e){if(this.heldNotes.delete(e),this.heldNotes.size>0){const e=Array.from(this.heldNotes)[this.heldNotes.size-1];return void(this.baseNote=e)}}else this.heldNotes.clear();this.currentPlayingNote&&this.onNoteOff&&(this.onNoteOff(this.currentPlayingNote),this.currentPlayingNote=null),this.loop&&(this.loop.stop(),this.loop.dispose(),this.loop=null),this.isPlaying=!1,this.currentStepIndex=0,this.pingPongDirection=1}stopAll(){this.heldNotes.clear(),this.stop()}updateConfig(e){if(this.config={...this.config,...e},this.loop&&this.isPlaying){const e=this.getInterval();this.loop.interval=e}"oneshot"===e.mode&&(this.currentStepIndex=0)}getCurrentStep(){return this.currentStepIndex}getIsPlaying(){return this.isPlaying}getConfig(){return{...this.config}}dispose(){this.stopAll(),this.loop&&(this.loop.dispose(),this.loop=null)}}const Kr={OPN2:0,OPM:1,OPL3:2,OPLL:11,OPNA:13,OPNB:14,OPZ:22,Y8950:23,OPL4:26,OPN:47,OPNB_B:48,ESFM:49,PSG:3,AY:12,SAA:18,T6W28:43,AY8930:50,NES:4,GB:5,SNES:24,FDS:16,MMC5:17,VRC6:9,N163:8,VB:44,NDS:51,GBA_DMA:52,GBA_MINMOD:53,POKEMINI:54,PCE:6,SCC:7,SWAN:19,SM8521:37,BUBBLE:38,X1_010:41,NAMCO:55,SID:10,SID_6581:45,SID_8580:46,VIC:33,TED:34,PET:56,TIA:15,POKEY:57,LYNX:25,OKI:20,ES5506:21,SEGAPCM:27,YMZ280B:28,RF5C68:29,GA20:30,C140:31,QSOUND:32,K007232:39,K053260:40,MSM6258:58,MSM5232:59,MULTIPCM:60,AMIGA:61,VERA:36,SUPERVISION:35,UPD1771:42,PCSPKR:62,PONG:63,PV1000:64,DAVE:65,SU:66,BIFURCATOR:67,POWERNOISE:68,ZXBEEPER:69,ZXBEEPER_QT:70,SCVTONE:71,PCMDAC:72},Hr="__FurnaceChipEngineInstance__";class Wr{static instance=null;static instanceId=0;myInstanceId;isLoaded=!1;initPromise=null;initFailedPermanently=!1;workletNode=null;lastInitAttempt=0;writeCount=0;nativeContext=null;rawContext=null;outputGain=null;constructor(){this.myInstanceId=++Wr.instanceId}static getInstance(){const e=globalThis[Hr];return e?(Wr.instance!==e&&(Wr.instance=e),e):(Wr.instance||(Wr.instance=new Wr,globalThis[Hr]=Wr.instance),Wr.instance)}async init(e){if(this.isLoaded)return;if(this.initFailedPermanently)return;if(this.initPromise)return this.initPromise;const t=Date.now();return t-this.lastInitAttempt<500?void 0:(this.lastInitAttempt=t,this.initPromise=this.doInit(e),this.initPromise)}async doInit(e){try{const s=e,r=s.rawContext||s._context||e,o=qa(e);if(!r||!r.audioWorklet)return void(this.initPromise=null);if("running"!==r.state){try{await r.resume()}catch{}if("running"!==r.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===r.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const i="/DEViLBOX/",l=`?v=${Date.now()}`,c=o instanceof AudioContext?o:r,d=`${i}FurnaceChips.worklet.js${l}`;try{await c.audioWorklet.addModule(d)}catch(t){if(!t?.message?.includes("already")&&"InvalidStateError"!==t?.name)return void(this.initPromise=null)}const u=`${i}FurnaceChips.wasm${l}`,p=`${i}FurnaceChips.js${l}`,[h,m]=await Promise.all([fetch(u,{cache:"no-store"}),fetch(p,{cache:"no-store"})]);if(!h.ok)return void(this.initPromise=null);if(!m.ok)return void(this.initPromise=null);const f=await h.arrayBuffer();let y=await m.text();y='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+y.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');try{this.nativeContext=o,this.workletNode=new AudioWorkletNode(c,"furnace-chips-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode}catch(t){return void(this.initPromise=null)}const g=new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4),n=a=>{"initialized"===a.data.type&&(clearTimeout(t),this.workletNode?.port.removeEventListener("message",n),e(!0))};this.workletNode.port.addEventListener("message",n),this.workletNode.port.start()});this.workletNode&&this.workletNode.port.postMessage({type:"init",wasmBinary:f,jsCode:y});if(await g){this.isLoaded=!0,this.rawContext=c;try{const e=c.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(c.destination),this.outputGain=e}catch(n){try{if(o&&o.destination){const e=o.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(o.destination),this.outputGain=e}}catch(a){}}this.workletNode.port.addEventListener("message",e=>{"debug"===e.data.type?e.data.msgType:e.data.type}),setTimeout(()=>{this.requestWorkletStatus()},500)}else this.initPromise=null}catch(t){this.initPromise=null}}write(e,t,n){if(this.writeCount,!this.workletNode)return this.writeCount,void this.writeCount++;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(()=>{});const a={type:"write",chipType:e,register:t,value:n,writeId:this.writeCount};this.workletNode.port.postMessage(a);const s=8===t||40===t||t>=160&&t<=167;if(this.writeCount<10||s){this.nativeContext}this.writeCount++}getDiagnostics(){return{loaded:this.isLoaded,hasWorklet:null!==this.workletNode,contextState:this.nativeContext?.state||null}}requestWorkletStatus(){this.workletNode&&this.workletNode.port.postMessage({type:"getStatus"})}testPing(){this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now()})}testWrite(){this.workletNode&&this.workletNode.port.postMessage({type:"write",chipType:0,register:255,value:170,writeId:-1})}getNativeOutput(){return this.outputGain}getWorkletDiagnostics(){const e=null!==this.workletNode,t=null!==this.workletNode?.port;return{hasNode:e,hasPort:t,portId:t?`port-inst-${this.myInstanceId}`:"none"}}resetWriteCount(){this.writeCount=0;this.rawContext;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(e=>{}),this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now(),label:"post-reset"})}setWavetable(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",chipType:e,index:t,data:n})}setLogging(e){this.workletNode&&this.workletNode.port.postMessage({type:"setLogging",enabled:e})}async getLog(){return this.workletNode?new Promise(e=>{const t=n=>{"logData"===n.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(n.data.data))};this.workletNode?.port.addEventListener("message",t),this.workletNode?.port.postMessage({type:"getLog"})}):new Uint8Array(0)}getOutput(){if(!this.workletNode)throw new Error("Engine not initialized");return this.workletNode}setOutputGain(e){this.outputGain&&this.outputGain.gain.setValueAtTime(e,this.rawContext?.currentTime||0)}getOutputGainValue(){return this.outputGain?.gain.value??1}isInitialized(){return this.isLoaded&&null!==this.workletNode}deactivate(e){this.workletNode&&this.workletNode.port.postMessage({type:"deactivate",chipType:e})}}const $r=[{id:"32x16FunkyLead",name:"Funky Lead",category:"32x16",len:32,max:15,data:[8,15,14,11,9,6,4,4,6,7,6,4,3,3,4,6,8,9,11,12,12,11,9,8,9,11,11,9,6,4,1,0]},{id:"32x16NamcoBass",name:"Namco Bass",category:"32x16",len:32,max:15,data:[7,10,12,13,14,13,12,10,7,4,2,1,0,1,2,4,7,11,13,14,13,11,7,3,1,0,1,3,7,14,7,0]},{id:"32x16ataribass",name:"Atari Bass",category:"32x16",len:32,max:15,data:[15,15,0,0,15,15,0,0,0,0,15,15,15,15,0,0,15,15,15,15,15,15,0,0,0,0,0,0,0,0,0,0]},{id:"32x16brass",name:"Brass",category:"32x16",len:32,max:15,data:[15,14,13,12,11,8,6,2,4,3,7,9,9,7,5,0,15,15,13,13,13,11,11,8,8,0,0,0,0,0,0,0]},{id:"32x16clarinet",name:"Clarinet",category:"32x16",len:32,max:15,data:[12,14,15,15,15,15,15,15,15,15,15,15,15,15,14,12,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,3]},{id:"32x16distortedsquare",name:"Distorted Square",category:"32x16",len:32,max:15,data:[14,12,10,11,14,9,10,13,9,14,10,15,13,7,14,6,5,1,6,0,3,2,4,5,0,3,2,4,2,3,6,1]},{id:"32x16eguitar",name:"E-Guitar",category:"32x16",len:32,max:15,data:[0,12,9,6,13,2,9,12,4,3,4,12,10,8,8,1,2,0,9,10,10,12,0,0,5,3,0,15,0,0,10,10]},{id:"32x16flute",name:"Flute",category:"32x16",len:32,max:15,data:[12,14,15,15,14,14,14,15,13,14,15,15,14,13,11,9,6,4,2,0,0,2,2,2,1,1,1,1,0,1,2,4]},{id:"32x16guitar",name:"Guitar",category:"32x16",len:32,max:15,data:[9,15,15,14,15,15,15,15,15,15,15,13,5,1,1,3,7,7,5,4,2,1,0,4,8,7,4,1,2,3,5,6]},{id:"32x16opllpiano",name:"OPLL Piano",category:"32x16",len:32,max:15,data:[7,13,15,15,15,15,14,11,10,12,15,14,8,3,2,4,7,11,13,13,10,4,0,2,5,5,3,1,0,0,0,1]},{id:"32x16opllvibra",name:"OPLL Vibraphone",category:"32x16",len:32,max:15,data:[5,14,12,9,8,15,15,15,14,15,12,13,15,15,11,4,7,11,9,1,0,2,4,1,1,0,0,0,4,7,4,1]},{id:"32x16reedorgan",name:"Reed Organ",category:"32x16",len:32,max:15,data:[8,12,10,11,10,12,12,13,12,15,14,13,12,13,13,9,6,2,2,3,2,1,0,3,2,3,3,5,4,5,3,7]},{id:"32x16saw",name:"Saw",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]},{id:"32x16saw2",name:"Saw 2",category:"32x16",len:32,max:15,data:[15,14,13,12,11,10,9,8,15,14,13,12,11,10,9,8,12,14,12,10,8,6,5,4,3,3,2,2,1,1,0,0]},{id:"32x16sax",name:"Sax",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,0,15,10,11,12,13,14,15,15]},{id:"32x16slapbass",name:"Slap Bass",category:"32x16",len:32,max:15,data:[8,13,15,15,13,11,8,7,6,8,10,14,15,12,4,0,8,15,12,3,0,2,5,8,9,9,7,5,2,0,0,3]},{id:"32x16synthbass",name:"Synth Bass",category:"32x16",len:32,max:15,data:[10,9,9,8,5,7,7,5,4,4,5,7,8,9,10,10,10,9,7,6,8,10,12,12,12,11,8,4,3,2,3,1]},{id:"32x16synthbrass",name:"Synth Brass",category:"32x16",len:32,max:15,data:[2,15,5,0,0,9,15,13,11,9,12,14,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x16trumpet",name:"Trumpet",category:"32x16",len:32,max:15,data:[7,15,13,12,10,10,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,6,5,5,3,2,0,0]},{id:"32x16voice",name:"Voice",category:"32x16",len:32,max:15,data:[7,8,9,10,10,11,11,12,12,12,12,12,12,12,12,12,11,11,10,10,9,8,7,2,1,0,0,0,0,0,1,2]},{id:"32x32KeygenBass",name:"Keygen Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,25,27,29,30,31,31,31,31,31,31,31,31,31]},{id:"32x32accordion",name:"Accordion",category:"32x32",len:32,max:31,data:[0,8,1,13,20,23,20,17,23,17,9,9,18,17,16,26,31,26,27,24,20,14,5,12,10,18,11,15,21,12,5,11]},{id:"32x32accordion2",name:"Accordion 2",category:"32x32",len:32,max:31,data:[16,17,21,22,22,22,20,19,13,12,11,10,10,13,15,17,27,27,31,31,31,29,25,23,9,7,3,1,0,2,4,6]},{id:"32x32acousticguitar",name:"Acoustic Guitar",category:"32x32",len:32,max:31,data:[2,18,26,28,29,28,28,28,29,31,31,27,14,2,1,0,1,2,2,0,1,1,1,1,1,1,1,0,0,0,0,0]},{id:"32x32agogo",name:"Agogo",category:"32x32",len:32,max:31,data:[16,8,6,31,13,16,16,14,25,21,8,12,28,18,18,12,16,16,23,0,13,16,20,16,6,12,18,17,8,15,15,26]},{id:"32x32ataribass",name:"Atari Bass",category:"32x32",len:32,max:31,data:[31,31,31,31,31,31,31,31,0,0,0,0,0,0,0,0,31,31,31,0,0,0,31,31,31,31,31,0,0,0,0,0]},{id:"32x32bass2",name:"Bass 2",category:"32x32",len:32,max:31,data:[15,25,31,31,26,18,12,7,4,3,3,3,4,6,8,12,15,19,23,26,28,29,29,29,28,26,22,16,8,2,0,5]},{id:"32x32bass3",name:"Bass 3",category:"32x32",len:32,max:31,data:[15,15,12,7,2,0,2,7,15,24,29,31,29,24,19,16,15,16,17,18,17,17,16,15,15,15,15,14,14,13,14,15]},{id:"32x32bell",name:"Bell",category:"32x32",len:32,max:31,data:[16,31,30,16,26,25,13,28,31,15,0,0,8,4,10,26,13,4,20,30,29,30,30,19,1,9,23,9,5,11,0,0]},{id:"32x32brass",name:"Brass",category:"32x32",len:32,max:31,data:[31,31,29,27,25,23,21,19,16,14,12,10,8,6,4,2,28,26,23,21,19,17,14,12,22,20,17,15,13,11,9,6]},{id:"32x32brass2",name:"Brass 2",category:"32x32",len:32,max:31,data:[16,18,21,24,27,29,30,31,31,31,30,29,27,24,21,18,0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29]},{id:"32x32chime",name:"Chime",category:"32x32",len:32,max:31,data:[15,27,23,17,23,27,21,15,23,30,26,17,21,23,15,6,15,24,15,7,9,13,4,0,7,15,9,3,7,13,7,3]},{id:"32x32choir",name:"Choir",category:"32x32",len:32,max:31,data:[0,3,8,13,22,26,30,31,31,30,28,24,20,18,17,16,15,15,15,15,16,16,16,16,15,14,12,10,8,5,2,0]},{id:"32x32clarinet",name:"Clarinet",category:"32x32",len:32,max:31,data:[20,31,29,26,26,28,30,31,31,30,28,26,25,27,30,31,15,0,4,6,6,4,2,0,0,1,3,5,6,6,2,2]},{id:"32x32clarinet2",name:"Clarinet 2",category:"32x32",len:32,max:31,data:[21,27,30,28,24,22,24,26,24,22,19,18,19,26,23,19,12,6,0,1,4,8,7,5,7,10,13,11,9,7,5,10]},{id:"32x32distortedpulse",name:"Distorted Pulse",category:"32x32",len:32,max:31,data:[31,31,31,31,0,0,0,0,16,16,16,16,0,0,0,0,8,8,8,8,0,0,0,0,3,3,3,3,0,0,0,0]},{id:"32x32distortedpulse2",name:"Distorted Pulse 2",category:"32x32",len:32,max:31,data:[3,25,13,15,18,16,17,15,15,15,17,15,12,11,6,15,27,0,13,15,18,3,8,15,15,20,17,15,12,31,29,15]},{id:"32x32distortedsaw",name:"Distorted Saw",category:"32x32",len:32,max:31,data:[0,7,10,10,14,14,17,17,21,21,25,25,27,27,29,29,29,29,31,31,31,31,31,5,8,11,14,16,18,20,22,0]},{id:"32x32ebass",name:"E-Bass",category:"32x32",len:32,max:31,data:[17,21,31,28,23,27,30,13,0,8,11,10,7,8,14,21,27,27,26,25,31,19,0,2,0,0,0,8,15,18,18,16]},{id:"32x32eguitar",name:"E-Guitar",category:"32x32",len:32,max:31,data:[3,9,16,23,28,31,31,29,26,23,25,27,28,29,28,22,8,0,12,28,0,14,2,0,1,31,30,4,3,1,0,0]},{id:"32x32eguitar2",name:"E-Guitar 2",category:"32x32",len:32,max:31,data:[16,27,31,28,31,25,16,0,3,0,11,7,5,16,18,17,23,23,30,31,29,30,0,12,3,4,4,8,11,10,20,21]},{id:"32x32englishhorn",name:"English Horn",category:"32x32",len:32,max:31,data:[16,22,31,22,15,9,15,9,15,13,11,8,6,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,6,8,11]},{id:"32x32fantasia",name:"Fantasia",category:"32x32",len:32,max:31,data:[0,6,14,15,14,8,5,7,15,15,21,26,27,26,21,15,17,23,29,31,31,28,22,12,11,15,19,20,19,17,6,1]},{id:"32x32filteredsaw",name:"Filtered Saw",category:"32x32",len:32,max:31,data:[16,18,20,21,23,25,26,28,29,30,31,31,31,31,30,26,19,9,3,1,0,0,1,2,3,4,6,7,9,11,12,14]},{id:"32x32filteredsquare",name:"Filtered Square",category:"32x32",len:32,max:31,data:[20,24,27,28,29,30,31,31,31,31,30,29,28,27,24,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32flute",name:"Flute",category:"32x32",len:32,max:31,data:[16,19,23,27,30,31,31,31,29,25,21,17,12,8,6,4,3,3,3,3,3,3,3,3,4,5,6,7,8,9,11,13]},{id:"32x32frenchhorn",name:"French Horn",category:"32x32",len:32,max:31,data:[16,22,27,29,30,31,31,26,22,16,14,9,4,5,8,15,19,20,18,16,14,10,8,8,8,8,9,13,14,13,13,13]},{id:"32x32frenchhorn2",name:"French Horn 2",category:"32x32",len:32,max:31,data:[29,31,29,27,24,22,18,11,2,0,2,4,8,13,16,17,18,17,16,13,8,4,2,0,2,11,18,22,24,27,29,31]},{id:"32x32glockenspiel",name:"Glockenspiel",category:"32x32",len:33,max:31,data:[16,29,24,17,24,29,20,16,24,31,26,16,20,22,15,5,16,26,15,11,15,15,5,0,7,15,11,2,7,15,7,2,16]},{id:"32x32hardslap",name:"Hard Slap",category:"32x32",len:32,max:31,data:[18,30,21,16,15,17,22,31,2,11,29,0,20,10,15,31,6,21,30,0,7,11,12,8,1,11,30,16,1,31,18,4]},{id:"32x32jazzguitar",name:"Jazz Guitar",category:"32x32",len:32,max:31,data:[0,2,3,2,1,0,0,2,11,19,24,29,30,30,29,28,27,28,30,31,30,25,17,13,13,15,16,17,16,13,7,0]},{id:"32x32lead",name:"Lead",category:"32x32",len:32,max:31,data:[31,23,18,14,11,9,7,5,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,5,7,9,11,14,18,23,31]},{id:"32x32lead2",name:"Lead 2",category:"32x32",len:32,max:31,data:[11,20,26,30,31,31,30,22,12,0,1,1,1,17,16,16,16,16,30,31,30,0,5,8,18,20,21,22,20,19,15,11]},{id:"32x32mutetrumpet",name:"Mute Trumpet",category:"32x32",len:32,max:31,data:[31,29,20,15,12,11,12,12,13,13,13,14,14,15,16,15,15,15,14,14,15,15,16,16,16,16,16,16,17,17,17,24]},{id:"32x32oboe",name:"Oboe",category:"32x32",len:32,max:31,data:[21,31,14,0,1,8,14,18,20,22,22,22,21,20,18,17,15,13,12,11,10,9,9,10,12,15,20,27,31,30,13,1]},{id:"32x32octavelead",name:"Octave Lead",category:"32x32",len:32,max:31,data:[6,11,15,19,23,27,29,31,13,14,15,16,17,18,18,0,3,6,9,12,14,16,17,18,0,0,0,0,0,0,0,0]},{id:"32x32octavesaw",name:"Octave Saw",category:"32x32",len:32,max:31,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]},{id:"32x32organ",name:"Organ",category:"32x32",len:32,max:31,data:[23,31,31,28,27,26,19,15,19,23,17,10,9,11,8,10,20,29,28,22,19,17,9,5,8,13,8,3,2,6,5,9]},{id:"32x32organ2",name:"Organ 2",category:"32x32",len:32,max:31,data:[16,19,26,30,31,27,23,14,10,6,8,9,9,8,13,14,18,17,20,22,26,24,24,19,18,13,12,9,5,2,5,8]},{id:"32x32organ3",name:"Organ 3",category:"32x32",len:32,max:31,data:[16,31,31,24,22,24,20,15,16,18,17,17,22,22,11,6,16,25,21,11,10,15,16,14,16,17,12,8,10,9,0,0]},{id:"32x32piano",name:"Piano",category:"32x32",len:32,max:31,data:[18,30,31,29,31,30,30,31,31,31,31,26,10,2,2,6,14,14,10,8,5,3,1,9,17,15,8,2,4,7,10,13]},{id:"32x32piano2",name:"Piano 2",category:"32x32",len:32,max:31,data:[14,27,31,31,31,31,28,22,21,24,31,29,16,7,5,8,15,22,26,26,21,8,0,4,10,11,6,2,0,1,0,2]},{id:"32x32reedorgan",name:"Reed Organ",category:"32x32",len:32,max:31,data:[16,22,31,22,15,8,0,8,16,22,31,22,15,8,16,22,15,13,16,18,16,16,16,16,16,16,31,31,31,31,31,31]},{id:"32x32sam",name:"SAM",category:"32x32",len:32,max:31,data:[5,10,15,10,10,15,15,26,31,31,31,26,21,15,10,10,10,10,15,21,26,26,26,26,21,26,21,21,10,5,0,0]},{id:"32x32saw2",name:"Saw 2",category:"32x32",len:32,max:31,data:[15,31,30,25,23,20,19,17,17,16,15,15,15,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{id:"32x32sax",name:"Sax",category:"32x32",len:32,max:31,data:[0,16,22,27,29,31,29,27,22,16,9,5,2,0,2,5,9,16,24,29,31,29,24,16,7,2,0,2,7,16,31,16]},{id:"32x32strings",name:"Strings",category:"32x32",len:32,max:31,data:[5,31,10,0,0,18,31,26,23,19,25,28,31,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32strings2",name:"Strings 2",category:"32x32",len:32,max:31,data:[21,26,26,21,16,16,16,24,29,31,29,21,15,12,12,16,19,19,15,7,2,0,2,7,16,16,10,5,5,10,16,16]},{id:"32x32synthbass",name:"Synth Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,15,15,0,0,15,15,31,31,31,31,31,31,0,7,7,7,7,7,7,0,23,23,23,23,23,23,0]},{id:"32x32synthbell",name:"Synth Bell",category:"32x32",len:32,max:31,data:[16,31,26,31,19,12,16,19,11,0,6,0,29,18,4,28,19,0,7,0,15,19,16,12,23,31,27,31,4,14,28,5]},{id:"32x32synthlead",name:"Synth Lead",category:"32x32",len:32,max:31,data:[0,0,0,0,3,26,1,0,1,28,0,29,0,18,5,4,0,0,3,0,31,0,20,31,5,2,0,20,27,31,0,16]},{id:"32x32synthlead2",name:"Synth Lead 2",category:"32x32",len:32,max:31,data:[16,16,15,0,16,31,31,31,16,16,15,0,15,15,15,0,0,0,0,15,0,0,15,15,15,15,0,0,0,15,0,0]},{id:"32x32synthpiano",name:"Synth Piano",category:"32x32",len:32,max:31,data:[14,7,8,8,7,3,2,5,3,4,13,25,31,31,31,30,25,14,14,18,22,17,9,9,8,9,15,25,30,29,23,5]},{id:"32x32synthstrings",name:"Synth Strings",category:"32x32",len:32,max:31,data:[17,26,31,31,27,22,17,14,13,16,21,28,31,25,8,1,16,31,24,7,0,5,11,17,19,18,15,10,4,1,1,7]},{id:"32x32trumpet",name:"Trumpet",category:"32x32",len:32,max:31,data:[15,31,26,24,21,20,19,19,18,17,17,17,17,16,17,16,16,16,16,16,16,16,15,14,14,12,11,10,7,4,1,0]},{id:"32x32tuba",name:"Tuba",category:"32x32",len:32,max:31,data:[19,28,31,30,26,22,19,17,16,15,14,14,15,15,15,16,17,17,18,18,18,18,18,17,16,14,11,8,4,1,0,7]},{id:"32x32vibraphone",name:"Vibraphone",category:"32x32",len:32,max:31,data:[10,28,25,18,17,30,31,31,29,31,25,26,30,31,22,9,15,22,19,2,1,5,9,2,3,1,0,0,8,15,8,3]},{id:"32x32voice",name:"Voice",category:"32x32",len:32,max:31,data:[16,25,28,31,28,25,12,8,8,13,19,29,31,29,24,19,9,8,3,2,1,1,0,1,0,0,2,1,5,5,8,14]},{id:"32x32voice2",name:"Voice 2",category:"32x32",len:32,max:31,data:[0,6,8,17,19,21,21,19,16,12,10,12,20,26,29,30,29,21,13,0,1,1,2,2,16,31,30,30,28,16,8,2]},{id:"128x256bass",name:"Bass",category:"128x256",len:128,max:255,data:[0,1,5,17,41,76,120,164,201,227,242,249,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,250,248,244,240,236,232,228,224,222,220,218,217,216,215,214,213,212,210,207,204,199,194,189,184,178,172,166,160,154,148,144,140,136,133,131,129,127,125,123,122,121,120,119,118,117,114,111,107,102,97,90,83,76,70,64,58,52,46,42,39,37,35,34,33,32,31,30,29,28,25,22,17,13,9,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"128x256chime",name:"Chime",category:"128x256",len:128,max:255,data:[128,154,184,203,201,192,190,187,181,176,172,167,164,161,160,161,165,174,188,210,235,252,255,254,253,253,252,250,249,248,246,245,244,244,246,248,252,255,251,233,210,212,223,224,225,230,233,235,237,239,240,240,239,236,230,217,192,151,110,101,118,122,123,130,136,140,144,148,151,151,150,145,136,118,91,55,23,13,20,25,24,28,33,35,38,41,44,44,44,41,35,26,13,2,2,12,9,5,5,4,2,1,1,0,0,0,0,0,1,3,9,25,57,92,95,80,77,76,69,64,61,57,54,52,52,53,58,67]},{id:"128x256lead",name:"Lead",category:"128x256",len:128,max:255,data:[96,159,151,135,187,216,196,170,210,251,206,157,149,151,191,242,206,206,248,206,168,164,166,208,247,200,156,186,218,207,179,212,255,241,241,255,255,255,255,255,248,241,248,255,255,255,232,195,217,212,179,221,250,242,223,163,105,134,164,126,94,110,150,123,102,153,132,104,144,161,128,90,120,149,91,31,13,4,34,76,42,37,60,22,0,0,0,7,13,6,0,0,0,0,0,14,14,0,43,75,48,37,68,98,54,8,47,88,91,87,49,6,49,49,13,64,103,105,98,49,4,44,84,58,38,67,119,104]}];function qr(e,t){if(e.max===t)return e.data;const n=t/e.max;return e.data.map(e=>Math.round(Math.max(0,Math.min(t,e*n))))}function Yr(e,t){const n=(a=e,$r.find(e=>e.id===a));var a;if(!n)return null;switch(t){case"gb":case"n163":case"swan":return qr(n,15);case"pce":case"vb":return 31===n.max?n.data:qr(n,31);case"scc":return qr(n,255).map(e=>e-128);case"lynx":return qr(n,255);default:return n.data}}class Xr{static mapOPN2(e,t,n){const a=Kr.OPN2,s=t%3,r=0===(t<3?0:1)?0:256;if(e.write(a,34,8),n.fms||n.ams){const t=n.fms??0;e.write(a,34,8|7&t)}const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapOPM(e,t,n){const a=Kr.OPM,s=7&t;if(e.write(a,1,2),e.write(a,24,0),e.write(a,25,127),e.write(a,25,255),n.fms||n.ams){const t=n.fms??0;e.write(a,24,16*t&255);const s=n.fms??127,r=n.ams??127;e.write(a,25,128|127&s),e.write(a,25,127&r)}const r=192|(7&n.feedback)<<3|7&n.algorithm;e.write(a,32+s,r);const o=n.fms??0,i=n.ams??0;e.write(a,56+s,(7&o)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const r=l[n]+s,o=this.furnaceDtToOPN2(t.dt??0);e.write(a,64+r,(7&o)<<4|15&(t.mult??1)),e.write(a,96+r,127&(t.tl??0)),e.write(a,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(a,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(a,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(a,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapOPL3(e,t,n,a){const s=a??Kr.OPL3;e.write(s,261,1),e.write(s,1,32);const r=t<9?0:256,o=t%9,i=48|(7&n.feedback)<<1|1&n.algorithm;e.write(s,r|192+o,i);const l=this.getOPL3Slots(o);n.operators.slice(0,2).forEach((t,n)=>{const a=r|l[n],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(s,32+a,o),e.write(s,64+a,(3&t.ksl)<<6|63&t.tl),e.write(s,96+a,t.ar>>1<<4|t.dr>>1),e.write(s,128+a,(15&t.sl)<<4|15&t.rr),e.write(s,224+a,7&t.ws)})}static mapPSG(e,t,n){const a=Kr.PSG;e.write(a,0,231),e.write(a,1,255);const s=144|(3&t)<<5|15&Math.min(15,Math.floor(n.operators[0].tl/8));e.write(a,0,s)}static mapGB(e,t,n){const a=Kr.GB;e.write(a,16,0),e.write(a,38,143),e.write(a,37,255),e.write(a,36,255)}static mapC64(e,t,n){const a=n.c64,s=n.chipType===Kr.SID_6581||n.chipType===Kr.SID_8580,r=s?n.chipType:Kr.SID;if(s){const n=7*t,s=a?.a??0,o=a?.d??8;e.write(r,n+5,(15&s)<<4|15&o);const i=a?.s??15,l=a?.r??4;e.write(r,n+6,(15&i)<<4|15&l);const c=a?.duty??2048;e.write(r,n+2,255&c),e.write(r,n+3,c>>8&15);let d=0;a?(a.noiseOn&&(d|=128),a.pulseOn&&(d|=64),a.sawOn&&(d|=32),a.triOn&&(d|=16),a.ringMod&&(d|=4),a.oscSync&&(d|=2)):d=64,e.write(r,n+4,d),e.write(r,24,15);const u=a?.filterResonance??a?.filterRes??0;let p=0;a?.filterOn&&!0!==a?.filterCh3Off&&(p|=1<<t),e.write(r,23,(15&u)<<4|p)}else{const n=0,s=1,o=2,i=3,l=5,c=6,d=7,u=8,p=13,h=50,m=51,f=t*64,y=17*(a?.a??0),g=17*(a?.d??8),v=17*(a?.s??15),b=17*(a?.r??4);e.write(r,f+s,255&y),e.write(r,f+o,255&g),e.write(r,f+i,255&v),e.write(r,f+l,255&b);let x=0;a?(a.triOn&&(x|=1),a.sawOn&&(x|=2),a.pulseOn&&(x|=4),a.noiseOn&&(x|=8)):x=4,e.write(r,f+c,x);const w=a?.duty??2048;e.write(r,f+d,w>>8&255),e.write(r,f+u,255&w),e.write(r,f+p,255),e.write(r,f+h,255),e.write(r,f+m,255),e.write(r,f+n,0)}}static mapNES(e,t,n){const a=Kr.NES;if(e.write(a,16405,31),e.write(a,16385,8),e.write(a,16389,8),e.write(a,16384,48),e.write(a,16386,0),e.write(a,16387,8),e.write(a,16388,48),e.write(a,16390,0),e.write(a,16391,8),e.write(a,16392,0),e.write(a,16394,0),e.write(a,16395,8),e.write(a,16396,48),e.write(a,16398,8),e.write(a,16399,8),t<2){const s=4*t,r=3&Math.floor((n.operators[0]?.mult??2)/4),o=Math.max(0,15-Math.floor(n.operators[0].tl/8));e.write(a,16384+s,r<<6|48|15&o)}else if(2===t)e.write(a,16392,255);else if(3===t){const t=Math.max(0,15-Math.floor(n.operators[0].tl/8));e.write(a,16396,48|15&t)}}static mapAY(e,t,n){const a=Kr.AY;e.write(a,7,56)}static mapPCE(e,t,n){const a=Kr.PCE;e.write(a,0,0),e.write(a,1,255)}static mapSNES(e,t,n){const a=Kr.SNES;e.write(a,93,2),e.write(a,12,127),e.write(a,28,127),e.write(a,108,0),e.write(a,76,0),e.write(a,92,0);for(let s=0;s<8;s++)e.write(a,16*s+4,s)}static mapOPLL(e,t,n){const a=Kr.OPLL,s=n.opllPreset??3;if(0===s&&n.operators.length>=2){const t=n.operators[0],s=n.operators[1],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(a,0,r);const o=(s.am?128:0)|(s.vib?64:0)|(s.sus?32:0)|(s.ksr?16:0)|15&s.mult;e.write(a,1,o);const i=Math.min(63,t.tl>>1);e.write(a,2,(3&t.ksl)<<6|63&i);const l=1&(s.ws??0),c=1&(t.ws??0);e.write(a,3,l<<4|c<<3|7&n.feedback),e.write(a,4,(15&t.ar)<<4|15&t.dr),e.write(a,5,(15&s.ar)<<4|15&s.dr),e.write(a,6,(15&t.sl)<<4|15&t.rr),e.write(a,7,(15&s.sl)<<4|15&s.rr)}e.write(a,48+t,(15&s)<<4),e.write(a,14,0)}static mapOPNA(e,t,n){const a=Kr.OPNA,s=t%3,r=0===(t<3?0:1)?0:256;e.write(a,34,8),e.write(a,41,159),e.write(a,257,63);const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapOPN(e,t,n){const a=Kr.OPN,s=t%3;e.write(a,34,8);const r=(7&n.feedback)<<3|7&n.algorithm;e.write(a,176+s,r);const o=(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,180+s,o);const i=[0,8,4,12];n.operators.forEach((t,n)=>{const r=i[n]+s,o=this.furnaceDtToOPN2(t.dt);e.write(a,48+r,(7&o)<<4|15&t.mult),e.write(a,64+r,127&t.tl),e.write(a,80+r,(3&t.rs)<<6|31&t.ar),e.write(a,96+r,(t.am?128:0)|31&t.dr),e.write(a,112+r,31&t.d2r),e.write(a,128+r,(15&t.sl)<<4|15&t.rr),e.write(a,144+r,15&t.ssg)})}static mapOPNB(e,t,n){const a=Kr.OPNB,s=t%3,r=0===(t<3?0:1)?0:256;e.write(a,34,0);const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapVRC6(e,t,n){const a=Kr.VRC6;e.write(a,36867,0)}static mapN163(e,t,n){const a=Kr.N163;e.write(a,127,0)}static mapSCC(e,t,n){const a=Kr.SCC;for(let s=0;s<5;s++)e.write(a,138+s,15);e.write(a,143,31)}static mapFDS(e,t,n){const a=Kr.FDS;e.write(a,16419,0),e.write(a,16419,131),e.write(a,16521,0)}static mapMMC5(e,t,n){const a=Kr.MMC5;e.write(a,20501,3),e.write(a,20496,0)}static mapTIA(e,t,n){const a=Kr.TIA;e.write(a,25,15),e.write(a,26,15)}static mapSAA(e,t,n){const a=Kr.SAA;e.write(a,28,2),e.write(a,28,1)}static mapSWAN(e,t,n){const a=Kr.SWAN;for(let s=0;s<4;s++)e.write(a,8+s,255);e.write(a,15,0),e.write(a,17,15)}static mapOKI(e,t,n){const a=Kr.OKI;e.write(a,12,0)}static mapES5506(e,t,n){}static mapOPZ(e,t,n){const a=Kr.OPZ,s=7&t;e.write(a,1,2),e.write(a,24,0),e.write(a,25,127),e.write(a,25,255);const r=192|(7&n.feedback)<<3|7&n.algorithm;e.write(a,32+s,r);const o=n.fms??0,i=n.ams??0;e.write(a,56+s,(7&o)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const r=l[n]+s,o=this.furnaceDtToOPN2(t.dt??0);e.write(a,64+r,(7&o)<<4|15&(t.mult??1)),e.write(a,96+r,127&(t.tl??0)),e.write(a,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(a,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(a,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(a,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapY8950(e,t,n){const a=Kr.Y8950;e.write(a,1,32),e.write(a,4,0),e.write(a,8,0);const s=t%9,r=(7&n.feedback)<<1|1&n.algorithm;e.write(a,192+s,r);const o=this.getOPL3Slots(s);n.operators.slice(0,2).forEach((t,n)=>{const s=o[n],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(a,32+s,r),e.write(a,64+s,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(a,96+s,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(a,128+s,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(a,224+s,3&(t.ws??0))})}static mapOPL4(e,t,n){const a=Kr.OPL4;e.write(a,261,3),e.write(a,514,16),e.write(a,1,32);const s=t<9?0:256,r=t%9,o=48|(7&n.feedback)<<1|1&n.algorithm;e.write(a,s|192+r,o);const i=this.getOPL3Slots(r);n.operators.slice(0,2).forEach((t,n)=>{const r=s|i[n],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(a,32+r,o),e.write(a,64+r,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(a,96+r,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(a,128+r,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(a,224+r,7&(t.ws??0))})}static mapSEGAPCM(e,t,n){const a=Kr.SEGAPCM;for(let s=0;s<16;s++){const t=s<<3;e.write(a,134+t,3),e.write(a,2+t,127),e.write(a,3+t,127)}}static mapYMZ280B(e,t,n){const a=Kr.YMZ280B;e.write(a,255,128);for(let s=0;s<8;s++)e.write(a,2+4*s,255),e.write(a,3+4*s,8)}static mapRF5C68(e,t,n){const a=Kr.RF5C68;e.write(a,8,255);for(let s=0;s<8;s++)e.write(a,0+s,0),e.write(a,1+s,0);e.write(a,8,0)}static mapGA20(e,t,n){const a=Kr.GA20;for(let s=0;s<4;s++)e.write(a,5+8*s,0),e.write(a,6+8*s,0)}static mapC140(e,t,n){const a=Kr.C140;for(let s=0;s<24;s++)e.write(a,5+(s<<4),0)}static mapQSOUND(e,t,n){const a=Kr.QSOUND;e.write(a,0,0)}static mapVIC(e,t,n){const a=Kr.VIC;e.write(a,14,15)}static mapTED(e,t,n){const a=Kr.TED;e.write(a,17,15)}static mapSUPERVISION(e,t,n){}static mapVERA(e,t,n){const a=Kr.VERA;for(let s=0;s<16;s++)e.write(a,129472+4*s+2,3)}static mapSM8521(e,t,n){const a=Kr.SM8521;e.write(a,64,128)}static mapBUBBLE(e,t,n){}static mapK007232(e,t,n){const a=Kr.K007232;e.write(a,12,255),e.write(a,13,0)}static mapK053260(e,t,n){const a=Kr.K053260;e.write(a,40,0),e.write(a,47,2)}static mapX1_010(e,t,n){const a=Kr.X1_010;for(let s=0;s<16;s++)e.write(a,8*s,0)}static mapUPD1771(e,t,n){}static mapT6W28(e,t,n){const a=Kr.T6W28;e.write(a,1,231)}static mapVB(e,t,n){const a=Kr.VB;for(let s=0;s<6;s++){const t=1024+64*s;e.write(a,t+4,255),e.write(a,t+16,240)}}static mapLYNX(e,t,n){const a=Kr.LYNX;e.write(a,80,0)}static mapNAMCO(e,t,n){}static mapPET(e,t,n){}static mapPOKEY(e,t,n){}static mapAMIGA(e,t,n){}static mapPCSPKR(e,t,n){}static getOPL3Slots(e){return[[0,1,2,8,9,10,16,17,18][e],[3,4,5,11,12,13,19,20,21][e]]}static furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}static uploadWavetable(e,t,n){switch(t){case Kr.GB:for(let s=0;s<16;s++){const t=15&(n[2*s]||0),a=15&(n[2*s+1]||0);e.write(Kr.GB,48+s,t<<4|a)}break;case Kr.SCC:for(let s=0;s<32;s++)e.write(Kr.SCC,s,255&n[s]);break;case Kr.N163:e.write(Kr.N163,57344,128);for(let s=0;s<Math.min(128,n.length);s++)e.write(Kr.N163,63488,255&n[s]);break;case Kr.PCE:for(let s=0;s<32;s++)e.write(Kr.PCE,6,31&n[s]);break;case Kr.SWAN:for(let s=0;s<16;s++){const t=15&(n[2*s]||0),a=15&(n[2*s+1]||0);e.write(Kr.SWAN,64+s,t<<4|a)}break;case Kr.BUBBLE:const t=new Uint8Array(n.slice(0,32));e.setWavetable(Kr.BUBBLE,0,t),e.setWavetable(Kr.BUBBLE,1,t);break;case Kr.X1_010:const a=n.some(e=>e<0);for(let s=0;s<16;s++){const t=4096|s<<7;for(let s=0;s<128;s++){const r=s*n.length/128,o=Math.floor(r),i=r-o,l=n[o]||0,c=l+((n[(o+1)%n.length]||0)-l)*i;let d;d=a?255&Math.round(4*c):17*c-128&255,e.write(Kr.X1_010,t+s,d)}}}}static loadWavetablePreset(e,t,n){let a;switch(t){case Kr.GB:a="gb";break;case Kr.PCE:a="pce";break;case Kr.N163:a="n163";break;case Kr.SCC:a="scc";break;case Kr.SWAN:a="swan";break;case Kr.VB:a="vb";break;case Kr.LYNX:a="lynx";break;default:return!1}const s=Yr(n,a);return!!s&&(this.uploadWavetable(e,t,s),!0)}static getRecommendedWavetables(e){switch(e){case Kr.GB:case Kr.N163:case Kr.SWAN:return["32x16saw","32x16FunkyLead","32x16NamcoBass","32x16brass","32x16clarinet","32x16flute","32x16guitar","32x16opllpiano","32x16synthbass","32x16trumpet","32x16voice"];case Kr.PCE:case Kr.VB:return["32x32piano","32x32brass","32x32flute","32x32lead","32x32organ","32x32strings","32x32synthbass","32x32trumpet","32x32voice","32x32bell","32x32choir","32x32vibraphone"];case Kr.SCC:return["32x32piano","32x32brass","32x32lead","32x32organ","32x32synthbass","32x32trumpet","32x32strings","32x32flute"];case Kr.LYNX:return["128x256bass","128x256chime","128x256lead","32x32piano","32x32brass","32x32lead","32x32synthbass"];default:return[]}}}class Qr{static CLOCK_OPN2=7670454;static CLOCK_OPN2_PAL=7600489;static CLOCK_OPN=4e6;static CLOCK_OPM=3579545;static FREQ_BASE_OPN2=9440540;static FREQ_BASE_OPN=4720270;static FREQ_BASE_OPM=3579545;static freqToOPN2(e){if(e<=0)return{block:0,fnum:0};const t=this.CLOCK_OPN2;let n=7,a=0;for(n=7;n>=0;n--){const s=Math.pow(2,n);if(a=Math.round(144*e*2097152/(t*s)),a<=2047&&a>=600)break;if(!(a<=2047&&a<600&&n>0)&&(0===n&&a<=2047))break}return a>2047&&(n=7,a=2047),n=Math.max(0,Math.min(7,n)),a=Math.max(0,Math.min(2047,a)),{block:n,fnum:a}}static freqToOPM(e){if(e<=0)return{kc:0,kf:0};const t=12*Math.log2(e/440)+69,n=Math.floor(t),a=t-n,s=Math.floor(n/12)-1,r=n%12;return{kc:Math.max(0,Math.min(7,s))<<4|[0,1,2,4,5,6,8,9,10,12,13,14][r],kf:63&Math.floor(64*a)}}static freqToGB(e){if(e<=0)return 0;const t=2048-131072/e;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNES(e){if(e<=0)return 0;const t=1789773/(16*e)-1;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNESNoise(e){const t=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];if(e<=0)return 15;const n=1789773/e;let a=0,s=Math.abs(t[0]-n);for(let r=1;r<16;r++){const e=Math.abs(t[r]-n);e<s&&(s=e,a=r)}return a}static freqToAY(e,t=1789773){if(e<=0)return 0;const n=Math.floor(t/(16*e));return Math.max(0,Math.min(4095,n))}static freqToPCE(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(4095,t))}static freqToSCC(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToSID(e,t=!0){if(e<=0)return 0;const n=t?985248:1022727,a=Math.floor(16777216*e/n);return Math.max(0,Math.min(65535,a))}static freqToPSG(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(1023,t))}static freqToSNES(e){if(e<=0)return 0;const t=Math.floor(4096*e/32e3);return Math.max(0,Math.min(16383,t))}static freqToFDS(e){if(e<=0)return 0;const t=Math.floor(65536*e/1789773);return Math.max(0,Math.min(4095,t))}static freqToVRC6(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToPOKEY(e){if(e<=0)return 0;const t=Math.floor(1789773/(2*e))-1;return Math.max(0,Math.min(255,t))}static freqToTIA(e){if(e<=0)return 0;const t=Math.floor(31440/(32*e))-1;return Math.max(0,Math.min(31,t))}static freqToVIC(e){if(e<=0)return 0;const t=Math.floor(256-1022727/(32*e));return Math.max(0,Math.min(127,t))}static freqToTED(e){if(e<=0)return 0;const t=Math.floor(1024-1773447/(8*e));return Math.max(0,Math.min(1023,t))}static freqToAmiga(e,t=!0){if(e<=0)return 65535;const n=t?3546895:3579545,a=Math.floor(n/(2*e));return Math.max(124,Math.min(65535,a))}}let Zr=0;const Jr=a((e,t)=>({errors:[],activeError:null,reportError:t=>{const n="synth-error-"+ ++Zr,a={timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",audioContextState:"undefined"!=typeof AudioContext?(new AudioContext).state:"AudioContext not available",wasmSupported:"undefined"!=typeof WebAssembly,...t.debugData},s={id:n,synthType:t.synthType,synthName:t.synthName,errorType:t.errorType,message:t.message,stack:t.stack,debugData:a,dismissed:!1};return e(e=>({errors:[...e.errors,s],activeError:s})),n},dismissError:t=>{e(e=>({errors:e.errors.map(e=>e.id===t?{...e,dismissed:!0}:e),activeError:e.activeError?.id===t?null:e.activeError}))},dismissAll:()=>{e(e=>({errors:e.errors.map(e=>({...e,dismissed:!0})),activeError:null}))},clearDismissed:()=>{e(e=>({errors:e.errors.filter(e=>!e.dismissed)}))},getDebugString:e=>{const t=["=== DEViLBOX Synth Error Report ===","",`Synth Type: ${e.synthType}`,e.synthName?`Synth Name: ${e.synthName}`:null,`Error Type: ${e.errorType}`,`Message: ${e.message}`,"","--- Debug Data ---",`Timestamp: ${e.debugData.timestamp}`,`User Agent: ${e.debugData.userAgent}`,`AudioContext State: ${e.debugData.audioContextState}`,`WASM Supported: ${e.debugData.wasmSupported}`,""].filter(Boolean),n=Object.keys(e.debugData).filter(e=>!["timestamp","userAgent","audioContextState","wasmSupported","synthConfig"].includes(e));if(n.length>0){t.push("--- Additional Info ---");for(const a of n)t.push(`${a}: ${JSON.stringify(e.debugData[a])}`);t.push("")}return e.debugData.synthConfig&&(t.push("--- Synth Config ---"),t.push(JSON.stringify(e.debugData.synthConfig,null,2)),t.push("")),e.stack&&(t.push("--- Stack Trace ---"),t.push(e.stack)),t.join("\n")},copyToClipboard:async e=>{const n=t().getDebugString(e);try{return await navigator.clipboard.writeText(n),!0}catch(a){return!1}}})),eo=(e,t,n)=>Jr.getState().reportError({synthType:e,message:t,synthName:n?.synthName,errorType:n?.errorType??"init",stack:n?.error?.stack,debugData:n?.debugData});class to extends u{name="FurnaceSynth";input;output;chipEngine=Wr.getInstance();outputGain;config;channelIndex=0;macroPositions=new Map;opMacroPositions=Array.from({length:4},()=>({}));activeNoteFreq=440;isNoteOn=!1;currentDuty=2;currentPan=0;velocity=1;baseTLValues=[];_oplBlock=0;_oplFnum=0;useWasmEngine=!1;errorReported=!1;gbFreqHigh=0;gbFreqVal=0;nesNoiseIndex=0;initInProgress=!1;wasmNoteTriggered=!1;noteOnTime=0;static MIN_GATE_TIME=.05;_volumeOffsetDb=0;constructor(e=xa,t=0){super(),this.config={...e,operators:e.operators?.map(e=>({...e}))||[]},this.channelIndex=t,this.outputGain=new p(1),this.output=this.outputGain,this.chipEngine=Wr.getInstance(),this.initEngine()}getChipType(){return this.config.chipType}setVolumeOffset(e){this._volumeOffsetDb=e,this.useWasmEngine&&this.chipEngine.setOutputGain(Math.pow(10,e/20))}async ensureInitialized(){if(!this.useWasmEngine){if(this.initInProgress){for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);if(this.useWasmEngine)return}await this.initEngine(),!this.useWasmEngine&&this.chipEngine.isInitialized()&&(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters())}}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=D();if(!e)return this.reportInitError("audio","No Tone.js AudioContext available. Audio may not be initialized."),void(this.initInProgress=!1);if("running"!==(e.state||e._context?.state)){if(!(await Promise.race([new Promise(t=>{const n=()=>{"running"===(e.state||e._context?.state)?t(!0):setTimeout(n,100)};n()}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return this.reportInitError("audio","AudioContext failed to start. Click anywhere to enable audio, then try again."),void(this.initInProgress=!1)}await this.chipEngine.init(e),this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters(),this.isNoteOn&&this.activeNoteFreq>0&&(this.updateFrequency(this.activeNoteFreq),this.writeKeyOn(this.velocity),this.wasmNoteTriggered=!0)):this.reportInitError("wasm","WASM chip engine failed to initialize. This synth requires WebAssembly support.")}catch(e){const t=e instanceof Error?e:new Error(String(e));this.reportInitError("wasm",t.message,t)}finally{this.initInProgress=!1}}}reportInitError(e,t,n){this.errorReported||(this.errorReported=!0,eo(`Furnace/${this.config.chipType||"Unknown"}`,t,{errorType:e,error:n,debugData:{chipType:this.config.chipType,channelIndex:this.channelIndex,synthConfig:this.config}}))}processTick(e=x()){this.isNoteOn&&(this.config.macros.forEach(t=>{if(!t.data||0===t.data.length)return;let n=this.macroPositions.get(t.type)||0;n>=t.data.length&&(n=t.data.length-1);const a=t.data[n];switch(t.type){case 0:const t=Math.max(0,a/127*this.velocity);this.outputGain.gain.setValueAtTime(t,e);break;case 1:this.updateFrequency(this.activeNoteFreq*Math.pow(2,a/12));break;case 2:this.currentDuty=a,this.writeDutyRegister(a);break;case 3:this.writeWavetableSelect(a);break;case 4:const n=a>127?a-256:a;this.updateFrequency(this.activeNoteFreq*Math.pow(2,n/1200));break;case 5:this.currentPan=a>127?a-256:a,this.writePanRegister(this.currentPan);break;case 6:0!==a&&this.writePhaseReset()}n++,n>=t.data.length&&(n=t.loop>=0?t.loop:t.data.length-1),this.macroPositions.set(t.type,n)}),this.config.opMacros.forEach((e,t)=>{if(!e)return;const n=this.config.operators[t];if(n){if(e.tl&&e.tl.data.length>0){const a=this.advanceOpMacro(e.tl,t,"tl");n.tl=a,this.writeOperatorTL(t,a)}if(e.mult&&e.mult.data.length>0){const a=this.advanceOpMacro(e.mult,t,"mult");n.mult=a,this.writeOperatorMult(t,a)}if(e.ar&&e.ar.data.length>0){const a=this.advanceOpMacro(e.ar,t,"ar");n.ar=a,this.writeOperatorAR(t,a)}if(e.dr&&e.dr.data.length>0){const a=this.advanceOpMacro(e.dr,t,"dr");n.dr=a,this.writeOperatorDR(t,a)}if(e.sl&&e.sl.data.length>0){const a=this.advanceOpMacro(e.sl,t,"sl");n.sl=a,this.writeOperatorSL(t,a)}if(e.rr&&e.rr.data.length>0){const a=this.advanceOpMacro(e.rr,t,"rr");n.rr=a,this.writeOperatorRR(t,a)}}}))}advanceOpMacro(e,t,n){let a=this.opMacroPositions[t][n]||0;a>=e.data.length&&(a=e.data.length-1);const s=e.data[a];return a++,a>=e.data.length&&(a=e.loop>=0?e.loop:e.data.length-1),this.opMacroPositions[t][n]=a,s}writeDutyRegister(e){const t=this.channelIndex;if(this.config.chipType===Kr.NES){if(t<2){const n=16384+4*t,a=48|15&(this.config.operators[0]?.tl||15);this.chipEngine.write(Kr.NES,n,(3&e)<<6|a)}}else if(this.config.chipType===Kr.GB){if(t<2){const n=0===t?17:22;this.chipEngine.write(Kr.GB,n,(3&e)<<6)}}else this.config.chipType,Kr.PSG}writeWavetableSelect(e){if(this.config.wavetables&&this.config.wavetables[e]){const t=this.config.wavetables[e].data;Xr.uploadWavetable(this.chipEngine,this.config.chipType,t)}}writePanRegister(e){const t=this.channelIndex;if(this.config.chipType===Kr.OPN2){const n=t%3,a=0===(t<3?0:1)?0:256;let s=192;e<-32?s=128:e>32&&(s=64),this.chipEngine.write(Kr.OPN2,a|180+n,s)}else if(this.config.chipType===Kr.OPM){let n=192;e<-32?n=128:e>32&&(n=64);const a=(7&this.config.feedback)<<3|7&this.config.algorithm;this.chipEngine.write(Kr.OPM,32+(7&t),n|a)}else this.config.chipType===Kr.GB&&this.chipEngine.write(Kr.GB,37,255)}writePhaseReset(){if(this.config.chipType===Kr.OPN2){const e=this.channelIndex%3,t=this.channelIndex<3?0:1;this.chipEngine.write(Kr.OPN2,40,t<<2|e),this.chipEngine.write(Kr.OPN2,40,240|t<<2|e)}}writeOperatorTL(e,t){const n=this.channelIndex;if(this.config.chipType===Kr.OPN2){const a=0===(n<3?0:1)?0:256,s=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,a|64+s,127&t)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const a=[0,16,8,24][e]+(7&n),s=this.config.chipType;this.chipEngine.write(s,96+a,127&t)}}writeOperatorMult(e,t){const n=this.channelIndex,a=this.config.operators[e];if(!a)return;const s=this.furnaceDtToOPN2(a.dt);if(this.config.chipType===Kr.OPN2){const a=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,a|48+r,(7&s)<<4|15&t)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const a=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,64+a,(7&s)<<4|15&t)}}writeOperatorAR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Kr.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,s|80+r,(3&a.rs)<<6|31&t)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,128+s,(3&a.rs)<<6|31&t)}}writeOperatorDR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Kr.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,s|96+r,(a.am?128:0)|31&t)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,160+s,(a.am?128:0)|31&t)}}writeOperatorSL(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Kr.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,s|128+r,(15&t)<<4|15&a.rr)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&t)<<4|15&a.rr)}}writeOperatorRR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Kr.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Kr.OPN2,s|128+r,(15&a.sl)<<4|15&t)}else if(this.config.chipType===Kr.OPM||this.config.chipType===Kr.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&a.sl)<<4|15&t)}}furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}updateFrequency(e){const t=this.channelIndex%3,n=0===(this.channelIndex<3?0:1)?0:256;if(this.config.chipType===Kr.OPN2){const{block:a,fnum:s}=Qr.freqToOPN2(e);this.chipEngine.write(Kr.OPN2,n|160+t,255&s),this.chipEngine.write(Kr.OPN2,n|164+t,(7&a)<<3|s>>8&7)}else if(this.config.chipType===Kr.OPN){const{block:t,fnum:n}=Qr.freqToOPN2(e),a=this.channelIndex%3;this.chipEngine.write(Kr.OPN,160+a,255&n),this.chipEngine.write(Kr.OPN,164+a,(7&t)<<3|n>>8&7)}else if(this.config.chipType===Kr.OPM){const{kc:t,kf:n}=Qr.freqToOPM(e);this.chipEngine.write(Kr.OPM,40+(7&this.channelIndex),t),this.chipEngine.write(Kr.OPM,48+(7&this.channelIndex),n<<2)}else if(this.config.chipType===Kr.OPZ){const t=[0,1,2,4,5,6,8,9,10,12,13,14],n=Math.round(12*Math.log2(e/440)+69),a=Math.max(0,Math.min(127,n)),s=(7&Math.floor(a/12))<<4|t[a%12],r=12*Math.log2(e/440)+69-a,o=63&Math.floor(64*r);this.chipEngine.write(Kr.OPZ,40+(7&this.channelIndex),s),this.chipEngine.write(Kr.OPZ,48+(7&this.channelIndex),o<<2)}else if(this.config.chipType===Kr.OPL3||this.config.chipType===Kr.Y8950||this.config.chipType===Kr.OPL4||this.config.chipType===Kr.ESFM){const t=this.channelIndex%9,n=this.channelIndex<9?0:256;let a=4,s=Math.floor(e*(1<<19)/2e5);for(;s>1023&&a<7;)s>>=1,a++;for(;s<256&&a>0;)s<<=1,a--;s&=1023,this._oplBlock=a,this._oplFnum=s,this.chipEngine.write(this.config.chipType,n|160+t,255&s),this.chipEngine.write(this.config.chipType,n|176+t,(7&a)<<2|s>>8&3)}else if(this.config.chipType===Kr.OPLL){const t=this.channelIndex%9;let n=4,a=Math.floor(e*(1<<18)/2e5);for(;a>511&&n<7;)a>>=1,n++;for(;a<128&&n>0;)a<<=1,n--;a&=511,this._oplBlock=n,this._oplFnum=a,this.chipEngine.write(Kr.OPLL,16+t,255&a)}else if(this.config.chipType===Kr.OPNA||this.config.chipType===Kr.OPNB||this.config.chipType===Kr.OPNB_B){const{block:t,fnum:n}=Qr.freqToOPN2(e),a=this.channelIndex%3,s=0===(this.channelIndex<3?0:1)?0:256;this.chipEngine.write(this.config.chipType,s|160+a,255&n),this.chipEngine.write(this.config.chipType,s|164+a,(7&t)<<3|n>>8&7)}else if(this.config.chipType===Kr.AY||this.config.chipType===Kr.AY8930){const t=1789773,n=4095&Math.floor(t/(16*e)),a=this.channelIndex%3;this.chipEngine.write(this.config.chipType,2*a,255&n),this.chipEngine.write(this.config.chipType,2*a+1,n>>8&15)}else if(this.config.chipType===Kr.SID||this.config.chipType===Kr.SID_6581||this.config.chipType===Kr.SID_8580){const t=985248,n=65535&Math.floor(16777216*e/t),a=this.channelIndex%3*7;this.chipEngine.write(this.config.chipType,a+0,255&n),this.chipEngine.write(this.config.chipType,a+1,n>>8&255)}else if(this.config.chipType===Kr.PSG){const t=1023&Math.floor(3579545/(32*e)),n=3&this.channelIndex;this.chipEngine.write(Kr.PSG,0,128|n<<5|15&t),this.chipEngine.write(Kr.PSG,0,t>>4&63)}else if(this.config.chipType===Kr.NES){const t=this.channelIndex;if(t<2){const n=Qr.freqToNES(e),a=16384+4*t;this.chipEngine.write(Kr.NES,a+2,255&n),this.chipEngine.write(Kr.NES,a+3,n>>8&7)}else if(2===t){const t=Qr.freqToNES(e);this.chipEngine.write(Kr.NES,16394,255&t),this.chipEngine.write(Kr.NES,16395,t>>8&7)}else if(3===t){const t=Qr.freqToNESNoise(e);this.nesNoiseIndex=t,this.chipEngine.write(Kr.NES,16398,15&t)}}else if(this.config.chipType===Kr.GB){const t=Qr.freqToGB(e);this.gbFreqVal=t}else if(this.config.chipType===Kr.PCE){const t=this.channelIndex,n=4095&Math.floor(3579545/(32*e));this.chipEngine.write(Kr.PCE,0,7&t),this.chipEngine.write(Kr.PCE,2,255&n),this.chipEngine.write(Kr.PCE,3,n>>8&15)}else if(this.config.chipType===Kr.SNES){const t=16*(7&this.channelIndex),n=16383&Math.floor(4096*e/32e3);this.chipEngine.write(Kr.SNES,t+2,255&n),this.chipEngine.write(Kr.SNES,t+3,n>>8&63)}}updateParameters(){switch(this.config.chipType){case 0:Xr.mapOPN2(this.chipEngine,this.channelIndex,this.config);break;case 1:Xr.mapOPM(this.chipEngine,this.channelIndex,this.config);break;case 2:Xr.mapOPL3(this.chipEngine,this.channelIndex,this.config);break;case 11:Xr.mapOPLL(this.chipEngine,this.channelIndex,this.config);break;case 13:Xr.mapOPNA(this.chipEngine,this.channelIndex,this.config);break;case 14:case 48:Xr.mapOPNB(this.chipEngine,this.channelIndex,this.config);break;case 22:Xr.mapOPZ(this.chipEngine,this.channelIndex,this.config);break;case 23:Xr.mapY8950(this.chipEngine,this.channelIndex,this.config);break;case 26:Xr.mapOPL4(this.chipEngine,this.channelIndex,this.config);break;case 47:Xr.mapOPN(this.chipEngine,this.channelIndex,this.config);break;case 49:Xr.mapOPL3(this.chipEngine,this.channelIndex,this.config,Kr.ESFM);break;case 3:Xr.mapPSG(this.chipEngine,this.channelIndex,this.config);break;case 12:Xr.mapAY(this.chipEngine,this.channelIndex,this.config);break;case 18:Xr.mapSAA(this.chipEngine,this.channelIndex,this.config);break;case 43:Xr.mapT6W28(this.chipEngine,this.channelIndex,this.config);break;case 4:Xr.mapNES(this.chipEngine,this.channelIndex,this.config);break;case 5:Xr.mapGB(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.GB,this.config.wavetables[0].data);break;case 6:Xr.mapPCE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.PCE,this.config.wavetables[0].data);break;case 24:Xr.mapSNES(this.chipEngine,this.channelIndex,this.config);break;case 44:Xr.mapVB(this.chipEngine,this.channelIndex,this.config);break;case 16:Xr.mapFDS(this.chipEngine,this.channelIndex,this.config);break;case 17:Xr.mapMMC5(this.chipEngine,this.channelIndex,this.config);break;case 8:Xr.mapN163(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.N163,this.config.wavetables[0].data);break;case 9:Xr.mapVRC6(this.chipEngine,this.channelIndex,this.config);break;case 7:Xr.mapSCC(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.SCC,this.config.wavetables[0].data);break;case 19:Xr.mapSWAN(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.SWAN,this.config.wavetables[0].data);break;case 36:Xr.mapVERA(this.chipEngine,this.channelIndex,this.config);break;case 37:Xr.mapSM8521(this.chipEngine,this.channelIndex,this.config);break;case 38:Xr.mapBUBBLE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.BUBBLE,this.config.wavetables[0].data);break;case 10:case 45:case 46:Xr.mapC64(this.chipEngine,this.channelIndex,this.config);break;case 20:Xr.mapOKI(this.chipEngine,this.channelIndex,this.config);break;case 21:Xr.mapES5506(this.chipEngine,this.channelIndex,this.config);break;case 27:Xr.mapSEGAPCM(this.chipEngine,this.channelIndex,this.config);break;case 28:Xr.mapYMZ280B(this.chipEngine,this.channelIndex,this.config);break;case 29:Xr.mapRF5C68(this.chipEngine,this.channelIndex,this.config);break;case 30:Xr.mapGA20(this.chipEngine,this.channelIndex,this.config);break;case 31:Xr.mapC140(this.chipEngine,this.channelIndex,this.config);break;case 32:Xr.mapQSOUND(this.chipEngine,this.channelIndex,this.config);break;case 39:Xr.mapK007232(this.chipEngine,this.channelIndex,this.config);break;case 40:Xr.mapK053260(this.chipEngine,this.channelIndex,this.config);break;case 41:Xr.mapX1_010(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Xr.uploadWavetable(this.chipEngine,Kr.X1_010,this.config.wavetables[0].data);break;case 15:Xr.mapTIA(this.chipEngine,this.channelIndex,this.config);break;case 33:Xr.mapVIC(this.chipEngine,this.channelIndex,this.config);break;case 34:Xr.mapTED(this.chipEngine,this.channelIndex,this.config);break;case 35:Xr.mapSUPERVISION(this.chipEngine,this.channelIndex,this.config);break;case 42:Xr.mapUPD1771(this.chipEngine,this.channelIndex,this.config);break;case 25:Xr.mapLYNX(this.chipEngine,this.channelIndex,this.config);break;case 55:Xr.mapNAMCO(this.chipEngine,this.channelIndex,this.config);break;case 56:Xr.mapPET(this.chipEngine,this.channelIndex,this.config);break;case 57:Xr.mapPOKEY(this.chipEngine,this.channelIndex,this.config);break;case 61:Xr.mapAMIGA(this.chipEngine,this.channelIndex,this.config);break;case 62:Xr.mapPCSPKR(this.chipEngine,this.channelIndex,this.config)}}triggerAttack(e,t,n){const a=b(e).toFrequency();this.activeNoteFreq=a,this.isNoteOn=!0,this.velocity=void 0!==n?n:1;const s=t||x();return this.noteOnTime=x(),this.useWasmEngine||(this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters()):this.initInProgress||this.initEngine()),this.useWasmEngine?(this.macroPositions.clear(),this.opMacroPositions=Array.from({length:4},()=>({})),this.currentDuty=2,this.currentPan=0,this.baseTLValues=this.config.operators.map(e=>e.tl),this.applyVelocityToCarriers(),this.updateParameters(),this.updateFrequency(a),this.writeKeyOn(n),this.wasmNoteTriggered=!0,this.processTick(s),this):this}applyVelocityToCarriers(){if(this.config.chipType!==Kr.OPN2&&this.config.chipType!==Kr.OPM)return;const e=[[3],[3],[3],[3],[2,3],[2,3],[1,2,3],[0,1,2,3]][7&this.config.algorithm]||[3],t=Math.floor(32*(1-this.velocity));for(const n of e)if(this.config.operators[n]){const e=this.baseTLValues[n];this.config.operators[n].tl=Math.min(127,e+t)}}writeKeyOn(e){const t=this.channelIndex,n=void 0!==e?Math.floor(15*e):15;switch(this.config.chipType){case Kr.OPN2:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(Kr.OPN2,40,e),this.chipEngine.write(Kr.OPN2,40,n);break}case Kr.OPM:this.chipEngine.write(Kr.OPM,8,7&t),this.chipEngine.write(Kr.OPM,8,120|7&t);break;case Kr.NES:if(this.chipEngine.write(Kr.NES,16405,31),t<2){const e=16384+4*t,a=Qr.freqToNES(this.activeNoteFreq);this.chipEngine.write(Kr.NES,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(Kr.NES,e+1,8),this.chipEngine.write(Kr.NES,e+2,255&a),this.chipEngine.write(Kr.NES,e+3,8|a>>8&7)}else if(2===t){const e=Qr.freqToNES(this.activeNoteFreq);this.chipEngine.write(Kr.NES,16392,255),this.chipEngine.write(Kr.NES,16394,255&e),this.chipEngine.write(Kr.NES,16395,8|e>>8&7)}else 3===t&&(this.chipEngine.write(Kr.NES,16396,48|n),this.chipEngine.write(Kr.NES,16398,15&this.nesNoiseIndex),this.chipEngine.write(Kr.NES,16399,8));break;case Kr.GB:{const e=this.gbFreqVal||0;if(t<2){const a=0===t?16:21;this.chipEngine.write(Kr.GB,a+1,(3&this.currentDuty)<<6|63),this.chipEngine.write(Kr.GB,a+2,n<<4|8),this.chipEngine.write(Kr.GB,a+3,2048-e&255),this.chipEngine.write(Kr.GB,a+4,2048-e>>8&7|128)}else 2===t?(this.chipEngine.write(Kr.GB,26,128),this.chipEngine.write(Kr.GB,27,255),this.chipEngine.write(Kr.GB,28,32),this.chipEngine.write(Kr.GB,29,2048-e&255),this.chipEngine.write(Kr.GB,30,2048-e>>8&7|128)):3===t&&(this.chipEngine.write(Kr.GB,32,63),this.chipEngine.write(Kr.GB,33,n<<4|8),this.chipEngine.write(Kr.GB,34,0),this.chipEngine.write(Kr.GB,35,128));this.chipEngine.write(Kr.GB,38,128);break}case Kr.PSG:const e=15-Math.min(15,n);this.chipEngine.write(Kr.PSG,0,144|(3&t)<<5|e);break;case Kr.PCE:{const e=4095&Math.floor(3579545/(32*this.activeNoteFreq));this.chipEngine.write(Kr.PCE,0,7&t),this.chipEngine.write(Kr.PCE,4,95),this.chipEngine.write(Kr.PCE,4,31);for(let t=0;t<32;t++){const e=t<16?31:0;this.chipEngine.write(Kr.PCE,6,e)}this.chipEngine.write(Kr.PCE,2,255&e),this.chipEngine.write(Kr.PCE,3,e>>8&15),this.chipEngine.write(Kr.PCE,5,255),this.chipEngine.write(Kr.PCE,4,128|31&n);break}case Kr.SNES:{const e=16*(7&t),a=1<<(7&t);this.chipEngine.write(Kr.SNES,92,a);const s=16383&Math.floor(4096*this.activeNoteFreq/32e3);this.chipEngine.write(Kr.SNES,e+2,255&s),this.chipEngine.write(Kr.SNES,e+3,s>>8&63),this.chipEngine.write(Kr.SNES,e+5,255),this.chipEngine.write(Kr.SNES,e+6,224),this.chipEngine.write(Kr.SNES,e+0,8*n),this.chipEngine.write(Kr.SNES,e+1,8*n),this.chipEngine.write(Kr.SNES,92,0),this.chipEngine.write(Kr.SNES,76,a);break}case Kr.OPL3:{const e=t%9,n=t<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(Kr.OPL3,n|176+e,a),this.chipEngine.write(Kr.OPL3,n|176+e,s);break}case Kr.OPLL:{const e=t%9,n=(7&this._oplBlock)<<1|this._oplFnum>>8&1,a=16|n;this.chipEngine.write(Kr.OPLL,32+e,n),this.chipEngine.write(Kr.OPLL,32+e,a);break}case Kr.OPNA:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(Kr.OPNA,40,e),this.chipEngine.write(Kr.OPNA,40,n);break}case Kr.OPNB:{const e=[1,2,5,6][3&t];this.chipEngine.write(Kr.OPNB,40,e),this.chipEngine.write(Kr.OPNB,40,240|e);break}case Kr.OPN:{const e=t%3;this.chipEngine.write(Kr.OPN,40,e),this.chipEngine.write(Kr.OPN,40,240|e);break}case Kr.OPZ:{const e=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7,n=64|e;this.chipEngine.write(Kr.OPZ,32+(7&t),e),this.chipEngine.write(Kr.OPZ,32+(7&t),n);break}case Kr.Y8950:case Kr.OPL4:{const e=this.config.chipType,n=t%9,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(e,176+n,a),this.chipEngine.write(e,176+n,s);break}case Kr.AY:{const e=4095&Math.floor(1789773/(16*this.activeNoteFreq));this.chipEngine.write(Kr.AY,2*t,255&e),this.chipEngine.write(Kr.AY,2*t+1,e>>8&15),this.chipEngine.write(Kr.AY,8+t,15&n);const a=63&~(1<<t);this.chipEngine.write(Kr.AY,7,a);break}case Kr.SAA:{const e=8e6;let a=4,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));for(;s<0&&a<7;)a++,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));for(;s>255&&a>0;)a--,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));s=Math.max(0,Math.min(255,s)),this.chipEngine.write(Kr.SAA,0+t,n<<4|n),this.chipEngine.write(Kr.SAA,8+t,s);const r=16+Math.floor(t/2),o=t%2*4;this.chipEngine.write(Kr.SAA,r,a<<o|a<<4*(1-t%2)),this.chipEngine.write(Kr.SAA,20,1<<t);break}case Kr.T6W28:{const e=3072e3,a=3===t?15:16,s=Math.floor(e/(a*this.activeNoteFreq))-1,r=Math.max(0,Math.min(1023,s)),o=15-Math.min(15,n);this.chipEngine.write(Kr.T6W28,0,128|(3&t)<<5|15&r),this.chipEngine.write(Kr.T6W28,0,r>>4&63),this.chipEngine.write(Kr.T6W28,1,128|(3&t)<<5|15&r),this.chipEngine.write(Kr.T6W28,1,r>>4&63),this.chipEngine.write(Kr.T6W28,0,144|(3&t)<<5|o),this.chipEngine.write(Kr.T6W28,1,144|(3&t)<<5|o);break}case Kr.VRC6:if(t<2){const e=0===t?36864:40960,a=Math.floor(3579545/(16*this.activeNoteFreq))-1;this.chipEngine.write(Kr.VRC6,e,(7&this.currentDuty)<<4|n),this.chipEngine.write(Kr.VRC6,e+1,255&a),this.chipEngine.write(Kr.VRC6,e+2,128|a>>8&15)}else{const e=Math.floor(3579545/(14*this.activeNoteFreq))-1;this.chipEngine.write(Kr.VRC6,45056,63&n),this.chipEngine.write(Kr.VRC6,45057,255&e),this.chipEngine.write(Kr.VRC6,45058,128|e>>8&15)}break;case Kr.N163:{const e=Math.floor(7864320*this.activeNoteFreq/3579545);this.chipEngine.write(Kr.N163,120,255&e),this.chipEngine.write(Kr.N163,122,e>>8&255),this.chipEngine.write(Kr.N163,124,224|e>>16&3),this.chipEngine.write(Kr.N163,127,240|n);break}case Kr.FDS:{const e=4095&Math.floor(65536*this.activeNoteFreq/1789773);this.chipEngine.write(Kr.FDS,16512,128|2*n),this.chipEngine.write(Kr.FDS,16514,255&e),this.chipEngine.write(Kr.FDS,16515,e>>8&15);break}case Kr.MMC5:{const e=0===t?20480:20484,a=Qr.freqToNES(this.activeNoteFreq);this.chipEngine.write(Kr.MMC5,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(Kr.MMC5,e+2,255&a),this.chipEngine.write(Kr.MMC5,e+3,8|a>>8&7);break}case Kr.SCC:{const e=Math.floor(3579545/(16*this.activeNoteFreq))-1,a=128;this.chipEngine.write(Kr.SCC,a+2*t,255&e),this.chipEngine.write(Kr.SCC,a+2*t+1,e>>8&15),this.chipEngine.write(Kr.SCC,a+10+t,15&n),this.chipEngine.write(Kr.SCC,a+15,1<<t);break}case Kr.SWAN:{const e=3072e3,a=2047&Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Kr.SWAN,2*t,255&a),this.chipEngine.write(Kr.SWAN,2*t+1,a>>8&7),this.chipEngine.write(Kr.SWAN,8+t,n<<4|n),this.chipEngine.write(Kr.SWAN,16,1<<t),this.chipEngine.write(Kr.SWAN,17,15);break}case Kr.VERA:{const e=25e6,a=65535&Math.floor(2097152*this.activeNoteFreq/e),s=4*t;this.chipEngine.write(Kr.VERA,s+0,255&a),this.chipEngine.write(Kr.VERA,s+1,a>>8&255),this.chipEngine.write(Kr.VERA,s+2,(63&n)<<2|3),this.chipEngine.write(Kr.VERA,s+3,63);break}case Kr.SM8521:{const e=756e3,a=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a)),r=[[71,70],[73,72],[77,76]],o=[66,68,74];this.chipEngine.write(Kr.SM8521,o[t]||66,31&n),r[t]&&(this.chipEngine.write(Kr.SM8521,r[t][0],s>>8&15),this.chipEngine.write(Kr.SM8521,r[t][1],255&s)),this.chipEngine.write(Kr.SM8521,64,128|1<<t);break}case Kr.BUBBLE:{const e=3579545,a=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a));this.chipEngine.write(Kr.BUBBLE,1&t,255&s),this.chipEngine.write(Kr.BUBBLE,2+(1&t),15&n);break}case Kr.X1_010:{const e=4194304,a=65535&Math.floor(this.activeNoteFreq*e/1e6),s=t<<3;this.chipEngine.write(Kr.X1_010,s+2,255&a),this.chipEngine.write(Kr.X1_010,s+3,a>>8&255),this.chipEngine.write(Kr.X1_010,s+1,n<<4),this.chipEngine.write(Kr.X1_010,s,3);break}case Kr.VB:{const e=5e6,a=Math.floor(2048-e/(16*this.activeNoteFreq)),s=Math.max(0,Math.min(2047,a)),r=1024+64*t;this.chipEngine.write(Kr.VB,r+8,2047-s&255),this.chipEngine.write(Kr.VB,r+12,2047-s>>8&7),this.chipEngine.write(Kr.VB,r+4,255),this.chipEngine.write(Kr.VB,r+16,(15&n)<<4),this.chipEngine.write(Kr.VB,r+20,0),this.chipEngine.write(Kr.VB,r+0,128);break}case Kr.LYNX:{const e=16e6,a=Math.floor(e/(256*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,a)),r=32+8*t;this.chipEngine.write(Kr.LYNX,r+0,n<<4|n),this.chipEngine.write(Kr.LYNX,r+1,1),this.chipEngine.write(Kr.LYNX,r+4,s),this.chipEngine.write(Kr.LYNX,r+5,128),this.chipEngine.write(Kr.LYNX,80,255);break}case Kr.SID:{const e=t*64;this.chipEngine.write(Kr.SID,e+0,1);break}case Kr.SID_6581:case Kr.SID_8580:{const e=7*t,n=45===this.config.chipType?Kr.SID_6581:Kr.SID_8580,a=0,s=8,r=15,o=8,i=64,l=1,c=2048;this.chipEngine.write(n,e+2,255&c),this.chipEngine.write(n,e+3,c>>8&15),this.chipEngine.write(n,e+5,a<<4|s),this.chipEngine.write(n,e+6,r<<4|o),this.chipEngine.write(n,e+4,i|l);break}case Kr.TIA:{const e=31440,a=Math.floor(e/(32*this.activeNoteFreq))-1,s=Math.max(0,Math.min(31,a)),r=0===t?21:22;this.chipEngine.write(Kr.TIA,r,4),this.chipEngine.write(Kr.TIA,r+2,31&s),this.chipEngine.write(Kr.TIA,r+4,15&n);break}case Kr.VIC:{const e=1022727;let a=Math.floor(256-e/(32*this.activeNoteFreq));a>>=t<3?2-t:1;const s=Math.max(0,Math.min(127,a));this.chipEngine.write(Kr.VIC,10+t,255-s),this.chipEngine.write(Kr.VIC,14,15&n);break}case Kr.TED:{const e=1773447,a=Math.floor(1024-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(1023,a));0===t?(this.chipEngine.write(Kr.TED,14,1022-s&255),this.chipEngine.write(Kr.TED,18,1022-s>>8&3)):(this.chipEngine.write(Kr.TED,15,1022-s&255),this.chipEngine.write(Kr.TED,16,1022-s>>8&3));const r=15&n|(0===t?16:32);this.chipEngine.write(Kr.TED,17,r);break}case Kr.SUPERVISION:{const e=4e6;if(t<2){const n=Math.floor(2*e/(32*this.activeNoteFreq)),a=Math.max(1,Math.min(2047,n)),s=16+4*t;this.chipEngine.write(Kr.SUPERVISION,s,255&a),this.chipEngine.write(Kr.SUPERVISION,s+1,a>>8&7);const r=30|(3&this.currentDuty)<<4;this.chipEngine.write(Kr.SUPERVISION,s+2,r),this.chipEngine.write(Kr.SUPERVISION,s+3,255)}else if(3===t){const e=15-(15&Math.floor(12*Math.log2(this.activeNoteFreq/440)+69))<<4|15&n;this.chipEngine.write(Kr.SUPERVISION,40,e),this.chipEngine.write(Kr.SUPERVISION,41,200),this.chipEngine.write(Kr.SUPERVISION,42,30)}break}case Kr.UPD1771:this.chipEngine.write(Kr.UPD1771,0,2);break;case Kr.OKI:this.chipEngine.write(Kr.OKI,t,128|n<<3);break;case Kr.SEGAPCM:{const e=8*t;this.chipEngine.write(Kr.SEGAPCM,e+134,255),this.chipEngine.write(Kr.SEGAPCM,e+2,n<<3),this.chipEngine.write(Kr.SEGAPCM,e+3,n<<3);break}case Kr.YMZ280B:{const e=4*t;this.chipEngine.write(Kr.YMZ280B,1+e,192|n<<1);break}case Kr.RF5C68:this.chipEngine.write(Kr.RF5C68,7,t),this.chipEngine.write(Kr.RF5C68,8,255&~(1<<t));break;case Kr.GA20:this.chipEngine.write(Kr.GA20,0+8*t+5,0);break;case Kr.C140:{const e=16*t;this.chipEngine.write(Kr.C140,e+5,96);break}case Kr.QSOUND:this.chipEngine.write(Kr.QSOUND,8*t+6,n<<4);break;case Kr.K007232:this.chipEngine.write(Kr.K007232,6*t+0,128);break;case Kr.K053260:this.chipEngine.write(Kr.K053260,40,1<<t);break;case Kr.ES5506:break;case Kr.OPN:{const e=t%3;this.chipEngine.write(Kr.OPN,40,e),this.chipEngine.write(Kr.OPN,40,240|e);break}case Kr.OPNB_B:{const e=[1,2,5,6,0,4][t%6];this.chipEngine.write(Kr.OPNB_B,40,e),this.chipEngine.write(Kr.OPNB_B,40,240|e);break}case Kr.ESFM:{const e=t%18,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(Kr.ESFM,n|176+e%9,a),this.chipEngine.write(Kr.ESFM,n|176+e%9,s);break}case Kr.AY8930:{const e=1789773,a=65535&Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Kr.AY8930,2*t,255&a),this.chipEngine.write(Kr.AY8930,2*t+1,a>>8&255),this.chipEngine.write(Kr.AY8930,8+t,31&n),this.chipEngine.write(Kr.AY8930,7,63&~(1<<t)),this.chipEngine.write(Kr.AY8930,22+t,8);break}case Kr.NDS:{const e=16*t,a=65535&Math.floor(65536*this.activeNoteFreq/32768);this.chipEngine.write(Kr.NDS,e+8,255&a),this.chipEngine.write(Kr.NDS,e+9,a>>8&255),this.chipEngine.write(Kr.NDS,e+3,128|n<<1);break}case Kr.GBA_DMA:this.chipEngine.write(Kr.GBA_DMA,130,11);break;case Kr.GBA_MINMOD:this.chipEngine.write(Kr.GBA_MINMOD,0,128|n);break;case Kr.POKEMINI:{const e=4e6,t=Math.floor(e/(16*this.activeNoteFreq)),a=Math.max(1,Math.min(65535,t));this.chipEngine.write(Kr.POKEMINI,74,255&a),this.chipEngine.write(Kr.POKEMINI,75,a>>8&255),this.chipEngine.write(Kr.POKEMINI,76,a>>1&255),this.chipEngine.write(Kr.POKEMINI,77,a>>1>>8&255),this.chipEngine.write(Kr.POKEMINI,72,4),this.chipEngine.write(Kr.POKEMINI,113,n>8?3:n>4?2:1);break}case Kr.NAMCO:{const e=4194304,a=1048575&Math.floor(this.activeNoteFreq*e/192e3);if(0===t)this.chipEngine.write(Kr.NAMCO,16,a>>4&15),this.chipEngine.write(Kr.NAMCO,17,15&a),this.chipEngine.write(Kr.NAMCO,18,a>>8&15),this.chipEngine.write(Kr.NAMCO,19,a>>12&15),this.chipEngine.write(Kr.NAMCO,20,a>>16&15);else{const e=21+5*(t-1);this.chipEngine.write(Kr.NAMCO,e+1,15&a),this.chipEngine.write(Kr.NAMCO,e+2,a>>8&15),this.chipEngine.write(Kr.NAMCO,e+3,a>>12&15),this.chipEngine.write(Kr.NAMCO,e+4,a>>16&15)}this.chipEngine.write(Kr.NAMCO,21+5*t,15&n),this.chipEngine.write(Kr.NAMCO,5+5*t,0);break}case Kr.PET:{const e=1e6,t=Math.floor(e/(16*this.activeNoteFreq))-1,n=Math.max(0,Math.min(65535,t));this.chipEngine.write(Kr.PET,8,255&n),this.chipEngine.write(Kr.PET,9,n>>8&255),this.chipEngine.write(Kr.PET,11,16);break}case Kr.POKEY:{const e=1789773,a=Math.floor(e/(2*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,a));this.chipEngine.write(Kr.POKEY,2*t,s),this.chipEngine.write(Kr.POKEY,2*t+1,160|15&n),this.chipEngine.write(Kr.POKEY,8,0),this.chipEngine.write(Kr.POKEY,15,3);break}case Kr.MSM6258:this.chipEngine.write(Kr.MSM6258,0,2);break;case Kr.MSM5232:this.chipEngine.write(Kr.MSM5232,t,128|n);break;case Kr.MULTIPCM:{const e=t<<3;this.chipEngine.write(Kr.MULTIPCM,e+4,128),this.chipEngine.write(Kr.MULTIPCM,e+5,15-n<<3);break}case Kr.AMIGA:{const e=3546895,a=Math.floor(e/(2*this.activeNoteFreq)),s=Math.max(124,Math.min(65535,a)),r=160+16*t;this.chipEngine.write(Kr.AMIGA,r+6,s>>8&255),this.chipEngine.write(Kr.AMIGA,r+7,255&s),this.chipEngine.write(Kr.AMIGA,r+8,4*n&127),this.chipEngine.write(Kr.AMIGA,150,32768|1<<t);break}case Kr.PCSPKR:{const e=1193182,t=Math.floor(e/this.activeNoteFreq),n=Math.max(1,Math.min(65535,t));this.chipEngine.write(Kr.PCSPKR,0,255&n),this.chipEngine.write(Kr.PCSPKR,1,n>>8&255);break}case Kr.PONG:this.chipEngine.write(Kr.PONG,0,1);break;case Kr.PV1000:{const e=3579545,n=Math.floor(63-e/(1024*this.activeNoteFreq)),a=Math.max(0,Math.min(62,n));this.chipEngine.write(Kr.PV1000,t,a);break}case Kr.DAVE:{const e=8e6,a=Math.floor(4096-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a));this.chipEngine.write(Kr.DAVE,2*t,255&s),this.chipEngine.write(Kr.DAVE,2*t+1,s>>8&15),this.chipEngine.write(Kr.DAVE,8+t,n<<2&63),this.chipEngine.write(Kr.DAVE,12+t,n<<2&63),this.chipEngine.write(Kr.DAVE,7,15);break}case Kr.SU:{const e=t<<3;this.chipEngine.write(Kr.SU,e+4,128|n);break}case Kr.BIFURCATOR:this.chipEngine.write(Kr.BIFURCATOR,t,n);break;case Kr.POWERNOISE:{const e=t<<2;this.chipEngine.write(Kr.POWERNOISE,e+0,128|n);break}case Kr.ZXBEEPER:{const e=35e5,t=Math.floor(e/(2*this.activeNoteFreq));this.chipEngine.write(Kr.ZXBEEPER,0,255&t),this.chipEngine.write(Kr.ZXBEEPER,1,t>>8&255);break}case Kr.ZXBEEPER_QT:{const e=35e5,n=Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Kr.ZXBEEPER_QT,2*t,255&n),this.chipEngine.write(Kr.ZXBEEPER_QT,2*t+1,n>>8&255);break}case Kr.SCVTONE:{const e=3579545,a=Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Kr.SCVTONE,2*t,255&a),this.chipEngine.write(Kr.SCVTONE,2*t+1,a>>8&15|n<<4);break}case Kr.PCMDAC:this.chipEngine.write(Kr.PCMDAC,0,128|n)}}triggerRelease(e){if(this.isNoteOn=!1,!this.useWasmEngine)return this;const t=x()-this.noteOnTime;if(t<to.MIN_GATE_TIME){setTimeout(()=>this.writeKeyOff(),1e3*(to.MIN_GATE_TIME-t))}else this.writeKeyOff();return this}writeKeyOff(){if(!this.wasmNoteTriggered)return;this.wasmNoteTriggered=!1;const e=this.channelIndex;switch(this.config.chipType){case Kr.OPN2:{const t=e%3,n=e<3?0:1,a=0===n?0:256,s=n<<2|t;this.chipEngine.write(Kr.OPN2,40,s);const r=[0,8,4,12];for(let e=0;e<4;e++){const n=r[e]+t;this.chipEngine.write(Kr.OPN2,a|64+n,127)}this.chipEngine.deactivate(Kr.OPN2);break}case Kr.OPM:{const t=7&e;this.chipEngine.write(Kr.OPM,8,t);const n=[0,16,8,24];for(let a=0;a<4;a++){const t=n[a]+(7&e);this.chipEngine.write(Kr.OPM,96+t,127)}this.chipEngine.deactivate(Kr.OPM);break}case Kr.OPL3:{const t=e%9,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Kr.OPL3,n|176+t,a);break}case Kr.OPLL:{const t=e%9,n=3579545;let a=0,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-a)/n);for(;s>511&&a<7;)a++,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-a)/n);s=Math.min(511,Math.max(0,s));const r=(7&a)<<1|s>>8&1;this.chipEngine.write(Kr.OPLL,32+t,r);break}case Kr.OPNA:{const t=(e<3?0:1)<<2|e%3;this.chipEngine.write(Kr.OPNA,40,t);break}case Kr.OPNB:{const t=[1,2,5,6][3&e];this.chipEngine.write(Kr.OPNB,40,t);break}case Kr.OPN:{const t=e%3;this.chipEngine.write(Kr.OPN,40,t);break}case Kr.OPZ:{const t=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7;this.chipEngine.write(Kr.OPZ,32+(7&e),t),this.chipEngine.deactivate(Kr.OPZ);break}case Kr.Y8950:case Kr.OPL4:{const t=this.config.chipType,n=e%9,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(t,176+n,a);break}case Kr.PSG:this.chipEngine.write(Kr.PSG,0,159|(3&e)<<5);break;case Kr.AY:this.chipEngine.write(Kr.AY,8+e,0);break;case Kr.SAA:this.chipEngine.write(Kr.SAA,0+e,0),this.chipEngine.write(Kr.SAA,20,0);break;case Kr.T6W28:this.chipEngine.write(Kr.T6W28,0,159|(3&e)<<5),this.chipEngine.write(Kr.T6W28,1,159|(3&e)<<5);break;case Kr.NES:if(e<2){const t=16384+4*e;this.chipEngine.write(Kr.NES,t,48)}else 2===e?this.chipEngine.write(Kr.NES,16392,0):3===e&&this.chipEngine.write(Kr.NES,16396,48);break;case Kr.GB:{const t=16+5*e;e<2?this.chipEngine.write(Kr.GB,t+2,8):2===e?this.chipEngine.write(Kr.GB,28,0):3===e&&this.chipEngine.write(Kr.GB,33,8);break}case Kr.PCE:this.chipEngine.write(Kr.PCE,0,7&e),this.chipEngine.write(Kr.PCE,5,0);break;case Kr.SNES:this.chipEngine.write(Kr.SNES,92,1<<(7&e));break;case Kr.VB:{const t=1024+64*e;this.chipEngine.write(Kr.VB,t+16,0);break}case Kr.LYNX:{const t=32+8*e;this.chipEngine.write(Kr.LYNX,t+0,0);break}case Kr.VRC6:if(e<2){const t=0===e?36864:40960;this.chipEngine.write(Kr.VRC6,t,0)}else this.chipEngine.write(Kr.VRC6,45056,0);break;case Kr.N163:this.chipEngine.write(Kr.N163,127,0);break;case Kr.FDS:this.chipEngine.write(Kr.FDS,16512,128);break;case Kr.MMC5:{const t=0===e?20480:20484;this.chipEngine.write(Kr.MMC5,t,48);break}case Kr.SCC:this.chipEngine.write(Kr.SCC,170+e,0);break;case Kr.SWAN:this.chipEngine.write(Kr.SWAN,8+e,0);break;case Kr.VERA:{const t=4*e;this.chipEngine.write(Kr.VERA,t+2,0);break}case Kr.SM8521:{const t=[66,68,74][e]||66;this.chipEngine.write(Kr.SM8521,t,0);break}case Kr.BUBBLE:this.chipEngine.write(Kr.BUBBLE,2+e,0);break;case Kr.X1_010:{const t=e<<3;this.chipEngine.write(Kr.X1_010,t,0);break}case Kr.SID:{const t=0,n=e*64;this.chipEngine.write(Kr.SID,n+t,0);break}case Kr.SID_6581:case Kr.SID_8580:{const t=7*e,n=45===this.config.chipType?Kr.SID_6581:Kr.SID_8580;this.chipEngine.write(n,t+4,0);break}case Kr.TIA:this.chipEngine.write(Kr.TIA,25+e,0);break;case Kr.VIC:this.chipEngine.write(Kr.VIC,10+e,0);break;case Kr.TED:this.chipEngine.write(Kr.TED,17,0);break;case Kr.SUPERVISION:{const t=16+4*e;this.chipEngine.write(Kr.SUPERVISION,t+2,0);break}case Kr.UPD1771:this.chipEngine.write(Kr.UPD1771,0,0);break;case Kr.YMZ280B:{const t=4*e;this.chipEngine.write(Kr.YMZ280B,1+t,64);break}case Kr.RF5C68:this.chipEngine.write(Kr.RF5C68,8,255);break;case Kr.GA20:{const t=8*e;this.chipEngine.write(Kr.GA20,t+5,0),this.chipEngine.write(Kr.GA20,t+6,0);break}case Kr.SEGAPCM:{const t=8*(15&e);this.chipEngine.write(Kr.SEGAPCM,134+t,0);break}case Kr.K007232:this.chipEngine.write(Kr.K007232,12,0);break;case Kr.K053260:this.chipEngine.write(Kr.K053260,40,0);break;case Kr.QSOUND:{const t=e%16,n=t<8?6+8*t:70+8*(t-8);this.chipEngine.write(Kr.QSOUND,0,0),this.chipEngine.write(Kr.QSOUND,1,0),this.chipEngine.write(Kr.QSOUND,2,n);break}case Kr.C140:{const t=16*(e%24);this.chipEngine.write(Kr.C140,t+5,0);break}case Kr.ES5506:case Kr.OKI:break;case Kr.OPN:{const t=e%3;this.chipEngine.write(Kr.OPN,40,t);break}case Kr.OPNB_B:{const t=[1,2,5,6][3&e];this.chipEngine.write(Kr.OPNB_B,40,t);break}case Kr.ESFM:{const t=e%9,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Kr.ESFM,n|176+t,a);break}case Kr.AY8930:this.chipEngine.write(Kr.AY8930,8+e,0);break;case Kr.NDS:{const t=16*e;this.chipEngine.write(Kr.NDS,t+3,0);break}case Kr.GBA_DMA:this.chipEngine.write(Kr.GBA_DMA,132,0);break;case Kr.GBA_MINMOD:this.chipEngine.write(Kr.GBA_MINMOD,132,0);break;case Kr.POKEMINI:this.chipEngine.write(Kr.POKEMINI,113,0);break;case Kr.NAMCO:{const t=8*e;this.chipEngine.write(Kr.NAMCO,21+t,0);break}case Kr.PET:this.chipEngine.write(Kr.PET,0,0);break;case Kr.POKEY:this.chipEngine.write(Kr.POKEY,2*e+1,0);break;case Kr.MSM6258:this.chipEngine.write(Kr.MSM6258,0,1);break;case Kr.MSM5232:{const t=10+e;this.chipEngine.write(Kr.MSM5232,t,0);break}case Kr.MULTIPCM:{const t=8*e;this.chipEngine.write(Kr.MULTIPCM,t+5,0);break}case Kr.AMIGA:this.chipEngine.write(Kr.AMIGA,150,1<<e);break;case Kr.PCSPKR:this.chipEngine.write(Kr.PCSPKR,97,0);break;case Kr.PONG:break;case Kr.PV1000:this.chipEngine.write(Kr.PV1000,252+e,0);break;case Kr.DAVE:{const t=8+3*e+2;this.chipEngine.write(Kr.DAVE,t,0);break}case Kr.SU:{const t=e<<5;this.chipEngine.write(Kr.SU,t+2,0);break}case Kr.BIFURCATOR:break;case Kr.POWERNOISE:{const t=4*e;this.chipEngine.write(Kr.POWERNOISE,t,0);break}case Kr.ZXBEEPER:case Kr.ZXBEEPER_QT:break;case Kr.SCVTONE:this.chipEngine.write(Kr.SCVTONE,e,0);break;case Kr.PCMDAC:this.chipEngine.write(Kr.PCMDAC,0,128)}}dispose(){return this.outputGain.dispose(),super.dispose(),this}}function no(e){switch(e){case oo.GENESIS:case oo.GENESIS_EXT:case oo.YM2151:case oo.YM2612:case oo.YM2203:case oo.YM2203_EXT:case oo.YM2608:case oo.YM2608_EXT:case oo.YM2610:case oo.YM2610_EXT:case oo.YM2610B:case oo.YM2610B_EXT:case oo.ARCADE:case oo.TX81Z:case oo.OPL:case oo.OPL2:case oo.OPL3:case oo.OPL4:case oo.OPLL:case oo.VRC7:case oo.ESFM:return"fm";case oo.AY8910:case oo.AY8930:case oo.SMS:case oo.SAA1099:case oo.T6W28:return"psg";case oo.C64_6581:case oo.C64_8580:case oo.SID2:case oo.SID3:return"c64";case oo.SNES:return"snes";case oo.GB:return"gb";case oo.NES:case oo.NES_VRC7:case oo.NES_FDS:case oo.VRC6:case oo.MMC5:case oo.FDS:return"nes";case oo.PCE:return"pce";case oo.NAMCO:case oo.NAMCO_15XX:case oo.NAMCO_CUS30:case oo.N163:return"namco";case oo.AMIGA:case oo.SEGAPCM:case oo.QSOUND:case oo.MULTIPCM:case oo.RF5C68:case oo.MSM6295:case oo.MSM6258:case oo.YMZ280B:case oo.K007232:case oo.K053260:case oo.GA20:case oo.C140:case oo.ES5506:return"sample";default:return"other"}}class ao{platformType;family;effectMemory=new Map;constructor(e=oo.GB){this.platformType=e,this.family=no(e)}setPlatform(e){this.platformType=e,this.family=no(e)}getMemory(e,t){const n=this.effectMemory.get(e);return n?n.get(t)??0:0}setMemory(e,t,n){this.effectMemory.has(e)||this.effectMemory.set(e,new Map),this.effectMemory.get(e).set(t,n)}resetMemory(){this.effectMemory.clear()}routeEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];0===a?a=this.getMemory(t,n):this.setMemory(t,n,a);const r=a>>4&15,o=15&a;switch(n){case 0:0!==a&&s.push({cmd:lo.NOTE_PORTA,chan:t,val1:r,val2:o});break;case 1:s.push({cmd:lo.PITCH,chan:t,val1:a,val2:0});break;case 2:s.push({cmd:lo.PITCH,chan:t,val1:-a,val2:0});break;case 3:s.push({cmd:lo.NOTE_PORTA,chan:t,val1:a,val2:1});break;case 4:s.push({cmd:lo.HINT_VIBRATO,chan:t,val1:r,val2:o});break;case 7:s.push({cmd:lo.HINT_TREMOLO,chan:t,val1:r,val2:o});break;case 8:s.push({cmd:lo.PANNING,chan:t,val1:a,val2:a});break;case 10:s.push({cmd:lo.HINT_VOL_SLIDE,chan:t,val1:r,val2:o});break;case 12:s.push({cmd:lo.VOLUME,chan:t,val1:a,val2:0});break;case 14:s.push(...this.routeExtendedEffect(this.platformType,t,r,o));break;default:s.push(...this.routePlatformEffect(this.platformType,t,n,a))}return s}routeExtendedEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];switch(n){case 1:s.push({cmd:lo.PITCH,chan:t,val1:a,val2:0});break;case 2:s.push({cmd:lo.PITCH,chan:t,val1:-a,val2:0});break;case 3:s.push({cmd:lo.LEGATO,chan:t,val1:a,val2:0});break;case 4:s.push({cmd:lo.HINT_VIBRATO_SHAPE,chan:t,val1:a,val2:0});break;case 5:s.push({cmd:lo.PITCH,chan:t,val1:a-8,val2:1});break;case 9:s.push({cmd:lo.NOTE_ON,chan:t,val1:-1,val2:a});break;case 10:s.push({cmd:lo.HINT_VOL_SLIDE,chan:t,val1:a,val2:0});break;case 11:s.push({cmd:lo.HINT_VOL_SLIDE,chan:t,val1:0,val2:a});break;case 12:s.push({cmd:lo.NOTE_OFF,chan:t,val1:a,val2:0});break;case 13:s.push({cmd:lo.PRE_NOTE,chan:t,val1:a,val2:0});break;case 15:s.push({cmd:lo.MACRO_ON,chan:t,val1:a,val2:0})}return s.push(...this.routePlatformExtendedEffect(this.platformType,t,n,a)),s}routePlatformEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];switch(this.family){case"fm":s.push(...this.routeFMEffect(t,n,a));break;case"c64":s.push(...this.routeC64Effect(t,n,a));break;case"snes":s.push(...this.routeSNESEffect(t,n,a));break;case"gb":s.push(...this.routeGBEffect(t,n,a));break;case"nes":s.push(...this.routeNESEffect(t,n,a));break;case"pce":s.push(...this.routePCEEffect(t,n,a));break;case"psg":s.push(...this.routePSGEffect(t,n,a));break;case"namco":s.push(...this.routeNamcoEffect(t,n,a));break;case"sample":s.push(...this.routeSampleEffect(t,n,a))}return s}routePlatformExtendedEffect(e,t,n,a){const s=[];switch(e!==this.platformType&&this.setPlatform(e),this.family){case"gb":6===n&&s.push({cmd:lo.GB_SWEEP_TIME,chan:t,val1:a,val2:0});break;case"nes":6===n&&s.push({cmd:lo.NES_SWEEP,chan:t,val1:a,val2:0});break;case"c64":6===n&&s.push({cmd:lo.C64_FILTER_MODE,chan:t,val1:a,val2:0})}return s}routeFMEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:lo.FM_LFO,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.FM_TL,chan:e,val1:s,val2:8*r});break;case 18:a.push({cmd:lo.FM_AR,chan:e,val1:s,val2:2*r});break;case 19:a.push({cmd:lo.FM_DR,chan:e,val1:s,val2:2*r});break;case 20:a.push({cmd:lo.FM_MULT,chan:e,val1:s,val2:r});break;case 21:a.push({cmd:lo.FM_RR,chan:e,val1:s,val2:r});break;case 22:a.push({cmd:lo.FM_SL,chan:e,val1:s,val2:r});break;case 23:a.push({cmd:lo.FM_DT,chan:e,val1:s,val2:r});break;case 24:a.push({cmd:lo.FM_FB,chan:e,val1:n>>4,val2:0});break;case 25:a.push({cmd:lo.FM_FB,chan:e,val1:0,val2:7&n});break;case 26:a.push({cmd:lo.FM_SSG,chan:e,val1:s,val2:r});break;case 27:a.push({cmd:lo.FM_AM_DEPTH,chan:e,val1:s,val2:0}),a.push({cmd:lo.FM_PM_DEPTH,chan:e,val1:r,val2:0});break;case 31:a.push({cmd:lo.FM_HARD_RESET,chan:e,val1:n,val2:0})}return a}routeC64Effect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.C64_CUTOFF,chan:e,val1:8*n,val2:0});break;case 17:a.push({cmd:lo.C64_FINE_CUTOFF,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.C64_RESONANCE,chan:e,val1:15&n,val2:0});break;case 19:a.push({cmd:lo.C64_FILTER_MODE,chan:e,val1:7&n,val2:0});break;case 20:a.push({cmd:lo.C64_EXTENDED,chan:e,val1:0,val2:n});break;case 21:a.push({cmd:lo.C64_EXTENDED,chan:e,val1:1,val2:n});break;case 22:a.push({cmd:lo.C64_DUTY_RESET,chan:e,val1:16*n,val2:0});break;case 23:a.push({cmd:lo.C64_FINE_DUTY,chan:e,val1:n,val2:0})}return a}routeSNESEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.SNES_ECHO,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.SNES_ECHO_DELAY,chan:e,val1:15&n,val2:0});break;case 18:a.push({cmd:lo.SNES_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:lo.SNES_ECHO_VOL_LEFT,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:lo.SNES_ECHO_VOL_RIGHT,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:lo.SNES_ECHO_FIR,chan:e,val1:n,val2:0});break;case 22:a.push({cmd:lo.SNES_PITCH_MOD,chan:e,val1:n,val2:0});break;case 23:a.push({cmd:lo.SNES_GAIN_MODE,chan:e,val1:n,val2:0});break;case 24:a.push({cmd:lo.SNES_GAIN,chan:e,val1:n,val2:0});break;case 25:a.push({cmd:lo.SNES_INVERT,chan:e,val1:n,val2:0})}return a}routeGBEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:lo.GB_SWEEP_TIME,chan:e,val1:s,val2:0}),a.push({cmd:lo.GB_SWEEP_DIR,chan:e,val1:r>>3,val2:0});break;case 17:a.push({cmd:lo.WAVE,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.STD_NOISE_MODE,chan:e,val1:n,val2:0})}return a}routeNESEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:lo.NES_SWEEP,chan:e,val1:s,val2:r});break;case 17:a.push({cmd:lo.NES_DMC,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.NES_ENV_MODE,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:lo.NES_LENGTH,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:lo.FDS_MOD_DEPTH,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:lo.FDS_MOD_HIGH,chan:e,val1:n,val2:0});break;case 22:a.push({cmd:lo.FDS_MOD_LOW,chan:e,val1:n,val2:0})}return a}routePCEEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.PCE_LFO_MODE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.PCE_LFO_SPEED,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.WAVE,chan:e,val1:n,val2:0})}return a}routePSGEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.AY_ENVELOPE_SET,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.AY_ENVELOPE_LOW,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.AY_ENVELOPE_HIGH,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:lo.AY_AUTO_ENVELOPE,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:lo.STD_NOISE_FREQ,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:lo.STD_NOISE_MODE,chan:e,val1:n,val2:0})}return a}routeNamcoEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.WAVE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.N163_WAVE_POSITION,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.N163_WAVE_LENGTH,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:lo.N163_WAVE_LOADPOS,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:lo.N163_CHANNEL_LIMIT,chan:e,val1:n,val2:0})}return a}routeSampleEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:lo.SAMPLE_MODE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:lo.SAMPLE_BANK,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:lo.SAMPLE_DIR,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:lo.SAMPLE_POS,chan:e,val1:n<<8,val2:0});break;case 20:a.push({cmd:lo.ES5506_FILTER_MODE,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:lo.ES5506_FILTER_K1,chan:e,val1:n<<8,val2:65280});break;case 22:a.push({cmd:lo.ES5506_FILTER_K2,chan:e,val1:n<<8,val2:65280});break;case 23:a.push({cmd:lo.QSOUND_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 24:a.push({cmd:lo.QSOUND_ECHO_LEVEL,chan:e,val1:n,val2:0});break;case 25:a.push({cmd:lo.QSOUND_SURROUND,chan:e,val1:n,val2:0})}return a}clearMemory(){this.effectMemory.clear()}clearChannelMemory(e){this.effectMemory.delete(e)}}let so=null;function ro(){return so||(so=new ao),so}new Proxy({},{get:(e,t)=>ro()[t],set:(e,t,n)=>(ro()[t]=n,!0)});const oo={GENESIS:2,GENESIS_EXT:3,ARCADE:13,NES_VRC7:9,NES_FDS:10,SMS:4,GB:6,PCE:7,NES:8,SNES:26,SWAN:43,LYNX:60,VBOY:47,NDS:103,POKEMINI:45,TIA:21,POKEY:41,C64_6581:11,C64_8580:12,PET:25,VIC20:24,TED:97,FDS:29,MMC5:30,N163:31,VRC6:27,VRC7:48,AY:17,AY8910:17,AY8930:23,SAA1099:22,T6W28:83,YM2612:20,YM2151:19,TX81Z:44,YM2203:32,YM2203_EXT:33,YM2608:34,YM2608_EXT:35,YM2610:57,YM2610_EXT:58,YM2610B:49,YM2610B_EXT:63,OPL:36,OPL2:37,OPL3:38,OPL4:67,OPLL:28,ESFM:100,AMIGA:18,SEGAPCM:46,SEGAPCM_COMPAT:64,MULTIPCM:39,QSOUND:61,RF5C68:42,PCM_DAC:86,ES5506:69,K007232:84,K053260:96,GA20:85,C140:98,C219:99,YMZ280B:76,MSM6258:75,MSM6295:74,SCC:53,SCC_PLUS:72,NAMCO:77,NAMCO_15XX:78,NAMCO_CUS30:79,BUBSYS_WSG:66,X1_010:65,VERA:62,SOUND_UNIT:73,PCSPKR:40,PONG:87,PV1000:95,MSM5232:82,SM8521:94,DAVE:102,POWERNOISE:101,SFX_BEEPER:50,GBA_DMA:104,GBA_MINMOD:105,SID2:108,SID3:111,SUPERVISION:109,UPD1771C:110},io=10,lo={NOTE_ON:0,NOTE_OFF:1,INSTRUMENT:4,VOLUME:5,NOTE_PORTA:8,PITCH:9,PANNING:10,LEGATO:11,PRE_NOTE:13,HINT_VIBRATO:14,HINT_VIBRATO_SHAPE:16,HINT_VOL_SLIDE:20,HINT_TREMOLO:24,SAMPLE_MODE:28,SAMPLE_BANK:30,SAMPLE_POS:31,SAMPLE_DIR:32,FM_HARD_RESET:33,FM_LFO:34,FM_TL:36,FM_AR:38,FM_DR:39,FM_SL:40,FM_RR:42,FM_DT:43,FM_SSG:50,FM_FB:53,FM_MULT:54,FM_AM_DEPTH:58,FM_PM_DEPTH:59,STD_NOISE_FREQ:62,STD_NOISE_MODE:63,WAVE:64,GB_SWEEP_TIME:65,GB_SWEEP_DIR:66,PCE_LFO_MODE:67,PCE_LFO_SPEED:68,NES_SWEEP:69,NES_DMC:70,C64_CUTOFF:71,C64_RESONANCE:72,C64_FILTER_MODE:73,C64_DUTY_RESET:77,C64_EXTENDED:78,C64_FINE_DUTY:79,C64_FINE_CUTOFF:80,AY_ENVELOPE_SET:81,AY_ENVELOPE_LOW:82,AY_ENVELOPE_HIGH:83,AY_AUTO_ENVELOPE:87,FDS_MOD_DEPTH:90,FDS_MOD_HIGH:91,FDS_MOD_LOW:92,QSOUND_ECHO_FEEDBACK:100,QSOUND_ECHO_LEVEL:102,QSOUND_SURROUND:103,N163_WAVE_POSITION:113,N163_WAVE_LENGTH:114,N163_WAVE_LOADPOS:117,N163_CHANNEL_LIMIT:120,SNES_ECHO:132,SNES_PITCH_MOD:133,SNES_INVERT:134,SNES_GAIN_MODE:135,SNES_GAIN:136,SNES_ECHO_DELAY:138,SNES_ECHO_VOL_LEFT:139,SNES_ECHO_VOL_RIGHT:140,SNES_ECHO_FEEDBACK:141,SNES_ECHO_FIR:142,NES_ENV_MODE:143,NES_LENGTH:144,MACRO_ON:147,ES5506_FILTER_MODE:151,ES5506_FILTER_K1:152,ES5506_FILTER_K2:153},co=1;class uo{static instance=null;workletNode=null;_nativeCtx=null;initialized=!1;initializing=!1;numChannels=0;platformType=0;dispatchHandle=0;_wasmReadyResolve=null;_wasmReadyReject=null;_wasmReadyPromise=null;_chipCreatedResolve=null;_chipCreatedPromise=null;oscCallbacks=new Set;latestOscData=[];static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;effectRouter=new ao;constructor(){}static getInstance(){return uo.instance||(uo.instance=new uo),uo.instance}get isInitialized(){return this.initialized}get channelCount(){return this.numChannels}get platform(){return this.platformType}get handle(){return this.dispatchHandle}async init(e){if(!this.initialized&&!this.initializing){this.initializing=!0;try{const a=qa(e);if(!a)throw new Error("Could not get native AudioContext");if(this._nativeCtx=a,"running"!==a.state)try{await a.resume()}catch(t){throw new Error(`AudioContext not running (state: ${a.state})`)}if("running"!==a.state)throw new Error(`AudioContext still not running after resume (state: ${a.state})`);await uo.ensureModuleLoaded(a);try{this.workletNode=new AudioWorkletNode(a,"furnace-dispatch-processor",{outputChannelCount:[2],processorOptions:{sampleRate:a.sampleRate}})}catch(n){throw n}this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this._wasmReadyPromise=new Promise((e,t)=>{this._wasmReadyResolve=e,this._wasmReadyReject=t,setTimeout(()=>t(new Error("FurnaceDispatch WASM ready timeout after 10s")),1e4)}),this.workletNode.port.postMessage({type:"init",sampleRate:a.sampleRate,wasmBinary:uo.wasmBinary,jsCode:uo.jsCode}),await this._wasmReadyPromise;try{const e=a.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(a.destination)}catch(t){}this.initialized=!0}catch(a){throw a}finally{this.initializing=!1}}}static async ensureModuleLoaded(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/",n=`?v=${Date.now()}`;if("running"!==e.state)try{await e.resume()}catch(a){}try{await e.audioWorklet.addModule(`${t}furnace-dispatch/FurnaceDispatch.worklet.js${n}`)}catch(a){const e=a?.message||String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load FurnaceDispatch worklet: ${e}`)}if(!this.wasmBinary||!this.jsCode){const[e,a]=await Promise.all([fetch(`${t}furnace-dispatch/FurnaceDispatch.wasm${n}`,{cache:"no-store"}),fetch(`${t}furnace-dispatch/FurnaceDispatch.js${n}`,{cache:"no-store"})]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar createFurnaceDispatch = createFurnaceDispatch || Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}handleWorkletMessage(e){switch(e.type){case"ready":this._wasmReadyResolve&&(this._wasmReadyResolve(),this._wasmReadyResolve=null);break;case"chipCreated":this.dispatchHandle=e.handle,this.numChannels=e.numChannels,this.platformType=e.platformType,this.latestOscData=new Array(this.numChannels).fill(null),this._chipCreatedResolve&&(this._chipCreatedResolve(),this._chipCreatedResolve=null);break;case"oscData":this.latestOscData=e.channels;for(const t of this.oscCallbacks)t(e.channels);break;case"error":this._wasmReadyReject&&(this._wasmReadyReject(new Error(e.message)),this._wasmReadyReject=null,this._wasmReadyResolve=null)}}createChip(e,t){this.workletNode&&(this._chipCreatedPromise=new Promise(e=>{this._chipCreatedResolve=e}),this.workletNode.port.postMessage({type:"createChip",platformType:e,sampleRate:t}))}async waitForChipCreated(){this._chipCreatedPromise&&await this._chipCreatedPromise}dispatch(e,t,n=0,a=0){this.workletNode&&this.workletNode.port.postMessage({type:"dispatch",cmd:e,chan:t,val1:n,val2:a})}noteOn(e,t){this.dispatch(lo.NOTE_ON,e,t,0)}noteOff(e){this.dispatch(lo.NOTE_OFF,e,0,0)}setInstrument(e,t){this.dispatch(lo.INSTRUMENT,e,t,0)}setVolume(e,t){this.dispatch(lo.VOLUME,e,t,0)}setGBInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setGBInstrument",insIndex:e,insData:t})}setWavetable(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",waveIndex:e,waveData:t})}setFMInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setFMInstrument",insIndex:e,insData:t})}setC64Instrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setC64Instrument",insIndex:e,insData:t})}setNESInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setNESInstrument",insIndex:e,insData:t})}setSNESInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setSNESInstrument",insIndex:e,insData:t})}setN163Instrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setN163Instrument",insIndex:e,insData:t})}setFDSInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setFDSInstrument",insIndex:e,insData:t})}setAmigaInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setAmigaInstrument",insIndex:e,insData:t})}setMultiPCMInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMultiPCMInstrument",insIndex:e,insData:t})}setES5506Instrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setES5506Instrument",insIndex:e,insData:t})}setESFMInstrument(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setESFMInstrument",insIndex:e,insData:t})}setWaveSynth(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setWaveSynth",insIndex:e,insData:t})}setMacro(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMacro",insIndex:e,macroData:t})}setInstrumentFull(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t})}setSample(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setSample",sampleIndex:e,sampleData:t})}renderSamples(){this.workletNode&&this.workletNode.port.postMessage({type:"renderSamples"})}setMacrosEnabled(e){this.workletNode&&this.workletNode.port.postMessage({type:"setMacrosEnabled",enabled:e})}clearMacros(e){this.workletNode&&this.workletNode.port.postMessage({type:"clearMacros",insIndex:e})}releaseMacros(e){this.workletNode&&this.workletNode.port.postMessage({type:"releaseMacros",chan:e})}setCompatFlags(e){if(!this.workletNode)return;const t=new Uint8Array(57);t[0]=e.limitSlides?1:0,t[1]=e.linearPitch??2,t[2]=e.pitchSlideSpeed??0,t[3]=e.loopModality??0,t[4]=e.delayBehavior??0,t[5]=e.jumpTreatment??0,t[6]=e.properNoiseLayout?1:0,t[7]=e.waveDutyIsVol?1:0,t[8]=e.resetMacroOnPorta?1:0,t[9]=e.legacyVolumeSlides?1:0,t[10]=e.compatibleArpeggio?1:0,t[11]=e.noteOffResetsSlides?1:0,t[12]=e.targetResetsSlides?1:0,t[13]=e.arpNonPorta?1:0,t[14]=e.algMacroBehavior?1:0,t[15]=e.brokenShortcutSlides?1:0,t[16]=e.ignoreDuplicateSlides?1:0,t[17]=e.stopPortaOnNoteOff?1:0,t[18]=e.continuousVibrato?1:0,t[19]=e.brokenDACMode?1:0,t[20]=e.oneTickCut?1:0,t[21]=e.newInsTriggersInPorta?1:0,t[22]=e.arp0Reset?1:0,t[23]=e.brokenSpeedSel?1:0,t[24]=e.noSlidesOnFirstTick?1:0,t[25]=e.rowResetsArpPos?1:0,t[26]=e.ignoreJumpAtEnd?1:0,t[27]=e.buggyPortaAfterSlide?1:0,t[28]=e.gbInsAffectsEnvelope?1:0,t[29]=e.sharedExtStat?1:0,t[30]=e.ignoreDACModeOutsideChannel?1:0,t[31]=e.e1e2AlsoTakePriority?1:0,t[32]=e.newSegaPCM?1:0,t[33]=e.fbPortaPause?1:0,t[34]=e.snDutyReset?1:0,t[35]=e.pitchMacroIsLinear?1:0,t[36]=e.oldOctaveBoundary?1:0,t[37]=e.noOPN2Vol?1:0,t[38]=e.newVolumeScaling?1:0,t[39]=e.volMacroLinger?1:0,t[40]=e.brokenOutVol?1:0,t[41]=e.brokenOutVol2?1:0,t[42]=e.e1e2StopOnSameNote?1:0,t[43]=e.brokenPortaArp?1:0,t[44]=e.snNoLowPeriods?1:0,t[45]=e.disableSampleMacro?1:0,t[46]=e.oldArpStrategy?1:0,t[47]=e.brokenPortaLegato?1:0,t[48]=e.brokenFMOff?1:0,t[49]=e.preNoteNoEffect?1:0,t[50]=e.oldDPCM?1:0,t[51]=e.resetArpPhaseOnNewNote?1:0,t[52]=e.ceilVolumeScaling?1:0,t[53]=e.oldAlwaysSetVolume?1:0,t[54]=e.oldSampleOffset?1:0,t[55]=e.oldCenterRate?1:0,t[56]=e.noVolSlideReset?1:0,this.workletNode.port.postMessage({type:"setCompatFlags",flags:t})}setCompatFlag(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setCompatFlag",flagIndex:e,value:t})}resetCompatFlags(){this.workletNode&&this.workletNode.port.postMessage({type:"resetCompatFlags"})}setLinearPitch(e){this.setCompatFlag(co,e)}setTickRate(e){this.workletNode&&this.workletNode.port.postMessage({type:"setTickRate",hz:e})}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}forceIns(){this.workletNode&&this.workletNode.port.postMessage({type:"forceIns"})}mute(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"mute",chan:e,mute:t})}onOscData(e){return this.oscCallbacks.add(e),()=>{this.oscCallbacks.delete(e)}}getOscData(){return this.latestOscData}getWorkletNode(){return this.workletNode}getNativeCtx(){return this._nativeCtx}dispatchFM(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchC64(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchSNES(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchGB(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchNES(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchAY(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchES5506(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchN163(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchSample(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}dispatchMacro(e,t){this.dispatch(t.cmd,e,t.val1,t.val2)}applyEffect(e,t,n){const a=this.effectRouter.routeEffect(this.platformType,e,t,n);for(const s of a)this.dispatch(s.cmd,s.chan,s.val1,s.val2)}applyExtendedEffect(e,t,n){const a=this.effectRouter.routeExtendedEffect(this.platformType,e,t,n);for(const s of a)this.dispatch(s.cmd,s.chan,s.val1,s.val2)}applyPlatformEffect(e,t,n){const a=this.effectRouter.routePlatformEffect(this.platformType,e,t,n);for(const s of a)this.dispatch(s.cmd,s.chan,s.val1,s.val2)}resetEffectMemory(){this.effectRouter.resetMemory()}getEffectRouter(){return this.effectRouter}dispose(){this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.dispatchHandle=0,this.numChannels=0,this.oscCallbacks.clear(),this.latestOscData=[],uo.instance=null}}const po=a(e=>({channelData:[],numChannels:0,platformType:0,isActive:!1,updateChannelData:t=>e({channelData:t,isActive:!0}),setChipInfo:(t,n)=>e({numChannels:t,platformType:n,channelData:new Array(t).fill(null)}),clear:()=>e({channelData:[],numChannels:0,platformType:0,isActive:!1})})),ho={[oo.GB]:["PU1","PU2","WAV","NOI"],[oo.NES]:["PU1","PU2","TRI","NOI","DPCM"],[oo.SMS]:["SQ1","SQ2","SQ3","NOI"],[oo.AY]:["A","B","C"],[oo.AY8930]:["A","B","C"],[oo.PCE]:["CH1","CH2","CH3","CH4","CH5","CH6"],[oo.SNES]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[oo.VRC6]:["PU1","PU2","SAW"],[oo.FDS]:["FDS"],[oo.MMC5]:["PU1","PU2","PCM"],[oo.N163]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[oo.C64_6581]:["V1","V2","V3"],[oo.C64_8580]:["V1","V2","V3"],[oo.VIC20]:["BASS","ALT","SOP","NOI"],[oo.SAA1099]:["CH1","CH2","CH3","CH4","CH5","CH6"],[oo.TIA]:["AUD0","AUD1"],[oo.POKEY]:["CH1","CH2","CH3","CH4"],[oo.LYNX]:["CH1","CH2","CH3","CH4"],[oo.SWAN]:["CH1","CH2","CH3","CH4"],[oo.VERA]:["PU1","PU2","PU3","PU4","PU5","PU6","PU7","PU8","PU9","PU10","PU11","PU12","PU13","PU14","PU15","PU16","PCM"],[oo.SCC]:["CH1","CH2","CH3","CH4","CH5"],[oo.VBOY]:["CH1","CH2","CH3","CH4","CH5","CH6"],[oo.AMIGA]:["CH1","CH2","CH3","CH4"],[oo.PET]:["CH"],[oo.PCSPKR]:["SPK"],[oo.SFX_BEEPER]:["CH1","CH2","CH3","CH4","CH5","CH6"],[oo.PONG]:["CH"],[oo.TED]:["SQ1","SQ2"],[oo.POKEMINI]:["CH"],[oo.PV1000]:["CH1","CH2","CH3"],[oo.SOUND_UNIT]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[oo.NAMCO]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[oo.QSOUND]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8","CH9","CH10","CH11","CH12","CH13","CH14","CH15","CH16"],[oo.DAVE]:["CH1","CH2","CH3","NOI"]},mo={[oo.GB]:15,[oo.SMS]:15,[oo.NES]:15,[oo.PCE]:31,[oo.VIC20]:15,[oo.TIA]:15,[oo.POKEY]:15,[oo.PV1000]:15,[oo.POKEMINI]:3,[oo.PONG]:1,[oo.PCSPKR]:1,[oo.SFX_BEEPER]:15,[oo.TED]:8,[oo.VRC6]:15,[oo.MMC5]:15,[oo.SWAN]:15,[oo.LYNX]:127};function fo(e){return mo[e]??127}class yo extends u{name="FurnaceDispatchSynth";input;output;engine;_disposed=!1;_ready=!1;_readyPromise;_resolveReady;currentChannel=0;platformType;activeNotes=new Map;_volumeOffsetDb=0;constructor(e=oo.GB){super(),this.output=new p(1),this.platformType=e,this.engine=uo.getInstance(),this._readyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize()}get ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}setVolumeOffset(e){this._volumeOffsetDb=e;const t=this._nativeGain;t&&(t.gain.value=Math.pow(10,e/20))}async initialize(){try{const e=this.context,t=e.rawContext||e._context||qa(this.context);if(!t)throw new Error("Could not get native AudioContext");if(await this.engine.init(t),this._disposed)return;const n=this.engine.getNativeCtx()?.sampleRate??t.sampleRate;this.engine.createChip(this.platformType,n),await this.engine.waitForChipCreated();const a=this.engine.getWorkletNode(),s=this.engine.getNativeCtx();if(a&&s){const e=s.createGain();a.connect(e),e.connect(s.destination),this._nativeGain=e,0!==this._volumeOffsetDb&&(e.gain.value=Math.pow(10,this._volumeOffsetDb/20))}this.setupDefaultInstrument(),this._ready=!0,this._resolveReady();const r=po.getState(),o=this.getChannelNames();r.setChipInfo(o.length,this.platformType),this.engine.onOscData(e=>{po.getState().updateChannelData(e)})}catch(e){this._resolveReady()}}setupDefaultInstrument(){const e=oo,t=this.engine.channelCount||4,n=fo(this.platformType);switch(this.platformType){case e.GB:this.setupDefaultGBInstrument();break;case e.PCE:this.setupDefaultWavetable(32,31);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.SCC:case e.SCC_PLUS:this.setupDefaultWavetable(32,255);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.VBOY:this.setupDefaultWavetable(32,63);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.NAMCO:case e.NAMCO_15XX:case e.NAMCO_CUS30:case e.BUBSYS_WSG:this.setupDefaultWavetable(32,15);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.SWAN:this.setupDefaultWavetable(32,15);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.FDS:this.setupDefaultWavetable(64,63),this.engine.dispatch(lo.WAVE,0,0,0);break;case e.N163:this.setupDefaultWavetable(32,15);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.X1_010:case e.SOUND_UNIT:this.setupDefaultWavetable(32,255);for(let e=0;e<t;e++)this.engine.dispatch(lo.WAVE,e,0,0);break;case e.AMIGA:case e.SEGAPCM:case e.SEGAPCM_COMPAT:case e.RF5C68:case e.K007232:case e.K053260:case e.GA20:case e.GBA_DMA:case e.GBA_MINMOD:case e.NDS:case e.MSM6295:case e.YMZ280B:case e.QSOUND:case e.MULTIPCM:this.loadTestSample8bit(),this.engine.renderSamples();for(let e=0;e<t;e++)this.engine.setInstrument(e,0),this.engine.setVolume(e,n);break;case e.MSM6258:this.loadTestSampleVOX(),this.engine.renderSamples();for(let e=0;e<t;e++)this.engine.setInstrument(e,0),this.engine.setVolume(e,n);break;case e.ES5506:case e.C140:case e.C219:case e.PCM_DAC:this.loadTestSample16bit(),this.engine.renderSamples();for(let e=0;e<t;e++)this.engine.setInstrument(e,0),this.engine.setVolume(e,n);break;case e.SNES:this.loadTestSampleBRR(),this.engine.renderSamples();for(let e=0;e<t;e++)this.engine.setInstrument(e,0),this.engine.setVolume(e,n)}if(![e.AMIGA,e.SEGAPCM,e.SEGAPCM_COMPAT,e.RF5C68,e.K007232,e.K053260,e.GA20,e.GBA_DMA,e.GBA_MINMOD,e.NDS,e.MSM6295,e.YMZ280B,e.QSOUND,e.MULTIPCM,e.MSM6258,e.ES5506,e.C140,e.C219,e.PCM_DAC,e.SNES].includes(this.platformType))for(let a=0;a<t;a++)this.engine.setInstrument(a,0),this.engine.setVolume(a,n)}setupDefaultGBInstrument(){const e=new Uint8Array([15,0,2,0,0,1,0,0]);this.engine.setGBInstrument(0,e);for(let s=0;s<4;s++)this.engine.setInstrument(s,0),this.engine.setVolume(s,15);const t=32,n=new Uint8Array(136),a=new DataView(n.buffer);a.setInt32(0,t,!0),a.setInt32(4,15,!0);for(let s=0;s<t;s++){const e=s<16?Math.round(s/16*15):Math.round((t-s)/16*15);a.setInt32(8+4*s,e,!0)}this.engine.setWavetable(0,n)}setupDefaultWavetable(e,t){const n=new Uint8Array(8+4*e),a=new DataView(n.buffer);a.setInt32(0,e,!0),a.setInt32(4,t,!0);for(let s=0;s<e;s++){const n=Math.round(s/(e-1)*t);a.setInt32(8+4*s,n,!0)}this.engine.setWavetable(0,n)}buildSampleHeader(e,t,n=8363,a=0,s,r=!0){const o=new DataView(new ArrayBuffer(32));return o.setUint32(0,e,!0),o.setInt32(4,a,!0),o.setInt32(8,s??e,!0),o.setUint8(12,t),o.setUint8(13,0),o.setUint8(14,0),o.setUint8(15,0),o.setUint32(16,n,!0),o.setUint8(22,r?1:0),o}loadTestSample8bit(){const e=new Uint8Array(64),t=this.buildSampleHeader(32,8,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<32;n++)e[32+n]=n<16?127:128;this.engine.setSample(0,e)}loadTestSample16bit(){const e=new Uint8Array(96),t=this.buildSampleHeader(32,16,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));const n=new DataView(e.buffer);for(let a=0;a<32;a++){const e=a<16?32767:-32768;n.setInt16(32+2*a,e,!0)}this.engine.setSample(0,e)}loadTestSampleBRR(){const e=Math.ceil(2),t=new Uint8Array(32+9*e),n=this.buildSampleHeader(32,9,8363);new Uint8Array(t.buffer,0,32).set(new Uint8Array(n.buffer));for(let a=0;a<e;a++){const n=32+9*a,s=a===e-1;t[n]=194|(s?1:0);for(let e=0;e<8;e++){const s=16*a+2*e,r=s<16?7:8,o=s+1<16?7:8;t[n+1+e]=(15&r)<<4|15&o}}this.engine.setSample(0,t)}loadTestSampleVOX(){const e=new Uint8Array(48.5),t=this.buildSampleHeader(32,io,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<16.5;n++){const t=2*n,a=t<16?15:0,s=t+1<16?15:0;e[32+n]=a<<4|s}this.engine.setSample(0,e)}getChannelNames(){const e=ho[this.platformType];if(e)return e;const t=this.engine.channelCount||1;return Array.from({length:t},(e,t)=>`CH${t+1}`)}getNumChannels(){return this.engine.channelCount}onOscData(e){return this.engine.onOscData(e)}getOscData(){return this.engine.getOscData()}triggerAttack(e,t,n=1){if(!this._ready||this._disposed)return;const a="string"==typeof e?b(e).toMidi():e>127?Math.round(12*Math.log2(e/440)+69):e,s=this.currentChannel,r=fo(this.platformType),o=Math.round(n*r);this.engine.setVolume(s,o),this.engine.noteOn(s,a),this.activeNotes.set(a,s)}triggerRelease(e,t){if(this._ready&&!this._disposed)if(void 0!==e){const t="string"==typeof e?b(e).toMidi():e>127?Math.round(12*Math.log2(e/440)+69):e,n=this.activeNotes.get(t);void 0!==n&&(this.engine.noteOff(n),this.activeNotes.delete(t))}else{for(const[,e]of this.activeNotes)this.engine.noteOff(e);this.activeNotes.clear()}}releaseAll(){this.triggerRelease()}setChannel(e){this.currentChannel=e}sendCommand(e,t,n=0,a=0){this._ready&&!this._disposed&&this.engine.dispatch(e,t,n,a)}applyEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyEffect(n??this.currentChannel,e,t)}applyExtendedEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyExtendedEffect(n??this.currentChannel,e,t)}applyPlatformEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyPlatformEffect(n??this.currentChannel,e,t)}resetEffectMemory(){this.engine.resetEffectMemory()}setGBInstrument(e,t){this.engine.setGBInstrument(e,t)}setWavetable(e,t){this.engine.setWavetable(e,t)}renderSamples(){this.engine.renderSamples()}setParam(e,t){switch(e){case"volume":this.engine.setVolume(this.currentChannel,t);break;case"channel":this.currentChannel=t}}dispose(){this._disposed=!0,this.activeNotes.clear();const e=this._nativeGain;if(e){try{e.disconnect()}catch{}this._nativeGain=null}return this.output.dispose(),super.dispose(),this}}class go extends u{name="DrumKitSynth";config;sampleBuffers=new Map;activeVoices=[];outputGain;input;output;onSampleNeeded;constructor(e){super(),this.config=e,this.input=new p(1),this.output=new p(1),this.outputGain=new p(.8),this.outputGain.connect(this.output)}setSampleLoader(e){this.onSampleNeeded=e}async preloadSamples(){if(!this.onSampleNeeded)return;const e=this.config.keymap.map(async e=>{if(!this.sampleBuffers.has(e.id)){const t=await this.onSampleNeeded(e.sampleId,e.sampleUrl);t&&this.sampleBuffers.set(e.id,t)}});await Promise.all(e)}loadSample(e,t){this.sampleBuffers.set(e,t)}findMapping(e){for(const t of this.config.keymap)if(e>=t.noteStart&&e<=t.noteEnd)return t;return null}noteToMidiNumber(e){return"number"==typeof e?e+11:function(e){if("number"==typeof e)return e+11;if(null==e||""===e||"..."===e||"==="===e)return 60;const t=e.match(/^([A-G])([#b])?-?(\d)$/i);if(!t)return 60;const[,n,a,s]=t,r=parseInt(s,10),o=n.toUpperCase(),i=a?o+a:o+"-",l=La.indexOf(i);return-1===l?60:12*(r+1)+l}(e)}triggerAttack(e,t,n=.8){const a=this.noteToMidiNumber(e),s=this.findMapping(a);if(!s)return;const r=this.sampleBuffers.get(s.id);if(!r)return;if(this.activeVoices.length>=this.config.maxVoices){const e=this.activeVoices.shift();e&&this.disposeVoice(e)}if("mono"===this.config.polyphony||this.config.noteCut){this.activeVoices.filter(e=>e.mappingId===s.id).forEach(e=>{this.disposeVoice(e);const t=this.activeVoices.indexOf(e);-1!==t&&this.activeVoices.splice(t,1)})}const o=new R(r),i=new j({url:o,playbackRate:this.calculatePlaybackRate(s,a)}),l=(s.panOffset||0)/100,c=new N(l),d=Math.pow(10,(s.volumeOffset||0)/20),u=new p(n*d);i.connect(c),c.connect(u),u.connect(this.outputGain);const h=t??x();i.start(h);const m=this.calculatePlaybackRate(s,a),f={player:i,panner:c,gain:u,midiNote:a,mappingId:s.id,startTime:h};this.activeVoices.push(f);const y=r.duration/m;setTimeout(()=>{const e=this.activeVoices.indexOf(f);-1!==e&&(this.activeVoices.splice(e,1),this.disposeVoice(f))},1e3*(y+.1))}calculatePlaybackRate(e,t){let n=1;if(e.pitchOffset&&(n*=Math.pow(2,e.pitchOffset/12)),e.fineTune&&(n*=Math.pow(2,e.fineTune/1200)),e.baseNote){const a=t-this.noteToMidiNumber(e.baseNote);n*=Math.pow(2,a/12)}return Math.max(.1,Math.min(4,n))}triggerRelease(e,t){const n=this.noteToMidiNumber(e);this.activeVoices.filter(e=>e.midiNote===n).forEach(e=>{const n=t??x();e.gain.gain.linearRampTo(0,.05,n),setTimeout(()=>{const t=this.activeVoices.indexOf(e);-1!==t&&(this.activeVoices.splice(t,1),this.disposeVoice(e))},100)})}disposeVoice(e){try{e.player.stop(),e.player.disconnect(),e.player.dispose(),e.panner.disconnect(),e.panner.dispose(),e.gain.disconnect(),e.gain.dispose()}catch(t){}}releaseAll(){this.activeVoices.forEach(e=>this.disposeVoice(e)),this.activeVoices=[]}updateConfig(e){this.config={...this.config,...e}}getKeymap(){return[...this.config.keymap]}addMapping(e){this.config.keymap.push(e)}removeMapping(e){const t=this.config.keymap.findIndex(t=>t.id===e);-1!==t&&(this.config.keymap.splice(t,1),this.sampleBuffers.delete(e))}clearKeymap(){this.config.keymap=[],this.sampleBuffers.clear(),this.releaseAll()}dispose(){return this.releaseAll(),this.sampleBuffers.clear(),this.outputGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const vo={type:"sine",frequency:440},bo={enabled:!0,type:"square",rate:2,depth:100},xo={enabled:!0,time:.3,feedback:.4,wet:.3},wo={enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},ko={enabled:!0,decay:1.5,wet:.1};class So{osc;filter;reverb;delay;distortion;gate;output;signal;lfo;constructor(e){const t={oscillator:{...vo,...e?.oscillator},lfo:{...bo,...e?.lfo},delay:{...xo,...e?.delay},filter:{...wo,...e?.filter},reverb:{...ko,...e?.reverb}};this.output=new L(0),this.reverb=new P({decay:t.reverb.decay,wet:t.reverb.enabled?t.reverb.wet:0}),this.delay=new g({delayTime:t.delay.time,feedback:t.delay.feedback,wet:t.delay.enabled?t.delay.wet:0}),this.filter=new y({frequency:t.filter.frequency,type:t.filter.type,rolloff:t.filter.rolloff,Q:1}),this.distortion=new T(.1),this.gate=new p(0),this.osc=new M({type:t.oscillator.type}),this.signal=new B({units:"frequency",value:t.oscillator.frequency}),this.lfo=new k({type:t.lfo.type,frequency:t.lfo.rate,amplitude:1,min:-t.lfo.depth,max:t.lfo.depth}),this.osc.frequency.value=0,this.signal.connect(this.osc.frequency),t.lfo.enabled&&(this.lfo.connect(this.osc.frequency),this.lfo.start()),this.osc.connect(this.gate),this.gate.connect(this.filter),this.filter.connect(this.distortion),this.distortion.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this.output),this.osc.start()}applyConfig(e){this.osc.type=e.oscillator.type,this.setFrequency(e.oscillator.frequency),this.lfo.type=e.lfo.type,this.setLFORate(e.lfo.rate),this.setLFODepth(e.lfo.depth),e.lfo.enabled?"started"!==this.lfo.state&&(this.lfo.start(),this.lfo.connect(this.osc.frequency)):(this.lfo.stop(),this.lfo.disconnect()),this.setDelayTime(e.delay.time),this.setDelayFeedback(e.delay.feedback),this.setDelayMix(e.delay.enabled?e.delay.wet:0),this.setFilterFreq(e.filter.frequency),this.filter.type=e.filter.type,this.filter.rolloff=e.filter.rolloff,this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n){const a=t||x();if(e){const t=b(e).toFrequency();this.signal.setValueAtTime(t,a)}this.gate.gain.cancelScheduledValues(a),this.gate.gain.setValueAtTime(1,a)}triggerRelease(e){const t=e||x();this.gate.gain.cancelScheduledValues(t),this.gate.gain.setValueAtTime(0,t)}setOscType(e){this.osc.type=e}setFrequency(e){this.signal.rampTo(e,.1)}setLFOType(e){this.lfo.type=e}setLFORate(e){this.lfo.frequency.rampTo(e,.1)}setLFODepth(e){this.lfo.min=-e,this.lfo.max=e}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.delay.delayTime.rampTo(t,.1)}setDelayFeedback(e){this.delay.feedback.rampTo(e,.1)}setDelayMix(e){this.delay.wet.rampTo(e,.1)}setFilterFreq(e){this.filter.frequency.rampTo(e,.1)}connect(e){this.output.connect(e)}disconnect(){this.output.disconnect()}dispose(){this.osc.dispose(),this.gate.dispose(),this.filter.dispose(),this.distortion.dispose(),this.reverb.dispose(),this.delay.dispose(),this.output.dispose(),this.signal.dispose(),this.lfo.dispose()}get volume(){return this.output.volume}}class Mo{synth;filter;noise;noiseGain;reverb;delay;output;config;constructor(e){this.config=e,this.output=new L(0),this.reverb=new P({decay:e.reverb.decay,wet:e.reverb.enabled?e.reverb.wet:0}),this.delay=new g({delayTime:e.delay.time,feedback:e.delay.feedback,wet:e.delay.enabled?e.delay.wet:0}),this.filter=new y({frequency:e.filter.cutoff,type:e.filter.type,Q:e.filter.resonance/10}),this.synth=new V({harmonicity:e.fm.ratio,modulationIndex:e.fm.amount,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1},modulationEnvelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1}}),this.noise=new z({type:e.noise.type,volume:-1/0}),this.noiseGain=new p(e.noise.amount/100),this.noise.connect(this.noiseGain),this.synth.connect(this.filter),this.noiseGain.connect(this.filter),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this.output),this.noise.start()}applyConfig(e){this.config=e,this.synth.harmonicity.value=e.fm.ratio,this.synth.modulationIndex.value=e.fm.amount,this.synth.envelope.decay=e.laser.sweepTime/1e3,this.synth.modulationEnvelope.decay=e.laser.sweepTime/1e3,this.noise.type=e.noise.type,this.noiseGain.gain.rampTo(e.noise.amount/100,.1),this.filter.type=e.filter.type,this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.delay.delayTime.rampTo(e.delay.time,.1),this.delay.feedback.rampTo(e.delay.feedback,.1),this.delay.wet.rampTo(e.delay.enabled?e.delay.wet:0,.1),this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n=1){const a=t||x(),s=this.config.laser.sweepTime/1e3,r=e?b(e).toFrequency():this.config.laser.startFreq,o=this.config.laser.endFreq;this.synth.triggerAttack(r,a,n),this.synth.frequency.cancelScheduledValues(a+.001),"exponential"===this.config.laser.sweepCurve?this.synth.frequency.exponentialRampToValueAtTime(o,a+s):this.synth.frequency.linearRampToValueAtTime(o,a+s),this.synth.triggerRelease(a+s)}triggerRelease(e){const t=null==e?x():e;this.synth.triggerRelease(t)}connect(e){this.output.connect(e)}disconnect(){this.output.disconnect()}dispose(){this.noise.stop(),this.synth.dispose(),this.filter.dispose(),this.noise.dispose(),this.noiseGain.dispose(),this.reverb.dispose(),this.delay.dispose(),this.output.dispose()}get volume(){return this.output.volume}}class No{osc1;osc2;noise;osc1Gain;osc2Gain;noiseGain;filter;ampEnv;output;filterFreqEnv;pitchEnv;lfo;lfoGain;config;constructor(e){this.config=e,this.osc1=new M({type:"square",frequency:e.oscillator.tune}),this.osc2=new M({type:"square",frequency:e.oscillator.tune}),this.noise=new z({type:e.noise.type}),this.osc1Gain=new p(1),this.osc2Gain=new p(e.oscillator2.enabled?e.oscillator2.mix:0),this.noiseGain=new p(e.noise.enabled?e.noise.mix:0),this.filter=new y({frequency:e.filter.cutoff,type:"lowpass",rolloff:-24,Q:e.filter.resonance/10}),this.ampEnv=new U({attack:.005,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain,release:.1}),this.output=new L(0),this.filterFreqEnv=new S({attack:.005,decay:e.filter.decay/1e3,sustain:0,release:.1}),this.pitchEnv=new S({attack:.005,decay:e.sweep.time/1e3,sustain:0,release:.1}),this.lfo=new k({frequency:e.lfo.rate,amplitude:e.lfo.depth/100}),this.lfoGain=new p(0),this.lfo.connect(this.lfoGain),this.lfo.start(),this.osc1.connect(this.osc1Gain),this.osc2.connect(this.osc2Gain),this.noise.connect(this.noiseGain);const t=new p(1);this.osc1Gain.connect(t),this.osc2Gain.connect(t),this.noiseGain.connect(t),t.connect(this.filter),this.filter.connect(this.ampEnv),this.ampEnv.connect(this.output),this.applyConfig(e),this.osc1.start(),this.osc2.start(),this.noise.start()}applyConfig(e){this.config=e,this.osc1.frequency.rampTo(e.oscillator.tune,.1),this.osc2.frequency.rampTo(e.oscillator.tune*Math.pow(2,e.oscillator2.detune/12),.1),this.osc1Gain.gain.rampTo(1,.1),this.osc2Gain.gain.rampTo(e.oscillator2.enabled?e.oscillator2.mix:0,.1),this.noiseGain.gain.rampTo(e.noise.enabled?e.noise.mix:0,.1),this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.ampEnv.decay=e.envelope.decay/1e3,this.ampEnv.sustain=e.envelope.sustain,this.filterFreqEnv.decay=e.filter.decay/1e3,this.pitchEnv.decay=e.sweep.time/1e3,this.lfo.frequency.rampTo(e.lfo.rate,.1),this.lfoGain.gain.rampTo(e.lfo.enabled?e.lfo.depth/100:0,.1)}triggerAttack(e,t,n){const a=t||x();if(e){const t=b(e).toFrequency();this.osc1.frequency.setValueAtTime(t,a),this.osc2.frequency.setValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),a)}if(this.ampEnv.triggerAttack(a,n),this.config.filter.envMod>0){const e=Math.min(2e4,this.config.filter.cutoff+100*this.config.filter.envMod);this.filter.frequency.cancelScheduledValues(a),this.filter.frequency.setValueAtTime(this.config.filter.cutoff,a),this.filter.frequency.exponentialRampToValueAtTime(e,a+.005),this.filter.frequency.exponentialRampToValueAtTime(this.config.filter.cutoff,a+this.config.filter.decay/1e3)}if(this.config.sweep.enabled){const t=e?b(e).toFrequency():this.config.oscillator.tune,n=t*Math.pow(2,this.config.sweep.amount/12);this.osc1.frequency.cancelScheduledValues(a),this.osc2.frequency.cancelScheduledValues(a),this.osc1.frequency.setValueAtTime(n,a),this.osc1.frequency.exponentialRampToValueAtTime(t,a+this.config.sweep.time/1e3),this.osc2.frequency.setValueAtTime(n*Math.pow(2,this.config.oscillator2.detune/12),a),this.osc2.frequency.exponentialRampToValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),a+this.config.sweep.time/1e3)}}triggerRelease(e){const t=e||x();this.ampEnv.triggerRelease(t)}updateParameter(e,t){this.applyConfig(this.config)}connect(e){this.output.connect(e)}disconnect(){this.output.disconnect()}dispose(){this.osc1.dispose(),this.osc2.dispose(),this.noise.dispose(),this.osc1Gain.dispose(),this.osc2Gain.dispose(),this.noiseGain.dispose(),this.filter.dispose(),this.ampEnv.dispose(),this.filterFreqEnv.dispose(),this.pitchEnv.dispose(),this.lfo.dispose(),this.lfoGain.dispose(),this.output.dispose()}get volume(){return this.output.volume}}let Co=(e,t)=>0!==(e&t),Eo=e=>{let t=new Uint8Array(e.length);return e.split("").forEach((e,n)=>{t[n]=e.charCodeAt(0)}),t},Po=e=>{let t=new Uint8Array(4);return t[0]=e,t[1]=e>>8,t[2]=e>>16,t[3]=e>>24,t},To=e=>{let t=new Uint8Array(2);return t[0]=e,t[1]=e>>8,t},Ao=null,Io=e=>{if(null===Ao&&(Ao=new AudioContext),!Ao)throw new Error("No player available!");return((e,t)=>{let n,a=new Promise((a,s)=>{let r=e.createBufferSource(),o=e.createBuffer(1,t.length,22050),i=o.getChannelData(0);for(let e=0;e<t.length;e++)i[e]=t[e];r.buffer=o,r.connect(e.destination),r.onended=()=>{a(!0)},n=e=>{r.disconnect(),s(e)},r.start(0)});return a.abort=n,a})(Ao,e)},_o=e=>{let t=new Uint8Array(44+e.length),n=0,a=e=>{t.set(e,n),n+=e.length};return a(Eo("RIFF")),a(Po(e.length+12+16+8-8)),a(Eo("WAVE")),a(Eo("fmt ")),a(Po(16)),a(To(1)),a(To(1)),a(Po(22050)),a(Po(22050)),a(To(1)),a(To(8)),a(Eo("data")),a(Po(e.length)),a(e),t},Oo={" ":0,"!":2,'"':2,"#":2,$:2,"%":2,"&":2,"'":130,"(":0,")":0,"*":2,"+":2,",":2,"-":2,".":2,"/":2,0:3,1:3,2:3,3:3,4:3,5:3,6:3,7:3,8:3,9:3,":":2,";":2,"<":2,"=":2,">":2,"?":2,"@":2,A:192,B:168,C:176,D:172,E:192,F:160,G:184,H:160,I:192,J:188,K:160,L:172,M:168,N:172,O:192,P:160,Q:160,R:172,S:180,T:164,U:192,V:168,W:168,X:176,Y:192,Z:188,"[":0,"\\":0,"]":0,"^":2,_:0,"`":32},Fo='(A)=|(!)=.|(") =-AH5NKWOWT-|(")=KWOW4T-|(#)= NAH4MBER|($)= DAA4LER|(%)= PERSEH4NT|(&)= AEND|(\')=|(*)= AE4STERIHSK|(+)= PLAH4S|(,)=,| (-) =-|(-)=|(.)= POYNT|(/)= SLAE4SH|(0)= ZIY4ROW| (1ST)=FER4ST| (10TH)=TEH4NTH|(1)= WAH4N| (2ND)=SEH4KUND|(2)= TUW4| (3RD)=THER4D|(3)= THRIY4|(4)= FOH4R| (5TH)=FIH4FTH|(5)= FAY4V| (64) =SIH4KSTIY FOHR|(6)= SIH4KS|(7)= SEH4VUN| (8TH)=EY4TH|(8)= EY4T|(9)= NAY4N|(:)=.|(;)=.|(<)= LEH4S DHAEN|(=)= IY4KWULZ|(>)= GREY4TER DHAEN|(?)=?|(@)= AE6T|(^)= KAE4RIXT',Do=128,Ro=(e,t)=>0!==(Oo[e]&t),jo=(e,t,n)=>Ro(e[t],n),Lo=(e,t)=>-1!==t.indexOf(e),Bo=e=>{let t=e.split("=");const n=t.pop(),a=t.join("=").split("("),s=a.pop().split(")"),r=a[0],o=s[0],i=s[1];let l=["T","C","S"],c=["E","I","Y"],d=(e,t)=>!!e.startsWith(o,t)&&(!!((e,t)=>{for(let n=r.length-1;n>-1;n--){let a=r[n];if(Ro(a,Do)){if(e[--t]!==a)return!1}else if(!{" ":()=>!jo(e,--t,Do),"#":()=>jo(e,--t,64),".":()=>jo(e,--t,8),"&":()=>jo(e,--t,16)||Lo(e.substr(--t,2),["CH","SH"]),"@":()=>{if(jo(e,--t,4))return!0;let n=e[t];if("H"!==n)return!1;if(!Lo(n,l))return!1;throw new Error("Is always false but happened? "+n)},"^":()=>jo(e,--t,32),"+":()=>Lo(e[--t],c),":":()=>{for(;t>=0&&jo(e,t-1,32);)t--;return!0}}[a]())return!1}return!0})(e,t)&&((e,t)=>{for(let n=0;n<i.length;n++){let a=i[n];if(Ro(a,Do)){if(e[++t]!==a)return!1}else if(!{" ":()=>!jo(e,++t,Do),"#":()=>jo(e,++t,64),".":()=>jo(e,++t,8),"&":()=>jo(e,++t,16)||Lo(e.substr(++t-2,2),["HC","HS"]),"@":()=>{if(jo(e,++t,4))return!0;let n=e[t];if("H"!==n)return!1;if(!Lo(n,l))return!1;throw new Error("This should not be possible ",n)},"^":()=>jo(e,++t,32),"+":()=>Lo(e[++t],c),":":()=>{for(;jo(e,t+1,32);)t++;return!0},"%":()=>"E"!==e[t+1]?"ING"===e.substr(t+1,3)&&(t+=3,!0):jo(e,t+2,Do)?Lo(e[t+2],["R","S","D"])?(t+=2,!0):"L"!==e[t+2]?"FUL"===e.substr(t+2,3)&&(t+=4,!0):"Y"===e[t+3]&&(t+=3,!0):(t++,!0)}[a]())return!1}return!0})(e,t+(o.length-1))),u=(e,t,a)=>{if(d(e,t))return a(n,o.length),!0};return u.c=o[0],u},Vo={};" (A.)=EH4Y. |(A) =AH| (ARE) =AAR| (AR)O=AXR|(AR)#=EH4R| ^(AS)#=EY4S|(A)WA=AX|(AW)=AO5| :(ANY)=EH4NIY|(A)^+#=EY5|#:(ALLY)=ULIY| (AL)#=UL|(AGAIN)=AXGEH4N|#:(AG)E=IHJ|(A)^%=EY|(A)^+:#=AE| :(A)^+ =EY4| (ARR)=AXR|(ARR)=AE4R| ^(AR) =AA5R|(AR)=AA5R|(AIR)=EH4R|(AI)=EY4|(AY)=EY5|(AU)=AO4|#:(AL) =UL|#:(ALS) =ULZ|(ALK)=AO4K|(AL)^=AOL| :(ABLE)=EY4BUL|(ABLE)=AXBUL|(A)VO=EY4|(ANG)+=EY4NJ|(ATARI)=AHTAA4RIY|(A)TOM=AE|(A)TTI=AE| (AT) =AET| (A)T=AH|(A)=AE| (B) =BIY4| (BE)^#=BIH|(BEING)=BIY4IHNX| (BOTH) =BOW4TH| (BUS)#=BIH4Z|(BREAK)=BREY5K|(BUIL)=BIH4L|(B)=B| (C) =SIY4| (CH)^=K|^E(CH)=K|(CHA)R#=KEH5|(CH)=CH| S(CI)#=SAY4|(CI)A=SH|(CI)O=SH|(CI)EN=SH|(CITY)=SIHTIY|(C)+=S|(CK)=K|(COMMODORE)=KAA4MAHDOHR|(COM)=KAHM|(CUIT)=KIHT|(CREA)=KRIYEY|(C)=K| (D) =DIY4| (DR.) =DAA4KTER|#:(DED) =DIHD|.E(D) =D|#:^E(D) =T| (DE)^#=DIH| (DO) =DUW| (DOES)=DAHZ|(DONE) =DAH5N|(DOING)=DUW4IHNX| (DOW)=DAW|#(DU)A=JUW|#(DU)^#=JAX|(D)=D| (E) =IYIY4|#:(E) =|':^(E) =| :(E) =IY|#(ED) =D|#:(E)D =|(EV)ER=EH4V|(E)^%=IY4|(ERI)#=IY4RIY|(ERI)=EH4RIH|#:(ER)#=ER|(ERROR)=EH4ROHR|(ERASE)=IHREY5S|(ER)#=EHR|(ER)=ER| (EVEN)=IYVEHN|#:(E)W=|@(EW)=UW|(EW)=YUW|(E)O=IY|#:&(ES) =IHZ|#:(E)S =|#:(ELY) =LIY|#:(EMENT)=MEHNT|(EFUL)=FUHL|(EE)=IY4|(EARN)=ER5N| (EAR)^=ER5|(EAD)=EHD|#:(EA) =IYAX|(EA)SU=EH5|(EA)=IY5|(EIGH)=EY4|(EI)=IY4| (EYE)=AY4|(EY)=IY|(EU)=YUW5|(EQUAL)=IY4KWUL|(E)=EH| (F) =EH4F|(FUL)=FUHL|(FRIEND)=FREH5ND|(FATHER)=FAA4DHER|(F)F=|(F)=F| (G) =JIY4|(GIV)=GIH5V| (G)I^=G|(GE)T=GEH5|SU(GGES)=GJEH4S|(GG)=G| B#(G)=G|(G)+=J|(GREAT)=GREY4T|(GON)E=GAO5N|#(GH)=| (GN)=N|(G)=G| (H) =EY4CH| (HAV)=/HAE6V| (HERE)=/HIYR| (HOUR)=AW5ER|(HOW)=/HAW|(H)#=/H|(H)=| (IN)=IHN| (I) =AY4|(I) =AY|(IN)D=AY5N|SEM(I)=IY| ANT(I)=AY|(IER)=IYER|#:R(IED) =IYD|(IED) =AY5D|(IEN)=IYEHN|(IE)T=AY4EH|(I')=AY5| :(I)^%=AY5| :(IE) =AY4|(I)%=IY|(IE)=IY4| (IDEA)=AYDIY5AH|(I)^+:#=IH|(IR)#=AYR|(IZ)%=AYZ|(IS)%=AYZ|I^(I)^#=IH|+^(I)^+=AY|#:^(I)^+=IH|(I)^+=AY|(IR)=ER|(IGH)=AY4|(ILD)=AY5LD| (IGN)=IHGN|(IGN) =AY4N|(IGN)^=AY4N|(IGN)%=AY4N|(ICRO)=AY4KROH|(IQUE)=IY4K|(I)=IH| (J) =JEY4|(J)=J| (K) =KEY4| (K)N=|(K)=K| (L) =EH4L|(LO)C#=LOW|L(L)=|#:^(L)%=UL|(LEAD)=LIYD| (LAUGH)=LAE4F|(L)=L| (M) =EH4M| (MR.) =MIH4STER| (MS.)=MIH5Z| (MRS.) =MIH4SIXZ|(MOV)=MUW4V|(MACHIN)=MAHSHIY5N|M(M)=|(M)=M| (N) =EH4N|E(NG)+=NJ|(NG)R=NXG|(NG)#=NXG|(NGL)%=NXGUL|(NG)=NX|(NK)=NXK| (NOW) =NAW4|N(N)=|(NON)E=NAH4N|(N)=N| (O) =OH4W|(OF) =AHV| (OH) =OW5|(OROUGH)=ER4OW|#:(OR) =ER|#:(ORS) =ERZ|(OR)=AOR| (ONE)=WAHN|#(ONE) =WAHN|(OW)=OW| (OVER)=OW5VER|PR(O)V=UW4|(OV)=AH4V|(O)^%=OW5|(O)^EN=OW|(O)^I#=OW5|(OL)D=OW4L|(OUGHT)=AO5T|(OUGH)=AH5F| (OU)=AW|H(OU)S#=AW4|(OUS)=AXS|(OUR)=OHR|(OULD)=UH5D|(OU)^L=AH5|(OUP)=UW5P|(OU)=AW|(OY)=OY|(OING)=OW4IHNX|(OI)=OY5|(OOR)=OH5R|(OOK)=UH5K|F(OOD)=UW5D|L(OOD)=AH5D|M(OOD)=UW5D|(OOD)=UH5D|F(OOT)=UH5T|(OO)=UW5|(O')=OH|(O)E=OW|(O) =OW|(OA)=OW4| (ONLY)=OW4NLIY| (ONCE)=WAH4NS|(ON'T)=OW4NT|C(O)N=AA|(O)NG=AO| :^(O)N=AH|I(ON)=UN|#:(ON)=UN|#^(ON)=UN|(O)ST=OW|(OF)^=AO4F|(OTHER)=AH5DHER|R(O)B=RAA|^R(O):#=OW5|(OSS) =AO5S|#:^(OM)=AHM|(O)=AA| (P) =PIY4|(PH)=F|(PEOPL)=PIY5PUL|(POW)=PAW4|(PUT) =PUHT|(P)P=|(P)S=|(P)N=|(PROF.)=PROHFEH4SER|(P)=P| (Q) =KYUW4|(QUAR)=KWOH5R|(QU)=KW|(Q)=K| (R) =AA5R| (RE)^#=RIY|(R)R=|(R)=R| (S) =EH4S|(SH)=SH|#(SION)=ZHUN|(SOME)=SAHM|#(SUR)#=ZHER|(SUR)#=SHER|#(SU)#=ZHUW|#(SSU)#=SHUW|#(SED)=ZD|#(S)#=Z|(SAID)=SEHD|^(SION)=SHUN|(S)S=|.(S) =Z|#:.E(S) =Z|#:^#(S) =S|U(S) =S| :#(S) =Z|##(S) =Z| (SCH)=SK|(S)C+=|#(SM)=ZUM|#(SN)'=ZUM|(STLE)=SUL|(S)=S| (T) =TIY4| (THE) #=DHIY| (THE) =DHAX|(TO) =TUX| (THAT)=DHAET| (THIS) =DHIHS| (THEY)=DHEY| (THERE)=DHEHR|(THER)=DHER|(THEIR)=DHEHR| (THAN) =DHAEN| (THEM) =DHAEN|(THESE) =DHIYZ| (THEN)=DHEHN|(THROUGH)=THRUW4|(THOSE)=DHOHZ|(THOUGH) =DHOW|(TODAY)=TUXDEY|(TOMO)RROW=TUMAA5|(TO)TAL=TOW5| (THUS)=DHAH4S|(TH)=TH|#:(TED)=TIXD|S(TI)#N=CH|(TI)O=SH|(TI)A=SH|(TIEN)=SHUN|(TUR)#=CHER|(TU)A=CHUW| (TWO)=TUW|&(T)EN =|(T)=T| (U) =YUW4| (UN)I=YUWN| (UN)=AHN| (UPON)=AXPAON|@(UR)#=UH4R|(UR)#=YUH4R|(UR)=ER|(U)^ =AH|(U)^^=AH5|(UY)=AY5| G(U)#=|G(U)%=|G(U)#=W|#N(U)=YUW|@(U)=UW|(U)=YUW| (V) =VIY4|(VIEW)=VYUW5|(V)=V| (W) =DAH4BULYUW| (WERE)=WER|(WA)SH=WAA|(WA)ST=WEY|(WA)S=WAH|(WA)T=WAA|(WHERE)=WHEHR|(WHAT)=WHAHT|(WHOL)=/HOWL|(WHO)=/HUW|(WH)=WH|(WAR)#=WEHR|(WAR)=WAOR|(WOR)^=WER|(WR)=R|(WOM)A=WUHM|(WOM)E=WIHM|(WEA)R=WEH|(WANT)=WAA5NT|ANS(WER)=ER|(W)=W| (X) =EH4KR| (X)=Z|(X)=KS| (Y) =WAY4|(YOUNG)=YAHNX| (YOUR)=YOHR| (YOU)=YUW| (YES)=YEHS| (Y)=Y|F(Y)=AY|PS(YCH)=AYK|#:^(Y)=IY|#:^(Y)I=IY| :(Y) =AY| :(Y)#=AY| :(Y)^+:#=IH| :(Y)^#=AY|(Y)=IH| (Z) =ZIY4|(Z)=Z".split("|").map(e=>{let t=Bo(e),n=t.c;Vo[n]=Vo[n]||[],Vo[n].push(t)});let zo=Fo.split("|").map(Bo),Uo="*12345678".split(""),Go=" *.*?*,*-*IYIHEHAEAAAHAOUHAXIXERUXOHRXLXWXYXWHR*L*W*Y*M*N*NXDXQ*S*SHF*TH/H/XZ*ZHV*DHCH**J*******EYAYOYAWOWUWB*****D*****G*****GX****P*****T*****K*****KX****ULUMUN".match(/.{1,2}/g),Ko=[32768,49408,49408,49408,49408,164,164,164,164,164,164,132,132,164,164,132,132,132,132,132,132,132,68,4164,4164,4164,4164,2124,3148,2124,1096,16460,9280,8256,8256,9280,64,64,9284,8260,8260,9284,8264,8256,76,8260,0,0,180,180,180,148,148,148,78,78,78,1102,1102,1102,78,78,78,78,78,78,75,75,75,1099,1099,1099,75,75,75,75,75,75,128,193,193],Ho=[0,4626,4626,4626,2056,2824,2312,2824,3592,3851,2822,4108,3082,1541,1541,3595,3082,3594,3082,2825,2056,2055,2825,2567,2310,2056,2054,2055,2055,2055,770,1285,514,514,514,514,514,514,1542,1542,2055,1542,1542,514,2312,1027,513,286,3597,3852,3852,3852,3598,3593,2054,513,514,1797,513,257,1798,513,514,1798,513,514,2056,514,514,1540,514,514,1798,513,1028,1798,257,1028,1479,1535],Wo=(e,t)=>{let n=Go.findIndex(n=>n===e+t&&"*"!==n[1]);return-1!==n&&n},$o=e=>{let t=Go.findIndex(t=>t===e+"*");return-1!==t&&t},qo=(e,t)=>Co(Ko[e],t),Yo=128,Xo=e=>{if(!e)return!1;let t=e=>{if(e<0||e>l.length)throw new Error("Out of bounds: "+e);return e===l.length?null:l[e]},n=(e,t,n,r)=>{for(let c=l.length-1;c>=e;c--)l[c+1]=l[c],i[c+1]=s(c),o[c+1]=a(c);l[e]=t,i[e]=0|r,o[e]=n},a=e=>0|o[e],s=e=>0|i[e],r=(e,t)=>{if(128&t)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");if(e<0||e>l.length)throw new Error("Out of bounds: "+e);i[e]=t},o=[],i=[],l=[],c=0;return((e,t,n)=>{for(let a=0;a<e.length;a++){e.toLowerCase();let s,r=e[a],o=e[a+1]||"";if(!1===(s=Wo(r,o)))if(!1===(s=$o(r))){for(s=Uo.length;r!==Uo[s]&&s>0;)--s;if(0===s)throw Error(`Could not parse char ${r}`);n(s)}else t(s);else a++,t(s)}})(e,e=>{o[c]=0,i[c]=0,l[c++]=e},e=>{if(128&e)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");o[c-1]=e}),Qo(l,i,o),((e,t,n,a)=>{let s,r=(s,r)=>{switch(s){case 53:qo(n(r-1),1024)&&t(r,16);break;case 42:e(r+1,43,a(r));break;case 44:e(r+1,45,a(r))}},o=(n,s)=>{t(n,13),e(n+1,s,a(n))},i=-1;for(;null!==(s=n(++i));){if(0===s)continue;if(qo(s,16)){e(i+1,qo(s,32)?21:20,a(i)),r(s,i);continue}if(78===s){o(i,24);continue}if(79===s){o(i,27);continue}if(80===s){o(i,28);continue}if(qo(s,Yo)&&a(i)){0===n(i+1)&&(s=n(i+2),null!==s&&qo(s,Yo)&&a(i+2)&&e(i+2,31,0));continue}let l=0===i?null:n(i-1);if(23!==s)if(24===s&&qo(l,Yo))t(i,19);else if(60!==l||32!==s){if(60===s){let e=n(i+1);qo(e,32)||null===e||t(i,63);continue}if(72===s){let e=n(i+1);qo(e,32)&&null!==e||(t(i,75),s=75)}qo(s,1)&&32===l?t(i,s-12):qo(s,1)||r(s,i),69!==s&&57!==s||i>0&&qo(n(i-1),Yo)&&(s=n(i+1),0===s&&(s=n(i+2)),qo(s,Yo)&&!a(i+1)&&t(i,30))}else t(i,38);else switch(l){case 69:t(i-1,42);break;case 57:t(i-1,44);break;default:qo(l,Yo)&&t(i,18)}}})(n,(e,t)=>{l[e]=t},t,a),((e,t,n)=>{let a,s=0;for(;null!==(a=e(s));){if(qo(a,64)&&(a=e(s+1),null!==a&&qo(a,Yo))){let e=t(s+1);0!==e&&e<128&&n(s,e+1)}++s}})(t,a,(e,t)=>{o[e]=t}),((e,t,n)=>{let a,s=0;for(;null!==(a=e(s));){let e=t(s);n(s,0===e||e>127?255&Ho[a]:Ho[a]>>8),s++}})(t,a,r),((e,t,n)=>{for(let r=0;null!==e(r);r++){if(!qo(e(r),256))continue;let a=r;for(;--r>1&&!qo(e(r),Yo););if(0===r)break;for(;r<a;r++)if(!qo(e(r),8192)||qo(e(r),4)){let e=n(r);t(r,(e>>1)+e+1)}}let a,s=-1;for(;null!==(a=e(++s));){let r=s;if(qo(a,Yo)){if(a=e(++r),!qo(a,64)){18!==a&&19!==a||!qo(e(++r),64)||t(s,n(s)-1);continue}let o=null===a?65:Ko[a];if(!Co(o,4)){if(Co(o,1)){let e=n(s);t(s,e-(e>>3))}continue}let i=n(s);t(s,(i>>2)+i+1);continue}if(qo(a,2048))a=e(++r),null!==a&&qo(a,2)&&(t(r,6),t(r-1,5));else if(qo(a,2)){for(;0===(a=e(++r)););null!==a&&qo(a,2)&&(t(r,1+(n(r)>>1)),t(s,1+(n(s)>>1)))}else r>0&&qo(a,4096)&&qo(e(r-1),2)&&t(r,n(r)-2)}})(t,r,s),((e,t,n)=>{let a,s=-1;for(;null!==(a=e(++s));)if(qo(a,2)){if(qo(a,1)){let t,n=s;do{t=e(++n)}while(0===t);if(null!==t&&(qo(t,8)||36===t||37===t))continue}t(s+1,a+1,n(s),255&Ho[a+1]),t(s+2,a+2,n(s),255&Ho[a+2]),s+=2}})(t,n,a),Qo(l,i,o),l.map((e,t)=>e?[e,0|i[t],0|o[t]]:null).filter(e=>e)},Qo=(e,t,n)=>{for(let a=0;a<e.length;a++){}},Zo=[24,26,23,23,23],Jo=[0,224,230,236,243,249,0,6,12,6],ei=[0,31,31,31,31,2,2,2,2,2,2,2,2,2,5,5,2,10,2,8,5,5,11,10,9,8,8,160,8,8,23,31,18,18,18,18,30,30,20,20,20,20,23,23,26,26,29,29,2,2,2,2,2,2,26,29,27,26,29,27,26,29,27,26,29,27,23,29,23,23,29,23,23,29,23,23,29,23,23,23],ti=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,4,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,0,1,0,1,0,5,5,5,5,5,4,4,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,1,3,0,2,3,0,2,160,160],ni=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3,3,3,3,1,2,3,2,1,3,3,3,3,1,1,3,3,3,2,2,3,2,3,0,0,5,5,5,5,4,4,2,0,2,2,0,3,2,0,4,2,0,3,2,0,2,2,0,2,3,0,3,3,0,3,176,160],ai=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,241,226,211,187,124,149,1,2,3,3,0,114,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,25,0,0,0,0,0,0,0,0,0],si=[0,5980947,5980947,5980947,5980947,7230474,6113550,5980947,5783320,5842971,5712919,5775125,5383440,5844244,6113550,4075794,5383182,5774866,4076306,7218448,5250317,6112527,5904395,3944978,7216654,5904395,7230217,5320198,7943686,6641158,7943686,5980945,6506758,6967046,5315078,7946758,6113550,5383440,6107913,6767114,4990984,6106890,6639366,6639366,7946758,6639365,7958022,0,5916691,5777179,5775125,5778203,5774866,5382669,5315078,5315078,5315078,7946758,7946758,7946758,7368198,7237126,7237126,6181894,6181894,6181894,5315078,5315078,5315078,7946758,7946758,7946758,6647046,6641162,7367946,6181894,6181894,6181894,556844,98067],ri=[0,0,0,0,0,526861,461581,527630,527887,68879,68623,3087,68367,2316,461581,330508,68623,3087,396301,67597,2061,461838,2061,330252,67597,2061,526861,780,2313,198153,0,0,0,0,0,0,0,0,779,66827,779,1035,0,0,1,66827,920064,66050,593422,68879,3087,68879,3087,2061,2,260,0,2,260,0,1,260,0,1,260,0,0,0,0,0,0,0,0,461324,0,0,330240,0,1245199,1048591],oi=[56,132,107,25,198,99,24,134,115,152,198,177,28,202,49,140,199,49,136,194,48,152,70,49,24,198,53,12,202,49,12,198,33,16,36,105,18,194,49,20,196,113,8,74,34,73,171,106,168,172,73,81,50,213,82,136,147,108,148,34,21,84,210,37,150,212,80,165,70,33,8,133,107,24,196,99,16,206,107,24,140,113,25,140,99,53,12,198,51,153,204,108,181,78,162,153,70,33,40,130,149,46,227,48,156,197,48,156,162,177,156,103,49,136,102,89,44,83,24,132,103,80,202,227,10,172,171,48,172,98,48,140,99,16,148,98,177,140,130,40,150,51,152,214,181,76,98,41,165,74,181,156,198,49,20,214,56,156,75,180,134,101,24,174,103,28,166,99,25,150,35,25,132,19,8,166,82,172,202,34,137,110,171,25,140,98,52,196,98,25,134,99,24,196,35,88,214,163,80,66,84,74,173,74,37,17,107,100,137,74,99,57,138,35,49,42,234,162,169,68,197,18,205,66,52,140,98,24,140,99,17,72,102,49,157,68,51,29,70,49,156,198,177,12,205,50,136,196,115,24,134,115,8,214,99,88,7,129,224,240,60,7,135,144,60,124,15,199,192,192,240,124,30,7,128,128,0,28,120,112,241,199,31,192,12,254,28,31,31,14,10,122,192,113,242,131,143,3,15,15,12,0,121,248,97,224,67,15,131,231,24,249,193,19,218,233,99,143,15,131,131,135,195,31,60,112,240,225,225,227,135,184,113,14,32,227,141,72,120,28,147,135,48,225,193,193,228,120,33,131,131,195,135,6,57,229,195,135,7,14,28,28,112,244,113,156,96,54,50,195,30,60,243,143,14,60,112,227,199,143,15,15,14,60,120,240,227,135,6,240,227,7,193,153,135,15,24,120,112,112,252,243,16,177,140,140,49,124,112,225,134,60,100,108,176,225,227,15,35,143,15,30,62,56,60,56,123,143,7,14,60,244,23,30,60,120,242,158,114,73,227,37,54,56,88,57,226,222,60,120,120,225,199,97,225,225,176,240,240,195,199,14,56,192,240,206,115,115,24,52,176,225,199,142,28,60,248,56,240,225,193,139,134,143,28,120,112,240,120,172,177,143,57,49,219,56,97,195,14,14,56,120,115,23,30,57,30,56,100,225,241,193,78,15,64,162,2,197,143,129,161,252,18,8,100,224,60,34,224,69,7,142,12,50,144,240,31,32,73,224,248,12,96,240,23,26,65,170,164,208,141,18,130,30,30,3,248,62,3,12,115,128,112,68,38,3,36,225,62,4,78,4,28,193,9,204,158,144,33,7,144,67,100,192,15,198,144,156,193,91,3,226,29,129,224,94,29,3,132,184,44,15,128,177,131,224,48,65,30,67,137,131,80,252,36,46,19,131,241,124,76,44,201,13,131,176,181,130,228,232,6,156,7,160,153,29,7,62,130,143,112,48,116,64,202,16,228,232,15,146,20,63,6,248,132,136,67,129,10,52,57,65,198,227,28,71,3,176,184,19,10,194,100,248,24,249,96,179,192,101,32,96,166,140,195,129,32,48,38,30,28,56,211,1,176,38,64,244,11,195,66,31,133,50,38,96,64,201,203,1,236,17,40,64,250,4,52,224,112,76,140,29,7,105,3,22,200,4,35,232,198,154,11,26,3,224,118,6,5,207,30,188,88,49,113,102,0,248,63,4,252,12,116,39,138,128,113,194,58,38,6,192,31,5,15,152,64,174,1,127,192,7,255,0,14,254,0,3,223,128,3,239,128,27,241,194,0,231,224,24,252,224,33,252,128,60,252,64,14,126,0,63,62,0,15,254,0,31,255,0,62,240,7,252,0,126,16,63,255,0,63,56,14,124,1,135,12,252,199,0,62,4,15,62,31,15,15,31,15,2,131,135,207,3,135,15,63,192,7,158,96,63,192,3,254,0,63,224,119,225,192,254,224,195,224,1,223,248,3,7,0,126,112,0,124,56,24,254,12,30,120,28,124,62,14,31,30,30,62,0,127,131,7,219,135,131,7,199,7,16,113,255,0,63,226,1,224,193,195,225,0,127,192,5,240,32,248,240,112,254,120,121,248,2,63,12,143,3,15,159,224,193,199,135,3,195,195,176,225,225,193,227,224,113,240,0,252,112,124,12,62,56,14,28,112,195,199,3,129,193,199,231,0,15,199,135,25,9,239,196,51,224,193,252,248,112,240,120,248,240,97,199,0,31,248,1,124,248,240,120,112,60,124,206,14,33,131,207,8,7,143,8,193,135,143,128,199,227,0,7,248,224,239,0,57,247,128,14,248,225,227,248,33,159,192,255,3,248,7,192,31,248,196,4,252,196,193,188,135,240,15,192,127,5,224,37,236,192,62,132,71,240,142,3,248,3,251,192,25,248,7,156,12,23,248,7,224,31,161,252,15,252,1,240,63,0,254,3,240,31,0,253,0,255,136,13,249,1,255,0,112,7,192,62,66,243,13,196,127,128,252,7,240,94,192,63,0,120,63,129,255,1,248,1,195,232,12,228,100,143,228,15,240,7,240,194,31,0,127,192,111,128,126,3,248,7,240,63,192,120,15,130,7,254,34,119,112,2,118,3,254,0,254,103,0,124,199,241,142,198,59,224,63,132,243,25,216,3,153,252,9,184,15,248,0,157,36,97,249,13,0,253,3,240,31,144,63,1,248,31,208,15,248,55,1,248,7,240,15,192,63,0,254,3,248,15,192,63,0,250,3,240,15,128,255,1,184,7,240,1,252,1,188,128,19,30,0,127,225,64,127,160,127,176,0,63,192,31,192,56,15,240,31,128,255,1,252,3,241,126,1,254,1,240,255,0,127,192,29,7,240,15,192,126,6,224,7,224,15,248,6,193,254,1,252,3,224,15,0,252],ii=(e,t,n,a,s)=>{let r=((e,t)=>{let n=(e,t)=>(e*t>>8&255)<<1,a=[[],[],[]];si.map((e,t)=>{a[0][t]=255&e,a[1][t]=e>>8&255,a[2][t]=e>>16&255});for(let s=5;s<30;s++)a[0][s]=n(e,a[0][s]),a[1][s]=n(t,a[1][s]);for(let s=48;s<54;s++)a[0][s]=n(e,a[0][s]),a[1][s]=n(t,a[1][s]);return a})(n,a);const[o,i,l,c]=((e,t,n)=>{let a=(e,t,n)=>{let a,s=t;for(t<30?t=0:t-=30;127===(a=n[t]);)++t;for(;t!==s;)for(a+=e,n[t]=255&a;++t!==s&&255===n[t];);},s=[],r=[[],[],[]],o=[[],[],[]],i=[],l=0;for(let c=0;c<t.length;c++){let d=t[c][0];1===d?a(1,l,s):2===d&&a(255,l,s);let u=Jo[t[c][2]];for(let a=t[c][1];a>0;a--)r[0][l]=n[0][d],r[1][l]=n[1][d],r[2][l]=n[2][d],o[0][l]=255&ri[d],o[1][l]=ri[d]>>8&255,o[2][l]=ri[d]>>16&255,i[l]=ai[d],s[l]=e+u&255,l++}return[s,r,o,i]})(t,e,r);let d=((e,t,n,a)=>{let s,r,o=[e,t[0],t[1],t[2],n[0],n[1],n[2]],i=(e,t)=>{if(e<0||e>o.length-1)throw new Error(`Error invalid table in Read: ${e}`);return o[e][t]},l=(e,t,n,a)=>{let s=a<0,r=Math.abs(a)%e,l=a/e|0,c=0,d=e;for(;--d>0;){let a=i(t,n)+l;if(c+=r,c>=e&&(c-=e,s?a--:a&&a++),t<0||t>o.length-1)throw new Error(`Error invalid table in Read: ${t}`);o[t][++n]=a,a+=l}},c=0;for(let d=0;d<a.length-1;d++){let t=a[d][0],n=a[d+1][0],o=ei[n],u=ei[t];u===o?(s=ti[t],r=ti[n]):u<o?(s=ni[n],r=ti[n]):(s=ti[t],r=ni[t]),c+=a[d][1];let p=c+r,h=c-s,m=s+r;if(!(m-2&128)){let t=a[d][1]>>1,n=a[d+1][1]>>1;l(t+n,0,h,e[c+n]-e[c-t]);for(let e=1;e<7;e++)l(m,e,h,i(e,p)-i(e,h))}}return c+a[a.length-1][1]})(o,i,l,e);if(!s)for(let p=0;p<o.length;p++)o[p]-=i[0][p]>>1;let u=[0,1,2,2,2,3,3,4,4,5,6,8,9,11,13,15];for(let p=l[0].length-1;p>=0;p--)l[0][p]=u[l[0][p]],l[1][p]=u[l[1][p]],l[2][p]=u[l[2][p]];return[d,i,o,l,c]},li=(e,t,n,a)=>{let s=(7&n)-1,r=256*s&65535,o=248&n,i=(t,n,a,s)=>{let i=8,l=oi[r+o];do{128&l?e(t,n):e(a,s),l<<=1}while(--i)};if(0===o){let e=a>>4^255;o=255&t;do{i(3,26,4,6),o++,o&=255}while(255&++e);return o}o^=255;let l=255&Zo[s];do{i(2,5,1,l)}while(255&++o);return t},ci=e=>127*Math.sin(2*Math.PI*(e/256))|0,di=(e,t,n,a,s,r)=>{s=255&(s||72);let o=ii(e,t=void 0===t?64:255&t,n=void 0===n?128:255&n,a=void 0===a?128:255&a,r=r||!1),i=(e=>{let t=new Uint8Array(e),n=0,a=0,s=(e,t)=>{let n=16*(15&t);s.ary(e,[n,n,n,n,n])};return s.ary=(e,s)=>{if(n+=[[162,167,167,127,128],[226,60,60,0,0],[225,60,59,0,0],[200,0,0,54,55],[199,0,0,54,54]][a][e],(n/50|0)>t.length)throw new Error(`Buffer overflow, want ${n/50|0} but buffersize is only ${t.length}!`);a=e;for(let a=0;a<5;a++)t[(n/50|0)+a]=s[a]},s.get=()=>t.slice(0,n/50|0),s})(176.4*e.reduce((e,t)=>e+t[1],0)*s|0);const[l,c,d,u,p]=o;return ui(d,c,u,p),((e,t,n,a,s,r,o)=>{let i=n,l=0,c=0,d=0,u=0,p=0,h=s[0],m=.75*h|0;for(;t;){let f=o[p];if(248&f)u=li(e,u,f,s[255&p]),p+=2,t-=2,i=n;else{{let t=[],n=256*l,s=256*c,o=256*d;for(let e=0;e<5;e++){const i=ci(255&n>>8),l=ci(255&s>>8),c=(255&o>>8)<129?-112:112;let d=i*(15&r[0][p])+l*(15&r[1][p])+c*(15&r[2][p]);d/=32,d+=128,t[e]=0|d,n+=256*a[0][p]/4,s+=256*a[1][p]/4,o+=256*a[2][p]/4}e.ary(0,t)}if(i--,0===i){if(p++,0===--t)return;i=n}if(h--,0!==h){if(m--,0!==m||0===f){l+=a[0][p],c+=a[1][p],d+=a[2][p];continue}u=li(e,u,f,s[255&p])}}h=s[p],m=.75*h|0,l=0,c=0,d=0}})(i,l,s,c,d,u,p),i.get()},ui=(e,t,n,a)=>{for(let s=0;s<a.length;s++)s++},pi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Xo(e);return!1!==n&&di(n,t.pitch,t.mouth,t.throat,t.speed,t.singmode)},hi=e=>{let t=" "+e.toUpperCase(),n=0,a="",s=(e,t)=>{n+=t,a+=e},r=0;for(;n<t.length&&r++<1e4;){t.toLowerCase();let e=t[n];if("."!==e||jo(t,n+1,1)){if(Ro(e,2)){zo.some(e=>e(t,n,s));continue}if(0!==Oo[e]){if(!Ro(e,Do))return!1;Vo[e].some(e=>e(t,n,s));continue}a+=" ",n++}else a+=".",n++}return a},mi=pi,fi=(e,t)=>{let n=pi(e,t);return!1!==n&&(e=>{let t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=(e[n]-128)/256;return t})(n)};function yi(e){let t=e||{},n=(e,n)=>n||t.phonetic?e.toUpperCase():hi(e);this.buf8=(e,a)=>mi(n(e,a),t),this.buf32=(e,a)=>fi(n(e,a),t),this.speak=(e,t)=>Io(this.buf32(e,t)),this.download=(e,t)=>{(e=>{let t=new Blob([_o(e)],{type:"audio/vnd.wave"}),n=window.URL||window.webkitURL,a=n.createObjectURL(t),s=document.createElement("a");s.href=a,s.target="_blank",s.download="sam.wav",document.body.appendChild(s),s.click(),document.body.removeChild(s),n.revokeObjectURL(a)})(this.buf8(e,t))},this.wav=(e,t)=>_o(this.buf8(e,t))}yi.buf8=mi,yi.buf32=fi,yi.convert=hi;class gi extends u{name="SAMSynth";input=void 0;output;_player;_sam;_config;_buffer=null;_isRendering=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){super(),this.output=new p,this._config={...e},this._player=(new j).connect(this.output),this._player.loop=this._config.singmode,this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._sam=new yi({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()}async ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,this._config.phonetic);if(e){const t=D().createBuffer(1,e.length,22050);t.getChannelData(0).set(e),this._buffer=t;const n="started"===this._player.state;this._player.buffer&&this._player.buffer.dispose(),this._player.buffer=new R(t),n&&this._config.singmode&&("started"===this._player.state&&this._player.stop(),this._player.start()),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.mouth&&e.mouth!==this._config.mouth||void 0!==e.throat&&e.throat!==this._config.throat||void 0!==e.singmode&&e.singmode!==this._config.singmode||void 0!==e.phonetic&&e.phonetic!==this._config.phonetic;this._config={...this._config,...e},void 0!==e.singmode&&(this._player.loop=e.singmode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{this._sam=new yi({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()},50))}triggerAttack(e,t,n=1){if(this._buffer)if(this._config.singmode){const a="string"==typeof e?b(e).toMidi():e,s=Math.pow(2,(a-60)/12);this._player.playbackRate=s,"started"!==this._player.state&&this._player.start(t,0),this._player.volume.value=G(n)}else this._player.playbackRate=1,"started"===this._player.state&&this._player.stop(),this._player.start(t,0),this._player.volume.value=G(n)}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a)}triggerRelease(){}dispose(){return this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),super.dispose(),this._player.dispose(),this.output.dispose(),this}}class vi extends u{name="V2Synth";input=void 0;output;_worklet=null;_initialized=!1;_initPromise;_pendingNotes=[];_releaseTimers=new Set;_initialConfig;constructor(e){super(),this.output=new p,this._initialConfig=e,this._initPromise=this._initialize()}async _initialize(){const e=this.context,t=e.rawContext||e._context;if(!t)throw new Error("Could not get native AudioContext from Tone.js");if("running"!==t.state){try{await t.resume()}catch{}"running"!==t.state&&await Promise.race([new Promise(e=>{const n=()=>{"running"===t.state?e():setTimeout(n,100)};setTimeout(n,100)}),new Promise((e,t)=>setTimeout(()=>t(new Error("AudioContext not running after 5s")),5e3))])}const n="/DEViLBOX/",a=`?v=${Date.now()}`;try{await t.audioWorklet.addModule(`${n}V2Synth.worklet.js${a}`)}catch(d){}const[s,r]=await Promise.all([fetch(`${n}V2Synth.wasm${a}`,{cache:"no-store"}),fetch(`${n}V2Synth.js${a}`,{cache:"no-store"})]);if(!s.ok)throw new Error(`Failed to load V2Synth.wasm: ${s.status}`);if(!r.ok)throw new Error(`Failed to load V2Synth.js: ${r.status}`);const[o,i]=await Promise.all([s.arrayBuffer(),r.text()]),l='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+i.replace(/import\.meta\.url/g,`"${n}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/(_malloc=wasmExports\["\w+"\])/,'$1;Module["_malloc"]=_malloc').replace(/(_free=wasmExports\["\w+"\])/,'$1;Module["_free"]=_free');this._worklet=v(t,"v2-synth-processor",{outputChannelCount:[2]}),await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("V2Synth initialization timeout after 10s"))},1e4);this._worklet.port.onmessage=t=>{"ready"===t.data.type?(clearTimeout(n),this._initialized=!0,this._initialConfig&&this._applyV2Config(this._initialConfig),this._pendingNotes.forEach(e=>this._sendMIDI([144,e.note,e.vel])),this._pendingNotes=[],e()):t.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:o,jsCode:l})});const c=this.output.input;this._worklet.connect(c);try{const e=t.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(t.destination)}catch(d){}}async ready(){return this._initPromise}async ensureInitialized(){return this._initPromise}triggerAttack(e,t,n=1){const a="string"==typeof e?b(e).toMidi():e,s=Math.floor(127*n);this._initialized?this._sendMIDI([144,a,s]):this._pendingNotes.push({note:a,vel:s})}triggerRelease(e){this._initialized}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,void 0,a);const s="string"==typeof e?b(e).toMidi():e,r=this.toSeconds(t),o=setTimeout(()=>{this._releaseTimers.delete(o),this._initialized&&this._worklet&&this._sendMIDI([128,s,0])},1e3*r);this._releaseTimers.add(o)}setParameter(e,t){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"param",index:e,value:t})}applyConfig(e){this._initialized?this._applyV2Config(e):this._initialConfig=e}_applyV2Config(e){e.osc1&&(this.setParameter(2,e.osc1.mode),this.setParameter(4,e.osc1.transpose+64),this.setParameter(5,e.osc1.detune+64),this.setParameter(6,e.osc1.color),this.setParameter(7,e.osc1.level)),e.osc2&&(this.setParameter(8,e.osc2.mode),this.setParameter(9,e.osc2.ringMod?1:0),this.setParameter(10,e.osc2.transpose+64),this.setParameter(11,e.osc2.detune+64),this.setParameter(12,e.osc2.color),this.setParameter(13,e.osc2.level)),e.osc3&&(this.setParameter(14,e.osc3.mode),this.setParameter(15,e.osc3.ringMod?1:0),this.setParameter(16,e.osc3.transpose+64),this.setParameter(17,e.osc3.detune+64),this.setParameter(18,e.osc3.color),this.setParameter(19,e.osc3.level)),e.filter1&&(this.setParameter(20,e.filter1.mode),this.setParameter(21,e.filter1.cutoff),this.setParameter(22,e.filter1.resonance)),e.filter2&&(this.setParameter(23,e.filter2.mode),this.setParameter(24,e.filter2.cutoff),this.setParameter(25,e.filter2.resonance)),e.routing&&(this.setParameter(26,e.routing.mode),this.setParameter(27,e.routing.balance)),e.envelope&&(this.setParameter(32,e.envelope.attack),this.setParameter(33,e.envelope.decay),this.setParameter(34,e.envelope.sustain),this.setParameter(36,e.envelope.release)),e.envelope2&&(this.setParameter(38,e.envelope2.attack),this.setParameter(39,e.envelope2.decay),this.setParameter(40,e.envelope2.sustain),this.setParameter(42,e.envelope2.release)),e.lfo1&&(this.setParameter(47,e.lfo1.rate),this.setParameter(50,e.lfo1.depth))}_sendMIDI(e){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"midi",msg:e})}dispose(){return this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._initialized=!1,super.dispose(),this._worklet&&this._worklet.disconnect(),this.output.dispose(),this}}class bi extends u{name="V2SpeechSynth";input=void 0;output;_player;_sam;_config;_buffer=null;_isRendering=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){super(),this.output=new p,this._config={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,...e},this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._player=(new j).connect(this.output),this._player.loop=this._config.singMode;const t=Math.round(this._config.pitch/127*255),n=Math.round(this._config.speed/127*255),a=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+a)),r=Math.max(0,Math.min(255,128-a));this._sam=new yi({pitch:t,speed:n,mouth:Math.round(s),throat:Math.round(r),singmode:this._config.singMode,phonetic:!1}),this._render()}async ready(){return this._readyPromise}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,!1);if(e){const t=D().createBuffer(1,e.length,22050);t.getChannelData(0).set(e),this._buffer=t;const n="started"===this._player.state;this._player.buffer&&this._player.buffer.dispose(),this._player.buffer=new R(t),n&&this._config.singMode&&("started"===this._player.state&&this._player.stop(),this._player.start()),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.formantShift&&e.formantShift!==this._config.formantShift||void 0!==e.singMode&&e.singMode!==this._config.singMode;this._config={...this._config,...e},void 0!==e.singMode&&(this._player.loop=e.singMode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{const e=Math.round(this._config.pitch/127*255),t=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,a=Math.max(0,Math.min(255,128+n)),s=Math.max(0,Math.min(255,128-n));this._sam=new yi({pitch:e,speed:t,mouth:Math.round(a),throat:Math.round(s),singmode:this._config.singMode,phonetic:!1}),this._render()},50))}triggerAttack(e,t,n=1){if(this._buffer)if(this._config.singMode){const a="string"==typeof e?b(e).toMidi():e,s=Math.pow(2,(a-60)/12);this._player.playbackRate=s,"started"!==this._player.state&&this._player.start(t,0),this._player.volume.value=G(n)}else this._player.playbackRate=1,"started"===this._player.state&&this._player.stop(),this._player.start(t,0),this._player.volume.value=G(n)}triggerRelease(e){}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a)}dispose(){return this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),super.dispose(),this._player.dispose(),this.output.dispose(),this}}const xi={ARGURU_DISTORTION:"ArguruDistortion",ELAK_DIST2:"ElakDist2",JESKOLA_DISTORTION:"JeskolaDistortion",GEONIK_OVERDRIVE:"GeonikOverdrive",GRAUE_SOFTSAT:"GraueSoftSat",WHITENOISE_STEREODIST:"WhiteNoiseStereoDist",ELAK_SVF:"ElakSVF",CYANPHASE_NOTCH:"CyanPhaseNotch",Q_ZFILTER:"QZfilter",FSM_PHILTA:"FSMPhilta",JESKOLA_DELAY:"JeskolaDelay",JESKOLA_CROSSDELAY:"JeskolaCrossDelay",JESKOLA_FREEVERB:"JeskolaFreeverb",FSM_PANZERDELAY:"FSMPanzerDelay",FSM_CHORUS:"FSMChorus",FSM_CHORUS2:"FSMChorus2",WHITENOISE_WHITECHORUS:"WhiteNoiseWhiteChorus",BIGYO_FREQUENCYSHIFTER:"BigyoFrequencyShifter",GEONIK_COMPRESSOR:"GeonikCompressor",LD_SLIMIT:"LdSLimit",OOMEK_EXCITER:"OomekExciter",OOMEK_MASTERIZER:"OomekMasterizer",DEDACODE_STEREOGAIN:"DedaCodeStereoGain",FSM_KICK:"FSMKick",FSM_KICKXP:"FSMKickXP",JESKOLA_TRILOK:"JeskolaTrilok",JESKOLA_NOISE:"JeskolaNoise",OOMEK_AGGRESSOR:"OomekAggressor",OOMEK_AGGRESSOR_DF:"OomekAggressorDF",MADBRAIN_4FM2F:"MadBrain4FM2F",MADBRAIN_DYNAMITE6:"MadBrainDynamite6",MAKK_M3:"MakkM3",MAKK_M4:"MakkM4",CYANPHASE_DTMF:"CyanPhaseDTMF",ELENZIL_FREQUENCYBOMB:"ElenzilFrequencyBomb"},wi={[xi.ARGURU_DISTORTION]:{name:"Arguru Distortion",shortName:"Distortion",author:"Arguru",type:"effect",parameters:[{index:0,name:"Input Gain",description:"Input Gain",minValue:1,maxValue:2048,defaultValue:256,type:"word"},{index:1,name:"Threshold (-)",description:"Threshold level (negative)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:2,name:"Threshold (+)",description:"Threshold level (positive)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:3,name:"Output Gain",description:"Output Gain",minValue:1,maxValue:2048,defaultValue:1024,type:"word"},{index:4,name:"Phase Inversor",description:"Stereo phase inversor",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:5,name:"Mode",description:"Operational mode (0=Clip, 1=Saturate)",minValue:0,maxValue:1,defaultValue:0,type:"byte"}]},[xi.ELAK_SVF]:{name:"Elak SVF Filter",shortName:"SVF",author:"Elak",type:"effect",parameters:[{index:0,name:"Cutoff",description:"Cut-off frequency",minValue:0,maxValue:1e3,defaultValue:512,type:"word"},{index:1,name:"Resonance",description:"Resonance",minValue:0,maxValue:65534,defaultValue:512,type:"word"}]},[xi.FSM_KICK]:{name:"FSM Kick",shortName:"Kick",author:"FSM",type:"generator",parameters:[]},[xi.FSM_KICKXP]:{name:"FSM KickXP",shortName:"KickXP",author:"FSM",type:"generator",parameters:[]},[xi.JESKOLA_TRILOK]:{name:"Jeskola Trilok",shortName:"Trilok",author:"Jeskola",type:"generator",parameters:[]},[xi.JESKOLA_NOISE]:{name:"Jeskola Noise",shortName:"Noise",author:"Jeskola",type:"generator",parameters:[]},[xi.OOMEK_AGGRESSOR]:{name:"Oomek Aggressor",shortName:"Aggressor",author:"Oomek",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"}]},[xi.OOMEK_AGGRESSOR_DF]:{name:"Oomek Aggressor Devil Fish",shortName:"AggressorDF",author:"Oomek + Devil Fish Mods",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Normal envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:8,name:"Accent Decay",description:"Accent envelope decay time (Devil Fish)",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:9,name:"VEG Decay",description:"Volume envelope decay (Devil Fish)",minValue:0,maxValue:128,defaultValue:96,type:"byte"},{index:10,name:"VEG Sustain",description:"Volume envelope sustain 0-100% (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:11,name:"Soft Attack",description:"Soft attack time 0.3-30ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:12,name:"Filter Tracking",description:"Filter tracking 0-200% (Devil Fish)",minValue:0,maxValue:200,defaultValue:0,type:"byte"},{index:13,name:"High Resonance",description:"High resonance mode - self oscillation (Devil Fish)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:14,name:"Slide Time",description:"Slide/glide time 10-500ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:30,type:"byte"},{index:15,name:"Muffler",description:"Output soft clipping 0=off, 1=soft, 2=hard (Devil Fish)",minValue:0,maxValue:2,defaultValue:0,type:"byte"},{index:16,name:"Sweep Speed",description:"Accent sweep speed 0=fast, 1=normal, 2=slow (Devil Fish)",minValue:0,maxValue:2,defaultValue:1,type:"byte"}]},[xi.MADBRAIN_4FM2F]:{name:"MadBrain 4FM2F",shortName:"4FM2F",author:"MadBrain",type:"generator",parameters:[]},[xi.MADBRAIN_DYNAMITE6]:{name:"MadBrain Dynamite6",shortName:"Dynamite6",author:"MadBrain",type:"generator",parameters:[]},[xi.MAKK_M3]:{name:"Makk M3",shortName:"M3",author:"Makk",type:"generator",parameters:[]},[xi.MAKK_M4]:{name:"Makk M4",shortName:"M4",author:"Makk",type:"generator",parameters:[]},[xi.ELAK_DIST2]:{name:"Elak Dist2",shortName:"Dist2",author:"Elak",type:"effect",parameters:[]},[xi.JESKOLA_DISTORTION]:{name:"Jeskola Distortion",shortName:"JDist",author:"Jeskola",type:"effect",parameters:[]},[xi.GEONIK_OVERDRIVE]:{name:"Geonik Overdrive",shortName:"Overdrive",author:"Geonik",type:"effect",parameters:[]},[xi.GRAUE_SOFTSAT]:{name:"Graue SoftSat",shortName:"SoftSat",author:"Graue",type:"effect",parameters:[]},[xi.WHITENOISE_STEREODIST]:{name:"WhiteNoise StereoDist",shortName:"StereoDist",author:"WhiteNoise",type:"effect",parameters:[]},[xi.CYANPHASE_NOTCH]:{name:"CyanPhase Notch",shortName:"Notch",author:"CyanPhase",type:"effect",parameters:[]},[xi.Q_ZFILTER]:{name:"Q Zfilter",shortName:"Zfilter",author:"Q",type:"effect",parameters:[]},[xi.FSM_PHILTA]:{name:"FSM Philta",shortName:"Philta",author:"FSM",type:"effect",parameters:[]},[xi.JESKOLA_DELAY]:{name:"Jeskola Delay",shortName:"JDelay",author:"Jeskola",type:"effect",parameters:[]},[xi.JESKOLA_CROSSDELAY]:{name:"Jeskola CrossDelay",shortName:"CrossDelay",author:"Jeskola",type:"effect",parameters:[]},[xi.JESKOLA_FREEVERB]:{name:"Jeskola Freeverb",shortName:"Freeverb",author:"Jeskola",type:"effect",parameters:[]},[xi.FSM_PANZERDELAY]:{name:"FSM PanzerDelay",shortName:"PanzerDelay",author:"FSM",type:"effect",parameters:[]},[xi.FSM_CHORUS]:{name:"FSM Chorus",shortName:"Chorus",author:"FSM",type:"effect",parameters:[]},[xi.FSM_CHORUS2]:{name:"FSM Chorus2",shortName:"Chorus2",author:"FSM",type:"effect",parameters:[]},[xi.WHITENOISE_WHITECHORUS]:{name:"WhiteNoise WhiteChorus",shortName:"WhiteChorus",author:"WhiteNoise",type:"effect",parameters:[]},[xi.BIGYO_FREQUENCYSHIFTER]:{name:"Bigyo FrequencyShifter",shortName:"FreqShift",author:"Bigyo",type:"effect",parameters:[]},[xi.GEONIK_COMPRESSOR]:{name:"Geonik Compressor",shortName:"Compressor",author:"Geonik",type:"effect",parameters:[]},[xi.LD_SLIMIT]:{name:"Ld SLimit",shortName:"SLimit",author:"Ld",type:"effect",parameters:[]},[xi.OOMEK_EXCITER]:{name:"Oomek Exciter",shortName:"Exciter",author:"Oomek",type:"effect",parameters:[]},[xi.OOMEK_MASTERIZER]:{name:"Oomek Masterizer",shortName:"Masterizer",author:"Oomek",type:"master",parameters:[]},[xi.DEDACODE_STEREOGAIN]:{name:"DedaCode StereoGain",shortName:"StereoGain",author:"DedaCode",type:"effect",parameters:[]},[xi.CYANPHASE_DTMF]:{name:"CyanPhase DTMF",shortName:"DTMF",author:"CyanPhase",type:"generator",parameters:[]},[xi.ELENZIL_FREQUENCYBOMB]:{name:"Elenzil FrequencyBomb",shortName:"FreqBomb",author:"Elenzil",type:"generator",parameters:[]}};class ki{static instance=null;isLoaded=!1;initPromise=null;workletNode=null;nativeContext=null;constructor(){}static getInstance(){return ki.instance||(ki.instance=new ki),ki.instance}async init(e){if(!this.isLoaded)return this.initPromise||(this.initPromise=this.doInit(e)),this.initPromise}async doInit(e){try{const t=e,n=t.rawContext||t._context||qa(e);if(this.nativeContext=n,!n||!n.audioWorklet)return void(this.initPromise=null);if("running"!==n.state){try{await n.resume()}catch{}if("running"!==n.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===n.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const a="/DEViLBOX/",s=`?v=${Date.now()}`;await n.audioWorklet.addModule(`${a}Buzzmachine.worklet.js${s}`),this.isLoaded=!0}catch(t){throw this.initPromise=null,t}}isInitialized(){return this.isLoaded}async createMachineNode(e,t){this.isLoaded||await this.init(e);const n=e,a=n.rawContext||n._context||qa(e),s=v(a,"buzzmachine-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});return await this.loadMachineWasm(s,t),s}async loadMachineWasm(e,t){const n=this.getMachineFilename(t),a="/DEViLBOX/",[s,r]=await Promise.all([fetch(`${a}buzzmachines/${n}.js`),fetch(`${a}buzzmachines/${n}.wasm`)]);if(!s.ok||!r.ok)throw new Error(`Failed to load buzzmachine: ${t}`);const o=await s.text(),i=await r.arrayBuffer();return new Promise((n,a)=>{const s=setTimeout(()=>{a(new Error("Buzzmachine init timeout"))},5e3);e.port.onmessage=e=>{"initialized"===e.data.type?(clearTimeout(s),n()):"error"===e.data.type&&(clearTimeout(s),a(new Error(e.data.error)))},e.port.postMessage({type:"init",wasmBinary:i,jsCode:o,machineType:t})})}getMachineFilename(e){const t={[xi.ARGURU_DISTORTION]:"Arguru_Distortion",[xi.ELAK_DIST2]:"Elak_Dist2",[xi.JESKOLA_DISTORTION]:"Jeskola_Distortion",[xi.GEONIK_OVERDRIVE]:"Geonik_Overdrive",[xi.GRAUE_SOFTSAT]:"Graue_SoftSat",[xi.WHITENOISE_STEREODIST]:"WhiteNoise_StereoDist",[xi.ELAK_SVF]:"Elak_SVF",[xi.CYANPHASE_NOTCH]:"CyanPhase_Notch",[xi.Q_ZFILTER]:"Q_Zfilter",[xi.FSM_PHILTA]:"FSM_Philta",[xi.JESKOLA_DELAY]:"Jeskola_Delay",[xi.JESKOLA_CROSSDELAY]:"Jeskola_CrossDelay",[xi.JESKOLA_FREEVERB]:"Jeskola_Freeverb",[xi.FSM_PANZERDELAY]:"FSM_PanzerDelay",[xi.FSM_CHORUS]:"FSM_Chorus",[xi.FSM_CHORUS2]:"FSM_Chorus2",[xi.WHITENOISE_WHITECHORUS]:"WhiteNoise_WhiteChorus",[xi.BIGYO_FREQUENCYSHIFTER]:"Bigyo_FrequencyShifter",[xi.GEONIK_COMPRESSOR]:"Geonik_Compressor",[xi.LD_SLIMIT]:"Ld_SLimit",[xi.OOMEK_EXCITER]:"Oomek_Exciter",[xi.OOMEK_MASTERIZER]:"Oomek_Masterizer",[xi.DEDACODE_STEREOGAIN]:"DedaCode_StereoGain",[xi.FSM_KICK]:"FSM_Kick",[xi.FSM_KICKXP]:"FSM_KickXP",[xi.JESKOLA_TRILOK]:"Jeskola_Trilok",[xi.JESKOLA_NOISE]:"Jeskola_Noise",[xi.OOMEK_AGGRESSOR]:"Oomek_Aggressor",[xi.OOMEK_AGGRESSOR_DF]:"Oomek_Aggressor_DF",[xi.MADBRAIN_4FM2F]:"MadBrain_4FM2F",[xi.MADBRAIN_DYNAMITE6]:"MadBrain_Dynamite6",[xi.MAKK_M3]:"Makk_M3",[xi.MAKK_M4]:"Makk_M4",[xi.CYANPHASE_DTMF]:"CyanPhase_DTMF",[xi.ELENZIL_FREQUENCYBOMB]:"Elenzil_FrequencyBomb"}[e];if(!t)throw new Error(`Unknown machine type: ${e}`);return t}setParameter(e,t,n){e.port.postMessage({type:"setParameter",paramIndex:t,paramValue:n})}stop(e){e.port.postMessage({type:"stop"})}getMachineInfo(e){return wi[e]}}class Si extends u{name="BuzzmachineGenerator";input=void 0;output;engine=ki.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;preGain=null;overdrive=null;mufflerFilter=null;postFilter=null;postGain=null;overdriveAmount=0;mufflerMode="off";filterTrackingAmount=0;currentCutoff=1e3;constructor(e){super(),this.machineType=e,this.output=new p(1),this.is303Style()&&this.createEffectsChain(),this.initEngine()}createEffectsChain(){this.preGain=new p(1),this.overdrive=new T({distortion:.4,wet:0,oversample:"2x"}),this.mufflerFilter=new y({type:"lowpass",frequency:2e4,rolloff:-12,Q:.7}),this.postFilter=new y({type:"lowpass",frequency:2e4,rolloff:-12,Q:1}),this.postGain=new p(1),this.preGain.connect(this.overdrive),this.overdrive.connect(this.mufflerFilter),this.mufflerFilter.connect(this.postFilter),this.postFilter.connect(this.postGain),this.postGain.connect(this.output)}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const t=this.context;if(await this.engine.init(t),this.workletNode=await this.engine.createMachineNode(t,this.machineType),!this.workletNode)throw new Error("Worklet node creation failed");const n=Xa(this.is303Style()&&this.preGain?this.preGain:this.output);if(!n)throw new Error("Could not find native AudioNode for connection");this.workletNode.connect(n);try{const e=this.context,t=e.rawContext||e._context;if(t){const e=t.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(t.destination)}}catch(e){}this.useWasmEngine=!0}catch(t){this.initError=t instanceof Error?t:new Error(String(t)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=wi[this.machineType];eo("BuzzmachineGenerator",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}triggerAttack(e,t,n=1,a,s){if(!this.useWasmEngine||!this.workletNode)return this;const r=t??void 0,o=b(e).toFrequency();return this.is303Style()&&this.filterTrackingAmount>0&&this.applyFilterTracking(o),this.workletNode.port.postMessage({type:"noteOn",frequency:o,velocity:Math.round(127*n),time:void 0!==r?w(r).toSeconds():void 0,accent:a,slide:s}),this}triggerRelease(e){if(!this.useWasmEngine||!this.workletNode)return this;const t=e??void 0;return this.workletNode.port.postMessage({type:"noteOff",time:void 0!==t?w(t).toSeconds():void 0}),this}triggerAttackRelease(e,t,n,a=1,s,r){const o=n??void 0,i=void 0!==o?w(o).toSeconds():x(),l=w(t).toSeconds();return this.triggerAttack(e,i,a,s,r),this.triggerRelease(i+l),this}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}releaseAll(){this.stop()}is303Style(){return this.machineType===xi.OOMEK_AGGRESSOR||this.machineType===xi.OOMEK_AGGRESSOR_DF}isDevilFishWasm(){return this.machineType===xi.OOMEK_AGGRESSOR_DF}setCutoff(e){if(!this.is303Style())return;const t=200*Math.pow(100,e);this.currentCutoff=Math.max(200,Math.min(5e3,t)),this.postFilter&&0===this.filterTrackingAmount&&(this.postFilter.frequency.value=Math.min(18e3,1.5*this.currentCutoff));const n=Math.round(240*e);this.setParameter(1,Math.min(240,Math.max(0,n)))}setResonance(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(2,Math.min(128,Math.max(0,t)))}setEnvMod(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(3,Math.min(128,Math.max(0,t)))}setDecay(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(4,Math.min(128,Math.max(0,t)))}setAccentAmount(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(5,Math.min(128,Math.max(0,t)))}setAccent(e){this.setAccentAmount(e)}setTuning(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(6,Math.min(200,Math.max(0,t)))}setVolume(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(7,Math.min(200,Math.max(0,t)))}setWaveform(e){if(!this.is303Style())return;let t;t="number"==typeof e?e>=.5?1:0:"square"===e?1:0,this.setParameter(0,t)}setSlideTime(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(14,t)}}enableDevilFish(e,t){this.is303Style()&&(e?(this.setOverdrive(t?.overdrive??.3),this.setMuffler(t?.muffler??"mid"),this.setHighResonanceEnabled(!0),this.isDevilFishWasm()&&(this.setFilterTracking(.5),this.setSlideTime(.17),this.setSweepSpeed("normal"))):(this.setOverdrive(0),this.setMuffler("off"),this.setHighResonanceEnabled(!1),this.setFilterTracking(0)))}setOverdrive(e){this.is303Style()&&this.overdrive&&(this.overdriveAmount=Math.min(Math.max(e,0),1),0===this.overdriveAmount?this.overdrive.wet.value=0:(this.overdrive.wet.value=.8*this.overdriveAmount,this.overdrive.distortion=.2+.6*this.overdriveAmount))}setMuffler(e){if(this.is303Style()){if(this.mufflerMode=e,this.isDevilFishWasm()){let e;switch(this.mufflerMode){case"dark":case"mid":e=1;break;case"bright":e=2;break;default:e=0}this.setParameter(15,e)}if(this.mufflerFilter)switch(this.mufflerMode){case"dark":this.mufflerFilter.frequency.value=2e3,this.mufflerFilter.Q.value=.5;break;case"mid":this.mufflerFilter.frequency.value=6e3,this.mufflerFilter.Q.value=.7;break;case"bright":this.mufflerFilter.frequency.value=12e3,this.mufflerFilter.Q.value=.7;break;default:this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7}}}applyFilterTracking(e){if(!this.postFilter||0===this.filterTrackingAmount)return;const t=Math.log2(e/440)*this.filterTrackingAmount*2e3,n=Math.max(200,Math.min(18e3,this.currentCutoff+t));this.postFilter.frequency.value=n}setFilterTracking(e){if(this.is303Style()&&(this.filterTrackingAmount=Math.min(Math.max(e,0),1),this.isDevilFishWasm())){const t=Math.round(200*e);this.setParameter(12,Math.min(200,t))}}setHighResonanceEnabled(e){this.is303Style()&&(this.isDevilFishWasm()&&this.setParameter(13,e?1:0),this.postFilter&&(this.postFilter.Q.value=e?4:1))}setHighResonance(e){this.setHighResonanceEnabled(e)}setNormalDecay(e){this.is303Style()&&this.setDecay(e)}setAccentDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(8,Math.min(128,Math.max(0,t)))}}setVegDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(9,Math.min(128,Math.max(0,t)))}}setVegSustain(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(10,t)}}setSoftAttack(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(11,Math.min(100,Math.max(0,t)))}}setFilterFM(e){this.is303Style()&&this.isDevilFishWasm()&&this.setParameter(19,Math.round(100*e))}setSweepSpeed(e){if(this.is303Style()&&this.isDevilFishWasm()){let t;if("number"==typeof e)t=Math.round(2*e);else switch(e.toLowerCase()){case"fast":t=0;break;case"slow":t=2;break;default:t=1}this.setParameter(16,t)}}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}dispose(){return super.dispose(),this.output.dispose(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.preGain&&(this.preGain.dispose(),this.preGain=null),this.overdrive&&(this.overdrive.dispose(),this.overdrive=null),this.mufflerFilter&&(this.mufflerFilter.dispose(),this.mufflerFilter=null),this.postFilter&&(this.postFilter.dispose(),this.postFilter=null),this.postGain&&(this.postGain.dispose(),this.postGain=null),this}}const Mi=0,Ni=1,Ci=2,Ei=3,Pi=4,Ti=5,Ai=6,Ii=7,_i=8,Oi=9,Fi=10,Di=11,Ri=12,ji=13,Li=14,Bi=15,Vi=16,zi=17,Ui=18,Gi=19,Ki=20,Hi=126,Wi=127,$i=128,qi=129,Yi=130,Xi=131,Qi=132,Zi=133,Ji=134,el=135,tl=136,nl=137,al=138,sl=139,rl=140,ol=141,il=142,ll=143,cl=144,dl={"E.PIANO 1":{algorithm:5,feedback:6,operators:[{level:99,coarse:1,fine:0,detune:7},{level:70,coarse:14,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:60,coarse:1,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:80,coarse:1,fine:0,detune:7}]},"BRASS 1":{algorithm:22,feedback:7},"STRINGS 1":{algorithm:2,feedback:4},"INIT VOICE":{algorithm:0,feedback:0}};class ul extends u{name="DexedSynth";input;output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){super(),this.output=new p(1),this.config={algorithm:0,feedback:0,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=this.context,n=t.rawContext||t._context,a="/DEViLBOX/";ul.isWorkletLoaded||(ul.workletLoadPromise||(ul.workletLoadPromise=n.audioWorklet.addModule(`${a}dexed/Dexed.worklet.js`)),await ul.workletLoadPromise,ul.isWorkletLoaded=!0);const[s,r]=await Promise.all([fetch(`${a}dexed/Dexed.wasm`),fetch(`${a}dexed/Dexed.js`)]);if(!s.ok)throw new Error(`Failed to load Dexed.wasm: ${s.status}`);if(!r.ok)throw new Error(`Failed to load Dexed.js: ${r.status}`);const[o,i]=await Promise.all([s.arrayBuffer(),r.text()]),l=i.replace(/import\.meta\.url/g,`"${a}dexed/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=v(n,"dexed-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:o,jsCode:l});const c=this.output.input;this._worklet.connect(c);try{const e=n.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(n.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){this._worklet&&this.isInitialized&&(void 0!==e.algorithm&&this.setParameter(Ji,e.algorithm),void 0!==e.feedback&&this.setParameter(el,e.feedback),void 0!==e.oscSync&&this.setParameter(tl,e.oscSync?1:0),void 0!==e.transpose&&this.setParameter(cl,e.transpose),void 0!==e.lfoSpeed&&this.setParameter(nl,e.lfoSpeed),void 0!==e.lfoDelay&&this.setParameter(al,e.lfoDelay),void 0!==e.lfoPmd&&this.setParameter(sl,e.lfoPmd),void 0!==e.lfoAmd&&this.setParameter(rl,e.lfoAmd),void 0!==e.lfoSync&&this.setParameter(ol,e.lfoSync?1:0),void 0!==e.lfoWave&&this.setParameter(il,e.lfoWave),void 0!==e.lfoPms&&this.setParameter(ll,e.lfoPms),e.pitchEgRates&&(this.setParameter(Hi,e.pitchEgRates[0]),this.setParameter(Wi,e.pitchEgRates[1]),this.setParameter($i,e.pitchEgRates[2]),this.setParameter(qi,e.pitchEgRates[3])),e.pitchEgLevels&&(this.setParameter(Yi,e.pitchEgLevels[0]),this.setParameter(Xi,e.pitchEgLevels[1]),this.setParameter(Qi,e.pitchEgLevels[2]),this.setParameter(Zi,e.pitchEgLevels[3])),e.operators&&e.operators.forEach((e,t)=>{if(t>=6)return;const n=21*t;void 0!==e.level&&this.setParameter(n+Vi,e.level),void 0!==e.coarse&&this.setParameter(n+Ui,e.coarse),void 0!==e.fine&&this.setParameter(n+Gi,e.fine),void 0!==e.detune&&this.setParameter(n+Ki,e.detune),void 0!==e.mode&&this.setParameter(n+zi,e.mode),e.egRates&&(this.setParameter(n+Mi,e.egRates[0]),this.setParameter(n+Ni,e.egRates[1]),this.setParameter(n+Ci,e.egRates[2]),this.setParameter(n+Ei,e.egRates[3])),e.egLevels&&(this.setParameter(n+Pi,e.egLevels[0]),this.setParameter(n+Ti,e.egLevels[1]),this.setParameter(n+Ai,e.egLevels[2]),this.setParameter(n+Ii,e.egLevels[3])),void 0!==e.breakPoint&&this.setParameter(n+_i,e.breakPoint),void 0!==e.leftDepth&&this.setParameter(n+Oi,e.leftDepth),void 0!==e.rightDepth&&this.setParameter(n+Fi,e.rightDepth),void 0!==e.leftCurve&&this.setParameter(n+Di,e.leftCurve),void 0!==e.rightCurve&&this.setParameter(n+Ri,e.rightCurve),void 0!==e.rateScaling&&this.setParameter(n+ji,e.rateScaling),void 0!==e.ampModSens&&this.setParameter(n+Li,e.ampModSens),void 0!==e.velocitySens&&this.setParameter(n+Bi,e.velocitySens)}))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadSysEx(e){this._worklet?.port.postMessage({type:"loadSysEx",sysexData:Array.from(e)})}loadPreset(e){const t=dl[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setAlgorithm(e){this.config.algorithm=Math.max(0,Math.min(31,e)),this.setParameter(Ji,this.config.algorithm)}setFeedback(e){this.config.feedback=Math.max(0,Math.min(7,e)),this.setParameter(el,this.config.feedback)}setOperatorLevel(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Vi,Math.max(0,Math.min(99,t)))}setOperatorCoarse(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Ui,Math.max(0,Math.min(31,t)))}setOperatorFine(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Gi,Math.max(0,Math.min(99,t)))}setOperatorDetune(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Ki,Math.max(0,Math.min(14,t)))}setLfoSpeed(e){this.config.lfoSpeed=Math.max(0,Math.min(99,e)),this.setParameter(nl,this.config.lfoSpeed)}setLfoPitchModDepth(e){this.config.lfoPmd=Math.max(0,Math.min(99,e)),this.setParameter(sl,this.config.lfoPmd)}setLfoAmpModDepth(e){this.config.lfoAmd=Math.max(0,Math.min(99,e)),this.setParameter(rl,this.config.lfoAmd)}setLfoWaveform(e){this.config.lfoWave=Math.max(0,Math.min(5,e)),this.setParameter(il,this.config.lfoWave)}setTranspose(e){this.config.transpose=Math.max(0,Math.min(48,e)),this.setParameter(cl,this.config.transpose)}triggerAttack(e,t,n=1){const a="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi(),s=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}),this):(this.pendingNotes.push({note:a,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi();this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){return this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.dispose(),this}}const pl=0,hl=1,ml=2,fl=3,yl=4,gl=5,vl=6,bl=7,xl=8,wl=9,kl=11,Sl=12,Ml=13,Nl=14,Cl=15,El=16,Pl=17,Tl=18,Al=19,Il=20,_l=21,Ol=22,Fl=23,Dl=24,Rl=25,jl=26,Ll=27,Bl=28,Vl=29,zl=30,Ul=31,Gl=32,Kl=33,Hl=34,Wl=35,$l=36,ql=37,Yl=38,Xl=39,Ql=40,Zl=41,Jl=42,ec=43,tc=44,nc=0,ac=1,sc=0,rc={"Classic Brass":{osc1Waveform:nc,osc2Waveform:nc,osc2Detune:.05,osc1Level:1,osc2Level:.8,filterCutoff:.4,filterResonance:.2,filterEnvAmount:.6,filterAttack:.1,filterDecay:.3,filterSustain:.4,filterRelease:.2,ampAttack:.05,ampDecay:.1,ampSustain:.8,ampRelease:.3},"Fat Lead":{osc1Waveform:nc,osc2Waveform:nc,osc2Octave:-1,osc2Detune:.1,osc1Level:1,osc2Level:1,filterCutoff:.6,filterResonance:.4,filterEnvAmount:.3,lfoRate:.3,lfoOscAmount:.1},"Pulse Pad":{osc1Waveform:ac,osc2Waveform:ac,osc1PulseWidth:.3,osc2PulseWidth:.7,osc2Detune:.02,filterCutoff:.3,filterResonance:.1,filterEnvAmount:.2,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,lfoRate:.15,lfoPwAmount:.3},"Sync Lead":{osc1Waveform:nc,osc2Waveform:nc,osc2Octave:1,oscSync:!0,filterCutoff:.5,filterResonance:.3,filterEnvAmount:.5},Init:{osc1Waveform:nc,osc1Level:1,osc2Level:0,filterCutoff:.7,filterResonance:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3}};class oc extends u{name="OBXdSynth";input;output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){super(),this.output=new p(1),this.config={osc1Waveform:nc,osc1Octave:0,osc1Level:1,osc1PulseWidth:.5,osc2Waveform:nc,osc2Octave:0,osc2Detune:.1,osc2Level:.7,osc2PulseWidth:.5,filterCutoff:.7,filterResonance:.3,filterEnvAmount:.5,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:sc,masterVolume:.7,velocitySensitivity:.5,panSpread:.3,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=this.context,n=t.rawContext||t._context,a="/DEViLBOX/";oc.isWorkletLoaded||(oc.workletLoadPromise||(oc.workletLoadPromise=n.audioWorklet.addModule(`${a}obxd/OBXd.worklet.js`)),await oc.workletLoadPromise,oc.isWorkletLoaded=!0);const[s,r]=await Promise.all([fetch(`${a}obxd/OBXd.wasm`),fetch(`${a}obxd/OBXd.js`)]);if(!s.ok)throw new Error(`Failed to load OBXd.wasm: ${s.status}`);if(!r.ok)throw new Error(`Failed to load OBXd.js: ${r.status}`);const[o,i]=await Promise.all([s.arrayBuffer(),r.text()]),l=i.replace(/import\.meta\.url/g,`"${a}obxd/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=v(n,"obxd-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:o,jsCode:l});const c=this.output.input;this._worklet.connect(c);try{const e=n.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(n.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){if(!this._worklet||!this.isInitialized)return;const t=[["osc1Waveform",pl],["osc1Octave",hl],["osc1Detune",ml],["osc1PulseWidth",fl],["osc1Level",yl],["osc2Waveform",gl],["osc2Octave",vl],["osc2Detune",bl],["osc2PulseWidth",xl],["osc2Level",wl],["filterCutoff",Ml],["filterResonance",Nl],["filterType",Cl],["filterEnvAmount",El],["filterKeyTrack",Pl],["filterVelocity",Tl],["filterAttack",Al],["filterDecay",Il],["filterSustain",_l],["filterRelease",Ol],["ampAttack",Fl],["ampDecay",Dl],["ampSustain",Rl],["ampRelease",jl],["lfoRate",Ll],["lfoWaveform",Bl],["lfoDelay",Vl],["lfoOscAmount",zl],["lfoFilterAmount",Ul],["lfoAmpAmount",Gl],["lfoPwAmount",Kl],["masterVolume",Hl],["voices",Wl],["unisonDetune",ql],["portamento",Yl],["velocitySensitivity",Ql],["panSpread",Xl],["noiseLevel",Zl],["subOscLevel",Jl],["subOscOctave",ec],["drift",tc]];for(const[n,a]of t){const t=e[n];void 0!==t&&this.setParameter(a,t)}void 0!==e.oscSync&&this.setParameter(kl,e.oscSync?1:0),void 0!==e.oscXor&&this.setParameter(Sl,e.oscXor?1:0),void 0!==e.unison&&this.setParameter($l,e.unison?1:0)}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadPreset(e){const t=rc[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setCutoff(e){this.config.filterCutoff=Math.max(0,Math.min(1,e)),this.setParameter(Ml,this.config.filterCutoff)}setResonance(e){this.config.filterResonance=Math.max(0,Math.min(1,e)),this.setParameter(Nl,this.config.filterResonance)}setFilterEnvAmount(e){this.config.filterEnvAmount=Math.max(0,Math.min(1,e)),this.setParameter(El,this.config.filterEnvAmount)}setOsc1Waveform(e){this.config.osc1Waveform=e,this.setParameter(pl,e)}setOsc2Waveform(e){this.config.osc2Waveform=e,this.setParameter(gl,e)}setOsc2Detune(e){this.config.osc2Detune=Math.max(-1,Math.min(1,e)),this.setParameter(bl,this.config.osc2Detune)}setLfoRate(e){this.config.lfoRate=Math.max(0,Math.min(1,e)),this.setParameter(Ll,this.config.lfoRate)}setLfoOscAmount(e){this.config.lfoOscAmount=Math.max(0,Math.min(1,e)),this.setParameter(zl,this.config.lfoOscAmount)}setLfoFilterAmount(e){this.config.lfoFilterAmount=Math.max(0,Math.min(1,e)),this.setParameter(Ul,this.config.lfoFilterAmount)}setPortamento(e){this.config.portamento=Math.max(0,Math.min(1,e)),this.setParameter(Yl,this.config.portamento)}setUnison(e){this.config.unison=e,this.setParameter($l,e?1:0)}setUnisonDetune(e){this.config.unisonDetune=Math.max(0,Math.min(1,e)),this.setParameter(ql,this.config.unisonDetune)}setVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.setParameter(Hl,this.config.masterVolume)}triggerAttack(e,t,n=1){const a="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi(),s=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}),this):(this.pendingNotes.push({note:a,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi();this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){return this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.dispose(),this}}const ic=0,lc=0,cc=0,dc=16,uc=32,pc=96,hc=104,mc=152;class fc extends u{name="CZ101Synth";input=void 0;output;workletNode=null;voices=[];currentPatch=null;isInitialized=!1;initPromise=null;static DEFAULT_PATCH={name:"Init",line1:{waveform1:ic,dcaEnvelope:[{rate:99,level:99},{rate:60,level:80},{rate:40,level:60},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:0,level:0}],dcwEnvelope:[{rate:99,level:99},{rate:50,level:70},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:2,level:2},{rate:0,level:0}]}};constructor(){super(),this.output=new p(1);for(let e=0;e<8;e++)this.voices.push({note:0,velocity:0,active:!1,envStage:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){const e=D().rawContext;if(!e.audioWorklet)throw new Error("AudioWorklet not supported");try{await e.audioWorklet.addModule("/DEViLBOX/cz101/CZ101.worklet.js")}catch(n){if(!n?.message?.includes("already"))throw n}this.workletNode=new AudioWorkletNode(e,"cz101-processor",{numberOfOutputs:1,outputChannelCount:[2]});const t=Xa(this.output);if(!t)throw new Error("Could not find native AudioNode for connection");this.workletNode.connect(t);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch(a){}await new Promise((e,t)=>{const n=setTimeout(()=>t(new Error("CZ101 init timeout")),5e3),a=t=>{"initialized"===t.data.type&&(clearTimeout(n),this.workletNode?.port.removeEventListener("message",a),e())};this.workletNode.port.addEventListener("message",a),this.workletNode.port.start(),this.workletNode.port.postMessage({type:"init"})}),this.isInitialized=!0,this.loadPatch(fc.DEFAULT_PATCH)}writeReg(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"writeReg",register:e,value:t})}midiNoteToPitch(e,t=0){return(e-7<<9)+4*t}encodeDCAStep(e,t,n,a){return(1&e)<<15|(127&t)<<8|(1&n)<<7|127&a}_encodeDCOStep(e,t,n,a,s){return(1&e)<<15|(127&t)<<8|(1&n)<<7|(1&a)<<6|63&s}encodeWaveform(e,t,n,a,s,r){return(7&e)<<13|(7&(t??e))<<10|(void 0!==t?1:0)<<9|(7&n)<<6|(a?1:0)<<5|(3&s)<<3|(r?1:0)<<2}loadPatch(e){if(this.currentPatch=e,this.workletNode)for(let t=0;t<8;t++){const n=this.encodeWaveform(e.line1.waveform1,e.line1.waveform2,lc,e.ringMod??!1,e.noiseMode?2:0,!1);this.writeReg(hc+t,n)}}triggerAttack(e,t,n=.8){const a="string"==typeof e?b(e).toMidi():e;let s=this.voices.findIndex(e=>!e.active);-1===s&&(s=0);const r=this.voices[s];if(r.note=a,r.velocity=Math.floor(127*n),r.active=!0,r.envStage=0,!this.workletNode||!this.currentPatch)return this;const o=this.midiNoteToPitch(a,this.currentPatch.detune??0);this.writeReg(pc+s,o),this.writeReg(mc+s,0);const i=this.currentPatch.line1.dcaEnvelope[0],l=this.encodeDCAStep(0,i.rate,0,Math.floor(i.level*r.velocity/127));this.writeReg(cc+s,l);const c=this.currentPatch.line1.dcwEnvelope[0],d=this.encodeDCAStep(0,c.rate,0,c.level);if(this.writeReg(uc+s,d),this.currentPatch.line1.dcoEnvelope&&this.currentPatch.line1.dcoEnvelope.length>0){const e=this.currentPatch.line1.dcoEnvelope[0],t=this._encodeDCOStep(0,e.rate,0,0,e.level);this.writeReg(dc+s,t)}return this}triggerRelease(e,t){const n="string"==typeof e?b(e).toMidi():e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return this;if(this.voices[a].active=!1,!this.workletNode||!this.currentPatch)return this;const s=this.encodeDCAStep(1,40,0,0);return this.writeReg(cc+a,s),this}setParameter(e,t){}getParameters(){return{}}dispose(){return this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.dispose(),this}}const yc=0,gc=1,vc=2,bc=3,xc=4,wc=5,kc=6,Sc=7,Mc=1,Nc=2,Cc=4;class Ec extends gr{name="CEM3394Synth";chipName="CEM3394";workletFile="CEM3394.worklet.js";processorName="cem3394-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setCutoff(e){this.setParameterById(kc,e)}setResonance(e){this.setParameterById(wc,e)}setFilterModulation(e){this.setParameterById(gc,e)}setPulseWidth(e){this.setParameterById(bc,e)}setWaveform(e){let t=Nc|Cc;if("string"==typeof e)switch(e.toLowerCase()){case"triangle":t=Mc;break;case"sawtooth":case"saw":t=Nc;break;case"pulse":case"square":t=Cc;break;case"all":t=Mc|Nc|Cc}else t=e;this.setParameterById(vc,t)}setVolume(e){this.setParameterById(Sc,e)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_frequency:yc,modulation:gc,wave_select:vc,pulse_width:bc,mixer_balance:xc,resonance:wc,cutoff:kc,volume:Sc}[e];void 0!==n&&this.setParameterById(n,t)}}const Pc=0;class Tc extends gr{name="SCSPSynth";chipName="SCSP";workletFile="SCSP.worklet.js";processorName="scsp-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t/2,a=Math.log2(e/n),s=Math.floor(a)+1,r=Math.round(1024*(e/(n*Math.pow(2,s-1))-1));return{oct:Math.max(-8,Math.min(7,s)),fns:Math.max(0,Math.min(1023,r))}}(e);this.workletNode.port.postMessage({type:"setFrequency",oct:t.oct,fns:t.fns,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",tl:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*31),n=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",sdl:t,sdr:n,slot:this.currentSlot})}setFMLevel(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMLevel",slot:e,level:t})}setFMInputSlot(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMInputSlot",slot:e,inputSlot:t})}setSlot(e){this.currentSlot=Math.max(0,Math.min(31,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r??0})}setEnvelope(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,ar:t,d1r:n,d2r:a,rr:s,dl:r})}setLFO(e,t,n,a,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,plfos:t,alfos:n,freq:a,wave:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Pc,volume:Pc}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Pc,e)}}const Ac={chipName:"TR707",basePath:"/roms/tr707",zipFile:"tr707.zip",combinedFile:"tr707_combined.bin",combinedSize:131072,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768}]},Ic={chipName:"TR707-Expansion",basePath:"/roms/tr707",zipFile:"tr707_expansion.zip",combinedFile:"tr707_expansion.bin",combinedSize:262144,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768},{name:"tr707_expansion.bin",offset:131072,size:131072}]},_c={chipName:"C352",basePath:"/roms/c352",zipFile:"c352.zip",combinedFile:"c352_samples.bin",combinedSize:8388608,files:[{name:"c352_samples_0.bin",offset:0,size:4194304,required:!0},{name:"c352_samples_1.bin",offset:4194304,size:4194304,required:!0}]},Oc={chipName:"K054539",basePath:"/roms/k054539",zipFile:"k054539.zip",combinedFile:"k054539_samples.bin",combinedSize:6291456,files:[{name:"k054539_samples_0.bin",offset:0,size:2097152,required:!0},{name:"k054539_samples_1.bin",offset:2097152,size:1048576,required:!0},{name:"k054539_samples_2.bin",offset:3145728,size:1048576,required:!0},{name:"k054539_samples_3.bin",offset:4194304,size:2097152,required:!0}]},Fc={chipName:"ICS2115",basePath:"/roms/ics2115",zipFile:"ics2115.zip",combinedFile:"ics2115_wavetable.bin",combinedSize:262144,files:[{name:"ics2115_wavetable_0.bin",offset:0,size:262144,required:!0}]},Dc={chipName:"RF5C400",basePath:"/roms/rf5c400",zipFile:"rf5c400.zip",combinedFile:"rf5c400_samples.bin",files:[{name:"rf5c400_samples.bin",offset:0,required:!0}]},Rc={chipName:"ES5503",basePath:"/roms/es5503",zipFile:"es5503.zip",combinedFile:"es5503_wavetable.bin",files:[{name:"es5503_wavetable.bin",offset:0,required:!0}]},jc={chipName:"D50",basePath:"/roms/d50",zipFile:"d50.zip",files:[{name:"d50_firmware.bin",offset:0,size:65536,required:!0},{name:"d50_ic30.bin",offset:65536,size:524288,required:!0},{name:"d50_ic29.bin",offset:589824,size:524288,required:!0}]},Lc={chipName:"VFX",basePath:"/roms/vfx",zipFile:"vfx.zip",files:[{name:"u14.bin",offset:0,size:524288,required:!0},{name:"u15.bin",offset:524288,size:524288,required:!0},{name:"u16.bin",offset:1048576,size:524288,required:!0},{name:"vfx210b-low.bin",offset:1572864,size:65536},{name:"vfx210b-high.bin",offset:1638400,size:65536}]};async function Bc(e){try{if(e.zipFile){const t=`${e.basePath}/${e.zipFile}`,n=await async function(e,t){try{const n=await fetch(Dn(e));if(!n.ok)return null;if((n.headers.get("content-type")||"").includes("text/html"))return null;const a=await n.arrayBuffer();if(a.byteLength<4)return null;const s=new Uint8Array(a,0,4);if(80!==s[0]||75!==s[1])return null;const r=await zn.loadAsync(a),o=t.files.filter(e=>e.size).map(e=>e.offset+e.size),i=o.length>0?Math.max(...o):t.combinedSize||4194304;let l=new Uint8Array(i),c=0;for(const e of t.files){let t=r.file(e.name);if(!t){const n=Object.keys(r.files).find(t=>t.endsWith("/"+e.name)||t===e.name);n&&(t=r.file(n))}if(!t){if(e.required)return null;continue}const n=await t.async("uint8array");e.size&&(n.length,e.size);const a=e.offset+n.length;if(a>l.length){const e=new Uint8Array(a);e.set(l),l=e}l.set(n,e.offset),c++}return 0===c?null:l}catch(n){return null}}(t,e);if(n)return n}if(e.combinedFile)try{const t=await fetch(Dn(`${e.basePath}/${e.combinedFile}`)),n=t.headers.get("content-type")||"";if(t.ok&&!n.includes("text/html")){const n=await t.arrayBuffer(),a=new Uint8Array(n);return e.combinedSize&&(a.length,e.combinedSize),a}}catch(t){}const n=Math.max(...e.files.map(e=>e.offset+(e.size||0))),a=new Uint8Array(n||1048576);let s=0;const r=await Promise.allSettled(e.files.map(async t=>{try{const n=await fetch(Dn(`${e.basePath}/${t.name}`)),r=n.headers.get("content-type")||"";if(!n.ok||r.includes("text/html")){if(t.required)throw new Error(`${t.name} not found (HTTP ${n.status}, type: ${r})`);return}const o=await n.arrayBuffer(),i=new Uint8Array(o);t.size&&(i.length,t.size),a.set(i,t.offset),s++}catch(n){if(t.required)throw n}}));if(0===s)throw new Error(`No ROM files loaded for ${e.chipName}`);if(r.find((t,n)=>"rejected"===t.status&&e.files[n].required))throw new Error(`Required ROM file failed to load for ${e.chipName}`);return a}catch(n){throw new Error(`${e.chipName} ROM files not found or invalid.\nPlease place ROM files in ${e.basePath}/\nRequired files: ${e.files.filter(e=>e.required).map(e=>e.name).join(", ")}`)}}const Vc=1,zc=0,Uc=1,Gc=3,Kc=5,Hc=6,Wc=7,$c=8,qc=10,Yc=12;class Xc extends u{name="VFXSynth";input=void 0;output;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=16e6;static NUM_VOICES=32;constructor(){super(),this.output=new p(1),this.mameEngine=nr.getInstance();for(let e=0;e<Xc.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,looping:!1})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Zs,Xc.CLOCK),0===this.handle)throw new Error("Failed to create ES5506 instance");this.isInitialized=!0;try{const e=await async function(){const e=await Bc(Lc);return[e.slice(0,524288),e.slice(524288,1048576),e.slice(1048576,1572864)]}();for(let t=0;t<e.length;t++)await this.loadSampleROM(t,e[t].buffer)}catch(e){}}async loadSampleROM(e,t){this.isInitialized||await this.init(),this.mameEngine.setRom(e,new Uint8Array(t)),this.romLoaded=!0}writeVoiceReg(e,t,n){if(0===this.handle)return;const a=16*e+t;this.mameEngine.write16(this.handle,a,n)}midiNoteToFreqCount(e,t=44100){const n=440*Math.pow(2,(e-69)/12);return 4294967295&Math.floor(n*Math.pow(2,32)/t)}velocityToVolume(e){const t=e/127,n=Math.pow(t,2);return Math.floor(65535*n)}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return this;const a="string"==typeof e?b(e).toMidi():e,s=this.allocateVoice(),r=this.voices[s];r.note=a,r.velocity=Math.floor(127*n),r.active=!0;const o=this.midiNoteToFreqCount(a);this.writeVoiceReg(s,Uc,o>>>16),this.writeVoiceReg(s,Uc+1,65535&o);const i=this.velocityToVolume(r.velocity);this.writeVoiceReg(s,Gc,i),this.writeVoiceReg(s,Wc,i),this.writeVoiceReg(s,Hc,0);let l=Vc;return this.writeVoiceReg(s,zc,l),this}triggerAttackRelease(e,t=.5,n,a=.8){this.triggerAttack(e,n,a);const s="string"==typeof t?w(t).toSeconds():t;return setTimeout(()=>{this.triggerRelease(e)},1e3*s),this}triggerRelease(e,t){if(!this.isInitialized)return this;const n="string"==typeof e?b(e).toMidi():e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return this;return this.voices[a].active=!1,this.writeVoiceReg(a,Kc,128),this.writeVoiceReg(a,$c,128),this}setFilter(e,t,n){this.writeVoiceReg(e,Yc,Math.floor(65535*t)),this.writeVoiceReg(e,qc,Math.floor(65535*n))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){return 0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.dispose(),this}}const Qc=0,Zc=6144;class Jc extends u{name="D50Synth";input=void 0;output;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=2e7;static NUM_VOICES=16;constructor(){super(),this.output=new p(1),this.mameEngine=nr.getInstance();for(let e=0;e<Jc.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,partialMask:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Js,Jc.CLOCK),0===this.handle)throw new Error("Failed to create Roland SA instance");this.isInitialized=!0;try{const{firmware:e,ic30:t,ic29:n}=await async function(){const e=await Bc(jc);return{firmware:e.slice(0,65536),ic30:e.slice(65536,589824),ic29:e.slice(589824,1114112)}}();await this.loadROMs(t.buffer,n.buffer,e.buffer)}catch(e){}}async loadROMs(e,t,n){this.isInitialized||await this.init(),this.mameEngine.rsaLoadRoms(this.handle,new Uint8Array(e),new Uint8Array(t),new Uint8Array(n)),this.romLoaded=!0}writeControl(e,t){0!==this.handle&&this.mameEngine.write(this.handle,e,t)}_midiNoteToPitch(e,t=0){return e}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e,this.isInitialized}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return this;const a="string"==typeof e?b(e).toMidi():e,s=this.allocateVoice(),r=this.voices[s],o=this._currentPatch?.effects?.chorusRate??0,i=this._midiNoteToPitch(a,o);r.note=a,r.velocity=Math.floor(127*n),r.active=!0,r.partialMask=15;const l=Qc+128*s;return this.writeControl(l+0,i),this.writeControl(l+1,r.velocity),this.writeControl(l+2,1),this}triggerAttackRelease(e,t=.5,n,a=.8){this.triggerAttack(e,n,a);const s="string"==typeof t?w(t).toSeconds():t;return setTimeout(()=>{this.triggerRelease(e)},1e3*s),this}triggerRelease(e,t){if(!this.isInitialized)return this;const n="string"==typeof e?b(e).toMidi():e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return this;this.voices[a].active=!1;const s=Qc+128*a;return this.writeControl(s+2,0),this}setChorus(e,t){this.writeControl(Zc+0,Math.floor(127*e)),this.writeControl(Zc+1,Math.floor(127*t))}setReverb(e){this.writeControl(Zc+16,Math.floor(127*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){return 0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.dispose(),this}}const ed=0,td=1,nd=2,ad=3,sd=4,rd=5,od=6,id=7,ld=8,cd=9,dd=[{ic5:"mks20_15179738.BIN",ic6:"mks20_15179737.BIN",ic7:"mks20_15179736.BIN",ic18:"mks20_15179757.BIN"},{ic5:"mks20_15179741.BIN",ic6:"mks20_15179740.BIN",ic7:"mks20_15179739.BIN",ic18:"mks20_15179757.BIN"},{ic5:"MK80_IC5.bin",ic6:"MK80_IC6.bin",ic7:"MK80_IC7.bin",ic18:"MK80_IC18.bin"}],ud=[{name:"MKS-20: Piano 1",romSet:0},{name:"MKS-20: Piano 2",romSet:0},{name:"MKS-20: Piano 3",romSet:0},{name:"MKS-20: Harpsichord",romSet:1},{name:"MKS-20: Clavi",romSet:1},{name:"MKS-20: Vibraphone",romSet:1},{name:"MKS-20: E-Piano 1",romSet:1},{name:"MKS-20: E-Piano 2",romSet:1},{name:"MK-80: Classic",romSet:2},{name:"MK-80: Special",romSet:2},{name:"MK-80: Blend",romSet:2},{name:"MK-80: Contemporary",romSet:2},{name:"MK-80: A. Piano 1",romSet:2},{name:"MK-80: A. Piano 2",romSet:2},{name:"MK-80: Clavi",romSet:2},{name:"MK-80: Vibraphone",romSet:2}];class pd extends u{name="RdPianoSynth";input=void 0;output;_worklet=null;config;isInitialized=!1;pendingNotes=[];loadedRomSets=new Set;currentPatch=0;romLoadError=!1;_initPromise;static romCache=new Map;static isWorkletLoaded=!1;static workletLoadPromise=null;static wasmBinary=null;static jsCode=null;constructor(e={}){super(),this.output=new p(1),this.config={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.context,t=e.rawContext||e._context;if(!t)return;const n="/DEViLBOX/";if(!pd.isWorkletLoaded){if(!pd.workletLoadPromise){const e=`?v=${Date.now()}`;pd.workletLoadPromise=t.audioWorklet.addModule(`${n}rdpiano/RdPiano.worklet.js${e}`)}await pd.workletLoadPromise,pd.isWorkletLoaded=!0}if(!pd.wasmBinary||!pd.jsCode){const[e,t]=await Promise.all([fetch(`${n}rdpiano/RdPiano.wasm`),fetch(`${n}rdpiano/RdPiano.js`)]);if(!e.ok||!t.ok)throw new Error("Failed to fetch RdPiano WASM files");const[a,s]=await Promise.all([e.arrayBuffer(),t.text()]);pd.jsCode=s.replace(/import\.meta\.url/g,`"${n}rdpiano/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),pd.wasmBinary=a}this._worklet=v(t,"rdpiano-processor"),this._worklet.port.onmessage=e=>{const{type:t}=e.data;if("wasmReady"===t)this.loadROMs();else if("ready"===t){this.isInitialized=!0,this.applyConfig(),null!=this.config.patch&&0!==this.config.patch&&this.selectPatch(this.config.patch);for(const{note:e,velocity:t}of this.pendingNotes)this._worklet?.port.postMessage({type:"noteOn",note:e,velocity:t});this.pendingNotes=[]}},this._worklet.port.postMessage({type:"init",wasmBinary:pd.wasmBinary,jsCode:pd.jsCode});const a=this.output.input;this._worklet.connect(a)}catch(e){}}async loadROMs(){try{const e=`${"/DEViLBOX/"}rdpiano/roms/`,t=await this.fetchROM(e+"RD200_B.bin");if(!t)return void(this.romLoadError=!0);this._worklet?.port.postMessage({type:"loadProgramROM",romData:t}),await new Promise(e=>setTimeout(e,50));const n=this.config.patch||0,a=ud[n].romSet;await this.loadROMSet(a),await new Promise(e=>setTimeout(e,100)),this._worklet?.port.postMessage({type:"initMCU"})}catch(e){this.romLoadError=!0}}async loadROMSet(e){if(this.loadedRomSets.has(e))return!0;if(e<0||e>2)return!1;const t="/DEViLBOX/rdpiano/roms/",n=dd[e],[a,s,r,o]=await Promise.all([this.fetchROM(t+n.ic5),this.fetchROM(t+n.ic6),this.fetchROM(t+n.ic7),this.fetchROM(t+n.ic18)]);return!!(a&&s&&r&&o)&&(this._worklet?.port.postMessage({type:"loadROMSet",setIndex:e,ic5:a,ic6:s,ic7:r,ic18:o}),this.loadedRomSets.add(e),!0)}async fetchROM(e){const t=pd.romCache.get(e);if(t)return t.slice(0);try{const t=await fetch(e);if(!t.ok)return null;const n=await t.arrayBuffer();return pd.romCache.set(e,n),n.slice(0)}catch(n){return null}}applyConfig(){this._worklet&&this.isInitialized&&(null!=this.config.chorusEnabled&&this.setParameter(ed,this.config.chorusEnabled?1:0),null!=this.config.chorusRate&&this.setParameter(td,this.config.chorusRate),null!=this.config.chorusDepth&&this.setParameter(nd,this.config.chorusDepth),null!=this.config.efxEnabled&&this.setParameter(ad,this.config.efxEnabled?1:0),null!=this.config.phaserRate&&this.setParameter(sd,this.config.phaserRate),null!=this.config.phaserDepth&&this.setParameter(rd,this.config.phaserDepth),null!=this.config.tremoloEnabled&&this.setParameter(od,this.config.tremoloEnabled?1:0),null!=this.config.tremoloRate&&this.setParameter(id,this.config.tremoloRate),null!=this.config.tremoloDepth&&this.setParameter(ld,this.config.tremoloDepth),null!=this.config.volume&&this.setParameter(cd,this.config.volume))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}async selectPatch(e){if(e<0||e>=16)return;const t=ud[e];if(!this.loadedRomSets.has(t.romSet)){if(!(await this.loadROMSet(t.romSet)))return}this._worklet?.port.postMessage({type:"selectPatch",patchIndex:e}),this.currentPatch=e}setChorusEnabled(e){this.config.chorusEnabled=e,this.setParameter(ed,e?1:0)}setChorusRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusRate=e,this.setParameter(td,e)}setChorusDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusDepth=e,this.setParameter(nd,e)}setEfxEnabled(e){this.config.efxEnabled=e,this.setParameter(ad,e?1:0)}setPhaserRate(e){e=Math.max(0,Math.min(1,e)),this.config.phaserRate=e,this.setParameter(sd,e)}setPhaserDepth(e){e=Math.max(0,Math.min(1,e)),this.config.phaserDepth=e,this.setParameter(rd,e)}setTremoloEnabled(e){this.config.tremoloEnabled=e,this.setParameter(od,e?1:0)}setTremoloRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloRate=e,this.setParameter(id,e)}setTremoloDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloDepth=e,this.setParameter(ld,e)}setVolume(e){e=Math.max(0,Math.min(1,e)),this.config.volume=e,this.setParameter(cd,e)}triggerAttack(e,t,n=1){const a="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi(),s=Math.round(127*Math.max(0,Math.min(1,n)));return this.romLoadError?this:this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}),this):(this.pendingNotes.push({note:a,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t="string"==typeof e?b(e).toMidi():b(e,"hz").toMidi();this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}getCurrentPatch(){return this.currentPatch}dispose(){return this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.dispose(),this}}const hd=8,md=10,fd=12,yd=50,gd=4096;class vd extends u{name="MU2000Synth";input=void 0;output;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;static CLOCK=33868800;static NUM_VOICES=64;constructor(){super(),this.output=new p(1),this.mameEngine=nr.getInstance();for(let e=0;e<vd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,channel:0,active:!1,startTime:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(er,vd.CLOCK),0===this.handle)throw new Error("Failed to create SWP30 instance");this.isInitialized=!0}async loadWaveROM(e){this.isInitialized||await this.init();const t=new Uint8Array(e);this.mameEngine.setRom(0,t),this.romLoaded=!0}midiNoteToPitch(e,t=0){const n=e-60+t/8192,a=Math.pow(2,n/12);return 65535&Math.floor(8192*a)}velocityToVolume(e){return Math.floor(2*e)}allocateVoice(e){let t=this.voices.findIndex(e=>!e.active);if(-1===t){let n=1/0,a=0;for(let t=0;t<this.voices.length;t++)this.voices[t].channel===e&&this.voices[t].startTime<n&&(n=this.voices[t].startTime,a=t);if(n===1/0)for(let e=0;e<this.voices.length;e++)this.voices[e].startTime<n&&(n=this.voices[e].startTime,a=e);t=a}return t}writeReg(e,t){0!==this.handle&&this.mameEngine.write16(this.handle,e,t)}triggerAttack(e,t,n=.8,a=0){if(!this.isInitialized||!this.romLoaded)return this;const s="string"==typeof e?b(e).toMidi():e,r=this.allocateVoice(a),o=this.voices[r];o.note=s,o.velocity=Math.floor(127*n),o.channel=a,o.active=!0,o.startTime=performance.now();const i=64*r,l=this.midiNoteToPitch(s);this.writeReg(i+fd,l);const c=this.velocityToVolume(o.velocity);return this.writeReg(i+yd,c),this.writeReg(i+hd,0),this.writeReg(i+md,0),this}triggerRelease(e,t){if(!this.isInitialized)return this;const n="string"==typeof e?b(e).toMidi():e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return this;this.voices[a].active=!1;const s=64*a;return this.writeReg(s+yd,0),this}sendMidi(e){0!==this.handle&&this.mameEngine.addMidiEvent(this.handle,e)}setMasterVolume(e){this.writeReg(gd,Math.floor(255*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){return 0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.dispose(),this}}const bd=0;class xd extends gr{name="AICASynth";chipName="AICA";workletFile="AICA.worklet.js";processorName="aica-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",volume:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",pan:t,slot:this.currentSlot})}setSlot(e){this.currentSlot=Math.max(0,Math.min(63,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r})}setEnvelope(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,attack:t,decay1:n,decay2:a,release:s,sustainLevel:r})}setLFO(e,t,n,a,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,pitchDepth:t,ampDepth:n,rate:a,waveform:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:bd,volume:bd}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(bd,e)}}const wd=0,kd=1,Sd=2,Md=3,Nd=4,Cd=5,Ed=6,Pd=7;class Td extends gr{name="ASCSynth";chipName="ASC";workletFile="ASC.worklet.js";processorName="asc-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=(e-128)/128*.5;this.workletNode.port.postMessage({type:"setPanning",width:t})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveform(e){this.writeWavetableSelect(e)}setAttack(e){this.setParameterById(Sd,e)}setDecay(e){this.setParameterById(Md,e)}setSustain(e){this.setParameterById(Nd,e)}setRelease(e){this.setParameterById(Cd,e)}setStereoWidth(e){this.setParameterById(Ed,e)}setDetune(e){this.setParameterById(Pd,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:wd,waveform:kd,attack:Sd,decay:Md,sustain:Nd,release:Cd,stereo_width:Ed,detune:Pd}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Ad=0,Id=1,_d=2,Od=3,Fd=4,Dd=5,Rd=6,jd=7;class Ld extends gr{name="AstrocadeSynth";chipName="Astrocade";workletFile="Astrocade.worklet.js";processorName="astrocade-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVibratoSpeed(e){this.sendMessage("setVibratoSpeed",e)}setVibratoDepth(e){this.sendMessage("setVibratoDepth",e)}setNoiseVolume(e){this.sendMessage("setNoiseVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Ad,vibrato_speed:Id,vibrato_depth:_d,noise_am:Od,noise_mod:Fd,noise_vol:Dd,master_freq:Rd,stereo_width:jd}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Bd=0;class Vd extends gr{name="C352Synth";chipName="C352";workletFile="C352.worklet.js";processorName="c352-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return Bc(_c)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t,a=Math.round(e/n*65536);return Math.max(0,Math.min(65535,a))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,voice:this.currentVoice})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,voice:this.currentVoice})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*255),n=Math.round(e/255*255);this.workletNode.port.postMessage({type:"setPanning",vol_f:t<<8|n,vol_r:t<<8|n,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureVoice(e,t,n,a,s,r,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureVoice",voice:e,bank:t,start:n,end:a,loop:s,freq:r,flags:o})}setVoiceVolume(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVoiceVolume",voice:e,vol_f:t,vol_r:n})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",voice:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",voice:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Bd,volume:Bd}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Bd,e)}}const zd=0,Ud=1,Gd=2,Kd=3,Hd=4,Wd=5,$d=6,qd=7;class Yd extends gr{name="ES5503Synth";chipName="ES5503";workletFile="ES5503.worklet.js";processorName="es5503-processor";currentOsc=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return Bc(Rc)}();await super.initialize(),this.loadWaveData(e,2048)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),osc:this.currentOsc})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,osc:this.currentOsc})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=894886){const n=Math.round(e*Math.pow(2,17)/t);return Math.max(0,Math.min(131071,n))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,osc:this.currentOsc})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,osc:this.currentOsc})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*7);this.workletNode.port.postMessage({type:"setPanning",channel:t,osc:this.currentOsc})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e,osc:this.currentOsc})}setOscillator(e){this.currentOsc=Math.max(0,Math.min(31,e))}setWaveform(e){this.writeWavetableSelect(e)}setWaveSize(e){this.sendMessage("setWaveSize",e)}setResolution(e){this.sendMessage("setResolution",e)}setOscMode(e){this.sendMessage("setOscMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setReleaseTime(e){this.sendMessage("setReleaseTime",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setNumOscillators(e){this.sendMessage("setNumOscillators",e)}loadWaveData(e,t=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadWaveData",waveData:e.buffer,offset:t})}loadWavePage(e,t){this.loadWaveData(e.slice(0,256),256*t)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={waveform:zd,wave_size:Ud,resolution:Gd,osc_mode:Kd,volume:Hd,num_oscillators:Wd,attack_time:$d,release_time:qd}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Xd=0,Qd=1;class Zd extends gr{name="ICS2115Synth";chipName="ICS2115";workletFile="ICS2115.worklet.js";processorName="ics2115-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return Bc(Fc)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",voice:e,reg:t,data:n})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Xd,volume:Xd,active_osc:Qd,voices:Qd}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Xd,e)}setActiveOscillators(e){this.setParameterById(Qd,e)}}const Jd=0,eu=1;class tu extends gr{name="K054539Synth";chipName="K054539";workletFile="K054539.worklet.js";processorName="k054539-processor";currentChannel=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return Bc(Oc)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=261.63){const n=e/t,a=Math.round(4096*n);return Math.max(0,Math.min(65535,a))}(e);this.workletNode.port.postMessage({type:"setChannelPitch",channel:this.currentChannel,delta:t})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(64*(1-e));this.workletNode.port.postMessage({type:"setChannelVolume",channel:this.currentChannel,volume:t})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*14);this.workletNode.port.postMessage({type:"setChannelPan",channel:this.currentChannel,pan:t})}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureChannel(e,t,n,a=0,s=!1,r=!1){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureChannel",channel:e,startAddr:t,loopAddr:n,sampleType:a,loopEnable:s,reverse:r})}setChannelPitch(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPitch",channel:e,delta:t})}setChannelVolume(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelVolume",channel:e,volume:t})}setChannelPan(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPan",channel:e,pan:t})}setChannelGain(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelGain",channel:e,gain:t})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",channel:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",channel:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Jd,volume:Jd,reverb_enable:eu,reverb:eu}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Jd,e)}setReverbEnable(e){this.setParameterById(eu,e?1:0)}}const nu=0,au=1,su=2,ru=3,ou=4,iu=5,lu=6,cu=7,du=8;class uu extends gr{name="MEA8000Synth";chipName="MEA8000";workletFile="MEA8000.worklet.js";processorName="mea8000-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",f1:e,f2:t,f3:n})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setBandwidth(e){this.setParameterById(iu,e)}setInterpTime(e){this.setParameterById(du,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:nu,noise_mode:au,f1_index:su,f2_index:ru,f3_index:ou,bw_index:iu,amplitude:lu,stereo_width:cu,interp_time:du}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const pu=0,hu=1;class mu extends gr{name="RF5C400Synth";chipName="RF5C400";workletFile="RF5C400.worklet.js";processorName="rf5c400-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return Bc(Dc)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,data:t})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:pu,volume:pu,clock:hu}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(pu,e)}setClock(e){this.setParameterById(hu,e)}}const fu=0,yu=1,gu=2,vu=3,bu=4,xu=5,wu=6,ku=7,Su=8,Mu=9,Nu=10,Cu=11,Eu=12;class Pu extends gr{name="SN76477Synth";chipName="SN76477";workletFile="SN76477.worklet.js";processorName="sn76477-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVCOFreq(e){this.sendMessage("setVCOFreq",e)}setSLFFreq(e){this.sendMessage("setSLFFreq",e)}setNoiseFreq(e){this.sendMessage("setNoiseFreq",e)}setVCODutyCycle(e){this.sendMessage("setVCODutyCycle",e)}setMixerMode(e){this.sendMessage("setMixerMode",e)}setEnvelopeMode(e){this.sendMessage("setEnvelopeMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setDecayTime(e){this.sendMessage("setDecayTime",e)}setOneShotTime(e){this.sendMessage("setOneShotTime",e)}setNoiseFilterFreq(e){this.sendMessage("setNoiseFilterFreq",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setVCOMode(e){this.sendMessage("setVCOMode",e)}setChipEnable(e){this.sendMessage("setEnable",e?0:1)}setVCORes(e){this.sendMessage("setVCORes",e)}setVCOCap(e){this.sendMessage("setVCOCap",e)}setVCOVoltage(e){this.sendMessage("setVCOVoltage",e)}setPitchVoltage(e){this.sendMessage("setPitchVoltage",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}static RES_K(e){return 1e3*e}static RES_M(e){return 1e6*e}static CAP_U(e){return 1e-6*e}static CAP_N(e){return 1e-9*e}static CAP_P(e){return 1e-12*e}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_freq:fu,slf_freq:yu,noise_freq:gu,vco_duty_cycle:vu,mixer_mode:bu,envelope_mode:xu,attack_time:wu,decay_time:ku,one_shot_time:Su,noise_filter_freq:Mu,amplitude:Nu,vco_mode:Cu,enable:Eu}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Tu=0,Au=1,Iu=2,_u=3;class Ou extends gr{name="SNKWaveSynth";chipName="SNKWave";workletFile="SNKWave.worklet.js";processorName="snkwave-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e){this.writeWavetableSelect(e)}setCustomWaveform(e,t,n,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setCustomWaveform",b0:e,b1:t,b2:n,b3:a})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Tu,waveform:Au,stereo_width:Iu,detune:_u}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Fu=0,Du=1,Ru=2,ju=3,Lu=4,Bu=5;class Vu extends gr{name="SP0250Synth";chipName="SP0250";workletFile="SP0250.worklet.js";processorName="sp0250-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVowel(e){this.sendMessage("setVowel",e)}setVoiced(e){this.setParameterById(Ru,e?1:0)}setBrightness(e){this.setParameterById(ju,e)}writeFIFO(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeFIFO",index:e,data:t})}setFilterCoeff(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFilterCoeff",filterIdx:e,isB:t,value:n})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Fu,vowel:Du,voiced:Ru,brightness:ju,stereo_width:Lu,filter_mix:Bu}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const zu=0,Uu=1,Gu=2,Ku=3,Hu=4,Wu=5;class $u extends gr{name="TMS36XXSynth";chipName="TMS36XX";workletFile="TMS36XX.worklet.js";processorName="tms36xx-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setStopEnable(e){this.sendMessage("setStopEnable",e)}setOctave(e){this.sendMessage("setOctave",e)}setDecayRate(e){this.setParameterById(Gu,e)}setDetune(e){this.setParameterById(Wu,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:zu,stop_enable:Uu,decay_rate:Gu,octave:Ku,stereo_width:Hu,detune:Wu}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const qu=0,Yu=1,Xu=2,Qu=3,Zu=4,Ju=5,ep=6,tp=7,np=8,ap=9;class sp extends gr{name="TMS5220Synth";chipName="TMS5220";workletFile="TMS5220.worklet.js";processorName="tms5220-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",k1:e,k2:t,k3:n})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setChirpType(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChirpType",value:e})}setEnergy(e){this.setParameterById(Ju,e)}setBrightness(e){this.setParameterById(ap,e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:qu,chirp_type:Yu,k1_index:Xu,k2_index:Qu,k3_index:Zu,energy_index:Ju,pitch_index:ep,noise_mode:tp,stereo_width:np,brightness:ap}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const rp=0,op=1,ip=2,lp=3,cp=4,dp=5,up=6,pp=7,hp=8,mp=9,fp=10,yp=11,gp=12,vp={BASS_1:36,SNARE_1:38,SNARE_2:40,LOW_TOM:41,MID_TOM:47,HI_TOM:50,RIMSHOT:37,COWBELL:56,HANDCLAP:39,TAMBOURINE:54,CLOSED_HIHAT:42,OPEN_HIHAT:46,CRASH:49,RIDE:51};class bp extends gr{name="TR707Synth";chipName="TR707";workletFile="TR707.worklet.js";processorName="tr707-processor";constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(e=!1){if(e)try{return await Bc(Ic)}catch(t){}return Bc(Ac)}(!1);await super.initialize(),this.loadCombinedROM(e);for(let t=0;t<10;t++)this.setParameterById(op+t,.8);this.setParameterById(rp,.8),this.setParameterById(yp,.5),this.setParameterById(gp,.5)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"allNotesOff"})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}loadCombinedROM(e){this.loadROM(0,e)}loadROMs(e,t,n){this.loadROM(0,e),this.loadROM(65536,t),this.loadROM(98304,n)}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setVoiceLevel(e,t){this.setParameterById(op+e,t)}setAccent(e){this.setParameterById(yp,e)}setDecay(e){this.setParameterById(gp,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:rp,bass:op,snare:ip,low_tom:lp,mid_tom:cp,hi_tom:dp,rimshot:up,handclap:pp,hihat:hp,crash:mp,ride:fp,accent:yp,decay:gp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const xp=0,wp=1,kp=2,Sp=3,Mp=4,Np=5,Cp=6,Ep=7;class Pp extends gr{name="UPD931Synth";chipName="UPD931";workletFile="UPD931.worklet.js";processorName="upd931-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveA(e){this.setParameterById(wp,e)}setWaveB(e){this.setParameterById(kp,e)}setMirror(e){this.setParameterById(Sp,e?1:0)}setInvert(e){this.setParameterById(Mp,e?1:0)}setModeA(e){this.setParameterById(Np,e)}setModeB(e){this.setParameterById(Cp,e)}setKeyScaling(e){this.setParameterById(Ep,e?1:0)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:xp,wave_a:wp,wave_b:kp,mirror:Sp,invert:Mp,mode_a:Np,mode_b:Cp,key_scaling:Ep}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Tp=0,Ap=1,Ip=2,_p=3,Op=4,Fp=5,Dp=6,Rp=7,jp=8,Lp=9,Bp=10;class Vp extends gr{name="UPD933Synth";chipName="UPD933";workletFile="UPD933.worklet.js";processorName="upd933-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",wave1:e,wave2:t})}setWindow(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWindow",value:e})}setDCWDepth(e){this.setParameterById(Op,e)}setDCARate(e){this.setParameterById(Fp,e)}setDCWRate(e){this.setParameterById(Dp,e)}setDCODepth(e){this.setParameterById(jp,e)}setRingMod(e){this.setParameterById(Lp,e?1:0)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Tp,waveform1:Ap,waveform2:Ip,window:_p,dcw_depth:Op,dca_rate:Fp,dcw_rate:Dp,dco_rate:Rp,dco_depth:jp,ring_mod:Lp,stereo_width:Bp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const zp=0,Up=1,Gp=2,Kp=3,Hp=4,Wp=5,$p=6;class qp extends gr{name="VotraxSynth";chipName="Votrax";workletFile="Votrax.worklet.js";processorName="votrax-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setPhoneme(e){this.sendMessage("setPhoneme",e)}setInflection(e){this.setParameterById(Gp,e)}setF1Override(e){this.setParameterById(Kp,e)}setF2Override(e){this.setParameterById(Hp,e)}setF3Override(e){this.setParameterById(Wp,e)}writePhone(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writePhone",value:e})}writeInflection(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeInflection",value:e})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:zp,phoneme:Up,inflection:Gp,f1_override:Kp,f2_override:Hp,f3_override:Wp,stereo_width:$p}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Yp=0,Xp=1,Qp=2,Zp=3,Jp=4,eh=5,th=6,nh=7,ah=8,sh=9,rh=10,oh=11,ih=12,lh=13,ch=14,dh=15;class uh extends gr{name="YMF271Synth";chipName="YMF271";workletFile="YMF271.worklet.js";processorName="ymf271-processor";currentGroup=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),group:this.currentGroup})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,group:this.currentGroup})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=16384e3){let n=0,a=0;for(n=0;n<8&&(a=Math.round(1024*e*Math.pow(2,20-n)/t),!(a<1024));n++);return{block:Math.min(7,n),fnum:Math.max(0,Math.min(1023,a))}}(e);this.workletNode.port.postMessage({type:"setFrequency",block:t.block,fnum:t.fnum,group:this.currentGroup})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const a of t)this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:a,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,group:this.currentGroup})}getCarrierOperators(){return{0:[3],1:[2,3],2:[2,3],3:[1,3],4:[1,3],5:[0,2,3],6:[0,2,3],7:[0,1,2,3]}[this.currentAlgorithm%8]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Xp,value:e/15})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Qp,value:e/7})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:ch,value:e/7})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:dh,value:e/3})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d1r",value:t})}setOperatorD2R(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d2r",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"dt",value:t})}setOperatorWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"waveform",value:t})}setGroup(e){this.currentGroup=Math.max(0,Math.min(11,e))}setLFOFrequency(e){this.setParameterById(ih,e/255)}setLFOWaveform(e){this.setParameterById(lh,e/3)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Yp,volume:Yp,algorithm:Xp,feedback:Qp,waveform:Zp,tl:Jp,total_level:Jp,ar:eh,attack:eh,d1r:th,decay1:th,d2r:nh,decay2:nh,rr:ah,release:ah,d1l:sh,decay1_level:sh,multiple:rh,detune:oh,lfo_freq:ih,lfo_wave:lh,pms:ch,ams:dh}[e];void 0!==n&&this.setParameterById(n,t)}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setWaveform(e){this.setParameterById(Zp,e/6)}setAttackRate(e){this.setParameterById(eh,e/31)}setDecay1Rate(e){this.setParameterById(th,e/31)}setDecay2Rate(e){this.setParameterById(nh,e/31)}setReleaseRate(e){this.setParameterById(ah,e/15)}setTotalLevel(e){this.setParameterById(Jp,e/127)}setMultiple(e){this.setParameterById(rh,e/15)}setMasterVolume(e){this.setParameterById(Yp,e)}}const ph=0,hh=1,mh=2,fh=3,yh=4,gh=5,vh=6,bh=10,xh=11,wh=12,kh=13,Sh=14,Mh=15,Nh=16,Ch=17,Eh=18,Ph=19,Th=20;class Ah extends gr{name="YMOPQSynth";chipName="YMOPQ";workletFile="YMOPQ.worklet.js";processorName="ymopq-processor";currentChannel=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=yr(e);this.workletNode.port.postMessage({type:"setFrequency",kc:t.kc,kf:t.kf,channel:this.currentChannel})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const a of t)this.workletNode.port.postMessage({type:"setOperatorParam",channel:this.currentChannel,op:a,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,channel:this.currentChannel})}getCarrierOperators(){return{0:[3],1:[3],2:[3],3:[3],4:[1,3],5:[1,2,3],6:[1,2,3],7:[0,1,2,3]}[this.currentAlgorithm]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setAlgorithm",value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFeedback",value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(fh,e/7)}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(yh,e/3)}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+bh,t/127)}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+xh,t/31)}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+wh,t/31)}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Sh,t/15)}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Mh,t/15)}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Nh,t/15)}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Ch,t/7)}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setLFORate(e){this.sendMessage("setLFORate",e)}setVolume(e){this.sendMessage("setVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n=e.match(/^op(\d+)_(.+)$/);if(n)return void this.setOperatorParamByName(parseInt(n[1]),n[2],t);const a={algorithm:ph,feedback:hh,lfo_rate:mh,lfo_pm_sens:fh,lfo_am_sens:yh,reverb:gh,volume:vh}[e];void 0!==a&&this.setParameterById(a,t)}setOperatorParamByName(e,t,n){const a={total_level:bh,attack_rate:xh,decay_rate:wh,sustain_rate:kh,sustain_level:Sh,release_rate:Mh,multiple:Nh,detune:Ch,waveform:Eh,ksr:Ph,am_enable:Th}[t];void 0!==a&&e>=1&&e<=4&&this.setParameterById(100*e+a,n)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Ih=0,_h=1,Oh=2,Fh=3,Dh=4,Rh=5,jh=6,Lh=7;class Bh extends gr{name="VASynthSynth";chipName="VASynth";workletFile="VASynth.worklet.js";processorName="vasynth-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e){return Math.max(20,Math.min(2e4,e))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setOsc1Wave(e){this.setParameterById(_h,e)}setOsc2Wave(e){this.setParameterById(Oh,e)}setOscMix(e){this.setParameterById(Fh,e)}setOsc2Detune(e){this.setParameterById(Dh,e)}setFilterCutoff(e){this.setParameterById(Rh,e)}setFilterResonance(e){this.setParameterById(jh,e)}setFilterEnvDepth(e){this.setParameterById(Lh,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Ih,osc1_wave:_h,osc2_wave:Oh,osc_mix:Fh,osc2_detune:Dh,filter_cutoff:Rh,filter_res:jh,filter_env_depth:Lh}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Vh={FurnaceNES:oo.NES,FurnaceGB:oo.GB,FurnaceSNES:oo.SNES,FurnacePCE:oo.PCE,FurnacePSG:oo.SMS,FurnaceVB:oo.VBOY,FurnaceLynx:oo.LYNX,FurnaceSWAN:oo.SWAN,FurnaceVRC6:oo.VRC6,FurnaceN163:oo.N163,FurnaceFDS:oo.FDS,FurnaceMMC5:oo.MMC5,FurnaceGBA:oo.GBA_DMA,FurnaceNDS:oo.NDS,FurnacePOKEMINI:oo.POKEMINI,FurnaceC64:oo.C64_6581,FurnaceSID6581:oo.C64_6581,FurnaceSID8580:oo.C64_8580,FurnaceAY:oo.AY8910,FurnaceAY8930:oo.AY8930,FurnaceVIC:oo.VIC20,FurnaceSAA:oo.SAA1099,FurnaceTED:oo.TED,FurnaceVERA:oo.VERA,FurnaceSCC:oo.SCC,FurnaceTIA:oo.TIA,FurnaceAMIGA:oo.AMIGA,FurnacePET:oo.PET,FurnacePCSPKR:oo.PCSPKR,FurnaceZXBEEPER:oo.SFX_BEEPER,FurnacePOKEY:oo.POKEY,FurnacePONG:oo.PONG,FurnacePV1000:oo.PV1000,FurnaceDAVE:oo.DAVE,FurnaceSU:oo.SOUND_UNIT,FurnacePOWERNOISE:oo.POWERNOISE,FurnaceSEGAPCM:oo.SEGAPCM,FurnaceQSOUND:oo.QSOUND,FurnaceES5506:oo.ES5506,FurnaceRF5C68:oo.RF5C68,FurnaceC140:oo.C140,FurnaceK007232:oo.K007232,FurnaceK053260:oo.K053260,FurnaceGA20:oo.GA20,FurnaceOKI:oo.MSM6295,FurnaceYMZ280B:oo.YMZ280B,FurnaceX1_010:oo.X1_010,FurnaceMSM6258:oo.MSM6258,FurnaceMSM5232:oo.MSM5232,FurnaceMULTIPCM:oo.MULTIPCM,FurnaceNAMCO:oo.NAMCO,FurnacePCMDAC:oo.PCM_DAC,FurnaceBUBBLE:oo.BUBSYS_WSG,FurnaceSM8521:oo.SM8521,FurnaceT6W28:oo.T6W28,FurnaceSUPERVISION:oo.SUPERVISION,FurnaceUPD1771:oo.UPD1771C,FurnaceSCVTONE:oo.UPD1771C};class zh{static VOLUME_NORMALIZATION_OFFSETS={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7,PolySynth:8,TB303:15,JC303:15,Buzz3o3:5,Furnace:0,FurnaceOPN:7,FurnaceOPM:2,FurnaceOPL:10,FurnaceOPLL:2,FurnaceESFM:0,FurnaceOPZ:0,FurnaceOPNA:5,FurnaceOPNB:5,FurnaceOPL4:6,FurnaceY8950:6,FurnaceVRC7:2,FurnaceOPN2203:0,FurnaceOPNBB:2,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:3,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:6,FurnaceSID6581:6,FurnaceSID8580:6,FurnaceAY:3,FurnaceAY8930:3,FurnaceVIC:3,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:17,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:3,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:3,FurnaceSU:8,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:5,FurnaceES5506:38,FurnaceRF5C68:0,FurnaceC140:8,FurnaceK007232:-4,FurnaceK053260:3,FurnaceGA20:3,FurnaceOKI:44,FurnaceYMZ280B:14,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:14,FurnaceNAMCO:3,FurnacePCMDAC:-5,FurnaceBUBBLE:3,FurnaceSM8521:3,FurnaceT6W28:3,FurnaceSUPERVISION:3,FurnaceUPD1771:3,BuzzKick:3,BuzzKickXP:5,BuzzNoise:7,BuzzTrilok:5,Buzz4FM2F:7,BuzzFreqBomb:4,Buzz3o3DF:8,Synare:7,DubSiren:13,SpaceLaser:24,V2:0,Sam:16,SuperSaw:9,WobbleBass:13,FormantSynth:9,StringMachine:11,PWMSynth:9,ChipSynth:5,Wavetable:5,Organ:3,Sampler:10,Player:10,GranularSynth:-47,DrumMachine:18,ChiptuneModule:-6,DrumKit:0,MAMEVFX:0,MAMEDOC:0,MAMERSA:0,MAMESWP30:0,CZ101:0,Dexed:41,OBXd:9,CEM3394:19,SCSP:15,MAMEAstrocade:18,MAMESN76477:5,MAMEASC:11,MAMEES5503:62,MAMEMEA8000:12,MAMESNKWave:8,MAMESP0250:26,MAMETMS36XX:6,MAMEVotrax:20,MAMEYMOPQ:19,MAMEUPD931:23,MAMEUPD933:28,MAMETMS5220:37,MAMEYMF271:15,MAMETR707:22,MAMEVASynth:20,MAMEAICA:0,MAMEICS2115:35,MAMEK054539:22,MAMEC352:17,MAMERF5C400:0};static getNormalizedVolume(e,t){return(t??-12)+(this.VOLUME_NORMALIZATION_OFFSETS[e]??0)}static createInstrument(e){let t;switch(e.synthType){case"Synth":case"ChiptuneModule":default:t=this.createSynth(e);break;case"MonoSynth":t=this.createMonoSynth(e);break;case"DuoSynth":t=this.createDuoSynth(e);break;case"FMSynth":t=this.createFMSynth(e);break;case"AMSynth":t=this.createAMSynth(e);break;case"PluckSynth":t=this.createPluckSynth(e);break;case"MetalSynth":t=this.createMetalSynth(e);break;case"MembraneSynth":t=this.createMembraneSynth(e);break;case"NoiseSynth":t=this.createNoiseSynth(e);break;case"TB303":t=this.createTB303(e);break;case"Furnace":t=this.createFurnace(e);break;case"Buzzmachine":t=this.createBuzzmachine(e);break;case"FurnaceOPN":t=this.createFurnaceWithChip(e,Kr.OPN2);break;case"FurnaceOPM":t=this.createFurnaceWithChip(e,Kr.OPM);break;case"FurnaceOPL":t=this.createFurnaceWithChip(e,Kr.OPL3);break;case"FurnaceOPLL":case"FurnaceVRC7":t=this.createFurnaceWithChip(e,Kr.OPLL);break;case"FurnaceESFM":t=this.createFurnaceWithChip(e,Kr.ESFM);break;case"FurnaceOPZ":t=this.createFurnaceWithChip(e,Kr.OPZ);break;case"FurnaceOPNA":t=this.createFurnaceWithChip(e,Kr.OPNA);break;case"FurnaceOPNB":t=this.createFurnaceWithChip(e,Kr.OPNB);break;case"FurnaceOPL4":t=this.createFurnaceWithChip(e,Kr.OPL4);break;case"FurnaceY8950":t=this.createFurnaceWithChip(e,Kr.Y8950);break;case"FurnaceNES":case"FurnaceGB":case"FurnaceSNES":case"FurnacePCE":case"FurnacePSG":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceGBA":case"FurnaceNDS":case"FurnacePOKEMINI":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceAY8930":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSCC":case"FurnaceTIA":case"FurnaceAMIGA":case"FurnacePET":case"FurnacePCSPKR":case"FurnaceZXBEEPER":case"FurnacePOKEY":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceX1_010":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceNAMCO":case"FurnacePCMDAC":case"FurnaceBUBBLE":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":{const n=Vh[e.synthType];t=void 0!==n?new yo(n):this.createFurnaceWithChip(e,Kr.OPN2);break}case"FurnaceOPN2203":t=this.createFurnaceWithChip(e,Kr.OPN);break;case"FurnaceOPNBB":t=this.createFurnaceWithChip(e,Kr.OPNB_B);break;case"Sampler":const n=e.metadata?.modPlayback?.usePeriodPlayback;t=n?this.createPlayer(e):this.createSampler(e);break;case"Player":t=this.createPlayer(e);break;case"Wavetable":t=this.createWavetable(e);break;case"GranularSynth":t=this.createGranularSynth(e);break;case"SuperSaw":t=this.createSuperSaw(e);break;case"PolySynth":t=this.createPolySynth(e);break;case"Organ":t=this.createOrgan(e);break;case"DrumMachine":t=this.createDrumMachine(e);break;case"ChipSynth":t=this.createChipSynth(e);break;case"PWMSynth":t=this.createPWMSynth(e);break;case"StringMachine":t=this.createStringMachine(e);break;case"FormantSynth":t=this.createFormantSynth(e);break;case"WobbleBass":t=this.createWobbleBass(e);break;case"DrumKit":t=this.createDrumKit(e);break;case"DubSiren":t=this.createDubSiren(e);break;case"SpaceLaser":t=this.createSpaceLaser(e);break;case"V2":t=this.createV2(e);break;case"Sam":t=this.createSam(e);break;case"Synare":t=this.createSynare(e);break;case"Dexed":t=this.createDexed(e);break;case"OBXd":t=this.createOBXd(e);break;case"MAMEVFX":case"VFX":t=this.createVFX(e);break;case"D50":t=this.createD50(e);break;case"MAMEDOC":t=new ar({type:"doc"});break;case"MAMERSA":t=this.createRdPiano(e);break;case"MAMESWP30":t=this.createMU2000(e);break;case"CZ101":t=this.createCZ101(e);break;case"CEM3394":t=this.createCEM3394(e);break;case"SCSP":t=this.createSCSP(e);break;case"BuzzDTMF":t=this.createBuzzGenerator(xi.CYANPHASE_DTMF,"BuzzDTMF",e);break;case"BuzzFreqBomb":t=this.createBuzzGenerator(xi.ELENZIL_FREQUENCYBOMB,"BuzzFreqBomb",e);break;case"BuzzKick":t=this.createBuzzGenerator(xi.FSM_KICK,"BuzzKick",e);break;case"BuzzKickXP":t=this.createBuzzGenerator(xi.FSM_KICKXP,"BuzzKickXP",e);break;case"BuzzNoise":t=this.createBuzzGenerator(xi.JESKOLA_NOISE,"BuzzNoise",e);break;case"BuzzTrilok":t=this.createBuzzGenerator(xi.JESKOLA_TRILOK,"BuzzTrilok",e);break;case"Buzz4FM2F":t=this.createBuzzGenerator(xi.MADBRAIN_4FM2F,"Buzz4FM2F",e);break;case"BuzzDynamite6":t=this.createBuzzGenerator(xi.MADBRAIN_DYNAMITE6,"BuzzDynamite6",e);break;case"BuzzM3":t=this.createBuzzGenerator(xi.MAKK_M3,"BuzzM3",e);break;case"Buzz3o3":t=this.createBuzz3o3(e);break;case"Buzz3o3DF":t=this.createBuzz3o3DF(e);break;case"BuzzM4":t=this.createBuzzGenerator(xi.MAKK_M4,"BuzzM4",e);break;case"MAMEAICA":t=this.createMAMEAICA(e);break;case"MAMEASC":t=this.createMAMEASC(e);break;case"MAMEAstrocade":t=this.createMAMEAstrocade(e);break;case"MAMEC352":t=this.createMAMEC352(e);break;case"MAMEES5503":t=this.createMAMEES5503(e);break;case"MAMEICS2115":t=this.createMAMEICS2115(e);break;case"MAMEK054539":t=this.createMAMEK054539(e);break;case"MAMEMEA8000":t=this.createMAMEMEA8000(e);break;case"MAMERF5C400":t=this.createMAMERF5C400(e);break;case"MAMESN76477":t=this.createMAMESN76477(e);break;case"MAMESNKWave":t=this.createMAMESNKWave(e);break;case"MAMESP0250":t=this.createMAMESP0250(e);break;case"MAMETMS36XX":t=this.createMAMETMS36XX(e);break;case"MAMETMS5220":t=this.createMAMETMS5220(e);break;case"MAMETR707":t=this.createMAMETR707(e);break;case"MAMEUPD931":t=this.createMAMEUPD931(e);break;case"MAMEUPD933":t=this.createMAMEUPD933(e);break;case"MAMEVotrax":t=this.createMAMEVotrax(e);break;case"MAMEYMF271":t=this.createMAMEYMF271(e);break;case"MAMEYMOPQ":t=this.createMAMEYMOPQ(e);break;case"MAMEVASynth":t=this.createMAMEVASynth(e)}if(e.synthType.startsWith("Furnace")&&t){const n=this.VOLUME_NORMALIZATION_OFFSETS[e.synthType]??0;0!==n&&"setVolumeOffset"in t&&t.setVolumeOffset(n)}return t}static async createEffectChain(e,t){const n=e.filter(e=>e.enabled);return Promise.all(n.map(e=>this.createEffect(e,t)))}static async createEffect(e,t){const n=e.wet/100;if("neural"===e.category){if(void 0===e.neuralModelIndex)throw new Error("Neural effect requires neuralModelIndex");const t=new Pr({modelIndex:e.neuralModelIndex,wet:n});return await t.loadModel(),Object.entries(e.parameters).forEach(([e,n])=>{t.setParameter(e,n)}),t}let a;switch(e.type){case"Distortion":a=new T({distortion:e.parameters.drive||.4,oversample:e.parameters.oversample||"none",wet:n});break;case"Reverb":{const t=new P({decay:e.parameters.decay||1.5,preDelay:e.parameters.preDelay||.01,wet:n});await t.ready,a=t;break}case"Delay":case"FeedbackDelay":a=new g({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:n});break;case"Chorus":{const t=new m({frequency:e.parameters.frequency||1.5,delayTime:e.parameters.delayTime||3.5,depth:e.parameters.depth||.7,wet:n});t.start(),a=t;break}case"Phaser":a=new f({frequency:e.parameters.frequency||.5,octaves:e.parameters.octaves||3,baseFrequency:e.parameters.baseFrequency||350,wet:n});break;case"Tremolo":{const t=new te({frequency:e.parameters.frequency||10,depth:e.parameters.depth||.5,wet:n});t.start(),a=t;break}case"Vibrato":a=new ee({frequency:e.parameters.frequency||5,depth:e.parameters.depth||.1,wet:n});break;case"AutoFilter":{const t=new J({frequency:e.parameters.frequency||1,baseFrequency:e.parameters.baseFrequency||200,octaves:e.parameters.octaves||2.6,filter:{type:e.parameters.filterType||"lowpass",rolloff:-12,Q:1},wet:n});t.start(),a=t;break}case"AutoPanner":{const t=new Z({frequency:e.parameters.frequency||1,depth:e.parameters.depth||1,wet:n});t.start(),a=t;break}case"AutoWah":a=new Q({baseFrequency:e.parameters.baseFrequency||100,octaves:e.parameters.octaves||6,sensitivity:e.parameters.sensitivity||0,Q:e.parameters.Q||2,gain:e.parameters.gain||2,follower:e.parameters.follower||.1,wet:n});break;case"BitCrusher":a=new X({bits:e.parameters.bits||4,wet:n});break;case"Chebyshev":a=new Y({order:e.parameters.order||50,oversample:e.parameters.oversample||"none",wet:n});break;case"FrequencyShifter":a=new q({frequency:e.parameters.frequency||0,wet:n});break;case"PingPongDelay":a=new $({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:n});break;case"PitchShift":a=new W({pitch:e.parameters.pitch||0,windowSize:e.parameters.windowSize||.1,delayTime:e.parameters.delayTime||0,feedback:e.parameters.feedback||0,wet:n});break;case"Compressor":a=new I({threshold:e.parameters.threshold||-24,ratio:e.parameters.ratio||12,attack:e.parameters.attack||.003,release:e.parameters.release||.25});break;case"EQ3":a=new C({low:e.parameters.low||0,mid:e.parameters.mid||0,high:e.parameters.high||0,lowFrequency:e.parameters.lowFrequency||400,highFrequency:e.parameters.highFrequency||2500});break;case"Filter":a=new y({type:e.parameters.type||"lowpass",frequency:e.parameters.frequency||350,rolloff:e.parameters.rolloff||-12,Q:e.parameters.Q||1,gain:e.parameters.gain||0});break;case"JCReverb":a=new H({roomSize:e.parameters.roomSize||.5,wet:n});break;case"StereoWidener":a=new K({width:e.parameters.width||.5});break;case"TapeSaturation":a=new vr({drive:(e.parameters.drive||50)/100,tone:e.parameters.tone||12e3,wet:n});break;case"SidechainCompressor":a=new Ur({threshold:e.parameters.threshold??-24,ratio:e.parameters.ratio??4,attack:e.parameters.attack??.003,release:e.parameters.release??.25,knee:e.parameters.knee??6,sidechainGain:(e.parameters.sidechainGain??100)/100,wet:n});break;case"SpaceEcho":a=new Tr({mode:Number(e.parameters.mode)||4,rate:Number(e.parameters.rate)||300,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,reverbVolume:Number(e.parameters.reverbVolume)||.3,bass:Number(e.parameters.bass)||0,treble:Number(e.parameters.treble)||0,wet:n});break;case"SpaceyDelayer":a=new Fr({firstTap:Number(e.parameters.firstTap)||250,tapSize:Number(e.parameters.tapSize)||150,feedback:Number(e.parameters.feedback)||40,multiTap:null!=e.parameters.multiTap?Number(e.parameters.multiTap):1,tapeFilter:Number(e.parameters.tapeFilter)||0,wet:n});break;case"RETapeEcho":a=new Br({mode:null!=e.parameters.mode?Number(e.parameters.mode):3,repeatRate:Number(e.parameters.repeatRate)||.5,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,wow:Number(e.parameters.wow)||0,flutter:Number(e.parameters.flutter)||0,dirt:Number(e.parameters.dirt)||0,inputBleed:null!=e.parameters.inputBleed?Number(e.parameters.inputBleed):0,loopAmount:Number(e.parameters.loopAmount)||0,playheadFilter:null!=e.parameters.playheadFilter?Number(e.parameters.playheadFilter):1,wet:n});break;case"BiPhase":a=new Vr({rateA:Number(e.parameters.rateA)||.5,depthA:Number(e.parameters.depthA)||.6,rateB:Number(e.parameters.rateB)||4,depthB:Number(e.parameters.depthB)||.4,feedback:Number(e.parameters.feedback)||.3,routing:1===Number(e.parameters.routing)?"series":"parallel",wet:n});break;case"DubFilter":a=new zr({cutoff:Number(e.parameters.cutoff)||20,resonance:Number(e.parameters.resonance)||1,gain:Number(e.parameters.gain)||1,wet:n});break;case"BuzzDistortion":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ArguruDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzSVF":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakSVF");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDelay":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzChorus":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzCompressor":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikCompressor");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzOverdrive":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikOverdrive");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDistortion2":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzCrossDelay":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaCrossDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzPhilta":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPhilta");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDist2":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakDist2");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzFreeverb":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaFreeverb");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzFreqShift":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("BigyoFrequencyShifter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzNotch":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("CyanPhaseNotch");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzStereoGain":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("DedaCodeStereoGain");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzSoftSat":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GraueSoftSat");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzLimiter":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("LdSLimit");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzExciter":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekExciter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzMasterizer":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekMasterizer");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzStereoDist":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseStereoDist");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzWhiteChorus":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseWhiteChorus");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzZfilter":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("QZfilter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzChorus2":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus2");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzPanzerDelay":{const{BuzzmachineSynth:t}=await Pn(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-CjI0uLt_.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPanzerDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}default:a=new p(1)}return a._fxType=e.type,a}static connectWithEffects(e,t,n){if(0!==t.length){e.connect(t[0]);for(let e=0;e<t.length-1;e++)t[e].connect(t[e+1]);t[t.length-1].connect(n)}else e.connect(n)}static disposeInstrument(e,t){t.forEach(e=>e.dispose()),e.dispose()}static createSynth(e){const t=new ne(ae,{oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("Synth",e.volume)}),n=e.pitchEnvelope;return n?.enabled&&0!==n.amount?{triggerAttackRelease:(e,a,s,r)=>{const o=s??x();this.applyPitchEnvelope(t,n,o,a),t.triggerAttackRelease(e,a,o,r)},triggerAttack:(e,a,s)=>{const r=a??x();this.triggerPitchEnvelopeAttack(t,n,r),t.triggerAttack(e,r,s)},triggerRelease:(e,a)=>{const s=a??x();this.triggerPitchEnvelopeRelease(t,n,s),t.triggerRelease(e,s)},releaseAll:()=>{t.set({detune:0}),t.releaseAll()},connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}:t}static createMonoSynth(e){const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new se(t)}static createDuoSynth(e){return new re({voice0:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:this.getNormalizedVolume("DuoSynth",e.volume)})}static createFMSynth(e){return new ne(V,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},modulationIndex:10,volume:this.getNormalizedVolume("FMSynth",e.volume)})}static createAMSynth(e){return new ne(oe,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("AMSynth",e.volume)})}static createPluckSynth(e){return new ne(ie,{attackNoise:1,dampening:4e3,resonance:.7,volume:this.getNormalizedVolume("PluckSynth",e.volume)})}static createMetalSynth(e){return new le({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MetalSynth",e.volume)})}static createMembraneSynth(e){return new ce({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MembraneSynth",e.volume)})}static createNoiseSynth(e){return new de({noise:{type:"white"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("NoiseSynth",e.volume)})}static createTB303(e){const t=e.tb303||{...Da},n=this.getNormalizedVolume("TB303",e.volume);return this.createDB303(t,n)}static createDB303(e,t){const n=new Qs,a=200,s=2e3,r=(e,t,n)=>e>=0&&e<=1?e:n>100?Math.log(e/t)/Math.log(n/t):(e-t)/(n-t);n.setCutoff(r(e.filter.cutoff,314,2394)),n.setResonance(e.filter.resonance>1?e.filter.resonance/100:e.filter.resonance),n.setEnvMod(e.filterEnvelope.envMod>1?e.filterEnvelope.envMod/100:e.filterEnvelope.envMod),n.setDecay(r(e.filterEnvelope.decay,a,s)),n.setAccent(e.accent.amount>1?e.accent.amount/100:e.accent.amount),n.setWaveform("square"===e.oscillator.type?1:0),void 0!==e.oscillator.pulseWidth&&n.setPulseWidth(e.oscillator.pulseWidth>1?e.oscillator.pulseWidth/100:e.oscillator.pulseWidth),void 0!==e.oscillator.subOscGain&&n.setSubOscGain(e.oscillator.subOscGain>1?e.oscillator.subOscGain/100:e.oscillator.subOscGain),void 0!==e.oscillator.subOscBlend&&n.setSubOscBlend(e.oscillator.subOscBlend>1?e.oscillator.subOscBlend/100:e.oscillator.subOscBlend),n.setVegDecay(r(1230,a,s)),void 0!==e.tuning&&n.setTuning(e.tuning>1?(e.tuning-440)/440:e.tuning);const o=e.devilFish;o&&(void 0!==o.filterFmDepth&&n.setFilterFM(o.filterFmDepth>1?o.filterFmDepth/100:o.filterFmDepth),void 0!==o.accentSweepEnabled&&n.setAccentSweepEnabled(o.accentSweepEnabled),void 0!==o.accentSoftAttack&&n.setAccentSoftAttack(o.accentSoftAttack>1?o.accentSoftAttack/100:o.accentSoftAttack),void 0!==o.passbandCompensation&&n.setPassbandCompensation(o.passbandCompensation>1?o.passbandCompensation/100:o.passbandCompensation),void 0!==o.resTracking&&n.setResTracking(o.resTracking>1?o.resTracking/100:o.resTracking),void 0!==o.duffingAmount&&n.setDuffingAmount(o.duffingAmount>1?o.duffingAmount/100:o.duffingAmount),void 0!==o.lpBpMix&&n.setLpBpMix(o.lpBpMix>1?o.lpBpMix/100:o.lpBpMix),void 0!==o.filterSelect&&n.setFilterSelect(o.filterSelect),void 0!==o.diodeCharacter&&n.setDiodeCharacter(o.diodeCharacter>1?o.diodeCharacter/100:o.diodeCharacter),void 0!==o.normalDecay&&n.setNormalDecay(r(o.normalDecay,a,s)),void 0!==o.accentDecay&&n.setAccentDecay(r(o.accentDecay,a,s)),void 0!==o.softAttack&&n.setSoftAttack(o.softAttack>1?o.softAttack/100:o.softAttack),void 0!==o.muffler&&n.setMuffler(o.muffler),void 0!==o.sweepSpeed&&n.setSweepSpeed(o.sweepSpeed),void 0!==o.highResonance&&n.setHighResonanceEnabled(o.highResonance));const i=e.lfo;i&&(void 0!==i.waveform&&n.setLfoWaveform(i.waveform),void 0!==i.rate&&n.setLfoRate(i.rate>1?i.rate/100:i.rate),void 0!==i.contour&&n.setLfoContour(i.contour>1?i.contour/100:i.contour),void 0!==i.pitchDepth&&n.setLfoPitchDepth(i.pitchDepth>1?i.pitchDepth/100:i.pitchDepth),void 0!==i.pwmDepth&&n.setLfoPwmDepth(i.pwmDepth>1?i.pwmDepth/100:i.pwmDepth),void 0!==i.filterDepth&&n.setLfoFilterDepth(i.filterDepth>1?i.filterDepth/100:i.filterDepth));const l=e.chorus;l&&(void 0!==l.enabled&&n.setChorusEnabled(l.enabled),void 0!==l.mode&&n.setChorusMode(l.mode),void 0!==l.mix&&n.setChorusMix(l.mix>1?l.mix/100:l.mix));const c=e.phaser;c&&(void 0!==c.enabled&&n.setPhaserEnabled(c.enabled),void 0!==c.rate&&n.setPhaserRate(c.rate>1?c.rate/100:c.rate),void 0!==c.depth&&n.setPhaserDepth(c.depth>1?c.depth/100:c.depth),void 0!==c.feedback&&n.setPhaserFeedback(c.feedback>1?c.feedback/100:c.feedback),void 0!==c.mix&&n.setPhaserMix(c.mix>1?c.mix/100:c.mix));const d=e.delay;return d&&(void 0!==d.enabled&&n.setDelayEnabled(d.enabled),void 0!==d.time&&n.setDelayTime(d.time>1?d.time/2e3:d.time),void 0!==d.feedback&&n.setDelayFeedback(d.feedback>1?d.feedback/100:d.feedback),void 0!==d.tone&&n.setDelayTone(d.tone>1?d.tone/100:d.tone),void 0!==d.mix&&n.setDelayMix(d.mix>1?d.mix/100:d.mix),void 0!==d.stereo&&n.setDelaySpread(d.stereo>1?d.stereo/100:d.stereo)),void 0!==t&&n.setVolume(t>1?(t+60)/60:t),n}static createBuzzGenerator(e,t,n){const a=new Si(e),s=this.getNormalizedVolume(t,n.volume);return a.output.gain.value=ue(s),a}static createBuzz3o3(e){const t=new Si(xi.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const a=this.getNormalizedVolume("Buzz3o3",e.volume);t.setVolume(a)}return t}static createWavetable(e){const t=e.wavetable||na,n=new Nr(t);return n.output.gain.value=ue(this.getNormalizedVolume("Wavetable",e.volume)),n}static createSampler(e){if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new pe({urls:e.sample.multiMap,volume:this.getNormalizedVolume("Sampler",e.volume)});const t=e.parameters?.sampleUrl||e.sample?.url,n=e.sample?.baseNote||"C4";if(!t&&e.metadata,t){const a={};return a[n]=t,new pe({urls:a,volume:this.getNormalizedVolume("Sampler",e.volume)})}return new pe({volume:this.getNormalizedVolume("Sampler",e.volume)})}static createPlayer(e){const t=e.parameters?.sampleUrl,n=e.parameters?.reverseMode||"forward";if(t){return new j({url:t,volume:this.getNormalizedVolume("Player",e.volume),reverse:"reverse"===n})}return new j({volume:this.getNormalizedVolume("Player",e.volume)})}static createGranularSynth(e){const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,n=e.granular;if(t){return new he({url:t,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}return new he({grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}static createSuperSaw(e){const t=e.superSaw||la,n=t.detune,a=new ne(ae,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??80)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("SuperSaw",e.volume)}),s=new y({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),r=new m({frequency:4,delayTime:2.5,depth:Math.min(1,n/50),wet:.8});r.start(),a.connect(s),s.connect(r);const o=e.pitchEnvelope,i=o?.enabled&&0!==o.amount;return{triggerAttackRelease:(e,t,n,s)=>{const r=n??x();i&&this.applyPitchEnvelope(a,o,r,t),a.triggerAttackRelease(e,t,r,s)},triggerAttack:(e,t,n)=>{const s=t??x();i&&this.triggerPitchEnvelopeAttack(a,o,s),a.triggerAttack(e,s,n)},triggerRelease:(e,t)=>{const n=t??x();i&&this.triggerPitchEnvelopeRelease(a,o,n),a.triggerRelease(e,n)},releaseAll:()=>{a.set({detune:0}),a.releaseAll()},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{a.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||la;a.set({envelope:{attack:(t.envelope.attack||10)/1e3,decay:(t.envelope.decay||100)/1e3,sustain:(t.envelope.sustain||80)/100,release:(t.envelope.release||300)/1e3}}),s.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),r.set({depth:Math.min(1,t.detune/50)})},volume:a.volume}}static createPolySynth(e){const t=e.polySynth||ca;let n=ae;"FMSynth"===t.voiceType?n=V:"AMSynth"===t.voiceType&&(n=oe);const a=new ne(n,{maxPolyphony:t.voiceCount,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||50)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||500)/1e3},volume:this.getNormalizedVolume("PolySynth",e.volume)}),s=e.pitchEnvelope;return s?.enabled&&0!==s.amount?{triggerAttackRelease:(e,t,n,r)=>{const o=n??x();this.applyPitchEnvelope(a,s,o,t),a.triggerAttackRelease(e,t,o,r)},triggerAttack:(e,t,n)=>{const r=t??x();this.triggerPitchEnvelopeAttack(a,s,r),a.triggerAttack(e,r,n)},triggerRelease:(e,t)=>{const n=t??x();this.triggerPitchEnvelopeRelease(a,s,n),a.triggerRelease(e,n)},releaseAll:()=>{a.set({detune:0}),a.releaseAll()},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>a.dispose(),volume:a.volume}:a}static createOrgan(e){const t=e.organ||da,n=t.drawbars||da.drawbars,a=new p(1),s=new ne(ae,{maxPolyphony:32,oscillator:{type:"sine",partials:[n[0]/8,n[1]/8,n[2]/8,n[3]/8,n[4]/8,n[5]/8,n[6]/8,n[7]/8,n[8]/8]},envelope:{attack:.005,decay:.1,sustain:1,release:.1},volume:this.getNormalizedVolume("Organ",e.volume)});let r=null;return t.rotary?.enabled?(r=new te({frequency:"fast"===t.rotary.speed?6:1,depth:.3,wet:.5}),r.start(),s.connect(r),r.connect(a)):s.connect(a),{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(e,t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(e,t)},releaseAll:()=>s.releaseAll(),connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{s.dispose(),r?.dispose(),a.dispose()},applyConfig:e=>{const t=e||da;s.set({oscillator:{partials:[(t.drawbars[0]||0)/8,(t.drawbars[1]||0)/8,(t.drawbars[2]||0)/8,(t.drawbars[3]||0)/8,(t.drawbars[4]||0)/8,(t.drawbars[5]||0)/8,(t.drawbars[6]||0)/8,(t.drawbars[7]||0)/8,(t.drawbars[8]||0)/8]}}),r&&r.frequency.rampTo("fast"===t.rotary?.speed?6:1,.1)},volume:s.volume}}static createDrumMachine(e){const t=e.drumMachine||ua,n="808"===t.machineType;switch(t.drumType){case"kick":{const a={...n?{pitch:48,pitchDecay:50,tone:40,toneDecay:30,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},...t.kick},s=new ce({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)});let r=s,o=null,i=null;a.drive>0&&(o=new T({distortion:a.drive/100*.5,oversample:"2x",wet:1})),i=new y({type:"lowpass",frequency:a.filterFreq,Q:1,rolloff:-24}),o?(s.connect(o),o.connect(i)):s.connect(i),r=i;const l=b(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(l,t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(l,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{s.dispose(),o?.dispose(),i?.dispose()},applyConfig:e=>{const t=(e||ua).kick;t&&(s.set({pitchDecay:t.envDuration/1e3,octaves:2*Math.log2(t.envAmount),envelope:{decay:t.decay/1e3}}),o&&(o.distortion=t.drive/100*.5),i&&i.frequency.rampTo(t.filterFreq,.1))},volume:s.volume}}case"snare":{const a={...n?{pitch:238,tone:35,toneDecay:200,snappy:55,decay:150,envAmount:2.5,envDuration:25,filterType:"lowpass",filterFreq:2500}:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},...t.snare},s=new ce({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new de({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3,sustain:0,release:.05},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(a.snappy/15-3)}),o=new y({type:a.filterType,frequency:a.filterFreq,Q:2}),i=new p(1);s.connect(i),r.connect(o),o.connect(i);const l=b(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(l,t,n,a),r.triggerAttackRelease(t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(l,t,n),r.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose(),i.dispose()},applyConfig:t=>{const n=(t||DEFAULT_DR_MACHINE).snare;n&&(s.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),r.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(n.snappy/15-3)}),o.set({type:n.filterType,frequency:n.filterFreq}))},volume:s.volume}}case"hihat":{const a={...n?{tone:40,decay:80,metallic:70}:{tone:50,decay:100,metallic:50},...t.hihat};return new le({frequency:n?180+1.5*a.tone:200+2*a.tone,envelope:{attack:.001,decay:a.decay/1e3,release:n?.02:.01},harmonicity:5.1,modulationIndex:32+a.metallic/3,resonance:4e3+40*a.tone,octaves:1.5,volume:e.volume||-12})}case"clap":{const a={...n?{tone:45,decay:120,toneDecay:350,spread:15,filterFreqs:[700,1e3],modulatorFreq:30}:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},...t.clap},s=new p(1),r=new de({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.05},volume:e.volume??-10}),o=new y({type:"highpass",frequency:a.filterFreqs[0],Q:1.2}),i=new y({type:"bandpass",frequency:a.filterFreqs[1],Q:.7}),l=new y({type:"bandpass",frequency:1e3+24*a.tone,Q:2});r.connect(l),l.connect(o),o.connect(i),i.connect(s);const c=[],d=4;for(let t=0;t<d;t++){const n=new de({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3/(t+1),sustain:0,release:.02},volume:(e.volume??-10)-3*t});n.connect(l),c.push(n)}return{triggerAttackRelease:(e,t,n,s)=>{const o=n??x(),i=a.spread/1e3;c.forEach((e,n)=>{const a=o+n*i,r=(s??1)*(1-.15*n);e.triggerAttackRelease(t/(n+1),a,r)}),r.triggerAttackRelease(t,o+d*i,s)},triggerAttack:(e,t,n)=>{const s=t??x(),o=a.spread/1e3;c.forEach((e,t)=>{e.triggerAttack(s+t*o,(n??1)*(1-.15*t))}),r.triggerAttack(s+d*o,n)},triggerRelease:(e,t)=>{r.triggerRelease(t),c.forEach(e=>e.triggerRelease(t))},releaseAll:()=>{try{r.triggerRelease()}catch{}c.forEach(e=>{try{e.triggerRelease()}catch{}})},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{r.dispose(),c.forEach(e=>e.dispose()),o.dispose(),i.dispose(),l.dispose(),s.dispose()},applyConfig:e=>{const t=(e||ua).clap;t&&(r.set({envelope:{decay:t.decay/1e3}}),o.frequency.rampTo(t.filterFreqs[0],.1),i.frequency.rampTo(t.filterFreqs[1],.1),l.frequency.rampTo(1e3+24*t.tone,.1),c.forEach((e,n)=>{e.set({envelope:{decay:t.toneDecay/1e3/(n+1)}})}))},volume:r.volume}}case"tom":{const a={...n?{pitch:160,decay:300,tone:2,toneDecay:50,envAmount:1.5,envDuration:150}:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},...t.tom},s=new ce({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new de({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3,sustain:0,release:.02},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+a.tone/5}),o=new p(1);s.connect(o),r.connect(o);const i=b(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(i,t,n,a),r.triggerAttackRelease(.3*t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(i,t,n),r.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose()},applyConfig:t=>{const n=(t||DEFAULT_DR_MACHINE).tom;n&&(s.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),r.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+n.tone/5}))},volume:s.volume}}case"rimshot":{const a={...n?{decay:45,filterFreqs:[280,450,850],filterQ:8,saturation:2}:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},...t.rimshot},s=new de({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.01},volume:e.volume??-10}),r=new y({type:"bandpass",frequency:a.filterFreqs[0],Q:a.filterQ}),o=new y({type:"bandpass",frequency:a.filterFreqs[1],Q:a.filterQ}),i=new y({type:"bandpass",frequency:a.filterFreqs[2],Q:a.filterQ}),l=new p(1);s.connect(r),s.connect(o),s.connect(i),r.connect(l),o.connect(l),i.connect(l);const c=new T({distortion:a.saturation/5*.8,oversample:"2x",wet:1}),d=new y({type:"highpass",frequency:100,Q:.5});return l.connect(c),c.connect(d),{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>d.connect(e),disconnect:()=>d.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose(),c.dispose(),d.dispose()},applyConfig:e=>{const t=(e||ua).rimshot;t&&(s.set({envelope:{decay:t.decay/1e3}}),r.frequency.rampTo(t.filterFreqs[0],.1),o.frequency.rampTo(t.filterFreqs[1],.1),i.frequency.rampTo(t.filterFreqs[2],.1),r.Q.value=t.filterQ,o.Q.value=t.filterQ,i.Q.value=t.filterQ,c.distortion=t.saturation/5*.8)},volume:s.volume}}case"conga":{const n={pitch:310,decay:180,...t.conga},a=new ae({oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:e.volume??-8}),s=new y({type:"lowpass",frequency:1e4,Q:1});a.connect(s);const r=b(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(r,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(r,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).conga;t&&a.set({envelope:{decay:t.decay/1e3}})},volume:a.volume}}case"cowbell":{const e={decay:400,filterFreq:2640,...t.cowbell},n=new M({type:"square",frequency:540,volume:-6}),a=new M({type:"square",frequency:800,volume:-6}),s=new p(0),r=new p(0),o=new y({type:"bandpass",frequency:e.filterFreq,Q:1}),i=new p(.3);n.connect(i),a.connect(i),i.connect(s),i.connect(r);const l=new p(1);return s.connect(o),r.connect(o),o.connect(l),n.start(),a.start(),{triggerAttackRelease:(t,n,a,o)=>{const i=a??x(),l=o??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.375*l,i+.002),s.gain.linearRampToValueAtTime(0,i+.017),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.001,i+.015),r.gain.exponentialRampToValueAtTime(.125*l,i+.017),r.gain.exponentialRampToValueAtTime(.001,i+.017+e.decay/1e3)},triggerAttack:(t,n,a)=>{const o=n??x(),i=a??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(0,o),s.gain.linearRampToValueAtTime(.375*i,o+.002),s.gain.linearRampToValueAtTime(0,o+.017),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.001,o+.015),r.gain.exponentialRampToValueAtTime(.125*i,o+.017),r.gain.exponentialRampToValueAtTime(.001,o+.017+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),a.stop(),n.dispose(),a.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).cowbell;t&&o.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"clave":{const e={decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450,...t.clave},n=new M({type:"triangle",frequency:e.pitch,volume:-6}),a=new M({type:"sine",frequency:e.pitchSecondary,volume:-8}),s=new p(0),r=new p(0),o=new y({type:"bandpass",frequency:e.filterFreq,Q:5}),i=new T({distortion:.5,oversample:"2x",wet:1}),l=new p(1);return n.connect(s),a.connect(r),s.connect(o),r.connect(o),o.connect(i),i.connect(l),n.start(),a.start(),{triggerAttackRelease:(t,n,a,o)=>{const i=a??x(),l=o??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(.7*l,i),s.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.5*l,i),r.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3)},triggerAttack:(t,n,a)=>{const o=n??x(),i=a??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(.7*i,o),s.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.5*i,o),r.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),a.stop(),n.dispose(),a.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).clave;t&&o.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"maracas":{const n={decay:30,filterFreq:5e3,...t.maracas},a=new de({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.01},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),s=new y({type:"highpass",frequency:n.filterFreq,Q:1});return a.connect(s),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).maracas;t&&(a.set({envelope:{decay:t.decay/1e3}}),s.frequency.rampTo(t.filterFreq,.1))},volume:a.volume}}case"cymbal":{const e={tone:50,decay:2e3,...t.cymbal},n=[263,400,421,474,587,845],a=[],s=new p(.3);for(const t of n){const e=new M({type:"square",frequency:t,volume:-10});e.connect(s),e.start(),a.push(e)}const r=new y({type:"bandpass",frequency:5e3,Q:1}),o=new p(0),i=new y({type:"bandpass",frequency:1e4,Q:1}),l=new p(0),c=new y({type:"highpass",frequency:8e3,Q:1}),d=new p(0);s.connect(r),s.connect(i),s.connect(c),r.connect(o),i.connect(l),c.connect(d);const u=new p(1);o.connect(u),l.connect(u),d.connect(u);const h=.666-e.tone/100*.666,m=.333,f=.666-.666*(1-e.tone/100);return{triggerAttackRelease:(t,n,a,s)=>{const r=a??x(),i=s??1;o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(.001,r),o.gain.exponentialRampToValueAtTime(h*i,r+.01),o.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3),l.gain.cancelScheduledValues(r),l.gain.setValueAtTime(.001,r),l.gain.exponentialRampToValueAtTime(m*i,r+.01),l.gain.exponentialRampToValueAtTime(.001,r+.4),d.gain.cancelScheduledValues(r),d.gain.setValueAtTime(.001,r),d.gain.exponentialRampToValueAtTime(f*i,r+.01),d.gain.exponentialRampToValueAtTime(.001,r+.15)},triggerAttack:(t,n,a)=>{const s=n??x(),r=a??1;o.gain.cancelScheduledValues(s),o.gain.setValueAtTime(.001,s),o.gain.exponentialRampToValueAtTime(h*r,s+.01),o.gain.exponentialRampToValueAtTime(.001,s+e.decay/1e3),l.gain.cancelScheduledValues(s),l.gain.setValueAtTime(.001,s),l.gain.exponentialRampToValueAtTime(m*r,s+.01),l.gain.exponentialRampToValueAtTime(.001,s+.4),d.gain.cancelScheduledValues(s),d.gain.setValueAtTime(.001,s),d.gain.exponentialRampToValueAtTime(f*r,s+.01),d.gain.exponentialRampToValueAtTime(.001,s+.15)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>u.connect(e),disconnect:()=>u.disconnect(),dispose:()=>{a.forEach(e=>{e.stop(),e.dispose()}),s.dispose(),r.dispose(),i.dispose(),c.dispose(),o.dispose(),l.dispose(),d.dispose(),u.dispose()},applyConfig:e=>{},volume:u.gain}}default:return new ce({pitchDecay:.05,octaves:3,envelope:{attack:.001,decay:.3,sustain:0,release:.1},volume:e.volume||-12})}}static createChipSynth(e){const t=e.chipSynth||pa,n=t.arpeggio;let a="square";if("triangle"===t.channel&&(a="triangle"),"noise"===t.channel){const n=new de({noise:{type:"white"},envelope:{attack:(t.envelope?.attack||5)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??0)/100,release:(t.envelope?.release||50)/1e3},volume:e.volume||-12}),a=new X({bits:t.bitDepth,wet:1});return n.connect(a),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{n.dispose(),a.dispose()},applyConfig:e=>{const t=e||pa;n.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),a.bits=t.bitDepth},volume:n.volume}}const s=new ne(ae,{maxPolyphony:32,oscillator:{type:a},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:this.getNormalizedVolume("ChipSynth",e.volume)}),r=new X({bits:t.bitDepth,wet:1});s.connect(r);let o=null,i=null;n?.enabled&&(o=new Gr({config:n,onNoteOn:(e,t,n,a)=>{i&&s.triggerRelease(i,a),s.triggerAttackRelease(e,n,a,t),i=e},onNoteOff:(e,t)=>{s.triggerRelease(e,t),i===e&&(i=null)}}));return{triggerAttackRelease:(e,t,a,r)=>{if(o&&n?.enabled){if(o.start(e,r??1),t&&"number"==typeof t){const n=(a??x())+t;O().scheduleOnce(()=>{o.stop(e)},n)}}else s.triggerAttackRelease(e,t,a,r)},triggerAttack:(e,t,a)=>{o&&n?.enabled?o.start(e,a??1):s.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{o&&n?.enabled?o.stop(e):s.triggerRelease(e,t)},releaseAll:()=>{o&&o.stopAll(),s.releaseAll(),i=null},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{o&&o.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||pa;s.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),r.bits=t.bitDepth},volume:s.volume,updateArpeggio:e=>{o&&e&&o.updateConfig(e)},getArpeggioEngine:()=>o,getCurrentArpeggioStep:()=>o?.getCurrentStep()??0,isArpeggioPlaying:()=>o?.getIsPlaying()??!1}}static createFurnace(e){if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new to(e.furnace)}static createBuzzmachine(e){const t=e.buzzmachine?.machineType||"ArguruDistortion",n=new Si({ArguruDistortion:xi.ARGURU_DISTORTION,ElakDist2:xi.ELAK_DIST2,JeskolaDistortion:xi.JESKOLA_DISTORTION,GeonikOverdrive:xi.GEONIK_OVERDRIVE,GraueSoftSat:xi.GRAUE_SOFTSAT,WhiteNoiseStereoDist:xi.WHITENOISE_STEREODIST,ElakSVF:xi.ELAK_SVF,CyanPhaseNotch:xi.CYANPHASE_NOTCH,QZfilter:xi.Q_ZFILTER,FSMPhilta:xi.FSM_PHILTA,JeskolaDelay:xi.JESKOLA_DELAY,JeskolaCrossDelay:xi.JESKOLA_CROSSDELAY,JeskolaFreeverb:xi.JESKOLA_FREEVERB,FSMPanzerDelay:xi.FSM_PANZERDELAY,FSMChorus:xi.FSM_CHORUS,FSMChorus2:xi.FSM_CHORUS2,WhiteNoiseWhiteChorus:xi.WHITENOISE_WHITECHORUS,BigyoFrequencyShifter:xi.BIGYO_FREQUENCYSHIFTER,GeonikCompressor:xi.GEONIK_COMPRESSOR,LdSLimit:xi.LD_SLIMIT,OomekExciter:xi.OOMEK_EXCITER,OomekMasterizer:xi.OOMEK_MASTERIZER,DedaCodeStereoGain:xi.DEDACODE_STEREOGAIN,FSMKick:xi.FSM_KICK,FSMKickXP:xi.FSM_KICKXP,JeskolaTrilok:xi.JESKOLA_TRILOK,JeskolaNoise:xi.JESKOLA_NOISE,OomekAggressor:xi.OOMEK_AGGRESSOR,MadBrain4FM2F:xi.MADBRAIN_4FM2F,MadBrainDynamite6:xi.MADBRAIN_DYNAMITE6,MakkM3:xi.MAKK_M3,CyanPhaseDTMF:xi.CYANPHASE_DTMF,ElenzilFrequencyBomb:xi.ELENZIL_FREQUENCYBOMB}[t]??xi.ARGURU_DISTORTION),a=this.getNormalizedVolume("Buzzmachine",e.volume);return n.output.gain.value=ue(a),n}static CHIP_DEFAULTS={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]},2:{algorithm:0,feedback:3,operators:[{enabled:!0,mult:2,tl:30,ar:15,dr:4,d2r:0,sl:8,rr:5,dt:0,ws:1,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:2,d2r:0,sl:4,rr:8,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1}]},11:{algorithm:0,feedback:2,operators:[{enabled:!0,mult:4,tl:35,ar:15,dr:5,d2r:0,sl:6,rr:7,dt:0,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:3,d2r:0,sl:3,rr:6,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},4:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},5:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:28,dr:2,d2r:0,sl:2,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},3:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},12:{algorithm:7,feedback:1,operators:[{enabled:!0,mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:50,ar:31,dr:8,d2r:0,sl:8,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},10:{algorithm:4,feedback:4,operators:[{enabled:!0,mult:1,tl:15,ar:25,dr:8,d2r:3,sl:5,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:6,rr:10,dt:1,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},6:{algorithm:6,feedback:2,operators:[{enabled:!0,mult:1,tl:12,ar:31,dr:5,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:0,sl:4,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},9:{algorithm:5,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:31,dr:3,d2r:0,sl:1,rr:10,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:6,d2r:0,sl:3,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},8:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]},15:{algorithm:7,feedback:7,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4,dt:0,am:!1},{enabled:!0,mult:5,tl:45,ar:31,dr:20,d2r:0,sl:10,rr:6,dt:2,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]}};static createFurnaceWithChip(e,t){const n=this.CHIP_DEFAULTS[t]||{algorithm:0,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}]},a={...e.furnace||{algorithm:n.algorithm??0,feedback:n.feedback??0,operators:n.operators||[],macros:[],opMacros:[],wavetables:n.wavetables||[]},chipType:t};return new to(a)}static createPWMSynth(e){const t=e.pwmSynth||ha,n=new ne(ae,{maxPolyphony:32,oscillator:{type:"square"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("PWMSynth",e.volume)}),a=new y({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),s=new m({frequency:t.pwmRate,delayTime:2,depth:t.pwmDepth/100,wet:.6});return s.start(),n.connect(a),a.connect(s),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),a.dispose(),s.dispose()},applyConfig:e=>{const t=e||ha;n.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),a.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),s.set({frequency:t.pwmRate,depth:t.pwmDepth/100})},volume:n.volume}}static createStringMachine(e){const t=e.stringMachine||ma,n=new ne(ae,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.attack||100)/1e3,decay:.2,sustain:.9,release:(t.release||500)/1e3},volume:this.getNormalizedVolume("StringMachine",e.volume)}),a=new m({frequency:t.ensemble.rate,delayTime:3.5,depth:t.ensemble.depth/100,wet:.8});a.start();const s=new y({type:"lowpass",frequency:2e3+80*t.brightness,Q:.5,rolloff:-12});return n.connect(s),s.connect(a),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{n.dispose(),a.dispose(),s.dispose()},applyConfig:e=>{const t=e||ma;n.set({envelope:{attack:t.attack/1e3,release:t.release/1e3}}),a.set({frequency:t.ensemble.rate,depth:t.ensemble.depth/100}),s.frequency.rampTo(2e3+80*t.brightness,.1)},volume:n.volume}}static createFormantSynth(e){const t=e.formantSynth||va,n=fa[t.vowel]||fa.a,a=new ne(ae,{maxPolyphony:32,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("FormantSynth",e.volume)}),s=new y({type:"bandpass",frequency:n.f1,Q:3}),r=new y({type:"bandpass",frequency:n.f2,Q:3}),o=new y({type:"bandpass",frequency:n.f3,Q:3}),i=new p(2);return a.connect(s),a.connect(r),a.connect(o),s.connect(i),r.connect(i),o.connect(i),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{a.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose()},applyConfig:e=>{const t=e||va,n=fa[t.vowel];a.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),s.frequency.rampTo(n.f1,.1),r.frequency.rampTo(n.f2,.1),o.frequency.rampTo(n.f3,.1)},volume:a.volume}}static createWobbleBass(e){const t=e.wobbleBass||ya,n=Math.max(1,t.unison.voices),a=t.unison.detune,s=new ne(ae,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc1.level/100*6-6-6}),r=new ne(ae,{maxPolyphony:32,oscillator:{type:t.osc2.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc2.level/100*6-6-6});s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune});let o=null;t.sub.enabled&&(o=new ne(ae,{maxPolyphony:32,oscillator:{type:"sine"},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.sub.level/100*12-12-6}),o.set({detune:1200*t.sub.octave}));const i=[],l=[];if(n>1)for(let p=1;p<Math.min(n,8);p++){const e=(p/n-.5)*a*2,s=(p/n-.5)*(t.unison.stereoSpread/50),r=new ne(ae,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-12-1.5*n});r.set({detune:1200*t.osc1.octave+e});const o=new N(s);r.connect(o),i.push(r),l.push(o)}let c=null;t.fm.enabled&&t.fm.amount>0&&(c=new ne(V,{maxPolyphony:32,modulationIndex:t.fm.amount/10,harmonicity:t.fm.ratio,envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-6}),c.set({detune:1200*t.osc1.octave}));const d=new p(1),u=new y({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:t.filter.rolloff});let h=null;t.filter.drive>0&&(h=new T({distortion:t.filter.drive/100,oversample:"2x"}));const m=t.filterEnvelope.amount/100,f=t.filter.cutoff,g=4*Math.abs(m),v=new me({baseFrequency:f,octaves:g,attack:t.filterEnvelope.attack/1e3,decay:t.filterEnvelope.decay/1e3,sustain:t.filterEnvelope.sustain/100,release:t.filterEnvelope.release/1e3});(!t.wobbleLFO.enabled||t.filterEnvelope.amount>0)&&v.connect(u.frequency);let b=null;if(t.wobbleLFO.enabled){let e=t.wobbleLFO.rate;if("free"!==t.wobbleLFO.sync){e=(O().bpm.value||120)/60*(({"1/1":1,"1/2":2,"1/2T":3,"1/2D":1.5,"1/4":4,"1/4T":6,"1/4D":3,"1/8":8,"1/8T":12,"1/8D":6,"1/16":16,"1/16T":24,"1/16D":12,"1/32":32,"1/32T":48}[t.wobbleLFO.sync]||4)/4)}const n={sine:"sine",triangle:"triangle",saw:"sawtooth",square:"square",sample_hold:"square"},a=4*f,s=Math.max(20,.1*f),r=Math.min(2e4,f+a*(t.wobbleLFO.amount/100));b=new k({frequency:e,type:n[t.wobbleLFO.shape]||"sine",min:s,max:r,phase:t.wobbleLFO.phase}),b.connect(u.frequency),b.start()}let w=null;if(t.distortion.enabled)switch(t.distortion.type){case"soft":w=new T({distortion:t.distortion.drive/100,oversample:"2x"});break;case"hard":w=new Y({order:Math.floor(1+t.distortion.drive/100*50)});break;case"fuzz":w=new T({distortion:.5+t.distortion.drive/200,oversample:"4x"});break;case"bitcrush":w=new X({bits:Math.max(2,12-Math.floor(t.distortion.drive/10))})}const S=new y({type:"lowpass",frequency:500+t.distortion.tone/100*15e3,Q:.5});let M=[],C=null;if(t.formant.enabled){const e=fa[t.formant.vowel];M=[new y({type:"bandpass",frequency:e.f1,Q:5}),new y({type:"bandpass",frequency:e.f2,Q:5}),new y({type:"bandpass",frequency:e.f3,Q:5})],C=new p(.5)}const E=new p(1);E.gain.value=Math.pow(10,this.getNormalizedVolume("WobbleBass",e.volume)/20),s.connect(d),r.connect(d),o&&o.connect(d),c&&c.connect(d),l.forEach(e=>e.connect(d)),h?(d.connect(h),h.connect(u)):d.connect(u);let P=u;w&&(P.connect(w),P=w),P.connect(S),P=S,C&&M.length>0?(M.forEach(e=>{P.connect(e),e.connect(C)}),C.connect(E),P.connect(E)):P.connect(E);const A=new Set;return{triggerAttackRelease:(e,n,a,l)=>{const d=a??x(),u=l??.8;t.wobbleLFO.retrigger&&b&&(b.phase=t.wobbleLFO.phase),v.triggerAttack(d),s.triggerAttackRelease(e,n,d,u),r.triggerAttackRelease(e,n,d,u),o&&o.triggerAttackRelease(e,n,d,u),c&&c.triggerAttackRelease(e,n,d,u),i.forEach(t=>t.triggerAttackRelease(e,n,d,.6*u))},triggerAttack:(e,n,a)=>{const l=n??x(),d=a??.8;A.add(e),t.wobbleLFO.retrigger&&b&&(b.phase=t.wobbleLFO.phase),v.triggerAttack(l),s.triggerAttack(e,l,d),r.triggerAttack(e,l,d),o&&o.triggerAttack(e,l,d),c&&c.triggerAttack(e,l,d),i.forEach(t=>t.triggerAttack(e,l,.6*d))},triggerRelease:(e,t)=>{const n=t??x();A.delete(e),v.triggerRelease(n),s.triggerRelease(e,n),r.triggerRelease(e,n),o&&o.triggerRelease(e,n),c&&c.triggerRelease(e,n),i.forEach(t=>t.triggerRelease(e,n))},releaseAll:()=>{s.releaseAll(),r.releaseAll(),o&&o.releaseAll(),c&&c.releaseAll(),i.forEach(e=>e.releaseAll()),A.clear()},connect:e=>E.connect(e),disconnect:()=>E.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o&&o.dispose(),c&&c.dispose(),i.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),d.dispose(),u.dispose(),h&&h.dispose(),v.dispose(),b&&b.dispose(),w&&w.dispose(),S.dispose(),M.forEach(e=>e.dispose()),C&&C.dispose(),E.dispose()},applyConfig:e=>{const t=e||ya,n={attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3};s.set({envelope:n}),r.set({envelope:n}),o&&o.set({envelope:n}),c&&c.set({envelope:n}),i.forEach(e=>e.set({envelope:n})),s.volume.rampTo(t.osc1.level/100*6-6-6,.1),r.volume.rampTo(t.osc2.level/100*6-6-6,.1),s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune}),o&&(o.volume.rampTo(t.sub.level/100*12-12-6,.1),o.set({detune:1200*t.sub.octave})),u.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),b&&b.frequency.rampTo(t.wobbleLFO.rate,.1)},volume:s.volume,wobbleLFO:b,filter:u}}static reverseAudioBuffer(e){const t=D().rawContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let n=0;n<e.numberOfChannels;n++){const a=e.getChannelData(n),s=t.getChannelData(n);for(let e=0;e<a.length;e++)s[e]=a[a.length-1-e]}return t}static createDrumKit(e){const t=e.drumKit||Ma;return new go(t)}static applyPitchEnvelope(e,t,n,a){const s=100*t.amount,r=t.sustain/100*s,o=t.attack/1e3;t.decay;const i=t.release/1e3,l=e;if(!l.set)return;l.set({detune:s});setTimeout(()=>{l.set&&l.set({detune:r})},1e3*(n+o-x()));setTimeout(()=>{l.set&&l.set({detune:0})},1e3*(n+a-x())+1e3*i)}static triggerPitchEnvelopeAttack(e,t,n){const a=100*t.amount,s=t.sustain/100*a,r=t.attack/1e3,o=t.decay/1e3,i=e;if(!i.set)return;i.set({detune:a});setTimeout(()=>{i.set&&i.set({detune:s})},1e3*(r+o))}static createDubSiren(e){const t=e.dubSiren||Ca,n=new So(t);return n.volume.value=this.getNormalizedVolume("DubSiren",e.volume),n}static createSpaceLaser(e){const t=e.spaceLaser||Aa,n=new Mo(t);return n.volume.value=this.getNormalizedVolume("SpaceLaser",e.volume),n}static createV2(e){if(e.v2Speech){const t=new bi(e.v2Speech);return t.output.gain.value=ue(this.getNormalizedVolume("V2",e.volume)),t}const t=new vi(e.v2||void 0);return t.output.gain.value=ue(this.getNormalizedVolume("V2",e.volume)),t}static createSam(e){const t=e.sam||Ea,n=new gi(t);return n.output.gain.value=ue(this.getNormalizedVolume("Sam",e.volume)),n}static createSynare(e){const t=e.synare||Ia,n=new No(t);return n.volume.value=this.getNormalizedVolume("Synare",e.volume),n}static createDexed(e){const t=e.dexed||{},n=new ul(t);return n.output.gain.value=ue(this.getNormalizedVolume("Dexed",e.volume)),n}static createOBXd(e){const t=e.obxd||{},n=new oc(t);return n.output.gain.value=ue(this.getNormalizedVolume("OBXd",e.volume)),n}static createCZ101(e){const t=new fc;return t.init(),t.output.gain.value=ue(this.getNormalizedVolume("CZ101",e.volume)),t}static createCEM3394(e){const t=new Ec;return t.output.gain.value=ue(this.getNormalizedVolume("CEM3394",e.volume)),t}static createSCSP(e){const t=new Tc;return t.output.gain.value=ue(this.getNormalizedVolume("SCSP",e.volume)),t}static createVFX(e){const t=new Xc;return t.init(),t.output.gain.value=ue(this.getNormalizedVolume("MAMEVFX",e.volume)),t}static createD50(e){const t=new Jc;return t.init(),t.output.gain.value=ue(this.getNormalizedVolume("MAMERSA",e.volume)),t}static createRdPiano(e){const t=e.rdpiano||{},n=new pd(t);return n.output.gain.value=ue(this.getNormalizedVolume("MAMERSA",e.volume)),n}static createMU2000(e){const t=new vd;return t.init(),t.output.gain.value=ue(this.getNormalizedVolume("MAMESWP30",e.volume)),t}static createBuzz3o3DF(e){const t=new Si(xi.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const a=this.getNormalizedVolume("Buzz3o3DF",e.volume);t.setVolume(a)}return t}static applyChipParameters(e,t){const n=t.parameters;if(n){"number"==typeof n._program&&"function"==typeof e.loadPreset&&e.loadPreset(n._program);for(const[t,a]of Object.entries(n))"_program"!==t&&"number"==typeof a&&e.setParam(t,a)}}static createMAMEAICA(e){const t=new xd;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEAICA",e.volume)),this.applyChipParameters(t,e),t}static createMAMEASC(e){const t=new Td;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEASC",e.volume)),this.applyChipParameters(t,e),t}static createMAMEAstrocade(e){const t=new Ld;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEAstrocade",e.volume)),this.applyChipParameters(t,e),t}static createMAMEC352(e){const t=new Vd;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEC352",e.volume)),this.applyChipParameters(t,e),t}static createMAMEES5503(e){const t=new Yd;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEES5503",e.volume)),this.applyChipParameters(t,e),t}static createMAMEICS2115(e){const t=new Zd;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEICS2115",e.volume)),this.applyChipParameters(t,e),t}static createMAMEK054539(e){const t=new tu;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEK054539",e.volume)),this.applyChipParameters(t,e),t}static createMAMEMEA8000(e){const t=new uu;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEMEA8000",e.volume)),this.applyChipParameters(t,e),t}static createMAMERF5C400(e){const t=new mu;return t.output.gain.value=ue(this.getNormalizedVolume("MAMERF5C400",e.volume)),this.applyChipParameters(t,e),t}static createMAMESN76477(e){const t=new Pu;return t.output.gain.value=ue(this.getNormalizedVolume("MAMESN76477",e.volume)),this.applyChipParameters(t,e),t}static createMAMESNKWave(e){const t=new Ou;return t.output.gain.value=ue(this.getNormalizedVolume("MAMESNKWave",e.volume)),this.applyChipParameters(t,e),t}static createMAMESP0250(e){const t=new Vu;return t.output.gain.value=ue(this.getNormalizedVolume("MAMESP0250",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS36XX(e){const t=new $u;return t.output.gain.value=ue(this.getNormalizedVolume("MAMETMS36XX",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS5220(e){const t=new sp;return t.output.gain.value=ue(this.getNormalizedVolume("MAMETMS5220",e.volume)),this.applyChipParameters(t,e),t}static createMAMETR707(e){const t=new bp;return t.output.gain.value=ue(this.getNormalizedVolume("MAMETR707",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD931(e){const t=new Pp;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEUPD931",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD933(e){const t=new Vp;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEUPD933",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVotrax(e){const t=new qp;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEVotrax",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMF271(e){const t=new uh;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEYMF271",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMOPQ(e){const t=new Ah;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEYMOPQ",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVASynth(e){const t=new Bh;return t.output.gain.value=ue(this.getNormalizedVolume("MAMEVASynth",e.volume)),this.applyChipParameters(t,e),t}static triggerPitchEnvelopeRelease(e,t,n){const a=t.release/1e3,s=e;s.set&&setTimeout(()=>{s.set&&s.set({detune:0})},1e3*a)}}function Uh(e){const t={FurnaceOPN:0,FurnaceOPM:1,FurnaceOPL:2,FurnacePSG:3,FurnaceNES:4,FurnaceGB:5,FurnacePCE:6,FurnaceSCC:7,FurnaceN163:8,FurnaceVRC6:9,FurnaceC64:10,FurnaceOPLL:11,FurnaceAY:12,FurnaceOPNA:13,FurnaceOPNB:14,FurnaceTIA:15,FurnaceFDS:16,FurnaceMMC5:17,FurnaceSAA:18,FurnaceSWAN:19,FurnaceOKI:20,FurnaceES5506:21,FurnaceOPZ:22,FurnaceY8950:23,FurnaceSNES:24,FurnaceLYNX:25,FurnaceOPL4:26,FurnaceSEGAPCM:27,FurnaceYMZ280B:28,FurnaceRF5C68:29,FurnaceGA20:30,FurnaceC140:31,FurnaceQSOUND:32,FurnaceVIC:33,FurnaceTED:34,FurnaceSUPERVISION:35,FurnaceVERA:36,FurnaceSM8521:37,FurnaceBUBBLE:38,FurnaceK007232:39,FurnaceK053260:40,FurnaceX1_010:41,FurnaceUPD1771:42,FurnaceT6W28:43,FurnaceVB:44,FurnaceSID6581:45,FurnaceSID8580:46,FurnaceOPN2203:47,FurnaceOPNBB:48,FurnaceESFM:49,FurnaceAY8930:50,FurnaceNDS:51,FurnaceGBA:52,FurnacePOKEMINI:54,FurnaceNAMCO:55,FurnacePET:56,FurnacePOKEY:57,FurnaceMSM6258:58,FurnaceMSM5232:59,FurnaceMULTIPCM:60,FurnaceAMIGA:61,FurnacePCSPKR:62,FurnacePONG:63,FurnacePV1000:64,FurnaceDAVE:65,FurnaceSU:66,FurnacePOWERNOISE:68,FurnaceZXBEEPER:69,FurnaceSCVTONE:71,FurnacePCMDAC:72,Furnace:0}[e];if(void 0===t)return;const n={...xa,chipType:t,operators:xa.operators.map(e=>({...e}))};return"FurnaceC64"!==e&&"FurnaceSID6581"!==e&&"FurnaceSID8580"!==e||(n.c64={triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:12,r:6,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}),n}const Gh=[[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]];function Kh(e,t=0){if(e>=36&&e<72&&Math.abs(t)<=8){const n=function(e){const t=Math.max(-8,Math.min(7,Math.round(e)));return t<0?t+16:t}(t);return Gh[n][e-36]}const n=e-48+t/128;return Math.round(428/Math.pow(2,n/12))}function Hh(e,t=0){if(e<=0)return-1;const n=3546895/e,a=48+12*Math.log2(n/8287.13);return Math.round(a)}class Wh extends u{name="AmigaFilter";hp_a1=0;hp_a2=0;lp1_a1=0;lp1_a2=0;lp2_a1=0;lp2_a2=0;lp2_b1=0;lp2_b2=0;_ledFilterEnabled=!0;_sampleRate;input;output;_worklet=null;_initialized=!1;_initializing=!1;_retryCount=0;static MAX_RETRIES=3;static _loadPromises=new WeakMap;constructor(){super(),this.input=new p,this.output=new p,this._sampleRate=D().sampleRate,this.setupCoefficients(),this.input.connect(this.output),this.tryInitWorklet()}async tryInitWorklet(){if(this._initialized||this._initializing)return;const e=D();if("running"!==e.state){const t=()=>{"running"===e.state&&this.initWorklet()};return e.on("statechange",t),void setTimeout(()=>{"running"!==e.state||this._initialized||this.initWorklet()},100)}await this.initWorklet()}async initWorklet(){if(!(this._initialized||this._initializing||this._retryCount>=Wh.MAX_RETRIES)){this._initializing=!0;try{const t=this.context,n=t.rawContext||t._context;if(!n||!n.audioWorklet)return void(this._initializing=!1);if("running"!==n.state)return void(this._initializing=!1);const a="/DEViLBOX/",s=`?v=${Date.now()}`;let r=Wh._loadPromises.get(n);r||(r=(async()=>{try{await n.audioWorklet.addModule(`${a}AmigaFilter.worklet.js${s}`)}catch(e){if(!(e?.message?.includes("already")||e?.message?.includes("duplicate")))throw Wh._loadPromises.delete(n),e}})(),Wh._loadPromises.set(n,r)),await r;try{this._worklet=v(n,"amiga-filter-processor")}catch(e){if("InvalidStateError"===e?.name)return this._retryCount++,Wh._loadPromises.delete(n),this._initializing=!1,void(this._retryCount<Wh.MAX_RETRIES&&setTimeout(()=>this.initWorklet(),500));throw e}if(this._worklet&&this._worklet.port.postMessage({type:"INIT",coeffs:{hp:{a1:this.hp_a1,a2:this.hp_a2},lp1:{a1:this.lp1_a1,a2:this.lp1_a2},lp2:{a1:this.lp2_a1,a2:this.lp2_a2,b1:this.lp2_b1,b2:this.lp2_b2}}}),this._worklet){try{this.input.disconnect(this.output)}catch{}A(this.input,this._worklet),A(this._worklet,this.output),this._initialized=!0}else this._initializing=!1}catch(e){this._initializing=!1,this._retryCount++}}}setupCoefficients(){const e=this._sampleRate,t=Math.PI,n=2-Math.cos(2*t*5.128/e),a=n-Math.sqrt(n*n-1);this.hp_a1=1-a,this.hp_a2=a;const s=2-Math.cos(2*t*4420.971/e),r=s-Math.sqrt(s*s-1);this.lp1_a1=1-r,this.lp1_a2=r;const o=1/Math.tan(3090.533*t/e),i=1/.660225;this.lp2_a1=1/(1+i*o+o*o),this.lp2_a2=2*this.lp2_a1,this.lp2_b1=2*(1-o*o)*this.lp2_a1,this.lp2_b2=(1-i*o+o*o)*this.lp2_a1}get ledFilterEnabled(){return this._ledFilterEnabled}set ledFilterEnabled(e){this._ledFilterEnabled=e,this._worklet&&this._worklet.port.postMessage({type:"SET_LED",enabled:e})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this}}class $h{points=[];enabled=!1;sustainPoint=null;loopStart=null;loopEnd=null;tick=0;isKeyOff=!1;currentValue=64;finished=!1;constructor(e){e&&this.init(e)}init(e){this.enabled=e.enabled,this.points=e.points,this.sustainPoint=e.sustainPoint,this.loopStart=e.loopStartPoint,this.loopEnd=e.loopEndPoint,this.reset()}reset(){this.tick=0,this.isKeyOff=!1,this.currentValue=this.points.length>0?this.points[0].value:64,this.finished=!1}keyOff(){this.isKeyOff=!0}tickNext(){if(!this.enabled||0===this.points.length)return 64;if(this.finished)return this.points[this.points.length-1].value;if(!this.isKeyOff&&null!==this.sustainPoint){const e=this.points[this.sustainPoint];if(this.tick>=e.tick)return this.tick=e.tick,this.currentValue=e.value,this.currentValue}if(null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd],t=this.points[this.loopStart];this.tick>=e.tick&&(this.tick=t.tick)}if(this.currentValue=this.interpolate(this.tick),this.tick++,null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd];this.tick>=e.tick&&(this.tick=this.points[this.loopStart].tick)}return this.tick>this.points[this.points.length-1].tick&&(this.finished=!0,this.tick=this.points[this.points.length-1].tick),this.currentValue}interpolate(e){if(0===this.points.length)return 64;if(e<=this.points[0].tick)return this.points[0].value;if(e>=this.points[this.points.length-1].tick)return this.points[this.points.length-1].value;for(let t=0;t<this.points.length-1;t++){const n=this.points[t],a=this.points[t+1];if(e>=n.tick&&e<=a.tick){const t=a.tick-n.tick;if(0===t)return a.value;const s=(a.value-n.value<<16)/t,r=(e-n.tick)*s;return n.value+(r>>16)}}return 64}isEnabled(){return this.enabled}isFinished(){return this.finished}getCurrentValue(){return this.currentValue}}class qh{input;output;analyser;fft;disposed=!1;cachedWaveform=null;cachedFFT=null;constructor(){this.input=new p(1),this.output=new p(1),this.analyser=new fe("waveform",256),this.fft=new ye(1024),this.input.connect(this.analyser),this.input.connect(this.fft),this.input.connect(this.output)}getWaveform(){if(this.disposed)return this.cachedWaveform||new Float32Array(256);const e=this.analyser.getValue();return this.cachedWaveform&&this.cachedWaveform.length===e.length||(this.cachedWaveform=new Float32Array(e.length)),this.cachedWaveform.set(e),this.cachedWaveform}getFFT(){if(this.disposed)return this.cachedFFT||new Float32Array(1024);const e=this.fft.getValue();return this.cachedFFT&&this.cachedFFT.length===e.length||(this.cachedFFT=new Float32Array(e.length)),this.cachedFFT.set(e),this.cachedFFT}getLevel(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}getPeak(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let n=0;n<e.length;n++){const a=Math.abs(e[n]);a>t&&(t=a)}return t}hasActivity(){return this.getPeak()>.001}connectInstrument(e){this.disposed||e.connect(this.input)}disconnectInstrument(e){if(!this.disposed)try{e.disconnect(this.input)}catch{}}dispose(){if(!this.disposed){this.disposed=!0;try{this.input.disconnect(),this.analyser.disconnect(),this.fft.disconnect(),this.output.disconnect(),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.fft.dispose()}catch{}this.cachedWaveform=null,this.cachedFFT=null}}}function Yh(e,t){let n;try{n=e()}catch(a){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=n.getItem(e))?t:null;return s instanceof Promise?s.then(a):a(s)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}const Xh=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>Xh(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>Xh(e)(n)}}},Qh=(e,t)=>(n,a,s)=>{let r={storage:Yh(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1,i=0;const l=new Set,c=new Set;let d=r.storage;if(!d)return e((...e)=>{n(...e)},a,s);const u=()=>{const e=r.partialize({...a()});return d.setItem(r.name,{state:e,version:r.version})},p=s.setState;s.setState=(e,t)=>(p(e,t),u());const h=e((...e)=>(n(...e),u()),a,s);let m;s.getInitialState=()=>h;const f=()=>{var e,t;if(!d)return;const s=++i;o=!1,l.forEach(e=>{var t;return e(null!=(t=a())?t:h)});const p=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=a())?e:h))||void 0;return Xh(d.getItem.bind(d))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(s!==i)return;const[o,l]=e;return m=r.merge(l,null!=(t=a())?t:h),n(m,!0),o?u():void 0}).then(()=>{s===i&&(null==p||p(m,void 0),m=a(),o=!0,c.forEach(e=>e(m)))}).catch(e=>{s===i&&(null==p||p(void 0,e))})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>f(),hasHydrated:()=>o,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},r.skipHydration||f(),m||h},Zh=a()(Qh(Fn(e=>({amigaLimits:!1,linearInterpolation:!0,masterTuning:440,performanceQuality:"high",audioLatency:"balanced",autoLatency:!0,midiPolyphonic:!0,setAmigaLimits:t=>e(e=>{e.amigaLimits=t}),setLinearInterpolation:t=>e(e=>{e.linearInterpolation=t}),setMasterTuning:t=>e(e=>{e.masterTuning=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setAudioLatency:t=>e(e=>{e.audioLatency=t}),setAutoLatency:t=>e(e=>{e.autoLatency=t}),setMidiPolyphonic:t=>e(e=>{e.midiPolyphonic=t})})),{name:"devilbox-settings",partialize:e=>({amigaLimits:e.amigaLimits,linearInterpolation:e.linearInterpolation,masterTuning:e.masterTuning,performanceQuality:e.performanceQuality,audioLatency:e.audioLatency,autoLatency:e.autoLatency,midiPolyphonic:e.midiPolyphonic})}));class Jh{static instance=null;static itFilterWorkletLoaded=!1;static itFilterWorkletPromise=null;masterInput;masterChannel;analyser;fft;wasmInstance=null;instruments;instrumentSynthTypes=new Map;instrumentLoadingPromises=new Map;decodedAudioBuffers=new Map;liveVoiceAllocation=new Map;liveVoicePool=[];static LIVE_VOICE_BASE_CHANNEL=100;static MAX_LIVE_VOICES=16;activeVoices=new Map;masterEffectsNodes=[];masterEffectConfigs=new Map;channelOutputs=new Map;channelMuteStates=new Map;channelPitchState=new Map;channelActivePlayer=new Map;channelLastNote=new Map;static SLIDE_TIME_CONSTANT=.06;static ACCENT_BOOST=1.35;static MIDI_FREQ_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=440*Math.pow(2,(t-69)/12);return e})();static FILTER_CUTOFF_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=100*Math.pow(100,t/127);return e})();static PITCH_CENTS_CACHE=new Map;metronomeSynth=null;metronomeVolume=null;metronomeEnabled=!1;metronomePart=null;amigaFilter;amigaFilterEnabled=!0;instrumentEffectChains=new Map;instrumentAnalysers=new Map;constructor(){this.masterInput=new p(1),this.amigaFilter=new Wh,this.masterChannel=new ge({volume:-6,pan:0}).toDestination(),this.analyser=new fe("waveform",1024),this.fft=new ye(1024),this.masterChannel.connect(this.analyser),this.masterChannel.connect(this.fft),this.masterInput.connect(this.amigaFilter),this.amigaFilter.connect(this.masterChannel),this.instruments=new Map,this.liveVoicePool=[];for(let e=0;e<Jh.MAX_LIVE_VOICES;e++)this.liveVoicePool.push(Jh.LIVE_VOICE_BASE_CHANNEL+e)}static getInstance(){return Jh.instance||(Jh.instance=new Jh),Jh.instance}async decodeAudioData(e){if(e instanceof AudioBuffer)return e;if(e instanceof Uint8Array){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await D().rawContext.decodeAudioData(t)}if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer type: "+typeof e);return await D().rawContext.decodeAudioData(e.slice(0))}async encodeAudioData(e){return e.getChannelData(0).buffer.slice(0)}getDecodedBuffer(e){return this.decodedAudioBuffers.get(e)}getWasmInstance(){return this.wasmInstance}async init(){"interactive"!==D().latencyHint&&ve(new be({latencyHint:"interactive",lookAhead:.05})),"suspended"===D().state&&await xe();const e=Zh.getState().audioLatency||"balanced";this.setAudioLatency(e),O().bpm.value=125;const t=D(),n=qa(t),a=t.rawContext||t._context;"running"!==n.state&&await new Promise(e=>{const t=()=>{"running"===n.state?e():setTimeout(t,10)};t()});let s=null;const r=async()=>{if(s)return s;const e=await fetch("/DEViLBOX/DevilboxDSP.wasm");if(e.ok){s=await e.arrayBuffer();try{const e={env:{abort:()=>{}}},{instance:t}=await WebAssembly.instantiate(s,e);this.wasmInstance=t.exports,this.wasmInstance.init&&this.wasmInstance.init()}catch(t){}return s}return null};Jh.itFilterWorkletLoaded||(Jh.itFilterWorkletPromise||(Jh.itFilterWorkletPromise=(async()=>{try{const e="/DEViLBOX/";await a.audioWorklet.addModule(`${e}ITFilter.worklet.js`);const t=await r();if(t){const e=v(a,"it-filter-processor");e.port.postMessage({type:"init",wasmBinary:t}),e.disconnect()}Jh.itFilterWorkletLoaded=!0}catch(e){e?.message?.includes("already")||e?.message?.includes("duplicate")||(Jh.itFilterWorkletPromise=null)}})()),await Jh.itFilterWorkletPromise);try{const e=Wr.getInstance();await e.init(D())}catch(o){}}getContextState(){return D().state}async preloadInstruments(e){e.forEach(e=>{const t=this.getInstrumentKey(e.id,-1);this.instruments.has(t)&&this.disposeInstrument(e.id)});const t=e.filter(e=>"Sampler"===e.synthType||"Player"===e.synthType),n=e.filter(e=>"Sam"===e.synthType||"V2"===e.synthType&&e.v2Speech);e.filter(e=>"Sampler"!==e.synthType&&"Player"!==e.synthType&&"Sam"!==e.synthType&&!("V2"===e.synthType&&e.v2Speech)).forEach(e=>{this.getInstrument(e.id,e)}),t.forEach(e=>{this.getInstrument(e.id,e)});const a=[];if(n.forEach(e=>{const t=this.getInstrument(e.id,e);t?.ready&&a.push(t.ready())}),t.length>0)try{await we();const e=Array.from(this.instrumentLoadingPromises.values());e.length>0&&await Promise.all(e)}catch(o){}if(a.length>0)try{await Promise.all(a)}catch(o){}const s=e.filter(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType);if(s.length>0){const e=[];for(const t of s){const n=this.getInstrumentKey(t.id,-1),a=this.instruments.get(n);a?.ensureInitialized&&e.push(a.ensureInitialized())}if(e.length>0)try{await Promise.all(e)}catch(o){}}const r=["MetalSynth","MembraneSynth","NoiseSynth","FMSynth"];for(const l of e)if(r.includes(l.synthType||"")){const e=this.getInstrumentKey(l.id,-1),t=this.instruments.get(e);if(t)try{const e=t.volume.value;t.volume.value=-1/0,"NoiseSynth"===l.synthType||"MetalSynth"===l.synthType?t.triggerAttackRelease(.001,x()):"MembraneSynth"===l.synthType?t.triggerAttackRelease("C2",.001,x()):t.triggerAttackRelease?.("C4",.001,x()),t.volume.value=e}catch(i){}}}async ensureWASMSynthsReady(e){const t=e.filter(e=>["TB303","Buzz3o3","V2","Sam","Synare","DubSiren","SpaceLaser","Dexed","OBXd"].includes(e.synthType||""));if(0===t.length)return;const n=[];for(const a of t){const e=this.getInstrument(a.id,a);e?.ensureInitialized&&n.push(e.ensureInitialized())}n.length>0&&await Promise.all(n)}setMasterVolume(e){this.masterChannel.volume.value=e}setMasterMute(e){this.masterChannel.mute=e}_currentLatency="";setAudioLatency(e){if(this._currentLatency===e)return;this._currentLatency=e;let t=.05;switch(e){case"interactive":t=.01;break;case"balanced":t=.05;break;case"playback":t=.15}D().lookAhead=t}setAmigaFilter(e){this.amigaFilterEnabled=e,this.amigaFilter.ledFilterEnabled=e}getAmigaFilterEnabled(){return this.amigaFilterEnabled}processInstrumentTicks(e=x()){this.instruments.forEach(t=>{t&&"function"==typeof t.processTick&&t.processTick(e)})}setBPM(e){const t=O();"started"===t.state?t.bpm.rampTo(e,.02):t.bpm.value=e}getBPM(){return O().bpm.value}async start(){"suspended"===D().state&&await xe(),O().start()}stop(){this.releaseAll();const e=this.masterChannel.volume.value;this.masterChannel.volume.value=-1/0,setTimeout(()=>{this.masterChannel.volume.value=e},50),O().stop()}pause(){O().pause()}getPosition(){return O().position}setPosition(e){O().position=e}getInstrumentKey(e,t){return`${e}-${t??-1}`}lastTriggerTime=0;getSafeTime(e){if("running"!==ke.state)return null;const t=null==e||isNaN(e)||e<=0?Se():x();let n;return n=null!=e&&!isNaN(e)&&e>0?e:t+.001,n<=this.lastTriggerTime&&(n=this.lastTriggerTime+5e-4),this.lastTriggerTime=n,n}getImmediateTime(){let e=Se();return e<=this.lastTriggerTime&&(e=this.lastTriggerTime+1e-4),this.lastTriggerTime=e,e}getInstrument(e,t,n){const a=t.synthType?.startsWith("MAME")||"CZ101"===t.synthType||"CEM3394"===t.synthType||"SCSP"===t.synthType,s=t.synthType?.startsWith("Furnace")||"Furnace"===t.synthType,r=t.synthType?.startsWith("Buzz")||"Buzzmachine"===t.synthType,o=["TB303","V2","Sam","DubSiren","SpaceLaser","Synare","Dexed","OBXd"].includes(t.synthType||""),i="Sampler"===t.synthType||"Player"===t.synthType||a||s||r||o,l=i?this.getInstrumentKey(e,-1):this.getInstrumentKey(e,n);if(this.instruments.has(l))return this.instruments.get(l);const c=void 0!==n&&n>=Jh.LIVE_VOICE_BASE_CHANNEL,d=this.getInstrumentKey(e,-1);if(!i&&!c&&this.instruments.has(d))return this.instruments.get(d);let u;switch(t.synthType){case"Synth":const n="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;u=new ne({voice:ae,maxPolyphony:n,options:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"MonoSynth":u=new se({oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume||-12});break;case"DuoSynth":u=new re({voice0:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},vibratoAmount:t.oscillator?.detune?t.oscillator.detune/100:.5,vibratoRate:5,volume:t.volume||-12});break;case"FMSynth":const a="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?6:3;u=new ne({voice:V,maxPolyphony:a,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},modulationIndex:10},volume:t.volume||-12});break;case"AMSynth":const s="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;u=new ne({voice:oe,maxPolyphony:s,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"PluckSynth":const r="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;u=new ne({voice:ie,maxPolyphony:r,options:{attackNoise:1,dampening:t.filter?.frequency||4e3,resonance:.7},volume:t.volume||-12});break;case"MetalSynth":u=new de({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??100)/1e3,sustain:0,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"MembraneSynth":u=new ae({oscillator:{type:"sine"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??400)/1e3,sustain:.01,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"NoiseSynth":{const e=new de({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume??-12});if(t.filter&&"lowpass"!==t.filter.type){const n=new y({type:t.filter.type,frequency:t.filter.frequency,Q:t.filter.Q||1,rolloff:t.filter.rolloff||-12});e.connect(n),u={triggerAttackRelease:(t,n,a)=>{e.triggerAttackRelease(t,n,a)},triggerAttack:(t,n)=>{e.triggerAttack(t,n)},triggerRelease:t=>{e.triggerRelease(t)},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{e.dispose(),n.dispose()},volume:e.volume}}else u=e;break}case"TB303":case"SuperSaw":case"PolySynth":case"Organ":case"DrumMachine":case"ChipSynth":case"PWMSynth":case"StringMachine":case"FormantSynth":case"Wavetable":case"WobbleBass":case"Furnace":case"FurnaceOPN":case"FurnaceOPM":case"FurnaceOPL":case"FurnaceOPLL":case"FurnaceOPZ":case"FurnaceOPNA":case"FurnaceOPNB":case"FurnaceOPL4":case"FurnaceY8950":case"FurnaceESFM":case"FurnaceNES":case"FurnaceGB":case"FurnacePSG":case"FurnacePCE":case"FurnaceSNES":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceVRC7":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceSCC":case"FurnaceX1_010":case"FurnaceBUBBLE":case"FurnaceTIA":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":case"FurnaceOPN2203":case"FurnaceOPNBB":case"FurnaceAY8930":case"FurnaceNDS":case"FurnaceGBA":case"FurnacePOKEMINI":case"FurnaceNAMCO":case"FurnacePET":case"FurnacePOKEY":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceAMIGA":case"FurnacePCSPKR":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceZXBEEPER":case"FurnaceSCVTONE":case"FurnacePCMDAC":case"DrumKit":case"ChiptuneModule":case"Dexed":case"OBXd":case"MAMEVFX":case"MAMEDOC":case"MAMERSA":case"MAMESWP30":case"CZ101":case"CEM3394":case"SCSP":case"MAMEAICA":case"MAMEASC":case"MAMEAstrocade":case"MAMEC352":case"MAMEES5503":case"MAMEICS2115":case"MAMEK054539":case"MAMEMEA8000":case"MAMEMSM5232":case"MAMERF5C400":case"MAMESN76477":case"MAMESNKWave":case"MAMESP0250":case"MAMETIA":case"MAMETMS36XX":case"MAMETMS5220":case"MAMETR707":case"MAMEUPD931":case"MAMEUPD933":case"MAMEVotrax":case"MAMEYMF271":case"MAMEYMOPQ":case"MAMEVASynth":case"BuzzDTMF":case"BuzzFreqBomb":case"BuzzKick":case"BuzzKickXP":case"BuzzNoise":case"BuzzTrilok":case"Buzz4FM2F":case"BuzzDynamite6":case"BuzzM3":case"Buzz3o3":case"DubSiren":case"SpaceLaser":case"V2":case"Sam":case"Synare":case"Buzzmachine":u=zh.createInstrument(t);break;case"Sampler":{let n=t.parameters?.sampleUrl||t.sample?.url;const a=t.sample?.baseNote||"C4",s=!0===t.sample?.loop,r=t.sample?.loopStart||0,o=t.sample?.loopEnd||0,i=t.sample?.audioBuffer;if(n&&n.startsWith("blob:")&&(n=void 0),n&&(n=Dn(n)),i){let n=i;if("string"==typeof i)try{const e=atob(i),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);n=t.buffer}catch(p){n=null}if(n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||s){u=new j({loop:s,volume:t.volume||0}),this.instrumentSynthTypes.set(l,"Player");const a=n,i=u,c=(async()=>{try{const n=await this.decodeAudioData(a);if(i.buffer=new R(n),s){const e=t.sample?.sampleRate||8363,a=n.duration;i.loopStart=Math.min(r/e,a-1e-4),i.loopEnd=Math.min(o/e,a),i.loopEnd<=i.loopStart&&(i.loopEnd=a)}this.decodedAudioBuffers.set(e,n)}catch(n){}})();this.instrumentLoadingPromises.set(l,c)}else{u=new pe({volume:t.volume||-12}),this.instrumentSynthTypes.set(l,"Sampler");const s=n,r=u,o=(async()=>{try{const t=await this.decodeAudioData(s),n=new R(t);r.add(a,n),this.decodedAudioBuffers.set(e,t)}catch(t){}})();this.instrumentLoadingPromises.set(l,o)}}}if(!u&&n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||s){const a=new j({url:n,loop:s,volume:t.volume||0,onload:()=>{if(s){const e=t.sample?.sampleRate||8363,n=a.buffer.get(),s=n?n.duration:0;s>0&&(a.loopStart=Math.min(r/e,s-1e-4),a.loopEnd=Math.min(o/e,s),a.loopEnd<=a.loopStart&&(a.loopEnd=s))}const n=a.buffer.get();n&&this.decodedAudioBuffers.set(e,n)},onerror:e=>{}});u=a,this.instrumentSynthTypes.set(l,"Player")}else{const e=t.sample?.multiMap||{};t.sample?.multiMap||(e[a]=n),u=new pe({urls:e,volume:t.volume||-12,onerror:e=>{}}),this.instrumentSynthTypes.set(l,"Sampler")}}u||(u=new pe({volume:t.volume||-12}));break}case"Player":{const e=t.parameters?.sampleUrl;u=new j(e?{url:e,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{volume:t.volume||-12});break}case"GranularSynth":{const e=t.granular?.sampleUrl||t.parameters?.sampleUrl,n=t.granular;u=new he(e?{url:e,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{grainSize:.1,overlap:.5,loop:!0,volume:t.volume||-12});break}default:return eo(t.synthType||"Unknown",`Unsupported synth type "${t.synthType}". This instrument cannot produce sound.`,{synthName:t.name,errorType:"init",debugData:{synthType:t.synthType,instrumentId:e}}),null}return u?(t.filter&&u.filter&&(u.filter.type=t.filter.type,u.filter.frequency.value=t.filter.frequency,u.filter.Q.value=t.filter.Q),this.instruments.set(l,u),this.instrumentSynthTypes.has(l)||this.instrumentSynthTypes.set(l,t.synthType),this.buildInstrumentEffectChain(l,t.effects||[],u).catch(e=>{}),u):null}getInstrumentAnalyser(e){let t=this.instrumentAnalysers.get(e);if(t)return t;t=new qh,t.output.connect(this.masterInput);return this.instrumentEffectChains.forEach((n,a)=>{const[s]=String(a).split("-");if(s===String(e))try{n.output.disconnect(this.masterInput),n.output.connect(t.input)}catch(r){}}),this.instrumentAnalysers.set(e,t),t}disposeInstrumentAnalyser(e){const t=this.instrumentAnalysers.get(e);if(!t)return;const n=this.getInstrumentKey(e,-1);let a=this.instruments.get(n);if(!a)for(const[s,r]of this.instruments)if(s.startsWith(`${e}-`)){a=r;break}if(a){try{a.disconnect()}catch{}const e=this.instrumentEffectChains.get(n);e?e.effects.length>0?a.connect(e.effects[0]):a.connect(e.output):a.connect(this.masterInput)}t.dispose(),this.instrumentAnalysers.delete(e)}disposeAllInstrumentAnalysers(){this.instrumentAnalysers.forEach((e,t)=>{this.disposeInstrumentAnalyser(t)})}applyAutomation(e,t,n,a){const s=this.getInstrumentKey(e,a),r=this.instruments.get(s);if(!r){const a=this.instruments.get(this.getInstrumentKey(e,-1));if(!a)return;return void this.applyAutomationToInstrument(a,t,n)}this.applyAutomationToInstrument(r,t,n)}applyAutomationToInstrument(e,t,n){const a=this.getSafeTime();if(null!==a)try{switch(t){case"cutoff":if(e instanceof Qs){const t=200*Math.pow(100,n);e.setCutoff(t)}else if(e.filter){const t=200*Math.pow(100,n);e.filter.frequency.setValueAtTime(t,a)}break;case"resonance":e instanceof Qs?e.setResonance(100*n):e.filter&&e.filter.Q.setValueAtTime(10*n,a);break;case"envMod":e instanceof Qs&&e.setEnvMod(100*n);break;case"volume":const t=40*n-40;e.volume.setValueAtTime(t,a);break;case"pan":const s=2*n-1;e.pan&&e.pan.setValueAtTime(s,a);break;case"decay":if(e instanceof Qs){const t=30+2970*n;e.setDecay(t)}break;case"accent":e instanceof Qs&&e.setAccentAmount(100*n);break;case"tuning":if(e instanceof Qs){const t=200*(n-.5);e.setTuning(t)}break;case"overdrive":e instanceof Qs&&e.setOverdrive(100*n);break;case"normalDecay":if(e instanceof Qs){const t=30+2970*n;e.setNormalDecay(t)}break;case"accentDecay":if(e instanceof Qs){const t=30+2970*n;e.setAccentDecay(t)}break;case"vegDecay":if(e instanceof Qs){const t=16+2984*n;e.setVegDecay(t)}break;case"vegSustain":e instanceof Qs&&e.setVegSustain(100*n);break;case"softAttack":if(e instanceof Qs){const t=.3*Math.pow(100,n);e.setSoftAttack(t)}break;case"filterTracking":e instanceof Qs&&e.setFilterTracking(200*n);break;case"filterFM":e instanceof Qs&&e.setFilterFM(100*n)}}catch(s){}}applySlideAndAccent(e,t,n,a,s,r,o,i){let l=a;if(s&&(l=Math.min(1,a*Jh.ACCENT_BOOST)),r&&void 0!==o){const a=this.channelLastNote.get(o);if(a&&a.frequency>0){let s=null;if(e.oscillator?.frequency?s=e.oscillator.frequency:e.voice0?.oscillator?.frequency?s=e.voice0.oscillator.frequency:e.frequency&&(s=e.frequency),s)try{s.setValueAtTime(a.frequency,n),s.setTargetAtTime(t,n,Jh.SLIDE_TIME_CONSTANT)}catch(c){}}}return void 0!==o&&void 0!==i&&this.channelLastNote.set(o,{frequency:t,time:n,instrumentId:i}),l}triggerNoteAttack(e,t,n,a=1,s,r,o,i,l,c){const d=this.getInstrument(e,s,l);if(!d)return;if(!(d.triggerAttack||d.start))return;const u=s.isLive?this.getImmediateTime():this.getSafeTime(n);if(null!==u)try{if(d instanceof Qs)d.triggerAttack(t,u,a,o,i);else if(d instanceof Qs)d.triggerAttack(t,u,a,o,i,c);else if("NoiseSynth"===s.synthType)d.triggerAttack(u,a);else if("Sampler"===s.synthType){const n=this.getInstrumentKey(e,void 0);if("Player"===this.instrumentSynthTypes.get(n)){const e=d;if(!e.buffer||!e.buffer.loaded)return;const n=a>0?G(a):-1/0;if(e.volume.value=n,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let n=r;if(0!==t.finetune){const e=Hh(r,0);e>=0&&(n=Kh(e,t.finetune))}const a=t.periodMultiplier/n,o=a/(s.sample?.sampleRate||8363);e.playbackRate=o}else{const n=s.sample?.baseNote||"C4",a=b(n).toFrequency(),r=b(t).toFrequency()/a;e.playbackRate=r}e.start(u)}else{const e=d;if(!e.loaded)return;e.triggerAttack(t,u,a)}}else if("Player"===s.synthType||"GranularSynth"===s.synthType){const e=d;if(!e.buffer||!e.buffer.loaded)return;const n=a>0?G(a):-1/0;if(e.volume.value=n,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let n=r;if(0!==t.finetune){const e=Hh(r,0);e>=0&&(n=Kh(e,t.finetune))}const a=t.periodMultiplier/n,o=a/(s.sample?.sampleRate||8363);e.playbackRate=o}else{const n=s.sample?.baseNote||"C4",a=b(n).toFrequency(),r=b(t).toFrequency()/a;e.playbackRate=r}e.start(u)}else if("NoiseSynth"===s.synthType){const e=d,t=o?Math.min(1,a*Jh.ACCENT_BOOST):a;e.triggerAttack(u,t)}else if("MetalSynth"===s.synthType){const e=d,t=o?Math.min(1,a*Jh.ACCENT_BOOST):a;e.triggerAttack(u,t)}else if("MembraneSynth"===s.synthType){const e=d,n=o?Math.min(1,a*Jh.ACCENT_BOOST):a;e.triggerAttack(t,u,n)}else if("BuzzmachineGenerator"===d.constructor.name)d.triggerAttack(t,u,a,o,i);else{const n=b(t).toFrequency(),s=this.applySlideAndAccent(d,n,u,a,o,i,l,e);d.triggerAttack(t,u,s)}}catch(p){}}triggerNoteRelease(e,t,n,a,s){const r=this.getInstrument(e,a,s);if(!r||!r.triggerRelease)return;const o=a.isLive?this.getImmediateTime():this.getSafeTime(n);if(null!==o)try{if("Sampler"===a.synthType){const e=r;if(!e.loaded)return;return void e.triggerRelease(t,o)}if("Player"===a.synthType||"GranularSynth"===a.synthType){const e=r;return void("started"===e.state&&e.stop(o))}"NoiseSynth"===a.synthType||"MonoSynth"===a.synthType||"DuoSynth"===a.synthType||"MetalSynth"===a.synthType||"MembraneSynth"===a.synthType||"TB303"===a.synthType||"DubSiren"===a.synthType||"Synare"===a.synthType||"Furnace"===a.synthType||"BuzzKick"===a.synthType||"BuzzKickXP"===a.synthType||"BuzzNoise"===a.synthType||"BuzzTrilok"===a.synthType||"Buzz4FM2F"===a.synthType||"BuzzDynamite6"===a.synthType||"BuzzM3"===a.synthType||"Buzz3o3"===a.synthType||"SpaceLaser"===a.synthType||"Sam"===a.synthType||"V2"===a.synthType||"V2Speech"===a.synthType||"MAMEVFX"===a.synthType||"MAMEDOC"===a.synthType||"MAMERSA"===a.synthType||"MAMESWP30"===a.synthType||"CZ101"===a.synthType||"CEM3394"===a.synthType||"SCSP"===a.synthType||a.synthType.startsWith("MAME")?r.triggerRelease(o):r.triggerRelease(t,o)}catch(i){}}static NATIVE_POLY_TYPES=new Set(["Synth","FMSynth","AMSynth","PluckSynth","Sampler","SuperSaw","PolySynth","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth","Wavetable","WobbleBass"]);triggerPolyNoteAttack(e,t,n,a,s=!1,r=!1){!0===a.monophonic&&(r||this.releaseAllPolyNotes(e,a));const o=a.synthType;if((!o||Jh.NATIVE_POLY_TYPES.has(o))&&!0!==a.monophonic){this.liveVoiceAllocation.set(t,-1);const o=a.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,o,n,a,void 0,s,r)}if("TB303"===o||"Buzz3o3"===o){r||this.releaseAllPolyNotes(e,a),this.liveVoiceAllocation.set(t,-1);const o=a.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,o,n,a,void 0,s,r)}if(this.liveVoiceAllocation.has(t)&&(r||this.triggerPolyNoteRelease(e,t,a)),0===this.liveVoicePool.length)return;const i=this.liveVoicePool.shift();this.liveVoiceAllocation.set(t,i);const l=this.getImmediateTime();this.triggerNoteAttack(e,t,l,n,a,void 0,s,r,i)}triggerPolyNoteRelease(e,t,n){const a=this.liveVoiceAllocation.get(t);if(void 0===a)return;this.liveVoiceAllocation.delete(t);const s=n.isLive?this.getImmediateTime():0;-1===a?this.triggerNoteRelease(e,t,s,n):(this.triggerNoteRelease(e,t,s,n,a),this.liveVoicePool.push(a))}releaseAllPolyNotes(e,t){for(const[n,a]of this.liveVoiceAllocation.entries())-1===a?this.triggerNoteRelease(e,n,0,t):(this.triggerNoteRelease(e,n,0,t,a),this.liveVoicePool.push(a));this.liveVoiceAllocation.clear()}hasActivePolyNotes(){return this.liveVoiceAllocation.size>0}releaseNote(e,t,n,a){const s=this.getInstrumentKey(e,a);let r=this.instruments.get(s);if(r||(r=this.instruments.get(this.getInstrumentKey(e,-1))),!r)return;const o=this.getSafeTime(n);if(null===o)return;const i=this.instrumentSynthTypes.get(s)||this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if("Sampler"===i){const e=r;if(e.loaded&&e.triggerRelease)try{e.triggerRelease(t,o)}catch{}return}if("Player"===i||"GranularSynth"===i){const e=r;if("started"===e.state)try{e.stop(o)}catch{}return}if(!r.triggerRelease)return;const l="MonoSynth"===i||"DuoSynth"===i||"MetalSynth"===i||"MembraneSynth"===i||"NoiseSynth"===i||"TB303"===i||"Buzz3o3"===i||"BuzzKick"===i||"BuzzKickXP"===i||"BuzzNoise"===i||"BuzzTrilok"===i||"Buzz4FM2F"===i||"BuzzDynamite6"===i||"BuzzM3"===i||"DubSiren"===i||"Synare"===i;try{l?r.triggerRelease(o):r.triggerRelease(t,o)}catch{try{r.triggerRelease(o)}catch{}}}triggerNote(e,t,n,a,s=1,r,o,i,l,c,d,u=0,p){const h=this.getSafeTime(a);if(null===h)return;const m=this.getInstrument(e,r,l);if(m){if(void 0!==l){let n,a=this.activeVoices.get(l)||[];0===u?(a.forEach(e=>{e.instrument!==m&&this.stopVoice(e,h)}),a=a.filter(e=>e.instrument===m)):a.forEach(e=>{2===u&&e.volumeEnv.keyOff(),3===u&&(e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024))}),"Sampler"===r.synthType||"Player"===r.synthType?(n=new j(m.buffer),n.loop=m.loop,n.loopStart=m.loopStart,n.loopEnd=m.loopEnd):n="Synth"===r.synthType?new ae(m.get()):m;const p=a.findIndex(e=>e.instrument===n);if(p>=0)a[p].note=t;else{const e=this.createVoice(l,n,t,r);n.connect(e.nodes.gain),a.push(e)}this.activeVoices.set(l,a);try{if(n instanceof j){const e=s>0?G(s):-1/0;if(n.volume.value=e,r.metadata?.modPlayback?.usePeriodPlayback&&c){const e=r.metadata.modPlayback.periodMultiplier/c,t=r.sample?.sampleRate||8363;n.playbackRate=e/t}else{const e=r.sample?.baseNote||"C4",a=b(e).toFrequency(),s=b(t).toFrequency()/a;n.playbackRate=s}const a=d?d/(n.buffer.sampleRate||44100):0;n.start(h,a)}else if(n.triggerAttack)if("NoiseSynth"===r.synthType||"MetalSynth"===r.synthType){const e=o?Math.min(1,s*Jh.ACCENT_BOOST):s;n.triggerAttack(h,e)}else if(n instanceof Qs)n.triggerAttack(t,h,s,o,i);else if(n instanceof Qs)n.triggerAttack(t,h,s,o,i);else{const a=b(t).toFrequency(),r=this.applySlideAndAccent(n,a,h,s,o,i,l,e);n.triggerAttack(t,h,r)}}catch(f){}return}try{if(m instanceof Qs)m.triggerAttackRelease(t,n,h,s,o,i);else if(m instanceof Qs)m.triggerAttackRelease(t,n,h,s,o,i,p);else if("NoiseSynth"===r.synthType)m.triggerAttackRelease(n,h,s);else if("MetalSynth"===r.synthType)m.triggerAttackRelease(n,h,s);else if("MembraneSynth"===r.synthType)m.triggerAttackRelease(t,n,h,s);else if("GranularSynth"===r.synthType){const e=m;if(e.buffer&&e.buffer.loaded){const a=s>0?G(s):-1/0;if(e.volume.value=a,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=Hh(c,0);e>=0&&(n=Kh(e,t.finetune))}const a=t.periodMultiplier/n,s=a/(r.sample?.sampleRate||8363);e.playbackRate=s*(r.granular?.playbackRate||1)}else{const n=b("C4").toFrequency(),a=b(t).toFrequency()/n;e.playbackRate=a*(r.granular?.playbackRate||1)}e.start(h),e.stop(h+n)}}else if("Player"===r.synthType||"Sampler"===r.synthType&&r.sample?.loop||"Sampler"===r.synthType&&r.metadata?.modPlayback?.usePeriodPlayback){const e=m;if(e.buffer&&e.buffer.loaded){const a=o?Math.min(1,s*Jh.ACCENT_BOOST):s,i=a>0?G(a):-1/0;if(e.volume.value=i,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=Hh(c,0);e>=0&&(n=Kh(e,t.finetune))}const a=t.periodMultiplier/n,s=a/(r.sample?.sampleRate||8363);e.playbackRate=s}else if(r.metadata?.modPlayback?.usePeriodPlayback&&!c);else{const n=b("C4").toFrequency(),a=b(t).toFrequency()/n;e.playbackRate=a}const u=d&&d>0?d/(e.buffer?.sampleRate||D().sampleRate):0;if(e.loop){if(void 0!==l){const t=this.channelActivePlayer.get(l);t&&"started"===t.state&&t.stop(h),this.channelActivePlayer.set(l,e)}e.start(h,u)}else e.start(h,u),e.stop(h+n)}}else if("Sampler"!==r.synthType||r.sample?.loop){if("SuperSaw"===r.synthType||"PolySynth"===r.synthType||"Organ"===r.synthType||"ChipSynth"===r.synthType||"PWMSynth"===r.synthType||"StringMachine"===r.synthType||"FormantSynth"===r.synthType){if(m.triggerAttackRelease){const a=b(t).toFrequency(),r=this.applySlideAndAccent(m,a,h,s,o,i,l,e);m.triggerAttackRelease(t,n,h,r)}}else if("DrumMachine"===r.synthType){if(m.triggerAttackRelease){const e=o?Math.min(1,s*Jh.ACCENT_BOOST):s;m.triggerAttackRelease(t,n,h,e)}}else if(m.triggerAttackRelease){const a=b(t).toFrequency(),r=this.applySlideAndAccent(m,a,h,s,o,i,l,e);m.triggerAttackRelease(t,n,h,r)}}else{const e=m;if(e.loaded)if(d&&d>0){const a=r.sample?.baseNote||"C4",o=e._buffers?.get(a)||e._buffers?._buffers?.[a];if(o&&o.duration){const i=256*d/(o.sampleRate||D().sampleRate),l=Math.min(i,o.duration-.001);try{const e=new j({url:o,volume:G(s)+(r.volume||-12)}).toDestination(),i=b(a).toFrequency(),c=b(t).toFrequency()/i;e.playbackRate=c,e.start(h,l),e.stop(h+n),O().scheduleOnce(()=>{e.dispose()},h+n+.1)}catch(f){e.triggerAttackRelease(t,n,h,s)}}else e.triggerAttackRelease(t,n,h,s)}else e.triggerAttackRelease(t,n,h,s)}}catch(y){}}}schedulePatternEvents(e,t){O().cancel(),e.forEach(e=>{O().schedule(t=>{this.triggerNote(e.instrumentId,e.note,e.duration,t,e.velocity,e.config)},e.time)})}clearSchedule(){O().cancel()}releaseAll(){const e=x();this.instruments.forEach((t,n)=>{try{if(t instanceof j||t instanceof he?"started"===t.state&&t.stop(e):t instanceof Qs?t.releaseAll():t.releaseAll&&t.releaseAll(e),t.volume&&"function"==typeof t.volume.rampTo){const n=t.volume.value;t.volume.rampTo(-1/0,.05,e),setTimeout(()=>{try{t.volume&&(t.volume.value=n)}catch{}},100)}}catch(a){}}),this.channelPitchState.clear(),this.channelActivePlayer.clear()}disposeInstrumentByKey(e){const t=this.instruments.get(e);if(t){this.instruments.delete(e),this.instrumentSynthTypes.delete(e),this.instrumentLoadingPromises.delete(e);try{t.disposed||(t.releaseAll?t.releaseAll():t.triggerRelease&&t.triggerRelease())}catch(n){}this.disposeInstrumentEffectChain(e);try{t.disposed||t.dispose()}catch(n){}}}disposeInstrument(e){const t=[];this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&t.push(a)}),t.forEach(e=>{this.disposeInstrumentByKey(e)})}invalidateInstrument(e){this.disposeInstrument(e)}updateInstrument(e,t){this.disposeInstrument(e),this.getInstrument(e,t)}async previewSlice(e,t,n){await xe();const a=(await Pn(()=>Promise.resolve().then(()=>Rf),void 0).then(e=>e.useInstrumentStore.getState())).instruments.find(t=>t.id===e),s=a?.sample?.audioBuffer,r=a?.sample?.url;if(s||r)try{let e;if(s)e=await this.decodeAudioData(s);else{const t=await fetch(r),n=await t.arrayBuffer();e=await this.decodeAudioData(n)}const a=e.sampleRate,o=n-t;if(o<=0)return;const i=ke.createBuffer(e.numberOfChannels,o,a);for(let n=0;n<e.numberOfChannels;n++){const a=e.getChannelData(n),s=i.getChannelData(n);for(let e=0;e<o;e++)s[e]=a[t+e]}const l=new j(i).toDestination();l.start();setTimeout(()=>{try{l.stop(),l.dispose()}catch{}},o/a*1e3+100)}catch(o){}}async bakeInstrument(e,t=2,n="C4"){return await Me(async()=>{const t=zh.createInstrument(e);if(e.effects&&e.effects.length>0){const n=await zh.createEffectChain(e.effects);let a=t;for(const e of n)a.connect(e),a=e;a.toDestination()}else t.toDestination();t.triggerAttack&&(t.triggerAttack(n,0),t.triggerRelease&&t.triggerRelease(1))},t)}updateTB303Parameters(e,t){const n=[];if(this.instruments.forEach((t,a)=>{const[s]=a.split("-");s===String(e)&&t instanceof Qs&&n.push(t)}),0===n.length)return void this.invalidateInstrument(e);const a=200,s=2e3,r=(e,t,n)=>{if(e>=0&&e<=1)return e;const a=Math.max(t,Math.min(n,e));return Math.log(a/t)/Math.log(n/t)},o=e=>e>=0&&e<=1?e:Math.max(0,Math.min(1,e/100));n.forEach(e=>{if(void 0!==t.tuning&&e.setTuning(t.tuning),void 0!==t.volume&&e.setVolume(t.volume),t.filter&&(e.setCutoff(r(t.filter.cutoff,314,2394)),e.setResonance(o(t.filter.resonance))),t.filterEnvelope&&(e.setEnvMod(o(t.filterEnvelope.envMod)),e.setDecay(r(t.filterEnvelope.decay,a,s))),t.accent&&e.setAccentAmount(o(t.accent.amount)),t.slide&&e.setSlideTime(r(t.slide.time,2,360)),t.overdrive&&e.setOverdrive(o(t.overdrive.amount)),t.oscillator&&(e.setWaveform("square"===t.oscillator.type?1:0),void 0!==t.oscillator.pulseWidth&&e.setPulseWidth(o(t.oscillator.pulseWidth)),void 0!==t.oscillator.subOscGain&&e.setSubOscGain(o(t.oscillator.subOscGain)),void 0!==t.oscillator.subOscBlend&&e.setSubOscBlend(o(t.oscillator.subOscBlend)),void 0!==t.oscillator.pitchToPw&&e.setPitchToPw(t.oscillator.pitchToPw)),t.devilFish?.enabled){const n=t.devilFish;e.enableDevilFish(!0),e.setNormalDecay(r(n.normalDecay,a,s)),e.setAccentDecay(r(n.accentDecay,a,s)),e.setSoftAttack(o(n.softAttack)),void 0!==n.accentSoftAttack&&e.setAccentSoftAttack(o(n.accentSoftAttack)),e.setVegDecay(r(n.vegDecay,a,s)),e.setVegSustain(o(n.vegSustain)),e.setFilterTracking(o(n.filterTracking)),e.setFilterFmDepth(o(n.filterFmDepth)),void 0!==n.filterInputDrive&&e.setFilterInputDrive(o(n.filterInputDrive)),void 0!==n.passbandCompensation&&e.setPassbandCompensation(o(n.passbandCompensation)),void 0!==n.resTracking&&e.setResTracking(o(n.resTracking)),void 0!==n.duffingAmount&&e.setDuffingAmount(o(n.duffingAmount)),void 0!==n.lpBpMix&&e.setLpBpMix(o(n.lpBpMix)),void 0!==n.filterSelect&&e.setFilterSelect(n.filterSelect),void 0!==n.diodeCharacter&&e.setDiodeCharacter(o(n.diodeCharacter)),void 0!==n.stageNLAmount&&"function"==typeof e.setStageNLAmount&&e.setStageNLAmount(o(n.stageNLAmount)),void 0!==n.ensembleAmount&&"function"==typeof e.setEnsembleAmount&&e.setEnsembleAmount(o(n.ensembleAmount)),void 0!==n.oversamplingOrder&&"function"==typeof e.setOversamplingOrder&&e.setOversamplingOrder(n.oversamplingOrder),void 0!==n.korgBite&&e.setKorgBite(n.korgBite),void 0!==n.korgClip&&e.setKorgClip(n.korgClip),void 0!==n.korgCrossmod&&e.setKorgCrossmod(n.korgCrossmod),void 0!==n.korgQSag&&e.setKorgQSag(n.korgQSag),void 0!==n.korgSharpness&&e.setKorgSharpness(n.korgSharpness),"function"==typeof e.setMuffler&&e.setMuffler(n.muffler),"function"==typeof e.setHighResonance&&e.setHighResonance(n.highResonance)}else t.devilFish&&e.enableDevilFish(!1);if(t.lfo&&(e.setLfoWaveform(t.lfo.waveform),e.setLfoRate(t.lfo.rate),e.setLfoContour(t.lfo.contour),e.setLfoPitchDepth(t.lfo.pitchDepth),e.setLfoPwmDepth(t.lfo.pwmDepth),e.setLfoFilterDepth(t.lfo.filterDepth),void 0!==t.lfo.stiffDepth&&e.setLfoStiffDepth(t.lfo.stiffDepth)),t.chorus){e.setChorusMode(t.chorus.mode);const n=o(t.chorus.mix);e.setChorusMix(t.chorus.enabled?n:0)}if(t.phaser){e.setPhaserRate(o(t.phaser.rate)),e.setPhaserWidth(o(t.phaser.depth)),e.setPhaserFeedback(o(t.phaser.feedback));const n=o(t.phaser.mix);e.setPhaserMix(t.phaser.enabled?n:0)}t.delay&&(e.setDelayTime(t.delay.time>1?t.delay.time/2e3:t.delay.time),e.setDelayFeedback(o(t.delay.feedback)),e.setDelayTone(o(t.delay.tone)),e.setDelayMix(t.delay.enabled?o(t.delay.mix):0),e.setDelaySpread(o(t.delay.stereo)))})}getMAMESynthHandle(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);return n instanceof ar?n.getHandle():0}getMAMEChipSynth(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);if(n instanceof gr)return n;for(const[a,s]of this.instruments)if(a.startsWith(`${e}-`)&&s instanceof gr)return s;return null}updateMAMEParameters(e,t){const n=this.getInstrumentKey(e,-1);this.instruments.get(n)}updateMAMEChipParam(e,t,n){const a=this.getInstrumentKey(e,-1),s=this.instruments.get(a);s&&"function"==typeof s.setParam&&s.setParam(t,n)}loadMAMEChipPreset(e,t){const n=this.getInstrumentKey(e,-1),a=this.instruments.get(n);a&&"function"==typeof a.loadPreset&&a.loadPreset(t)}updateMAMEChipTextParam(e,t,n){const a=this.getInstrumentKey(e,-1),s=this.instruments.get(a);s&&("function"==typeof s.setTextParam?s.setTextParam(t,n):"function"==typeof s.applyConfig&&s.applyConfig({[t]:n}))}loadSynthROM(e,t,n,a){const s=this.getInstrumentKey(e,-1),r=this.instruments.get(s);if(!r)return;const o=r;"MAMERSA"===t?"function"==typeof o.loadROM&&o.loadROM(n,a):"MAMESWP30"===t?"function"==typeof o.loadWaveROM&&o.loadWaveROM(a.buffer):"function"==typeof o.loadROM?o.loadROM(n,a):"function"==typeof o.setRom&&o.setRom(n,a)}updateDubSirenParameters(e,t){let n=!1;this.instruments.forEach((a,s)=>{const[r]=s.split("-");r===String(e)&&a&&"function"==typeof a.applyConfig&&(a.applyConfig(t),n=!0)})}updateSpaceLaserParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateV2Parameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");if(s===String(e)&&n&&"V2Synth"===n.name){const e=n;t.osc1&&(e.setParameter(2,t.osc1.mode),e.setParameter(4,t.osc1.transpose+64),e.setParameter(5,t.osc1.detune+64),e.setParameter(6,t.osc1.color),e.setParameter(7,t.osc1.level)),t.osc2&&(e.setParameter(8,t.osc2.mode),e.setParameter(9,t.osc2.ringMod?1:0),e.setParameter(10,t.osc2.transpose+64),e.setParameter(11,t.osc2.detune+64),e.setParameter(12,t.osc2.color),e.setParameter(13,t.osc2.level)),t.osc3&&(e.setParameter(14,t.osc3.mode),e.setParameter(15,t.osc3.ringMod?1:0),e.setParameter(16,t.osc3.transpose+64),e.setParameter(17,t.osc3.detune+64),e.setParameter(18,t.osc3.color),e.setParameter(19,t.osc3.level)),t.filter1&&(e.setParameter(20,t.filter1.mode),e.setParameter(21,t.filter1.cutoff),e.setParameter(22,t.filter1.resonance)),t.filter2&&(e.setParameter(23,t.filter2.mode),e.setParameter(24,t.filter2.cutoff),e.setParameter(25,t.filter2.resonance)),t.routing&&(e.setParameter(26,t.routing.mode),e.setParameter(27,t.routing.balance)),t.envelope&&(e.setParameter(32,t.envelope.attack),e.setParameter(33,t.envelope.decay),e.setParameter(34,t.envelope.sustain),e.setParameter(36,t.envelope.release)),t.envelope2&&(e.setParameter(38,t.envelope2.attack),e.setParameter(39,t.envelope2.decay),e.setParameter(40,t.envelope2.sustain),e.setParameter(42,t.envelope2.release)),t.lfo1&&(e.setParameter(47,t.lfo1.rate),e.setParameter(50,t.lfo1.depth))}})}updateSynareParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateFurnaceParameters(e,t){this.instruments.forEach((t,n)=>{const[a]=n.split("-");a===String(e)&&t&&"function"==typeof t.updateParameters&&t.updateParameters()})}applyFurnaceEffect(e,t,n,a=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,o]of this.instruments){const[s]=r.split("-");if(s===String(e)){if(o instanceof yo)return o.applyEffect(t,n,a),!0;if(o instanceof to)return this.applyFurnaceSynthEffect(o,t,n),!0}}return!1}applyFurnaceExtendedEffect(e,t,n,a=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,o]of this.instruments){const[s]=r.split("-");if(s===String(e)&&o instanceof yo)return o.applyExtendedEffect(t,n,a),!0}return!1}applyFurnaceSynthEffect(e,t,n){const a=n>>4&15,s=15&n,r=e.getChipType();8!==t?this.isFMChip(r)?this.applyFMEffect(e,t,n,a,s):this.isPSGChip(r)?this.applyPSGEffect(e,t,n,r):this.isWavetableChip(r)?this.applyWavetableEffect(e,t,n,r):this.isC64Chip(r)&&this.applyC64Effect(e,t,n):e.writePanRegister(n)}isFMChip(e){return[Kr.OPN2,Kr.OPM,Kr.OPL3,Kr.OPLL,Kr.OPNA,Kr.OPNB,Kr.OPZ,Kr.Y8950,Kr.OPL4,Kr.OPN,Kr.OPNB_B,Kr.ESFM].includes(e)}isPSGChip(e){return[Kr.NES,Kr.GB,Kr.PSG,Kr.AY,Kr.AY8930,Kr.SAA,Kr.VIC,Kr.TED].includes(e)}isWavetableChip(e){return[Kr.PCE,Kr.SCC,Kr.SWAN,Kr.N163,Kr.NAMCO,Kr.FDS,Kr.BUBBLE,Kr.X1_010,Kr.SM8521].includes(e)}isC64Chip(e){return[Kr.SID,Kr.SID_6581,Kr.SID_8580].includes(e)}applyFMEffect(e,t,n,a,s){switch(t){case 17:e.writeOperatorTL(a,8*s);break;case 18:e.writeOperatorAR(a,2*s);break;case 19:e.writeOperatorDR(a,2*s);break;case 20:e.writeOperatorMult(a,s);break;case 21:e.writeOperatorRR(a,s);break;case 22:e.writeOperatorSL(a,s)}}applyPSGEffect(e,t,n,a){switch(a){case Kr.GB:17===t?e.writeWavetableSelect(n):18===t&&e.writeDutyRegister(3&n);break;case Kr.NES:18===t&&e.writeDutyRegister(n>>6&3)}}applyWavetableEffect(e,t,n,a){switch(a){case Kr.PCE:18===t&&e.writeWavetableSelect(n);break;case Kr.SCC:case Kr.N163:case Kr.NAMCO:16===t&&e.writeWavetableSelect(n);break;case Kr.FDS:break;case Kr.SWAN:case Kr.SM8521:case Kr.BUBBLE:case Kr.X1_010:16!==t&&17!==t||e.writeWavetableSelect(n)}}applyC64Effect(e,t,n){16!==t&&18!==t||e.writeDutyRegister(n)}updateDexedParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateOBXdParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateComplexSynthParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateBuzzmachineParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.setParameter&&Object.entries(t.parameters).forEach(([e,t])=>{n.setParameter(Number(e),t)})})}async updateTB303Pedalboard(e,t){if(!t)return;const n=[];if(this.instruments.forEach((t,a)=>{a.startsWith(`${e}-`)&&t instanceof Qs&&n.push(t)}),0===n.length)return;const a=t.enabled&&t.chain.some(e=>e.enabled&&"neural"===e.type);for(const r of n)if(a){const e=t.chain.find(e=>e.enabled&&"neural"===e.type);if(e&&void 0!==e.modelIndex)try{await r.loadGuitarMLModel(e.modelIndex),await r.setGuitarMLEnabled(!0),void 0!==e.parameters?.dryWet&&r.setGuitarMLMix(e.parameters.dryWet)}catch(s){}}else try{await r.setGuitarMLEnabled(!1)}catch(s){}}updateChipSynthArpeggio(e,t){t&&this.instruments.forEach((n,a)=>{a.startsWith(`${e}-`)&&n.updateArpeggio&&n.updateArpeggio(t)})}getChipSynthArpeggioStep(e){for(const[t,n]of this.instruments.entries())if(t.startsWith(`${e}-`)&&n.getCurrentArpeggioStep)return n.getCurrentArpeggioStep();return 0}isChipSynthArpeggioPlaying(e){for(const[t,n]of this.instruments.entries())if(t.startsWith(`${e}-`)&&n.isArpeggioPlaying)return n.isArpeggioPlaying();return!1}initMetronome(){this.metronomeSynth||(this.metronomeSynth=new ce({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}),this.metronomeVolume=new p(.5),this.metronomeSynth.connect(this.metronomeVolume),this.metronomeVolume.connect(this.masterChannel))}setMetronomeEnabled(e){this.metronomeEnabled=e,e&&this.initMetronome()}isMetronomeEnabled(){return this.metronomeEnabled}setMetronomeVolume(e){this.metronomeVolume||this.initMetronome();const t=Math.max(0,Math.min(1,e/100));this.metronomeVolume?.set({gain:t})}triggerMetronomeClick(e,t=!1){if(!this.metronomeEnabled||!this.metronomeSynth)return;const n=t?"C5":"C4",a=t?.8:.5;this.metronomeSynth.triggerAttackRelease(n,"32n",e,a)}stopMetronome(){this.metronomePart&&(this.metronomePart.stop(),this.metronomePart.dispose(),this.metronomePart=null)}disposeMetronome(){this.stopMetronome(),this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.metronomeVolume&&(this.metronomeVolume.dispose(),this.metronomeVolume=null)}dispose(){this.stop(),this.clearSchedule(),this.disposeMetronome(),this.disposeAllInstrumentAnalysers(),this.instrumentEffectChains.forEach((e,t)=>{e.effects.forEach(e=>{try{e.dispose()}catch(t){}});try{e.output.dispose()}catch(n){}}),this.instrumentEffectChains.clear(),this.instruments.forEach((e,t)=>{try{e.dispose()}catch(n){}}),this.instruments.clear(),this.disposeChannelOutputs(),this.masterEffectsNodes.forEach(e=>{try{e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.analyser.dispose(),this.fft.dispose(),this.amigaFilter.dispose(),this.masterInput.dispose(),this.masterChannel.dispose(),Jh.instance=null}async buildInstrumentEffectChain(e,t,n){const a=this.instrumentEffectChains.get(e);a&&(a.effects.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),a.output.disconnect(),a.output.dispose());const s=new p(1),r=t.filter(e=>e.enabled);if(0===r.length){n.connect(s);const[t]=String(e).split("-"),a=parseInt(t),r=this.instrumentAnalysers.get(a);return r?s.connect(r.input):s.connect(this.masterInput),void this.instrumentEffectChains.set(e,{effects:[],output:s})}const o=await Promise.all(r.map(e=>zh.createEffect(e)));if(o.length>0){n.connect(o[0]);for(let e=0;e<o.length-1;e++)o[e].connect(o[e+1]);o[o.length-1].connect(s)}else n.connect(s);const[i]=String(e).split("-"),l=parseInt(i),c=this.instrumentAnalysers.get(l);c?s.connect(c.input):s.connect(this.masterInput),this.instrumentEffectChains.set(e,{effects:o,output:s})}async rebuildInstrumentEffects(e,t){const n=this.getInstrumentKey(e,-1),a=this.instruments.get(n);if(a){try{a.disconnect()}catch(s){}await this.buildInstrumentEffectChain(n,t,a)}}throwInstrumentToEffect(e,t,n=1,a=0){const s=[];this.instrumentEffectChains.forEach((t,n)=>{const[a]=String(n).split("-");a===String(e)&&s.push(t)}),0!==s.length&&s.forEach(e=>{const s=e.effects.find(e=>e._fxType===t);if(s&&s.wet){const e=s.wet,t=Se();e.cancelScheduledValues(t),e.rampTo(n,.01,t),a>0&&e.rampTo(0,.1,t+a/1e3)}})}disposeInstrumentEffectChain(e){const t=this.instrumentEffectChains.get(e);if(t){t.effects.forEach(e=>{try{e.dispose()}catch{}});try{t.output.dispose()}catch{}this.instrumentEffectChains.delete(e)}}async rebuildMasterEffects(e){const t=JSON.parse(JSON.stringify(e));this.masterInput.disconnect(),this.masterEffectsNodes.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear();const n=t.filter(e=>e.enabled);if(0===n.length)return void(this.amigaFilterEnabled?this.masterInput.connect(this.amigaFilter):this.masterInput.connect(this.masterChannel));(await Promise.all(n.map(e=>zh.createEffect(e)))).forEach((e,t)=>{this.masterEffectsNodes.push(e),this.masterEffectConfigs.set(n[t].id,{node:e,config:n[t]})}),this.masterInput.connect(this.masterEffectsNodes[0]);for(let a=0;a<this.masterEffectsNodes.length-1;a++)this.masterEffectsNodes[a].connect(this.masterEffectsNodes[a+1]);this.masterEffectsNodes[this.masterEffectsNodes.length-1].connect((()=>this.amigaFilterEnabled?this.amigaFilter:this.masterChannel)())}updateMasterEffectParams(e,t){const n=this.masterEffectConfigs.get(e);if(!n)return;const{node:a}=n,s=t.wet/100;try{"wet"in a&&a.wet instanceof B&&(a.wet.value=s),this.applyEffectParameters(a,t),n.config=t}catch(r){}}applyEffectParameters(e,t){const n=t.parameters;switch(t.type){case"Distortion":e instanceof T&&(e.distortion=n.drive??.4,e.oversample=n.oversample??"none");break;case"Reverb":break;case"Delay":case"FeedbackDelay":e instanceof g&&(e.delayTime.value=n.time??.25,e.feedback.value=n.feedback??.5);break;case"Chorus":e instanceof m&&(e.frequency.value=n.frequency??1.5,e.depth=n.depth??.7);break;case"Phaser":e instanceof f&&(e.frequency.value=n.frequency??.5,e.octaves=n.octaves??3);break;case"Tremolo":e instanceof te&&(e.frequency.value=n.frequency??10,e.depth.value=n.depth??.5);break;case"Vibrato":e instanceof ee&&(e.frequency.value=n.frequency??5,e.depth.value=n.depth??.1);break;case"BitCrusher":e instanceof X&&(e.bits.value=n.bits??4);break;case"PingPongDelay":e instanceof $&&(e.delayTime.value=n.time??.25,e.feedback.value=n.feedback??.5);break;case"PitchShift":e instanceof W&&(e.pitch=n.pitch??0);break;case"Compressor":e instanceof I&&(e.threshold.value=n.threshold??-24,e.ratio.value=n.ratio??12,e.attack.value=n.attack??.003,e.release.value=n.release??.25);break;case"EQ3":e instanceof C&&(e.low.value=n.low??0,e.mid.value=n.mid??0,e.high.value=n.high??0);break;case"Filter":e instanceof y&&(e.frequency.value=n.frequency??350,e.Q.value=n.Q??1);break;case"AutoFilter":e instanceof J&&(e.frequency.value=n.frequency??1,e.baseFrequency=n.baseFrequency??200,e.octaves=n.octaves??2.6);break;case"AutoPanner":e instanceof Z&&(e.frequency.value=n.frequency??1,e.depth.value=n.depth??1);break;case"StereoWidener":e instanceof K&&(e.width.value=n.width??.5);break;case"SpaceyDelayer":e instanceof Fr&&(null!=n.firstTap&&e.setFirstTap(Number(n.firstTap)),null!=n.tapSize&&e.setTapSize(Number(n.tapSize)),null!=n.feedback&&e.setFeedback(Number(n.feedback)),null!=n.multiTap&&e.setMultiTap(Number(n.multiTap)),null!=n.tapeFilter&&e.setTapeFilter(Number(n.tapeFilter)));break;case"RETapeEcho":e instanceof Br&&(null!=n.mode&&e.setMode(Number(n.mode)),null!=n.repeatRate&&e.setRepeatRate(Number(n.repeatRate)),null!=n.intensity&&e.setIntensity(Number(n.intensity)),null!=n.echoVolume&&e.setEchoVolume(Number(n.echoVolume)),null!=n.wow&&e.setWow(Number(n.wow)),null!=n.flutter&&e.setFlutter(Number(n.flutter)),null!=n.dirt&&e.setDirt(Number(n.dirt)),null!=n.inputBleed&&e.setInputBleed(Number(n.inputBleed)),null!=n.loopAmount&&e.setLoopAmount(Number(n.loopAmount)),null!=n.playheadFilter&&e.setPlayheadFilter(Number(n.playheadFilter)));break;case"SpaceEcho":e instanceof Tr&&(null!=n.mode&&e.setMode(Number(n.mode)),null!=n.rate&&e.setRate(Number(n.rate)),null!=n.intensity&&e.setIntensity(Number(n.intensity)),null!=n.echoVolume&&e.setEchoVolume(Number(n.echoVolume)),null!=n.reverbVolume&&e.setReverbVolume(Number(n.reverbVolume)),null!=n.bass&&e.setBass(Number(n.bass)),null!=n.treble&&e.setTreble(Number(n.treble)));break;case"BiPhase":e instanceof Vr&&(null!=n.rateA&&(e.rateA=Number(n.rateA)),null!=n.depthA&&(e.depthA=Number(n.depthA)),null!=n.rateB&&(e.rateB=Number(n.rateB)),null!=n.depthB&&(e.depthB=Number(n.depthB)),null!=n.feedback&&(e.feedback=Number(n.feedback)));break;case"DubFilter":e instanceof zr&&(null!=n.cutoff&&(e.cutoff=Number(n.cutoff)),null!=n.resonance&&(e.resonance=Number(n.resonance)),null!=n.gain&&(e.gain=Number(n.gain)))}}getChannelOutput(e){if(!this.channelOutputs.has(e)){const t=new p(1),n=new ge({volume:0,pan:0}),a=new _({smoothing:.8});t.connect(n),n.connect(a),n.connect(this.masterInput),this.channelOutputs.set(e,{input:t,channel:n,meter:a})}return this.channelOutputs.get(e).input}createVoice(e,t,n,a){const s=this.channelOutputs.get(e);if(!s)throw new Error(`Channel ${e} not initialized`);const r=new p(1);let o;if("IT"===a.metadata?.importedFrom&&Jh.itFilterWorkletLoaded){const e=D(),t=e.rawContext||e._context;o=v(t,"it-filter-processor")}else o=new y({type:"lowpass",frequency:2e4,Q:0,rolloff:-12});const i=new N(0);o instanceof y?(r.connect(o),o.connect(i)):(r.connect(o),A(o,i)),i.connect(s.input);const l=a.metadata?.envelopes?.[a.id],c=new $h,d=new $h,u=new $h;return l?.volumeEnvelope&&c.init(l.volumeEnvelope),l?.panningEnvelope&&d.init(l.panningEnvelope),l?.pitchEnvelope&&u.init(l.pitchEnvelope),{instrument:t,note:n,volumeEnv:c,panningEnv:d,pitchEnv:u,fadeout:65536,fadeoutStep:a.metadata?.modPlayback?.fadeout||0,isKeyOff:!1,isFilterEnvelope:"filter"===l?.pitchEnvelope?.type,lastCutoff:127,lastResonance:0,nodes:{gain:r,filter:o,panner:i}}}stopVoice(e,t){e.instrument.stop?e.instrument.stop(t):e.instrument.triggerRelease&&e.instrument.triggerRelease(t),setTimeout(()=>{e.nodes.gain.dispose(),e.nodes.filter.dispose(),e.nodes.panner.dispose()},100)}setChannelVolume(e,t){const n=this.activeVoices.get(e);if(n&&n.length>0){const e=x(),a=t<=-60?0:Math.pow(10,t/20);for(const t of n)t.nodes.gain&&t.nodes.gain.gain.setValueAtTime(a,e)}this.channelOutputs.get(e)}setChannelFilterCutoff(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1];a.lastCutoff=t;const s=a.lastResonance,r=a.nodes.filter,o=x();if(t>=127&&0===s||255===t)r instanceof y?(r.frequency.setValueAtTime(24e3,o),r.Q.setValueAtTime(0,o)):r instanceof AudioWorkletNode&&(r.parameters.get("cutoff")?.setValueAtTime(127,o),r.parameters.get("resonance")?.setValueAtTime(0,o));else if(r instanceof y){const e=100*Math.pow(100,t/127);r.frequency.setValueAtTime(e,o)}else r instanceof AudioWorkletNode&&r.parameters.get("cutoff")?.setValueAtTime(t,o)}setChannelFilterResonance(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1];a.lastResonance=t;const s=a.lastCutoff,r=a.nodes.filter,o=x();if(r instanceof y){const e=t/127*(t/127)*25;r.Q.setValueAtTime(e,o)}else r instanceof AudioWorkletNode&&r.parameters.get("resonance")?.setValueAtTime(t,o);t>0&&s>=127&&this.setChannelFilterCutoff(e,s)}setChannelPan(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=(t??0)/100;n[n.length-1].nodes.panner.pan.setValueAtTime(a,x())}setChannelFunkRepeat(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1].instrument;if(a instanceof j&&a.loop){if(0===t)return;if(a.buffer.loaded){const e=a._originalLoopStart??a.loopStart;void 0===a._originalLoopStart&&(a._originalLoopStart=a.loopStart);const n=t/128*(a.loopEnd-e);a.loopStart=e+n}}}handlePastNoteAction(e,t){const n=this.activeVoices.get(e);if(!n||n.length<=1)return;const a=n.slice(0,n.length-1),s=n[n.length-1];0===t?(a.forEach(e=>this.stopVoice(e,x())),this.activeVoices.set(e,[s])):2===t?a.forEach(e=>e.volumeEnv.keyOff()):3===t&&a.forEach(e=>{e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024)})}setChannelPitch(e,t){const n=this.channelPitchState.get(e);if(!n)return;n.currentPitchMult=t;const a=this.activeVoices.get(e);if(!a||0===a.length){const e=this.instruments.get(n.instrumentKey);if(!e)return;return void this.applyPitchToNode(e,t,n.basePlaybackRate,n.instrumentKey)}const s=a[a.length-1];this.applyPitchToNode(s.instrument,t,n.basePlaybackRate,n.instrumentKey)}applyPitchToNode(e,t,n,a){const s=this.instrumentSynthTypes.get(a),r=1200*Math.log2(t);e instanceof j||e instanceof he?e.playbackRate=n*t:"Sampler"===s?void 0!==e.detune&&(e.detune.value=r):void 0!==e.detune&&e.detune instanceof B?e.detune.value=r:void 0!==e.oscillator?.detune?e.oscillator.detune.value=r:void 0!==e.detune&&(e.detune=r)}setChannelFrequency(e,t){const n=this.channelPitchState.get(e);if(!n||0===n.baseFrequency)return;const a=t/n.baseFrequency;this.setChannelPitch(e,a)}initChannelPitch(e,t,n,a=1){this.channelPitchState.set(e,{instrumentKey:t,basePlaybackRate:a,baseFrequency:n,currentPitchMult:1})}clearChannelPitch(e){this.channelPitchState.get(e)&&(this.setChannelPitch(e,1),this.channelPitchState.delete(e))}setChannelMute(e,t){this.channelOutputs.has(e)||this.getChannelOutput(e);const n=this.channelOutputs.get(e);n&&(n.channel.mute=t)}updateMuteStates(e){const t=e.some(e=>e.solo);e.forEach((e,n)=>{const a=t?!e.solo:e.muted;this.channelMuteStates.set(n,a),this.setChannelMute(n,a)})}isChannelMuted(e){return this.channelMuteStates.get(e)??!1}disposeChannelOutputs(){this.channelOutputs.forEach((e,t)=>{try{e.meter.dispose()}catch(n){}try{e.channel.dispose()}catch(n){}try{e.input.dispose()}catch(n){}}),this.channelOutputs.clear()}getChannelLevels(e){const t=[];for(let n=0;n<e;n++){const e=this.channelOutputs.get(n);if(e){const n=e.meter.getValue(),a=Math.max(0,Math.min(1,(n+60)/60));t.push(a)}else t.push(0)}return t}channelTriggerLevels=new Map;triggerLevelsCache=[];triggerChannelMeter(e,t){this.channelTriggerLevels.set(e,Math.min(1,1.2*t))}getChannelTriggerLevels(e){this.triggerLevelsCache.length!==e&&(this.triggerLevelsCache=new Array(e).fill(0));for(let t=0;t<e;t++){const e=this.channelTriggerLevels.get(t)||0;this.triggerLevelsCache[t]=e,e>0&&this.channelTriggerLevels.set(t,0)}return this.triggerLevelsCache}getWaveform(){return this.analyser.getValue()}getFFT(){return this.fft.getValue()}currentPerformanceQuality="high";setPerformanceQuality(e){if(this.currentPerformanceQuality===e)return;this.currentPerformanceQuality=e,this.instruments.forEach((t,n)=>{t instanceof Qs&&t.setQuality(e)});const t=[];this.instruments.forEach((e,n)=>{if(e&&"object"==typeof e&&"maxPolyphony"in e){const e=n.split("-"),a=parseInt(e[0],10),s="-1"===e[1]?void 0:parseInt(e[1],10),r=this.instrumentSynthTypes.get(n);r&&["Synth","FMSynth","AMSynth","PluckSynth"].includes(r)&&t.push({key:n,instrumentId:a,channelIndex:s,config:{synthType:r}})}}),t.length>0&&t.forEach(({key:e})=>{const t=this.instruments.get(e);if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(n){}this.instruments.delete(e),this.instrumentSynthTypes.delete(e)})}updateChannelEnvelopes(e){const t=this.activeVoices.get(e),n=this.channelOutputs.get(e);if(!t||0===t.length||!n)return;const a=x(),s=n.channel.pan.value;let r=0;const o=t.length;for(let i=0;i<o;i++){const e=t[i],n=e.volumeEnv.tickNext();e.isKeyOff&&e.fadeout>0&&(e.fadeout=Math.max(0,e.fadeout-e.fadeoutStep));const o=n/64*(e.fadeout/65536);e.nodes.gain.gain.setValueAtTime(o,a);const l=e.panningEnv.tickNext();if(32!==l){const t=(l-32)/32,n=Math.max(-1,Math.min(1,s+t));e.nodes.panner.pan.setValueAtTime(n,a)}const c=e.pitchEnv.tickNext();if(e.pitchEnv.isEnabled())if(e.isFilterEnvelope){const t=e.lastCutoff,n=c-32,s=Math.max(0,Math.min(127,t+n));if(e.nodes.filter instanceof y){const t=Jh.FILTER_CUTOFF_LUT[s];e.nodes.filter.frequency.setValueAtTime(t,a)}else e.nodes.filter instanceof AudioWorkletNode&&e.nodes.filter.parameters.get("cutoff")?.setValueAtTime(s,a)}else{const t=(c-32)/32*12;void 0!==e.instrument.detune&&(e.instrument.detune.value=100*t)}e.isKeyOff&&e.fadeout<=0||e.volumeEnv.isFinished()&&e.isKeyOff?(e.nodes.gain.dispose(),e.nodes.filter.dispose(),e.nodes.panner.dispose()):t[r++]=e}r>0?t.length=r:this.activeVoices.delete(e)}setChannelKeyOff(e){const t=this.activeVoices.get(e);t&&t.forEach(e=>{e.isKeyOff=!0,e.volumeEnv.keyOff(),e.panningEnv.keyOff(),e.pitchEnv.keyOff()})}getPerformanceQuality(){return this.currentPerformanceQuality}}const em=()=>Jh.getInstance(),tm=Object.freeze(Object.defineProperty({__proto__:null,ToneEngine:Jh,getToneEngine:em},Symbol.toStringTag,{value:"Module"}));let nm=0;const am={generate:(e="id")=>(nm++,`${e}-${nm}-${Date.now()}`),reset(){nm=0}},sm=16,rm=31,om=(e,t)=>0!==(e&t),im=(e,t)=>e^t,lm=(e=64,t=4)=>({id:am.generate("pattern"),name:"Untitled Pattern",length:e,channels:Array.from({length:t},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,rows:Array.from({length:e},()=>({...ta})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}),cm=a()(Fn((e,t)=>({patterns:[lm()],currentPatternIndex:0,cursor:{channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},selection:null,clipboard:null,trackClipboard:null,followPlayback:!1,showGhostPatterns:!0,columnVisibility:{...ea},copyMask:rm,pasteMask:rm,transposeMask:1,macroSlots:Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),insertMode:!1,currentOctave:4,recordMode:!1,editStep:1,multiRecEnabled:!1,multiEditEnabled:!1,multiRecChannels:Array(16).fill(!0),multiKeyJazz:!1,recQuantEnabled:!1,recQuantRes:16,recReleaseEnabled:!1,keyOnTab:Array(16).fill(0),keyOffTime:Array(16).fill(0),keyOffCounter:0,ptnJumpPos:[0,0,0,0],patternOrder:[0],currentPositionIndex:0,originalModuleData:null,setCurrentPattern:t=>e(e=>{t>=0&&t<e.patterns.length&&(e.currentPatternIndex=t)}),moveCursor:t=>e(e=>{const n=e.patterns[e.currentPatternIndex],a=n.channels.length,s=n.length,r=e.cursor.rowIndex,o=e.cursor.channelIndex,i=e.cursor.columnType,l=e.cursor.digitIndex,c={instrument:2,volume:2,effTyp:1,effParam:2,effTyp2:1,effParam2:2,cutoff:2,resonance:2,envMod:2,pan:2,probability:2},d=c[e.cursor.columnType]||0;switch(t){case"up":e.cursor.rowIndex>0?e.cursor.rowIndex--:e.cursor.rowIndex=s-1;break;case"down":e.cursor.rowIndex<s-1?e.cursor.rowIndex++:e.cursor.rowIndex=0;break;case"left":{if(d>0&&e.cursor.digitIndex>0){e.cursor.digitIndex--;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],n=t.indexOf(e.cursor.columnType);if(-1===n){e.cursor.columnType="note",e.cursor.digitIndex=0;break}if(n>0){e.cursor.columnType=t[n-1];const a=c[e.cursor.columnType]||0;e.cursor.digitIndex=a>0?a-1:0}else{e.cursor.channelIndex>0?e.cursor.channelIndex--:e.cursor.channelIndex=a-1,e.cursor.columnType=t[t.length-1];const n=c[e.cursor.columnType]||0;e.cursor.digitIndex=n>0?n-1:0}break}case"right":{if(d>0&&e.cursor.digitIndex<d-1){e.cursor.digitIndex++;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],n=t.indexOf(e.cursor.columnType);if(-1===n){e.cursor.columnType="note",e.cursor.digitIndex=0;break}n<t.length-1?(e.cursor.columnType=t[n+1],e.cursor.digitIndex=0):(e.cursor.channelIndex<a-1?e.cursor.channelIndex++:e.cursor.channelIndex=0,e.cursor.columnType="note",e.cursor.digitIndex=0);break}}if(e.cursor.rowIndex===r&&e.cursor.channelIndex===o&&e.cursor.columnType===i&&e.cursor.digitIndex===l)return e}),moveCursorToRow:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.length&&(e.cursor.rowIndex=t)}),moveCursorToChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&(e.cursor.channelIndex=t)}),moveCursorToColumn:t=>e(e=>{e.cursor.columnType=t,e.cursor.digitIndex=0}),setCell:(t,n,a)=>e(e=>{const s=e.patterns[e.currentPatternIndex];t>=0&&t<s.channels.length&&n>=0&&n<s.length&&Object.assign(s.channels[t].rows[n],a)}),clearCell:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&n>=0&&n<a.length&&(a.channels[t].rows[n]={...ta})}),clearChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&(n.channels[t].rows=n.channels[t].rows.map(()=>({...ta})))}),clearPattern:()=>e(e=>{e.patterns[e.currentPatternIndex].channels.forEach(e=>{e.rows=e.rows.map(()=>({...ta}))})}),insertRow:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length&&n>=0&&n<a.length){const e=a.channels[t].rows;for(let t=a.length-1;t>n;t--)e[t]={...e[t-1]};e[n]={...ta}}}),deleteRow:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length&&n>=0&&n<a.length){const e=a.channels[t].rows;for(let t=n;t<a.length-1;t++)e[t]={...e[t+1]};e[a.length-1]={...ta}}}),setFollowPlayback:t=>e(e=>{e.followPlayback=t}),setShowGhostPatterns:t=>e(e=>{e.showGhostPatterns=t}),setColumnVisibility:t=>e(e=>{Object.assign(e.columnVisibility,t)}),setCopyMask:t=>e(e=>{e.copyMask=t&rm}),setPasteMask:t=>e(e=>{e.pasteMask=t&rm}),setTransposeMask:t=>e(e=>{e.transposeMask=t&rm}),toggleMaskBit:(t,n)=>e(e=>{"copy"===t?e.copyMask=im(e.copyMask,n):"paste"===t?e.pasteMask=im(e.pasteMask,n):"transpose"===t&&(e.transposeMask=im(e.transposeMask,n))}),setCurrentOctave:t=>e(e=>{e.currentOctave=Math.max(1,Math.min(7,t))}),toggleRecordMode:()=>e(e=>{e.recordMode=!e.recordMode}),setEditStep:t=>e(e=>{e.editStep=Math.max(0,Math.min(16,t))}),toggleInsertMode:()=>e(e=>{e.insertMode=!e.insertMode}),setMultiRecEnabled:t=>e(e=>{e.multiRecEnabled=t}),setMultiEditEnabled:t=>e(e=>{e.multiEditEnabled=t}),toggleMultiRecChannel:t=>e(e=>{t>=0&&t<e.multiRecChannels.length&&(e.multiRecChannels[t]=!e.multiRecChannels[t])}),setMultiKeyJazz:t=>e(e=>{e.multiKeyJazz=t}),setRecQuantEnabled:t=>e(e=>{e.recQuantEnabled=t}),setRecQuantRes:t=>e(e=>{[1,2,4,8,16].includes(t)&&(e.recQuantRes=t)}),setRecReleaseEnabled:t=>e(e=>{e.recReleaseEnabled=t}),setKeyOn:(t,n)=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOnTab[t]=n)}),setKeyOff:t=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOffCounter++,e.keyOnTab[t]=0,e.keyOffTime[t]=e.keyOffCounter)}),findBestChannel:()=>{const e=t(),n=e.patterns[e.currentPatternIndex],a=n?.channels.length||1;if(!e.multiRecEnabled&&!e.multiEditEnabled)return e.cursor.channelIndex;let s=e.cursor.channelIndex,r=1/0;for(let t=0;t<a;t++)e.multiRecChannels[t]&&0===e.keyOnTab[t]&&e.keyOffTime[t]<r&&(s=t,r=e.keyOffTime[t]);return s},resetKeyTracking:()=>e(e=>{e.keyOnTab=e.keyOnTab.map(()=>0),e.keyOffTime=e.keyOffTime.map(()=>0),e.keyOffCounter=0}),setPtnJumpPos:(t,n)=>e(e=>{t>=0&&t<4&&(e.ptnJumpPos[t]=n)}),getPtnJumpPos:e=>{const n=t();return e>=0&&e<4?n.ptnJumpPos[e]:0},startSelection:()=>e(e=>{e.selection={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,columnTypes:[e.cursor.columnType]}}),updateSelection:(t,n)=>e(e=>{e.selection&&(e.selection.endChannel=t,e.selection.endRow=n)}),endSelection:()=>e(e=>{e.selection&&(e.selection.endChannel=e.cursor.channelIndex,e.selection.endRow=e.cursor.rowIndex)}),clearSelection:()=>e(e=>{e.selection=null}),selectColumn:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:a.length-1,columnTypes:[n]}}),selectChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:n.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),selectPattern:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];e.selection={startChannel:0,endChannel:t.channels.length-1,startRow:0,endRow:t.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),copySelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r),d=[];for(let u=o;u<=i;u++){const e=[];for(let n=l;n<=c;n++)e.push({...t.channels[u].rows[n]});d.push(e)}e.clipboard={channels:i-o+1,rows:c-l+1,data:d}}),cutSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r),d=[];for(let u=o;u<=i;u++){const e=[];for(let n=l;n<=c;n++)e.push({...t.channels[u].rows[n]}),t.channels[u].rows[n]={...ta};d.push(e)}e.clipboard={channels:i-o+1,rows:c-l+1,data:d},e.selection=null}),paste:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let o=0;o<s.length;o++){const e=n+o;if(e>=t.channels.length)break;for(let n=0;n<s[o].length;n++){const i=a+n;if(i>=t.length)break;const l=s[o][n],c=t.channels[e].rows[i];om(r,1)&&(c.note=l.note),om(r,2)&&(c.instrument=l.instrument),om(r,4)&&(c.volume=l.volume),om(r,8)&&(c.effTyp=l.effTyp,c.eff=l.eff),om(r,sm)&&(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteMix:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let o=0;o<s.length;o++){const e=n+o;if(e>=t.channels.length)break;for(let n=0;n<s[o].length;n++){const i=a+n;if(i>=t.length)break;const l=s[o][n],c=t.channels[e].rows[i];om(r,1)&&0!==l.note&&0===c.note&&(c.note=l.note),om(r,2)&&0!==l.instrument&&0===c.instrument&&(c.instrument=l.instrument),om(r,4)&&0!==l.volume&&0===c.volume&&(c.volume=l.volume),!om(r,8)||0===l.effTyp&&0===l.eff||0!==c.effTyp||0!==c.eff||(c.effTyp=l.effTyp,c.eff=l.eff),!om(r,sm)||0===l.effTyp2&&0===l.eff2||0!==c.effTyp2||0!==c.eff2||(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteFlood:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,o=s[0]?.length||0;if(0!==o)for(let i=0;i<s.length;i++){const e=n+i;if(e>=t.channels.length)break;let l=a;for(;l<t.length;){for(let n=0;n<s[i].length;n++){const a=l+n;if(a>=t.length)break;const o=s[i][n],c=t.channels[e].rows[a];om(r,1)&&(c.note=o.note),om(r,2)&&(c.instrument=o.instrument),om(r,4)&&(c.volume=o.volume),om(r,8)&&(c.effTyp=o.effTyp,c.eff=o.eff),om(r,sm)&&(c.effTyp2=o.effTyp2,c.eff2=o.eff2)}l+=o}}}),pastePushForward:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,o=s[0]?.length||0;if(0!==o)for(let i=0;i<s.length;i++){const e=n+i;if(e>=t.channels.length)break;const l=t.channels[e];for(let n=t.length-1;n>=a+o;n--){const e=n-o;e>=a&&(l.rows[n]={...l.rows[e]})}for(let n=0;n<s[i].length;n++){const e=a+n;if(e>=t.length)break;const o=s[i][n],c=l.rows[e];c.note=0,c.instrument=0,c.volume=0,c.effTyp=0,c.eff=0,c.effTyp2=0,c.eff2=0,om(r,1)&&(c.note=o.note),om(r,2)&&(c.instrument=o.instrument),om(r,4)&&(c.volume=o.volume),om(r,8)&&(c.effTyp=o.effTyp,c.eff=o.eff),om(r,sm)&&(c.effTyp2=o.effTyp2,c.eff2=o.eff2)}}}),copyTrack:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t];e.trackClipboard=a.rows.map(e=>({...e}))}),cutTrack:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t];e.trackClipboard=a.rows.map(e=>({...e})),a.rows=a.rows.map(()=>({...ta}))}),pasteTrack:t=>e(e=>{if(!e.trackClipboard)return;const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t],{pasteMask:s}=e,r=Math.min(e.trackClipboard.length,n.length);for(let t=0;t<r;t++){const n=e.trackClipboard[t],r=a.rows[t];om(s,1)&&(r.note=n.note),om(s,2)&&(r.instrument=n.instrument),om(s,4)&&(r.volume=n.volume),om(s,8)&&(r.effTyp=n.effTyp,r.eff=n.eff),om(s,sm)&&(r.effTyp2=n.effTyp2,r.eff2=n.eff2)}}),writeMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const n=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:s}=e.cursor,r=n.channels[a].rows[s];e.macroSlots[t]={note:r.note,instrument:r.instrument,volume:r.volume,effTyp:r.effTyp,eff:r.eff,effTyp2:r.effTyp2,eff2:r.eff2}}),readMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const n=e.macroSlots[t],a=e.patterns[e.currentPatternIndex],{channelIndex:s,rowIndex:r}=e.cursor,{pasteMask:o}=e;if(e.insertMode){const e=a.channels[s],t={...ta};om(o,1)&&0!==n.note&&(t.note=n.note),om(o,2)&&0!==n.instrument&&(t.instrument=n.instrument),om(o,4)&&0!==n.volume&&(t.volume=n.volume),om(o,8)&&(t.effTyp=n.effTyp,t.eff=n.eff),!om(o,sm)||0===n.effTyp2&&0===n.eff2||(t.effTyp2=n.effTyp2,t.eff2=n.eff2),e.rows.splice(r,0,t),e.rows.length>a.length&&e.rows.pop()}else{const e=a.channels[s].rows[r];om(o,1)&&0!==n.note&&(e.note=n.note),om(o,2)&&0!==n.instrument&&(e.instrument=n.instrument),om(o,4)&&0!==n.volume&&(e.volume=n.volume),om(o,8)&&(e.effTyp=n.effTyp,e.eff=n.eff),!om(o,sm)||0===n.effTyp2&&0===n.eff2||(e.effTyp2=n.effTyp2,e.eff2=n.eff2)}}),transposeSelection:(t,n=!1)=>e(e=>{const a=e.patterns[e.currentPatternIndex],s=n?e.patterns[e.currentPatternIndex].channels[e.cursor.channelIndex].rows[e.cursor.rowIndex].instrument:null;let r,o,i,l;e.selection?(r=Math.min(e.selection.startChannel,e.selection.endChannel),o=Math.max(e.selection.startChannel,e.selection.endChannel),i=Math.min(e.selection.startRow,e.selection.endRow),l=Math.max(e.selection.startRow,e.selection.endRow)):(r=e.cursor.channelIndex,o=e.cursor.channelIndex,i=e.cursor.rowIndex,l=e.cursor.rowIndex);for(let c=r;c<=o;c++)if(!(c>=a.channels.length))for(let e=i;e<=l;e++){if(e>=a.length)continue;const r=a.channels[c].rows[e];if(!r.note||0===r.note||97===r.note)continue;if(n&&null!==s&&r.instrument!==s)continue;const o=Ha(r.note);if(null===o)continue;const i=o+t;i>=12&&i<=107&&(r.note=Wa(i))}}),remapInstrument:(t,n,a)=>e(e=>{const s=(e,a,s,r)=>{const o=void 0!==a?a:0,i=void 0!==a?a:e.channels.length-1,l=void 0!==s?s:0,c=void 0!==r?r:e.length-1;for(let d=o;d<=i;d++)for(let a=l;a<=c;a++)e.channels[d].rows[a]?.instrument===t&&(e.channels[d].rows[a].instrument=n)};if("block"===a&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),n=Math.max(e.selection.startChannel,e.selection.endChannel),a=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let o=t;o<=n;o++)s(e.patterns[e.currentPatternIndex],o,a,r)}else"track"===a?s(e.patterns[e.currentPatternIndex],e.cursor.channelIndex):"pattern"===a?s(e.patterns[e.currentPatternIndex]):"song"===a&&e.patterns.forEach(e=>s(e))}),interpolateSelection:(t,n,a,s="linear")=>e(e=>{if(!e.selection)return;const r=e.patterns[e.currentPatternIndex],{startChannel:o,endChannel:i,startRow:l,endRow:c}=e.selection,d=Math.min(o,i),u=Math.max(o,i),p=Math.min(l,c),h=Math.max(l,c),m=h-p+1;if(m<2)return;const f=e=>{switch(s){case"log":return Math.log(1+9*e)/Math.log(10);case"exp":return(Math.pow(10,e)-1)/9;case"scurve":return e*e*(3-2*e);default:return e}};for(let s=d;s<=u;s++)if(!(s>=r.channels.length))for(let e=p;e<=h;e++){if(e>=r.length)continue;const o=r.channels[s].rows[e],i=f((e-p)/(m-1)),l=Math.round(n+(a-n)*i);"volume"===t?o.volume=Math.max(0,Math.min(64,l)):"cutoff"===t?o.cutoff=Math.max(0,Math.min(127,l)):"resonance"===t?o.resonance=Math.max(0,Math.min(127,l)):"envMod"===t?o.envMod=Math.max(0,Math.min(127,l)):"pan"===t&&(o.pan=Math.max(-100,Math.min(100,l)))}}),humanizeSelection:t=>e(e=>{if(!e.selection)return;const n=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:s,startRow:r,endRow:o}=e.selection,i=Math.min(a,s),l=Math.max(a,s),c=Math.min(r,o),d=Math.max(r,o);for(let u=i;u<=l;u++)if(!(u>=n.channels.length))for(let e=c;e<=d;e++){if(e>=n.length)continue;const a=n.channels[u].rows[e];if(!a.note||0===a.note||97===a.note)continue;const s=a.volume>=16&&a.volume<=80?a.volume-16:48,r=Math.floor(s*(t/100)),o=Math.floor(Math.random()*(2*r+1))-r,i=Math.max(0,Math.min(64,s+o));a.volume=16+i}}),strumSelection:(t,n)=>e(e=>{if(!e.selection)return;const a=e.patterns[e.currentPatternIndex],{startChannel:s,endChannel:r,startRow:o,endRow:i}=e.selection,l=Math.min(s,r),c=Math.max(s,r),d=Math.min(o,i),u=Math.max(o,i);for(let p=d;p<=u;p++)if(!(p>=a.length))for(let e=l;e<=c;e++){if(e>=a.channels.length)continue;const s=a.channels[e].rows[p];if(!s.note||0===s.note||97===s.note)continue;const r="down"===n?e-l:c-e,o=Math.min(15,r*t);o>0&&(s.effTyp=14,s.eff=208+o)}}),legatoSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r);for(let d=o;d<=i;d++){if(d>=t.channels.length)continue;let e=-1;for(let n=l;n<=c;n++){if(n>=t.length)continue;const a=t.channels[d].rows[n];a.note>0&&a.note<97&&(e>=0&&n>e+1&&0===a.effTyp&&(a.effTyp=3,a.eff=255),e=n)}}}),scaleVolume:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];(()=>{const n=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),s=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),o=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=s;e++)for(let t=r;t<=o;t++)e<a.channels.length&&t<a.length&&n.push(a.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<a.channels.length&&n.push(...a.channels[t].rows)}else"pattern"===t&&a.channels.forEach(e=>{n.push(...e.rows)});return n})().forEach(e=>{null!==e.volume&&void 0!==e.volume&&(e.volume=Math.min(64,Math.max(0,Math.round(e.volume*n))))})}),fadeVolume:(t,n,a)=>e(e=>{const s=e.patterns[e.currentPatternIndex],r=(()=>{const n=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),o=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=a;e++)for(let t=r;t<=o;t++)e<s.channels.length&&t<s.length&&n.push(s.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<s.channels.length&&n.push(...s.channels[t].rows)}else"pattern"===t&&s.channels.forEach(e=>{n.push(...e.rows)});return n})(),o=r.length;o<2||r.forEach((e,t)=>{const s=t/(o-1),r=Math.round(n+s*(a-n));e.volume=Math.min(64,Math.max(0,r))})}),addPattern:(t=64)=>e(e=>{const n=e.patterns[0]?.channels.length||4;e.patterns.push(lm(t,n)),"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN ADDED")})}),deletePattern:t=>e(e=>{e.patterns.length>1&&t>=0&&t<e.patterns.length&&(e.patterns.splice(t,1),e.currentPatternIndex>=e.patterns.length&&(e.currentPatternIndex=e.patterns.length-1),"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN DELETED")}))}),clonePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=JSON.parse(JSON.stringify(n));a.id=am.generate("pattern"),a.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,a),"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN CLONED")})}}),resizePattern:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>0){const a=e.patterns[t],s=a.length;a.length=n,a.channels.forEach(e=>{if(n>s)for(let t=s;t<n;t++)e.rows.push({...ta});else e.rows.splice(n)})}}),resizeAllPatterns:t=>e(e=>{t>0&&e.patterns.forEach(e=>{const n=e.length;e.length=t,e.channels.forEach(e=>{if(t>n)for(let a=n;a<t;a++)e.rows.push({...ta});else e.rows.splice(t)})})}),duplicatePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=JSON.parse(JSON.stringify(n));a.id=am.generate("pattern"),a.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,a),e.currentPatternIndex=t+1}}),expandPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=n.length,s=Math.min(2*a,256);if(s===a)return;n.length=s,n.channels.forEach(e=>{const t=[];for(let n=0;n<a;n++)t.push(e.rows[n]),t.push({...ta});e.rows=t})}}),shrinkPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=n.length,s=Math.max(Math.floor(a/2),1);if(s===a)return;n.length=s,n.channels.forEach(e=>{const t=[];for(let n=0;n<s;n++)t.push(e.rows[2*n]);e.rows=t})}}),reorderPatterns:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>=0&&n<e.patterns.length&&t!==n){const[a]=e.patterns.splice(t,1);e.patterns.splice(n,0,a),e.currentPatternIndex===t?e.currentPatternIndex=n:t<e.currentPatternIndex&&n>=e.currentPatternIndex?e.currentPatternIndex--:t>e.currentPatternIndex&&n<=e.currentPatternIndex&&e.currentPatternIndex++}}),updatePatternName:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n.trim()&&(e.patterns[t].name=n.trim())}),addChannel:()=>e(e=>{const t=Jn.filter(e=>null!==e),n=t[Math.floor(Math.random()*t.length)];e.patterns.forEach(e=>{if(e.channels.length<16){const t=e.channels.length;e.channels.push({id:am.generate("channel"),name:`Channel ${t+1}`,rows:Array.from({length:e.length},()=>({...ta})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:n})}}),"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL ADDED")})}),removeChannel:t=>e(e=>{e.patterns.forEach(e=>{e.channels.length>1&&t>=0&&t<e.channels.length&&e.channels.splice(t,1)}),e.cursor.channelIndex>=e.patterns[0]?.channels.length&&(e.cursor.channelIndex=Math.max(0,e.patterns[0].channels.length-1)),"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL REMOVED")})}),toggleChannelMute:n=>{let a=!1;e(e=>{e.patterns.forEach(e=>{n>=0&&n<e.channels.length&&(e.channels[n].muted=!e.channels[n].muted,a=e.channels[n].muted)})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){em().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(a?"MUTED":"UNMUTED")})},toggleChannelSolo:n=>{let a=!1;e(e=>{e.patterns.forEach(e=>{if(n>=0&&n<e.channels.length){const t=e.channels[n].solo;e.channels.forEach(e=>{e.solo=!1}),t||(e.channels[n].solo=!0,a=!0)}})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){em().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&Pn(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>Lf);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(a?"SOLO ON":"SOLO OFF")})},toggleChannelCollapse:t=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].collapsed=!e.channels[t].collapsed)})}),setChannelVolume:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].volume=Math.max(0,Math.min(100,n)))})}),setChannelPan:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].pan=Math.max(-100,Math.min(100,n)))})}),setChannelColor:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].color=n)})}),setChannelRows:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length){const e=[...n];for(;e.length<a.length;)e.push({...ta});a.channels[t].rows=e.slice(0,a.length)}}),reorderChannel:(t,n)=>e(e=>{e.patterns.forEach(e=>{if(t>=0&&t<e.channels.length&&n>=0&&n<e.channels.length&&t!==n){const[a]=e.channels.splice(t,1);e.channels.splice(n,0,a)}}),e.cursor.channelIndex===t?e.cursor.channelIndex=n:t<e.cursor.channelIndex&&n>=e.cursor.channelIndex?e.cursor.channelIndex--:t>e.cursor.channelIndex&&n<=e.cursor.channelIndex&&e.cursor.channelIndex++}),setChannelRecordGroup:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].recordGroup=n)})}),getChannelsInRecordGroup:e=>{const n=t(),a=n.patterns[n.currentPatternIndex];return a?a.channels.map((t,n)=>t.recordGroup===e?n:-1).filter(e=>e>=0):[]},loadPatterns:t=>e(e=>{if(t.length>0){const n=t.map(e=>({...e,length:Math.max(1,e.length),channels:e.channels.map(e=>({...e,color:e.color??null}))}));e.patterns=n,e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null}}),setPatternOrder:t=>e(e=>{t.length>0&&(e.patternOrder=t,e.currentPositionIndex=0)}),setOriginalModuleData:t=>e(e=>{e.originalModuleData=t}),importPattern:n=>{const a=t().patterns.length;return e(e=>{const t={...n,length:Math.max(1,n.length),channels:n.channels.map(e=>({...e,color:e.color??null}))};e.patterns.push(t)}),a},replacePattern:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(e.patterns[t]=JSON.parse(JSON.stringify(n)))}),addToOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(void 0!==n&&n>=0&&n<=e.patternOrder.length?e.patternOrder.splice(n,0,t):e.patternOrder.push(t))}),removeFromOrder:t=>e(e=>{t>=0&&t<e.patternOrder.length&&e.patternOrder.length>1&&(e.patternOrder.splice(t,1),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1))}),insertInOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n>=0&&n<=e.patternOrder.length&&e.patternOrder.splice(n,0,t)}),duplicatePosition:t=>e(e=>{if(t>=0&&t<e.patternOrder.length){const n=e.patternOrder[t];e.patternOrder.splice(t+1,0,n)}}),clearOrder:()=>e(e=>{e.patternOrder=[0],e.currentPositionIndex=0}),reorderPositions:(t,n)=>e(e=>{if(t>=0&&t<e.patternOrder.length&&n>=0&&n<e.patternOrder.length){const[a]=e.patternOrder.splice(t,1);e.patternOrder.splice(n,0,a),e.currentPositionIndex===t?e.currentPositionIndex=n:t<e.currentPositionIndex&&n>=e.currentPositionIndex?e.currentPositionIndex--:t>e.currentPositionIndex&&n<=e.currentPositionIndex&&e.currentPositionIndex++}}),setCurrentPosition:t=>e(e=>{t>=0&&t<e.patternOrder.length&&(e.currentPositionIndex=t,e.currentPatternIndex=e.patternOrder[t])}),reset:()=>e(e=>{e.patterns=[lm()],e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null,e.trackClipboard=null,e.currentOctave=4,e.recordMode=!1,e.editStep=1,e.insertMode=!1,e.columnVisibility={...ea},e.copyMask=rm,e.pasteMask=rm,e.transposeMask=1,e.macroSlots=Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),e.patternOrder=[0],e.currentPositionIndex=0})}))),dm=Object.freeze(Object.defineProperty({__proto__:null,MASK_ALL:rm,MASK_EFFECT:8,MASK_EFFECT2:sm,MASK_INSTRUMENT:2,MASK_NOTE:1,MASK_VOLUME:4,hasMaskBit:om,toggleMaskBit:im,useTrackerStore:cm},Symbol.toStringTag,{value:"Module"})),um=[{type:"synth",name:"JC303 Default",synthType:"TB303",tb303:{engineType:"jc303",oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.743,filterSelect:255,diodeCharacter:1,duffingAmount:.03,lpBpMix:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,filterTracking:0,filterFmDepth:0,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.1875,feedback:.3,tone:.5,mix:0,stereo:.5}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.65},filterEnvelope:{envMod:.6,decay:.3},accent:{amount:.7},slide:{time:.17,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.82},filterEnvelope:{envMod:.85,decay:.4},accent:{amount:.9},slide:{time:.15,mode:"exponential"}},effects:[],volume:.7,pan:0},{type:"synth",name:"303 Deep Sub",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.15,resonance:.35},filterEnvelope:{envMod:.25,decay:.2},accent:{amount:.45},slide:{time:.3,mode:"exponential"}},effects:[],volume:.8,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:.45,resonance:.68},filterEnvelope:{envMod:.55,decay:.25},accent:{amount:.65},slide:{time:.15,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.75,resonance:.88},filterEnvelope:{envMod:.95,decay:.5},accent:{amount:1},slide:{time:.1,mode:"exponential"}},effects:[{id:"distortion-1",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.6}}],volume:.6,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.8},filterEnvelope:{envMod:.75,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.2,accentDecay:.1,vegDecay:.3,vegSustain:.15,softAttack:.05,filterTracking:.6,filterFmDepth:.5,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:.6,pan:0}],pm=(e={})=>({enabled:!0,am:!1,ar:31,dr:0,mult:1,rr:15,sl:0,tl:0,dt2:0,rs:0,dt:0,d2r:0,ssg:0,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0,...e}),hm=()=>pm({enabled:!1,tl:127,ar:0,rr:0}),mm=[{name:"Genesis Bass",type:"synth",synthType:"FurnaceOPN",volume:-6,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:5,operators:[pm({mult:1,tl:20,ar:31,dr:8,sl:2,rr:8}),pm({mult:2,tl:30,ar:31,dr:12,sl:4,rr:6,dt:3}),pm({mult:1,tl:25,ar:31,dr:10,sl:3,rr:8}),pm({mult:4,tl:35,ar:28,dr:15,sl:5,rr:10,dt:-1})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Lead",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:5,feedback:6,operators:[pm({mult:1,tl:10,ar:31,dr:4,sl:1,rr:6}),pm({mult:3,tl:35,ar:31,dr:8,sl:3,rr:8,dt:2}),pm({mult:2,tl:30,ar:31,dr:6,sl:2,rr:8,dt:-2}),pm({mult:1,tl:15,ar:31,dr:10,sl:4,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Brass",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:2,feedback:7,operators:[pm({mult:1,tl:25,ar:28,dr:10,sl:4,rr:8}),pm({mult:1,tl:20,ar:31,dr:8,sl:3,rr:10}),pm({mult:2,tl:30,ar:31,dr:12,sl:5,rr:8,dt:1}),pm({mult:1,tl:15,ar:25,dr:6,sl:2,rr:6})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Bell",type:"synth",synthType:"FurnaceOPN",volume:-10,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:0,operators:[pm({mult:1,tl:15,ar:31,dr:8,sl:0,rr:10}),pm({mult:7,tl:40,ar:31,dr:12,sl:2,rr:12,dt:3}),pm({mult:1,tl:20,ar:31,dr:10,sl:1,rr:10}),pm({mult:14,tl:45,ar:31,dr:15,sl:3,rr:14,dt:-2})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Strings",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:1,feedback:3,operators:[pm({mult:1,tl:20,ar:20,dr:5,sl:2,rr:8}),pm({mult:2,tl:35,ar:25,dr:8,sl:4,rr:10,dt:1}),pm({mult:1,tl:25,ar:22,dr:6,sl:3,rr:8,dt:-1}),pm({mult:3,tl:40,ar:28,dr:10,sl:5,rr:12,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Synth Lead",type:"synth",synthType:"FurnaceOPM",volume:-8,pan:0,effects:[],furnace:{chipType:33,algorithm:5,feedback:6,operators:[pm({mult:1,tl:15,ar:31,dr:5,sl:1,rr:6}),pm({mult:3,tl:40,ar:31,dr:8,sl:3,rr:8,dt:2}),pm({mult:2,tl:35,ar:31,dr:10,sl:4,rr:8,dt:-2}),pm({mult:1,tl:25,ar:31,dr:12,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Electric Piano",type:"synth",synthType:"FurnaceOPM",volume:-10,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:2,operators:[pm({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),pm({mult:14,tl:50,ar:31,dr:15,sl:5,rr:10}),pm({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),pm({mult:1,tl:45,ar:31,dr:18,sl:6,rr:12,dt:1})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Metallic Drum",type:"synth",synthType:"FurnaceOPM",volume:-6,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:7,operators:[pm({mult:1,tl:20,ar:31,dr:15,sl:0,rr:15}),pm({mult:5,tl:30,ar:31,dr:12,sl:0,rr:15,dt:2}),pm({mult:9,tl:40,ar:31,dr:10,sl:0,rr:15,dt:-2}),pm({mult:2,tl:50,ar:31,dr:8,sl:0,rr:15})],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Organ",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:3,operators:[pm({mult:2,tl:30,ar:15,dr:4,sl:8,rr:5,ws:1}),pm({mult:1,tl:0,ar:15,dr:2,sl:4,rr:8,ws:0}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Slap Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:5,operators:[pm({mult:4,tl:35,ar:15,dr:6,sl:3,rr:4,ws:0}),pm({mult:1,tl:0,ar:15,dr:3,sl:2,rr:6,ws:0}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Bass Drum",type:"synth",synthType:"FurnaceOPL",volume:-4,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[pm({mult:1,tl:10,ar:31,dr:6,sl:2,rr:6,ws:0}),pm({mult:0,tl:0,ar:31,dr:8,sl:0,rr:8,ws:0}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Snare",type:"synth",synthType:"FurnaceOPL",volume:-6,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:0,operators:[pm({mult:1,tl:5,ar:31,dr:10,sl:0,rr:10,ws:3}),pm({mult:4,tl:20,ar:31,dr:8,sl:0,rr:8,ws:0}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[pm({mult:1,tl:25,ar:12,dr:5,sl:5,rr:6,ws:0}),pm({mult:1,tl:5,ar:14,dr:4,sl:3,rr:8,ws:0}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[pm({mult:1,tl:0,ar:31,dr:0,sl:0,rr:12}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[pm({mult:1,tl:5,ar:31,dr:4,sl:2,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Triangle",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:2,sl:1,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Pulse",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[pm({mult:1,tl:5,ar:28,dr:2,sl:2,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:5,sl:3,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Arp Lead",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[pm({mult:1,tl:3,ar:31,dr:3,sl:1,rr:12}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:4,sl:3,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[pm({mult:1,tl:12,ar:31,dr:6,sl:4,rr:6}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:4,operators:[pm({mult:1,tl:15,ar:25,dr:8,sl:5,rr:8}),pm({mult:2,tl:35,ar:31,dr:10,sl:6,rr:10,dt:1}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Bass",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:5,operators:[pm({mult:1,tl:10,ar:31,dr:6,sl:3,rr:6}),pm({mult:3,tl:40,ar:31,dr:12,sl:8,rr:8,dt:2}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Pad",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:3,algorithm:2,feedback:3,operators:[pm({mult:1,tl:18,ar:18,dr:4,sl:2,rr:10}),pm({mult:2,tl:30,ar:20,dr:6,sl:4,rr:12,dt:-1}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Buzzy Lead",type:"synth",synthType:"FurnaceAY",volume:-8,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:1,operators:[pm({mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6}),pm({mult:3,tl:50,ar:31,dr:8,sl:8,rr:10}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Square Bass",type:"synth",synthType:"FurnaceAY",volume:-6,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:0,operators:[pm({mult:1,tl:15,ar:31,dr:8,sl:5,rr:5}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:4,algorithm:6,feedback:2,operators:[pm({mult:1,tl:12,ar:31,dr:5,sl:2,rr:8}),pm({mult:2,tl:40,ar:31,dr:8,sl:4,rr:10}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:4,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:6,sl:3,rr:6}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Pulse Lead",type:"synth",synthType:"FurnaceVRC6",volume:-8,pan:0,effects:[],furnace:{chipType:21,algorithm:5,feedback:0,operators:[pm({mult:1,tl:5,ar:31,dr:3,sl:1,rr:10}),pm({mult:2,tl:30,ar:31,dr:6,sl:3,rr:12}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Saw Bass",type:"synth",synthType:"FurnaceVRC6",volume:-6,pan:0,effects:[],furnace:{chipType:21,algorithm:7,feedback:0,operators:[pm({mult:1,tl:10,ar:31,dr:5,sl:2,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"N163 Wave Lead",type:"synth",synthType:"FurnaceN163",volume:-8,pan:0,effects:[],furnace:{chipType:22,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:4,sl:2,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]}},{name:"TIA Buzzy",type:"synth",synthType:"FurnaceTIA",volume:-10,pan:0,effects:[],furnace:{chipType:38,algorithm:7,feedback:7,operators:[pm({mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4}),pm({mult:5,tl:45,ar:31,dr:20,sl:10,rr:6,dt:2}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"VERA PSG Lead",type:"synth",synthType:"FurnaceVERA",volume:-8,pan:0,effects:[],furnace:{chipType:42,algorithm:7,feedback:0,operators:[pm({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SCC Wave",type:"synth",synthType:"FurnaceSCC",volume:-8,pan:0,effects:[],furnace:{chipType:10,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:5,sl:2,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[{id:0,data:[0,32,64,96,127,96,64,32,0,-32,-64,-96,-127,-96,-64,-32]}]}},{name:"OPLL Piano",type:"synth",synthType:"FurnaceOPLL",volume:-10,pan:0,effects:[],furnace:{chipType:9,algorithm:0,feedback:2,operators:[pm({mult:4,tl:35,ar:15,dr:5,sl:6,rr:7}),pm({mult:1,tl:0,ar:15,dr:3,sl:3,rr:6}),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Pad",type:"synth",synthType:"FurnaceSNES",volume:-10,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[pm({mult:1,tl:12,ar:20,dr:4,sl:2,rr:12}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Bass",type:"synth",synthType:"FurnaceSNES",volume:-6,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[pm({mult:1,tl:8,ar:31,dr:6,sl:3,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"FDS Wave",type:"synth",synthType:"FurnaceFDS",volume:-8,pan:0,effects:[],furnace:{chipType:23,algorithm:7,feedback:0,operators:[pm({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[{id:0,data:[32,40,48,56,63,56,48,40,32,24,16,8,0,8,16,24]}]}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:32,algorithm:7,feedback:0,operators:[pm({mult:1,tl:12,ar:31,dr:5,sl:3,rr:8}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"SAA Square",type:"synth",synthType:"FurnaceSAA",volume:-8,pan:0,effects:[],furnace:{chipType:31,algorithm:7,feedback:0,operators:[pm({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),hm(),hm(),hm()],macros:[],opMacros:[],wavetables:[]}},{name:"ESFM Lead",type:"synth",synthType:"FurnaceESFM",volume:-8,pan:0,effects:[],furnace:{chipType:48,algorithm:5,feedback:5,operators:[pm({mult:1,tl:15,ar:15,dr:4,sl:2,rr:6}),pm({mult:3,tl:35,ar:15,dr:6,sl:4,rr:8,dt:1}),pm({mult:2,tl:30,ar:15,dr:5,sl:3,rr:8}),pm({mult:1,tl:20,ar:15,dr:8,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPZ E.Piano",type:"synth",synthType:"FurnaceOPZ",volume:-10,pan:0,effects:[],furnace:{chipType:40,algorithm:4,feedback:3,operators:[pm({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),pm({mult:14,tl:48,ar:31,dr:14,sl:5,rr:10,dt:1}),pm({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),pm({mult:1,tl:45,ar:31,dr:16,sl:6,rr:12})],macros:[],opMacros:[],wavetables:[]}}],fm=[{type:"synth",name:"Classic Siren",synthType:"DubSiren",dubSiren:{...Ca,oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"triangle",rate:2,depth:200},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1.5,wet:.2}},effects:[],volume:-10,pan:0},{type:"synth",name:"Code Red",synthType:"DubSiren",dubSiren:{...Ca,oscillator:{type:"square",frequency:600},lfo:{enabled:!0,type:"square",rate:8,depth:100},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:2,wet:.4}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Echo",synthType:"DubSiren",dubSiren:{...Ca,oscillator:{type:"sawtooth",frequency:220},lfo:{enabled:!0,type:"sine",rate:.5,depth:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},filter:{enabled:!0,type:"highpass",frequency:300,rolloff:-12},reverb:{enabled:!0,decay:4,wet:.6}},effects:[],volume:-12,pan:0},{type:"synth",name:"Air Horn",synthType:"DubSiren",dubSiren:{...Ca,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0}],ym=[{type:"synth",name:"Standard Zap",synthType:"SpaceLaser",spaceLaser:{...Aa,laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:30,ratio:2},noise:{amount:5,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:30}},effects:[],volume:-10,pan:0},{type:"synth",name:"Cosmic Burst",synthType:"SpaceLaser",spaceLaser:{...Aa,laser:{startFreq:8e3,endFreq:400,sweepTime:300,sweepCurve:"exponential"},fm:{amount:60,ratio:4.5},noise:{amount:20,type:"pink"},filter:{type:"highpass",cutoff:1e3,resonance:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},reverb:{enabled:!0,decay:4,wet:.4}},effects:[],volume:-12,pan:0},{type:"synth",name:"Anime Pew",synthType:"SpaceLaser",spaceLaser:{...Aa,laser:{startFreq:6e3,endFreq:2e3,sweepTime:80,sweepCurve:"exponential"},fm:{amount:80,ratio:8},noise:{amount:0,type:"white"},filter:{type:"bandpass",cutoff:4e3,resonance:60},delay:{enabled:!0,time:.1,feedback:.3,wet:.3},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Blaster",synthType:"SpaceLaser",spaceLaser:{...Aa,laser:{startFreq:1500,endFreq:40,sweepTime:500,sweepCurve:"linear"},fm:{amount:20,ratio:1.5},noise:{amount:40,type:"brown"},filter:{type:"lowpass",cutoff:800,resonance:40},delay:{enabled:!0,time:.33,feedback:.6,wet:.6},reverb:{enabled:!0,decay:2.5,wet:.3}},effects:[],volume:-10,pan:0}],gm={type:"synth",name:"V2 Trance Lead",synthType:"V2",v2:{...Ta,osc1:{mode:1,detune:0,transpose:0,color:64,level:100},osc2:{mode:1,ringMod:!1,detune:15,transpose:0,color:64,level:80},filter1:{mode:1,cutoff:80,resonance:40},envelope:{attack:5,decay:60,sustain:40,release:40}},effects:[],volume:-10,pan:0},vm={type:"synth",name:"V2 Silk Pad",synthType:"V2",v2:{...Ta,osc1:{mode:1,detune:5,transpose:0,color:64,level:60},osc2:{mode:3,ringMod:!1,detune:0,transpose:12,color:64,level:40},filter1:{mode:1,cutoff:40,resonance:20},envelope:{attack:80,decay:100,sustain:100,release:100}},effects:[],volume:-12,pan:0},bm={type:"synth",name:"V2 4k Bass",synthType:"V2",v2:{...Ta,osc1:{mode:1,detune:0,transpose:-12,color:64,level:100},osc2:{mode:2,ringMod:!1,detune:0,transpose:-12,color:64,level:60},filter1:{mode:1,cutoff:30,resonance:60},envelope:{attack:0,decay:40,sustain:0,release:10}},effects:[],volume:-8,pan:0},xm={type:"synth",name:"V2 4k Kick",synthType:"V2",v2:{...Ta,osc1:{mode:3,detune:0,transpose:-24,color:64,level:120},filter1:{mode:1,cutoff:20,resonance:40},envelope:{attack:0,decay:30,sustain:0,release:10}},effects:[],volume:-6,pan:0},wm={type:"synth",name:"V2 Noise Snare",synthType:"V2",v2:{...Ta,osc1:{mode:4,detune:0,transpose:0,color:64,level:100},filter1:{mode:2,cutoff:60,resonance:20},envelope:{attack:0,decay:45,sustain:0,release:20}},effects:[],volume:-10,pan:0},km={type:"synth",name:"V2 Metal Hat",synthType:"V2",v2:{...Ta,osc1:{mode:4,detune:0,transpose:0,color:64,level:80},filter1:{mode:3,cutoff:100,resonance:10},envelope:{attack:0,decay:15,sustain:0,release:10}},effects:[],volume:-14,pan:0},Sm=[gm,vm,bm,xm,wm,km,{type:"synth",name:"V2 Retro Zap",synthType:"V2",v2:{...Ta,osc1:{mode:1,detune:0,transpose:12,color:64,level:100},filter1:{mode:1,cutoff:120,resonance:80},envelope:{attack:0,decay:25,sustain:0,release:10}},effects:[],volume:-10,pan:0},{name:"V2 Speech",type:"synth",synthType:"V2Speech",volume:-6,pan:0,effects:[],parameters:{text:"Ready"}}],Mm=[{type:"synth",name:"Disco Tom",synthType:"Synare",synare:{...Ia,oscillator:{type:"square",tune:150,fine:0},sweep:{enabled:!0,amount:24,time:200},envelope:{decay:400,sustain:0},noise:{enabled:!1,type:"white",mix:0,color:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Perc",synthType:"Synare",synare:{...Ia,oscillator:{type:"square",tune:80,fine:0},sweep:{enabled:!0,amount:12,time:100},filter:{cutoff:400,resonance:85,envMod:80,decay:150},envelope:{decay:200,sustain:0},noise:{enabled:!0,type:"white",mix:.1,color:50}},effects:[],volume:-10,pan:0},{type:"synth",name:"Synare Snare",synthType:"Synare",synare:{...Ia,oscillator:{type:"square",tune:220,fine:0},noise:{enabled:!0,type:"white",mix:.6,color:80},filter:{cutoff:2e3,resonance:30,envMod:40,decay:100},envelope:{decay:150,sustain:0},sweep:{enabled:!1,amount:0,time:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Zap",synthType:"Synare",synare:{...Ia,oscillator:{type:"square",tune:600,fine:0},sweep:{enabled:!0,amount:48,time:300},lfo:{enabled:!0,rate:12,depth:50,target:"pitch"},envelope:{decay:500,sustain:0}},effects:[],volume:-12,pan:0}],Nm=(e,t,n)=>({id:`map-${e}-${Date.now()}-${Math.random()}`,noteStart:e,noteEnd:e,sampleId:t,sampleName:t,sampleUrl:`data/samples/packs/drumnibus/${n}`,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0}),Cm=(e,t)=>({type:"synth",name:e,synthType:"DrumKit",drumKit:{keymap:t,polyphony:"poly",maxVoices:8,noteCut:!0},effects:[],volume:-6,pan:0}),Em=[Nm(36,"Kick","kicks/BD_808A1200.wav"),Nm(38,"Snare","snares/SD_Analog Noise1.wav"),Nm(39,"Clap","percussion/CLAP_Juxtapos.wav"),Nm(42,"Closed Hat","hihats/CH_AnalogHihat1.wav"),Nm(46,"Open Hat","hihats/OH_AnalogOpenhatwav.wav"),Nm(41,"Tom Low","percussion/TOM_Warped.wav"),Nm(45,"Tom Mid","percussion/TOM_Stofelectro1.wav"),Nm(49,"Crash","hihats/CYM_Synthique.wav"),Nm(51,"Ride","hihats/CYM_Magnotron.wav"),Nm(60,"FX","fx/FX_AnalogFX1.wav")],Pm=[Nm(36,"Kick","kicks/BD_Digidap.wav"),Nm(38,"Snare","snares/SD_Digidap.wav"),Nm(39,"Clap","percussion/CLAP_Punchtron.wav"),Nm(42,"Closed Hat","hihats/CH_Digidap.wav"),Nm(46,"Open Hat","hihats/OH_Digidap.wav"),Nm(41,"Tom","percussion/TOM_Punchtron.wav"),Nm(49,"Crash","hihats/CYM_Punchtron.wav"),Nm(60,"Zap","fx/FX_Digidap2.wav")],Tm=[Nm(36,"Kick","kicks/BD_LofiHuman.wav"),Nm(38,"Snare","snares/SD_LofiHuman.wav"),Nm(39,"Clap","percussion/CLAP_LofiHuman.wav"),Nm(42,"Closed Hat","hihats/CH_LofiHuman.wav"),Nm(46,"Open Hat","hihats/OH_LofiHuman.wav"),Nm(41,"Tom","percussion/TOM_LofiHuman.wav"),Nm(60,"Vocal FX","fx/FX_LofiHuman.wav")],Am=[Nm(36,"Kick","kicks/BD_Pziforze.wav"),Nm(38,"Snare","snares/SD_Wolf 3.wav"),Nm(39,"Clap","percussion/CLAP_Magnotron.wav"),Nm(42,"Closed Hat","hihats/CH_Magnotron.wav"),Nm(46,"Open Hat","hihats/OH_Magnotron.wav"),Nm(41,"Tom Low","percussion/TOM_Magnotron.wav"),Nm(49,"Crash","hihats/CYM_Magnotron.wav"),Nm(60,"Rumble FX","fx/FX_Magstorm1.wav")],Im=[Cm("Drumnibus Analog",Em),Cm("Drumnibus Digital",Pm),Cm("Drumnibus LoFi",Tm),Cm("Drumnibus Techno",Am)],_m=[{type:"synth",name:"SP_TheProduct",synthType:"V2",v2Speech:{text:"!DHAX_ !prAA_dAHkt",speed:64,pitch:40,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP_Demoscene",synthType:"V2",v2Speech:{text:"!dEH_mOW_sIYn",speed:64,pitch:64,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"KY_Rhodesano0",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:0},osc2:{mode:5,ringMod:!1,transpose:0,detune:9,color:0,level:122},osc3:{mode:0,ringMod:!1,transpose:31,detune:29,color:72,level:0},filter1:{mode:1,cutoff:99,resonance:0},filter2:{mode:0,cutoff:94,resonance:99},routing:{mode:1,balance:64},envelope:{attack:13,decay:104,sustain:0,release:44},envelope2:{attack:4,decay:93,sustain:0,release:64},lfo1:{rate:74,depth:75}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_AnaBass#005",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:7,color:0,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:64,level:125},osc3:{mode:0,ringMod:!1,transpose:-12,detune:0,color:0,level:125},filter1:{mode:1,cutoff:52,resonance:91},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_French HornZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Dry BD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:22,level:122},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:0},filter1:{mode:1,cutoff:122,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:5,release:45},envelope2:{attack:0,decay:35,sustain:0,release:33},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Morseh #000",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:-6,detune:0,color:62,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:94,depth:108}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Transortion",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:63,resonance:95},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:90,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Long Pad007",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:16,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-8,color:64,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:4,cutoff:39,resonance:0},filter2:{mode:1,cutoff:35,resonance:69},routing:{mode:1,balance:64},envelope:{attack:71,decay:94,sustain:96,release:106},envelope2:{attack:114,decay:120,sustain:113,release:112},lfo1:{rate:7,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_JarreStrings",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:12,color:1,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:61,level:34},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:5,cutoff:74,resonance:42},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:26,decay:64,sustain:64,release:49},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:78,depth:2}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_His Shadow's Breath",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:4,level:122},osc2:{mode:4,ringMod:!1,transpose:45,detune:0,color:41,level:77},osc3:{mode:1,ringMod:!1,transpose:12,detune:16,color:3,level:122},filter1:{mode:5,cutoff:67,resonance:97},filter2:{mode:2,cutoff:76,resonance:120},routing:{mode:2,balance:64},envelope:{attack:27,decay:64,sustain:122,release:30},envelope2:{attack:0,decay:102,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Deepness001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:14,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-15,color:0,level:126},filter1:{mode:1,cutoff:76,resonance:47},filter2:{mode:1,cutoff:76,resonance:47},routing:{mode:1,balance:42},envelope:{attack:0,decay:14,sustain:115,release:54},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 SD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Marsian Pan Flute",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:28,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:-27,color:64,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:18,resonance:118},filter2:{mode:1,cutoff:100,resonance:70},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:37,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Lullaby09",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:80,resonance:44},filter2:{mode:2,cutoff:115,resonance:108},routing:{mode:2,balance:64},envelope:{attack:0,decay:64,sustain:64,release:75},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Morpher#072",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-8,color:8,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:12,color:24,level:72},osc3:{mode:1,ringMod:!1,transpose:0,detune:-7,color:97,level:126},filter1:{mode:2,cutoff:0,resonance:86},filter2:{mode:2,cutoff:123,resonance:51},routing:{mode:2,balance:63},envelope:{attack:0,decay:25,sustain:126,release:7},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:24,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Jarresque06",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:124},osc2:{mode:4,ringMod:!1,transpose:23,detune:0,color:98,level:49},osc3:{mode:1,ringMod:!1,transpose:12,detune:10,color:6,level:124},filter1:{mode:2,cutoff:68,resonance:0},filter2:{mode:3,cutoff:120,resonance:0},routing:{mode:2,balance:29},envelope:{attack:75,decay:0,sustain:125,release:98},envelope2:{attack:125,decay:125,sustain:125,release:125},lfo1:{rate:10,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_Awaych #000",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-11,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:12,color:0,level:126},filter1:{mode:2,cutoff:86,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:86,decay:114,sustain:109,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:74,depth:23}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Kicking Saw",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:68,resonance:98},filter2:{mode:1,cutoff:62,resonance:105},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:105,depth:32}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Hiphop BaZZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:42,resonance:0},filter2:{mode:2,cutoff:126,resonance:0},routing:{mode:2,balance:64},envelope:{attack:0,decay:12,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Woodblock",synthType:"V2",v2:{osc1:{mode:3,transpose:12,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:21,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:21,sustain:0,release:25},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Electrons68",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:1,ringMod:!0,transpose:0,detune:-19,color:32,level:125},osc3:{mode:3,ringMod:!0,transpose:31,detune:0,color:114,level:125},filter1:{mode:2,cutoff:67,resonance:95},filter2:{mode:3,cutoff:60,resonance:89},routing:{mode:1,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:91,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Garage Organ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:15,level:125},osc2:{mode:3,ringMod:!1,transpose:48,detune:0,color:32,level:25},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:33},filter1:{mode:1,cutoff:108,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:49,sustain:108,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Lonely Square Lead",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:97},osc2:{mode:2,ringMod:!1,transpose:0,detune:-9,color:64,level:66},osc3:{mode:2,ringMod:!1,transpose:0,detune:6,color:64,level:47},filter1:{mode:2,cutoff:66,resonance:35},filter2:{mode:3,cutoff:98,resonance:10},routing:{mode:2,balance:32},envelope:{attack:0,decay:73,sustain:36,release:55},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Strangeland",synthType:"V2",v2:{osc1:{mode:2,transpose:-12,detune:0,color:2,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:5,color:123,level:126},osc3:{mode:2,ringMod:!1,transpose:0,detune:-9,color:24,level:126},filter1:{mode:3,cutoff:117,resonance:14},filter2:{mode:2,cutoff:91,resonance:15},routing:{mode:2,balance:42},envelope:{attack:10,decay:96,sustain:65,release:102},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:14,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old Saw Percs",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:9,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:23,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:67,resonance:13},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:68},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:50,depth:114}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_SawBass#004",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:4,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-5,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:0,color:6,level:126},filter1:{mode:1,cutoff:64,resonance:7},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:90,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Ridesecken",synthType:"V2",v2:{osc1:{mode:2,transpose:-4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:4,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:2,cutoff:104,resonance:95},routing:{mode:1,balance:64},envelope:{attack:0,decay:26,sustain:57,release:100},envelope2:{attack:0,decay:90,sustain:0,release:95},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Powerbeam15",synthType:"V2",v2:{osc1:{mode:3,transpose:-45,detune:0,color:0,level:124},osc2:{mode:3,ringMod:!0,transpose:-38,detune:0,color:32,level:124},osc3:{mode:5,ringMod:!1,transpose:-2,detune:0,color:67,level:124},filter1:{mode:1,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:125,sustain:0,release:2},envelope2:{attack:0,decay:125,sustain:0,release:0},lfo1:{rate:94,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Glimpse Of a Clavi",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:13,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:82,resonance:102},filter2:{mode:3,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:13},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_PWM Leade)",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:125},osc2:{mode:0,ringMod:!1,transpose:-12,detune:7,color:4,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:73,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:60,decay:114,sustain:80,release:64},envelope2:{attack:126,decay:126,sustain:126,release:0},lfo1:{rate:77,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_LoFi Choir9",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-20,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:82,resonance:98},filter2:{mode:3,cutoff:80,resonance:106},routing:{mode:1,balance:64},envelope:{attack:67,decay:64,sustain:64,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old SawsrnZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_I like to move it",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-13,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:20,color:32,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:58},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:31},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Industrial VeloHammer",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:15,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:61,resonance:113},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:55,sustain:0,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Rave Siren",synthType:"V2",v2:{osc1:{mode:2,transpose:8,detune:4,color:69,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:53,level:107},osc3:{mode:2,ringMod:!1,transpose:-4,detune:5,color:69,level:126},filter1:{mode:3,cutoff:58,resonance:95},filter2:{mode:2,cutoff:100,resonance:90},routing:{mode:1,balance:64},envelope:{attack:0,decay:13,sustain:28,release:86},envelope2:{attack:0,decay:72,sustain:58,release:73},lfo1:{rate:104,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Doj's Organ",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:0,color:32,level:125},osc3:{mode:3,ringMod:!1,transpose:36,detune:0,color:32,level:78},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:38,sustain:107,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Phunny #002",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:26,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:75,resonance:82},filter2:{mode:1,cutoff:64,resonance:0},routing:{mode:2,balance:26},envelope:{attack:7,decay:37,sustain:64,release:53},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:73,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Fairies#001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:63},osc2:{mode:1,ringMod:!1,transpose:0,detune:8,color:0,level:63},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:121},filter1:{mode:3,cutoff:42,resonance:101},filter2:{mode:0,cutoff:108,resonance:0},routing:{mode:0,balance:64},envelope:{attack:72,decay:121,sustain:70,release:100},envelope2:{attack:0,decay:125,sustain:56,release:108},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nastyn-303",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:0,level:125},osc2:{mode:0,ringMod:!1,transpose:0,detune:19,color:0,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:49,resonance:114},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:18},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:61,depth:82}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Squaredance",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:65,level:126},osc3:{mode:2,ringMod:!0,transpose:12,detune:0,color:64,level:22},filter1:{mode:1,cutoff:57,resonance:63},filter2:{mode:2,cutoff:60,resonance:31},routing:{mode:0,balance:64},envelope:{attack:0,decay:26,sustain:100,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Biiiig Drumdamm",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:0,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:81},envelope2:{attack:0,decay:57,sustain:0,release:52},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Random Zaps",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:44,detune:0,color:53,level:126},filter1:{mode:3,cutoff:80,resonance:51},filter2:{mode:1,cutoff:93,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:0},envelope2:{attack:0,decay:0,sustain:46,release:3},lfo1:{rate:22,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_What They Called Pian",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:32,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:34,level:124},filter1:{mode:1,cutoff:95,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:79,sustain:64,release:69},envelope2:{attack:96,decay:0,sustain:124,release:62},lfo1:{rate:76,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Debil? ICH?",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:52,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:97,resonance:62},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:32,sustain:0,release:64},lfo1:{rate:78,depth:113}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Formants From The Cry",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:17,level:126},osc2:{mode:3,ringMod:!0,transpose:36,detune:4,color:112,level:76},osc3:{mode:1,ringMod:!1,transpose:31,detune:0,color:22,level:27},filter1:{mode:2,cutoff:81,resonance:83},filter2:{mode:1,cutoff:73,resonance:104},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_You broke me!bass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:2,level:11},osc2:{mode:1,ringMod:!1,transpose:0,detune:2,color:0,level:10},osc3:{mode:4,ringMod:!1,transpose:6,detune:0,color:53,level:38},filter1:{mode:1,cutoff:78,resonance:30},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:25,depth:117}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Airy HH003",synthType:"V2",v2:{osc1:{mode:4,transpose:35,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:115,resonance:8},filter2:{mode:1,cutoff:116,resonance:24},routing:{mode:1,balance:64},envelope:{attack:0,decay:55,sustain:24,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:97,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Tag You're Its",synthType:"V2",v2:{osc1:{mode:3,transpose:-6,detune:0,color:60,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:61,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:106,resonance:126},filter2:{mode:3,cutoff:95,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:35,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Slow Synthbrass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-9,color:0,level:126},filter1:{mode:1,cutoff:74,resonance:24},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:45,decay:66,sustain:64,release:73},envelope2:{attack:98,decay:91,sustain:121,release:72},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Random Arp3",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:11,color:18,level:98},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:83},filter2:{mode:0,cutoff:58,resonance:0},routing:{mode:0,balance:64},envelope:{attack:4,decay:50,sustain:0,release:57},envelope2:{attack:0,decay:26,sustain:0,release:31},lfo1:{rate:64,depth:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Analog Mod Bass",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:25,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:19,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:39,resonance:105},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:32,decay:64,sustain:64,release:62},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:97}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_HighSnare02",synthType:"V2",v2:{osc1:{mode:3,transpose:3,detune:0,color:0,level:68},osc2:{mode:3,ringMod:!1,transpose:10,detune:0,color:32,level:64},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:23,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:107,sustain:0,release:64},lfo1:{rate:93,depth:25}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Whistling Wind",synthType:"V2",v2:{osc1:{mode:4,transpose:31,detune:0,color:61,level:126},osc2:{mode:4,ringMod:!1,transpose:-10,detune:-13,color:23,level:126},osc3:{mode:0,ringMod:!1,transpose:24,detune:-5,color:96,level:126},filter1:{mode:4,cutoff:62,resonance:40},filter2:{mode:1,cutoff:80,resonance:53},routing:{mode:1,balance:64},envelope:{attack:46,decay:78,sustain:126,release:66},envelope2:{attack:0,decay:0,sustain:11,release:4},lfo1:{rate:5,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Sweeping Dist",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:11,level:126},osc2:{mode:0,ringMod:!1,transpose:38,detune:0,color:65,level:24},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:126},filter2:{mode:0,cutoff:80,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:30}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lofi Squares",synthType:"V2",v2:{osc1:{mode:3,transpose:10,detune:0,color:72,level:126},osc2:{mode:3,ringMod:!0,transpose:12,detune:-1,color:55,level:126},osc3:{mode:2,ringMod:!1,transpose:4,detune:0,color:65,level:126},filter1:{mode:1,cutoff:52,resonance:104},filter2:{mode:2,cutoff:126,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:41,sustain:43,release:8},envelope2:{attack:0,decay:23,sustain:126,release:14},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Not From This World",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:2,color:52,level:126},osc2:{mode:2,ringMod:!0,transpose:4,detune:13,color:23,level:126},osc3:{mode:5,ringMod:!0,transpose:-24,detune:3,color:56,level:126},filter1:{mode:2,cutoff:50,resonance:53},filter2:{mode:2,cutoff:78,resonance:82},routing:{mode:2,balance:63},envelope:{attack:0,decay:83,sustain:126,release:6},envelope2:{attack:0,decay:41,sustain:126,release:10},lfo1:{rate:9,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:-3,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-3,detune:0,color:96,level:126},osc3:{mode:4,ringMod:!1,transpose:21,detune:0,color:36,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:69,sustain:0,release:55},envelope2:{attack:0,decay:32,sustain:0,release:31},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Mod Perc004",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:10,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:60,resonance:110},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:13,decay:39,sustain:24,release:59},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:0,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nice Saws87",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:13,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-13,color:0,level:126},filter1:{mode:1,cutoff:126,resonance:107},filter2:{mode:2,cutoff:113,resonance:65},routing:{mode:2,balance:64},envelope:{attack:0,decay:66,sustain:19,release:70},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:12,depth:102}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Roaar! 007",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:3,color:126,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:-7,color:126,level:26},filter1:{mode:1,cutoff:62,resonance:75},filter2:{mode:3,cutoff:41,resonance:15},routing:{mode:1,balance:64},envelope:{attack:20,decay:64,sustain:126,release:20},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Dist Kick",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_XPlosion007",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:-46,detune:0,color:65,level:126},osc3:{mode:0,ringMod:!1,transpose:-11,detune:0,color:32,level:14},filter1:{mode:1,cutoff:92,resonance:0},filter2:{mode:1,cutoff:25,resonance:10},routing:{mode:1,balance:64},envelope:{attack:0,decay:96,sustain:0,release:96},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Whistlotronic",synthType:"V2",v2:{osc1:{mode:2,transpose:12,detune:0,color:66,level:127},osc2:{mode:0,ringMod:!1,transpose:7,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:4,detune:0,color:27,level:126},filter1:{mode:2,cutoff:86,resonance:0},filter2:{mode:2,cutoff:116,resonance:0},routing:{mode:2,balance:21},envelope:{attack:34,decay:64,sustain:53,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:99,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Tech Arp100",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:13,resonance:32},filter2:{mode:2,cutoff:29,resonance:104},routing:{mode:2,balance:78},envelope:{attack:0,decay:48,sustain:18,release:23},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:1,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Mightyass1",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:9,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:47},filter1:{mode:1,cutoff:25,resonance:69},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:105,sustain:6,release:81},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Rim#003",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:6,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:38,detune:0,color:0,level:121},filter1:{mode:0,cutoff:73,resonance:117},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:11,sustain:0,release:0},envelope2:{attack:0,decay:6,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Hell's Bell",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:91,level:28},osc2:{mode:5,ringMod:!1,transpose:23,detune:50,color:30,level:126},osc3:{mode:3,ringMod:!0,transpose:-64,detune:0,color:102,level:24},filter1:{mode:1,cutoff:80,resonance:106},filter2:{mode:3,cutoff:37,resonance:77},routing:{mode:1,balance:64},envelope:{attack:0,decay:65,sustain:126,release:77},envelope2:{attack:0,decay:46,sustain:15,release:13},lfo1:{rate:28,depth:52}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Farscape04",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:4,ringMod:!1,transpose:-44,detune:-10,color:0,level:6},osc3:{mode:3,ringMod:!1,transpose:0,detune:1,color:32,level:126},filter1:{mode:1,cutoff:86,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:80,decay:64,sustain:112,release:94},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:27,depth:109}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lethal PWM0",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:80,resonance:0},filter2:{mode:5,cutoff:114,resonance:91},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:116,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:68,depth:34}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Soaring#088",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-4,color:126,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:-11,color:0,level:126},filter1:{mode:1,cutoff:33,resonance:51},filter2:{mode:1,cutoff:77,resonance:115},routing:{mode:1,balance:64},envelope:{attack:0,decay:126,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:8,depth:46}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_Trombrato02",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:14,color:0,level:121},osc2:{mode:0,ringMod:!1,transpose:0,detune:-15,color:0,level:82},osc3:{mode:0,ringMod:!1,transpose:12,detune:2,color:0,level:76},filter1:{mode:1,cutoff:70,resonance:0},filter2:{mode:1,cutoff:70,resonance:23},routing:{mode:1,balance:64},envelope:{attack:46,decay:64,sustain:121,release:20},envelope2:{attack:94,decay:125,sustain:125,release:26},lfo1:{rate:0,depth:17}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noiseh #004",synthType:"V2",v2:{osc1:{mode:4,transpose:5,detune:0,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:67,resonance:83},filter2:{mode:2,cutoff:86,resonance:66},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:113,release:26},envelope2:{attack:0,decay:25,sustain:20,release:121},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Disturbing7",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:122},osc2:{mode:4,ringMod:!1,transpose:52,detune:0,color:32,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:122},filter1:{mode:2,cutoff:89,resonance:89},filter2:{mode:2,cutoff:78,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:77,sustain:123,release:0},envelope2:{attack:0,decay:106,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Bontempi002",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:5,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:2,cutoff:45,resonance:0},filter2:{mode:0,cutoff:47,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:41,release:70},envelope2:{attack:0,decay:64,sustain:64,release:90},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_FlangeHats2",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Screeeam!IKAAAA!!!",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-17,color:63,level:55},osc2:{mode:1,ringMod:!1,transpose:12,detune:-43,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:92,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:14,decay:64,sustain:64,release:42},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:82,depth:87}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Kick075",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Synth Jew's Harp",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:5,level:123},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},filter1:{mode:2,cutoff:9,resonance:113},filter2:{mode:1,cutoff:81,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:27},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Snaree",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:124},osc2:{mode:4,ringMod:!1,transpose:25,detune:0,color:102,level:108},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:0,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:39,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Cheap Arp08",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:14,color:0,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:1,cutoff:83,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:42,sustain:38,release:71},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 HHs 104",synthType:"V2",v2:{osc1:{mode:2,transpose:4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:24,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:3,cutoff:104,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_VeloFuzz001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:1,color:0,level:126},osc2:{mode:2,ringMod:!0,transpose:24,detune:14,color:63,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:4,resonance:116},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Hefty Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:-54,detune:3,color:70,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:0,color:65,level:126},filter1:{mode:1,cutoff:122,resonance:11},filter2:{mode:3,cutoff:41,resonance:42},routing:{mode:1,balance:64},envelope:{attack:0,decay:98,sustain:126,release:47},envelope2:{attack:0,decay:54,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_yasgch #005",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:9,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:59},filter2:{mode:0,cutoff:59,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:118,sustain:114,release:35},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Synth Kick",synthType:"V2",v2:{osc1:{mode:1,transpose:-3,detune:0,color:61,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:0,cutoff:27,resonance:56},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:34,sustain:0,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Hihats 2",synthType:"V2",v2:{osc1:{mode:2,transpose:-10,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:91},filter2:{mode:2,cutoff:108,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 1001",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:26,resonance:126},filter2:{mode:2,cutoff:25,resonance:126},routing:{mode:1,balance:64},envelope:{attack:0,decay:61,sustain:0,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 13",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:3,ringMod:!1,transpose:0,detune:7,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:60},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:76,depth:104}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 28",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:70,sustain:0,release:92},envelope2:{attack:0,decay:37,sustain:0,release:40},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistSnare11",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:32,level:0},osc2:{mode:3,ringMod:!1,transpose:8,detune:36,color:32,level:0},osc3:{mode:4,ringMod:!1,transpose:35,detune:0,color:70,level:124},filter1:{mode:5,cutoff:73,resonance:115},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:56,sustain:0,release:65},envelope2:{attack:0,decay:15,sustain:0,release:0},lfo1:{rate:64,depth:105}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 Ride",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:14},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:18},osc3:{mode:4,ringMod:!1,transpose:50,detune:0,color:66,level:123},filter1:{mode:3,cutoff:124,resonance:0},filter2:{mode:2,cutoff:104,resonance:100},routing:{mode:1,balance:64},envelope:{attack:0,decay:54,sustain:0,release:75},envelope2:{attack:0,decay:64,sustain:123,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 HHs + Dis",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 1 #000",synthType:"V2",v2:{osc1:{mode:3,transpose:-7,detune:0,color:32,level:127},osc2:{mode:3,ringMod:!1,transpose:-7,detune:9,color:32,level:127},osc3:{mode:4,ringMod:!1,transpose:29,detune:0,color:64,level:0},filter1:{mode:0,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:47,sustain:0,release:43},envelope2:{attack:0,decay:46,sustain:1,release:75},lfo1:{rate:90,depth:107}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:4,detune:-64,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:-1,detune:-13,color:32,level:91},osc3:{mode:4,ringMod:!1,transpose:-11,detune:44,color:0,level:34},filter1:{mode:1,cutoff:68,resonance:0},filter2:{mode:2,cutoff:84,resonance:63},routing:{mode:2,balance:15},envelope:{attack:0,decay:0,sustain:65,release:64},envelope2:{attack:0,decay:63,sustain:99,release:76},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_March Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:6,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:12,detune:1,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Nice Synth HH",synthType:"V2",v2:{osc1:{mode:4,transpose:53,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:121,resonance:121},filter2:{mode:1,cutoff:117,resonance:114},routing:{mode:2,balance:64},envelope:{attack:0,decay:20,sustain:20,release:8},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Crash",synthType:"V2",v2:{osc1:{mode:4,transpose:62,detune:62,color:106,level:126},osc2:{mode:4,ringMod:!1,transpose:62,detune:50,color:51,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:26,color:108,level:126},filter1:{mode:3,cutoff:126,resonance:55},filter2:{mode:1,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:47,sustain:21,release:77},envelope2:{attack:0,decay:113,sustain:70,release:124},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Open HH",synthType:"V2",v2:{osc1:{mode:4,transpose:36,detune:0,color:82,level:126},osc2:{mode:0,ringMod:!1,transpose:9,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:112,resonance:106},filter2:{mode:0,cutoff:104,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:44,sustain:0,release:32},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Pop BD #003",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:121},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:36,detune:0,color:90,level:0},filter1:{mode:1,cutoff:121,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:0,release:52},envelope2:{attack:0,decay:23,sustain:0,release:0},lfo1:{rate:80,depth:84}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Snappy Snare",synthType:"V2",v2:{osc1:{mode:1,transpose:-10,detune:0,color:72,level:126},osc2:{mode:5,ringMod:!1,transpose:0,detune:0,color:64,level:38},osc3:{mode:4,ringMod:!1,transpose:33,detune:0,color:76,level:126},filter1:{mode:3,cutoff:53,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:45,sustain:0,release:19},envelope2:{attack:0,decay:18,sustain:0,release:0},lfo1:{rate:105,depth:11}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Ver|bt Snare",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:60,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:-21,color:126,level:88},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:82,resonance:126},filter2:{mode:1,cutoff:22,resonance:126},routing:{mode:2,balance:17},envelope:{attack:0,decay:0,sustain:126,release:14},envelope2:{attack:0,decay:83,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #100",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #101",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #102",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #103",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #104",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #105",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #106",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #107",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #108",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #109",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #110",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #111",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #112",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #113",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #114",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #115",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #116",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #117",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #118",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #119",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #120",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #121",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #122",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #123",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #124",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #125",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #126",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #127",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0}],Om=[{type:"synth",name:"SAM_Classic",synthType:"Sam",sam:{text:"SAM IS BACK",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_C64",synthType:"Sam",sam:{text:"COMMODORE SIXTY FOUR",pitch:64,speed:64,mouth:150,throat:110,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_Robotic",synthType:"Sam",sam:{text:"EXTERMINATE",pitch:40,speed:80,mouth:200,throat:200,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_High",synthType:"Sam",sam:{text:"I HAVE A HIGH VOICE",pitch:100,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0}],Fm=[{type:"synth",name:"Astrocade Clean Square",synthType:"MAMEAstrocade",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Vibrato Lead",synthType:"MAMEAstrocade",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Buzz",synthType:"MAMEAstrocade",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Rumble",synthType:"MAMEAstrocade",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Laser",synthType:"MAMESN76477",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Explosion",synthType:"MAMESN76477",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Engine",synthType:"MAMESN76477",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Siren",synthType:"MAMESN76477",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Organ",synthType:"MAMEMSM5232",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Full Brass",synthType:"MAMEMSM5232",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Strings",synthType:"MAMEMSM5232",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Reedy Combo",synthType:"MAMEMSM5232",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Piano",synthType:"MAMETMS36XX",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Banjo",synthType:"MAMETMS36XX",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Organ",synthType:"MAMETMS36XX",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Sine",synthType:"MAMESNKWave",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Square",synthType:"MAMESNKWave",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Triangle",synthType:"MAMESNKWave",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"YMOPQ E.Piano",synthType:"MAMEYMOPQ",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Brass",synthType:"MAMEYMOPQ",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Strings",synthType:"MAMEYMOPQ",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bass",synthType:"MAMEYMOPQ",parameters:{_program:3},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Organ",synthType:"MAMEYMOPQ",parameters:{_program:4},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Lead",synthType:"MAMEYMOPQ",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Pad",synthType:"MAMEYMOPQ",parameters:{_program:6},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bell",synthType:"MAMEYMOPQ",parameters:{_program:7},effects:[],volume:-8,pan:0},{type:"synth",name:"MEA8000 Vowel A",synthType:"MAMEMEA8000",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel E",synthType:"MAMEMEA8000",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel O",synthType:"MAMEMEA8000",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Nasal",synthType:"MAMEMEA8000",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel AH",synthType:"MAMESP0250",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel EE",synthType:"MAMESP0250",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel OO",synthType:"MAMESP0250",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax EH",synthType:"MAMEVotrax",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AW",synthType:"MAMEVotrax",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AH",synthType:"MAMEVotrax",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax OO",synthType:"MAMEVotrax",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"ES5503 Default",synthType:"MAMEES5503",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"YMF271 FM Piano",synthType:"MAMEYMF271",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Brass",synthType:"MAMEYMF271",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Strings",synthType:"MAMEYMF271",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"TR707 Default Kit",synthType:"MAMETR707",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Bass",synthType:"MAMEVASynth",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Lead",synthType:"MAMEVASynth",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pad",synthType:"MAMEVASynth",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pluck",synthType:"MAMEVASynth",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"TIA Square",synthType:"MAMETIA",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TIA Buzz",synthType:"MAMETIA",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD931 Default",synthType:"MAMEUPD931",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD933 Default",synthType:"MAMEUPD933",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS5220 Speech",synthType:"MAMETMS5220",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Sine",synthType:"MAMEASC",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Square",synthType:"MAMEASC",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"AICA Default",synthType:"MAMEAICA",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"SCSP Default",synthType:"SCSP",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"C352 Default",synthType:"MAMEC352",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"RF5C400 Default",synthType:"MAMERF5C400",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"ICS2115 Default",synthType:"MAMEICS2115",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"K054539 Default",synthType:"MAMEK054539",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Bass",synthType:"CEM3394",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"CEM3394 Lead",synthType:"CEM3394",parameters:{_program:1,volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Pad",synthType:"CEM3394",parameters:{_program:2,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"SCSP Synth Bass",synthType:"SCSP",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"SCSP Poly Pad",synthType:"SCSP",parameters:{_program:1,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"AICA FM Piano",synthType:"MAMEAICA",parameters:{_program:0,volume:.8},effects:[],volume:-10,pan:0}],Dm=(e,t,n=0,a=7)=>({level:e,coarse:t,fine:n,detune:a,egRates:[99,99,99,99],egLevels:[99,99,99,0]}),Rm=[{name:"DX7 E.Piano 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:dl["E.PIANO 1"]},{name:"DX7 E.Piano Bright",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{...dl["E.PIANO 1"],feedback:7}},{name:"DX7 Clavinet",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,60,30,60],egLevels:[99,0,0,0]},{level:80,coarse:2,egRates:[99,50,20,50],egLevels:[99,0,0,0]},Dm(0,1),Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Organ",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:3,feedback:0,operators:[{level:99,coarse:1},{level:90,coarse:2},{level:85,coarse:3},{level:80,coarse:4},Dm(0,1),Dm(0,1)]}},{name:"DX7 Bass 1",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:5,feedback:7,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:75,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:50,coarse:2,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Slap Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:16,feedback:6,operators:[{level:99,coarse:1,egRates:[99,60,40,60],egLevels:[99,95,0,0]},{level:88,coarse:4,egRates:[99,80,60,80],egLevels:[99,0,0,0]},Dm(0,1),Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Solid Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:18,feedback:4,operators:[{level:99,coarse:0,fine:50},{level:80,coarse:1},{level:70,coarse:1},Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Tubular Bells",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:1,feedback:5,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,40,20,50],egLevels:[99,0,0,0]},{level:85,coarse:3,fine:50,detune:7,egRates:[99,60,30,50],egLevels:[99,0,0,0]},Dm(0,1),Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Marimba",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,70,30,60],egLevels:[99,0,0,0]},{level:80,coarse:4,egRates:[99,60,20,50],egLevels:[99,0,0,0]},Dm(0,1),Dm(0,1),Dm(0,1),Dm(0,1)]}},{name:"DX7 Brass 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:dl["BRASS 1"]},{name:"DX7 Strings 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:dl["STRINGS 1"]},{name:"DX7 Init Voice",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:dl["INIT VOICE"]}],jm=[{name:"OB-X Classic Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:rc["Classic Brass"]},{name:"OB-X Bright Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{...rc["Classic Brass"],filterCutoff:.6,filterEnvAmount:.7,unison:!0,unisonDetune:.1}},{name:"OB-X Fat Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:rc["Fat Lead"]},{name:"OB-X Sync Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:rc["Sync Lead"]},{name:"OB-X Unison Saw",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,unison:!0,unisonDetune:.2,panSpread:.5,filterCutoff:1,ampRelease:.2}},{name:"OB-X Rez Bass",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:1,osc2Detune:.08,filterCutoff:.3,filterResonance:.6,filterEnvAmount:.7,filterAttack:.05,filterDecay:.2,ampAttack:.01,ampDecay:.3}},{name:"OB-X Sub Bass",type:"synth",synthType:"OBXd",volume:-6,pan:0,effects:[],obxd:{osc1Waveform:2,osc2Waveform:0,osc2Octave:-1,filterCutoff:.2,filterResonance:0,filterEnvAmount:.3,filterDecay:.4}},{name:"OB-X PWM Strings",type:"synth",synthType:"OBXd",volume:-12,pan:0,effects:[],obxd:{osc1Waveform:1,osc2Waveform:1,osc1PulseWidth:.5,osc2Detune:.03,lfoRate:.2,lfoPwAmount:.4,filterCutoff:.4,filterResonance:.1,ampAttack:.2,ampRelease:.5}},{name:"OB-X Pulse Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:rc["Pulse Pad"]},{name:"OB-X Sweep Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,filterCutoff:.3,filterResonance:.5,lfoRate:.1,lfoFilterAmount:.4,ampAttack:.5,ampRelease:.8}},{name:"OB-X S&H Sci-Fi",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:1,lfoWaveform:4,lfoRate:.7,lfoFilterAmount:.8,lfoOscAmount:.3,filterResonance:.7}},{name:"OB-X Init",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:rc.Init}],Lm=[{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.NES}},{name:"NES Pulse 12.5%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.NES,nes:{dutyNoise:0,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Pulse 25%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.NES,nes:{dutyNoise:1,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Triangle Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.NES}},{name:"NES Noise Drums",type:"synth",synthType:"FurnaceNES",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.NES}},{name:"MMC5 Expansion Init",type:"synth",synthType:"FurnaceMMC5",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.MMC5}},{name:"GB Pulse 50%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"GB Pulse 25%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"GB Noise Snare",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"GB Wave Organ",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"GB Noise HiHat",type:"synth",synthType:"FurnaceGB",volume:-12,pan:0,effects:[],furnace:{chipType:Kr.GB}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.PSG}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.PSG}},{name:"PSG Periodic Noise",type:"synth",synthType:"FurnacePSG",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.PSG}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.PCE}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.PCE}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.VIC}},{name:"VIC Noise",type:"synth",synthType:"FurnaceVIC",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.VIC}},{name:"TIA Square",type:"synth",synthType:"FurnaceTIA",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.TIA}},{name:"TIA Bass",type:"synth",synthType:"FurnaceTIA",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.TIA}},{name:"OPL3 FM Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.OPL3,algorithm:0,feedback:6}},{name:"OPL3 FM Strings",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.OPL3,algorithm:1,feedback:2}},{name:"OPL3 FM Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.OPL3,algorithm:0,feedback:4}},{name:"Amiga ST-01 Bass",type:"synth",synthType:"FurnaceAMIGA",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Lead Strings",type:"synth",synthType:"FurnaceAMIGA",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Poly Pad",type:"synth",synthType:"FurnaceAMIGA",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"PET Bleep",type:"synth",synthType:"FurnacePET",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.PET}},{name:"PC Speaker Beeper",type:"synth",synthType:"FurnacePCSPKR",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.PCSPKR}},{name:"ZX Beeper QuadTone",type:"synth",synthType:"FurnaceZXBEEPER",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.ZXBEEPER_QT}},{name:"SID Pulse PWM",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.SID}},{name:"SID Ring Mod",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.SID}},{name:"GBA Synth Bass",type:"synth",synthType:"FurnaceGBA",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.GBA_DMA}},{name:"GBA Lead Strings",type:"synth",synthType:"FurnaceGBA",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.GBA_DMA}},{name:"NDS Piano",type:"synth",synthType:"FurnaceNDS",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.NDS}},{name:"NDS Pad",type:"synth",synthType:"FurnaceNDS",volume:-12,pan:0,effects:[],furnace:{chipType:Kr.NDS}},{name:"Virtual Boy Lead",type:"synth",synthType:"FurnaceVB",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.VB}},{name:"WonderSwan Wave",type:"synth",synthType:"FurnaceSWAN",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.SWAN}},{name:"Atari Lynx Pulse",type:"synth",synthType:"FurnaceLynx",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.LYNX}},{name:"Neo Geo Pocket Bass",type:"synth",synthType:"FurnaceT6W28",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.T6W28}},{name:"QSound Fat Bass",type:"synth",synthType:"FurnaceQSOUND",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.QSOUND}},{name:"Sega MultiPCM Strings",type:"synth",synthType:"FurnaceMULTIPCM",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.MULTIPCM}},{name:"Sega PCM Lead",type:"synth",synthType:"FurnaceSEGAPCM",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.SEGAPCM}},{name:"Namco C140 Drum",type:"synth",synthType:"FurnaceC140",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.C140}},{name:"OKI MSM6295 Kick",type:"synth",synthType:"FurnaceOKI",volume:-4,pan:0,effects:[],furnace:{chipType:Kr.OKI}},{name:"OKI MSM6258 Snare",type:"synth",synthType:"FurnaceMSM6258",volume:-6,pan:0,effects:[],furnace:{chipType:Kr.MSM6258}},{name:"YM2203 FM Bass",type:"synth",synthType:"FurnaceOPN2203",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.OPN,algorithm:4,feedback:5}},{name:"YM2608 FM Strings",type:"synth",synthType:"FurnaceOPNA",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.OPNA,algorithm:5,feedback:3}},{name:"YM2610 FM Lead",type:"synth",synthType:"FurnaceOPNB",volume:-8,pan:0,effects:[],furnace:{chipType:Kr.OPNB,algorithm:4,feedback:6}},{name:"YMF278B FM Piano",type:"synth",synthType:"FurnaceOPL4",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.OPL4,algorithm:4,feedback:2}},{name:"VRC7 FM Brass",type:"synth",synthType:"FurnaceVRC7",volume:-10,pan:0,effects:[],furnace:{chipType:Kr.OPLL,algorithm:0,feedback:4}}],Bm="/data/samples/packs/casio-mt40/leads",Vm="/data/samples/packs/drumnibus",zm=[{name:"MT-40 Accordion",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/accordion.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/brass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Clarinet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/clarinet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Elec Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/elec piano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Harpsichord",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/harpsichord.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Pipe Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/pipe-organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Trumpet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/trumpet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Violin",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/violin.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Celesta",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bm}/celesta.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Funny Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/funny fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Xylophone",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/xylophone.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Gloken",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bm}/glocken.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Folk Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/folk flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 ST Ensemble",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bm}/st ensemble.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Synth Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bm}/synth fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${Vm}/kicks/BD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Analog",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Vm}/snares/SD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Wolf",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Vm}/snares/SD_Wolf1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Percussion Tom",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Vm}/percussion/TOM_Magnotron.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus HiHat Digidap",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Vm}/hihats/CH_Digidap.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Player Analog Kick",type:"synth",synthType:"Player",volume:-6,pan:0,effects:[],parameters:{sampleUrl:`${Vm}/kicks/BD_Analog1.wav`}},{name:"Player Analog Snare",type:"synth",synthType:"Player",volume:-8,pan:0,effects:[],parameters:{sampleUrl:`${Vm}/snares/SD_Analog1.wav`}},{name:"Player Sci-Fi FX",type:"synth",synthType:"Player",volume:-10,pan:0,effects:[],parameters:{sampleUrl:`${Vm}/fx/FX_AnalogFX1.wav`}},{name:"Granular Casio Flute",type:"synth",synthType:"GranularSynth",volume:-10,pan:0,effects:[],granular:{sampleUrl:`${Bm}/flute.wav`,grainSize:100,grainOverlap:50,detune:10,randomPitch:20,density:8,scanSpeed:10,playbackRate:1,randomPosition:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"Granular Drumnibus Texture",type:"synth",synthType:"GranularSynth",volume:-12,pan:0,effects:[],granular:{sampleUrl:`${Vm}/fx/FX_Blarper.wav`,grainSize:200,grainOverlap:10,detune:-5,randomPosition:30,density:12,scanSpeed:5,playbackRate:1,randomPitch:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"MT-40 Full Lead Set",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:"",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1,multiMap:{C2:`${Bm}/bass.wav`,C3:`${Bm}/cello.wav`,C4:`${Bm}/elec piano.wav`,C5:`${Bm}/glocken.wav`,C6:`${Bm}/funny fuzz.wav`}}}],Um=[{name:"Wavetable Bell",type:"synth",synthType:"Wavetable",volume:-12,pan:0,effects:[],wavetable:{wavetableId:"bell-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:1,detune:0,stereoSpread:0},envelope:{attack:10,decay:1e3,sustain:0,release:100},filter:{type:"lowpass",cutoff:12e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Brass",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"brass-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:2,detune:10,stereoSpread:50},envelope:{attack:50,decay:500,sustain:50,release:200},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:30},filterEnvelope:{attack:100,decay:300,sustain:0,release:100}}},{name:"Wavetable Choir",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"choir-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:4,detune:15,stereoSpread:80},envelope:{attack:200,decay:500,sustain:100,release:500},filter:{type:"lowpass",cutoff:4e3,resonance:5,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Heavy Bass",type:"synth",synthType:"Wavetable",volume:-8,pan:0,effects:[],wavetable:{wavetableId:"m4-bass01",morphPosition:0,morphModSource:"envelope",morphModAmount:50,morphLFORate:0,unison:{voices:2,detune:15,stereoSpread:40},envelope:{attack:5,decay:400,sustain:20,release:150},filter:{type:"lowpass",cutoff:2e3,resonance:40,envelopeAmount:60},filterEnvelope:{attack:10,decay:300,sustain:0,release:100}}}],Gm={"Soft Clip":{machineType:xi.ARGURU_DISTORTION,parameters:{0:256,1:1024,2:1024,3:1024,4:0,5:0}},"Hard Clip":{machineType:xi.ARGURU_DISTORTION,parameters:{0:512,1:256,2:256,3:768,4:0,5:0}},"Heavy Saturate":{machineType:xi.ARGURU_DISTORTION,parameters:{0:768,1:512,2:512,3:1280,4:0,5:1}}},Km={"Low Pass":{machineType:xi.ELAK_SVF,parameters:{0:500,1:512}},"Low Pass Resonant":{machineType:xi.ELAK_SVF,parameters:{0:300,1:40960}},"High Pass":{machineType:xi.ELAK_SVF,parameters:{0:700,1:1024}}},Hm={[xi.ARGURU_DISTORTION]:Gm,[xi.ELAK_SVF]:Km,[xi.FSM_KICK]:{"Hard Kick":{machineType:xi.FSM_KICK,parameters:{0:100,1:80}},"Soft Kick":{machineType:xi.FSM_KICK,parameters:{0:60,1:40}},"Long 808-ish":{machineType:xi.FSM_KICK,parameters:{0:80,1:120}}},[xi.FSM_KICKXP]:{"Init KickXP":{machineType:xi.FSM_KICKXP,parameters:{}},"Extreme Kick":{machineType:xi.FSM_KICKXP,parameters:{0:127,1:127}}},[xi.JESKOLA_TRILOK]:{"Punchy BD":{machineType:xi.JESKOLA_TRILOK,parameters:{0:80,1:60}},"Deep BD":{machineType:xi.JESKOLA_TRILOK,parameters:{0:40,1:90}}},[xi.JESKOLA_NOISE]:{"White Noise":{machineType:xi.JESKOLA_NOISE,parameters:{0:0}},"Pink Noise":{machineType:xi.JESKOLA_NOISE,parameters:{0:1}},"Noisy FX":{machineType:xi.JESKOLA_NOISE,parameters:{0:2,1:100}}},[xi.OOMEK_AGGRESSOR]:{"Acid Bass":{machineType:xi.OOMEK_AGGRESSOR,parameters:{1:120,2:96,3:80,4:64}},"Squelchy Lead":{machineType:xi.OOMEK_AGGRESSOR,parameters:{1:160,2:127,3:96,4:80}},"Soft Sub":{machineType:xi.OOMEK_AGGRESSOR,parameters:{1:48,2:32,3:32,4:96}}},[xi.OOMEK_AGGRESSOR_DF]:{"DF Screamer":{machineType:xi.OOMEK_AGGRESSOR_DF,parameters:{1:176,2:127,13:1,15:2}},"DF Infinite":{machineType:xi.OOMEK_AGGRESSOR_DF,parameters:{1:96,10:100,9:127}}},[xi.MADBRAIN_4FM2F]:{"FM Bass":{machineType:xi.MADBRAIN_4FM2F,parameters:{0:10,1:80,2:40}},"FM Lead":{machineType:xi.MADBRAIN_4FM2F,parameters:{0:40,1:100,2:60}},"FM Pad":{machineType:xi.MADBRAIN_4FM2F,parameters:{0:60,1:50,2:100}}},[xi.MADBRAIN_DYNAMITE6]:{"Additive Lead":{machineType:xi.MADBRAIN_DYNAMITE6,parameters:{0:80,1:40}},"Organ-like":{machineType:xi.MADBRAIN_DYNAMITE6,parameters:{0:60,1:100}}},[xi.MAKK_M3]:{"M3 Lead":{machineType:xi.MAKK_M3,parameters:{0:64,1:64}},"M3 Bass":{machineType:xi.MAKK_M3,parameters:{0:127,1:32}}},[xi.MAKK_M4]:{"M4 Wavetable":{machineType:xi.MAKK_M4,parameters:{0:0}},"M4 Sweep":{machineType:xi.MAKK_M4,parameters:{0:50,1:100}}},[xi.CYANPHASE_DTMF]:{"Phone Tones":{machineType:xi.CYANPHASE_DTMF,parameters:{}}},[xi.ELENZIL_FREQUENCYBOMB]:{"Freq Bomb":{machineType:xi.ELENZIL_FREQUENCYBOMB,parameters:{0:100}}},[xi.ELAK_DIST2]:{},[xi.JESKOLA_DISTORTION]:{},[xi.GEONIK_OVERDRIVE]:{},[xi.GRAUE_SOFTSAT]:{},[xi.WHITENOISE_STEREODIST]:{},[xi.CYANPHASE_NOTCH]:{},[xi.Q_ZFILTER]:{},[xi.FSM_PHILTA]:{},[xi.JESKOLA_DELAY]:{},[xi.JESKOLA_CROSSDELAY]:{},[xi.JESKOLA_FREEVERB]:{},[xi.FSM_PANZERDELAY]:{},[xi.FSM_CHORUS]:{},[xi.FSM_CHORUS2]:{},[xi.WHITENOISE_WHITECHORUS]:{},[xi.BIGYO_FREQUENCYSHIFTER]:{},[xi.GEONIK_COMPRESSOR]:{},[xi.LD_SLIMIT]:{},[xi.OOMEK_EXCITER]:{},[xi.OOMEK_MASTERIZER]:{},[xi.DEDACODE_STEREOGAIN]:{}};function Wm(e){return Object.keys(function(e){return Hm[e]||{}}(e))}const $m=[xi.FSM_KICK,xi.FSM_KICKXP,xi.JESKOLA_TRILOK,xi.JESKOLA_NOISE,xi.OOMEK_AGGRESSOR,xi.OOMEK_AGGRESSOR_DF,xi.MADBRAIN_4FM2F,xi.MADBRAIN_DYNAMITE6,xi.MAKK_M3,xi.MAKK_M4,xi.CYANPHASE_DTMF,xi.ELENZIL_FREQUENCYBOMB],qm=[];for(const lT of $m){const e=Hm[lT];if(e)for(const[t,n]of Object.entries(e)){const e=`Buzz ${t}`;qm.push({name:e,type:"synth",synthType:`Buzz${Ym(lT)}`,volume:-10,pan:0,effects:[],parameters:n.parameters})}}function Ym(e){switch(e){case xi.FSM_KICK:return"Kick";case xi.FSM_KICKXP:return"KickXP";case xi.JESKOLA_TRILOK:return"Trilok";case xi.JESKOLA_NOISE:return"Noise";case xi.OOMEK_AGGRESSOR:return"Aggressor";case xi.OOMEK_AGGRESSOR:return"3o3";case xi.OOMEK_AGGRESSOR_DF:return"3o3DF";case xi.MADBRAIN_4FM2F:return"4FM2F";case xi.MADBRAIN_DYNAMITE6:return"Dynamite6";case xi.MAKK_M3:return"M3";case xi.MAKK_M4:return"M4";case xi.CYANPHASE_DTMF:return"DTMF";case xi.ELENZIL_FREQUENCYBOMB:return"FreqBomb";default:return e}}const Xm=[{name:"M4 Deep Bass",type:"synth",synthType:"BuzzM4",volume:-8,pan:0,effects:[],parameters:{0:1,1:64,2:32,3:80}},{name:"M4 Sub Bass",type:"synth",synthType:"BuzzM4",volume:-6,pan:0,effects:[],parameters:{0:5,1:0,2:20}},{name:"M4 Rezzy Growl",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:13,1:127,2:45,3:110}},{name:"M4 Sharp Saw",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:20,1:64,2:100,3:20}},{name:"M4 Digi Lead",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:45,1:80,2:120}},{name:"M4 Sync Lead",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:30,1:64,4:12}},{name:"M4 Soft Pad",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:60,1:64,2:60,3:10}},{name:"M4 Metallic Text",type:"synth",synthType:"BuzzM4",volume:-14,pan:0,effects:[],parameters:{0:85,1:100,2:80,3:90}}],Qm=[{type:"synth",name:"Classic Wobble",synthType:"WobbleBass",wobbleBass:{mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Growl Bass",synthType:"WobbleBass",wobbleBass:{mode:"growl",osc1:{type:"sawtooth",octave:-2,detune:0,level:100},osc2:{type:"square",octave:-2,detune:5,level:70},sub:{enabled:!0,octave:-2,level:80},fm:{enabled:!0,amount:40,ratio:1,envelope:60},unison:{voices:2,detune:10,stereoSpread:30},filter:{type:"bandpass",cutoff:600,resonance:40,rolloff:-12,drive:50,keyTracking:20},filterEnvelope:{amount:50,attack:10,decay:400,sustain:40,release:200},wobbleLFO:{enabled:!0,sync:"1/8",rate:4,shape:"saw",amount:60,pitchAmount:0,fmAmount:30,phase:0,retrigger:!0},envelope:{attack:5,decay:300,sustain:60,release:200},distortion:{enabled:!0,type:"hard",drive:60,tone:50},formant:{enabled:!0,vowel:"O",morph:50,lfoAmount:40}},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Wobble",synthType:"WobbleBass",wobbleBass:{mode:"reese",osc1:{type:"sawtooth",octave:-1,detune:-10,level:90},osc2:{type:"sawtooth",octave:-1,detune:10,level:90},sub:{enabled:!0,octave:-2,level:70},fm:{enabled:!1,amount:0,ratio:1,envelope:0},unison:{voices:6,detune:25,stereoSpread:80},filter:{type:"lowpass",cutoff:1200,resonance:30,rolloff:-24,drive:20,keyTracking:0},filterEnvelope:{amount:0,attack:0,decay:0,sustain:0,release:0},wobbleLFO:{enabled:!0,sync:"1/2",rate:1,shape:"triangle",amount:50,pitchAmount:0,fmAmount:0,phase:0,retrigger:!1},envelope:{attack:20,decay:500,sustain:100,release:800},distortion:{enabled:!0,type:"soft",drive:30,tone:60},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Pluck Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:300,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Fat Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:5,octave:-1},envelope:{attack:10,decay:400,sustain:.4,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Sine Sub",synthType:"Synth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:65},filterEnvelope:{envMod:60,decay:200},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:85},filterEnvelope:{envMod:80,decay:150},accent:{amount:80},slide:{time:50,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Deep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:40},filterEnvelope:{envMod:30,decay:300},accent:{amount:60},slide:{time:80,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:700,resonance:60},filterEnvelope:{envMod:50,decay:180},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:92},filterEnvelope:{envMod:95,decay:100},accent:{amount:90},slide:{time:40,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Bubbly",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:75},filterEnvelope:{envMod:70,decay:80},accent:{amount:75},slide:{time:30,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Self-Osc",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:98},filterEnvelope:{envMod:85,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Plastikman",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:40,decay:250},accent:{amount:65},slide:{time:100,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:70},filterEnvelope:{envMod:55,decay:250},accent:{amount:75},slide:{time:50,mode:"exponential"},devilFish:{enabled:!0,normalDecay:300,accentDecay:150,vegDecay:2500,vegSustain:0,softAttack:2,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Infinite Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:30,decay:400},accent:{amount:50},slide:{time:120,mode:"exponential"},devilFish:{enabled:!0,normalDecay:800,accentDecay:600,vegDecay:3e3,vegSustain:100,softAttack:15,filterTracking:50,filterFmDepth:10,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1400,resonance:85},filterEnvelope:{envMod:80,decay:350},accent:{amount:100},slide:{time:30,mode:"exponential"},overdrive:{amount:70,modelIndex:0,drive:70,dryWet:100},devilFish:{enabled:!0,normalDecay:200,accentDecay:100,vegDecay:500,vegSustain:20,softAttack:.5,filterTracking:80,filterFmDepth:80,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!0,muffler:"hard"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Whistler",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1600,resonance:92},filterEnvelope:{envMod:70,decay:500},accent:{amount:80},slide:{time:100,mode:"exponential"},devilFish:{enabled:!0,normalDecay:400,accentDecay:300,vegDecay:1500,vegSustain:30,softAttack:5,filterTracking:150,filterFmDepth:25,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Muffled Punch",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:60},filterEnvelope:{envMod:65,decay:150},accent:{amount:90},slide:{time:45,mode:"exponential"},devilFish:{enabled:!0,normalDecay:100,accentDecay:80,vegDecay:200,vegSustain:0,softAttack:.5,filterTracking:30,filterFmDepth:15,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Acid Low",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:400,resonance:72},filterEnvelope:{envMod:50,decay:300},accent:{amount:80},slide:{time:80,mode:"exponential"},devilFish:{enabled:!0,normalDecay:250,accentDecay:120,vegDecay:800,vegSustain:15,softAttack:1.5,filterTracking:40,filterFmDepth:20,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Resonant Sweep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:88},filterEnvelope:{envMod:90,decay:600},accent:{amount:95},slide:{time:60,mode:"exponential"},devilFish:{enabled:!0,normalDecay:500,accentDecay:400,vegDecay:1200,vegSustain:10,softAttack:3,filterTracking:100,filterFmDepth:35,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Soft Pad",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:700,resonance:40},filterEnvelope:{envMod:20,decay:800},accent:{amount:30},slide:{time:200,mode:"exponential"},devilFish:{enabled:!0,normalDecay:1500,accentDecay:1200,vegDecay:3e3,vegSustain:80,softAttack:25,filterTracking:60,filterFmDepth:5,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Hardstyle",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1800,resonance:75},filterEnvelope:{envMod:85,decay:80},accent:{amount:100},slide:{time:25,mode:"exponential"},overdrive:{amount:60,modelIndex:0,drive:60,dryWet:100},devilFish:{enabled:!0,normalDecay:60,accentDecay:40,vegDecay:150,vegSustain:0,softAttack:.3,filterTracking:50,filterFmDepth:45,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Singing Filter",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2200,resonance:95},filterEnvelope:{envMod:60,decay:700},accent:{amount:70},slide:{time:150,mode:"exponential"},devilFish:{enabled:!0,normalDecay:600,accentDecay:500,vegDecay:2e3,vegSustain:50,softAttack:8,filterTracking:180,filterFmDepth:15,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Gritty Bass",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:500,resonance:65},filterEnvelope:{envMod:45,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"},overdrive:{amount:40,modelIndex:0,drive:40,dryWet:100},devilFish:{enabled:!0,normalDecay:180,accentDecay:100,vegDecay:400,vegSustain:5,softAttack:1,filterTracking:25,filterFmDepth:55,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Bubbly Acid",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:78},filterEnvelope:{envMod:75,decay:50},accent:{amount:90},slide:{time:20,mode:"exponential"},devilFish:{enabled:!0,normalDecay:40,accentDecay:30,vegDecay:100,vegSustain:0,softAttack:.5,filterTracking:70,filterFmDepth:30,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Ambient Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:50},filterEnvelope:{envMod:25,decay:1500},accent:{amount:35},slide:{time:300,mode:"exponential"},devilFish:{enabled:!0,normalDecay:2500,accentDecay:2e3,vegDecay:3e3,vegSustain:95,softAttack:30,filterTracking:80,filterFmDepth:8,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Techno Stab",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:70},filterEnvelope:{envMod:70,decay:100},accent:{amount:100},slide:{time:30,mode:"exponential"},devilFish:{enabled:!0,normalDecay:80,accentDecay:50,vegDecay:180,vegSustain:0,softAttack:.3,filterTracking:45,filterFmDepth:40,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Screaming Lead",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:3e3,resonance:90},filterEnvelope:{envMod:95,decay:400},accent:{amount:100},slide:{time:50,mode:"exponential"},overdrive:{amount:50,modelIndex:0,drive:50,dryWet:100},devilFish:{enabled:!0,normalDecay:350,accentDecay:250,vegDecay:800,vegSustain:25,softAttack:2,filterTracking:150,filterFmDepth:60,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-16,pan:0},{type:"synth",name:"808 Sub",synthType:"MonoSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:1,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:15,octave:0},envelope:{attack:10,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:800,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"House Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Wobble Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:400,sustain:0,release:100},filter:{type:"lowpass",frequency:1e3,Q:8,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Duo Sub Bass",synthType:"DuoSynth",oscillator:{type:"triangle",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:1,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},...um,...fm],Zm=[{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Pluck Keys",synthType:"PluckSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2500,Q:1,rolloff:-12},effects:[],volume:-10,pan:0},{type:"synth",name:"Guitar Pluck",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:200,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"AM Bell",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"AM Sci-Fi",synthType:"AMSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:.5,release:1e3},effects:[],volume:-6,pan:0},{type:"synth",name:"FM Electric Piano",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:.2,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Saw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:10,decay:200,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Square Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:100,sustain:.8,release:100},effects:[],volume:-10,pan:0},{type:"synth",name:"Supersaw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:20,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Acid Lead",synthType:"MonoSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:350,sustain:0,release:200},filter:{type:"lowpass",frequency:2e3,Q:5,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Sync Lead",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:10,decay:450,sustain:0,release:300},filter:{type:"lowpass",frequency:2500,Q:3,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:3e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Detuned Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:25,octave:0},envelope:{attack:30,decay:450,sustain:0,release:400},filter:{type:"lowpass",frequency:2800,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Filtered Lead",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"AM Tremolo Lead",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"FM Bell Lead",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:1e3,sustain:0,release:800},effects:[],volume:-10,pan:0},{type:"synth",name:"Harp Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:800,sustain:0,release:500},effects:[],volume:-8,pan:0},{type:"synth",name:"Nylon Guitar",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1,decay:1200,sustain:0,release:1e3},effects:[],volume:-8,pan:0},{type:"synth",name:"PWM Solo Lead",synthType:"PWMSynth",pwmSynth:{pulseWidth:20,pwmDepth:40,pwmRate:1.5,pwmWaveform:"sine",oscillators:2,detune:5,envelope:{attack:10,decay:300,sustain:.6,release:200},filter:{type:"lowpass",cutoff:3e3,resonance:30,envelopeAmount:20,keyTracking:50},filterEnvelope:{attack:5,decay:400,sustain:.2,release:100}},effects:[],volume:-10,pan:0},{type:"synth",name:"Poly Brass",synthType:"PolySynth",polySynth:{voiceCount:6,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:50,decay:400,sustain:.7,release:200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SuperSaw Lead",synthType:"SuperSaw",superSaw:{voices:7,detune:40,mix:70,stereoSpread:80,envelope:{attack:10,decay:300,sustain:50,release:200},filter:{type:"lowpass",cutoff:5e3,resonance:20,envelopeAmount:50},filterEnvelope:{attack:5,decay:400,sustain:0,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Robot Talk",synthType:"FormantSynth",formantSynth:{vowel:"E",vowelMorph:{target:"U",amount:80,rate:2,mode:"manual"},oscillator:{type:"square"},formants:{...fa.E,bandwidth:120},envelope:{attack:5,decay:200,sustain:.5,release:100},brightness:80},effects:[],volume:-10,pan:0}],Jm=[{type:"synth",name:"Ambient Pad",synthType:"Synth",oscillator:{type:"sine",detune:3,octave:0},envelope:{attack:800,decay:2e3,sustain:0,release:1500},filter:{type:"lowpass",frequency:1500,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Dark Pad",synthType:"DuoSynth",oscillator:{type:"triangle",detune:8,octave:0},envelope:{attack:1e3,decay:2500,sustain:0,release:2e3},filter:{type:"lowpass",frequency:800,Q:2,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"String Pad",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:500,decay:1800,sustain:0,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1.5,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Noise Sweep",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:1500,sustain:0,release:1e3},filter:{type:"bandpass",frequency:1e3,Q:5,rolloff:-24},effects:[],volume:-18,pan:0},{type:"synth",name:"AM Atmospheric",synthType:"AMSynth",oscillator:{type:"sine",detune:5,octave:0},envelope:{attack:1500,decay:3e3,sustain:.8,release:2e3},effects:[],volume:-12,pan:0},{type:"synth",name:"Wavetable Evolving Pad",synthType:"Wavetable",wavetable:{wavetableId:"evolve-1",morphPosition:0,morphModSource:"lfo",morphModAmount:80,morphLFORate:.1,unison:{voices:4,detune:12,stereoSpread:60},envelope:{attack:1e3,decay:2e3,sustain:.7,release:1500},filter:{type:"lowpass",cutoff:1500,resonance:20,envelopeAmount:30},filterEnvelope:{attack:2e3,decay:1e3,sustain:.5,release:1e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"Poly Soft Strings",synthType:"PolySynth",polySynth:{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:500,decay:1e3,sustain:.8,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-14,pan:0},{type:"synth",name:"PWM Strings",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:30,pwmRate:.5,pwmWaveform:"sine",oscillators:3,detune:12,envelope:{attack:800,decay:1500,sustain:.9,release:1500},filter:{type:"lowpass",cutoff:1200,resonance:15,envelopeAmount:0,keyTracking:30},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Solina Ensemble",synthType:"StringMachine",stringMachine:{sections:{violin:100,viola:80,cello:60,bass:40},ensemble:{depth:70,rate:2.5,voices:4},attack:300,release:1500,brightness:50},effects:[],volume:-10,pan:0},{type:"synth",name:"Ethereal Choir",synthType:"FormantSynth",formantSynth:{vowel:"A",vowelMorph:{target:"O",amount:50,rate:.2,mode:"lfo"},oscillator:{type:"sawtooth"},formants:{...fa.A,bandwidth:80},envelope:{attack:1e3,decay:2e3,sustain:.8,release:2e3},brightness:60},effects:[],volume:-12,pan:0},{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"Wavetable Morph Pad",synthType:"Wavetable",wavetable:{wavetableId:"morph-2",morphPosition:50,morphModSource:"lfo",morphModAmount:40,morphLFORate:.2,unison:{voices:6,detune:20,stereoSpread:90},envelope:{attack:1200,decay:2500,sustain:.8,release:2e3},filter:{type:"lowpass",cutoff:2e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"PWM Soft Pad",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:20,pwmRate:.3,pwmWaveform:"sine",oscillators:2,detune:8,envelope:{attack:1500,decay:2e3,sustain:.9,release:2e3},filter:{type:"lowpass",cutoff:800,resonance:5,envelopeAmount:0,keyTracking:20},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-14,pan:0},{type:"synth",name:"Granular Cloud",synthType:"GranularSynth",granular:{sampleUrl:"",grainSize:.1,grainOverlap:.05,detune:5,playbackRate:1,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:1,reverse:!1,envelope:{attack:10,release:100},filter:{type:"lowpass",cutoff:2e3,resonance:1}},effects:[],volume:-10,pan:0}],ef=[xm,wm,km,{type:"synth",name:"808 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:100,Q:1,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:300,sustain:0,release:50},filter:{type:"lowpass",frequency:80,Q:2,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"Hardcore Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:150,sustain:0,release:20},filter:{type:"lowpass",frequency:120,Q:3,rolloff:-24},effects:[],volume:-4,pan:0},{type:"synth",name:"DnB Snare",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:300,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Clap",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:150,sustain:0,release:50},filter:{type:"bandpass",frequency:1e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Closed Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:50,sustain:0,release:20},filter:{type:"highpass",frequency:8e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Open Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:200},filter:{type:"highpass",frequency:7e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:1500,sustain:0,release:1e3},filter:{type:"highpass",frequency:6e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Synth Low Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:400,sustain:0,release:100},effects:[],volume:-8,pan:-20},{type:"synth",name:"Synth Mid Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:350,sustain:0,release:80},effects:[],volume:-8,pan:0},{type:"synth",name:"Synth Hi Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:60},effects:[],volume:-8,pan:20},...Mm],tf=[{type:"synth",name:"NES Major Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:15,delay:200},arpeggio:{enabled:!0,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"C64 Minor Arp",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:4,depth:10,delay:300},arpeggio:{enabled:!0,speed:12,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"SID Dim7 Pad",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:50,decay:600,sustain:0,release:500},vibrato:{speed:3,depth:8,delay:100},arpeggio:{enabled:!0,speed:8,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:6},{noteOffset:9}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Gameboy Sus4",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:12.5},bitDepth:4,sampleRate:16384,envelope:{attack:1,decay:200,sustain:0,release:100},vibrato:{speed:6,depth:20,delay:150},arpeggio:{enabled:!0,speed:18,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:5},{noteOffset:7}],mode:"loop"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Atari Dom7",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:4,sampleRate:15720,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:20,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Amiga Power Oct",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:8,sampleRate:28867,envelope:{attack:5,decay:300,sustain:0,release:250},vibrato:{speed:4,depth:12,delay:200},arpeggio:{enabled:!0,speed:14,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Fast Maj9 Stab",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:150,sustain:0,release:80},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:30,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:11},{noteOffset:14}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Slow Min7 Sweep",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:100,decay:800,sustain:0,release:600},vibrato:{speed:3,depth:15,delay:500},arpeggio:{enabled:!0,speed:4,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Square Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:200},vibrato:{speed:6,depth:15,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Triangle Bass",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:4,sampleRate:22050,envelope:{attack:1,decay:400,sustain:0,release:150},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12}],mode:"loop"}},effects:[],volume:-6,pan:0},{type:"synth",name:"Noise Snare",synthType:"ChipSynth",chipSynth:{channel:"noise",bitDepth:1,sampleRate:22050,envelope:{attack:1,decay:100,sustain:0,release:50},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Octave Jump",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:10,delay:250},arpeggio:{enabled:!0,speed:10,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12},{noteOffset:24}],mode:"loop"}},effects:[],volume:-10,pan:0}],nf=[{type:"synth",name:"909 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3}},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",snare:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Rim",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:100,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:300,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:60,decay:50,metallic:65}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:55,decay:350,metallic:60}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Ride",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:800,sustain:.1,release:500},filter:{type:"highpass",frequency:5e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"909 Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:2e3,sustain:.05,release:1500},filter:{type:"highpass",frequency:4e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0}],af=[{type:"synth",name:"808 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",machineType:"808",kick:{pitch:48,pitchDecay:110,tone:50,toneDecay:20,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",machineType:"808",snare:{pitch:238,pitchHigh:476,tone:50,toneDecay:75,snappy:50,decay:100,envAmount:1,envDuration:100,filterType:"highpass",filterFreq:1300}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",machineType:"808",clap:{tone:50,decay:115,toneDecay:200,spread:100,filterFreqs:[1e3,1e3],modulatorFreq:10}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Rimshot",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",machineType:"808",rimshot:{decay:40,filterFreqs:[480,1750,2450],filterQ:5,saturation:2.5}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Clave",synthType:"DrumMachine",drumMachine:{drumType:"clave",machineType:"808",clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Cowbell",synthType:"DrumMachine",drumMachine:{drumType:"cowbell",machineType:"808",cowbell:{decay:400,filterFreq:2640}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Maracas",synthType:"DrumMachine",drumMachine:{drumType:"maracas",machineType:"808",maracas:{decay:30,filterFreq:5e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:90,decay:200,tone:20,toneDecay:155,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:140,decay:190,tone:20,toneDecay:130,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:190,decay:180,tone:20,toneDecay:100,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Low Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:190,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:280,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:410,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:50,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:270,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Cymbal",synthType:"DrumMachine",drumMachine:{drumType:"cymbal",machineType:"808",cymbal:{tone:50,decay:3e3}},effects:[],volume:-14,pan:0}],sf=[{type:"synth",name:"Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"Downlifter",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:2e3,sustain:0,release:100},filter:{type:"lowpass",frequency:5e3,Q:3,rolloff:-24},effects:[],volume:-14,pan:0},{type:"synth",name:"Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:2,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Laser Zap",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-12,pan:0}],rf=[{type:"synth",name:"505 Kick",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Snare",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Clap",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Rim",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"505 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"505 Crash",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"505 Ride",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"505 Low Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 High Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Low Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-20},{type:"synth",name:"505 High Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:20},{type:"synth",name:"505 Timbale",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-timbal.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}],of=[{type:"synth",name:"707 Kick",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Kick Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Snare",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Clap",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Rim",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Low Tom Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"707 Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-cowbell.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Crash",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"707 Ride",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"707 Tambourine",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tambourine.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0}],lf=[{type:"synth",name:"DN 808 A1200",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN SubThud",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_SubThud.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Punchtron Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN 808 Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Analog Noise",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro 7000",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_electro7000.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Wolf Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Wolf1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Closed Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Open Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Analog Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Cymbal",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CYM_Synthique.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Clap",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Clave",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Tom",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Lazer",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/LAZ_R900.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Sonar",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Sonar.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Laser",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Burst",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Burst1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0}],cf=[{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"VFX Evolving",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},{type:"synth",name:"ESQ-1 Gritty Keys",synthType:"MAMEDOC",effects:[],volume:-10,pan:0},{type:"synth",name:"MKS-20 E.Piano 1",synthType:"MAMERSA",effects:[],volume:-10,pan:0},{type:"synth",name:"RD-1000 Grand",synthType:"MAMERSA",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Grand Piano",synthType:"MAMESWP30",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Synth Brass",synthType:"MAMESWP30",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Brass 1",synthType:"CZ101",effects:[],volume:-8,pan:0},{type:"synth",name:"CZ Electric Piano",synthType:"CZ101",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Synth Bass",synthType:"CZ101",effects:[],volume:-6,pan:0},{type:"synth",name:"CZ Digital Pad",synthType:"CZ101",effects:[],volume:-10,pan:0}],df=[{type:"synth",name:"Jazz Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!0,volume:60,decay:"fast",harmonic:"third"},keyClick:40,vibrato:{type:"C3",depth:60},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Gospel Organ",synthType:"Organ",organ:{drawbars:[8,8,8,8,8,8,8,8,8],percussion:{enabled:!1,volume:50,decay:"slow",harmonic:"second"},keyClick:20,vibrato:{type:"V3",depth:40},rotary:{enabled:!0,speed:"slow"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Church Organ",synthType:"Organ",organ:{drawbars:[8,0,8,0,8,0,0,8,8],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:0,vibrato:{type:"V1",depth:20},rotary:{enabled:!1,speed:"slow"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Rock Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:80,vibrato:{type:"C3",depth:80},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-8,pan:0}],uf=[{type:"synth",name:"Generic Module",synthType:"ChiptuneModule",effects:[],volume:-6,pan:0}],pf=[...Qm,...Zm,...Jm,...ef,...cf,...Fm,...df,...uf,...af,...nf,...of,...rf,...tf,...mm,...Lm,...sf,...fm,...ym,...Sm,..._m,...Om,...lf,...Im,...Rm,...jm,...zm,...Um,...qm,...Xm,{type:"synth",name:"Sample Player",synthType:"Player",volume:-6,pan:0,effects:[]}],hf={Bass:Qm,Leads:Zm,Pads:Jm,Drums:ef,MAME:[...cf,...Fm],Keys:df,Module:uf,"TR-808":af,"TR-909":nf,"TR-707":of,"TR-505":rf,Chip:tf,Furnace:[...mm,...Lm],FX:sf,Dub:[...fm,...ym,...Sm,..._m,...Mm],DubSiren:fm,SpaceLaser:ym,V2:[...Sm,..._m],Sam:Om,Synare:Mm,Drumnibus:[...Im,...lf],Dexed:Rm,OBXd:jm,Samples:zm,Wavetables:Um,Buzz:qm,Makk:Xm};function mf(e){const t=hf[e];if(t&&t.length>0)return t[0];const n=pf.find(t=>t.synthType===e);if(n)return n;const a=um.find(t=>t.synthType===e);if(a)return a;const s=Mm.find(t=>t.synthType===e);return s||null}class ff{view;offset=0;size;constructor(e){e instanceof DataView?this.view=e:this.view=new DataView(e),this.size=this.view.byteLength}getOffset(){return this.offset}setOffset(e){this.offset=e}getSize(){return this.size}seek(e){this.offset=e}skip(e){this.offset+=e}isEOF(){return this.offset>=this.size}readUint8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.view.getInt8(this.offset);return this.offset+=1,e}readUint16(e=!0){const t=this.view.getUint16(this.offset,e);return this.offset+=2,t}readInt16(e=!0){const t=this.view.getInt16(this.offset,e);return this.offset+=2,t}readUint32(e=!0){const t=this.view.getUint32(this.offset,e);return this.offset+=4,t}readInt32(e=!0){const t=this.view.getInt32(this.offset,e);return this.offset+=4,t}readFloat32(e=!0){const t=this.view.getFloat32(this.offset,e);return this.offset+=4,t}readString(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);this.offset+=e;let n=0;for(;n<e&&0!==t[n];)n++;return(new TextDecoder).decode(t.slice(0,n))}readNullTerminatedString(){let e=0;for(;this.offset+e<this.size&&0!==this.view.getUint8(this.offset+e);)e++;const t=this.readString(e);return this.offset<this.size&&this.offset++,t}readPrefixedString(){const e=this.readUint8();return 0===e?"":this.readString(e)}readPrefixedString16(){const e=this.readUint16();return 0===e?"":this.readString(e)}readPrefixedString32(){const e=this.readUint32();return 0===e?"":this.readString(e)}readBytes(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,new Uint8Array(t)}readMagic(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,Array.from(t).map(e=>String.fromCharCode(e)).join("")}}class yf{static parse(e){const t=new ff(e);if(t.readMagic(16).startsWith("-Furnace instr."))return this.parseOldFormat(t);t.seek(0);const n=t.readMagic(4);if("FINS"===n||"INS2"===n||"INST"===n)return this.parseNewFormat(t,n);throw new Error(`Invalid Furnace instrument header: ${n}`)}static parseNewFormat(e,t){"INS2"===t&&e.skip(4),e.skip(2);const n=e.readUint8(),a={...xa,chipType:n,operators:Array.from({length:4},()=>({...xa.operators[0]})),macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]};let s="Furnace Instrument";const r=[];for(;!e.isEOF();)try{if(e.getOffset()+4>e.getSize())break;const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),o=e.getOffset()+n;if(o>e.getSize())break;switch(t){case"NA":case"NM":s=e.readString(n);break;case"FM":this.readFMFeature(e,a);break;case"WV":case"WL":case"LW":this.readWavePointers(e,r)}e.seek(o)}catch(o){break}return this.loadWavetables(e,r,a),{name:s,config:a}}static parseOldFormat(e){e.seek(16),e.skip(4);const t=e.readUint32(),n=e.readUint16(),a=e.readUint16();e.skip(4);const s=[];for(let l=0;l<n;l++)s.push(e.readUint32());if(e.skip(4*a),t>=e.getSize())throw new Error("Invalid data pointer");if(e.seek(t),"INST"!==e.readMagic(4))throw new Error("Invalid INST block");e.skip(4),e.skip(2);const r=e.readUint8();e.skip(1);const o=e.readNullTerminatedString(),i={...xa,chipType:r,operators:[],macros:[],opMacros:[],wavetables:[]};if(e.getOffset()+8<=e.getSize()){i.algorithm=e.readUint8(),i.feedback=e.readUint8(),e.skip(2);const t=e.readUint8();e.skip(3);for(let n=0;n<4&&!(e.getOffset()+12>e.getSize());n++){const a={enabled:n<t,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.getOffset()+10<=e.getSize()&&e.skip(10),i.operators.push(a)}}return 0===i.operators.length&&(i.operators=Array.from({length:4},()=>({...xa.operators[0]}))),this.loadWavetables(e,s,i),{name:o,config:i}}static readFMFeature(e,t){const n=e.readUint8(),a=15&n,s=n>>4&15;t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),e.skip(2),t.operators=[];for(let r=0;r<a;r++){const n={enabled:!!(s>>r&1),mult:15&e.readUint8(),dt:e.readUint8()>>4&7,dt2:0,tl:e.readUint8(),ar:31&e.readUint8(),dr:31&e.readUint8(),d2r:0,sl:e.readUint8()>>4&15,rr:15&e.readUint8(),rs:0,ssg:15&e.readUint8(),am:!1,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};t.operators.push(n)}}static readWavePointers(e,t){const n=e.readUint16();e.skip(2*n);for(let a=0;a<n;a++)t.push(e.readUint32())}static loadWavetables(e,t,n){for(const a of t)if(a>0&&a<e.getSize()){e.seek(a);const t=this.readWaveBlock(e);t&&n.wavetables.push(t)}}static readWaveBlock(e){if(e.getOffset()+4>e.getSize())return null;if("WAVE"!==e.readMagic(4))return null;e.skip(20);const t=e.readUint32();e.skip(8);const n=[];for(let a=0;a<t&&!(e.getOffset()+4>e.getSize());a++)n.push(e.readInt32());return{id:0,data:n}}}const gf={1:{id:1,name:"YMU759",chipType:19,fmChannels:17,psgChannels:0,totalChannels:17},2:{id:2,name:"Genesis",chipType:0,fmChannels:6,psgChannels:4,totalChannels:10},3:{id:3,name:"SMS",chipType:3,fmChannels:0,psgChannels:4,totalChannels:4},4:{id:4,name:"Game Boy",chipType:5,fmChannels:0,psgChannels:4,totalChannels:4},5:{id:5,name:"PC Engine",chipType:6,fmChannels:0,psgChannels:6,totalChannels:6},6:{id:6,name:"NES",chipType:4,fmChannels:0,psgChannels:5,totalChannels:5},7:{id:7,name:"C64",chipType:10,fmChannels:0,psgChannels:3,totalChannels:3},8:{id:8,name:"Arcade",chipType:1,fmChannels:13,psgChannels:0,totalChannels:13},9:{id:9,name:"Neo Geo",chipType:14,fmChannels:4,psgChannels:7,totalChannels:13},10:{id:10,name:"Genesis Ext",chipType:0,fmChannels:9,psgChannels:4,totalChannels:13},11:{id:11,name:"SMS + OPLL",chipType:11,fmChannels:9,psgChannels:4,totalChannels:13},12:{id:12,name:"NES + VRC7",chipType:4,fmChannels:6,psgChannels:5,totalChannels:11},13:{id:13,name:"NES + FDS",chipType:16,fmChannels:0,psgChannels:6,totalChannels:6}};class vf{static SYSTEM_MAP={1:19,2:0,3:3,4:5,5:6,6:4,7:10,8:1,9:14,10:0,11:11,12:4,13:16};static parse(e,t){const n=new ff(e),a=n.readMagic(16);if("dmf"===t){if(!a.startsWith(".DeFleMask."))throw new Error("Invalid DMF magic");return this.parseDMF(n,a)}if("dmp"===t)return n.seek(0),this.parseDMP(n);if("dmw"===t)return n.seek(0),this.parseDMW(n);throw new Error(`Unknown format: ${t}`)}static parseDMF(e,t){const n=this.extractVersion(t),a=e.readUint8(),s=gf[a]??gf[2],r={version:n,system:s,name:"",author:"",timeBase:0,ticksPerRow:[6,6],framesPerTick:1,patternRows:64,matrixRows:1,arpeggioTickSpeed:1,instruments:[],wavetables:[],patterns:[],patternMatrix:[],channelCount:s.totalChannels};if(n>=17?(r.name=e.readPrefixedString(),r.author=e.readPrefixedString(),e.readUint8(),e.readUint8()):n>=10&&(r.name=e.readNullTerminatedString(),r.author=e.readNullTerminatedString()),r.timeBase=e.readUint8(),r.ticksPerRow=[e.readUint8(),e.readUint8()],n>=14&&(r.framesPerTick=e.readUint8()),n>=19){e.readUint8()&&(e.readUint8(),e.readUint8(),e.readUint8())}r.patternRows=e.readUint32(),r.matrixRows=e.readUint8(),n>=21&&(r.arpeggioTickSpeed=e.readUint8()),r.patternMatrix=[];for(let l=0;l<r.channelCount;l++){const t=[];for(let n=0;n<r.matrixRows;n++)t.push(e.readUint8());r.patternMatrix.push(t)}const o=e.readUint8();for(let l=0;l<o;l++){const t=this.parseInstrument(e,n,s);r.instruments.push(t)}const i=e.readUint8();for(let l=0;l<i;l++){const t=e.readUint32(),n=[];for(let a=0;a<t;a++)n.push(e.readUint32());r.wavetables.push(n)}for(let l=0;l<r.channelCount;l++){const t=e.readUint8();for(let n=0;n<r.matrixRows;n++){const n={rows:[]};for(let a=0;a<r.patternRows;a++){const s={note:e.readUint16(),octave:e.readUint16(),volume:e.readInt16(),instrument:e.readInt16(),effects:[]};for(let n=0;n<t;n++){const t=e.readInt16(),n=e.readInt16();t>=0&&s.effects.push({code:t,value:n})}n.rows[a]||(n.rows[a]=[]),n.rows[a][l]=s}r.patterns.push(n)}}return r}static extractVersion(e){const t=e.match(/\.DeFleMask\.(\d+)/);return t?parseInt(t[1],10):24}static parseInstrument(e,t,n){const a=t>=17?e.readPrefixedString():e.readNullTerminatedString(),s=e.readUint8(),r={...xa,chipType:this.SYSTEM_MAP[n.id]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===s){r.algorithm=e.readUint8(),r.feedback=e.readUint8();const a=11===n.id||12===n.id?2:4;t>=19&&(e.readUint8(),e.readUint8());for(let n=0;n<a;n++){const n=this.parseOperator(e,t);r.operators.push(n)}}else this.readMacros(e,r);return{name:a,config:r}}static parseOperator(e,t){const n={enabled:!0,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt:0,dt2:0,rs:0,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};return t>=11&&(n.dt=e.readInt8(),n.rs=e.readUint8()),t>=12&&e.readUint8(),t>=15&&(n.ssg=e.readUint8()),n}static parseDMP(e){e.readUint8();const t=e.readUint8(),n=e.readUint8(),a={...xa,chipType:this.SYSTEM_MAP[t]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===n){a.algorithm=e.readUint8(),a.feedback=e.readUint8();for(let t=0;t<4;t++){const t={enabled:!0,mult:e.readUint8(),tl:e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,sl:e.readUint8(),rr:e.readUint8(),dt:e.readInt8(),dt2:0,rs:e.readUint8(),am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};a.operators.push(t)}}else this.readMacros(e,a);return{name:"DefleMask Instrument",config:a}}static parseDMW(e){const t=[];for(;!e.isEOF();)t.push(e.readUint8());return t}static readMacros(e,t){const n=["volume","arp","duty","wave","pitch"];for(const a of n){if(e.readUint8()){const s=e.readUint8(),r=e.readUint8(),o=[];for(let t=0;t<s;t++)o.push(e.readInt32());t.macros.push({type:n.indexOf(a),data:o,loop:r,release:-1,mode:0})}}}}function bf(e,t){const n={...e};for(const a of Object.keys(t)){const s=t[a],r=e[a];null!=s&&("object"!=typeof s||Array.isArray(s)||"object"!=typeof r||Array.isArray(r)?n[a]=s:n[a]=bf(r,s))}return n}function xf(e){const t={...e};switch(e.synthType){case"TB303":case"Buzz3o3":t.tb303=bf(Da,e.tb303||{});break;case"DrumMachine":t.drumMachine=bf(ua,e.drumMachine||{});break;case"ChipSynth":t.chipSynth=bf(pa,e.chipSynth||{});break;case"PWMSynth":t.pwmSynth=bf(ha,e.pwmSynth||{});break;case"Wavetable":t.wavetable=bf(na,e.wavetable||{});break;case"GranularSynth":t.granular=bf(aa,e.granular||{});break;case"SuperSaw":t.superSaw=bf(la,e.superSaw||{});break;case"PolySynth":t.polySynth=bf(ca,e.polySynth||{});break;case"Organ":t.organ=bf(da,e.organ||{});break;case"StringMachine":t.stringMachine=bf(ma,e.stringMachine||{});break;case"FormantSynth":t.formantSynth=bf(va,e.formantSynth||{});break;case"WobbleBass":t.wobbleBass=bf(ya,e.wobbleBass||{});break;case"DubSiren":t.dubSiren=bf(Ca,e.dubSiren||{});break;case"SpaceLaser":t.spaceLaser=bf(Aa,e.spaceLaser||{});break;case"V2":t.v2=bf(Ta,e.v2||{});break;case"Sam":t.sam=bf(Ea,e.sam||{});break;case"Synare":t.synare=bf(Ia,e.synare||{});break;case"Buzzmachine":t.buzzmachine=bf(ga,e.buzzmachine||{});break;case"Dexed":t.dexed=bf(wa,e.dexed||{});break;case"OBXd":t.obxd=bf(ka,e.obxd||{});break;case"DrumKit":t.drumKit=bf(Ma,e.drumKit||{});break;case"Furnace":t.furnace=bf(xa,e.furnace||{})}return t}function wf(e){return"string"==typeof e.note}function kf(e){return e.some(e=>{const t=e.id;return 0===t||t>0&&t%100==0&&t<3200})}function Sf(e){return 0===e?1:e%100==0&&e<3200?e/100+1:e}function Mf(e){const t={...e};if("string"==typeof e.note?t.note=Ba(e.note):null!==e.note&&void 0!==e.note||(t.note=0),null===e.instrument||void 0===e.instrument?t.instrument=0:"number"==typeof e.instrument&&(t.instrument=Sf(e.instrument)),null===e.volume||void 0===e.volume?t.volume=0:"number"==typeof e.volume&&e.volume<=64&&(t.volume=16+e.volume),"effect"in e&&"string"==typeof e.effect){const n=e.effect;if(n&&"..."!==n&&"000"!==n){const[e,a]=Ga(n);t.effTyp=e,t.eff=a}else t.effTyp=0,t.eff=0;delete t.effect}if(t.effTyp||0===t.effTyp||(t.effTyp=0),t.eff||0===t.eff||(t.eff=0),"effect2"in e&&"string"==typeof e.effect2){const n=e.effect2;if(n&&"..."!==n&&"000"!==n){const[e,a]=Ga(n);t.effTyp2=e,t.eff2=a}else t.effTyp2=0,t.eff2=0;delete t.effect2}return void 0!==t.effTyp2&&null!==t.effTyp2||(t.effTyp2=0),void 0!==t.eff2&&null!==t.eff2||(t.eff2=0),t}function Nf(e){return{...e,channels:e.channels.map(e=>({...e,rows:e.rows.map(e=>Mf(e)),instrumentId:null!==e.instrumentId&&void 0!==e.instrumentId?Sf(e.instrumentId):1}))}}function Cf(e){const t=new Map;let n=1;for(const a of e)if(!t.has(a.id)){const e=Sf(a.id);Array.from(t.values()).includes(e)?t.set(a.id,n++):(t.set(a.id,e),n=Math.max(n,e+1))}return e.map(e=>{const n=t.get(e.id)??e.id,a="Sampler"===e.synthType||"Player"===e.synthType?"sample":"synth";return{...xf(e),id:n,type:e.type||a}})}function Ef(e,t){const n=e.some(e=>e.channels.some(e=>e.rows.some(e=>wf(e)))),a=kf(t),s=t.some(e=>!e.type),r=t.some(e=>function(e){switch(e.synthType){case"TB303":case"Buzz3o3":return!e.tb303||!e.tb303.filter||!e.tb303.filterEnvelope;case"DrumMachine":return!e.drumMachine;case"ChipSynth":return!e.chipSynth||!e.chipSynth.envelope;case"PWMSynth":return!e.pwmSynth||!e.pwmSynth.envelope;case"SuperSaw":return!e.superSaw||!e.superSaw.envelope;case"PolySynth":return!e.polySynth||!e.polySynth.envelope;case"Organ":return!e.organ||!e.organ.drawbars;case"StringMachine":return!e.stringMachine;case"FormantSynth":return!e.formantSynth||!e.formantSynth.envelope;case"WobbleBass":return!e.wobbleBass||!e.wobbleBass.envelope;case"DubSiren":return!e.dubSiren||!e.dubSiren.reverb;case"SpaceLaser":return!e.spaceLaser;case"Dexed":return!e.dexed;case"OBXd":return!e.obxd;case"DrumKit":return!e.drumKit;case"Furnace":return!e.furnace;default:return!1}}(e));return n||a||s||r}function Pf(e,t){return{patterns:e.map(e=>Nf(e)),instruments:Cf(t)}}const Tf=Object.freeze(Object.defineProperty({__proto__:null,deepMerge:bf,ensureCompleteInstrumentConfig:xf,hasOldInstrumentIds:kf,isOldFormatCell:wf,migrateCell:Mf,migrateInstrumentId:Sf,migrateInstruments:Cf,migratePattern:Nf,migrateProject:Pf,needsMigration:Ef},Symbol.toStringTag,{value:"Module"}));class Af{static reverse(e){const t=e.numberOfChannels,n=e.length,a=e.sampleRate,s=new AudioBuffer({length:n,numberOfChannels:t,sampleRate:a});for(let r=0;r<t;r++){const t=e.getChannelData(r),a=s.getChannelData(r);for(let e=0;e<n;e++)a[e]=t[n-1-e]}return s}static normalize(e){const t=e.numberOfChannels,n=e.length,a=e.sampleRate;let s=0;for(let i=0;i<t;i++){const t=e.getChannelData(i);for(let e=0;e<n;e++){const n=Math.abs(t[e]);n>s&&(s=n)}}if(0===s||1===s)return e;const r=1/s,o=new AudioBuffer({length:n,numberOfChannels:t,sampleRate:a});for(let i=0;i<t;i++){const t=e.getChannelData(i),a=o.getChannelData(i);for(let e=0;e<n;e++)a[e]=t[e]*r}return o}static invertLoop(e,t,n){const a=e.numberOfChannels,s=e.length,r=e.sampleRate,o=new AudioBuffer({length:s,numberOfChannels:a,sampleRate:r});for(let i=0;i<a;i++){const a=e.getChannelData(i),r=o.getChannelData(i);for(let e=0;e<t;e++)r[e]=a[e];for(let e=t;e<n&&e<s;e++)r[e]=-a[e];for(let e=n;e<s;e++)r[e]=a[e]}return o}static applyGain(e,t){const n=e.numberOfChannels,a=e.length,s=e.sampleRate,r=new AudioBuffer({length:a,numberOfChannels:n,sampleRate:s});for(let o=0;o<n;o++){const n=e.getChannelData(o),s=r.getChannelData(o);for(let e=0;e<a;e++)s[e]=n[e]*t}return r}static async bufferToWav(e){const t=e.numberOfChannels,n=e.sampleRate,a=e.length,s=2*t,r=n*s,o=a*s,i=44+o,l=new ArrayBuffer(i),c=new DataView(l);this.writeString(c,0,"RIFF"),c.setUint32(4,i-8,!0),this.writeString(c,8,"WAVE"),this.writeString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,n,!0),c.setUint32(28,r,!0),c.setUint16(32,s,!0),c.setUint16(34,16,!0),this.writeString(c,36,"data"),c.setUint32(40,o,!0);let d=44;for(let u=0;u<a;u++)for(let n=0;n<t;n++){let t=e.getChannelData(n)[u];t=Math.max(-1,Math.min(1,t));const a=t<0?32768*t:32767*t;c.setInt16(d,a,!0),d+=2}return l}static writeString(e,t,n){for(let a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}}function If(e){e&&(e.url&&URL.revokeObjectURL(e.url),e.multiMap&&Object.values(e.multiMap).forEach(e=>URL.revokeObjectURL(e)))}const _f=new Set;function Of(e,t){const n=new Set;return e.forEach(e=>{e.rows.forEach(e=>{e.cells.forEach(e=>{e.instrument===t&&e.note&&n.add(e.note)})})}),Array.from(n).sort()}function Ff(e){for(let t=1;t<=128;t++)if(!e.includes(t))return t;return 1}const Df=a()(Fn((e,t)=>({instruments:[],currentInstrumentId:0,get currentInstrument(){const e=t();return e.instruments.find(t=>t.id===e.currentInstrumentId)||null},previewInstrument:null,presets:[],setCurrentInstrument:t=>e(e=>{e.instruments.find(e=>e.id===t)&&(e.currentInstrumentId=t)}),setPreviewInstrument:t=>e(e=>{e.previewInstrument=t}),getInstrument:e=>t().instruments.find(t=>t.id===e),updateInstrument:(n,a)=>{const s=t().instruments.find(e=>e.id===n),r=s&&a.synthType&&a.synthType!==s.synthType,o=a.name&&a.synthType,i=!!(a.oscillator||a.envelope||a.filter||a.filterEnvelope||a.superSaw||a.polySynth||a.organ||a.drumMachine||a.chipSynth||a.pwmSynth||a.stringMachine||a.formantSynth||a.wavetable||a.granular||a.furnace||a.dubSiren||a.synare||a.sam||a.v2Speech||a.tb303||a.buzzmachine||a.spaceLaser||a.v2);if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const{id:e,...n}=a;if(Object.keys(n).forEach(e=>{const a=n[e];a&&"object"==typeof a&&!Array.isArray(a)&&t[e]?t[e]={...t[e],...a}:t[e]=a}),r&&a.synthType?.startsWith("Furnace")){const e=Uh(a.synthType);e&&(t.furnace=e)}if(r&&"DubSiren"===a.synthType&&!t.dubSiren&&(t.dubSiren={...Ca}),r&&"SpaceLaser"===a.synthType&&!t.spaceLaser&&(t.spaceLaser={...Aa}),r&&"V2"===a.synthType&&!t.v2&&(t.v2={...Ta}),r&&"Synare"===a.synthType&&!t.synare&&(t.synare={...Ia}),r&&"Sam"===a.synthType&&!t.sam&&(t.sam={...Ea}),r&&!o&&a.synthType){const e=t.furnace?.chipType,n=t.buzzmachine?.machineType,s=mf(a.synthType);if(s){const{name:r,type:o,synthType:i,...l}=s;Object.keys(l).forEach(e=>{const n=l[e];n&&"object"==typeof n&&!Array.isArray(n)&&t[e]?Object.assign(t[e],n):t[e]=n}),t.synthType=a.synthType,void 0!==e&&t.furnace&&(t.furnace.chipType=e),n&&t.buzzmachine&&(t.buzzmachine.machineType=n)}}}}),!r&&!o)try{const s=em(),r=t().instruments.find(e=>e.id===n);if(r){if(("TB303"===r.synthType||"Buzz3o3"===r.synthType)&&r.tb303&&a.tb303)return void s.updateTB303Parameters(n,r.tb303);if("DubSiren"===r.synthType&&r.dubSiren&&a.dubSiren)return void s.updateDubSirenParameters(n,r.dubSiren);if("SpaceLaser"===r.synthType&&r.spaceLaser&&a.spaceLaser)return void s.updateSpaceLaserParameters(n,r.spaceLaser);if("V2"===r.synthType&&r.v2&&a.v2)return void s.updateV2Parameters(n,r.v2);if("V2"===r.synthType&&r.v2Speech&&a.v2Speech)return void s.updateComplexSynthParameters(n,r.v2Speech);if("Sam"===r.synthType&&r.sam&&a.sam)return void s.updateComplexSynthParameters(n,r.sam);if("Synare"===r.synthType&&r.synare&&a.synare)return void s.updateSynareParameters(n,r.synare);if("Buzz3o3"===r.synthType&&r.tb303&&a.tb303){const t=r.tb303,a=r.buzzmachine||{machineType:"OomekAggressor",parameters:{}},o={...a.parameters};return o[0]="square"===t.oscillator.type?1:0,o[1]=Math.round(Math.log2(t.filter.cutoff/200)/Math.log2(25)*240),o[2]=Math.round(t.filter.resonance/100*128),o[3]=Math.round(t.filterEnvelope.envMod/100*128),o[4]=Math.round(Math.log2(t.filterEnvelope.decay/30)/Math.log2(100)*128),o[5]=Math.round(t.accent.amount/100*128),o[6]=Math.round((t.tuning||0)+100),e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.buzzmachine={...a,parameters:o})}),void s.updateBuzzmachineParameters(n,{...a,parameters:o})}if(r.synthType.startsWith("Buzz")&&r.buzzmachine&&a.buzzmachine)return void s.updateBuzzmachineParameters(n,r.buzzmachine);if(("Furnace"===r.synthType||r.synthType.startsWith("Furnace"))&&r.furnace&&a.furnace)return void s.updateFurnaceParameters(n,r.furnace);if(["SuperSaw","WobbleBass","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth"].includes(r.synthType)){const e=r.synthType.charAt(0).toLowerCase()+r.synthType.slice(1),t=r[e];if(t&&a[e])return void s.updateComplexSynthParameters(n,t)}}}catch(l){}if(r||o||i)try{em().invalidateInstrument(n)}catch(l){}},createInstrument:n=>{const a=Ff(t().instruments.map(e=>e.id));return e(e=>{const t={id:s=a,name:`TB303 ${String(s).padStart(2,"0")}`,type:"synth",synthType:"TB303",tb303:{...Da},oscillator:{..._a},envelope:{...Oa},filter:{...Fa},effects:[],volume:-6,pan:0};var s;const r=n?bf(t,n):t;r.id=a,e.instruments.push(r),e.currentInstrumentId=a}),a},addInstrument:t=>{e(e=>{const n=e.instruments.find(e=>e.id===t.id);n?Object.assign(n,t):e.instruments.push({...t}),e.currentInstrumentId=t.id})},deleteInstrument:t=>e(e=>{const n=e.instruments.findIndex(e=>e.id===t);-1!==n&&e.instruments.length>1&&(If(e.instruments[n].sample),e.instruments.splice(n,1),e.currentInstrumentId===t&&(e.currentInstrumentId=e.instruments[0].id))}),cloneInstrument:n=>{const a=t().instruments.find(e=>e.id===n);if(!a)return n;const s=Ff(t().instruments.map(e=>e.id));return e(e=>{const t=JSON.parse(JSON.stringify(a));t.id=s,t.name=`${a.name} (Copy)`,e.instruments.push(t),e.currentInstrumentId=s}),s},resetInstrument:t=>{e(e=>{const n=e.instruments.find(e=>e.id===t);if(n){const e=n.synthType,t=function(e){const t={synthType:e,effects:[],volume:-12,pan:0};switch(e){case"TB303":t.tb303={...Da};break;case"DrumMachine":t.drumMachine={...ua};break;case"ChipSynth":t.chipSynth={...pa};break;case"PWMSynth":t.pwmSynth={...ha};break;case"Wavetable":t.wavetable={...na};break;case"GranularSynth":t.granular={...aa};break;case"SuperSaw":t.superSaw={...la};break;case"PolySynth":t.polySynth={...ca};break;case"Organ":t.organ={...da};break;case"StringMachine":t.stringMachine={...ma};break;case"FormantSynth":t.formantSynth={...va};break;case"WobbleBass":t.wobbleBass={...ya};break;case"DubSiren":t.dubSiren={...Ca};break;case"SpaceLaser":t.spaceLaser={...Aa};break;case"V2":t.v2={...Ta};break;case"Sam":t.sam={...Ea};break;case"Synare":t.synare={...Ia};break;case"Buzz3o3":t.tb303={...Da},t.buzzmachine={...ga,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}};break;case"Buzzmachine":t.buzzmachine={...ga};break;case"Dexed":t.dexed={...wa};break;case"OBXd":t.obxd={...ka};break;case"DrumKit":t.drumKit={...Ma};break;case"ChiptuneModule":t.chiptuneModule={...ia};break;case"MAMEVFX":t.mame={...sa};break;case"MAMEDOC":t.mame={...ra};break;case"MAMERSA":t.rdpiano={...Sa};break;case"MAMESWP30":t.mame={...oa}}const n=mf(e);if(n){const{name:a,type:s,synthType:r,...o}=n;Object.assign(t,o),t.synthType=e}return t}(e);if(Object.assign(n,{...t,synthType:e,name:n.name,tb303:void 0,drumMachine:void 0,chipSynth:void 0,pwmSynth:void 0,wavetable:void 0,granular:void 0,superSaw:void 0,polySynth:void 0,organ:void 0,stringMachine:void 0,formantSynth:void 0,furnace:void 0,chiptuneModule:void 0,wobbleBass:void 0,drumKit:void 0,dubSiren:void 0,spaceLaser:void 0,synare:void 0,v2:void 0}),"TB303"===e||"Buzz3o3"===e)n.tb303={...Da},"Buzz3o3"===e&&(n.buzzmachine={...ga,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}});else if("DubSiren"===e)n.dubSiren={...Ca};else if("SpaceLaser"===e)n.spaceLaser={...Aa};else if("V2"===e)n.v2={...Ta};else if("Synare"===e)n.synare={...Ia};else if(e.startsWith("Furnace")){const t=Uh(e);t&&(n.furnace=t)}}});try{em().invalidateInstrument(t)}catch(n){}},bakeInstrument:async(n,a="lite")=>{const s=t().instruments.find(e=>e.id===n);if(s&&"Sampler"!==s.synthType&&!_f.has(n)){_f.add(n);try{const r=em();s.sample&&If(s.sample);const o=JSON.parse(JSON.stringify(s));if(delete o.metadata,"pro"===a){const a=Of((await Pn(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>dm);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,n);if(0===a.length)return t().bakeInstrument(n,"lite");const i={};for(const e of a){const t=await r.bakeInstrument(s,2,e),n=await Af.bufferToWav(t),a=new Blob([n],{type:"audio/wav"});i[e]=URL.createObjectURL(a)}e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:o,bakeType:"pro"}},t.synthType="Sampler",t.sample={url:"",multiMap:i,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}else{const t=await r.bakeInstrument(s,2,"C4"),a=await Af.bufferToWav(t),i=new Blob([a],{type:"audio/wav"}),l=URL.createObjectURL(i);e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:o,bakeType:"lite"}},t.synthType="Sampler",t.sample={url:l,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}r.invalidateInstrument(n)}catch(r){}finally{_f.delete(n)}}},unbakeInstrument:n=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t&&t.metadata?.preservedSynth){const{synthType:e,config:n}=t.metadata.preservedSynth;If(t.sample);const a={...t.metadata};delete a.preservedSynth,Object.assign(t,n),t.synthType=e,t.metadata=a,t.sample=void 0}});try{const e=em();e.invalidateInstrument(n);const a=t().instruments.find(e=>e.id===n);a&&e.rebuildInstrumentEffects(n,a.effects)}catch(a){}},autoBakeInstruments:async()=>{const n=t().instruments.filter(e=>e.metadata?.preservedSynth&&!e.sample?.url&&!e.sample?.multiMap);if(0!==n.length)for(const t of n){const n=t.metadata.preservedSynth,s={...t,...n.config,synthType:n.synthType},r=n.bakeType||"lite";try{const n=em();if("pro"===r){const a=Of((await Pn(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>dm);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,t.id),r={};for(const e of a){const t=await n.bakeInstrument(s,2,e),a=await Af.bufferToWav(t),o=new Blob([a],{type:"audio/wav"});r[e]=URL.createObjectURL(o)}e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.multiMap=r)})}else{const a=await n.bakeInstrument(s,2,"C4"),r=await Af.bufferToWav(a),o=new Blob([r],{type:"audio/wav"}),i=URL.createObjectURL(o);e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.url=i)})}n.invalidateInstrument(t.id)}catch(a){}}},addEffect:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:a,enabled:!0,wet:50,parameters:{}};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=em();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},addEffectConfig:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={...a,id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=em();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},removeEffect:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.findIndex(e=>e.id===a);-1!==e&&t.effects.splice(e,1)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=em();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},updateEffect:(n,a,s)=>{if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.find(e=>e.id===a);e&&Object.assign(e,s)}}),void 0!==s.enabled){const e=t().instruments.find(e=>e.id===n);e&&(async()=>{try{const t=em();await t.rebuildInstrumentEffects(n,e.effects)}catch(t){}})()}},reorderEffects:(n,a,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const[e]=t.effects.splice(a,1);t.effects.splice(s,0,e)}});const r=t().instruments.find(e=>e.id===n);r&&(async()=>{try{const e=em();await e.rebuildInstrumentEffects(n,r.effects)}catch(e){}})()},loadPreset:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===n);a&&(Object.assign(a,t.config),a.id=n)});try{em().invalidateInstrument(n)}catch(a){}},saveAsPreset:(t,n,a)=>e(e=>{const s=e.instruments.find(e=>e.id===t);if(s){const t={id:`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:n,category:a,tags:[],author:"User",config:{name:s.name,type:s.type,synthType:s.synthType,oscillator:s.oscillator,envelope:s.envelope,filter:s.filter,filterEnvelope:s.filterEnvelope,tb303:s.tb303,effects:s.effects,volume:s.volume,pan:s.pan}};e.presets.push(t)}}),loadInstruments:n=>{const a=em();t().instruments.forEach(e=>{try{a.invalidateInstrument(e.id)}catch(t){}}),Pn(async()=>{const{ensureCompleteInstrumentConfig:e}=await Promise.resolve().then(()=>Tf);return{ensureCompleteInstrumentConfig:e}},void 0).then(({ensureCompleteInstrumentConfig:t})=>{const a=n.map(e=>({...t(e),synthType:e.tb303&&"TB303"!==e.synthType&&"Buzz3o3"!==e.synthType?"TB303":e.synthType,type:e.type||("Sampler"===e.synthType?"sample":"synth"),effects:e.effects?.map(e=>({...e,category:e.category||"tonejs"}))||[]}));e(e=>{e.instruments=a,e.currentInstrumentId=a.length>0?a[0].id:null})})},loadFurnaceInstrument:n=>{try{const{name:a,config:s}=yf.parse(n),r=Ff(t().instruments.map(e=>e.id));e(e=>{const t={id:r,name:a||"Furnace Patch",type:"synth",synthType:"Furnace",furnace:s,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=r})}catch(a){}},loadDefleMaskInstrument:n=>{try{const a=vf.parse(n,"dmp"),{name:s,config:r}=a,o=Ff(t().instruments.map(e=>e.id));e(e=>{const t={id:o,name:s||"DefleMask Patch",type:"synth",synthType:"Furnace",furnace:r,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=o})}catch(a){}},loadDefleMaskWavetable:n=>{try{const a=vf.parse(n,"dmw"),s=t().currentInstrumentId;if(!s)return;e(e=>{const t=e.instruments.find(e=>e.id===s);"Furnace"===t?.synthType&&t.furnace&&t.furnace.wavetables.push({id:t.furnace.wavetables.length,data:a})})}catch(a){}},transformInstrument:(n,a,s)=>{const r=t().instruments.find(e=>e.id===n);if(!r)return;if("Sampler"!==r.synthType)return;const o=r.sample?{...r.sample,envelope:r.envelope||{...Oa}}:void 0;if(!o)return;let i;function l(t,n,a,s,r){e(e=>{const r=e.instruments.find(e=>e.id===t);if(!r)return;delete r.tb303,delete r.polySynth,delete r.wavetable,delete r.granular,delete r.superSaw,delete r.organ,delete r.drumMachine,delete r.chipSynth,delete r.pwmSynth,delete r.stringMachine,delete r.formantSynth,delete r.sample,r.type="synth",r.synthType=n;r[n.toLowerCase()]=a,r.metadata||(r.metadata={}),r.metadata.preservedSample=s,r.metadata.transformHistory||(r.metadata.transformHistory=[]),r.metadata.transformHistory.push({timestamp:(new Date).toISOString(),fromType:"Sampler",toType:n})});try{em().invalidateInstrument(t)}catch(o){}}"analyze"===s?Pn(async()=>{const{analyzeSample:e,suggestSynthConfig:t}=await Promise.resolve().then(()=>LC);return{analyzeSample:e,suggestSynthConfig:t}},void 0).then(({analyzeSample:e,suggestSynthConfig:t})=>{const s=e({id:n,name:r.name,pcmData:o.audioBuffer||new ArrayBuffer(0),loopStart:o.loopStart,loopLength:o.loopEnd-o.loopStart,loopType:o.loop?"forward":"none",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:44100,length:1e3},r.metadata?.originalEnvelope);i=t(a,s),l(n,a,i,o)}):(i=function(e){switch(e){case"TB303":return{...Da};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{..._a},envelope:{...Oa},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{...Oa},filter:{...Fa,cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{...Oa}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{...Oa,attack:5,decay:300},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{..._a},envelope:{...Oa}}}}(a),l(n,a,i,o))},revertToSample:n=>{const a=t().instruments.find(e=>e.id===n);if(!a)return;const s=a.metadata?.preservedSample;if(s){e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(delete t.tb303,delete t.polySynth,delete t.wavetable,delete t.granular,delete t.superSaw,delete t.organ,delete t.drumMachine,delete t.chipSynth,delete t.pwmSynth,delete t.stringMachine,delete t.formantSynth,t.type="sample",t.synthType="Sampler",t.sample={audioBuffer:s.audioBuffer,url:s.url,baseNote:s.baseNote,detune:s.detune,loop:s.loop,loopStart:s.loopStart,loopEnd:s.loopEnd,reverse:!1,playbackRate:1},t.envelope=s.envelope)});try{em().invalidateInstrument(n)}catch(r){}}},reverseSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer)return;const s=a.sample.audioBuffer,r=await em().decodeAudioData(s),o=Af.reverse(r),i=await em().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),em().invalidateInstrument(n)},normalizeSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer)return;const s=a.sample.audioBuffer,r=await em().decodeAudioData(s),o=Af.normalize(r),i=await em().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),em().invalidateInstrument(n)},invertLoopSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer||!a.sample.loop)return;const s=a.sample.audioBuffer,r=await em().decodeAudioData(s),o=Af.invertLoop(r,a.sample.loopStart,a.sample.loopEnd),i=await em().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),em().invalidateInstrument(n)},updateSampleBuffer:async(n,a)=>{const s=t().instruments.find(e=>e.id===n);if(!s?.sample)return;const r=await em().encodeAudioData(a);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=r)}),em().invalidateInstrument(n)},updateSlices:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);a?.sample&&(a.sample.slices=n)})},updateSliceConfig:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);a?.sample&&(a.sample.sliceConfig=n)})},removeSlice:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);if(a?.sample?.slices){const e=a.sample.slices,t=e.findIndex(e=>e.id===n);if(-1!==t&&e.length>1){const n=e[t];t>0?(e[t-1].endFrame=n.endFrame,e[t-1].endTime=n.endTime):t<e.length-1&&(e[t+1].startFrame=n.startFrame,e[t+1].startTime=n.startTime),e.splice(t,1)}}})},createSlicedInstruments:async(n,a,s="Slice")=>{const r=t().instruments.find(e=>e.id===n);if(!r?.sample?.url)return[];const o=[],i=em();try{const n=await fetch(r.sample.url),l=await n.arrayBuffer(),c=await i.decodeAudioData(l),d=t().instruments.map(e=>e.id);for(let t=0;t<a.length;t++){const n=a[t],l=Ff([...d,...o]);o.push(l);const u=n.endFrame-n.startFrame,p=c.numberOfChannels,h=c.sampleRate,m=new OfflineAudioContext(p,u,h).createBuffer(p,u,h);for(let e=0;e<p;e++){const t=c.getChannelData(e),a=m.getChannelData(e);for(let e=0;e<u;e++)a[e]=t[n.startFrame+e]}const f=await i.encodeAudioData(m),y=new Blob([f],{type:"audio/wav"}),g=await new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(y)}),v=n.label||`${s} ${t+1}`,b=r.name?`${r.name} - ${v}`:v;e(e=>{const t={id:l,name:b.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:g,audioBuffer:f,baseNote:r.sample?.baseNote||"C-4",detune:r.sample?.detune||0,loop:!1,loopStart:0,loopEnd:u,sampleRate:h,reverse:!1,playbackRate:1},envelope:r.envelope||{...Oa},effects:[],volume:r.volume||-6,pan:r.pan||0};e.instruments.push(t)})}return o.length>0&&e(e=>{e.currentInstrumentId=o[0]}),o}catch(l){return[]}},reset:()=>{const n=em();t().instruments.forEach(e=>{try{n.invalidateInstrument(e.id)}catch(t){}}),e(e=>{e.instruments=[{...um[0],id:1,type:"synth"}],e.currentInstrumentId=1,e.presets=[]})}}))),Rf=Object.freeze(Object.defineProperty({__proto__:null,useInstrumentStore:Df},Symbol.toStringTag,{value:"Module"})),jf=a()(Qh(Fn((e,t)=>({visiblePanels:["tracker","oscilloscope","pattern-list"],trackerZoom:100,activePanel:"tracker",modalOpen:null,sidebarCollapsed:!1,useHexNumbers:!0,rowHighlightInterval:4,showBeatLabels:!1,chordEntryMode:!1,blankEmptyCells:!1,tb303Collapsed:!0,oscilloscopeVisible:!0,compactToolbar:!1,autoCompactApplied:!1,showSamplePackModal:!1,uiVersion:8,performanceQuality:"high",statusMessage:"All Right",prevStatusMessage:"All Right",togglePanel:t=>e(e=>{const n=e.visiblePanels.indexOf(t);-1!==n?e.visiblePanels.splice(n,1):e.visiblePanels.push(t)}),setActivePanel:t=>e(e=>{e.activePanel=t,e.visiblePanels.includes(t)||e.visiblePanels.push(t)}),setTrackerZoom:t=>e(e=>{e.trackerZoom=Math.max(80,Math.min(200,t))}),openModal:t=>e(e=>{e.modalOpen=t}),closeModal:()=>e(e=>{e.modalOpen=null}),toggleSidebar:()=>e(e=>{e.sidebarCollapsed=!e.sidebarCollapsed}),setSidebarCollapsed:t=>e(e=>{e.sidebarCollapsed=t}),setUseHexNumbers:t=>e(e=>{e.useHexNumbers=t}),setRowHighlightInterval:t=>e(e=>{e.rowHighlightInterval=Math.max(1,Math.min(32,t))}),toggleBeatLabels:()=>e(e=>{e.showBeatLabels=!e.showBeatLabels}),toggleChordEntryMode:()=>e(e=>{e.chordEntryMode=!e.chordEntryMode}),setBlankEmptyCells:t=>e(e=>{e.blankEmptyCells=t}),setStatusMessage:(t,n=!1,a=2e3)=>e(e=>{n&&(e.prevStatusMessage=t),e.statusMessage=t,a>0&&(window._statusTimeout&&clearTimeout(window._statusTimeout),window._statusTimeout=setTimeout(()=>{const e=jf.getState().prevStatusMessage;jf.getState().setStatusMessage(e||"All Right",!1,0),window._statusTimeout=null},a))}),toggleTB303Collapsed:()=>e(e=>{e.tb303Collapsed=!e.tb303Collapsed}),setTB303Collapsed:t=>e(e=>{e.tb303Collapsed=t}),toggleOscilloscopeVisible:()=>e(e=>{e.oscilloscopeVisible=!e.oscilloscopeVisible}),setOscilloscopeVisible:t=>e(e=>{e.oscilloscopeVisible=t}),toggleCompactToolbar:()=>e(e=>{e.compactToolbar=!e.compactToolbar}),setCompactToolbar:t=>e(e=>{e.compactToolbar=t}),applyAutoCompact:()=>e(e=>{const t="undefined"!=typeof window?window.innerHeight:1080;e.uiVersion<8&&(e.uiVersion=8,e.tb303Collapsed=!0,e.compactToolbar=!1),e.autoCompactApplied||(e.autoCompactApplied=!0,t<800&&(e.oscilloscopeVisible=!1))}),setShowSamplePackModal:t=>e(e=>{e.showSamplePackModal=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t})})),{name:"devilbox-ui-settings",partialize:e=>({tb303Collapsed:e.tb303Collapsed,oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar,sidebarCollapsed:e.sidebarCollapsed,trackerZoom:e.trackerZoom,useHexNumbers:e.useHexNumbers,rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels,chordEntryMode:e.chordEntryMode,blankEmptyCells:e.blankEmptyCells,performanceQuality:e.performanceQuality,uiVersion:e.uiVersion})})),Lf=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:jf},Symbol.toStringTag,{value:"Module"}));let Bf,Vf=0,zf=null,Uf=null;const Gf=a()(Fn((e,t)=>({bpm:125,timeSignature:[4,4],swing:100,position:"0:0:0",isPlaying:!1,isPaused:!1,isLooping:!0,currentRow:0,currentPatternIndex:0,continuousRow:0,smoothScrolling:!1,metronomeEnabled:!1,metronomeVolume:75,speed:6,loopStartRow:0,grooveTemplateId:"straight",grooveSteps:2,jitter:0,useMpcScale:!1,setBPM:t=>e(e=>{e.bpm=Math.max(20,Math.min(999,t));try{jf.getState().setStatusMessage(`BPM ${e.bpm}`,!1,1500)}catch(n){}}),setTimeSignature:(t,n)=>e(e=>{e.timeSignature=[t,n]}),setSwing:t=>e(e=>{e.useMpcScale?e.swing=Math.max(50,Math.min(75,t)):e.swing=Math.max(0,Math.min(200,t))}),setJitter:t=>e(e=>{e.jitter=Math.max(0,Math.min(100,t))}),setUseMpcScale:t=>e(e=>{e.useMpcScale!==t&&(e.useMpcScale=t,e.swing=t?50+e.swing/200*25:(e.swing-50)/25*200)}),setPosition:t=>e(e=>{e.position=t}),play:()=>{Df.getState().autoBakeInstruments(),e(e=>{e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow})},pause:()=>e(e=>{e.isPlaying=!1,e.isPaused=!0}),stop:()=>e(e=>{e.isPlaying=!1,e.isPaused=!1,e.currentRow=0,e.continuousRow=0,e.position="0:0:0"}),togglePlayPause:()=>{t().isPlaying||Df.getState().autoBakeInstruments(),e(e=>{e.isPlaying?(e.isPlaying=!1,e.isPaused=!0):(e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow)})},setIsLooping:t=>e(e=>{e.isLooping=t}),setCurrentRow:(t,n)=>e(e=>{const a=e.currentRow;if(e.currentRow=t,t>a)e.continuousRow+=t-a;else if(t===a);else if(t<a){if(n?a-t>=n/2:0===t&&a>2){const s=n||a+1;e.continuousRow+=s-a+t}}}),setCurrentRowThrottled:(e,n)=>{const a=performance.now();zf=e,Bf=n,a-Vf>=20?(Vf=a,t().setCurrentRow(e,n),zf=null,Bf=void 0,null!==Uf&&(window.clearTimeout(Uf),Uf=null)):null===Uf&&(Uf=window.setTimeout(()=>{null!==zf&&(Vf=performance.now(),t().setCurrentRow(zf,Bf),zf=null,Bf=void 0),Uf=null},20-(a-Vf)))},setCurrentPattern:t=>e(e=>{e.currentPatternIndex=t}),setSmoothScrolling:t=>e(e=>{e.smoothScrolling=t}),setMetronomeEnabled:t=>e(e=>{e.metronomeEnabled=t}),setMetronomeVolume:t=>e(e=>{e.metronomeVolume=Math.max(0,Math.min(100,t))}),toggleMetronome:()=>e(e=>{e.metronomeEnabled=!e.metronomeEnabled}),setSpeed:t=>e(e=>{e.speed=Math.max(1,Math.min(31,t))}),setLoopStartRow:t=>e(e=>{e.loopStartRow=Math.max(0,t)}),setGrooveTemplate:t=>e(e=>{Ra.find(e=>e.id===t)&&(e.grooveTemplateId=t)}),setGrooveSteps:t=>e(e=>{e.grooveSteps=Math.max(1,Math.min(64,t))}),getGrooveTemplate:()=>{const e=t();return Ra.find(t=>t.id===e.grooveTemplateId)||Ra[0]},reset:()=>e(e=>{e.bpm=125,e.timeSignature=[4,4],e.swing=100,e.position="0:0:0",e.isPlaying=!1,e.isPaused=!1,e.isLooping=!0,e.currentRow=0,e.currentPatternIndex=0,e.continuousRow=0,e.speed=6,e.loopStartRow=0,e.grooveTemplateId="straight",e.grooveSteps=2,e.jitter=0,e.useMpcScale=!1})}))),Kf=a()(Fn((e,t)=>({initialized:!1,contextState:"suspended",masterVolume:0,masterMuted:!1,analyserNode:null,fftNode:null,toneEngineInstance:null,masterEffects:[],setInitialized:t=>e(e=>{e.initialized=t}),setContextState:t=>e(e=>{e.contextState=t}),setMasterVolume:n=>e(e=>{e.masterVolume=Math.max(-60,Math.min(0,n));const a=t().toneEngineInstance;a&&a.setMasterVolume(e.masterVolume)}),setMasterMuted:n=>e(e=>{e.masterMuted=n;const a=t().toneEngineInstance;a&&a.setMasterMute(n)}),toggleMasterMute:()=>e(e=>{e.masterMuted=!e.masterMuted;const n=t().toneEngineInstance;n&&n.setMasterMute(e.masterMuted)}),setAnalyserNode:t=>e(e=>{e.analyserNode=t}),setFFTNode:t=>e(e=>{e.fftNode=t}),setToneEngineInstance:t=>e(e=>{e.toneEngineInstance=t}),addMasterEffect:n=>e(e=>{const a={id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:n,enabled:!0,wet:50,parameters:{}};e.masterEffects.push(a);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),addMasterEffectConfig:n=>e(e=>{const a={...n,id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};e.masterEffects.push(a);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),removeMasterEffect:n=>e(e=>{const a=e.masterEffects.findIndex(e=>e.id===n);if(-1!==a){e.masterEffects.splice(a,1);const n=JSON.parse(JSON.stringify(e.masterEffects)),s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(n)}catch(e){}})()}}),updateMasterEffect:(n,a)=>e(e=>{const s=e.masterEffects.find(e=>e.id===n);if(s){Object.assign(s,a);const e=t().toneEngineInstance;e&&e.updateMasterEffectParams(n,s)}}),reorderMasterEffects:(n,a)=>e(e=>{const[s]=e.masterEffects.splice(n,1);e.masterEffects.splice(a,0,s);const r=JSON.parse(JSON.stringify(e.masterEffects)),o=t().toneEngineInstance;o&&(async()=>{try{await o.rebuildMasterEffects(r)}catch(e){}})()}),setMasterEffects:n=>e(e=>{const a=n.map(e=>({...e,category:e.category||"tonejs"}));e.masterEffects=a;const s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(a)}catch(e){}})()})}))),Hf=a()(Fn((e,t)=>({metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},isDirty:!1,lastSavedAt:null,setMetadata:t=>e(e=>{Object.assign(e.metadata,t),e.metadata.modifiedAt=(new Date).toISOString(),e.isDirty=!0}),setIsDirty:t=>e(e=>{e.isDirty=t}),markAsSaved:()=>e(e=>{e.isDirty=!1,e.lastSavedAt=(new Date).toISOString()}),markAsModified:()=>e(e=>{e.isDirty=!0,e.metadata.modifiedAt=(new Date).toISOString()}),resetProject:()=>e(e=>{e.metadata={id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},e.isDirty=!1,e.lastSavedAt=null})}))),Wf=a()(Fn((e,t)=>({curves:[],selectedCurveId:null,editMode:"pencil",presets:[...ja],automation:{},channelLanes:new Map,addCurve:(t,n,a)=>{const s={id:`curve-${Date.now()}`,patternId:t,channelIndex:n,parameter:a,mode:"curve",interpolation:"linear",points:[],enabled:!0};return e(e=>{e.curves.push(s),e.selectedCurveId=s.id,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),s.id},removeCurve:t=>e(e=>{const n=e.curves.findIndex(e=>e.id===t);-1!==n&&(e.curves.splice(n,1),e.selectedCurveId===t&&(e.selectedCurveId=null),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),updateCurve:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(Object.assign(a,n),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),setSelectedCurve:t=>e(e=>{e.selectedCurveId=t}),setEditMode:t=>e(e=>{e.editMode=t}),addPoint:(t,n,a)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.findIndex(e=>e.row===n);-1!==t?s.points[t].value=a:(s.points.push({row:n,value:a}),s.points.sort((e,t)=>e.row-t.row)),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}}),removePoint:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);if(a){const t=a.points.findIndex(e=>e.row===n);-1!==t&&(a.points.splice(t,1),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),updatePoint:(t,n,a)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.find(e=>e.row===n);t&&(t.value=a,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),clearPoints:t=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(n.points=[],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),applyPreset:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(a.points=[...n.points],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),getCurvesForPattern:(e,n)=>t().curves.filter(t=>t.patternId===e&&t.channelIndex===n),getValueAtRow:(e,n)=>{const a=t().curves.find(t=>t.id===e);if(!a||0===a.points.length)return null;let s=null,r=null;for(let t=0;t<a.points.length;t++)if(a.points[t].row<=n&&(s=a.points[t]),a.points[t].row>=n){r=a.points[t];break}if(s&&s.row===n)return s.value;if(r&&r.row===n)return r.value;if(s&&r&&"linear"===a.interpolation){const e=(n-s.row)/(r.row-s.row);return s.value+(r.value-s.value)*e}if(s&&r&&"exponential"===a.interpolation){const e=(n-s.row)/(r.row-s.row),t=e*e;return s.value+(r.value-s.value)*t}return a.mode,s?s.value:r?r.value:null},getAutomation:(e,n,a)=>{const s=t().curves.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===a);return s||{id:`temp-${e}-${n}-${a}`,patternId:e,channelIndex:n,parameter:a,mode:"curve",interpolation:"linear",points:[],enabled:!0}},setAutomation:(t,n,a,s)=>e(e=>{const r=e.curves.findIndex(e=>e.patternId===t&&e.channelIndex===n&&e.parameter===a);-1!==r?e.curves[r]=s:e.curves.push(s),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),buildAutomationData:()=>{const e=t(),n={};return e.curves.forEach(e=>{n[e.patternId]||(n[e.patternId]={}),n[e.patternId][e.channelIndex]||(n[e.patternId][e.channelIndex]={}),n[e.patternId][e.channelIndex][e.parameter]=e}),n},loadCurves:t=>e(e=>{e.curves=t,e.selectedCurveId=null,e.automation={},t.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),getCurves:()=>t().curves,setActiveParameter:(t,n)=>e(e=>{const a=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...a,activeParameter:n})}),getActiveParameter:e=>{const n=t();return n.channelLanes.get(e)?.activeParameter||"cutoff"},setShowLane:(t,n)=>e(e=>{const a=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...a,showLane:n})}),getShowLane:e=>{const n=t();return n.channelLanes.get(e)?.showLane||!1},reset:()=>e(e=>{e.curves=[],e.selectedCurveId=null,e.editMode="pencil",e.automation={},e.channelLanes=new Map})}))),$f=a()(Fn((e,t)=>({undoStack:[],redoStack:[],maxStackSize:100,currentActionId:null,pushAction:(t,n,a,s,r)=>e(e=>{const o={id:`action-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),description:n,patternIndex:a,beforeState:JSON.parse(JSON.stringify(s)),afterState:JSON.parse(JSON.stringify(r))};e.undoStack.push(o),e.undoStack.length>e.maxStackSize&&e.undoStack.shift(),e.redoStack=[],e.currentActionId=o.id}),undo:()=>{const n=t();if(0===n.undoStack.length)return null;const a=n.undoStack[n.undoStack.length-1];return e(e=>{const t=e.undoStack.pop();t&&(e.redoStack.push(t),e.currentActionId=e.undoStack.length>0?e.undoStack[e.undoStack.length-1].id:null)}),a.beforeState},redo:()=>{const n=t();if(0===n.redoStack.length)return null;const a=n.redoStack[n.redoStack.length-1];return e(e=>{const t=e.redoStack.pop();t&&(e.undoStack.push(t),e.currentActionId=t.id)}),a.afterState},canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,clearHistory:()=>e(e=>{e.undoStack=[],e.redoStack=[],e.currentActionId=null}),setMaxStackSize:t=>e(e=>{e.maxStackSize=Math.max(1,t),e.undoStack.length>e.maxStackSize&&(e.undoStack=e.undoStack.slice(-e.maxStackSize)),e.redoStack.length>e.maxStackSize&&(e.redoStack=e.redoStack.slice(-e.maxStackSize))}),getUndoCount:()=>t().undoStack.length,getRedoCount:()=>t().redoStack.length,getLastAction:()=>{const e=t().undoStack;return e.length>0?e[e.length-1]:null},getActionHistory:()=>t().undoStack.slice(-20)}))),qf=e=>({EDIT_CELL:"Edit Cell",PASTE_BLOCK:"Paste Block",DELETE_BLOCK:"Delete Block",CUT_BLOCK:"Cut Block",TRANSPOSE_BLOCK:"Transpose Block",AMPLIFY_BLOCK:"Amplify Block",INTERPOLATE_BLOCK:"Interpolate Block",CLEAR_CELL:"Clear Cell",CLEAR_ROW:"Clear Row",CLEAR_CHANNEL:"Clear Channel",CLEAR_PATTERN:"Clear Pattern",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",RESIZE_PATTERN:"Resize Pattern"}[e]||e),Yf=e=>{switch(e){case"EDIT_CELL":return"text-blue-400";case"PASTE_BLOCK":case"CUT_BLOCK":case"DELETE_BLOCK":return"text-green-400";case"TRANSPOSE_BLOCK":case"AMPLIFY_BLOCK":case"INTERPOLATE_BLOCK":return"text-yellow-400";case"CLEAR_CELL":case"CLEAR_ROW":case"CLEAR_CHANNEL":case"CLEAR_PATTERN":return"text-red-400";case"INSERT_ROW":case"DELETE_ROW":case"RESIZE_PATTERN":return"text-purple-400";default:return"text-gray-400"}},Xf=()=>{const e=cm.getState(),t=Df.getState(),n=Wf.getState(),a=Hf.getState(),s=Gf.getState();return{patterns:JSON.parse(JSON.stringify(e.patterns)),currentPatternIndex:e.currentPatternIndex,instruments:JSON.parse(JSON.stringify(t.instruments)),currentInstrumentId:t.currentInstrumentId,automationCurves:JSON.parse(JSON.stringify(n.curves)),metadata:JSON.parse(JSON.stringify(a.metadata)),bpm:s.bpm}},Qf=e=>{const t=em();try{t.stop()}catch(n){}Gf.getState().reset(),Gf.getState().setBPM(e.bpm),Hf.getState().setMetadata(e.metadata),Hf.getState().setIsDirty(!1),cm.getState().loadPatterns(e.patterns),cm.getState().setCurrentPattern(e.currentPatternIndex),Df.getState().loadInstruments(e.instruments),null!==e.currentInstrumentId&&Df.getState().setCurrentInstrument(e.currentInstrumentId),Wf.getState().loadCurves(e.automationCurves)},Zf=()=>({id:`tab-${Date.now()}`,name:"Untitled",isDirty:!1,state:null}),Jf=Zf(),ey=a()(Fn((e,t)=>({tabs:[Jf],activeTabId:Jf.id,addTab:()=>{const n=t().activeTabId,a=Xf();e(e=>{const t=e.tabs.find(e=>e.id===n);t&&(t.state=a);const s=Zf();e.tabs.push(s),e.activeTabId=s.id});const s={patterns:[{id:`pattern-${Date.now()}`,name:"Untitled Pattern",length:64,channels:Array.from({length:4},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}],currentPatternIndex:0,instruments:[{id:0,name:"TB303 Classic",type:"synth",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:15},filterEnvelope:{envMod:50,decay:300},accent:{amount:.8},slide:{time:60,mode:"exponential"}},oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0}],currentInstrumentId:0,automationCurves:[],metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},bpm:125};Qf(s)},closeTab:n=>{const a=t();if(a.tabs.length<=1)return;const s=a.tabs.findIndex(e=>e.id===n);if(-1===s)return;let r=a.activeTabId,o=!1;if(a.activeTabId===n){const e=0===s?1:s-1;r=a.tabs[e].id,o=!0}const i=a.tabs.find(e=>e.id===r),l=i?.state;e(e=>{e.activeTabId=r,e.tabs.splice(s,1);const t=e.tabs.find(e=>e.id===r);t&&(t.state=null)}),o&&l&&Qf(l)},setActiveTab:n=>{const a=t();if(!a.tabs.some(e=>e.id===n))return;if(a.activeTabId===n)return;const s=a.activeTabId,r=Xf(),o=a.tabs.find(e=>e.id===n),i=o?.state;e(e=>{const t=e.tabs.find(e=>e.id===s);t&&(t.state=r),e.activeTabId=n;const a=e.tabs.find(e=>e.id===n);a&&(a.state=null)}),i&&Qf(i)},updateTabName:(t,n)=>e(e=>{const a=e.tabs.find(e=>e.id===t);a&&(a.name=n)}),markTabDirty:(t,n)=>e(e=>{const a=e.tabs.find(e=>e.id===t);a&&(a.isDirty=n)})}))),ty={id:"devilbox",name:"DEViLBOX",colors:{bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",bgHover:"#262020",bgActive:"#2f2828",border:"#2f2525",borderLight:"#403535",accent:"#ef4444",accentSecondary:"#f97316",accentGlow:"rgba(239, 68, 68, 0.15)",text:"#f2f0f0",textSecondary:"#a8a0a0",textMuted:"#686060",textInverse:"#0b0909",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0f0c0c",trackerRowOdd:"#131010",trackerRowHighlight:"#181414",trackerRowCurrent:"#2a1a1a",trackerRowCursor:"#251010",cellNote:"#f2f0f0",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#ef4444",cellSlide:"#fb7185",cellEmpty:"#484040"}},ny=[ty,{id:"neodark",name:"NeoDark",colors:{bg:"#0a0a0b",bgSecondary:"#111113",bgTertiary:"#1a1a1d",bgHover:"#222226",bgActive:"#2a2a2f",border:"#2a2a2f",borderLight:"#3a3a40",accent:"#00d4aa",accentSecondary:"#7c3aed",accentGlow:"rgba(0, 212, 170, 0.15)",text:"#f0f0f2",textSecondary:"#a0a0a8",textMuted:"#606068",textInverse:"#0a0a0b",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0d0d0f",trackerRowOdd:"#111113",trackerRowHighlight:"#151518",trackerRowCurrent:"#1a2a25",trackerRowCursor:"#0d2520",cellNote:"#f0f0f2",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#00d4aa",cellSlide:"#a78bfa",cellEmpty:"#404048"}},{id:"cyan-lineart",name:"Cyan Lineart",colors:{bg:"#030808",bgSecondary:"#051010",bgTertiary:"#071414",bgHover:"#0a1a1a",bgActive:"#0c2020",border:"#00808080",borderLight:"#00b8b8",accent:"#00ffff",accentSecondary:"#00e0e0",accentGlow:"rgba(0, 255, 255, 0.12)",text:"#00ffff",textSecondary:"#00c8c8",textMuted:"#006060",textInverse:"#030808",error:"#ff4080",success:"#00ff88",warning:"#00ffaa",trackerRowEven:"#030808",trackerRowOdd:"#041010",trackerRowHighlight:"#061414",trackerRowCurrent:"#081818",trackerRowCursor:"#0a1c1c",cellNote:"#00ffff",cellInstrument:"#00e8e8",cellVolume:"#00d0d0",cellEffect:"#00b8b8",cellAccent:"#00ffff",cellSlide:"#00a0a0",cellEmpty:"#003838"}}],ay=e=>{const t=document.documentElement,{colors:n}=e;t.setAttribute("data-theme",e.id),t.style.setProperty("--color-bg",n.bg),t.style.setProperty("--color-bg-secondary",n.bgSecondary),t.style.setProperty("--color-bg-tertiary",n.bgTertiary),t.style.setProperty("--color-bg-hover",n.bgHover),t.style.setProperty("--color-bg-active",n.bgActive),t.style.setProperty("--color-border",n.border),t.style.setProperty("--color-border-light",n.borderLight),t.style.setProperty("--color-accent",n.accent),t.style.setProperty("--color-accent-secondary",n.accentSecondary),t.style.setProperty("--color-accent-glow",n.accentGlow),t.style.setProperty("--color-text",n.text),t.style.setProperty("--color-text-secondary",n.textSecondary),t.style.setProperty("--color-text-muted",n.textMuted),t.style.setProperty("--color-text-inverse",n.textInverse),t.style.setProperty("--color-error",n.error),t.style.setProperty("--color-success",n.success),t.style.setProperty("--color-warning",n.warning),t.style.setProperty("--color-tracker-row-even",n.trackerRowEven),t.style.setProperty("--color-tracker-row-odd",n.trackerRowOdd),t.style.setProperty("--color-tracker-row-highlight",n.trackerRowHighlight),t.style.setProperty("--color-tracker-row-current",n.trackerRowCurrent),t.style.setProperty("--color-tracker-row-cursor",n.trackerRowCursor),t.style.setProperty("--color-cell-note",n.cellNote),t.style.setProperty("--color-cell-instrument",n.cellInstrument),t.style.setProperty("--color-cell-volume",n.cellVolume),t.style.setProperty("--color-cell-effect",n.cellEffect),t.style.setProperty("--color-cell-accent",n.cellAccent),t.style.setProperty("--color-cell-slide",n.cellSlide),t.style.setProperty("--color-cell-empty",n.cellEmpty)},sy=a()(Qh((e,t)=>({currentThemeId:"devilbox",setTheme:t=>{const n=ny.find(e=>e.id===t);n&&(ay(n),e({currentThemeId:t}))},getCurrentTheme:()=>{const{currentThemeId:e}=t();return ny.find(t=>t.id===e)||ty}}),{name:"devilbox-theme",onRehydrateStorage:()=>e=>{if(e){const t=ny.find(t=>t.id===e.currentThemeId)||ty;ay(t)}}}));if("undefined"!=typeof window){const e=localStorage.getItem("devilbox-theme");let t="devilbox";if(e)try{const n=JSON.parse(e);t=n.state?.currentThemeId||"devilbox"}catch{}const n=ny.find(e=>e.id===t)||ty;ay(n)}let ry=0;const oy=a((e,t)=>({notifications:[],addNotification:n=>{const a="notification-"+ ++ry,s={...n,id:a,duration:n.duration??5e3};return e(e=>({notifications:[...e.notifications,s]})),s.duration&&s.duration>0&&setTimeout(()=>{t().removeNotification(a)},s.duration),a},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),iy={success:(e,t)=>oy.getState().addNotification({type:"success",message:e,duration:t}),error:(e,t)=>oy.getState().addNotification({type:"error",message:e,duration:t??8e3}),warning:(e,t)=>oy.getState().addNotification({type:"warning",message:e,duration:t}),info:(e,t)=>oy.getState().addNotification({type:"info",message:e,duration:t})};class ly{static instance=null;midiAccess=null;inputs=new Map;outputs=new Map;selectedInputId=null;selectedOutputId=null;messageHandlers=new Set;deviceChangeCallbacks=new Set;lastActivityTimestamp=0;boundMessageHandler=null;clockTickCount=0;lastClockTimestamp=0;clockBPM=0;clockSyncEnabled=!1;clockSyncCallbacks=new Set;transportCallbacks=new Set;constructor(){}static getInstance(){return ly.instance||(ly.instance=new ly),ly.instance}isSupported(){return"requestMIDIAccess"in navigator}async init(){if(!this.isSupported())return!1;try{return this.midiAccess=await navigator.requestMIDIAccess({sysex:!0}),this.updateDevices(),this.midiAccess.onstatechange=()=>{this.updateDevices(),this.notifyDeviceChange()},!0}catch(e){return!1}}updateDevices(){if(this.midiAccess){if(this.inputs.clear(),this.outputs.clear(),this.midiAccess.inputs.forEach((e,t)=>{this.inputs.set(t,e)}),this.midiAccess.outputs.forEach((e,t)=>{this.outputs.set(t,e)}),!this.selectedInputId){const e=this.detectTD3Devices().input;e&&this.selectInput(e.id)}if(!this.selectedOutputId){const e=this.detectTD3Devices().output;e&&this.selectOutput(e.id)}}}portToDeviceInfo(e,t){const n=e.name||"Unknown Device",a=e.manufacturer||"";return{id:e.id,name:n,manufacturer:a,type:t,isConnected:"open"===e.connection||"connected"===e.state,isTD3:this.isTD3Device(n,a)}}isTD3Device(e,t){const n=e.toLowerCase(),a=t.toLowerCase();return n.includes("td-3")||n.includes("td3")||a.includes("behringer")&&n.includes("303")}getInputDevices(){const e=[];return this.inputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"input"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}getOutputDevices(){const e=[];return this.outputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"output"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}detectTD3Devices(){const e=this.getInputDevices(),t=this.getOutputDevices();return{input:e.find(e=>e.isTD3)||null,output:t.find(e=>e.isTD3)||null}}async selectInput(e){if(this.selectedInputId){const e=this.inputs.get(this.selectedInputId);if(e){e.onmidimessage=null;try{await e.close()}catch{}}}if(this.selectedInputId=e,e){const n=this.inputs.get(e);if(n)try{await n.open(),this.boundMessageHandler=this.handleMIDIMessage.bind(this),n.onmidimessage=this.boundMessageHandler}catch(t){}}}selectOutput(e){this.selectedOutputId=e,e&&this.outputs.get(e)}getSelectedInput(){if(!this.selectedInputId)return null;const e=this.inputs.get(this.selectedInputId);return e?this.portToDeviceInfo(e,"input"):null}getSelectedOutput(){if(!this.selectedOutputId)return null;const e=this.outputs.get(this.selectedOutputId);return e?this.portToDeviceInfo(e,"output"):null}handleMIDIMessage(e){const t=e.data;if(!t||0===t.length)return;const n=t[0];if(248!==n){Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join(" "),t[0]>=240||(176==(240&t[0])||(144==(240&t[0])||(128==(240&t[0])||(224==(240&t[0])||t[0]))))}this.lastActivityTimestamp=Date.now();const a=this.parseMIDIMessage(n,t,e.timeStamp);this.clockSyncEnabled&&("clock"===a.type?this.processClockTick(e.timeStamp):"start"!==a.type&&"stop"!==a.type&&"continue"!==a.type||this.processTransportCommand(a.type)),"cc"===a.type||"noteOn"===a.type||"noteOff"===a.type||"pitchBend"===a.type||a.type,this.messageHandlers.forEach(e=>{try{e(a,this.selectedInputId||"")}catch(t){}})}processClockTick(e){if(this.clockTickCount++,this.lastClockTimestamp>0){const t=e-this.lastClockTimestamp;if(t>0){const e=2500/t;if(0===this.clockBPM?this.clockBPM=e:this.clockBPM=.9*this.clockBPM+.1*e,this.clockTickCount%24==0){const e=Math.round(10*this.clockBPM)/10;this.clockSyncCallbacks.forEach(t=>{try{t(e)}catch(n){}})}}}this.lastClockTimestamp=e}processTransportCommand(e){"start"===e&&(this.clockTickCount=0,this.lastClockTimestamp=0),this.transportCallbacks.forEach(t=>{try{t(e)}catch(n){}})}parseMIDIMessage(e,t,n){let a,s,r,o,i,l,c,d="other";if(e>=240)switch(a=-1,e){case 240:d="sysex";break;case 248:d="clock";break;case 250:d="start";break;case 251:d="continue";break;case 252:d="stop";break;default:d="other"}else{switch(a=15&e,240&e){case 144:d="noteOn",s=t[1],r=t[2],0===r&&(d="noteOff");break;case 128:d="noteOff",s=t[1],r=t[2];break;case 176:d="cc",o=t[1],i=t[2];break;case 192:d="programChange",c=t[1];break;case 224:d="pitchBend",l=(t[2]<<7|t[1])-8192;break;default:d="other"}}return{type:d,channel:a,data:t,timestamp:n,note:s,velocity:r,cc:o,value:i,pitchBend:l,program:c}}addMessageHandler(e){this.messageHandlers.add(e)}removeMessageHandler(e){this.messageHandlers.delete(e)}sendCC(e,t,n){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const s=new Uint8Array([176|15&e,127&t,127&n]);a.send(s)}sendSysEx(e){if(!this.selectedOutputId)return;const t=this.outputs.get(this.selectedOutputId);if(t)try{t.send(e)}catch(n){throw n}}sendNoteOn(e,t,n){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const s=new Uint8Array([144|15&e,127&t,127&n]);a.send(s)}sendNoteOff(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=new Uint8Array([128|15&e,127&t,0]);n.send(a)}sendPitchBend(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=Math.max(0,Math.min(16383,t+8192)),s=new Uint8Array([224|15&e,127&a,a>>7&127]);n.send(s)}sendProgramChange(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=new Uint8Array([192|15&e,127&t]);n.send(a)}setClockSyncEnabled(e){this.clockSyncEnabled=e,e||(this.clockTickCount=0,this.lastClockTimestamp=0,this.clockBPM=0)}isClockSyncEnabled(){return this.clockSyncEnabled}getClockBPM(){return Math.round(10*this.clockBPM)/10}onClockSync(e){return this.clockSyncCallbacks.add(e),()=>{this.clockSyncCallbacks.delete(e)}}onTransportCommand(e){return this.transportCallbacks.add(e),()=>{this.transportCallbacks.delete(e)}}onDeviceChange(e){return this.deviceChangeCallbacks.add(e),()=>{this.deviceChangeCallbacks.delete(e)}}notifyDeviceChange(){this.deviceChangeCallbacks.forEach(e=>{try{e()}catch(t){}})}getLastActivityTimestamp(){return this.lastActivityTimestamp}isInitialized(){return null!==this.midiAccess}dispose(){this.midiAccess&&(this.midiAccess.onstatechange=null),this.inputs.forEach(e=>{e.onmidimessage=null}),this.inputs.clear(),this.outputs.clear(),this.messageHandlers.clear(),this.deviceChangeCallbacks.clear(),this.clockSyncCallbacks.clear(),this.transportCallbacks.clear(),this.selectedInputId=null,this.selectedOutputId=null,this.midiAccess=null,this.clockSyncEnabled=!1,this.clockBPM=0,this.clockTickCount=0,this.lastClockTimestamp=0}}function cy(){return ly.getInstance()}class dy{static instance=null;mappings=new Map;lastCCValues=new Map;smoothedValues=new Map;globalSensitivity=.3;controlledInstrumentId=null;controlledInstrumentListeners=new Set;learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null};changeCallbacks=new Set;learnListeners=new Set;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return dy.instance||(dy.instance=new dy),dy.instance}init(){if(this.handlerRegistered)return;cy().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("cc"!==e.type||void 0===e.cc||void 0===e.value)return;if(this.learnState.isLearning&&this.learnState.callback)return void this.learnState.callback(e.cc,e.channel);const t=`${e.cc}-${e.channel}`,n=e.value,a=this.smoothedValues.get(t)??n,s=this.globalSensitivity,r=a+(n-a)*s;this.smoothedValues.set(t,r),this.mappings.forEach(t=>{if(t.ccNumber!==e.cc)return;if(void 0!==t.midiChannel&&t.midiChannel!==e.channel)return;const s=t.sensitivity??1,o=s<1?a+(n-a)*s:r,i=this.ccToParameter(o,t);this.notifyParameterChange(t.instrumentId,t.parameterPath,i)})};ccToParameter(e,t){const n=e/127;if("logarithmic"===t.curve){const e=Math.max(1,t.min),a=Math.max(e+1,t.max),s=Math.log(e),r=Math.log(a);return Math.exp(s+n*(r-s))}return t.min+n*(t.max-t.min)}parameterToCC(e,t){let n;if("logarithmic"===t.curve){const a=Math.max(1,t.min),s=Math.max(a+1,t.max),r=Math.log(a),o=Math.log(s);n=(Math.log(Math.max(a,e))-r)/(o-r)}else n=(e-t.min)/(t.max-t.min);return Math.round(Math.max(0,Math.min(127,127*n)))}startLearn(e,t,n,a,s,r="linear"){return new Promise(o=>{this.learnState={isLearning:!0,instrumentId:e,parameterPath:t,displayName:n,min:a,max:s,curve:r,callback:(e,t)=>{this.learnState.isLearning=!1,this.learnState.callback=null,this.notifyLearnChange(!1,null),o({ccNumber:e,channel:t})}},this.notifyLearnChange(!0,t)})}cancelLearn(){this.learnState.isLearning&&(this.learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null},this.notifyLearnChange(!1,null))}isLearning(){return this.learnState.isLearning}getLearningParameter(){return this.learnState.parameterPath}setMapping(e){this.mappings.forEach((t,n)=>{t.instrumentId===e.instrumentId&&t.parameterPath===e.parameterPath&&this.mappings.delete(n)}),this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}removeMappingsForInstrument(e){const t=[];this.mappings.forEach((n,a)=>{n.instrumentId===e&&t.push(a)}),t.forEach(e=>this.mappings.delete(e)),t.length>0&&(this.saveMappings(),this.notifyMappingChange())}getMappingForParameter(e,t){for(const n of this.mappings.values())if(n.instrumentId===e&&n.parameterPath===t)return n}getMappingsForInstrument(e){const t=[];return this.mappings.forEach(n=>{n.instrumentId===e&&t.push(n)}),t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}onParameterChange(e){return this.changeCallbacks.add(e),()=>this.changeCallbacks.delete(e)}onLearnChange(e){return this.learnListeners.add(e),()=>this.learnListeners.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyParameterChange(e,t,n){this.changeCallbacks.forEach(a=>{try{a(e,t,n)}catch(s){}})}notifyLearnChange(e,t){this.learnListeners.forEach(n=>{try{n(e,t)}catch(a){}})}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}setGlobalSensitivity(e){this.globalSensitivity=Math.max(.05,Math.min(1,e))}getGlobalSensitivity(){return this.globalSensitivity}resetSmoothing(){this.smoothedValues.clear(),this.lastCCValues.clear()}setControlledInstrument(e){this.controlledInstrumentId=e,this.resetSmoothing(),this.notifyControlledInstrumentChange(e)}getControlledInstrument(){return this.controlledInstrumentId}onControlledInstrumentChange(e){return this.controlledInstrumentListeners.add(e),()=>this.controlledInstrumentListeners.delete(e)}notifyControlledInstrumentChange(e){this.controlledInstrumentListeners.forEach(t=>{try{t(e)}catch(n){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("cc-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("cc-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){cy().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.changeCallbacks.clear(),this.learnListeners.clear(),this.mappingListeners.clear()}}function uy(){return dy.getInstance()}class py{static instance=null;mappings=new Map;actionHandlers=new Map;isLearning=!1;learningAction=null;learnCallback=null;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return py.instance||(py.instance=new py),py.instance}init(){if(this.handlerRegistered)return;cy().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if(this.isLearning&&this.learnCallback)return"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?void this.learnCallback(e.note,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63?void this.learnCallback(-e.cc-1,e.channel):void 0;"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?this.triggerButtonAction(e.note,void 0,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63&&this.triggerButtonAction(void 0,e.cc,e.channel)};triggerButtonAction(e,t,n){for(const a of this.mappings.values()){const s=void 0!==e&&a.midiNote===e,r=void 0!==t&&a.ccNumber===t;if(!s&&!r)continue;if(void 0!==a.midiChannel&&void 0!==n&&a.midiChannel!==n)continue;const o=this.actionHandlers.get(a.action);return void(o&&o())}}startLearn(e){return new Promise(t=>{this.isLearning=!0,this.learningAction=e,this.learnCallback=(e,n)=>{this.isLearning=!1,this.learningAction=null,this.learnCallback=null,t(e<0?{type:"cc",number:-e-1,channel:n}:{type:"note",number:e,channel:n})}})}cancelLearn(){this.isLearning=!1,this.learningAction=null,this.learnCallback=null}isInLearnMode(){return this.isLearning}getLearningAction(){return this.learningAction}setMapping(e){for(const[t,n]of this.mappings.entries())n.action===e.action&&this.mappings.delete(t);this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}getMappingForAction(e){for(const t of this.mappings.values())if(t.action===e)return t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}registerAction(e,t){return this.actionHandlers.set(e,t),()=>this.actionHandlers.delete(e)}unregisterAction(e){this.actionHandlers.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("button-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("button-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){cy().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.actionHandlers.clear(),this.mappingListeners.clear()}}function hy(){return py.getInstance()}class my{static instance=null;mappings=new Map;triggerCallbacks=new Set;handlerRegistered=!1;isLearning=!1;learnCallback=null;constructor(){}static getInstance(){return my.instance||(my.instance=new my),my.instance}init(){if(this.handlerRegistered)return;cy().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("noteOn"!==e.type&&"noteOff"!==e.type)return;if(void 0===e.note)return;if(this.isLearning&&"noteOn"===e.type&&this.learnCallback)return void this.learnCallback(e.note,e.channel);const t=`${e.channel}-${e.note}`,n=this.mappings.get(t);if(n){const t="noteOff"===e.type?0:e.velocity??0;this.notifyTrigger(n,t)}};onTrigger(e){return this.triggerCallbacks.add(e),()=>this.triggerCallbacks.delete(e)}notifyTrigger(e,t){this.triggerCallbacks.forEach(n=>{try{n(e,t)}catch(a){}})}setMapping(e){this.mappings.set(e.id,e),this.saveMappings()}removeMapping(e){this.mappings.delete(e),this.saveMappings()}getMapping(e,t){return this.mappings.get(`${e}-${t}`)}getAllMappings(){return Array.from(this.mappings.values())}clearMappings(){this.mappings.clear(),this.saveMappings()}startLearn(e){this.isLearning=!0,this.learnCallback=(t,n)=>{this.isLearning=!1,this.learnCallback=null,e(t,n)}}cancelLearn(){this.isLearning=!1,this.learnCallback=null}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("pad-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("pad-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>this.mappings.set(e.id,e))}}catch(e){}}dispose(){this.handlerRegistered&&(cy().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1),this.triggerCallbacks.clear()}}function fy(){return my.getInstance()}const yy={HEADER:new Uint8Array([240,0,32,50,0,1,10]),FOOTER:247,CMD_REQUEST_PATTERN:119,CMD_SEND_PATTERN:120},gy=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function vy(e){const{name:t,octave:n}=function(e){const t=Math.floor(e/12)-1;return{name:gy[e%12],octave:t}}(e);return t.includes("#")?`${t}${n}`:`${t}-${n}`}const by={303:[{cc:70,param:"cutoff",label:"Cutoff"},{cc:71,param:"resonance",label:"Resonance"},{cc:72,param:"envMod",label:"Env Mod"},{cc:73,param:"decay",label:"Decay"},{cc:74,param:"accent",label:"Accent"},{cc:75,param:"overdrive",label:"Drive"},{cc:76,param:"slideTime",label:"Slide"},{cc:77,param:"mixer.volume",label:"Volume"}],Siren:[{cc:70,param:"siren.osc.frequency",label:"Osc Freq"},{cc:71,param:"siren.lfo.rate",label:"LFO Rate"},{cc:72,param:"siren.lfo.depth",label:"LFO Depth"},{cc:73,param:"siren.delay.time",label:"Delay Time"},{cc:74,param:"siren.delay.feedback",label:"Feedback"},{cc:75,param:"siren.delay.wet",label:"Delay Mix"},{cc:76,param:"siren.filter.frequency",label:"Filter"},{cc:77,param:"siren.reverb.wet",label:"Reverb"}],FX:[{cc:70,param:"echo.rate",label:"Echo Rate"},{cc:71,param:"echo.intensity",label:"Intensity"},{cc:72,param:"echo.echoVolume",label:"Echo Vol"},{cc:73,param:"echo.reverbVolume",label:"Rev Vol"},{cc:74,param:"echo.mode",label:"Echo Mode"},{cc:75,param:"biphase.rateA",label:"Phase A"},{cc:76,param:"biphase.feedback",label:"Phase FB"},{cc:77,param:"biphase.routing",label:"Routing"}],Mixer:[{cc:70,param:"mixer.volume",label:"Vol 1"},{cc:71,param:"mixer.volume",label:"Vol 2"},{cc:72,param:"mixer.volume",label:"Vol 3"},{cc:73,param:"mixer.volume",label:"Vol 4"},{cc:74,param:"mixer.pan",label:"Pan 1"},{cc:75,param:"mixer.pan",label:"Pan 2"},{cc:76,param:"mixer.pan",label:"Pan 3"},{cc:77,param:"mixer.pan",label:"Pan 4"}]};function xy(e,t){return`${e}:${t}`}function wy(e,t,n,a){return t+function(e,t="linear"){const n=Math.max(0,Math.min(127,e))/127;switch(t){case"exponential":return Math.pow(n,2);case"logarithmic":return Math.sqrt(n);default:return n}}(e,a)*(n-t)}const ky=[{ccNumber:74,parameter:"cutoff",min:200,max:2e4,curve:"logarithmic"},{ccNumber:71,parameter:"resonance",min:0,max:100,curve:"linear"},{ccNumber:10,parameter:"envMod",min:0,max:100,curve:"linear"},{ccNumber:75,parameter:"decay",min:30,max:3e3,curve:"logarithmic"},{ccNumber:16,parameter:"accent",min:0,max:100,curve:"linear"}],Sy=new Map,My=new Map,Ny=a()(Qh(Fn((e,t)=>({isSupported:null,isInitialized:!1,lastError:null,inputDevices:[],outputDevices:[],selectedInputId:null,selectedOutputId:null,ccMappings:[...ky],isLearning:!1,learningParameter:null,lastActivityTimestamp:0,controlledInstrumentId:null,knobBank:"303",padBank:"A",midiOctaveOffset:0,showPatternDialog:!1,showKnobBar:!1,midiOutputEnabled:!0,init:async()=>{const n=cy();if(!n.isSupported())return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported in this browser"}),!1;e(e=>{e.isSupported=!0});try{if(await n.init()){n.addMessageHandler(e=>{const n=t();if(n.updateActivity(),"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){if(fy().getMapping(e.channel,e.note))return;if(36===e.note)return void n.setKnobBank("303");if(37===e.note)return void n.setKnobBank("Siren");if(38===e.note)return void n.setKnobBank("FX");if(39===e.note)return void n.setKnobBank("Mixer");const t=n.midiOctaveOffset||0,a=e.note+12*t,s=vy(a).replace("-",""),r=Df.getState(),o=r.currentInstrumentId,i=r.instruments.find(e=>e.id===o),l=r.previewInstrument||i||r.instruments[0];Math.pow(2,(a-69)/12);if(l){"DubSiren"===l.synthType&&"Siren"!==n.knobBank?n.setKnobBank("Siren"):"TB303"!==l.synthType&&"Buzz3o3"!==l.synthType||"303"===n.knobBank||n.setKnobBank("303");const t=em(),{midiPolyphonic:a}=Zh.getState(),r=e.velocity/127,o=Math.max(.5,Math.sqrt(r));if(My.set(e.note,s),a)t.triggerPolyNoteAttack(l.id,s,o,l);else{if(My.size>1){for(const[a,s]of My.entries())a!==e.note&&t.triggerPolyNoteRelease(l.id,s,l);const n=My.get(e.note);My.clear(),n&&My.set(e.note,n)}t.triggerPolyNoteAttack(l.id,s,o,l)}}return}if("noteOff"===e.type&&void 0!==e.note){if(fy().getMapping(e.channel,e.note))return;const t=My.get(e.note);if(t){My.delete(e.note);const n=Df.getState(),a=n.currentInstrumentId,s=n.instruments.find(e=>e.id===a),r=n.previewInstrument||s||n.instruments[0];if(r){em().triggerPolyNoteRelease(r.id,t,r)}}return}if("pitchBend"===e.type&&void 0!==e.pitchBend){const t=(e.pitchBend+8192)/16383,n=Df.getState(),a=n.currentInstrumentId,s=n.instruments.find(e=>e.id===a);if("DubSiren"===s?.synthType&&s.dubSiren){const e=60+1440*t;n.updateInstrument(s.id,{dubSiren:{...s.dubSiren,oscillator:{...s.dubSiren.oscillator,frequency:e}}})}return}if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value){if(1===e.cc){const t=e.value/127,n=Df.getState(),a=n.currentInstrumentId,s=n.instruments.find(e=>e.id===a);if("DubSiren"===s?.synthType&&s.dubSiren){const e=.1+19.9*t;n.updateInstrument(s.id,{dubSiren:{...s.dubSiren,lfo:{...s.dubSiren.lfo,rate:e}}})}}if(n.isLearning&&n.learningParameter)return void n.handleLearnedCC(e.cc);if(e.cc>=70&&e.cc<=77){const t=by[n.knobBank].find(t=>t.cc===e.cc);if(t)return void((e,t)=>{const n=t/127,a=Df.getState(),s=a.currentInstrumentId,r=a.instruments.find(e=>e.id===s);if(r)switch(e){case"cutoff":a.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,cutoff:200*Math.pow(25,n)}}});break;case"resonance":a.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,resonance:100*n}}});break;case"envMod":a.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,envMod:100*n}}});break;case"decay":a.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,decay:30+2970*n}}});break;case"accent":a.updateInstrument(r.id,{tb303:{...r.tb303,accent:{amount:100*n}}});break;case"overdrive":a.updateInstrument(r.id,{tb303:{...r.tb303,overdrive:{...r.tb303.overdrive,amount:100*n}}});break;case"slideTime":a.updateInstrument(r.id,{tb303:{...r.tb303,slide:{...r.tb303.slide,time:2+358*n}}});break;case"siren.osc.frequency":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,oscillator:{...r.dubSiren.oscillator,frequency:60+940*n}}});break;case"siren.lfo.rate":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,rate:.1+19.9*n}}});break;case"siren.lfo.depth":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,depth:500*n}}});break;case"siren.delay.time":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,time:.01+.99*n}}});break;case"siren.delay.feedback":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,feedback:.95*n}}});break;case"siren.delay.wet":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,wet:n}}});break;case"siren.filter.frequency":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,filter:{...r.dubSiren.filter,frequency:20+9980*n}}});break;case"siren.reverb.wet":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,reverb:{...r.dubSiren.reverb,wet:n}}});break;case"echo.rate":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,rate:50+950*n}});break}case"echo.intensity":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,intensity:1.2*n}});break}case"echo.echoVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,echoVolume:n}});break}case"echo.reverbVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,reverbVolume:n}});break}case"echo.mode":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,mode:Math.floor(1+11*n)}});break}case"biphase.rateA":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,rateA:.1+9.9*n}});break}case"biphase.feedback":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,feedback:.95*n}});break}case"biphase.routing":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,routing:n>.5?1:0}});break}case"mixer.volume":a.updateInstrument(r.id,{volume:60*n-60});break;case"mixer.pan":a.updateInstrument(r.id,{pan:200*n-100})}})(t.param,e.value)}const t=n.ccMappings.find(t=>t.ccNumber===e.cc);if(t){const n=e.value/127;let a;if("logarithmic"===t.curve){const e=Math.max(1,t.min),s=Math.max(e+1,t.max),r=Math.log(e),o=Math.log(s);a=Math.exp(r+n*(o-r))}else a=t.min+n*(t.max-t.min);const s=Sy.get(t.parameter);s&&s(a)}}}),n.onDeviceChange(()=>{t().refreshDevices();const n=t();!n.selectedInputId&&n.inputDevices.length>0&&t().selectInput(n.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0})}),t().refreshDevices();const a=t();!a.selectedInputId&&a.inputDevices.length>0&&await t().selectInput(a.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0});uy().init();return hy().init(),e(e=>{e.isInitialized=!0,e.lastError=null}),!0}return e(e=>{e.lastError="Failed to initialize MIDI access"}),!1}catch(a){return e(e=>{e.lastError=a instanceof Error?a.message:"Unknown error"}),!1}},refreshDevices:()=>{const t=cy();e(e=>{e.inputDevices=t.getInputDevices(),e.outputDevices=t.getOutputDevices();const n=t.getSelectedInput(),a=t.getSelectedOutput();e.selectedInputId=n?.id||null,e.selectedOutputId=a?.id||null})},selectInput:async t=>{const n=cy();await n.selectInput(t),e(e=>{e.selectedInputId=t})},selectOutput:t=>{cy().selectOutput(t),e(e=>{e.selectedOutputId=t})},setMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t.ccNumber&&e.parameter!==t.parameter),e.ccMappings.push(t)})},removeMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t)})},resetMappings:()=>{e(e=>{e.ccMappings=[...ky]})},startLearn:t=>{e(e=>{e.isLearning=!0,e.learningParameter=t})},cancelLearn:()=>{e(e=>{e.isLearning=!1,e.learningParameter=null})},handleLearnedCC:n=>{const{learningParameter:a}=t();if(!a)return;const s=ky.find(e=>e.parameter===a),r=s?{...s,ccNumber:n}:{ccNumber:n,parameter:a,min:0,max:100,curve:"linear"};e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==n&&e.parameter!==a),e.ccMappings.push(r),e.isLearning=!1,e.learningParameter=null})},updateActivity:()=>{const n=Date.now(),a=t().lastActivityTimestamp;n-a>100&&e(e=>{e.lastActivityTimestamp=n})},openPatternDialog:()=>{e(e=>{e.showPatternDialog=!0})},closePatternDialog:()=>{e(e=>{e.showPatternDialog=!1})},registerCCHandler:(e,t)=>{Sy.set(e,t)},unregisterCCHandler:e=>{Sy.delete(e)},setControlledInstrument:t=>{e(e=>{e.controlledInstrumentId=t})},setKnobBank:t=>e(e=>{e.knobBank=t}),togglePadBank:()=>e(e=>{e.padBank="A"===e.padBank?"B":"A"}),setPadBank:t=>e(e=>{e.padBank=t}),setShowKnobBar:t=>{e(e=>{e.showKnobBar=t})},sendCC:(e,n,a=0)=>{const{midiOutputEnabled:s}=t();if(!s)return;const r=cy(),o=Math.max(0,Math.min(127,Math.round(n)));r.sendCC(a,e,o)},setMidiOutputEnabled:t=>{e(e=>{e.midiOutputEnabled=t})},setMidiOctaveOffset:t=>{e(e=>{e.midiOctaveOffset=Math.max(-4,Math.min(4,t))})},gridMappings:{},gridIsLearning:!1,gridLearningParameter:null,addGridMapping:t=>{t.channel<0||t.channel>15||t.controller<0||t.controller>127||t.min>t.max||e(e=>{const n=xy(t.channel,t.controller);e.gridMappings[n]=t})},removeGridMapping:(t,n)=>{e(e=>{const a=xy(t,n);delete e.gridMappings[a]})},getGridMapping:(e,n)=>{const a=xy(e,n);return t().gridMappings[a]},clearGridMappings:()=>{e(e=>{e.gridMappings={}})},startGridLearning:n=>{t().gridIsLearning||e(e=>{e.gridIsLearning=!0,e.gridLearningParameter=n})},stopGridLearning:()=>{e(e=>{e.gridIsLearning=!1,e.gridLearningParameter=null})},applyGridMIDIValue:(e,n,a)=>{const s=t().getGridMapping(e,n);return s?wy(a,s.min,s.max,s.curve):null}})),{name:"midi-settings",partialize:e=>({ccMappings:e.ccMappings,selectedInputId:e.selectedInputId,selectedOutputId:e.selectedOutputId,controlledInstrumentId:e.controlledInstrumentId,knobBank:e.knobBank,showKnobBar:e.showKnobBar,midiOutputEnabled:e.midiOutputEnabled,midiOctaveOffset:e.midiOctaveOffset,gridMappings:e.gridMappings})})),Cy=a((e,t)=>({activeNotes:new Map,adsrStages:new Map,adsrProgress:new Map,lfoPhases:new Map,samplePositions:new Map,setActiveNote:(t,n)=>{e(e=>{const a=new Map(e.activeNotes),s=a.get(t)||[],r=s.findIndex(e=>e.note===n.note);return r>=0?s[r]=n:s.push(n),a.set(t,s),{activeNotes:a}})},clearActiveNote:(t,n)=>{e(e=>{const a=new Map(e.activeNotes),s=(a.get(t)||[]).filter(e=>e.note!==n);return 0===s.length?a.delete(t):a.set(t,s),{activeNotes:a}})},clearChannelNotes:t=>{e(e=>{const n=new Map(e.activeNotes);return n.delete(t),{activeNotes:n}})},clearAllNotes:()=>{e({activeNotes:new Map})},setADSRStage:(t,n,a=0)=>{e(e=>{const s=new Map(e.adsrStages),r=new Map(e.adsrProgress);return s.set(t,n),r.set(t,a),{adsrStages:s,adsrProgress:r}})},setADSRProgress:(t,n)=>{e(e=>{const a=new Map(e.adsrProgress);return a.set(t,n),{adsrProgress:a}})},setLFOPhase:(t,n)=>{e(e=>{const a=new Map(e.lfoPhases);return a.set(t,n),{lfoPhases:a}})},setSamplePosition:(t,n)=>{e(e=>{const a=new Map(e.samplePositions);return a.set(t,Math.max(0,Math.min(1,n))),{samplePositions:a}})},clearSamplePosition:t=>{e(e=>{const n=new Map(e.samplePositions);return n.delete(t),{samplePositions:n}})}})),Ey=a()(Fn((e,t)=>({isLiveMode:!1,pendingPatternIndex:null,pendingPositionIndex:null,queueMode:"end-of-pattern",channelQueues:new Map,showQueueCountdown:!0,barsUntilSwitch:0,toggleLiveMode:()=>{const n=!t().isLiveMode;e(e=>{e.isLiveMode=n,n||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues=new Map)})},setLiveMode:t=>{e(e=>{e.isLiveMode=t,t||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues.clear())})},queuePattern:t=>{e(e=>{e.pendingPatternIndex=t})},queuePosition:t=>{e(e=>{e.pendingPositionIndex=t})},clearQueue:()=>{e(e=>{e.pendingPatternIndex=null,e.pendingPositionIndex=null})},setQueueMode:t=>{e(e=>{e.queueMode=t})},queueChannelAction:(t,n)=>{e(e=>{const a=e.channelQueues.get(t)||[];a.push(n),e.channelQueues.set(t,a)})},clearChannelQueue:t=>{e(e=>{e.channelQueues.delete(t)})},popChannelAction:n=>{const a=t().channelQueues.get(n);if(!a||0===a.length)return;const s=a.shift();return e(e=>{0===a.length?e.channelQueues.delete(n):e.channelQueues.set(n,a)}),s},updateBarsUntilSwitch:t=>{e(e=>{e.barsUntilSwitch=t})},setShowQueueCountdown:t=>{e(e=>{e.showQueueCountdown=t})}}))),Py={horizontalZoom:16,verticalZoom:12,scrollX:0,scrollY:48,snapToGrid:!0,gridDivision:4,showVelocity:!0,showVelocityLane:!1,channelIndex:0,multiChannel:!1,scaleKey:"chromatic",scaleRoot:0,noteLengthPreset:0},Ty={notes:new Set,startRow:null,endRow:null,startNote:null,endNote:null},Ay=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Iy(e){const t=Math.floor(e/12)-1;return`${Ay[e%12]}${t}`}function _y(e){return[1,3,6,8,10].includes(e%12)}const Oy=[{label:"Grid",value:0},{label:"1/32",value:1},{label:"1/16",value:2},{label:"1/8",value:4},{label:"1/4",value:8},{label:"1/2",value:16},{label:"1/1",value:32}],Fy=a()(Fn((e,t)=>({view:{...Py},selection:{...Ty,notes:new Set},drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},tool:"select",clipboard:null,contextMenu:{visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},ghostNotes:[],setHorizontalZoom:t=>e(e=>{e.view.horizontalZoom=Math.max(4,Math.min(64,t))}),setVerticalZoom:t=>e(e=>{e.view.verticalZoom=Math.max(8,Math.min(32,t))}),setScroll:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,t),e.view.scrollY=Math.max(0,Math.min(127,n))}),scrollBy:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,e.view.scrollX+t),e.view.scrollY=Math.max(0,Math.min(127,e.view.scrollY+n))}),setSnapToGrid:t=>e(e=>{e.view.snapToGrid=t}),setGridDivision:t=>e(e=>{e.view.gridDivision=t}),setShowVelocity:t=>e(e=>{e.view.showVelocity=t}),setShowVelocityLane:t=>e(e=>{e.view.showVelocityLane=t}),setChannelIndex:t=>e(e=>{e.view.channelIndex=t}),setMultiChannel:t=>e(e=>{e.view.multiChannel=t}),setScaleKey:t=>e(e=>{e.view.scaleKey=t}),setScaleRoot:t=>e(e=>{e.view.scaleRoot=Math.max(0,Math.min(11,t))}),setNoteLengthPreset:t=>e(e=>{e.view.noteLengthPreset=t}),selectNote:(t,n=!1)=>e(e=>{n?e.selection.notes.add(t):e.selection.notes=new Set([t])}),selectNotes:t=>e(e=>{e.selection.notes=new Set(t)}),selectAll:t=>e(e=>{e.selection.notes=new Set(t)}),deselectNote:t=>e(e=>{e.selection.notes.delete(t)}),clearSelection:()=>e(e=>{e.selection.notes=new Set,e.selection.startRow=null,e.selection.endRow=null,e.selection.startNote=null,e.selection.endNote=null}),setSelectionBox:(t,n,a,s)=>e(e=>{e.selection.startRow=t,e.selection.endRow=n,e.selection.startNote=a,e.selection.endNote=s}),startDrag:(t,n,a,s)=>e(e=>{e.drag.isDragging=!0,e.drag.mode=t,e.drag.startX=n,e.drag.startY=a,e.drag.currentX=n,e.drag.currentY=a,e.drag.noteId=s||null}),updateDrag:(t,n)=>e(e=>{e.drag.currentX=t,e.drag.currentY=n}),endDrag:()=>e(e=>{e.drag.isDragging=!1,e.drag.mode="none",e.drag.noteId=null,e.drag.originalNotes=[],e.ghostNotes=[]}),setTool:t=>e(e=>{e.tool=t}),copyNotes:t=>e(e=>{if(0===t.length)return;const n=Math.min(...t.map(e=>e.startRow)),a=Math.min(...t.map(e=>e.midiNote));e.clipboard={notes:t.map(e=>({...e})),minRow:n,minNote:a}}),getClipboard:()=>t().clipboard,showContextMenu:(t,n,a,s,r)=>e(e=>{e.contextMenu={visible:!0,x:t,y:n,noteId:a,row:s,midiNote:r}}),hideContextMenu:()=>e(e=>{e.contextMenu.visible=!1}),setGhostNotes:t=>e(e=>{e.ghostNotes=t}),clearGhostNotes:()=>e(e=>{e.ghostNotes=[]}),resetView:()=>e(e=>{e.view={...Py},e.selection={...Ty,notes:new Set},e.drag={isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},e.tool="select",e.clipboard=null,e.contextMenu={visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},e.ghostNotes=[]})}))),Dy=0,Ry=1,jy=2,Ly=3,By="Synthesis",Vy="Filter",zy="Envelope",Uy="LFO",Gy="Effects",Ky="Modulation",Hy="Arpeggiator",Wy="Output",$y=1313559366,qy=1313428297,Yy=1313426241,Xy=1347179847,Qy=1,Zy=0,Jy="DEViLBOX",eg="devilbox-tracker-v1",tg=[{id:"tb303.cutoff",name:"Cutoff",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:74,isAutomatable:!0},{id:"tb303.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,ccNumber:71,isAutomatable:!0},{id:"tb303.envMod",name:"Env Mod",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,ccNumber:102,isAutomatable:!0},{id:"tb303.decay",name:"Decay",section:zy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,ccNumber:103,isAutomatable:!0},{id:"tb303.accent",name:"Accent",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,ccNumber:104,isAutomatable:!0},{id:"tb303.tuning",name:"Tuning",section:By,type:Dy,min:-1,max:1,defaultValue:0,unit:"semi",formatString:"%.1f",page:0,index:5,ccNumber:105,isAutomatable:!0},{id:"tb303.waveform",name:"Waveform",section:By,type:Ly,min:0,max:1,defaultValue:0,valueStrings:["Saw","Square"],page:0,index:6,ccNumber:106,isAutomatable:!0},{id:"tb303.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"dB",formatString:"%.1f",page:0,index:7,ccNumber:7,isAutomatable:!0},{id:"tb303.distortion",name:"Distortion",section:Gy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:0,ccNumber:94,isAutomatable:!0},{id:"tb303.delay.time",name:"Delay Time",section:Gy,type:Dy,min:0,max:1,defaultValue:.375,unit:"ms",formatString:"%.0f",page:1,index:1,ccNumber:85,isAutomatable:!0},{id:"tb303.delay.feedback",name:"Delay Fdbk",section:Gy,type:Dy,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,ccNumber:86,isAutomatable:!0},{id:"tb303.delay.mix",name:"Delay Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,ccNumber:87,isAutomatable:!0},{id:"tb303.reverb.size",name:"Reverb Size",section:Gy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:4,ccNumber:91,isAutomatable:!0},{id:"tb303.reverb.mix",name:"Reverb Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:5,ccNumber:92,isAutomatable:!0}],ng=[{id:"dexed.algorithm",name:"Algorithm",section:By,type:Ry,min:0,max:31,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"dexed.feedback",name:"Feedback",section:By,type:Ry,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"dexed.lfoSpeed",name:"LFO Speed",section:Uy,type:Ry,min:0,max:99,defaultValue:35,page:0,index:2,isAutomatable:!0},{id:"dexed.lfoPitchModDepth",name:"LFO Pitch",section:Uy,type:Ry,min:0,max:99,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"dexed.lfoAmpModDepth",name:"LFO Amp",section:Uy,type:Ry,min:0,max:99,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"dexed.lfoWave",name:"LFO Wave",section:Uy,type:Ly,min:0,max:5,defaultValue:0,valueStrings:["Triangle","Saw Down","Saw Up","Square","Sine","S&H"],page:0,index:5,isAutomatable:!0},{id:"dexed.transpose",name:"Transpose",section:By,type:Ry,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:6,isAutomatable:!0},{id:"dexed.oscSync",name:"Osc Sync",section:By,type:jy,min:0,max:1,defaultValue:1,page:0,index:7,isAutomatable:!0},...function(){const e=[];for(let t=0;t<6;t++){const n=t+1;e.push({id:`dexed.op${t+1}.level`,name:`OP${t+1} Level`,section:By,type:Ry,min:0,max:99,defaultValue:0===t?99:0,page:n,index:0,isAutomatable:!0},{id:`dexed.op${t+1}.coarse`,name:`OP${t+1} Coarse`,section:By,type:Ry,min:0,max:31,defaultValue:1,page:n,index:1,isAutomatable:!0},{id:`dexed.op${t+1}.fine`,name:`OP${t+1} Fine`,section:By,type:Ry,min:0,max:99,defaultValue:0,page:n,index:2,isAutomatable:!0},{id:`dexed.op${t+1}.detune`,name:`OP${t+1} Detune`,section:By,type:Ry,min:0,max:14,defaultValue:7,page:n,index:3,isAutomatable:!0},{id:`dexed.op${t+1}.egRate1`,name:`OP${t+1} R1`,section:zy,type:Ry,min:0,max:99,defaultValue:99,page:n,index:4,isAutomatable:!0},{id:`dexed.op${t+1}.egRate2`,name:`OP${t+1} R2`,section:zy,type:Ry,min:0,max:99,defaultValue:99,page:n,index:5,isAutomatable:!0},{id:`dexed.op${t+1}.egRate3`,name:`OP${t+1} R3`,section:zy,type:Ry,min:0,max:99,defaultValue:99,page:n,index:6,isAutomatable:!0},{id:`dexed.op${t+1}.egRate4`,name:`OP${t+1} R4`,section:zy,type:Ry,min:0,max:99,defaultValue:99,page:n,index:7,isAutomatable:!0})}return e}()];const ag=[{id:"polysynth.oscillator.type",name:"Waveform",section:By,type:Ly,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"polysynth.oscillator.detune",name:"Detune",section:By,type:Dy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"polysynth.filter.frequency",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"polysynth.filter.Q",name:"Resonance",section:Vy,type:Dy,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"polysynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"polysynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"polysynth.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"polysynth.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"polysynth.maxPolyphony",name:"Voices",section:By,type:Ry,min:1,max:32,defaultValue:8,page:1,index:0,isAutomatable:!0},{id:"polysynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0}],sg=[{id:"noisesynth.noise.type",name:"Noise Type",section:By,type:Ly,min:0,max:2,defaultValue:0,valueStrings:["White","Pink","Brown"],page:0,index:0,isAutomatable:!0},{id:"noisesynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.005,unit:"s",formatString:"%.3f",page:0,index:1,isAutomatable:!0},{id:"noisesynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"noisesynth.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"noisesynth.envelope.release",name:"Release",section:zy,type:Dy,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"noisesynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],rg=[{id:"sampler.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:0,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"sampler.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"sampler.baseUrl",name:"Sample",section:By,type:Ly,min:0,max:0,defaultValue:0,page:0,index:2,isAutomatable:!1},{id:"sampler.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],og=[{id:"furnace.algorithm",name:"Algorithm",section:By,type:Ry,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"furnace.feedback",name:"Feedback",section:By,type:Ry,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"furnace.op1.level",name:"OP1 Level",section:By,type:Ry,min:0,max:127,defaultValue:99,page:0,index:2,isAutomatable:!0},{id:"furnace.op1.mult",name:"OP1 Mult",section:By,type:Ry,min:0,max:15,defaultValue:1,page:0,index:3,isAutomatable:!0},{id:"furnace.op2.level",name:"OP2 Level",section:By,type:Ry,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.op2.mult",name:"OP2 Mult",section:By,type:Ry,min:0,max:15,defaultValue:1,page:0,index:5,isAutomatable:!0},{id:"furnace.lfoRate",name:"LFO Rate",section:Uy,type:Ry,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ig=[{id:"furnace.duty",name:"Duty Cycle",section:By,type:Ly,min:0,max:3,defaultValue:2,valueStrings:["12.5%","25%","50%","75%"],page:0,index:0,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Wy,type:Ry,min:0,max:15,defaultValue:15,page:0,index:1,isAutomatable:!0},{id:"furnace.arpSpeed",name:"Arp Speed",section:Hy,type:Ry,min:0,max:15,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"furnace.pitchSlide",name:"Pitch Slide",section:Ky,type:Ry,min:-127,max:127,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"furnace.vibrato",name:"Vibrato",section:Uy,type:Ry,min:0,max:15,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.noise",name:"Noise",section:By,type:jy,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"furnace.envelope",name:"Env Mode",section:zy,type:Ry,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0}],lg=[{id:"buzzmachine.param0",name:"Param 1",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"buzzmachine.param1",name:"Param 2",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"buzzmachine.param2",name:"Param 3",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"buzzmachine.param3",name:"Param 4",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"buzzmachine.param4",name:"Param 5",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"buzzmachine.param5",name:"Param 6",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"buzzmachine.param6",name:"Param 7",section:zy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"buzzmachine.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],cg=[{id:"generic.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:7,isAutomatable:!0},{id:"generic.pan",name:"Pan",section:Wy,type:Dy,min:-1,max:1,defaultValue:0,formatString:"%.2f",page:0,index:1,ccNumber:10,isAutomatable:!0}],dg={TB303:tg,Dexed:ng,OBXd:[{id:"obxd.osc1Waveform",name:"Osc1 Wave",section:By,type:Ly,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"obxd.osc1Octave",name:"Osc1 Oct",section:By,type:Ry,min:-2,max:2,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"obxd.osc1PulseWidth",name:"Osc1 PW",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"obxd.osc1Level",name:"Osc1 Level",section:By,type:Dy,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"obxd.osc2Waveform",name:"Osc2 Wave",section:By,type:Ly,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:4,isAutomatable:!0},{id:"obxd.osc2Octave",name:"Osc2 Oct",section:By,type:Ry,min:-2,max:2,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"obxd.osc2Detune",name:"Osc2 Detune",section:By,type:Dy,min:-1,max:1,defaultValue:.1,unit:"semi",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"obxd.osc2Level",name:"Osc2 Level",section:By,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"obxd.filterCutoff",name:"Cutoff",section:Vy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:0,isAutomatable:!0},{id:"obxd.filterResonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"obxd.filterEnvAmount",name:"Env Amount",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"obxd.filterKeyTrack",name:"Key Track",section:Vy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"obxd.filterAttack",name:"Flt Attack",section:zy,type:Dy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:1,index:4,isAutomatable:!0},{id:"obxd.filterDecay",name:"Flt Decay",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:5,isAutomatable:!0},{id:"obxd.filterSustain",name:"Flt Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"obxd.filterRelease",name:"Flt Release",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:7,isAutomatable:!0},{id:"obxd.ampAttack",name:"Amp Attack",section:zy,type:Dy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:2,index:0,isAutomatable:!0},{id:"obxd.ampDecay",name:"Amp Decay",section:zy,type:Dy,min:0,max:1,defaultValue:.2,unit:"s",formatString:"%.2f",page:2,index:1,isAutomatable:!0},{id:"obxd.ampSustain",name:"Amp Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:2,isAutomatable:!0},{id:"obxd.ampRelease",name:"Amp Release",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:2,index:3,isAutomatable:!0},{id:"obxd.masterVolume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:4,isAutomatable:!0},{id:"obxd.portamento",name:"Portamento",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:2,index:5,isAutomatable:!0},{id:"obxd.unison",name:"Unison",section:By,type:jy,min:0,max:1,defaultValue:0,page:2,index:6,isAutomatable:!0},{id:"obxd.unisonDetune",name:"Uni Detune",section:By,type:Dy,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:2,index:7,isAutomatable:!0},{id:"obxd.lfoRate",name:"LFO Rate",section:Uy,type:Dy,min:0,max:1,defaultValue:.2,unit:"Hz",formatString:"%.1f",page:3,index:0,isAutomatable:!0},{id:"obxd.lfoWaveform",name:"LFO Wave",section:Uy,type:Ly,min:0,max:4,defaultValue:0,valueStrings:["Sine","Triangle","Saw","Square","S&H"],page:3,index:1,isAutomatable:!0},{id:"obxd.lfoOscAmount",name:"LFO>Pitch",section:Uy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:2,isAutomatable:!0},{id:"obxd.lfoFilterAmount",name:"LFO>Filter",section:Uy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:3,isAutomatable:!0},{id:"obxd.lfoAmpAmount",name:"LFO>Amp",section:Uy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:4,isAutomatable:!0},{id:"obxd.lfoPwAmount",name:"LFO>PW",section:Uy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:5,isAutomatable:!0},{id:"obxd.oscSync",name:"Osc Sync",section:By,type:jy,min:0,max:1,defaultValue:0,page:3,index:6,isAutomatable:!0},{id:"obxd.oscXor",name:"Ring Mod",section:By,type:jy,min:0,max:1,defaultValue:0,page:3,index:7,isAutomatable:!0}],DubSiren:[{id:"dubsiren.oscillator.type",name:"Osc Type",section:By,type:Ly,min:0,max:3,defaultValue:0,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:0,isAutomatable:!0},{id:"dubsiren.oscillator.frequency",name:"Frequency",section:By,type:Dy,min:60,max:1e3,defaultValue:440,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"dubsiren.lfo.enabled",name:"LFO On",section:Uy,type:jy,min:0,max:1,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"dubsiren.lfo.type",name:"LFO Type",section:Uy,type:Ly,min:0,max:3,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:3,isAutomatable:!0},{id:"dubsiren.lfo.rate",name:"LFO Rate",section:Uy,type:Dy,min:0,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"dubsiren.lfo.depth",name:"LFO Depth",section:Uy,type:Dy,min:0,max:1e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"dubsiren.filter.enabled",name:"Filter On",section:Vy,type:jy,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"dubsiren.filter.frequency",name:"Filter Freq",section:Vy,type:Dy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"dubsiren.delay.enabled",name:"Delay On",section:Gy,type:jy,min:0,max:1,defaultValue:1,page:1,index:0,isAutomatable:!0},{id:"dubsiren.delay.time",name:"Delay Time",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"dubsiren.delay.feedback",name:"Delay Fdbk",section:Gy,type:Dy,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"dubsiren.delay.wet",name:"Delay Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"dubsiren.reverb.enabled",name:"Reverb On",section:Gy,type:jy,min:0,max:1,defaultValue:1,page:1,index:4,isAutomatable:!0},{id:"dubsiren.reverb.decay",name:"Reverb Dec",section:Gy,type:Dy,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"dubsiren.reverb.wet",name:"Reverb Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],SpaceLaser:[{id:"spacelaser.laser.startFreq",name:"Start Freq",section:By,type:Dy,min:100,max:1e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"spacelaser.laser.endFreq",name:"End Freq",section:By,type:Dy,min:20,max:2e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"spacelaser.laser.sweepTime",name:"Sweep Time",section:zy,type:Dy,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"spacelaser.laser.sweepCurve",name:"Curve",section:zy,type:Ly,min:0,max:1,defaultValue:0,valueStrings:["Exp","Linear"],page:0,index:3,isAutomatable:!0},{id:"spacelaser.fm.amount",name:"FM Amount",section:Ky,type:Dy,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"spacelaser.fm.ratio",name:"FM Ratio",section:Ky,type:Dy,min:.5,max:16,defaultValue:1,formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"spacelaser.noise.amount",name:"Noise",section:By,type:Dy,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"spacelaser.filter.cutoff",name:"Filter",section:Vy,type:Dy,min:20,max:2e4,defaultValue:2e4,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"spacelaser.delay.enabled",name:"Delay On",section:Gy,type:jy,min:0,max:1,defaultValue:0,page:1,index:0,isAutomatable:!0},{id:"spacelaser.delay.time",name:"Delay Time",section:Gy,type:Dy,min:0,max:1,defaultValue:.25,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"spacelaser.delay.feedback",name:"Delay Fdbk",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"spacelaser.delay.wet",name:"Delay Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"spacelaser.reverb.enabled",name:"Reverb On",section:Gy,type:jy,min:0,max:1,defaultValue:0,page:1,index:4,isAutomatable:!0},{id:"spacelaser.reverb.decay",name:"Reverb Dec",section:Gy,type:Dy,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"spacelaser.reverb.wet",name:"Reverb Mix",section:Gy,type:Dy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],Synare:[{id:"synare.oscillator.tune",name:"Tune",section:By,type:Dy,min:20,max:1e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"synare.oscillator.fine",name:"Fine Tune",section:By,type:Dy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"synare.oscillator2.enabled",name:"Osc2 On",section:By,type:jy,min:0,max:1,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"synare.oscillator2.detune",name:"Osc2 Detune",section:By,type:Dy,min:-24,max:24,defaultValue:7,unit:"semi",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"synare.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"synare.filter.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:100,defaultValue:20,unit:"%",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"synare.filter.envMod",name:"Flt Env",section:Vy,type:Dy,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"synare.filter.decay",name:"Flt Decay",section:zy,type:Dy,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"synare.envelope.decay",name:"Amp Decay",section:zy,type:Dy,min:10,max:2e3,defaultValue:300,unit:"ms",formatString:"%.0f",page:1,index:0,isAutomatable:!0},{id:"synare.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"synare.sweep.enabled",name:"Sweep On",section:Ky,type:jy,min:0,max:1,defaultValue:1,page:1,index:2,isAutomatable:!0},{id:"synare.sweep.amount",name:"Sweep Amt",section:Ky,type:Dy,min:0,max:48,defaultValue:12,unit:"semi",formatString:"%.0f",page:1,index:3,isAutomatable:!0},{id:"synare.sweep.time",name:"Sweep Time",section:Ky,type:Dy,min:1,max:500,defaultValue:50,unit:"ms",formatString:"%.0f",page:1,index:4,isAutomatable:!0},{id:"synare.noise.enabled",name:"Noise On",section:By,type:jy,min:0,max:1,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"synare.noise.mix",name:"Noise Mix",section:By,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"synare.noise.color",name:"Noise Color",section:By,type:Dy,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:1,index:7,isAutomatable:!0}],V2:[{id:"v2.osc1.mode",name:"Osc1 Mode",section:By,type:Ly,min:0,max:7,defaultValue:1,valueStrings:["Off","Saw/Tri","Pulse","Sin","Noise","XX","AuxA","AuxB"],page:0,index:0,isAutomatable:!0},{id:"v2.osc1.transpose",name:"Osc1 Trans",section:By,type:Ry,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:1,isAutomatable:!0},{id:"v2.osc1.color",name:"Osc1 Color",section:By,type:Ry,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"v2.osc1.level",name:"Osc1 Level",section:By,type:Ry,min:0,max:127,defaultValue:127,page:0,index:3,isAutomatable:!0},{id:"v2.osc2.mode",name:"Osc2 Mode",section:By,type:Ly,min:0,max:7,defaultValue:0,valueStrings:["!Off","Tri","Pulse","Sin","Noise","FM","AuxA","AuxB"],page:0,index:4,isAutomatable:!0},{id:"v2.osc2.transpose",name:"Osc2 Trans",section:By,type:Ry,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:5,isAutomatable:!0},{id:"v2.osc2.detune",name:"Osc2 Detune",section:By,type:Ry,min:-64,max:63,defaultValue:10,page:0,index:6,isAutomatable:!0},{id:"v2.osc2.level",name:"Osc2 Level",section:By,type:Ry,min:0,max:127,defaultValue:0,page:0,index:7,isAutomatable:!0},{id:"v2.filter1.mode",name:"Flt1 Mode",section:Vy,type:Ly,min:0,max:7,defaultValue:1,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:0,isAutomatable:!0},{id:"v2.filter1.cutoff",name:"Flt1 Cutoff",section:Vy,type:Ry,min:0,max:127,defaultValue:127,page:1,index:1,isAutomatable:!0},{id:"v2.filter1.resonance",name:"Flt1 Reso",section:Vy,type:Ry,min:0,max:127,defaultValue:0,page:1,index:2,isAutomatable:!0},{id:"v2.filter2.mode",name:"Flt2 Mode",section:Vy,type:Ly,min:0,max:7,defaultValue:0,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:3,isAutomatable:!0},{id:"v2.filter2.cutoff",name:"Flt2 Cutoff",section:Vy,type:Ry,min:0,max:127,defaultValue:127,page:1,index:4,isAutomatable:!0},{id:"v2.filter2.resonance",name:"Flt2 Reso",section:Vy,type:Ry,min:0,max:127,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"v2.routing.mode",name:"Routing",section:Vy,type:Ly,min:0,max:2,defaultValue:0,valueStrings:["Single","Serial","Parallel"],page:1,index:6,isAutomatable:!0},{id:"v2.routing.balance",name:"Balance",section:Vy,type:Ry,min:0,max:127,defaultValue:64,page:1,index:7,isAutomatable:!0},{id:"v2.envelope.attack",name:"Amp Attack",section:zy,type:Ry,min:0,max:127,defaultValue:0,page:2,index:0,isAutomatable:!0},{id:"v2.envelope.decay",name:"Amp Decay",section:zy,type:Ry,min:0,max:127,defaultValue:64,page:2,index:1,isAutomatable:!0},{id:"v2.envelope.sustain",name:"Amp Sustain",section:zy,type:Ry,min:0,max:127,defaultValue:127,page:2,index:2,isAutomatable:!0},{id:"v2.envelope.release",name:"Amp Release",section:zy,type:Ry,min:0,max:127,defaultValue:32,page:2,index:3,isAutomatable:!0},{id:"v2.envelope2.attack",name:"Env2 Attack",section:zy,type:Ry,min:0,max:127,defaultValue:0,page:2,index:4,isAutomatable:!0},{id:"v2.envelope2.decay",name:"Env2 Decay",section:zy,type:Ry,min:0,max:127,defaultValue:64,page:2,index:5,isAutomatable:!0},{id:"v2.lfo1.rate",name:"LFO Rate",section:Uy,type:Ry,min:0,max:127,defaultValue:64,page:2,index:6,isAutomatable:!0},{id:"v2.lfo1.depth",name:"LFO Depth",section:Uy,type:Ry,min:0,max:127,defaultValue:0,page:2,index:7,isAutomatable:!0}],Sam:[{id:"sam.speed",name:"Speed",section:By,type:Ry,min:20,max:200,defaultValue:72,page:0,index:0,isAutomatable:!0},{id:"sam.pitch",name:"Pitch",section:By,type:Ry,min:20,max:200,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"sam.mouth",name:"Mouth",section:By,type:Ry,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"sam.throat",name:"Throat",section:By,type:Ry,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"sam.singMode",name:"Sing Mode",section:By,type:jy,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"sam.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MonoSynth:[{id:"monosynth.oscillator.type",name:"Waveform",section:By,type:Ly,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"monosynth.oscillator.detune",name:"Detune",section:By,type:Dy,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"monosynth.filter.frequency",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"monosynth.filter.Q",name:"Resonance",section:Vy,type:Dy,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"monosynth.filterEnvelope.amount",name:"Flt Env",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"monosynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monosynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.2,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"monosynth.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"monosynth.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:1,index:0,isAutomatable:!0},{id:"monosynth.portamento",name:"Portamento",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"monosynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],DuoSynth:[{id:"duosynth.voice0.oscillator.type",name:"V0 Wave",section:By,type:Ly,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"duosynth.voice0.filter.frequency",name:"V0 Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"duosynth.voice0.filter.Q",name:"V0 Reso",section:Vy,type:Dy,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"duosynth.voice0.envelope.attack",name:"V0 Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"duosynth.voice1.oscillator.type",name:"V1 Wave",section:By,type:Ly,min:0,max:4,defaultValue:2,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:4,isAutomatable:!0},{id:"duosynth.voice1.filter.frequency",name:"V1 Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"duosynth.voice1.filter.Q",name:"V1 Reso",section:Vy,type:Dy,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"duosynth.harmonicity",name:"Harmonicity",section:By,type:Dy,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"duosynth.vibratoRate",name:"Vib Rate",section:Uy,type:Dy,min:0,max:20,defaultValue:5,unit:"Hz",formatString:"%.1f",page:1,index:0,isAutomatable:!0},{id:"duosynth.vibratoAmount",name:"Vib Amount",section:Uy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"duosynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],PolySynth:ag,Synth:ag,FMSynth:[{id:"fmsynth.modulationIndex",name:"Mod Index",section:Ky,type:Dy,min:0,max:100,defaultValue:10,formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"fmsynth.harmonicity",name:"Harmonicity",section:By,type:Dy,min:.5,max:8,defaultValue:1,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.attack",name:"Mod Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.decay",name:"Mod Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.sustain",name:"Mod Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"fmsynth.envelope.attack",name:"Amp Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"fmsynth.envelope.decay",name:"Amp Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"fmsynth.envelope.sustain",name:"Amp Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],AMSynth:[{id:"amsynth.harmonicity",name:"Harmonicity",section:By,type:Dy,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"amsynth.modulationEnvelope.attack",name:"Mod Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"amsynth.modulationEnvelope.decay",name:"Mod Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"amsynth.envelope.attack",name:"Amp Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"amsynth.envelope.decay",name:"Amp Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"amsynth.envelope.sustain",name:"Amp Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"amsynth.envelope.release",name:"Amp Release",section:zy,type:Dy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"amsynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MembraneSynth:[{id:"membranesynth.pitchDecay",name:"Pitch Decay",section:zy,type:Dy,min:0,max:.5,defaultValue:.05,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"membranesynth.octaves",name:"Octaves",section:By,type:Dy,min:.5,max:8,defaultValue:4,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"membranesynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:2,isAutomatable:!0},{id:"membranesynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:.01,max:2,defaultValue:.4,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"membranesynth.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.01,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"membranesynth.envelope.release",name:"Release",section:zy,type:Dy,min:.01,max:2,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"membranesynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],MetalSynth:[{id:"metalsynth.frequency",name:"Frequency",section:By,type:Dy,min:20,max:8e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"metalsynth.harmonicity",name:"Harmonicity",section:By,type:Dy,min:1,max:10,defaultValue:5.1,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"metalsynth.modulationIndex",name:"Mod Index",section:Ky,type:Dy,min:0,max:100,defaultValue:32,formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"metalsynth.resonance",name:"Resonance",section:By,type:Dy,min:0,max:7e3,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"metalsynth.octaves",name:"Octaves",section:By,type:Dy,min:.5,max:4,defaultValue:1.5,formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"metalsynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:5,isAutomatable:!0},{id:"metalsynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:.01,max:4,defaultValue:1.4,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"metalsynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],NoiseSynth:sg,PluckSynth:[{id:"plucksynth.attackNoise",name:"Attack Noise",section:By,type:Dy,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"plucksynth.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.9,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"plucksynth.dampening",name:"Dampening",section:Vy,type:Dy,min:1e3,max:1e4,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"plucksynth.release",name:"Release",section:zy,type:Dy,min:.1,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"plucksynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0}],Sampler:rg,Player:rg,SuperSaw:[{id:"supersaw.detune",name:"Detune",section:By,type:Dy,min:0,max:100,defaultValue:30,unit:"ct",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"supersaw.mix",name:"Mix",section:By,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"supersaw.voices",name:"Voices",section:By,type:Ry,min:1,max:7,defaultValue:7,page:0,index:2,isAutomatable:!0},{id:"supersaw.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:8e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"supersaw.filter.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"supersaw.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"supersaw.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"supersaw.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Organ:[{id:"organ.drawbar1",name:"16'",section:By,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"organ.drawbar2",name:"5 1/3'",section:By,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"organ.drawbar3",name:"8'",section:By,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"organ.drawbar4",name:"4'",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"organ.drawbar5",name:"2 2/3'",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"organ.drawbar6",name:"2'",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"organ.percussion",name:"Percussion",section:By,type:jy,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"organ.vibrato",name:"Vibrato",section:Uy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DrumMachine:[{id:"drummachine.kick.tune",name:"Kick Tune",section:By,type:Dy,min:20,max:200,defaultValue:60,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"drummachine.kick.decay",name:"Kick Decay",section:zy,type:Dy,min:.05,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"drummachine.snare.tune",name:"Snare Tune",section:By,type:Dy,min:100,max:400,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"drummachine.snare.snappy",name:"Snare Snap",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"drummachine.hihat.decay",name:"HiHat Decay",section:zy,type:Dy,min:.01,max:1,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"drummachine.tone",name:"Tone",section:Vy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"drummachine.accent",name:"Accent",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"drummachine.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ChipSynth:[{id:"chipsynth.waveform",name:"Waveform",section:By,type:Ly,min:0,max:4,defaultValue:1,valueStrings:["Square","Pulse25","Pulse12","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"chipsynth.duty",name:"Duty",section:By,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"chipsynth.pitchBend",name:"Pitch Bend",section:By,type:Ry,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:2,isAutomatable:!0},{id:"chipsynth.vibrato",name:"Vibrato",section:Uy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"chipsynth.arpSpeed",name:"Arp Speed",section:Hy,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"chipsynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"chipsynth.envelope.decay",name:"Decay",section:zy,type:Dy,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"chipsynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],PWMSynth:[{id:"pwmsynth.pulseWidth",name:"Pulse Width",section:By,type:Dy,min:.01,max:.99,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"pwmsynth.lfo.rate",name:"LFO Rate",section:Uy,type:Dy,min:.1,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"pwmsynth.lfo.depth",name:"LFO Depth",section:Uy,type:Dy,min:0,max:.49,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"pwmsynth.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"pwmsynth.filter.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"pwmsynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"pwmsynth.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"pwmsynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WobbleBass:[{id:"wobblebass.lfo.rate",name:"Wobble Rate",section:Uy,type:Dy,min:.1,max:20,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"wobblebass.lfo.depth",name:"Wobble Depth",section:Uy,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"wobblebass.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:5e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wobblebass.filter.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.6,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wobblebass.distortion",name:"Distortion",section:Gy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"wobblebass.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wobblebass.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"wobblebass.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],StringMachine:[{id:"stringmachine.ensemble",name:"Ensemble",section:Gy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"stringmachine.detune",name:"Detune",section:By,type:Dy,min:0,max:50,defaultValue:15,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"stringmachine.voices",name:"Voices",section:By,type:Ry,min:2,max:8,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"stringmachine.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:1e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"stringmachine.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:3,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"stringmachine.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"stringmachine.chorus",name:"Chorus",section:Gy,type:Dy,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"stringmachine.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],FormantSynth:[{id:"formantsynth.vowel",name:"Vowel",section:By,type:Ly,min:0,max:4,defaultValue:0,valueStrings:["A","E","I","O","U"],page:0,index:0,isAutomatable:!0},{id:"formantsynth.formant1",name:"Formant 1",section:Vy,type:Dy,min:200,max:2e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"formantsynth.formant2",name:"Formant 2",section:Vy,type:Dy,min:500,max:4e3,defaultValue:1200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"formantsynth.nasality",name:"Nasality",section:By,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"formantsynth.vibrato",name:"Vibrato",section:Uy,type:Dy,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"formantsynth.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"formantsynth.envelope.release",name:"Release",section:zy,type:Dy,min:0,max:3,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"formantsynth.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],GranularSynth:[{id:"granular.grainSize",name:"Grain Size",section:By,type:Dy,min:.01,max:.5,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"granular.overlap",name:"Overlap",section:By,type:Dy,min:.1,max:2,defaultValue:.5,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"granular.playbackRate",name:"Speed",section:By,type:Dy,min:.25,max:4,defaultValue:1,formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"granular.detune",name:"Detune",section:By,type:Ry,min:-1200,max:1200,defaultValue:0,unit:"ct",page:0,index:3,isAutomatable:!0},{id:"granular.drift",name:"Drift",section:Ky,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"granular.reverse",name:"Reverse",section:By,type:jy,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"granular.loop",name:"Loop",section:By,type:jy,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"granular.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Wavetable:[{id:"wavetable.tablePosition",name:"Position",section:By,type:Dy,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"wavetable.morphSpeed",name:"Morph Speed",section:Ky,type:Dy,min:0,max:10,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"wavetable.filter.cutoff",name:"Cutoff",section:Vy,type:Dy,min:20,max:2e4,defaultValue:1e4,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wavetable.filter.resonance",name:"Resonance",section:Vy,type:Dy,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wavetable.envelope.attack",name:"Attack",section:zy,type:Dy,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"wavetable.envelope.decay",name:"Decay",section:zy,type:Dy,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wavetable.envelope.sustain",name:"Sustain",section:zy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"wavetable.volume",name:"Volume",section:Wy,type:Dy,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Buzz3o3:tg,BuzzM3:lg,Buzz4FM2F:og,BuzzDynamite6:lg,BuzzKick:lg,BuzzKickXP:lg,BuzzTrilok:lg,BuzzNoise:sg,BuzzFreqBomb:lg,BuzzDTMF:lg,Buzzmachine:lg,Furnace:og,FurnaceOPN:og,FurnaceOPN2203:og,FurnaceOPNA:og,FurnaceOPNB:og,FurnaceOPNBB:og,FurnaceOPM:og,FurnaceOPL:og,FurnaceOPLL:og,FurnaceOPL4:og,FurnaceOPZ:og,FurnaceY8950:og,FurnaceESFM:og,FurnaceVRC7:og,FurnaceNES:ig,FurnaceGB:ig,FurnacePSG:ig,FurnacePCE:ig,FurnaceSNES:ig,FurnaceVB:ig,FurnaceLynx:ig,FurnaceSWAN:ig,FurnaceNDS:ig,FurnaceGBA:ig,FurnacePOKEMINI:ig,FurnaceVRC6:ig,FurnaceN163:ig,FurnaceFDS:ig,FurnaceMMC5:ig,FurnaceC64:ig,FurnaceSID6581:ig,FurnaceSID8580:ig,FurnaceAY:ig,FurnaceAY8930:ig,FurnaceVIC:ig,FurnacePET:ig,FurnaceSAA:ig,FurnaceTED:ig,FurnaceDAVE:ig,FurnaceVERA:ig,FurnaceSCC:ig,FurnaceTIA:ig,FurnacePOKEY:ig,FurnaceZXBEEPER:ig,FurnaceAMIGA:ig,FurnacePCSPKR:ig,FurnaceSEGAPCM:rg,FurnaceQSOUND:rg,FurnaceES5506:rg,FurnaceRF5C68:rg,FurnaceC140:rg,FurnaceK007232:rg,FurnaceK053260:rg,FurnaceGA20:rg,FurnaceOKI:rg,FurnaceYMZ280B:rg,FurnaceX1_010:rg,FurnaceBUBBLE:rg,FurnaceMULTIPCM:rg,FurnaceMSM6258:rg,FurnaceMSM5232:rg,FurnaceNAMCO:ig,FurnaceSM8521:ig,FurnaceT6W28:ig,FurnaceSUPERVISION:ig,FurnaceUPD1771:ig,FurnacePONG:ig,FurnacePV1000:ig,FurnaceSU:ig,FurnacePOWERNOISE:sg,FurnaceSCVTONE:ig,FurnacePCMDAC:rg,MAMEVFX:og,MAMEDOC:og,MAMERSA:ag,MAMESWP30:og,CZ101:og};function ug(e){return dg[e]||cg}function pg(e){const t=new Map;for(const a of e)t.has(a.page)||t.set(a.page,[]),t.get(a.page).push(a);const n=[];for(const[a,s]of t.entries()){s.sort((e,t)=>e.index-t.index);const e=s.map(e=>e.section),t=new Map;for(const n of e)t.set(n,(t.get(n)||0)+1);let r=e[0],o=0;for(const[n,a]of t.entries())a>o&&(r=n,o=a);n.push({id:`page_${a}`,name:`${r} ${a+1}`,parameters:s})}return n.sort((e,t)=>parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])),n}function hg(e,t){switch(e.type){case jy:return t>=.5?"On":"Off";case Ly:if(e.valueStrings){const n=Math.round(t*(e.valueStrings.length-1));return e.valueStrings[Math.min(n,e.valueStrings.length-1)]||""}return String(Math.round(t));case Ry:return String(Math.round(t*(e.max-e.min)+e.min));default:{const n=t*(e.max-e.min)+e.min,a=e.formatString?e.formatString.replace("%.0f",String(Math.round(n))).replace("%.1f",n.toFixed(1)).replace("%.2f",n.toFixed(2)).replace("%.3f",n.toFixed(3)):n.toFixed(2);return e.unit?`${a}${e.unit}`:a}}}async function mg(e){const t=new DataView(e);let n=0;if(t.getUint32(n,!1)!==$y)throw new Error("Invalid NKSF file: missing magic header");n+=4;const a=t.getUint16(n,!1),s=t.getUint16(n+2,!1);n+=4;const r={vendor:Jy,uuid:eg,version:`${a}.${s}`},o={};let i;for(;n<e.byteLength;){const a=t.getUint32(n,!1),s=t.getUint32(n+4,!0);n+=8;const c=n,d=n+s;switch(a){case qy:{const t=gg(new Uint8Array(e,c,s));try{const e=JSON.parse(t);Object.assign(r,e)}catch(l){}break}case Yy:{const t=new DataView(e,c,s);let n=0;const a=t.getUint32(n,!0);n+=4;for(let s=0;s<a;s++){const a=t.getUint8(n);n+=1;const s=new Uint8Array(e,c+n,a),r=(new TextDecoder).decode(s);n+=a;const i=t.getFloat32(n,!0);n+=4,o[r]=i}break}case Xy:i=e.slice(c,d)}n=d}return{metadata:r,parameters:o,blob:i}}function fg(e){const t=[],n=JSON.stringify(e.metadata),a=(new TextEncoder).encode(n);t.push(yg(qy,a.buffer));const s=Object.entries(e.parameters),r=4+s.reduce((e,[t])=>e+1+t.length+4,0),o=new ArrayBuffer(r),i=new DataView(o);let l=0;i.setUint32(l,s.length,!0),l+=4;for(const[h,m]of s){const e=(new TextEncoder).encode(h);i.setUint8(l,e.length),l+=1,new Uint8Array(o,l,e.length).set(e),l+=e.length,i.setFloat32(l,m,!0),l+=4}t.push(yg(Yy,o)),e.blob&&t.push(yg(Xy,e.blob));const c=8+t.reduce((e,t)=>e+t.byteLength,0),d=new ArrayBuffer(c),u=new DataView(d);let p=0;u.setUint32(p,$y,!1),p+=4,u.setUint16(p,Qy,!1),u.setUint16(p+2,Zy,!1),p+=4;for(const h of t)new Uint8Array(d,p,h.byteLength).set(new Uint8Array(h)),p+=h.byteLength;return d}function yg(e,t){const n=new ArrayBuffer(8+t.byteLength),a=new DataView(n);return a.setUint32(0,e,!1),a.setUint32(4,t.byteLength,!0),new Uint8Array(n,8,t.byteLength).set(new Uint8Array(t)),n}function gg(e){let t=e.indexOf(0);return-1===t&&(t=e.length),(new TextDecoder).decode(e.subarray(0,t))}const vg={Bass:["Bass","Synth Bass"],Lead:["Lead","Synth Lead"],Pad:["Pad","Ambient"],Drum:["Drums","Electronic"],FX:["FX","Sound Design"],User:["User","Custom"]};function bg(e){const t=e[0]?.toLowerCase()||"";return t.includes("bass")?"Bass":t.includes("lead")?"Lead":t.includes("pad")||t.includes("ambient")?"Pad":t.includes("drum")||t.includes("perc")?"Drum":t.includes("fx")||t.includes("effect")?"FX":"User"}function xg(e,t){const n=[];return e&&n.push(...e.map(e=>e.toLowerCase())),t&&n.push(...t.map(e=>e.toLowerCase())),[...new Set(n)]}function wg(e,t){const n=e.synthType,a=function(e,t){const n={},a=e.synthType.toLowerCase();for(const s of t){const t=s.id.replace(`${a}.`,"").split(".");let r=e;const o=e[a];o&&"object"==typeof o&&(r=o);for(const n of t){if(!r||"object"!=typeof r||!(n in r)){if("cutoff"===n&&void 0!==e.filter?.frequency){r=e.filter.frequency;break}if("resonance"===n&&void 0!==e.filter?.Q){r=e.filter.Q;break}if("attack"===n&&void 0!==e.envelope?.attack){r=e.envelope.attack;break}if("decay"===n&&void 0!==e.envelope?.decay){r=e.envelope.decay;break}if("sustain"===n&&void 0!==e.envelope?.sustain){r=e.envelope.sustain;break}if("release"===n&&void 0!==e.envelope?.release){r=e.envelope.release;break}r=void 0;break}r=r[n]}if("number"==typeof r){const e=(r-s.min)/(s.max-s.min);n[s.id]=Math.max(0,Math.min(1,e))}else if("boolean"==typeof r)n[s.id]=r?1:0;else if("string"==typeof r&&s.valueStrings){const e=s.valueStrings.indexOf(r);n[s.id]=-1!==e?e/Math.max(1,s.valueStrings.length-1):s.defaultValue}else n[s.id]=s.defaultValue}return n}(e,ug(n)),{types:s,modes:r}=function(e){const t=[],n=[],a=["bass","lead","pad","drum","fx","synth","keys","strings","brass","vocal"],s=["mono","poly","analog","digital","fm","wavetable","granular","acoustic","electric"];for(const r of e){const e=r.toLowerCase();a.some(t=>e.includes(t))?t.push(r.charAt(0).toUpperCase()+r.slice(1)):s.some(t=>e.includes(t))&&n.push(r.charAt(0).toUpperCase()+r.slice(1))}return{types:t,modes:n}}(t?.tags||[]),o=t?.category?vg[t.category]:["User",e.synthType];return{metadata:{vendor:Jy,uuid:eg,version:"1.0",name:t?.name||e.name,author:t?.author||"DEViLBOX User",comment:t?.comment||`${n} preset for DEViLBOX`,deviceType:"INST",bankChain:o,types:s.length>0?s:[n],modes:r.length>0?r:void 0,isUser:!0},parameters:a,blob:(new TextEncoder).encode(JSON.stringify(e)).buffer}}function kg(e,t,n){if(e.blob)try{const n=(new TextDecoder).decode(new Uint8Array(e.blob)),a=JSON.parse(n);if(a.synthType)return{...a,id:t,name:e.metadata.name||a.name||"NKS Preset"}}catch{}const a=n||function(e){const t=e.bankChain.join(" ").toLowerCase(),n=(e.types||[]).join(" ").toLowerCase(),a=(e.comment||"").toLowerCase(),s=`${t} ${n} ${a}`;return s.includes("tb303")||s.includes("303")?"TB303":s.includes("tb808")||s.includes("808")?"DrumMachine":s.includes("dub siren")||s.includes("dubsiren")?"DubSiren":s.includes("space laser")||s.includes("spacelaser")?"SpaceLaser":s.includes("fm")||s.includes("dexed")?"FMSynth":s.includes("wavetable")?"Wavetable":s.includes("granular")?"GranularSynth":s.includes("mono")?"MonoSynth":s.includes("poly")?"PolySynth":s.includes("membrane")||s.includes("kick")?"MembraneSynth":s.includes("metal")||s.includes("hihat")||s.includes("cymbal")?"MetalSynth":s.includes("pluck")?"PluckSynth":s.includes("noise")?"NoiseSynth":s.includes("am ")?"AMSynth":s.includes("duo")?"DuoSynth":null}(e.metadata)||"Synth",s=ug(a),r={id:t,name:e.metadata.name||"NKS Preset",type:"synth",synthType:a,effects:[],volume:-6,pan:0};return function(e,t,n){const a=e.synthType.toLowerCase(),s={};for(const r of n){const n=t[r.id];if(void 0===n)continue;const o=n*(r.max-r.min)+r.min,i=r.id.replace(`${a}.`,""),l=i.split(".");let c=s;for(let e=0;e<l.length-1;e++)l[e]in c||(c[l[e]]={}),c=c[l[e]];const d=l[l.length-1];if(r.valueStrings&&r.valueStrings.length>0){const e=Math.round(n*(r.valueStrings.length-1));c[d]=r.valueStrings[Math.min(e,r.valueStrings.length-1)]}else 2===r.type?c[d]=n>=.5:c[d]=o;"cutoff"!==d&&"frequency"!==d||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.frequency=o),"resonance"!==d&&"Q"!==d||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.Q=o),"attack"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.attack=o),"decay"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.decay=o),"sustain"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.sustain=o),"release"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.release=o)}Object.keys(s).length>0&&(e[a]=s)}(r,e.parameters,s),r}function Sg(e){return wg({id:0,...e.config},{name:e.name,category:e.category,tags:e.tags})}function Mg(e,t){const n=kg(e,0,t),{id:a,...s}=n;return{name:e.metadata.name||"NKS Preset",category:bg(e.metadata.bankChain),synthType:n.synthType,tags:xg(e.metadata.types,e.metadata.modes),config:s}}function Ng(e,t){const n=fg(wg(e,t)),a=new Blob([n],{type:"application/octet-stream"}),s=URL.createObjectURL(a),r=`${t?.name||e.name||"preset"}.nksf`,o=document.createElement("a");o.href=s,o.download=r,o.click(),URL.revokeObjectURL(s)}const Cg=a()(Qh(Fn((e,t)=>({userPresets:[],recentPresetIds:[],savePreset:(t,n,a,s=[])=>{const r=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return e(e=>{const o={id:r,name:n,category:a,synthType:t.synthType,tags:s,createdAt:Date.now(),updatedAt:Date.now(),config:{name:t.name,type:t.type,synthType:t.synthType,oscillator:t.oscillator,envelope:t.envelope,filter:t.filter,filterEnvelope:t.filterEnvelope,tb303:t.tb303,wavetable:t.wavetable,effects:t.effects?[...t.effects]:[],volume:t.volume,pan:t.pan,parameters:t.parameters}};e.userPresets.push(o)}),r},deletePreset:t=>e(e=>{const n=e.userPresets.findIndex(e=>e.id===t);-1!==n&&e.userPresets.splice(n,1);const a=e.recentPresetIds.indexOf(t);-1!==a&&e.recentPresetIds.splice(a,1)}),updatePreset:(t,n)=>e(e=>{const a=e.userPresets.find(e=>e.id===t);a&&(Object.assign(a,n),a.updatedAt=Date.now())}),getPreset:e=>t().userPresets.find(t=>t.id===e),getPresetsByCategory:e=>t().userPresets.filter(t=>t.category===e),getPresetsBySynthType:e=>t().userPresets.filter(t=>t.synthType===e),addToRecent:t=>e(e=>{const n=e.recentPresetIds.indexOf(t);-1!==n&&e.recentPresetIds.splice(n,1),e.recentPresetIds.unshift(t),e.recentPresetIds.length>10&&e.recentPresetIds.pop()}),clearRecent:()=>e(e=>{e.recentPresetIds=[]}),importPresets:t=>e(e=>{t.forEach(t=>{const n=e.userPresets.findIndex(e=>e.id===t.id);-1!==n?e.userPresets[n]=t:e.userPresets.push(t)})}),exportPresets:()=>t().userPresets,exportPresetAsNKSF:e=>{const n=t().getPreset(e);if(n)try{const e=fg(Sg(n)),t=new Blob([e],{type:"application/octet-stream"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`${n.name}.nksf`,s.click(),URL.revokeObjectURL(a)}catch(a){}},exportAllPresetsAsNKSF:e=>{const n=t().userPresets;if(0!==n.length)try{const t=function(e,t){return e.map(e=>{const n=Sg(e);return t&&(n.metadata.author=t),{filename:`${e.name}.nksf`,buffer:fg(n)}})}(n,e);t.forEach((e,t)=>{setTimeout(()=>{const t=new Blob([e.buffer],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e.filename,a.click(),URL.revokeObjectURL(n)},100*t)})}catch(a){}},importNKSFFiles:async t=>{const n=[];try{const a=await async function(e){const t=[];for(const a of e)try{const e=await a.arrayBuffer(),n=await mg(e);t.push(Mg(n))}catch(n){}return t}(t);for(const t of a){const a=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e(e=>{const n={id:a,...t,createdAt:Date.now(),updatedAt:Date.now()};e.userPresets.push(n)}),n.push(a)}}catch(a){}return n}})),{name:"devilbox-user-presets",version:1})),Eg="356",Pg="ddecc91",Tg=`1.0.1.${Eg}`,Ag=[{version:"1.0.1",date:"2026-02-09",changes:[{type:"fix",description:"Use absolute paths for worklet/wasm loading on GitHub Pages"},{type:"fix",description:"Test page uses direct worklet loading + correct case-sensitive filenames"},{type:"fix",description:"Test page now uses direct worklet loading instead of TypeScript imports"},{type:"fix",description:"Tracker knobs now update live synth + improve test page tracking params"},{type:"feature",description:"Comprehensive parameter testing with smoothing, retrigger, and auto-setup"},{type:"feature",description:"Complete DB303 synth overhaul with full parameter test suite"},{type:"improvement",description:"Update changelog and minor UI refinements"},{type:"improvement",description:"303 UI improvements: full-width responsive layout with collapsible sections"},{type:"fix",description:"Rebrand file formats: .dbx for songs, .dbi for instruments + fix speech synth singing modes"},{type:"improvement",description:"Optimize engine and shared control components"},{type:"improvement",description:"Optimize effect and specialty synth controls"},{type:"improvement",description:"Add refs to high-complexity synth controls"},{type:"improvement",description:"Prevent knob handler re-creation with refs"},{type:"fix",description:"Eliminate stale state bug preventing first drag response"},{type:"fix",description:"Chore: Add demo channel fix script and update build"},{type:"fix",description:"Improve VU meter timing and visibility"},{type:"feature",description:"Add ProTracker-style status messages"},{type:"feature",description:"Add ghost patterns and automation integration"},{type:"feature",description:"Update visualizer integration and logo animation"},{type:"feature",description:"Add classic demoscene sine scroller with starfield"},{type:"feature",description:"Add 5 per-channel visualizers"},{type:"feature",description:"Add 3 new global audio visualizers"},{type:"feature",description:"Add mouse interaction to automation lanes"}]},{version:"2026-02-08",date:"2026-02-08",changes:[{type:"feature",description:"Add automation lane to tracker channels"},{type:"fix",description:"Resolve WASM loading errors and update synth implementations"},{type:"improvement",description:"Implement authentic ProTracker status messages in pattern header"},{type:"improvement",description:"Implement collapsible sections for cleaner vertical layout"},{type:"improvement",description:"Expand TB-303 panel dimensions and optimize control spacing"},{type:"fix",description:"Optimize FT2 toolbar layout to prevent horizontal overflow"},{type:"fix",description:"Correct position and pattern order management in toolbar"},{type:"improvement",description:"Fix white dividers in groove settings modal"},{type:"improvement",description:"Move groove controls to dedicated settings modal and simplify toolbar"},{type:"feature",description:"Enhance groove templates with velocity dynamics"},{type:"feature",description:"Implement adjustable groove cycle duration and immediate re-sync"},{type:"fix",description:"Remove unused tickLoop property"},{type:"feature",description:"Add manual swing amount control to groove menu"},{type:"fix",description:"Implement sample-accurate groove and swing for 303 synths"},{type:"improvement",description:"Fix groove menu dividers and cleanup unused imports"},{type:"improvement",description:"Comprehensive FT2 panel cleanup and reorganization"},{type:"fix",description:"Resolve AmigaFilter InvalidStateError and optimize 303 timing"},{type:"improvement",description:"Comprehensive tracker optimization (memoization, jank fixes, and UI smoothing)"}]},{version:"2026-02-07",date:"2026-02-07",changes:[{type:"improvement",description:"Chore: update song files with latest format and improvements"},{type:"improvement",description:"Chore: update generated changelog and Open303 worklet"},{type:"improvement",description:"Improve engine systems and pattern handling"},{type:"improvement",description:"Consolidate tracker cells into unified FlagCell component"},{type:"feature",description:"Enhance DB303/TB303 pattern system with XML patterns and improved conversion"},{type:"feature",description:"Complete drum pad system Phase 3 & 4 improvements"},{type:"feature",description:"Refactor drum pad kit loading to integrate with instrument system"},{type:"improvement",description:"Add drum pad Phase 2 completion documentation"},{type:"fix",description:"Improve ROM archive ignore pattern"}]}],Ig=Tg,_g=Tg,Og=({label:e,devices:t,selectedId:n,onSelect:a,disabled:s=!1})=>{const r=t.find(e=>e.id===n);return bn.jsxs("div",{className:"space-y-1",children:[bn.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:e}),bn.jsxs("div",{className:"relative",children:[bn.jsxs("select",{value:n||"",onChange:e=>a(e.target.value||null),disabled:s,className:`\n            w-full px-3 py-2 pr-8 rounded-md text-sm\n            bg-dark-bgTertiary border border-dark-border\n            text-text-primary appearance-none cursor-pointer\n            hover:border-dark-borderLight focus:border-accent-primary focus:outline-none\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${r?.isTD3?"border-accent-success/50":""}\n          `,children:[bn.jsx("option",{value:"",children:"No device"}),t.map(e=>bn.jsxs("option",{value:e.id,children:[e.isTD3?" ":"",e.name,e.manufacturer?` (${e.manufacturer})`:""]},e.id))]}),bn.jsx(Ce,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"})]}),r?.isTD3&&bn.jsxs("div",{className:"flex items-center gap-1 text-xs text-accent-success",children:[bn.jsx(Ee,{size:12}),bn.jsx("span",{children:"TD-3 detected"})]})]})};function Fg(){const[e,t]=s.useState([]),[n,a]=s.useState(!1),[r,o]=s.useState(!1),[i,l]=s.useState(null),c=s.useRef(null),d=s.useRef(null),u=s.useRef(new Set);s.useEffect(()=>{a("requestMIDIAccess"in navigator)},[]);const p=s.useCallback(e=>{const t=function(e){if(e.length<1)return{type:"unknown",channel:0,raw:e};const[t,n=0,a=0]=e,s=15&t;switch(t>>4&15){case 9:return{type:a>0?"noteon":"noteoff",channel:s,note:n,velocity:a,raw:e};case 8:return{type:"noteoff",channel:s,note:n,velocity:a,raw:e};case 11:return{type:"cc",channel:s,controller:n,value:a,raw:e};case 14:return{type:"pitchbend",channel:s,value:a<<7|n,raw:e};case 13:return{type:"aftertouch",channel:s,value:n,raw:e};default:return{type:"unknown",channel:s,raw:e}}}(e.data);l(t),u.current.forEach(e=>{e(t)})},[]),h=s.useCallback(e=>{const n=[];e.inputs.forEach(e=>{n.push({id:e.id,name:e.name||"Unknown Device",manufacturer:e.manufacturer||"Unknown",state:e.state})}),t(n)},[]),m=s.useCallback(async()=>{if(!n)throw new Error("Web MIDI API not supported in this browser");if(!r)try{const e=await navigator.requestMIDIAccess();c.current=e,e.inputs.forEach(e=>{e.addEventListener("midimessage",p)});const t=()=>{h(e),e.inputs.forEach(e=>{e.removeEventListener("midimessage",p),e.addEventListener("midimessage",p)})};d.current=t,e.addEventListener("statechange",t),h(e),o(!0)}catch(e){throw e}},[n,r,p,h]),f=s.useCallback(()=>{c.current&&(c.current.inputs.forEach(e=>{e.removeEventListener("midimessage",p)}),d.current&&(c.current.removeEventListener("statechange",d.current),d.current=null),c.current=null),o(!1),t([]),l(null)},[p]),y=s.useCallback(e=>(u.current.add(e),()=>{u.current.delete(e)}),[]);return s.useEffect(()=>()=>{f()},[f]),{devices:e,isSupported:n,isEnabled:r,lastMessage:i,enableMIDI:m,disableMIDI:f,onMessage:y}}const Dg={1:{mode:92,cc:93,min:94,max:95,name:96},2:{mode:112,cc:113,min:114,max:115,name:116},3:{mode:132,cc:133,min:134,max:135,name:136},4:{mode:152,cc:153,min:154,max:155,name:156},5:{mode:172,cc:173,min:174,max:175,name:176},6:{mode:192,cc:193,min:194,max:195,name:196},7:{mode:212,cc:213,min:214,max:215,name:216},8:{mode:232,cc:233,min:234,max:235,name:236}};class Rg{static instance=null;currentPreset=null;deviceName=null;constructor(){}static getInstance(){return Rg.instance||(Rg.instance=new Rg),Rg.instance}checkConnection(){const e=cy().getInputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return this.deviceName=t.name||"MPK Mini",!0}return this.deviceName=null,!1}getDeviceName(){return this.deviceName}createDefaultPreset(){const e=new Uint8Array(246);e[0]=0;const t=this.stringToBytes("DEViLBOX       ",16);e.set(t,1),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let n=1;n<=8;n++){const t=Dg[n];e[t.mode-7]=0,e[t.cc-7]=70+n-1,e[t.min-7]=0,e[t.max-7]=127;const a=`Knob ${n}        `,s=this.stringToBytes(a,16);e.set(s,t.name-7)}return e}stringToBytes(e,t){const n=new Uint8Array(t);for(let a=0;a<t;a++)a<e.length?n[a]=Math.min(127,e.charCodeAt(a)):n[a]=32;return n}buildSysExMessage(e){const t=e.length,n=t>>7&127,a=127&t,s=new Uint8Array(7+e.length+1);return s[0]=240,s[1]=71,s[2]=127,s[3]=73,s[4]=100,s[5]=n,s[6]=a,s.set(e,7),s[s.length-1]=247,s}findMPKMiniOutputId(){const e=cy().getOutputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return t.id}return null}async sendSysEx(e){const t=cy(),n=this.findMPKMiniOutputId();if(!n)return!1;const a=t.getSelectedOutput(),s=a?.id||null;try{return t.selectOutput(n),t.sendSysEx(e),s&&s!==n&&t.selectOutput(s),!0}catch(r){if(s)try{t.selectOutput(s)}catch{}return!1}}async setKnobName(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=Dg[e],a=this.stringToBytes(t,16);this.currentPreset.set(a,n.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async setKnobNames(e){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());for(const[n,a]of Object.entries(e)){const e=parseInt(n);if(e>=1&&e<=8){const t=Dg[e],n=this.stringToBytes(a,16);this.currentPreset.set(n,t.name-7)}}const t=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(t)}async setKnobConfig(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=Dg[e];void 0!==t.mode&&(this.currentPreset[n.mode-7]="relative"===t.mode?1:0),void 0!==t.cc&&(this.currentPreset[n.cc-7]=127&t.cc),void 0!==t.min&&(this.currentPreset[n.min-7]=127&t.min),void 0!==t.max&&(this.currentPreset[n.max-7]=127&t.max);const a=this.stringToBytes(t.name,16);this.currentPreset.set(a,n.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async applyDEViLBOXPreset(){return this.setKnobNames({1:"Cutoff",2:"Resonance",3:"Env Mod",4:"Decay",5:"Accent",6:"Overdrive",7:"Slide Time",8:"Filter FM"})}async resetKnobNames(){this.currentPreset=this.createDefaultPreset();const e=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(e)}}function jg(){return Rg.getInstance()}const Lg={"transport.play":{label:"Play",category:"Transport"},"transport.stop":{label:"Stop",category:"Transport"},"transport.pause":{label:"Pause",category:"Transport"},"transport.record":{label:"Record",category:"Transport"},"transport.loop":{label:"Toggle Loop",category:"Transport"},"nav.patternUp":{label:"Pattern Up",category:"Navigation"},"nav.patternDown":{label:"Pattern Down",category:"Navigation"},"nav.positionUp":{label:"Song Position Up",category:"Navigation"},"nav.positionDown":{label:"Song Position Down",category:"Navigation"},"nav.rowUp":{label:"Row Up",category:"Navigation"},"nav.rowDown":{label:"Row Down",category:"Navigation"},"nav.toStart":{label:"Go to Start",category:"Navigation"},"nav.toEnd":{label:"Go to End",category:"Navigation"},"edit.octaveUp":{label:"Octave Up",category:"Editing"},"edit.octaveDown":{label:"Octave Down",category:"Editing"},"edit.instrumentUp":{label:"Instrument Up",category:"Editing"},"edit.instrumentDown":{label:"Instrument Down",category:"Editing"},"edit.undo":{label:"Undo",category:"Editing"},"edit.redo":{label:"Redo",category:"Editing"},"edit.copy":{label:"Copy",category:"Editing"},"edit.paste":{label:"Paste",category:"Editing"},"edit.delete":{label:"Delete",category:"Editing"},"edit.insertRow":{label:"Insert Row",category:"Editing"},"edit.deleteRow":{label:"Delete Row",category:"Editing"},"channel.mute1":{label:"Mute Ch 1",category:"Channels"},"channel.mute2":{label:"Mute Ch 2",category:"Channels"},"channel.mute3":{label:"Mute Ch 3",category:"Channels"},"channel.mute4":{label:"Mute Ch 4",category:"Channels"},"channel.mute5":{label:"Mute Ch 5",category:"Channels"},"channel.mute6":{label:"Mute Ch 6",category:"Channels"},"channel.mute7":{label:"Mute Ch 7",category:"Channels"},"channel.mute8":{label:"Mute Ch 8",category:"Channels"},"channel.solo1":{label:"Solo Ch 1",category:"Channels"},"channel.solo2":{label:"Solo Ch 2",category:"Channels"},"channel.solo3":{label:"Solo Ch 3",category:"Channels"},"channel.solo4":{label:"Solo Ch 4",category:"Channels"},"pattern.new":{label:"New Pattern",category:"Pattern"},"pattern.clone":{label:"Clone Pattern",category:"Pattern"},"pattern.delete":{label:"Delete Pattern",category:"Pattern"},"view.toggleEditor":{label:"Toggle Editor",category:"View"},"view.toggleMixer":{label:"Toggle Mixer",category:"View"}},Bg={"tb303.cutoff":{label:"Cutoff",min:200,max:5e3,category:"303 Main"},"tb303.resonance":{label:"Resonance",min:0,max:100,category:"303 Main"},"tb303.envMod":{label:"Env Mod",min:0,max:100,category:"303 Main"},"tb303.decay":{label:"Decay",min:200,max:2e3,category:"303 Main"},"tb303.accent":{label:"Accent",min:0,max:100,category:"303 Main"},"tb303.slideTime":{label:"Slide Time",min:2,max:360,category:"303 Main"},"tb303.overdrive":{label:"Overdrive",min:0,max:100,category:"303 Main"},"tb303.normalDecay":{label:"Normal Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.accentDecay":{label:"Accent Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.softAttack":{label:"Soft Attack",min:.3,max:30,category:"Devil Fish"},"tb303.vegSustain":{label:"VEG Sustain",min:0,max:100,category:"Devil Fish"},"tb303.filterFM":{label:"Filter FM",min:0,max:100,category:"Devil Fish"},"tb303.filterTracking":{label:"Key Track",min:0,max:200,category:"Devil Fish"}},Vg=[{id:"akai-mpk-mini-mk3",name:"MPK Mini MK3",manufacturer:"Akai",detectPatterns:["mpk mini","mpk mini mk3","mpkmini"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime"}}},{id:"akai-mpk-mini-plus",name:"MPK Mini Plus",manufacturer:"Akai",detectPatterns:["mpk mini plus","mpkminiplus"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1}}},{id:"novation-launchkey-mini-mk3",name:"Launchkey Mini MK3",manufacturer:"Novation",detectPatterns:["launchkey mini","launchkey"],knobs:[{cc:21,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:22,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:23,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:24,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:25,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:26,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:27,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:28,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"},{note:44,name:"Pad 9"},{note:45,name:"Pad 10"},{note:46,name:"Pad 11"},{note:47,name:"Pad 12"},{note:48,name:"Pad 13"},{note:49,name:"Pad 14"},{note:50,name:"Pad 15"},{note:51,name:"Pad 16"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}},{id:"arturia-minilab-3",name:"MiniLab 3",manufacturer:"Arturia",detectPatterns:["minilab","arturia minilab"],knobs:[{cc:74,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:71,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:76,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:77,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:93,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:73,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:75,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:114,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:85,name:"Fader 1"},{cc:86,name:"Fader 2"},{cc:87,name:"Fader 3"},{cc:88,name:"Fader 4"}]}},{id:"korg-nanokontrol2",name:"nanoKONTROL2",manufacturer:"Korg",detectPatterns:["nanokontrol","nano kontrol","korg nano"],knobs:[{cc:16,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:17,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:18,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:19,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:20,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:21,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:22,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:23,name:"Knob 8"}],pads:[{cc:32,name:"S1",defaultMapping:"channel.solo1"},{cc:33,name:"S2",defaultMapping:"channel.solo2"},{cc:34,name:"S3",defaultMapping:"channel.solo3"},{cc:35,name:"S4",defaultMapping:"channel.solo4"},{cc:48,name:"M1",defaultMapping:"channel.mute1"},{cc:49,name:"M2",defaultMapping:"channel.mute2"},{cc:50,name:"M3",defaultMapping:"channel.mute3"},{cc:51,name:"M4",defaultMapping:"channel.mute4"},{cc:64,name:"R1"},{cc:65,name:"R2"},{cc:66,name:"R3"},{cc:67,name:"R4"},{cc:41,name:"Play",defaultMapping:"transport.play"},{cc:42,name:"Stop",defaultMapping:"transport.stop"},{cc:43,name:"Rewind",defaultMapping:"nav.toStart"},{cc:44,name:"Forward",defaultMapping:"nav.toEnd"},{cc:45,name:"Record",defaultMapping:"transport.record"},{cc:46,name:"Cycle",defaultMapping:"transport.loop"}],extras:{faders:[{cc:0,name:"Fader 1"},{cc:1,name:"Fader 2"},{cc:2,name:"Fader 3"},{cc:3,name:"Fader 4"},{cc:4,name:"Fader 5"},{cc:5,name:"Fader 6"},{cc:6,name:"Fader 7"},{cc:7,name:"Fader 8"}]}},{id:"behringer-xtouch-mini",name:"X-Touch Mini",manufacturer:"Behringer",detectPatterns:["x-touch","xtouch","behringer x-touch"],knobs:[{cc:1,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:2,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:3,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:4,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:5,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:6,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:7,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:8,name:"Encoder 8"}],pads:[{note:0,name:"Button 1",defaultMapping:"transport.play"},{note:1,name:"Button 2",defaultMapping:"transport.stop"},{note:2,name:"Button 3",defaultMapping:"transport.record"},{note:3,name:"Button 4",defaultMapping:"transport.loop"},{note:4,name:"Button 5"},{note:5,name:"Button 6"},{note:6,name:"Button 7"},{note:7,name:"Button 8"},{note:8,name:"Button 9"},{note:9,name:"Button 10"},{note:10,name:"Button 11"},{note:11,name:"Button 12"},{note:12,name:"Button 13"},{note:13,name:"Button 14"},{note:14,name:"Button 15"},{note:15,name:"Button 16"}],extras:{faders:[{cc:9,name:"Fader"}]}},{id:"generic",name:"Generic MIDI Controller",manufacturer:"Unknown",detectPatterns:[],knobs:[{cc:1,name:"CC 1"},{cc:7,name:"CC 7 (Volume)"},{cc:10,name:"CC 10 (Pan)"},{cc:11,name:"CC 11 (Expression)"},{cc:74,name:"CC 74 (Cutoff)"},{cc:71,name:"CC 71 (Resonance)"}],pads:[],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}}];function zg(e){const t=e.toLowerCase();for(const n of Vg)for(const e of n.detectPatterns)if(t.includes(e.toLowerCase()))return n;return null}const Ug=({isOpen:e,onClose:t})=>{const{devices:n,isSupported:a,isEnabled:r,lastMessage:o,enableMIDI:i}=Fg(),l=uy(),c=Df(e=>e.instruments);s.useEffect(()=>{e&&r&&l.init()},[e,r,l]);const[d,u]=s.useState("devices"),[p,h]=s.useState(null),[m,f]=s.useState(null),[y,g]=s.useState(!1),[v,b]=s.useState(null),[x,w]=s.useState([]),[k,S]=s.useState(new Set(["Transport","303 Main"])),[M,N]=s.useState(l.getGlobalSensitivity()),[C,E]=s.useState(!1),[P,T]=s.useState("idle"),[A,I]=s.useState(l.getControlledInstrument());s.useEffect(()=>l.onControlledInstrumentChange(e=>{I(e)}),[l]);const _=s.useCallback(e=>{l.setControlledInstrument(e),I(e)},[l]);s.useEffect(()=>{if(r&&n.length>0){const e=jg();E(e.checkConnection())}},[r,n]);const O=s.useCallback(async()=>{const e=jg();if(!e.checkConnection())return void T("error");T("syncing");const t={},n={70:1,71:2,72:3,73:4,74:5,75:6,76:7,77:8};x.forEach(e=>{const a=n[e.ccNumber];a&&e.displayName&&(t[a]=e.displayName.substring(0,16))});try{const n=await e.setKnobNames(t);T(n?"success":"error"),n&&setTimeout(()=>T("idle"),2e3)}catch{T("error")}},[x]),F=s.useCallback(async()=>{const e=jg();T("syncing");try{const t=await e.applyDEViLBOXPreset();T(t?"success":"error"),t&&setTimeout(()=>T("idle"),2e3)}catch{T("error")}},[]),D=s.useCallback(()=>{w(l.getAllMappings())},[l]);s.useEffect(()=>{if(n.length>0){const e=zg(n[0].name||"");h(e),e&&!m&&f(e)}},[n,m]),s.useEffect(()=>(D(),l.onMappingChange(D)),[l,D]),s.useEffect(()=>{if(!y||!v)return;return l.onLearnChange((e,t)=>{e||(g(!1),b(null),D())})},[y,v,l,D]);const R=async e=>{g(!0),b(e);const t=await l.startLearn(0,e.id,e.label,"parameter"===e.type?e.min:0,"parameter"===e.type?e.max:127,"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear");t&&l.setMapping({id:`${t.channel}-${t.ccNumber}-${e.id}`,ccNumber:t.ccNumber,midiChannel:t.channel,instrumentId:0,parameterPath:e.id,min:"parameter"===e.type?e.min:0,max:"parameter"===e.type?e.max:127,curve:"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear",displayName:e.label}),g(!1),b(null)},j=()=>{m&&(m.knobs.forEach(e=>{if(e.defaultMapping){const t=Bg[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:t.min,max:t.max,curve:e.defaultMapping.includes("cutoff")?"logarithmic":"linear",displayName:t.label})}}),m.pads.forEach(e=>{if(e.defaultMapping&&void 0!==e.cc){const t=Lg[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:0,max:127,curve:"linear",displayName:t.label})}}),D())},L=()=>{l.clearAllMappings(),D()},B=e=>{S(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},V=e=>x.some(t=>t.parameterPath===e),z=e=>x.find(t=>t.parameterPath===e);if(!e)return null;const U=Object.entries(Bg).reduce((e,[t,n])=>{const a=n.category;return e[a]||(e[a]=[]),e[a].push({id:t,...n}),e},{}),G=Object.entries(Lg).reduce((e,[t,n])=>{const a=n.category;return e[a]||(e[a]=[]),e[a].push({id:t,...n}),e},{});return bn.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:bn.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] max-h-[85vh] flex flex-col",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[bn.jsxs("h2",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[bn.jsx(Pe,{size:20}),"MIDI Controller Setup"]}),bn.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors",children:bn.jsx(Te,{size:20})})]}),y&&v&&bn.jsxs("div",{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-10 rounded-lg",children:[bn.jsx(Ae,{size:48,className:"text-accent-primary animate-spin mb-4"}),bn.jsx("p",{className:"text-text-primary text-lg mb-2",children:"Move a controller to map to:"}),bn.jsx("p",{className:"text-accent-primary text-xl font-bold mb-4",children:v.label}),o&&"cc"===o.type&&bn.jsxs("p",{className:"text-text-muted text-sm mb-4",children:["Last: CH",o.channel+1," CC",o.controller," = ",o.value]}),bn.jsx("button",{onClick:()=>{l.cancelLearn(),g(!1),b(null)},className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Cancel"})]}),bn.jsx("div",{className:"flex border-b border-dark-border",children:[{id:"devices",label:"Devices",icon:Pe},{id:"parameters",label:"TB-303",icon:Ie},{id:"actions",label:"Tracker",icon:_e},{id:"mappings",label:"Mappings",icon:Oe},{id:"settings",label:"Settings",icon:Fe}].map(e=>bn.jsxs("button",{onClick:()=>u(e.id),className:`\n                flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors\n                ${d===e.id?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"}\n              `,children:[bn.jsx(e.icon,{size:16}),e.label]},e.id))}),bn.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["devices"===d&&bn.jsx("div",{className:"space-y-4",children:a?r?0===n.length?bn.jsxs("div",{className:"text-center py-8",children:[bn.jsx(Pe,{size:48,className:"mx-auto text-text-muted mb-4"}),bn.jsx("p",{className:"text-text-secondary",children:"No MIDI devices detected"}),bn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Connect a MIDI controller and refresh"})]}):bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Connected Devices"}),bn.jsx("div",{className:"space-y-2",children:n.map(e=>bn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded p-3",children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("span",{className:"w-3 h-3 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),bn.jsxs("div",{children:[bn.jsx("div",{className:"text-text-primary font-medium",children:e.name}),bn.jsx("div",{className:"text-text-muted text-xs",children:e.manufacturer})]})]}),p&&e.name?.toLowerCase().includes(p.detectPatterns[0])&&bn.jsxs("span",{className:"text-xs bg-accent-primary/20 text-accent-primary px-2 py-1 rounded",children:["Auto-detected: ",p.name]})]},e.id))})]}),bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Controller Profile"}),bn.jsxs("select",{value:m?.id||"",onChange:e=>{const t=Vg.find(t=>t.id===e.target.value);f(t||null)},className:"w-full bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 text-text-primary",children:[bn.jsx("option",{value:"",children:"Select a profile..."}),Vg.map(e=>bn.jsxs("option",{value:e.id,children:[e.manufacturer," ",e.name]},e.id))]})]}),m&&bn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[bn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[bn.jsxs("h4",{className:"text-sm font-medium text-text-primary",children:[m.manufacturer," ",m.name]}),bn.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white text-sm rounded transition-colors",children:"Apply Suggested Mappings"})]}),bn.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[bn.jsxs("div",{children:[bn.jsx("span",{className:"text-text-muted",children:"Knobs:"})," ",bn.jsx("span",{className:"text-text-secondary",children:m.knobs.length})]}),bn.jsxs("div",{children:[bn.jsx("span",{className:"text-text-muted",children:"Pads:"})," ",bn.jsx("span",{className:"text-text-secondary",children:m.pads.length})]}),m.extras?.faders&&bn.jsxs("div",{children:[bn.jsx("span",{className:"text-text-muted",children:"Faders:"})," ",bn.jsx("span",{className:"text-text-secondary",children:m.extras.faders.length})]})]})]})]}):bn.jsxs("div",{className:"text-center py-8",children:[bn.jsx(Pe,{size:48,className:"mx-auto text-text-muted mb-4"}),bn.jsx("p",{className:"text-text-secondary mb-4",children:"Enable MIDI to connect your controller"}),bn.jsx("button",{onClick:i,className:"px-6 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded font-medium transition-colors",children:"Enable MIDI"})]}):bn.jsxs("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-4",children:[bn.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[bn.jsx(De,{size:20}),bn.jsx("span",{children:"Web MIDI API not supported"})]}),bn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})}),"parameters"===d&&bn.jsx("div",{className:"space-y-3",children:Object.entries(U).map(([e,t])=>bn.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[bn.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[bn.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?bn.jsx(Ce,{size:16,className:"text-text-muted"}):bn.jsx(Re,{size:16,className:"text-text-muted"})]}),k.has(e)&&bn.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),n=z(e.id),a=y&&v?.id===e.id;return bn.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${a?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[t&&bn.jsx(je,{size:14,className:"text-accent-success"}),bn.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[n&&bn.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]}),bn.jsx("button",{onClick:()=>R({type:"parameter",id:e.id,label:e.label,min:e.min,max:e.max,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${a?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:a?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"actions"===d&&bn.jsx("div",{className:"space-y-3",children:Object.entries(G).map(([e,t])=>bn.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[bn.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[bn.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?bn.jsx(Ce,{size:16,className:"text-text-muted"}):bn.jsx(Re,{size:16,className:"text-text-muted"})]}),k.has(e)&&bn.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),n=z(e.id),a=y&&v?.id===e.id;return bn.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${a?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[t&&bn.jsx(je,{size:14,className:"text-accent-success"}),bn.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[n&&bn.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]}),bn.jsx("button",{onClick:()=>R({type:"action",id:e.id,label:e.label,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${a?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:a?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"mappings"===d&&bn.jsx("div",{className:"space-y-4",children:0===x.length?bn.jsxs("div",{className:"text-center py-8",children:[bn.jsx(Oe,{size:48,className:"mx-auto text-text-muted mb-4"}),bn.jsx("p",{className:"text-text-secondary",children:"No mappings configured"}),bn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Go to TB-303 or Tracker tabs to create mappings"})]}):bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"flex justify-end",children:bn.jsxs("button",{onClick:L,className:"flex items-center gap-1 text-sm text-accent-error hover:underline",children:[bn.jsx(Le,{size:14}),"Clear All"]})}),bn.jsx("div",{className:"space-y-2",children:x.map(e=>bn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded px-4 py-3",children:[bn.jsxs("div",{children:[bn.jsx("div",{className:"text-text-primary font-medium",children:e.displayName||e.parameterPath}),bn.jsx("div",{className:"text-text-muted text-xs",children:e.parameterPath})]}),bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsxs("div",{className:"text-right",children:[bn.jsxs("div",{className:"text-text-secondary font-mono text-sm",children:[void 0!==e.midiChannel?`CH${e.midiChannel+1} `:"","CC",e.ccNumber]}),bn.jsxs("div",{className:"text-text-muted text-xs",children:[e.min," - ",e.max," (",e.curve,")"]})]}),bn.jsx("button",{onClick:()=>{return t=e.id,l.removeMapping(t),void D();var t},className:"text-accent-error hover:text-accent-error/80 transition-colors",children:bn.jsx(Le,{size:16})})]})]},e.id))})]})}),"settings"===d&&bn.jsxs("div",{className:"space-y-6",children:[bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Knob Sensitivity"}),bn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[bn.jsxs("div",{className:"flex items-center justify-between mb-2",children:[bn.jsx("span",{className:"text-text-muted text-sm",children:"Slow (Smooth)"}),bn.jsx("span",{className:"text-text-primary font-mono",children:M.toFixed(2)}),bn.jsx("span",{className:"text-text-muted text-sm",children:"Fast (Direct)"})]}),bn.jsx("input",{type:"range",min:"0.05",max:"1",step:"0.05",value:M,onChange:e=>{return t=parseFloat(e.target.value),N(t),void l.setGlobalSensitivity(t);var t},className:"w-full accent-accent-primary"}),bn.jsx("p",{className:"text-text-muted text-xs mt-2",children:"Lower values make knobs respond more smoothly but slower. Higher values give immediate response."})]})]}),bn.jsxs("div",{children:[bn.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[bn.jsx(Ie,{size:16}),"Controlled Instrument"]}),bn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[bn.jsxs("select",{value:A??"all",onChange:e=>{const t=e.target.value;_("all"===t?null:parseInt(t))},className:"w-full bg-dark-bgTertiary border border-dark-border rounded px-3 py-2 text-text-primary mb-2",children:[bn.jsx("option",{value:"all",children:"All TB-303 Instruments"}),c.map(e=>bn.jsxs("option",{value:e.id,children:[e.id,". ",e.name," (",e.synthType||"Sampler",")"]},e.id))]}),bn.jsx("p",{className:"text-text-muted text-xs",children:'Choose which instrument responds to MIDI CC knobs. "All TB-303" controls every TB-303 synth at once.'})]})]}),bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Quick Setup"}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("button",{onClick:j,disabled:!m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgSecondary disabled:text-text-muted text-white rounded font-medium transition-colors",children:[bn.jsx(Oe,{size:18}),"Apply Suggested Mappings"]}),bn.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:[bn.jsx(Le,{size:18}),"Clear All Mappings"]})]})]}),C&&bn.jsxs("div",{children:[bn.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[bn.jsx(Be,{size:16}),"MPK Mini MK3 Display"]}),bn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4 space-y-3",children:[bn.jsx("p",{className:"text-text-muted text-xs",children:"Sync parameter names to your MPK Mini's OLED display. Names will show when you turn the knobs."}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("button",{onClick:O,disabled:"syncing"===P||0===x.length,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgTertiary disabled:text-text-muted text-white rounded text-sm transition-colors",children:[bn.jsx(Be,{size:16}),"syncing"===P?"Syncing...":"Sync Current Mappings"]}),bn.jsxs("button",{onClick:F,disabled:"syncing"===P,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-sm transition-colors",children:[bn.jsx(Oe,{size:16}),"Apply DEViLBOX Preset (TB-303)"]})]}),"success"===P&&bn.jsxs("p",{className:"text-accent-success text-xs flex items-center gap-1",children:[bn.jsx(je,{size:12})," Display updated!"]}),"error"===P&&bn.jsxs("p",{className:"text-accent-error text-xs flex items-center gap-1",children:[bn.jsx(De,{size:12})," Failed to update display"]})]})]}),bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Supported Controllers"}),bn.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Vg.filter(e=>"generic"!==e.id).map(e=>bn.jsxs("div",{className:"bg-dark-bgSecondary rounded px-3 py-2 text-text-muted",children:[e.manufacturer," ",e.name]},e.id))})]})]})]}),bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-dark-border",children:[bn.jsxs("div",{className:"text-xs text-text-muted",children:[x.length," mapping",1!==x.length?"s":""," active"]}),bn.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Close"})]})]})})},Gg="TB303",Kg=ug(Gg),Hg=pg(Kg),Wg=a()(Fn((e,t)=>({isConnected:!1,controllerInfo:null,currentSynthType:Gg,currentPreset:null,currentPage:0,pages:Hg,parameters:Kg,parameterValues:{},changedParameters:new Set,presets:[],availablePresets:[],currentBank:[],displayInfo:null,lightGuide:[],totalPages:Hg.length,init:async n=>{const a=n||t().currentSynthType,s=ug(a),r=pg(s),o={};for(const e of s)o[e.id]=e.defaultValue;e(e=>{e.currentSynthType=a,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=o,e.changedParameters=new Set,e.currentPage=0}),await async function(){}(),t().updateDisplay()},setSynth:n=>{const{currentSynthType:a}=t();if(n===a)return;const s=ug(n),r=pg(s),o={};for(const e of s)o[e.id]=e.defaultValue;e(e=>{e.currentSynthType=n,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=o,e.changedParameters=new Set,e.currentPage=0,e.currentPreset=null}),t().updateDisplay()},disconnect:()=>{e(e=>{e.isConnected=!1,e.controllerInfo=null})},loadPreset:n=>{e(e=>{e.currentPreset=n,e.parameterValues={...n.parameters},e.changedParameters=new Set,e.currentPage=0}),t().updateDisplay()},loadPresetFromFile:async e=>{try{const n=await e.arrayBuffer(),a=await mg(n);t().loadPreset(a)}catch(n){throw n}},savePreset:(n,a)=>{const{parameterValues:s,currentPreset:r}=t(),o={metadata:{...r?.metadata,name:n,vendor:"DEViLBOX",uuid:"devilbox-tracker-v1",version:"1.0",deviceType:"INST",bankChain:a?.bankChain||["User","Saved"],author:a?.author,comment:a?.comment,isUser:!0,...a},parameters:{...s},blob:r?.blob};e(e=>{e.currentPreset=o,e.changedParameters=new Set})},exportPreset:()=>{const{currentPreset:e}=t();if(!e)return;const n=fg(e),a=new Blob([n],{type:"application/octet-stream"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`${e.metadata.name||"preset"}.nksf`,r.click(),URL.revokeObjectURL(s)},addPreset:t=>{e(e=>{e.presets.push(t)})},setParameterValue:(n,a)=>{const{parameters:s}=t(),r=s.find(e=>e.id===n);if(!r)return;const o=Math.max(0,Math.min(1,a));e(e=>{e.parameterValues[n]=o,Math.abs(o-r.defaultValue)>.001?e.changedParameters.add(n):e.changedParameters.delete(n)}),t().updateDisplay()},resetParameter:e=>{const{parameters:n}=t(),a=n.find(t=>t.id===e);a&&t().setParameterValue(e,a.defaultValue)},resetAllParameters:()=>{const{parameters:n}=t();e(e=>{for(const t of n)e.parameterValues[t.id]=t.defaultValue;e.changedParameters.clear()}),t().updateDisplay()},nextPage:()=>{const{currentPage:e,pages:n}=t(),a=(e+1)%n.length;t().setPage(a)},prevPage:()=>{const{currentPage:e,pages:n}=t(),a=0===e?n.length-1:e-1;t().setPage(a)},setPage:n=>{const{pages:a}=t();n<0||n>=a.length||(e(e=>{e.currentPage=n}),t().updateDisplay())},updateDisplay:()=>{const{currentPreset:n,currentPage:a,pages:s,parameterValues:r,currentSynthType:o}=t(),i=s[a];if(!i)return;const l=[`DEViLBOX - ${o}`,n?.metadata.name||"Untitled"];for(const e of i.parameters.slice(0,4)){const t=hg(e,r[e.id]||e.defaultValue);l.push(`${e.name}: ${t}`)}e(e=>{e.displayInfo=l})},setLightGuide:t=>{e(e=>{e.lightGuide=t})},clearLightGuide:()=>{e(e=>{e.lightGuide=[]})},setDisplayInfo:t=>{e(e=>{e.displayInfo=t})},syncParametersFromConfig:n=>{const{parameters:a,currentSynthType:s}=t(),r={};for(const e of a){const t=e.id.replace(`${s.toLowerCase()}.`,"").split(".");let a=n;for(const e of t){if(!a||"object"!=typeof a||!(e in a)){a=void 0;break}a=a[e]}if("number"==typeof a){const t=(a-e.min)/(e.max-e.min);r[e.id]=Math.max(0,Math.min(1,t))}else if("boolean"==typeof a)r[e.id]=a?1:0;else if("string"==typeof a&&e.valueStrings){const t=e.valueStrings.indexOf(a);-1!==t&&(r[e.id]=t/(e.valueStrings.length-1))}}Object.keys(r).length>0&&(e(e=>{for(const[t,n]of Object.entries(r)){e.parameterValues[t]=n;const s=a.find(e=>e.id===t);s&&Math.abs(n-s.defaultValue)>.001&&e.changedParameters.add(t)}}),t().updateDisplay())}})));const $g=6092,qg=2536,Yg=7285,Xg=8137,Qg=1891,Zg=7285,Jg=8137,ev=1,tv=3,nv=16,av=17,sv=18,rv=240,ov=241,iv={PLAY:1,STOP:2,REC:3,LOOP:4,METRO:5,BROWSE:32,PRESET:34,PAGE_LEFT:48,PAGE_RIGHT:49,SHIFT:80,CLEAR:81,OCTAVE_UP:96,OCTAVE_DOWN:97,SCALE:112};class lv{device=null;deviceInfo=null;knobValues=new Array(8).fill(0);buttonStates=new Map;onKnobChange;onButtonPress;onButtonRelease;constructor(){this.handleInputReport=this.handleInputReport.bind(this)}async requestDevice(){if(!("hid"in navigator))return!1;try{const e=await navigator.hid.requestDevice({filters:[{vendorId:$g},{vendorId:qg},{vendorId:Yg},{vendorId:Xg},{vendorId:Qg},{vendorId:Zg},{vendorId:Jg},{vendorId:15}]});return 0!==e.length&&await this.connect(e[0])}catch(e){return!1}}async connect(e){try{e.opened||await e.open(),this.device=e,this.deviceInfo=this.parseDeviceInfo(e),e.addEventListener("inputreport",this.handleInputReport);try{await this.sendPing()}catch(t){}return!0}catch(n){return!1}}async disconnect(){this.device&&(this.device.removeEventListener("inputreport",this.handleInputReport),this.device.opened&&await this.device.close(),this.device=null,this.deviceInfo=null)}getDeviceInfo(){return this.deviceInfo}parseDeviceInfo(e){const t=e.productId,n=e.vendorId,a=e.productName||"Unknown Controller";let s="Native Instruments";n===qg?s="Akai":n===Yg?s="Arturia":n===Xg?s="Nektar":n===Qg?s="M-Audio":n===Zg?s="Studiologic":n===Jg?s="iCON":15===n&&(s="Alesis");let r=!1,o=0,i=0,l=!1,c=0,d=8;[4928,4944,4960,5136].includes(t)?(r=!0,o=2,i=72,l=!0,4928===t?c=25:4944===t?c=49:4960===t?c=61:5136===t&&(c=88)):t>=5664&&t<=5968?(r=!0,o=4,i=144,l=!0,5664===t||5920===t?c=49:5680===t||5936===t?c=61:5712!==t&&5968!==t||(c=88)):t>=5648&&t<=5650?(r=!0,o=2,i=72,l=!0,5648===t?c=25:5649===t?c=49:5650===t&&(c=61)):5632===t?(r=!0,o=2,i=72,l=!0,c=32):2056===t?(r=!0,o=2,i=128,l=!1,d=8):5888===t||5904===t?(r=!0,o=2,i=144,l=!1,d=8):4416===t?(r=!0,o=2,i=160,l=!1,d=8):2067===t||5893===t?(r=!1,o=0,i=0,l=!1,d=8):5376===t&&(r=!0,o=2,i=96,l=!1,d=8);n===qg&&([309,312].includes(t)||a.toLowerCase().includes("mpk mini"))?(r=!0,o=2,i=16,l=!0,c=8,d=8):n===qg&&[305,306,307].includes(t)&&(r=!0,o=2,i=80,l=!1,d=8);n===Yg&&[1319,1320,1321].includes(t)?(r=!0,o=2,i=64,l=!1,d=9):n===Yg&&[1553,1554,1555].includes(t)&&(r=!0,o=2,i=80,l=!1,d=9);return n===Xg&&[8240,8241,8242,8243].includes(t)?(r=!0,o=2,i=40,l=!1,d=8):n===Xg&&[8224,8225].includes(t)&&(r=!0,o=4,i=128,l=!0,c=49,d=8),n===Qg&&[405,406,407].includes(t)&&(r=!0,o=2,i=64,l=!1,d=16),n===Zg&&[2048,2064].includes(t)&&(r=!0,o=2,i=40,l=!1,d=8),n===Jg&&[12304,12305].includes(t)&&(r=!0,o=2,i=64,l=!1,d=8),15===n&&[311,312,313].includes(t)&&(r=!1,o=0,i=0,l=!1,d=8),{id:`nks_${n.toString(16)}_${t.toString(16)}`,name:a,vendor:s,hasDisplay:r,displayLines:o,displayChars:i,hasLightGuide:l,lightGuideKeys:c,hasKnobs:!0,knobCount:d,hasButtons:!0,hasPads:5888===t||5904===t,hasTransport:!0,hasJogWheel:5888===t||5904===t,hasBrowserControls:!0,hasTouchStrip:t>=5920&&t<=5968}}async sendDisplayUpdate(e){if(!this.device||!this.deviceInfo?.hasDisplay)return;const t=e.slice(0,this.deviceInfo.displayLines).map(e=>e.padEnd(this.deviceInfo.displayChars," ").substring(0,this.deviceInfo.displayChars)),n=new TextEncoder,a=this.deviceInfo.displayLines*this.deviceInfo.displayChars,s=t.join("").substring(0,a),r=n.encode(s),o=new Uint8Array(64);o[0]=ev,o[1]=this.deviceInfo.displayLines,o[2]=255&r.length,o[3]=r.length>>8&255,o.set(r.slice(0,60),4);try{await this.device.sendReport(ev,o)}catch(i){}}async sendLightGuide(e){if(this.device&&this.deviceInfo?.hasLightGuide)try{const t=new Uint8Array(256);for(const n of e){if(n.note<0||n.note>=128)continue;const e=2*n.note;t[e]=n.color,t[e+1]=Math.round(255*n.brightness)}for(let e=0;e<t.length;e+=60){const n=t.slice(e,e+60),a=new Uint8Array(64);a[0]=tv,a[1]=e/60&255,a[2]=n.length,a.set(n,3),await this.device.sendReport(tv,a)}}catch(t){}}handleInputReport(e){const{data:t,reportId:n}=e,a=new Uint8Array(t.buffer);switch(n){case nv:this.handleKnobValues(a);break;case av:this.handleButtonState(a);break;case sv:this.handleTransport(a);break;case ov:this.handleDeviceInfo(a)}}handleKnobValues(e){const t=e[1];for(let n=0;n<t;n++){const t=2+2*n,a=e[t],s=e[t+1]/127;this.knobValues[a]!==s&&(this.knobValues[a]=s,this.onKnobChange?.(a,s))}}handleButtonState(e){const t=e[1],n=1===e[2];n!==(this.buttonStates.get(t)||!1)&&(this.buttonStates.set(t,n),n?this.onButtonPress?.(t):this.onButtonRelease?.(t))}handleTransport(e){const t=e[1];this.handleButtonState(new Uint8Array([0,t,1]))}handleDeviceInfo(e){}async sendPing(){if(!this.device)return;const e=new Uint8Array(64);e[0]=rv,e[1]=1,await this.device.sendReport(rv,e)}onKnobChanged(e){this.onKnobChange=e}onButtonPressed(e){this.onButtonPress=e}onButtonReleased(e){this.onButtonRelease=e}getKnobValues(){return[...this.knobValues]}getButtonState(e){return this.buttonStates.get(e)||!1}}function cv(){return"hid"in navigator}const dv=Object.freeze(Object.defineProperty({__proto__:null,AKAI_VENDOR_ID:qg,ALESIS_VENDOR_ID:15,ARTURIA_VENDOR_ID:Yg,ICON_VENDOR_ID:Jg,M_AUDIO_VENDOR_ID:Qg,NEKTAR_VENDOR_ID:Xg,NI_VENDOR_ID:$g,NKSHIDProtocol:lv,NKS_BUTTONS:iv,STUDIOLOGIC_VENDOR_ID:Zg,getPairedDevices:async function(){if(!cv())return[];const e=await navigator.hid.getDevices(),t=[$g,qg,Yg,Xg,Qg,Zg,Jg,15];return e.filter(e=>t.includes(e.vendorId))},isHIDSupported:cv},Symbol.toStringTag,{value:"Module"})),uv=[240,71,127],pv=16,hv=14,mv=32,fv=128,yv=64,gv=[[13,19,25,31,37,43,49],[0,20,26,32,38,44,50],[1,7,27,33,39,45,51],[2,8,14,34,40,46,52],[3,9,15,21,41,47,53],[4,10,16,22,28,48,54],[5,11,17,23,29,35,55],[6,12,18,24,30,36,42]];async function vv(e,t){if(!Ny.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const n=await navigator.requestMIDIAccess({sysex:!0}),a=Array.from(n.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(a)try{const n=e.padEnd(16," ").substring(0,16),s=t.padEnd(16," ").substring(0,16),r=Array.from(n).map(e=>e.charCodeAt(0)),o=Array.from(s).map(e=>e.charCodeAt(0)),i=new Uint8Array([...uv,73,pv,0,...r,1,...o,247]);a.send(i)}catch(s){}}async function bv(e,t,n,a){if(!Ny.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const s=await navigator.requestMIDIAccess({sysex:!0}),r=Array.from(s.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(r&&!(e<0||e>7))try{const s=Math.max(0,Math.min(127,t)),o=Math.max(0,Math.min(127,n)),i=Math.max(0,Math.min(127,a)),l=new Uint8Array([...uv,73,mv,e,s,o,i,247]);r.send(l)}catch(o){}}async function xv(e){for(const t of e)await bv(t.pad,t.red,t.green,t.blue)}async function wv(e){if(1024!==e.length)return;if(!Ny.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const t=await navigator.requestMIDIAccess({sysex:!0}),n=Array.from(t.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(n)try{const t=function(e){const t=[];for(let n=0;n<8;n++)for(let a=0;a<fv;a+=7){const s=new Array(8).fill(0);for(let t=0;t<8;t++){const r=16*(8*n+t)+Math.floor(a/8);for(let n=0;n<7&&a+n<fv;n++){const o=7-(a+n)%8,i=e[r]>>o&1,l=gv[t][n],c=Math.floor(l/7),d=l%7;i&&(s[c]|=1<<d)}}t.push(...s)}return new Uint8Array(t)}(e),a=t.length+4,s=a>>7&127,r=127&a,o=new Uint8Array([...uv,73,hv,s,r,0,7,0,127,...t,247]);n.send(o)}catch(a){}}async function kv(){const e=Array(yv).fill(null).map(()=>Array(fv).fill(!1));for(let a=0;a<fv;a++)e[0][a]=!0,e[63][a]=!0;for(let a=0;a<yv;a++)e[a][0]=!0,e[a][127]=!0;for(let a=0;a<Math.min(fv,yv);a++)e[a][a]=!0,e[a][127-a]=!0;let t=16;for(const a of"DEVILBOX")Sv(e,a,t,28),t+=12;const n=function(e){const t=new Uint8Array(1024);for(let n=0;n<yv;n++)for(let a=0;a<fv;a++)if(e[n]&&e[n][a]){const e=7-a%8;t[16*n+Math.floor(a/8)]|=1<<e}return t}(e);await wv(n)}function Sv(e,t,n,a){const s={D:[126,66,66,66,66,66,126,0],E:[126,64,64,124,64,64,126,0],V:[66,66,66,36,36,24,24,0],I:[60,24,24,24,24,24,60,0],L:[64,64,64,64,64,64,126,0],B:[124,66,66,124,66,66,124,0],O:[60,66,66,66,66,66,60,0],X:[66,66,36,24,36,66,66,0]},r=s[t.toUpperCase()]||s.O;for(let o=0;o<8;o++)for(let t=0;t<8;t++)if(r[o]>>7-t&1){const s=n+t,r=a+o;s>=0&&s<fv&&r>=0&&r<yv&&(e[r][s]=!0)}}class Mv{protocol;updateInterval=null;lightGuideEnabled=!0;isAkaiDevice=!1;constructor(){this.protocol=new lv,this.protocol.onKnobChanged((e,t)=>{this.handleKnobChange(e,t)}),this.protocol.onButtonPressed(e=>{this.handleButtonPress(e)})}async requestConnection(){if(!cv())return!1;const e=await this.protocol.requestDevice();if(e){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return e}async connectToPairedDevice(){if(!cv())return!1;try{const{getPairedDevices:e}=await Pn(async()=>{const{getPairedDevices:e}=await Promise.resolve().then(()=>dv);return{getPairedDevices:e}},void 0),t=await e();if(0===t.length)return!1;const n=await this.protocol.connect(t[0]);if(n){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return n}catch(e){return!1}}async disconnect(){this.stopDisplayUpdates(),await this.protocol.disconnect()}getDeviceInfo(){return this.protocol.getDeviceInfo()}isConnected(){return null!==this.protocol.getDeviceInfo()}startDisplayUpdates(){null===this.updateInterval&&(this.updateInterval=window.setInterval(()=>{this.updateDisplay()},100),this.updateDisplay())}stopDisplayUpdates(){null!==this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}async updateDisplay(){const e=Wg.getState().displayInfo;if(e&&0!==e.length)if(this.isAkaiDevice){const t=e[0]||"",n=e[1]||"";await vv(t,n)}else await this.protocol.sendDisplayUpdate(e)}async updateLightGuide(){if(!this.lightGuideEnabled)return;const e=Wg.getState().lightGuide||[];this.isAkaiDevice?await async function(e){const t=[];for(let n=0;n<Math.min(8,e.length);n++){const a=e[n],s=Math.round(127*a.brightness);let r=0,o=0,i=0;switch(a.color){case 0:break;case 1:r=o=i=s;break;case 2:r=s;break;case 3:r=s,o=Math.round(.5*s);break;case 4:r=o=s;break;case 5:o=s;break;case 6:o=i=s;break;case 7:i=s;break;case 8:r=Math.round(.5*s),i=s;break;case 9:r=i=s}t.push({pad:n,red:r,green:o,blue:i})}await xv(t)}(e):await this.protocol.sendLightGuide(e)}handleKnobChange(e,t){const n=Wg.getState(),a=8*n.currentPage+e,s=n.parameters[a];s&&n.setParameterValue(s.id,t)}handleButtonPress(e){const t=Wg.getState();switch(e){case iv.PAGE_LEFT:t.prevPage(),this.updateDisplay();break;case iv.PAGE_RIGHT:t.nextPage(),this.updateDisplay();break;case iv.PRESET:case iv.BROWSE:case iv.SHIFT:break;case iv.CLEAR:const e=8*t.currentPage,n=t.parameters[e];n&&t.setParameterValue(n.id,0);break;case iv.OCTAVE_UP:this.shiftLightGuide(12);break;case iv.OCTAVE_DOWN:this.shiftLightGuide(-12)}}shiftLightGuide(e){const t=Wg.getState(),n=(t.lightGuide||[]).map(t=>({...t,note:Math.max(0,Math.min(127,t.note+e))}));t.setLightGuide(n),this.updateLightGuide()}setScaleLights(e,t){const n=[];for(let a=0;a<11;a++)for(const s of t){const t=12*a+e+s;t>=0&&t<128&&n.push({note:t,color:0===s?2:1,brightness:.5})}Wg.getState().setLightGuide(n),this.updateLightGuide()}clearLightGuide(){Wg.getState().setLightGuide([]),this.updateLightGuide()}setLightGuideEnabled(e){this.lightGuideEnabled=e,e?this.updateLightGuide():this.clearLightGuide()}async syncKnobsToParameters(){await this.updateDisplay()}}let Nv=null;function Cv(){return Nv||(Nv=new Mv),Nv}function Ev(){return cv()}const Pv=Object.freeze(Object.defineProperty({__proto__:null,NKSHardwareController:Mv,connectToNKSPairedDevice:async function(){return Cv().connectToPairedDevice()},getNKSHardwareController:Cv,isNKSHardwareAvailable:Ev},Symbol.toStringTag,{value:"Module"}));function Tv(e){return e.split(".")}function Av(e,t,n){if(0===t.length)return e;const[a,...s]=t,r=e[a];return 0===s.length?{...e,[a]:n}:{...e,[a]:Av(r||{},s,n)}}function Iv(){!function(e){const{currentSynthType:t,setSynth:n,parameters:a,syncParametersFromConfig:r}=Wg(),{getInstrument:o,updateInstrument:i}=Df(),l=s.useRef(""),c=e?o(e):void 0;s.useEffect(()=>{if(!c)return;const e=c.synthType;e!==t&&n(e);const a=e.toLowerCase(),s=c[a];if(s&&"object"==typeof s){const e=JSON.stringify(s);e!==l.current&&(l.current=e,r(s))}},[c,t,n,r]),s.useEffect(()=>{if(e&&c)return Wg.subscribe((t,n)=>{if(t.parameterValues!==n.parameterValues){const a=c.synthType.toLowerCase();let s={},r=!1;for(const e of t.parameters){const o=t.parameterValues[e.id],i=n.parameterValues[e.id];if(void 0!==o&&o!==i){let t;switch(e.type){case 2:t=o>=.5;break;case 3:if(e.valueStrings){const n=Math.round(o*(e.valueStrings.length-1));t=e.valueStrings[n]||e.valueStrings[0]}else t=Math.round(o*(e.max-e.min)+e.min);break;case 1:t=Math.round(o*(e.max-e.min)+e.min);break;default:t=o*(e.max-e.min)+e.min}const n=Tv(e.id);if(n[0]===a&&n.length>1){const e=n.slice(1),o=Av(c[a]||{},e,t);s={...s,[a]:o},r=!0}}}if(r){const t=JSON.stringify(s[a]);l.current=t,i(e,s)}}})},[e,c,a,i])}(Df(e=>e.currentInstrumentId))}const _v=(e,t,n)=>{const a=Math.log(t),s=Math.log(n);return(Math.log(e)-a)/(s-a)},Ov=e.memo(({value:e,min:t,max:n,label:a,title:r,unit:o="",onChange:i,logarithmic:l=!1,defaultValue:c,size:d="md",color:u="#00d4aa",displayValue:p,isActive:h=!1,bipolar:m=!1,formatValue:f,step:y,disabled:g=!1})=>{const v=s.useRef(null),[b,x]=s.useState(!1),w=s.useRef(!1),k=s.useRef(0),S=s.useRef(0),M=s.useRef(null),N=s.useRef(null),C="cyan-lineart"===sy(e=>e.currentThemeId),E=C?"#00ffff":u,P=C?"#0a3a3a":"#2a2a2a",T=C?"#0a4a4a":"#444",A=C?"#0a4a4a":"#4a4a4a",I=C?"#0a3a3a":"#3a3a3a",_=C?"#0a2a2a":"#2a2a2a",{knob:O,fontSize:F,stroke:D}={sm:{knob:40,fontSize:10,stroke:3},md:{knob:56,fontSize:11,stroke:4},lg:{knob:72,fontSize:12,stroke:5}}[d],R=s.useCallback(()=>l?_v(Math.max(t,Math.min(n,e)),t,n):(e-t)/(n-t),[e,t,n,l]),j=s.useCallback(()=>{const a=void 0!==p?p:e,s=Math.max(t,Math.min(n,a));return l?_v(s,t,n):(s-t)/(n-t)},[p,e,t,n,l])(),L=isNaN(j)||!isFinite(j)?-135:270*j-135,B=f||(e=>isNaN(e)||null==e?"0":e>=1e3?`${(e/1e3).toFixed(1)}k`:e<10?e.toFixed(1):Math.round(e).toString()),V=m?0:-135,z=L,U=(O-2*D)/2,G=O/2,K=e=>{const t=((isNaN(e)||!isFinite(e)?-135:e)-90)*Math.PI/180;return{x:G+U*Math.cos(t),y:G+U*Math.sin(t)}},H=(e,t)=>{const n=K(e),a=K(t),s=Math.abs(t-e)>180?1:0,r=t>e?1:0;return`M ${n.x} ${n.y} A ${U} ${U} 0 ${s} ${r} ${a.x} ${a.y}`},W=s.useCallback(e=>{if(g)return;e.preventDefault(),x(!0),w.current=!0;const t="touches"in e?e.touches[0].clientY:e.clientY;k.current=t,S.current=R(),document.body.style.cursor="ns-resize"},[R,g]),$=s.useCallback(()=>{g||i(void 0!==c?c:m?(n+t)/2:t)},[c,m,t,n,i,g]),q=s.useCallback(e=>{e.preventDefault(),g||i(void 0!==c?c:m?(n+t)/2:t)},[c,m,t,n,i,g]),Y=s.useCallback(a=>{let s=e;const r=y||(l?(n-t)/100:(n-t)/50),o=10*r;switch(a.key){case"ArrowUp":case"ArrowRight":a.preventDefault(),s=Math.min(n,e+(a.shiftKey?o:r));break;case"ArrowDown":case"ArrowLeft":a.preventDefault(),s=Math.max(t,e-(a.shiftKey?o:r));break;case"Home":a.preventDefault(),s=t;break;case"End":a.preventDefault(),s=n;break;case"PageUp":a.preventDefault(),s=Math.min(n,e+o);break;case"PageDown":a.preventDefault(),s=Math.max(t,e-o);break;default:return}s=void 0!==y&&y>0?Math.round(s/y)*y:n-t>100?Math.round(s):Math.round(10*s)/10,i(s)},[e,t,n,l,y,i]);s.useEffect(()=>{const e=e=>{if(!w.current)return;const a="touches"in e?e.touches[0].clientY:e.clientY,s=(k.current-a)/150,r=Math.max(0,Math.min(1,S.current+s));let o;o=l?((e,t,n)=>{const a=Math.log(t),s=Math.log(n);return Math.exp(a+e*(s-a))})(r,t,n):t+r*(n-t),o=void 0!==y&&y>0?Math.round(o/y)*y:Math.round(100*o)/100,N.current=o,M.current||(M.current=requestAnimationFrame(()=>{null!==N.current&&(i(N.current),N.current=null),M.current=null}))},a=()=>{w.current&&(x(!1),w.current=!1,document.body.style.cursor="")};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",a),window.addEventListener("touchmove",e),window.addEventListener("touchend",a),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",a),window.removeEventListener("touchmove",e),window.removeEventListener("touchend",a),M.current&&cancelAnimationFrame(M.current)}},[t,n,l,y,i]);const X=K(L),Q={x:G+(U-8)*Math.cos((L-90)*Math.PI/180),y:G+(U-8)*Math.sin((L-90)*Math.PI/180)};return bn.jsxs("div",{className:"knob-container",style:{width:O+20,opacity:g?.4:1,pointerEvents:g?"none":"auto"},title:r,children:[a&&bn.jsx("div",{className:"knob-label",style:{fontSize:F-1},children:a}),bn.jsx("div",{ref:v,className:"knob-body "+(b?"cursor-grabbing":""),style:{width:O,height:O},onMouseDown:W,onTouchStart:W,onDoubleClick:$,onContextMenu:q,onKeyDown:Y,role:"slider","aria-label":`${a||"Knob"}${o?` (${o})`:""}`,"aria-valuemin":t,"aria-valuemax":n,"aria-valuenow":Math.round(10*e)/10,"aria-valuetext":`${B(void 0!==p?p:e)}${o}`,tabIndex:0,children:bn.jsxs("svg",{width:O,height:O,viewBox:`0 0 ${O} ${O}`,children:[bn.jsx("path",{d:H(-135,135),fill:"none",stroke:P,strokeWidth:D,strokeLinecap:"round"}),m?.5!==j&&bn.jsx("path",{d:H(j>.5?V:z,j>.5?z:V),fill:"none",stroke:E,strokeWidth:D,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${E})`:`drop-shadow(0 0 2px ${E})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}):bn.jsx("path",{d:H(-135,L),fill:"none",stroke:E,strokeWidth:D,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${E})`:`drop-shadow(0 0 2px ${E})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}),bn.jsx("circle",{cx:G,cy:G,r:U-D-4,fill:"url(#knobGradient)",stroke:T,strokeWidth:"1"}),bn.jsx("line",{x1:Q.x,y1:Q.y,x2:X.x,y2:X.y,stroke:E,strokeWidth:"2",strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 3px ${E})`:"none",transition:void 0!==p?"transform 0.016s linear":"transform 0.1s ease-out"}}),bn.jsx("defs",{children:bn.jsxs("linearGradient",{id:"knobGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[bn.jsx("stop",{offset:"0%",stopColor:A}),bn.jsx("stop",{offset:"50%",stopColor:I}),bn.jsx("stop",{offset:"100%",stopColor:_})]})})]})}),bn.jsxs("div",{className:"knob-value",style:{fontSize:F,color:h?E:void 0,textShadow:h?`0 0 4px ${E}80`:"none"},children:[B(void 0!==p?p:e),o]})]})},(e,t)=>e.value===t.value&&e.displayValue===t.displayValue&&e.isActive===t.isActive&&e.min===t.min&&e.max===t.max&&e.label===t.label&&e.color===t.color&&e.size===t.size);Ov.displayName="Knob";const Fv=()=>{const[e,t]=s.useState(null),[n,a]=s.useState(!1),[r,o]=s.useState(null),i=s.useRef(null);Iv();const{currentPreset:l,currentPage:c,totalPages:d,currentSynthType:u,pages:p,parameterValues:h,setParameterValue:m}=Wg(),f=Cv();s.useEffect(()=>{const e=f.getDeviceInfo();e&&t(e)},[]);return Ev()?bn.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg space-y-4",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{children:[bn.jsx("h3",{className:"text-lg font-semibold text-white",children:"Native Kontrol Standard"}),bn.jsx("div",{className:"text-xs text-cyan-400 mt-0.5",children:u})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("div",{className:"w-2 h-2 rounded-full "+(e?"bg-green-500":"bg-gray-500")}),bn.jsx("span",{className:"text-xs text-gray-400",children:e?"Connected":"Disconnected"})]})]}),e?bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[bn.jsx("div",{className:"text-sm font-medium text-white",children:e.name}),bn.jsx("div",{className:"text-xs text-gray-400",children:e.vendor}),bn.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-400",children:[e.hasDisplay&&bn.jsx("span",{children:" Display"}),e.hasLightGuide&&bn.jsxs("span",{children:[" Light Guide (",e.lightGuideKeys," keys)"]}),e.hasKnobs&&bn.jsxs("span",{children:[" ",e.knobCount," Knobs"]}),e.hasTransport&&bn.jsx("span",{children:" Transport"})]})]}),bn.jsx("button",{onClick:async()=>{await f.disconnect(),t(null)},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"Disconnect"})]}):bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("p",{className:"text-sm text-gray-300",children:"Connect a Native Instruments controller to enable hardware control."}),bn.jsx("button",{onClick:async()=>{a(!0),o(null);try{if(await f.requestConnection()){const e=f.getDeviceInfo();t(e)}else o("Failed to connect to device")}catch(e){o(e instanceof Error?e.message:"Unknown error")}finally{a(!1)}},disabled:n,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:n?"Connecting...":"Connect Hardware"}),r&&bn.jsx("div",{className:"text-xs text-red-400 bg-red-900/20 rounded p-2",children:r})]}),l&&bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Current Preset"}),bn.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[bn.jsx("div",{className:"text-sm font-medium text-white",children:l.metadata.name}),l.metadata.author&&bn.jsxs("div",{className:"text-xs text-gray-400",children:["by ",l.metadata.author]}),l.metadata.comment&&bn.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l.metadata.comment})]}),bn.jsx("button",{onClick:()=>{const e=Wg.getState();e.currentPreset&&e.exportPreset()},className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-sm",children:"Export .nksf File"})]}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("div",{className:"text-xs font-medium text-gray-400 uppercase",children:["Parameter Pages - ",p[c]?.name||"Page"]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("button",{onClick:()=>{Wg.getState().prevPage()},disabled:0===c,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:" Previous"}),bn.jsxs("div",{className:"px-4 py-2 bg-gray-700 rounded text-white text-sm font-mono",children:[c+1," / ",d]}),bn.jsx("button",{onClick:()=>{Wg.getState().nextPage()},disabled:c>=d-1,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:"Next "})]})]}),p[c]&&bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Parameters"}),bn.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3",children:bn.jsx("div",{className:"grid grid-cols-4 gap-3",children:p[c].parameters.slice(0,8).map(e=>{const t=h[e.id]??e.defaultValue,n=hg(e,t);return bn.jsxs("div",{className:"flex flex-col items-center",children:[bn.jsx(Ov,{value:t*(e.max-e.min)+e.min,min:e.min,max:e.max,onChange:t=>{const n=(t-e.min)/(e.max-e.min);m(e.id,n)},label:e.name,color:"#00ffff",size:"sm"}),bn.jsx("div",{className:"text-[10px] text-gray-400 mt-1 text-center truncate w-full",children:n})]},e.id)})})})]}),e?.hasLightGuide&&bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"Pad LEDs":"Light Guide"}),bn.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.vendor.toLowerCase().includes("akai")?bn.jsxs(bn.Fragment,{children:[bn.jsx("button",{onClick:()=>async function(){await xv([{pad:0,red:127,green:0,blue:0},{pad:1,red:127,green:64,blue:0},{pad:2,red:127,green:127,blue:0},{pad:3,red:0,green:127,blue:0},{pad:4,red:0,green:127,blue:127},{pad:5,red:0,green:0,blue:127},{pad:6,red:64,green:0,blue:127},{pad:7,red:127,green:0,blue:127}])}(),className:"px-3 py-2 bg-gradient-to-r from-red-500 via-yellow-500 to-blue-500 hover:opacity-80 text-white rounded transition-colors text-xs font-medium",children:"Rainbow"}),bn.jsx("button",{onClick:()=>async function(){const e=Array.from({length:8},(e,t)=>({pad:t,red:0,green:0,blue:0}));await xv(e)}(),className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear LEDs"})]}):bn.jsxs(bn.Fragment,{children:[bn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,4,5,7,9,11])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Major Scale"}),bn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,3,5,7,8,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Minor Scale"}),bn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,3,5,7,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Pentatonic"}),bn.jsx("button",{onClick:()=>{f.clearLightGuide()},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear"})]})})]}),e?.hasDisplay&&bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"OLED Display (128x64)":"Display Test"}),e.vendor.toLowerCase().includes("akai")?bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsx("button",{onClick:()=>vv("  DEViLBOX  ","  Tracker DAW  "),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Text"}),bn.jsx("button",{onClick:()=>kv(),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Pattern"})]}),bn.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;const n=new Image;n.onload=async()=>{const e=document.createElement("canvas");e.width=128,e.height=64;const t=e.getContext("2d");if(!t)return;t.fillStyle="black",t.fillRect(0,0,128,64);const a=Math.min(128/n.width,64/n.height),s=(128-n.width*a)/2,r=(64-n.height*a)/2;t.drawImage(n,s,r,n.width*a,n.height*a);const i=function(e){const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");const n=t.getImageData(0,0,fv,yv),a=new Uint8Array(1024);for(let s=0;s<yv;s++)for(let e=0;e<fv;e++){const t=4*(s*fv+e);if(n.data[t]>127){const t=7-e%8;a[16*s+Math.floor(e/8)]|=1<<t}}return a}(e);await wv(i),o(null)},n.onerror=()=>{o("Failed to load image")},n.src=URL.createObjectURL(t)},className:"hidden"}),bn.jsx("button",{onClick:()=>{i.current?.click()},className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors text-xs font-medium",children:" Upload Custom Image (128x64)"}),bn.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"Tip: Upload any image - it will be auto-converted to monochrome 12864"})]}):bn.jsx("button",{onClick:()=>{Wg.getState().setDisplayInfo(["    DEViLBOX    ","  Tracker DAW   ","  NKS Active    ","  Connected!    "])},className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Display"})]}),bn.jsx("div",{className:"pt-2 border-t border-gray-700",children:bn.jsxs("div",{className:"text-xs text-gray-500",children:[bn.jsx("p",{children:"NKS enables deep hardware integration with Native Instruments controllers."}),bn.jsx("p",{className:"mt-1",children:"Knobs, displays, and light guides sync automatically."})]})})]}):bn.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg",children:[bn.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Web HID Not Supported"}),bn.jsx("p",{className:"text-sm text-gray-300",children:"Your browser does not support Web HID API. Please use Chrome/Edge 89+ or Opera 75+."})]})},Dv=({onClose:e})=>{const[t,n]=s.useState(""),[a,r]=s.useState("all"),[o,i]=s.useState("name"),{presets:l,loadPreset:c}=Wg(),d=s.useMemo(()=>{let e=[...l];if(t.trim()){const n=t.toLowerCase();e=e.filter(e=>e.metadata.name.toLowerCase().includes(n)||e.metadata.author?.toLowerCase().includes(n)||e.metadata.comment?.toLowerCase().includes(n)||e.metadata.bankChain.some(e=>e.toLowerCase().includes(n)))}return"all"!==a&&(e=e.filter(e=>e.metadata.bankChain.includes(a))),e.sort((e,t)=>{switch(o){case"name":case"date":return e.metadata.name.localeCompare(t.metadata.name);case"author":return(e.metadata.author||"").localeCompare(t.metadata.author||"");default:return 0}}),e},[l,t,a,o]),u=s.useMemo(()=>{const e=new Set;return l.forEach(t=>{t.metadata.bankChain.forEach(t=>e.add(t))}),Array.from(e).sort()},[l]);return bn.jsx("div",{className:"nks-preset-browser fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:bn.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl max-h-[80vh] flex flex-col",children:[bn.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[bn.jsx("h2",{className:"text-xl font-semibold text-white",children:"NKS Preset Browser"}),bn.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:bn.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:bn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),bn.jsxs("div",{className:"p-4 border-b border-gray-700 space-y-3",children:[bn.jsxs("div",{className:"relative",children:[bn.jsx("input",{type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"Search presets...",className:"w-full px-4 py-2 pl-10 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500 outline-none"}),bn.jsx("svg",{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:bn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),bn.jsxs("div",{className:"flex gap-3",children:[bn.jsxs("select",{value:a,onChange:e=>r(e.target.value),className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[bn.jsx("option",{value:"all",children:"All Categories"}),u.map(e=>bn.jsx("option",{value:e,children:e},e))]}),bn.jsxs("select",{value:o,onChange:e=>i(e.target.value),className:"px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[bn.jsx("option",{value:"name",children:"Sort by Name"}),bn.jsx("option",{value:"author",children:"Sort by Author"}),bn.jsx("option",{value:"date",children:"Sort by Date"})]}),bn.jsxs("label",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer transition-colors",children:["Import .nksf",bn.jsx("input",{type:"file",accept:".nksf",onChange:async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.arrayBuffer(),n=await mg(e);if(n){Wg.getState().addPreset(n),c(n)}}catch(n){alert("Failed to import preset file")}},className:"hidden"})]})]})]}),bn.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===d.length?bn.jsxs("div",{className:"text-center text-gray-400 py-8",children:[bn.jsx("p",{children:"No presets found"}),0===l.length&&bn.jsx("p",{className:"text-sm mt-2",children:"Import .nksf files to get started"})]}):bn.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.map((t,n)=>bn.jsxs("button",{onClick:()=>(t=>{c(t),e?.()})(t),className:"text-left p-4 bg-gray-700 hover:bg-gray-600 rounded transition-colors group",children:[bn.jsxs("div",{className:"flex items-start justify-between",children:[bn.jsxs("div",{className:"flex-1 min-w-0",children:[bn.jsx("div",{className:"font-medium text-white truncate group-hover:text-blue-400 transition-colors",children:t.metadata.name}),t.metadata.author&&bn.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["by ",t.metadata.author]}),t.metadata.bankChain.length>0&&bn.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:t.metadata.bankChain.join("  ")}),t.metadata.comment&&bn.jsx("div",{className:"text-xs text-gray-500 mt-2 line-clamp-2",children:t.metadata.comment})]}),bn.jsx("svg",{className:"w-5 h-5 text-gray-500 group-hover:text-blue-400 transition-colors ml-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:bn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),bn.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[Object.keys(t.parameters).length," parameters"]})]},`${t.metadata.uuid}-${n}`))})}),bn.jsxs("div",{className:"p-4 border-t border-gray-700 text-xs text-gray-500",children:["Showing ",d.length," of ",l.length," presets"]})]})})},Rv=e.memo(()=>{const[e,t]=s.useState(!1),[n,a]=s.useState(!1),[r,o]=s.useState(!1),[i,l]=s.useState(!1),c=s.useRef(null),d=Ny(e=>e.isSupported),u=Ny(e=>e.isInitialized),p=Ny(e=>e.lastError),h=Ny(e=>e.inputDevices),m=Ny(e=>e.outputDevices),f=Ny(e=>e.selectedInputId),y=Ny(e=>e.selectedOutputId),g=Ny(e=>e.isLearning),v=Ny(e=>e.lastActivityTimestamp),b=Ny(e=>e.init),x=Ny(e=>e.selectInput),w=Ny(e=>e.selectOutput),k=Ny(e=>e.cancelLearn),S=Ny(e=>e.openPatternDialog);s.useEffect(()=>{u||null!==d||(a(!0),b().finally(()=>a(!1)))},[u,d,b]),s.useEffect(()=>{if(!e)return;const n=e=>{c.current&&!c.current.contains(e.target)&&(t(!1),g&&k())};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[e,g,k]);const[M,N]=s.useState(!1);s.useEffect(()=>{if(v>0){N(!0);const e=setTimeout(()=>N(!1),100);return()=>clearTimeout(e)}},[v]);return bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{className:"relative",ref:c,children:[bn.jsxs("button",{onClick:()=>t(!e),className:`\n          flex items-center gap-2 px-2 py-1 rounded text-sm font-medium\n          transition-all duration-150\n          ${e?"bg-dark-bgActive text-text-primary":"hover:bg-dark-bgHover"}\n          ${null===d||!1===d?"text-text-muted":p?"text-accent-error":u?f||y?"text-accent-success":"text-accent-warning":"text-text-muted"}\n        `,title:d?u?f||y?"MIDI connected":"No MIDI device":"MIDI not initialized":"MIDI not supported",children:[bn.jsxs("div",{className:"relative",children:[bn.jsx(Pe,{size:16}),M&&bn.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-primary rounded-full animate-ping"})]}),bn.jsx("span",{className:"hidden sm:inline",children:"MIDI"})]}),e&&bn.jsxs("div",{className:"absolute right-0 top-full mt-1 w-80 max-h-[80vh] bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl z-50 overflow-y-auto",children:[bn.jsxs("div",{className:"px-4 py-3 border-b border-dark-border bg-dark-bgSecondary",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"MIDI Settings"}),n&&bn.jsx(Ve,{size:14,className:"animate-spin text-accent-primary"})]}),p&&bn.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-accent-error",children:[bn.jsx(De,{size:12}),bn.jsx("span",{children:p})]})]}),!1===d?bn.jsxs("div",{className:"px-4 py-6 text-center",children:[bn.jsx(De,{size:24,className:"mx-auto mb-2 text-text-muted"}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"Web MIDI API is not supported in this browser."}),bn.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Try Chrome, Edge, or Opera."})]}):null===d?bn.jsxs("div",{className:"px-4 py-6 text-center",children:[bn.jsx(Ve,{size:24,className:"mx-auto mb-2 text-text-muted animate-spin"}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"Checking MIDI support..."})]}):bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{className:"px-4 py-3 space-y-3 border-b border-dark-border",children:[bn.jsx(Og,{label:"Input Device",devices:h,selectedId:f,onSelect:x}),bn.jsx(Og,{label:"Output Device",devices:m,selectedId:y,onSelect:w})]}),bn.jsxs("div",{className:"px-4 py-2 border-b border-dark-border space-y-2",children:[bn.jsxs("button",{onClick:()=>{t(!1),o(!0)},className:"w-full px-3 py-2 text-sm font-medium bg-accent-primary/20 border border-accent-primary/30 rounded flex items-center justify-center gap-2 hover:bg-accent-primary/30 transition-colors text-accent-primary",children:[bn.jsx(ze,{size:14}),"MIDI Controller Setup..."]}),bn.jsxs("button",{onClick:()=>{t(!1),S()},className:"w-full px-3 py-2 text-sm font-medium bg-dark-bgActive rounded flex items-center justify-center gap-2 hover:bg-dark-bgHover transition-colors",children:[bn.jsx(Ue,{size:14}),"TD-3 Patterns..."]})]}),bn.jsx("div",{className:"border-t border-dark-border",children:bn.jsx(Fv,{})}),f&&bn.jsx("div",{className:"px-4 py-2 border-t border-dark-border bg-dark-bgSecondary",children:bn.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[bn.jsx(Ge,{size:10,className:M?"text-accent-success":"text-text-muted"}),bn.jsx("span",{children:M?"Receiving MIDI...":"Listening for MIDI input"})]})})]})]})]}),i&&bn.jsx(Dv,{onClose:()=>l(!1)}),bn.jsx(Ug,{isOpen:r,onClose:()=>o(!1)})]})}),jv=({variant:e="default",size:t="md",color:n="default",fullWidth:a=!1,loading:s=!1,icon:r,iconPosition:o="left",children:i,className:l="",disabled:c,...d})=>{const u={primary:"btn-primary",default:"btn",ghost:"btn-ghost",icon:"btn-icon",danger:"btn-danger",ft2:""},p={sm:"btn-sm",md:"btn-md",lg:"btn-lg",icon:""};let h="inline-flex items-center justify-center gap-2 font-medium transition-colors focus:outline-none";if("ft2"===e)h+=` ft2-btn ${{sm:"ft2-btn-small",md:"",lg:"",icon:""}[t]} ${{default:"",red:"ft2-btn-red",green:"ft2-btn-green",yellow:"ft2-btn-yellow",blue:"ft2-btn-blue",purple:"ft2-btn-purple",cyan:"",amber:""}[n]}`;else{h+=` ${u[e]||u.default}`,p[t]&&(h+=` ${p[t]}`)}a&&(h+=" w-full"),(c||s)&&(h+=" opacity-50 cursor-not-allowed"),l&&(h+=` ${l}`);const m=bn.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[bn.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),bn.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return bn.jsxs("button",{...d,className:h,disabled:c||s,children:[s&&m,!s&&r&&"left"===o&&r,i,!s&&r&&"right"===o&&r]})},Lv=({isOpen:e,onClose:t})=>{if(!e)return null;const n=[{name:"Windows",icon:bn.jsx(Be,{size:24}),desc:"Installer (.exe) or Portable (.zip)",color:"text-blue-400"},{name:"macOS",icon:bn.jsx(We,{size:24}),desc:"Disk Image (.dmg) for Intel/Apple Silicon",color:"text-gray-300"},{name:"Linux",icon:bn.jsx($e,{size:24}),desc:"AppImage, Debian, or Tarball",color:"text-orange-400"}];return bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100] animate-fade-in",children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden animate-slide-in-up",children:[bn.jsxs("div",{className:"bg-dark-bgTertiary px-6 py-4 flex items-center justify-between border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:bn.jsx(Ke,{size:20})}),bn.jsxs("div",{children:[bn.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Download DEViLBOX"}),bn.jsx("p",{className:"text-xs text-text-muted font-mono",children:"Native Desktop Applications"})]})]}),bn.jsx(jv,{variant:"icon",size:"icon",onClick:t,"aria-label":"Close dialog",children:bn.jsx(Te,{size:20})})]}),bn.jsxs("div",{className:"p-6",children:[bn.jsx("p",{className:"text-sm text-text-secondary mb-6 leading-relaxed",children:"Experience DEViLBOX with lower latency, better performance, and offline support. Native apps provide full access to system audio and MIDI resources."}),bn.jsx("div",{className:"space-y-3",children:n.map(e=>bn.jsxs("a",{href:"https://github.com/spotUP/DEViLBOX/releases/latest",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-4 p-4 rounded-xl border border-dark-border bg-dark-bg hover:bg-dark-bgHover hover:border-accent-primary/50 transition-all duration-200 shadow-sm",children:[bn.jsx("div",{className:`p-3 rounded-lg bg-dark-bgSecondary ${e.color} group-hover:scale-110 transition-transform duration-200`,children:e.icon}),bn.jsxs("div",{className:"flex-1",children:[bn.jsx("h3",{className:"font-semibold text-text-primary group-hover:text-accent-primary transition-colors",children:e.name}),bn.jsx("p",{className:"text-xs text-text-muted",children:e.desc})]}),bn.jsx(He,{size:16,className:"text-text-muted group-hover:text-text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"})]},e.name))}),bn.jsx("div",{className:"mt-8 pt-6 border-t border-dark-border text-center",children:bn.jsx("p",{className:"text-[10px] text-text-muted font-mono uppercase tracking-widest",children:"Built with Electron & Tone.js"})})]})]})})},Bv={Synth:1,MonoSynth:2,DuoSynth:3,FMSynth:4,AMSynth:5,TB303:10,Sampler:11,WobbleBass:12,DubSiren:13,SpaceLaser:14,V2:20,Synare:15,DrumMachine:16,ChipSynth:17};class Vv{static export(e,t,n,a,s){const r=[];r.push(219,88,78,33),r.push(1),r.push(Math.min(255,a)),r.push(Math.min(255,s));const o=this.getUsedInstrumentIds(t,n),i=e.filter(e=>o.has(e.id));r.push(i.length),r.push(n.length),i.forEach(e=>{r.push(e.id),r.push(Bv[e.synthType]||0),r.push(Math.round((e.volume+60)/60*255)),r.push(Math.round((e.pan+100)/200*255));this.packSynthParams(e).forEach(e=>r.push(e))}),n.forEach(e=>r.push(e));const l=Array.from(new Set(n));return r.push(l.length),l.forEach(e=>{const n=t[e];if(n){r.push(e),r.push(n.length);for(let e=0;e<n.length;e++){const t=[];n.channels.forEach((n,a)=>{const s=n.rows[e];s&&this.isCellActive(s)&&t.push({cell:s,channel:a})}),0!==t.length?(r.push(t.length),t.forEach(({cell:e,channel:t})=>{let n=0;e.note>0&&(n|=8),e.instrument>0&&(n|=4),e.volume>0&&(n|=2),e.effTyp>0&&(n|=1),r.push(t<<4|n),8&n&&r.push(e.note),4&n&&r.push(e.instrument),2&n&&r.push(e.volume),1&n&&(r.push(e.effTyp),r.push(e.eff))})):r.push(0)}}}),new Uint8Array(r)}static getUsedInstrumentIds(e,t){const n=new Set;return t.forEach(t=>{const a=e[t];a&&a.channels.forEach(e=>{e.rows.forEach(e=>{e.instrument>0&&n.add(e.instrument)})})}),n}static isCellActive(e){return e.note>0||e.instrument>0||e.volume>0||e.effTyp>0}static packSynthParams(e){const t=new Array(8).fill(0);return"TB303"===e.synthType&&e.tb303?(t[0]=e.tb303.filter.cutoff,t[1]=e.tb303.filter.resonance,t[2]=e.tb303.filterEnvelope.envMod,t[3]=e.tb303.filterEnvelope.decay):"SpaceLaser"===e.synthType&&e.spaceLaser?(t[0]=e.spaceLaser.laser.sweepTime/2e3*255,t[1]=e.spaceLaser.fm.amount,t[2]=10*e.spaceLaser.fm.ratio,t[3]=e.spaceLaser.filter.cutoff/100):"V2"===e.synthType&&e.v2&&(t[0]=e.v2.osc1.transpose+64,t[1]=e.v2.osc1.detune+64,t[2]=e.v2.filter1.cutoff,t[3]=e.v2.filter1.resonance),t.map(e=>Math.floor(Math.min(255,Math.max(0,e))))}}const zv=({onClose:e})=>{const[t,n]=s.useState(!1),{instruments:a}=Df(),{patterns:r,patternOrder:o}=cm(),{bpm:i,speed:l}=Gf(),c=s.useMemo(()=>Vv.export(a,r,o,i,l),[a,r,o,i,l]),d=s.useMemo(()=>{let e="";const t=new Uint8Array(c),n=t.byteLength;for(let a=0;a<n;a++)e+=String.fromCharCode(t[a]);return window.btoa(e)},[c]),u=s.useMemo(()=>({bytes:c.length,kb:(c.length/1024).toFixed(2),instr:a.length}),[c,a]);return bn.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:bn.jsxs("div",{className:"w-full max-w-2xl bg-[#1a1a1a] border-2 border-amber-500/50 shadow-[0_0_30px_rgba(245,158,11,0.2)] rounded-xl overflow-hidden flex flex-col",children:[bn.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-amber-900/40 to-transparent border-b border-amber-500/30 flex items-center justify-between",children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("div",{className:"p-2 bg-amber-500 rounded-lg",children:bn.jsx(Oe,{size:20,className:"text-black"})}),bn.jsxs("div",{children:[bn.jsx("h2",{className:"text-xl font-bold text-amber-400 tracking-tight",children:"NANO EXPORTER"}),bn.jsx("p",{className:"text-[10px] text-amber-500/60 uppercase font-black tracking-[0.2em]",children:"4k Intro Binary Packing"})]})]}),bn.jsx("button",{onClick:e,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:bn.jsx(Te,{size:20})})]}),bn.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[bn.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[bn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[bn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Total Size"}),bn.jsxs("div",{className:"text-lg font-mono text-white",children:[u.bytes," ",bn.jsx("span",{className:"text-xs text-gray-500",children:"bytes"})]})]}),bn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[bn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Kilobytes"}),bn.jsxs("div",{className:"text-lg font-mono text-white",children:[u.kb," ",bn.jsx("span",{className:"text-xs text-gray-500",children:"KB"})]})]}),bn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[bn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Target"}),bn.jsx("div",{className:"text-lg font-mono text-green-500",children:"4K OK"})]})]}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Binary Data (Base64)"}),bn.jsxs("div",{className:"relative group",children:[bn.jsx("textarea",{readOnly:!0,value:d,className:"w-full h-32 bg-black/60 border border-white/10 rounded-lg p-4 font-mono text-[10px] text-amber-400/80 resize-none focus:outline-none focus:border-amber-500/50"}),bn.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d),n(!0),setTimeout(()=>n(!1),2e3)},className:"absolute top-2 right-2 p-2 bg-amber-500 text-black rounded-md hover:bg-amber-400 transition-colors shadow-lg flex items-center gap-2",children:[t?bn.jsx(je,{size:14}):bn.jsx(qe,{size:14}),bn.jsx("span",{className:"text-[10px] font-bold uppercase",children:t?"Copied":"Copy"})]})]})]}),bn.jsxs("div",{className:"bg-amber-500/5 border border-amber-500/20 p-4 rounded-lg",children:[bn.jsx("h4",{className:"text-xs font-bold text-amber-400 uppercase mb-2",children:"How to use in 4k Intro:"}),bn.jsxs("ul",{className:"text-[11px] text-gray-400 space-y-1 list-disc pl-4",children:[bn.jsx("li",{children:"Copy the Base64 string into your source code."}),bn.jsx("li",{children:"Decode it into a Uint8Array at startup."}),bn.jsx("li",{children:"Parse the fixed-length header (8 bytes)."}),bn.jsx("li",{children:"Precalc (Bake) instruments into RAM using the packed parameters."}),bn.jsx("li",{children:"Use a lightweight replay routine to process the 4-byte packed patterns."})]})]})]}),bn.jsxs("div",{className:"p-6 bg-black/20 border-t border-white/5 flex gap-3",children:[bn.jsxs("button",{onClick:()=>{const e=new Blob([new Uint8Array(c)],{type:"application/octet-stream"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="song.nano",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},className:"flex-1 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg font-bold text-xs text-white transition-all flex items-center justify-center gap-2",children:[bn.jsx(Ye,{size:16}),"DOWNLOAD .NANO"]}),bn.jsx("button",{onClick:e,className:"flex-1 py-3 bg-amber-500 hover:bg-amber-400 text-black rounded-lg font-bold text-xs transition-all",children:"DONE"})]})]})})},Uv=e.memo(()=>{const e=Hf(e=>e.metadata),t=Hf(e=>e.isDirty),n=Kf(e=>e.masterVolume),a=Kf(e=>e.setMasterVolume),r=ey(e=>e.tabs),o=ey(e=>e.activeTabId),i=ey(e=>e.addTab),l=ey(e=>e.closeTab),c=ey(e=>e.setActiveTab),d=ey(e=>e.updateTabName),u=ey(e=>e.markTabDirty),p=sy(e=>e.currentThemeId),h=sy(e=>e.setTheme),m=sy(e=>e.getCurrentTheme),[f,y]=s.useState(!1),[g,v]=s.useState(!1),[b,x]=s.useState(!1),w=m();s.useEffect(()=>{e.name&&o&&d(o,e.name)},[e.name,o,d]),s.useEffect(()=>{o&&u(o,t)},[t,o,u]),s.useEffect(()=>{if(!f)return;const e=e=>{e.target.closest("[data-theme-menu]")||y(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[f]);return bn.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border relative z-40",children:[bn.jsxs("nav",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsx("h1",{className:"font-bold text-lg tracking-tight",children:bn.jsx("span",{className:"text-accent-primary",children:"DEViLBOX"})}),bn.jsxs("span",{className:"text-xs font-medium text-text-inverse bg-accent-primary px-2 py-0.5 rounded cursor-help",title:`${Pg}  2026-02-09`,children:["1.0.",Eg]})]}),bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>x(!0),icon:bn.jsx(Oe,{size:14,className:"text-amber-400"}),className:"text-amber-400 hover:text-amber-300 hover:bg-amber-400/10 border border-amber-400/20",title:"Nano Exporter: Demoscene-grade binary packing",children:"NANO"}),!("undefined"!=typeof window&&!0===window.electron?.isElectron)&&bn.jsx(jv,{variant:"primary",size:"sm",onClick:()=>v(!0),icon:bn.jsx(Ke,{size:14}),iconPosition:"left",title:"Download Desktop App",children:bn.jsx("span",{className:"hidden sm:inline uppercase whitespace-nowrap",children:"Desktop App"})}),bn.jsx(Rv,{}),bn.jsxs("div",{className:"relative","data-theme-menu":!0,children:[bn.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors whitespace-nowrap",title:"Change theme",children:[bn.jsx(Xe,{size:16}),bn.jsx("span",{className:"text-sm",children:w.name})]}),f&&bn.jsx("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[140px]",children:ny.map(e=>bn.jsxs("button",{onClick:()=>{h(e.id),y(!1)},className:`\n                      w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2\n                      ${p===e.id?"bg-dark-bgActive text-text-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"}\n                    `,children:[bn.jsx("span",{className:"w-3 h-3 rounded-full border border-dark-borderLight",style:{backgroundColor:e.colors.accent}}),e.name]},e.id))})]}),bn.jsx("input",{type:"range",value:n,onChange:e=>{const t=parseInt(e.target.value,10);a(t)},min:"-60",max:"0",step:"1",className:"w-24",title:`Volume: ${n} dB`})]})]}),bn.jsxs("div",{className:"flex items-center px-2 py-1 border-b border-dark-border bg-dark-bgTertiary",children:[bn.jsx("div",{className:"flex items-center gap-1 flex-1 overflow-x-auto scrollbar-none",children:r.map(e=>bn.jsxs("button",{onClick:()=>c(e.id),className:`\n                group flex items-center gap-2 px-3 py-1.5 rounded-t-md text-sm font-medium\n                transition-all duration-150 min-w-0 max-w-[200px]\n                ${o===e.id?"bg-dark-bg text-text-primary border-t border-x border-dark-border -mb-px":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary hover:bg-dark-bg/50"}\n              `,children:[bn.jsxs("span",{className:"truncate",children:[e.name||"Untitled",e.isDirty&&bn.jsx("span",{className:"text-accent-primary ml-1",children:"*"})]}),r.length>1&&bn.jsx("span",{onClick:t=>((e,t)=>{e.stopPropagation(),l(t)})(t,e.id),className:`\n                    flex-shrink-0 p-0.5 rounded hover:bg-dark-border/50\n                    ${o===e.id?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:!opacity-100"}\n                  `,children:bn.jsx(Te,{size:12})})]},e.id))}),bn.jsx("button",{onClick:()=>{i()},className:"flex-shrink-0 p-1.5 ml-1 rounded hover:bg-dark-border/50 text-text-muted hover:text-text-primary transition-colors",title:"New project tab",children:bn.jsx(Qe,{size:16})})]}),bn.jsx(Lv,{isOpen:g,onClose:()=>v(!1)}),b&&bn.jsx(zv,{onClose:()=>x(!1)})]})}),Gv=({children:e})=>bn.jsxs("div",{className:"h-screen flex flex-col bg-dark-bg text-text-primary overflow-y-hidden",children:[bn.jsx(Uv,{}),bn.jsx("main",{className:"flex-1 flex min-h-0 overflow-y-hidden",children:e})]}),Kv=(e,t)=>{if(!e||0===e.points.length)return null;const n=e.points;let a=null,s=null;for(let r=0;r<n.length;r++)if(n[r].row<=t&&(a=n[r]),n[r].row>=t){s=n[r];break}if(a&&a.row===t)return a.value;if(s&&s.row===t)return s.value;if(!a&&s)return s.value;if(a&&!s)return a.value;if(a&&s){const e=(t-a.row)/(s.row-a.row);return a.value+(s.value-a.value)*e}return null},Hv=20,Wv=({patternId:e,patternLength:t,rowHeight:n,channelCount:a,channelWidth:r,rowNumWidth:o,scrollOffset:i,visibleStart:l,parameter:c="cutoff",prevPatternId:d,prevPatternLength:u,nextPatternId:p,nextPatternLength:h})=>{const m=Wf(e=>e.curves),f=Wf(e=>e.addPoint),y=Wf(e=>e.removePoint),[g,v]=s.useState(null),b=s.useRef(null),x=s.useMemo(()=>{const t=[];for(let n=0;n<a;n++){const a=m.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===c);t.push(a&&a.points.length>0?a:null)}return t},[e,a,c,m]),w=s.useMemo(()=>{if(!d)return[];const e=[];for(let t=0;t<a;t++){const n=m.find(e=>e.patternId===d&&e.channelIndex===t&&e.parameter===c);e.push(n&&n.points.length>0?n:null)}return e},[d,a,c,m]),k=s.useMemo(()=>{if(!p)return[];const e=[];for(let t=0;t<a;t++){const n=m.find(e=>e.patternId===p&&e.channelIndex===t&&e.parameter===c);e.push(n&&n.points.length>0?n:null)}return e},[p,a,c,m]),S=(e=>({cutoff:"var(--color-synth-filter)",resonance:"var(--color-synth-filter)",envMod:"var(--color-synth-envelope)",decay:"var(--color-synth-envelope)",accent:"var(--color-synth-accent)",overdrive:"var(--color-synth-drive)",distortion:"var(--color-synth-drive)",volume:"var(--color-synth-volume)",pan:"var(--color-synth-pan)",delay:"var(--color-synth-effects)",reverb:"var(--color-synth-effects)"}[e]||"var(--color-synth-filter)"))(c),M=d?u||t:0,N=p?h||t:0,C=M*n+t*n+N*n;if(!(x.some(e=>null!==e)||w.some(e=>null!==e)||k.some(e=>null!==e)))return null;const E=s.useCallback((e,a,s,r,o)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const i=b.current?.getBoundingClientRect();if(!i)return;const l=e.clientY-i.top-o,c=Math.floor(l/n);if(c<0||c>=t)return;const d=e.clientX-i.left-r,u=Math.max(0,Math.min(1,(d-1)/18));f(a.id,c,u),v({curveId:a.id,row:c,channelIndex:s})},[t,n,f]),P=s.useCallback(e=>{if(!g||!b.current)return;const a=b.current.getBoundingClientRect(),s=x[g.channelIndex];if(!s)return;const o=g.channelIndex*r+r-Hv-4,i=M*n,l=e.clientY-a.top-i,c=Math.floor(l/n);if(c<0||c>=t)return;const d=e.clientX-a.left-o,u=Math.max(0,Math.min(1,(d-1)/18));f(s.id,c,u)},[g,x,r,M,n,t,f]),T=s.useCallback(()=>{v(null)},[]),A=s.useCallback((e,a,s)=>{const r=b.current?.getBoundingClientRect();if(!r)return;const o=e.clientY-r.top-s,i=Math.floor(o/n);if(i<0||i>=t)return;a.points.find(e=>e.row===i)&&y(a.id,i)},[t,n,y]),I=(e,t,a,s,o,i)=>e.map((e,l)=>{if(!e)return null;const c=l*r+r-Hv-4,d=t*n,u=a*n,p=[],h=[`M 20 ${d}`];for(let a=0;a<t;a++){const t=Kv(e,a);if(null!==t){const e=18*t+1,s=a*n+n/2;p.push(`${0===p.length?"M":"L"} ${e} ${s}`)}}for(let a=t-1;a>=0;a--){const t=Kv(e,a);if(null!==t){const e=18*t+1,s=a*n+n/2;h.push(`L ${e} ${s}`)}}return h.push("L 20 0 Z"),bn.jsx("div",{style:{position:"absolute",left:c,top:u,width:Hv,height:d,cursor:i?"crosshair":"default"},onMouseDown:i?t=>E(t,e,l,c,u):void 0,onDoubleClick:i?t=>A(t,e,u):void 0,children:bn.jsxs("svg",{width:Hv,height:d,children:[bn.jsx("path",{d:h.join(" "),fill:S,fillOpacity:.1*s}),bn.jsx("path",{d:p.join(" "),fill:"none",stroke:S,strokeWidth:1.5,strokeOpacity:.6*s,strokeLinecap:"round",strokeLinejoin:"round"}),1===s&&e.points.map((e,t)=>bn.jsx("circle",{cx:18*e.value+1,cy:e.row*n+n/2,r:2,fill:S,fillOpacity:.8},t))]})},`${o}-${l}`)});return bn.jsxs("div",{ref:b,className:"automation-lanes",style:{position:"absolute",top:i-l*n-M*n,left:o,right:0,height:C,zIndex:5},onMouseMove:P,onMouseUp:T,onMouseLeave:T,children:[w.length>0&&I(w,M,0,.5,"prev",!1),I(x,t,M,1,"current",!0),k.length>0&&I(k,N,M+t,.5,"next",!1)]})},$v=e.memo(({level:e,isActive:t})=>null);$v.displayName="ChannelVUMeter";const qv=25,Yv=(e,t,n=0)=>{if(!t)return{bg:"transparent",glow:"none"};const a=`hsl(${n}, ${180===n?100:75+10*e}%, ${180===n?45+15*e:40+20*e}%)`;return{bg:a,glow:`0 0 6px ${a}`}},Xv=s.memo(({channelWidth:e,scrollLeft:t=0})=>{const{patterns:n,currentPatternIndex:a}=cm(On(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),r=sy(e=>e.currentThemeId),o=jf(e=>e.performanceQuality),i=n[a],l=i?.channels.length||4,c=s.useRef(null),d=s.useRef([]),u=s.useRef([]),p=s.useRef([]),h=s.useRef(null),m=s.useRef(200),f="cyan-lineart"===r?180:0;s.useEffect(()=>{p.current=Array(l).fill(null).map((e,t)=>({level:0,position:(t%2==0?-1:1)*qv*.5,direction:t%2==0?1:-1})),d.current=Array(l).fill(null),u.current=Array(l).fill(null).map(()=>Array(26).fill(null))},[l]),s.useEffect(()=>{const e=()=>{c.current&&(m.current=c.current.clientHeight,d.current.forEach(e=>{e&&(e.style.height=m.current-4+"px")}))};e();const t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);const y=s.useCallback(()=>{const e=em().getChannelTriggerLevels(l);c.current&&(c.current.style.transform=`translateX(${-t}px)`);for(let t=0;t<l;t++){const n=p.current[t];if(!n)continue;const a=e[t]||0,s=.012*t;if(a>0)n.level=a;else{const e=.92-s;n.level=n.level*e,n.level<.01&&(n.level=0)}if(n.level>.02){const e=Math.abs(n.position)/qv,t=.8*(1-.7*Math.max(0,(e-.7)/.3));n.position+=t*n.direction,n.position>=qv?(n.position=qv,n.direction=-1):n.position<=-25&&(n.position=-25,n.direction=1)}const r=d.current[t];r&&(r.style.transform=`translateX(${n.position}px)`);const o=Math.round(26*n.level),i=u.current[t];if(i)for(let e=0;e<26;e++){const t=i[e];if(!t)continue;const n=e<o,a=e/25,{bg:s,glow:r}=Yv(a,n,f);t.style.backgroundColor=s,t.style.boxShadow=r}}h.current=requestAnimationFrame(y)},[l,f,t]);if(s.useEffect(()=>{if("low"!==o)return h.current=requestAnimationFrame(y),()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)};h.current&&(cancelAnimationFrame(h.current),h.current=null)},[y,o]),"low"===o)return null;const g=e||260;return bn.jsx("div",{ref:c,className:"vu-meters-overlay",children:Array(l).fill(0).map((t,n)=>{const a=(t=>{if(e)return t*g+g/2;if(!i)return t*g+g/2;let n=0;for(let e=0;e<t;e++){const t=i.channels[e]?.collapsed;n+=t?60:g}return n+(i.channels[t]?.collapsed?60:g)/2})(n);return bn.jsx("div",{ref:e=>{d.current[n]=e},className:"vu-meter-vertical",style:{left:a-14+"px",width:"28px",height:m.current-4+"px",display:"flex",flexDirection:"column-reverse",alignItems:"stretch",gap:"4px"},children:Array.from({length:26},(e,t)=>bn.jsx("div",{ref:e=>{u.current[n]||(u.current[n]=[]),u.current[n][t]=e},style:{height:"4px",backgroundColor:"transparent",borderRadius:"1px"}},t))},n)})})});Xv.displayName="ChannelVUMeters";var Qv=l();const Zv=({currentColor:e,onColorSelect:t})=>{const[n,a]=s.useState(!1),[r,o]=s.useState({top:0,left:0}),i=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{if(n&&i.current){const e=i.current.getBoundingClientRect();o({top:e.bottom+4,left:e.left})}},[n]),s.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&i.current&&!i.current.contains(e.target)&&a(!1)};if(n)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&a(!1)};if(n)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const c=n?bn.jsxs("div",{ref:l,className:"fixed bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-2 animate-fade-in",style:{top:r.top,left:r.left,zIndex:9999,minWidth:"140px"},children:[bn.jsx("div",{className:"text-xs text-text-muted mb-2 px-1",children:"Channel Color"}),bn.jsx("div",{className:"grid grid-cols-4 gap-1",children:Jn.map((n,s)=>bn.jsx("button",{type:"button",onClick:e=>((e,n)=>{n.stopPropagation(),t(e),a(!1)})(n,e),className:"w-7 h-7 rounded border-2 transition-all flex items-center justify-center "+(e===n?"border-accent-primary scale-110":"border-transparent hover:border-dark-borderLight hover:scale-105"),style:{backgroundColor:n||"transparent"},title:n||"No color",children:null===n&&bn.jsx(Te,{size:14,className:"text-text-muted"})},s))})]}):null;return bn.jsxs(bn.Fragment,{children:[bn.jsx("button",{ref:i,type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),a(!n)},className:"p-1 rounded transition-colors "+(e?"text-text-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),style:e?{color:e}:void 0,title:"Channel Color",children:bn.jsx(Xe,{size:12})}),c&&Qv.createPortal(c,document.body)]})},Jv=({items:e,position:t,onClose:n,className:a=""})=>{const r=s.useRef(null),[o,i]=s.useState(t),[l,c]=s.useState(null),[d,u]=s.useState(null),p=s.useRef(null);s.useEffect(()=>{if(!t||!r.current)return;const e=r.current.getBoundingClientRect(),n=window.innerWidth,a=window.innerHeight;let s=t.x,o=t.y;s+e.width>n-10&&(s=n-e.width-10),s<10&&(s=10),o+e.height>a-10&&(o=a-e.height-10),o<10&&(o=10),i({x:s,y:o})},[t]),s.useEffect(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&n()},t=e=>{"Escape"===e.key&&n()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),p.current&&clearTimeout(p.current)}},[n]);const h=s.useCallback((e,t)=>{p.current&&(clearTimeout(p.current),p.current=null);const n=t.getBoundingClientRect();c(e),u({x:n.right-2,y:n.top-4})},[]),m=s.useCallback(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(null),u(null)},300)},[]),f=s.useCallback(()=>{p.current&&(clearTimeout(p.current),p.current=null)},[]);return t?Qv.createPortal(bn.jsx("div",{ref:r,className:`\n        fixed z-[100] min-w-[180px] py-1\n        bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl\n        ${a}\n      `,style:{left:o?.x??t.x,top:o?.y??t.y},onMouseEnter:f,children:0===e.length?bn.jsx("div",{className:"px-4 py-2 text-xs text-text-muted italic",children:"Empty"}):e.map((e,t)=>{if(!e)return null;if("divider"===e.type)return bn.jsx("div",{className:"h-px bg-dark-border my-1 mx-2"},`divider-${t}`);const a=e.submenu&&e.submenu.length>0;return bn.jsxs("div",{className:`\n                flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer transition-colors\n                ${e.disabled?"opacity-50 cursor-not-allowed":"hover:bg-dark-bgHover"}\n                ${e.danger?"text-accent-error hover:bg-accent-error/10":"text-text-secondary"}\n                ${l===e.id?"bg-dark-bgHover":""}\n              `,onClick:()=>{e.disabled||a||(e.onClick?.(),n())},onMouseEnter:t=>{a?h(e.id,t.currentTarget):(c(null),u(null))},onMouseLeave:()=>{a&&m()},children:[void 0!==e.checked&&bn.jsx("span",{className:"w-4 flex justify-center",children:e.radio?e.checked?bn.jsx(Ze,{size:8,className:"fill-accent-primary text-accent-primary"}):null:e.checked?bn.jsx(je,{size:14,className:"text-accent-primary"}):null}),e.icon&&bn.jsx("span",{className:"w-4 flex justify-center",children:e.icon}),bn.jsx("span",{className:"flex-1",children:e.label}),e.shortcut&&bn.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.shortcut}),a&&bn.jsx(Re,{size:14,className:"text-text-muted"}),a&&l===e.id&&d&&bn.jsx(eb,{items:e.submenu,position:d,onClose:n})]},e.id)})}),document.body):null},eb=e=>bn.jsx(Jv,{...e}),tb=()=>{const[e,t]=s.useState(null);return{position:e,open:s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY})},[]),close:s.useCallback(()=>{t(null)},[]),isOpen:null!==e}},nb=({items:e,children:t,className:n="",disabled:a=!1})=>{const r=s.useRef(null),[o,i]=s.useState(!1),[l,c]=s.useState(null),d=s.useCallback(()=>{if(!a&&r.current){const e=r.current.getBoundingClientRect();c({x:e.left,y:e.bottom+4}),i(!0)}},[a]),u=s.useCallback(()=>{i(!1),c(null)},[]);return bn.jsxs(bn.Fragment,{children:[bn.jsx("button",{ref:r,onClick:d,disabled:a,className:n,children:t}),o&&l&&bn.jsx(Jv,{items:e,position:l,onClose:u})]})},ab=()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),sb=(e,t,n=64,a=!1)=>({note:e,instrument:t,volume:16+n,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:a?1:0});const rb={"4on4":{name:"4/4 Kicks",description:"Every 4 rows on beat",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[];for(let i=0;i<t;i++)if(i%4==0){const e=i%16==0;o.push(sb(a,n,s,r||e))}else o.push(ab());return o}},offbeat:{name:"Offbeat",description:"Every 4 rows, offset by 2",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56,accent:r}=e,o=[];for(let i=0;i<t;i++)(i+2)%4==0?o.push(sb(a,n,s,r)):o.push(ab());return o}},"8ths":{name:"8th Notes",description:"Every 2 rows",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56,accent:r}=e,o=[];for(let i=0;i<t;i++)if(i%2==0){const e=i%8==0;o.push(sb(a,n,e?s:s-8,r))}else o.push(ab());return o}},"16ths":{name:"16th Notes",description:"Every row",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=48,accent:r}=e,o=[];for(let i=0;i<t;i++){const e=i%4==0?s:i%2==0?s-8:s-16;o.push(sb(a,n,Math.max(16,e),r))}return o}},backbeat:{name:"Backbeat (2&4)",description:"Snare on beats 2 and 4",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[];for(let i=0;i<t;i++)i%16==4||i%16==12?o.push(sb(a,n,s,r)):o.push(ab());return o}},random:{name:"Random",description:"30% density random fill",category:"general",generate:e=>function(e,t=.3){const{patternLength:n,instrumentId:a,note:s,velocity:r=64,accent:o}=e,i=[];for(let l=0;l<n;l++)if(Math.random()<t){const e=Math.max(32,r-Math.floor(16*Math.random())),t=o||Math.random()<.25;i.push(sb(s,a,e,t))}else i.push(ab());return i}(e,.3)},build:{name:"Build",description:"Increasing density for transitions",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[],i=t/4;for(let l=0;l<t;l++){const e=Math.floor(l/i);let t;switch(e){case 0:t=8;break;case 1:default:t=4;break;case 2:t=2;break;case 3:t=1}if(l%t===0){const t=Math.min(64,s-16+8*e);o.push(sb(a,n,t,r))}else o.push(ab())}return o}},breakdown:{name:"Breakdown",description:"Sparse, minimal pattern",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=48,accent:r}=e,o=[];for(let i=0;i<t;i++)i%16==0?o.push(sb(a,n,s,r)):o.push(ab());return o}},syncopated:{name:"Syncopated",description:"Offbeat acid pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[],i=[0,3,8,11,14];for(let l=0;l<t;l++){const e=l%16;if(i.includes(e)){const t=3===e||11===e,i=sb(a,n,s,r);i.flag2=t?2:0,o.push(i)}else o.push(ab())}return o}},walking:{name:"Walking Bass",description:"Simple ascending pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56}=e,r=[],o=a||Ba("C-4"),i=Ha(o);if(null===i)return r;const l=e=>{const t=i+e;return t>=12&&t<=107?Wa(t):o},c=[0,5,7,5];for(let d=0;d<t;d++)if(d%4==0){const e=l(c[Math.floor(d/4)%c.length]);r.push(sb(e,n,s,!1))}else r.push(ab());return r}},hiHats:{name:"Hi-Hats",description:"Open/closed hat pattern",category:"drums",generate:function(e,t){const{patternLength:n,instrumentId:a,note:s,velocity:r=56,accent:o}=e,i=[],l=t||Ba("A#3");for(let c=0;c<n;c++)if(c%2==0){const e=(c+4)%8==0,t=e?l:s,n=e?r:r-8;i.push(sb(t,a,n,o))}else i.push(ab());return i}},clear:{name:"Clear",description:"Remove all notes",category:"general",generate:e=>{return t=e.patternLength,Array(t).fill(null).map(()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));var t}}},ob=[{name:"Clean Master",description:"Subtle compression and EQ for polished output",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1,mid:0,high:.5}}]},{name:"Transparent",description:"Very light processing, preserves dynamics",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:2,attack:.02,release:.3}}]},{name:"Stereo Wide",description:"Clean stereo enhancement for wider soundstage",category:"Clean",effects:[{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:2.5,attack:.015,release:.25}}]},{name:"Club Ready",description:"Punchy compression with subs, ready for the dancefloor",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}]},{name:"Techno Master",description:"Hard compression and subs for driving techno",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:15,parameters:{distortion:.15}}]},{name:"Acid House",description:"Warm compression with subtle room reverb",category:"Club",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3.5,attack:.01,release:.2}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:1.5,preDelay:.01}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Deep House",description:"Smooth and warm with controlled dynamics",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:1,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2.5,attack:.02,release:.3}},{category:"tonejs",type:"Chorus",enabled:!0,wet:15,parameters:{frequency:.5,depth:.3}}]},{name:"Lo-Fi Crunch",description:"Bit-crushed and filtered for retro vibes",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:40,parameters:{bits:8}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:8e3,type:"lowpass",Q:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Tape Warmth",description:"Subtle saturation and filtering like vintage tape",category:"Lo-Fi",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.2}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:12e3,type:"lowpass",Q:.7}},{category:"tonejs",type:"Chorus",enabled:!0,wet:8,parameters:{frequency:.2,depth:.15}}]},{name:"VHS Vibe",description:"Wobbly and degraded like old VHS audio",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:25,parameters:{bits:12}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:30,parameters:{frequency:4,depth:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:15,parameters:{decay:1.2,preDelay:.02}}]},{name:"Ambient Space",description:"Lush reverb and delay for atmospheric soundscapes",category:"Ambient",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.4,feedback:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2,attack:.05,release:.4}}]},{name:"Dreamy Haze",description:"Soft and floaty with modulated delays",category:"Ambient",effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:35,parameters:{frequency:.3,depth:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:55,parameters:{decay:6,preDelay:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:5e3,type:"lowpass",Q:.5}}]},{name:"Cathedral",description:"Massive reverb for epic, cavernous sound",category:"Ambient",effects:[{category:"tonejs",type:"JCReverb",enabled:!0,wet:60,parameters:{roomSize:.9}},{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{delayTime:.25,feedback:.3}}]},{name:"Underwater",description:"Filtered and submerged atmospheric effect",category:"Ambient",effects:[{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:1200,type:"lowpass",Q:2}},{category:"tonejs",type:"Chorus",enabled:!0,wet:40,parameters:{frequency:.4,depth:.6}},{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:4,preDelay:.03}}]},{name:"Industrial",description:"Harsh distortion and compression for aggressive sound",category:"Aggressive",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:45,parameters:{distortion:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:2,high:4}}]},{name:"Crushed",description:"Heavy bit-crushing and distortion",category:"Aggressive",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:60,parameters:{bits:6}},{category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:10,attack:.001,release:.05}}]},{name:"Hardstyle",description:"Punchy kick-focused processing for hard dance",category:"Aggressive",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.002,release:.08}},{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.3}}]},{name:"Gabber",description:"Extreme compression and saturation for hardcore",category:"Aggressive",effects:[{category:"tonejs",type:"Chebyshev",enabled:!0,wet:50,parameters:{order:8}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-6,ratio:20,attack:5e-4,release:.03}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:0,high:5}}]},{name:"Dub Station",description:"Space Echo and Bi-Phase for authentic dub vibes",category:"Dub",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:40,parameters:{mode:4,rate:300,intensity:.6,echoVolume:.8,reverbVolume:.2}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0}}]},{name:"Sound System",description:"Heavy subs and performance filtering",category:"Dub",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:-2,high:1}},{category:"tonejs",type:"DubFilter",enabled:!0,wet:100,parameters:{cutoff:20,resonance:15,gain:1.2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]}],ib=({channelIndex:e,channel:t,patternId:n,patternLength:a,onFillPattern:r,onClearChannel:o,onCopyChannel:i,onCutChannel:l,onPasteChannel:c,onTranspose:d,onHumanize:u,onInterpolate:p,onAcidGenerator:h})=>{const{isLiveMode:m,queueChannelAction:f}=Ey(),{toggleChannelMute:y,toggleChannelSolo:g,removeChannel:v,setChannelColor:b,patterns:x}=cm(),{setActiveParameter:w,setShowLane:k,getShowLane:S,removeCurve:M,getCurvesForPattern:N}=Wf(),{updateInstrument:C}=Df(),E=s.useCallback(n=>{const a=ob.find(e=>e.name===n);if(!a||!t.instrumentId)return;const s=a.effects.map((e,t)=>({...e,id:`channel-fx-${Date.now()}-${t}`}));C(t.instrumentId,{effects:s}),iy.success(`Applied ${a.name} to CH ${(e+1).toString().padStart(2,"0")}`)},[t.instrumentId,e,C]),P=S(e),T=N(n,e),A=T.length>0,I=[{id:"cutoff",label:"Cutoff",color:"#4f9d69"},{id:"resonance",label:"Resonance",color:"#3b82f6"},{id:"envMod",label:"Env Mod",color:"#f59e0b"},{id:"volume",label:"Volume",color:"#ef4444"},{id:"pan",label:"Pan",color:"#8b5cf6"},{id:"decay",label:"Decay",color:"#06b6d4"}],_=s.useMemo(()=>m?[{id:"trigger",label:"Trigger",icon:bn.jsx(Oe,{size:14}),submenu:[{id:"trigger-kicks",label:"4/4 Kicks",onClick:()=>{f(e,{type:"trigger",pattern:"kicks"}),r(e,"4on4")}},{id:"trigger-build",label:"Build",onClick:()=>{f(e,{type:"trigger",pattern:"build"}),r(e,"build")}},{id:"trigger-drop",label:"Drop",onClick:()=>{f(e,{type:"trigger",pattern:"drop"}),r(e,"16ths")}},{id:"trigger-breakdown",label:"Breakdown",onClick:()=>{f(e,{type:"trigger",pattern:"breakdown"}),r(e,"breakdown")}}]},{id:"stutter",label:"Stutter",icon:bn.jsx(Je,{size:14}),onClick:()=>f(e,{type:"stutter"})},{id:"roll",label:"Roll",icon:bn.jsx(Ae,{size:14}),submenu:[{id:"roll-4",label:"1/4 Note",onClick:()=>f(e,{type:"roll",division:"1/4"})},{id:"roll-8",label:"1/8 Note",onClick:()=>f(e,{type:"roll",division:"1/8"})},{id:"roll-16",label:"1/16 Note",onClick:()=>f(e,{type:"roll",division:"1/16"})}]},{type:"divider"},{id:"automation",label:"Automation",icon:bn.jsx(et,{size:14}),submenu:[{id:"auto-sweep-up",label:"Filter Sweep Up",onClick:()=>f(e,{type:"filterSweep",direction:"up",bars:4})},{id:"auto-sweep-down",label:"Filter Sweep Down",onClick:()=>f(e,{type:"filterSweep",direction:"down",bars:4})},{id:"auto-fade-in",label:"Volume Fade In",onClick:()=>f(e,{type:"volumeFade",direction:"in",bars:4})},{id:"auto-fade-out",label:"Volume Fade Out",onClick:()=>f(e,{type:"volumeFade",direction:"out",bars:4})},{type:"divider"},{id:"auto-show-cutoff",label:"Show Cutoff",onClick:()=>{w(e,"cutoff"),k(e,!0)}},{id:"auto-show-volume",label:"Show Volume",onClick:()=>{w(e,"volume"),k(e,!0)}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?bn.jsx(tt,{size:14}):bn.jsx(nt,{size:14}),checked:t.muted,onClick:()=>y(e)},{id:"solo",label:"Solo",icon:bn.jsx(at,{size:14}),checked:t.solo,onClick:()=>g(e)},{id:"kill",label:"Kill",icon:bn.jsx(Oe,{size:14}),danger:!0,onClick:()=>{f(e,{type:"kill"}),y(e)}}]:[{id:"fill",label:"Fill",icon:bn.jsx(_e,{size:14}),submenu:[{id:"fill-4on4",label:rb["4on4"].name,onClick:()=>r(e,"4on4")},{id:"fill-offbeat",label:rb.offbeat.name,onClick:()=>r(e,"offbeat")},{id:"fill-backbeat",label:rb.backbeat.name,onClick:()=>r(e,"backbeat")},{id:"fill-hihats",label:rb.hiHats.name,onClick:()=>r(e,"hiHats")},{type:"divider"},{id:"fill-8ths",label:rb["8ths"].name,onClick:()=>r(e,"8ths")},{id:"fill-16ths",label:rb["16ths"].name,onClick:()=>r(e,"16ths")},{id:"fill-random",label:rb.random.name,onClick:()=>r(e,"random")},{id:"fill-acid",label:" Acid Generator...",icon:bn.jsx(st,{size:14}),onClick:()=>h(e)},{type:"divider"},{id:"fill-syncopated",label:rb.syncopated.name,onClick:()=>r(e,"syncopated")},{id:"fill-walking",label:rb.walking.name,onClick:()=>r(e,"walking")},{type:"divider"},{id:"fill-build",label:rb.build.name,onClick:()=>r(e,"build")},{id:"fill-breakdown",label:rb.breakdown.name,onClick:()=>r(e,"breakdown")}]},{id:"clear",label:"Clear Channel",icon:bn.jsx(Le,{size:14}),onClick:()=>o(e)},{id:"copy",label:"Copy Track",icon:bn.jsx(qe,{size:14}),onClick:()=>i(e)},{id:"cut",label:"Cut Track",icon:bn.jsx(rt,{size:14}),onClick:()=>l(e)},{id:"paste",label:"Paste Track",icon:bn.jsx(ot,{size:14}),onClick:()=>c(e)},{type:"divider"},{id:"fx-presets",label:"FX Presets",icon:bn.jsx(it,{size:14}),submenu:(()=>{const e={};return ob.forEach(t=>{const n=t.category||"General";e[n]||(e[n]=[]),e[n].push(t)}),Object.keys(e).sort().map(t=>({id:`fx-cat-${t.toLowerCase()}`,label:t,submenu:e[t].map(e=>({id:`fx-preset-${e.name.replace(/\s+/g,"-")}`,label:e.name,onClick:()=>E(e.name)}))}))})()},{type:"divider"},{id:"transpose",label:"Transpose",icon:bn.jsx(Ue,{size:14}),submenu:[{id:"transpose-12",label:"+12 (Octave Up)",onClick:()=>d(e,12)},{id:"transpose-7",label:"+7 (Fifth)",onClick:()=>d(e,7)},{id:"transpose-1",label:"+1 (Semitone)",onClick:()=>d(e,1)},{type:"divider"},{id:"transpose--1",label:"-1 (Semitone)",onClick:()=>d(e,-1)},{id:"transpose--7",label:"-7 (Fifth)",onClick:()=>d(e,-7)},{id:"transpose--12",label:"-12 (Octave Down)",onClick:()=>d(e,-12)}]},{id:"humanize",label:"Humanize",icon:bn.jsx(st,{size:14}),shortcut:"Ctrl+H",onClick:()=>u(e)},{id:"interpolate",label:"Interpolate",icon:bn.jsx(lt,{size:14}),shortcut:"Ctrl+I",onClick:()=>p(e)},{type:"divider"},{id:"automation",label:"Automation",icon:bn.jsx(ut,{size:14}),submenu:[...I.map(t=>({id:`auto-${t.id}`,label:t.label,icon:bn.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),onClick:()=>{w(e,t.id),k(e,!0)}})),{type:"divider"},{id:"auto-toggle-lane",label:P?"Hide Lane":"Show Lane",icon:P?bn.jsx(ct,{size:14}):bn.jsx(dt,{size:14}),onClick:()=>k(e,!P)},{id:"auto-clear-all",label:"Clear All Automation",icon:bn.jsx(Le,{size:14}),danger:!0,disabled:!A,onClick:()=>{T.forEach(e=>M(e.id))}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?bn.jsx(tt,{size:14}):bn.jsx(nt,{size:14}),checked:t.muted,onClick:()=>y(e)},{id:"solo",label:"Solo",icon:bn.jsx(at,{size:14}),checked:t.solo,onClick:()=>g(e)},{id:"color",label:"Color",icon:bn.jsx(Xe,{size:14}),submenu:Jn.map((n,a)=>({id:`color-${a}`,label:null===n?"None":"",icon:n?bn.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:n}}):bn.jsx("span",{className:"w-4 h-4 rounded border border-dark-border"}),checked:t.color===n,onClick:()=>b(e,n)}))},{id:"delete",label:"Delete Channel",icon:bn.jsx(pt,{size:14}),danger:!0,disabled:x[0]?.channels.length<=1,onClick:()=>v(e)}],[m,e,t,P,A,T,x,r,o,i,l,c,d,u,p,h,y,g,v,b,f,w,k,M,E]);return bn.jsx(nb,{items:_,className:`\n        p-1 rounded transition-colors\n        ${m?"text-accent-error hover:bg-accent-error/20":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"}\n      `,children:bn.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[bn.jsx("circle",{cx:"12",cy:"12",r:"1"}),bn.jsx("circle",{cx:"12",cy:"5",r:"1"}),bn.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})},lb=({position:e,onClose:t,rowIndex:n,channelIndex:a,onInterpolate:r,onHumanize:o,onStrum:i,onLegato:l,onOpenParameterEditor:c})=>{const{patterns:d,currentPatternIndex:u,setCell:p,cursor:h,selectColumn:m,selectChannel:f}=cm(),y=d[u],g=s.useCallback(()=>{if(!y)return;const e=y.channels[a].rows[n];localStorage.setItem("devilbox-cell-clipboard",JSON.stringify(e))},[y,a,n]),v=s.useCallback(()=>{g(),p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[g,p,a,n]),b=s.useCallback(()=>{const e=localStorage.getItem("devilbox-cell-clipboard");if(e)try{const t=JSON.parse(e);p(a,n,t)}catch(t){}},[p,a,n]),x=s.useCallback(()=>{p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[p,a,n]),w=s.useCallback(()=>{if(y){for(let e=y.length-1;e>n;e--){const t=y.channels[a].rows[e-1];p(a,e,t)}p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,a,n,p]),k=s.useCallback(()=>{if(y){for(let e=n;e<y.length-1;e++){const t=y.channels[a].rows[e+1];p(a,e,t)}p(a,y.length-1,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,a,n,p]),S=s.useCallback(()=>{m(a,h.columnType),t()},[a,h.columnType,m,t]),M=s.useCallback(()=>{f(a),t()},[a,f,t]),N=s.useMemo(()=>[{id:"cut",label:"Cut",icon:bn.jsx(rt,{size:14}),shortcut:"Ctrl+X",onClick:v},{id:"copy",label:"Copy",icon:bn.jsx(qe,{size:14}),shortcut:"Ctrl+C",onClick:g},{id:"paste",label:"Paste",icon:bn.jsx(ot,{size:14}),shortcut:"Ctrl+V",onClick:b},{id:"clear",label:"Clear",icon:bn.jsx(Le,{size:14}),shortcut:"Del",onClick:x},{type:"divider"},{id:"insert-row",label:"Insert Row",icon:bn.jsx(ht,{size:14}),shortcut:"Ins",onClick:w},{id:"delete-row",label:"Delete Row",icon:bn.jsx(mt,{size:14}),shortcut:"Backspace",onClick:k},{type:"divider"},{id:"interpolate",label:"Interpolate",icon:bn.jsx(lt,{size:14}),shortcut:"Ctrl+I",onClick:r},{id:"humanize",label:"Humanize",icon:bn.jsx(st,{size:14}),shortcut:"Ctrl+H",onClick:o},{id:"strum",label:"Strum/Arpeggiate",icon:bn.jsx(_e,{size:14}),onClick:i},{id:"legato",label:"Legato (Connect Notes)",icon:bn.jsx(ft,{size:14}),onClick:l},{type:"divider"},{id:"param-editor",label:"Visual Parameter Editor",icon:bn.jsx(yt,{size:14}),submenu:[{id:"param-volume",label:"Edit Volume...",onClick:()=>c?.("volume")},{id:"param-effect",label:"Edit Effect Type...",onClick:()=>c?.("effect")},{id:"param-effectparam",label:"Edit Effect Parameter...",onClick:()=>c?.("effectParam")}]},{type:"divider"},{id:"select-column",label:"Select Column",icon:bn.jsx(gt,{size:14}),onClick:S},{id:"select-channel",label:"Select Channel",icon:bn.jsx(vt,{size:14}),onClick:M}],[v,g,b,x,w,k,r,o,i,l,c,S,M]);return e?bn.jsx(Jv,{items:N,position:e,onClose:t}):null},cb={volume:{label:"Volume",min:0,max:64,default:64,color:"#22c55e",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effectParam:{label:"Effect Parameter",min:0,max:255,default:0,color:"#f59e0b",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effect:{label:"Effect Type",min:0,max:35,default:0,color:"#8b5cf6",format:e=>e<10?e.toString():String.fromCharCode(55+e)},note:{label:"Note",min:0,max:119,default:48,color:"#3b82f6",format:e=>{const t=Math.floor(e/12);return`${["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"][e%12]}${t}`}},instrument:{label:"Instrument",min:0,max:99,default:1,color:"#ec4899",format:e=>e.toString().padStart(2,"0")}},db=({onClose:e,channelIndex:t,startRow:n,endRow:a,field:r})=>{const o=s.useRef(null),i=s.useRef(null),[l,c]=s.useState(!1),[d,u]=s.useState("overwrite"),[p,h]=s.useState([]),[m,f]=s.useState(null),y=jf(e=>e.useHexNumbers),g=cm(e=>e.patterns),v=cm(e=>e.currentPatternIndex),b=cm(e=>e.setCell),x=cb[r],w=a-n+1,k=12,S=20,M=Math.max(400,14*w+40),N=200;s.useEffect(()=>{const e=g[v];if(!e)return;const s=e.channels[t];if(!s)return;const o=[];for(let t=n;t<=a;t++){const e=s.rows[t];if(!e){o.push(x.default);continue}let n=x.default;switch(r){case"volume":n=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(n=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(n=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(n=e.note);break;case"instrument":n=e.instrument??x.default}o.push(n)}h(o)},[g,v,t,n,a,r,x.default]);const C=s.useCallback(()=>{const e=o.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#1a1a2e",t.fillRect(0,0,M,N),t.strokeStyle="#2a2a4a",t.lineWidth=1;for(let n=0;n<=4;n++){const e=S+n/4*160;t.beginPath(),t.moveTo(S,e),t.lineTo(M-S,e),t.stroke();const a=Math.round(x.max-(x.max-x.min)*(n/4));t.fillStyle="#666",t.font="10px monospace",t.textAlign="right",t.fillText(x.format(a),16,e+3)}(m||p).forEach((e,a)=>{const s=S+14*a,r=160*((e-x.min)/(x.max-x.min)),o=180-r,i=t.createLinearGradient(s,o,s,180);i.addColorStop(0,x.color),i.addColorStop(1,x.color+"40"),t.fillStyle=i,t.fillRect(s,o,k,r),t.strokeStyle=x.color,t.lineWidth=1,t.strokeRect(s,o,k,r),(n+a)%4==0&&(t.fillStyle="#888",t.font="9px monospace",t.textAlign="center",t.fillText(y?(n+a).toString(16).toUpperCase().padStart(2,"0"):(n+a).toString().padStart(2,"0"),s+6,196))})},[p,m,M,N,x,n,y]);s.useEffect(()=>{C()},[C]);const E=s.useCallback(e=>{const t=o.current;if(!t)return null;const n=t.getBoundingClientRect(),a=e.clientX-n.left,s=e.clientY-n.top,r=Math.floor((a-S)/14);if(r<0||r>=w)return null;const i=1-(s-S)/160,l=Math.round(x.min+i*(x.max-x.min));return{rowIndex:r,value:Math.max(x.min,Math.min(x.max,l))}},[w,x,N]),P=s.useCallback((e,t,n)=>{h(a=>{const s=[...a],r=s[e];switch(n){case"overwrite":s[e]=t;break;case"fill_blanks":0!==r&&r!==x.default||(s[e]=t);break;case"add":s[e]=Math.max(x.min,Math.min(x.max,r+(t-x.max/2)));break;case"scale":const n=t/x.max;s[e]=Math.round(r*n)}return s})},[x]),T=s.useCallback(e=>{const t=E(e);if(t){if(2===e.button)return e.preventDefault(),void P(t.rowIndex,t.value,"overwrite");c(!0),P(t.rowIndex,t.value,d)}},[E,P,d]),A=s.useCallback(e=>{if(!l){const t=E(e);return void(t&&f(()=>{const e=[...p];return e[t.rowIndex]=t.value,e}))}const t=E(e);t&&P(t.rowIndex,t.value,d)},[l,E,P,d,p]),I=s.useCallback(()=>{c(!1)},[]),_=s.useCallback(()=>{c(!1),f(null)},[]),O=s.useCallback(e=>{e.preventDefault()},[]),F=s.useCallback(()=>{p.forEach((e,a)=>{const s=n+a,o=g[v];if(!o)return;const i=o.channels[t]?.rows[s];if(!i)return;const l={};switch(r){case"volume":l.volume=e;break;case"effect":const t=i.effect||"000",n=t.length>=3?t.substring(1):"00";l.effect=x.format(e)+n;break;case"effectParam":const a=i.effect?.[0]||"0";l.effect=a+e.toString(16).toUpperCase().padStart(2,"0");break;case"note":l.note=e;break;case"instrument":l.instrument=e}b(t,s,l)}),e()},[p,n,g,v,t,r,x,b,e]),D=s.useCallback(e=>{const t=Array(w).fill(0).map((t,n)=>{const a=n/(w-1||1),s=x.max-x.min;switch(e){case"ramp_up":return Math.round(x.min+a*s);case"ramp_down":return Math.round(x.max-a*s);case"triangle":return Math.round(x.min+Math.abs(1-2*a)*s);case"random":return Math.round(x.min+Math.random()*s);case"sine":return Math.round(x.min+(Math.sin(a*Math.PI*2)+1)/2*s);default:return x.default}});h(t)},[w,x]),R=s.useCallback(()=>{if(p.length<2)return;const e=p[0],t=p[p.length-1],n=p.map((n,a)=>{const s=a/(p.length-1);return Math.round(e+(t-e)*s)});h(n)},[p]),j=s.useCallback(()=>{const e=g[v];if(!e)return;const s=e.channels[t];if(!s)return;const o=[];for(let t=n;t<=a;t++){const e=s.rows[t];let n=x.default;if(e)switch(r){case"volume":n=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(n=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(n=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(n=e.note);break;case"instrument":n=e.instrument??x.default}o.push(n)}h(o)},[g,v,t,n,a,r,x.default]);return bn.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:bn.jsxs("div",{ref:i,className:"bg-dark-bg border border-dark-border rounded-lg shadow-2xl max-w-[95vw] overflow-hidden",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-dark-bgSecondary border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsxs("h2",{className:"text-text-primary font-bold",children:[x.label," Editor"]}),bn.jsxs("span",{className:"text-xs text-text-secondary",children:["Channel ",t+1,", Rows ",n,"-",a]})]}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:e,children:bn.jsx(Te,{size:18})})]}),bn.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-dark-bgSecondary/50 border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[bn.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Mode:"}),["overwrite","fill_blanks","add","scale"].map(e=>bn.jsx("button",{onClick:()=>u(e),className:"px-2 py-1 text-xs rounded "+(d===e?"bg-blue-600 text-white":"bg-dark-bg text-text-secondary hover:bg-dark-bgSecondary"),children:"fill_blanks"===e?"Fill Empty":e.charAt(0).toUpperCase()+e.slice(1)},e))]}),bn.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[bn.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Generate:"}),bn.jsx("button",{onClick:()=>D("ramp_up"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Up",children:""}),bn.jsx("button",{onClick:()=>D("ramp_down"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Down",children:""}),bn.jsx("button",{onClick:()=>D("triangle"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Triangle",children:""}),bn.jsx("button",{onClick:()=>D("sine"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Sine",children:""}),bn.jsx("button",{onClick:()=>D("random"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Random",children:"?"})]}),bn.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[bn.jsx(jv,{variant:"ghost",size:"sm",onClick:R,title:"Interpolate between first and last",children:bn.jsx(Ue,{size:14})}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:j,title:"Reset to original",children:bn.jsx(bt,{size:14})})]})]}),bn.jsx("div",{className:"p-4 overflow-x-auto",children:bn.jsx("canvas",{ref:o,width:M,height:N,onMouseDown:T,onMouseMove:A,onMouseUp:I,onMouseLeave:_,onContextMenu:O,className:"cursor-crosshair border border-dark-border rounded",style:{minWidth:M}})}),bn.jsxs("div",{className:"px-4 py-2 text-xs text-text-secondary bg-dark-bgSecondary/30 border-t border-dark-border",children:[bn.jsx("span",{className:"font-medium",children:"Tips:"})," Click + drag to paint values. Right-click for single-row precision."]}),bn.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 bg-dark-bgSecondary border-t border-dark-border",children:[bn.jsx(jv,{variant:"ghost",onClick:e,children:"Cancel"}),bn.jsxs(jv,{variant:"primary",onClick:F,children:[bn.jsx(st,{size:14,className:"mr-1"}),"Apply"]})]})]})})},ub=640,pb=1024;function hb(){const[e,t]=s.useState(()=>"undefined"!=typeof window?window.innerWidth:1024);return s.useEffect(()=>{if("undefined"==typeof window)return;let e;t(window.innerWidth);const n=()=>{clearTimeout(e),e=setTimeout(()=>{t(window.innerWidth)},100)};return window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{clearTimeout(e),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),s.useMemo(()=>{const t=function(e){return e<ub?"mobile":e<pb?"tablet":"desktop"}(e);return{breakpoint:t,isMobile:"mobile"===t,isTablet:"tablet"===t,isDesktop:"desktop"===t,width:e}},[e])}const mb=s.createContext(null);function fb({children:e}){const t={...hb(),isTouch:function(){const[e,t]=s.useState(!1);return s.useEffect(()=>{t("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),e}()};return bn.jsx(mb.Provider,{value:t,children:e})}const yb=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114],gb=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];const vb=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];class bb{song=null;playing=!1;songPos=0;pattPos=0;currentTick=0;speed=6;bpm=125;globalVolume=64;pBreakPos=0;pBreakFlag=!1;posJumpFlag=!1;posJumpPos=0;patternDelay=0;channels=[];masterGain;stateQueue=[];lastDequeuedState=null;static MAX_STATE_QUEUE_SIZE=256;bufferCache=new Map;onRowChange=null;onSongEnd=null;onTickProcess=null;constructor(){this.masterGain=new p(1).toDestination()}loadSong(e){this.stop(),this.song=e,this.bufferCache.clear();for(const n of this.channels){for(const e of n.playerPool)try{e.dispose()}catch(t){}try{n.gainNode.dispose()}catch(t){}try{n.panNode.dispose()}catch(t){}}this.channels=[];for(let n=0;n<e.numChannels;n++)this.channels.push(this.createChannel(n,e.numChannels));this.songPos=0,this.pattPos=0,this.currentTick=0,this.speed=e.initialSpeed,this.bpm=e.initialBPM,this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0}createChannel(e,t){let n=0;n=4===t?0===e||3===e?-.7:.7:e%2==0?-.5:.5;const a=new N(n),s=new p(1);s.connect(a),a.connect(this.masterGain);const r=[];for(let o=0;o<2;o++){const e=new j;e.connect(s),r.push(e)}return{note:0,period:0,volume:64,panning:128,sampleNum:0,sampleOffset:0,finetune:0,portaSpeed:0,portaTarget:0,tonePortaSpeed:0,vibratoPos:0,vibratoCmd:0,tremoloPos:0,tremoloCmd:0,waveControl:0,retrigCount:0,retrigVolSlide:0,patternLoopRow:0,patternLoopCount:0,globalVolSlide:0,panSlide:0,macroPos:0,macroReleased:!1,macroPitchOffset:0,macroArpNote:0,macroDuty:0,macroWaveform:0,previousSlideFlag:!1,gateHigh:!1,player:null,playerPool:r,activePlayerIdx:0,gainNode:s,panNode:a,instrument:null}}scheduleAheadTime=.1;schedulerInterval=.015;nextScheduleTime=0;startTime=0;totalTicksScheduled=0;lastGrooveTemplateId="straight";lastSwingAmount=100;lastGrooveSteps=2;schedulerTimerId=null;async play(){if(!this.song||this.playing)return;await xe();const e=em();await e.ensureWASMSynthsReady(this.song.instruments),this.playing=!0;const t=Gf.getState();this.lastGrooveTemplateId=t.grooveTemplateId,this.lastSwingAmount=t.swing,this.lastGrooveSteps=t.grooveSteps,this.startScheduler()}stop(){this.playing=!1,null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null);for(const e of this.channels)this.stopChannel(e);this.songPos=0,this.pattPos=0,this.currentTick=0,this.totalTicksScheduled=0,this.lastGrooveTemplateId="straight",this.lastSwingAmount=100,this.lastGrooveSteps=2,this.clearStateQueue()}pause(){null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1}resume(){this.song&&!this.playing&&(this.playing=!0,this.startScheduler())}startScheduler(){this.startTime=x()+.02,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0;const e=()=>{if(!this.playing)return;const e=x(),t=e+this.scheduleAheadTime,n=Gf.getState();(n.grooveTemplateId!==this.lastGrooveTemplateId||n.swing!==this.lastSwingAmount||n.grooveSteps!==this.lastGrooveSteps||Math.abs(n.bpm-this.bpm)>.1)&&(this.startTime=e+.01,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0,this.lastGrooveTemplateId=n.grooveTemplateId,this.lastSwingAmount=n.swing,this.lastGrooveSteps=n.grooveSteps,this.bpm=n.bpm,this.speed=n.speed);const a=2.5/this.bpm;for(;this.nextScheduleTime<t&&this.playing;)this.processTick(this.nextScheduleTime),this.totalTicksScheduled++,this.nextScheduleTime=this.startTime+this.totalTicksScheduled*a};e(),this.schedulerTimerId=setInterval(e,1e3*this.schedulerInterval)}calculateGrooveOffset(e,t,n){const a=Ra.find(e=>e.id===n.grooveTemplateId),s=n.swing/100;if(a&&"straight"!==a.id)return function(e,t,n){if(!e.values||0===e.values.length)return 0;const a=t%e.values.length;return e.values[a]/100*n}(a,e,t)*s;{const a=n.grooveSteps||2,s=e%a>=a/2;if(100!==n.swing&&s){const e=.3333;return n.swing/100*e*t}}return 0}processTick(e){if(!this.song||!this.playing)return;if(this.patternDelay>0)return void this.patternDelay--;const t=Gf.getState();t.bpm!==this.bpm&&(this.bpm=t.bpm),t.speed!==this.speed&&(this.speed=t.speed);const n=2.5/this.bpm;let a=e;if(0===this.currentTick){const e=n*this.speed;a+=this.calculateGrooveOffset(this.pattPos,e,t)}if(t.jitter>0){const e=t.jitter/100*.01;a+=(2*Math.random()-1)*e}const s=this.song.songPositions[this.songPos],r=this.song.patterns[s];if(r){0===this.currentTick&&this.queueDisplayState(a,this.pattPos,s,this.songPos,0);for(let e=0;e<this.channels.length;e++){const t=this.channels[e],s=r.channels[e]?.rows[this.pattPos];s&&(0===this.currentTick?this.processRow(e,t,s,a):this.processEffectTick(e,t,s,a+this.currentTick*n),this.processMacros(t,a+this.currentTick*n))}this.onTickProcess&&this.onTickProcess(this.currentTick,this.pattPos),this.currentTick++,this.currentTick>=this.speed&&(this.currentTick=0,this.advanceRow())}}queueDisplayState(e,t,n,a,s){const r={time:e,row:t,pattern:n,position:a,tick:s};this.stateQueue.length>=bb.MAX_STATE_QUEUE_SIZE&&this.stateQueue.shift(),this.stateQueue.push(r)}getStateAtTime(e,t=!1){if(!this.playing)return this.lastDequeuedState;if(t){let t=this.lastDequeuedState;for(const n of this.stateQueue){if(!(n.time<=e))break;t=n}return t}let n=this.lastDequeuedState;for(;this.stateQueue.length>0;){if(!(this.stateQueue[0].time<=e))break;n=this.stateQueue.shift(),this.lastDequeuedState=n}return n}clearStateQueue(){this.stateQueue=[],this.lastDequeuedState=null}processRow(e,t,n,a){if(!this.song)return;const s=1===n.flag1||1===n.flag2,r=2===n.flag1||2===n.flag2,o=3===n.flag1||3===n.flag2,i=4===n.flag1||4===n.flag2;if(o){if(t.gainNode.gain.setValueAtTime(0,a),t.player){try{t.player.stop(a)}catch(v){}t.player=null}return}const l=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),c=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0),d=n.instrument??0;if(d>0){const e=this.song.instruments.find(e=>e.id===d);e&&(t.instrument=e,t.sampleNum=d,t.volume=64,t.finetune=e.metadata?.modPlayback?.finetune??0,t.gainNode.gain.setValueAtTime(t.volume/64,a))}const u=n.note,p=n.period,h=n.probability,m=void 0!==h&&h>0&&h<100&&100*Math.random()>=h,f=r||i;if(u&&0!==u&&!m){const n=p||this.noteToPeriod(u,t.finetune);if(3===l||5===l)t.portaTarget=n,0!==c&&3===l&&(t.tonePortaSpeed=c);else{t.note=n,t.period=t.note;let r=0;9===l&&(r=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const o=t.previousSlideFlag&&null!==u&&!i;this.triggerNote(t,a,r,e,s,o,f,i),4&t.waveControl||(t.vibratoPos=0),64&t.waveControl||(t.tremoloPos=0)}}t.previousSlideFlag=(r||i)??!1,97===u&&(this.releaseMacros(t),this.stopChannel(t)),void 0!==n.volume&&n.volume>=16&&n.volume<=80&&(t.volume=n.volume-16,t.gainNode.gain.setValueAtTime(t.volume/64,a)),this.processEffect0(e,t,l,c,a);const y=n.effTyp2??0,g=n.eff2??0;0===y&&0===g||this.processEffect0(e,t,y,g,a)}processEffect0(e,t,n,a,s){const r=a>>4&15,o=15&a;if(t.instrument?.synthType?.startsWith("Furnace")){const s=em();11===n||13===n||15===n||(14===n?s.applyFurnaceExtendedEffect(t.instrument.id,r,o,e):s.applyFurnaceEffect(t.instrument.id,n,a,e))}switch(n){case 0:case 5:case 6:case 10:break;case 1:case 2:0!==a&&(t.portaSpeed=a);break;case 3:0!==a&&(t.tonePortaSpeed=a);break;case 4:0!==r&&(t.vibratoCmd=15&t.vibratoCmd|r<<4),0!==o&&(t.vibratoCmd=240&t.vibratoCmd|o);break;case 7:0!==r&&(t.tremoloCmd=15&t.tremoloCmd|r<<4),0!==o&&(t.tremoloCmd=240&t.tremoloCmd|o);break;case 8:t.panning=a,t.panNode.pan.setValueAtTime((a-128)/128,s);break;case 9:0!==a&&(t.sampleOffset=a);break;case 11:this.posJumpPos=a,this.posJumpFlag=!0,this.pBreakFlag=!0;break;case 12:t.volume=Math.min(64,a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 13:this.pBreakPos=10*r+o,this.pBreakPos>63&&(this.pBreakPos=0),this.pBreakFlag=!0;break;case 14:this.processExtendedEffect0(e,t,r,o,s);break;case 15:0===a||(a<32?this.speed=a:this.bpm=a);break;case 16:this.globalVolume=Math.min(64,a),this.updateAllChannelVolumes(s);break;case 17:0!==a&&(t.globalVolSlide=a);break;case 25:0!==a&&(t.panSlide=a);break;case 27:t.retrigCount=15&a,t.retrigVolSlide=a>>4&15}}processExtendedEffect0(e,t,n,a,s){switch(n){case 1:t.period=Math.max(113,t.period-a),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+a),this.updatePeriod(t);break;case 4:t.waveControl=240&t.waveControl|15&a;break;case 5:t.finetune=a>7?a-16:a;break;case 6:0===a?t.patternLoopRow=this.pattPos:(0===t.patternLoopCount?t.patternLoopCount=a:t.patternLoopCount--,0!==t.patternLoopCount&&(this.pBreakPos=t.patternLoopRow,this.pBreakFlag=!0));break;case 7:t.waveControl=15&t.waveControl|(15&a)<<4;break;case 9:t.retrigCount=a;break;case 10:t.volume=Math.min(64,t.volume+a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 11:t.volume=Math.max(0,t.volume-a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 14:this.patternDelay=a*this.speed}}processEffectTick(e,t,n,a){const s=1===n.flag1||1===n.flag2,r=2===n.flag1||2===n.flag2,o=3===n.flag1||3===n.flag2;if(4===n.flag1||n.flag2,o)return;const i=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),l=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0),c=l>>4&15,d=15&l,u=n.effTyp2??0,p=n.eff2??0;switch(0===u&&0===p||this.processEffectTickSingle(e,t,n,u,p,a),t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,i,l,c,d),i){case 0:0!==l&&this.doArpeggio(t,l);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,l,a);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,l,a);break;case 7:this.doTremolo(t,a);break;case 10:this.doVolumeSlide(t,l,a);break;case 14:if(9===c&&d>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=d,this.triggerNote(t,a,0,e,s,!1,!1));else if(12===c&&d===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,a);else if(13===c&&d===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,a,0,e,s,n,r)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,a);break;case 25:this.doPanSlide(t,t.panSlide,a);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&l,this.applyRetrigVolSlide(t,t.retrigVolSlide,a),this.triggerNote(t,a,0,e,s,!1,!1)))}}processEffectTickSingle(e,t,n,a,s,r){const o=1===n.flag1||1===n.flag2,i=2===n.flag1||2===n.flag2,l=s>>4&15,c=15&s;switch(t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,a,s,l,c),a){case 0:0!==s&&this.doArpeggio(t,s);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,s,r);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,s,r);break;case 7:this.doTremolo(t,r);break;case 10:this.doVolumeSlide(t,s,r);break;case 14:if(9===l&&c>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=c,this.triggerNote(t,r,0,e,o,!1,!1));else if(12===l&&c===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,r);else if(13===l&&c===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,r,0,e,o,n,i)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,r);break;case 25:this.doPanSlide(t,t.panSlide,r);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&s,this.applyRetrigVolSlide(t,t.retrigVolSlide,r),this.triggerNote(t,r,0,e,o,!1,!1)))}}forwardEffectToFurnace(e,t,n,a,s,r){if(11===n||13===n||15===n||0===n&&0===a)return;const o=em();14===n?o.applyFurnaceExtendedEffect(e.instrument.id,s,r,t):o.applyFurnaceEffect(e.instrument.id,n,a,t)}doArpeggio(e,t){const n=t>>4&15,a=15&t,s=this.currentTick%3;let r=e.note;1===s?r=this.periodPlusSemitones(e.note,n,e.finetune):2===s&&(r=this.periodPlusSemitones(e.note,a,e.finetune)),this.updatePeriodDirect(e,r)}doTonePortamento(e){0!==e.portaTarget&&e.period!==e.portaTarget&&(e.period<e.portaTarget?(e.period+=e.tonePortaSpeed,e.period>e.portaTarget&&(e.period=e.portaTarget)):(e.period-=e.tonePortaSpeed,e.period<e.portaTarget&&(e.period=e.portaTarget)),this.updatePeriod(e))}doVibrato(e){const t=e.vibratoCmd>>4&15,n=15&e.vibratoCmd,a=3&e.waveControl;let s;0===a?s=vb[31&e.vibratoPos]:1===a?(s=8*(31&e.vibratoPos),e.vibratoPos>=32&&(s=255-s)):s=255;let r=s*n>>7;e.vibratoPos>=32&&(r=-r),this.updatePeriodDirect(e,e.period+r),e.vibratoPos=e.vibratoPos+t&63}doTremolo(e,t){const n=e.tremoloCmd>>4&15,a=15&e.tremoloCmd,s=e.waveControl>>4&3;let r;0===s?r=vb[31&e.tremoloPos]:1===s?(r=8*(31&e.tremoloPos),e.tremoloPos>=32&&(r=255-r)):r=255;let o=r*a>>6;e.tremoloPos>=32&&(o=-o);const i=Math.max(0,Math.min(64,e.volume+o));e.gainNode.gain.setValueAtTime(i/64,t),e.tremoloPos=e.tremoloPos+n&63}doVolumeSlide(e,t,n){const a=t>>4&15,s=15&t;a>0?e.volume=Math.min(64,e.volume+a):s>0&&(e.volume=Math.max(0,e.volume-s)),e.gainNode.gain.setValueAtTime(e.volume/64,n)}doGlobalVolumeSlide(e,t){const n=e>>4&15,a=15&e;n>0?this.globalVolume=Math.min(64,this.globalVolume+n):a>0&&(this.globalVolume=Math.max(0,this.globalVolume-a)),this.updateAllChannelVolumes(t)}doPanSlide(e,t,n){const a=t>>4&15,s=15&t;a>0?e.panning=Math.min(255,e.panning+a):s>0&&(e.panning=Math.max(0,e.panning-s)),e.panNode.pan.setValueAtTime((e.panning-128)/128,n)}applyRetrigVolSlide(e,t,n){switch(t){case 0:case 8:break;case 1:e.volume=Math.max(0,e.volume-1);break;case 2:e.volume=Math.max(0,e.volume-2);break;case 3:e.volume=Math.max(0,e.volume-4);break;case 4:e.volume=Math.max(0,e.volume-8);break;case 5:e.volume=Math.max(0,e.volume-16);break;case 6:e.volume=Math.floor(2*e.volume/3);break;case 7:e.volume=Math.floor(e.volume/2);break;case 9:e.volume=Math.min(64,e.volume+1);break;case 10:e.volume=Math.min(64,e.volume+2);break;case 11:e.volume=Math.min(64,e.volume+4);break;case 12:e.volume=Math.min(64,e.volume+8);break;case 13:e.volume=Math.min(64,e.volume+16);break;case 14:e.volume=Math.min(64,Math.floor(3*e.volume/2));break;case 15:e.volume=Math.min(64,2*e.volume)}e.gainNode.gain.setValueAtTime(e.volume/64,n)}processMacros(e,t){if(!e.instrument?.furnace?.macros)return;const n=e.instrument.furnace.macros;if(0!==n.length){for(const a of n){if(!a.data||0===a.data.length)continue;let n=e.macroPos;const s=a.speed||1;if(this.currentTick%s!==0)continue;e.macroReleased&&a.release>=0&&n<a.release&&(n=a.release),n>=a.data.length&&(n=a.loop>=0&&a.loop<a.data.length?e.macroReleased&&a.release>=0&&a.loop<a.release?a.data.length-1:a.loop:a.data.length-1);const r=a.data[n]??0;this.applyMacroValue(e,a.type,r,t)}e.macroPos++}}applyMacroValue(e,t,n,a){switch(t){case ba.VOL:e.volume=Math.round(n/15*64),e.gainNode.gain.setValueAtTime(e.volume/64*(this.globalVolume/64),a);break;case ba.ARP:if(e.macroArpNote=n>127?n-256:n,e.period>0){const t=Math.pow(2,e.macroArpNote/12),n=Math.round(e.note/t);this.updatePeriodDirect(e,n)}break;case ba.DUTY:e.macroDuty=n;break;case ba.WAVE:e.macroWaveform=n;break;case ba.PITCH:if(e.macroPitchOffset=n>127?n-256:n,e.period>0){const t=e.macroPitchOffset/64,n=Math.round(e.period*(1-.01*t));this.updatePeriodDirect(e,Math.max(113,Math.min(856,n)))}break;case ba.EX1:case ba.EX2:case ba.EX3:case ba.EX4:case ba.EX5:case ba.EX6:case ba.EX7:case ba.EX8:case ba.ALG:case ba.FB:case ba.FMS:case ba.AMS:break;case ba.PAN_L:e.panning=Math.max(0,128-8*n),e.panNode.pan.setValueAtTime((e.panning-128)/128,a);break;case ba.PAN_R:e.panning=Math.min(255,128+8*n),e.panNode.pan.setValueAtTime((e.panning-128)/128,a)}}releaseMacros(e){e.macroReleased=!0}triggerNote(e,t,n,a,s,r,o,i){if(void 0!==a){if(em().isChannelMuted(a))return}const l=t??x();if(e.player)try{e.player.stop(l)}catch(P){}if(e.macroPos=0,e.macroReleased=!1,e.macroPitchOffset=0,e.macroArpNote=0,!e.instrument)return;const c=em(),d=function(e){for(let t=0;t<8;t++)for(let n=0;n<12;n++){const a=12*t+n;if(a<36&&yb[a]<=e)return`${gb[n].replace("-","")}${t+1}`}return"C4"}(e.period),u=Gf.getState(),p=u.grooveTemplateId,h=Ra.find(e=>e.id===p),m=u.swing/100;let f=0;h&&(f=function(e,t){if(!e.velocityOffsets||0===e.velocityOffsets.length)return 0;const n=t%e.velocityOffsets.length;return e.velocityOffsets[n]}(h,this.pattPos)*m);const y=Math.max(0,Math.min(1,e.volume/64+f));if(void 0!==a&&Ne.schedule(()=>{c.triggerChannelMeter(a,y)},l),e.instrument.synthType&&"Sampler"!==e.instrument.synthType){const t=2.5/this.bpm*this.speed,n=("TB303"===e.instrument.synthType||"Buzz3o3"===e.instrument.synthType)&&!o?.8*t:1.05*t;return void c.triggerNote(e.instrument.id,d,n,l,y,e.instrument,s,o,void 0,e.period,void 0,0,i)}const g=c.getDecodedBuffer(e.instrument.id);if(!g)return;const v=e.instrument.sample;if(!e.period||e.period<=0)return;const b=e.finetune,w=Math.pow(2,b/96),k=428/e.period*w;let S=this.bufferCache.get(e.instrument.id);S||(S=new R(g),this.bufferCache.set(e.instrument.id,S));const M=(e.activePlayerIdx+1)%e.playerPool.length,N=e.playerPool[M];if(e.activePlayerIdx=M,"started"===N.state)try{N.stop(l)}catch(P){}N.buffer=S;const C=v?.sampleRate||8363,E=g.duration;v?.loop&&(v.loopEnd??0)>(v.loopStart??0)?(N.loop=!0,N.loopStart=Math.min((v.loopStart??0)/C,E-1e-4),N.loopEnd=Math.min((v.loopEnd??0)/C,E),N.loopEnd<=N.loopStart&&(N.loopEnd=E)):N.loop=!1,N.playbackRate=k,e.player=N;try{const e=n>0?n/C:0;N.start(l,Math.min(e,E-1e-4))}catch(P){}}stopChannel(e){for(const n of e.playerPool)try{"started"===n.state&&n.stop()}catch(t){}e.player=null}updatePeriod(e){this.updatePeriodDirect(e,e.period)}updatePeriodDirect(e,t){if(!e.player||0===t)return;const n=e.instrument?.sample?.sampleRate||8363,a=3546895/t;e.player.playbackRate=a/n}updateAllChannelVolumes(e){const t=this.globalVolume/64;for(const n of this.channels){const a=n.volume/64*t;n.gainNode.gain.setValueAtTime(a,e)}}noteToPeriod(e,t){if("number"==typeof e&&e>0){if(e>=113&&e<=856)return e;if(e<97){let n=e-1,a=0;for(;n<12;)n+=12,a--;for(;n>47;)n-=12,a++;if(n-=12,n>=0&&n<36){let e=this.getPeriod(n,t);return a>0?e=Math.round(e/Math.pow(2,a)):a<0&&(e=Math.round(e*Math.pow(2,-a))),e}}}else if("string"==typeof e)return this.noteStringToPeriod(e,t);return 0}noteStringToPeriod(e,t){const n=e.match(/^([A-G][#]?)-?(\d)$/);if(!n)return 0;const a={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11}[n[1]]??0,s=12*(parseInt(n[2],10)-1)+a;return s<0||s>=36?0:this.getPeriod(s,t)}getPeriod(e,t){return yb[36*(t>=0?t:t+16)+Math.min(35,Math.max(0,e))]}periodPlusSemitones(e,t,n){const a=36*(n>=0?n:n+16);let s=0;for(let o=0;o<36;o++)if(yb[a+o]<=e){s=o;break}const r=Math.min(35,Math.max(0,s+t));return yb[a+r]}advanceRow(){if(!this.song)return;this.pBreakFlag?(this.pattPos=this.pBreakPos,this.pBreakFlag=!1,this.pBreakPos=0,this.posJumpFlag||this.songPos++):this.pattPos++,this.posJumpFlag&&(this.songPos=this.posJumpPos,this.posJumpFlag=!1);const e=this.song.songPositions[this.songPos],t=this.song.patterns[e],n=t?.length??64;if(this.pattPos>=n&&(this.pattPos=0,this.songPos++),this.songPos>=this.song.songLength&&(this.songPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0,this.onSongEnd?.()),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}}isPlaying(){return this.playing}getBPM(){return this.bpm}getSpeed(){return this.speed}getCurrentRow(){return this.pattPos}getCurrentPosition(){return this.songPos}getCurrentTick(){return this.currentTick}dispose(){this.stop();for(const t of this.channels){for(const n of t.playerPool)try{n.dispose()}catch(e){}t.gainNode.dispose(),t.panNode.dispose()}this.bufferCache.clear(),this.masterGain.dispose(),this.channels=[],this.song=null}}let xb=null;function wb(){return xb||(xb=new bb),xb}const kb=24,Sb=10,Mb=40,Nb=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Cb(e){if(0===e)return"---";if(97===e)return"OFF";const t=(e-1)%12,n=Math.floor((e-1)/12);return`${Nb[t]}${n}`}function Eb(e){return e.toString(16).toUpperCase().padStart(2,"0")}const Pb=e.memo(({onAcidGenerator:t})=>{const{isMobile:n}=s.useContext(mb)||{breakpoint:"desktop",isMobile:!1,isTablet:!1,isDesktop:!0,width:1024,isTouch:!1},a=s.useRef(null),r=s.useRef(null),o=s.useRef(null),[i,l]=s.useState({width:800,height:600}),[c,d]=s.useState(0),[u,p]=s.useState(0),[h,m]=s.useState(0),[f,y]=s.useState(0),g=s.useRef([]),v=s.useRef({}),b=s.useRef({}),w=s.useRef({}),k=s.useRef(null),{pattern:S,patterns:M,currentPatternIndex:N,addChannel:C,removeChannel:E,toggleChannelMute:P,toggleChannelSolo:T,setChannelColor:A,setCell:I,moveCursorToChannel:_,copyTrack:O,cutTrack:F,pasteTrack:D,mobileChannelIndex:R,cursor:j,selection:L,showGhostPatterns:B}=cm(On(e=>({pattern:e.patterns[e.currentPatternIndex],patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,addChannel:e.addChannel,removeChannel:e.removeChannel,toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,setChannelColor:e.setChannelColor,setCell:e.setCell,moveCursorToChannel:e.moveCursorToChannel,copyTrack:e.copyTrack,cutTrack:e.cutTrack,pasteTrack:e.pasteTrack,mobileChannelIndex:e.cursor.channelIndex,cursor:e.cursor,selection:e.selection,showGhostPatterns:e.showGhostPatterns}))),{instruments:V}=Df(On(e=>({instruments:e.instruments}))),z=s.useRef(null),U=s.useRef(-1),G=s.useRef(0),K=sy(e=>e.currentThemeId),H=s.useRef(K),W="cyan-lineart"===K,$=(()=>{const[t,n]=e.useState({position:null,rowIndex:0,channelIndex:0}),a=s.useCallback((e,t,a)=>{e.preventDefault(),e.stopPropagation(),n({position:{x:e.clientX,y:e.clientY},rowIndex:t,channelIndex:a})},[]),r=s.useCallback(()=>{n(e=>({...e,position:null}))},[]),o=s.useCallback(e=>{e.preventDefault()},[]);return{...t,openMenu:a,closeMenu:r,isOpen:null!==t.position,handleContextMenu:o,cellInfo:t.position?{rowIndex:t.rowIndex,channelIndex:t.channelIndex}:null}})(),[q,Y]=s.useState(null),X=s.useCallback(e=>{const t=$.cellInfo?.channelIndex??j.channelIndex,n=L?.startRow??j.rowIndex,a=L?.endRow??Math.min(j.rowIndex+15,S.length-1);Y({isOpen:!0,field:e,channelIndex:t,startRow:n,endRow:a}),$.closeMenu()},[$,j,L,S.length]);s.useEffect(()=>{H.current!==K&&(v.current={},b.current={},w.current={},H.current=K)},[K]);const Q=s.useMemo(()=>({bg:"#0a0a0b",rowNormal:"#0d0d0e",rowHighlight:"#111113",centerLine:W?"rgba(0, 255, 255, 0.25)":"rgba(239, 68, 68, 0.25)",cursor:W?"#00ffff":"#ef4444",cursorBg:W?"rgba(0, 255, 255, 0.2)":"rgba(239, 68, 68, 0.2)",text:"#e0e0e0",textMuted:"#505050",textNote:"#909090",textNoteActive:"#ffffff",textInstrument:"#4ade80",textVolume:"#60a5fa",textEffect:"#f97316",border:"#252530",lineNumber:"#707070",lineNumberHighlight:"#f97316"}),[W]),Z=s.useCallback(()=>{if(!S||!n)return;const e=Math.min(S.channels.length-1,R+1);e!==R&&_(e)},[S,n,R,_]),J=s.useCallback(()=>{if(!S||!n)return;const e=Math.max(0,R-1);e!==R&&_(e)},[S,n,R,_]),ee=function({threshold:e=50,onSwipeLeft:t,onSwipeRight:n}){const a=s.useRef(null);return{onTouchStart:s.useCallback(e=>{const t=e.touches[0];a.current={startX:t.clientX,startY:t.clientY,startTime:Date.now()}},[]),onTouchEnd:s.useCallback(s=>{if(!a.current)return;const r=s.changedTouches[0],o=r.clientX-a.current.startX,i=r.clientY-a.current.startY,l=Date.now()-a.current.startTime;Math.abs(o)>e&&Math.abs(o)>1.5*Math.abs(i)&&l<500&&(o>0&&n?n():o<0&&t&&t()),a.current=null},[e,t,n]),onTouchCancel:s.useCallback(()=>{a.current=null},[])}}({threshold:50,onSwipeLeft:Z,onSwipeRight:J}),te=s.useCallback((e,t)=>{if(!S)return;const n=rb[t];if(!n)return;const a=S.channels[e].instrumentId??1;n.generate({patternLength:S.length,instrumentId:a,note:49,velocity:64}).forEach((t,n)=>{I(e,n,t)})},[S,I]),ne=s.useCallback(e=>{if(S){for(let t=0;t<S.length;t++)I(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0});jf.getState().setStatusMessage("CHANNEL CLEARED")}},[S,I]),ae=s.useCallback(e=>{O(e)},[O]),se=s.useCallback(e=>{F(e)},[F]),re=s.useCallback(e=>{D(e)},[D]),oe=s.useCallback((e,t)=>{if(S){for(let n=0;n<S.length;n++){const a=S.channels[e].rows[n];if(a.note&&0!==a.note&&97!==a.note){let s=a.note+t;s=Math.max(1,Math.min(96,s)),I(e,n,{...a,note:s})}}jf.getState().setStatusMessage(`TRANSPOSE ${t>0?"+":""}${t}`)}},[S,I]),ie=s.useCallback(e=>{if(S){for(let t=0;t<S.length;t++){const n=S.channels[e].rows[t];if(null!==n.volume&&n.volume>=16){const a=Math.floor(8*Math.random())-4,s=Math.max(16,Math.min(80,n.volume+a));I(e,t,{...n,volume:s})}}jf.getState().setStatusMessage("HUMANIZED")}},[S,I]),le=s.useCallback(e=>{if(!S)return;const t=S.channels[e];if(!t)return;let n=-1,a=-1,s=0,r=0;for(let i=0;i<S.length;i++){const e=t.rows[i];null!==e.volume&&e.volume>=16&&e.volume<=80&&(-1===n&&(n=i,s=e.volume),a=i,r=e.volume)}if(-1===n||-1===a||a-n<2)return;const o=a-n;for(let i=n+1;i<a;i++){const a=(i-n)/o,l=Math.round(s+(r-s)*a),c=t.rows[i];I(e,i,{...c,volume:l})}jf.getState().setStatusMessage("INTERPOLATED")},[S,I]);s.useEffect(()=>{S&&(g.current=S.channels.map(()=>({level:0,triggered:!1})))},[S?.channels.length]);const ce=s.useCallback((e,t=!1)=>{const n=`${e}-${t?"a":"n"}`;if(v.current[n])return v.current[n];const a=document.createElement("canvas");a.width=34,a.height=kb;const s=a.getContext("2d");return s.font='14px "JetBrains Mono", "Fira Code", monospace',s.textBaseline="middle",s.fillStyle=0===e?Q.textMuted:97===e?Q.textEffect:t?Q.textNoteActive:Q.textNote,s.fillText(Cb(e),0,12),v.current[n]=a,a},[Q.textMuted,Q.textEffect,Q.textNote,Q.textNoteActive]),de=s.useCallback((e,t,n,a,s,r,o,i,l,c)=>{const d=`${e}-${t}-${n}-${a}-${s}-${r}-f1${o??"x"}-f2${i??"x"}-p${l??"x"}-${c?"B":""}`;if(b.current[d])return b.current[d];const u=void 0!==o||void 0!==i,p=void 0!==l&&l>0,h=document.createElement("canvas");h.width=116+(u?28:0)+(p?24:0),h.height=kb;const m=h.getContext("2d");m.font='14px "JetBrains Mono", "Fira Code", monospace',m.textBaseline="middle";let f=0;const y=12;0!==e?(m.fillStyle=Q.textInstrument,m.fillText(Eb(e),f,y)):c||(m.fillStyle=Q.textMuted,m.fillText("..",f,y)),f+=24;t>=16&&t<=80?(m.fillStyle=Q.textVolume,m.fillText(Eb(t),f,y)):c||(m.fillStyle=Q.textMuted,m.fillText("..",f,y)),f+=24;0!==n||0!==a?(m.fillStyle=Q.textEffect,m.fillText(n.toString(16).toUpperCase()+Eb(a),f,y)):c||(m.fillStyle=Q.textMuted,m.fillText("...",f,y)),f+=34;if(0!==s||0!==r?(m.fillStyle=Q.textEffect,m.fillText(s.toString(16).toUpperCase()+Eb(r),f,y)):c||(m.fillStyle=Q.textMuted,m.fillText("...",f,y)),f+=34,u&&(1===o?(m.fillStyle="#f59e0b",m.fillText("A",f,y)):2===o?(m.fillStyle="#06b6d4",m.fillText("S",f,y)):3===o?(m.fillStyle="#facc15",m.fillText("M",f,y)):4===o?(m.fillStyle="#22d3ee",m.fillText("H",f,y)):c||(m.fillStyle=Q.textMuted,m.fillText(".",f,y)),f+=14,1===i?(m.fillStyle="#f59e0b",m.fillText("A",f,y)):2===i?(m.fillStyle="#06b6d4",m.fillText("S",f,y)):3===i?(m.fillStyle="#facc15",m.fillText("M",f,y)):4===i?(m.fillStyle="#22d3ee",m.fillText("H",f,y)):c||(m.fillStyle=Q.textMuted,m.fillText(".",f,y)),f+=14),p){const e=Math.min(99,Math.max(0,l)),t=e>=75?"#4ade80":e>=50?"#facc15":e>=25?"#fb923c":"#f87171";m.fillStyle=t,m.fillText(e.toString(10).padStart(2,"0"),f,y)}return b.current[d]=h,h},[Q.textMuted,Q.textInstrument,Q.textVolume,Q.textEffect]),ue=s.useCallback((e,t)=>{const n=e%4==0,a=`${e}-${t}-${n}`;if(w.current[a])return w.current[a];const s=document.createElement("canvas");s.width=Mb,s.height=kb;const r=s.getContext("2d");r.font=n?'bold 12px "JetBrains Mono", monospace':'12px "JetBrains Mono", monospace',r.textBaseline="middle",r.textAlign="center",r.fillStyle=n?Q.lineNumberHighlight:Q.lineNumber;const o=t?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return r.fillText(o,20,12),w.current[a]=s,s},[Q.lineNumber,Q.lineNumberHighlight]),pe=s.useCallback(()=>{const e=a.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const n=cm.getState(),s=Gf.getState(),r=jf.getState(),o=n.patterns[n.currentPatternIndex],l=s.smoothScrolling,d=n.showGhostPatterns;if(!o)return t.fillStyle=Q.bg,t.fillRect(0,0,i.width,i.height),t.fillStyle=Q.textMuted,t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",void t.fillText("No pattern loaded",i.width/2,i.height/2);const f=n.cursor,g=s.isPlaying,v=r.useHexNumbers,b=r.blankEmptyCells,w=s.speed,k=s.bpm,{width:S,height:C}=i,E=o.length;let P,T=0;if(g){const e=wb(),t=x()+.01,n=e.getStateAtTime(t);if(n){if(z.current=n,P=n.row,l){const a=e.getStateAtTime(t+.5,!0);let s;s=a&&a.row!==n.row?a.time-n.time:2.5/k*w;const r=t-n.time;T=Math.min(Math.max(r/s,0),1)*kb}else T=0;U.current=P,G.current=T}else P=s.currentRow}else P=f.rowIndex,z.current=null,U.current=-1,G.current=0;const A=Math.ceil(C/kb)+2,I=Math.floor(A/2),_=P-I,O=_+A,F=Math.floor(C/2)-12,D=F-I*kb-T,R=o.channels.length;(Math.abs(D-u)>.5||_!==h)&&(p(D),m(_),y(e=>e+1));let j=!1,L=!1;for(const a of o.channels){if(j&&L)break;if(!j&&null!==a.instrumentId){const e=V.find(e=>e.id===a.instrumentId);"TB303"!==e?.synthType&&"Buzz3o3"!==e?.synthType||(j=!0)}const e=a.rows[0];e&&(void 0===e.flag1&&void 0===e.flag2||(j=!0),void 0!==e.probability&&(L=!0))}const B=34+(116+(j?28:0)+(L?24:0)+20+4)+20;t.fillStyle=Q.bg,t.fillRect(0,0,S,C);for(let a=h;a<O;a++){let e,n=!1,s=null;if(g)if(d&&a<0)if(N>0){if(s=M[N-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else{if(!(M.length>1))continue;if(s=M[M.length-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else if(d&&a>=E)if(N<M.length-1){if(s=M[N+1],e=a-E,e<0||e>=s.length)continue;n=!0}else{if(!(M.length>1))continue;if(s=M[0],e=a-E,e<0||e>=s.length)continue;n=!0}else{if(a<0||a>=E)continue;e=a}else if(d&&a<0)if(N>0){if(s=M[N-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else{if(!(M.length>1))continue;if(s=M[M.length-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else if(d&&a>=E)if(N<M.length-1){if(s=M[N+1],e=a-E,e<0||e>=s.length)continue;n=!0}else{if(!(M.length>1))continue;if(s=M[0],e=a-E,e<0||e>=s.length)continue;n=!0}else{if(a<0||a>=E)continue;e=a}const r=D+(a-_)*kb;if(r<-24||r>C+kb)continue;const i=e%4==0;n&&(t.globalAlpha=.35),t.fillStyle=i?Q.rowHighlight:Q.rowNormal,t.fillRect(0,r,S,kb),n&&(t.globalAlpha=1);const l=ue(e,v);t.drawImage(l,4,r),n&&(t.globalAlpha=.35);const u=s||o;for(let a=0;a<R;a++){const s=Mb+a*B+8-c;if(s+B<0||s>S)continue;if(!u.channels[a]){t.fillStyle=Q.border,t.fillRect(Mb+(a+1)*B-c,r,1,kb);continue}const o=u.channels[a].rows[e];if(!o)continue;if(!o)continue;const i=g&&!n&&e===P,l=o.note||0;if(!b||0!==l){const e=ce(l,i&&l>0);t.drawImage(e,s,r)}const d=de(o.instrument||0,o.volume||0,o.effTyp||0,o.eff||0,o.effTyp2||0,o.eff2||0,o.flag1,o.flag2,o.probability,b);t.drawImage(d,s+34+4,r),t.fillStyle=Q.border,t.fillRect(Mb+(a+1)*B-c,r,1,kb)}n&&(t.globalAlpha=1)}t.fillStyle=Q.centerLine,t.fillRect(0,F,S,kb);{const e=Mb+f.channelIndex*B+8-c;let a=0,r=Sb;const i=38,l=0,d=24,u=48,p=82,h=116,m=h+(j?28:0);switch(f.columnType){case"note":r=34;break;case"instrument":a=i+l+f.digitIndex*Sb;break;case"volume":a=i+d+f.digitIndex*Sb;break;case"effTyp":default:a=i+u;break;case"effParam":a=i+u+Sb+f.digitIndex*Sb;break;case"effTyp2":a=i+p;break;case"effParam2":a=i+p+Sb+f.digitIndex*Sb;break;case"flag1":a=i+h;break;case"flag2":a=i+h+Sb+4;break;case"probability":a=i+m+f.digitIndex*Sb}const y=n.recordMode,v=s.isPlaying;let b;b=y?"#ef4444":v?"#22c55e":W?"#00ffff":"#3b82f6";const x=kb,w=F,k=e+a,S=r;t.clearRect(k,w,S,x),t.fillStyle=b,t.fillRect(k,w,S,x);const M=g?P:f.rowIndex,N=o.channels[f.channelIndex]?.rows[M];if(N){let e="";const n=f.columnType,a=f.digitIndex;if("note"===n)e=Cb(N.note??0);else if("instrument"===n){const t=Eb(N.instrument??0);e=0===(N.instrument??0)?"..":t,e=e[a]??"."}else if("volume"===n){const t=N.volume??0;e=(t>=16&&t<=80?Eb(t):"..")[a]??"."}else if("effTyp"===n){const t=N.effTyp??0,n=N.eff??0;e=0!==t||0!==n?t.toString(16).toUpperCase():"."}else if("effParam"===n){const t=N.effTyp??0,n=N.eff??0;e=(0!==t||0!==n?Eb(n):"..")[a]??"."}else if("effTyp2"===n){const t=N.effTyp2??0,n=N.eff2??0;e=0!==t||0!==n?t.toString(16).toUpperCase():"."}else if("effParam2"===n){const t=N.effTyp2??0,n=N.eff2??0;e=(0!==t||0!==n?Eb(n):"..")[a]??"."}else if("flag1"===n)e=1===N.flag1?"A":2===N.flag1?"S":".";else if("flag2"===n)e=1===N.flag2?"A":2===N.flag2?"S":".";else if("probability"===n){const t=N.probability??0;e=(t>0?t.toString(10).padStart(2,"0"):"..")[a]??"."}t.font='14px "JetBrains Mono", "Fira Code", monospace',t.textBaseline="middle",t.fillStyle="#ffffff",t.fillText(e,k,w+x/2)}}},[i,Q,ce,de,ue,c,W]),he=s.useCallback(()=>{pe(),k.current=requestAnimationFrame(he)},[pe]);s.useEffect(()=>(k.current=requestAnimationFrame(he),()=>{k.current&&cancelAnimationFrame(k.current)}),[he]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:n}=t.contentRect;e>0&&n>0&&l({width:e,height:n})}});t.observe(e);const n=e.getBoundingClientRect();return n.width>0&&n.height>0&&l({width:n.width,height:n.height}),()=>t.disconnect()},[]),s.useEffect(()=>{const e=a.current;e&&(e.width=i.width,e.height=i.height,v.current={},b.current={},w.current={})},[i]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=e=>{e.preventDefault();if(!Gf.getState().isPlaying)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){const t=2*Math.sign(e.deltaY),n=cm.getState(),a=n.patterns[n.currentPatternIndex];if(!a)return;const s=n.cursor.rowIndex,r=Math.min(a.length+32,s+t);cm.getState().moveCursorToRow(r)}else d(t=>Math.max(0,t+e.deltaX))};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]);const me=s.useCallback(e=>{d(e.currentTarget.scrollLeft)},[]),fe=S?.channels[0]?.rows[0],ye=34+(116+(void 0!==fe?.flag1||void 0!==fe?.flag2?28:0)+(void 0!==fe?.probability?24:0)+20+4)+20+20,ge=S?S.channels.length*ye:0;if(!S)return bn.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const ve=S.channels[R],be=g.current[R]||{level:0,triggered:!1};return bn.jsxs("div",{className:"flex flex-col h-full",...n?ee:{},children:[n&&bn.jsxs("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border relative",children:[bn.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[bn.jsx("button",{onClick:J,disabled:R<=0,className:"p-2 rounded-lg transition-colors "+(R<=0?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:bn.jsx(xt,{size:20})}),bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsxs("span",{className:"font-bold font-mono text-lg",style:{color:ve?.color||"var(--color-accent)"},children:["CH ",(R+1).toString().padStart(2,"0")]}),bn.jsxs("span",{className:"text-xs text-text-muted",children:["/ ",S.channels.length.toString().padStart(2,"0")]}),bn.jsx($v,{level:be.level,isActive:be.triggered})]}),bn.jsx("button",{onClick:Z,disabled:R>=S.channels.length-1,className:"p-2 rounded-lg transition-colors "+(R>=S.channels.length-1?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:bn.jsx(Re,{size:20})})]}),bn.jsxs("div",{className:"flex items-center justify-center gap-2 px-3 py-1 border-t border-dark-border/50",children:[bn.jsx("button",{onClick:()=>P(R),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(ve?.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:bg-dark-bgHover"),children:ve?.muted?bn.jsx(nt,{size:14}):bn.jsx(tt,{size:14})}),bn.jsx("button",{onClick:()=>T(R),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(ve?.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:bg-dark-bgHover"),children:bn.jsx(at,{size:14})}),bn.jsx(Zv,{currentColor:ve?.color,onColorSelect:e=>A(R,e)})]})]}),!n&&bn.jsx("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border z-20 relative h-[37px]",children:bn.jsxs("div",{className:"flex h-full",children:[bn.jsx("div",{className:"flex-shrink-0 px-2 text-text-muted text-xs font-medium text-center border-r border-dark-border flex items-center justify-center",style:{width:Mb},children:"ROW"}),bn.jsx("div",{ref:o,onScroll:me,className:"overflow-x-auto scrollbar-hidden flex-1","data-vu-scroll":!0,children:bn.jsxs("div",{className:"flex",style:{width:ge},children:[S.channels.map((e,n)=>{const a=g.current[n]||{level:0,triggered:!1};return bn.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between gap-2 px-3 py-1.5\n                        border-r border-dark-border transition-colors relative\n                        ${e.muted?"opacity-50":""}\n                        ${e.solo?"bg-accent-primary/10":""}`,style:{width:ye,backgroundColor:e.color?`${e.color}15`:void 0,boxShadow:e.color?`inset 3px 0 0 ${e.color}`:void 0},children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("span",{className:"font-bold font-mono text-sm",style:{color:e.color||"var(--color-accent)"},children:(n+1).toString().padStart(2,"0")}),bn.jsx($v,{level:a.level,isActive:a.triggered})]}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx(ib,{channelIndex:n,channel:e,patternId:S.id,patternLength:S.length,onFillPattern:te,onClearChannel:ne,onCopyChannel:ae,onCutChannel:se,onPasteChannel:re,onTranspose:oe,onHumanize:ie,onInterpolate:le,onAcidGenerator:t||(()=>{})}),bn.jsx(Zv,{currentColor:e.color,onColorSelect:e=>A(n,e)}),bn.jsx("button",{onClick:()=>P(n),className:"p-1 rounded transition-colors "+(e.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.muted?"Unmute":"Mute",children:e.muted?bn.jsx(nt,{size:12}):bn.jsx(tt,{size:12})}),bn.jsx("button",{onClick:()=>T(n),className:"p-1 rounded transition-colors "+(e.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.solo?"Unsolo":"Solo",children:bn.jsx(at,{size:12})}),S.channels.length>1&&bn.jsx("button",{onClick:()=>E(n),className:"p-1 rounded text-text-muted hover:text-accent-error hover:bg-dark-bgHover transition-colors",title:"Remove Channel",children:bn.jsx(pt,{size:12})})]})]},e.id)}),S.channels.length<16&&bn.jsx("button",{onClick:C,className:"flex-shrink-0 w-12 flex items-center justify-center border-r border-dark-border\n                      text-text-muted hover:text-accent-primary hover:bg-dark-bgHover transition-colors",title:"Add Channel",children:bn.jsx(Qe,{size:16})})]})})]})}),bn.jsxs("div",{ref:r,className:"flex-1 relative bg-dark-bg",style:{minHeight:200},tabIndex:0,onContextMenu:$.handleContextMenu,children:[bn.jsx("canvas",{ref:a,style:{width:i.width,height:i.height,display:"block"}}),S&&bn.jsx(Wv,{patternId:S.id,patternLength:S.length,rowHeight:kb,channelCount:S.channels.length,channelWidth:ye,rowNumWidth:Mb,scrollOffset:u,visibleStart:h,parameter:"cutoff",prevPatternId:B?N>0?M[N-1]?.id:M.length>1?M[M.length-1]?.id:void 0:void 0,prevPatternLength:B?N>0?M[N-1]?.length:M.length>1?M[M.length-1]?.length:void 0:void 0,nextPatternId:B?N<M.length-1?M[N+1]?.id:M.length>1?M[0]?.id:void 0:void 0,nextPatternLength:B?N<M.length-1?M[N+1]?.length:M.length>1?M[0]?.length:void 0:void 0},`automation-${S.id}-${f}`),bn.jsx("div",{className:"absolute right-0 pointer-events-none z-30 overflow-hidden",style:{top:0,left:Mb,height:"calc(50% - 12px)"},children:bn.jsx(Xv,{channelWidth:ye,scrollLeft:c})}),bn.jsx(lb,{isOpen:$.isOpen,position:$.position,onClose:$.closeMenu,channelIndex:$.cellInfo?.channelIndex??0,rowIndex:$.cellInfo?.rowIndex??0,onOpenParameterEditor:X}),q?.isOpen&&bn.jsx(db,{onClose:()=>Y(null),channelIndex:q.channelIndex,startRow:q.startRow,endRow:q.endRow,field:q.field})]})]})}),Tb=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ab={noteIndex:null,octaveShift:0,accent:!1,slide:!1,tie:!1,mute:!1,hammer:!1,velocity:100};function Ib(e,t){if(!e||0===e||97===e)return null;const n=Va(e).match(/^([A-G])(#?)(-?\d)$/);if(!n)return null;const[,a,s,r]=n,o=parseInt(r,10),i=a+(s||""),l=Tb.indexOf(i);if(-1===l)return null;const c=o-t;return c<-1||c>1?{noteIndex:l,octaveShift:Math.max(-1,Math.min(1,c))}:{noteIndex:l,octaveShift:c}}function _b(e,t){if(null===e.noteIndex)return 0;const n=Tb[e.noteIndex],a=t+e.octaveShift;let s;return s=n.includes("#")?`${n}${a}`:`${n}-${a}`,Ba(s)}function Ob(e){const{patterns:t,currentPatternIndex:n,setCell:a,resizePattern:r,resizeAllPatterns:o}=cm(),[i,l]=s.useState(3),c=t[n],d=c?.channels[e],u=d?.rows||[],p=c?.length||16,h=s.useCallback(e=>{r(n,e)},[n,r]),m=s.useMemo(()=>function(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e[s];if(!n){a.push({...Ab});continue}const r=Ib(n.note,t);let o=!1;if(s>0&&r&&e[s-1]){const n=Ib(e[s-1].note,t);n&&n.noteIndex===r.noteIndex&&n.octaveShift===r.octaveShift&&(o=!0)}a.push({noteIndex:r?.noteIndex??null,octaveShift:r?.octaveShift??0,accent:1===n.flag1||1===n.flag2,slide:2===n.flag1||2===n.flag2,tie:o,mute:3===n.flag1||3===n.flag2,hammer:4===n.flag1||4===n.flag2,velocity:n.volume??100})}return{steps:a,baseOctave:t,length:n}}(u,i,p),[u,i,p]),f=s.useCallback((t,n,s=0)=>{if(t<0||t>=p)return;const r=null!==n?_b({noteIndex:n,octaveShift:s},i):0,o=u[t];if(0!==r&&0===(o?.instrument||0)){a(e,t,{note:r,instrument:d?.instrumentId??1})}else a(e,t,{note:r})},[e,a,i,p,u,d]),y=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=1===u[t]?.flag1||1===u[t]?.flag2;a(e,t,{flag1:n?0:1})},[e,u,a]),g=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=2===u[t]?.flag1||2===u[t]?.flag2;a(e,t,{flag2:n?0:2})},[e,u,a]),v=s.useCallback((t,n)=>{if(t<0||t>=u.length)return;const s=u[t];if(!s?.note)return;const r=Ib(s.note,i);if(!r)return;const o=_b({noteIndex:r.noteIndex,octaveShift:n},i);a(e,t,{note:o})},[e,u,a,i]),b=s.useCallback(t=>{t<0||t>=p||a(e,t,{note:0,flag1:0,flag2:0})},[e,a,p]),x=s.useCallback(()=>{for(let t=0;t<p;t++)a(e,t,{note:0,flag1:0,flag2:0})},[e,a,p]),w=s.useCallback((t,n)=>{if(t<0||t>=u.length)return;const s=Math.max(0,Math.min(127,n));a(e,t,{volume:s})},[e,u,a]),k=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=3===u[t]?.flag1||3===u[t]?.flag2;a(e,t,{flag1:n?0:3})},[e,u,a]),S=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=4===u[t]?.flag1||4===u[t]?.flag2;a(e,t,{flag2:n?0:4})},[e,u,a]);return{gridPattern:m,baseOctave:i,setBaseOctave:l,maxSteps:p,setMaxSteps:h,resizeAllPatterns:o,setNote:f,toggleAccent:y,toggleSlide:g,toggleMute:k,toggleHammer:S,setOctaveShift:v,setVelocity:w,clearStep:b,clearAll:x}}const Fb={chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],description:"All notes"},major:{name:"Major",intervals:[0,2,4,5,7,9,11],description:"Ionian mode"},minor:{name:"Natural Minor",intervals:[0,2,3,5,7,8,10],description:"Aeolian mode"},harmonicMinor:{name:"Harmonic Minor",intervals:[0,2,3,5,7,8,11],description:"Minor with raised 7th"},melodicMinor:{name:"Melodic Minor",intervals:[0,2,3,5,7,9,11],description:"Minor with raised 6th and 7th"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],description:"Minor with raised 6th"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],description:"Minor with lowered 2nd"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],description:"Major with raised 4th"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],description:"Major with lowered 7th"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],description:"Diminished scale"},pentatonicMajor:{name:"Pentatonic Major",intervals:[0,2,4,7,9],description:"5-note major scale"},pentatonicMinor:{name:"Pentatonic Minor",intervals:[0,3,5,7,10],description:"5-note minor scale"},blues:{name:"Blues",intervals:[0,3,5,6,7,10],description:"Minor pentatonic + blue note"},wholeTone:{name:"Whole Tone",intervals:[0,2,4,6,8,10],description:"All whole steps"},diminished:{name:"Diminished",intervals:[0,2,3,5,6,8,9,11],description:"Half-whole diminished"}};const Db=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Rb=({scaleKey:e,rootNote:t,onScaleChange:n,onRootNoteChange:a})=>{const r=s.useMemo(()=>Object.entries(Fb).map(([e,t])=>({value:e,label:t.name,description:t.description})),[]),o=s.useMemo(()=>Fb[e]||Fb.chromatic,[e]);return bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Root:"}),bn.jsx("select",{value:t,onChange:e=>a(parseInt(e.target.value,10)),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary",children:Db.map((e,t)=>bn.jsx("option",{value:t,children:e},t))})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Scale:"}),bn.jsx("select",{value:e,onChange:e=>n(e.target.value),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary min-w-[140px]",title:o?.description,children:r.map(e=>bn.jsx("option",{value:e.value,title:e.description,children:e.label},e.value))})]}),"Chromatic"!==o.name&&bn.jsxs("span",{className:"text-[10px] text-text-muted",children:["(",o.intervals.length," notes)"]})]})},jb={baseOctave:{label:"Base Octave",min:1,max:6,group:"General"},velocity:{label:"Velocity",min:0,max:127,group:"General"},cutoff:{label:"Cutoff",min:200,max:5e3,group:"303 Main"},resonance:{label:"Resonance",min:0,max:100,group:"303 Main"},envMod:{label:"Env Mod",min:0,max:100,group:"303 Main"},decay:{label:"Decay",min:200,max:2e3,group:"303 Main"},accent:{label:"Accent",min:0,max:100,group:"303 Main"},slideTime:{label:"Slide Time",min:2,max:360,group:"303 Main"},overdrive:{label:"Overdrive",min:0,max:100,group:"303 Main"},normalDecay:{label:"Normal Decay",min:30,max:3e3,group:"Devil Fish"},accentDecay:{label:"Accent Decay",min:30,max:3e3,group:"Devil Fish"},softAttack:{label:"Soft Attack",min:.3,max:30,group:"Devil Fish"},vegSustain:{label:"VEG Sustain",min:0,max:100,group:"Devil Fish"},filterFM:{label:"Filter FM",min:0,max:100,group:"Devil Fish"},filterTracking:{label:"Key Track",min:0,max:200,group:"Devil Fish"}},Lb=({onClose:e})=>{const{devices:t,isSupported:n,isEnabled:a,lastMessage:r,enableMIDI:o,disableMIDI:i,onMessage:l}=Fg(),{gridMappings:c,gridIsLearning:d,gridLearningParameter:u,addGridMapping:p,removeGridMapping:h,clearGridMappings:m,startGridLearning:f,stopGridLearning:y}=Ny(),[g,v]=s.useState(null);s.useEffect(()=>{if(!d||!u)return;return l(e=>{if("cc"===e.type&&void 0!==e.controller&&void 0!==e.value){const t=jb[u];p({channel:e.channel,controller:e.controller,parameter:u,min:t.min,max:t.max,curve:"linear"}),y()}})},[d,u,l,p,y]);return n?bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4 space-y-4",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[bn.jsx(Pe,{size:16}),"MIDI Learn"]}),e&&bn.jsx("button",{onClick:e,className:"text-text-muted hover:text-text-primary text-xs",children:"Close"})]}),bn.jsx("div",{className:"flex items-center gap-3",children:a?bn.jsxs(bn.Fragment,{children:[bn.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-xs transition-colors",children:"Disable MIDI"}),bn.jsxs("span",{className:"flex items-center gap-1 text-xs text-accent-success",children:[bn.jsx("span",{className:"w-2 h-2 bg-accent-success rounded-full animate-pulse"}),"Connected"]})]}):bn.jsx("button",{onClick:async()=>{try{v(null),await o()}catch(e){v(e instanceof Error?e.message:"Failed to enable MIDI")}},className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white rounded text-xs font-medium transition-colors",children:"Enable MIDI"})}),g&&bn.jsx("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-2 text-xs text-accent-error",children:g}),a&&t.length>0&&bn.jsxs("div",{children:[bn.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-2",children:"Connected Devices"}),bn.jsx("div",{className:"space-y-1",children:t.map(e=>bn.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted bg-dark-bgTertiary rounded px-2 py-1",children:[bn.jsx("span",{className:"w-2 h-2 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),bn.jsx("span",{className:"flex-1",children:e.name}),bn.jsx("span",{className:"text-[10px] opacity-60",children:e.manufacturer})]},e.id))})]}),a&&r&&"cc"===r.type&&bn.jsxs("div",{className:"bg-dark-bgTertiary rounded p-2",children:[bn.jsx("div",{className:"text-xs text-text-muted",children:"Last CC Message:"}),bn.jsxs("div",{className:"text-xs font-mono text-text-primary mt-1",children:["CH",r.channel+1," CC",r.controller," = ",r.value]})]}),a&&bn.jsxs("div",{className:"space-y-3",children:[bn.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Map Parameters"}),["General","303 Main","Devil Fish"].map(e=>{const t=Object.keys(jb).filter(t=>jb[t].group===e);return 0===t.length?null:bn.jsxs("div",{children:[bn.jsx("div",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide mb-1.5",children:e}),bn.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:t.map(e=>{const t=Object.values(c).some(t=>t.parameter===e),n=d&&u===e;return bn.jsxs("button",{onClick:()=>{n?y():f(e)},className:`\n                          flex items-center gap-2 px-2 py-1.5 rounded text-xs transition-colors\n                          ${n?"bg-accent-primary text-white animate-pulse":t?"bg-accent-success/20 text-accent-success border border-accent-success/30":"bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary"}\n                        `,children:[n&&bn.jsx(Ae,{size:12,className:"animate-spin"}),bn.jsx("span",{className:"flex-1 text-left",children:jb[e].label}),t&&!n&&bn.jsx("span",{className:"text-[10px]",children:""})]},e)})})]},e)}),d&&bn.jsxs("p",{className:"text-xs text-accent-primary mt-2 animate-pulse",children:["Move a MIDI controller to assign it to ",jb[u].label,"..."]})]}),a&&Object.keys(c).length>0&&bn.jsxs("div",{children:[bn.jsxs("div",{className:"flex items-center justify-between mb-2",children:[bn.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Active Mappings"}),bn.jsxs("button",{onClick:m,className:"flex items-center gap-1 text-xs text-accent-error hover:underline",children:[bn.jsx(Le,{size:10}),"Clear All"]})]}),bn.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(c).map(([e,t])=>bn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgTertiary rounded px-2 py-1 text-xs",children:[bn.jsx("span",{className:"text-text-primary",children:jb[t.parameter].label}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsxs("span",{className:"font-mono text-text-muted text-[10px]",children:["CH",t.channel+1," CC",t.controller]}),bn.jsx("button",{onClick:()=>h(t.channel,t.controller),className:"text-accent-error hover:text-accent-error/80",children:bn.jsx(Le,{size:10})})]})]},e))})]})]}):bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4",children:[bn.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[bn.jsx(wt,{size:16}),bn.jsx("span",{className:"text-sm",children:"Web MIDI API not supported in this browser"})]}),bn.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})},Bb=({baseOctave:e,onBaseOctaveChange:t,maxSteps:n,onMaxStepsChange:a,onResizeAllPatterns:r,scaleKey:o,rootNote:i,onScaleChange:l,onRootNoteChange:c,onClearAll:d,onRandomize:u,onAcidGenerator:p})=>{const[h,m]=s.useState(!1);return bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{className:"flex items-center gap-4 p-2 bg-dark-bgSecondary border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Octave"}),bn.jsxs("div",{className:"flex items-center",children:[bn.jsx("button",{onClick:()=>t(Math.max(1,e-1)),disabled:e<=1,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:bn.jsx(Ce,{size:14})}),bn.jsx("span",{className:"w-8 text-center text-sm font-mono text-text-primary",children:e}),bn.jsx("button",{onClick:()=>t(Math.min(6,e+1)),disabled:e>=6,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:bn.jsx(kt,{size:14})})]}),bn.jsxs("span",{className:"text-xs text-text-muted",children:["C",e," - C",e+2]})]}),bn.jsx("div",{className:"w-px h-6 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Steps"}),bn.jsxs("select",{value:n,onChange:e=>a(Number(e.target.value)),className:"px-2 py-1 text-sm bg-dark-bgTertiary border border-dark-border rounded text-text-primary",children:[bn.jsx("option",{value:4,children:"4"}),bn.jsx("option",{value:8,children:"8"}),bn.jsx("option",{value:12,children:"12"}),bn.jsx("option",{value:16,children:"16"}),bn.jsx("option",{value:24,children:"24"}),bn.jsx("option",{value:32,children:"32"}),bn.jsx("option",{value:64,children:"64"})]}),bn.jsx("button",{onClick:()=>r(n),className:"px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Apply this step count to all patterns",children:"Apply All"})]}),bn.jsx("div",{className:"w-px h-6 bg-dark-border"}),bn.jsx(Rb,{scaleKey:o,rootNote:i,onScaleChange:l,onRootNoteChange:c}),bn.jsx("div",{className:"w-px h-6 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsxs("button",{onClick:()=>m(!h),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors "+(h?"bg-accent-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-dark-bgActive"),title:"MIDI Learn",children:[bn.jsx(Pe,{size:12}),"MIDI"]}),p&&bn.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate 303 acid pattern",children:[bn.jsx(st,{size:12}),"Acid"]}),u&&bn.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate random pattern",children:[bn.jsx(St,{size:12}),"Random"]}),bn.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-accent-error hover:bg-accent-error/10 rounded transition-colors",title:"Clear all steps",children:[bn.jsx(Le,{size:12}),"Clear"]})]})]}),h&&bn.jsx("div",{className:"border-b border-dark-border p-3 bg-dark-bg",children:bn.jsx(Lb,{onClose:()=>m(!1)})})]})},Vb=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],zb=127,Ub=s.memo(({isActive:e,isCurrentStep:t=!1,onClick:n,color:a="default",size:s="normal"})=>{const r="small"===s?"w-5 h-5":"w-7 h-7";return bn.jsx("button",{onClick:n,className:`\n        ${r} rounded transition-all duration-75 border\n        ${(()=>{if(!e)return"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border";switch(a){case"accent":return"bg-accent-warning hover:bg-accent-warning/80 border-accent-warning/50";case"slide":return"bg-accent-secondary hover:bg-accent-secondary/80 border-accent-secondary/50";case"octave":return"bg-accent-primary/50 hover:bg-accent-primary/70 border-accent-primary/50";default:return"bg-accent-primary hover:bg-accent-primary/80 border-accent-primary/50"}})()}\n        ${t?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":""}\n        ${e?"shadow-sm":""}\n      `})}),Gb=({x:e,y:t,accent:n,slide:a,mute:r,hammer:o,octaveShift:i,velocity:l,onToggleAccent:c,onToggleSlide:d,onToggleMute:u,onToggleHammer:p,onSetOctave:h,onSetVelocity:m,onClose:f})=>{const[y,g]=s.useState(l);return s.useEffect(()=>{const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"fixed inset-0 z-40",onClick:f}),bn.jsxs("div",{className:"fixed z-50 bg-dark-bgSecondary border border-dark-border rounded shadow-lg py-1 min-w-[160px]",style:{left:e,top:t},children:[bn.jsxs("button",{onClick:()=>{c(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(n?"text-accent-warning":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(n?"bg-accent-warning":"border border-text-muted")}),"Accent ",n&&""]}),bn.jsxs("button",{onClick:()=>{d(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(a?"text-accent-secondary":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 "+(a?"text-accent-secondary":"text-text-muted"),children:""}),"Slide ",a&&""]}),bn.jsx("div",{className:"border-t border-dark-border my-1"}),bn.jsxs("button",{onClick:()=>{u(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(r?"text-yellow-400":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(r?"bg-yellow-400":"border border-text-muted")}),"Mute ",r&&""]}),bn.jsxs("button",{onClick:()=>{p(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(o?"text-cyan-400":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(o?"bg-cyan-400":"border border-text-muted")}),"Hammer ",o&&""]}),bn.jsx("div",{className:"border-t border-dark-border my-1"}),bn.jsxs("button",{onClick:()=>{h(1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(1===i?"text-cyan-400":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(1===i?"bg-accent-primary ring-2 ring-cyan-400 ring-inset":"border border-text-muted")}),"Oct+ ",1===i&&""]}),bn.jsxs("button",{onClick:()=>{h(0),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(0===i?"text-accent-primary":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(0===i?"bg-accent-primary":"border border-text-muted")}),"Normal ",0===i&&""]}),bn.jsxs("button",{onClick:()=>{h(-1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(-1===i?"text-pink-400":"text-text-secondary"),children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm "+(-1===i?"bg-accent-primary ring-2 ring-pink-400 ring-inset":"border border-text-muted")}),"Oct- ",-1===i&&""]}),bn.jsx("div",{className:"border-t border-dark-border my-1"}),bn.jsxs("div",{className:"px-3 py-2",children:[bn.jsxs("div",{className:"flex items-center justify-between mb-1",children:[bn.jsx("span",{className:"text-xs text-text-secondary",children:"Velocity"}),bn.jsx("span",{className:"text-xs text-text-primary font-mono",children:y})]}),bn.jsx("input",{type:"range",min:1,max:zb,value:y,onChange:e=>{const t=parseInt(e.target.value,10);g(t),m(t)},className:"w-full h-1 bg-dark-bgTertiary rounded-lg appearance-none cursor-pointer accent-accent-primary"}),bn.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-text-muted",children:[bn.jsx("button",{onClick:()=>{m(64),g(64)},className:"hover:text-text-secondary",children:"50%"}),bn.jsx("button",{onClick:()=>{m(100),g(100)},className:"hover:text-text-secondary",children:"Default"}),bn.jsx("button",{onClick:()=>{m(zb),g(zb)},className:"hover:text-text-secondary",children:"Max"})]})]})]})]})},Kb=s.memo(({noteIndex:e,stepIndex:t,isActive:n,isCurrentStep:a,isTriggered:r=!1,isFocused:o=!1,accent:i=!1,slide:l=!1,mute:c=!1,hammer:d=!1,octaveShift:u=0,velocity:p=100,onClick:h,onToggleAccent:m,onToggleSlide:f,onToggleMute:y,onToggleHammer:g,onSetOctave:v,onSetVelocity:b,onFocus:x})=>{const[w,k]=s.useState(null),S=s.useCallback(a=>{if(n){if(a.shiftKey&&m)return void m(t);if((a.ctrlKey||a.metaKey)&&f)return void f(t);if(a.altKey&&v){return void v(t,0===u?1:1===u?-1:0)}}h(e,t,{shift:a.shiftKey,ctrl:a.ctrlKey||a.metaKey,alt:a.altKey})},[h,e,t,n,m,f,v,u]),M=s.useCallback(e=>{n&&(e.preventDefault(),k({x:e.clientX,y:e.clientY}))},[n]),N=s.useCallback(()=>{k(null)},[]),C=s.useCallback(()=>{m?.(t)},[m,t]),E=s.useCallback(()=>{f?.(t)},[f,t]),P=s.useCallback(()=>{y?.(t)},[y,t]),T=s.useCallback(()=>{g?.(t)},[g,t]),A=s.useCallback(e=>{v?.(t,e)},[v,t]),I=s.useCallback(e=>{b?.(t,e)},[b,t]),_=s.useCallback(e=>{if(!n||!b)return;e.preventDefault();const a=e.deltaY>0?-5:5,s=Math.max(1,Math.min(zb,p+a));b(t,s)},[n,b,t,p]),O=s.useCallback(()=>{x?.()},[x]);return bn.jsxs(bn.Fragment,{children:[bn.jsxs("button",{onClick:S,onContextMenu:M,onWheel:_,onFocus:O,tabIndex:o?0:-1,className:`\n          w-7 h-7 rounded transition-all duration-75 border relative\n          ${n?i?"bg-accent-warning hover:brightness-110 border-accent-warning/50":"bg-accent-primary hover:brightness-110 border-accent-primary/50":"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border"}\n          ${a?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":n&&0!==u?u>0?"ring-2 ring-cyan-400 ring-inset":"ring-2 ring-pink-400 ring-inset":""}\n          ${o&&!a?"ring-2 ring-text-secondary ring-offset-1 ring-offset-dark-bg":""}\n          ${n?"shadow-sm":""}\n          ${r&&n?"!bg-white scale-110 shadow-lg shadow-white/50":""}\n          ${!n||p>=100?"":p<50?"ring-1 ring-inset ring-black/30":p<80?"ring-1 ring-inset ring-black/15":""}\n          focus:outline-none\n        `,title:n?`Velocity: ${p} | Shift+click: accent, Ctrl+click: slide, Alt+click: octave, Scroll: velocity`:"","aria-label":`Step ${t+1}, Note ${Vb[e]}${n?", Active":""}`,"aria-pressed":n,children:[n&&l&&!c&&bn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-xs font-bold",children:""}),n&&c&&bn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400 text-xs font-bold",children:"M"}),n&&d&&!c&&bn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-cyan-400 text-xs font-bold",children:"H"})]}),w&&bn.jsx(Gb,{x:w.x,y:w.y,accent:i,slide:l,mute:c,hammer:d,octaveShift:u,velocity:p,onToggleAccent:C,onToggleSlide:E,onToggleMute:P,onToggleHammer:T,onSetOctave:A,onSetVelocity:I,onClose:N})]})});s.memo(({stepIndex:t,isActive:n,isCurrentStep:a,color:s,onClick:r})=>{const o=e.useCallback(()=>{r(t)},[r,t]);return bn.jsx(Ub,{isActive:n,isCurrentStep:a,onClick:o,color:s})});const Hb=["MINOR","MAJOR","DORIAN","MIXOLYDIAN","PHRYGIAN","HARMONIC_MINOR","PHRYGIAN_DOMINANT","MELODIC_MINOR","LYDIAN_DOMINANT","HUNGARIAN_MINOR"],Wb={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]};function $b(e,t){return Math.floor(Math.random()*(t-e+1))+e}function qb(e,t){const n=[...e],a=[],s=Math.min(t,e.length);for(let r=0;r<s;r++){const e=Math.floor(Math.random()*(n.length-r))+r;[n[r],n[e]]=[n[e],n[r]],a.push(n[r])}return a}function Yb(e={}){const{patternLength:t=16,density:n=60,spread:a=60,accentsDensity:s=50,slidesDensity:r=40,scale:o="MINOR",rootNote:i="C2",instrumentId:l=1}=e,c=function(e){const{patternLength:t,density:n,spread:a,accentsDensity:s,slidesDensity:r}=e,o=Array.from({length:t},(e,t)=>t),i=Math.round(t*(n/100)),l=$b(Math.round(i/2),i),c=qb(o,l),d=Math.max(1,Math.round(l/2*(s/100))),u=Math.round(l/2*(r/100)),p=qb(c,$b(1,d)),h=qb(c,$b(0,u)),m=Math.round(a/100*6),f=qb(Array.from({length:7},(e,t)=>t),Math.max(1,m)),y=qb(c,$b(0,l));return o.map(e=>{if(!c.includes(e))return{note:null,octave:null,accent:null,slide:null};const t=$b(-1,1);return{note:y.includes(e)&&f.length>0?f[$b(0,f.length-1)]:0,octave:t,accent:p.includes(e),slide:h.includes(e)}})}({patternLength:t,density:n,spread:a,accentsDensity:s,slidesDensity:r}),d=Wb[o],u=function(e){const t=e.match(/^([A-G][b#]?)(-?\d+)$/);if(!t)return 36;const[,n,a]=t,s=parseInt(a,10),r={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===r?36:r+12*(s+1)}(i);return c.map(e=>{if(null===e.note||null===e.octave)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const t=function(e,t,n,a){return t[e]+n+12*a}(e.note,d,u,e.octave),n=Wa(t),a=e.accent?64:$b(48,56);return{note:n,instrument:l,volume:16+a,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:void 0,flag2:e.slide?2:void 0}})}function Xb(e){return{MINOR:"Minor (Natural)",MAJOR:"Major",DORIAN:"Dorian",MIXOLYDIAN:"Mixolydian",PHRYGIAN:"Phrygian",HARMONIC_MINOR:"Harmonic Minor",PHRYGIAN_DOMINANT:"Phrygian Dominant",MELODIC_MINOR:"Melodic Minor",LYDIAN_DOMINANT:"Lydian Dominant",HUNGARIAN_MINOR:"Hungarian Minor"}[e]}const Qb=({channelIndex:e,onClose:t})=>{const{patterns:n,currentPatternIndex:a,setChannelRows:r}=cm(),o=n[a],i=o?.channels[e],l=i?.instrumentId??0,[c,d]=s.useState(60),[u,p]=s.useState(60),[h,m]=s.useState(50),[f,y]=s.useState(40),[g,v]=s.useState("MINOR"),[b,x]=s.useState("C2"),w=["C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"];return i?bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(st,{size:18,className:"text-accent-primary"}),bn.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"Acid Pattern Generator"})]}),bn.jsx("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:bn.jsx(Te,{size:18})})]}),bn.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[bn.jsx("div",{className:"bg-dark-bgTertiary p-3 rounded border border-ft2-border",children:bn.jsxs("div",{className:"text-sm text-ft2-textDim",children:["Generating for: ",bn.jsx("span",{className:"font-bold text-ft2-text",children:i.name}),bn.jsx("br",{}),"Pattern Length: ",bn.jsxs("span",{className:"font-mono",children:[o.length," steps"]})]})}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Scale"}),bn.jsx("select",{value:g,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:Hb.map(e=>bn.jsx("option",{value:e,children:Xb(e)},e))})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Root Note"}),bn.jsx("select",{value:b,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:w.map(e=>bn.jsx("option",{value:e,children:e},e))})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Density: ",bn.jsxs("span",{className:"font-mono text-accent-primary",children:[c,"%"]})]}),bn.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:e=>d(parseInt(e.target.value)),className:"w-full"}),bn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many notes in the pattern (sparse   dense)"})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Spread: ",bn.jsxs("span",{className:"font-mono text-accent-primary",children:[u,"%"]})]}),bn.jsx("input",{type:"range",min:"0",max:"100",value:u,onChange:e=>p(parseInt(e.target.value)),className:"w-full"}),bn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"Note range variety (narrow   wide)"})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Accents: ",bn.jsxs("span",{className:"font-mono text-accent-primary",children:[h,"%"]})]}),bn.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:e=>m(parseInt(e.target.value)),className:"w-full"}),bn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many accented notes (subtle   punchy)"})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Slides: ",bn.jsxs("span",{className:"font-mono text-accent-primary",children:[f,"%"]})]}),bn.jsx("input",{type:"range",min:"0",max:"100",value:f,onChange:e=>y(parseInt(e.target.value)),className:"w-full"}),bn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many slides/portamento (few   many)"})]})]}),bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[bn.jsxs("button",{onClick:()=>{d(Math.floor(60*Math.random())+40),p(Math.floor(60*Math.random())+40),m(Math.floor(60*Math.random())+20),y(Math.floor(60*Math.random())+20),v(Hb[Math.floor(Math.random()*Hb.length)]);const e=w[Math.floor(Math.random()*w.length)];x(e)},className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[bn.jsx(Mt,{size:14}),"Randomize"]}),bn.jsxs("div",{className:"flex gap-2",children:[bn.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"}),bn.jsx("button",{onClick:()=>{(()=>{if(!i)return;const t=Yb({patternLength:o.length,density:c,spread:u,accentsDensity:h,slidesDensity:f,scale:g,rootNote:b,instrumentId:l});r(e,t)})(),t()},className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Generate Pattern"})]})]})]})}):null},Zb=["B","A#","A","G#","G","F#","F","E","D#","D","C#","C"],Jb=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ex=[11,10,9,8,7,6,5,4,3,2,1,0],tx=({channelIndex:e})=>{const{gridPattern:t,baseOctave:n,setBaseOctave:a,maxSteps:r,setMaxSteps:o,resizeAllPatterns:i,setNote:l,toggleAccent:c,toggleSlide:d,toggleMute:u,toggleHammer:p,setOctaveShift:h,setVelocity:m,clearAll:f}=Ob(e),{currentRow:y,isPlaying:g,smoothScrolling:v,bpm:b,speed:w}=Gf(),k=g?y%r:-1,S=s.useRef(null),M=s.useRef(-1),N=s.useRef(0),C=s.useRef(0),E=s.useRef(0),P=s.useRef(t.steps);P.current=t.steps;const[T,A]=s.useState(null),I=s.useRef(null),[_,O]=s.useState("chromatic"),[F,D]=s.useState(0),[R,j]=s.useState(!1),{onMessage:L}=Fg(),{applyGridMIDIValue:B}=Ny();s.useEffect(()=>{null===T&&r>0&&A({noteIndex:11,stepIndex:0})},[T,r]),s.useEffect(()=>{if(!g||!v)return M.current=-1,N.current=0,void(E.current&&(cancelAnimationFrame(E.current),E.current=0));const e=S.current;if(!e)return;const t=2.5/b*w*1e3,n=()=>{const a=performance.now();k!==M.current&&(M.current=k,N.current=a);const s=a-N.current,r=Math.min(s/t,1),o=48+32*(k+r),i=e.clientWidth,l=Math.max(0,o-.4*i);C.current+=.15*(l-C.current),e.scrollLeft=C.current,E.current=requestAnimationFrame(n)};return C.current=e.scrollLeft,E.current=requestAnimationFrame(n),()=>{E.current&&(cancelAnimationFrame(E.current),E.current=0)}},[g,v,b,w,k]),s.useEffect(()=>L(e=>{if("cc"!==e.type||void 0===e.controller||void 0===e.value)return;const t=B(e.channel,e.controller,e.value);if(null===t)return;const n=Ny.getState().getGridMapping(e.channel,e.controller);if(n&&"baseOctave"===n.parameter)a(Math.round(t))}),[L,B,a]);const[V]=s.useState(!0),z=s.useCallback((t,a=0,s=!1,r=!1)=>{if(V)try{const o=em();if(!o)return;const{patterns:i,currentPatternIndex:l}=cm.getState(),c=i[l],d=c?.channels[e],u=d?.instrumentId??1,p=Df.getState().instruments.find(e=>e.id===u);if(p){const e=`${Jb[t]}${n+a}`;o.triggerNote(u,e,.2,x(),.8,p,s,r)}}catch(o){}},[V,e,n]),U=s.useCallback((e,t)=>{const n=P.current[t];if(n?.noteIndex===e)l(t,null);else{const a=null!==n?.noteIndex?n.octaveShift:0;l(t,e,a),z(e,a,n?.accent||!1,n?.slide||!1)}},[l,z]),G=s.useCallback((e,t)=>{h(e,t)},[h]),K=s.useCallback(()=>{for(let e=0;e<r;e++)if(Math.random()<.7){const t=Math.floor(12*Math.random()),n=Math.random()<.3?Math.random()<.5?-1:1:0;l(e,t,n),Math.random()<.25&&c(e),e>0&&Math.random()<.2&&d(e)}else l(e,null)},[r,l,c,d]),H=s.useCallback(()=>{j(!0)},[]),W=s.useMemo(()=>Array.from({length:r},(e,t)=>t),[r]),$=s.useMemo(()=>{const e=Fb[_];return e&&"chromatic"!==_?ex.filter(t=>function(e,t,n){if(e<0||e>11)return!1;if(t<0||t>11)return!1;const a=(e-t+12)%12;return n.intervals.includes(a)}(t,F,e)):ex},[_,F]),q=s.useCallback(e=>{if(!T)return;const{noteIndex:t,stepIndex:n}=T,a=P.current[n],s=a?.noteIndex===t;if("ArrowRight"===e.key)e.preventDefault(),A({noteIndex:t,stepIndex:Math.min(n+1,r-1)});else if("ArrowLeft"===e.key)e.preventDefault(),A({noteIndex:t,stepIndex:Math.max(n-1,0)});else if("ArrowDown"===e.key){e.preventDefault();const a=ex.indexOf(t),s=Math.min(a+1,ex.length-1);A({noteIndex:ex[s],stepIndex:n})}else if("ArrowUp"===e.key){e.preventDefault();const a=ex.indexOf(t),s=Math.max(a-1,0);A({noteIndex:ex[s],stepIndex:n})}else if("Enter"===e.key||" "===e.key)e.preventDefault(),U(t,n);else if(s)if("a"===e.key||"A"===e.key)e.preventDefault(),c(n);else if("s"===e.key||"S"===e.key)e.preventDefault(),d(n);else if("m"===e.key||"M"===e.key)e.preventDefault(),u(n);else if("h"===e.key||"H"===e.key)e.preventDefault(),p(n);else if("o"===e.key||"O"===e.key){e.preventDefault();const t=a?.octaveShift??0;h(n,0===t?1:1===t?-1:0)}else if("v"===e.key||"V"===e.key)e.preventDefault(),m(n,100);else if("+"===e.key||"="===e.key){e.preventDefault();const t=a?.velocity??100;m(n,Math.min(127,t+10))}else if("-"===e.key||"_"===e.key){e.preventDefault();const t=a?.velocity??100;m(n,Math.max(1,t-10))}},[T,U,r,c,d,u,p,h,m]);return bn.jsxs("div",{className:"flex flex-col h-full bg-dark-bg",children:[bn.jsx(Bb,{baseOctave:n,onBaseOctaveChange:a,maxSteps:r,onMaxStepsChange:o,onResizeAllPatterns:i,scaleKey:_,rootNote:F,onScaleChange:O,onRootNoteChange:D,onClearAll:f,onRandomize:K,onAcidGenerator:H}),bn.jsxs("div",{ref:S,className:"flex-1 overflow-auto p-2",children:[bn.jsxs("div",{ref:I,className:"inline-block min-w-full",role:"grid","aria-label":"TB-303 Pattern Grid",onKeyDown:q,tabIndex:0,children:[bn.jsx("div",{className:"flex items-center mb-1 pl-12",role:"row",children:W.map(e=>bn.jsx("div",{className:`w-7 h-4 flex items-center justify-center text-[10px] font-mono mx-0.5\n                  ${e%4==0?"text-text-primary":"text-text-muted"}\n                  ${k===e?"text-accent-primary font-bold":""}\n                `,children:(e+1).toString().padStart(2,"0")},e))}),$.map(e=>{const n=ex.indexOf(e),a=e===F;return bn.jsxs("div",{className:"flex items-center mb-0.5",role:"row",children:[bn.jsxs("div",{className:`w-10 mr-2 text-right text-xs font-mono\n                    ${a?"text-accent-primary font-bold":Zb[n].includes("#")?"text-text-muted":"text-text-secondary"}\n                  `,"aria-label":`Note ${Zb[n]}${a?" (Root)":""}`,children:[Zb[n],a&&bn.jsx("span",{className:"ml-0.5 text-[8px]",children:""})]}),W.map(n=>{const a=t.steps[n],s=a?.noteIndex===e,r=T?.noteIndex===e&&T?.stepIndex===n;return bn.jsx("div",{className:"mx-0.5",role:"gridcell",children:bn.jsx(Kb,{noteIndex:e,stepIndex:n,isActive:s,isCurrentStep:k===n,isTriggered:k===n&&s,isFocused:r,accent:!!s&&a?.accent,slide:!!s&&a?.slide,mute:!!s&&a?.mute,hammer:!!s&&a?.hammer,octaveShift:s?a?.octaveShift:0,velocity:s?a?.velocity:100,onClick:U,onToggleAccent:c,onToggleSlide:d,onToggleMute:u,onToggleHammer:p,onSetOctave:G,onSetVelocity:m,onFocus:()=>A({noteIndex:e,stepIndex:n})})},n)})]},e)})]}),bn.jsxs("div",{className:"mt-4 pt-3 border-t border-dark-border space-y-2",children:[bn.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[bn.jsx("span",{children:"Click: note"}),bn.jsxs("span",{className:"flex items-center gap-1",children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-warning/80"})," Shift+click: accent"]}),bn.jsxs("span",{className:"flex items-center gap-1",children:[bn.jsx("span",{className:"text-accent-secondary",children:""})," Ctrl+click: slide"]}),bn.jsxs("span",{className:"flex items-center gap-1",children:[bn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-cyan-400 ring-inset"}),bn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-pink-400 ring-inset"}),"Alt+click: octave"]}),bn.jsx("span",{children:"Right-click: menu"}),bn.jsx("span",{children:"Scroll: velocity"})]}),bn.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[bn.jsx("span",{className:"font-semibold text-text-secondary",children:"Keyboard:"}),bn.jsx("span",{children:"Arrows: navigate"}),bn.jsx("span",{children:"Enter/Space: toggle"}),bn.jsx("span",{children:"A: accent"}),bn.jsx("span",{children:"S: slide"}),bn.jsx("span",{children:"M: mute"}),bn.jsx("span",{children:"H: hammer"}),bn.jsx("span",{children:"O: octave"}),bn.jsx("span",{children:"V: velocity reset"}),bn.jsx("span",{children:"+/-: velocity 10"})]})]})]}),R&&bn.jsx(Qb,{channelIndex:e,onClose:()=>j(!1)})]})},nx={z:{note:"C",octaveOffset:0},s:{note:"C#",octaveOffset:0},x:{note:"D",octaveOffset:0},d:{note:"D#",octaveOffset:0},c:{note:"E",octaveOffset:0},v:{note:"F",octaveOffset:0},g:{note:"F#",octaveOffset:0},b:{note:"G",octaveOffset:0},h:{note:"G#",octaveOffset:0},n:{note:"A",octaveOffset:0},j:{note:"A#",octaveOffset:0},m:{note:"B",octaveOffset:0},",":{note:"C",octaveOffset:1},q:{note:"C",octaveOffset:1},2:{note:"C#",octaveOffset:1},w:{note:"D",octaveOffset:1},3:{note:"D#",octaveOffset:1},e:{note:"E",octaveOffset:1},r:{note:"F",octaveOffset:1},5:{note:"F#",octaveOffset:1},t:{note:"G",octaveOffset:1},6:{note:"G#",octaveOffset:1},y:{note:"A",octaveOffset:1},7:{note:"A#",octaveOffset:1},u:{note:"B",octaveOffset:1},i:{note:"C",octaveOffset:2},9:{note:"C#",octaveOffset:2},o:{note:"D",octaveOffset:2},0:{note:"D#",octaveOffset:2},p:{note:"E",octaveOffset:2}},ax={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7},sx={a:8,s:9,d:10,f:11,g:12,h:13,j:14,k:15},rx="0123456789ABCDEFabcdef",ox={0:0,1:1,2:2,3:3,4:4,"-":6,"+":7,d:8,u:9,s:10,v:11,p:12,l:13,r:14,m:15},ix={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35};const lx=({isOpen:e,onClose:t,children:n,theme:a="modern",size:r="md",backdropOpacity:o="medium",rounded:i=!0,closeOnBackdropClick:l=!0,closeOnEscape:c=!0,animation:d="fade",className:u=""})=>{s.useEffect(()=>{if(!e||!c)return;const n=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,c,t]);if(!e)return null;const p=`\n    fixed inset-0 z-50 flex items-center justify-center p-4\n    ${{light:"bg-black/50",medium:"bg-black/60",dark:"bg-black/80"}[o]}\n  `,h=`\n    ${{sm:"w-80 max-w-sm",md:"w-96 max-w-md",lg:"max-w-2xl w-full",xl:"max-w-4xl w-full",fullscreen:"w-full h-full"}[r]}\n    ${"retro"===a?"bg-ft2-bg border-ft2-border":"bg-dark-bg border-dark-border"}\n    ${"retro"===a?"border-2":"border"}\n    ${i?"rounded-lg":""}\n    ${{fade:"animate-fade-in",slide:"animate-slide-in-up",scale:"animate-scale-in"}[d]}\n    ${"fullscreen"!==r?"shadow-xl max-h-[90vh] overflow-hidden":""}\n    ${u}\n    flex flex-col\n  `;return bn.jsx("div",{className:p,onClick:e=>{l&&e.target===e.currentTarget&&t()},children:bn.jsx("div",{className:h,children:n})})},cx=({title:e,subtitle:t,icon:n,onClose:a,theme:s="modern",showCloseButton:r=!0})=>{const o="retro"===s?"bg-ft2-header border-ft2-border text-ft2-highlight":"bg-dark-bgSecondary border-dark-border text-text-primary",i="retro"===s?"border-b-2":"border-b",l="retro"===s?"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none":"p-2 rounded-lg hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors focus:outline-none";return bn.jsxs("div",{className:`flex items-center justify-between px-4 py-3 ${i} ${o}`,children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[n&&bn.jsx("div",{className:"text-accent-primary",children:n}),bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("h2",{className:"font-bold tracking-wide "+("retro"===s?"text-sm":"text-base"),children:e}),t&&bn.jsx("p",{className:"text-text-secondary "+("retro"===s?"text-xs":"text-sm"),children:t})]})]}),r&&a&&bn.jsx("button",{onClick:a,className:l,"aria-label":"Close",title:"Close (Esc)",children:bn.jsx(Te,{size:16})})]})},dx=({children:e,theme:t="modern",align:n="right"})=>{const a="retro"===t?"bg-ft2-header border-ft2-border":"bg-dark-bgSecondary border-dark-border",s="retro"===t?"border-t-2":"border-t";return bn.jsx("div",{className:`flex gap-2 px-4 py-3 ${s} ${a} ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[n]}`,children:e})},ux=[{value:"volume",label:"Volume",min:0,max:64},{value:"cutoff",label:"Cutoff",min:0,max:127},{value:"resonance",label:"Resonance",min:0,max:127},{value:"envMod",label:"Env Mod",min:0,max:127},{value:"pan",label:"Pan",min:-100,max:100}],px=[{value:"linear",label:"Linear",description:"Constant rate of change"},{value:"log",label:"Logarithmic",description:"Fast start, gradual end"},{value:"exp",label:"Exponential",description:"Gradual start, fast end"},{value:"scurve",label:"S-Curve",description:"Smooth ease in/out"}],hx=({isOpen:e,onClose:t})=>{const{selection:n,interpolateSelection:a}=cm(),[r,o]=s.useState("volume"),[i,l]=s.useState(64),[c,d]=s.useState(0),[u,p]=s.useState("linear"),h=ux.find(e=>e.value===r);return bn.jsxs(lx,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[bn.jsx(cx,{title:"Interpolate Selection",icon:bn.jsx(lt,{size:18}),onClose:t,theme:"modern"}),bn.jsxs("div",{className:"p-4 space-y-4",children:[bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Column"}),bn.jsx("select",{value:r,onChange:e=>(e=>{o(e);const t=ux.find(t=>t.value===e);"pan"===e?(l(-100),d(100)):(l(t.max),d(0))})(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:ux.map(e=>bn.jsx("option",{value:e.value,children:e.label},e.value))})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["Start Value (",h.min," - ",h.max,")"]}),bn.jsx("input",{type:"number",value:i,onChange:e=>l(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["End Value (",h.min," - ",h.max,")"]}),bn.jsx("input",{type:"number",value:c,onChange:e=>d(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Curve"}),bn.jsx("div",{className:"grid grid-cols-4 gap-1",children:px.map(e=>bn.jsx("button",{onClick:()=>p(e.value),className:"px-2 py-1.5 text-xs rounded border transition-colors "+(u===e.value?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),title:e.description,children:e.label},e.value))}),bn.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:px.find(e=>e.value===u)?.description})]}),!n&&bn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),bn.jsxs(dx,{theme:"modern",align:"right",children:[bn.jsx(jv,{variant:"ghost",onClick:t,children:"Cancel"}),bn.jsx(jv,{variant:"primary",onClick:()=>{n?(a(r,i,c,u),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},mx=({isOpen:e,onClose:t})=>{const{selection:n,humanizeSelection:a}=cm(),[r,o]=s.useState(15);return bn.jsxs(lx,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[bn.jsx(cx,{title:"Humanize Selection",icon:bn.jsx(it,{size:18}),onClose:t,theme:"modern"}),bn.jsxs("div",{className:"p-4 space-y-4",children:[bn.jsx("p",{className:"text-xs text-text-muted",children:"Add random variation to volume values to create a more human feel."}),bn.jsxs("div",{children:[bn.jsxs("label",{className:"block text-xs text-text-muted mb-2",children:["Volume Variation: ",bn.jsxs("span",{className:"text-accent-primary font-mono",children:[r,"%"]})]}),bn.jsx("input",{type:"range",value:r,onChange:e=>o(parseInt(e.target.value)),min:0,max:50,className:"w-full accent-accent-primary"}),bn.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-1",children:[bn.jsx("span",{children:"0% (none)"}),bn.jsx("span",{children:"50% (max)"})]})]}),bn.jsx("div",{className:"bg-dark-bg rounded p-3 text-xs text-text-secondary",children:bn.jsxs("p",{children:["Each note's volume will be randomly adjusted by up to ",r,"% of its current value."]})}),!n&&bn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),bn.jsxs(dx,{theme:"modern",align:"right",children:[bn.jsx(jv,{variant:"ghost",onClick:t,children:"Cancel"}),bn.jsx(jv,{variant:"primary",onClick:()=>{n?(a(r),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},fx=({isOpen:e,onClose:t})=>{const{patterns:n,currentPatternIndex:a,selection:r}=cm(),[o,i]=s.useState("note"),[l,c]=s.useState("pattern"),[d,u]=s.useState(""),[p,h]=s.useState(""),[m,f]=s.useState(null),[y,g]=s.useState(null),v=n[a];return bn.jsxs(lx,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[bn.jsx(cx,{title:"Find & Replace",icon:bn.jsx(Nt,{size:18}),onClose:t,theme:"modern"}),bn.jsxs("div",{className:"p-4 space-y-4",children:[bn.jsx("div",{className:"flex gap-2",children:["note","instrument","effect"].map(e=>bn.jsx("button",{onClick:()=>i(e),className:"flex-1 px-3 py-2 text-xs rounded transition-colors "+(o===e?"bg-accent-primary text-white":"bg-dark-bg text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Scope"}),bn.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[bn.jsxs("option",{value:"selection",disabled:!r,children:["Selection ",!r&&"(none)"]}),bn.jsx("option",{value:"pattern",children:"Current Pattern"}),bn.jsx("option",{value:"all",children:"All Patterns"})]})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Find"}),bn.jsxs("div",{className:"relative",children:[bn.jsx(Nt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),bn.jsx("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"note"===o?"e.g., C-4":"instrument"===o?"e.g., 01":"e.g., A0F",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Replace with (empty to clear)"}),bn.jsxs("div",{className:"relative",children:[bn.jsx(Ct,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),bn.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"Leave empty to clear",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),null!==m&&bn.jsxs("p",{className:"text-xs text-accent-primary",children:["Found ",m," match",1!==m?"es":""]}),null!==y&&bn.jsxs("p",{className:"text-xs text-accent-success",children:["Replaced ",y," occurrence",1!==y?"s":""]})]}),bn.jsxs(dx,{theme:"modern",align:"right",children:[bn.jsx(jv,{variant:"ghost",onClick:t,children:"Close"}),bn.jsx(jv,{variant:"default",onClick:()=>{let e=0;const t="all"===l?n:[v];for(const n of t)for(const t of n.channels)for(let a=0;a<n.length;a++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),s=Math.max(r.startChannel,r.endChannel),o=Math.min(r.startRow,r.endRow),i=Math.max(r.startRow,r.endRow),l=n.channels.indexOf(t);if(l<e||l>s||a<o||a>i)continue}const s=t.rows[a];if("note"===o&&s.note&&0!==s.note&&97!==s.note){Va(s.note).toLowerCase().includes(d.toLowerCase())&&e++}else if("instrument"===o&&0!==s.instrument){s.instrument.toString(16).toUpperCase().padStart(2,"0").includes(d.toUpperCase())&&e++}else if("effect"===o&&(0!==s.effTyp||0!==s.eff)){Ka(s.effTyp,s.eff).toLowerCase().includes(d.toLowerCase())&&e++}}f(e),g(null)},disabled:!d,children:"Find"}),bn.jsx(jv,{variant:"primary",onClick:()=>{if(!d)return;let e=0;cm.setState(t=>{const n="all"===l?t.patterns:[t.patterns[a]];for(const a of n)for(let t=0;t<a.channels.length;t++){const n=a.channels[t];for(let s=0;s<a.length;s++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),n=Math.max(r.startChannel,r.endChannel),a=Math.min(r.startRow,r.endRow),o=Math.max(r.startRow,r.endRow);if(t<e||t>n||s<a||s>o)continue}const a=n.rows[s];if("note"===o&&a.note&&0!==a.note&&97!==a.note){Va(a.note).toLowerCase().includes(d.toLowerCase())&&(a.note=""===p?0:Ba(p.toUpperCase()),e++)}else if("instrument"===o&&0!==a.instrument){a.instrument.toString(16).toUpperCase().padStart(2,"0").includes(d.toUpperCase())&&(a.instrument=""===p?0:parseInt(p,16)||0,e++)}else if("effect"===o&&(0!==a.effTyp||0!==a.eff)){if(Ka(a.effTyp,a.eff).toLowerCase().includes(d.toLowerCase())){if(""===p)a.effTyp=0,a.eff=0;else{const[e,t]=Ga(p.toUpperCase());a.effTyp=e,a.eff=t}e++}}}}}),g(e),f(null)},disabled:!d,children:"Replace All"})]})]})};class yx{context=null;gain=null;processNode=null;config;handlers=new Map;initialized=!1;initError=null;initPromise=null;meta=null;duration=0;currentTime=0;order=0;pattern=0;row=0;constructor(e={}){this.config={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,...e}}async ensureInitialized(){return!!this.initialized||!this.initError&&(this.initPromise?(await this.initPromise,this.initialized):(this.initPromise=this.initWorklet(),await this.initPromise,this.initialized))}async initWorklet(){try{this.context=new AudioContext,this.gain=this.context.createGain(),this.gain.gain.value=1;const e="/DEViLBOX/";await this.context.audioWorklet.addModule(`${e}chiptune3/chiptune3.worklet.js`),this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.processNode.connect(this.gain),this.gain.connect(this.context.destination),this.initialized=!0,this.fireEvent("onInitialized")}catch(e){const t=e instanceof Error?e.message:String(e);this.initError=t,this.fireEvent("onError",{type:"init",message:t})}}handleMessage(e){const{cmd:t,meta:n,pos:a,order:s,pattern:r,row:o,val:i}=e.data;switch(t){case"meta":this.meta=n,this.duration=n?.dur||0,this.fireEvent("onMetadata",n);break;case"pos":this.currentTime=a,this.order=s,this.pattern=r,this.row=o,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:i})}}fireEvent(e,t){const n=this.handlers.get(e);n&&n.forEach(e=>e(t))}addHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}onInitialized(e){this.initialized?e():this.initError?this.fireEvent("onError",{type:"init",message:this.initError}):(this.addHandler("onInitialized",e),this.ensureInitialized())}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}async play(e){await this.ensureInitialized()&&this.processNode&&this.context?("suspended"===this.context.state&&await this.context.resume(),this.processNode.port.postMessage({cmd:"play",val:e})):this.fireEvent("onError",{type:"not_initialized"})}stop(){this.processNode?.port.postMessage({cmd:"stop"})}pause(){this.processNode?.port.postMessage({cmd:"pause"})}unpause(){this.processNode?.port.postMessage({cmd:"unpause"})}setVol(e){this.gain&&(this.gain.gain.value=e)}setPos(e){this.processNode?.port.postMessage({cmd:"setPos",val:e})}setRepeatCount(e){this.processNode?.port.postMessage({cmd:"repeatCount",val:e})}isAvailable(){return this.initialized&&!this.initError}getInitError(){return this.initError}}async function gx(e){const t=new DataView(e);let n=0;const a=function(e,t){const n=Sx(e,t,17);if("Extended Module: "!==n)throw new Error("Invalid XM file: incorrect header signature");const a=Sx(e,t+17,20).trim();t+=38;const s=Sx(e,t,20).trim();t+=20;const r=e.getUint16(t,!0);t+=2;const o=e.getUint32(t,!0);t+=4;const i=e.getUint16(t,!0);t+=2;const l=e.getUint16(t,!0);t+=2;const c=e.getUint16(t,!0);t+=2;const d=e.getUint16(t,!0);t+=2;const u=e.getUint16(t,!0);t+=2;const p=e.getUint16(t,!0);t+=2;const h=e.getUint16(t,!0);t+=2;const m=e.getUint16(t,!0);t+=2;const f=[];for(let y=0;y<256;y++)f.push(e.getUint8(t+y));return{idText:n,moduleName:a,trackerName:s,versionNumber:r,headerSize:o,songLength:i,restartPosition:l,channelCount:c,patternCount:d,instrumentCount:u,flags:p,defaultTempo:h,defaultBPM:m,patternOrderTable:f}}(t,n);n+=a.headerSize;const s=[];for(let i=0;i<a.patternCount;i++){const e=vx(t,n,a.channelCount);s.push(e.notes),n+=e.totalSize}const r=[];for(let i=0;i<a.instrumentCount;i++){const e=bx(t,n);e.parsed.id=i+1,e.parsed.samples.forEach((e,t)=>{e.id=i+1}),r.push(e.parsed),n+=e.totalSize}const o={sourceFormat:"XM",sourceFile:a.moduleName,importedAt:(new Date).toISOString(),originalChannelCount:a.channelCount,originalPatternCount:a.patternCount,originalInstrumentCount:a.instrumentCount,modData:{moduleType:"XM",initialSpeed:a.defaultTempo,initialBPM:a.defaultBPM,amigaPeriods:!(1&a.flags),channelNames:Array.from({length:a.channelCount},(e,t)=>`Channel ${t+1}`),songLength:a.songLength,restartPosition:a.restartPosition,patternOrderTable:a.patternOrderTable},xmData:{frequencyType:1&a.flags?"linear":"amiga",defaultPanning:Array.from({length:a.channelCount},()=>128)},originalSamples:{},envelopes:{}};return r.forEach(e=>{e.samples.forEach(e=>{o.originalSamples[e.id]=e}),o.envelopes[e.id]={volumeEnvelope:e.volumeEnvelope,panningEnvelope:e.panningEnvelope,autoVibrato:e.autoVibrato,fadeout:e.fadeout}}),{header:a,patterns:s,instruments:r,metadata:o}}function vx(e,t,n){const a=t;e.getUint32(t,!0),t+=4,e.getUint8(t),t+=1;const s=e.getUint16(t,!0)||64;t+=2;const r=e.getUint16(t,!0);t+=2;const o=[],i=new Uint8Array(e.buffer,t,r);t+=r;let l=0;for(let c=0;c<s;c++){const e=[];for(let t=0;t<n;t++){const t={note:0,instrument:0,volume:0,effectType:0,effectParam:0};if(l>=i.length){e.push(t);continue}const n=i[l++];128&n?(1&n&&(t.note=i[l++]),2&n&&(t.instrument=i[l++]),4&n&&(t.volume=i[l++]),8&n&&(t.effectType=i[l++]),16&n&&(t.effectParam=i[l++])):(t.note=n,t.instrument=i[l++],t.volume=i[l++],t.effectType=i[l++],t.effectParam=i[l++]),e.push(t)}o.push(e)}return{notes:o,totalSize:t-a}}function bx(e,t){const n=t,a=e.getUint32(t,!0),s=Sx(e,t+=4,22).trim();t+=22,e.getUint8(t),t+=1;const r=e.getUint16(t,!0);t+=2;let o,i,l,c=0,d=[],u=0;if(r>0){c=e.getUint32(t,!0),t+=4,d=[];for(let o=0;o<96;o++)d.push(e.getUint8(t+o));o=xx(e,t+=96),i=xx(e,t+=48),t+=48;const n=e.getUint8(t);t+=1;const a=e.getUint8(t);t+=1,o.enabled=!!(1&n),i.enabled=!!(1&a);const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const p=e.getUint8(t);t+=1;const h=e.getUint8(t);t+=1,l={type:["sine","square","rampDown","rampUp"][s],sweep:r,depth:p,rate:h},u=e.getUint16(t,!0),t+=2,t+=22}t=n+a;const p=[];for(let m=0;m<r;m++)p.push(wx(e,t)),t+=c;const h=[];for(let m=0;m<r;m++){const n=p[m],a=kx(e,t,n);t+=n.length,h.push({id:m,name:n.name,pcmData:a,loopStart:n.loopStart/(16&n.type?2:1),loopLength:n.loopLength/(16&n.type?2:1),loopType:3&n.type?1==(3&n.type)?"forward":"pingpong":"none",volume:n.volume,finetune:n.finetune,relativeNote:n.relativeNote,panning:n.panning,bitDepth:16&n.type?16:8,sampleRate:44100,length:n.length/(16&n.type?2:1)})}return{parsed:{id:0,name:s,samples:h,volumeEnvelope:o,panningEnvelope:i,autoVibrato:l,fadeout:u,volumeType:"envelope",panningType:"envelope"},totalSize:t-n}}function xx(e,t){const n=[];for(let i=0;i<12;i++){const a=e.getUint16(t+4*i,!0),s=e.getUint16(t+4*i+2,!0);n.push({tick:a,value:s})}const a=e.getUint8(t+48),s=e.getUint8(t+49),r=e.getUint8(t+50),o=e.getUint8(t+51);return{enabled:!1,points:n.slice(0,a),sustainPoint:a>0?s:null,loopStartPoint:a>0?r:null,loopEndPoint:a>0?o:null}}function wx(e,t){return{length:e.getUint32(t,!0),loopStart:e.getUint32(t+4,!0),loopLength:e.getUint32(t+8,!0),volume:e.getUint8(t+12),finetune:e.getInt8(t+13),type:e.getUint8(t+14),panning:e.getUint8(t+15),relativeNote:e.getInt8(t+16),reserved:e.getUint8(t+17),name:Sx(e,t+18,22).trim()}}function kx(e,t,n){const a=!!(16&n.type),s=n.length;if(a){const n=new Int16Array(s/2);let a=0;for(let s=0;s<n.length;s++){a+=e.getInt16(t+2*s,!0),n[s]=a}return n.buffer}{const n=new Int8Array(s);let a=0;for(let s=0;s<n.length;s++){a+=e.getInt8(t+s),n[s]=a}return n.buffer}}function Sx(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e.getUint8(t+s);if(0===n)break;a.push(n)}return String.fromCharCode(...a)}const Mx={"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,"4CHN":4,"6CHN":6,"8CHN":8,OCTA:8,CD81:8,"2CHN":2,TDZ1:1,TDZ2:2,TDZ3:3};async function Nx(e){const t=new DataView(e);let n=0;const a=function(e){let t=0;const n=Px(e,t,20).trim();t+=20;const a=[];for(let c=0;c<31;c++){const n=Px(e,t,22).trim(),s=e.getUint16(t+22,!1),r=15&e.getUint8(t+24),o=Math.min(e.getUint8(t+25),64),i=e.getUint16(t+26,!1),l=e.getUint16(t+28,!1);a.push({name:n,length:s,finetune:r>7?r-16:r,volume:o,loopStart:i,loopLength:l}),t+=30}const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const o=[];let i=0;for(let c=0;c<128;c++){const n=e.getUint8(t+c);o.push(n),c<s&&n>i&&(i=n)}t+=128;const l=Px(e,t,4);return{title:n,samples:a,songLength:s,restartPosition:r,patternOrderTable:o,formatTag:l,channelCount:Mx[l]||4,patternCount:i+1}}(t);n=1084;const s=[];for(let i=0;i<a.patternCount;i++){const e=Cx(t,n,a.channelCount);s.push(e),n+=64*a.channelCount*4}const r=[];for(let i=0;i<31;i++){const e=a.samples[i];if(0===e.length)continue;const s=Ex(t,n,e);n+=2*e.length;const o=2*e.loopStart,l=2*e.loopLength,c=i+1,d={id:c,name:e.name,pcmData:s,loopStart:o,loopLength:l,loopType:e.loopLength>1?"forward":"none",volume:e.volume,finetune:e.finetune,relativeNote:0,panning:128,bitDepth:8,sampleRate:8363,length:2*e.length};r.push({id:c,name:e.name,samples:[d],fadeout:0,volumeType:"none",panningType:"none"})}const o={sourceFormat:"MOD",sourceFile:a.title,importedAt:(new Date).toISOString(),originalChannelCount:a.channelCount,originalPatternCount:a.patternCount,originalInstrumentCount:r.length,modData:{moduleType:a.formatTag,initialSpeed:6,initialBPM:125,amigaPeriods:!0,channelNames:Array.from({length:a.channelCount},(e,t)=>`Channel ${t+1}`),songLength:a.songLength,restartPosition:a.restartPosition,patternOrderTable:a.patternOrderTable},originalSamples:{},envelopes:{}};return r.forEach(e=>{e.samples.forEach(e=>{o.originalSamples[e.id]=e})}),{header:a,patterns:s,instruments:r,metadata:o}}function Cx(e,t,n){const a=[];for(let s=0;s<64;s++){const s=[];for(let a=0;a<n;a++){const n=e.getUint8(t++),a=e.getUint8(t++),r=e.getUint8(t++),o=(15&n)<<8|a,i=240&n|(240&r)>>4,l=15&r,c=e.getUint8(t++);s.push({period:o,instrument:i,effect:l,effectParam:c})}a.push(s)}return a}function Ex(e,t,n){const a=2*n.length,s=new Int8Array(a);for(let r=0;r<a;r++)s[r]=e.getInt8(t+r);return s.buffer}function Px(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e.getUint8(t+s);if(0===n)break;a.push(n)}return String.fromCharCode(...a)}function Tx(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ax=256,Ix=286,_x=30,Ox=15,Fx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Dx=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rx=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lx=new Array(576);Tx(Lx);const Bx=new Array(60);Tx(Bx);const Vx=new Array(512);Tx(Vx);const zx=new Array(256);Tx(zx);const Ux=new Array(29);Tx(Ux);const Gx=new Array(_x);function Kx(e,t,n,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}let Hx,Wx,$x;function qx(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Tx(Gx);const Yx=e=>e<256?Vx[e]:Vx[256+(e>>>7)],Xx=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Qx=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Xx(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Zx=(e,t,n)=>{Qx(e,n[2*t],n[2*t+1])},Jx=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},ew=(e,t,n)=>{const a=new Array(16);let s,r,o=0;for(s=1;s<=Ox;s++)o=o+n[s-1]<<1,a[s]=o;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=Jx(a[t]++,t))}},tw=e=>{let t;for(t=0;t<Ix;t++)e.dyn_ltree[2*t]=0;for(t=0;t<_x;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},nw=e=>{e.bi_valid>8?Xx(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},aw=(e,t,n,a)=>{const s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&a[t]<=a[n]},sw=(e,t,n)=>{const a=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&aw(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!aw(t,a,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=a},rw=(e,t,n)=>{let a,s,r,o,i=0;if(0!==e.sym_next)do{a=255&e.pending_buf[e.sym_buf+i++],a+=(255&e.pending_buf[e.sym_buf+i++])<<8,s=e.pending_buf[e.sym_buf+i++],0===a?Zx(e,s,t):(r=zx[s],Zx(e,r+Ax+1,t),o=Fx[r],0!==o&&(s-=Ux[r],Qx(e,s,o)),a--,r=Yx(a),Zx(e,r,n),o=Dx[r],0!==o&&(a-=Gx[r],Qx(e,a,o)))}while(i<e.sym_next);Zx(e,256,t)},ow=(e,t)=>{const n=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,i,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<r;o++)0!==n[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=a[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)sw(e,n,o);l=r;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],sw(e,n,1),i=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=i,n[2*l]=n[2*o]+n[2*i],e.depth[l]=(e.depth[o]>=e.depth[i]?e.depth[o]:e.depth[i])+1,n[2*o+1]=n[2*i+1]=l,e.heap[1]=l++,sw(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,a=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,i=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,u,p,h,m,f=0;for(p=0;p<=Ox;p++)e.bl_count[p]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],p=n[2*n[2*d+1]+1]+1,p>l&&(p=l,f++),n[2*d+1]=p,d>a||(e.bl_count[p]++,h=0,d>=i&&(h=o[d-i]),m=n[2*d],e.opt_len+=m*(p+h),r&&(e.static_len+=m*(s[2*d+1]+h)));if(0!==f){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(p=l;0!==p;p--)for(d=e.bl_count[p];0!==d;)u=e.heap[--c],u>a||(n[2*u+1]!==p&&(e.opt_len+=(p-n[2*u+1])*n[2*u],n[2*u+1]=p),d--)}})(e,t),ew(n,c,e.bl_count)},iw=(e,t,n)=>{let a,s,r=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)s=o,o=t[2*(a+1)+1],++i<l&&s===o||(i<c?e.bl_tree[2*s]+=i:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):i<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4))},lw=(e,t,n)=>{let a,s,r=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),a=0;a<=n;a++)if(s=o,o=t[2*(a+1)+1],!(++i<l&&s===o)){if(i<c)do{Zx(e,s,e.bl_tree)}while(0!==--i);else 0!==s?(s!==r&&(Zx(e,s,e.bl_tree),i--),Zx(e,16,e.bl_tree),Qx(e,i-3,2)):i<=10?(Zx(e,17,e.bl_tree),Qx(e,i-3,3)):(Zx(e,18,e.bl_tree),Qx(e,i-11,7));i=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4)}};let cw=!1;const dw=(e,t,n,a)=>{Qx(e,0+(a?1:0),3),nw(e),Xx(e,n),Xx(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var uw={_tr_init:e=>{cw||((()=>{let e,t,n,a,s;const r=new Array(16);for(n=0,a=0;a<28;a++)for(Ux[a]=n,e=0;e<1<<Fx[a];e++)zx[n++]=a;for(zx[n-1]=a,s=0,a=0;a<16;a++)for(Gx[a]=s,e=0;e<1<<Dx[a];e++)Vx[s++]=a;for(s>>=7;a<_x;a++)for(Gx[a]=s<<7,e=0;e<1<<Dx[a]-7;e++)Vx[256+s++]=a;for(t=0;t<=Ox;t++)r[t]=0;for(e=0;e<=143;)Lx[2*e+1]=8,e++,r[8]++;for(;e<=255;)Lx[2*e+1]=9,e++,r[9]++;for(;e<=279;)Lx[2*e+1]=7,e++,r[7]++;for(;e<=287;)Lx[2*e+1]=8,e++,r[8]++;for(ew(Lx,287,r),e=0;e<_x;e++)Bx[2*e+1]=5,Bx[2*e]=Jx(e,5);Hx=new Kx(Lx,Fx,257,Ix,Ox),Wx=new Kx(Bx,Dx,0,_x,Ox),$x=new Kx(new Array(0),Rx,0,19,7)})(),cw=!0),e.l_desc=new qx(e.dyn_ltree,Hx),e.d_desc=new qx(e.dyn_dtree,Wx),e.bl_desc=new qx(e.bl_tree,$x),e.bi_buf=0,e.bi_valid=0,tw(e)},_tr_stored_block:dw,_tr_flush_block:(e,t,n,a)=>{let s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ax;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ow(e,e.l_desc),ow(e,e.d_desc),o=(e=>{let t;for(iw(e,e.dyn_ltree,e.l_desc.max_code),iw(e,e.dyn_dtree,e.d_desc.max_code),ow(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*jx[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?dw(e,t,n,a):4===e.strategy||r===s?(Qx(e,2+(a?1:0),3),rw(e,Lx,Bx)):(Qx(e,4+(a?1:0),3),((e,t,n,a)=>{let s;for(Qx(e,t-257,5),Qx(e,n-1,5),Qx(e,a-4,4),s=0;s<a;s++)Qx(e,e.bl_tree[2*jx[s]+1],3);lw(e,e.dyn_ltree,t-1),lw(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),rw(e,e.dyn_ltree,e.dyn_dtree)),tw(e),a&&nw(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(zx[n]+Ax+1)]++,e.dyn_dtree[2*Yx(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Qx(e,2,3),Zx(e,256,Lx),(e=>{16===e.bi_valid?(Xx(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var pw=(e,t,n,a)=>{let s=65535&e,r=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{s=s+t[a++]|0,r=r+s|0}while(--o);s%=65521,r%=65521}return s|r<<16};const hw=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var mw=(e,t,n,a)=>{const s=hw,r=a+n;e^=-1;for(let o=a;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e},fw={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},yw={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:gw,_tr_stored_block:vw,_tr_flush_block:bw,_tr_tally:xw,_tr_align:ww}=uw,{Z_NO_FLUSH:kw,Z_PARTIAL_FLUSH:Sw,Z_FULL_FLUSH:Mw,Z_FINISH:Nw,Z_BLOCK:Cw,Z_OK:Ew,Z_STREAM_END:Pw,Z_STREAM_ERROR:Tw,Z_DATA_ERROR:Aw,Z_BUF_ERROR:Iw,Z_DEFAULT_COMPRESSION:_w,Z_FILTERED:Ow,Z_HUFFMAN_ONLY:Fw,Z_RLE:Dw,Z_FIXED:Rw,Z_DEFAULT_STRATEGY:jw,Z_UNKNOWN:Lw,Z_DEFLATED:Bw}=yw,Vw=258,zw=262,Uw=42,Gw=113,Kw=666,Hw=(e,t)=>(e.msg=fw[t],t),Ww=e=>2*e-(e>4?9:0),$w=e=>{let t=e.length;for(;--t>=0;)e[t]=0},qw=e=>{let t,n,a,s=e.w_size;t=e.hash_size,a=t;do{n=e.head[--a],e.head[a]=n>=s?n-s:0}while(--t);t=s,a=t;do{n=e.prev[--a],e.prev[a]=n>=s?n-s:0}while(--t)};let Yw=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Xw=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Qw=(e,t)=>{bw(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Xw(e.strm)},Zw=(e,t)=>{e.pending_buf[e.pending++]=t},Jw=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ek=(e,t,n,a)=>{let s=e.avail_in;return s>a&&(s=a),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=pw(e.adler,t,s,n):2===e.state.wrap&&(e.adler=mw(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},tk=(e,t)=>{let n,a,s=e.max_chain_length,r=e.strstart,o=e.prev_length,i=e.nice_match;const l=e.strstart>e.w_size-zw?e.strstart-(e.w_size-zw):0,c=e.window,d=e.w_mask,u=e.prev,p=e.strstart+Vw;let h=c[r+o-1],m=c[r+o];e.prev_length>=e.good_match&&(s>>=2),i>e.lookahead&&(i=e.lookahead);do{if(n=t,c[n+o]===m&&c[n+o-1]===h&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<p);if(a=Vw-(p-r),r=p-Vw,a>o){if(e.match_start=t,o=a,a>=i)break;h=c[r+o-1],m=c[r+o]}}}while((t=u[t&d])>l&&0!==--s);return o<=e.lookahead?o:e.lookahead},nk=e=>{const t=e.w_size;let n,a,s;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-zw)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),qw(e),a+=t),0===e.strm.avail_in)break;if(n=ek(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Yw(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Yw(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<zw&&0!==e.strm.avail_in)},ak=(e,t)=>{let n,a,s,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,i=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(0===n&&t!==Nw||t===kw||n!==a+e.strm.avail_in))break;o=t===Nw&&n===a+e.strm.avail_in?1:0,vw(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Xw(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(ek(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return i-=e.strm.avail_in,i&&(i>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=i&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-i,e.strm.next_in),e.strstart),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==kw&&t!==Nw&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(ek(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Nw)&&t!==kw&&0===e.strm.avail_in&&a<=s)&&(n=a>s?s:a,o=t===Nw&&0===e.strm.avail_in&&n===a?1:0,vw(e,e.block_start,n,o),e.block_start+=n,Xw(e.strm)),o?3:1)},sk=(e,t)=>{let n,a;for(;;){if(e.lookahead<zw){if(nk(e),e.lookahead<zw&&t===kw)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Yw(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-zw&&(e.match_length=tk(e,n)),e.match_length>=3)if(a=xw(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Yw(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Yw(e,e.ins_h,e.window[e.strstart+1]);else a=xw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Qw(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Nw?(Qw(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Qw(e,!1),0===e.strm.avail_out)?1:2},rk=(e,t)=>{let n,a,s;for(;;){if(e.lookahead<zw){if(nk(e),e.lookahead<zw&&t===kw)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Yw(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-zw&&(e.match_length=tk(e,n),e.match_length<=5&&(e.strategy===Ow||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,a=xw(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=Yw(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Qw(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=xw(e,0,e.window[e.strstart-1]),a&&Qw(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=xw(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Nw?(Qw(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Qw(e,!1),0===e.strm.avail_out)?1:2};function ok(e,t,n,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=s}const ik=[new ok(0,0,0,0,ak),new ok(4,4,8,4,sk),new ok(4,5,16,8,sk),new ok(4,6,32,32,sk),new ok(4,4,16,16,rk),new ok(8,16,32,32,rk),new ok(8,16,128,128,rk),new ok(8,32,128,256,rk),new ok(32,128,258,1024,rk),new ok(32,258,258,4096,rk)];function lk(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bw,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),$w(this.dyn_ltree),$w(this.dyn_dtree),$w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),$w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),$w(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ck=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Uw&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Gw&&t.status!==Kw?1:0},dk=e=>{if(ck(e))return Hw(e,Tw);e.total_in=e.total_out=0,e.data_type=Lw;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Uw:Gw,e.adler=2===t.wrap?0:1,t.last_flush=-2,gw(t),Ew},uk=e=>{const t=dk(e);var n;return t===Ew&&((n=e.state).window_size=2*n.w_size,$w(n.head),n.max_lazy_match=ik[n.level].max_lazy,n.good_match=ik[n.level].good_length,n.nice_match=ik[n.level].nice_length,n.max_chain_length=ik[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},pk=(e,t,n,a,s,r)=>{if(!e)return Tw;let o=1;if(t===_w&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),s<1||s>9||n!==Bw||a<8||a>15||t<0||t>9||r<0||r>Rw||8===a&&1!==o)return Hw(e,Tw);8===a&&(a=9);const i=new lk;return e.state=i,i.strm=e,i.status=Uw,i.wrap=o,i.gzhead=null,i.w_bits=a,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=s+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<s+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=t,i.strategy=r,i.method=n,uk(e)};var hk={deflateInit:(e,t)=>pk(e,t,Bw,15,8,jw),deflateInit2:pk,deflateReset:uk,deflateResetKeep:dk,deflateSetHeader:(e,t)=>ck(e)||2!==e.state.wrap?Tw:(e.state.gzhead=t,Ew),deflate:(e,t)=>{if(ck(e)||t>Cw||t<0)return e?Hw(e,Tw):Tw;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Kw&&t!==Nw)return Hw(e,0===e.avail_out?Iw:Tw);const a=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Xw(e),0===e.avail_out)return n.last_flush=-1,Ew}else if(0===e.avail_in&&Ww(t)<=Ww(a)&&t!==Nw)return Hw(e,Iw);if(n.status===Kw&&0!==e.avail_in)return Hw(e,Iw);if(n.status===Uw&&0===n.wrap&&(n.status=Gw),n.status===Uw){let t=Bw+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Fw||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=a<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Jw(n,t),0!==n.strstart&&(Jw(n,e.adler>>>16),Jw(n,65535&e.adler)),e.adler=1,n.status=Gw,Xw(e),0!==n.pending)return n.last_flush=-1,Ew}if(57===n.status)if(e.adler=0,Zw(n,31),Zw(n,139),Zw(n,8),n.gzhead)Zw(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Zw(n,255&n.gzhead.time),Zw(n,n.gzhead.time>>8&255),Zw(n,n.gzhead.time>>16&255),Zw(n,n.gzhead.time>>24&255),Zw(n,9===n.level?2:n.strategy>=Fw||n.level<2?4:0),Zw(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Zw(n,255&n.gzhead.extra.length),Zw(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=mw(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Zw(n,0),Zw(n,0),Zw(n,0),Zw(n,0),Zw(n,0),Zw(n,9===n.level?2:n.strategy>=Fw||n.level<2?4:0),Zw(n,3),n.status=Gw,Xw(e),0!==n.pending)return n.last_flush=-1,Ew;if(69===n.status){if(n.gzhead.extra){let t=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=mw(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,Xw(e),0!==n.pending)return n.last_flush=-1,Ew;t=0,a-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>t&&(e.adler=mw(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=mw(e.adler,n.pending_buf,n.pending-a,a)),Xw(e),0!==n.pending)return n.last_flush=-1,Ew;a=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Zw(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=mw(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=mw(e.adler,n.pending_buf,n.pending-a,a)),Xw(e),0!==n.pending)return n.last_flush=-1,Ew;a=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Zw(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=mw(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Xw(e),0!==n.pending))return n.last_flush=-1,Ew;Zw(n,255&e.adler),Zw(n,e.adler>>8&255),e.adler=0}if(n.status=Gw,Xw(e),0!==n.pending)return n.last_flush=-1,Ew}if(0!==e.avail_in||0!==n.lookahead||t!==kw&&n.status!==Kw){let a=0===n.level?ak(n,t):n.strategy===Fw?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(nk(e),0===e.lookahead)){if(t===kw)return 1;break}if(e.match_length=0,n=xw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Qw(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Nw?(Qw(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Qw(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Dw?((e,t)=>{let n,a,s,r;const o=e.window;for(;;){if(e.lookahead<=Vw){if(nk(e),e.lookahead<=Vw&&t===kw)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,a=o[s],a===o[++s]&&a===o[++s]&&a===o[++s])){r=e.strstart+Vw;do{}while(a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&s<r);e.match_length=Vw-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=xw(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=xw(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Qw(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Nw?(Qw(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Qw(e,!1),0===e.strm.avail_out)?1:2})(n,t):ik[n.level].func(n,t);if(3!==a&&4!==a||(n.status=Kw),1===a||3===a)return 0===e.avail_out&&(n.last_flush=-1),Ew;if(2===a&&(t===Sw?ww(n):t!==Cw&&(vw(n,0,0,!1),t===Mw&&($w(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Xw(e),0===e.avail_out))return n.last_flush=-1,Ew}return t!==Nw?Ew:n.wrap<=0?Pw:(2===n.wrap?(Zw(n,255&e.adler),Zw(n,e.adler>>8&255),Zw(n,e.adler>>16&255),Zw(n,e.adler>>24&255),Zw(n,255&e.total_in),Zw(n,e.total_in>>8&255),Zw(n,e.total_in>>16&255),Zw(n,e.total_in>>24&255)):(Jw(n,e.adler>>>16),Jw(n,65535&e.adler)),Xw(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Ew:Pw)},deflateEnd:e=>{if(ck(e))return Tw;const t=e.state.status;return e.state=null,t===Gw?Hw(e,Aw):Ew},deflateSetDictionary:(e,t)=>{let n=t.length;if(ck(e))return Tw;const a=e.state,s=a.wrap;if(2===s||1===s&&a.status!==Uw||a.lookahead)return Tw;if(1===s&&(e.adler=pw(e.adler,t,n,0)),a.wrap=0,n>=a.w_size){0===s&&($w(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(n-a.w_size,n),0),t=e,n=a.w_size}const r=e.avail_in,o=e.next_in,i=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,nk(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=Yw(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,nk(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=o,e.input=i,e.avail_in=r,a.wrap=s,Ew},deflateInfo:"pako deflate (from Nodeca project)"};const mk=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var fk=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)mk(n,t)&&(e[t]=n[t])}}return e},yk=e=>{let t=0;for(let a=0,s=e.length;a<s;a++)t+=e[a].length;const n=new Uint8Array(t);for(let a=0,s=0,r=e.length;a<r;a++){let t=e[a];n.set(t,s),s+=t.length}return n};let gk=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(iT){gk=!1}const vk=new Uint8Array(256);for(let lT=0;lT<256;lT++)vk[lT]=lT>=252?6:lT>=248?5:lT>=240?4:lT>=224?3:lT>=192?2:1;vk[254]=vk[254]=1;var bk=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,a,s,r,o=e.length,i=0;for(s=0;s<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),i+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(i),r=0,s=0;r<i;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},xk=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,s;const r=new Array(2*n);for(s=0,a=0;a<n;){let t=e[a++];if(t<128){r[s++]=t;continue}let o=vk[t];if(o>4)r[s++]=65533,a+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&a<n;)t=t<<6|63&e[a++],o--;o>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&gk)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n})(r,s)},wk=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+vk[e[n]]>t?n:t};var kk=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Sk=Object.prototype.toString,{Z_NO_FLUSH:Mk,Z_SYNC_FLUSH:Nk,Z_FULL_FLUSH:Ck,Z_FINISH:Ek,Z_OK:Pk,Z_STREAM_END:Tk,Z_DEFAULT_COMPRESSION:Ak,Z_DEFAULT_STRATEGY:Ik,Z_DEFLATED:_k}=yw;function Ok(e){this.options=fk({level:Ak,method:_k,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ik},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kk,this.strm.avail_out=0;let n=hk.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Pk)throw new Error(fw[n]);if(t.header&&hk.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?bk(t.dictionary):"[object ArrayBuffer]"===Sk.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=hk.deflateSetDictionary(this.strm,e),n!==Pk)throw new Error(fw[n]);this._dict_set=!0}}function Fk(e,t){const n=new Ok(t);if(n.push(e,!0),n.err)throw n.msg||fw[n.err];return n.result}Ok.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Ek:Mk,"string"==typeof e?n.input=bk(e):"[object ArrayBuffer]"===Sk.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),(r===Nk||r===Ck)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=hk.deflate(n,r),s===Tk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=hk.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Pk;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Ok.prototype.onData=function(e){this.chunks.push(e)},Ok.prototype.onEnd=function(e){e===Pk&&(this.result=yk(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Dk={Deflate:Ok,deflate:Fk,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Fk(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Fk(e,t)}};const Rk=16209;var jk=function(e,t){let n,a,s,r,o,i,l,c,d,u,p,h,m,f,y,g,v,b,x,w,k,S,M,N;const C=e.state;n=e.next_in,M=e.input,a=n+(e.avail_in-5),s=e.next_out,N=e.output,r=s-(t-e.avail_out),o=s+(e.avail_out-257),i=C.dmax,l=C.wsize,c=C.whave,d=C.wnext,u=C.window,p=C.hold,h=C.bits,m=C.lencode,f=C.distcode,y=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;e:do{h<15&&(p+=M[n++]<<h,h+=8,p+=M[n++]<<h,h+=8),v=m[p&y];t:for(;;){if(b=v>>>24,p>>>=b,h-=b,b=v>>>16&255,0===b)N[s++]=65535&v;else{if(!(16&b)){if(64&b){if(32&b){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=Rk;break e}v=m[(65535&v)+(p&(1<<b)-1)];continue t}for(x=65535&v,b&=15,b&&(h<b&&(p+=M[n++]<<h,h+=8),x+=p&(1<<b)-1,p>>>=b,h-=b),h<15&&(p+=M[n++]<<h,h+=8,p+=M[n++]<<h,h+=8),v=f[p&g];;){if(b=v>>>24,p>>>=b,h-=b,b=v>>>16&255,16&b){if(w=65535&v,b&=15,h<b&&(p+=M[n++]<<h,h+=8,h<b&&(p+=M[n++]<<h,h+=8)),w+=p&(1<<b)-1,w>i){e.msg="invalid distance too far back",C.mode=Rk;break e}if(p>>>=b,h-=b,b=s-r,w>b){if(b=w-b,b>c&&C.sane){e.msg="invalid distance too far back",C.mode=Rk;break e}if(k=0,S=u,0===d){if(k+=l-b,b<x){x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}}else if(d<b){if(k+=l+d-b,b-=d,b<x){x-=b;do{N[s++]=u[k++]}while(--b);if(k=0,d<x){b=d,x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}}}else if(k+=d-b,b<x){x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}for(;x>2;)N[s++]=S[k++],N[s++]=S[k++],N[s++]=S[k++],x-=3;x&&(N[s++]=S[k++],x>1&&(N[s++]=S[k++]))}else{k=s-w;do{N[s++]=N[k++],N[s++]=N[k++],N[s++]=N[k++],x-=3}while(x>2);x&&(N[s++]=N[k++],x>1&&(N[s++]=N[k++]))}break}if(64&b){e.msg="invalid distance code",C.mode=Rk;break e}v=f[(65535&v)+(p&(1<<b)-1)]}}break}}while(n<a&&s<o);x=h>>3,n-=x,h-=x<<3,p&=(1<<h)-1,e.next_in=n,e.next_out=s,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=s<o?o-s+257:257-(s-o),C.hold=p,C.bits=h};const Lk=15,Bk=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Vk=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),zk=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Uk=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Gk=(e,t,n,a,s,r,o,i)=>{const l=i.bits;let c,d,u,p,h,m,f=0,y=0,g=0,v=0,b=0,x=0,w=0,k=0,S=0,M=0,N=null;const C=new Uint16Array(16),E=new Uint16Array(16);let P,T,A,I=null;for(f=0;f<=Lk;f++)C[f]=0;for(y=0;y<a;y++)C[t[n+y]]++;for(b=l,v=Lk;v>=1&&0===C[v];v--);if(b>v&&(b=v),0===v)return s[r++]=20971520,s[r++]=20971520,i.bits=1,0;for(g=1;g<v&&0===C[g];g++);for(b<g&&(b=g),k=1,f=1;f<=Lk;f++)if(k<<=1,k-=C[f],k<0)return-1;if(k>0&&(0===e||1!==v))return-1;for(E[1]=0,f=1;f<Lk;f++)E[f+1]=E[f]+C[f];for(y=0;y<a;y++)0!==t[n+y]&&(o[E[t[n+y]]++]=y);if(0===e?(N=I=o,m=20):1===e?(N=Bk,I=Vk,m=257):(N=zk,I=Uk,m=0),M=0,y=0,f=g,h=r,x=b,w=0,u=-1,S=1<<b,p=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){P=f-w,o[y]+1<m?(T=0,A=o[y]):o[y]>=m?(T=I[o[y]-m],A=N[o[y]-m]):(T=96,A=0),c=1<<f-w,d=1<<x,g=d;do{d-=c,s[h+(M>>w)+d]=P<<24|T<<16|A}while(0!==d);for(c=1<<f-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,y++,0===--C[f]){if(f===v)break;f=t[n+o[y]]}if(f>b&&(M&p)!==u){for(0===w&&(w=b),h+=g,x=f-w,k=1<<x;x+w<v&&(k-=C[x+w],!(k<=0));)x++,k<<=1;if(S+=1<<x,1===e&&S>852||2===e&&S>592)return 1;u=M&p,s[u]=b<<24|x<<16|h-r}}return 0!==M&&(s[h+M]=f-w<<24|64<<16),i.bits=b,0};const{Z_FINISH:Kk,Z_BLOCK:Hk,Z_TREES:Wk,Z_OK:$k,Z_STREAM_END:qk,Z_NEED_DICT:Yk,Z_STREAM_ERROR:Xk,Z_DATA_ERROR:Qk,Z_MEM_ERROR:Zk,Z_BUF_ERROR:Jk,Z_DEFLATED:eS}=yw,tS=16180,nS=16190,aS=16191,sS=16192,rS=16194,oS=16199,iS=16200,lS=16206,cS=16209,dS=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function uS(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tS||t.mode>16211?1:0},hS=e=>{if(pS(e))return Xk;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tS,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,$k},mS=e=>{if(pS(e))return Xk;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hS(e)},fS=(e,t)=>{let n;if(pS(e))return Xk;const a=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Xk:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,mS(e))},yS=(e,t)=>{if(!e)return Xk;const n=new uS;e.state=n,n.strm=e,n.window=null,n.mode=tS;const a=fS(e,t);return a!==$k&&(e.state=null),a};let gS,vS,bS=!0;const xS=e=>{if(bS){gS=new Int32Array(512),vS=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Gk(1,e.lens,0,288,gS,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Gk(2,e.lens,0,32,vS,0,e.work,{bits:5}),bS=!1}e.lencode=gS,e.lenbits=9,e.distcode=vS,e.distbits=5},wS=(e,t,n,a)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),a>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>a&&(s=a),r.window.set(t.subarray(n-a,n-a+s),r.wnext),(a-=s)?(r.window.set(t.subarray(n-a,n),0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var kS={inflateReset:mS,inflateReset2:fS,inflateResetKeep:hS,inflateInit:e=>yS(e,15),inflateInit2:yS,inflate:(e,t)=>{let n,a,s,r,o,i,l,c,d,u,p,h,m,f,y,g,v,b,x,w,k,S,M=0;const N=new Uint8Array(4);let C,E;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pS(e)||!e.output||!e.input&&0!==e.avail_in)return Xk;n=e.state,n.mode===aS&&(n.mode=sS),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,i=e.avail_in,c=n.hold,d=n.bits,u=i,p=l,S=$k;e:for(;;)switch(n.mode){case tS:if(0===n.wrap){n.mode=sS;break}for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,N[0]=255&c,N[1]=c>>>8&255,n.check=mw(n.check,N,2,0),c=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=cS;break}if((15&c)!==eS){e.msg="unknown compression method",n.mode=cS;break}if(c>>>=4,d-=4,k=8+(15&c),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=cS;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:aS,c=0,d=0;break;case 16181:for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==eS){e.msg="unknown compression method",n.mode=cS;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=cS;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=mw(n.check,N,2,0)),c=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,n.check=mw(n.check,N,4,0)),c=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=mw(n.check,N,2,0)),c=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=mw(n.check,N,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(h=n.length,h>i&&(h=i),h&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(a.subarray(r,r+h),k)),512&n.flags&&4&n.wrap&&(n.check=mw(n.check,a,h,r)),i-=h,r+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===i)break e;h=0;do{k=a[r+h++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&h<i);if(512&n.flags&&4&n.wrap&&(n.check=mw(n.check,a,h,r)),i-=h,r+=h,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===i)break e;h=0;do{k=a[r+h++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&h<i);if(512&n.flags&&4&n.wrap&&(n.check=mw(n.check,a,h,r)),i-=h,r+=h,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=cS;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=aS;break;case 16189:for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}e.adler=n.check=dS(c),c=0,d=0,n.mode=nS;case nS:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,Yk;e.adler=n.check=1,n.mode=aS;case aS:if(t===Hk||t===Wk)break e;case sS:if(n.last){c>>>=7&d,d-=7&d,n.mode=lS;break}for(;d<3;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=16193;break;case 1:if(xS(n),n.mode=oS,t===Wk){c>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=cS}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=cS;break}if(n.length=65535&c,c=0,d=0,n.mode=rS,t===Wk)break e;case rS:n.mode=16195;case 16195:if(h=n.length,h){if(h>i&&(h=i),h>l&&(h=l),0===h)break e;s.set(a.subarray(r,r+h),o),i-=h,r+=h,l-=h,o+=h,n.length-=h;break}n.mode=aS;break;case 16196:for(;d<14;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=cS;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.lens[P[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},S=Gk(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid code lengths set",n.mode=cS;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;M=n.lencode[c&(1<<n.lenbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(v<16)c>>>=y,d-=y,n.lens[n.have++]=v;else{if(16===v){for(E=y+2;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(c>>>=y,d-=y,0===n.have){e.msg="invalid bit length repeat",n.mode=cS;break}k=n.lens[n.have-1],h=3+(3&c),c>>>=2,d-=2}else if(17===v){for(E=y+3;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=y,d-=y,k=0,h=3+(7&c),c>>>=3,d-=3}else{for(E=y+7;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=y,d-=y,k=0,h=11+(127&c),c>>>=7,d-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=cS;break}for(;h--;)n.lens[n.have++]=k}}if(n.mode===cS)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=cS;break}if(n.lenbits=9,C={bits:n.lenbits},S=Gk(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid literal/lengths set",n.mode=cS;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},S=Gk(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,S){e.msg="invalid distances set",n.mode=cS;break}if(n.mode=oS,t===Wk)break e;case oS:n.mode=iS;case iS:if(i>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,jk(e,p),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,i=e.avail_in,c=n.hold,d=n.bits,n.mode===aS&&(n.back=-1);break}for(n.back=0;M=n.lencode[c&(1<<n.lenbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(g&&!(240&g)){for(b=y,x=g,w=v;M=n.lencode[w+((c&(1<<b+x)-1)>>b)],y=M>>>24,g=M>>>16&255,v=65535&M,!(b+y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=y,d-=y,n.back+=y,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=aS;break}if(64&g){e.msg="invalid literal/length code",n.mode=cS;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(E=n.extra;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;M=n.distcode[c&(1<<n.distbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(!(240&g)){for(b=y,x=g,w=v;M=n.distcode[w+((c&(1<<b+x)-1)>>b)],y=M>>>24,g=M>>>16&255,v=65535&M,!(b+y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=y,d-=y,n.back+=y,64&g){e.msg="invalid distance code",n.mode=cS;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(E=n.extra;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=cS;break}n.mode=16204;case 16204:if(0===l)break e;if(h=p-l,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=cS;break}h>n.wnext?(h-=n.wnext,m=n.wsize-h):m=n.wnext-h,h>n.length&&(h=n.length),f=n.window}else f=s,m=o-n.offset,h=n.length;h>l&&(h=l),l-=h,n.length-=h;do{s[o++]=f[m++]}while(--h);0===n.length&&(n.mode=iS);break;case 16205:if(0===l)break e;s[o++]=n.length,l--,n.mode=iS;break;case lS:if(n.wrap){for(;d<32;){if(0===i)break e;i--,c|=a[r++]<<d,d+=8}if(p-=l,e.total_out+=p,n.total+=p,4&n.wrap&&p&&(e.adler=n.check=n.flags?mw(n.check,s,p,o-p):pw(n.check,s,p,o-p)),p=l,4&n.wrap&&(n.flags?c:dS(c))!==n.check){e.msg="incorrect data check",n.mode=cS;break}c=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=cS;break}c=0,d=0}n.mode=16208;case 16208:S=qk;break e;case cS:S=Qk;break e;case 16210:return Zk;default:return Xk}return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,(n.wsize||p!==e.avail_out&&n.mode<cS&&(n.mode<lS||t!==Kk))&&wS(e,e.output,e.next_out,p-e.avail_out),u-=e.avail_in,p-=e.avail_out,e.total_in+=u,e.total_out+=p,n.total+=p,4&n.wrap&&p&&(e.adler=n.check=n.flags?mw(n.check,s,p,e.next_out-p):pw(n.check,s,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===aS?128:0)+(n.mode===oS||n.mode===rS?256:0),(0===u&&0===p||t===Kk)&&S===$k&&(S=Jk),S},inflateEnd:e=>{if(pS(e))return Xk;let t=e.state;return t.window&&(t.window=null),e.state=null,$k},inflateGetHeader:(e,t)=>{if(pS(e))return Xk;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,$k):Xk},inflateSetDictionary:(e,t)=>{const n=t.length;let a,s,r;return pS(e)?Xk:(a=e.state,0!==a.wrap&&a.mode!==nS?Xk:a.mode===nS&&(s=1,s=pw(s,t,n,0),s!==a.check)?Qk:(r=wS(e,t,n,n),r?(a.mode=16210,Zk):(a.havedict=1,$k)))},inflateInfo:"pako inflate (from Nodeca project)"};var SS=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const MS=Object.prototype.toString,{Z_NO_FLUSH:NS,Z_FINISH:CS,Z_OK:ES,Z_STREAM_END:PS,Z_NEED_DICT:TS,Z_STREAM_ERROR:AS,Z_DATA_ERROR:IS,Z_MEM_ERROR:_S}=yw;function OS(e){this.options=fk({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kk,this.strm.avail_out=0;let n=kS.inflateInit2(this.strm,t.windowBits);if(n!==ES)throw new Error(fw[n]);if(this.header=new SS,kS.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=bk(t.dictionary):"[object ArrayBuffer]"===MS.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=kS.inflateSetDictionary(this.strm,t.dictionary),n!==ES)))throw new Error(fw[n])}function FS(e,t){const n=new OS(t);if(n.push(e),n.err)throw n.msg||fw[n.err];return n.result}OS.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize,s=this.options.dictionary;let r,o,i;if(this.ended)return!1;for(o=t===~~t?t:!0===t?CS:NS,"[object ArrayBuffer]"===MS.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),r=kS.inflate(n,o),r===TS&&s&&(r=kS.inflateSetDictionary(n,s),r===ES?r=kS.inflate(n,o):r===IS&&(r=TS));n.avail_in>0&&r===PS&&n.state.wrap>0&&0!==e[n.next_in];)kS.inflateReset(n),r=kS.inflate(n,o);switch(r){case AS:case IS:case TS:case _S:return this.onEnd(r),this.ended=!0,!1}if(i=n.avail_out,n.next_out&&(0===n.avail_out||r===PS))if("string"===this.options.to){let e=wk(n.output,n.next_out),t=n.next_out-e,s=xk(n.output,e);n.next_out=t,n.avail_out=a-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==ES||0!==i){if(r===PS)return r=kS.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},OS.prototype.onData=function(e){this.chunks.push(e)},OS.prototype.onEnd=function(e){e===ES&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=yk(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var DS={Inflate:OS,inflate:FS,inflateRaw:function(e,t){return(t=t||{}).raw=!0,FS(e,t)},ungzip:FS};const{Deflate:RS,deflate:jS,deflateRaw:LS,gzip:BS}=Dk,{Inflate:VS,inflate:zS,inflateRaw:US,ungzip:GS}=DS;var KS={Deflate:RS,deflate:jS,deflateRaw:LS,gzip:BS,Inflate:VS,inflate:zS,inflateRaw:US,ungzip:GS,constants:yw};const HS={0:"ChipSynth",1:"FurnaceOPN",2:"FurnaceGB",3:"FurnaceC64",4:"Sampler",5:"FurnacePCE",6:"FurnaceAY",7:"FurnaceAY",8:"FurnaceTIA",9:"FurnaceSAA",10:"FurnaceVIC",11:"ChipSynth",12:"FurnaceVRC6",13:"FurnaceOPLL",14:"FurnaceOPL",15:"FurnaceFDS",16:"FurnaceVB",17:"FurnaceN163",18:"FurnaceSCC",19:"FurnaceOPZ",20:"ChipSynth",21:"ChipSynth",22:"FurnaceSWAN",23:"FurnaceLynx",24:"FurnaceVERA",25:"FurnaceX1_010",26:"FurnaceVRC6",27:"FurnaceES5506",28:"Sampler",29:"FurnaceSNES",30:"ChipSynth",31:"ChipSynth",32:"FurnaceOPL",33:"FurnaceOPM",34:"FurnaceNES",35:"Sampler",36:"FurnaceOKI",37:"Sampler",38:"Sampler",39:"FurnaceSEGAPCM",40:"FurnaceQSOUND",41:"FurnaceYMZ280B",42:"FurnaceRF5C68",43:"ChipSynth",44:"FurnaceT6W28",45:"FurnaceK007232",46:"FurnaceGA20",47:"ChipSynth",48:"FurnaceSM8521",49:"ChipSynth",50:"FurnaceK053260",52:"FurnaceTED",53:"FurnaceC140",54:"Sampler",55:"FurnaceESFM",56:"ChipSynth",57:"ChipSynth",58:"ChipSynth",59:"Sampler",60:"Sampler",61:"Sampler",62:"ChipSynth",63:"FurnaceC64",64:"FurnaceSUPERVISION",65:"FurnaceUPD1771",66:"FurnaceC64"};const WS=[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],$S=[250,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],qS={0:0,1:17,2:10,3:4,4:4,5:6,6:5,7:3,71:3,128:3,129:4,130:8,131:6,132:2,133:4,134:1,135:8,136:3,137:9,138:1,139:3,140:8,141:6,142:16,143:9,144:9,145:18,146:28,147:1,148:4,149:8,150:4,151:6,152:8,153:1,154:3,155:16,156:6,157:6,158:16,159:6,160:9,161:5,162:11,163:11,164:20,165:14,166:17,167:11,168:4,170:4,171:1,172:17,173:2,174:42,175:44,176:16,177:32,178:10,179:12,180:5,181:8,182:9,183:19,184:8,185:3,186:8,187:8,188:8,189:11,190:7,191:4,192:1,193:10,194:18,195:10,196:20,197:20,198:2,199:4,200:3,202:5,203:3,204:4,205:2,206:24,207:16,209:18,212:4,213:6,214:16,215:2,216:16,217:4,222:19,224:19,226:4,227:4,229:4,240:3,241:5,245:7,252:1,253:8};function YS(e){let t="";for(;!e.isEOF();){const n=e.readUint8();if(0===n)break;t+=String.fromCharCode(n)}return t}async function XS(e){const t=function(e){if(120===e[0])try{return KS.inflate(e)}catch(t){throw new Error("Failed to decompress Furnace file: "+t)}return e}(new Uint8Array(e)),n=new ff(t.buffer),a=n.readMagic(16);if(!a.startsWith("-Furnace module-"))throw new Error(`Invalid Furnace file header: "${a}"`);const s=n.readUint16();n.skip(2);const r=n.readUint32();n.seek(r);const o={name:"",author:"",category:"",systemName:"",tuning:440,masterVol:1,version:s,systemLen:0,systems:[],systemChans:[],systemVol:[],systemPan:[],systemPanFR:[],chans:0,subsongs:[],instruments:[],wavetables:[],samples:[],patterns:new Map,comment:""};return s>=240?await async function(e,t,n){const a=e.readMagic(4);if("INF2"!==a)throw new Error(`Expected INF2 block, got: "${a}"`);if(e.readUint32(),t.name=YS(e),t.author=YS(e),t.systemName=YS(e),t.category=YS(e),YS(e),YS(e),YS(e),YS(e),t.tuning=e.readFloat32(),e.readUint8(),t.masterVol=e.readFloat32(),t.chans=e.readUint16(),t.systemLen=e.readUint16(),t.systemLen<1)throw new Error("Zero chips in module!");let s=0;for(let h=0;h<t.systemLen;h++){const n=e.readUint16();t.systems.push(n);const a=e.readUint16();t.systemChans.push(a),s+=a,t.systemVol.push(e.readFloat32()),t.systemPan.push(e.readFloat32()),t.systemPanFR.push(e.readFloat32())}t.chans!==s&&(t.chans=s);const r=e.readUint32();e.skip(4*r),e.readUint8();const o=[],i=[],l=[],c=[],d=[];let u=0,p=!0;for(;p;){switch(e.readUint8()){case 0:p=!1;break;case 1:{const t=e.readUint32();for(let n=0;n<t;n++)c.push(e.readUint32());break}case 2:{const t=e.readUint32();e.skip(4*t);break}case 3:{const t=e.readUint32();e.skip(4*t);break}case 4:{const t=e.readUint32();for(let n=0;n<t;n++)o.push(e.readUint32());break}case 5:{const t=e.readUint32();for(let n=0;n<t;n++)i.push(e.readUint32());break}case 6:{const t=e.readUint32();for(let n=0;n<t;n++)l.push(e.readUint32());break}case 7:{const t=e.readUint32();for(let n=0;n<t;n++)d.push(e.readUint32());break}case 8:e.readUint32(),e.readUint32();break;case 9:e.readUint32(),u=e.readUint32();break;case 10:{const t=e.readUint32();e.skip(4*t);break}default:{const t=e.readUint32();e.skip(4*t);break}}}for(const h of c){e.seek(h);const a=QS(e,t.chans,n);t.subsongs.push(a)}for(const h of o){e.seek(h);const n=ZS(e);t.instruments.push(n)}for(const h of i){e.seek(h);const n=tM(e);t.wavetables.push(n)}for(const h of l){e.seek(h);const a=nM(e,n);t.samples.push(a)}for(const h of d){e.seek(h);const a=aM(e,t.chans,t.subsongs,n),s=`${a.subsong}_${a.channel}_${a.index}`;if(t.patterns.set(s,a),t.patterns.size<=3){if(a.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)){a.rows.findIndex(e=>e.note>=0||e.instrument>=0)}}}if(u>0){e.seek(u);"CMNT"===e.readMagic(4)&&(e.readUint32(),t.comment=YS(e))}}(n,o,s,t.buffer):await async function(e,t,n){const a=e.readMagic(4);if("INFO"!==a)throw new Error(`Expected INFO block, got: "${a}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8();const r=e.readUint16(),o=e.readUint16(),i=e.readUint16();e.readUint32();const l=[];for(let f=0;f<32;f++){const t=e.readUint8();0!==t&&l.push(t)}t.systems=l.filter(e=>0!==e),t.systemLen=t.systems.length;for(let f=0;f<32;f++){const n=e.readInt8();f<t.systemLen&&t.systemVol.push(n/64)}for(let f=0;f<32;f++){const n=e.readInt8();f<t.systemLen&&t.systemPan.push(n/127)}e.skip(128);t.name=YS(e),t.author=YS(e),t.tuning=e.readFloat32(),n>=36&&e.readUint8();n>=36&&e.readUint8();n>=36&&e.readUint8();n>=42&&e.readUint8();n>=42&&e.readUint8();n>=45&&(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8());n>=47&&(e.readUint8(),e.readUint8());n>=49&&e.readUint8();n>=50&&e.readUint8();n>=62&&e.readUint8();n>=62&&e.readUint8();n>=64&&e.readUint8();n>=65&&e.readUint8();n>=66&&e.readUint8();n>=69&&e.readUint8();const c=[],d=[],u=[],p=[];for(let f=0;f<r;f++)c.push(e.readUint32());for(let f=0;f<o;f++)d.push(e.readUint32());for(let f=0;f<i;f++)u.push(e.readUint32());let h=0;for(const f of t.systems){const e=qS[f]||4;t.systemChans.push(e),h+=e}t.chans=h,e.readUint32&&e.readUint32(),s.orders=[];for(let f=0;f<t.chans;f++){const t=[];for(let n=0;n<s.ordersLen;n++)t.push(e.readUint8());s.orders.push(t)}s.effectColumns=[];for(let f=0;f<t.chans;f++)s.effectColumns.push(e.readUint8());e.skip(2*t.chans);for(let f=0;f<t.chans;f++)s.channelNames.push(YS(e));for(let f=0;f<t.chans;f++)s.channelShortNames.push(YS(e));t.comment=YS(e),t.masterVol=n>=59?e.readFloat32():2;n>=70&&e.readUint8();n>=96&&(s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16());t.subsongs.push(s);for(const f of c)if(0!==f){e.seek(f);try{const a=ZS(e,n);t.instruments.push(a)}catch(m){t.instruments.push({name:"Error",type:0,macros:[],samples:[],wavetables:[]})}}for(const f of d)if(0!==f){e.seek(f);try{const n=tM(e);t.wavetables.push(n)}catch(m){}}for(const f of u)if(0!==f){e.seek(f);try{const a=nM(e,n);t.samples.push(a)}catch(m){}}for(const f of p)if(0!==f){e.seek(f);try{const a=aM(e,t.chans,t.subsongs,n),s=`${a.subsong}_${a.channel}_${a.index}`;if(t.patterns.set(s,a),t.patterns.size<=3){a.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)}}catch(m){}}}(n,o,s,t.buffer),o}function QS(e,t,n){const a=e.readMagic(4);if("SNG2"!==a&&"SONG"!==a)throw new Error(`Expected SNG2/SONG block, got: "${a}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};if("SNG2"===a){s.hz=e.readFloat32(),s.arpLen=e.readUint8(),e.readUint8(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16();const t=e.readUint8(),n=[];for(let a=0;a<16;a++)n.push(e.readUint16());s.speed1=n[0]||6,s.speed2=t>1?n[1]:s.speed1,s.name=YS(e),s.comment=YS(e)}else s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16(),s.name=YS(e),s.comment=YS(e);for(let r=0;r<t;r++){const t=[];for(let n=0;n<s.ordersLen;n++)t.push(e.readUint8());s.orders.push(t)}for(let r=0;r<t;r++)s.effectColumns.push(e.readUint8());e.skip(2*t);for(let r=0;r<t;r++)s.channelNames.push(YS(e));for(let r=0;r<t;r++)s.channelShortNames.push(YS(e));return n>=240&&e.skip(4*t),s}function ZS(e,t){const n=e.readMagic(4),a={name:"",type:0,macros:[],samples:[],wavetables:[]};if("INS2"===n||"FINS"===n)for(e.readUint32(),e.readUint16(),a.type=e.readUint16();!e.isEOF();){const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),s=e.getOffset()+n;switch(t){case"NA":a.name=YS(e);break;case"FM":a.fm=JS(e);break;case"MA":eM(e,a);break;case"SM":e.readUint16(),e.readUint8(),e.readUint8();break;case"SL":case"LS":{const n="LS"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LS"===t?a.samples.push(e.readUint16()):a.samples.push(e.readUint8());break}case"WL":case"LW":{const n="LW"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LW"===t?a.wavetables.push(e.readUint16()):a.wavetables.push(e.readUint8());break}}e.seek(s)}else{if("INST"!==n)throw new Error(`Unknown instrument format: "${n}"`);e.readUint32(),e.readUint16(),a.type=e.readUint8(),e.readUint8(),a.name=YS(e),0!==a.type&&1!==a.type||(a.fm=function(e){const t={...xa,operators:[],macros:[],opMacros:[],wavetables:[]};t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),t.fms=7&e.readUint8(),t.ams=3&e.readUint8();const n=e.readUint8();t.ops=n,t.opllPreset=31&e.readUint8(),e.skip(2);for(let a=0;a<4;a++){const s={enabled:a<n,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.skip(10),t.operators.push(s)}return t}(e))}return a}function JS(e,t){const n={...xa,operators:[],macros:[],opMacros:[],wavetables:[]},a=e.readUint8(),s=15&a,r=a>>4&15;n.ops=s;const o=e.readUint8();n.algorithm=7&o,n.feedback=o>>3&7;const i=e.readUint8();n.fms=7&i,n.ams=i>>3&3;const l=e.readUint8();n.opllPreset=31&l;for(let c=0;c<s;c++){const t=e.readUint8(),a=e.readUint8(),s=e.readUint8(),o=e.readUint8(),i=e.readUint8(),l=e.readUint8(),d=e.readUint8(),u=e.readUint8(),p={enabled:!!(r>>c&1),mult:15&t,dt:t>>4&7,ksr:!!(t>>7&1),tl:127&a,sus:!!(a>>7&1),ar:31&s,vib:!!(s>>5&1),rs:s>>6&3,dr:31&o,ksl:o>>5&3,am:!!(o>>7&1),d2r:31&i,sl:l>>4&15,rr:15&l,ssg:15&d,ws:7&u,dt2:u>>3&3};n.operators.push(p)}return n}function eM(e,t,n){const a=e.readUint16(),s=e.getOffset()+a;for(;e.getOffset()<s;){const n=e.readUint8();if(255===n)break;const a={code:n,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},s=a.type>>6&3;for(let t=0;t<a.length;t++)switch(s){case 0:a.data.push(e.readUint8());break;case 1:a.data.push(e.readInt8());break;case 2:a.data.push(e.readInt16());break;case 3:a.data.push(e.readInt32())}t.macros.push(a)}}function tM(e){const t=e.readMagic(4);if("WAVE"!==t)throw new Error(`Expected WAVE block, got: "${t}"`);e.readUint32();const n={name:YS(e),width:e.readUint32(),height:0,data:[]};e.readUint32(),n.height=e.readUint32();for(let a=0;a<n.width;a++)n.data.push(e.readInt32());return n}function nM(e,t){const n=e.readMagic(4),a={name:"",length:0,compatRate:0,c4Rate:0,depth:16,loopStart:-1,loopEnd:-1,loopDirection:0,data:new Int16Array(0)};if("SMP2"===n)if(e.readUint32(),a.name=YS(e),a.length=e.readUint32(),a.compatRate=e.readUint32(),a.c4Rate=e.readUint32(),a.depth=e.readUint8(),a.loopDirection=t>=123?e.readUint8():0,e.readUint8(),e.readUint8(),a.loopStart=e.readInt32(),a.loopEnd=e.readInt32(),e.skip(16),16===a.depth){const t=new Int16Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt16();a.data=t}else if(8===a.depth){const t=new Int8Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt8();a.data=t}else a.data=e.readBytes(a.length);else{if("SMPL"!==n)throw new Error(`Unknown sample format: "${n}"`);{e.readUint32(),a.name=YS(e),a.length=e.readUint32(),a.compatRate=e.readUint32(),t<58?(e.readUint16(),e.readUint16()):e.skip(4),a.depth=e.readUint8(),e.readUint8(),t>=32&&(a.c4Rate=e.readUint16()),t>=19&&(a.loopStart=e.readInt32());const n=t<58?2*a.length:a.length;if(16===a.depth){const t=new Int16Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt16();a.data=t}else{const t=new Int8Array(n);for(let a=0;a<n;a++)t[a]=e.readInt8();a.data=t}}}return a}function aM(e,t,n,a){const s=e.readMagic(4),r={subsong:0,channel:0,index:0,name:"",rows:[]};if("PATN"===s){e.readUint32(),r.subsong=e.readUint8(),a>=240?r.channel=e.readUint16():(r.channel=e.readUint8(),e.readUint8()),r.index=e.readUint16(),a>=51&&(r.name=YS(e));const t=n[r.subsong]||n[0],s=t?.patLen||64;t?.effectColumns[r.channel];for(let e=0;e<s;e++)r.rows.push({note:-1,octave:0,instrument:-1,volume:-1,effects:[]});let o=0;for(;o<s&&!e.isEOF();){const t=e.readUint8();if(255===t)break;if(128&t){o+=2+(127&t);continue}if(0===t){o++;continue}const n=r.rows[o],a=!!(1&t),s=!!(2&t),i=!!(4&t),l=!!(8&t),c=!!(16&t),d=!!(64&t);let u=0,p=0;if(!!(32&t)&&(u=e.readUint8()),d&&(p=e.readUint8()),a){const t=e.readUint8();t>=180?(n.note=t,n.octave=0):t<180&&(n.note=WS[t]||0,n.octave=$S[t]||0,n.octave>=250&&(n.octave=n.octave-256))}if(s&&(n.instrument=e.readUint8()),i&&(n.volume=e.readUint8()),l){const t=e.readUint8(),a=c?e.readUint8():0;n.effects.push({type:t,value:a})}else c&&e.readUint8();for(let r=1;r<=3;r++){const t=!!(u&1<<2*(r-1)+1);if(!!(u&1<<2*(r-1))){const a=e.readUint8(),s=t?e.readUint8():0;n.effects.push({type:a,value:s})}else t&&e.readUint8()}for(let r=4;r<=7;r++){const t=!!(p&1<<2*(r-4)+1);if(!!(p&1<<2*(r-4))){const a=e.readUint8(),s=t?e.readUint8():0;n.effects.push({type:a,value:s})}else t&&e.readUint8()}o++}}else{if("PATR"!==s)throw new Error(`Unknown pattern format: "${s}"`);{e.readUint32(),r.channel=e.readUint16(),r.index=e.readUint16(),a>=95&&(r.subsong=e.readUint16()),e.skip(2);const t=n[r.subsong]||n[0],s=t?.patLen||64,o=t?.effectColumns[r.channel]||1;for(let n=0;n<s;n++){const t={note:e.readInt16(),octave:e.readInt16(),instrument:e.readInt16(),volume:e.readInt16(),effects:[]};0===t.note&&0===t.octave?t.note=-1:100===t.note?t.note=180:101===t.note?t.note=181:102===t.note&&(t.note=182);for(let n=0;n<o;n++){const n=e.readInt16(),a=e.readInt16();n>=0&&t.effects.push({type:n,value:a>=0?a:0})}r.rows.push(t)}a>=51&&(r.name=YS(e))}}return r}function sM(e){const t=e.instruments.map((t,n)=>{const a=[],s=(r=t.type,HS[r]||"ChipSynth");var r;const o="Sampler"===s||"Player"===s;if(t.samples&&t.samples.length>0){for(const l of t.samples)if(l<e.samples.length){const t=e.samples[l];a.push(oM(t,l))}}else if(o&&n<e.samples.length){const t=e.samples[n];a.push(oM(t,n))}const i={chipType:t.type,synthType:s,macros:t.macros.map(e=>({type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed})),wavetables:t.wavetables.filter(t=>t<e.wavetables.length).map(t=>{const n=e.wavetables[t];return{id:t,data:[...n.data],len:n.width,max:n.height}})};return t.fm&&(i.fm={algorithm:t.fm.algorithm,feedback:t.fm.feedback,fms:t.fm.fms,ams:t.fm.ams,ops:t.fm.ops,opllPreset:t.fm.opllPreset,operators:t.fm.operators.map(e=>({enabled:e.enable,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2,rs:e.rs,am:e.am,ksr:e.ksr,ksl:e.ksl,sus:e.sus,vib:e.vib,ws:e.ws,ssg:e.ssg}))}),{id:n+1,name:t.name||`Instrument ${n+1}`,samples:a,fadeout:0,volumeType:"none",panningType:"none",furnace:i}}),n=[],a=e.subsongs[0];if(!a)return{instruments:t,patterns:[],metadata:rM(e)};const s=Math.max(...a.orders.flat().filter(e=>!isNaN(e)&&e>=0),0);for(let r=0;r<=s;r++){const t=[];for(let n=0;n<a.patLen;n++){const a=[];for(let t=0;t<e.chans;t++){const s=`0_${t}_${r}`,o=e.patterns.get(s);if(o&&o.rows[n]){const e=o.rows[n],s=iM(e);0===r&&n<5&&0===t&&(e.note>=0||e.instrument),a.push(s)}else a.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(a)}n.push(t)}n.filter(e=>e.some(e=>e.some(e=>e.note>0||e.instrument>0||e.effectType>0)));return n.length>0&&n[0].length,{instruments:t,patterns:n,metadata:rM(e)}}function rM(e){const t=e.subsongs[0];return{sourceFormat:"XM",sourceFile:e.name||"Furnace Module",importedAt:(new Date).toISOString(),originalChannelCount:e.chans,originalPatternCount:e.patterns.size,originalInstrumentCount:e.instruments.length,modData:{moduleType:"FUR",initialSpeed:t?.speed1||6,initialBPM:Math.round((t?.virtualTempo||150)*(t?.hz||60)/(2.5*(t?.speed1||6))),amigaPeriods:!1,channelNames:t?.channelNames||Array.from({length:e.chans},(e,t)=>`Ch ${t+1}`),songLength:t?.ordersLen||1,restartPosition:0,patternOrderTable:t?.orders[0]||[],songMessage:e.comment}}}function oM(e,t){let n;if(16===e.depth&&e.data instanceof Int16Array)n=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);else if(e.data instanceof Int8Array){const t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=256*e.data[n];n=t.buffer}else n=new ArrayBuffer(2*e.length);return{id:t,name:e.name,pcmData:n,loopStart:e.loopStart>=0?e.loopStart:0,loopLength:e.loopEnd>e.loopStart?e.loopEnd-e.loopStart:0,loopType:e.loopStart<0?"none":2===e.loopDirection?"pingpong":"forward",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:e.c4Rate||e.compatRate||22050,length:e.length}}function iM(e){let t=0;if(180===e.note||181===e.note||182===e.note)t=97;else if(e.note>=0&&e.note<=12){const n=12===e.note?0:e.note,a=12===e.note?e.octave+1:e.octave;t=12*(a<0?0:a)+n+1,t>96&&(t=96),t<1&&(t=0)}let n=0;e.volume>=0&&(n=16+Math.min(64,Math.floor(e.volume/2)));let a=0,s=0;if(e.effects.length>0){const t=e.effects[0];a={0:0,1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:8,9:15,10:10,11:11,12:233,13:13,15:15,16:16,17:17,128:8,129:8,130:8,131:25,132:25,136:8,137:8,138:8,144:9,145:9,146:9,147:9,148:9,149:9,150:9,151:9,152:9,153:9,154:9,155:9,156:9,157:9,158:9,159:9,192:15,193:15,194:15,195:15,211:10,212:10,220:236,224:0,225:225,226:226,227:228,228:4,229:0,230:3,231:0,232:3,233:3,234:0,235:0,236:236,237:237,238:0,240:15,241:225,242:226,243:234,244:235,245:0,246:0,247:0,248:234,249:235,250:10,252:236,253:15,254:15,255:0}[r=t.type]??r,s=255&t.value}var r;return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:n,effectType:a,effectParam:s}}async function lM(e){return new Promise((t,n)=>{const a=new FileReader;a.onload=async a=>{const s=a.target?.result;if(!s)return void n(new Error("Failed to read file"));const r=e.name.toLowerCase().slice(e.name.lastIndexOf(".")),o=".xm"===r||".mod"===r||".fur"===r||".dmf"===r;try{if(o)try{const n=await async function(e,t){try{if(".xm"===t){const t=await gx(e);return{format:"XM",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".mod"===t){const t=await Nx(e);return{format:"MOD",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".fur"===t){const t=sM(await XS(e));return{format:"FUR",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".dmf"===t){const t=function(e){const t=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,samples:[],fadeout:0,volumeType:"none",panningType:"none"})),n=[];for(let o=0;o<e.matrixRows;o++){const t=[];for(let n=0;n<e.patternRows;n++){const a=[];for(let t=0;t<e.channelCount;t++){const s=e.patternMatrix[t]?.[o]||0,r=t*e.matrixRows+s,i=e.patterns[r],l=i?.rows?.[n]?.[t];l?a.push(mM(l)):a.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(a)}n.push(t)}const a=60,s=Math.round(2.5*a/(e.timeBase+1)/e.ticksPerRow[0]*4),r={sourceFormat:"XM",sourceFile:e.name||"DefleMask Module",importedAt:(new Date).toISOString(),originalChannelCount:e.channelCount,originalPatternCount:n.length,originalInstrumentCount:e.instruments.length,modData:{moduleType:"DMF",initialSpeed:e.ticksPerRow[0],initialBPM:s>0?s:125,amigaPeriods:!1,channelNames:Array.from({length:e.channelCount},(e,t)=>`Ch ${t+1}`),songLength:e.matrixRows,restartPosition:0,patternOrderTable:Array.from({length:e.matrixRows},(e,t)=>t),songMessage:`${e.name} by ${e.author}`}};return{instruments:t,patterns:n,metadata:r}}(vf.parse(e,"dmf"));return{format:"DMF",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}}catch(n){return null}return null}(s,r,e.name);if(n){const a={title:n.importMetadata.sourceFile,type:".fur"===r?"Furnace":".dmf"===r?"DefleMask":n.format,channels:n.importMetadata.originalChannelCount,patterns:n.importMetadata.originalPatternCount,orders:n.importMetadata.modData?.songLength||1,instruments:n.importMetadata.originalInstrumentCount,samples:n.importMetadata.originalInstrumentCount,duration:0,message:n.importMetadata.modData?.songMessage};let o;return".fur"!==r&&".dmf"!==r&&(o=await uM(s,e)),void t({metadata:a,arrayBuffer:s,player:o,file:e,nativeData:n})}}catch(i){}const n=await uM(s,e),a=await new Promise((t,a)=>{const s=setTimeout(()=>{a(new Error("Timeout waiting for metadata"))},5e3);n.onMetadata(n=>{let a;clearTimeout(s),n.song&&(a={channels:n.song.channels||[],instruments:n.song.instruments||[],samples:n.song.samples||[],orders:n.song.orders||[],patterns:n.song.patterns||[],numSubsongs:n.song.numSubsongs||1}),t({title:n.title||e.name.replace(/\.[^/.]+$/,""),type:n.type||"Unknown",channels:n.song?.channels?.length||n.channels||4,patterns:n.song?.patterns?.length||n.totalPatterns||n.patterns||1,orders:n.song?.orders?.length||n.totalOrders||n.orders||1,instruments:n.song?.instruments?.length||n.instruments||0,samples:n.song?.samples?.length||n.samples||0,duration:n.dur||0,message:n.message,song:a})}),n.onError(e=>{clearTimeout(s),a(new Error(`Failed to load module: ${e.type||e.message||"unknown error"}`))})});t({metadata:a,arrayBuffer:s,player:n,file:e})}catch(l){n(l)}},a.onerror=()=>n(new Error("Failed to read file")),a.readAsArrayBuffer(e)})}async function cM(e){e.player&&await e.player.play(e.arrayBuffer)}function dM(e){e.player&&e.player.stop()}async function uM(e,t){const n=new yx({repeatCount:0});if(!(await new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4);n.onInitialized(()=>{clearTimeout(t),e(!0)}),n.onError(n=>{"init"===n.type&&(clearTimeout(t),e(!1))})})))throw new Error("Module player not available. The audio worklet failed to load.");return await n.play(e),n.stop(),n}function pM(){return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"]}function hM(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].includes(t)}function mM(e){let t=0;if(100===e.note)t=97;else if(e.note>=0&&e.note<=11){t=12*Math.max(0,Math.min(7,e.octave))+e.note+1,t>96&&(t=96),t<1&&(t=0)}let n=0;e.volume>=0&&(n=16+Math.floor(4*e.volume));let a=0,s=0;if(e.effects.length>0){const t=e.effects[0];a={0:0,1:1,2:2,3:3,4:4,7:7,8:8,9:9,10:10,11:11,12:12,13:13,15:15,16:16,225:225,226:226,233:233,234:234,235:235,236:236,237:237}[t.code]??0,s=255&t.value}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:n,effectType:a,effectParam:s}}const fM=Object.freeze(Object.defineProperty({__proto__:null,getSupportedExtensions:pM,isSupportedModule:hM,loadModuleFile:lM,previewModule:cM,stopPreview:dM},Symbol.toStringTag,{value:"Module"})),yM=({isOpen:e,onClose:t,onImport:n})=>{const[a,r]=s.useState(null),[o,i]=s.useState(!1),[l,c]=s.useState(null),[d,u]=s.useState(!1),[p,h]=s.useState(!0),m=s.useRef(null),f=s.useCallback(async e=>{if(hM(e.name)){i(!0),c(null),r(null);try{const t=await lM(e);r(t)}catch(t){c(t instanceof Error?t.message:"Failed to load module")}finally{i(!1)}}else c(`Unsupported file format. Supported: ${[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].slice(0,5).join(", ")}...`)},[]),y=s.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&f(t)},[f]),g=s.useCallback(e=>{e.preventDefault()},[]),v=s.useCallback(e=>{const t=e.target.files?.[0];t&&f(t)},[f]),b=s.useCallback(()=>{a&&(d?(dM(a),u(!1)):(cM(a),u(!0)))},[a,d]),x=s.useCallback(()=>{a&&(d&&(dM(a),u(!1)),n(a,{useLibopenmpt:p}),t())},[a,d,n,t,p]),w=s.useCallback(()=>{a&&d&&dM(a),r(null),c(null),u(!1),t()},[a,d,t]);return e?bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[80vh] overflow-hidden",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(Et,{size:18,className:"text-accent-primary"}),bn.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Tracker Module"})]}),bn.jsx(jv,{variant:"icon",size:"icon",onClick:w,"aria-label":"Close dialog",children:bn.jsx(Te,{size:16})})]}),bn.jsxs("div",{className:"p-4 space-y-4",children:[bn.jsxs("div",{onDrop:y,onDragOver:g,onClick:()=>m.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${o?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[bn.jsx("input",{ref:m,type:"file",accept:[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].join(","),onChange:v,className:"hidden"}),o?bn.jsxs("div",{className:"flex flex-col items-center gap-2",children:[bn.jsx("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),bn.jsx("p",{className:"text-sm text-text-muted",children:"Loading module..."})]}):bn.jsxs("div",{className:"flex flex-col items-center gap-2",children:[bn.jsx(Pt,{size:32,className:"text-text-muted"}),bn.jsx("p",{className:"text-sm text-text-primary",children:"Drop a tracker file here or click to browse"}),bn.jsx("p",{className:"text-xs text-text-muted",children:"Supports MOD, XM, IT, S3M and 20+ other formats"})]})]}),l&&bn.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[bn.jsx(De,{size:16}),l]}),a&&bn.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(_e,{size:16,className:"text-accent-primary"}),bn.jsx("span",{className:"font-medium text-text-primary",children:a.metadata.title})]}),bn.jsx("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:a.metadata.type})]}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Channels:"}),bn.jsx("span",{className:"text-text-primary font-mono",children:a.metadata.channels})]}),bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Patterns:"}),bn.jsx("span",{className:"text-text-primary font-mono",children:a.metadata.patterns})]}),bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Instruments:"}),bn.jsx("span",{className:"text-text-primary font-mono",children:a.metadata.instruments})]}),bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Samples:"}),bn.jsx("span",{className:"text-text-primary font-mono",children:a.metadata.samples})]}),bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Orders:"}),bn.jsx("span",{className:"text-text-primary font-mono",children:a.metadata.orders})]}),bn.jsxs("div",{className:"flex justify-between text-text-muted",children:[bn.jsx("span",{children:"Duration:"}),bn.jsxs("span",{className:"text-text-primary font-mono",children:[Math.floor(a.metadata.duration/60),":",String(Math.floor(a.metadata.duration%60)).padStart(2,"0")]})]})]}),a.metadata.message&&bn.jsx("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap",children:a.metadata.message}),bn.jsx(jv,{variant:"ghost",fullWidth:!0,onClick:b,icon:d?bn.jsx(Tt,{size:14}):bn.jsx(At,{size:14}),className:d?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:d?"Stop Preview":"Preview"})]}),a&&bn.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("input",{type:"checkbox",id:"useLibopenmpt",checked:p,onChange:e=>h(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bgSecondary accent-accent-primary"}),bn.jsx("label",{htmlFor:"useLibopenmpt",className:"text-sm text-text-primary cursor-pointer",children:"Use libopenmpt for sample-accurate playback"})]}),bn.jsxs("div",{className:"flex items-start gap-2 text-xs text-text-muted",children:[bn.jsx(It,{size:12,className:"mt-0.5 flex-shrink-0"}),bn.jsx("span",{children:"When enabled, uses libopenmpt WASM for authentic tracker effects (smooth vibrato, portamento). Editing will use Tone.js approximation."})]})]}),a&&!p&&bn.jsx("p",{className:"text-xs text-text-muted",children:"Note: Importing will create patterns and sampler instruments from this module. Complex effects may not translate perfectly."})]}),bn.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border",children:[bn.jsx(jv,{variant:"ghost",size:"sm",onClick:w,children:"Cancel"}),bn.jsx(jv,{variant:"primary",size:"sm",onClick:x,disabled:!a,children:"Import Module"})]})]})}):null},gM=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(1),o=()=>{t(a)};return bn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:bn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),o()):"Escape"===e.key&&(e.preventDefault(),n())},children:[bn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Scale Volume (",e,")"]}),bn.jsxs("div",{className:"space-y-4",children:[bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Scale Factor"}),bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsx("input",{type:"range",min:"0",max:"2",step:"0.05",value:a,onChange:e=>r(parseFloat(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),bn.jsxs("span",{className:"text-neutral-100 font-mono text-sm w-20 text-right",children:[a.toFixed(2)," (",Math.round(100*a),"%)"]})]}),bn.jsxs("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[bn.jsx("span",{children:"0 (silence)"}),bn.jsx("span",{children:"1 (unchanged)"}),bn.jsx("span",{children:"2 (double)"})]})]}),bn.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[bn.jsxs("p",{className:"mb-1",children:[bn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Scale volume multiplies all volume values by the factor."]}),bn.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[bn.jsx("li",{children:"0.5 = half volume (50%)"}),bn.jsx("li",{children:"1.0 = no change (100%)"}),bn.jsx("li",{children:"2.0 = double volume (200%, clamped to max)"})]})]})]}),bn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[bn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",bn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),bn.jsxs("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",bn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},vM=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(64),[o,i]=s.useState(0),l=()=>{t(a,o)};return bn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:bn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),n())},children:[bn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Fade Volume (",e,")"]}),bn.jsxs("div",{className:"space-y-4",children:[bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Start Volume"}),bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:a,onChange:e=>r(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),bn.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:a.toString().padStart(2,"0")})]})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"End Volume"}),bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:o,onChange:e=>i(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),bn.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:o.toString().padStart(2,"0")})]})]}),bn.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3",children:bn.jsxs("div",{className:"text-xs text-neutral-400 space-y-2",children:[bn.jsxs("p",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Fade Direction:"})," ",a>o?bn.jsx("span",{className:"text-red-400",children:"Fade out (loud  quiet)"}):a<o?bn.jsx("span",{className:"text-green-400",children:"Fade in (quiet  loud)"}):bn.jsx("span",{className:"text-neutral-400",children:"No change (flat)"})]}),bn.jsxs("p",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Fade volume applies linear interpolation from start to end across all rows in the ",e,"."]})]})})]}),bn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[bn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",bn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),bn.jsxs("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",bn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},bM=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(0),[o,i]=s.useState(0),l=()=>{t(a,o)};return bn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:bn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),n())},children:[bn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Remap Instrument (",e,")"]}),bn.jsxs("div",{className:"space-y-4",children:[bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Source Instrument"}),bn.jsx("input",{type:"number",min:"0",max:"255",value:a,onChange:e=>r(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),bn.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to find (0-255)"})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Destination Instrument"}),bn.jsx("input",{type:"number",min:"0",max:"255",value:o,onChange:e=>i(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"}),bn.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to replace with (0-255)"})]}),bn.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[bn.jsxs("p",{className:"mb-1",children:[bn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Remap instrument replaces all occurrences of the source instrument ID with the destination ID."]}),bn.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[bn.jsxs("li",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Block:"})," Only in selected region"]}),bn.jsxs("li",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Track:"})," Entire current channel"]}),bn.jsxs("li",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Pattern:"})," Entire current pattern"]}),bn.jsxs("li",{children:[bn.jsx("strong",{className:"text-neutral-300",children:"Song:"})," All patterns"]})]})]}),a===o&&bn.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded p-3 text-xs text-yellow-300",children:" Source and destination are the same - no changes will be made."})]}),bn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[bn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",bn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),bn.jsxs("button",{onClick:l,disabled:a===o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Remap ",bn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},xM=({onClose:e})=>{const t=cm(e=>e.patternOrder),n=cm(e=>e.currentPositionIndex),a=cm(e=>e.currentPatternIndex),r=cm(e=>e.addToOrder),o=cm(e=>e.removeFromOrder),i=cm(e=>e.duplicatePosition),l=cm(e=>e.clearOrder),c=cm(e=>e.reorderPositions),d=cm(e=>e.setCurrentPosition),[u,p]=s.useState(null),h=e=>{e.currentTarget.classList.remove("bg-accent-primary/20")},m=()=>{p(null),document.querySelectorAll(".bg-accent-primary\\/20").forEach(e=>{e.classList.remove("bg-accent-primary/20")})};return bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center justify-between bg-ft2-header",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("span",{className:"text-lg font-bold text-ft2-text",children:"Pattern Order"}),bn.jsxs("span",{className:"text-sm text-ft2-textDim",children:["(",t.length," positions)"]})]}),bn.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-dark-bgHover transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:bn.jsx(Te,{size:20})})]}),bn.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center gap-2 bg-dark-bgTertiary",children:[bn.jsxs("button",{onClick:()=>{r(a),iy.success(`Added Pattern ${a.toString(16).padStart(2,"0").toUpperCase()}`,2e3)},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Add current pattern to order",children:[bn.jsx(Qe,{size:14}),"Add Current Pattern"]}),bn.jsxs("button",{onClick:()=>{confirm("Clear all positions? This will reset to just the first pattern.")&&(l(),iy.info("Pattern order cleared",2e3))},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Clear all positions",children:[bn.jsx(Le,{size:14}),"Clear All"]}),bn.jsxs("div",{className:"ml-auto text-xs text-ft2-textDim",children:["Current Pattern: ",a.toString(16).padStart(2,"0").toUpperCase()]})]}),bn.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-ft2-bg",children:bn.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 xl:grid-cols-16 gap-2",children:t.map((e,a)=>bn.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{p(t),e.dataTransfer.effectAllowed="move"})(e,a),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==u&&u!==t&&e.currentTarget.classList.add("bg-accent-primary/20")})(e,a),onDragLeave:h,onDrop:e=>((e,t)=>{e.preventDefault(),e.currentTarget.classList.remove("bg-accent-primary/20"),null!==u&&u!==t&&(c(u,t),p(null),iy.success("Position reordered",2e3))})(e,a),onDragEnd:m,onClick:()=>d(a),onContextMenu:e=>{e.preventDefault(),e.shiftKey?(i(a),iy.success("Position duplicated",2e3)):(e.ctrlKey||e.metaKey)&&(e=>{t.length>1?(o(e),iy.info("Position removed",2e3)):iy.warning("Cannot remove last position",2e3)})(a)},className:`\n                  relative px-3 py-2 rounded border cursor-pointer transition-all\n                  ${a===n?"bg-dark-bgActive border-accent-primary text-accent-primary font-bold":"bg-dark-bgTertiary border-dark-border text-text-secondary hover:bg-dark-bgHover hover:border-dark-borderLight"}\n                  ${u===a?"opacity-50":""}\n                `,title:`Position ${a.toString(16).padStart(2,"0").toUpperCase()}: Pattern ${e.toString(16).padStart(2,"0").toUpperCase()}\nClick to select\nShift+Click to duplicate\nCtrl+Click to remove\nDrag to reorder`,children:[bn.jsx("div",{className:"text-xs text-center leading-none opacity-60",children:a.toString(16).padStart(2,"0").toUpperCase()}),bn.jsx("div",{className:"text-lg text-center font-mono leading-none mt-1",children:e.toString(16).padStart(2,"0").toUpperCase()})]},`pos-${a}`))})}),bn.jsxs("div",{className:"px-4 py-3 border-t border-ft2-border text-sm text-ft2-textDim bg-dark-bgTertiary",children:[bn.jsx("strong",{children:"Controls:"})," Click: Select  Drag: Reorder  Shift+Click: Duplicate  Ctrl+Click: Remove"]})]})})},wM=({isOpen:e,onClose:t})=>{const{selection:n,strumSelection:a}=cm(),[r,o]=s.useState(1),[i,l]=s.useState("down");return bn.jsxs(lx,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[bn.jsx(cx,{title:"Strum / Arpeggiate",icon:bn.jsx(_e,{size:18}),onClose:t,theme:"modern"}),bn.jsxs("div",{className:"p-4 space-y-4",children:[bn.jsx("div",{className:"text-xs text-text-secondary",children:"Add incremental note delays (EDx) across channels to create a strum or arpeggio effect."}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Ticks per channel (1-15)"}),bn.jsx("input",{type:"number",value:r,onChange:e=>o(Math.max(1,Math.min(15,parseInt(e.target.value)||1))),min:1,max:15,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),bn.jsxs("div",{children:[bn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Direction"}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsx("button",{onClick:()=>l("down"),className:"px-3 py-2 text-xs rounded border transition-colors "+("down"===i?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Down (left to right)"}),bn.jsx("button",{onClick:()=>l("up"),className:"px-3 py-2 text-xs rounded border transition-colors "+("up"===i?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Up (right to left)"})]})]}),!n&&bn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),bn.jsxs(dx,{theme:"modern",align:"right",children:[bn.jsx(jv,{variant:"ghost",onClick:t,children:"Cancel"}),bn.jsx(jv,{variant:"primary",onClick:()=>{n?(a(r,i),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},kM=()=>{const e=cm(e=>e.macroSlots),t=cm(e=>e.writeMacroSlot),n=cm(e=>e.readMacroSlot),a=e=>null==e?"..":"string"==typeof e?e:e.toString(16).padStart(2,"0").toUpperCase();return bn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4",children:[bn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[bn.jsx("h4",{className:"text-sm font-semibold text-neutral-100",children:"Macro Slots"}),bn.jsx("span",{className:"text-xs text-neutral-500",children:"FT2-Style Quick Entry"})]}),bn.jsx("div",{className:"space-y-2",children:e.map((e,s)=>{const r=0===e.note&&0===e.instrument&&0===e.volume&&0===e.effTyp&&0===e.eff&&0===e.effTyp2&&0===e.eff2;return bn.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:[bn.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-neutral-700 border border-neutral-600 rounded text-xs font-bold text-neutral-300",children:s+1}),bn.jsxs("div",{className:"flex-1 font-mono text-xs text-neutral-300 flex items-center gap-1",children:[bn.jsx("span",{className:e.note?"text-blue-400":"text-neutral-600",children:e.note||"..."}),bn.jsx("span",{className:null!==e.instrument?"text-green-400":"text-neutral-600",children:a(e.instrument)}),bn.jsx("span",{className:null!==e.volume?"text-yellow-400":"text-neutral-600",children:a(e.volume)}),bn.jsx("span",{className:0!==e.effTyp||0!==e.eff?"text-purple-400":"text-neutral-600",children:0!==e.effTyp||0!==e.eff?`${e.effTyp.toString(16).toUpperCase()}${e.eff.toString(16).padStart(2,"0").toUpperCase()}`:"..."}),bn.jsx("span",{className:0!==e.effTyp2||0!==e.eff2?"text-pink-400":"text-neutral-600",children:0!==e.effTyp2||0!==e.eff2?`${e.effTyp2.toString(16).toUpperCase()}${e.eff2.toString(16).padStart(2,"0").toUpperCase()}`:"..."})]}),bn.jsxs("div",{className:"flex gap-1",children:[bn.jsx("button",{onClick:()=>t(s),className:"px-2 py-1 text-xs font-medium text-neutral-300 bg-neutral-700 border border-neutral-600 rounded hover:bg-neutral-600 transition-colors",title:`Write current cell to slot ${s+1} (Ctrl+Shift+${s+1})`,children:"Write"}),bn.jsx("button",{onClick:()=>n(s),disabled:r,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:`Paste macro slot ${s+1} (Ctrl+${s+1})`,children:"Read"})]})]},s)})}),bn.jsxs("div",{className:"mt-4 p-3 bg-neutral-800/50 border border-neutral-700 rounded text-xs text-neutral-400",children:[bn.jsx("div",{className:"font-semibold text-neutral-300 mb-2",children:"Keyboard Shortcuts:"}),bn.jsxs("div",{className:"space-y-1",children:[bn.jsxs("div",{className:"flex justify-between",children:[bn.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+1-8"}),bn.jsx("span",{children:"Read macro slot 1-8"})]}),bn.jsxs("div",{className:"flex justify-between",children:[bn.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+Shift+1-8"}),bn.jsx("span",{children:"Write current cell to slot 1-8"})]})]}),bn.jsx("p",{className:"mt-2 text-neutral-500",children:"Macros store cell data for quick entry. Perfect for repeated patterns!"})]})]})},SM=({onClose:e,onShowScaleVolume:t,onShowFadeVolume:n,onShowRemapInstrument:a,onExportPattern:r,onExportTrack:o,onReverse:i,onExpand:l,onShrink:c,onDuplicate:d,onMath:u})=>{const{selection:p}=cm(),[h,m]=s.useState("macros"),[f,y]=s.useState(1),[g,v]=s.useState("volume"),b=null!==p,x=e=>{m(h===e?null:e)};return bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(Ie,{size:18,className:"text-accent-primary"}),bn.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"FT2 Advanced Edit"})]}),bn.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:bn.jsx(Te,{size:20})})]}),bn.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[bn.jsxs("div",{className:"border border-ft2-border rounded",children:[bn.jsxs("button",{onClick:()=>x("volume"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[bn.jsx("span",{children:"Volume Operations"}),bn.jsx("span",{children:"volume"===h?"":""})]}),"volume"===h&&bn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[bn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform volume values across selection, track, or pattern"}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsx("button",{onClick:()=>t?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Scale Block"}),bn.jsx("button",{onClick:()=>n?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Fade Block"}),bn.jsx("button",{onClick:()=>t?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Track"}),bn.jsx("button",{onClick:()=>n?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Track"}),bn.jsx("button",{onClick:()=>t?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Pattern"}),bn.jsx("button",{onClick:()=>n?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Pattern"})]})]})]}),bn.jsxs("div",{className:"border border-ft2-border rounded",children:[bn.jsxs("button",{onClick:()=>x("blockops"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[bn.jsxs("span",{className:"flex items-center gap-2",children:[bn.jsx(Ue,{size:14}),"Block Operations"]}),bn.jsx("span",{children:"blockops"===h?"":""})]}),"blockops"===h&&bn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[bn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform selected block content"}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsxs("button",{onClick:i,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[bn.jsx(Ue,{size:12}),"Reverse"]}),bn.jsxs("button",{onClick:d,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[bn.jsx(qe,{size:12}),"Duplicate"]}),bn.jsxs("button",{onClick:l,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[bn.jsx(_t,{size:12}),"Expand 2x"]}),bn.jsxs("button",{onClick:c,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[bn.jsx(Ot,{size:12}),"Shrink 2x"]})]}),bn.jsxs("div",{className:"mt-3 pt-2 border-t border-ft2-border",children:[bn.jsxs("div",{className:"text-xs text-ft2-textDim mb-2 flex items-center gap-1",children:[bn.jsx(Ft,{size:12}),"Math Operations"]}),bn.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[bn.jsxs("select",{value:g,onChange:e=>v(e.target.value),className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text",children:[bn.jsx("option",{value:"volume",children:"Volume"}),bn.jsx("option",{value:"eff",children:"Effect"})]}),bn.jsx("input",{type:"number",value:f,onChange:e=>{const t=Number(e.target.value);isNaN(t)||y(Math.max(0,Math.min(255,t)))},className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text w-16",min:0,max:255})]}),bn.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[bn.jsx("button",{onClick:()=>u?.("add",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"}),bn.jsx("button",{onClick:()=>u?.("sub",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),bn.jsx("button",{onClick:()=>u?.("mul",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),bn.jsx("button",{onClick:()=>u?.("div",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""})]})]}),bn.jsx("div",{className:"text-[10px] text-ft2-textDim mt-1",children:"Alt+R = Reverse | Alt+D = Duplicate"})]})]}),bn.jsxs("div",{className:"border border-ft2-border rounded",children:[bn.jsxs("button",{onClick:()=>x("remap"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[bn.jsxs("span",{className:"flex items-center gap-2",children:[bn.jsx(St,{size:14}),"Instrument Remap"]}),bn.jsx("span",{children:"remap"===h?"":""})]}),"remap"===h&&bn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[bn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Find and replace instrument IDs"}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsx("button",{onClick:()=>a?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Remap Block"}),bn.jsx("button",{onClick:()=>a?.("track"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Track"}),bn.jsx("button",{onClick:()=>a?.("pattern"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Pattern"}),bn.jsx("button",{onClick:()=>a?.("song"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Song"})]})]})]}),bn.jsxs("div",{className:"border border-ft2-border rounded",children:[bn.jsxs("button",{onClick:()=>x("export"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[bn.jsxs("span",{className:"flex items-center gap-2",children:[bn.jsx(Ke,{size:14}),"Export/Import"]}),bn.jsx("span",{children:"export"===h?"":""})]}),"export"===h&&bn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[bn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Export patterns and tracks as FT2-compatible files"}),bn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[bn.jsxs("button",{onClick:r,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[bn.jsx(Ke,{size:12}),"Pattern (.xp)"]}),bn.jsxs("button",{onClick:o,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[bn.jsx(Ke,{size:12}),"Track (.xt)"]})]}),bn.jsx("div",{className:"text-xs text-ft2-textDim mt-2",children:"Import: Use File  Open Module"})]})]}),bn.jsxs("div",{className:"border border-ft2-border rounded",children:[bn.jsxs("button",{onClick:()=>x("macros"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[bn.jsx("span",{children:"Macro Slots"}),bn.jsx("span",{children:"macros"===h?"":""})]}),"macros"===h&&bn.jsx("div",{className:"p-3 bg-dark-bgSecondary",children:bn.jsx(kM,{})})]})]})]})})},MM=[{title:"Navigation",shortcuts:[{keys:"Arrow Up/Down",action:"Move cursor up/down"},{keys:"Arrow Left/Right",action:"Move cursor left/right"},{keys:"Tab / Shift+Tab",action:"Next/prev channel"},{keys:"PageUp / PageDown",action:"Jump 16 rows"},{keys:"Home / End",action:"Jump to first/last row"},{keys:"F9-F12",action:"Jump to 0%/25%/50%/75%"},{keys:"Shift+Arrow L/R",action:"Prev/next pattern"},{keys:"Alt+Q-I",action:"Jump to tracks 0-7"},{keys:"Alt+A-K",action:"Jump to tracks 8-15"}]},{title:"Playback",shortcuts:[{keys:"Space",action:"Stop / toggle edit mode"},{keys:"Right Shift",action:"Record + play pattern"},{keys:"Right Ctrl",action:"Play song"},{keys:"Right Alt",action:"Play pattern"},{keys:"Ctrl+Enter",action:"Play song"}]},{title:"Note Entry",shortcuts:[{keys:"Z-M (bottom row)",action:"Notes C-B (lower octave)"},{keys:"Q-P (top row)",action:"Notes C-E (upper octave)"},{keys:"F1-F7",action:"Select octave 1-7"},{keys:"Numpad +/-",action:"Octave up/down"},{keys:"CapsLock",action:"Note off"},{keys:"` / ~",action:"Edit step +1 / -1"}]},{title:"Editing",shortcuts:[{keys:"Delete",action:"Delete at cursor"},{keys:"Shift+Delete",action:"Delete entire cell"},{keys:"Backspace",action:"Delete previous & move up"},{keys:"Insert",action:"Insert row / toggle insert mode"},{keys:"Shift+Insert",action:"Insert entire line"}]},{title:"Block Operations",shortcuts:[{keys:"Alt+B / Alt+E",action:"Mark block start/end"},{keys:"Ctrl+C / Ctrl+X",action:"Copy / Cut"},{keys:"Ctrl+V",action:"Paste"},{keys:"Ctrl+Shift+V",action:"Mix paste (fill empty)"},{keys:"Ctrl+Shift+F",action:"Flood paste (to end)"},{keys:"F3 / F4 / F5",action:"Cut / Copy / Paste (FT2)"},{keys:"Alt+Arrow keys",action:"Extend selection"}]},{title:"Transpose",shortcuts:[{keys:"Ctrl+Up/Down",action:"Transpose 1 semitone"},{keys:"Ctrl+Shift+Up/Down",action:"Transpose 1 octave"},{keys:"Alt+T / Alt+Shift+T",action:"Block transpose 1"}]},{title:"Macros & Dialogs",shortcuts:[{keys:"Ctrl+1-8",action:"Recall macro slot"},{keys:"Ctrl+Shift+1-8",action:"Save macro slot"},{keys:"Ctrl+I",action:"Interpolate"},{keys:"Ctrl+H",action:"Humanize"},{keys:"Ctrl+F",action:"Find & Replace"},{keys:"Ctrl+O",action:"Import module"},{keys:"?",action:"This shortcut sheet"}]},{title:"Effect Commands",shortcuts:[{keys:"0xy",action:"Arpeggio"},{keys:"1/2xx",action:"Pitch slide up/down"},{keys:"3xx",action:"Tone portamento"},{keys:"4xy",action:"Vibrato"},{keys:"Axy",action:"Volume slide"},{keys:"Cxx",action:"Set volume (00-40)"},{keys:"Fxx",action:"Speed (01-1F) / BPM (20-FF)"},{keys:"Exy",action:"Extended commands"}]}],NM=({isOpen:e,onClose:t})=>{const n=s.useRef(null),[a,r]=s.useState("");if(s.useEffect(()=>{if(!e)return;const n=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[e,t]),!e)return null;const o=a.toLowerCase(),i=MM.map(e=>({...e,shortcuts:e.shortcuts.filter(e=>e.keys.toLowerCase().includes(o)||e.action.toLowerCase().includes(o))})).filter(e=>e.shortcuts.length>0);return bn.jsx("div",{ref:n,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:t,children:bn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[720px] max-w-[90vw] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-neutral-700",children:[bn.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"Keyboard Shortcuts"}),bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("input",{type:"text",placeholder:"Filter...",value:a,onChange:e=>r(e.target.value),className:"bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 w-32 focus:outline-none focus:border-blue-500",autoFocus:!0,"aria-label":"Filter keyboard shortcuts"}),bn.jsx("button",{onClick:t,className:"text-neutral-400 hover:text-neutral-200 transition-colors",children:bn.jsx(Te,{size:18})})]})]}),bn.jsx("div",{className:"overflow-y-auto p-5",children:bn.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(e=>bn.jsxs("div",{className:"space-y-1",children:[bn.jsx("h3",{className:"text-xs font-bold text-blue-400 uppercase tracking-wide mb-2",children:e.title}),e.shortcuts.map((t,n)=>bn.jsxs("div",{className:"flex items-center justify-between gap-2 py-0.5",children:[bn.jsx("kbd",{className:"text-[10px] font-mono bg-neutral-800 border border-neutral-600 rounded px-1.5 py-0.5 text-yellow-300 whitespace-nowrap",children:t.keys}),bn.jsx("span",{className:"text-[11px] text-neutral-300 text-right",children:t.action})]},`${e.title}-${n}`))]},e.title))})}),bn.jsxs("div",{className:"px-5 py-2 border-t border-neutral-700 text-[10px] text-neutral-500 text-center",children:["Press ",bn.jsx("kbd",{className:"bg-neutral-800 border border-neutral-600 rounded px-1 text-yellow-400",children:"Esc"})," to close"," "," | Ctrl/Cmd shown as Ctrl (use Cmd on macOS)"]})]})})},CM={0:{command:"0xy",name:"Arpeggio",description:"Rapidly cycle between note, note+x semitones, note+y semitones",parameters:"x=1st offset (0-F hex), y=2nd offset (0-F hex)",tick:"tick-N",category:"misc"},1:{command:"1xx",name:"Pitch Slide Up",description:"Slide pitch upward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},2:{command:"2xx",name:"Pitch Slide Down",description:"Slide pitch downward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},3:{command:"3xx",name:"Tone Portamento",description:"Slide pitch toward target note",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},4:{command:"4xy",name:"Vibrato",description:"Oscillate pitch up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"pitch"},5:{command:"5xy",name:"Tone Porta + Vol Slide",description:"Continue tone portamento while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},6:{command:"6xy",name:"Vibrato + Vol Slide",description:"Continue vibrato while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},7:{command:"7xy",name:"Tremolo",description:"Oscillate volume up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"volume"},8:{command:"8xx",name:"Set Panning",description:"Set channel panning position",parameters:"xx=position (00=left, 80=center, FF=right)",tick:"tick-0",category:"panning"},9:{command:"9xx",name:"Sample Offset",description:"Start sample playback at offset",parameters:"xx=offset (multiply by 256 samples)",tick:"tick-0",category:"sample"},A:{command:"Axy",name:"Volume Slide",description:"Slide volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"volume"},B:{command:"Bxx",name:"Position Jump",description:"Jump to pattern in order list",parameters:"xx=position (00-FF hex)",tick:"tick-0",category:"global"},C:{command:"Cxx",name:"Set Volume",description:"Set channel volume directly",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"volume"},D:{command:"Dxx",name:"Pattern Break",description:"Break pattern and jump to row in next pattern",parameters:"xx=row (00-3F hex, 0-63 decimal)",tick:"tick-0",category:"global"},E:{command:"Exy",name:"Extended Command",description:"Extended effects (see E-commands)",parameters:"x=sub-command (0-F), y=parameter",tick:"both",category:"misc"},F:{command:"Fxx",name:"Set Speed/BPM",description:"Set speed (01-1F) or BPM (20-FF)",parameters:"xx=speed/BPM (01-1F=speed, 20-FF=BPM)",tick:"tick-0",category:"global"},G:{command:"Gxx",name:"Set Global Volume",description:"Set global volume for all channels",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"global"},H:{command:"Hxy",name:"Global Volume Slide",description:"Slide global volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"global"}},EM={E0:{command:"E0x",name:"Set Filter (Amiga)",description:"Enable/disable Amiga LED filter",parameters:"x=0 (filter on) or 1 (filter off)",tick:"tick-0",category:"misc"},E1:{command:"E1x",name:"Fine Pitch Slide Up",description:"Slide pitch up once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E2:{command:"E2x",name:"Fine Pitch Slide Down",description:"Slide pitch down once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E3:{command:"E3x",name:"Glissando Control",description:"Enable/disable glissando (semitone portamento)",parameters:"x=0 (off) or 1 (on)",tick:"tick-0",category:"pitch"},E4:{command:"E4x",name:"Set Vibrato Waveform",description:"Set vibrato waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"pitch"},E5:{command:"E5x",name:"Set Finetune",description:"Set sample finetune",parameters:"x=finetune (-8 to +7, stored as 0-F)",tick:"tick-0",category:"sample"},E6:{command:"E6x",name:"Pattern Loop",description:"Loop pattern section",parameters:"x=0 (set loop start) or 1-F (loop count)",tick:"tick-0",category:"global"},E7:{command:"E7x",name:"Set Tremolo Waveform",description:"Set tremolo waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"volume"},E8:{command:"E8x",name:"Set Panning (Fine)",description:"Set panning with fine control",parameters:"x=panning (0=left, 8=center, F=right)",tick:"tick-0",category:"panning"},E9:{command:"E9x",name:"Retrigger Note",description:"Retrigger note every x ticks",parameters:"x=retrigger rate (1-F ticks)",tick:"tick-N",category:"timing"},EA:{command:"EAx",name:"Fine Volume Slide Up",description:"Slide volume up once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EB:{command:"EBx",name:"Fine Volume Slide Down",description:"Slide volume down once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EC:{command:"ECx",name:"Note Cut",description:"Cut note (set volume to 0) at tick x",parameters:"x=tick to cut (0=immediate, 1-F=delayed)",tick:"both",category:"timing"},ED:{command:"EDx",name:"Note Delay",description:"Delay note trigger by x ticks",parameters:"x=delay in ticks (0-F)",tick:"tick-N",category:"timing"},EE:{command:"EEx",name:"Pattern Delay",description:"Delay pattern by x rows",parameters:"x=rows to delay (0-F)",tick:"tick-0",category:"global"},EF:{command:"EFx",name:"Funk Repeat (Invert Loop)",description:"Invert sample loop at speed x (Amiga)",parameters:"x=invert speed (0-F)",tick:"tick-N",category:"sample"}},PM={10:{command:"10xx",name:"Set LFO Speed",description:"Set the LFO speed for FM chip vibrato/tremolo",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set TL (Total Level)",description:"Set operator total level (volume)",parameters:"xx=TL value (00-7F, lower=louder)",tick:"tick-0",category:"volume"},12:{command:"12xx",name:"Set AR (Attack Rate)",description:"Set operator attack rate",parameters:"xx=AR value (00-1F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set DR (Decay Rate)",description:"Set operator decay rate",parameters:"xx=DR value (00-1F)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set MULT (Multiplier)",description:"Set operator frequency multiplier",parameters:"xx=MULT value (00-0F)",tick:"tick-0",category:"pitch"},15:{command:"15xx",name:"Set RR (Release Rate)",description:"Set operator release rate",parameters:"xx=RR value (00-0F)",tick:"tick-0",category:"misc"},16:{command:"16xx",name:"Set SL (Sustain Level)",description:"Set operator sustain level",parameters:"xx=SL value (00-0F)",tick:"tick-0",category:"volume"},17:{command:"17xx",name:"Set DT (Detune)",description:"Set operator detune",parameters:"xx=DT value (00-07)",tick:"tick-0",category:"pitch"},18:{command:"18xx",name:"Set SSG-EG",description:"Set SSG envelope generator mode",parameters:"xx=SSG-EG mode (00-0F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"Set Algorithm",description:"Set FM algorithm (operator routing)",parameters:"xx=algorithm (00-07)",tick:"tick-0",category:"misc"},"1A":{command:"1Axx",name:"Set Feedback",description:"Set operator 1 feedback level",parameters:"xx=feedback (00-07)",tick:"tick-0",category:"misc"},"1B":{command:"1Bxy",name:"Set AM/PM Depth",description:"Set amplitude/phase modulation depth",parameters:"x=AM depth (0-3), y=PM depth (0-7)",tick:"tick-0",category:"misc"},"1C":{command:"1Cxx",name:"FM Hard Reset",description:"Force hard reset on note (key-off before key-on)",parameters:"xx=01 (enable), 00 (disable)",tick:"tick-0",category:"misc"}},TM={10:{command:"10xx",name:"Set Filter Cutoff",description:"Set SID filter cutoff frequency",parameters:"xx=cutoff (00-FF, 11-bit scaled)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Filter Resonance",description:"Set SID filter resonance",parameters:"xx=resonance (00-0F)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Filter Mode",description:"Set SID filter mode",parameters:"xx: 0=off, 1=LP, 2=BP, 4=HP (can combine)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Ring Mod",description:"Enable/disable ring modulation",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Hard Sync",description:"Enable/disable oscillator hard sync",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pulse Width",description:"Set pulse wave width",parameters:"xx=pulse width (00-FF, scaled to 12-bit)",tick:"tick-0",category:"misc"}},AM={11:{command:"11xx",name:"Set DMC",description:"Set DMC sample parameters",parameters:"xx=DMC control value",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty/Noise",description:"Set pulse duty or noise mode",parameters:"xx: pulse 0-3=duty, noise 0=short 1=long",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (pulse channels)",parameters:"x=period, y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Envelope Mode",description:"Set envelope/length counter mode",parameters:"xx=envelope settings",tick:"tick-0",category:"misc"},18:{command:"18xx",name:"FDS Mod Depth",description:"Set FDS modulation depth",parameters:"xx=mod depth (00-3F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"FDS Mod Speed High",description:"Set FDS modulation speed (high byte)",parameters:"xx=speed high byte",tick:"tick-0",category:"misc"}},IM={10:{command:"10xx",name:"Set Envelope Shape",description:"Set AY envelope shape",parameters:"xx=shape (00-0F)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Envelope Period Low",description:"Set AY envelope period (low byte)",parameters:"xx=period low byte",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Envelope Period High",description:"Set AY envelope period (high byte)",parameters:"xx=period high byte",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Auto-Envelope",description:"Enable auto-envelope (track note pitch)",parameters:"xx=auto-envelope numerator",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Noise Freq",description:"Set noise frequency",parameters:"xx=noise period (00-1F)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Noise Mode",description:"Set noise/tone mixing mode",parameters:"xx=mode bits (tone/noise enable)",tick:"tick-0",category:"misc"}},_M={10:{command:"10xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Wave Position",description:"Set wave position in RAM",parameters:"xx=position (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave Length",description:"Set wave length",parameters:"xx=length (must be power of 2)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Wave Load",description:"Load wave from position",parameters:"xx=load parameters",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Channel Limit",description:"Set max active channels (N163)",parameters:"xx=channel count (1-8)",tick:"tick-0",category:"misc"}},OM={10:{command:"10xx",name:"Set Sample Mode",description:"Set sample playback mode",parameters:"xx=mode (chip-specific)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Sample Bank",description:"Set sample bank",parameters:"xx=bank number",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Direction",description:"Set sample playback direction",parameters:"xx: 0=forward, 1=reverse",tick:"tick-0",category:"sample"},20:{command:"20xx",name:"ES5506 Filter Mode",description:"Set ES5506 filter mode",parameters:"xx=filter mode (00-03)",tick:"tick-0",category:"misc"},21:{command:"21xx",name:"ES5506 Filter K1",description:"Set ES5506 filter K1 coefficient",parameters:"xx=K1 value",tick:"tick-0",category:"misc"},22:{command:"22xx",name:"ES5506 Filter K2",description:"Set ES5506 filter K2 coefficient",parameters:"xx=K2 value",tick:"tick-0",category:"misc"},30:{command:"30xx",name:"QSound Echo",description:"Set QSound echo feedback",parameters:"xx=echo feedback",tick:"tick-0",category:"misc"},31:{command:"31xx",name:"QSound Surround",description:"Set QSound surround/3D position",parameters:"xx=surround position",tick:"tick-0",category:"panning"}},FM={FurnaceOPN:PM,FurnaceOPN2:PM,FurnaceOPM:PM,FurnaceOPL:PM,FurnaceOPL2:PM,FurnaceOPL3:PM,FurnaceOPLL:PM,FurnaceOPZ:PM,FurnaceESFM:PM,FurnaceC64:TM,FurnaceSID2:TM,FurnaceSID3:TM,FurnaceGB:{10:{command:"10xx",name:"Set Envelope",description:"Set volume envelope (NRx2 register)",parameters:"xx: high nibble=volume, low nibble=direction+period",tick:"tick-0",category:"volume"},11:{command:"11xx",name:"Set Wave",description:"Load wavetable into wave channel",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty",description:"Set pulse wave duty cycle",parameters:"xx: 0=12.5%, 1=25%, 2=50%, 3=75%",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (channel 1 only)",parameters:"x=period (0-7), y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Noise Mode",description:"Set noise channel width mode",parameters:"xx: 0=15-bit (normal), 1=7-bit (metallic)",tick:"tick-0",category:"misc"}},FurnaceNES:AM,FurnaceFDS:AM,FurnaceVRC6:AM,Furnace5E01:AM,FurnacePCE:{10:{command:"10xx",name:"Set LFO Mode",description:"Set PCE LFO mode",parameters:"xx=LFO mode (00-03)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set LFO Speed",description:"Set PCE LFO speed",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"}},FurnaceAY:IM,FurnaceAY8930:IM,FurnaceSAA:IM,FurnaceSMS:IM,FurnaceT6W28:IM,FurnaceN163:_M,FurnaceSCC:_M,FurnaceVB:_M,FurnaceSWAN:_M,FurnaceX1_010:_M,FurnaceSNES:{10:{command:"10xx",name:"Set Echo Enable",description:"Enable/disable echo for channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Echo Delay",description:"Set echo delay time",parameters:"xx=delay (00-0F, 16ms steps)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Echo Feedback",description:"Set echo feedback amount",parameters:"xx=feedback (-80 to 7F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Echo Volume",description:"Set echo volume",parameters:"xx=volume (-80 to 7F)",tick:"tick-0",category:"volume"},14:{command:"14xx",name:"Set Echo FIR",description:"Set echo FIR filter coefficient",parameters:"xx=coefficient index and value",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pitch Mod",description:"Enable pitch modulation from prev channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"pitch"},16:{command:"16xx",name:"Set Gain Mode",description:"Set ADSR/gain mode",parameters:"xx=gain mode (see SNES docs)",tick:"tick-0",category:"misc"},17:{command:"17xx",name:"Set Invert",description:"Invert waveform phase",parameters:"xx: 1=left, 2=right, 3=both",tick:"tick-0",category:"misc"}},FurnaceAmiga:OM,FurnaceSEGAPCM:OM,FurnaceQSOUND:OM,FurnaceES5506:OM,FurnaceRF5C68:OM,FurnaceC140:OM,FurnaceC219:OM,FurnaceK054539:OM,FurnaceYMZ280B:OM,FurnaceGA20:OM,FurnaceK007232:OM,FurnaceK053260:OM,FurnaceOKI:OM};const DM={pitch:"Pitch",volume:"Volume",panning:"Panning",timing:"Timing",global:"Global",sample:"Sample",misc:"Misc",chip:"Chip"},RM=["pitch","volume","panning","timing","global","sample","misc"],jM={pitch:"text-blue-400",volume:"text-emerald-400",panning:"text-purple-400",timing:"text-yellow-400",global:"text-red-400",sample:"text-cyan-400",misc:"text-orange-400",chip:"text-pink-400"},LM=({isOpen:e,position:t,onSelect:n,onClose:a,synthType:r})=>{const[o,i]=s.useState(""),[l,c]=s.useState("all"),d=s.useRef(null),u=s.useRef(null);s.useEffect(()=>{e&&u.current&&u.current.focus()},[e]),s.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&(e.preventDefault(),a())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,a]);const p=r&&function(e){return e.startsWith("Furnace")||e in FM}(r),h=s.useMemo(()=>{const e=[];if(Object.entries(CM).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!1,isFurnace:!1})}),Object.entries(EM).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!0,isFurnace:!1})}),p&&r){const t=function(e){return e&&FM[e]?Object.values(FM[e]):Object.values(PM)}(r);t.forEach(t=>{const n=t.command.substring(0,2);e.push({...t,key:n,isExtended:!1,isFurnace:!0,category:"misc"})})}return e},[p,r]),m=s.useMemo(()=>{const e=o.toLowerCase();return h.filter(t=>{if("chip"===l){if(!t.isFurnace)return!1}else if("all"!==l){if(t.isFurnace)return!1;if(t.category!==l)return!1}return!o||(t.name.toLowerCase().includes(e)||t.command.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))})},[h,o,l]);if(!e)return null;const f=t?{position:"fixed",left:Math.max(0,Math.min(t.x,window.innerWidth-400)),top:Math.max(0,Math.min(t.y,window.innerHeight-500)),zIndex:60}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:60};return bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"fixed inset-0 bg-black/40 z-50",onClick:a}),bn.jsxs("div",{ref:d,className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[380px] max-h-[480px] flex flex-col z-[60]",style:f,children:[bn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[bn.jsx("h3",{className:"text-sm font-semibold text-neutral-100",children:"Effect Commands"}),bn.jsx("button",{onClick:a,className:"text-neutral-400 hover:text-neutral-200","aria-label":"Close effect picker",children:bn.jsx(Te,{size:16})})]}),bn.jsx("div",{className:"px-3 py-2 border-b border-neutral-800",children:bn.jsx("input",{ref:u,type:"text",placeholder:"Search effects...",value:o,onChange:e=>i(e.target.value),className:"w-full bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 focus:outline-none focus:border-blue-500","aria-label":"Search effects"})}),bn.jsxs("div",{className:"flex flex-wrap gap-1 px-3 py-1.5 border-b border-neutral-800",children:[bn.jsx("button",{onClick:()=>c("all"),className:"px-2 py-0.5 text-[10px] rounded "+("all"===l?"bg-neutral-700 text-white":"text-neutral-400 hover:text-neutral-200"),children:"All"}),RM.map(e=>bn.jsx("button",{onClick:()=>c(e),className:"px-2 py-0.5 text-[10px] rounded "+(l===e?"bg-neutral-700 text-white":`${jM[e]} hover:opacity-80`),children:DM[e]},e)),p&&bn.jsxs("button",{onClick:()=>c("chip"),className:"px-2 py-0.5 text-[10px] rounded "+("chip"===l?"bg-pink-700 text-white":`${jM.chip} hover:opacity-80`),children:[DM.chip," (",r?.replace("Furnace",""),")"]})]}),bn.jsx("div",{className:"overflow-y-auto flex-1 p-1",children:0===m.length?bn.jsx("div",{className:"text-center text-neutral-500 text-xs py-4",children:"No effects match"}):m.map(e=>{const t=e.isFurnace?jM.chip:jM[e.category];return bn.jsxs("button",{onClick:()=>(e=>{if(e.isExtended){const t=parseInt(e.key.substring(1),16);n(14,t<<4)}else if(e.isFurnace){const t=parseInt(e.key,16);n(t,0)}else{const t=parseInt(e.key,16);n(t,0)}a()})(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-800 transition-colors text-left group",children:[bn.jsx("span",{className:`font-mono text-xs font-bold w-8 ${t}`,children:e.command.substring(0,3)}),bn.jsxs("div",{className:"flex-1 min-w-0",children:[bn.jsxs("div",{className:"text-xs text-neutral-200 truncate",children:[e.name,e.isFurnace&&bn.jsx("span",{className:"ml-1 text-[9px] text-pink-400",children:"(Chip)"})]}),bn.jsx("div",{className:"text-[10px] text-neutral-500 truncate",children:e.description})]}),bn.jsx("span",{className:"text-[9px] text-neutral-600 group-hover:text-neutral-400",children:"tick-0"===e.tick?"T0":"tick-N"===e.tick?"TN":"T*"})]},e.isFurnace?`f-${e.key}`:e.isExtended?`e-${e.key}`:`n-${e.key}`)})})]})]})},BM={"text-blue-400":"bg-blue-400","text-green-400":"bg-green-400","text-yellow-400":"bg-yellow-400","text-red-400":"bg-red-400","text-purple-400":"bg-purple-400","text-orange-400":"bg-orange-400","text-cyan-400":"bg-cyan-400","text-neutral-400":"bg-neutral-400"},VM=e=>BM[e]||"bg-neutral-400",zM=({isOpen:e,onClose:t})=>{const{undoStack:n,redoStack:a,undo:s,redo:r}=$f();if(!e)return null;const o=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return bn.jsxs("div",{className:"absolute right-0 top-0 w-64 h-full bg-neutral-900 border-l border-neutral-700 flex flex-col z-30 shadow-xl",children:[bn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(Dt,{size:14,className:"text-neutral-400"}),bn.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"History"})]}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx("button",{onClick:s,disabled:0===n.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Undo","aria-label":"Undo",children:bn.jsx(Rt,{size:12,className:"text-neutral-400"})}),bn.jsx("button",{onClick:r,disabled:0===a.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Redo","aria-label":"Redo",children:bn.jsx(jt,{size:12,className:"text-neutral-400"})}),bn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors text-xs","aria-label":"Close history panel",children:"x"})]})]}),bn.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a.length>0&&bn.jsxs("div",{className:"opacity-40",children:[bn.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Redo (",a.length,")"]}),[...a].reverse().map((e,t)=>bn.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>r(),title:"Redo one step",children:[bn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${VM(Yf(e.type))}`}),bn.jsx("div",{className:"flex-1 min-w-0",children:bn.jsx("div",{className:"text-[10px] text-neutral-400 truncate",children:qf(e.type)})}),bn.jsx("span",{className:"text-[9px] text-neutral-600",children:o(e.timestamp)})]},`redo-${e.id}-${t}`))]}),bn.jsx("div",{className:"px-3 py-1 bg-blue-900/30 border-y border-blue-800/50",children:bn.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"Current State"})}),n.length>0?bn.jsxs("div",{children:[bn.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Undo (",n.length,")"]}),[...n].reverse().map((e,t)=>bn.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>s(),title:"Undo one step",children:[bn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${VM(Yf(e.type))}`}),bn.jsxs("div",{className:"flex-1 min-w-0",children:[bn.jsx("div",{className:"text-[10px] text-neutral-300 truncate",children:qf(e.type)}),e.description&&bn.jsx("div",{className:"text-[9px] text-neutral-500 truncate",children:e.description})]}),bn.jsx("span",{className:"text-[9px] text-neutral-600",children:o(e.timestamp)})]},`undo-${e.id}-${t}`))]}):bn.jsx("div",{className:"text-center text-neutral-600 text-xs py-8",children:"No history yet"})]}),bn.jsx("div",{className:"px-3 py-1.5 border-t border-neutral-700 text-[9px] text-neutral-600 text-center",children:"Ctrl+Z undo | Ctrl+Y redo"})]})},UM=({isOpen:e,onClose:t})=>{const{patterns:n,patternOrder:a,currentPositionIndex:r,setCurrentPosition:o,addToOrder:i,removeFromOrder:l}=cm(On(e=>({patterns:e.patterns,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,addToOrder:e.addToOrder,removeFromOrder:e.removeFromOrder}))),c=s.useCallback(e=>{o(e)},[o]),d=s.useCallback(()=>{i(0)},[i]),u=s.useCallback(e=>{a.length>1&&l(e)},[l,a.length]),p=s.useCallback((e,t)=>{cm.setState(n=>{const a=[...n.patternOrder];return a[e]=t,{patternOrder:a}})},[]);return e?bn.jsxs("div",{className:"absolute left-0 top-0 w-56 h-full bg-neutral-900 border-r border-neutral-700 flex flex-col z-30 shadow-xl",children:[bn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[bn.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"Pattern Matrix"}),bn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors",children:bn.jsx(Te,{size:14})})]}),bn.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:bn.jsxs("table",{className:"w-full border-collapse",children:[bn.jsx("thead",{children:bn.jsxs("tr",{children:[bn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pos"}),bn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pattern"}),bn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-right",children:"Len"}),bn.jsx("th",{className:"w-6"})]})}),bn.jsx("tbody",{children:a.map((e,t)=>{const s=t===r,o=n[e];return bn.jsxs("tr",{className:"cursor-pointer transition-colors "+(s?"bg-blue-900/40 text-blue-300":"hover:bg-neutral-800 text-neutral-300"),onClick:()=>c(t),children:[bn.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-neutral-500",children:t.toString(16).toUpperCase().padStart(2,"0")}),bn.jsx("td",{className:"px-1 py-0.5",children:bn.jsx("select",{value:e,onChange:e=>{e.stopPropagation(),p(t,parseInt(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-full bg-transparent text-[10px] font-mono cursor-pointer focus:outline-none "+(s?"text-blue-300":"text-neutral-300"),children:n.map((e,t)=>bn.jsxs("option",{value:t,className:"bg-neutral-900 text-neutral-200",children:[t.toString(16).toUpperCase().padStart(2,"0"),n[t]?.name?` ${n[t].name}`:""]},t))})}),bn.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-right text-neutral-500",children:o?.length||"?"}),bn.jsx("td",{className:"px-0.5 py-0.5",children:bn.jsx("button",{onClick:e=>{e.stopPropagation(),u(t)},className:"p-0.5 rounded hover:bg-red-900/50 text-neutral-600 hover:text-red-400 transition-colors",title:"Remove position",disabled:a.length<=1,children:bn.jsx(Te,{size:10})})})]},t)})})]})}),bn.jsxs("div",{className:"px-3 py-2 border-t border-neutral-700 flex items-center justify-between",children:[bn.jsxs("span",{className:"text-[9px] text-neutral-500",children:[a.length," positions | ",n.length," patterns"]}),bn.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-[10px] bg-neutral-800 hover:bg-neutral-700 text-neutral-300 rounded transition-colors",children:[bn.jsx(Qe,{size:10}),"Add"]})]})]}):null},GM=({label:e,value:t,onChange:n,min:a=0,max:r=999,step:o=1,format:i="decimal",throttleMs:l=0,presets:c})=>{const d=s.useRef(null),u=s.useRef(null),p=s.useRef(t),h=s.useRef(0),m=s.useRef(null),[f,y]=s.useState(!1),[g,v]=s.useState({x:0,y:0});s.useEffect(()=>{p.current=t},[t]),s.useEffect(()=>()=>{d.current&&clearInterval(d.current),u.current&&clearTimeout(u.current)},[]),s.useEffect(()=>{if(!f)return;const e=e=>{m.current&&!m.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const b=s.useCallback(e=>{c&&0!==c.length&&(e.preventDefault(),v({x:e.clientX,y:e.clientY}),y(!0))},[c]),x=s.useCallback(e=>{n(e),y(!1)},[n]),w=s.useCallback(e=>{const t=Date.now();l>0&&t-h.current<l||(h.current=t,n(e))},[n,l]),k=s.useCallback(()=>{const e=Math.min(r,p.current+o);p.current=e,w(e)},[r,o,w]),S=s.useCallback(()=>{const e=Math.max(a,p.current-o);p.current=e,w(e)},[a,o,w]),M=s.useCallback(e=>{e(),u.current&&clearTimeout(u.current),d.current&&clearInterval(d.current),u.current=window.setTimeout(()=>{d.current=window.setInterval(e,80)},300)},[]),N=s.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null),d.current&&(clearInterval(d.current),d.current=null)},[]);return bn.jsxs("div",{ref:m,className:"ft2-numeric-group",onContextMenu:b,title:c?"Right-click for presets":void 0,children:[bn.jsxs("span",{className:"ft2-numeric-label",children:[e,":"]}),bn.jsx("span",{className:"ft2-numeric-value",children:(C=t,"hex"===i?C.toString(16).toUpperCase().padStart(2,"0"):C.toString().padStart(3,"0"))}),bn.jsxs("div",{className:"ft2-numeric-arrows",children:[bn.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>M(k),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(k),onTouchEnd:N,title:`Increase ${e}`,children:bn.jsx("span",{className:"ft2-arrow-icon",children:""})}),bn.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>M(S),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(S),onTouchEnd:N,title:`Decrease ${e}`,children:bn.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),f&&c&&bn.jsx("div",{className:"ft2-presets-menu",style:{position:"fixed",left:g.x,top:g.y,zIndex:1e3,backgroundColor:"#1a1a1d",border:"1px solid #333",borderRadius:"4px",padding:"4px 0",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",minWidth:"100px"},children:c.map(e=>bn.jsx("button",{onClick:()=>x(e.value),className:"ft2-preset-item",style:{display:"block",width:"100%",padding:"6px 12px",textAlign:"left",background:t===e.value?"#333":"transparent",border:"none",color:t===e.value?"#ef4444":"#e0e0e0",cursor:"pointer",fontSize:"12px",fontFamily:"monospace"},onMouseEnter:e=>e.currentTarget.style.background="#2a2a2d",onMouseLeave:n=>n.currentTarget.style.background=t===e.value?"#333":"transparent",children:e.label},e.value))})]});var C},KM={TB303:{type:"TB303",name:"TB-303",shortName:"303",description:"Classic acid bass synthesizer with resonant filter and slide",bestFor:["Acid bass","Squelchy lines","Techno","House"],icon:"Zap",color:"text-accent-primary"},MonoSynth:{type:"MonoSynth",name:"Mono Synth",shortName:"Mono",description:"Single-voice synth with oscillator, filter, and envelope",bestFor:["Bass","Lead lines","Portamento"],icon:"AudioLines",color:"text-blue-400"},Synth:{type:"Synth",name:"Basic Synth",shortName:"Synth",description:"Simple polyphonic synthesizer with amplitude envelope",bestFor:["Pads","Chords","Simple sounds"],icon:"Music2",color:"text-purple-400"},DuoSynth:{type:"DuoSynth",name:"Duo Synth",shortName:"Duo",description:"Two-voice synth with harmonics and vibratoesque LFO",bestFor:["Rich leads","Detuned sounds","Fat bass"],icon:"Layers",color:"text-indigo-400"},FMSynth:{type:"FMSynth",name:"FM Synth",shortName:"FM",description:"Frequency modulation synth for complex harmonic tones",bestFor:["Bells","Electric piano","Metallic sounds"],icon:"Radio",color:"text-cyan-400"},AMSynth:{type:"AMSynth",name:"AM Synth",shortName:"AM",description:"Amplitude modulation synth with ring modulation character",bestFor:["Tremolo effects","Ring mod","Atmospheric"],icon:"Activity",color:"text-teal-400"},PluckSynth:{type:"PluckSynth",name:"Pluck Synth",shortName:"Pluck",description:"Karplus-Strong string synthesis for plucked strings",bestFor:["Guitar","Harp","Pizzicato","String plucks"],icon:"Guitar",color:"text-amber-400"},MembraneSynth:{type:"MembraneSynth",name:"Membrane Synth",shortName:"Membrane",description:"Drum membrane simulation for kicks and toms",bestFor:["Kick drums","Toms","Percussion"],icon:"Circle",color:"text-orange-400"},MetalSynth:{type:"MetalSynth",name:"Metal Synth",shortName:"Metal",description:"Metallic percussion synthesis with harmonics",bestFor:["Hi-hats","Cymbals","Bells","Metallic hits"],icon:"Hexagon",color:"text-yellow-400"},NoiseSynth:{type:"NoiseSynth",name:"Noise Synth",shortName:"Noise",description:"Filtered noise generator with envelope",bestFor:["Snares","Hi-hats","Risers","FX"],icon:"Hash",color:"text-gray-400"},Wavetable:{type:"Wavetable",name:"Wavetable",shortName:"Wave",description:"Wavetable synth with morphing and unison",bestFor:["Evolving pads","Modern bass","Complex timbres"],icon:"Waves",color:"text-pink-400"},Sampler:{type:"Sampler",name:"Sampler",shortName:"Sampler",description:"Multi-sample playback with velocity layers",bestFor:["Realistic instruments","Sample kits","One-shots"],icon:"FileAudio",color:"text-rose-400"},Player:{type:"Player",name:"Sample Player",shortName:"Player",description:"Simple one-shot sample playback",bestFor:["Loops","One-shots","Vocal samples"],icon:"Play",color:"text-lime-400"},GranularSynth:{type:"GranularSynth",name:"Granular Synth",shortName:"Granular",description:"Sample-based granular synthesis with grain manipulation",bestFor:["Textures","Pads","Ambient","Sound design","Glitch"],icon:"Sparkles",color:"text-violet-400"},SuperSaw:{type:"SuperSaw",name:"SuperSaw",shortName:"SSaw",description:"Massive detuned saw waves for trance and EDM",bestFor:["Trance leads","EDM drops","Big chords","Supersaw stabs"],icon:"Layers",color:"text-orange-500"},PolySynth:{type:"PolySynth",name:"Poly Synth",shortName:"Poly",description:"True polyphonic synth with voice management",bestFor:["Chords","Pads","Polyphonic parts","Layered sounds"],icon:"LayoutGrid",color:"text-blue-500"},Organ:{type:"Organ",name:"Drawbar Organ",shortName:"Organ",description:"Hammond-style tonewheel organ with drawbars",bestFor:["House","Gospel","Jazz","Rock organ"],icon:"Piano",color:"text-amber-600"},DrumMachine:{type:"DrumMachine",name:"Roland TR-808/909",shortName:"808/909",description:"Analog drum synthesis (808/909 style)",bestFor:["Kicks","Snares","Hi-hats","Electronic drums"],icon:"Disc",color:"text-red-500"},ChipSynth:{type:"ChipSynth",name:"Chip Synth",shortName:"Chip",description:"8-bit video game console sounds",bestFor:["Chiptune","Retro","Lo-fi","Arpeggios"],icon:"Gamepad2",color:"text-green-400"},PWMSynth:{type:"PWMSynth",name:"PWM Synth",shortName:"PWM",description:"Pulse width modulation for rich analog tones",bestFor:["Analog pads","Warm leads","Classic synth"],icon:"Waves",color:"text-emerald-400"},StringMachine:{type:"StringMachine",name:"String Machine",shortName:"Strings",description:"Vintage ensemble strings (Solina-style)",bestFor:["Lush pads","Disco strings","Ambient","Retro"],icon:"Music4",color:"text-rose-400"},FormantSynth:{type:"FormantSynth",name:"Formant Synth",shortName:"Vocal",description:"Vowel synthesis for vocal-like sounds",bestFor:["Vocal pads","Talk box","Choir","Robotic"],icon:"Mic",color:"text-fuchsia-400"},Furnace:{type:"Furnace",name:"Furnace FM",shortName:"FUI",description:"FM engine compatible with Furnace Tracker (.fui) instruments",bestFor:["Genesis bass","FM bells","Retro arcade","4-op FM"],icon:"Cpu",color:"text-amber-500"},FurnaceOPN:{type:"FurnaceOPN",name:"Sega Genesis (YM2612)",shortName:"Genesis",description:"Sega Genesis / Mega Drive YM2612 - 6 channels of 4-op FM",bestFor:["Genesis bass","FM leads","Slap bass","16-bit game music"],icon:"Gamepad2",color:"text-blue-500"},FurnaceOPM:{type:"FurnaceOPM",name:"Arcade / X68000 (YM2151)",shortName:"OPM",description:"Yamaha YM2151 - Sharp X68000, arcade machines",bestFor:["Arcade FM","Bright leads","Brass","Game music"],icon:"Cpu",color:"text-cyan-500"},FurnaceOPL:{type:"FurnaceOPL",name:"AdLib / Sound Blaster (OPL3)",shortName:"OPL3",description:"Yamaha YMF262 - AdLib, Sound Blaster, DOS games",bestFor:["DOS game music","MIDI synth","Organs","PC gaming"],icon:"Monitor",color:"text-yellow-500"},FurnaceOPLL:{type:"FurnaceOPLL",name:"MSX / Sega (OPLL)",shortName:"OPLL",description:"Yamaha YM2413 - MSX, SMS FM unit, budget FM",bestFor:["MSX music","SMS FM","Lo-fi FM","Simple FM"],icon:"Radio",color:"text-orange-400"},FurnaceESFM:{type:"FurnaceESFM",name:"ESFM",shortName:"ESFM",description:"Enhanced Sound FM - advanced OPL3 with operator detune",bestFor:["Modern retro","Enhanced FM","Detuned sounds"],icon:"Zap",color:"text-purple-500"},FurnaceOPZ:{type:"FurnaceOPZ",name:"Yamaha TX81Z (OPZ)",shortName:"OPZ",description:"Yamaha YM2414 - TX81Z, DX11, advanced FM",bestFor:["Lately bass","DX bells","Complex FM","E-piano"],icon:"Piano",color:"text-indigo-500"},FurnaceNES:{type:"FurnaceNES",name:"Nintendo NES (2A03)",shortName:"NES",description:"Nintendo Entertainment System - 2 pulse, triangle, noise, DPCM",bestFor:["NES chiptune","8-bit melodies","Retro drums","Famicom"],icon:"Gamepad2",color:"text-red-500"},FurnaceGB:{type:"FurnaceGB",name:"Nintendo Game Boy",shortName:"GB",description:"Nintendo Game Boy - 2 pulse, wave, noise channels",bestFor:["Game Boy music","Lo-fi chiptune","Portable gaming"],icon:"Smartphone",color:"text-green-500"},FurnaceC64:{type:"FurnaceC64",name:"Commodore 64 (SID)",shortName:"SID",description:"Commodore 64 SID chip - 3 voices with filters",bestFor:["SID leads","Arpeggios","Filter sweeps","Demoscene"],icon:"Terminal",color:"text-violet-500"},FurnaceAY:{type:"FurnaceAY",name:"ZX Spectrum / Amstrad (AY)",shortName:"AY",description:"General Instrument AY - ZX Spectrum, MSX, Atari ST",bestFor:["ZX Spectrum","MSX","Amstrad CPC","Envelope tricks"],icon:"Tv",color:"text-sky-500"},FurnaceTIA:{type:"FurnaceTIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 - primitive but distinctive sound",bestFor:["Atari 2600","Primitive bleeps","Retro FX"],icon:"Joystick",color:"text-amber-600"},FurnaceVERA:{type:"FurnaceVERA",name:"Commander X16 (VERA)",shortName:"VERA",description:"Commander X16 - modern retro 16 channels PSG + PCM",bestFor:["Modern retro","X16 music","Rich PSG"],icon:"Cpu",color:"text-teal-500"},FurnaceSAA:{type:"FurnaceSAA",name:"SAM Coup (SAA1099)",shortName:"SAA",description:"Philips SAA1099 - Sam Coup, some PC sound cards",bestFor:["Sam Coup","Stereo chips","European home computers"],icon:"Speaker",color:"text-pink-500"},FurnacePSG:{type:"FurnacePSG",name:"Sega Master System (PSG)",shortName:"PSG",description:"TI SN76489 - Master System, Game Gear, BBC Micro",bestFor:["Master System","Colecovision","Square wave PSG"],icon:"SquareStack",color:"text-emerald-500"},FurnaceVIC:{type:"FurnaceVIC",name:"Commodore VIC-20",shortName:"VIC",description:"Commodore VIC-20 - 3 square + noise",bestFor:["VIC-20 music","Early 80s","Simple tones"],icon:"Monitor",color:"text-lime-500"},FurnaceLynx:{type:"FurnaceLynx",name:"Atari Lynx",shortName:"Lynx",description:"Atari Lynx - 4 channel wavetable",bestFor:["Lynx music","Portable gaming","Wavetable"],icon:"Gamepad",color:"text-rose-500"},FurnaceSID6581:{type:"FurnaceSID6581",name:"SID 6581",shortName:"6581",description:"Classic C64 SID - warm, gritty original chip",bestFor:["Authentic C64","Warm bass","Classic demoscene"],icon:"Terminal",color:"text-violet-400"},FurnaceSID8580:{type:"FurnaceSID8580",name:"SID 8580",shortName:"8580",description:"Revised SID - cleaner filter, brighter sound",bestFor:["Clean SID","Later C64/C128","Clearer filters"],icon:"Terminal",color:"text-violet-600"},FurnaceOPNA:{type:"FurnaceOPNA",name:"NEC PC-98 (OPNA)",shortName:"OPNA",description:"YM2608 - NEC PC-98, arcade machines",bestFor:["PC-98 music","Touhou-style","Japanese arcade"],icon:"Cpu",color:"text-blue-400"},FurnaceOPNB:{type:"FurnaceOPNB",name:"SNK Neo Geo (OPNB)",shortName:"OPNB",description:"YM2610 - SNK Neo Geo",bestFor:["Neo Geo music","Fighting games","SNK"],icon:"Gamepad2",color:"text-red-400"},FurnaceOPL4:{type:"FurnaceOPL4",name:"Yamaha OPL4",shortName:"OPL4",description:"Yamaha YMF278 - FM + wavetable hybrid",bestFor:["Advanced OPL","FM + samples","Late DOS"],icon:"Layers",color:"text-yellow-400"},FurnaceY8950:{type:"FurnaceY8950",name:"MSX-Audio (Y8950)",shortName:"Y8950",description:"Yamaha Y8950 - MSX-Audio, OPL + ADPCM",bestFor:["MSX-Audio","OPL with drums","Japanese PC"],icon:"Radio",color:"text-orange-300"},FurnacePCE:{type:"FurnacePCE",name:"PC Engine / TurboGrafx",shortName:"PCE",description:"PC Engine / TurboGrafx-16 - 6 channel wavetable",bestFor:["PC Engine","TurboGrafx","HuCard games"],icon:"Tv",color:"text-orange-500"},FurnaceSNES:{type:"FurnaceSNES",name:"Super Nintendo (SPC700)",shortName:"SNES",description:"Super Nintendo - Sony SPC700 8-channel BRR",bestFor:["SNES music","16-bit classics","BRR samples"],icon:"Gamepad2",color:"text-purple-400"},FurnaceVB:{type:"FurnaceVB",name:"Nintendo Virtual Boy",shortName:"VB",description:"Nintendo Virtual Boy - 6 channel wavetable",bestFor:["Virtual Boy","Stereo 3D audio","Nintendo VB"],icon:"Glasses",color:"text-red-600"},FurnaceSWAN:{type:"FurnaceSWAN",name:"Bandai WonderSwan",shortName:"SWAN",description:"Bandai WonderSwan - 4 channel wavetable + PCM",bestFor:["WonderSwan","Portable gaming","Bandai"],icon:"Smartphone",color:"text-cyan-400"},FurnaceVRC6:{type:"FurnaceVRC6",name:"Famicom (VRC6)",shortName:"VRC6",description:"Konami VRC6 - 2 pulse + saw (Castlevania 3 JP)",bestFor:["Castlevania 3","Konami NES","Extra channels"],icon:"Zap",color:"text-amber-400"},FurnaceVRC7:{type:"FurnaceVRC7",name:"Famicom (VRC7)",shortName:"VRC7",description:"Konami VRC7 - OPLL clone (Lagrange Point)",bestFor:["Lagrange Point","FM on NES","Konami FM"],icon:"Radio",color:"text-amber-500"},FurnaceN163:{type:"FurnaceN163",name:"Namco Arcade (N163)",shortName:"N163",description:"Namco 163 - 8 channel wavetable",bestFor:["Namco NES","Wavetable","Complex tones"],icon:"Waves",color:"text-green-400"},FurnaceFDS:{type:"FurnaceFDS",name:"Famicom Disk System",shortName:"FDS",description:"Famicom Disk System - wavetable + modulation",bestFor:["FDS games","Wavy bass","Zelda FDS"],icon:"Disc",color:"text-yellow-500"},FurnaceMMC5:{type:"FurnaceMMC5",name:"Famicom (MMC5)",shortName:"MMC5",description:"MMC5 - 2 extra pulse channels",bestFor:["Castlevania 3 US","Extra NES pulse","CV3"],icon:"Plus",color:"text-blue-300"},FurnaceTED:{type:"FurnaceTED",name:"Commodore Plus/4 (TED)",shortName:"TED",description:"Commodore Plus/4 TED - 2 square + noise",bestFor:["Plus/4 music","Commodore 16","Budget C64"],icon:"Monitor",color:"text-violet-400"},FurnaceSEGAPCM:{type:"FurnaceSEGAPCM",name:"Sega Arcade (SegaPCM)",shortName:"SEGAPCM",description:"Sega System 16/18 - 16 channel PCM",bestFor:["OutRun","After Burner","Sega arcade"],icon:"Speaker",color:"text-blue-500"},FurnaceQSOUND:{type:"FurnaceQSOUND",name:"Capcom Arcade (QSound)",shortName:"QSound",description:"Capcom QSound - CPS1/CPS2 with 3D audio",bestFor:["Street Fighter","CPS games","3D positioning"],icon:"Headphones",color:"text-purple-500"},FurnaceES5506:{type:"FurnaceES5506",name:"ES5506",shortName:"ES5506",description:"Ensoniq ES5506 - 32 voice wavetable",bestFor:["Taito F3","Ensoniq synths","High quality"],icon:"AudioLines",color:"text-pink-400"},FurnaceRF5C68:{type:"FurnaceRF5C68",name:"RF5C68",shortName:"RF5C68",description:"Ricoh RF5C68 - Sega CD, 8 channel PCM",bestFor:["Sega CD","Mega CD","CD audio"],icon:"Disc",color:"text-cyan-500"},FurnaceC140:{type:"FurnaceC140",name:"C140",shortName:"C140",description:"Namco C140 - System 2, 24 channel PCM",bestFor:["Namco arcade","System 2","Assault"],icon:"Cpu",color:"text-yellow-400"},FurnaceK007232:{type:"FurnaceK007232",name:"K007232",shortName:"K007232",description:"Konami K007232 - 2 channel PCM",bestFor:["Contra arcade","Konami PCM","TMNT"],icon:"Speaker",color:"text-red-400"},FurnaceK053260:{type:"FurnaceK053260",name:"K053260",shortName:"K053260",description:"Konami K053260 - 4 channel PCM with ADPCM",bestFor:["Sunset Riders","Simpsons","Konami 90s"],icon:"Speaker",color:"text-orange-400"},FurnaceGA20:{type:"FurnaceGA20",name:"GA20",shortName:"GA20",description:"Irem GA20 - 4 channel PCM",bestFor:["R-Type Leo","Irem arcade","In the Hunt"],icon:"Cpu",color:"text-teal-400"},FurnaceOKI:{type:"FurnaceOKI",name:"OKI MSM6295",shortName:"OKI",description:"OKI MSM6295 - 4 channel ADPCM",bestFor:["Neo Geo","Data East","ADPCM drums"],icon:"Volume2",color:"text-gray-400"},FurnaceYMZ280B:{type:"FurnaceYMZ280B",name:"YMZ280B",shortName:"YMZ280B",description:"Yamaha YMZ280B - 8 channel ADPCM",bestFor:["Cave shmups","Late arcade","High quality"],icon:"AudioLines",color:"text-indigo-400"},FurnaceSCC:{type:"FurnaceSCC",name:"Konami SCC",shortName:"SCC",description:"Konami SCC - 5 channel wavetable (MSX)",bestFor:["Gradius","Snatcher","MSX Konami"],icon:"Waves",color:"text-green-500"},FurnaceX1_010:{type:"FurnaceX1_010",name:"X1-010",shortName:"X1-010",description:"Seta X1-010 - 16 channel wavetable",bestFor:["Seta arcade","Wavetable","Twin Eagle"],icon:"Waves",color:"text-lime-400"},FurnaceBUBBLE:{type:"FurnaceBUBBLE",name:"Bubble System",shortName:"BUBBLE",description:"Konami Bubble System - wavetable",bestFor:["Konami arcade","Bubble System","Wavetable"],icon:"Circle",color:"text-sky-400"},FurnaceSM8521:{type:"FurnaceSM8521",name:"SM8521",shortName:"SM8521",description:"Sharp SM8521 - Game.com",bestFor:["Game.com","Tiger electronics","Obscure"],icon:"Smartphone",color:"text-gray-500"},FurnaceT6W28:{type:"FurnaceT6W28",name:"T6W28",shortName:"T6W28",description:"NEC T6W28 - PC-6001, stereo PSG",bestFor:["NEC PC-6001","Japanese PC","Stereo PSG"],icon:"Monitor",color:"text-blue-300"},FurnaceSUPERVISION:{type:"FurnaceSUPERVISION",name:"Supervision",shortName:"SV",description:"Watara Supervision - 4 channel + noise/DMA",bestFor:["Supervision","Portable gaming","Watara"],icon:"Gamepad",color:"text-emerald-400"},FurnaceUPD1771:{type:"FurnaceUPD1771",name:"PD1771",shortName:"UPD1771",description:"NEC PD1771 - Epoch Super Cassette Vision",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-400"},FurnaceOPN2203:{type:"FurnaceOPN2203",name:"YM2203 / OPN",shortName:"OPN",description:"YM2203 - PC-88/98, simpler 3-channel FM + SSG",bestFor:["PC-88 music","Japanese PC games","Simpler FM"],icon:"Cpu",color:"text-blue-300"},FurnaceOPNBB:{type:"FurnaceOPNBB",name:"YM2610B",shortName:"OPNB-B",description:"YM2610B - Extended Neo Geo with more FM channels",bestFor:["Neo Geo CD","Extended OPNB","SNK"],icon:"Gamepad2",color:"text-red-300"},FurnaceAY8930:{type:"FurnaceAY8930",name:"AY-8930",shortName:"AY+",description:"Enhanced AY-3-8910 with expanded features",bestFor:["Enhanced chiptune","Extended AY","Microchip"],icon:"Tv",color:"text-sky-400"},FurnaceNDS:{type:"FurnaceNDS",name:"Nintendo DS",shortName:"NDS",description:"Nintendo DS - 16 channel PCM/PSG",bestFor:["NDS music","Portable gaming","Modern chiptune"],icon:"Smartphone",color:"text-slate-400"},FurnaceGBA:{type:"FurnaceGBA",name:"Game Boy Advance",shortName:"GBA",description:"GBA DMA Sound - 2 channel direct PCM",bestFor:["GBA music","Portable gaming","PCM"],icon:"Gamepad",color:"text-purple-300"},FurnacePOKEMINI:{type:"FurnacePOKEMINI",name:"Pokemon Mini",shortName:"PKMN",description:"Pokemon Mini - tiny handheld sound",bestFor:["Pokemon Mini","Tiny tunes","Lo-fi"],icon:"Star",color:"text-yellow-300"},FurnaceNAMCO:{type:"FurnaceNAMCO",name:"Namco WSG",shortName:"WSG",description:"Namco WSG - Pac-Man, Galaga wavetable",bestFor:["Pac-Man","Galaga","Classic arcade"],icon:"Circle",color:"text-yellow-400"},FurnacePET:{type:"FurnacePET",name:"Commodore PET",shortName:"PET",description:"Commodore PET - single voice shift register",bestFor:["PET music","Early 80s","Primitive"],icon:"Monitor",color:"text-green-300"},FurnacePOKEY:{type:"FurnacePOKEY",name:"Atari POKEY",shortName:"POKEY",description:"Atari POKEY - Atari 800/5200/arcade",bestFor:["Atari 8-bit","Atari arcade","Classic chiptune"],icon:"Joystick",color:"text-orange-400"},FurnaceMSM6258:{type:"FurnaceMSM6258",name:"MSM6258",shortName:"MSM6258",description:"OKI MSM6258 - 4-bit ADPCM voice",bestFor:["Voice samples","ADPCM","Japanese arcade"],icon:"Mic",color:"text-pink-300"},FurnaceMSM5232:{type:"FurnaceMSM5232",name:"MSM5232",shortName:"MSM5232",description:"OKI MSM5232 - 8-voice PSG synthesizer",bestFor:["Early arcade","Organ sounds","8-voice"],icon:"Music2",color:"text-amber-300"},FurnaceMULTIPCM:{type:"FurnaceMULTIPCM",name:"Sega MultiPCM",shortName:"MPCM",description:"Sega MultiPCM - System 32, Model 1/2",bestFor:["Virtua Racing","Sega arcade","High quality PCM"],icon:"Headphones",color:"text-blue-400"},FurnaceAMIGA:{type:"FurnaceAMIGA",name:"Amiga Paula",shortName:"PAULA",description:"Amiga Paula - 4 channel 8-bit PCM",bestFor:["Amiga MODs","Demoscene","Classic samples"],icon:"Disc",color:"text-slate-300"},FurnacePCSPKR:{type:"FurnacePCSPKR",name:"PC Speaker",shortName:"PCSPK",description:"PC Speaker - internal IBM PC beeper",bestFor:["DOS games","Beeper music","Lo-fi PC"],icon:"Volume2",color:"text-gray-400"},FurnacePONG:{type:"FurnacePONG",name:"AY-3-8500",shortName:"PONG",description:"AY-3-8500 - original Pong chip sound",bestFor:["Pong","Retro bleeps","Primitive"],icon:"Circle",color:"text-white"},FurnacePV1000:{type:"FurnacePV1000",name:"Casio PV-1000",shortName:"PV1K",description:"Casio PV-1000 - 3 channel PSG",bestFor:["PV-1000","Obscure","Japanese"],icon:"Tv",color:"text-green-400"},FurnaceDAVE:{type:"FurnaceDAVE",name:"Enterprise DAVE",shortName:"DAVE",description:"Enterprise DAVE - 3 channel + noise",bestFor:["Enterprise 64/128","Hungarian","European"],icon:"Monitor",color:"text-red-300"},FurnaceSU:{type:"FurnaceSU",name:"Sound Unit",shortName:"SU",description:"Commander X16 Sound Unit",bestFor:["X16 music","Modern retro","Sound Unit"],icon:"Speaker",color:"text-teal-300"},FurnacePOWERNOISE:{type:"FurnacePOWERNOISE",name:"Power Noise",shortName:"PNOISE",description:"Power Noise - noise generator chip",bestFor:["Noise music","Experimental","Harsh sounds"],icon:"Zap",color:"text-violet-400"},FurnaceZXBEEPER:{type:"FurnaceZXBEEPER",name:"ZX Beeper",shortName:"BEEP",description:"ZX Spectrum beeper - 1-bit audio",bestFor:["ZX Spectrum","Beeper music","1-bit audio"],icon:"Speaker",color:"text-cyan-300"},FurnaceSCVTONE:{type:"FurnaceSCVTONE",name:"SCV Tone",shortName:"SCV",description:"Epoch SCV tone generator",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-300"},FurnacePCMDAC:{type:"FurnacePCMDAC",name:"PCM DAC",shortName:"DAC",description:"Generic PCM DAC output",bestFor:["PCM output","Generic DAC","Simple samples"],icon:"AudioLines",color:"text-gray-300"},ChiptuneModule:{type:"ChiptuneModule",name:"Chiptune Module",shortName:"MOD",description:"Libopenmpt-powered playback for MOD/XM/IT/S3M files",bestFor:["Tracker modules","Retro game music","Sample-accurate playback"],icon:"Gamepad2",color:"text-lime-400"},WobbleBass:{type:"WobbleBass",name:"Wobble Bass",shortName:"Wobble",description:"Dubstep/DnB bass with tempo-synced LFO, Reese detuning, FM growl",bestFor:["Dubstep","DnB","Jungle","Neurofunk","Riddim"],icon:"Waves",color:"text-fuchsia-500"},DrumKit:{type:"DrumKit",name:"Drum Kit",shortName:"Kit",description:"Multi-sample instrument with keymap - assign different samples to different notes",bestFor:["Drum kits","Instrument layers","Velocity splits","Sample mapping"],icon:"Piano",color:"text-amber-500"},Buzzmachine:{type:"Buzzmachine",name:"Buzzmachine",shortName:"Buzz",description:"Jeskola Buzz machines - classic tracker effects and generators from the Buzz ecosystem",bestFor:["Effects","Generators","Classic tracker sounds","Buzz compatibility"],icon:"Cpu",color:"text-yellow-500"},BuzzDTMF:{type:"BuzzDTMF",name:"CyanPhase DTMF",shortName:"DTMF",description:"Phone dial tone generator - classic DTMF tones",bestFor:["Phone tones","Retro effects","Experimental"],icon:"Phone",color:"text-cyan-400"},BuzzFreqBomb:{type:"BuzzFreqBomb",name:"Frequency Bomb",shortName:"FreqBomb",description:"Elenzil Frequency Bomb - chaotic frequency modulation",bestFor:["Noise","Chaos","Experimental"],icon:"Bomb",color:"text-red-500"},BuzzKick:{type:"BuzzKick",name:"FSM Kick",shortName:"Kick",description:"FSM Kick drum synthesizer",bestFor:["Kick drums","Bass drums","Percussion"],icon:"Drum",color:"text-orange-500"},BuzzKickXP:{type:"BuzzKickXP",name:"FSM KickXP",shortName:"KickXP",description:"Extended FSM Kick with more parameters",bestFor:["Kick drums","Deep bass","EDM kicks"],icon:"Drum",color:"text-orange-600"},BuzzNoise:{type:"BuzzNoise",name:"Jeskola Noise",shortName:"Noise",description:"Jeskola Noise generator",bestFor:["Noise","Hi-hats","Textures"],icon:"Waves",color:"text-gray-400"},BuzzTrilok:{type:"BuzzTrilok",name:"Jeskola Trilok",shortName:"Trilok",description:"Jeskola Trilok bass drum synthesizer",bestFor:["Bass drums","Toms","Percussion"],icon:"Drum",color:"text-amber-500"},Buzz4FM2F:{type:"Buzz4FM2F",name:"MadBrain 4FM2F",shortName:"4FM2F",description:"4-operator FM synthesizer with 2 filters",bestFor:["FM sounds","Complex timbres","DX-style"],icon:"Radio",color:"text-purple-500"},BuzzDynamite6:{type:"BuzzDynamite6",name:"MadBrain Dynamite6",shortName:"Dyn6",description:"6-voice additive synthesizer",bestFor:["Additive synthesis","Organs","Complex sounds"],icon:"Zap",color:"text-yellow-500"},BuzzM3:{type:"BuzzM3",name:"Makk M3",shortName:"M3",description:"Dual-oscillator mono synth",bestFor:["Bass","Leads","Classic synth"],icon:"AudioLines",color:"text-green-500"},Buzz3o3:{type:"Buzz3o3",name:"Oomek Aggressor 3o3",shortName:"3o3",description:"TB-303 style acid synth clone",bestFor:["Acid bass","Squelchy lines","Techno"],icon:"Zap",color:"text-lime-500"},MAMEVFX:{type:"MAMEVFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq ES5506 (OTTO) 32-voice wavetable synthesis",bestFor:["Evolving pads","90s digital","Cinematic","Layers"],icon:"AudioLines",color:"text-pink-400"},MAMEDOC:{type:"MAMEDOC",name:"Ensoniq ESQ-1",shortName:"DOC",description:"Ensoniq ES5503 (DOC) 8-bit wavetable synthesis",bestFor:["Lo-fi digital","ESQ-1 pads","Gritty bass","80s digital"],icon:"Waves",color:"text-amber-400"},MAMERSA:{type:"MAMERSA",name:"Roland SA",shortName:"MKS20",description:"Roland Structured Adaptive Synthesis (MKS-20/RD-1000)",bestFor:["Electric piano","Authentic piano","80s keys"],icon:"Piano",color:"text-sky-400"},MAMESWP30:{type:"MAMESWP30",name:"Yamaha SWP30",shortName:"AWM2",description:"Yamaha SWP30 (AWM2) 64-voice ROMpler/DSP engine",bestFor:["Realistic instruments","90s ROMpler","Advanced effects","AWM2 sounds"],icon:"Cpu",color:"text-emerald-400"},CZ101:{type:"CZ101",name:"Casio CZ-101",shortName:"CZ",description:"Casio Phase Distortion synthesis - 8 voices, dual oscillator with DCO/DCW/DCA envelopes",bestFor:["Digital bass","Metallic leads","Synth brass","80s digital","Phase distortion"],icon:"Activity",color:"text-violet-400"},CEM3394:{type:"CEM3394",name:"CEM3394 (Curtis)",shortName:"CEM",description:"Curtis Electromusic analog synth voice - used in Prophet VS, Matrix-6, ESQ-1, Six-Trak",bestFor:["Analog bass","Warm pads","Classic leads","80s analog","Prophet sounds"],icon:"Waves",color:"text-emerald-400"},SCSP:{type:"SCSP",name:"Sega Saturn SCSP",shortName:"SCSP",description:"Yamaha YMF292-F 32-voice sound processor - Sega Saturn, Model 2/3 arcade",bestFor:["Arcade sounds","90s gaming","Saturn pads","Virtua sounds","Sega classics"],icon:"Gamepad2",color:"text-blue-500"},DubSiren:{type:"DubSiren",name:"Dub Siren",shortName:"Siren",description:"Classic dub sound system siren with LFO and delay",bestFor:["Dub FX","Reggae","Sound system","Alerts"],icon:"Megaphone",color:"text-red-500"},SpaceLaser:{type:"SpaceLaser",name:"Space Laser",shortName:"Laser",description:"FM-based cosmic zap generator for classic reggae and anime effects",bestFor:["Laser shots","Anime FX","Reggae dubs","Sci-fi"],icon:"Zap",color:"text-green-500"},V2:{type:"V2",name:"Farbrausch V2 Synth",shortName:"V2",description:"Authentic 4k/64k demoscene synthesis with multi-voice subtractive engine.",bestFor:["Demoscene","Trance","Techno","Leads"],icon:"Radio",color:"amber"},V2Speech:{type:"V2Speech",name:"V2 Speech",shortName:"V2Sp",description:"Farbrausch V2 speech synthesis module for robotic and vocoder-style voices.",bestFor:["Speech","Robotic Voices","Demoscene","FX"],icon:"Radio",color:"amber"},Sam:{type:"Sam",name:"Commodore SAM",shortName:"SAM",description:"Software Automatic Mouth - classic 8-bit speech synthesizer from 1982.",bestFor:["Speech","Robotic Voices","Lo-Fi","FX"],icon:"MessageSquare",color:"amber"},Synare:{type:"Synare",name:"Synare 3",shortName:"Synare",description:'Classic electronic percussion synthesizer for "disco tom" and dub sounds',bestFor:["Dub percussion","Disco toms","Electronic drums","SFX"],icon:"Drum",color:"text-yellow-500"},Dexed:{type:"Dexed",name:"Dexed (DX7)",shortName:"DX7",description:"Yamaha DX7 FM synthesizer emulation - 6-operator FM with 32 algorithms",bestFor:["FM Bass","Electric Piano","Bells","Pads","Classic FM sounds"],icon:"Piano",color:"text-blue-400"},OBXd:{type:"OBXd",name:"OBXd (Oberheim)",shortName:"OBXd",description:"Oberheim OB-X analog polysynth emulation - classic warm analog sounds",bestFor:["Pads","Brass","Strings","Warm leads","Analog sounds"],icon:"Waves",color:"text-amber-400"},Buzz3o3DF:{type:"Buzz3o3DF",name:"Aggressor Devil Fish",shortName:"3o3DF",description:"Enhanced TB-303 clone with Devil Fish mods - accent decay, VEG, filter tracking, muffler",bestFor:["Acid bass","Deep acid","Experimental","Devil Fish tones"],icon:"Zap",color:"text-lime-400"},BuzzM4:{type:"BuzzM4",name:"Makk M4",shortName:"M4",description:"Wavetable synth with 100+ waveforms, dual oscillators, sub osc, and dual LFOs",bestFor:["Wavetable","Leads","Pads","Bass"],icon:"Layers",color:"text-sky-400"},MAMEAICA:{type:"MAMEAICA",name:"Sega AICA",shortName:"AICA",description:"Sega Dreamcast/Naomi AICA - 64-voice ADPCM+FM sound processor",bestFor:["Dreamcast sounds","Arcade PCM","90s gaming","ADPCM samples"],icon:"Gamepad2",color:"text-blue-400"},MAMEASC:{type:"MAMEASC",name:"Apple Sound Chip",shortName:"ASC",description:"Apple ASC - 4-voice wavetable synthesis from Apple IIGS and Mac",bestFor:["Retro Mac","Wavetable","IIGS sounds","80s digital"],icon:"Cpu",color:"text-gray-400"},MAMEAstrocade:{type:"MAMEAstrocade",name:"Bally Astrocade",shortName:"Astro",description:"Bally Astrocade custom sound - 3 voices + noise, vibrato modulation",bestFor:["Retro arcade","Lo-fi","Noise FX","Vintage gaming"],icon:"Gamepad2",color:"text-purple-400"},MAMEC352:{type:"MAMEC352",name:"Namco C352",shortName:"C352",description:"Namco System 22/23 - 32-voice PCM with built-in effects (needs ROM)",bestFor:["Namco arcade","Ridge Racer","Tekken sounds","Arcade PCM"],icon:"Gamepad2",color:"text-red-400"},MAMEES5503:{type:"MAMEES5503",name:"Ensoniq ES5503",shortName:"ES5503",description:"Ensoniq DOC - 32-oscillator wavetable chip (Apple IIGS, ESQ-1, Mirage)",bestFor:["Wavetable","Lo-fi digital","80s synth","IIGS music"],icon:"Waves",color:"text-amber-400"},MAMEICS2115:{type:"MAMEICS2115",name:"ICS WaveFront",shortName:"ICS",description:"ICS 2115 WaveFront - 32-voice wavetable with interpolation (needs ROM)",bestFor:["Wavetable","90s soundcard","GUS compatible","Tracker music"],icon:"Cpu",color:"text-teal-400"},MAMEK054539:{type:"MAMEK054539",name:"Konami K054539",shortName:"K054",description:"Konami 054539 - 8-channel PCM for Konami arcade (needs ROM)",bestFor:["Konami arcade","TMNT","Gradius","Arcade samples"],icon:"Gamepad2",color:"text-yellow-400"},MAMEMEA8000:{type:"MAMEMEA8000",name:"Philips MEA8000",shortName:"MEA",description:"Philips MEA8000 - LPC speech synthesis with formant modeling",bestFor:["Speech","Robotic voice","Retro talking","Voice FX"],icon:"Mic",color:"text-green-400"},MAMEMSM5232:{type:"MAMEMSM5232",name:"OKI MSM5232",shortName:"MSM",description:"OKI MSM5232 - 8-voice PSG organ/synth chip (MAME native emulation)",bestFor:["Organ","Arcade melody","Retro synth","Simple tones"],icon:"Cpu",color:"text-orange-400"},MAMERF5C400:{type:"MAMERF5C400",name:"Ricoh RF5C400",shortName:"RF5C",description:"Ricoh RF5C400 - 32-voice PCM with digital filtering (needs ROM)",bestFor:["Seta arcade","PCM playback","Arcade samples"],icon:"Cpu",color:"text-indigo-400"},MAMESN76477:{type:"MAMESN76477",name:"TI SN76477",shortName:"SN77",description:"TI SN76477 Complex Sound Generator - VCO, noise, envelope, mixer",bestFor:["Sci-fi FX","Laser sounds","Space Invaders","Retro arcade FX"],icon:"Zap",color:"text-green-500"},MAMESNKWave:{type:"MAMESNKWave",name:"SNK Wave",shortName:"SNK",description:"SNK custom wavetable sound generator - Neo Geo era",bestFor:["Retro arcade","Wavetable","SNK sounds","Lo-fi"],icon:"Gamepad2",color:"text-red-500"},MAMESP0250:{type:"MAMESP0250",name:"GI SP0250",shortName:"SP02",description:"General Instrument SP0250 - LPC speech synthesis for arcade machines",bestFor:["Arcade speech","Robotic voice","Q*bert sounds","Retro talking"],icon:"Mic",color:"text-yellow-500"},MAMETIA:{type:"MAMETIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 TIA - MAME-accurate 2-voice with 16 distortion modes",bestFor:["Atari sounds","2600 bleeps","Lo-fi","Retro FX"],icon:"Gamepad2",color:"text-amber-500"},MAMETMS36XX:{type:"MAMETMS36XX",name:"TMS36XX Organ",shortName:"TMS3",description:"TI TMS3615/3617 - electronic organ chip with 13 chromatic notes",bestFor:["Electronic organ","Retro tones","Circus music","Simple melody"],icon:"Music2",color:"text-rose-400"},MAMETMS5220:{type:"MAMETMS5220",name:"Speak & Spell",shortName:"TMS5",description:"TI TMS5220 LPC speech - the Speak & Spell chip, phoneme-based voice",bestFor:["Speech","Speak & Spell","Robotic voice","LPC vocoder"],icon:"Mic",color:"text-orange-500"},MAMETR707:{type:"MAMETR707",name:"Roland TR-707",shortName:"707",description:"Roland TR-707 PCM drum machine - 10 voices with analog filtering (needs ROM)",bestFor:["House drums","Electro beats","80s rhythm","Classic drum machine"],icon:"Disc",color:"text-red-400"},MAMEUPD931:{type:"MAMEUPD931",name:"NEC uPD931",shortName:"931",description:"NEC uPD931 - speech synthesis processor with LPC coding",bestFor:["Japanese speech","Arcade voice","Retro talking","Speech FX"],icon:"Mic",color:"text-cyan-400"},MAMEUPD933:{type:"MAMEUPD933",name:"NEC uPD933",shortName:"933",description:"NEC uPD933 raw phase distortion chip - the core of the Casio CZ series",bestFor:["Phase distortion","CZ sounds","Digital bass","Metallic leads"],icon:"Activity",color:"text-violet-400"},MAMEVotrax:{type:"MAMEVotrax",name:"Votrax SC-01",shortName:"Vtrx",description:"Votrax SC-01 - classic 1980s phoneme speech synthesizer chip",bestFor:["Robotic speech","Arcade talking","Q*bert","Retro voice"],icon:"Mic",color:"text-emerald-400"},MAMEYMF271:{type:"MAMEYMF271",name:"Yamaha OPX",shortName:"OPX",description:"Yamaha YMF271 OPX - 12-voice FM+PCM synthesis for arcade hardware",bestFor:["Arcade FM","FM+PCM","Jaleco sounds","Complex FM"],icon:"Radio",color:"text-blue-500"},MAMEYMOPQ:{type:"MAMEYMOPQ",name:"Yamaha OPQ",shortName:"OPQ",description:"Yamaha YM3806 OPQ - 4-op FM synthesis for Yamaha keyboards",bestFor:["FM synthesis","Yamaha sounds","Vintage FM","Keyboard sounds"],icon:"Radio",color:"text-indigo-500"},MAMEVASynth:{type:"MAMEVASynth",name:"Virtual Analog",shortName:"VA",description:"Virtual Analog modeling synthesizer - subtractive with multi-waveform oscillators",bestFor:["Analog modeling","Bass","Leads","Pads","Classic analog"],icon:"Waves",color:"text-pink-500"}},HM=[{id:"bass",name:"Bass",description:"Deep and punchy bass synths",synths:[KM.TB303,KM.MonoSynth,KM.WobbleBass]},{id:"lead",name:"Lead",description:"Melodic lead synthesizers",synths:[KM.Synth,KM.DuoSynth,KM.FMSynth,KM.AMSynth,KM.PluckSynth,KM.SuperSaw,KM.ChipSynth,KM.PWMSynth,KM.FormantSynth,KM.V2]},{id:"drums",name:"Drums",description:"Percussion and drum synthesis",synths:[KM.MembraneSynth,KM.MetalSynth,KM.NoiseSynth,KM.DrumMachine,KM.DrumKit,KM.Synare,KM.MAMETR707]},{id:"pads",name:"Pads",description:"Evolving textures and pads",synths:[KM.Wavetable,KM.GranularSynth,KM.PolySynth,KM.StringMachine,KM.V2]},{id:"dub",name:"Dub & FX",description:"Classic sound system and special effects",synths:[KM.DubSiren,KM.SpaceLaser,KM.V2,KM.Synare]},{id:"vintage",name:"Keys",description:"Keyboard instruments",synths:[KM.Organ]},{id:"samples",name:"Samples",description:"Sample-based instruments",synths:[KM.Sampler,KM.Player]},{id:"fx",name:"FX",description:"Sound effects and noise generators",synths:[KM.DubSiren]},{id:"furnace",name:" Furnace Chips",description:"All Furnace chip emulations - 70+ authentic retro sound chips",synths:[KM.FurnaceOPN,KM.FurnaceOPN2203,KM.FurnaceOPNA,KM.FurnaceOPNB,KM.FurnaceOPNBB,KM.FurnaceOPM,KM.FurnaceOPL,KM.FurnaceOPLL,KM.FurnaceOPL4,KM.FurnaceOPZ,KM.FurnaceY8950,KM.FurnaceESFM,KM.FurnaceVRC7,KM.FurnaceNES,KM.FurnaceGB,KM.FurnaceSNES,KM.FurnacePCE,KM.FurnacePSG,KM.FurnaceVB,KM.FurnaceLynx,KM.FurnaceSWAN,KM.FurnaceNDS,KM.FurnaceGBA,KM.FurnacePOKEMINI,KM.FurnaceVRC6,KM.FurnaceN163,KM.FurnaceFDS,KM.FurnaceMMC5,KM.FurnaceC64,KM.FurnaceSID6581,KM.FurnaceSID8580,KM.FurnaceAY,KM.FurnaceAY8930,KM.FurnaceVIC,KM.FurnacePET,KM.FurnaceSAA,KM.FurnaceTED,KM.FurnaceDAVE,KM.FurnaceVERA,KM.FurnaceSCC,KM.FurnaceTIA,KM.FurnacePOKEY,KM.FurnaceZXBEEPER,KM.FurnaceAMIGA,KM.FurnacePCSPKR,KM.FurnaceSEGAPCM,KM.FurnaceQSOUND,KM.FurnaceES5506,KM.FurnaceRF5C68,KM.FurnaceC140,KM.FurnaceK007232,KM.FurnaceK053260,KM.FurnaceGA20,KM.FurnaceOKI,KM.FurnaceYMZ280B,KM.FurnaceX1_010,KM.FurnaceBUBBLE,KM.FurnaceMULTIPCM,KM.FurnaceMSM6258,KM.FurnaceMSM5232,KM.FurnaceNAMCO,KM.FurnaceSM8521,KM.FurnaceT6W28,KM.FurnaceSUPERVISION,KM.FurnaceUPD1771,KM.FurnacePONG,KM.FurnacePV1000,KM.FurnaceSU,KM.FurnacePOWERNOISE,KM.FurnaceSCVTONE,KM.FurnacePCMDAC,KM.Furnace]},{id:"chiptune-fm",name:"FM Chips",description:"Yamaha FM synthesis chips (OPN, OPL, OPM families)",synths:[KM.FurnaceOPN,KM.FurnaceOPN2203,KM.FurnaceOPNA,KM.FurnaceOPNB,KM.FurnaceOPNBB,KM.FurnaceOPM,KM.FurnaceOPL,KM.FurnaceOPLL,KM.FurnaceOPL4,KM.FurnaceOPZ,KM.FurnaceY8950,KM.FurnaceESFM,KM.FurnaceVRC7]},{id:"chiptune-console",name:"Console Chips",description:"Game console sound chips (Nintendo, Sega, etc.)",synths:[KM.FurnaceNES,KM.FurnaceGB,KM.FurnaceSNES,KM.FurnacePCE,KM.FurnacePSG,KM.FurnaceVB,KM.FurnaceLynx,KM.FurnaceSWAN,KM.FurnaceNDS,KM.FurnaceGBA,KM.FurnacePOKEMINI,KM.FurnaceVRC6,KM.FurnaceN163,KM.FurnaceFDS,KM.FurnaceMMC5]},{id:"chiptune-computer",name:"Computer Chips",description:"Home computer sound chips (C64, Spectrum, etc.)",synths:[KM.FurnaceC64,KM.FurnaceSID6581,KM.FurnaceSID8580,KM.FurnaceAY,KM.FurnaceAY8930,KM.FurnaceVIC,KM.FurnacePET,KM.FurnaceSAA,KM.FurnaceTED,KM.FurnaceDAVE,KM.FurnaceVERA,KM.FurnaceSCC,KM.FurnaceTIA,KM.FurnacePOKEY,KM.FurnaceZXBEEPER,KM.FurnaceAMIGA,KM.FurnacePCSPKR]},{id:"chiptune-arcade",name:"Arcade PCM",description:"Arcade game PCM/ADPCM chips (Sega, Namco, Konami, Capcom)",synths:[KM.FurnaceSEGAPCM,KM.FurnaceQSOUND,KM.FurnaceES5506,KM.FurnaceRF5C68,KM.FurnaceC140,KM.FurnaceK007232,KM.FurnaceK053260,KM.FurnaceGA20,KM.FurnaceOKI,KM.FurnaceYMZ280B,KM.FurnaceX1_010,KM.FurnaceBUBBLE,KM.FurnaceMULTIPCM,KM.FurnaceMSM6258,KM.FurnaceMSM5232,KM.FurnaceNAMCO]},{id:"chiptune-other",name:"Other Chips",description:"Obscure and miscellaneous sound chips",synths:[KM.FurnaceSM8521,KM.FurnaceT6W28,KM.FurnaceSUPERVISION,KM.FurnaceUPD1771,KM.FurnacePONG,KM.FurnacePV1000,KM.FurnaceSU,KM.FurnacePOWERNOISE,KM.FurnaceSCVTONE,KM.FurnacePCMDAC,KM.Furnace]},{id:"buzzmachines",name:"Buzzmachines",description:"Jeskola Buzz machines - classic tracker synths and drums",synths:[KM.Buzz3o3,KM.Buzz3o3DF,KM.BuzzM3,KM.BuzzM4,KM.Buzz4FM2F,KM.BuzzDynamite6,KM.BuzzKick,KM.BuzzKickXP,KM.BuzzTrilok,KM.BuzzNoise,KM.BuzzFreqBomb,KM.BuzzDTMF]},{id:"mame-synths",name:"MAME Hardware Synths",description:"Hardware-accurate synth and keyboard chip emulations",synths:[KM.MAMEVFX,KM.MAMEDOC,KM.MAMEES5503,KM.MAMERSA,KM.MAMESWP30,KM.CZ101,KM.MAMEUPD933,KM.CEM3394,KM.SCSP,KM.MAMEVASynth,KM.MAMEYMF271,KM.MAMEYMOPQ]},{id:"mame-arcade",name:"MAME Arcade & Retro",description:"Arcade game and retro computer sound chips (MAME-emulated)",synths:[KM.MAMEAICA,KM.MAMEASC,KM.MAMEAstrocade,KM.MAMEC352,KM.MAMEICS2115,KM.MAMEK054539,KM.MAMEMSM5232,KM.MAMERF5C400,KM.MAMESN76477,KM.MAMESNKWave,KM.MAMETIA,KM.MAMETMS36XX]},{id:"speech",name:"Speech & Voice",description:"Speech synthesis and voice generation",synths:[KM.MAMETMS5220,KM.MAMEVotrax,KM.MAMEMEA8000,KM.MAMESP0250,KM.MAMEUPD931,KM.Sam,KM.V2]},{id:"juce-synths",name:" JUCE Synths",description:"Professional quality WASM-based synth emulations",synths:[KM.Dexed,KM.OBXd]}],WM=Object.keys(KM).sort((e,t)=>KM[e].shortName.localeCompare(KM[t].shortName));function $M(e){return KM[e]}const qM=({compact:e=!1})=>{const{instruments:t,currentInstrumentId:n,setCurrentInstrument:a}=Df(),r=jf(e=>e.useHexNumbers),[o,i]=s.useState(!1),l=s.useRef(null),c=s.useRef(n??0);s.useEffect(()=>{c.current=n??0},[n]);const d=[...t].sort((e,t)=>e.id-t.id),u=t.find(e=>e.id===n);s.useEffect(()=>{if(!o)return;const e=e=>{l.current&&!l.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const p=s.useCallback(e=>{const t=d.findIndex(e=>e.id===c.current);if(-1===t)return;const n=t+e;if(n>=0&&n<d.length){const e=d[n].id;c.current=e,a(e)}},[d,a]),h=s.useRef(null),m=s.useRef(null);s.useEffect(()=>()=>{h.current&&clearInterval(h.current),m.current&&clearTimeout(m.current)},[]);const f=s.useCallback(e=>{e(),m.current&&clearTimeout(m.current),h.current&&clearInterval(h.current),m.current=window.setTimeout(()=>{h.current=window.setInterval(e,80)},300)},[]),y=s.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null),h.current&&(clearInterval(h.current),h.current=null)},[]),g=e=>r?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return bn.jsxs("div",{className:"ft2-numeric-group relative",ref:l,children:[bn.jsx("span",{className:"ft2-numeric-label",children:"Instr:"}),bn.jsx("button",{className:"ft2-numeric-value cursor-pointer hover:bg-dark-bgHover rounded px-1",onClick:()=>i(!o),title:u?.name||"Select instrument",children:g(n??0)}),!e&&u&&bn.jsx("span",{className:"ml-1 text-[10px] text-text-muted truncate max-w-[60px]",title:u.name,children:u.name.slice(0,8)}),bn.jsxs("div",{className:"ft2-numeric-arrows",children:[bn.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>f(()=>p(-1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(-1)),onTouchEnd:y,title:"Previous instrument",children:bn.jsx("span",{className:"ft2-arrow-icon",children:""})}),bn.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>f(()=>p(1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(1)),onTouchEnd:y,title:"Next instrument",children:bn.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),o&&bn.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 max-h-64 overflow-y-auto bg-dark-bgTertiary border border-dark-border rounded shadow-xl z-50 scrollbar-modern",children:d.map(e=>{const t=$M(e.synthType),s=(r=t.icon,Lt[r]||Bt);var r;const o=e.id===n;return bn.jsxs("div",{onClick:()=>{return t=e.id,a(t),void i(!1);var t},className:`\n                  flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors\n                  ${o?"bg-accent-primary/20 text-text-primary":"hover:bg-dark-bgHover text-text-secondary"}\n                `,children:[bn.jsx("span",{className:"font-mono text-xs w-5 text-text-muted",children:g(e.id)}),bn.jsx(s,{size:12,className:t.color}),bn.jsx("span",{className:"flex-1 text-xs truncate",children:e.name}),bn.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:t.shortName})]},e.id)})})]})};const YM=({width:e=800,height:t=120,mode:n="waveform"})=>{const a=s.useRef(null),r=s.useRef(null),o=s.useRef(),{analyserNode:i,fftNode:l}=Kf(),[c,d]=s.useState("number"==typeof e?e:800);s.useEffect(()=>{if("auto"!==e)return void d(e);const t=a.current;if(!t)return;const n=()=>{const e=t.getBoundingClientRect();d(Math.floor(e.width))};n();const s=new ResizeObserver(n);return s.observe(t),()=>s.disconnect()},[e]);const{currentThemeId:u}=sy(),p="cyan-lineart"===u,h=Gf(e=>e.isPlaying);return s.useEffect(()=>{const e=r.current;if(!e)return;const a=e.getContext("2d");if(!a)return;if(e.width=c,e.height=t,!h){const e=p?"#030808":"#0a0a0b",n=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",s=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)";a.fillStyle=e,a.fillRect(0,0,c,t),a.strokeStyle=n,a.lineWidth=1;for(let r=0;r<c;r+=50)a.beginPath(),a.moveTo(r,0),a.lineTo(r,t),a.stroke();for(let r=0;r<t;r+=30)a.beginPath(),a.moveTo(0,r),a.lineTo(c,r),a.stroke();return a.strokeStyle=s,a.beginPath(),a.moveTo(0,t/2),a.lineTo(c,t/2),void a.stroke()}let s=!0,d=0;const u=1e3/30,m=p?"#030808":"#0a0a0b",f=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",y=p?"#00ffff":"#00d4aa",g=p?"#00ffff":"#7c3aed",v=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)",b=a.createLinearGradient(0,0,c,0);b.addColorStop(0,y),b.addColorStop(.5,y),b.addColorStop(1,g);const x=[];if("spectrum"===n)for(let t=0;t<1024;t++)if(p)x.push("rgba(0, 255, 255, 0.75)");else{const e=160+t/1024*120;x.push(`hsla(${e}, 80%, 50%, 0.8)`)}const w=r=>{if(!s||!e||!a)return;const h=r-d;if(h<u)o.current=requestAnimationFrame(w);else{d=r-h%u,a.fillStyle=m,a.fillRect(0,0,c,t),a.strokeStyle=f,a.lineWidth=1;for(let e=0;e<c;e+=50)a.beginPath(),a.moveTo(e,0),a.lineTo(e,t),a.stroke();for(let e=0;e<t;e+=30)a.beginPath(),a.moveTo(0,e),a.lineTo(c,e),a.stroke();if("waveform"===n&&i){const e=i.getValue();a.strokeStyle=b,a.lineWidth=2,a.beginPath();const n=c/e.length;let s=0;for(let r=0;r<e.length;r++){const o=(e[r]+1)/2*t;0===r?a.moveTo(s,o):a.lineTo(s,o),s+=n}a.stroke(),a.strokeStyle=v,a.lineWidth=1,a.beginPath(),a.moveTo(0,t/2),a.lineTo(c,t/2),a.stroke()}else if("spectrum"===n&&l){const e=l.getValue(),n=c/e.length;let s=0;for(let r=0;r<e.length;r++){const o=(e[r]+100)/100,i=o*t;p?(a.globalAlpha=.5+.5*o,a.fillStyle="rgb(0, 255, 255)"):a.fillStyle=x[r]||x[x.length-1],a.fillRect(s,t-i,n-1,i),s+=n}a.globalAlpha=1}o.current=requestAnimationFrame(w)}};return o.current=requestAnimationFrame(w),()=>{s=!1,o.current&&cancelAnimationFrame(o.current)}},[c,t,n,i,l,p,h]),bn.jsx("div",{ref:a,className:"auto"===e?"w-full":"",children:bn.jsx("canvas",{ref:r,className:"rounded-md border border-dark-border",style:{width:"auto"===e?"100%":`${c}px`,height:`${t}px`}})})},XM=({height:e=100,width:t="auto"})=>{const n=s.useRef(null),a=s.useRef(null),r=s.useRef(null),o=s.useRef([]),i=s.useRef([]),{patterns:l,currentPatternIndex:c}=cm(),d=Gf(e=>e.isPlaying),{currentThemeId:u}=sy(),p=l[c],h=p?.channels.length||4,m="cyan-lineart"===u;s.useEffect(()=>{o.current=new Array(h).fill(0),i.current=new Array(h).fill(null).map(()=>({level:0,frames:0}))},[h]);const f=s.useCallback(t=>{const s=a.current,l=n.current;if(!s||!l)return void(r.current=requestAnimationFrame(f));const c=s.getContext("2d");if(!c)return void(r.current=requestAnimationFrame(f));const d=l.clientWidth;s.width===d&&s.height===e||(s.width=d,s.height=e);const u=em().getChannelTriggerLevels(h);for(let e=0;e<h;e++){const t=u[e]||0,n=o.current[e]||0;t>n?o.current[e]=n+.7*(t-n):(o.current[e]=.88*n,o.current[e]<.01&&(o.current[e]=0));const a=i.current[e];o.current[e]>=a.level?(a.level=o.current[e],a.frames=30):a.frames>0?a.frames--:(a.level*=.95,a.level<.01&&(a.level=0))}const p=m?"#030808":"#0a0a0b";c.fillStyle=p,c.fillRect(0,0,d,e);const y=Math.max(6,(e-24-3*(h-1))/h),g=d-40;for(let e=0;e<h;e++){const t=12+e*(y+3),n=o.current[e],a=i.current[e],s=n*g,r=20+a.level*g;if(c.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",c.font="9px monospace",c.textAlign="left",c.fillText(`${e+1}`,4,t+y-1),c.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",c.fillRect(20,t,g,y),s>0){const e=c.createLinearGradient(20,0,20+g,0);m?(e.addColorStop(0,"rgba(0, 200, 200, 0.8)"),e.addColorStop(.7,"rgba(0, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 100, 100, 1)")):(e.addColorStop(0,"rgba(0, 180, 140, 0.8)"),e.addColorStop(.7,"rgba(0, 212, 170, 1)"),e.addColorStop(1,"rgba(255, 80, 80, 1)")),c.fillStyle=e,c.fillRect(20,t,s,y)}a.level>.02&&(c.fillStyle=m?"#00ffff":"#ff4444",c.fillRect(r-1,t,2,y))}c.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",c.font="10px sans-serif",c.textAlign="center",c.fillText("Channel Levels",d/2,e-3),r.current=requestAnimationFrame(f)},[h,e,m]);return s.useEffect(()=>{if(!d){r.current&&(cancelAnimationFrame(r.current),r.current=null);const t=a.current,s=n.current;if(t&&s){const n=t.getContext("2d");if(n){const a=s.clientWidth;t.width=a,t.height=e;const r=m?"#030808":"#0a0a0b";n.fillStyle=r,n.fillRect(0,0,a,e);const o=Math.max(6,(e-24-3*(h-1))/h),i=a-40,l=12;for(let e=0;e<h;e++){const t=l+e*(o+3);n.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",n.font="9px monospace",n.textAlign="left",n.fillText(`${e+1}`,4,t+o-1),n.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",n.fillRect(20,t,i,o)}n.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",n.font="10px sans-serif",n.textAlign="center",n.fillText("Channel Levels",a/2,e-3)}}return o.current=new Array(h).fill(0),void(i.current=new Array(h).fill(null).map(()=>({level:0,frames:0})))}return r.current=requestAnimationFrame(f),()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)}},[f,d,h,e,m]),bn.jsx("div",{ref:n,className:"auto"===t?"w-full":"",children:bn.jsx("canvas",{ref:a,className:"rounded-md border border-dark-border",style:{width:"100%",height:`${e}px`}})})},QM=e.memo(({height:e=100,onComplete:t})=>{const n=s.useRef(null),a=s.useRef(null),[r,o]=s.useState(null),i=s.useRef(null),l=s.useRef(null),c=s.useRef(t);s.useEffect(()=>{c.current=t},[t]);const d=s.useRef(!1),{currentThemeId:u}=sy(),p="cyan-lineart"===u;s.useEffect(()=>{fetch("/DEViLBOX/assets/up-rough-logo.svg").then(e=>e.text()).then(e=>{let t=e;t=t.replace(/stroke="#000"/g,'stroke="currentColor"'),t=t.replace(/stroke-width="0"/g,'stroke-width="0" fill="currentColor"'),o(t)}).catch(e=>{})},[]);const h=s.useCallback(()=>{if(!a.current)return;const e=a.current.querySelector("svg");if(e){e.querySelectorAll("*").forEach(e=>{e.style.animationPlayState="paused"}),e.style.animationPlayState="paused"}},[]);s.useEffect(()=>(d.current=!1,l.current=setTimeout(()=>{h(),d.current=!0,c.current?.()},1e4),()=>{l.current&&clearTimeout(l.current)}),[h]);const m=s.useCallback(()=>{if(!a.current)return void(i.current=requestAnimationFrame(m));const e=a.current,t=p?"#00ffff":"#00d4aa";e.style.color=t,e.style.transform="scale(1.5)",e.style.filter="",i.current=requestAnimationFrame(m)},[p]);s.useEffect(()=>(i.current=requestAnimationFrame(m),()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null)}),[m]);const f=p?"#030808":"#0a0a0b",y=p?"#00ffff":"#00d4aa";return bn.jsx("div",{ref:n,className:"w-full flex items-center justify-center rounded-md border border-dark-border overflow-hidden",style:{height:`${e}px`,backgroundColor:f},onClick:e=>{e.stopPropagation(),l.current&&clearTimeout(l.current),i.current&&cancelAnimationFrame(i.current),c.current?.()},title:"Click to skip",children:r?bn.jsx("div",{ref:a,className:"flex items-center justify-center",style:{height:"100%",width:"100%",color:y,transformOrigin:"center center",transform:"scale(1.5)"},dangerouslySetInnerHTML:{__html:r}}):bn.jsx("span",{className:"text-text-muted text-sm",children:"Loading..."})})}),ZM=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const o=window.devicePixelRatio||1;s.width=a*o,s.height=e*o,r.scale(o,o);const i=a/2,l=e/2,c=.4*Math.min(a,e),d=()=>{r.clearRect(0,0,a,e);const t=em().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}r.strokeStyle="#333",r.lineWidth=2,r.beginPath(),r.arc(i,l,c,0,2*Math.PI),r.stroke();for(let e=0;e<3;e++){const t=c*(.4+.2*e),n=Math.max(0,s-.3*e);if(n>0){const e=2*Math.PI*Math.min(2*n,1),a=r.createLinearGradient(i-t,l,i+t,l);a.addColorStop(0,"#00d4aa"),a.addColorStop(.5,"#00ffff"),a.addColorStop(1,"#00d4aa"),r.strokeStyle=a,r.lineWidth=8,r.lineCap="round",r.beginPath(),r.arc(i,l,t,-Math.PI/2,-Math.PI/2+e),r.stroke()}}r.fillStyle=s>.5?"#00ffff":"#333",r.beginPath(),r.arc(i,l,4,0,2*Math.PI),r.fill(),n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,e]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},JM=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const o=window.devicePixelRatio||1;s.width=a*o,s.height=e*o,r.scale(o,o);const i=a/32,l=new Array(32).fill(0),c=()=>{r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=em().getFFT();if(t){const n=t,a=Math.floor(n.length/32);for(let t=0;t<32;t++){const s=(n[t*a]+140)/140,o=Math.max(0,Math.min(1,s))*e*.9;l[t]+=.3*(o-l[t]);const c=t*i,d=l[t],u=r.createLinearGradient(c,e-d,c,e);u.addColorStop(0,"#00ffff"),u.addColorStop(.5,"#00d4aa"),u.addColorStop(1,"#006655"),r.fillStyle=u,r.fillRect(c+1,e-d,i-2,d),r.fillStyle="rgba(0, 255, 255, 0.5)",r.fillRect(c+1,e-d,i-2,2),r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(c+i-2,e-d,1,d)}}n.current=requestAnimationFrame(c)};return c(),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,e]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},eN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),a=s.useRef([]),[r,o]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const o=s.getContext("2d");if(!o)return;const i=window.devicePixelRatio||1;s.width=r*i,s.height=e*i,o.scale(i,i);const l=a.current,c=(e,t,n)=>({x:e,y:t,vx:(Math.random()-.5)*n*4,vy:(Math.random()-.5)*n*4,size:3*Math.random()+1,life:1}),d=()=>{o.fillStyle="rgba(10, 10, 11, 0.15)",o.fillRect(0,0,r,e);const t=em().getWaveform();let a=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);a=Math.min(1,10*e)}if(a>.1&&l.length<150){const t=Math.floor(8*a);for(let n=0;n<t;n++)l.push(c(r/2+40*(Math.random()-.5),e/2+40*(Math.random()-.5),a))}for(let n=l.length-1;n>=0;n--){const t=l[n];t.x+=t.vx,t.y+=t.vy,t.life-=.015;const s=r/2-t.x,i=e/2-t.y,c=Math.sqrt(s*s+i*i);if(c>20&&(t.vx+=s/c*.05,t.vy+=i/c*.05),t.vx*=.98,t.vy*=.98,t.life<=0){l.splice(n,1);continue}const d=t.life,u=(60*t.life+160)%360;o.fillStyle=`hsla(${u}, 100%, 60%, ${d})`,o.beginPath(),o.arc(t.x,t.y,t.size*t.life,0,2*Math.PI),o.fill(),a>.5&&(o.fillStyle=`hsla(${u}, 100%, 80%, ${.3*d})`,o.beginPath(),o.arc(t.x,t.y,t.size*t.life*2,0,2*Math.PI),o.fill())}n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current),a.current=[]}},[r,e]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},tN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=cm(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=em().getWaveform();if(t){const e=t;for(let t=0;t<c;t++){const n=Math.floor(t/d),a=t%d*p,s=n*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(a,s,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,a+4,s+10);const o=4,i=h-2*o-12,u=s+o+12,m=Math.max(1,Math.floor(e.length/(p-2*o))),f=Math.floor(t/c*e.length),y=123*t%e.length;r.strokeStyle=l?.channels[t]?.muted?"#333":"#00d4aa",r.lineWidth=1.5,r.beginPath();for(let l=0;l<p-2*o;l++){let n=e[(f+l*m+y)%e.length];n=n*(.3+t/c*.5)*(1+t%3);const s=a+o+l,d=u+i/2+n*i*.4;0===l?r.moveTo(s,d):r.lineTo(s,d)}r.stroke()}}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},nN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=cm(),l=o[i],c=l?.channels.length||4,d=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const u=Math.min(8,c),p=Math.ceil(c/u),h=a/u,m=e/p,f=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=em().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/u),n=e%u*h,a=t*m,o=Date.now()/1e3,i=2.1*e,c=.4*Math.sin(2*o+i)+.3*Math.cos(1.3*o+.7*i),p=.5+e%4*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*p+c));d.current[e]+=.2*(f-d.current[e]);const y=d.current[e],g=2;r.fillStyle="#111",r.fillRect(n+g,a+g,h-2*g,m-2*g);const v=(m-2*g)*y,b=r.createLinearGradient(n,a+m,n,a+m-v);y>.8?(b.addColorStop(0,"#ff0000"),b.addColorStop(.3,"#ffff00"),b.addColorStop(1,"#00ff00")):y>.5?(b.addColorStop(0,"#ffff00"),b.addColorStop(1,"#00ff00")):(b.addColorStop(0,"#00ff00"),b.addColorStop(1,"#00d4aa")),r.fillStyle=b,r.fillRect(n+g,a+m-g-v,h-2*g,v),r.fillStyle=y>.5?"#000":"#666",r.font="9px monospace",r.textAlign="center",r.fillText((e+1).toString(),n+h/2,a+m/2+3),r.strokeStyle=l?.channels[e]?.solo?"#00ffff":"#222",r.lineWidth=l?.channels[e]?.solo?2:1,r.strokeRect(n+g,a+g,h-2*g,m-2*g)}n.current=requestAnimationFrame(f)};return f(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},aN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=cm(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=em().getFFT();if(t){const e=t,n=16;for(let t=0;t<c;t++){const a=Math.floor(t/d),s=t%d*p,o=a*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(s,o,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,s+4,o+10);const i=4,u=(p-2*i)/n,m=h-2*i-12;for(let d=0;d<n;d++){const a=Math.floor(t/c*e.length*.6),p=(e[(Math.floor(d/n*e.length)+a)%e.length]+140)/140,h=Math.max(0,Math.min(1,p))*m,f=Date.now()/1e3,y=1.7*t,g=.4+t%3*.3,v=h*(l?.channels[t]?.muted?0:.3*Math.sin(1.5*f+y+.4*d)+g),b=s+i+d*u,x=o+i+12+m-v,w=d/n*180+180;r.fillStyle=`hsl(${w}, 80%, 50%)`,r.fillRect(b,x,u-1,v)}}}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},sN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=cm(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=em().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),n=e%d*p,a=t*h,o=Date.now()/1e3,i=2.5*e,u=.3*Math.sin(2*o+i),m=.6+e%3*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*m+u));r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(n,a,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${e+1}`,n+4,a+10);const y=n+p/2,g=a+h/2,v=Math.min(p,h)/2-12;r.strokeStyle="#333",r.lineWidth=1,r.beginPath(),r.arc(y,g,v,0,2*Math.PI),r.stroke();const b=2;for(let s=0;s<b;s++){const t=v*(.5+.3*s),n=Math.max(0,f-.4*s);if(n>0){const a=2*Math.PI*Math.min(1.5*n,1),s=(o+.3*e)%(2*Math.PI),i=160+e/c*60;r.strokeStyle=`hsl(${i}, 80%, 50%)`,r.lineWidth=4,r.lineCap="round",r.beginPath(),r.arc(y,g,t,-Math.PI/2+s,-Math.PI/2+s+a),r.stroke()}}r.fillStyle=f>.5?"#00ffff":"#333",r.beginPath(),r.arc(y,g,3,0,2*Math.PI),r.fill()}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},rN=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),a=s.useRef([]),[r,o]=s.useState(300),{patterns:i,currentPatternIndex:l}=cm(),c=i[l],d=c?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const o=s.getContext("2d");if(!o)return;let i=!0;const l=window.devicePixelRatio||1;s.width=r*l,s.height=e*l,o.scale(l,l);const u=Math.min(4,d),p=Math.ceil(d/u),h=r/u,m=e/p;a.current=Array(d).fill(0).map(()=>[]);const f=()=>{if(!i)return;o.fillStyle="#0a0a0b",o.fillRect(0,0,r,e);const t=em().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<d;e++){const t=Math.floor(e/u),n=e%u*h,r=t*m,i=Date.now()/1e3,l=2.3*e,p=.35*Math.sin(2.5*i+l),f=.5+e%4*.25,y=c?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*f+p));o.strokeStyle="#222",o.lineWidth=1,o.strokeRect(n,r,h,m),o.fillStyle="#555",o.font="8px monospace",o.fillText(`CH${e+1}`,n+4,r+10);const g=n+h/2,v=r+m/2,b=20,x=a.current[e];if(y>.1&&x.length<b){const t=Math.floor(3*y);for(let n=0;n<t;n++){const t=Math.random()*Math.PI*2,n=.5+1.5*Math.random();x.push({x:g,y:v,vx:Math.cos(t)*n,vy:Math.sin(t)*n,life:1,maxLife:.5+.5*Math.random(),channelIndex:e})}}for(let a=x.length-1;a>=0;a--){const t=x[a];t.x+=t.vx,t.y+=t.vy;const n=g-t.x,s=v-t.y;if(Math.sqrt(n*n+s*s)>5&&(t.vx+=.01*n,t.vy+=.01*s),t.vx*=.98,t.vy*=.98,t.life-=.02,t.life<=0){x.splice(a,1);continue}const r=t.life,i=160+e/d*60,l=2+2*r;o.fillStyle=`hsla(${i}, 80%, 50%, ${.8*r})`,o.beginPath(),o.arc(t.x,t.y,l,0,2*Math.PI),o.fill(),o.fillStyle=`hsla(${i}, 80%, 50%, ${.2*r})`,o.beginPath(),o.arc(t.x,t.y,2*l,0,2*Math.PI),o.fill()}}n.current=requestAnimationFrame(f)};return f(),()=>{i=!1,n.current&&cancelAnimationFrame(n.current)}},[r,e,d,c]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border",children:bn.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},oN=({height:e=100,text:t="*** GREETINGS FLIES OUT TO....     AEROSOL   AFRIKA   ANDROMEDA   ATE BIT   ATLANTIS   BLACK MAIDEN   BOOZE DESIGN   BOOZOHOLICS   BYTERAPERS   CENSOR DESIGN   DA JORMAS  DCS   DEKADENCE   DEPTH   DESIRE   DIVINE STYLERS   DUREX   ELCREW   ELUDE   EPHIDRENA   EPSILON DESIGN   FAIRLIGHT   FATZONE   FIT   FLUSH  FUNKTION   GENESIS PROJECT   HACK N TRADE   HAUJOBB   HARD BOYLING BOYS   HOAXERS   LFT  IMPURE ASCII 1940  INSANE   INSTINCT   IRIS  JOSSYSTEM   JUDAS   KESO   LA PAZ   LAXATIVE EFFECTS   LEMON  LOONIES     MAHONEY   MANKIND  MAWI   MOODS PLATEAU   NATURE  NONAMENO   NUKLEUS   OFFENCE  ONSALA SECTOR     ONSLAUGHT   OUTBREAK   OXYRON   PACIF!C   PANDA DESIGN   PARADOX   PERFOMERS   PLANET JAZZ   POWERLINE   RAZOR 1911   REALITY   RELAPSE  RNO   RESISTANCE SCARAB   SCENESAT   SCOOPEX   SHARE AND ENJOY   SHAPE   SIGFLUP   SPACEBALLS   STRUTS SUBSPACE   STYLE   THE ELECTRONIC KNIGHTS   THE BLACK LOTUS   THE GANG   TITAN   TPOLM   TRAKTOR   TRIAD   TRSI   TULOU   UK SCENE ALLSTARS   UNIQUE   UNSTABLE LABEL   Y-CREW   AND   ZENON ***"})=>{const n=s.useRef(null),a=s.useRef(void 0),r=s.useRef(0),[o,i]=s.useState(800),{bpm:l,isPlaying:c}=Gf();return s.useEffect(()=>{const e=n.current;if(!e)return;const t=e.parentElement;if(!t)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(t),()=>a.disconnect()},[]),s.useEffect(()=>{const s=n.current;if(!s)return;const i=s.getContext("2d");if(!i)return;const d=window.devicePixelRatio||1;s.width=o*d,s.height=e*d,i.scale(d,d);let u=!0;const p=[];for(let t=0;t<200;t++)p.push({x:(Math.random()-.5)*o*2,y:(Math.random()-.5)*e*2,z:1e3*Math.random(),speed:.5+1.5*Math.random()});const h=Math.min(.4*e,32),m=.6*h,f=.2*e,y=2*(c?l/125:1);let g=0,v=1,b=0;const x=(t+"     ").repeat(5),w=()=>{if(!u)return;const n=em().getWaveform();let s=0;if(n&&n.length>0&&c){const e=Math.sqrt(n.reduce((e,t)=>e+t*t,0)/n.length);s=Math.min(1,10*e)}b+=.15*(s-b),i.fillStyle="#0a0a0b",i.fillRect(0,0,o,e);const l=o/2,d=e/2;for(const t of p){t.z-=t.speed*(1+1*b),t.z<=0&&(t.x=(Math.random()-.5)*o*2,t.y=(Math.random()-.5)*e*2,t.z=1e3);const n=200/t.z,a=l+t.x*n,s=d+t.y*n;if(a<0||a>o||s<0||s>e)continue;const r=Math.max(1,3*(1-t.z/1e3)),c=Math.floor(255*(1-t.z/1e3));i.fillStyle=`rgb(${.8*c}, ${.9*c}, ${c})`,i.beginPath(),i.arc(a,s,r,0,2*Math.PI),i.fill()}const k=Date.now()/1e3;v=1+.8*b,g=Math.sin(.5*k*v)*e*.3;const S=f;r.current+=y,r.current>m*(t.length+5)&&(r.current=0),i.font=`bold ${h}px monospace`,i.textBaseline="middle";for(let t=0;t<x.length;t++){const n=x[t];if(" "===n)continue;const a=o+t*m-r.current;if(a<-m||a>o+m)continue;const s=.035*(r.current+t*m),l=e/2+Math.sin(s)*S,c=i.createLinearGradient(0,g,0,e+g),d=30*k*v%360;c.addColorStop(0,`hsl(${d}, 100%, 60%)`),c.addColorStop(.25,`hsl(${(d+60)%360}, 100%, 70%)`),c.addColorStop(.5,`hsl(${(d+120)%360}, 100%, 70%)`),c.addColorStop(.75,`hsl(${(d+180)%360}, 100%, 70%)`),c.addColorStop(1,`hsl(${(d+240)%360}, 100%, 60%)`);const u=(d+.3*a)%360,p=10+8*b;i.shadowColor=`hsla(${u}, 100%, 50%, ${.5+.3*b})`,i.shadowBlur=p,i.fillStyle=c,i.fillText(n,a,l),i.shadowBlur=0,i.strokeStyle="rgba(0, 0, 0, 0.6)",i.lineWidth=2,i.strokeText(n,a,l)}a.current=requestAnimationFrame(w)};return w(),()=>{u=!1,a.current&&cancelAnimationFrame(a.current)}},[o,e,t]),bn.jsx("div",{className:"w-full h-full flex items-center justify-center bg-dark-bgPrimary rounded-md border border-dark-border overflow-hidden",children:bn.jsx("canvas",{ref:n,style:{width:`${o}px`,height:`${e}px`}})})},iN=e.memo(({label:e,value:t,onChange:n,color:a="#00d4aa",size:s="md",disabled:r=!1,title:o})=>{const i="cyan-lineart"===sy(e=>e.currentThemeId),l=i?"#00ffff":a,c=i?"#0a1a1f":"#1a1a1f",d=i?"#0a3333":"#333",u=i?"#0a6666":"#666",{width:p,height:h,fontSize:m}={sm:{width:36,height:18,fontSize:9},md:{width:44,height:22,fontSize:10}}[s];return bn.jsxs("div",{className:"toggle-container",style:{width:p+10,opacity:r?.4:1},children:[bn.jsx("div",{className:"toggle-label",style:{fontSize:m-1},children:e}),bn.jsx("button",{className:"toggle-switch "+(t?"toggle-on":"toggle-off"),onClick:()=>!r&&n(!t),disabled:r,title:o,style:{width:p,height:h,borderRadius:h/2,backgroundColor:t?l:c,border:`2px solid ${t?l:d}`,cursor:r?"not-allowed":"pointer"},children:bn.jsx("div",{className:"toggle-thumb",style:{width:h-6,height:h-6,borderRadius:"50%",backgroundColor:t?"#fff":u,transform:`translateX(${t?p-h+2:0}px)`,transition:"transform 0.15s ease-out, background-color 0.15s",boxShadow:t?`0 0 6px ${l}`:"none"}})})]})},(e,t)=>e.value===t.value&&e.label===t.label&&e.disabled===t.disabled&&e.color===t.color&&e.size===t.size);iN.displayName="Toggle";const lN=({onClose:e})=>{const{useHexNumbers:t,setUseHexNumbers:n,blankEmptyCells:a,setBlankEmptyCells:r,tb303Collapsed:o,setTB303Collapsed:i,oscilloscopeVisible:l,setOscilloscopeVisible:c,compactToolbar:d,setCompactToolbar:u}=jf(),{currentThemeId:p,setTheme:h}=sy(),{amigaLimits:m,setAmigaLimits:f,linearInterpolation:y,setLinearInterpolation:g,audioLatency:v,setAudioLatency:b,autoLatency:x,setAutoLatency:w,midiPolyphonic:k,setMidiPolyphonic:S}=Zh(),[M,N]=s.useState(!!document.fullscreenElement);s.useEffect(()=>{const e=()=>{N(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);return bn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:bn.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-lg shadow-xl",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[bn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-wide",children:"SETTINGS"}),bn.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none","aria-label":"Close",children:bn.jsx(Te,{size:16})})]}),bn.jsxs("div",{className:"p-4 space-y-6 max-h-[70vh] overflow-y-auto scrollbar-ft2",children:[bn.jsxs("section",{children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DISPLAY"}),bn.jsxs("div",{className:"space-y-3",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Theme:"}),bn.jsx("select",{value:p,onChange:e=>h(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:ny.map(e=>bn.jsx("option",{value:e.id,className:"bg-ft2-bg text-ft2-text",children:e.name},e.id))})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Number Format:"}),bn.jsxs("select",{value:t?"hex":"dec",onChange:e=>n("hex"===e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[bn.jsx("option",{value:"hex",className:"bg-ft2-bg text-ft2-text",children:"Hexadecimal (01, 02, 0A, 0F)"}),bn.jsx("option",{value:"dec",className:"bg-ft2-bg text-ft2-text",children:"Decimal (01, 02, 10, 15)"})]})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Blank Empty Cells:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Hide ---, .., ... on empty rows"})]}),bn.jsx(iN,{label:"",value:a,onChange:r,size:"sm"})]})]})]}),bn.jsxs("section",{children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"LAYOUT"}),bn.jsxs("div",{className:"space-y-3",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"TB-303 Panel:"}),bn.jsx(iN,{label:"",value:!o,onChange:e=>i(!e),size:"sm"})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Oscilloscope:"}),bn.jsx(iN,{label:"",value:l,onChange:c,size:"sm"})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Compact Toolbar:"}),bn.jsx(iN,{label:"",value:d,onChange:u,size:"sm"})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx(_t,{size:14,className:"text-ft2-textDim"}),bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Fullscreen:"})]}),bn.jsx(iN,{label:"",value:M,onChange:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},size:"sm"})]})]})]}),bn.jsxs("section",{children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"MIDI"}),bn.jsx("div",{className:"space-y-3",children:bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Polyphonic Mode:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Play multiple notes simultaneously"})]}),bn.jsx(iN,{label:"",value:k,onChange:S,size:"sm"})]})})]}),bn.jsxs("section",{children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"ENGINE"}),bn.jsxs("div",{className:"space-y-3",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Amiga Limits:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Clamp periods to 113-856"})]}),bn.jsx(iN,{label:"",value:m,onChange:f,size:"sm"})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Sample Interpolation:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Linear (clean) vs None (crunchy)"})]}),bn.jsx(iN,{label:"",value:y,onChange:g,size:"sm"})]}),bn.jsxs("div",{className:"flex items-center justify-between border-t border-ft2-border/30 pt-3",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Audio Latency Mode:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Low latency for live jamming vs stable playback"})]}),bn.jsxs("select",{value:v,onChange:e=>b(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[bn.jsx("option",{value:"interactive",children:"Interactive (10ms)"}),bn.jsx("option",{value:"balanced",children:"Balanced (50ms)"}),bn.jsx("option",{value:"playback",children:"Stable (150ms)"})]})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Dynamic Latency:"}),bn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Instant (10ms) when stopped, stable when playing"})]}),bn.jsx(iN,{label:"",value:x,onChange:w,size:"sm"})]})]})]}),bn.jsx("section",{className:"pt-4 border-t border-ft2-border",children:bn.jsxs("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1",children:[bn.jsx("div",{children:"DEViLBOX v1.0.0"}),bn.jsx("div",{children:"TB-303 Acid Tracker"}),bn.jsx("div",{className:"text-ft2-highlight",children:"Settings are saved automatically"})]})})]}),bn.jsx("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-end",children:bn.jsx("button",{onClick:e,className:"px-4 py-1.5 bg-ft2-cursor border border-ft2-cursor text-ft2-bg text-xs font-bold hover:bg-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none",children:"CLOSE"})})]})})},cN=({onClose:e})=>{const{swing:t,setSwing:n,grooveSteps:a,setGrooveSteps:s,jitter:r,setJitter:o,useMpcScale:i,setUseMpcScale:l,grooveTemplateId:c,setGrooveTemplate:d}=Gf();return bn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 backdrop-blur-sm",children:bn.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[bn.jsx("div",{className:"flex items-center gap-2",children:bn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-widest uppercase",children:"Groove & Swing Settings"})}),bn.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none",children:bn.jsx(Te,{size:18})})]}),bn.jsxs("div",{className:"flex-1 overflow-hidden p-0 flex flex-col md:flex-row min-h-0",children:[bn.jsx("div",{className:"w-full md:w-72 flex flex-col bg-dark-bgSecondary border-r border-ft2-border min-h-0",children:bn.jsxs("section",{className:"flex flex-col flex-1 min-h-0 p-6",children:[bn.jsx("h3",{className:"flex-shrink-0 text-ft2-highlight text-xs font-bold mb-4 tracking-wider uppercase flex items-center gap-2",children:"Groove Templates"}),bn.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-ft2 space-y-4",children:["straight","shuffle","swing","funk","hip-hop","custom"].map(e=>{const t=Ra.filter(t=>t.category===e);return 0===t.length?null:bn.jsxs("div",{className:"space-y-1",children:[bn.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase px-1 pb-1 border-b border-dark-border",children:e}),bn.jsx("div",{className:"grid grid-cols-1 gap-1 pt-1",children:t.map(e=>bn.jsxs("button",{onClick:()=>d(e.id),className:"w-full text-left px-3 py-2 text-xs font-mono transition-all rounded "+(e.id===c?"bg-accent-primary text-white font-bold shadow-glow-sm":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary bg-dark-bgSecondary border border-transparent hover:border-ft2-border"),children:[bn.jsxs("div",{className:"flex justify-between items-center",children:[bn.jsx("span",{children:e.name}),e.id===c&&bn.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]}),e.description&&bn.jsx("div",{className:"text-[10px] mt-0.5 leading-tight "+(e.id===c?"text-white":"opacity-60"),children:e.description})]},e.id))})]},e)})})]})}),bn.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-ft2 p-6 space-y-8 min-h-0",children:[bn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Global Intensity"}),bn.jsx("div",{className:"flex items-center gap-2",children:bn.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer group bg-dark-bgTertiary px-2 py-1 rounded border border-ft2-border hover:border-accent-primary transition-colors",title:"Use authentic MPC 50-75% scale",children:[bn.jsx("input",{type:"checkbox",checked:i,onChange:e=>l(e.target.checked),className:"w-3 h-3 accent-accent-primary"}),bn.jsx("span",{className:"text-[10px] text-text-muted group-hover:text-text-secondary font-bold uppercase",children:"MPC SCALE"})]})})]}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsxs("div",{className:"flex justify-between items-end",children:[bn.jsx("span",{className:"text-[10px] text-text-secondary font-mono uppercase",children:"Groove Amount"}),bn.jsx("span",{className:"text-xl font-mono text-accent-primary font-bold leading-none",children:i?t:`${t}%`})]}),bn.jsx("input",{type:"range",min:i?50:0,max:i?75:200,value:t,onChange:e=>n(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),n(i?50:100)},className:"w-full h-2 accent-accent-primary cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),bn.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[bn.jsx("span",{children:i?"50%":"Fixed"}),bn.jsx("span",{children:i?"66%":"100%"}),bn.jsx("span",{children:i?"75%":"200%"})]}),bn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:i?"Authentic MPC timing. 66% is the perfect triplet ratio. Right-click to reset.":"Scales template intensity. 100% is standard. Right-click to reset."})]})]}),bn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[bn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Swing Resolution"}),bn.jsx("div",{className:"grid grid-cols-3 gap-2",children:[2,4,8,16,32,64].map(e=>bn.jsxs("button",{onClick:()=>{s(e),"straight"!==c&&d("straight")},className:"px-2 py-2 text-[10px] font-mono border rounded transition-all "+(a===e&&"straight"===c?"bg-accent-primary border-accent-primary text-white font-bold":"bg-dark-bgTertiary border-ft2-border text-text-secondary hover:border-text-muted"),children:[2===e?"16th":4===e?"8th":8===e?"4th":e/16+"b",bn.jsxs("div",{className:"text-[8px] opacity-60",children:["(",e," stp)"]})]},e))}),bn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed",children:"Determines which notes in the pattern cycle are swung. 16th is standard for electronic music."})]}),bn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("h3",{className:"text-cyan-400 text-xs font-bold tracking-wider uppercase",children:"Humanization (Jitter)"}),bn.jsxs("span",{className:"text-lg font-mono text-cyan-400 font-bold leading-none",children:[r,"%"]})]}),bn.jsxs("div",{className:"space-y-2",children:[bn.jsx("input",{type:"range",min:"0",max:"100",value:r,onChange:e=>o(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),o(0)},className:"w-full h-2 accent-cyan-500 cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),bn.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[bn.jsx("span",{children:"Robotic"}),bn.jsx("span",{children:"Loose"}),bn.jsx("span",{children:"Drunken"})]}),bn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:"Adds random micro-timing offsets (0-10ms) to every note. Simulates unstable vintage clocks or human performance."})]})]})]})]}),bn.jsxs("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-between items-center",children:[bn.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[bn.jsx(It,{size:12,className:"text-ft2-highlight"}),bn.jsx("span",{children:"Groove affects all patterns globally"})]}),bn.jsx("button",{onClick:e,className:"px-6 py-1.5 bg-accent-primary border border-accent-primary text-white text-xs font-bold hover:bg-accent-secondary hover:border-accent-secondary transition-all rounded shadow-glow-sm focus:outline-none uppercase tracking-widest",children:"Accept"})]})]})})};e.createContext,s.createContext();const dN=e=>"string"==typeof e,uN=()=>{let e,t;const n=new Promise((n,a)=>{e=n,t=a});return n.resolve=e,n.reject=t,n},pN=e=>null==e?"":""+e,hN=/###/g,mN=e=>e&&e.indexOf("###")>-1?e.replace(hN,"."):e,fN=e=>!e||dN(e),yN=(e,t,n)=>{const a=dN(t)?t.split("."):t;let s=0;for(;s<a.length-1;){if(fN(e))return{};const t=mN(a[s]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return fN(e)?{}:{obj:e,k:mN(a[s])}},gN=(e,t,n)=>{const{obj:a,k:s}=yN(e,t,Object);if(void 0!==a||1===t.length)return void(a[s]=n);let r=t[t.length-1],o=t.slice(0,t.length-1),i=yN(e,o,Object);for(;void 0===i.obj&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),i=yN(e,o,Object),null!=i&&i.obj&&typeof i.obj[`${i.k}.${r}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${r}`]=n},vN=(e,t)=>{const{obj:n,k:a}=yN(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,a))return n[a]},bN=(e,t,n)=>{for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?dN(e[a])||e[a]instanceof String||dN(t[a])||t[a]instanceof String?n&&(e[a]=t[a]):bN(e[a],t[a],n):e[a]=t[a]);return e},xN=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var wN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const kN=e=>dN(e)?e.replace(/[&<>"'\/]/g,e=>wN[e]):e;const SN=[" ",",","?","!",";"],MN=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20),NN=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const a=t.split(n);let s=e;for(let r=0;r<a.length;){if(!s||"object"!=typeof s)return;let e,t="";for(let o=r;o<a.length;++o)if(o!==r&&(t+=n),t+=a[o],e=s[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&o<a.length-1)continue;r+=o-r+1;break}s=e}return s},CN=e=>null==e?void 0:e.replace("_","-"),EN={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,a;null==(a=null==(n=null==console?void 0:console[e])?void 0:n.apply)||a.call(n,console,t)}};class PN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||EN,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,a){return a&&!this.debug?null:(dN(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new PN(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new PN(this.logger,e)}}var TN=new PN;class AN{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,a]=e;for(let s=0;s<a;s++)t(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[a,s]=t;for(let r=0;r<s;r++)a.apply(a,[e,...n])})}}class IN extends AN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){var a,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,i=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):dN(n)&&o?l.push(...n.split(o)):l.push(n)));const c=vN(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&i&&dN(n)?NN(null==(s=null==(a=this.data)?void 0:a[e])?void 0:s[t],n,o):c}addResource(e,t,n,a){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const r=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator;let o=[e,t];n&&(o=o.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(o=e.split("."),a=t,t=o[1]),this.addNamespaces(t),gN(this.data,o,a),s.silent||this.emit("added",e,t,n,a)}addResources(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const s in n)(dN(n[s])||Array.isArray(n[s]))&&this.addResource(e,t,s,n[s],{silent:!0});a.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,a,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),a=n,n=t,t=o[1]),this.addNamespaces(t);let i=vN(this.data,o)||{};r.skipCopy||(n=JSON.parse(JSON.stringify(n))),a?bN(i,n,s):i={...i,...n},gN(this.data,o,i),r.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var _N={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,a,s){return e.forEach(e=>{var r;t=(null==(r=this.processors[e])?void 0:r.process(t,n,a,s))??t}),t}};const ON={},FN=e=>!dN(e)&&"boolean"!=typeof e&&"number"!=typeof e;class DN extends AN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),((e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=TN.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return void 0!==(null==n?void 0:n.res)}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const r=n&&e.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,n)=>{t=t||"",n=n||"";const a=SN.filter(e=>t.indexOf(e)<0&&n.indexOf(e)<0);if(0===a.length)return!0;const s=MN.getRegExp(`(${a.map(e=>"?"===e?"\\?":e).join("|")})`);let r=!s.test(e);if(!r){const t=e.indexOf(n);t>0&&!s.test(e.substring(0,t))&&(r=!0)}return r})(e,n,a));if(r&&!o){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:dN(s)?[s]:s};const r=e.split(n);(n!==a||n===a&&this.options.ns.indexOf(r[0])>-1)&&(s=r.shift()),e=r.join(a)}return{key:e,namespaces:dN(s)?[s]:s}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:r,namespaces:o}=this.extractFromKey(e[e.length-1],t),i=o[o.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return a?{res:`${i}${e}${r}`,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:i,usedParams:this.getUsedParamsDetails(t)}:`${i}${e}${r}`}return a?{res:r,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:i,usedParams:this.getUsedParamsDetails(t)}:r}const d=this.resolve(e,t);let u=null==d?void 0:d.res;const p=(null==d?void 0:d.usedKey)||r,h=(null==d?void 0:d.exactUsedKey)||r,m=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,f=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==t.count&&!dN(t.count),g=DN.hasDefaultValue(t),v=y?this.pluralResolver.getSuffix(l,t.count,t):"",b=t.ordinal&&y?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",x=y&&!t.ordinal&&0===t.count,w=x&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${v}`]||t[`defaultValue${b}`]||t.defaultValue;let k=u;f&&!u&&g&&(k=w);const S=FN(k),M=Object.prototype.toString.apply(k);if(!(f&&k&&S&&["[object Number]","[object Function]","[object RegExp]"].indexOf(M)<0)||dN(m)&&Array.isArray(k))if(f&&dN(m)&&Array.isArray(u))u=u.join(m),u&&(u=this.extendTranslation(u,e,t,n));else{let a=!1,o=!1;!this.isValidLookup(u)&&g&&(a=!0,u=w),this.isValidLookup(u)||(o=!0,u=r);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&o?void 0:u,p=g&&w!==u&&this.options.updateMissing;if(o||a||p){if(this.logger.log(p?"updateKey":"missingKey",l,i,r,p?w:u),s){const e=this.resolve(r,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const a=(e,n,a)=>{var s;const r=g&&a!==u?a:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,i,n,r,p,t):null!=(s=this.backendConnector)&&s.saveMissing&&this.backendConnector.saveMissing(e,i,n,r,p,t),this.emit("missingKey",e,i,n,u)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{const n=this.pluralResolver.getSuffixes(e,t);x&&t[`defaultValue${this.options.pluralSeparator}zero`]&&n.indexOf(`${this.options.pluralSeparator}zero`)<0&&n.push(`${this.options.pluralSeparator}zero`),n.forEach(n=>{a([e],r+n,t[`defaultValue${n}`]||w)})}):a(e,r,w))}u=this.extendTranslation(u,e,t,d,n),o&&u===r&&this.options.appendNamespaceToMissingKey&&(u=`${i}:${r}`),(o||a)&&this.options.parseMissingKeyHandler&&(u=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${i}:${r}`:r,a?u:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,k,{...t,ns:o}):`key '${r} (${this.language})' returned an object instead of string.`;return a?(d.res=e,d.usedParams=this.getUsedParamsDetails(t),d):e}if(s){const e=Array.isArray(k),n=e?[]:{},a=e?h:p;for(const r in k)if(Object.prototype.hasOwnProperty.call(k,r)){const e=`${a}${s}${r}`;n[r]=g&&!u?this.translate(e,{...t,defaultValue:FN(w)?w[r]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...t,joinArrays:!1,ns:o}),n[r]===e&&(n[r]=k[r])}u=n}}return a?(d.res=u,d.usedParams=this.getUsedParamsDetails(t),d):u}extendTranslation(e,t,n,a,s){var r,o,i=this;if(null!=(r=this.i18nFormat)&&r.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const r=dN(e)&&(void 0!==(null==(o=null==n?void 0:n.interpolation)?void 0:o.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(r){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=n.replace&&!dN(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,n.lng||this.language||a.usedLng,n),r){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(n.nest=!1)}!n.lng&&a&&a.res&&(n.lng=this.language||a.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(null==s?void 0:s[0])!==a[0]||n.context?i.translate(...a,t):(i.logger.warn(`It seems you are nesting recursively key: ${a[0]} in key: ${t[0]}`),null)},n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,c=dN(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==n.applyPostProcessor&&(e=_N.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,a,s,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dN(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const i=this.extractFromKey(e,o),l=i.key;n=l;let c=i.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==o.count&&!dN(o.count),u=d&&!o.ordinal&&0===o.count,p=void 0!==o.context&&(dN(o.context)||"number"==typeof o.context)&&""!==o.context,h=o.lngs?o.lngs:this.languageUtils.toResolveHierarchy(o.lng||this.language,o.fallbackLng);c.forEach(e=>{var i,c;this.isValidLookup(t)||(r=e,!ON[`${h[0]}-${e}`]&&null!=(i=this.utils)&&i.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(r))&&(ON[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${h.join(", ")}" won't get resolved as namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(n=>{var r;if(this.isValidLookup(t))return;s=n;const i=[l];if(null!=(r=this.i18nFormat)&&r.addLookupKeys)this.i18nFormat.addLookupKeys(i,l,n,e,o);else{let e;d&&(e=this.pluralResolver.getSuffix(n,o.count,o));const t=`${this.options.pluralSeparator}zero`,a=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(i.push(l+e),o.ordinal&&0===e.indexOf(a)&&i.push(l+e.replace(a,this.options.pluralSeparator)),u&&i.push(l+t)),p){const n=`${l}${this.options.contextSeparator}${o.context}`;i.push(n),d&&(i.push(n+e),o.ordinal&&0===e.indexOf(a)&&i.push(n+e.replace(a,this.options.pluralSeparator)),u&&i.push(n+t))}}let c;for(;c=i.pop();)this.isValidLookup(t)||(a=c,t=this.getResource(n,e,c,o))}))})}),{res:t,usedKey:n,exactUsedKey:a,usedLng:s,usedNS:r}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){var a;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(a=this.i18nFormat)&&a.getResource?this.i18nFormat.getResource(e,t,n,s):this.resourceStore.getResource(e,t,n,s)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!dN(e.replace);let a=n?e.replace:e;if(n&&typeof e.count<"u"&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!n){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class RN{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=TN.create("languageUtils")}getScriptPartFromCode(e){if(!(e=CN(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=CN(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(dN(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const n=this.getScriptPartFromCode(e);if(this.isSupportedCode(n))return t=n;const a=this.getLanguagePartFromCode(e);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(e=>e===a?e:e.indexOf("-")<0&&a.indexOf("-")<0||!(e.indexOf("-")>0&&a.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===a||0===e.indexOf(a)&&a.length>1)?void 0:e)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),dN(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],s=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return dN(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):dN(e)&&s(this.formatLanguageCode(e)),n.forEach(e=>{a.indexOf(e)<0&&s(this.formatLanguageCode(e))}),a}}const jN={zero:0,one:1,two:2,few:3,many:4,other:5},LN={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class BN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=TN.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=CN("dev"===e?"en":e),a=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:n,type:a});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let r;try{r=new Intl.PluralRules(n,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),LN;if(!e.match(/-|_/))return LN;const n=this.languageUtils.getLanguagePartFromCode(e);r=this.getRule(n,t)}return this.pluralRulesCache[s]=r,r}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort((e,t)=>jN[e]-jN[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=this.getRule(e,n);return a?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const VN=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=((e,t,n)=>{const a=vN(e,n);return void 0!==a?a:vN(t,n)})(e,t,n);return!r&&s&&dN(n)&&(r=NN(e,n,a),void 0===r&&(r=NN(t,n,a))),r},zN=e=>e.replace(/\$/g,"$$$$");class UN{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=TN.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:a,prefix:s,prefixEscaped:r,suffix:o,suffixEscaped:i,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:u,nestingPrefixEscaped:p,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:f,maxReplaces:y,alwaysFormat:g}=e.interpolation;this.escape=void 0!==t?t:kN,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==a&&a,this.prefix=s?xN(s):r||"{{",this.suffix=o?xN(o):i||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=u?xN(u):p||xN("$t("),this.nestingSuffix=h?xN(h):m||xN(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=y||1e3,this.alwaysFormat=void 0!==g&&g,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,a){var s;let r,o,i;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const s=VN(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(s,void 0,n,{...a,...t,interpolationkey:e}):s}const s=e.split(this.formatSeparator),r=s.shift().trim(),o=s.join(this.formatSeparator).trim();return this.format(VN(t,l,r,this.options.keySeparator,this.options.ignoreJSONStructure),o,n,{...a,...t,interpolationkey:r})};this.resetRegExp();const d=(null==a?void 0:a.missingInterpolationHandler)||this.options.missingInterpolationHandler,u=void 0!==(null==(s=null==a?void 0:a.interpolation)?void 0:s.skipOnVariables)?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>zN(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?zN(this.escape(e)):zN(e)}].forEach(t=>{for(i=0;r=t.regex.exec(e);){const n=r[1].trim();if(o=c(n),void 0===o)if("function"==typeof d){const t=d(e,r,a);o=dN(t)?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,n))o="";else{if(u){o=r[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),o=""}else!dN(o)&&!this.useRawValueToEscape&&(o=pN(o));const s=t.safeValue(o);if(e=e.replace(r[0],s),u?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),e}nest(e,t){let n,a,s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=(e,t)=>{const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const a=e.split(new RegExp(`${n}[ ]*{`));let r=`{${a[1]}`;e=a[0],r=this.interpolate(r,s);const o=r.match(/'/g),i=r.match(/"/g);(((null==o?void 0:o.length)??0)%2==0&&!i||i.length%2!=0)&&(r=r.replace(/'/g,'"'));try{s=JSON.parse(r),t&&(s={...t,...s})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${n}${r}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let i=[];s={...r},s=s.replace&&!dN(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),i=e,l=!0}if(a=t(o.call(this,n[1].trim(),s),s),a&&n[0]===e&&!dN(a))return a;dN(a)||(a=pN(a)),a||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),a=""),l&&(a=i.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:n[1].trim()}),a.trim())),e=e.replace(n[0],a),this.regexp.lastIndex=0}return e}}const GN=e=>{const t={};return(n,a,s)=>{let r=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(r={...r,[s.interpolationkey]:void 0});const o=a+JSON.stringify(r);let i=t[o];return i||(i=e(CN(a),s),t[o]=i),i(n)}};class KN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=TN.create("formatter"),this.options=e,this.formats={number:GN((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)}),currency:GN((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)}),datetime:GN((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)}),relativetime:GN((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")}),list:GN((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=GN(t)}format(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(e=>e.indexOf(")")>-1)){const e=s.findIndex(e=>e.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,e)].join(this.formatSeparator)}return s.reduce((e,t)=>{var s;const{formatName:r,formatOptions:o}=(e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const s=a[1].substring(0,a[1].length-1);"currency"===t&&s.indexOf(":")<0?n.currency||(n.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?n.range||(n.range=s.trim()):s.split(";").forEach(e=>{if(e){const[t,...a]=e.split(":"),s=a.join(":").trim().replace(/^'+|'+$/g,""),r=t.trim();n[r]||(n[r]=s),"false"===s&&(n[r]=!1),"true"===s&&(n[r]=!0),isNaN(s)||(n[r]=parseInt(s,10))}})}return{formatName:t,formatOptions:n}})(t);if(this.formats[r]){let t=e;try{const i=(null==(s=null==a?void 0:a.formatParams)?void 0:s[a.interpolationkey])||{},l=i.locale||i.lng||a.locale||a.lng||n;t=this.formats[r](e,l,{...o,...a,...i})}catch(i){this.logger.warn(i)}return t}return this.logger.warn(`there was no format function for ${r}`),e},e)}}class HN extends AN{constructor(e,t,n){var a,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=r,this.logger=TN.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],null==(s=null==(a=this.backend)?void 0:a.init)||s.call(a,n,r.backend,r)}queueLoad(e,t,n,a){const s={},r={},o={},i={};return e.forEach(e=>{let a=!0;t.forEach(t=>{const o=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===r[o]&&(r[o]=!0):(this.state[o]=1,a=!1,void 0===r[o]&&(r[o]=!0),void 0===s[o]&&(s[o]=!0),void 0===i[t]&&(i[t]=!0)))}),a||(o[e]=!0)}),(Object.keys(s).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(s),pending:Object.keys(r),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(i)}}loaded(e,t,n){const a=e.split("|"),s=a[0],r=a[1];t&&this.emit("failedLoading",s,r,t),!t&&n&&this.store.addResourceBundle(s,r,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const o={};this.queue.forEach(n=>{((e,t,n)=>{const{obj:a,k:s}=yN(e,t,Object);a[s]=a[s]||[],a[s].push(n)})(n.loaded,[s],r),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach(e=>{o[e]||(o[e]={});const t=n.loaded[e];t.length&&t.forEach(t=>{void 0===o[e][t]&&(o[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,r=arguments.length>5?arguments[5]:void 0;if(!e.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:a,wait:s,callback:r});this.readingCalls++;const o=(o,i)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}o&&i&&a<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,n,a+1,2*s,r)},s):r(o,i)},i=this.backend[n].bind(this.backend);if(2!==i.length)return i(e,t,o);try{const n=i(e,t);n&&"function"==typeof n.then?n.then(e=>o(null,e)).catch(o):o(null,n)}catch(l){o(l)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();dN(e)&&(e=this.languageUtils.toResolveHierarchy(e)),dN(t)&&(t=[t]);const s=this.queueLoad(e,t,n,a);if(!s.toLoad.length)return s.pending.length||a(),null;s.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),a=n[0],s=n[1];this.read(a,s,"read",void 0,void 0,(n,r)=>{n&&this.logger.warn(`${t}loading namespace ${s} for language ${a} failed`,n),!n&&r&&this.logger.log(`${t}loaded namespace ${s} for language ${a}`,r),this.loaded(e,n,r)})}saveMissing(e,t,n,a,s){var r,o,i,l,c;let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(o=null==(r=this.services)?void 0:r.utils)||!o.hasLoadedNamespace||null!=(l=null==(i=this.services)?void 0:i.utils)&&l.hasLoadedNamespace(t)){if(null!=n&&""!==n){if(null!=(c=this.backend)&&c.create){const r={...d,isUpdate:s},o=this.backend.create.bind(this.backend);if(o.length<6)try{let s;s=5===o.length?o(e,t,n,a,r):o(e,t,n,a),s&&"function"==typeof s.then?s.then(e=>u(null,e)).catch(u):u(null,s)}catch(p){u(p)}else o(e,t,n,a,u,r)}!e||!e[0]||this.store.addResource(e[0],t,n,a)}}else this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const WN=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),dN(e[1])&&(t.defaultValue=e[1]),dN(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),$N=e=>{var t,n;return dN(e.ns)&&(e.ns=[e.ns]),dN(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),dN(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},qN=()=>{};class YN extends AN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=$N(e),this.services={},this.logger=TN,this.modules={external:[]},n=this,Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(e=>{"function"==typeof n[e]&&(n[e]=n[e].bind(n))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}var n}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(dN(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const a=WN();this.options={...a,...this.options,...$N(t)},this.options.interpolation={...a.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?TN.init(s(this.modules.logger),this.options):TN.init(null,this.options),t=this.modules.formatter?this.modules.formatter:KN;const n=new RN(this.options);this.store=new IN(this.options.resources,this.options);const r=this.services;r.logger=TN,r.resourceStore=this.store,r.languageUtils=n,r.pluralResolver=new BN(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===a.interpolation.format)&&(r.formatter=s(t),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new UN(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new HN(s(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e.emit(t,...a)}),this.modules.languageDetector&&(r.languageDetector=s(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=s(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new DN(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e.emit(t,...a)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,n||(n=qN),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const r=uN(),o=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),r.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),r}loadResources(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qN;const s=dN(e)?e:this.language;if("function"==typeof e&&(a=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==s?void 0:s.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return a();const e=[],r=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};s?r(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>r(e)),null==(n=null==(t=this.options.preload)?void 0:t.forEach)||n.call(t,e=>r(e)),this.services.backendConnector.load(e,this.options.ns,e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),a(e)})}else a(null)}reloadResources(e,t,n){const a=uN();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=qN),this.services.backendConnector.reload(e,t,e=>{a.resolve(),n(e)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&_N.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const a=uN();this.emit("languageChanging",e);const s=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},r=(r,o)=>{o?this.isLanguageChangingTo===e&&(s(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,a.resolve(function(){return n.t(...arguments)}),t&&t(r,function(){return n.t(...arguments)})},o=t=>{var n,a;!e&&!t&&this.services.languageDetector&&(t=[]);const o=this.services.languageUtils.getBestMatchFromCodes(dN(t)?[t]:t);o&&(this.language||s(o),this.translator.language||this.translator.changeLanguage(o),null==(a=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||a.call(n,o)),this.loadResources(o,e=>{r(e,o)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),a}getFixedT(e,t,n){var a=this;const s=function(e,t){let r;if("object"!=typeof t){for(var o=arguments.length,i=new Array(o>2?o-2:0),l=2;l<o;l++)i[l-2]=arguments[l];r=a.options.overloadTranslationOptionHandler([e,t].concat(i))}else r={...t};r.lng=r.lng||s.lng,r.lngs=r.lngs||s.lngs,r.ns=r.ns||s.ns,""!==r.keyPrefix&&(r.keyPrefix=r.keyPrefix||n||s.keyPrefix);const c=a.options.keySeparator||".";let d;return d=r.keyPrefix&&Array.isArray(e)?e.map(e=>`${r.keyPrefix}${c}${e}`):r.keyPrefix?`${r.keyPrefix}${c}${e}`:e,a.t(d,r)};return dN(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=n,s}t(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return null==(e=this.translator)?void 0:e.translate(...n)}exists(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return null==(e=this.translator)?void 0:e.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const r=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,r);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(n,e)&&(!a||r(s,e)))}loadNamespaces(e,t){const n=uN();return this.options.ns?(dN(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=uN();dN(e)&&(e=[e]);const a=this.options.preload||[],s=e.filter(e=>a.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return s.length?(this.options.preload=a.concat(s),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const a=(null==(n=this.services)?void 0:n.languageUtils)||new RN(WN());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(a.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new YN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qN;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},s=new YN(a);if((void 0!==e.debug||void 0!==e.prefix)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(e=>{s[e]=this[e]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},n){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce((n,a)=>(n[a]={...e[t][a]},n),{})),{});s.store=new IN(e,a),s.services.resourceStore=s.store}return s.translator=new DN(s.services,a),s.translator.on("*",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];s.emit(e,...n)}),s.init(a,t),s.translator.options=a,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const XN=YN.createInstance();function QN(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}XN.createInstance=YN.createInstance,XN.createInstance,XN.dir,XN.init,XN.loadResources,XN.reloadResources,XN.use,XN.changeLanguage,XN.getFixedT,XN.t,XN.exists,XN.setDefaultNamespace,XN.hasLoadedNamespace,XN.loadNamespaces,XN.loadLanguages,s.createContext(()=>e=>e),s.createContext(),s.createContext(),s.createContext(),s.createContext();var ZN,JN,eC,tC,nC,aC={exports:{}};function sC(){if(JN)return ZN;JN=1;return ZN="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function rC(){if(tC)return eC;tC=1;var e=sC();function t(){}function n(){}return n.resetWarningCache=t,eC=function(){function a(t,n,a,s,r,o){if(o!==e){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function s(){return a}a.isRequired=a;var r={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:s,element:a,elementType:a,instanceOf:s,node:a,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:n,resetWarningCache:t};return r.PropTypes=r,r}}function oC(){return nC||(nC=1,aC.exports=rC()()),aC.exports}const iC=QN(oC());iC.bool.isRequired,iC.func.isRequired;const lC=(e,t,n)=>{const a=e[t];try{return void new URL(a)}catch{return new Error(`Invalid prop \`${t}\` supplied to \`${n}\`. Expected a valid URL but received \`${a}\`.`)}};iC.arrayOf(iC.shape({name:iC.string.isRequired,isDirectory:iC.bool.isRequired,path:iC.string.isRequired,updatedAt:(e,t,n)=>{const a=e[t];if(a&&isNaN(Date.parse(a)))return new Error(`Invalid prop \`${t}\` supplied to \`${n}\`. Expected a valid date string (ISO 8601) but received \`${a}\`.`)},size:iC.number})).isRequired,iC.shape({url:lC,headers:iC.objectOf(iC.string),method:iC.oneOf(["POST","PUT"])}),iC.bool,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.func,iC.oneOf(["grid","list"]),iC.number,iC.bool,iC.string,iC.oneOfType([iC.string,iC.number]),iC.oneOfType([iC.string,iC.number]),iC.string,iC.func,iC.string,iC.string,iC.string,iC.shape({create:iC.bool,upload:iC.bool,move:iC.bool,copy:iC.bool,rename:iC.bool,download:iC.bool,delete:iC.bool}),iC.bool,iC.bool,iC.string,iC.object,iC.func;const cC="projects";const dC=new class{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise||(this.initPromise=new Promise((e,t)=>{const n=indexedDB.open("devilbox-library",1);n.onerror=()=>{t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(cC)){const e=t.createObjectStore(cC,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("modifiedAt","modifiedAt",{unique:!1})}}})),this.initPromise}async ensureDb(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async saveProject(e,t,n){const a=await this.ensureDb(),s=n||`project-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r=JSON.stringify(t),o={id:s,name:e,data:r,size:r.length,createdAt:n&&(await this.getProject(n))?.createdAt||new Date,modifiedAt:new Date};return new Promise((e,t)=>{const n=a.transaction([cC],"readwrite").objectStore(cC).put(o);n.onsuccess=()=>{e(s)},n.onerror=()=>{t(n.error)}})}async getProject(e){const t=await this.ensureDb();return new Promise((n,a)=>{const s=t.transaction([cC],"readonly").objectStore(cC).get(e);s.onsuccess=()=>{n(s.result||null)},s.onerror=()=>{a(s.error)}})}async loadProject(e){const t=await this.getProject(e);if(!t)return null;try{return JSON.parse(t.data)}catch(n){return null}}async deleteProject(e){const t=await this.ensureDb();return new Promise((n,a)=>{const s=t.transaction([cC],"readwrite").objectStore(cC).delete(e);s.onsuccess=()=>{n()},s.onerror=()=>{a(s.error)}})}async listProjects(){const e=await this.ensureDb();return new Promise((t,n)=>{const a=e.transaction([cC],"readonly").objectStore(cC).getAll();a.onsuccess=()=>{const e=a.result.map(e=>({id:e.id,name:e.name,size:e.size,createdAt:e.createdAt,modifiedAt:e.modifiedAt,thumbnail:e.thumbnail}));e.sort((e,t)=>new Date(t.modifiedAt).getTime()-new Date(e.modifiedAt).getTime()),t(e)},a.onerror=()=>{n(a.error)}})}async renameProject(e,t){const n=await this.getProject(e);if(!n)throw new Error("Project not found");n.name=t,n.modifiedAt=new Date;const a=await this.ensureDb();return new Promise((e,t)=>{const s=a.transaction([cC],"readwrite").objectStore(cC).put(n);s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}async duplicateProject(e){const t=await this.getProject(e);if(!t)throw new Error("Project not found");const n=JSON.parse(t.data);return this.saveProject(`${t.name} (Copy)`,n)}async exportProject(e){const t=await this.getProject(e);if(!t)throw new Error("Project not found");return new Blob([t.data],{type:"application/json"})}async importProject(e,t){const n=JSON.parse(t);return this.saveProject(e,n)}async getStorageUsed(){return(await this.listProjects()).reduce((e,t)=>e+t.size,0)}async clearAll(){const e=await this.ensureDb();return new Promise((t,n)=>{const a=e.transaction([cC],"readwrite").objectStore(cC).clear();a.onsuccess=()=>{t()},a.onerror=()=>{n(a.error)}})}},uC=()=>"showOpenFilePicker"in window&&"showDirectoryPicker"in window;let pC=null;function hC(){return pC}async function mC(e,t){const n=await e.createWritable();await n.write(t),await n.close()}const fC=[".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx"];const yC=({isOpen:e,onClose:t,onLoad:n,onLoadTrackerModule:a,mode:r,currentProjectData:o,suggestedFilename:i="untitled.dbx"})=>{const[l,c]=s.useState("bundled"),[d,u]=s.useState([]),[p,h]=s.useState(!1),[m,f]=s.useState(null),[y,g]=s.useState(null),[v,b]=s.useState(i),[x,w]=s.useState(!1),[k,S]=s.useState("");s.useEffect(()=>{w(uC()&&!!hC())},[e]);const M=s.useCallback(async()=>{h(!0),f(null);try{let e=[];if("filesystem"===l){const t=hC();if(t){const n=await async function(e,t){const n=e||pC;if(!n)throw new Error("No directory handle available");const a=[];for await(const[s,r]of n.entries()){const e="directory"===r.kind;let o,i;if(!e&&t&&t.length>0){const e="."+s.split(".").pop()?.toLowerCase();if(!t.includes(e))continue}if(!e)try{const e=await r.getFile();o=e.size,i=new Date(e.lastModified)}catch{}a.push({name:s,path:`${n.name}/${s}`,isDirectory:e,size:o,modifiedAt:i,handle:r})}return a.sort((e,t)=>e.isDirectory!==t.isDirectory?e.isDirectory?-1:1:e.name.localeCompare(t.name)),a}(t,[".dbx",".xml",...fC]);e=n.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt,source:"filesystem",handle:e.handle}))}}else if("bundled"===l){const t="/DEViLBOX/";if(""===k){e=[{id:"data/songs",name:"songs",isDirectory:!0,path:"data/songs",source:"bundled"},{id:"data/samples",name:"samples",isDirectory:!0,path:"data/samples",source:"bundled"},{id:"data/instruments",name:"instruments",isDirectory:!0,path:"data/instruments",source:"bundled"}];try{const t=await dC.listProjects();e.push(...t.map(e=>({id:e.id,name:e.name.endsWith(".dbx")?e.name:`${e.name}.dbx`,isDirectory:!1,path:`library/${e.name}`,size:e.size,modifiedAt:new Date(e.modifiedAt),source:"library"})))}catch{}}else if("data/songs"===k)try{const n=await fetch(`${t}data/songs/modules.json`);if(n.ok){const t=(await n.json()).categories||{},a=[];for(const e of Object.values(t))a.push(...e);e=a.map(e=>({id:`songs/${e.file}`,name:e.name,isDirectory:!1,path:`data/songs/${e.file}`,source:"bundled"}))}}catch{e=[{id:"songs/phuture-acid-tracks.dbx",name:"Phuture - Acid Tracks",isDirectory:!1,path:"data/songs/phuture-acid-tracks.dbx",source:"bundled"},{id:"songs/hardfloor-funalogue.dbx",name:"Hardfloor - Funalogue",isDirectory:!1,path:"data/songs/hardfloor-funalogue.dbx",source:"bundled"}]}else("data/samples"===k||"data/instruments"===k)&&(e=[])}u(e)}catch(e){f(e instanceof Error?e.message:"Failed to load files")}finally{h(!1)}},[l,k]);s.useEffect(()=>{e&&M()},[e,l,M]);const N=async()=>{const e=await async function(){if(!uC())return null;try{const e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return pC=e,e}catch(m){if("AbortError"===m.name)return null;throw m}}();e&&(w(!0),c("filesystem"))},C=async()=>{if(y){h(!0),f(null);try{if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return fC.includes(t)}(y.name)){if(!a)throw new Error("Tracker module loading not supported");let e;if("filesystem"===y.source&&y.handle){const t=await y.handle.getFile();e=await t.arrayBuffer()}else{if("bundled"!==y.source)throw new Error("Cannot load tracker module from this source");{const t="/DEViLBOX/",n=await fetch(`${t}${y.path}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);e=await n.arrayBuffer()}}return await a(e,y.name),void t()}let e;const s=y.name.toLowerCase().endsWith(".xml");if("library"===y.source){const t=await dC.loadProject(y.id);if(!t)throw new Error("Project not found");e=t}else if("filesystem"===y.source&&y.handle){const t=await async function(e){return(await e.getFile()).text()}(y.handle);e=s?t:JSON.parse(t)}else{if("bundled"!==y.source)throw new Error("Cannot load file");{const t=`${"/DEViLBOX/"}${y.path}`,n=await fetch(t);if(!n.ok)throw new Error(`HTTP ${n.status}: ${t}`);const a=n.headers.get("content-type");if(a?.includes("text/html"))throw new Error(`Got HTML instead of file content. Path: ${t}`);e=s?await n.text():await n.json()}}n(e,y.name),t()}catch(e){f(e instanceof Error?e.message:"Failed to load file")}finally{h(!1)}}},E=async e=>{if(confirm(`Delete "${e.name}"?`))try{if("library"===e.source)await dC.deleteProject(e.id);else if("filesystem"===e.source){const t=hC();t&&await async function(e,t){const n=t||pC;if(!n)throw new Error("No directory handle available");await n.removeEntry(e)}(e.name,t)}M()}catch(t){f(t instanceof Error?t.message:"Failed to delete file")}};return e?bn.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:t,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[800px] max-w-[90vw] h-[600px] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[bn.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"load"===r?"Load Module":"Save Module"}),bn.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary text-xl leading-none",children:"x"})]}),bn.jsxs("div",{className:"flex border-b border-dark-border",children:["load"===r&&bn.jsx("button",{onClick:()=>c("bundled"),className:"px-4 py-2 text-sm font-medium "+("bundled"===l?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-primary"),children:"Files"}),bn.jsx("button",{onClick:()=>x?c("filesystem"):N(),className:"px-4 py-2 text-sm font-medium "+("filesystem"===l?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-primary"),children:x?"Folder":"Open Folder..."})]}),bn.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[m&&bn.jsx("div",{className:"bg-red-900/30 border border-red-500 text-red-300 px-4 py-2 rounded mb-4",children:m}),p?bn.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"Loading..."}):0===d.length?bn.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[bn.jsx("p",{className:"mb-4",children:"No files found"}),"bundled"===l&&"load"===r&&bn.jsx("p",{className:"text-sm",children:"Save a project to see it here"})]}):bn.jsxs("div",{className:"grid grid-cols-1 gap-2",children:["bundled"===l&&""!==k&&bn.jsxs("div",{onClick:()=>{S(""),g(null)},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors bg-dark-bgSecondary hover:bg-dark-bgHover border border-dark-border",children:[bn.jsx("div",{className:"text-2xl",children:""}),bn.jsx("div",{className:"flex-1",children:bn.jsx("div",{className:"font-medium text-text-primary",children:".. (back)"})})]}),d.map(e=>bn.jsxs("div",{onClick:()=>g(e),onDoubleClick:()=>{e.isDirectory?"bundled"===l&&(S(e.path),g(null)):(g(e),"load"===r&&C())},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors "+(y?.id===e.id?"bg-accent-primary/20 border border-accent-primary":"bg-dark-bgTertiary hover:bg-dark-bgHover border border-transparent"),children:[bn.jsx("div",{className:"text-2xl",children:e.isDirectory?"":""}),bn.jsxs("div",{className:"flex-1 min-w-0",children:[bn.jsx("div",{className:"font-medium text-text-primary truncate",children:e.name}),bn.jsxs("div",{className:"text-xs text-text-muted",children:[e.size?`${(e.size/1024).toFixed(1)} KB`:"",e.modifiedAt&&`  ${e.modifiedAt.toLocaleDateString()}`]})]}),("library"===e.source||"filesystem"===e.source)&&bn.jsx("button",{onClick:t=>{t.stopPropagation(),E(e)},className:"text-text-muted hover:text-red-400 p-1",title:"Delete",children:""})]},e.id))]})]}),bn.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 border-t border-dark-border",children:["save"===r&&bn.jsx("input",{type:"text",value:v,onChange:e=>b(e.target.value),placeholder:"Filename",className:"flex-1 px-3 py-2 bg-dark-bgTertiary border border-dark-border rounded text-text-primary"}),bn.jsx("div",{className:"flex-1"}),bn.jsx("button",{onClick:t,className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"Cancel"}),bn.jsx("button",{onClick:"load"===r?C:async()=>{if(o){h(!0),f(null);try{const e=o(),n=v.endsWith(".dbx")?v:`${v}.dbx`;if("bundled"===l)await dC.saveProject(n,e);else if("filesystem"===l){const t=hC();if(t)await async function(e,t,n){const a=n||pC;if(!a)throw new Error("No directory handle available");const s=await a.getFileHandle(e,{create:!0});return await mC(s,t),s}(n,JSON.stringify(e,null,2),t);else{const t=await async function(e,t){if(!uC())throw new Error("File System Access API not supported");try{return await window.showSaveFilePicker({suggestedName:e,types:t??[{description:"DEViLBOX Module",accept:{"application/json":[".dbox"]}}]})}catch(m){if("AbortError"===m.name)return null;throw m}}(n);t&&await mC(t,JSON.stringify(e,null,2))}}M(),t()}catch(e){f(e instanceof Error?e.message:"Failed to save file")}finally{h(!1)}}},disabled:"load"===r&&(!y||y.isDirectory),className:"px-6 py-2 rounded font-medium "+("load"!==r||y&&!y.isDirectory?"bg-accent-primary text-white hover:bg-accent-primaryHover":"bg-dark-bgTertiary text-text-muted cursor-not-allowed"),children:"load"===r?"Load":"Save"})]})]})}):null};var gC=r();function vC(e,t,n,a,s,r,o,i,l={},c){const d={format:"devilbox-song",version:_g,metadata:e,bpm:t,instruments:n,patterns:a,sequence:s,...r&&Object.keys(r).length>0?{automation:r}:{},...i&&i.length>0?{automationCurves:i}:{},...o&&o.length>0?{masterEffects:o}:{},...c&&"straight"!==c?{grooveTemplateId:c}:{}},u=l.prettify?JSON.stringify(d,null,2):JSON.stringify(d),p=new Blob([u],{type:"application/json"}),h=`${NC(e.name)}.dbx`;gC.saveAs(p,h)}function bC(e,t,n,a,s={}){const r={format:"devilbox-sfx",version:_g,name:e,instrument:t,pattern:n,bpm:a},o=s.prettify?JSON.stringify(r,null,2):JSON.stringify(r),i=new Blob([o],{type:"application/json"}),l=`${NC(e)}.sfx.json`;gC.saveAs(i,l)}function xC(e,t={}){const n={format:"devilbox-instrument",version:_g,instrument:e},a=t.prettify?JSON.stringify(n,null,2):JSON.stringify(n),s=new Blob([a],{type:"application/json"}),r=`${NC(e.name)}.dbi`;gC.saveAs(s,r)}async function wC(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-song"!==n.format)throw new Error("Invalid song format");return n}catch(t){return null}}async function kC(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-sfx"!==n.format)throw new Error("Invalid SFX format");return n}catch(t){return null}}async function SC(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-instrument"!==n.format)throw new Error("Invalid instrument format");return n}catch(t){return null}}async function MC(e){try{const t=await e.text(),n=JSON.parse(t);return"devilbox-song"===n.format?"song":"devilbox-sfx"===n.format?"sfx":"devilbox-instrument"===n.format?"instrument":"unknown"}catch{return"unknown"}}function NC(e){return e.replace(/[^a-z0-9_-]/gi,"_").replace(/_{2,}/g,"_").toLowerCase()}function CC(e){const t=new Uint8Array(e),n=[];for(let a=0;a<t.length;a+=32768){const e=t.subarray(a,Math.min(a+32768,t.length));n.push(String.fromCharCode.apply(null,e))}return btoa(n.join(""))}function EC(e){const[t,n,a,s,r,o]=e;let i=0;t>0&&t<=120?i=Math.max(1,t-12):254!==t&&255!==t||(i=97);return{note:i,instrument:n>0?n:0,volume:r>0?Math.min(16+Math.min(r,64),80):0,effTyp:s,eff:o,effTyp2:0,eff2:0}}function PC(e){const t=e.note,n=e.effectType,a=e.effectParam,s=e.volume,r=e.instrument;let o=0,i=0;if(s>=96){const e=function(e){const t=15&e;switch(e>>4){case 6:return[10,t];case 7:return[10,t<<4];case 8:return[14,176+t];case 9:return[14,160+t];case 11:return[4,t];case 12:return[8,17*t];case 13:return[25,t];case 14:return[25,t<<4];case 15:return[3,t>0?16*t:0];default:return null}}(s);null!==e&&(o=e[0],i=e[1])}return{note:t,instrument:r,volume:s,effTyp:n,eff:a,effTyp2:o,eff2:i}}function TC(e){const t=function(e){if(0===e)return 0;const t=[1712,1616,1525,1440,1357,1281,1209,1141,1077,1017,961,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];let n=0,a=1/0;for(let r=0;r<t.length;r++){const s=Math.abs(t[r]-e);s<a&&(a=s,n=r+1)}const s=n+24;return Math.min(96,Math.max(1,s))}(e.period),n=e.instrument,a=(s=e.effect,r=e.effectParam,`${s.toString(16).toUpperCase()}${r.toString(16).padStart(2,"0").toUpperCase()}`);var s,r;const[o,i]=a?Ga(a):[0,0];return{note:t,instrument:n,volume:0,effTyp:o,eff:i,effTyp2:0,eff2:0,period:e.period}}function AC(e){return e.instruments||[]}function IC(e){return e.samples||[]}function _C(e){const t=function(e){if(!e.patterns||0===e.patterns.length)return[];const t=[],n=e.channels.length;for(let a=0;a<e.patterns.length;a++){const s=e.patterns[a],r=s.rows.length;if(0===r)continue;const o=[];for(let t=0;t<n;t++){const n=e.channels[t]||`Channel ${t+1}`,i=[];let l=null;for(let e=0;e<r;e++){const n=s.rows[e];if(n&&n[t]){const e=EC(n[t]);0!==e.instrument&&(l=e.instrument),i.push(e)}else i.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const c=null!==l&&0!==l?l:1;o.push({id:`import-ch-${a}-${t}-${Date.now()}`,name:n||`Ch ${t+1}`,rows:i,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:c,color:null})}const i=s.name||`Pattern ${a}`;t.push({id:`import-pat-${a}-${Date.now()}`,name:i,length:r,channels:o})}return t}(e),n=function(e){return e.orders?e.orders.map(e=>e.pat):[]}(e);let a;return a=n.length>0?n.map((e,n)=>{const a=t[e];return a?{...a,id:`import-pos-${n}-pat-${e}-${Date.now()}`,name:`${String(n).padStart(2,"0")}: ${a.name}`,channels:a.channels.map(e=>({...e,id:`${e.id}-pos-${n}`,rows:[...e.rows]}))}:t[0]}):t,{patterns:a,order:n,instrumentNames:AC(e),sampleNames:IC(e),channelCount:e.channels?.length||4}}function OC(e,t,n,a,s){const r=[];for(let l=0;l<e.length;l++){const a=e[l],s=a.length,o=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let n=0;n<s;n++){const s=a[n]?.[e];if(s){const e=PC(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const i=null!==r?r:0;o.push({id:`xm-ch-${l}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:i,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`xm-pat-${l}-${Date.now()}`,name:`Pattern ${l}`,length:s,channels:o,importMetadata:n})}const o=n.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t);let i;return s&&(i={base64:CC(s),format:"XM",sourceFile:n.sourceFile}),{patterns:r,order:o,instrumentNames:a,sampleNames:a,channelCount:t,metadata:n,originalModuleData:i}}function FC(e,t,n,a,s){const r=[];for(let l=0;l<e.length;l++){const a=e[l],s=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let n=0;n<64;n++){const s=a[n]?.[e];if(s){const e=TC(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const o=null!==r?r:0;s.push({id:`mod-ch-${l}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:o,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`mod-pat-${l}-${Date.now()}`,name:`Pattern ${l}`,length:64,channels:s,importMetadata:n})}const o=n.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t);let i;return s&&(i={base64:CC(s),format:"MOD",sourceFile:n.sourceFile}),{patterns:r,order:o,instrumentNames:a,sampleNames:a,channelCount:t,metadata:n,originalModuleData:i}}function DC(e,t=0){const n={attack:10,decay:500,sustain:t,release:100};if(!e||!e.enabled||e.points.length<2)return n;const a=e.points;try{const t=function(e){if(0===e.length)return 10;const t=e[0];let n=0,a=e[0].value;for(let i=1;i<e.length;i++)if(e[i].value>a)a=e[i].value,n=i;else if(e[i].value<a-5)break;const s=e[n],r=s.tick-t.tick,o=32;return Math.max(1,r*o)}(a),{decay:n,sustain:s}=function(e,t,n){if(0===e.length)return{decay:500,sustain:0};let a=0,s=e[0].value;for(let u=0;u<e.length;u++)e[u].value>s&&(s=e[u].value,a=u);let r=n??a,o=e[r]?.value??s;if(null!==n&&n<e.length)o=e[n].value;else for(let u=a+1;u<e.length;u++){if(Math.abs(e[u].value-e[u-1].value)<6){r=u,o=e[u].value;break}}const i=e[r].tick-e[a].tick,l=32,c=Math.max(0,i*l),d=o/64*100;return{decay:c,sustain:d}}(a,0,e.sustainPoint),r=function(e,t){if(0===e.length)return 100;const n=t??Math.max(0,e.length-2);if(n>=e.length-1)return 100;let a=e.length-1;for(let o=n+1;o<e.length;o++)if(e[o].value<5){a=o;break}const s=e[a].tick-e[n].tick,r=32;return Math.max(10,s*r)}(a,e.sustainPoint);return{attack:Math.max(0,Math.min(2e3,t)),decay:Math.max(0,Math.min(2e3,n)),sustain:Math.max(0,Math.min(100,s)),release:Math.max(0,Math.min(5e3,r))}}catch(s){return n}}function RC(e,t,n){const a=[];if(e.furnace){const s=e.furnace.synthType;if("Sampler"===s||"Player"===s){if(e.samples.length>0)for(let s=0;s<e.samples.length;s++){const r=jC(e.samples[s],e,t+s,n);a.push(r)}return a}const r=function(e,t){const n=e.furnace,a=n.synthType,s={chipType:n.chipType,algorithm:n.fm?.algorithm??0,feedback:n.fm?.feedback??0,fms:n.fm?.fms??0,ams:n.fm?.ams??0,ops:n.fm?.ops??4,opllPreset:n.fm?.opllPreset??0,operators:n.fm?.operators?.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r??0,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2??0,rs:e.rs??0,am:e.am??!1,ksr:e.ksr??!1,ksl:e.ksl??0,sus:e.sus??!1,vib:e.vib??!1,ws:e.ws??0,ssg:e.ssg??0}))??[],macros:n.macros.map(e=>({type:e.type,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed})),opMacros:[],wavetables:n.wavetables.map(e=>({id:e.id,data:[...e.data],len:e.len,max:e.max}))},r={id:t,name:e.name||`Furnace Inst ${t}`,type:"synth",synthType:a,envelope:{attack:10,decay:100,sustain:80,release:100},effects:[],volume:0,pan:0,metadata:{importedFrom:"FUR"},furnace:s,parameters:{}};return r}(e,t);a.push(r);for(let o=0;o<e.samples.length;o++){const s=jC(e.samples[o],e,t+o+1,n);a.push(s)}return a}for(let s=0;s<e.samples.length;s++){const r=jC(e.samples[s],e,t+s,n);a.push(r)}return a}function jC(e,t,n,a){const{audioBuffer:s,blobUrl:r}=function(e){const t=e.sampleRate||8363,n=e.length,a=new Int16Array(n);if(8===e.bitDepth){const t=e.pcmData instanceof Float32Array?new Float32Array(e.pcmData):new Int8Array(e.pcmData);for(let e=0;e<n;e++)t instanceof Float32Array?a[e]=Math.round(32767*t[e]):a[e]=256*t[e]}else if(16===e.bitDepth){const t=new Int16Array(e.pcmData);for(let e=0;e<n;e++)a[e]=t[e]}const s="none"!==e.loopType?{start:e.loopStart,end:e.loopStart+e.loopLength}:void 0,r=function(e,t,n){const a=1,s=2*e.length,r=n?68:0,o=44+s+r,i=new ArrayBuffer(o),l=new DataView(i),c=(e,t)=>{for(let n=0;n<t.length;n++)l.setUint8(e+n,t.charCodeAt(n))};c(0,"RIFF"),l.setUint32(4,o-8,!0),c(8,"WAVE"),c(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,a,!0),l.setUint32(24,t,!0),l.setUint32(28,t*a*2,!0),l.setUint16(32,2*a,!0),l.setUint16(34,16,!0),c(36,"data"),l.setUint32(40,s,!0);let d=44;for(let u=0;u<e.length;u++)l.setInt16(d,e[u],!0),d+=2;n&&(c(d,"smpl"),l.setUint32(d+4,60,!0),l.setUint32(d+8,0,!0),l.setUint32(d+12,0,!0),l.setUint32(d+16,Math.floor(1e9/t),!0),l.setUint32(d+20,60,!0),l.setUint32(d+24,0,!0),l.setUint32(d+28,0,!0),l.setUint32(d+32,0,!0),l.setUint32(d+36,1,!0),l.setUint32(d+40,0,!0),l.setUint32(d+44,0,!0),l.setUint32(d+48,0,!0),l.setUint32(d+52,n.start,!0),l.setUint32(d+56,n.end-1,!0),l.setUint32(d+60,0,!0),l.setUint32(d+64,0,!0));return i}(a,t,s),o=function(e){const t=new Uint8Array(e);let n="";for(let a=0;a<t.byteLength;a++)n+=String.fromCharCode(t[a]);return btoa(n)}(r);return{audioBuffer:r,blobUrl:`data:audio/wav;base64,${o}`}}(e),o=(e.sampleRate,function(e){const t=48+e,n=Math.floor(t/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}${n}`}(e.relativeNote,e.finetune)),i=100*e.finetune/128,l=DC(t.volumeEnvelope),c=e.sampleRate||8363,d={audioBuffer:s,url:r,baseNote:o,detune:i,loop:"none"!==e.loopType,loopStart:e.loopStart,loopEnd:e.loopStart+e.loopLength,sampleRate:c,reverse:!1,playbackRate:1},u={importedFrom:"FUR"===a||"DMF"===a?"FUR":a,originalEnvelope:t.volumeEnvelope,autoVibrato:t.autoVibrato,preservedSample:{audioBuffer:d.audioBuffer,url:d.url,baseNote:d.baseNote,detune:d.detune,loop:d.loop,loopStart:d.loopStart,loopEnd:d.loopEnd,envelope:l},modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:e.finetune,defaultVolume:e.volume}};return{id:n,name:e.name||t.name||`Instrument ${n}`,type:"sample",synthType:"Sampler",sample:d,envelope:l,effects:[],volume:0,pan:(e.panning-128)/127*100,metadata:u,parameters:{sampleUrl:r}}}const LC=Object.freeze(Object.defineProperty({__proto__:null,analyzeSample:function(e,t){const n=function(e){if(!e||!e.enabled||e.points.length<2)return{type:"unknown",hasQuickAttack:!1,hasSustain:!1,hasLongRelease:!1};const t=DC(e),n=t.attack<20,a=t.sustain>20,s=t.release>500;let r="unknown";return n&&!a&&t.decay<300?r="pluck":n&&!a&&t.decay<100?r="percussive":!n&&a?r="pad":n&&a&&(r="sustained"),{type:r,hasQuickAttack:n,hasSustain:a,hasLongRelease:s}}(t),a="none"!==e.loopType,s=0!==e.relativeNote||a;return{dominantFrequency:s?440:null,harmonicContent:e.length<8e3&&!a&&"percussive"===n.type?"noise":s?"rich":"pure",envelopeShape:n.type,hasLoop:a,isPitched:s,bandwidth:1e3}},convertToInstrument:RC,suggestSynthConfig:function(e,t){switch(e){case"TB303":return{oscillator:{type:"rich"===t.harmonicContent?"sawtooth":"square"},filter:{cutoff:t.dominantFrequency?500:1e3,resonance:70},filterEnvelope:{envMod:60,decay:"pluck"===t.envelopeShape?200:500},accent:{amount:70},slide:{time:60,mode:"exponential"}};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:"pad"===t.envelopeShape?200:50,decay:500,sustain:t.hasLoop?50:0,release:100},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:"rich"===t.harmonicContent?3:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:"percussive"===t.envelopeShape?100:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100}}}}},Symbol.toStringTag,{value:"Module"}));var BC,VC,zC,UC,GC,KC={},HC={};function WC(){if(VC)return BC;function e(e){for(var n,a=new t(e),s=[];!a.eof();){var r=o();s.push(r)}return s;function o(){var e={};e.deltaTime=a.readVarInt();var t=a.readUInt8();if(240&~t){var s;if(128&t)s=a.readUInt8(),n=t;else{if(null===n)throw"Running status byte encountered before status byte";s=t,t=n,e.running=!0}var r=t>>4;switch(e.channel=15&t,r){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=a.readUInt8(),e;case 9:var o=a.readUInt8();return e.type=0===o?"noteOff":"noteOn",e.noteNumber=s,e.velocity=o,0===o&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=a.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=a.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(a.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+r}}else{if(255!==t){if(240==t){e.type="sysEx";l=a.readVarInt();return e.data=a.readBytes(l),e}if(247==t){e.type="endSysEx";l=a.readVarInt();return e.data=a.readBytes(l),e}throw"Unrecognised MIDI event type byte: "+t}e.meta=!0;var i=a.readUInt8(),l=a.readVarInt();switch(i){case 0:if(e.type="sequenceNumber",2!==l)throw"Expected length for sequenceNumber event is 2, got "+l;return e.number=a.readUInt16(),e;case 1:return e.type="text",e.text=a.readString(l),e;case 2:return e.type="copyrightNotice",e.text=a.readString(l),e;case 3:return e.type="trackName",e.text=a.readString(l),e;case 4:return e.type="instrumentName",e.text=a.readString(l),e;case 5:return e.type="lyrics",e.text=a.readString(l),e;case 6:return e.type="marker",e.text=a.readString(l),e;case 7:return e.type="cuePoint",e.text=a.readString(l),e;case 32:if(e.type="channelPrefix",1!=l)throw"Expected length for channelPrefix event is 1, got "+l;return e.channel=a.readUInt8(),e;case 33:if(e.type="portPrefix",1!=l)throw"Expected length for portPrefix event is 1, got "+l;return e.port=a.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=l)throw"Expected length for endOfTrack event is 0, got "+l;return e;case 81:if(e.type="setTempo",3!=l)throw"Expected length for setTempo event is 3, got "+l;return e.microsecondsPerBeat=a.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=l)throw"Expected length for smpteOffset event is 5, got "+l;var c=a.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&c],e.hour=31&c,e.min=a.readUInt8(),e.sec=a.readUInt8(),e.frame=a.readUInt8(),e.subFrame=a.readUInt8(),e;case 88:if(e.type="timeSignature",2!=l&&4!=l)throw"Expected length for timeSignature event is 4 or 2, got "+l;return e.numerator=a.readUInt8(),e.denominator=1<<a.readUInt8(),4===l?(e.metronome=a.readUInt8(),e.thirtyseconds=a.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=l)throw"Expected length for keySignature event is 2, got "+l;return e.key=a.readInt8(),e.scale=a.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=a.readBytes(l),e;default:return e.type="unknownMeta",e.data=a.readBytes(l),e.metatypeByte=i,e}}}}function t(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}return VC=1,t.prototype.eof=function(){return this.pos>=this.bufferLen},t.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},t.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},t.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},t.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},t.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},t.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},t.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},t.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},BC=function(n){var a=new t(n),s=a.readChunk();if("MThd"!=s.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var r=function(e){var n=new t(e),a=n.readUInt16(),s=n.readUInt16(),r={format:a,numTracks:s},o=n.readUInt16();32768&o?(r.framesPerSecond=256-(o>>8),r.ticksPerFrame=255&o):r.ticksPerBeat=o;return r}(s.data),o=[],i=0;!a.eof()&&i<r.numTracks;i++){var l=a.readChunk();if("MTrk"!=l.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var c=e(l.data);o.push(c)}return{header:r,tracks:o}}}function $C(){if(UC)return zC;function e(e,a,s){var r,o=new n,i=a.length,l=null;for(r=0;r<i;r++)!1!==s.running&&(s.running||a[r].running)||(l=null),l=t(o,a[r],l,s.useByte9ForNoteOff);e.writeChunk("MTrk",o.buffer)}function t(e,t,n,a){var s=t.type,r=t.deltaTime,o=t.text||"",i=t.data||[],l=null;switch(e.writeVarInt(r),s){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(o.length),e.writeString(o);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(o.length),e.writeString(o);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(o.length),e.writeString(o);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(o.length),e.writeString(o);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(o.length),e.writeString(o);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(o.length),e.writeString(o);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(o.length),e.writeString(o);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var d=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(d),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(i.length),e.writeBytes(i);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(i.length),e.writeBytes(i));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(i.length),e.writeBytes(i);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(i.length),e.writeBytes(i);break;case"noteOff":(l=(!1!==a&&t.byte9||a&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(l=144|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(l=160|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(l=176|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(l=192|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(l=208|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":(l=224|t.channel)!==n&&e.writeUInt8(l);var u=8192+t.value,p=127&u,h=u>>7&127;e.writeUInt8(p),e.writeUInt8(h);break;default:throw"Unrecognized event type: "+s}return l}function n(){this.buffer=[]}return UC=1,n.prototype.writeUInt8=function(e){this.buffer.push(255&e)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(a)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,a=e>>8&255,s=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(a),this.writeUInt8(s)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},n.prototype.writeString=function(e){var t,n=e.length,a=[];for(t=0;t<n;t++)a.push(e.codePointAt(t));this.writeBytes(a)},n.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var a=127&t|128;n.push(a),t>>=7}this.writeBytes(n.reverse())}},n.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},zC=function(t,a){if("object"!=typeof t)throw"Invalid MIDI data";a=a||{};var s,r=t.header||{},o=t.tracks||[],i=o.length,l=new n;for(function(e,t,a){var s=null==t.format?1:t.format,r=128;t.timeDivision?r=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?r=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(r=32767&t.ticksPerBeat);var o=new n;o.writeUInt16(s),o.writeUInt16(a),o.writeUInt16(r),e.writeChunk("MThd",o.buffer)}(l,r,i),s=0;s<i;s++)e(l,o[s],a);return l.buffer}}function qC(){return GC||(GC=1,HC.parseMidi=WC(),HC.writeMidi=$C()),HC}var YC,XC,QC={},ZC={};function JC(){if(YC)return ZC;function e(e,t,n){void 0===n&&(n="ticks");var a=0,s=e.length,r=s;if(s>0&&e[s-1][n]<=t)return s-1;for(;a<r;){var o=Math.floor(a+(r-a)/2),i=e[o],l=e[o+1];if(i[n]===t){for(var c=o;c<e.length;c++){e[c][n]===t&&(o=c)}return o}if(i[n]<t&&l[n]>t)return o;i[n]>t?r=o:i[n]<t&&(a=o+1)}return-1}return YC=1,Object.defineProperty(ZC,"__esModule",{value:!0}),ZC.insert=ZC.search=void 0,ZC.search=e,ZC.insert=function(t,n,a){if(void 0===a&&(a="ticks"),t.length){var s=e(t,n[a],a);t.splice(s+1,0,n)}else t.push(n)},ZC}function eE(){return XC||(XC=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=JC(),n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function a(t){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),t){n.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?a.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?a.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&a.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var s=0;t.tracks[0].forEach(function(e){s+=e.deltaTime,e.meta&&("trackName"===e.type?a.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||a.meta.push({text:e.text,ticks:s,type:e.type}))}),this.update()}}return a.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort(function(e,t){return e.ticks-t.ticks}),this.tempos.forEach(function(a,s){var r=s>0?e.tempos[s-1].bpm:e.tempos[0].bpm,o=a.ticks/e.ppq-n,i=60/r*o;a.time=i+t,t=a.time,n+=o}),this.timeSignatures.sort(function(e,t){return e.ticks-t.ticks}),this.timeSignatures.forEach(function(t,n){var a=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],s=(t.ticks-a.ticks)/e.ppq/a.timeSignature[0]/(a.timeSignature[1]/4);a.measures=a.measures||0,t.measures=s+a.measures})},a.prototype.ticksToSeconds=function(e){var n=(0,t.search)(this.tempos,e);if(-1!==n){var a=this.tempos[n],s=a.time,r=(e-a.ticks)/this.ppq;return s+60/a.bpm*r}return.5*(e/this.ppq)},a.prototype.ticksToMeasures=function(e){var n=(0,t.search)(this.timeSignatures,e);if(-1!==n){var a=this.timeSignatures[n],s=(e-a.ticks)/this.ppq;return a.measures+s/(a.timeSignature[0]/a.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(a.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),a.prototype.secondsToTicks=function(e){var n=(0,t.search)(this.tempos,e,"time");if(-1!==n){var a=this.tempos[n],s=(e-a.time)/(60/a.bpm);return Math.round(a.ticks+s*this.ppq)}var r=e/.5;return Math.round(r*this.ppq)},a.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},a.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(e){return Object.assign({},e)}),this.timeSignatures=e.timeSignatures.map(function(e){return Object.assign({},e)}),this.keySignatures=e.keySignatures.map(function(e){return Object.assign({},e)}),this.meta=e.meta.map(function(e){return Object.assign({},e)}),n.set(this,e.ppq),this.update()},a.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},a}();e.Header=a}(QC)),QC}var tE,nE={},aE={};function sE(){return tE||(tE=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,n){return t[e.controlChangeNames[n]]=n,t},{});var t=new WeakMap,n=new WeakMap,a=function(){function a(e,a){t.set(this,a),n.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(a.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){return t.get(this).ticksToSeconds(this.ticks)},set:function(e){var n=t.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},a}();e.ControlChange=a}(aE)),aE}var rE,oE={};var iE,lE={};var cE,dE,uE={},pE={};function hE(){if(dE)return uE;dE=1,Object.defineProperty(uE,"__esModule",{value:!0}),uE.Instrument=void 0;var e=(cE||(cE=1,Object.defineProperty(pE,"__esModule",{value:!0}),pE.DrumKitByPatchID=pE.InstrumentFamilyByID=pE.instrumentByPatchID=void 0,pE.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],pE.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],pE.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),pE),t=new WeakMap,n=function(){function n(e,n){if(this.number=0,t.set(this,n),this.number=0,e){var a=e.find(function(e){return"programChange"===e.type});a&&(this.number=a.programNumber)}}return Object.defineProperty(n.prototype,"name",{get:function(){return this.percussion?e.DrumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var n=e.instrumentByPatchID.indexOf(t);-1!==n&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"family",{get:function(){return this.percussion?"drums":e.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"percussion",{get:function(){return 9===t.get(this).channel},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},n.prototype.fromJSON=function(e){this.number=e.number},n}();return uE.Instrument=n,uE}var mE,fE,yE={};function gE(){if(mE)return yE;function e(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}mE=1,Object.defineProperty(yE,"__esModule",{value:!0}),yE.Note=void 0;var t=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var a=e.exec(n),s=a[1],r=a[2];return t[s.toLowerCase()]+12*(parseInt(r,10)+1)}}(),n=new WeakMap,a=function(){function a(e,t,a){n.set(this,a),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return t=this.midi,n=Math.floor(t/12)-1,e(t)+n.toString();var t,n},set:function(e){this.midi=t(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var e=n.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){return n.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return yE.Note=a,yE}function vE(){if(fE)return nE;fE=1,Object.defineProperty(nE,"__esModule",{value:!0}),nE.Track=void 0;var e=JC(),t=sE(),n=function(){if(rE)return oE;rE=1,Object.defineProperty(oE,"__esModule",{value:!0}),oE.createControlChanges=void 0;var e=sE();return oE.createControlChanges=function(){return new Proxy({},{get:function(t,n){return t[n]?t[n]:e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]:void 0},set:function(t,n,a){return e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]=a:t[n]=a,!0}})},oE}(),a=function(){if(iE)return lE;iE=1,Object.defineProperty(lE,"__esModule",{value:!0}),lE.PitchBend=void 0;var e=new WeakMap,t=function(){function t(t,n){e.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return e.get(this).ticksToSeconds(this.ticks)},set:function(t){var n=e.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return lE.PitchBend=t,lE}(),s=hE(),r=gE(),o=new WeakMap,i=function(){function i(e,t){var a=this;if(this.name="",this.notes=[],this.controlChanges=(0,n.createControlChanges)(),this.pitchBends=[],o.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var i=e.filter(function(e){return"noteOn"===e.type}),l=e.filter(function(e){return"noteOff"===e.type}),c=function(){var e=i.shift();d.channel=e.channel;var t=l.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var n=l.splice(t,1)[0];d.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},d=this;i.length;)c();e.filter(function(e){return"controller"===e.type}).forEach(function(e){a.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){a.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})});var u=e.find(function(e){return"endOfTrack"===e.type});this.endOfTrackTicks=void 0!==u?u.absoluteTime:void 0}}return i.prototype.addNote=function(t){var n=o.get(this),a=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(a,t),(0,e.insert)(this.notes,a,"ticks"),this},i.prototype.addCC=function(n){var a=o.get(this),s=new t.ControlChange({controllerType:n.number},a);return delete n.number,Object.assign(s,n),Array.isArray(this.controlChanges[s.number])||(this.controlChanges[s.number]=[]),(0,e.insert)(this.controlChanges[s.number],s,"ticks"),this},i.prototype.addPitchBend=function(t){var n=o.get(this),s=new a.PitchBend({},n);return Object.assign(s,t),(0,e.insert)(this.pitchBends,s,"ticks"),this},Object.defineProperty(i.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),i.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},i.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},i}();return nE.Track=i,nE}var bE={};function xE(e,t){for(var n=0;n<e.length;n++){var a=e[n];Array.isArray(a)?xE(a,t):t.push(a)}}const wE=d(Object.freeze(Object.defineProperty({__proto__:null,flatten:function(e){var t=[];return xE(e,t),t}},Symbol.toStringTag,{value:"Module"})));var kE,SE;function ME(){if(kE)return bE;kE=1;var e=bE&&bE.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,s=0,r=t.length;s<r;s++)!a&&s in t||(a||(a=Array.prototype.slice.call(t,0,s)),a[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))};Object.defineProperty(bE,"__esModule",{value:!0}),bE.encode=void 0;var t=qC(),n=eE(),a=wE;function s(e){return(0,a.flatten)(e.notes.map(function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)}))}function r(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function o(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}return bE.encode=function(a){var i={header:{format:1,numTracks:a.tracks.length+1,ticksPerBeat:a.header.ppq},tracks:e([e(e(e(e([{absoluteTime:0,deltaTime:0,meta:!0,text:a.header.name,type:"trackName"}],a.header.keySignatures.map(function(e){return function(e){var t=n.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)}),!0),a.header.meta.map(function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t}),!0),a.header.tempos.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)}),!0),a.header.timeSignatures.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)}),!0)],a.tracks.map(function(t){return e(e(e([(n=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:n,type:"trackName"}),o(t)],s(t),!0),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(n){t.push(r(n,e.channel))});return t}(t),!0),function(e){var t=[];return e.pitchBends.forEach(function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))}),t}(t),!0);var n}),!0)};return i.tracks=i.tracks.map(function(e){e=e.sort(function(e,t){return e.absoluteTime-t.absoluteTime});var t=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array((0,t.writeMidi)(i))},bE}var NE=(SE||(SE=1,function(e){var t=KC&&KC.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,r){function o(e){try{l(a.next(e))}catch(t){r(t)}}function i(e){try{l(a.throw(e))}catch(t){r(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,i)}l((a=a.apply(e,t||[])).next())})},n=KC&&KC.__generator||function(e,t){var n,a,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&r[0]?a.return:r[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(i){r=[6,i],a=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var a=qC(),s=eE(),r=vE(),o=ME(),i=function(){function e(e){var t=this,n=null;if(e){var o=e instanceof ArrayBuffer?new Uint8Array(e):e;(n=(0,a.parseMidi)(o)).tracks.forEach(function(e){var t=0;e.forEach(function(e){t+=e.deltaTime,e.absoluteTime=t})}),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var a=t.length,s=new Map,r=Array(16).fill(0),o=0,i=e[n];o<i.length;o++){var l=i[o],c=a,d=l.channel;if(void 0!==d){"programChange"===l.type&&(r[d]=l.programNumber);var u=r[d],p="".concat(u," ").concat(d);s.has(p)?c=s.get(p):(c=a+s.size,s.set(p,c))}t[c]||t.push([]),t[c].push(l)}return t}(n.tracks)}this.header=new s.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map(function(e){return new r.Track(e,t.header)}),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(a){return t(this,void 0,void 0,function(){var t;return n(this,function(n){switch(n.label){case 0:return[4,fetch(a)];case 1:return(t=n.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new e(n.sent())];case 3:throw new Error("Could not load '".concat(a,"'"))}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map(function(e){return e.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(e){return e.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new r.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,o.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(e){var n=new r.Track(void 0,t.header);return n.fromJSON(e),n})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();e.Midi=i;var l=vE();Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=eE();Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}})}(KC)),KC);function CE(e="id"){return`${e}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const EE={quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64};async function PE(e,t={}){const n={...EE,...t},a=await e.arrayBuffer(),s=new NE.Midi(a),r=s.header.ppq||480;if(0===r)throw new Error("Invalid MIDI file: PPQ (pulses per quarter note) cannot be zero");const o=s.header.tempos.length>0?Math.round(s.header.tempos[0].bpm):120,i=s.header.timeSignatures.length>0?[s.header.timeSignatures[0].timeSignature[0],s.header.timeSignatures[0].timeSignature[1]]:[4,4],l=[];if(n.mergeChannels){const e=function(e,t,n,a){const s=e.duration*(e.header.tempos[0]?.bpm||120)/60,r=Math.min(256,Math.max(t.defaultPatternLength||64,Math.ceil(s*a))),o=new Map;e.tracks.forEach(e=>{e.notes.forEach(e=>{const t=e.midi%16;o.has(t)||o.set(t,[]),o.get(t).push({tick:e.ticks,note:e})})});const i=Array.from(o.entries()).sort((e,t)=>e[0]-t[0]).map(([e,s])=>{const o=Array.from({length:r},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return s.forEach(({tick:e,note:s})=>{const i=AE(e,n,a,t.quantize);if(i<0||i>=r)return;const l=Wa(s.midi);if(!l)return;if(o[i].note=l,t.velocityToVolume){const e=IE(127*s.velocity);o[i].volume=16+Math.round(e/64*64)}const c=AE(e+s.durationTicks,n,a,t.quantize);c<r&&c>i&&(o[c].note=97)}),{id:CE("channel"),name:`Ch ${e+1}`,instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:o}});return{id:CE("pattern"),name:e.name||"MIDI Import",length:r,channels:i}}(s,n,r,4);l.push(e)}else for(let c=0;c<s.tracks.length;c++){const e=s.tracks[c];if(0===e.notes.length)continue;const t=TE(e,c,n,r,4);l.push(t)}return{patterns:l,bpm:o,timeSignature:i,metadata:{name:s.name||e.name.replace(/\.[^/.]+$/,""),tracks:s.tracks.length,totalTicks:s.durationTicks}}}function TE(e,t,n,a,s){const r=e.notes.length>0?e.notes[e.notes.length-1]:null,o=AE(r?r.ticks+r.durationTicks:0,a,s,0),i=Math.min(256,Math.max(n.defaultPatternLength||64,64*Math.ceil(o/64))),l=Array.from({length:i},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return e.notes.forEach(e=>{const t=AE(e.ticks,a,s,n.quantize);if(t<0||t>=i)return;const r=Wa(e.midi);if(!r)return;if(l[t].note=r,n.velocityToVolume){const n=IE(127*e.velocity);l[t].volume=16+Math.round(n/64*64)}const o=AE(e.ticks+e.durationTicks,a,s,n.quantize);o<i&&o>t&&(l[o].note=97)}),{id:CE("pattern"),name:e.name||`Track ${t+1}`,length:i,channels:[{id:CE("channel"),name:"Channel 1",instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:l}]}}function AE(e,t,n,a=0){if(0===t)return 0;const s=Math.round(e/t*n);return a>0?Math.round(s/a)*a:s}function IE(e){return Math.round(e/127*64)}function _E(e,t="DB303 Pattern",n=1){const a=(new DOMParser).parseFromString(e,"text/xml"),s=a.querySelector("parsererror");if(s)throw new Error("Invalid XML: "+s.textContent);const r=a.querySelector("db303-pattern");if(!r)throw new Error("Invalid pattern XML: missing db303-pattern element");const o=parseInt(r.getAttribute("numSteps")||"16",10),i=Math.max(1,Math.min(256,isNaN(o)?16:o)),l=parseInt(r.getAttribute("rootNote")||"36",10),c=r.getAttribute("tempo")?parseInt(r.getAttribute("tempo"),10):void 0,d=r.getAttribute("swing")?parseFloat(r.getAttribute("swing")):void 0,u=[];a.querySelectorAll("step").forEach(e=>{const t=parseInt(e.getAttribute("index")||"0",10),n=parseInt(e.getAttribute("key")||"0",10),a=parseInt(e.getAttribute("octave")||"0",10),s="true"===e.getAttribute("gate"),r="true"===e.getAttribute("accent"),o="true"===e.getAttribute("slide"),i="true"===e.getAttribute("mute"),l="true"===e.getAttribute("hammer");u.push({index:t,key:n,octave:a,gate:s,accent:r,slide:o,mute:i,hammer:l})}),u.sort((e,t)=>e.index-t.index);const p=new Map(u.map(e=>[e.index,e])),h=[];for(let m=0;m<i;m++){const e=p.get(m);if(e){let t=0;if(e.gate){t=l+e.key+12*e.octave+1,t=Math.max(1,Math.min(96,t))}h.push({note:t,instrument:n,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:e.mute?3:e.hammer?4:void 0,flag2:e.slide?2:!e.hammer||e.accent||e.mute?void 0:4})}else h.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}return{pattern:{id:`db303-${Date.now()}`,name:t,length:i,channels:[{id:"ch-1",name:"TB-303",rows:h,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:"#22c55e"}]},tempo:c,swing:d}}const OE=[".json",".song.json",".dbx",".xml",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".mid",".midi"].join(",");function FE(e,t,n){const a=new Set;for(const o of e)for(const e of o.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&a.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const o of Array.from(a).sort((e,t)=>e-t)){const e=t[o-1]||`Instrument ${o}`;{const t=r[(o-1)%r.length];s.push({id:o,name:e.trim()||`Instrument ${o}`,type:"synth",synthType:"Synth",oscillator:{..._a,type:t},envelope:{...Oa},filter:{...Fa},effects:[],volume:-6,pan:0})}}for(const o of[0,1])a.has(o)||s.push({id:o,name:0===o?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{..._a,type:"sawtooth"},envelope:{...Oa},filter:{...Fa},effects:[],volume:-6,pan:0});return s.sort((e,t)=>e.id-t.id),s}const DE=({onShowPatterns:t,onShowExport:n,onShowHelp:a,onShowMasterFX:r,onShowInstrumentFX:o,onShowInstruments:i,onShowPatternOrder:l,onShowDrumpads:c,showPatterns:d,showMasterFX:u,showInstrumentFX:p})=>{const{patterns:h,currentPatternIndex:m,setCurrentPattern:f,deletePattern:y,addPattern:g,expandPattern:v,shrinkPattern:b,resizePattern:x,loadPatterns:w,setPatternOrder:k,patternOrder:S,currentPositionIndex:M,setCurrentPosition:N,recordMode:C,editStep:E,toggleRecordMode:P,setEditStep:T,reset:A,duplicatePosition:I,removeFromOrder:_}=cm(),{isPlaying:O,isLooping:F,bpm:D,setBPM:R,speed:j,setSpeed:L,setIsLooping:B,play:V,stop:z,grooveTemplateId:U,setGrooveTemplate:G,swing:K,setSwing:H,setGrooveSteps:W,jitter:$,useMpcScale:q}=Gf(),{isDirty:Y,setMetadata:X,metadata:Q}=Hf(),{instruments:Z,loadInstruments:J,updateInstrument:ee,reset:te}=Df(),{masterEffects:ne}=Kf(),{compactToolbar:ae,toggleCompactToolbar:se,oscilloscopeVisible:re}=jf(),{curves:oe}=Wf(),ie=em(),le=s.useRef(null),[ce,de]=s.useState(!1),[ue,pe]=s.useState("logo"),{tap:he,tapCount:me,isActive:fe}=function(e){const[t,n]=s.useState(0),[a,r]=s.useState(null),[o,i]=s.useState(!1),l=s.useRef([]),c=s.useRef(null),d=s.useCallback(()=>{l.current=[],n(0),r(null),i(!1),c.current&&(clearTimeout(c.current),c.current=null)},[]);return s.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),{bpm:a,tapCount:t,isActive:o,tap:s.useCallback(()=>{const t=performance.now();c.current&&clearTimeout(c.current);const a=l.current[l.current.length-1];a&&t-a>2e3&&(l.current=[]),l.current.push(t),i(!0),l.current.length>8&&(l.current=l.current.slice(-8));const s=l.current;if(n(s.length),s.length>=2){const t=[];for(let e=1;e<s.length;e++)t.push(s[e]-s[e-1]);const n=t.reduce((e,t)=>e+t,0)/t.length;let a=Math.round(6e4/n);a=Math.max(20,Math.min(999,a)),r(a),e&&e(a)}c.current=setTimeout(()=>{i(!1)},2e3)},[e]),reset:d}}(R),[ye,ge]=s.useState(!1),[ve,be]=s.useState(!1),[xe,we]=s.useState(!1),[ke,Se]=s.useState(!1),[Me,Ne]=s.useState(!1),[Ee,Pe]=s.useState(!1),[Te,Ae]=s.useState(!!document.fullscreenElement),Ie=s.useCallback(()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","sineScroll"],t=(e.indexOf("logo")+1)%e.length;pe(e[t])},[]);e.useEffect(()=>{const e=()=>{Ae(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);const _e=s.useRef(null),Oe=s.useRef(null),[Fe,De]=s.useState({top:0,left:0});e.useEffect(()=>{if(ye&&Oe.current){const e=Oe.current.getBoundingClientRect();De({top:e.bottom+4,left:e.left})}},[ye]),e.useEffect(()=>{if(!ye)return;const e=e=>{ye&&_e.current&&!_e.current.contains(e.target)&&ge(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ye]);const Re=async e=>{O&&(z(),ie.releaseAll()),de(!0);try{let t,n;if(e.nativeData?.patterns){const{format:n,patterns:a,importMetadata:s,instruments:r}=e.nativeData,o=s.originalChannelCount,i=r?.map(e=>e.name)||[];if("XM"===n)t=OC(a,o,s,i,e.arrayBuffer);else if("MOD"===n)t=FC(a,o,s,i,e.arrayBuffer);else{if("FUR"!==n&&"DMF"!==n)return void iy.error(`Unsupported native format: ${n}`);{const e=s.modData?.patternOrderTable||[],n=a[0]?.length||64,r=a[0]?.[0]?.length||4;t={patterns:a.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:n,channels:Array.from({length:r},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:0,eff2:0}})}))})),order:e.length>0?e:[0],instrumentNames:i}}}}else{if(!e.metadata.song)return void iy.error(`Module "${e.metadata.title}" has no pattern data`);t=_C(e.metadata.song)}if(e.nativeData?.instruments){const t=e.nativeData.instruments,a=e.nativeData.format;n=t.flatMap(e=>RC(e,e.id,a))}else n=FE(t.patterns,t.instrumentNames);J(n),w(t.patterns),t.order&&t.order.length>0&&(k(t.order),f(t.order[0])),X({name:e.metadata.title,author:"",description:`Imported from ${e.metadata.type}`});const a=e.nativeData?.importMetadata.modData?.initialBPM;a&&R(a),iy.success(`Imported ${e.metadata.type}: ${e.metadata.title}`,3e3),await ie.preloadInstruments(n)}catch(t){iy.error("Failed to import module")}finally{de(!1)}},je=h[m],Le=je?.length||64,Be=h.length,Ve=O&&!F,ze=O&&F;return bn.jsxs("div",{className:"ft2-toolbar "+(ae?"ft2-toolbar-compact":""),children:[bn.jsx("button",{className:"panel-collapse-toggle",onClick:se,children:ae?bn.jsx(Ce,{size:12}):bn.jsx(kt,{size:12})}),bn.jsxs("div",{className:"flex min-w-0 overflow-hidden",children:[bn.jsxs("div",{className:"flex-shrink min-w-0",children:[bn.jsxs("div",{className:"ft2-toolbar-row",children:[bn.jsxs("div",{className:"ft2-section ft2-col-1",children:[bn.jsx(GM,{label:"Position",value:M,onChange:e=>{N(e)},min:0,max:S.length-1,format:"hex"}),bn.jsxs("div",{className:"flex gap-1 ml-auto",children:[bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>I(M),className:"min-w-[32px]",children:"Ins"}),bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>{S.length>1&&_(M)},disabled:S.length<=1,className:"min-w-[32px]",children:"Del"})]})]}),bn.jsxs("div",{className:"ft2-section ft2-col-2",children:[bn.jsx(GM,{label:"BPM",value:D,onChange:R,min:32,max:255,throttleMs:50}),bn.jsx(jv,{variant:fe?"primary":"default",size:"sm",onClick:he,title:`Tap Tempo (${me} taps)`,className:"min-w-[40px] ml-1",children:bn.jsx(Vt,{size:14})})]}),bn.jsx("div",{className:"ft2-section ft2-col-3",children:bn.jsx(GM,{label:"Pattern",value:S[M]??m,onChange:e=>{const t=[...S];t[M]=e,k(t),f(e)},min:0,max:h.length-1,format:"hex"})}),bn.jsx("div",{className:"ft2-section ft2-col-instrument",children:bn.jsx(qM,{})}),bn.jsxs("div",{className:"ft2-section ft2-section-playback",children:[bn.jsx(jv,{variant:Ve?"danger":"primary",size:"sm",onClick:async()=>{O&&!F?z():(O&&z(),B(!1),await ie.init(),V())},className:"min-w-[72px]",children:Ve?"Stop Song":"Play Song"}),bn.jsx(jv,{variant:ze?"danger":"primary",size:"sm",onClick:async()=>{O&&F?z():(O&&z(),B(!0),await ie.init(),V())},className:"min-w-[88px]",children:ze?"Stop Pattern":"Play Pattern"}),bn.jsx(jv,{variant:C?"danger":"default",size:"sm",className:"min-w-[48px]",onClick:P,children:C?" Rec":"Rec"})]})]}),!ae&&bn.jsxs("div",{className:"ft2-toolbar-row",children:[bn.jsx("div",{className:"ft2-section ft2-col-1",children:bn.jsx(GM,{label:"Song Len",value:Be,onChange:e=>{const t=h.length;if(e>t)for(let n=t;n<e;n++)g(Le);else if(e<t&&e>=1)for(let n=t-1;n>=e;n--)y(n)},min:1,max:256,format:"hex"})}),bn.jsxs("div",{className:"ft2-section ft2-col-2",children:[bn.jsx(GM,{label:"Speed",value:j,onChange:L,min:1,max:31,format:"hex"}),bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>be(!0),title:`Groove & Swing Settings (Current: ${Ra.find(e=>e.id===U)?.name||"None"})`,className:"min-w-[32px] ml-1 "+("straight"!==U||K!==(q?50:100)||$>0?"text-accent-primary font-bold shadow-glow-sm border-accent-primary/50":""),children:"Groove"}),ve&&bn.jsx(cN,{onClose:()=>be(!1)})]}),bn.jsx("div",{className:"ft2-section ft2-col-3",children:bn.jsx(GM,{label:"Length",value:Le,onChange:e=>{e>=1&&e<=256&&x(m,e)},min:1,max:256,format:"hex",presets:[{label:"16 rows",value:16},{label:"32 rows",value:32},{label:"48 rows",value:48},{label:"64 rows (default)",value:64},{label:"96 rows",value:96},{label:"128 rows",value:128},{label:"192 rows",value:192},{label:"256 rows (max)",value:256}]})}),bn.jsx("div",{className:"ft2-section ft2-col-4"})]}),!ae&&bn.jsxs("div",{className:"ft2-toolbar-row",children:[bn.jsx("div",{className:"ft2-section ft2-col-1",children:bn.jsx(GM,{label:"Edit Step",value:E,onChange:T,min:0,max:16,format:"hex"})}),bn.jsx("div",{className:"ft2-section ft2-col-2",children:bn.jsxs("div",{className:"ft2-numeric-group",children:[bn.jsx("span",{className:"ft2-numeric-label",children:"Modify:"}),bn.jsxs("div",{className:"flex gap-1 ml-1",children:[bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>v?.(m),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Expand"}),bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>b?.(m),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Shrink"})]})]})}),bn.jsx("div",{className:"ft2-section ft2-col-3"}),bn.jsx("div",{className:"ft2-section ft2-col-4"})]}),bn.jsx("div",{className:"ft2-toolbar-row ft2-toolbar-row-menu",children:bn.jsxs("div",{className:"ft2-section",children:[bn.jsx("input",{ref:le,type:"file",accept:OE,onChange:async e=>{const t=e.target.files?.[0];if(t)if(e.target.value="",hM(t.name))Se(!0);else{O&&(z(),ie.releaseAll()),de(!0);try{if(t.name.toLowerCase().endsWith(".xml")){const e=await t.text(),n=t.name.replace(".xml","")||"Imported Pattern",{pattern:a}=_E(e,n),s=[...h,a];return w(s),f(s.length-1),iy.success(`Loaded DB303 pattern: ${a.name}`),void de(!1)}if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return".mid"===t||".midi"===t}(t.name)){const e=await PE(t,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64}),n=FE(e.patterns,[]);w(e.patterns),J(n),X({name:e.metadata.name,author:"",description:`Imported from ${t.name} (${e.metadata.tracks} tracks)`}),R(e.bpm),iy.success(`Loaded MIDI: ${e.metadata.name}`)}else{const e=await wC(t);if(!e)return void iy.error("Failed to import song");const{needsMigration:n,migrateProject:a}=await Pn(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Tf);return{needsMigration:e,migrateProject:t}},void 0);let s=e.patterns,r=e.instruments;if(n(s,r)){const e=a(s,r);s=e.patterns,r=e.instruments}if(w(s),e.sequence&&Array.isArray(e.sequence)){const t=new Map(s.map((e,t)=>[e.id,t])),n=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);n.length>0&&k(n)}r&&J(r),e.masterEffects&&Kf.getState().setMasterEffects(e.masterEffects),R(e.bpm),X(e.metadata),G(e.grooveTemplateId||"straight"),iy.success(`Loaded: ${e.metadata?.name||t.name}`)}}catch(n){iy.error(`Failed to load ${t.name}`)}finally{de(!1)}}},className:"hidden"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>Ne(!0),disabled:ce,loading:ce,children:"Load"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>{try{const e=h.map(e=>e.id),t={};h.forEach(e=>{e.channels.forEach((n,a)=>{const s=oe.filter(t=>t.patternId===e.id&&t.channelIndex===a);s.length>0&&(t[e.id]||(t[e.id]={}),t[e.id][a]=s.reduce((e,t)=>(e[t.parameter]=t,e),{}))})}),vC(Q,D,Z,h,e,Object.keys(t).length>0?t:void 0,ne.length>0?ne:void 0,oe.length>0?oe:void 0,{prettify:!0},U),iy.success("Song downloaded!",2e3)}catch(e){iy.error("Failed to download file")}},children:Y?"Save*":"Save"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>Pe(!0),children:"Clear"}),bn.jsx(jv,{variant:d?"primary":"ghost",size:"sm",onClick:t,children:"Patterns"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:l,children:"Order"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:i,children:"Instr"}),bn.jsx(jv,{variant:p?"primary":"ghost",size:"sm",onClick:o,children:"Instrument FX"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:c,children:"Pads"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:n,children:"Export"}),bn.jsx("div",{ref:Oe,children:bn.jsx(jv,{variant:ye?"primary":"ghost",size:"sm",onClick:()=>ge(!ye),children:"FX Presets"})}),ye&&bn.jsxs("div",{ref:_e,className:"fixed flex flex-col bg-dark-bgTertiary border border-dark-border rounded shadow-lg z-[9999] min-w-[260px] max-h-[400px] overflow-y-auto",style:{top:`${Fe.top}px`,left:`${Fe.left}px`},children:[bn.jsx("div",{className:"px-3 py-1 text-xs font-bold text-text-muted border-b border-dark-border",children:"Master FX Presets"}),ob.map(e=>bn.jsxs("button",{onClick:()=>(e=>{ge(!1);const t=e.effects.map((e,t)=>({...e,id:`master-fx-${Date.now()}-${t}`}));Kf.getState().setMasterEffects(t),iy.success(`Applied FX: ${e.name}`)})(e),className:"w-full text-left px-3 py-2 text-sm font-mono text-text-secondary hover:bg-dark-bgHover hover:text-text-primary transition-colors flex flex-col",children:[bn.jsx("span",{className:"font-bold",children:e.name}),bn.jsx("span",{className:"text-[10px] opacity-60",children:e.description})]},e.name))]}),bn.jsx(jv,{variant:u?"primary":"ghost",size:"sm",onClick:r,children:"Master FX"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:a,children:"Help"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>we(!0),children:"Settings"}),bn.jsx(jv,{variant:Te?"primary":"ghost",size:"sm",onClick:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},title:Te?"Exit Fullscreen (F11)":"Enter Fullscreen (F11)",children:Te?bn.jsx(Ot,{size:14}):bn.jsx(_t,{size:14})})]})})]}),bn.jsxs("div",{className:"flex-1 min-w-[120px] flex items-center justify-center border-l border-dark-border px-2 cursor-pointer relative group",onClick:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","sineScroll"],t=(e.indexOf(ue)+1)%e.length;pe(e[t])},children:[bn.jsxs("div",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-text-muted opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["v",Ig]}),re&&bn.jsxs(bn.Fragment,{children:[("waveform"===ue||"spectrum"===ue)&&bn.jsx(YM,{width:"auto",height:ae?70:100,mode:ue}),"channels"===ue&&bn.jsx(XM,{height:ae?70:100}),"logo"===ue&&bn.jsx(QM,{height:ae?70:100,onComplete:Ie}),"circular"===ue&&bn.jsx(ZM,{height:ae?70:100}),"bars"===ue&&bn.jsx(JM,{height:ae?70:100}),"particles"===ue&&bn.jsx(eN,{height:ae?70:100}),"chanWaves"===ue&&bn.jsx(tN,{height:ae?70:100}),"chanActivity"===ue&&bn.jsx(nN,{height:ae?70:100}),"chanSpectrum"===ue&&bn.jsx(aN,{height:ae?70:100}),"chanCircular"===ue&&bn.jsx(sN,{height:ae?70:100}),"chanParticles"===ue&&bn.jsx(rN,{height:ae?70:100}),"sineScroll"===ue&&bn.jsx(oN,{height:ae?70:100})]})]})]}),xe&&bn.jsx(lN,{onClose:()=>we(!1)}),bn.jsx(yM,{isOpen:ke,onClose:()=>Se(!1),onImport:Re}),bn.jsx(yC,{isOpen:Me,onClose:()=>Ne(!1),mode:"load",onLoad:async(e,t)=>{O&&(z(),ie.releaseAll());try{if("string"==typeof e&&t.toLowerCase().endsWith(".xml"))try{const n=e.includes("<db303-preset"),a=e.includes("<db303-pattern");if(n){const{parseDb303Preset:n}=await Pn(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-DfrzYuLg.js");return{parseDb303Preset:e}},[]),a=n(e),s=Z.find(e=>"TB303"===e.synthType);return s?(ee(s.id,{tb303:{...s.tb303,...a}}),void iy.success(`Loaded DB303 preset: ${t.replace(".xml","")}`)):void iy.error("No TB-303 instrument found. Please create one first.")}if(a){const n=t.replace(".xml","")||"Imported Pattern",a=Z.find(e=>"TB303"===e.synthType);if(!a)return void iy.error("No TB-303 instrument found. Please create one first.");const{pattern:s,tempo:r,swing:o}=_E(e,n,a.id);s.channels[0].instrumentId=a.id;const i=[...h,s];if(w(i),f(i.length-1),k([i.length-1]),void 0!==r&&R(r),void 0!==o){H(100+100*o),W(2)}return void iy.success(`Loaded DB303 pattern: ${s.name} (${s.length} steps${r?`, ${r} BPM`:""})`)}return void iy.error("Unknown XML format. Expected db303-pattern or db303-preset.")}catch(n){return void iy.error(`Failed to parse XML: ${n instanceof Error?n.message:"Unknown error"}`)}const{needsMigration:a,migrateProject:s}=await Pn(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Tf);return{needsMigration:e,migrateProject:t}},void 0);let r=e.patterns,o=e.instruments;if(a(r,o)){const e=s(r,o);r=e.patterns,o=e.instruments}if(r&&(w(r),e.sequence&&Array.isArray(e.sequence))){const t=new Map(r.map((e,t)=>[e.id,t])),n=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);n.length>0&&k(n)}o&&J(o),e.metadata&&X(e.metadata),e.bpm&&R(e.bpm),G(e.grooveTemplateId||"straight"),iy.success(`Loaded: ${e.metadata?.name||t}`)}catch(a){iy.error("Failed to load file")}},onLoadTrackerModule:async(e,t)=>{O&&(z(),ie.releaseAll());try{const{loadModuleFile:n}=await Pn(async()=>{const{loadModuleFile:e}=await Promise.resolve().then(()=>fM);return{loadModuleFile:e}},void 0),a=await n(new File([e],t));a&&await Re(a)}catch(n){iy.error("Failed to load module")}}}),Ee&&bn.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60",children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl",children:[bn.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Clear Project"}),bn.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"What would you like to clear?"}),bn.jsxs("div",{className:"flex flex-col gap-2",children:[bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>{O&&(z(),ie.releaseAll()),te(),Pe(!1),iy.success("Instruments cleared")},children:"Clear Instruments"}),bn.jsx(jv,{variant:"default",size:"sm",onClick:()=>{O&&(z(),ie.releaseAll()),A(),Pe(!1),iy.success("Song data cleared")},children:"Clear Song Data"}),bn.jsx(jv,{variant:"danger",size:"sm",onClick:()=>{O&&(z(),ie.releaseAll()),te(),A(),Pe(!1),iy.success("Project cleared")},children:"Clear Both"}),bn.jsx(jv,{variant:"ghost",size:"sm",onClick:()=>Pe(!1),children:"Cancel"})]})]})})]})},RE=200,jE=s.memo(({config:e,onChange:t,isBuzz3o3:n=!1})=>{const a=s.useRef(null),[r,o]=s.useState({mods:!1,lfo:!1,effects:!1}),i=s.useRef(e);i.current=e;const[l,c]=s.useState(1200);s.useLayoutEffect(()=>{const e=()=>{if(a.current?.parentElement){const e=a.current.parentElement.clientWidth-32;c(Math.max(1e3,e))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const d=(e,n)=>{t({filter:{...i.current.filter,[e]:n}})},u=(e,n)=>{t({filterEnvelope:{...i.current.filterEnvelope,[e]:n}})},p=(e,n)=>{const a=i.current.devilFish||{enabled:!1,normalDecay:.5,accentDecay:.5,vegDecay:.5,vegSustain:0,softAttack:0,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"};t({devilFish:{...a,[e]:n}})},h=(e,n)=>{t({oscillator:{...i.current.oscillator,[e]:n}})},m=(e,n)=>{const a=i.current.lfo||{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0};t({lfo:{...a,[e]:n}})},f=(e,n)=>{const a=i.current.chorus||{enabled:!1,mode:1,mix:.3};t({chorus:{...a,[e]:n}})},y=(e,n)=>{const a=i.current.phaser||{enabled:!1,rate:.5,depth:.5,feedback:.3,mix:.3};t({phaser:{...a,[e]:n}})},g=(e,n)=>{const a=i.current.delay||{enabled:!1,time:.25,feedback:.3,tone:.7,mix:.25,stereo:.5};t({delay:{...a,[e]:n}})},v=({label:e,expanded:t,onToggle:n,x:a,y:s,width:r,colorClass:o="text-accent-primary"})=>bn.jsx("div",{style:{left:`${a}px`,top:`${s}px`,width:`${r}px`,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",zIndex:10,pointerEvents:"auto"},onClick:n,className:"group",children:bn.jsxs("div",{className:zt("flex items-center gap-2 px-4 py-1.5 rounded-full bg-black/60 border border-white/10 group-hover:border-white/30 group-hover:bg-black/80 transition-all shadow-lg",o,t?"opacity-100":"opacity-70"),children:[t?bn.jsx(Ce,{size:14}):bn.jsx(Re,{size:14}),bn.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.15em]",children:e})]})}),b=(e,t,n,a,s=0)=>({left:`${e}px`,top:`${t+s}px`,width:`${n}px`,height:`${a}px`,position:"absolute"}),x=(e,t,n,a=0)=>({left:`${e}px`,top:`${t+a}px`,width:`${n}px`,position:"absolute",textAlign:"center",fontSize:"10px",fontWeight:"bold",color:"#888",textTransform:"uppercase",letterSpacing:"0.08em"}),w=230,k=165,S=r.mods,M=!n&&r.lfo,N=!n&&r.effects,C=S?0:-230,E=C+(M?0:-165),P=285+(S?w:0)+(M?k:0)+(N?175:0);return bn.jsx("div",{ref:a,className:"w-full overflow-visible flex justify-center py-4 select-none",style:{minHeight:`${P+32}px`,transition:"min-height 0.3s ease-out"},children:bn.jsxs("div",{className:"relative bg-[#1a1a1a] rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border-b-8 border-r-4 border-black/40 overflow-hidden",style:{width:`${l}px`,height:`${P}px`,background:"linear-gradient(180deg, #252525 0%, #1a1a1a 100%)",transition:"all 0.3s ease-out"},children:[bn.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[bn.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-black/20"}),bn.jsx("div",{className:"absolute top-[110px] left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]"}),bn.jsx("div",{style:x(40,115,400),className:"text-accent-primary opacity-80",children:"Filter & Envelope"}),bn.jsx("div",{style:x(670,115,80),className:"text-accent-primary opacity-80",children:"Output"}),bn.jsx("div",{style:{...x(l-360,115,320),textAlign:"right",paddingRight:"20px"},className:"text-cyan-400 opacity-80",children:"Oscillator"}),bn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:"285px"}}),bn.jsx(v,{label:"Modifications",expanded:S,onToggle:()=>o(e=>({...e,mods:!e.mods})),x:40,y:292,width:l-80,colorClass:"text-red-500"}),!n&&bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${285+(S?w:0)}px`,transition:"top 0.3s ease-out"}}),bn.jsx(v,{label:"LFO (Modulation)",expanded:r.lfo,onToggle:()=>o(e=>({...e,lfo:!e.lfo})),x:40,y:292+(S?w:0),width:l-80,colorClass:"text-purple-500"})]}),!n&&bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${285+(S?w:0)+(M?k:0)}px`,transition:"top 0.3s ease-out"}}),bn.jsx(v,{label:"Built-in Effects",expanded:r.effects,onToggle:()=>o(e=>({...e,effects:!e.effects})),x:40,y:292+(S?w:0)+(M?k:0),width:l-80,colorClass:"text-green-500"})]})]}),bn.jsx("div",{style:b(40,145,65,65),children:bn.jsx(Ov,{value:e.tuning??.5,min:0,max:1,bipolar:!0,onChange:e=>{t({tuning:e})},label:"Tune",size:"md",color:"#ffcc00",formatValue:e=>(e-.5>0?"+":"")+Math.round(100*(e-.5))+"c"})}),bn.jsx("div",{style:b(145,145,65,65),children:bn.jsx(Ov,{value:e.filter.cutoff,min:0,max:1,onChange:e=>d("cutoff",e),label:"Cutoff",size:"md",color:"#ffcc00",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"})}),bn.jsx("div",{style:b(250,145,65,65),children:bn.jsx(Ov,{value:e.filter.resonance,min:0,max:1,onChange:e=>d("resonance",e),label:"Reso",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(355,145,65,65),children:bn.jsx(Ov,{value:e.filterEnvelope.envMod,min:0,max:1,onChange:e=>u("envMod",e),label:"EnvMod",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(460,145,65,65),children:bn.jsx(Ov,{value:e.filterEnvelope.decay,min:0,max:1,onChange:e=>u("decay",e),label:"Decay",size:"md",color:"#ffcc00",formatValue:e=>Math.round(RE*Math.pow(10,e))+" ms"})}),bn.jsx("div",{style:b(565,145,65,65),children:bn.jsx(Ov,{value:e.accent.amount,min:0,max:1,onChange:e=>{return n="amount",a=e,void t({accent:{...i.current.accent,[n]:a}});var n,a},label:"Accent",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(670,145,80,80),children:bn.jsx(Ov,{value:e.volume??.75,min:0,max:1,onChange:e=>t({volume:e}),label:"Level",size:"lg",color:"#00ffff",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsxs("div",{style:{...b(l-360,145,320,80),display:"flex",alignItems:"center",gap:"12px",justifyContent:"flex-end",paddingRight:"20px"},children:[bn.jsx("div",{style:{width:"40px"},children:bn.jsx(Ov,{value:e.oscillator.pulseWidth??1,min:0,max:1,onChange:e=>h("pulseWidth",e),label:"PWM",size:"sm",color:"#00cccc",formatValue:e=>Math.round(50+49*e)+"%"})}),bn.jsx("div",{style:{width:"40px"},children:bn.jsx(Ov,{value:e.oscillator.subOscGain??0,min:0,max:1,onChange:e=>h("subOscGain",e),label:"SubG",size:"sm",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:{width:"40px"},children:bn.jsx(Ov,{value:e.oscillator.subOscBlend??1,min:0,max:1,onChange:e=>h("subOscBlend",e),label:"SubB",size:"sm",color:"#00cccc",formatValue:e=>e<.5?"Mix":"Add"})}),bn.jsx("div",{style:{width:"40px"},children:bn.jsx(Ov,{value:e.oscillator.pitchToPw??0,min:0,max:1,onChange:e=>h("pitchToPw",e),label:"PPW",size:"sm",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsxs("div",{className:"flex flex-col items-center justify-center",style:{minWidth:"60px"},children:[bn.jsx("span",{className:zt("text-[9px] font-bold mb-1 transition-colors","sawtooth"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SAW"}),bn.jsx(iN,{label:"",value:"square"===e.oscillator.type,onChange:e=>{return n=e?"square":"sawtooth",void t({oscillator:{...i.current.oscillator,type:n}});var n},color:"#00ffff",size:"sm"}),bn.jsx("span",{className:zt("text-[9px] font-bold mt-1 transition-colors","square"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SQR"})]})]}),S&&bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{style:b(52,325,50,45),className:"flex flex-col items-center",children:[bn.jsx(iN,{label:"",value:e.devilFish?.enabled||!1,onChange:e=>p("enabled",e),color:"#ff3333",size:"sm"}),bn.jsx("span",{className:"text-[8px] font-bold text-red-500 mt-1",children:"ENABLE"})]}),bn.jsx("div",{style:b(82,295,12,12),className:zt("rounded-full border border-black/40 transition-all duration-300",e.devilFish?.enabled?"bg-red-500 shadow-[0_0_10px_#ef4444]":"bg-red-950")}),bn.jsx("div",{style:b(125,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.normalDecay||.5,min:0,max:1,onChange:e=>p("normalDecay",e),label:"N.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(RE*Math.pow(10,e))+" ms"})}),bn.jsx("div",{style:b(195,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.accentDecay||.5,min:0,max:1,onChange:e=>p("accentDecay",e),label:"A.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(RE*Math.pow(10,e))+" ms"})}),bn.jsx("div",{style:b(265,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.softAttack||0,min:0,max:1,onChange:e=>p("softAttack",e),label:"S.Atk",size:"sm",color:"#ff3333",formatValue:e=>(.3*Math.pow(100,e)).toFixed(1)+" ms"})}),bn.jsx("div",{style:b(335,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.accentSoftAttack||.5,min:0,max:1,onChange:e=>p("accentSoftAttack",e),label:"A.Atk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(405,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.passbandCompensation||.9,min:0,max:1,onChange:e=>p("passbandCompensation",e),label:"Comp",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(475,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.resTracking||.7,min:0,max:1,onChange:e=>p("resTracking",e),label:"R.Trk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(545,325,40,40),children:bn.jsx(Ov,{value:e.slide?.time||.17,min:0,max:1,onChange:e=>{t({slide:{...i.current.slide,time:e}})},label:"Slide",size:"sm",color:"#ff3333",formatValue:e=>Math.round(2*Math.pow(180,e))+" ms"})}),bn.jsx("div",{style:b(615,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.filterInputDrive||0,min:0,max:1,onChange:e=>p("filterInputDrive",e),label:"Drive",size:"sm",color:"#ff3333",formatValue:e=>(10*e).toFixed(1)})}),bn.jsx("div",{style:b(680,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.diodeCharacter||0,min:0,max:1,onChange:e=>p("diodeCharacter",e),label:"Diode",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(740,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.duffingAmount||0,min:-1,max:1,bipolar:!0,onChange:e=>p("duffingAmount",e),label:"Duff",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(800,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.filterFmDepth||0,min:0,max:1,onChange:e=>p("filterFmDepth",e),label:"F.FM",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(860,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.lpBpMix||0,min:0,max:1,onChange:e=>p("lpBpMix",e),label:"LP/BP",size:"sm",color:"#ff9900",formatValue:e=>e<.05?"LP":e>.95?"BP":"Mix"})}),bn.jsx("div",{style:b(920,325,40,40),children:bn.jsx(Ov,{value:e.devilFish?.filterTracking||0,min:0,max:1,onChange:e=>p("filterTracking",e),label:"K.Trk",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsxs("div",{style:b(980,320,80,50),className:"flex flex-col",children:[bn.jsx("label",{className:"text-[8px] font-bold text-orange-500/70 mb-1 ml-1",children:"FILTER"}),bn.jsxs("select",{value:e.devilFish?.filterSelect??1,onChange:e=>p("filterSelect",parseInt(e.target.value)),className:"bg-[#111] text-[10px] text-orange-400 border border-orange-900/30 rounded px-1 py-1 outline-none focus:border-orange-500",children:[bn.jsx("option",{value:1,children:"303 Lowpass"}),bn.jsx("option",{value:5,children:"Korg Ladder"})]})]}),bn.jsx("div",{style:x(40,380,200),className:"text-cyan-400/60 text-[9px]",children:"KORG FILTER"}),bn.jsx("div",{style:b(60,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.korgBite??0,min:0,max:1,onChange:e=>p("korgBite",e),label:"Bite",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),bn.jsx("div",{style:b(120,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.korgClip??0,min:0,max:1,onChange:e=>p("korgClip",e),label:"Clip",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),bn.jsx("div",{style:b(180,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.korgCrossmod??0,min:0,max:1,onChange:e=>p("korgCrossmod",e),label:"XMod",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),bn.jsx("div",{style:b(240,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.korgQSag??0,min:0,max:1,onChange:e=>p("korgQSag",e),label:"Q.Sag",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),bn.jsx("div",{style:b(300,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.korgSharpness??.5,min:0,max:1,onChange:e=>p("korgSharpness",e),label:"Sharp",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),bn.jsx("div",{style:x(400,380,200),className:"text-yellow-400/60 text-[9px]",children:"EXTRAS"}),bn.jsx("div",{style:b(420,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.stageNLAmount??0,min:0,max:1,onChange:e=>p("stageNLAmount",e),label:"StgNL",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(480,395,40,40),children:bn.jsx(Ov,{value:e.devilFish?.ensembleAmount??0,min:0,max:1,onChange:e=>p("ensembleAmount",e),label:"Ensem",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:x(560,380,200),className:"text-gray-400/60 text-[9px]",children:"QUALITY"}),bn.jsxs("div",{style:b(580,390,90,45),className:"flex flex-col",children:[bn.jsx("label",{className:"text-[8px] font-bold text-gray-400/70 mb-1",children:"OVERSAMPLE"}),bn.jsxs("select",{value:e.devilFish?.oversamplingOrder??0,onChange:e=>p("oversamplingOrder",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-gray-300 border border-gray-700 rounded px-1 py-0.5 outline-none focus:border-gray-500",children:[bn.jsx("option",{value:0,children:"Off"}),bn.jsx("option",{value:1,children:"2"}),bn.jsx("option",{value:2,children:"4"}),bn.jsx("option",{value:3,children:"8"}),bn.jsx("option",{value:4,children:"16"})]})]})]}),M&&bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{style:b(60,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.rate??0,min:0,max:1,onChange:e=>m("rate",e),label:"Rate",size:"md",color:"#a855f7",formatValue:e=>{const t=.05*Math.pow(400,e);return t>=10?t.toFixed(1)+"Hz":t.toFixed(2)+"Hz"}})}),bn.jsx("div",{style:b(170,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.contour??0,min:-1,max:1,bipolar:!0,onChange:e=>m("contour",e),label:"Contour",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(280,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.pitchDepth??0,min:0,max:1,onChange:e=>m("pitchDepth",e),label:"Pitch",size:"md",color:"#a855f7",formatValue:e=>"+"+Math.round(12*e)+" semi"})}),bn.jsx("div",{style:b(390,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.pwmDepth??0,min:0,max:1,onChange:e=>m("pwmDepth",e),label:"PWM",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(500,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.filterDepth??0,min:0,max:1,onChange:e=>m("filterDepth",e),label:"Filter",size:"md",color:"#a855f7",formatValue:e=>"+"+(2*e).toFixed(1)+" oct"})}),bn.jsx("div",{style:b(610,480,65,65,C),children:bn.jsx(Ov,{value:e.lfo?.stiffDepth??0,min:0,max:1,onChange:e=>m("stiffDepth",e),label:"Stiff",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(720,483,150,50,C),className:"flex gap-2 items-center",children:[0,1,2].map(t=>bn.jsx("button",{onClick:()=>m("waveform",t),className:zt("px-2 py-1 text-[10px] font-bold rounded border transition-all",e.lfo?.waveform===t?"bg-purple-500 text-white border-purple-400":"bg-black/40 text-purple-500/60 border-purple-900/30"),children:["SIN","TRI","SQR"][t]},t))})]}),N&&bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{style:x(40,615,120,E),className:"text-green-400/60 text-[10px]",children:"CHORUS"}),bn.jsx("div",{style:b(60,635,40,40,E),children:bn.jsx(iN,{value:e.chorus?.enabled??!1,onChange:e=>f("enabled",e),label:"On",size:"sm"})}),bn.jsxs("div",{style:b(100,632,50,45,E),className:"flex flex-col",children:[bn.jsxs("select",{value:e.chorus?.mode??1,onChange:e=>f("mode",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-green-400 border border-green-900/30 rounded px-1 py-0.5 outline-none focus:border-green-500",children:[bn.jsx("option",{value:0,children:"Subtle"}),bn.jsx("option",{value:1,children:"Medium"}),bn.jsx("option",{value:2,children:"Wide"})]}),bn.jsx("span",{className:"text-[7px] text-gray-500 mt-0.5 text-center",children:"MODE"})]}),bn.jsx("div",{style:b(155,635,40,40,E),children:bn.jsx(Ov,{value:e.chorus?.mix??.5,min:0,max:1,onChange:e=>f("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:x(200,615,120,E),className:"text-green-400/60 text-[10px]",children:"PHASER"}),bn.jsx("div",{style:b(220,635,40,40,E),children:bn.jsx(Ov,{value:e.phaser?.rate??.5,min:0,max:1,onChange:e=>y("rate",e),label:"Rate",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(270,635,40,40,E),children:bn.jsx(Ov,{value:e.phaser?.depth??.7,min:0,max:1,onChange:e=>y("depth",e),label:"Width",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(320,635,40,40,E),children:bn.jsx(Ov,{value:e.phaser?.feedback??0,min:0,max:1,onChange:e=>y("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(370,635,40,40,E),children:bn.jsx(Ov,{value:e.phaser?.mix??0,min:0,max:1,onChange:e=>y("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:x(460,615,120,E),className:"text-green-400/60 text-[10px]",children:"DELAY"}),bn.jsx("div",{style:b(480,635,40,40,E),children:bn.jsx(Ov,{value:e.delay?.time??.5,min:0,max:1,onChange:e=>g("time",e),label:"Time",size:"sm",color:"#22c55e",formatValue:e=>(.25+15.75*e).toFixed(2)})}),bn.jsx("div",{style:b(530,635,40,40,E),children:bn.jsx(Ov,{value:e.delay?.feedback??0,min:0,max:1,onChange:e=>g("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(580,635,40,40,E),children:bn.jsx(Ov,{value:e.delay?.tone??.5,min:0,max:1,onChange:e=>g("tone",e),label:"Tone",size:"sm",color:"#22c55e",formatValue:e=>e<.4?"LP":e>.6?"HP":"Bypass"})}),bn.jsx("div",{style:b(630,635,40,40,E),children:bn.jsx(Ov,{value:e.delay?.mix??0,min:0,max:1,onChange:e=>g("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),bn.jsx("div",{style:b(680,635,40,40,E),children:bn.jsx(Ov,{value:e.delay?.stereo??.75,min:0,max:1,onChange:e=>g("stereo",e),label:"Spread",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})})]}),bn.jsxs("div",{className:"absolute top-4 left-6 flex items-center gap-4",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("div",{className:"bg-accent-primary p-1 rounded",children:bn.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"3",children:bn.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),bn.jsxs("div",{className:"flex flex-col -space-y-1",children:[bn.jsx("span",{className:"text-white font-black italic text-xl tracking-tighter",children:"DB-303"}),bn.jsx("span",{className:"text-[8px] text-gray-500 font-bold uppercase tracking-widest",children:"TB-303 WASM Engine"})]})]}),bn.jsx("div",{className:"h-8 w-px bg-gray-800"}),bn.jsxs("div",{className:"flex flex-col",children:[bn.jsx("label",{className:"text-[8px] font-bold text-gray-500 mb-1",children:"PRESET"}),bn.jsxs("select",{value:"",onChange:e=>{const n=um.find(t=>t.name===e.target.value);n?.tb303&&t(n.tb303)},className:"bg-[#111] text-[10px] text-accent-primary border border-gray-800 rounded px-2 py-1 outline-none focus:border-accent-primary transition-colors max-w-[120px]",children:[bn.jsx("option",{value:"",disabled:!0,children:"Load Preset..."}),um.map(e=>bn.jsx("option",{value:e.name,children:e.name},e.name))]})]})]}),bn.jsxs("div",{className:"absolute bottom-2 right-4 text-[8px] text-gray-600 font-mono",children:["V",Ig,"-WASM"]})]})})});jE.displayName="JC303StyledKnobPanel";const LE=s.memo(()=>{const{instruments:e,updateInstrument:t}=Df(On(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument}))),{tb303Collapsed:n,toggleTB303Collapsed:a}=jf(On(e=>({tb303Collapsed:e.tb303Collapsed,toggleTB303Collapsed:e.toggleTB303Collapsed}))),{controlledInstrumentId:r}=Ny(),o=r?e.find(e=>e.id===r&&"TB303"===e.synthType):e.find(e=>"TB303"===e.synthType),i=s.useCallback(async e=>{if(!o)return;const n={...o.tb303,...e};t(o.id,{tb303:n});const a=await Pn(()=>Promise.resolve().then(()=>tm),void 0),s=(a.default||a).getInstrument(o.id,o);s&&"setCutoff"in s&&Object.entries(e).forEach(([e,t])=>{if(!t||"object"!=typeof t)return void("tuning"===e?s.setTuning(t):"volume"===e&&s.setVolume(t));const n=t;"filter"===e?("cutoff"in n&&s.setCutoff(n.cutoff),"resonance"in n&&s.setResonance(n.resonance)):"filterEnvelope"===e?("envMod"in n&&s.setEnvMod(n.envMod),"decay"in n&&s.setDecay(n.decay)):"accent"===e?"amount"in n&&s.setAccent(n.amount):"oscillator"===e?("type"in n&&s.setWaveform("square"===n.type?1:0),"pulseWidth"in n&&s.setPulseWidth(n.pulseWidth),"subOscGain"in n&&s.setSubOscGain(n.subOscGain),"subOscBlend"in n&&s.setSubOscBlend(n.subOscBlend),"pitchToPw"in n&&s.setPitchToPw(n.pitchToPw)):"slide"===e?"time"in n&&s.setSlideTime(n.time):"devilFish"===e?("enabled"in n&&s.enableDevilFish(n.enabled),"normalDecay"in n&&s.setNormalDecay(n.normalDecay),"accentDecay"in n&&s.setAccentDecay(n.accentDecay),"softAttack"in n&&s.setSoftAttack(n.softAttack),"accentSoftAttack"in n&&s.setAccentSoftAttack(n.accentSoftAttack),"passbandCompensation"in n&&s.setPassbandCompensation(n.passbandCompensation),"resTracking"in n&&s.setResTracking(n.resTracking),"filterInputDrive"in n&&s.setFilterInputDrive(n.filterInputDrive),"diodeCharacter"in n&&s.setDiodeCharacter(n.diodeCharacter),"duffingAmount"in n&&s.setDuffingAmount(n.duffingAmount),"filterFmDepth"in n&&s.setFilterFmDepth(n.filterFmDepth),"lpBpMix"in n&&s.setLpBpMix(n.lpBpMix),"filterTracking"in n&&s.setFilterTracking(n.filterTracking),"filterSelect"in n&&s.setFilterSelect(n.filterSelect)):"lfo"===e?("waveform"in n&&s.setLfoWaveform(n.waveform),"rate"in n&&s.setLfoRate(n.rate),"contour"in n&&s.setLfoContour(n.contour),"pitchDepth"in n&&s.setLfoPitchDepth(n.pitchDepth),"pwmDepth"in n&&s.setLfoPwmDepth(n.pwmDepth),"filterDepth"in n&&s.setLfoFilterDepth(n.filterDepth),"stiffDepth"in n&&s.setLfoStiffDepth(n.stiffDepth)):"chorus"===e?("mode"in n&&s.setChorusMode(n.mode),"mix"in n&&s.setChorusMix(n.mix)):"phaser"===e?("rate"in n&&s.setPhaserRate(n.rate),"depth"in n&&s.setPhaserDepth(n.depth),"feedback"in n&&s.setPhaserFeedback(n.feedback),"mix"in n&&s.setPhaserMix(n.mix)):"delay"===e&&("time"in n&&s.setDelayTime(n.time),"feedback"in n&&s.setDelayFeedback(n.feedback),"tone"in n&&s.setDelayTone(n.tone),"mix"in n&&s.setDelayMix(n.mix),"stereo"in n&&s.setDelaySpread(n.stereo))})},[o,t]);return o&&o.tb303?n?bn.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[bn.jsx("div",{className:"absolute top-0 right-0 z-50",children:bn.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:a,title:"Expand synth panel",children:bn.jsx(Ce,{size:16})})}),bn.jsxs("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[bn.jsx("span",{className:"font-bold",children:"TB-303"}),bn.jsxs("span",{className:"text-gray-500",children:["CH",String(e.indexOf(o)+1).padStart(2,"0")]}),bn.jsx("span",{className:"text-gray-400",children:o.name})]})]}):bn.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",maxHeight:"400px",background:"#1a1a1a",borderTop:"1px solid #333",overflow:"auto"},children:[bn.jsxs("div",{className:"sticky top-0 right-0 z-50 flex justify-end gap-1 bg-black/80 p-1",children:[bn.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80",onClick:a,title:"Collapse synth panel",children:bn.jsx(kt,{size:16})}),bn.jsx("button",{className:"p-2 text-gray-400 hover:text-red-400 bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:()=>jf.getState().setTB303Collapsed(!0),title:"Close synth panel",children:bn.jsx(Te,{size:16})})]}),bn.jsx("div",{children:bn.jsx(jE,{config:o.tb303,onChange:i},o.id)})]}):null});LE.displayName="TB303KnobPanel";class BE{key=0;octave=0;accent=!1;slide=!1;gate=!1;mute=!1;hammer=!1;constructor(){}isInDefaultState(){return!(0!==this.key||0!==this.octave||this.accent||this.slide||this.gate||this.mute||this.hammer)}clone(){const e=new BE;return e.key=this.key,e.octave=this.octave,e.accent=this.accent,e.slide=this.slide,e.gate=this.gate,e.mute=this.mute,e.hammer=this.hammer,e}toMidiNote(e=36){return e+12*this.octave+this.key}static fromMidiNote(e,t=36){const n=new BE,a=e-t;return n.octave=Math.floor(a/12),n.key=(a%12+12)%12,n}}class VE{static MAX_NUM_STEPS=32;notes=[];numSteps=16;stepLength=1;constructor(){for(let e=0;e<VE.MAX_NUM_STEPS;e++)this.notes.push(new BE)}setStepLength(e){this.stepLength=e}setKey(e,t){e>=0&&e<this.numSteps&&(this.notes[e].key=t)}setOctave(e,t){e>=0&&e<this.numSteps&&(this.notes[e].octave=t)}setAccent(e,t){e>=0&&e<this.numSteps&&(this.notes[e].accent=t)}setSlide(e,t){e>=0&&e<this.numSteps&&(this.notes[e].slide=t)}setGate(e,t){e>=0&&e<this.numSteps&&(this.notes[e].gate=t)}setMute(e,t){e>=0&&e<this.numSteps&&(this.notes[e].mute=t)}setHammer(e,t){e>=0&&e<this.numSteps&&(this.notes[e].hammer=t)}setNote(e,t){e>=0&&e<this.numSteps&&(this.notes[e]=t.clone())}getStepLength(){return this.stepLength}getKey(e){return e>=0&&e<this.numSteps?this.notes[e].key:0}getOctave(e){return e>=0&&e<this.numSteps?this.notes[e].octave:0}getAccent(e){return e>=0&&e<this.numSteps&&this.notes[e].accent}getSlide(e){return e>=0&&e<this.numSteps&&this.notes[e].slide}getGate(e){return e>=0&&e<this.numSteps&&this.notes[e].gate}getMute(e){return e>=0&&e<this.numSteps&&this.notes[e].mute}getHammer(e){return e>=0&&e<this.numSteps&&this.notes[e].hammer}getNote(e){return e>=0&&e<this.numSteps?this.notes[e]:null}getNumSteps(){return this.numSteps}setNumSteps(e){e>=1&&e<=VE.MAX_NUM_STEPS&&(this.numSteps=e)}static getMaxNumSteps(){return VE.MAX_NUM_STEPS}clear(){for(let e=0;e<this.numSteps;e++)this.notes[e]=new BE}randomize(){const e=[0,2,3,5,7,8,10],t=[-1,0,1];for(let n=0;n<this.numSteps;n++)this.notes[n].key=e[Math.floor(Math.random()*e.length)],this.notes[n].octave=t[Math.floor(Math.random()*t.length)],this.notes[n].gate=Math.random()>.3,this.notes[n].accent=Math.random()>.7,this.notes[n].slide=Math.random()>.85,this.notes[n].mute=!1,this.notes[n].hammer=!1}circularShift(e){if(0===e)return;e=(e%this.numSteps+this.numSteps)%this.numSteps;const t=[];for(let n=0;n<this.numSteps;n++)t.push(this.notes[n].clone());for(let n=0;n<this.numSteps;n++){const a=(n-e+this.numSteps)%this.numSteps;this.notes[n]=t[a]}}isEmpty(){for(let e=0;e<this.numSteps;e++)if(!this.notes[e].isInDefaultState())return!1;return!0}clone(){const e=new VE;e.numSteps=this.numSteps,e.stepLength=this.stepLength;for(let t=0;t<this.numSteps;t++)e.notes[t]=this.notes[t].clone();return e}toJSON(){return{numSteps:this.numSteps,stepLength:this.stepLength,notes:this.notes.map(e=>({key:e.key,octave:e.octave,accent:e.accent,slide:e.slide,gate:e.gate,mute:e.mute,hammer:e.hammer}))}}static fromJSON(e){const t=new VE;if(e.numSteps&&(t.numSteps=e.numSteps),e.stepLength&&(t.stepLength=e.stepLength),e.notes)for(let n=0;n<Math.min(e.notes.length,VE.MAX_NUM_STEPS);n++){const a=e.notes[n];t.notes[n].key=a.key||0,t.notes[n].octave=a.octave||0,t.notes[n].accent=a.accent||!1,t.notes[n].slide=a.slide||!1,t.notes[n].gate=a.gate||!1,t.notes[n].mute=a.mute||!1,t.notes[n].hammer=a.hammer||!1}return t}}const zE=0,UE=1;class GE{sampleRate=44100;bpm=140;running=!1;mode=zE;modeChanged=!1;patterns=[];activePattern=0;static NUM_PATTERNS=8;step=0;countDown=0;driftError=0;previousSlideFlag=!1;previousHammerFlag=!1;keyPermissible=new Array(13).fill(!0);eventCallback=null;constructor(){for(let e=0;e<GE.NUM_PATTERNS;e++)this.patterns.push(new VE)}setSampleRate(e){e>0&&(this.sampleRate=e)}setTempo(e){this.bpm=e}setMode(e){e>=0&&e<3&&(this.mode=e,this.modeChanged=!0)}setActivePattern(e){e>=0&&e<this.patterns.length&&(this.activePattern=e)}setEventCallback(e){this.eventCallback=e}getPattern(e){return e>=0&&e<this.patterns.length?this.patterns[e]:null}getActivePattern(){return this.patterns[this.activePattern]}getNumPatterns(){return GE.NUM_PATTERNS}setKeyPermissible(e,t){e>=0&&e<=12&&(this.keyPermissible[e]=t)}toggleKeyPermissibility(e){e>=0&&e<=12&&(this.keyPermissible[e]=!this.keyPermissible[e])}isKeyPermissible(e){return e>=0&&e<=12&&this.keyPermissible[e]}start(){this.running=!0,this.countDown=-1,this.step=0,this.driftError=0,this.previousSlideFlag=!1,this.previousHammerFlag=!1,this.eventCallback&&this.eventCallback({type:"step",step:0})}stop(){this.running=!1,this.eventCallback&&this.eventCallback({type:"noteOff"})}reset(){this.step=0,this.countDown=0,this.driftError=0,this.previousSlideFlag=!1,this.previousHammerFlag=!1}isRunning(){return this.running}modeWasChanged(){const e=this.modeChanged;return this.modeChanged=!1,e}getCurrentStep(){return this.step}processSamples(e){if(!this.running||this.mode===zE)return;if(this.getActivePattern())for(let t=0;t<e;t++)this.processSample()}processSample(){const e=this.getActivePattern();if(this.countDown<=0){this.triggerStep();const t=60*this.sampleRate/this.bpm/4*e.getStepLength();this.countDown=Math.round(t-this.driftError),this.driftError=t-this.driftError-this.countDown,this.step=(this.step+1)%e.getNumSteps()}this.countDown--}triggerStep(){const e=this.getActivePattern().getNote(this.step);if(e){if(this.eventCallback&&this.eventCallback({type:"step",step:this.step}),e.mute)return this.eventCallback&&this.eventCallback({type:"noteOff"}),this.previousSlideFlag=!1,void(this.previousHammerFlag=!1);if(e.gate){let t=e.toMidiNote();this.isKeyPermissible(e.key)||(t=this.findClosestPermissibleKey(e.key,e.octave));const n=this.previousSlideFlag&&!this.previousHammerFlag,a=this.previousHammerFlag,s=n||a;this.eventCallback&&this.eventCallback({type:"noteOn",midiNote:t,velocity:e.accent?127:100,accent:e.accent,slide:s,hammer:a}),this.previousSlideFlag=e.slide,this.previousHammerFlag=e.hammer}else this.eventCallback&&this.eventCallback({type:"noteOff"}),this.previousSlideFlag=!1,this.previousHammerFlag=!1}}findClosestPermissibleKey(e,t){for(let n=1;n<=6;n++){const a=e-n;if(a>=0&&this.isKeyPermissible(a))return 36+12*t+a;const s=e+n;if(s<=11&&this.isKeyPermissible(s))return 36+12*t+s}return 36+12*t+e}loadPatternsFromJSON(e){if(e.patterns&&Array.isArray(e.patterns))for(let t=0;t<Math.min(e.patterns.length,this.patterns.length);t++)this.patterns[t]=VE.fromJSON(e.patterns[t])}exportPatternsToJSON(){return{patterns:this.patterns.map(e=>e.toJSON()),bpm:this.bpm,activePattern:this.activePattern}}}class KE{audioContext;sequencer;tb303Engine=null;scriptProcessor=null;isRunning=!1;currentStep=0;lastNoteOn=null;stepCallback=null;noteCallback=null;constructor(e,t={}){this.audioContext=e,this.sequencer=new GE,this.sequencer.setSampleRate(t.sampleRate||e.sampleRate),this.sequencer.setTempo(t.bpm||140),this.sequencer.setMode(t.mode||UE),this.sequencer.setEventCallback(e=>this.handleSequencerEvent(e))}connectToTB303(e){this.tb303Engine=e}start(){if(this.isRunning)return;const e=qa(this.audioContext);this.scriptProcessor=e.createScriptProcessor(256,0,1),this.scriptProcessor.onaudioprocess=e=>{const t=e.outputBuffer.length;this.sequencer.processSamples(t);e.outputBuffer.getChannelData(0).fill(0)},this.scriptProcessor.connect(e.destination),this.sequencer.start(),this.isRunning=!0}stop(){this.isRunning&&(this.sequencer.stop(),this.scriptProcessor&&(this.scriptProcessor.disconnect(),this.scriptProcessor=null),this.tb303Engine&&null!==this.lastNoteOn&&(this.tb303Engine.noteOff(),this.lastNoteOn=null),this.isRunning=!1)}handleSequencerEvent(e){switch(e.type){case"noteOn":this.tb303Engine&&void 0!==e.midiNote&&(this.tb303Engine.noteOn(e.midiNote,e.velocity||100,e.accent||!1,e.slide||!1),this.lastNoteOn=e.midiNote),this.noteCallback&&this.noteCallback(e);break;case"noteOff":this.tb303Engine&&(this.tb303Engine.noteOff(),this.lastNoteOn=null),this.noteCallback&&this.noteCallback(e);break;case"step":this.currentStep=e.step||0,this.stepCallback&&this.stepCallback(this.currentStep)}}setTempo(e){this.sequencer.setTempo(e)}setActivePattern(e){this.sequencer.setActivePattern(e)}getPattern(e){return this.sequencer.getPattern(e)}getActivePattern(){return this.sequencer.getActivePattern()}getCurrentStep(){return this.currentStep}getNumPatterns(){return this.sequencer.getNumPatterns()}onStep(e){this.stepCallback=e}onNote(e){this.noteCallback=e}getIsRunning(){return this.isRunning}loadPatterns(e){this.sequencer.loadPatternsFromJSON(e)}exportPatterns(){return this.sequencer.exportPatternsToJSON()}dispose(){this.stop()}}const HE=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],WE=[1,3,6,8,10],$E=({step:e,stepIndex:t,position:n,onChange:a,onClose:r,onNavigate:o,unitId:i=1})=>{const[l,c]=s.useState(!0),d=s.useRef(null);s.useEffect(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]);const u=s.useCallback(t=>{if(a({note:t}),l)try{const n=em(),a=Df.getState().instruments.find(e=>e.id===i);if(a&&n){const s=`${t}${e.octave??2}`;n.triggerNote(i,s,.2,x(),.8,a,e.accent,e.slide)}}catch(n){}},[a,l,i,e.octave,e.accent,e.slide]),p=s.useCallback(t=>{const n=e.octave===t?2:t;a({octave:n})},[e.octave,a]),h=s.useCallback(t=>{a({[t]:!e[t]})},[e,a]),m={position:"fixed",left:`${n.x}px`,top:`${n.y}px`,transform:"translate(-50%, -100%) translateY(-10px)",zIndex:1e4};return bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"piano-popover-overlay"}),bn.jsxs("div",{ref:d,className:"piano-popover",style:m,children:[bn.jsxs("div",{className:"popover-header",children:[bn.jsxs("div",{className:"step-navigation",children:[bn.jsx("button",{className:"nav-btn",onClick:()=>o("prev"),"aria-label":"Previous step",children:""}),bn.jsxs("div",{className:"step-indicator",children:["Step ",(t+1).toString().padStart(2,"0")]}),bn.jsx("button",{className:"nav-btn",onClick:()=>o("next"),"aria-label":"Next step",children:""})]}),bn.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:""})]}),bn.jsxs("div",{className:"popover-controls",children:[bn.jsxs("div",{className:"control-group",children:[bn.jsx("div",{className:"control-label",children:"Octave"}),bn.jsxs("div",{className:"octave-selector",children:[bn.jsx("button",{className:"octave-select-btn "+(1===e.octave?"active":""),onClick:()=>p(1),children:"DN"}),bn.jsx("button",{className:"octave-select-btn "+(2===e.octave?"active":""),onClick:()=>p(2),children:"MID"}),bn.jsx("button",{className:"octave-select-btn "+(3===e.octave?"active":""),onClick:()=>p(3),children:"UP"})]})]}),bn.jsxs("div",{className:"control-group",children:[bn.jsx("div",{className:"control-label",children:"Modifiers"}),bn.jsxs("div",{className:"modifier-toggles",children:[bn.jsx("button",{className:"modifier-btn accent "+(e.accent?"active":""),onClick:()=>h("accent"),children:bn.jsx("span",{children:"AC"})}),bn.jsx("button",{className:"modifier-btn slide "+(e.slide?"active":""),onClick:()=>h("slide"),children:bn.jsx("span",{children:"SL"})})]})]}),bn.jsxs("div",{className:"control-group",children:[bn.jsx("div",{className:"control-label",children:"TT-303"}),bn.jsxs("div",{className:"modifier-toggles",children:[bn.jsx("button",{className:"modifier-btn mute "+(e.mute?"active":""),onClick:()=>h("mute"),title:"Mute - silent step, data preserved",children:bn.jsx("span",{children:"MT"})}),bn.jsx("button",{className:"modifier-btn hammer "+(e.hammer?"active":""),onClick:()=>h("hammer"),title:"Hammer - legato without pitch glide",children:bn.jsx("span",{children:"HM"})})]})]}),bn.jsxs("div",{className:"preview-toggle",children:[bn.jsx("input",{type:"checkbox",id:`preview-${i}-${t}`,checked:l,onChange:e=>c(e.target.checked)}),bn.jsx("label",{htmlFor:`preview-${i}-${t}`,children:"Preview Sound"})]})]}),bn.jsx("div",{className:"piano-keyboard",children:HE.map((t,n)=>{const a=WE.includes(n),s=e.note===t;return bn.jsx("div",{className:`\n                  piano-key\n                  ${a?"black":"white"}\n                  ${s?"selected":""}\n                `,onClick:()=>u(t),children:bn.jsx("div",{className:"key-label",children:t})},t)})})]})]})},qE=({steps:e,currentStep:t=-1,isPlaying:n=!1,onStepChange:a,onStepToggle:r,unitId:o=1})=>{const[i,l]=s.useState(null),c=s.useRef(null),d=s.useCallback(e=>{r&&r(e)},[r]),u=s.useCallback((e,t)=>{e.stopPropagation();const n=e.target.getBoundingClientRect();l({visible:!0,stepIndex:t,x:n.left+n.width/2,y:n.top})},[]),p=s.useCallback((t,n,s)=>{if(t.stopPropagation(),!a)return;const r=e[n],o=r.octave===s?2:s;a(n,{...r,octave:o})},[e,a]),h=s.useCallback((t,n,s)=>{if(t.stopPropagation(),!a)return;const r=e[n];a(n,{...r,[s]:!r[s]})},[e,a]),m=s.useCallback((t,n)=>{if(!a)return;const s=e[t];a(t,{...s,...n})},[e,a]),f=s.useCallback(()=>{l(null)},[]),y=s.useCallback(e=>{if(!i)return;const t="prev"===e?(i.stepIndex-1+16)%16:(i.stepIndex+1)%16;l({...i,stepIndex:t})},[i]);return bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{ref:c,className:"tb303-sequencer",children:e.map((e,a)=>bn.jsxs("div",{className:`\n              tb303-step\n              ${e.active?"active":""}\n              ${n&&a===t?"current":""}\n            `,onClick:()=>d(a),children:[bn.jsx("div",{className:"step-led"}),bn.jsx("div",{className:"step-note",onClick:e=>u(e,a),children:e.note}),bn.jsxs("div",{className:"step-octave-btns",children:[bn.jsx("div",{className:"octave-btn "+(1===e.octave?"active":""),onClick:e=>p(e,a,1),children:"DN"}),bn.jsx("div",{className:"octave-btn "+(3===e.octave?"active":""),onClick:e=>p(e,a,3),children:"UP"})]}),bn.jsxs("div",{className:"step-toggles",children:[bn.jsx("div",{className:"toggle-btn accent "+(e.accent?"active":""),onClick:e=>h(e,a,"accent"),children:"AC"}),bn.jsx("div",{className:"toggle-btn slide "+(e.slide?"active":""),onClick:e=>h(e,a,"slide"),children:"SL"})]})]},a))}),i?.visible&&bn.jsx($E,{step:e[i.stepIndex],stepIndex:i.stepIndex,position:{x:i.x,y:i.y},onChange:e=>m(i.stepIndex,e),onClose:f,onNavigate:y,unitId:o})]})},YE={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},XE=e=>{if("number"==typeof e){if(0===e||97===e)return{note:"C",octave:2};const t=Va(e),n=t.substring(0,2),a=t.substring(2),s=parseInt(a,10);let r=2;s<=2?r=1:s>=4&&(r=3);return{note:n.replace("-",""),octave:r}}if("string"==typeof e){if(!e||"..."===e||"==="===e)return{note:"C",octave:2};const t=e.substring(0,2),n=e.substring(2),a=parseInt(n,10);let s=2;a<=2?s=1:a>=4&&(s=3);return{note:t.replace("-",""),octave:s}}return{note:"C",octave:2}},QE=(e,t)=>{const n=1===t?2:2===t?3:4;return Ba(`${1===e.length?`${e}-`:e}${n}`)},ZE=({channelIndex:t=0})=>{const{patterns:n,currentPatternIndex:a,setCell:r}=cm(),{instruments:o,updateInstrument:i}=Df(),l=n[a],c=l?.channels[t],d=c?.instrumentId??0,u=o.find(e=>e.id===d),[p,h]=s.useState(!1),[m,f]=s.useState(-1),[y,g]=s.useState(130),[v,b]=s.useState(!1),x=s.useRef(u),w=s.useRef(u?.tb303);x.current=u,w.current=u?.tb303;const k=s.useRef(null),S=s.useCallback(e=>{k.current&&clearTimeout(k.current),k.current=window.setTimeout(()=>{i(d,e),k.current=null},300)},[d,i]),M=u?.tb303,N="square"===M?.oscillator.type?1:0,C=M?.filter.cutoff??1e3,E=M?.filter.resonance??50,P=M?.filterEnvelope.envMod??50,T=M?.filterEnvelope.decay??300,A=M?.accent.amount??50,I=s.useMemo(()=>{if(!l||!l.channels[t])return Array.from({length:16},()=>({active:!1,note:"C",octave:2,accent:!1,slide:!1}));const e=l.channels[t],n=[];for(let t=0;t<16;t++){const a=e.rows[t],s=!(!a||!a.note||0===a.note||97===a.note),{note:r,octave:o}=s?XE(a.note):{note:"C",octave:2};n.push({active:s,note:r,octave:o,accent:!(1!==a?.flag1&&1!==a?.flag2),slide:!(2!==a?.flag1&&2!==a?.flag2)})}return n},[l,t]),_=e.useRef(null);s.useEffect(()=>(u&&("TB303"===u.synthType||"Buzz3o3"===u.synthType||u.tb303)&&(async()=>{try{const e=em();await e.init();const n=e.getInstrument(d,u,t),a=new KE(e.masterInput.context,{bpm:y});a.connectToTB303(n),a.onStep(e=>f(e)),_.current=a,O()}catch(e){}})(),()=>{_.current&&(_.current.dispose(),_.current=null)}),[d,t,u]);const O=s.useCallback(()=>{if(!_.current)return;const e=_.current.getActivePattern();for(let t=0;t<16;t++){const n=I[t];if(e.setGate(t,n.active),n.active){const a=YE[n.note]??0;e.setKey(t,a);const s=n.octave-2;e.setOctave(t,s),e.setAccent(t,n.accent),e.setSlide(t,n.slide)}}},[I]);s.useEffect(()=>{O()},[I,O]),s.useEffect(()=>{_.current&&_.current.setTempo(y)},[y]);const F=s.useCallback(e=>{u&&M&&i(d,{tb303:{...M,oscillator:{...M.oscillator,type:e<.5?"sawtooth":"square"}}})},[d,u,M,i]),D=s.useCallback(e=>{const t=w.current;if(!x.current||!t)return;const n={...t,filter:{...t.filter,cutoff:e}};em().updateTB303Parameters(d,n),S({tb303:n})},[d,S]),R=s.useCallback(e=>{const t=w.current;if(!x.current||!t)return;const n={...t,filter:{...t.filter,resonance:e}};em().updateTB303Parameters(d,n),S({tb303:n})},[d,S]),j=s.useCallback(e=>{const t=w.current;if(!x.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,envMod:e}};em().updateTB303Parameters(d,n),S({tb303:n})},[d,S]),L=s.useCallback(e=>{const t=w.current;if(!x.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,decay:e}};em().updateTB303Parameters(d,n),S({tb303:n})},[d,S]),B=s.useCallback(e=>{const t=w.current;if(!x.current||!t)return;const n={...t,accent:{...t.accent,amount:e}};em().updateTB303Parameters(d,n),S({tb303:n})},[d,S]),V=s.useCallback((e,n)=>{r(t,e,{note:n.active?QE(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[t,r]),z=s.useCallback(e=>{const n=I[e],a=!n.active;r(t,e,{note:a?QE(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[t,r,I]);return u?M||"TB303"===u.synthType||"Buzz3o3"===u.synthType?bn.jsxs("div",{className:"tb303-view",children:[bn.jsxs(bn.Fragment,{children:[bn.jsxs("div",{className:"tb303-transport",children:[bn.jsxs("button",{onClick:()=>{_.current&&(p?(_.current.stop(),h(!1),f(-1)):(_.current.start(),h(!0)))},className:"transport-btn "+(p?"stop":"play"),children:[p?bn.jsx(Tt,{size:16}):bn.jsx(At,{size:16}),bn.jsx("span",{children:p?"Stop":"Play"})]}),bn.jsxs("div",{className:"transport-bpm",children:[bn.jsx("label",{children:"BPM"}),bn.jsx("input",{type:"number",value:y,onChange:e=>g(parseInt(e.target.value)||130),min:"60",max:"200"})]}),p&&bn.jsxs("div",{className:"transport-step",children:["Step ",(m+1).toString().padStart(2,"0"),"/16"]}),bn.jsx("div",{className:"transport-spacer"}),bn.jsxs("button",{onClick:()=>b(!0),className:"pattern-btn acid",children:[bn.jsx(st,{size:16}),bn.jsx("span",{children:"Acid"})]}),bn.jsxs("button",{onClick:()=>{const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let n=0;n<16;n++){const a=Math.random()>.3,s=e[Math.floor(Math.random()*e.length)],o=Math.floor(3*Math.random())+1,i=Math.random()>.7,l=Math.random()>.8;r(t,n,{note:a?QE(s,o):0,flag1:i?1:0,flag2:l?2:0})}},className:"pattern-btn randomize",children:[bn.jsx(St,{size:16}),bn.jsx("span",{children:"Random"})]}),bn.jsxs("button",{onClick:()=>{for(let e=0;e<16;e++)r(t,e,{note:0,flag1:0,flag2:0})},className:"pattern-btn clear",children:[bn.jsx(Le,{size:16}),bn.jsx("span",{children:"Clear"})]})]}),bn.jsxs("div",{className:"tb303-sequencer-section",children:[bn.jsx("h3",{className:"section-title",children:"Pattern Sequencer"}),bn.jsx(qE,{steps:I,currentStep:m,isPlaying:p,onStepChange:V,onStepToggle:z,unitId:1})]}),bn.jsxs("div",{className:"tb303-params-section",children:[bn.jsx("h3",{className:"section-title",children:"TB-303 Parameters"}),bn.jsxs("div",{className:"params-grid",children:[bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Waveform",value:N,min:0,max:1,step:.01,onChange:F,bipolar:!1,size:"md"}),bn.jsx("div",{className:"param-value",children:N<.5?"Saw":"Square"})]}),bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Cutoff",value:C,min:200,max:5e3,logarithmic:!0,onChange:D,bipolar:!1,size:"md"}),bn.jsxs("div",{className:"param-value",children:[Math.round(C),"Hz"]})]}),bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Resonance",value:E,min:0,max:100,onChange:R,bipolar:!1,size:"md"}),bn.jsxs("div",{className:"param-value",children:[E,"%"]})]}),bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Env Mod",value:P,min:0,max:100,onChange:j,bipolar:!1,size:"md"}),bn.jsxs("div",{className:"param-value",children:[P,"%"]})]}),bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Decay",value:T,min:200,max:2e3,logarithmic:!0,onChange:L,bipolar:!1,size:"md"}),bn.jsxs("div",{className:"param-value",children:[Math.round(T),"ms"]})]}),bn.jsxs("div",{className:"param-item",children:[bn.jsx(Ov,{label:"Accent",value:A,min:0,max:100,onChange:B,bipolar:!1,size:"md"}),bn.jsxs("div",{className:"param-value",children:[A,"%"]})]})]})]})]}),v&&bn.jsx(Qb,{channelIndex:t,onClose:()=>b(!1)})]}):bn.jsx("div",{className:"tb303-view",children:bn.jsxs("div",{className:"tb303-error",children:["Channel ",t+1," is using ",u.synthType,", not TB-303"]})}):bn.jsx("div",{className:"tb303-view",children:bn.jsxs("div",{className:"tb303-error",children:["No instrument assigned to channel ",t+1]})})},JE=[{id:"pattern",label:"Pattern",icon:bn.jsx(Ut,{size:20})},{id:"instruments",label:"Instruments",icon:bn.jsx(Bt,{size:20})},{id:"controls",label:"Controls",icon:bn.jsx(Gt,{size:20})}],eP=({activeTab:e,onTabChange:t})=>bn.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-dark-bgSecondary border-t border-dark-border safe-area-bottom",children:bn.jsx("div",{className:"flex items-stretch",children:JE.filter(e=>e&&e.icon).map(n=>{const a=e===n.id;return bn.jsxs("button",{onClick:()=>t(n.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-1\n                py-2 min-h-[56px] transition-colors\n                ${a?"text-accent-primary bg-accent-primary/10":"text-text-muted hover:text-text-secondary active:bg-dark-bgTertiary"}\n              `,"aria-current":a?"page":void 0,children:[bn.jsx("span",{className:a?"scale-110 transition-transform":"",children:n.icon}),bn.jsx("span",{className:"text-[10px] font-medium",children:n.label})]},n.id)})})}),tP=({isOpen:e,currentName:t,onConfirm:n,onClose:a})=>{const[r,o]=s.useState(t),i=s.useRef(null);s.useEffect(()=>{e&&(o(t),setTimeout(()=>i.current?.select(),0))},[e,t]);return e?Qv.createPortal(bn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:a,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between mb-4",children:[bn.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Instrument"}),bn.jsx("button",{onClick:a,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:bn.jsx(Te,{size:14})})]}),bn.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&r!==t&&n(r.trim()),a()},children:[bn.jsx("input",{ref:i,type:"text",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Escape"===e.key&&a()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter instrument name",autoFocus:!0}),bn.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[bn.jsx("button",{type:"button",onClick:a,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),bn.jsx("button",{type:"submit",disabled:!r.trim()||r===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})]})]})]})}),document.body):null},nP=({isOpen:e,title:t,message:n,confirmLabel:a="Confirm",danger:r=!1,onConfirm:o,onClose:i})=>{const l=s.useCallback(e=>{"Escape"===e.key?i():"Enter"===e.key&&(o(),i())},[i,o]);return s.useEffect(()=>{if(e)return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,l]),e?Qv.createPortal(bn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:i,children:bn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[bn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[bn.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:t}),bn.jsx("button",{onClick:i,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:bn.jsx(Te,{size:14})})]}),bn.jsx("p",{className:"text-sm text-text-secondary mb-4",children:n}),bn.jsxs("div",{className:"flex justify-end gap-2",children:[bn.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),bn.jsx("button",{onClick:()=>{o(),i()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(r?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:a})]})]})}),document.body):null},aP=({instrumentId:e,onEdit:t,onSavePreset:n,children:a})=>{const{position:r,open:o,close:i,isOpen:l}=tb(),{instruments:c,setCurrentInstrument:d,cloneInstrument:u,deleteInstrument:p,updateInstrument:h}=Df(),[m,f]=s.useState(!1),[y,g]=s.useState(!1),v=c.find(t=>t.id===e),b=c.length>1,x=s.useCallback(t=>{h(e,{name:t})},[e,h]),w=s.useCallback(()=>{h(e,{synthType:"Synth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0})},[e,h]),k=s.useMemo(()=>v?[{id:"edit",label:"Edit",icon:bn.jsx(Kt,{size:14}),onClick:()=>{d(e),t?.()}},{type:"divider"},{id:"duplicate",label:"Duplicate",icon:bn.jsx(qe,{size:14}),onClick:()=>u(e)},{id:"delete",label:"Delete",icon:bn.jsx(Le,{size:14}),danger:!0,disabled:!b,onClick:()=>p(e)},{type:"divider"},{id:"rename",label:"Rename",icon:bn.jsx(Ht,{size:14}),onClick:()=>f(!0)},{type:"divider"},{id:"copy-settings",label:"Copy Settings",icon:bn.jsx(Wt,{size:14}),onClick:()=>{localStorage.setItem("devilbox-instrument-clipboard",JSON.stringify(v))}},{id:"paste-settings",label:"Paste Settings",icon:bn.jsx(ot,{size:14}),onClick:()=>{const t=localStorage.getItem("devilbox-instrument-clipboard");if(t)try{const n=JSON.parse(t),{id:a,name:s,...r}=n;h(e,r)}catch(n){}}},{type:"divider"},{id:"save-preset",label:"Save as Preset",icon:bn.jsx(Ye,{size:14}),onClick:()=>{n?.()}},{id:"reset",label:"Reset to Default",icon:bn.jsx(bt,{size:14}),danger:!0,onClick:()=>g(!0)}]:[],[v,e,b,d,u,p,h,t,n]);return bn.jsxs("div",{onContextMenu:o,children:[a,l&&bn.jsx(Jv,{items:k,position:r,onClose:i}),bn.jsx(tP,{isOpen:m,currentName:v?.name||"",onConfirm:x,onClose:()=>f(!1)}),bn.jsx(nP,{isOpen:y,title:"Reset Instrument",message:"Reset this instrument to default settings? This cannot be undone.",confirmLabel:"Reset",danger:!0,onConfirm:w,onClose:()=>g(!1)})]})},sP=({onClose:e})=>{const{currentInstrumentId:t,updateInstrument:n,setPreviewInstrument:a}=Df(),{userPresets:r,deletePreset:o,addToRecent:i,exportPresets:l,importPresets:c,importNKSFFiles:d,exportAllPresetsAsNKSF:u}=Cg(),[p,h]=s.useState("factory"),[m,f]=s.useState("Bass"),[y,g]=s.useState("All"),[v,b]=s.useState(""),[x,w]=s.useState(null),[k,S]=s.useState(null),M=s.useRef(null),N=s.useRef(null),C=Object.keys(hf),E=e=>{h(e),w(null),S(null),b("")},P=s.useMemo(()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);return e?e.config:null}return"factory"===p&&x&&hf[m].find(e=>e.name===x)||null},[p,x,m,k,r]);s.useEffect(()=>{const t=t=>{"Escape"===t.key&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),s.useEffect(()=>{if(P){const t={...P,id:999,isLive:!0};a(t);try{em().invalidateInstrument(999)}catch(e){}}else a(null);return()=>{a(null)}},[P,a]),s.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=em(),n={...P,id:999,isLive:!0};e.triggerPolyNoteAttack(999,t,1,n)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=em(),n={...P,id:999,isLive:!0};e.triggerPolyNoteRelease(999,t,n)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[P]);const T=e=>Lt[e]||Bt,A=s.useMemo(()=>{const e=hf[m]||[];if(!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(t)||e.synthType?.toLowerCase().includes(t))},[m,v]),I=s.useMemo(()=>{let e=r;if("All"!==y&&(e=e.filter(e=>e.category===y)),!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.synthType.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},[r,y,v]),_=a=>{null!==t&&(n(t,a),e())},O=(a,s)=>{null!==t&&(i(a),n(t,s),e())},F=e=>({Bass:"text-blue-400",Leads:"text-yellow-400",Pads:"text-purple-400",Drums:"text-red-400","TR-808":"text-red-500","TR-909":"text-orange-400","TR-707":"text-rose-400","TR-505":"text-amber-400",Chip:"text-cyan-400",Furnace:"text-teal-400",FX:"text-green-400",Dub:"text-green-400",DubSiren:"text-red-500",SpaceLaser:"text-green-500",V2:"text-amber-500",Sam:"text-amber-500",Synare:"text-yellow-500",Drumnibus:"text-emerald-400",Keys:"text-amber-600",MAME:"text-pink-400",Module:"text-lime-400",Lead:"text-yellow-400",Pad:"text-purple-400",Drum:"text-red-400",User:"text-gray-400",All:"text-ft2-highlight"}[e]||"text-ft2-highlight"),D="factory"===p?A.length:I.length;return bn.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:[bn.jsxs("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden",children:[bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[bn.jsxs("div",{children:[bn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm uppercase tracking-widest",children:"LOAD PRESET"}),bn.jsx("p",{className:"text-ft2-textDim text-[10px]",children:"Browse, Jam and Load sounds"})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsxs("div",{className:"flex bg-ft2-bg rounded overflow-hidden border border-ft2-border",children:[bn.jsx("button",{onClick:()=>E("factory"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("factory"===p?"bg-ft2-cursor text-ft2-bg":"text-ft2-textDim hover:text-ft2-text"),children:"Factory"}),bn.jsxs("button",{onClick:()=>E("user"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("user"===p?"bg-amber-500 text-black":"text-ft2-textDim hover:text-ft2-text"),children:["User (",r.length,")"]})]}),bn.jsx("button",{onClick:e,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:bn.jsx(Te,{size:20})})]})]}),bn.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border",children:bn.jsxs("div",{className:"relative",children:[bn.jsx(Nt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"}),bn.jsx("input",{type:"text",value:v,onChange:e=>b(e.target.value),placeholder:"factory"===p?"Search factory presets...":"Search user presets by name, synth type, or tag...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none placeholder:text-ft2-textDim/50",autoFocus:!0})]})}),bn.jsx("div",{className:"flex flex-wrap gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border",children:"factory"===p?C.map(e=>{const t=m===e;return bn.jsx("button",{onClick:()=>(e=>{f(e),w(null),b("")})(e),className:`\n                    px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                    ${t?"bg-ft2-cursor text-ft2-bg shadow-[0_0_15px_rgba(255,255,255,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${F(e)}`}\n                  `,children:e},e)}):bn.jsxs(bn.Fragment,{children:[["All","Bass","Lead","Pad","Drum","FX","User"].map(e=>{const t=y===e;return bn.jsx("button",{onClick:()=>{g(e),S(null)},className:`\n                      px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                      ${t?"bg-amber-500 text-black shadow-[0_0_15px_rgba(245,158,11,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-amber-500/50 ${F(e)}`}\n                    `,children:e},e)}),bn.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[bn.jsxs("button",{onClick:()=>M.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import presets from JSON file",children:[bn.jsx(Pt,{size:10})," Import"]}),bn.jsxs("button",{onClick:()=>N.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import .nksf preset files",children:[bn.jsx(Pt,{size:10})," NKSF"]}),bn.jsxs("button",{onClick:()=>{const e=l();if(0===e.length)return void iy.warning("No user presets to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="devilbox-presets.json",a.click(),URL.revokeObjectURL(n),iy.success(`Exported ${e.length} presets`,2e3)},className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all user presets as JSON",children:[bn.jsx(Ke,{size:10})," Export"]}),bn.jsxs("button",{onClick:()=>u("DEViLBOX User"),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all presets as .nksf files",children:[bn.jsx(Ke,{size:10})," NKS"]})]})]})}),bn.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:"factory"===p?0===A.length?bn.jsxs("div",{className:"flex items-center justify-center h-full text-ft2-textDim font-mono text-sm uppercase",children:['No presets found matching "',v,'"']}):bn.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:A.map((e,t)=>{const n=$M(e.synthType||"Synth"),a=T(n.icon),s=x===e.name;return bn.jsxs("button",{onClick:()=>(e=>{w(e.name||null),S(null);const t=em(),n={...e,id:999,isLive:!0};t.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{t.triggerPolyNoteRelease(999,"C4",n)},300)})(e),onDoubleClick:()=>_(e),className:`\n                        p-3 rounded border-2 text-left transition-all group\n                        ${s?"bg-ft2-cursor text-ft2-bg border-ft2-cursor shadow-[0_0_20px_rgba(255,255,255,0.1)]":"bg-ft2-header border-ft2-border hover:border-ft2-highlight hover:bg-ft2-bg"}\n                      `,children:[bn.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[bn.jsx(a,{size:14,className:s?"text-ft2-bg":n.color}),bn.jsx("span",{className:"font-bold text-sm truncate "+(s?"text-ft2-bg":"text-ft2-text"),children:e.name})]}),bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsx("span",{className:"text-[10px] font-mono uppercase "+(s?"text-ft2-bg/80":"text-ft2-textDim"),children:e.synthType}),e.effects&&e.effects.length>0&&bn.jsxs("span",{className:"text-[9px] px-1.5 font-bold rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-green-600/20 text-green-400"),children:[e.effects.length," FX"]})]})]},`${m}-${e.name}-${t}`)})}):0===I.length?bn.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-ft2-textDim",children:[bn.jsx("span",{className:"font-mono text-sm uppercase",children:0===r.length?"No user presets yet":`No presets matching "${v}"`}),0===r.length&&bn.jsx("p",{className:"text-xs text-center max-w-md",children:"Save presets from the instrument editor to build your library. You can also import presets using the buttons above."})]}):bn.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:I.map(e=>{const t=$M(e.synthType),n=T(t.icon),a=k===e.id;return bn.jsxs("div",{onClick:()=>((e,t)=>{S(e),w(null);const n=em(),a={...t,id:999,isLive:!0};n.triggerPolyNoteAttack(999,"C4",1,a),setTimeout(()=>{n.triggerPolyNoteRelease(999,"C4",a)},300)})(e.id,e.config),onDoubleClick:()=>O(e.id,e.config),className:`\n                        p-3 rounded border-2 text-left transition-all group cursor-pointer relative\n                        ${a?"bg-amber-500 text-black border-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]":"bg-ft2-header border-ft2-border hover:border-amber-500/50 hover:bg-ft2-bg"}\n                      `,children:[bn.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),o(t),k===t&&S(null),iy.success("Preset deleted",2e3)})(t,e.id),className:"absolute top-1 right-1 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(a?"hover:bg-black/20 text-black/60":"hover:bg-red-500/20 text-red-400/60 hover:text-red-400"),title:"Delete preset",children:bn.jsx(Le,{size:12})}),bn.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[bn.jsx(n,{size:14,className:a?"text-black":t.color}),bn.jsx("span",{className:"font-bold text-sm truncate "+(a?"text-black":"text-ft2-text"),children:e.name})]}),bn.jsxs("div",{className:"flex items-center justify-between mb-1",children:[bn.jsx("span",{className:"text-[10px] font-mono uppercase "+(a?"text-black/70":"text-ft2-textDim"),children:e.synthType}),bn.jsx("span",{className:"text-[9px] px-1.5 font-bold rounded "+(a?"bg-black/10 text-black/70":"bg-amber-500/10 text-amber-400"),children:e.category})]}),e.tags.length>0&&bn.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,3).map(e=>bn.jsxs("span",{className:"text-[8px] px-1 rounded flex items-center gap-0.5 "+(a?"bg-black/10 text-black/60":"bg-ft2-bg text-ft2-textDim"),children:[bn.jsx($t,{size:7}),e]},e))})]},e.id)})})},`${p}-${m}-${y}`),bn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-t-2 border-ft2-border",children:[bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsxs("div",{className:"text-ft2-textDim text-xs font-mono",children:[D," PRESET",1!==D?"S":"","  ","factory"===p?m.toUpperCase():"All"===y?"ALL USER":y.toUpperCase(),(x||k)&&bn.jsx("span",{className:"ml-2 text-ft2-text",children:" DOUBLE-CLICK TO APPLY"})]}),P&&bn.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[bn.jsx(Oe,{size:12,className:"text-amber-400 fill-amber-400"}),bn.jsx("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"})]})]}),bn.jsxs("div",{className:"flex gap-2",children:[bn.jsx("button",{onClick:e,className:"px-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors font-bold text-xs uppercase",children:"Cancel"}),bn.jsxs("button",{onClick:()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);e&&O(e.id,e.config)}else P&&_(P)},disabled:!P,className:"flex items-center gap-2 px-6 py-2 bg-ft2-cursor text-ft2-bg font-black hover:bg-ft2-highlight rounded transition-all disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs",children:[bn.jsx(je,{size:16}),"Load Preset"]})]})]})]}),bn.jsx("input",{ref:M,type:"file",accept:".json",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const e=JSON.parse(n.result);Array.isArray(e)?(c(e),iy.success(`Imported ${e.length} presets`,2e3)):iy.error("Invalid preset file format")}catch{iy.error("Failed to parse preset file")}},n.readAsText(t),M.current&&(M.current.value="")}}),bn.jsx("input",{ref:N,type:"file",accept:".nksf",multiple:!0,className:"hidden",onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const n=await d(Array.from(t));n.length>0?iy.success(`Imported ${n.length} NKSF presets`,2e3):iy.error("Failed to import NKSF files"),N.current&&(N.current.value="")}})]})},rP=s.memo(({compact:e=!1,maxHeight:t="300px",showActions:n=!0,onInstrumentChange:a,showPreviewOnClick:r=!1,showSamplePackButton:o=!1,showPresetButton:i=!1,showEditButton:l=!1,onEditInstrument:c,variant:d="default",onCreateNew:u})=>{const{instruments:p,currentInstrumentId:h,setCurrentInstrument:m,createInstrument:f,deleteInstrument:y,cloneInstrument:g,updateInstrument:v}=Df(On(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument,createInstrument:e.createInstrument,deleteInstrument:e.deleteInstrument,cloneInstrument:e.cloneInstrument,updateInstrument:e.updateInstrument}))),{useHexNumbers:b,setShowSamplePackModal:w}=jf(On(e=>({useHexNumbers:e.useHexNumbers,setShowSamplePackModal:e.setShowSamplePackModal}))),k=s.useRef(null),S=s.useRef(null),M=s.useRef(null),N=s.useRef(null),[C,E]=s.useState(!1),[P,T]=s.useState(null),[A,I]=s.useState(""),_="ft2"===d;s.useEffect(()=>{S.current&&k.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[h]);const O=s.useCallback(async e=>{if(r)try{await xe(),M.current&&window.clearTimeout(M.current);const t=em(),n="TB303"===e.synthType||e.name.toLowerCase().includes("bass")?"C3":"C4",a=x();t.triggerNoteAttack(e.id,n,a,.8,e),M.current=window.setTimeout(()=>{t.triggerNoteRelease(e.id,n,x(),e)},300)}catch(t){}},[r]),F=(e,t)=>{m(e),a?.(e),r&&O(t)},D=(e,t)=>{e.stopPropagation(),p.length>1&&y(t)},R=(e,t)=>{e.stopPropagation(),g(t)},j=(e,t,n)=>{e.stopPropagation(),T(t),I(n),setTimeout(()=>N.current?.focus(),0)},L=()=>{null!==P&&A.trim()&&v(P,{name:A.trim()}),T(null),I("")},B=e=>{"Enter"===e.key?L():"Escape"===e.key&&(T(null),I(""))},V=[...p].sort((e,t)=>e.id-t.id),z=_&&(i||o||l);return bn.jsxs("div",{className:"flex flex-col h-full "+(_?"bg-ft2-bg border-l border-ft2-border":""),children:[z&&bn.jsx("div",{className:"px-2 py-2 bg-ft2-header border-b border-ft2-border flex-shrink-0",children:bn.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[bn.jsxs("button",{onClick:()=>{if(_){f(Qm[0])}else f()},className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Add new instrument (303 Classic)",children:[bn.jsx(Qe,{size:14}),bn.jsx("span",{className:"text-[8px] font-bold",children:"ADD"})]}),i&&bn.jsxs("button",{onClick:()=>E(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Load preset into current instrument",children:[bn.jsx(qt,{size:14}),bn.jsx("span",{className:"text-[8px] font-bold",children:"PRESET"})]}),o&&bn.jsxs("button",{onClick:()=>w(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-green-600 text-green-400 hover:bg-green-600 hover:text-ft2-bg transition-colors",title:"Browse sample packs",children:[bn.jsx(Yt,{size:14}),bn.jsx("span",{className:"text-[8px] font-bold",children:"SAMPLE"})]}),l&&bn.jsxs("button",{onClick:()=>c?.(h),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Edit current instrument",children:[bn.jsx(Xt,{size:14}),bn.jsx("span",{className:"text-[8px] font-bold",children:"EDIT"})]})]})}),bn.jsx("div",{ref:k,className:"flex-1 overflow-y-auto "+(_?"scrollbar-ft2 min-h-0":"scrollbar-modern"),style:_?void 0:{maxHeight:t},children:bn.jsx("div",{className:"flex flex-col divide-y divide-ft2-border/30",children:V.map(t=>{const a=$M(t.synthType),s=t.id===h,r=Lt[a?.icon||"Music2"]||Bt;return _?bn.jsxs("div",{ref:s?S:void 0,onClick:()=>F(t.id,t),className:`\n                  instrument-list-item\n                  flex items-center gap-2 px-2 py-1.5 cursor-pointer border-b border-ft2-border\n                  transition-colors group\n                  ${s?"bg-ft2-cursor text-ft2-bg":"hover:bg-ft2-header text-ft2-text"}\n                `,children:[bn.jsx("span",{className:"font-mono text-xs font-bold w-6 "+(s?"text-ft2-bg":"text-ft2-highlight"),children:b?t.id.toString(16).toUpperCase().padStart(2,"0"):t.id.toString(10).padStart(2,"0")}),bn.jsx(r,{size:12,className:s?"text-ft2-bg":a?.color||"text-ft2-highlight"}),P===t.id?bn.jsx("input",{ref:N,type:"text",value:A,onChange:e=>I(e.target.value),onBlur:L,onKeyDown:B,onClick:e=>e.stopPropagation(),className:"text-xs font-mono bg-ft2-bg border border-ft2-cursor px-1 py-0.5 rounded text-ft2-text focus:outline-none w-24",autoFocus:!0}):bn.jsx("span",{className:"text-xs font-mono whitespace-nowrap cursor-text",onDoubleClick:e=>j(e,t.id,t.name),title:"Double-click to rename",children:t.name}),bn.jsx("span",{className:"text-[9px] px-1 rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-ft2-header text-ft2-textDim"),children:a?.shortName||t.synthType}),n&&bn.jsxs("div",{className:`instrument-action-buttons flex gap-0.5 ${s?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[bn.jsx("button",{onClick:e=>R(e,t.id),className:"p-0.5 rounded "+(s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"),title:"Duplicate",children:bn.jsx(qe,{size:10})}),p.length>1&&bn.jsx("button",{onClick:e=>D(e,t.id),className:`p-0.5 rounded ${s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-red-400`,title:"Delete",children:bn.jsx(Le,{size:10})})]})]},t.id):bn.jsx(aP,{instrumentId:t.id,children:bn.jsxs("div",{ref:s?S:void 0,onClick:()=>F(t.id,t),className:`\n                  group flex items-center gap-2 px-3 py-2 cursor-pointer transition-all\n                  ${s?"bg-accent-primary/20 border-l-2 border-accent-primary":"hover:bg-dark-bgHover border-l-2 border-transparent"}\n                `,children:[bn.jsx("span",{className:`\n                    font-mono text-xs w-6 text-center\n                    ${s?"text-accent-primary":"text-text-muted"}\n                  `,children:String(t.id).padStart(2,"0")}),bn.jsx(r,{size:e?12:14,className:a?.color||"text-accent-primary"}),P===t.id?bn.jsx("input",{ref:N,type:"text",value:A,onChange:e=>I(e.target.value),onBlur:L,onKeyDown:B,onClick:e=>e.stopPropagation(),className:"text-sm bg-dark-bg border border-accent-primary px-1 py-0.5 rounded text-text-primary focus:outline-none w-28",autoFocus:!0}):bn.jsx("span",{className:`\n                      text-sm whitespace-nowrap cursor-text\n                      ${s?"text-text-primary":"text-text-secondary"}\n                    `,onDoubleClick:e=>j(e,t.id,t.name),title:"Double-click to rename",children:t.name}),!e&&bn.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:a?.shortName||t.synthType}),t.sample?.loop&&bn.jsx("span",{className:"text-text-muted ml-auto",title:"pingpong"===t.sample.loopType?"Ping-pong loop":"Forward loop",children:"pingpong"===t.sample.loopType?bn.jsx(Je,{size:10,className:"text-blue-400"}):bn.jsx(Qt,{size:10,className:"text-green-400"})}),n&&bn.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[bn.jsx("button",{onClick:e=>R(e,t.id),className:"p-1 text-text-muted hover:text-accent-primary",title:"Clone instrument",children:bn.jsx(qe,{size:12})}),p.length>1&&bn.jsx("button",{onClick:e=>D(e,t.id),className:"p-1 text-text-muted hover:text-accent-error",title:"Delete instrument",children:bn.jsx(Le,{size:12})})]})]})},t.id)})})}),bn.jsx("div",{className:_?"px-3 py-1.5 bg-ft2-header border-t border-ft2-border":"px-3 py-1 border-t border-dark-border bg-dark-bgSecondary",children:bn.jsxs("span",{className:_?"text-ft2-textDim text-[10px] font-mono":"text-[10px] text-text-muted",children:[p.length," instrument",1!==p.length?"s":""]})}),C&&bn.jsx(sP,{onClose:()=>E(!1)})]})});rP.displayName="InstrumentList";const oP=({onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:a,onShowInstruments:r,showPatterns:o,showMasterFX:i})=>{const[l,c]=s.useState("pattern"),{isPlaying:d,togglePlayPause:u}=Gf(),{patterns:p,currentPatternIndex:h}=cm(),m=p[h];return bn.jsxs("div",{className:"flex flex-col flex-1 min-h-0 bg-dark-bg",children:[bn.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-3 py-2 bg-dark-bgSecondary border-b border-dark-border",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("span",{className:"text-xs text-text-muted",children:"PAT"}),bn.jsx("span",{className:"text-sm font-bold text-accent-primary",children:(h+1).toString().padStart(2,"0")}),bn.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:m?.name||"Untitled"})]}),bn.jsx("div",{className:"flex items-center gap-1",children:bn.jsx("button",{onClick:u,className:`\n              p-2 rounded-lg transition-colors touch-target\n              ${d?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-primary hover:bg-dark-bgHover"}\n            `,children:d?bn.jsx(Tt,{size:18}):bn.jsx(At,{size:18})})})]}),bn.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden mobile-bottom-padding",children:["pattern"===l&&bn.jsx(Pb,{}),"instruments"===l&&bn.jsx("div",{className:"h-full overflow-y-auto",children:bn.jsx(rP,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})}),"controls"===l&&bn.jsxs("div",{className:"h-full overflow-y-auto",children:[bn.jsx("div",{className:"p-4 border-b border-dark-border",children:bn.jsx(LE,{})}),bn.jsx("div",{className:"p-2",children:bn.jsx(DE,{onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:a,onShowInstruments:r,showPatterns:o,showMasterFX:i})})]})]}),bn.jsx(eP,{activeTab:l,onTabChange:c})]})};const iP=e.memo(({verticalZoom:e,scrollY:t,visibleNotes:n,containerHeight:a,activeNotes:r=new Set,scaleNotes:o,onNoteClick:i,onNotePreview:l,onNoteRelease:c})=>{const d=s.useCallback(e=>{l?.(e),i?.(e)},[i,l]),u=s.useCallback(()=>{c?.()},[c]),p=s.useMemo(()=>{const e=[],a=Math.min(127,t+n),s=Math.max(0,t);for(let t=a;t>=s;t--){const n=t%12,a=!o||o.has(n);e.push({midiNote:t,isBlack:_y(t),name:Iy(t),inScale:a})}return e},[t,n,o]);return bn.jsx("div",{className:"flex flex-col bg-gray-900 border-r border-dark-border overflow-hidden shrink-0",style:{width:48,height:a||"auto"},role:"group","aria-label":"Piano keyboard",children:p.map(({midiNote:t,isBlack:n,name:a,inScale:s})=>{const o=t%12==0,i=r.has(t),l=!s;return bn.jsx("div",{className:`\n              flex items-center justify-end pr-1 text-[9px] font-mono cursor-pointer\n              select-none border-b transition-all duration-75 shrink-0\n              ${i?"bg-accent-primary text-text-inverse border-accent-primary brightness-110 shadow-lg":n?"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 "+(l?"opacity-40":""):"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 "+(l?"opacity-40":"")}\n              ${o?"font-bold":""}\n            `,style:{height:e,transform:i?"translateX(2px)":"translateX(0)"},onMouseDown:()=>d(t),onMouseUp:u,onMouseLeave:u,title:a,role:"button","aria-label":`Play ${a}`,"aria-pressed":i,children:o?a:""},t)})})}),lP=e.memo(({note:e,horizontalZoom:t,verticalZoom:n,scrollX:a,scrollY:r,isSelected:o,showVelocity:i,isGhost:l=!1,onSelect:c,onDragStart:d})=>{const u=(e.startRow-a)*t,p=(e.endRow-e.startRow)*t,h=(r+60-e.midiNote)*n;if(u+p<-50||u>3e3||h<-50||h>2e3)return null;const m=s.useCallback(t=>{if(l)return;t.stopPropagation();const n=t.currentTarget.getBoundingClientRect(),a=t.clientX-n.left>p-8;c?.(e.id,t.shiftKey||t.ctrlKey||t.metaKey),d&&d(e.id,a?"resize-end":"move",t)},[e.id,p,l,c,d]),f=e.velocity/127*100,y=["bg-cyan-500","bg-purple-500","bg-green-500","bg-amber-500","bg-pink-500","bg-blue-500","bg-red-500","bg-teal-500"],g=y[e.channelIndex%y.length],v=p>30&&n>=10,b=Iy(e.midiNote);return l?bn.jsx("div",{className:`absolute rounded-sm pointer-events-none ${g}`,style:{left:u,top:h,width:Math.max(4,p-1),height:n-1,opacity:.3,border:"1px dashed rgba(255,255,255,0.5)"}}):bn.jsxs("div",{className:`\n        absolute rounded-sm cursor-move select-none\n        ${g}\n        ${o?"ring-2 ring-accent-primary ring-opacity-100 brightness-125 z-10":"ring-1 ring-black/30"}\n        hover:brightness-125 hover:ring-accent-primary/50 hover:z-20\n        transition-all duration-75\n        shadow-md hover:shadow-lg\n      `,style:{left:u,top:h,width:Math.max(4,p-1),height:n-1,opacity:.8+e.velocity/127*.2},onMouseDown:m,title:`${b} vel:${e.velocity}${e.slide?" [SLIDE]":""}${e.accent?" [ACCENT]":""}`,role:"button","aria-label":`Note ${b}, velocity ${e.velocity}${e.slide?", slide":""}${e.accent?", accent":""}`,tabIndex:0,children:[v&&bn.jsx("span",{className:"absolute left-1 top-0 text-[8px] text-white/80 font-mono leading-none pointer-events-none",style:{lineHeight:n-1+"px"},children:b}),i&&p>20&&bn.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/30 pointer-events-none",style:{height:100-f+"%"}}),e.slide&&bn.jsx("div",{className:"absolute top-0 right-3 w-1.5 h-full bg-yellow-400/60 pointer-events-none"}),e.accent&&bn.jsx("div",{className:"absolute top-0 left-0 w-0 h-0 pointer-events-none",style:{borderLeft:"6px solid rgba(255,100,0,0.8)",borderBottom:"6px solid transparent"}}),bn.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 transition-colors"})]})}),cP=e.memo(({notes:t,patternLength:n,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,gridDivision:l,showVelocity:c,selectedNotes:d,playheadRow:u,containerHeight:p,scaleNotes:h,onNoteSelect:m,onNoteDragStart:f,onGridClick:y,onGridRightClick:g,onScroll:v,onSelectionBoxStart:b})=>{const x=s.useRef(null),w=Fy(e=>e.ghostNotes),k=Fy(e=>e.drag),[S,M]=e.useState(800);e.useEffect(()=>{const e=()=>{x.current&&M(x.current.clientWidth)};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]);const N=s.useMemo(()=>Math.ceil(S/a)+2,[a,S]),C=s.useMemo(()=>{const e=p||x.current?.clientHeight||400;return Math.ceil(e/r)+2},[r,p]),E=s.useCallback(e=>{e.preventDefault();const t=e.shiftKey?e.deltaY:e.deltaX,n=e.shiftKey?0:e.deltaY;v(t/a,-n/r)},[a,r,v]),P=s.useCallback(e=>{if(!x.current)return;if(2===e.button)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);y(Math.max(0,l),Math.max(0,Math.min(127,c)))},[a,r,o,i,y]),T=s.useCallback(e=>{if(e.preventDefault(),!x.current)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);g(Math.max(0,l),Math.max(0,Math.min(127,c)),e.clientX,e.clientY)},[a,r,o,i,g]),A=s.useCallback(e=>{if(!x.current||0!==e.button)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);b(Math.max(0,l),Math.max(0,Math.min(127,c)),e)},[a,r,o,i,b]),I=s.useMemo(()=>{const e=[],t=n*a,s=Math.max(S,t),c=Math.floor(o),d=Math.ceil(o+N),u=4/l,p=Math.max(d,Math.ceil(S/a+o));for(let r=c;r<=p;r++){const t=(r-o)*a,s=r%4==0,i=r%16==0,l=r>n;(r%u===0||s||i)&&e.push(bn.jsx("div",{className:"absolute top-0 bottom-0 "+(l?"bg-gray-700/20":i?"bg-gray-500/50":s?"bg-gray-600/40":"bg-gray-700/30"),style:{left:t,width:1}},`v-${r}`))}for(let n=0;n<C;n++){const t=i+60-n;if(t<0||t>127)continue;const a=n*r,o=t%12==0,l=_y(t),c=t%12,d=h&&!h.has(c);e.push(bn.jsx("div",{className:`absolute left-0 ${d?"bg-gray-900/70":l?"bg-gray-800/50":"bg-gray-900/30"} ${o?"border-t border-gray-500/50":""}`,style:{top:a,height:r,width:s}},`h-${t}`))}return e},[o,i,a,r,n,N,C,l,S,h]),_=null!==u?(u-o)*a:null,O=Fy(e=>e.tool),F="draw"===O?"cursor-crosshair":"erase"===O?"cursor-not-allowed":"cursor-default",D=s.useMemo(()=>{if("select-box"!==k.mode||!k.isDragging)return null;if(!x.current)return null;const e=x.current.getBoundingClientRect();return{left:Math.min(k.startX,k.currentX)-e.left,top:Math.min(k.startY,k.currentY)-e.top,width:Math.abs(k.currentX-k.startX),height:Math.abs(k.currentY-k.startY)}},[k]);return bn.jsxs("div",{ref:x,className:`flex-1 w-full h-full relative overflow-hidden bg-gray-900 ${F}`,onWheel:E,onClick:P,onContextMenu:T,onMouseDown:A,role:"grid","aria-label":"Piano roll note grid",children:[bn.jsx("div",{className:"absolute inset-0 pointer-events-none",children:I}),w.map(e=>bn.jsx(lP,{note:e,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,isSelected:!1,showVelocity:!1,isGhost:!0},`ghost-${e.id}`)),t.map(e=>bn.jsx(lP,{note:e,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,isSelected:d.has(e.id),showVelocity:c,onSelect:m,onDragStart:f},e.id)),D&&bn.jsx("div",{className:"absolute border-2 border-accent-primary/60 bg-accent-primary/10 pointer-events-none z-20",style:D}),null!==_&&_>=0&&bn.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent-primary pointer-events-none z-10",style:{left:_}}),bn.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-red-500/50 pointer-events-none",style:{left:(n-o)*a}})]})}),dP=e.memo(({notes:e,horizontalZoom:t,scrollX:n,selectedNotes:a,onVelocityChange:r,onMultiVelocityChange:o,onBeginDrag:i,onDragVelocity:l,onDragMultiVelocity:c,onEndDrag:d})=>{const u=s.useRef(null),[p,h]=s.useState(null),[m,f]=s.useState(null),y=s.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),g=s.useCallback((e,t)=>{if(t.preventDefault(),t.stopPropagation(),h(e),i(),!u.current)return;const n=u.current.getBoundingClientRect(),s=t.clientY-n.top,r=y(s);a.has(e)&&a.size>1?c(Array.from(a),r):l(e,r)},[a,i,l,c,y]),v=s.useCallback(e=>{if(!p||!u.current)return;const t=u.current.getBoundingClientRect(),n=e.clientY-t.top,s=y(n);a.has(p)&&a.size>1?c(Array.from(a),s):l(p,s)},[p,a,l,c,y]),b=s.useCallback(()=>{p&&d(),h(null)},[p,d]),x=s.useMemo(()=>e.map(e=>{const s=(e.startRow-n)*t,r=(e.endRow-e.startRow)*t;if(s+r<0||s>2e3)return null;const o=e.velocity/127*80,i=a.has(e.id),l=m===e.id,c=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],d=c[e.channelIndex%c.length];return bn.jsx("div",{className:"absolute bottom-0 cursor-ns-resize",style:{left:s,width:Math.max(3,r-1),height:o,backgroundColor:d,opacity:i?1:l?.9:.7,border:i?"1px solid #facc15":"none",borderRadius:"2px 2px 0 0",transition:"opacity 75ms"},onMouseDown:t=>g(e.id,t),onMouseEnter:()=>f(e.id),onMouseLeave:()=>f(null),title:`Velocity: ${e.velocity}`},e.id)}).filter(Boolean),[e,t,n,a,m,g]),w=s.useMemo(()=>{const e=[];return[32,64,96,127].forEach((t,n)=>{const a=80-t/127*80;e.push(bn.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:a},children:[bn.jsx("div",{className:"border-t border-gray-700/40 w-full"}),bn.jsx("span",{className:"absolute left-1 text-[8px] text-text-muted/40 -translate-y-full",children:t})]},t))}),e},[]);return bn.jsxs("div",{ref:u,className:"relative bg-gray-900/80 border-t border-dark-border overflow-hidden shrink-0",style:{height:80},onMouseMove:v,onMouseUp:b,onMouseLeave:b,children:[w,bn.jsx("div",{className:"absolute top-1 left-1 text-[9px] text-text-muted/50 pointer-events-none z-10",children:"VEL"}),x]})}),uP=({onCopy:e,onCut:t,onPaste:n,onDelete:a,onSelectAll:r,onQuantize:o,onToggleSlide:i,onToggleAccent:l,hasSelection:c,hasClipboard:d})=>{const{contextMenu:u,hideContextMenu:p}=Fy(),h=s.useRef(null);if(s.useEffect(()=>{if(!u.visible)return;const e=e=>{h.current&&!h.current.contains(e.target)&&p()},t=e=>{"Escape"===e.key&&p()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[u.visible,p]),!u.visible)return null;const m=Math.min(u.x,window.innerWidth-200),f=Math.min(u.y,window.innerHeight-260),y={position:"fixed",left:Math.max(0,m),top:Math.max(0,f),zIndex:100},g=({icon:e,label:t,shortcut:n,onClick:a,disabled:s})=>bn.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-1.5 text-xs text-left rounded transition-colors\n        "+(s?"text-text-muted/50 cursor-not-allowed":"text-text-primary hover:bg-dark-bgTertiary"),onClick:()=>{s||(a(),p())},disabled:s,children:[e,bn.jsx("span",{className:"flex-1",children:t}),n&&bn.jsx("span",{className:"text-text-muted text-[10px]",children:n})]}),v=()=>bn.jsx("div",{className:"h-px bg-dark-border mx-2 my-1"});return bn.jsxs("div",{ref:h,className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl py-1 min-w-[180px]",style:y,children:[bn.jsx(g,{icon:bn.jsx(qe,{size:12}),label:"Copy",shortcut:"Ctrl+C",onClick:e,disabled:!c}),bn.jsx(g,{icon:bn.jsx(rt,{size:12}),label:"Cut",shortcut:"Ctrl+X",onClick:t,disabled:!c}),bn.jsx(g,{icon:bn.jsx(ot,{size:12}),label:"Paste",shortcut:"Ctrl+V",onClick:n,disabled:!d}),bn.jsx(g,{icon:bn.jsx(Le,{size:12}),label:"Delete",shortcut:"Del",onClick:a,disabled:!c}),bn.jsx(v,{}),bn.jsx(g,{icon:bn.jsx(Zt,{size:12}),label:"Select All",shortcut:"Ctrl+A",onClick:r}),bn.jsx(v,{}),bn.jsx(g,{icon:bn.jsx(Ut,{size:12}),label:"Quantize",shortcut:"Q",onClick:o,disabled:!c}),bn.jsx(v,{}),bn.jsx(g,{icon:bn.jsx(Jt,{size:12}),label:"Toggle Slide",shortcut:"S",onClick:i,disabled:!c}),bn.jsx(g,{icon:bn.jsx(Oe,{size:12}),label:"Toggle Accent",shortcut:"A",onClick:l,disabled:!c})]})};function pP(e,t){return`${e}-${t}`}function hP(e,t,n){for(let a=t+1;a<n;a++){const n=e[a];if(97===n.note)return a-t;if(n.note&&0!==n.note&&97!==n.note)return a-t}return n-t}function mP(e){return JSON.parse(JSON.stringify(e))}function fP(e,t,n,a){(0,$f.getState().pushAction)("EDIT_CELL",a,n,e,JSON.parse(JSON.stringify(t)))}function yP(e){const{patterns:t,currentPatternIndex:n,setCell:a}=cm(),r=t[n],o=s.useMemo(()=>r?function(e,t){const n=[];return(void 0!==t?[e.channels[t]].filter(Boolean):e.channels).forEach((a,s)=>{const r=void 0!==t?t:s;for(let t=0;t<a.rows.length;t++){const s=a.rows[t];if(!s.note||0===s.note||97===s.note)continue;const o=Ha(s.note);if(null===o)continue;const i=hP(a.rows,t,e.length),l=s.volume>=16&&s.volume<=80?Math.round((s.volume-16)/64*127):100;n.push({id:pP(r,t),channelIndex:r,startRow:t,endRow:t+i,midiNote:o,velocity:l,instrument:s.instrument,slide:2===s.flag1||2===s.flag2,accent:1===s.flag1||1===s.flag2})}}),n}(r,e):[],[r,e]),i=s.useCallback((t,s,o,i=100,l)=>{const c=l??e??0;if(!r)return;const d=mP(r),u=Wa(t),p=Math.round(i/127*64);a(c,s,{note:u,volume:16+p}),s+o<(r?.length||64)&&a(c,s+o,{note:97});const h=cm.getState().patterns[n];h&&fP(d,h,n,"Add note")},[e,r,n,a]),l=s.useCallback(e=>{const[t,s]=e.split("-"),i=parseInt(t,10),l=parseInt(s,10),c=o.find(t=>t.id===e);if(!c||!r)return;const d=mP(r);if(a(i,l,{note:0,volume:0}),c.endRow<(r?.length||64)){const e=r?.channels[i]?.rows[c.endRow];97===e?.note&&a(i,c.endRow,{note:0})}const u=cm.getState().patterns[n];u&&fP(d,u,n,"Delete note")},[o,r,n,a]),c=s.useCallback(e=>{if(!r||0===e.length)return;const t=mP(r);e.forEach(e=>{const[t,s]=e.split("-"),i=parseInt(t,10),l=parseInt(s,10),c=o.find(t=>t.id===e);if(c&&(a(i,l,{note:0,volume:0}),c.endRow<(r?.length||64))){const e=cm.getState().patterns[n],t=e?.channels[i]?.rows[c.endRow];97===t?.note&&a(i,c.endRow,{note:0})}});const s=cm.getState().patterns[n];s&&fP(t,s,n,`Delete ${e.length} notes`)},[o,r,n,a]),d=s.useCallback((e,t,s)=>{const i=o.find(t=>t.id===e);if(!i||!r)return;const l=mP(r),c=Math.max(0,i.startRow+t),d=Math.max(0,Math.min(127,i.midiNote+s)),u=i.endRow-i.startRow,[p,h]=e.split("-"),m=parseInt(p,10),f=parseInt(h,10);if(a(m,f,{note:0,volume:0}),i.endRow<(r?.length||64)){const e=r?.channels[m]?.rows[i.endRow];97===e?.note&&a(m,i.endRow,{note:0})}const y=Wa(d),g=16+Math.round(i.velocity/127*64);a(i.channelIndex,c,{note:y,volume:g}),c+u<(r?.length||64)&&a(i.channelIndex,c+u,{note:97});const v=cm.getState().patterns[n];v&&fP(l,v,n,"Move note")},[o,r,n,a]),u=s.useCallback((e,t)=>{const s=o.find(t=>t.id===e);if(!s||!r)return;const i=mP(r),l=Math.max(1,t-s.startRow),[c,d]=e.split("-"),u=parseInt(c,10),p=parseInt(d,10);if(a(u,p,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=r?.channels[u]?.rows[s.endRow];97===e?.note&&a(u,s.endRow,{note:0})}const h=Wa(s.midiNote),m=16+Math.round(s.velocity/127*64);a(s.channelIndex,s.startRow,{note:h,volume:m}),s.startRow+l<(r?.length||64)&&a(s.channelIndex,s.startRow+l,{note:97});const f=cm.getState().patterns[n];f&&fP(i,f,n,"Resize note")},[o,r,n,a]),p=s.useCallback((e,t)=>{const[s,o]=e.split("-"),i=parseInt(s,10),l=parseInt(o,10);if(!r)return;const c=mP(r),d=Math.round(t/127*64);a(i,l,{volume:16+d});const u=cm.getState().patterns[n];u&&fP(c,u,n,"Set velocity")},[r,n,a]),h=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=mP(r),o=16+Math.round(t/127*64);e.forEach(e=>{const[t,n]=e.split("-"),s=parseInt(t,10),r=parseInt(n,10);a(s,r,{volume:o})});const i=cm.getState().patterns[n];i&&fP(s,i,n,`Set velocity (${e.length} notes)`)},[r,n,a]),m=s.useRef(null),f=s.useCallback(()=>{r&&(m.current=mP(r))},[r]),y=s.useCallback((e,t)=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10),i=Math.round(t/127*64);a(r,o,{volume:16+i})},[a]),g=s.useCallback((e,t)=>{const n=16+Math.round(t/127*64);e.forEach(e=>{const[t,s]=e.split("-"),r=parseInt(t,10),o=parseInt(s,10);a(r,o,{volume:n})})},[a]),v=s.useCallback(()=>{if(!m.current)return;const e=cm.getState().patterns[n];e&&fP(m.current,e,n,"Adjust velocity"),m.current=null},[n]),b=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=mP(r);e.forEach(e=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10);a(r,o,{flag2:t?2:0})});const o=cm.getState().patterns[n];o&&fP(s,o,n,"Toggle slide")},[r,n,a]),x=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=mP(r);e.forEach(e=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10);a(r,o,{flag1:t?1:0})});const o=cm.getState().patterns[n];o&&fP(s,o,n,"Toggle accent")},[r,n,a]),w=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=mP(r),i=Math.max(1,Math.floor(4/t));e.forEach(e=>{const t=o.find(t=>t.id===e);if(!t)return;const s=Math.round(t.startRow/i)*i;if(s===t.startRow)return;const l=t.endRow-t.startRow,[c,d]=e.split("-"),u=parseInt(c,10),p=parseInt(d,10);if(a(u,p,{note:0,volume:0}),t.endRow<(r?.length||64)){const e=cm.getState().patterns[n],s=e?.channels[u]?.rows[t.endRow];97===s?.note&&a(u,t.endRow,{note:0})}const h=Wa(t.midiNote),m=16+Math.round(t.velocity/127*64);a(t.channelIndex,s,{note:h,volume:m}),s+l<(r?.length||64)&&a(t.channelIndex,s+l,{note:97})});const l=cm.getState().patterns[n];l&&fP(s,l,n,"Quantize notes")},[o,r,n,a]),k=s.useCallback((t,s,o,i)=>{if(!r||0===t.notes.length)return;const l=mP(r),c=s-t.minRow,d=o-t.minNote,u=i??e??0;t.notes.forEach(e=>{const t=e.startRow+c,n=Math.max(0,Math.min(127,e.midiNote+d)),s=e.endRow-e.startRow;if(t<0||t>=(r?.length||64))return;const o=Wa(n),i=Math.round(e.velocity/127*64);a(u,t,{note:o,volume:16+i}),t+s<(r?.length||64)&&a(u,t+s,{note:97})});const p=cm.getState().patterns[n];p&&fP(l,p,n,"Paste notes")},[e,r,n,a]);return{notes:o,pattern:r,addNote:i,deleteNote:l,deleteNotes:c,moveNote:d,resizeNote:u,setNoteVelocity:p,setMultipleVelocities:h,beginVelocityDrag:f,setVelocityNoUndo:y,setMultipleVelocitiesNoUndo:g,endVelocityDrag:v,toggleSlide:b,toggleAccent:x,quantizeNotes:w,pasteNotes:k}}const gP={z:0,s:1,x:2,d:3,c:4,v:5,g:6,b:7,h:8,n:9,j:10,m:11,q:12,2:13,w:14,3:15,e:16,r:17,5:18,t:19,6:20,y:21,7:22,u:23,i:24,9:25,o:26,0:27,p:28},vP=({channelIndex:e})=>{const{view:t,selection:n,tool:a,drag:r,clipboard:o,setHorizontalZoom:i,setVerticalZoom:l,setScroll:c,setSnapToGrid:d,setGridDivision:u,setShowVelocity:p,setShowVelocityLane:h,setChannelIndex:m,setMultiChannel:f,setScaleKey:y,setScaleRoot:g,setNoteLengthPreset:v,selectNote:b,selectNotes:w,selectAll:k,clearSelection:S,setTool:M,startDrag:N,updateDrag:C,endDrag:E,copyNotes:P,showContextMenu:T,hideContextMenu:A,setGhostNotes:I}=Fy(),{notes:_,pattern:O,addNote:F,deleteNote:D,deleteNotes:R,moveNote:j,resizeNote:L,setNoteVelocity:B,setMultipleVelocities:V,beginVelocityDrag:z,setVelocityNoUndo:U,setMultipleVelocitiesNoUndo:G,endVelocityDrag:K,toggleSlide:H,toggleAccent:W,quantizeNotes:$,pasteNotes:q}=yP(t.multiChannel?void 0:e??t.channelIndex),Y=Gf(e=>e.isPlaying),X=Gf(e=>e.currentRow),{instruments:Q,currentInstrumentId:Z}=Df(),J=s.useRef(null),[ee,te]=s.useState(400),[ne,ae]=s.useState(!1),se=s.useRef(null);s.useEffect(()=>{void 0!==e&&m(e)},[e,m]);const re=s.useRef(null),oe=s.useRef(null);s.useEffect(()=>{if(Y&&null!==X){if(oe.current!==O)Fy.setState({view:{...Fy.getState().view,scrollX:0}}),oe.current=O,re.current=X;else if(null===re.current||X>=re.current){const e=48;if((X-t.scrollX)*t.horizontalZoom>e+t.horizontalZoom){const n=X-e/t.horizontalZoom;Fy.setState({view:{...Fy.getState().view,scrollX:Math.max(0,n)}})}re.current=X}}else re.current=null,oe.current=null},[Y,X,O,t.scrollX,t.horizontalZoom]),s.useEffect(()=>{const e=()=>{if(J.current){const e=J.current.clientHeight-44;te(Math.max(200,e))}};e();const t=new ResizeObserver(e);return J.current&&t.observe(J.current),()=>t.disconnect()},[]);const ie=s.useMemo(()=>Math.ceil(ee/t.verticalZoom)+2,[ee,t.verticalZoom]),le=s.useMemo(()=>Math.floor(ie/12),[ie]),ce=s.useMemo(()=>{if(!Y||null===X)return new Set;const e=new Set;return _.forEach(t=>{X>=t.startRow&&X<t.endRow&&e.add(t.midiNote)}),e},[Y,X,_]),de=s.useMemo(()=>{if("chromatic"===t.scaleKey)return;const e=Fb[t.scaleKey];return e?new Set(function(e,t){return e<0||e>11?[]:t.intervals.map(t=>(e+t)%12)}(t.scaleRoot,e)):void 0},[t.scaleKey,t.scaleRoot]),ue=s.useCallback(()=>t.noteLengthPreset>0?t.noteLengthPreset:t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,[t.noteLengthPreset,t.snapToGrid,t.gridDivision]),pe=s.useCallback(e=>{if(!de)return e;if(de.has(e%12))return e;for(let t=1;t<=6;t++){if(de.has((e+t)%12))return e+t;if(de.has((e-t+12)%12))return e-t}return e},[de]),he=s.useCallback(e=>{if(null===Z)return;const t=em(),n=Q.find(e=>e.id===Z);if(!n)return;const a=Iy(e);se.current=a,t.triggerNoteAttack(Z,a,x(),.8,n)},[Z,Q]),me=s.useCallback(()=>{if(se.current&&null!==Z){em().releaseNote(Z,se.current),se.current=null}},[Z]),fe=s.useCallback((e,t)=>{"erase"===a?D(e):b(e,t)},[a,D,b]),ye=s.useCallback((e,t,n)=>{N(t,n.clientX,n.clientY,e)},[N]),ge=s.useCallback((e,n)=>{if(A(),"draw"===a){const a=pe(n),s=ue();F(a,e,s,100,t.channelIndex)}else"select"===a&&(r.isDragging||S())},[a,t.channelIndex,F,S,A,r.isDragging,pe,ue]),ve=s.useCallback((e,t,a,s)=>{const r=_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote);r&&!n.notes.has(r.id)&&b(r.id,!1),T(a,s,r?.id||null,e,t)},[_,n.notes,b,T]),be=s.useCallback((e,t,n)=>{if("select"!==a)return;_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote)||N("select-box",n.clientX,n.clientY)},[a,_,N]),xe=s.useRef(t.scrollX),we=s.useRef(t.scrollY),ke=s.useRef(null),Se=s.useRef(t.scrollX),Me=s.useRef(t.scrollY);s.useEffect(()=>{t.scrollX!==Se.current&&(xe.current=t.scrollX),t.scrollY!==Me.current&&(we.current=t.scrollY),Se.current=t.scrollX,Me.current=t.scrollY},[t.scrollX,t.scrollY]),s.useEffect(()=>()=>{null!==ke.current&&cancelAnimationFrame(ke.current)},[]);const Ne=s.useCallback(()=>{const e=Fy.getState().view.scrollX,t=Fy.getState().view.scrollY,n=xe.current,a=we.current,s=n-e,r=a-t;if(Math.abs(s)<.1&&Math.abs(r)<.1)return c(n,a),Se.current=n,Me.current=a,void(ke.current=null);const o=e+.25*s,i=t+.25*r;c(o,i),Se.current=o,Me.current=i,ke.current=requestAnimationFrame(Ne)},[c]),Ce=s.useCallback((e,t)=>{xe.current=Math.max(0,xe.current+e),we.current=Math.max(0,Math.min(127,we.current+t)),null===ke.current&&(ke.current=requestAnimationFrame(Ne))},[Ne]);s.useEffect(()=>{const e=e=>{const n=Fy.getState().drag;if(n.isDragging){if(C(e.clientX,e.clientY),"move"===n.mode&&n.noteId){const a=e.clientX-n.startX,s=e.clientY-n.startY,r=Math.round(a/t.horizontalZoom),o=-Math.round(s/t.verticalZoom);if(0!==r||0!==o){const e=_.find(e=>e.id===n.noteId);if(e){const t=Fy.getState().selection.notes,n=(t.has(e.id)?Array.from(t):[e.id]).map(e=>{const t=_.find(t=>t.id===e);return t?{...t,startRow:Math.max(0,t.startRow+r),endRow:Math.max(1,t.endRow+r),midiNote:Math.max(0,Math.min(127,t.midiNote+o))}:null}).filter(Boolean);I(n)}}}if("select-box"===n.mode){const a=document.querySelector('[role="grid"]');if(!a)return;const s=a.getBoundingClientRect(),r=Math.min(n.startX,e.clientX)-s.left,o=Math.max(n.startX,e.clientX)-s.left,i=Math.min(n.startY,e.clientY)-s.top,l=Math.max(n.startY,e.clientY)-s.top,c=Math.floor(r/t.horizontalZoom)+t.scrollX,d=Math.ceil(o/t.horizontalZoom)+t.scrollX,u=t.scrollY+60-Math.floor(l/t.verticalZoom),p=t.scrollY+60-Math.floor(i/t.verticalZoom),h=_.filter(e=>e.startRow<d&&e.endRow>c&&e.midiNote>=u&&e.midiNote<=p).map(e=>e.id);w(h)}}},n=e=>{const n=Fy.getState().drag;if(!n.isDragging)return;if("select-box"===n.mode)return void E();if(!n.noteId)return void E();const a=n.currentX-n.startX,s=n.currentY-n.startY,r=Math.round(a/t.horizontalZoom),o=-Math.round(s/t.verticalZoom);if("move"!==n.mode||0===r&&0===o){if("resize-end"===n.mode){const e=_.find(e=>e.id===n.noteId);e&&L(n.noteId,e.endRow+r)}}else j(n.noteId,r,o);E()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}},[t.horizontalZoom,t.verticalZoom,t.scrollX,t.scrollY,_,j,L,C,E,w,I]);const Ee=s.useCallback(()=>{const e=_.filter(e=>n.notes.has(e.id));e.length>0&&P(e)},[_,n.notes,P]),Pe=s.useCallback(()=>{Ee();const e=Array.from(n.notes);R(e),S()},[Ee,n.notes,R,S]),Te=s.useCallback(()=>{const e=Fy.getState().clipboard;e&&q(e,Math.floor(t.scrollX),Math.round(t.scrollY+60),t.channelIndex)},[q,t.scrollX,t.scrollY,t.channelIndex]),Ae=s.useCallback(()=>{const e=Array.from(n.notes);R(e),S()},[n.notes,R,S]),Ie=s.useCallback(()=>{k(_.map(e=>e.id))},[_,k]),Oe=s.useCallback(()=>{const e=Array.from(n.notes);$(e,t.gridDivision)},[n.notes,$,t.gridDivision]),Fe=s.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.slide);H(e,!t)},[_,n.notes,H]),De=s.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.accent);W(e,!t)},[_,n.notes,W]),Re=s.useCallback(()=>{const e=$f.getState().undo();e&&cm.getState().replacePattern(cm.getState().currentPatternIndex,e)},[]),je=s.useCallback(()=>{const e=$f.getState().redo();e&&cm.getState().replacePattern(cm.getState().currentPatternIndex,e)},[]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if(e.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const s=e.key,r=s.toLowerCase();if((e.ctrlKey||e.metaKey)&&"z"===r&&!e.shiftKey)return e.preventDefault(),void Re();if((e.ctrlKey||e.metaKey)&&("y"===r||"z"===r&&e.shiftKey))return e.preventDefault(),void je();if((e.ctrlKey||e.metaKey)&&"c"===r)return e.preventDefault(),void Ee();if((e.ctrlKey||e.metaKey)&&"x"===r)return e.preventDefault(),void Pe();if((e.ctrlKey||e.metaKey)&&"v"===r)return e.preventDefault(),void Te();if((e.ctrlKey||e.metaKey)&&"a"===r)return e.preventDefault(),void Ie();if("Delete"===s||"Backspace"===s)return e.preventDefault(),void Ae();if("Escape"===s)return e.preventDefault(),S(),void A();if(!e.ctrlKey&&!e.metaKey&&!e.altKey){if("q"===r&&n.notes.size>0&&"select"===a)return e.preventDefault(),void Oe();if("s"===r&&n.notes.size>0&&"select"===a&&!e.shiftKey&&"select"===a)return e.preventDefault(),void Fe();if("a"===r&&n.notes.size>0&&"select"===a&&!e.shiftKey)return e.preventDefault(),void De();if("draw"!==a){if("1"===s)return M("select"),void e.preventDefault();if("2"===s)return M("draw"),void e.preventDefault();if("3"===s)return M("erase"),void e.preventDefault()}}if(!("draw"!==a||e.ctrlKey||e.metaKey||e.altKey||e.repeat)){const n=gP[r];if(void 0!==n){e.preventDefault();const a=cm.getState().currentOctave||4,s=pe(12*a+n),r=Math.floor(t.scrollX),o=ue();return F(s,r,o,100,t.channelIndex),void he(s)}}},s=e=>{const t=e.key.toLowerCase();"draw"===a&&void 0!==gP[t]&&me()};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[a,n.notes,t.scrollX,t.channelIndex,t.gridDivision,_,F,Ee,Pe,Te,Ae,Ie,Oe,Fe,De,Re,je,S,A,M,pe,ue,he,me]);const Le=s.useMemo(()=>t.showVelocityLane?ee-80:ee,[ee,t.showVelocityLane]),Be=O?.length||64,Ve=s.useMemo(()=>Object.entries(Fb).map(([e,t])=>({value:e,label:t.name})),[]);return bn.jsxs("div",{ref:J,className:"flex flex-col h-full w-full bg-dark-bgSecondary",role:"application","aria-label":"Piano roll editor",children:[bn.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-border bg-dark-bgTertiary shrink-0 flex-wrap",children:[bn.jsxs("div",{className:"flex items-center bg-dark-bg rounded-md p-0.5",role:"toolbar","aria-label":"Editing tools",children:[bn.jsx("button",{onClick:()=>M("select"),className:"p-1.5 rounded transition-colors "+("select"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Select (1)","aria-pressed":"select"===a,children:bn.jsx(en,{size:14})}),bn.jsx("button",{onClick:()=>M("draw"),className:"p-1.5 rounded transition-colors "+("draw"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Draw (2)","aria-pressed":"draw"===a,children:bn.jsx(Xt,{size:14})}),bn.jsx("button",{onClick:()=>M("erase"),className:"p-1.5 rounded transition-colors "+("erase"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Erase (3)","aria-pressed":"erase"===a,children:bn.jsx(tn,{size:14})})]}),bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx("span",{className:"text-[10px] text-text-muted",children:"H"}),bn.jsx("button",{onClick:()=>i(.8*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out horizontally",children:bn.jsx(nn,{size:14})}),bn.jsx("span",{className:"text-xs text-text-muted w-6 text-center",children:Math.round(t.horizontalZoom)}),bn.jsx("button",{onClick:()=>i(1.25*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in horizontally",children:bn.jsx(an,{size:14})})]}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx("span",{className:"text-[10px] text-text-muted",children:"V"}),bn.jsx("button",{onClick:()=>l(t.verticalZoom-2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out vertically",children:bn.jsx(Ot,{size:14})}),bn.jsxs("span",{className:"text-xs text-text-muted w-10 text-center",title:`${le} octaves visible`,children:[le,"oct"]}),bn.jsx("button",{onClick:()=>l(t.verticalZoom+2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in vertically",children:bn.jsx(_t,{size:14})})]}),bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("button",{onClick:()=>d(!t.snapToGrid),className:"p-1 rounded transition-colors "+(t.snapToGrid?"text-accent-primary":"text-text-muted"),title:"Snap to grid","aria-pressed":t.snapToGrid,children:bn.jsx(Ut,{size:14})}),bn.jsxs("select",{value:t.gridDivision,onChange:e=>u(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Grid division","aria-label":"Grid division",children:[bn.jsx("option",{value:1,children:"1/1"}),bn.jsx("option",{value:2,children:"1/2"}),bn.jsx("option",{value:4,children:"1/4"}),bn.jsx("option",{value:8,children:"1/8"}),bn.jsx("option",{value:16,children:"1/16"})]})]}),bn.jsx("select",{value:t.noteLengthPreset,onChange:e=>v(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Note length","aria-label":"Note length preset",children:Oy.map(e=>bn.jsx("option",{value:e.value,children:e.label},e.value))}),bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx(_e,{size:12,className:"text-text-muted"}),bn.jsx("select",{value:t.scaleRoot,onChange:e=>g(Number(e.target.value)),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary w-10",title:"Root note","aria-label":"Scale root note",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e,t)=>bn.jsx("option",{value:t,children:e},t))}),bn.jsx("select",{value:t.scaleKey,onChange:e=>y(e.target.value),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Scale","aria-label":"Scale type",children:Ve.map(e=>bn.jsx("option",{value:e.value,children:e.label},e.value))})]}),bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsx("button",{onClick:()=>p(!t.showVelocity),className:"p-1 rounded transition-colors "+(t.showVelocity?"text-accent-primary":"text-text-muted"),title:"Show velocity on notes","aria-pressed":t.showVelocity,children:t.showVelocity?bn.jsx(dt,{size:14}):bn.jsx(ct,{size:14})}),bn.jsx("button",{onClick:()=>h(!t.showVelocityLane),className:"p-1 rounded transition-colors "+(t.showVelocityLane?"text-accent-primary":"text-text-muted"),title:"Velocity editing lane","aria-pressed":t.showVelocityLane,children:bn.jsx(yt,{size:14})}),bn.jsx("button",{onClick:()=>f(!t.multiChannel),className:"p-1 rounded transition-colors "+(t.multiChannel?"text-accent-primary":"text-text-muted"),title:"Show all channels","aria-pressed":t.multiChannel,children:bn.jsx(Zt,{size:14})}),bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsxs("button",{onClick:()=>ae(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-text-primary rounded transition-colors",title:"Generate 303 acid pattern",children:[bn.jsx(st,{size:12}),"Acid"]}),!t.multiChannel&&void 0===e&&O&&bn.jsxs(bn.Fragment,{children:[bn.jsx("div",{className:"w-px h-4 bg-dark-border"}),bn.jsxs("div",{className:"flex items-center gap-1.5",children:[bn.jsx("span",{className:"text-xs text-text-muted",children:"CH"}),bn.jsx("select",{value:t.channelIndex,onChange:e=>m(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary","aria-label":"Channel",children:O.channels.map((e,t)=>bn.jsxs("option",{value:t,children:[String(t+1).padStart(2,"0")," ",e.name?`- ${e.name}`:""]},t))})]})]}),bn.jsx("div",{className:"flex-1"}),bn.jsxs("span",{className:"text-xs text-text-muted",children:[_.length," notes",n.notes.size>0&&` (${n.notes.size} sel)`,o&&` | clip:${o.notes.length}`]})]}),bn.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:[bn.jsxs("div",{className:"flex-1 flex w-full overflow-hidden min-h-0",children:[bn.jsx(iP,{verticalZoom:t.verticalZoom,scrollY:t.scrollY,visibleNotes:ie,containerHeight:Le,activeNotes:ce,scaleNotes:de,onNotePreview:he,onNoteRelease:me}),bn.jsx(cP,{notes:_,patternLength:Be,horizontalZoom:t.horizontalZoom,verticalZoom:t.verticalZoom,scrollX:t.scrollX,scrollY:t.scrollY,gridDivision:t.gridDivision,showVelocity:t.showVelocity,selectedNotes:n.notes,playheadRow:Y?X:null,containerHeight:Le,scaleNotes:de,onNoteSelect:fe,onNoteDragStart:ye,onGridClick:ge,onGridRightClick:ve,onScroll:Ce,onSelectionBoxStart:be})]}),t.showVelocityLane&&bn.jsxs("div",{className:"flex w-full shrink-0",children:[bn.jsx("div",{className:"shrink-0",style:{width:48}})," ",bn.jsx(dP,{notes:_,horizontalZoom:t.horizontalZoom,scrollX:t.scrollX,selectedNotes:n.notes,onVelocityChange:B,onMultiVelocityChange:V,onBeginDrag:z,onDragVelocity:U,onDragMultiVelocity:G,onEndDrag:K})]})]}),bn.jsx(uP,{onCopy:Ee,onCut:Pe,onPaste:Te,onDelete:Ae,onSelectAll:Ie,onQuantize:Oe,onToggleSlide:Fe,onToggleAccent:De,hasSelection:n.notes.size>0,hasClipboard:null!==o}),ne&&bn.jsx(Qb,{channelIndex:e??t.channelIndex,onClose:()=>ae(!1)})]})},bP=({curve:e,parameter:t,patternLength:n,onChange:a})=>{const r=s.useRef(null),o=s.useRef(null),[i,l]=s.useState("pencil"),[c,d]=s.useState(!1),[u,p]=s.useState(null),[h,m]=s.useState(800),f=200,y=35,g=10,v="cyan-lineart"===sy(e=>e.currentThemeId),b=v?"#00ffff":"#00d4aa",x=v?"#00ffff":"#7c3aed",w=v?"rgba(0, 255, 255, 0.3)":"rgba(0, 212, 170, 0.3)",k=v?"#0a2020":"#1a1a1d",S=v?"#0f3030":"#252528",M=v?"#030808":"#0a0a0b",N=v?"#00a0a0":"#606068";s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e)m(t.contentRect.width)});return t.observe(e),m(e.clientWidth),()=>t.disconnect()},[]);const C=h-y-10,E=165,P=s.useCallback(e=>y+e/n*C,[n,C]),T=s.useCallback(e=>g+(1-e)*E,[E]),A=s.useCallback(e=>{const t=(e-y)/C;return Math.round(t*n)},[n,C]),I=s.useCallback(e=>{const t=1-(e-g)/E;return Math.max(0,Math.min(1,t))},[E]),_=s.useCallback(()=>{const t=o.current;if(!t)return;const a=t.getContext("2d");if(a){a.fillStyle=M,a.fillRect(0,0,h,f);for(let e=0;e<=n;e++){const t=P(e),s=e%16==0,r=e%4==0;a.strokeStyle=s?S:k,a.lineWidth=s?1.5:.5,(n<=64||r)&&(a.beginPath(),a.moveTo(t,g),a.lineTo(t,175),a.stroke()),s&&e<n&&(a.fillStyle=N,a.font="9px JetBrains Mono, monospace",a.textAlign="center",a.fillText(e.toString(),t,192))}a.strokeStyle=k,a.lineWidth=.5;for(let e=0;e<=4;e++){const t=g+e/4*E,n=2===e;a.strokeStyle=n?S:k,a.lineWidth=n?1:.5,a.beginPath(),a.moveTo(y,t),a.lineTo(h-10,t),a.stroke()}if(a.fillStyle=N,a.font="9px JetBrains Mono, monospace",a.textAlign="right",a.fillText("1.0",30,14),a.fillText("0.5",30,95.5),a.fillText("0.0",30,178),e.points.length>0){const t=a.createLinearGradient(y,0,h-10,0);t.addColorStop(0,b),t.addColorStop(1,x),a.strokeStyle=t,a.lineWidth=2,a.beginPath();const n=[...e.points].sort((e,t)=>e.row-t.row);n.forEach((t,s)=>{const r=P(t.row),o=T(t.value);if(0===s)a.moveTo(r,o);else if("linear"===e.interpolation)a.lineTo(r,o);else if("exponential"===e.interpolation){const e=n[s-1],t=P(e.row),i=t+.5*(r-t),l=T(e.value);a.quadraticCurveTo(i,l,r,o)}}),a.stroke(),n.forEach((e,t)=>{const n=P(e.row),s=T(e.value);t===u&&(a.fillStyle=w,a.beginPath(),a.arc(n,s,10,0,2*Math.PI),a.fill()),a.fillStyle=t===u?b:x,a.beginPath(),a.arc(n,s,5,0,2*Math.PI),a.fill(),a.fillStyle="#ffffff",a.beginPath(),a.arc(n,s,2,0,2*Math.PI),a.fill()})}}},[e,n,u,P,T,b,x,w,h,M,k,S,N,C,E]);s.useEffect(()=>{_()},[_]);const[O,F]=s.useState(!1),D=()=>{d(!1),F(!1)},R=s.useCallback(t=>{if(("Delete"===t.key||"Backspace"===t.key)&&null!==u){const t=e.points.filter((e,t)=>t!==u);a({...e,points:t}),p(null)}},[u,e,a]);s.useEffect(()=>(window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)),[R]);const j=(t,s)=>{if(t<0||t>n)return;const r=[...e.points],o=r.findIndex(e=>e.row===t);o>=0?r[o].value=s:r.push({row:t,value:s}),a({...e,points:r.sort((e,t)=>e.row-t.row)})},L=t=>{const s=[];for(let e=0;e<=n;e+=4){let a=0;switch(t){case"rampUp":a=e/n;break;case"rampDown":a=1-e/n;break;case"triangle":a=e<n/2?e/n*2:2-e/n*2;break;case"sine":a=(Math.sin(e/n*Math.PI*2-Math.PI/2)+1)/2;break;case"saw":a=e%(n/4)/(n/4);break;case"square":a=e<n/2?1:0;break;case"random":a=Math.random()}s.push({row:e,value:a})}a({...e,points:s})};return bn.jsxs("div",{className:"bg-dark-bg p-4",children:[bn.jsx("div",{className:"text-accent-primary text-sm font-semibold mb-3",children:t.toUpperCase()}),bn.jsxs("div",{className:"flex gap-2 mb-3 flex-wrap",children:[bn.jsxs("div",{className:"flex gap-1 flex-wrap",children:[bn.jsx("button",{onClick:()=>L("rampUp"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Up"}),bn.jsx("button",{onClick:()=>L("rampDown"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Down"}),bn.jsx("button",{onClick:()=>L("triangle"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Triangle"}),bn.jsx("button",{onClick:()=>L("sine"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Sine"}),bn.jsx("button",{onClick:()=>L("random"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Random"})]}),bn.jsx("div",{className:"w-px bg-dark-border mx-1"}),bn.jsx("button",{onClick:()=>{a({...e,points:[]})},className:"px-3 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-accent-error border border-dark-border hover:border-accent-error transition-colors",children:"Clear"})]}),bn.jsx("div",{ref:r,className:"w-full",children:bn.jsx("canvas",{ref:o,width:h,height:f,onMouseDown:t=>{const n=o.current;if(!n)return;const a=n.getBoundingClientRect(),s=n.width/a.width,r=n.height/a.height,l=(t.clientX-a.left)*s,c=(t.clientY-a.top)*r,u=A(l),h=I(c),m=e.points.findIndex(e=>{const t=P(e.row),n=T(e.value);return Math.hypot(t-l,n-c)<15});if(m>=0)return p(m),void F(!0);"pencil"===i?(d(!0),j(u,h)):"select"===i&&p(null)},onMouseMove:t=>{const s=o.current;if(!s)return;const r=s.getBoundingClientRect(),l=s.width/r.width,d=s.height/r.height,h=(t.clientX-r.left)*l,m=(t.clientY-r.top)*d,f=A(h),y=I(m);if(O&&null!==u){const t=[...e.points],s=Math.max(0,Math.min(n,f));t[u]={row:s,value:y};const r=t.sort((e,t)=>e.row-t.row),o=r.findIndex(e=>e.row===s&&Math.abs(e.value-y)<.001);a({...e,points:r}),o>=0&&o!==u&&p(o)}else"pencil"===i&&c&&j(f,y)},onMouseUp:D,onMouseLeave:D,onContextMenu:t=>{t.preventDefault();const n=o.current;if(!n)return;const s=n.getBoundingClientRect(),r=n.width/s.width,i=n.height/s.height,l=(t.clientX-s.left)*r,c=(t.clientY-s.top)*i,d=e.points.findIndex(e=>{const t=P(e.row),n=T(e.value);return Math.hypot(t-l,n-c)<15});if(d>=0){const t=e.points.filter((e,t)=>t!==d);a({...e,points:t}),p(null)}},className:"w-full rounded-lg border border-dark-border "+(O?"cursor-grabbing":"cursor-crosshair"),style:{height:f},tabIndex:0})}),bn.jsxs("div",{className:"mt-3 flex gap-2 items-center",children:[bn.jsx("span",{className:"text-text-muted text-xs",children:"Interpolation:"}),bn.jsx("button",{onClick:()=>a({...e,interpolation:"linear"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("linear"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Linear"}),bn.jsx("button",{onClick:()=>a({...e,interpolation:"exponential"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("exponential"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Exponential"})]})]})},xP=[{label:"TB-303 Filter",params:[{id:"cutoff",name:"Cutoff",description:"Filter frequency"},{id:"resonance",name:"Resonance",description:"Filter resonance"},{id:"envMod",name:"Env Mod",description:"Envelope depth"},{id:"decay",name:"Decay",description:"Envelope decay time"}]},{label:"TB-303 Character",params:[{id:"accent",name:"Accent",description:"Accent intensity"},{id:"tuning",name:"Tuning",description:"Pitch detune"},{id:"overdrive",name:"Overdrive",description:"Saturation drive"}]},{label:"Mixer",params:[{id:"volume",name:"Volume",description:"Channel volume"},{id:"pan",name:"Pan",description:"Stereo panning"}]},{label:"Effects",params:[{id:"distortion",name:"Distortion",description:"Drive amount"},{id:"delay",name:"Delay",description:"Delay wet mix"},{id:"reverb",name:"Reverb",description:"Reverb wet mix"}]}],wP=()=>{const{patterns:e,currentPatternIndex:t}=cm(),{getAutomation:n,setAutomation:a}=Wf(),[r,o]=s.useState("cutoff"),[i,l]=s.useState(0),c="cyan-lineart"===sy(e=>e.currentThemeId),d=c?"bg-cyan-500/20":"bg-orange-500/20",u=c?"text-cyan-400":"text-orange-400",p=c?"border-cyan-500":"border-orange-500",h=c?"hover:bg-cyan-500/30":"hover:bg-orange-500/30",m=c?"bg-cyan-500":"bg-orange-500",f=e[t],y=f?.channels.length||4,g=Math.min(i,y-1);if(!f)return bn.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const v=n(f.id,g,r);return bn.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-dark-bg",children:[bn.jsx("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:bn.jsxs("div",{className:"flex items-center justify-between",children:[bn.jsxs("div",{className:"flex items-center gap-3",children:[bn.jsx("span",{className:"text-text-secondary text-sm",children:"Automation"}),bn.jsxs("span",{className:"text-text-primary font-medium",children:["Pattern ",String(t).padStart(2,"0"),": ",f.name]})]}),bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsx("span",{className:"text-text-muted text-xs",children:"Channel:"}),bn.jsx("div",{className:"flex gap-1",children:Array.from({length:y},(e,t)=>{const n=f.channels[t];return bn.jsx("button",{onClick:()=>l(t),className:`\n                      w-8 h-7 text-xs font-mono rounded border transition-all\n                      ${g===t?"text-text-inverse border-transparent":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"}\n                    `,style:g===t?{backgroundColor:n?.color||"#22c55e"}:void 0,title:n?.name||`Channel ${t+1}`,children:t+1},t)})})]})]})}),bn.jsx("div",{className:"border-b border-dark-border bg-dark-bgSecondary p-3",children:bn.jsx("div",{className:"flex gap-6 flex-wrap",children:xP.map(e=>bn.jsxs("div",{className:"flex flex-col gap-1.5",children:[bn.jsx("div",{className:"text-text-muted text-[10px] font-medium uppercase tracking-wider",children:e.label}),bn.jsx("div",{className:"flex gap-1.5",children:e.params.map(e=>{const t=n(f.id,g,e.id).points.length>0,a=r===e.id;return bn.jsxs("button",{onClick:()=>o(e.id),className:`\n                        relative px-3 py-1.5 text-xs rounded-md border transition-all duration-150\n                        ${a?"bg-accent-primary text-text-inverse border-accent-primary shadow-glow-sm":t?`${d} ${u} ${p} ${h}`:"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight hover:text-text-primary"}\n                      `,title:e.description+(t?" (has automation)":""),children:[e.name,t&&!a&&bn.jsx("span",{className:`absolute -top-1 -right-1 w-2 h-2 ${m} rounded-full`})]},e.id)})})]},e.label))})}),bn.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:bn.jsx(bP,{curve:v,parameter:r,patternLength:f.length,onChange:e=>{a(f.id,g,r,e)}})})]})};function kP(e,t,n){let a="";for(let s=0;s<n;s++){const n=e[t+s];if(0===n)break;a+=String.fromCharCode(n)}return a.trim()}function SP(e,t){return e[t]|e[t+1]<<8}function MP(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}async function NP(e){const t=await e.arrayBuffer(),n=new Uint8Array(t),a=function(e){if(e.length>1084){const t=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);if(["M.K.","M!K!","4CHN","6CHN","8CHN","FLT4","FLT8"].includes(t))return"MOD";if(t.match(/^\d\dCH$/))return"MOD"}if(e.length>17&&"Extended Module: "===String.fromCharCode(...e.slice(0,17)))return"XM";if(e.length>48&&26===e[44]&&16===e[45]&&16===e[29])return"S3M";if(e.length>4&&"IMPM"===String.fromCharCode(e[0],e[1],e[2],e[3]))return"IT";return null}(n);if(!a)throw new Error("Unknown or unsupported module format");switch(a){case"MOD":return function(e){const t=kP(e,0,20),n=[],a=[];for(let d=0;d<31;d++){const t=20+30*d,n=kP(e,t,22),s=2*(e[t+22]<<8|e[t+23]),r=15&e[t+24],o=e[t+25],i=2*(e[t+26]<<8|e[t+27]),l=2*(e[t+28]<<8|e[t+29]);a.push({name:n,length:s,fineTune:r,volume:o,loopStart:i,loopLength:l})}const s=e[950],r=e.slice(952,1080);let o=0;for(let d=0;d<s;d++)r[d]>o&&(o=r[d]);const i=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);let l=4;"6CHN"===i?l=6:"8CHN"===i||"FLT8"===i?l=8:i.match(/^\d\dCH$/)&&(l=parseInt(i.substring(0,2),10));let c=1084+64*(o+1)*l*4;for(let d=0;d<31;d++){const t=a[d];if(0===t.length)continue;const s=new Float32Array(t.length);for(let n=0;n<t.length;n++){const t=e[c+n],a=t>127?t-256:t;s[n]=a/128}let r="none";t.loopLength>2&&(r="forward"),n.push({name:t.name||`Sample ${d+1}`,sampleRate:8363,channels:1,bitDepth:8,pcmData:s,loopStart:t.loopStart,loopEnd:t.loopStart+t.loopLength,loopType:r,baseNote:"C-4",fineTune:t.fineTune>7?t.fineTune-16:t.fineTune,volume:t.volume}),c+=t.length}return{samples:n,format:"MOD",title:t}}(n);case"XM":return function(e){const t=kP(e,17,20),n=[],a=MP(e,60),s=SP(e,72);let r=60+a;for(let o=0;o<s&&!(r>=e.length);o++){const t=MP(e,r),a=kP(e,r+4,22),s=SP(e,r+27);if(0===s){r+=t;continue}const o=MP(e,r+29);r+=t;const i=[];for(let n=0;n<s&&!(r+40>e.length);n++)i.push({length:MP(e,r),loopStart:MP(e,r+4),loopLength:MP(e,r+8),volume:e[r+12],fineTune:e[r+13]>127?e[r+13]-256:e[r+13],type:e[r+14],pan:e[r+15],relNote:e[r+16]>127?e[r+16]-256:e[r+16],name:kP(e,r+18,22)}),r+=o;for(let l=0;l<s;l++){const t=i[l];if(0===t.length)continue;const s=!!(16&t.type),o=s?t.length/2:t.length,c=new Float32Array(o);if(s){let n=0;for(let t=0;t<o;t++){const a=SP(e,r+2*t);n+=a>32767?a-65536:a,n>32767&&(n-=65536),n<-32768&&(n+=65536),c[t]=n/32768}r+=t.length}else{let n=0;for(let a=0;a<t.length;a++){const t=e[r+a];n+=t>127?t-256:t,n>127&&(n-=256),n<-128&&(n+=256),c[a]=n/128}r+=t.length}let d="none";1==(3&t.type)?d="forward":2==(3&t.type)&&(d="pingpong"),n.push({name:t.name||a||`Sample ${n.length+1}`,sampleRate:8363,channels:1,bitDepth:s?16:8,pcmData:c,loopStart:s?t.loopStart/2:t.loopStart,loopEnd:s?(t.loopStart+t.loopLength)/2:t.loopStart+t.loopLength,loopType:d,baseNote:"C-4",fineTune:t.fineTune,volume:t.volume})}}return{samples:n,format:"XM",title:t}}(n);case"S3M":return function(e){const t=kP(e,0,28),n=[],a=SP(e,34),s=[];for(let r=0;r<a;r++)s.push(16*SP(e,96+2*r));for(let r=0;r<a;r++){const t=s[r];if(0===t||t>=e.length)continue;if(1!==e[t])continue;const a=kP(e,t+48,28),o=SP(e,t+16)|e[t+18]<<16,i=SP(e,t+20)|e[t+22]<<16,l=SP(e,t+24)|e[t+26]<<16,c=e[t+28],d=e[t+31],u=MP(e,t+32),p=16*(e[t+13]<<16|SP(e,t+14));if(0===o||p>=e.length)continue;const h=!!(4&d),m=!!(1&d),f=o/((h?2:1)*(2&d?2:1)),y=new Float32Array(f);if(h)for(let n=0;n<f;n++){const t=SP(e,p+2*n);y[n]=(t-32768)/32768}else for(let n=0;n<f;n++){const t=e[p+n];y[n]=(t-128)/128}n.push({name:a||`Sample ${r+1}`,sampleRate:u||8363,channels:1,bitDepth:h?16:8,pcmData:y,loopStart:m?h?i/2:i:void 0,loopEnd:m?h?l/2:l:void 0,loopType:m?"forward":"none",baseNote:"C-4",volume:c})}return{samples:n,format:"S3M",title:t}}(n);case"IT":throw new Error("IT format sample extraction not yet implemented");default:throw new Error(`Unsupported format: ${a}`)}}function CP(e){const{pcmData:t,sampleRate:n,channels:a}=e,s=t.length,r=2*a,o=n*r,i=2*s,l=44+i,c=new ArrayBuffer(l),d=new DataView(c);EP(d,0,"RIFF"),d.setUint32(4,l-8,!0),EP(d,8,"WAVE"),EP(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,a,!0),d.setUint32(24,n,!0),d.setUint32(28,o,!0),d.setUint16(32,r,!0),d.setUint16(34,16,!0),EP(d,36,"data"),d.setUint32(40,i,!0);let u=44;for(let m=0;m<s;m++){const e=Math.max(-1,Math.min(1,t[m])),n=Math.round(32767*e);d.setInt16(u,n,!0),u+=2}const p=new Uint8Array(c);let h="";for(let m=0;m<p.length;m++)h+=String.fromCharCode(p[m]);return`data:audio/wav;base64,${btoa(h)}`}function EP(e,t,n){for(let a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}function PP(e,t){const n=function(e){const t={version:1,name:e.name,rows:e.length,channels:e.channels.length,data:e.channels.map(e=>e.rows)},n=JSON.stringify(t,null,2);return new Blob([n],{type:"application/json"})}(e),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=`${e.name}.xp`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function TP(e,t,n){const a=t.channels[e];if(!a)throw new Error(`Channel ${e} not found in pattern`);const s=function(e,t){const n=t.channels[e];if(!n)throw new Error(`Channel ${e} not found in pattern`);const a={version:1,name:n.name,rows:t.length,data:n.rows},s=JSON.stringify(a,null,2);return new Blob([s],{type:"application/json"})}(e,t),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`${a.name}.xt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}const AP=({onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:a,onShowInstruments:r,onShowImportModule:o,onShowDrumpads:i,showMasterFX:l,showInstrumentFX:c,showImportModule:d})=>{const{isMobile:u,width:p}=function(){const[e,t]=s.useState(()=>{const e="undefined"!=typeof window?window.innerWidth:1024;return{width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024}});return s.useEffect(()=>{const e=()=>{const e=window.innerWidth;t({width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),{patterns:h,currentPatternIndex:m,cursor:f,showGhostPatterns:y,loadPatterns:g,setPatternOrder:v,setOriginalModuleData:b,setShowGhostPatterns:x,scaleVolume:w,fadeVolume:k,remapInstrument:S}=cm(On(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,showGhostPatterns:e.showGhostPatterns,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,setOriginalModuleData:e.setOriginalModuleData,setShowGhostPatterns:e.setShowGhostPatterns,scaleVolume:e.scaleVolume,fadeVolume:e.fadeVolume,remapInstrument:e.remapInstrument}))),{loadInstruments:M}=Df(On(e=>({loadInstruments:e.loadInstruments}))),{setMetadata:N}=Hf(On(e=>({setMetadata:e.setMetadata}))),{setBPM:C,smoothScrolling:E,setSmoothScrolling:P,grooveTemplateId:T,swing:A,jitter:I,useMpcScale:_}=Gf(On(e=>({setBPM:e.setBPM,smoothScrolling:e.smoothScrolling,setSmoothScrolling:e.setSmoothScrolling,grooveTemplateId:e.grooveTemplateId,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale}))),{masterMuted:O,toggleMasterMute:F}=Kf(On(e=>({masterMuted:e.masterMuted,toggleMasterMute:e.toggleMasterMute}))),D=jf(e=>e.statusMessage),[R,j]=s.useState("tracker"),[L,B]=s.useState(0),[V,z]=s.useState(!1),[U,G]=s.useState(!1),[K,H]=s.useState(!1),[W,$]=s.useState(!1),[q,Y]=s.useState(!1),[X,Q]=s.useState(!1),[Z,J]=s.useState(!1),[ee,te]=s.useState(!1),[ne,ae]=s.useState(!1),[se,re]=s.useState(!1),[oe,ie]=s.useState(!1),[le,ce]=s.useState(!1),[de,ue]=s.useState(!1),[pe,he]=s.useState("block"),[me,fe]=s.useState("block"),[ye,ge]=s.useState(!1),[ve,be]=s.useState(0),[xe,we]=s.useState(!1),ke=d??se,Se=o??re,[Me,Ne]=s.useState(!0),[Ce,Ee]=s.useState(!1),[Pe,Te]=s.useState(!1),{fps:Ie,averageFps:_e,quality:Fe}={fps:60,averageFps:60,quality:jf(e=>e.performanceQuality)};s.useEffect(()=>{"grid"===R&&requestAnimationFrame(()=>{B(f.channelIndex)})},[R,f.channelIndex]);const De=s.useCallback(e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return!e.ctrlKey&&!e.metaKey||"i"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"h"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"f"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"o"!==e.key.toLowerCase()||e.shiftKey||e.altKey?"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey?!e.ctrlKey&&!e.metaKey||"e"!==e.key.toLowerCase()||e.shiftKey||e.altKey?(e.ctrlKey||e.metaKey)&&"h"===e.key.toLowerCase()&&e.shiftKey&&!e.altKey?(e.preventDefault(),void J(e=>!e)):!e.ctrlKey&&!e.metaKey||"m"!==e.key.toLowerCase()||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void te(e=>!e)):(e.preventDefault(),void Q(e=>!e)):(e.preventDefault(),void $(e=>!e)):(e.preventDefault(),void Se(!0)):(e.preventDefault(),void H(!0)):(e.preventDefault(),void G(!0)):(e.preventDefault(),void z(!0))},[Se,z,G,H]);s.useEffect(()=>(window.addEventListener("keydown",De),()=>window.removeEventListener("keydown",De)),[De]),(()=>{const{cursor:e,patterns:t,currentPatternIndex:n,selection:a,currentOctave:r,recordMode:o,editStep:i,insertMode:l,multiRecEnabled:c,multiEditEnabled:d,multiRecChannels:u,recReleaseEnabled:p}=cm(On(e=>({cursor:e.cursor,patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,selection:e.selection,currentOctave:e.currentOctave,recordMode:e.recordMode,editStep:e.editStep,insertMode:e.insertMode,multiRecEnabled:e.multiRecEnabled,multiEditEnabled:e.multiEditEnabled,multiRecChannels:e.multiRecChannels,recReleaseEnabled:e.recReleaseEnabled}))),h=cm(e=>e.moveCursor),m=cm(e=>e.moveCursorToRow),f=cm(e=>e.moveCursorToChannel),y=cm(e=>e.moveCursorToColumn),g=cm(e=>e.setCell),v=cm(e=>e.clearCell),b=cm(e=>e.setCurrentPattern),x=cm(e=>e.startSelection),w=cm(e=>e.endSelection),k=cm(e=>e.clearSelection),S=cm(e=>e.copySelection),M=cm(e=>e.cutSelection),N=cm(e=>e.paste),C=cm(e=>e.pasteMix),E=cm(e=>e.pasteFlood),P=cm(e=>e.pastePushForward),T=cm(e=>e.setCurrentOctave),A=cm(e=>e.transposeSelection),I=cm(e=>e.interpolateSelection),_=cm(e=>e.humanizeSelection),O=cm(e=>e.toggleRecordMode),F=cm(e=>e.setEditStep),D=cm(e=>e.writeMacroSlot),R=cm(e=>e.readMacroSlot),j=cm(e=>e.toggleInsertMode),L=cm(e=>e.setKeyOn),B=cm(e=>e.setKeyOff),V=cm(e=>e.findBestChannel),z=cm(e=>e.insertRow),U=cm(e=>e.deleteRow),G=cm(e=>e.setPtnJumpPos),K=cm(e=>e.getPtnJumpPos),{isPlaying:H,currentRow:W,stop:$,play:q,togglePlayPause:Y}=Gf(On(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow,stop:e.stop,play:e.play,togglePlayPause:e.togglePlayPause}))),{instruments:X,currentInstrumentId:Q,setCurrentInstrument:Z}=Df(),J=t[n],ee=s.useRef(new Map),te=s.useCallback(()=>d&&o&&!H||c&&o&&H?V():e.channelIndex,[e.channelIndex,o,H,d,c,V]),ne=s.useCallback((e,t,n)=>{if(null===Q)return;const a=em(),s=X.find(e=>e.id===Q);if(!s)return;const r=`${e}${t}`,o=Ba(`${e}-${t}`);if(ee.current.has(n))return;const i=ee.current.size>0,l="TB303"===s.synthType||"Buzz3o3"===s.synthType,c=i&&l,d=!1,u=te(),{midiPolyphonic:p}=Zh.getState();p?a.triggerPolyNoteAttack(Q,r,1,s,d,c):a.triggerNoteAttack(Q,r,void 0,1,s,void 0,d,c),ee.current.set(n,{note:r,xmNote:o,instrumentId:Q,channelIndex:u}),L(u,o)},[Q,X,te,L]),ae=s.useCallback(e=>{const t=ee.current.get(e);if(!t)return;const n=em(),a=X.find(e=>e.id===t.instrumentId),{midiPolyphonic:s}=Zh.getState();s&&a?n.triggerPolyNoteRelease(t.instrumentId,t.note,a):n.releaseNote(t.instrumentId,t.note),B(t.channelIndex),p&&o&&H&&g(t.channelIndex,W,{note:97}),ee.current.delete(e)},[X,B,p,o,H,g,W]),se=s.useCallback((t,n,a)=>{const s=Ba(`${t}-${n}`);if(0===s)return;const r=void 0!==a?a:te(),c=o&&H?W:e.rowIndex;if(l&&!H&&z(r,c),g(r,c,{note:s,instrument:null!==Q?Q:void 0}),jf.getState().chordEntryMode&&!H&&void 0===a){const t=J.channels.length,n=e.channelIndex+1;if(n<t)return void f(n)}i>0&&!H&&m((e.rowIndex+i)%J.length)},[e,g,o,i,J,m,f,H,W,l,z,te]),re=s.useCallback(()=>{z(e.channelIndex,e.rowIndex)},[e,z]),oe=s.useCallback(()=>{U(e.channelIndex,e.rowIndex)},[e,U]),ie=s.useCallback(s=>{if(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const l=s.key,c=l.toLowerCase();if("F9"===l){if(s.preventDefault(),s.shiftKey)G(0,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=K(0);m(e),q()}else m(0);return}if("F10"===l){if(s.preventDefault(),s.shiftKey)G(1,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=K(1);m(e),q()}else m(Math.floor(.25*J.length));return}if("F11"===l){if(s.preventDefault(),s.shiftKey)G(2,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=K(2);m(e),q()}else m(Math.floor(.5*J.length));return}if("F12"===l){if(s.preventDefault(),s.shiftKey)G(3,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=K(3);m(e),q()}else m(Math.floor(.75*J.length));return}if("PageUp"===l)return s.preventDefault(),void m(Math.max(0,e.rowIndex-16));if("PageDown"===l)return s.preventDefault(),void m(Math.min(J.length-1,e.rowIndex+16));if("Home"===l)return s.preventDefault(),void m(0);if("End"===l)return s.preventDefault(),void m(J.length-1);if("Tab"===l)return s.preventDefault(),s.shiftKey?"note"===e.columnType&&(e.channelIndex>0?f(e.channelIndex-1):f(J.channels.length-1)):e.channelIndex<J.channels.length-1?f(e.channelIndex+1):f(0),void y("note");if(s.altKey&&void 0!==ax[c]){s.preventDefault();const e=ax[c]%J.channels.length;return f(e),void y("note")}if(s.altKey&&void 0!==sx[c]){s.preventDefault();const e=sx[c]%J.channels.length;return f(e),void y("note")}if((s.ctrlKey||s.metaKey)&&l>="1"&&l<="8"&&!s.altKey){s.preventDefault();const e=parseInt(l)-1;return void(s.shiftKey?D(e):R(e))}if("Insert"===l)return s.preventDefault(),void(o?(s.shiftKey,re()):j());if(o&&(s.ctrlKey||s.metaKey)&&"ArrowUp"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?A(12):A(1));if(o&&(s.ctrlKey||s.metaKey)&&"ArrowDown"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?A(-12):A(-1));if("ArrowUp"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("up"),w()):h("up"));if("ArrowDown"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("down"),w()):h("down"));if("ArrowLeft"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("left"),w()):h("left"));if("ArrowRight"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("right"),w()):h("right"));if("Delete"===l&&o)return s.preventDefault(),s.shiftKey?g(e.channelIndex,e.rowIndex,{note:0,instrument:0,volume:0,effTyp:0,eff:0}):s.ctrlKey||s.metaKey?g(e.channelIndex,e.rowIndex,{volume:0,effTyp:0,eff:0}):s.altKey?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"note"===e.columnType?g(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?g(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?g(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?g(e.channelIndex,e.rowIndex,{probability:void 0}):v(e.channelIndex,e.rowIndex),void(i>0&&!H&&m((e.rowIndex+i)%J.length));if("Backspace"===l&&o)return s.preventDefault(),void(s.shiftKey?e.rowIndex>0&&(h("up"),oe()):e.rowIndex>0&&(h("up"),v(e.channelIndex,e.rowIndex)));if("F3"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&M());if("F4"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&S());if("F5"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&N());if((s.ctrlKey||s.metaKey)&&"c"===c&&!s.altKey)return s.preventDefault(),S(),void jf.getState().setStatusMessage("COPY");if((s.ctrlKey||s.metaKey)&&"x"===c&&!s.altKey)return s.preventDefault(),M(),void jf.getState().setStatusMessage("CUT");if((s.ctrlKey||s.metaKey)&&"v"===c&&!s.altKey)return s.preventDefault(),void(s.shiftKey?(C(),jf.getState().setStatusMessage("MIX PASTE")):(N(),jf.getState().setStatusMessage("PASTE")));if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"f"===c)return s.preventDefault(),void E();if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"i"===c)return s.preventDefault(),void P();if("Escape"===l)return s.preventDefault(),void k();if("Shift"===s.key&&2===s.location)return s.preventDefault(),o||O(),void q();if("Control"===s.key&&2===s.location)return s.preventDefault(),void q();if("Alt"===s.key&&2===s.location)return s.preventDefault(),void q();if(" "===l){if(s.preventDefault(),H)$(),jf.getState().setStatusMessage("STOPPED");else{O();const e=cm.getState().recordMode;jf.getState().setStatusMessage(e?"RECORD ON":"RECORD OFF")}return}if("Enter"===l&&(s.ctrlKey||s.metaKey))return s.preventDefault(),q(),void jf.getState().setStatusMessage("PLAYING");if("CapsLock"===l){if(s.preventDefault(),"note"===e.columnType){const t=o&&H?W:e.rowIndex;g(e.channelIndex,t,{note:97}),i>0&&!H&&m((e.rowIndex+i)%J.length)}return}if(l>="F1"&&l<="F7"){s.preventDefault();const e=parseInt(l.substring(1));return T(e),void jf.getState().setStatusMessage(`OCTAVE ${e}`)}if("`"===l||"~"===l){let e;return s.preventDefault(),e=s.shiftKey?0===i?16:i-1:16===i?0:i+1,F(e),void jf.getState().setStatusMessage(`EDIT STEP ${e}`)}if("NumpadAdd"===s.code||"+"===l&&!s.shiftKey&&3===s.location)return s.preventDefault(),void(r<7&&T(r+1));if("NumpadSubtract"===s.code||"-"===l&&3===s.location)return s.preventDefault(),void(r>1&&T(r-1));if(s.shiftKey&&"ArrowLeft"===l)return s.preventDefault(),void(n>0&&b(n-1));if(s.shiftKey&&"ArrowRight"===l)return s.preventDefault(),void(n<t.length-1&&b(n+1));if(s.shiftKey&&"ArrowUp"===l){if(s.preventDefault(),null!==Q&&Q>0){const e=X.find(e=>e.id===Q-1);e&&Z(e.id)}return}if(s.shiftKey&&"ArrowDown"===l){if(s.preventDefault(),null!==Q){const e=X.find(e=>e.id===Q+1);e&&Z(e.id)}return}if(nx[c]&&!s.altKey&&!s.ctrlKey&&!s.metaKey&&!s.repeat&&"note"===e.columnType){s.preventDefault();const{note:e,octaveOffset:t}=nx[c],n=r+t;if(ne(e,n,c),o){const t=ee.current.get(c),a=t?.channelIndex;se(e,n,a)}return}if(nx[c]&&s.repeat&&"note"===e.columnType){if(s.preventDefault(),o&&!H){const{note:e,octaveOffset:t}=nx[c],n=r+t,a=ee.current.get(c);se(e,n,a?.channelIndex)}return}const d=J.channels[e.channelIndex].rows[e.rowIndex];if(o&&"instrument"===e.columnType&&rx.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.instrument||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,a>128&&(a=128),g(e.channelIndex,e.rowIndex,{instrument:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&"volume"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=d.volume||0;if(0===e.digitIndex){const n=ox[c];if(void 0!==n){s.preventDefault();let a=n<<4|15&t;return a>=81&&a<=95&&(a=80),g(e.channelIndex,e.rowIndex,{volume:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}}else if(rx.includes(l)){s.preventDefault();const n=parseInt(l,16);let a;return a=t<16?16+n:240&t|n,a>=81&&a<=95&&(a=80),g(e.channelIndex,e.rowIndex,{volume:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}}if(o&&"effTyp"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=ix[c];if(void 0!==t)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{effTyp:t}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&"effParam"===e.columnType&&rx.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.eff||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,g(e.channelIndex,e.rowIndex,{eff:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&"effTyp2"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=ix[c];if(void 0!==t)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{effTyp2:t}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&("flag1"===e.columnType||"flag2"===e.columnType)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=e.columnType;if("a"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:1}),void(i>0&&!H&&m((e.rowIndex+i)%J.length));if("s"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:2}),void(i>0&&!H&&m((e.rowIndex+i)%J.length));if("m"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:3}),void(i>0&&!H&&m((e.rowIndex+i)%J.length));if("h"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:4}),void(i>0&&!H&&m((e.rowIndex+i)%J.length));if("0"===l||"."===l)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:0}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&"effParam2"===e.columnType&&rx.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.eff2||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,g(e.channelIndex,e.rowIndex,{eff2:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}if(o&&"probability"===e.columnType&&/^[0-9]$/.test(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,10),n=d.probability||0;let a;return a=0===e.digitIndex?10*t+n%10:10*Math.floor(n/10)+t,a=Math.min(99,Math.max(0,a)),g(e.channelIndex,e.rowIndex,{probability:a}),void(i>0&&!H&&m((e.rowIndex+i)%J.length))}},[e,J,t,n,H,W,r,Q,X,a,o,O,i,F,h,m,f,y,g,v,b,Z,$,q,x,w,k,S,M,N,C,E,P,ne,se,re,oe,A,I,_,G,K]),le=s.useCallback(e=>{const t=e.key.toLowerCase();nx[t]&&ae(t)},[ae]);s.useEffect(()=>(window.addEventListener("keydown",ie,{capture:!0}),window.addEventListener("keyup",le,{capture:!0}),()=>{window.removeEventListener("keydown",ie,{capture:!0}),window.removeEventListener("keyup",le,{capture:!0})}),[ie,le])})();const Re=(()=>{const{cursor:e,selection:t,clipboard:n,patterns:a,currentPatternIndex:r,startSelection:o,endSelection:i,clearSelection:l,copySelection:c,cutSelection:d,paste:u,setCell:p}=cm(),[h,m]=s.useState({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}),f=a[r],y=s.useCallback(()=>{o(),m(e=>({...e,blockStartMarked:!0,blockEndMarked:!1,isBlockSelected:!1}))},[o,e]),g=s.useCallback(()=>{i(),m(e=>({...e,blockEndMarked:!0,isBlockSelected:!0}))},[i,e]),v=s.useCallback(()=>{t&&c()},[t,c]),b=s.useCallback(()=>{n&&u()},[n,u,e]),x=s.useCallback(()=>{t&&(d(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}))},[t,d]),w=s.useCallback(()=>{l(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1})},[l]),k=s.useCallback(()=>t?{startChannel:Math.min(t.startChannel,t.endChannel),endChannel:Math.max(t.startChannel,t.endChannel),startRow:Math.min(t.startRow,t.endRow),endRow:Math.max(t.startRow,t.endRow)}:null,[t]),S=s.useCallback((e,t)=>{const n=k();return!!n&&e>=n.startChannel&&e<=n.endChannel&&t>=n.startRow&&t<=n.endRow},[k]),M=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let a=t.startRow;a<=t.endRow;a++){const t=f.channels[n].rows[a];if(t.note&&0!==t.note&&97!==t.note){const s=Ha(t.note);if(null!==s){const t=s+e;if(t>=12&&t<=107){const e=Wa(t);p(n,a,{note:e})}}}}},[k,f,p]),N=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let a=t.startRow;a<=t.endRow;a++){const t=f.channels[n].rows[a];if(null!==t.volume){const s=Math.min(64,Math.max(0,Math.round(t.volume*e)));p(n,a,{volume:s})}}},[k,f,p]),C=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++){const a=f.channels[n].rows[t.startRow],s=f.channels[n].rows[t.endRow],r=a[e]||0,o=s[e]||0,i=t.endRow-t.startRow;if(!(i<=1))for(let l=1;l<i;l++){const a=l/i,s=Math.round(r+(o-r)*a),c=t.startRow+l;p(n,c,{[e]:s})}}},[k,f,p]),E=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let a=e.startChannel;a<=e.endChannel;a++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[a].rows[n]});n.push(t)}for(let a=e.startChannel;a<=e.endChannel;a++){const s=a-e.startChannel;for(let r=0;r<t;r++){const o=n[s][t-1-r];p(a,e.startRow+r,{note:o.note,instrument:o.instrument,volume:o.volume,effTyp:o.effTyp,eff:o.eff,effTyp2:o.effTyp2,eff2:o.eff2,flag1:o.flag1,flag2:o.flag2})}}},[k,f,p]),P=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,a=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[s].rows[n]});a.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const r=s-e.startChannel;for(let o=0;o<2*t;o++){const t=e.startRow+o;if(t>=n)break;if(o%2==0){const e=a[r][o/2];p(s,t,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(s,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}e.startRow},[k,f,p]),T=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let a=e.startChannel;a<=e.endChannel;a++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[a].rows[n]});n.push(t)}for(let a=e.startChannel;a<=e.endChannel;a++){const s=a-e.startChannel;for(let r=0;r<t;r++){const o=e.startRow+r,i=2*r;if(i<t){const e=n[s][i];p(a,o,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(a,o,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[k,f,p]),A=s.useCallback((e,t,n)=>{const a=k();if(a)for(let s=a.startChannel;s<=a.endChannel;s++)for(let r=a.startRow;r<=a.endRow;r++){const a=f.channels[s].rows[r][n];if(0===a&&"volume"===n)continue;let o;switch(e){case"add":o=a+t;break;case"sub":o=a-t;break;case"mul":o=Math.round(a*t);break;case"div":o=0!==t?Math.round(a/t):a}const i="volume"===n?80:255;o=Math.max(0,Math.min(i,o)),p(s,r,{[n]:o})}},[k,f,p]),I=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,a=[];for(let r=e.startChannel;r<=e.endChannel;r++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[r].rows[n]});a.push(t)}let s=e.endRow+1;for(;s<n;){for(let n=e.startChannel;n<=e.endChannel;n++){const r=n-e.startChannel,o=(s-e.endRow-1)%t,i=a[r][o];p(n,s,{note:i.note,instrument:i.instrument,volume:i.volume,effTyp:i.effTyp,eff:i.eff,effTyp2:i.effTyp2,eff2:i.eff2,flag1:i.flag1,flag2:i.flag2})}s++}},[k,f,p]);return s.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return e.altKey&&"b"===e.key.toLowerCase()?(e.preventDefault(),void y()):e.altKey&&"e"===e.key.toLowerCase()?(e.preventDefault(),void g()):e.altKey&&"c"===e.key.toLowerCase()?(e.preventDefault(),void v()):!e.altKey||"v"!==e.key.toLowerCase()&&"p"!==e.key.toLowerCase()?e.altKey&&"x"===e.key.toLowerCase()?(e.preventDefault(),void x()):"Escape"===e.key&&t?(e.preventDefault(),void w()):e.altKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(1)):e.altKey&&e.shiftKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(-1)):!e.altKey||"r"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?!e.altKey||"d"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?void 0:(e.preventDefault(),void I()):(e.preventDefault(),void E()):(e.preventDefault(),void b())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[y,g,v,b,x,w,M,E,I,t]),{blockState:h,selection:t,clipboard:n,markBlockStart:y,markBlockEnd:g,copyBlock:v,pasteBlock:b,cutBlock:x,clearBlock:w,isCellInBlock:S,getBlockBounds:k,transposeBlock:M,amplifyBlock:N,interpolateBlock:C,reverseBlock:E,expandBlock:P,shrinkBlock:T,mathBlock:A,duplicateBlock:I}})();(()=>{const{patterns:e,currentPatternIndex:t,setCurrentPattern:n,patternOrder:a,currentPositionIndex:r,setCurrentPosition:o}=cm(),{isPlaying:i,isLooping:l,bpm:c,setCurrentRow:d,setCurrentRowThrottled:u}=Gf(),{instruments:p}=Df(),{automation:h}=Wf(),{masterEffects:m}=Kf(),f=a[r]??t,y=e[f],g=em(),v=wb(),b=s.useRef(!1);s.useEffect(()=>{g.setBPM(c)},[c]),s.useEffect(()=>{g.rebuildMasterEffects(m)},[m]),s.useEffect(()=>{y&&(y.channels.forEach((e,t)=>{const n=e.volume>0?e.volume/100*60-60:-1/0;g.setChannelVolume(t,n),g.setChannelPan(t,e.pan)}),g.updateMuteStates(y.channels.map(e=>({muted:e.muted,solo:e.solo}))))},[y]),s.useEffect(()=>{if(i&&y&&!b.current){b.current=!0;const s=y.importMetadata?.sourceFormat??"XM",r=y.importMetadata?.modData,i=l?[t]:a;v.loadSong({name:y.importMetadata?.sourceFile??y.name??"Untitled",format:s,patterns:e,instruments:p,songPositions:i,songLength:l?1:r?.songLength??a.length,restartPosition:0,numChannels:y.channels.length,initialSpeed:r?.initialSpeed??6,initialBPM:r?.initialBPM??c});let d=-1,h=-1;v.onRowChange=(t,a,s)=>{u(t,e[a]?.length??64),0!==t||a===d&&s===h||(d=a,h=s,queueMicrotask(()=>{n(a),o(s)}))},v.onSongEnd=()=>{},v.play().catch(e=>{})}else!i&&b.current&&(b.current=!1,v.stop(),v.onRowChange=null,v.onSongEnd=null,d(0));return()=>{!i&&b.current&&(v.stop(),v.onRowChange=null,v.onSongEnd=null)}},[i,l,y,p,a,e,c,t,n,o,d,u])})();const je=s.useCallback(async(e,t)=>{const{useLibopenmpt:n}=t;if(e.nativeData){const{format:t,importMetadata:a,instruments:s,patterns:r}=e.nativeData;let o;if("XM"===t)o=OC(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);else if("MOD"===t)o=FC(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);else if("FUR"===t||"DMF"===t){const e=a.modData?.patternOrderTable||[],t=r[0]?.length||64,n=r[0]?.[0]?.length||4;o={patterns:r.map((e,a)=>({id:`pattern-${a}`,name:`Pattern ${a}`,length:t,channels:Array.from({length:n},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:0,eff2:0}})}))})),order:e.length>0?e:[0],instrumentNames:s.map(e=>e.name)}}else o=FC(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);if(0===o.patterns.length)return void alert(`Module "${e.metadata.title}" contains no patterns to import.`);const i=[];for(let e=0;e<s.length;e++){const n=RC(s[e],s[e].id,t);i.push(...n)}M(i),g(o.patterns),o.order&&o.order.length>0&&v(o.order),o.originalModuleData?b(o.originalModuleData):b(null),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"} (${t})`}),C(a.modData?.initialBPM||125);const l=i.filter(e=>"Sampler"===e.synthType).length;l>0&&await em().preloadInstruments(i);const c=o.originalModuleData?"\n\n libopenmpt playback available - sample-accurate effects!":"";return void alert(`Module "${e.metadata.title}" imported!\n\nFormat: ${t}\nPatterns: ${o.patterns.length}\nChannels: ${a.originalChannelCount}\nInstruments: ${i.length}\nSamplers: ${l}\n\n Native parser used - full sample extraction and FT2 effects preserved!${c}`)}if(!e.metadata.song)return void alert(`Module "${e.metadata.title}" loaded but no pattern data found.\n\nThe module metadata was extracted but pattern data is not available.`);const a=_C(e.metadata.song);if(0===a.patterns.length)return void alert(`Module "${e.metadata.title}" contains no patterns to import.`);let s;if(e.file&&function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".s3m"].includes(t)}(e.file.name))try{const t=await NP(e.file);s=new Map;for(let e=0;e<t.samples.length;e++){const n=t.samples[e];if(n.pcmData.length>0){const t=CP(n);s.set(e+1,t)}}}catch(i){}const r=function(e,t,n){const a=new Set;for(const o of e)for(const e of o.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&a.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const o of Array.from(a).sort((e,t)=>e-t)){const e=t[o-1]||`Instrument ${o}`,a=n?.get(o);if(a)s.push({id:o,name:e.trim()||`Sample ${o}`,type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:a}});else{const t=r[(o-1)%r.length];s.push({id:o,name:e.trim()||`Instrument ${o}`,type:"synth",synthType:"Synth",oscillator:{..._a,type:t},envelope:{...Oa},filter:{...Fa},effects:[],volume:-6,pan:0})}}for(const o of[0,1])if(!a.has(o)){const e=n?.get(o);e?s.push({id:o,name:0===o?"Default":"Sample 01",type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:e}}):s.push({id:o,name:0===o?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{..._a,type:"sawtooth"},envelope:{...Oa},filter:{...Fa},effects:[],volume:-6,pan:0})}return s.sort((e,t)=>e.id-t.id),s}(a.patterns,a.instrumentNames,s);M(r),g(a.patterns),a.order&&a.order.length>0&&v(a.order),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"}`}),C(125);const o=r.filter(e=>"Sampler"===e.synthType).length;o>0&&await em().preloadInstruments(r),alert(`Module "${e.metadata.title}" imported!\n\nPatterns: ${a.patterns.length}\nChannels: ${a.channelCount}\nInstruments: ${r.length}\nSamplers: ${o}`)},[M,g,N,C,v,b]),Le=s.useCallback(e=>{be(e),ge(!0)},[]),Be=h[m];return u?bn.jsxs(bn.Fragment,{children:[bn.jsx(oP,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstruments:r,showMasterFX:l}),bn.jsx(hx,{isOpen:V,onClose:()=>z(!1)}),bn.jsx(mx,{isOpen:U,onClose:()=>G(!1)}),bn.jsx(fx,{isOpen:K,onClose:()=>H(!1)}),bn.jsx(NM,{isOpen:W,onClose:()=>$(!1)}),bn.jsx(wM,{isOpen:q,onClose:()=>Y(!1)}),bn.jsx(LM,{isOpen:X,onSelect:(e,t)=>{const{cursor:n,setCell:a}=cm.getState();a(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),Q(!1)},onClose:()=>Q(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=cm.getState(),a=t[n];if(!a)return;const s=a.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Df.getState().getInstrument(s.instrument);return r?.synthType})()}),bn.jsx(zM,{isOpen:Z,onClose:()=>J(!1)}),bn.jsx(UM,{isOpen:ee,onClose:()=>te(!1)}),bn.jsx(yM,{isOpen:ke,onClose:()=>Se(!1),onImport:je}),oe&&bn.jsx(gM,{scope:pe,onConfirm:e=>{w(pe,e),ie(!1)},onCancel:()=>ie(!1)}),le&&bn.jsx(vM,{scope:pe,onConfirm:(e,t)=>{k(pe,e,t),ce(!1)},onCancel:()=>ce(!1)}),de&&bn.jsx(bM,{scope:me,onConfirm:(e,t)=>{S(e,t,me),ue(!1)},onCancel:()=>ue(!1)}),ye&&bn.jsx(Qb,{channelIndex:ve,onClose:()=>ge(!1)})]}):bn.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-dark-bg overflow-y-hidden",children:[bn.jsx("div",{className:"flex-shrink min-h-[80px]",children:bn.jsx(DE,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:a,onShowInstruments:r,onShowPatternOrder:()=>we(!0),onShowDrumpads:i,showMasterFX:l,showInstrumentFX:c})}),"tb303"!==R&&bn.jsx("div",{className:"flex-shrink-0",children:bn.jsx(LE,{})}),bn.jsxs("div",{className:"flex-shrink flex items-center justify-between px-2 py-1 bg-dark-bgTertiary border-b border-dark-border min-h-[28px]",children:[bn.jsxs("div",{className:"flex items-center gap-2",children:[bn.jsxs("div",{className:"flex items-center gap-1",children:["tracker"===R&&bn.jsx(sn,{size:14,className:"text-text-secondary"}),"grid"===R&&bn.jsx(Ut,{size:14,className:"text-text-secondary"}),"pianoroll"===R&&bn.jsx(rn,{size:14,className:"text-text-secondary"}),"tb303"===R&&bn.jsx(Ae,{size:14,className:"text-text-secondary"}),bn.jsxs("select",{value:R,onChange:e=>j(e.target.value),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",title:"Select editor view",children:[bn.jsx("option",{value:"tracker",children:"Tracker"}),bn.jsx("option",{value:"grid",children:"Grid"}),bn.jsx("option",{value:"pianoroll",children:"Piano Roll"}),bn.jsx("option",{value:"tb303",children:"TB-303"})]})]}),("grid"===R||"pianoroll"===R)&&Be&&bn.jsxs(bn.Fragment,{children:[bn.jsx("span",{className:"text-text-secondary text-[10px] font-medium",children:"CH:"}),bn.jsx("select",{value:L,onChange:e=>B(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",children:Be.channels.map((e,t)=>bn.jsx("option",{value:t,children:(t+1).toString().padStart(2,"0")},t))})]}),"tracker"===R&&bn.jsxs("button",{onClick:()=>x(!y),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${y?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:y?"Hide ghost patterns":"Show ghost patterns",children:[y?bn.jsx(dt,{size:12}):bn.jsx(ct,{size:12}),bn.jsx("span",{children:"Ghosts"})]}),"tracker"===R&&bn.jsxs("button",{onClick:()=>Ee(!Ce),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${Ce?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Advanced Edit Panel",children:[bn.jsx(Oe,{size:12}),bn.jsx("span",{children:"Edit"})]}),"tracker"===R&&bn.jsxs("button",{onClick:()=>Te(!0),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Automation Editor",children:[bn.jsx(et,{size:12}),bn.jsx("span",{children:"Auto"})]}),bn.jsxs("button",{onClick:i,className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Drumpad Editor",children:[bn.jsx(vt,{size:12}),bn.jsx("span",{children:"Pads"})]}),bn.jsx("div",{className:"w-px h-4 bg-dark-border mx-1"}),bn.jsx("button",{onClick:F,className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${O?"bg-accent-error/20 text-accent-error":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:O?"Unmute master output":"Mute master output",children:O?"Unmute":"Mute"}),bn.jsx("button",{onClick:()=>P(!E),className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${E?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:E?"Switch to stepped scrolling":"Switch to smooth scrolling",children:E?"Smooth":"Stepped"}),bn.jsxs("div",{className:"flex items-center gap-1 ml-1 pl-2 border-l border-dark-border",children:[bn.jsx("button",{onClick:()=>ae(!0),className:"px-2 py-1 text-[10px] rounded font-mono font-bold transition-colors "+("straight"!==T||A!==(_?50:100)||I>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/50":"bg-dark-bgSecondary text-text-secondary border border-dark-border hover:text-text-primary"),title:`Groove Settings (Current: ${Ra.find(e=>e.id===T)?.name||"None"})`,children:"GROOVE"}),ne&&bn.jsx(cN,{onClose:()=>ae(!1)})]}),D&&bn.jsx("div",{className:"flex items-center px-3 ml-2 pl-3 border-l border-dark-border",children:bn.jsx("span",{className:"text-accent-primary font-bold tracking-[0.3em] text-[11px] animate-pulse font-mono",children:D.toUpperCase()})})]}),bn.jsxs("div",{className:`\n            flex items-center gap-1 px-2 py-0.5 text-xs rounded font-mono\n            ${"low"===Fe?"bg-accent-error/20 text-accent-error":"medium"===Fe?"bg-orange-500/20 text-orange-400":"bg-green-500/20 text-green-400"}\n          `,title:`Performance: ${Fe.toUpperCase()} | Avg FPS: ${_e} | Current: ${Ie}`,children:[bn.jsx("span",{className:"font-bold",children:_e}),bn.jsx("span",{className:"text-[10px] opacity-70",children:"FPS"}),bn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${"low"===Fe?"bg-accent-error":"medium"===Fe?"bg-orange-400":"bg-green-400"} animate-pulse`})]})]}),bn.jsxs("div",{className:"flex-1 min-h-0 min-w-0 relative z-10 flex overflow-hidden",children:[bn.jsx("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col overflow-hidden",children:"tracker"===R?bn.jsx(Pb,{onAcidGenerator:Le}):"grid"===R?bn.jsx(tx,{channelIndex:L}):"pianoroll"===R?bn.jsx(vP,{channelIndex:L}):bn.jsx("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden bg-dark-bgPrimary",children:bn.jsx(ZE,{channelIndex:L})})}),p>=900&&bn.jsx("button",{onClick:()=>Ne(!Me),className:`\n              flex-shrink-0 w-6 flex items-center justify-center\n              bg-ft2-header border-l border-ft2-border\n              hover:bg-ft2-border transition-colors\n              ${Me?"text-ft2-highlight":"text-ft2-textDim"}\n            `,title:Me?"Hide Instruments":"Show Instruments",children:bn.jsx(Bt,{size:14,className:Me?"":"rotate-180"})}),p>=900&&Me&&bn.jsx("div",{className:"flex-shrink-0 w-fit min-w-48 max-w-80 border-l border-ft2-border flex flex-col overflow-hidden animate-fade-in",children:bn.jsx(rP,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})})]}),bn.jsx(hx,{isOpen:V,onClose:()=>z(!1)}),bn.jsx(mx,{isOpen:U,onClose:()=>G(!1)}),bn.jsx(fx,{isOpen:K,onClose:()=>H(!1)}),bn.jsx(NM,{isOpen:W,onClose:()=>$(!1)}),bn.jsx(wM,{isOpen:q,onClose:()=>Y(!1)}),bn.jsx(LM,{isOpen:X,onSelect:(e,t)=>{const{cursor:n,setCell:a}=cm.getState();a(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),Q(!1)},onClose:()=>Q(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=cm.getState(),a=t[n];if(!a)return;const s=a.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Df.getState().getInstrument(s.instrument);return r?.synthType})()}),bn.jsx(zM,{isOpen:Z,onClose:()=>J(!1)}),bn.jsx(UM,{isOpen:ee,onClose:()=>te(!1)}),bn.jsx(yM,{isOpen:ke,onClose:()=>Se(!1),onImport:je}),oe&&bn.jsx(gM,{scope:pe,onConfirm:e=>{w(pe,e),ie(!1)},onCancel:()=>ie(!1)}),le&&bn.jsx(vM,{scope:pe,onConfirm:(e,t)=>{k(pe,e,t),ce(!1)},onCancel:()=>ce(!1)}),de&&bn.jsx(bM,{scope:me,onConfirm:(e,t)=>{S(e,t,me),ue(!1)},onCancel:()=>ue(!1)}),xe&&bn.jsx(xM,{onClose:()=>we(!1)}),Ce&&bn.jsx(SM,{onClose:()=>Ee(!1),onShowScaleVolume:e=>{he(e),ie(!0)},onShowFadeVolume:e=>{he(e),ce(!0)},onShowRemapInstrument:e=>{fe(e),ue(!0)},onExportPattern:()=>{PP(h[m])},onExportTrack:()=>{const e=h[m];TP(f.channelIndex,e)},onReverse:Re.reverseBlock,onExpand:Re.expandBlock,onShrink:Re.shrinkBlock,onDuplicate:Re.duplicateBlock,onMath:Re.mathBlock}),ye&&bn.jsx(Qb,{channelIndex:ve,onClose:()=>ge(!1)}),Pe&&bn.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:bn.jsxs("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[bn.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-bgSecondary",children:[bn.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center gap-2",children:[bn.jsx(et,{size:20,className:"text-accent-primary"}),"Automation Editor"]}),bn.jsx("button",{onClick:()=>Te(!1),className:"p-2 rounded hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors",title:"Close",children:bn.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:bn.jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})]}),bn.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:bn.jsx(wP,{})})]})})]})},IP=e.memo(({onShowTips:e})=>{const t=cm(e=>e.cursor),n=cm(e=>e.currentOctave),a=cm(e=>e.insertMode),s=cm(e=>e.recordMode),r=cm(e=>e.patterns[e.currentPatternIndex]?.length||64),{isPlaying:o,currentRow:i}=Gf(),{contextState:l}=Kf(),{knobBank:c,setKnobBank:d,isInitialized:u,inputDevices:p,selectedInputId:h,showKnobBar:m,setShowKnobBar:f}=Ny(),y=o?i:t.rowIndex,g=`${String(y).padStart(2,"0")}/${String(r-1).padStart(2,"0")}`,v=`Ch ${t.channelIndex+1}`,b=u&&p.length>0,x=b?p.find(e=>e.id===h)||p[0]:null,w=x?.name||"MIDI Controller",k=[{id:"303",label:"303/Synth",icon:Fe},{id:"Siren",label:"Dub Siren",icon:et},{id:"FX",label:"Effects",icon:ut},{id:"Mixer",label:"Mixer",icon:Ie}],S=b?by[c]:[];return bn.jsxs("div",{className:"flex flex-col",children:[b&&m&&bn.jsxs("div",{className:"bg-dark-bgTertiary border-t border-dark-border px-4 py-2 flex flex-col gap-2",children:[bn.jsxs("div",{className:"flex items-center gap-1",children:[bn.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase mr-2 tracking-widest",children:"Knob Bank:"}),k.map(e=>{const t=e.icon,n=c===e.id;return bn.jsxs("button",{onClick:()=>d(e.id),className:`\n                    flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase transition-all border\n                    ${n?"bg-accent-primary text-dark-bg border-accent-primary shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-dark-bgSecondary text-text-muted border-dark-border hover:border-text-muted"}\n                  `,children:[bn.jsx(t,{size:12}),e.label]},e.id)})]}),bn.jsx("div",{className:"grid grid-cols-8 gap-2",children:S.map((e,t)=>bn.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border relative group overflow-hidden",children:[bn.jsx("div",{className:"absolute top-0 left-0 w-full h-[2px] bg-accent-primary/20 group-hover:bg-accent-primary/50 transition-colors"}),bn.jsxs("span",{className:"text-[8px] font-mono text-text-muted mb-1 flex items-center gap-1",children:[bn.jsx(on,{size:8})," K",t+1," (CC ",e.cc,")"]}),bn.jsx("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label})]},t))})]}),bn.jsxs("div",{className:"bg-dark-bgSecondary border-t border-dark-border flex items-center justify-between px-4 py-1.5 text-xs font-mono",children:[bn.jsxs("div",{className:"flex items-center gap-4",children:[bn.jsxs("span",{className:"text-text-secondary",children:["Row ",bn.jsx("span",{className:"text-accent-primary font-semibold",children:g})]}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"}),bn.jsx("span",{className:"text-text-secondary",children:v}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"}),bn.jsx("span",{className:"text-text-secondary capitalize",children:t.columnType}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"}),bn.jsxs("span",{className:"text-text-secondary",children:["Oct ",bn.jsx("span",{className:"text-accent-primary font-semibold",children:n})]}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"}),bn.jsxs("span",{className:"text-text-secondary",title:a?"Insert mode: new data shifts rows down":"Overwrite mode: new data replaces existing",children:["Mode: ",bn.jsx("span",{className:a?"text-accent-warning":"text-accent-primary",children:a?"INS":"OVR"})]}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"}),bn.jsx("span",{className:"px-2 py-0.5 rounded "+(s?"bg-accent-error/20 text-accent-error":"text-text-muted"),children:s?"REC":"EDIT"})]}),bn.jsxs("div",{className:"flex items-center gap-4",children:[b&&bn.jsxs(bn.Fragment,{children:[bn.jsxs("button",{onClick:()=>f(!m),className:"flex items-center gap-1.5 text-[10px] text-text-muted hover:text-accent-primary transition-colors",title:m?"Hide MIDI controls":"Show MIDI controls",children:[bn.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"}),bn.jsx("span",{className:"font-bold uppercase",children:w}),m?bn.jsx(Ce,{size:12}):bn.jsx(kt,{size:12})]}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),e&&bn.jsxs(bn.Fragment,{children:[bn.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-accent-warning/10 text-accent-warning hover:bg-accent-warning/20 transition-colors",title:"Tip of the Day",children:[bn.jsx(ln,{size:12}),bn.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Tips"})]}),bn.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),bn.jsxs("span",{className:"flex items-center gap-1.5 "+("running"===l?"text-accent-success":"text-text-muted"),children:[bn.jsx("span",{className:"w-2 h-2 rounded-full "+("running"===l?"bg-accent-success":"bg-text-muted")}),"running"===l?"Audio Active":"Audio Off"]})]})]})]})});const _P="devilbox-project";function OP(){try{const e=cm.getState(),t=Df.getState(),n=Hf.getState(),a=Gf.getState(),s=Wf.getState(),r=Kf.getState(),o={version:"1.0.0",savedAt:(new Date).toISOString(),metadata:n.metadata,bpm:a.bpm,patterns:e.patterns,patternOrder:e.patternOrder,instruments:t.instruments.map(e=>{if(e.metadata?.preservedSynth&&e.sample?.url?.startsWith("blob:")){const t={...e};return t.sample={...e.sample,url:""},t}return e}),automation:s.curves,masterEffects:r.masterEffects,..."straight"!==a.grooveTemplateId?{grooveTemplateId:a.grooveTemplateId}:{}};return o.instruments.filter(e=>"MOD"===e.metadata?.importedFrom||"XM"===e.metadata?.importedFrom).length,localStorage.setItem(_P,JSON.stringify(o)),n.markAsSaved(),!0}catch(e){return!1}}function FP(){try{const e=localStorage.getItem(_P);if(!e)return!1;const t=JSON.parse(e);if(!t.version||!t.patterns||!t.instruments)return!1;if(Ef(t.patterns,t.instruments)){const e=Pf(t.patterns,t.instruments);t.patterns=e.patterns,t.instruments=e.instruments}const n=cm.getState(),a=Df.getState(),s=Hf.getState(),r=Gf.getState(),o=Wf.getState(),i=Kf.getState();return n.loadPatterns(t.patterns),t.patternOrder&&t.patternOrder.length>0&&n.setPatternOrder(t.patternOrder),a.loadInstruments(t.instruments),s.setMetadata(t.metadata),r.setBPM(t.bpm),t.automation&&o.loadCurves(t.automation),t.masterEffects&&i.setMasterEffects(t.masterEffects),r.setGrooveTemplate(t.grooveTemplateId||"straight"),a.autoBakeInstruments(),s.markAsSaved(),!0}catch(e){return!1}}function DP(){try{return null!==localStorage.getItem(_P)}catch{return!1}}function RP(){try{localStorage.removeItem(_P)}catch(e){}}const jP={success:bn.jsx(dn,{size:18}),error:bn.jsx(De,{size:18}),warning:bn.jsx(cn,{size:18}),info:bn.jsx(It,{size:18})},LP={success:"text-accent-success border-accent-success/30 bg-accent-success/10",error:"text-accent-error border-accent-error/30 bg-accent-error/10",warning:"text-accent-warning border-accent-warning/30 bg-accent-warning/10",info:"text-accent-primary border-accent-primary/30 bg-accent-primary/10"},BP=()=>{const{notifications:e,removeNotification:t}=oy();return 0===e.length?null:bn.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:e.map(e=>bn.jsxs("div",{className:`\n            flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg\n            animate-slide-in-right\n            ${LP[e.type]}\n          `,role:"alert",children:[bn.jsx("span",{className:"flex-shrink-0 mt-0.5",children:jP[e.type]}),bn.jsx("p",{className:"flex-1 text-sm font-medium text-text-primary",children:e.message}),bn.jsx("button",{onClick:()=>t(e.id),className:"flex-shrink-0 p-0.5 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss notification",children:bn.jsx(Te,{size:14,className:"text-text-muted"})})]},e.id))})},VP=({onRefresh:e,onDismiss:t,currentVersion:n,latestVersion:a})=>bn.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[60] max-w-md w-full px-4",children:bn.jsxs("div",{className:"\n          flex items-center gap-3 px-4 py-3 rounded-lg border shadow-2xl\n          bg-accent-primary/20 border-accent-primary/40 backdrop-blur-sm\n          animate-slide-in-top\n        ",role:"alert",children:[bn.jsx(Mt,{size:20,className:"text-accent-primary flex-shrink-0 animate-pulse"}),bn.jsxs("div",{className:"flex-1 min-w-0",children:[bn.jsx("p",{className:"text-sm font-semibold text-text-primary mb-1",children:"Update Available"}),bn.jsxs("p",{className:"text-xs text-text-muted",children:["Version ",a," is now available (current: ",n,")"]})]}),bn.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[bn.jsx(jv,{onClick:e,className:"px-3 py-1.5 text-xs bg-accent-primary hover:bg-accent-primary/80 text-white font-medium rounded",children:"Refresh"}),bn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss update notification",children:bn.jsx(Te,{size:16,className:"text-text-muted"})})]})]})}),zP=()=>{const{activeError:e,dismissError:t,copyToClipboard:n,getDebugString:a}=Jr(),[r,o]=s.useState(!1),[i,l]=s.useState(!1);if(!e)return null;const c=()=>{t(e.id),o(!1),l(!1)};return bn.jsxs(lx,{isOpen:!0,onClose:c,size:"lg",closeOnBackdropClick:!1,closeOnEscape:!0,children:[bn.jsx(cx,{title:"Synth Error",subtitle:{init:"Initialization Error",wasm:"WASM Engine Error",runtime:"Runtime Error",audio:"Audio Context Error"}[e.errorType],icon:bn.jsx(cn,{className:"w-6 h-6 text-red-500"})}),bn.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[bn.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4",children:bn.jsx("div",{className:"flex items-start gap-3",children:bn.jsxs("div",{className:"flex-1",children:[bn.jsxs("p",{className:"font-mono text-sm text-red-300",children:[bn.jsx("span",{className:"text-red-400 font-bold",children:e.synthType}),e.synthName&&bn.jsxs("span",{className:"text-red-300/70",children:[" (",e.synthName,")"]})]}),bn.jsx("p",{className:"mt-2 text-white",children:e.message})]})})}),bn.jsxs("button",{onClick:()=>l(!i),className:"flex items-center gap-2 text-sm text-dark-text-secondary hover:text-white transition-colors",children:[i?bn.jsx(kt,{size:16}):bn.jsx(Ce,{size:16}),i?"Hide":"Show"," Debug Details"]}),i&&bn.jsxs("div",{className:"bg-dark-surface rounded-lg p-4 space-y-3",children:[bn.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary",children:"Timestamp:"}),bn.jsx("p",{className:"font-mono text-xs",children:e.debugData.timestamp})]}),bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary",children:"AudioContext:"}),bn.jsx("p",{className:"font-mono text-xs",children:e.debugData.audioContextState})]}),bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary",children:"WASM Supported:"}),bn.jsx("p",{className:"font-mono text-xs",children:e.debugData.wasmSupported?"Yes":"No"})]}),bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary",children:"Error Type:"}),bn.jsx("p",{className:"font-mono text-xs",children:e.errorType})]})]}),e.stack&&bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Stack Trace:"}),bn.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-red-300 overflow-x-auto max-h-32 overflow-y-auto",children:e.stack})]}),bn.jsxs("div",{children:[bn.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Full Debug Report:"}),bn.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-dark-text-secondary overflow-x-auto max-h-40 overflow-y-auto whitespace-pre-wrap",children:a(e)})]})]}),bn.jsx("p",{className:"text-sm text-dark-text-secondary",children:"This synth failed to initialize properly. Please copy the debug information and report this issue. The synth will not be available until the error is resolved."})]}),bn.jsx(dx,{children:bn.jsxs("div",{className:"flex justify-between w-full",children:[bn.jsx("button",{onClick:async()=>{await n(e)&&(o(!0),setTimeout(()=>o(!1),2e3))},className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:r?bn.jsxs(bn.Fragment,{children:[bn.jsx(je,{size:16,className:"text-green-500"}),bn.jsx("span",{className:"text-green-500",children:"Copied!"})]}):bn.jsxs(bn.Fragment,{children:[bn.jsx(qe,{size:16}),bn.jsx("span",{children:"Copy Debug Info"})]})}),bn.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition-colors",children:[bn.jsx(Te,{size:16}),bn.jsx("span",{children:"Dismiss"})]})]})})]})};const UP=[".dbx",".dbi",".xml",".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx",".mid",".midi",".wav",".mp3",".ogg",".flac",".aiff",".aif"];const GP=({onFileLoaded:e,children:t})=>{const[n,a]=s.useState(!1),[r,o]=s.useState(0),i=s.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),o(e=>e+1),e.dataTransfer.items&&e.dataTransfer.items.length>0){Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&a(!0)}},[]),l=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),o(e=>{const t=e-1;return 0===t&&a(!1),t})},[]),c=s.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),d=s.useCallback(async t=>{t.preventDefault(),t.stopPropagation(),a(!1),o(0);const n=Array.from(t.dataTransfer.files);if(0===n.length)return;const s=n.find(e=>function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return UP.includes(t)}(e.name));if(s)try{await e(s)}catch(r){}},[e]);return bn.jsxs("div",{onDragEnter:i,onDragLeave:l,onDragOver:c,onDrop:d,className:"relative w-full h-full",children:[t,n&&bn.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center pointer-events-none animate-fade-in",children:bn.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary border-dashed rounded-xl p-12 flex flex-col items-center gap-4 shadow-2xl",children:[bn.jsx(Pt,{size:64,className:"text-accent-primary animate-bounce"}),bn.jsxs("div",{className:"text-center",children:[bn.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"}),bn.jsx("p",{className:"text-text-muted text-sm",children:"Supports .dbx, .dbi, .xml, .mod, .xm, .it, .s3m, .fur, .mid, and more"})]})]})})]})},KP=s.lazy(()=>Pn(()=>import("./HelpModal-Ds6ippU1.js"),__vite__mapDeps([5,2,3,4,1])).then(e=>({default:e.HelpModal}))),HP=s.lazy(()=>Pn(()=>import("./ExportDialog-DzKQkHPU.js"),__vite__mapDeps([6,2,3,1,4])).then(e=>({default:e.ExportDialog}))),WP=s.lazy(()=>Pn(()=>import("./EditInstrumentModal-Ca4JjPkb.js"),__vite__mapDeps([7,2,3,4,1,8])).then(e=>({default:e.EditInstrumentModal}))),$P=s.lazy(()=>Pn(()=>import("./index-CCgYOEo1.js"),__vite__mapDeps([9,2,3,8,4,1])).then(e=>({default:e.MasterEffectsModal}))),qP=s.lazy(()=>Pn(()=>import("./index-CCgYOEo1.js"),__vite__mapDeps([9,2,3,8,4,1])).then(e=>({default:e.InstrumentEffectsModal}))),YP=s.lazy(()=>Pn(()=>import("./index-CCgYOEo1.js"),__vite__mapDeps([9,2,3,8,4,1])).then(e=>({default:e.EffectParameterEditor}))),XP=s.lazy(()=>Pn(()=>import("./TD3PatternDialog-CMFEggM-.js"),__vite__mapDeps([10,2,3,4,1])).then(e=>({default:e.TD3PatternDialog}))),QP=s.lazy(()=>Pn(()=>import("./DrumpadEditorModal-cNxoSLd5.js"),__vite__mapDeps([11,2,3,4,1])).then(e=>({default:e.DrumpadEditorModal}))),ZP=s.lazy(()=>Pn(()=>import("./TipOfTheDay-CXMJTuSK.js"),__vite__mapDeps([12,2,3,4,1])).then(e=>({default:e.TipOfTheDay}))),JP=s.lazy(()=>Pn(()=>import("./PatternManagement-CS7XqpRQ.js"),__vite__mapDeps([13,2,3,8,4,1])).then(e=>({default:e.PatternManagement}))),eT=s.lazy(()=>Pn(()=>import("./SamplePackBrowser-DSApFmEk.js"),__vite__mapDeps([14,2,3,1,4])).then(e=>({default:e.SamplePackBrowser})));function tT(){const{updateAvailable:e,latestVersion:t,currentVersion:n,refresh:a}=function(e=3e5){const[t,n]=s.useState(!1),[a,r]=s.useState(null),o=async()=>{try{const e=`/DEViLBOX/version.json?t=${Date.now()}`,t=await fetch(e,{cache:"no-cache"});if(!t.ok)return;const a=await t.json();r(a),a.buildHash!==Pg&&n(!0)}catch(e){}};return s.useEffect(()=>{o();const t=setInterval(o,e);return()=>clearInterval(t)},[e]),{updateAvailable:t,latestVersion:a,currentVersion:{buildNumber:Eg,buildHash:Pg},refresh:()=>{window.location.reload()}}}(),[r,o]=s.useState(!1),{initialized:i,contextState:l,setInitialized:c,setContextState:d,setToneEngineInstance:u,setAnalyserNode:p,setFFTNode:h}=Kf(On(e=>({initialized:e.initialized,contextState:e.contextState,setInitialized:e.setInitialized,setContextState:e.setContextState,setToneEngineInstance:e.setToneEngineInstance,setAnalyserNode:e.setAnalyserNode,setFFTNode:e.setFFTNode}))),{showSamplePackModal:m,setShowSamplePackModal:f,applyAutoCompact:y}=jf(),[g,v]=s.useState(null),[x,w]=s.useState(!1),[k,S]=s.useState(!1),[M,N]=s.useState(!1),[C,E]=s.useState(!1),[P,T]=s.useState(!1),[A,I]=s.useState(!1),[_,O]=s.useState(!1),[F,D]=s.useState(!1),[R,j]=s.useState("tips"),[L,B]=s.useState(null),[V,z]=s.useState(!1),[U,G]=s.useState(null),[K,H]=s.useState(!1),{showPatternDialog:W,closePatternDialog:$,showKnobBar:q,setShowKnobBar:Y}=Ny();s.useEffect(()=>{const e=localStorage.getItem("devilbox-seen-version"),t="false"!==localStorage.getItem("show-tips-at-startup");e!==n.buildNumber?(j("changelog"),D(!0)):t&&(j("tips"),D(!0))},[n.buildNumber]),function(){const{isPlaying:e,togglePlayPause:t,stop:n}=Gf(),{currentPatternIndex:a,patterns:r,setCurrentPattern:o,currentOctave:i,setCurrentOctave:l,cursor:c,moveCursorToChannel:d}=cm();s.useEffect(()=>{const e=hy();e.init();const s=[];return s.push(e.registerAction("transport.play",()=>{t()})),s.push(e.registerAction("transport.stop",()=>{n()})),s.push(e.registerAction("transport.playFromStart",()=>{n(),setTimeout(()=>t(),50)})),s.push(e.registerAction("pattern.next",()=>{a<r.length-1&&o(a+1)})),s.push(e.registerAction("pattern.previous",()=>{a>0&&o(a-1)})),s.push(e.registerAction("pattern.first",()=>{o(0)})),s.push(e.registerAction("pattern.last",()=>{o(r.length-1)})),s.push(e.registerAction("octave.up",()=>{i<8&&l(i+1)})),s.push(e.registerAction("octave.down",()=>{i>0&&l(i-1)})),s.push(e.registerAction("channel.next",()=>{const e=r[a];e&&c.channelIndex<e.channels.length-1&&d(c.channelIndex+1)})),s.push(e.registerAction("channel.previous",()=>{c.channelIndex>0&&d(c.channelIndex-1)})),()=>{s.forEach(e=>e())}},[e,t,n,a,r,o,i,l,c,d])}(),function(){const e=s.useCallback(e=>{const{patterns:t,currentPatternIndex:n,setCurrentPattern:a,currentOctave:s,setCurrentOctave:r}=cm.getState(),{isPlaying:o,isLooping:i,play:l,stop:c,pause:d,setIsLooping:u,currentRow:p,setCurrentRow:h}=Gf.getState(),{currentInstrumentId:m,setCurrentInstrument:f,instruments:y}=Df.getState(),{undo:g,redo:v}=$f.getState();switch(e){case"transport.play":o||l();break;case"transport.stop":c();break;case"transport.pause":d();break;case"transport.loop":u(!i);break;case"nav.patternUp":n<t.length-1&&a(n+1);break;case"nav.patternDown":n>0&&a(n-1);break;case"nav.rowUp":p>0&&h(p-1);break;case"nav.rowDown":const e=t[n];e&&p<e.length-1&&h(p+1);break;case"nav.toStart":h(0);break;case"nav.toEnd":const b=t[n];b&&h(b.length-1);break;case"edit.octaveUp":s<8&&r(s+1);break;case"edit.octaveDown":s>0&&r(s-1);break;case"edit.instrumentUp":if(null!==m){const e=m+1;y.some(t=>t.id===e)&&f(e)}break;case"edit.instrumentDown":if(null!==m&&m>1){const e=m-1;y.some(t=>t.id===e)&&f(e)}break;case"edit.undo":g();break;case"edit.redo":v()}},[]),t=s.useCallback((e,t)=>{const{instruments:n}=Df.getState(),a=em(),s=uy().getControlledInstrument();let r=n.filter(e=>("TB303"===e.synthType||"Buzz3o3"===e.synthType)&&e.tb303);if(null!==s){const e=n.find(e=>e.id===s);if(e&&e.tb303)r=[e];else if(e)return}0!==r.length&&r.forEach(n=>{if(!n.tb303)return;const s=JSON.parse(JSON.stringify(n.tb303));switch(e){case"cutoff":s.filter&&(s.filter.cutoff=t);break;case"resonance":s.filter&&(s.filter.resonance=t);break;case"envMod":s.filterEnvelope&&(s.filterEnvelope.envMod=t);break;case"decay":s.filterEnvelope&&(s.filterEnvelope.decay=t);break;case"accent":s.accent&&(s.accent.amount=t);break;case"slideTime":s.slide&&(s.slide.time=t);break;case"overdrive":s.overdrive&&(s.overdrive.amount=t);break;case"normalDecay":s.devilFish&&(s.devilFish.normalDecay=t);break;case"accentDecay":s.devilFish&&(s.devilFish.accentDecay=t);break;case"softAttack":s.devilFish&&(s.devilFish.softAttack=t);break;case"vegSustain":s.devilFish&&(s.devilFish.vegSustain=t);break;case"filterFM":s.devilFish&&(s.devilFish.filterFM=t);break;case"filterTracking":s.devilFish&&(s.devilFish.filterTracking=t)}a.updateTB303Parameters(n.id,s)})},[]),n=s.useCallback((n,a,s)=>{if(a.startsWith("transport.")||a.startsWith("nav.")||a.startsWith("edit.")||a.startsWith("channel.")||a.startsWith("pattern.")||a.startsWith("view."))s>64&&e(a);else if(a.startsWith("tb303.")){const e=a.replace("tb303.","");return void t(e,s)}},[e,t]);s.useEffect(()=>uy().onParameterChange(n),[n])}(),s.useEffect(()=>{const e=fy(),t=Jh.getInstance();e.init();const n=(e,n)=>{const a=Df.getState().instruments.find(t=>t.id===e.targetInstrumentId);if(!a)return;const s=e.targetNote??60,r=b(s,"midi").toNote(),o=2===r.length?r.charAt(0)+"-"+r.charAt(1):r,i=n/127;if(n>0){t.triggerPolyNoteAttack(a.id,r,i,{...a,isLive:!0});const e=cm.getState(),n=Gf.getState();if(e.recordMode){const t=n.isPlaying?n.currentRow:e.cursor.rowIndex;let s=e.cursor.channelIndex;e.multiRecEnabled&&n.isPlaying&&(s=e.findBestChannel());const r=Ba(o);if(e.setCell(s,t,{note:r,instrument:a.id}),!n.isPlaying&&e.editStep>0){const n=e.patterns[e.currentPatternIndex];if(n){const a=(t+e.editStep)%n.length;e.moveCursorToRow(a)}}}}else{t.triggerPolyNoteRelease(a.id,r,{...a,isLive:!0});const e=cm.getState(),n=Gf.getState();e.recordMode&&n.isPlaying&&e.recReleaseEnabled}},a=e.onTrigger(n),s=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const a=Ny.getState();if("NumpadEnter"===t.code||"Enter"===t.key&&3===t.location)return t.preventDefault(),void a.togglePadBank();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===a.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&n(r,127)}},r=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const a=Ny.getState();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===a.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&n(r,0)}};return window.addEventListener("keydown",s),window.addEventListener("keyup",r),()=>{a(),window.removeEventListener("keydown",s),window.removeEventListener("keyup",r)}},[]),s.useEffect(()=>{(async()=>{try{const{connectToNKSPairedDevice:e}=await Pn(async()=>{const{connectToNKSPairedDevice:e}=await Promise.resolve().then(()=>Pv);return{connectToNKSPairedDevice:e}},void 0);await e()}catch(e){}})()},[]);const{updateMasterEffect:X}=Kf();s.useEffect(()=>{y()},[y]);const{save:Q}=function(){const{isDirty:e,markAsModified:t}=Hf(),n=s.useRef(null),a=s.useRef(!1),r=s.useRef(!0);s.useEffect(()=>{!a.current&&DP()&&(a.current=!0,FP())},[]),s.useEffect(()=>cm.subscribe((e,n)=>{r.current?r.current=!1:e.patterns!==n.patterns&&t()}),[t]),s.useEffect(()=>Df.subscribe((e,n)=>{e.instruments!==n.instruments&&t()}),[t]),s.useEffect(()=>Gf.subscribe((e,n)=>{e.bpm===n.bpm&&e.grooveTemplateId===n.grooveTemplateId||t()}),[t]);const o=s.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e&&OP()},3e4)},[e]);return s.useEffect(()=>(e&&o(),()=>{n.current&&clearTimeout(n.current)}),[e,o]),s.useEffect(()=>{const t=t=>{e&&(OP(),t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),{save:s.useCallback(()=>OP(),[]),load:s.useCallback(()=>FP(),[]),hasSaved:DP(),clear:RP,isDirty:e}}();s.useEffect(()=>{(async()=>{try{const e=em();u(e),p(e.analyser),h(e.fft),d(e.getContextState()),c(!0)}catch(e){v(e instanceof Error?e.message:"Unknown error")}})()},[]);const{undo:Z,redo:J,canUndo:ee,canRedo:te}=$f(),{replacePattern:ne,currentPatternIndex:ae}=cm(),se=s.useCallback(()=>{if(!ee())return;const e=Z();e&&ne(ae,e)},[Z,ee,ne,ae]),re=s.useCallback(()=>{if(!te())return;const e=J();e&&ne(ae,e)},[J,te,ne,ae]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey)return e.preventDefault(),void se();if((e.ctrlKey||e.metaKey)&&"z"===e.key&&e.shiftKey||(e.ctrlKey||e.metaKey)&&"y"===e.key)return e.preventDefault(),void re();if((e.ctrlKey||e.metaKey)&&"s"===e.key)return e.preventDefault(),void Q();if("Escape"===e.key)return e.preventDefault(),void(k?S(!1):M?N(!1):C&&E(!1));if(e.shiftKey&&"?"===e.key)return e.preventDefault(),void S(!0);if(e.ctrlKey&&e.shiftKey&&"E"===e.key)return e.preventDefault(),void N(!0);if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return e.preventDefault(),void E(!C);if((e.ctrlKey||e.metaKey)&&"k"===e.key)return e.preventDefault(),void Y(!q);if((e.ctrlKey||e.metaKey)&&"i"===e.key&&!e.shiftKey)return e.preventDefault(),void z(!V);if((e.ctrlKey||e.metaKey)&&"m"===e.key&&!e.shiftKey)return e.preventDefault(),void T(!P);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key)return e.preventDefault(),void I(!A);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key)return e.preventDefault(),void Kf.getState().toggleMasterMute();if(!("l"!==e.key&&"L"!==e.key||e.ctrlKey||e.metaKey||e.altKey))return e.preventDefault(),void Ey.getState().toggleLiveMode();const t=parseInt(e.key);if(!isNaN(t)&&t>=1&&t<=9){const n=Ey.getState();if(n.isLiveMode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();const a=t-1;return void(a<cm.getState().patterns.length&&n.queuePattern(a))}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[C,k,M,V,P,A,se,re,Q]);s.useEffect(()=>{const e=async()=>{if("running"!==l)try{const e=em();await e.init(),d(e.getContextState())}catch(t){}window.removeEventListener("click",e),window.removeEventListener("keydown",e)};return window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[l,d]);const oe=s.useCallback(async e=>{const{loadPatterns:t,setPatternOrder:n}=cm.getState(),{loadInstruments:a}=Df.getState(),{setBPM:s,setGrooveTemplate:r}=Gf.getState(),{setMetadata:o}=Hf.getState();try{const i=e.name.toLowerCase();if(i.endsWith(".mid")||i.endsWith(".midi")){const n=await PE(e,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});t(n.patterns);a(n.patterns.map((e,t)=>({id:t+1,name:`Track ${t+1}`,type:"synth",synthType:"Synth",effects:[],volume:-6,pan:0}))),o({name:n.metadata.name,author:"",description:`Imported from ${e.name} (${n.metadata.tracks} tracks)`}),s(n.bpm),iy.success(`Loaded MIDI: ${n.metadata.name}`)}else if(i.match(/\.(mod|xm|it|s3m|fur|mptm|669|amf|ams|dbm|dmf|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/)){const t=await lM(e);t?iy.success(`Loaded module: ${t.metadata.title||e.name}`,3e3):iy.error(`Failed to load module: ${e.name}`)}else if(i.endsWith(".dbx")){const i=await e.text(),l=JSON.parse(i),{needsMigration:c,migrateProject:d}=await Pn(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Tf);return{needsMigration:e,migrateProject:t}},void 0);let u=l.patterns,p=l.instruments;if(c(u,p)){const e=d(u,p);u=e.patterns,p=e.instruments}if(t(u),l.sequence&&Array.isArray(l.sequence)){const e=new Map(u.map((e,t)=>[e.id,t])),t=l.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&n(t)}p&&a(p),l.masterEffects&&Kf.getState().setMasterEffects(l.masterEffects),s(l.bpm),o(l.metadata),r(l.grooveTemplateId||"straight"),iy.success(`Loaded: ${l.metadata?.name||e.name}`)}}catch(i){iy.error(`Failed to load ${e.name}`)}},[]),ie=s.useCallback(async e=>{const{addInstrument:t}=Df.getState();try{const n=e.name.toLowerCase();if(n.match(/\.(dbx|mid|midi|mod|xm|it|s3m|fur|mptm|669|amf|ams|dbm|dmf|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))return G(e),void H(!0);if(n.endsWith(".dbi")){const n=await SC(e);n?.instrument?(t(n.instrument),iy.success(`Loaded instrument: ${n.instrument.name||"Untitled"}`)):iy.error(`Failed to load instrument: ${e.name}`)}else n.endsWith(".xml")?iy.info(`XML file detected: ${e.name}. Use Load button for pattern/preset import.`):n.match(/\.(wav|mp3|ogg|flac|aiff|aif)$/)?(iy.info(`Audio sample: ${e.name}. Opening instrument editor...`),z(!0)):iy.warning(`Unsupported file format: ${e.name}`)}catch(n){iy.error(`Failed to handle ${e.name}`)}},[]),le=async()=>{try{const e=em();await e.init(),d(e.getContextState()),w(!1)}catch(e){v(e instanceof Error?e.message:"Unknown error")}};return g?bn.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:bn.jsxs("div",{className:"panel p-8 max-w-md",children:[bn.jsx("h2",{className:"text-xl font-bold text-accent-error mb-4",children:"Audio Initialization Error"}),bn.jsx("p",{className:"text-text-secondary mb-4",children:g}),bn.jsx(jv,{variant:"primary",onClick:()=>window.location.reload(),children:"Reload Application"})]})}):i?x&&"running"!==l?bn.jsx(Gv,{children:bn.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:bn.jsxs("div",{className:"text-center max-w-2xl",children:[bn.jsxs("div",{className:"mb-8",children:[bn.jsx("h1",{className:"text-5xl font-bold text-text-primary mb-2 tracking-tight",children:"DEViLBOX"}),bn.jsx("p",{className:"text-lg text-text-secondary",children:"TB-303 Acid Tracker with Devil Fish Mod"})]}),bn.jsx(jv,{variant:"primary",size:"lg",onClick:le,icon:bn.jsx(Oe,{size:20}),className:"shadow-glow animate-pulse-glow",children:"Start Audio Engine"}),bn.jsxs("div",{className:"mt-12 grid grid-cols-2 gap-4 text-left",children:[bn.jsxs("div",{className:"card p-4",children:[bn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[bn.jsx("div",{className:"p-2 rounded-md bg-accent-primary/20 text-accent-primary",children:bn.jsx(_e,{size:18})}),bn.jsx("h3",{className:"font-semibold text-text-primary",children:"22 Synth Engines"})]}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"Including authentic TB-303 with accent and slide"})]}),bn.jsxs("div",{className:"card p-4",children:[bn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[bn.jsx("div",{className:"p-2 rounded-md bg-accent-secondary/20 text-accent-secondary",children:bn.jsx(sn,{size:18})}),bn.jsx("h3",{className:"font-semibold text-text-primary",children:"Pattern Editor"})]}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"4-16 channels with FT2-style keyboard layout"})]}),bn.jsxs("div",{className:"card p-4",children:[bn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[bn.jsx("div",{className:"p-2 rounded-md bg-accent-warning/20 text-accent-warning",children:bn.jsx(Ie,{size:18})}),bn.jsx("h3",{className:"font-semibold text-text-primary",children:"Automation"})]}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"Real-time parameter curves for filter sweeps"})]}),bn.jsxs("div",{className:"card p-4",children:[bn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[bn.jsx("div",{className:"p-2 rounded-md bg-accent-success/20 text-accent-success",children:bn.jsx(Ke,{size:18})}),bn.jsx("h3",{className:"font-semibold text-text-primary",children:"36+ Presets"})]}),bn.jsx("p",{className:"text-sm text-text-secondary",children:"Factory sounds for instant acid basslines"})]})]}),bn.jsxs("p",{className:"mt-8 text-sm text-text-muted",children:["Press ",bn.jsx("kbd",{className:"px-2 py-0.5 rounded bg-dark-bgTertiary border border-dark-border text-text-secondary",children:"?"})," anytime for help"]})]})})}):bn.jsx(GP,{onFileLoaded:ie,children:bn.jsxs(Gv,{children:[bn.jsxs("div",{className:"flex flex-col flex-1 min-h-0 min-w-0 overflow-y-hidden",children:[bn.jsx("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-y-hidden",children:bn.jsxs("div",{className:"flex flex-col min-h-0 min-w-0 flex-1",children:[C&&bn.jsx("div",{className:"h-48 border-b border-dark-border animate-fade-in",children:bn.jsx(s.Suspense,{fallback:bn.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"Loading patterns..."}),children:bn.jsx(JP,{})})}),bn.jsx("div",{className:"flex-1 min-h-0 min-w-0 flex flex-col",children:bn.jsx(AP,{onShowPatterns:()=>E(!C),onShowExport:()=>N(!0),onShowHelp:()=>S(!0),onShowMasterFX:()=>T(!P),onShowInstrumentFX:()=>I(!A),onShowInstruments:()=>z(!0),onShowDrumpads:()=>O(!0),showPatterns:C,showMasterFX:P,showInstrumentFX:A})})]})}),bn.jsx(IP,{onShowTips:()=>D(!0)})]}),bn.jsxs(s.Suspense,{fallback:null,children:[k&&bn.jsx(KP,{isOpen:k,onClose:()=>S(!1)}),M&&bn.jsx(HP,{isOpen:M,onClose:()=>N(!1)}),V&&bn.jsx(WP,{isOpen:V,onClose:()=>z(!1)}),P&&bn.jsx($P,{isOpen:P,onClose:()=>T(!1)}),A&&bn.jsx(qP,{isOpen:A,onClose:()=>I(!1)}),W&&bn.jsx(XP,{isOpen:W,onClose:$}),_&&bn.jsx(QP,{isOpen:_,onClose:()=>O(!1)}),m&&bn.jsx(eT,{onClose:()=>f(!1)}),F&&bn.jsx(ZP,{isOpen:F,onClose:()=>D(!1),initialTab:R}),L&&bn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:bn.jsx("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:bn.jsx(YP,{effect:L.effect,onUpdateParameter:(e,t)=>{if(!L)return;const n={...L.effect.parameters,[e]:t};X(L.effect.id,{parameters:n}),B({...L,effect:{...L.effect,parameters:n}})},onUpdateWet:e=>{L&&(X(L.effect.id,{wet:e}),B({...L,effect:{...L.effect,wet:e}}))},onClose:()=>B(null)})})}),K&&U&&bn.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:bn.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md mx-4 animate-slide-in-up shadow-2xl",children:[bn.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Load Song File?"}),bn.jsxs("p",{className:"text-text-secondary mb-6",children:["Loading ",bn.jsx("span",{className:"text-accent-primary font-mono",children:U.name})," will replace your current project."]}),bn.jsx("p",{className:"text-text-muted text-sm mb-6",children:"Make sure you've saved any unsaved changes before continuing."}),bn.jsxs("div",{className:"flex gap-3 justify-end",children:[bn.jsx(jv,{variant:"ghost",onClick:()=>{H(!1),G(null)},children:"Cancel"}),bn.jsx(jv,{variant:"primary",onClick:async()=>{U&&await oe(U),H(!1),G(null)},children:"Load File"})]})]})})]}),bn.jsx(BP,{}),bn.jsx(zP,{}),e&&!r&&bn.jsx(VP,{onRefresh:a,onDismiss:()=>o(!0),currentVersion:n.buildNumber,latestVersion:t?.buildNumber||"unknown"})]})}):bn.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:bn.jsx("div",{className:"panel p-8",children:bn.jsxs("div",{className:"flex items-center gap-3 text-accent-primary",children:[bn.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),bn.jsx("span",{children:"Initializing audio engine..."})]})})})}class nT extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:bn.jsx("div",{className:"min-h-screen bg-bg flex items-center justify-center p-4",children:bn.jsxs("div",{className:"max-w-lg w-full bg-bg-secondary rounded-lg border border-border p-6 text-center",children:[bn.jsx("div",{className:"text-6xl mb-4",children:""}),bn.jsx("h1",{className:"text-2xl font-bold text-text mb-2",children:"Something went wrong"}),bn.jsx("p",{className:"text-text-secondary mb-4",children:"DEViLBOX encountered an unexpected error. Your work may have been auto-saved."}),!1,bn.jsxs("div",{className:"flex gap-3 justify-center",children:[bn.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-bg-tertiary hover:bg-border rounded text-text transition-colors",children:"Try Again"}),bn.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 bg-accent hover:bg-accent-hover rounded text-white transition-colors",children:"Reload App"})]})]})}):this.props.children}}const aT=["ChiptuneModule","Player","Sampler","DrumKit"];async function sT(e){const t=KM[e],n={synthType:e,name:t?.name||e,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,loadTimeMs:0};if(aT.includes(e))return n.error="Skipped (requires external resources)",n;const a=performance.now();try{const t={id:999,name:`Test ${e}`,type:"synth",synthType:e,effects:[],volume:-12,pan:0},r=zh.createInstrument(t);if(n.loadTimeMs=performance.now()-a,!r)return n.error="createInstrument returned null",n;n.loaded=!0;const o=new fe("waveform",256);r.connect(o),o.toDestination();try{"triggerAttack"in r&&"function"==typeof r.triggerAttack?(r.triggerAttack("C4",x(),.8),n.noteOnWorked=!0):"triggerAttackRelease"in r&&"function"==typeof r.triggerAttackRelease&&(r.triggerAttackRelease("C4","8n",x(),.8),n.noteOnWorked=!0)}catch(s){n.error=`Note trigger error: ${s}`}await new Promise(e=>setTimeout(e,100));try{const e=o.getValue().some(e=>Math.abs(e)>.001);n.producedSound=e}catch(s){}try{"triggerRelease"in r&&"function"==typeof r.triggerRelease&&(r.triggerRelease("C4",x()),n.noteOffWorked=!0)}catch(s){}await new Promise(e=>setTimeout(e,50));try{r.disconnect(),o.disconnect(),"dispose"in r&&"function"==typeof r.dispose&&r.dispose(),o.dispose()}catch(s){}}catch(s){n.error=`${s}`,n.loadTimeMs=performance.now()-a}return n}async function rT(e={}){const{verbose:t=!0,filter:n,timeout:a=5e3}=e;await xe();const s=n?WM.filter(n):WM,r=[];for(const d of s){const e=await Promise.race([sT(d),new Promise(e=>setTimeout(()=>e({synthType:d,name:KM[d]?.name||d,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,error:"Timeout",loadTimeMs:a}),a))]);if(r.push(e),t){e.loaded&&e.producedSound}}const o=r.filter(e=>e.loaded&&e.noteOnWorked),i=r.filter(e=>!e.loaded&&!aT.includes(e.synthType)),l=r.filter(e=>aT.includes(e.synthType)),c={total:r.length,passed:o.length,failed:i.length,skipped:l.length,results:r,failedSynths:i.map(e=>e.synthType),passedSynths:o.map(e=>e.synthType),timestamp:(new Date).toISOString()};if(t){c.failedSynths.length>0&&c.failedSynths.forEach(e=>{r.find(t=>t.synthType===e)});const e=r.filter(e=>e.loaded&&!e.producedSound&&!aT.includes(e.synthType));e.length>0&&e.forEach(e=>{})}return c}"undefined"!=typeof window&&(window.testAllSynths=rT,window.testToneSynths=async function(){const e=["Synth","MonoSynth","DuoSynth","FMSynth","AMSynth","PluckSynth","MetalSynth","MembraneSynth","NoiseSynth","PolySynth"];return rT({filter:t=>e.includes(t)})},window.testCustomSynths=async function(){const e=["TB303","DubSiren","SpaceLaser","Synare","V2","Sam","Dexed","OBXd","SuperSaw","Organ","DrumMachine","ChipSynth","PWMSynth","WobbleBass","StringMachine","FormantSynth","GranularSynth","Wavetable"];return rT({filter:t=>e.includes(t)})},window.testFurnaceSynths=async function(){return rT({filter:e=>e.startsWith("Furnace"),timeout:1e4})},window.testBuzzmachineSynths=async function(){return rT({filter:e=>e.startsWith("Buzz")})},window.quickTestSynths=async function(){return rT({timeout:2e3})}),o(),Zh.subscribe(e=>{try{const t=Gf.getState().isPlaying;e.autoLatency&&!t||em().setAudioLatency(e.audioLatency)}catch(t){}});let oT=Gf.getState().isPlaying;Gf.subscribe(e=>{if(e.isPlaying!==oT){oT=e.isPlaying;try{const t=Zh.getState();if(t.autoLatency){const n=em();e.isPlaying?n.setAudioLatency(t.audioLatency):n.setAudioLatency("interactive")}}catch(t){}}}),window.addEventListener("error",e=>{}),window.addEventListener("unhandledrejection",e=>{}),Cn.createRoot(document.getElementById("root")).render(bn.jsx(s.StrictMode,{children:bn.jsx(nT,{children:bn.jsx(fb,{children:bn.jsx(tT,{})})})}));export{Wm as $,Ca as A,jv as B,Ma as C,Ia as D,ya as E,Kr as F,va as G,ma as H,da as I,ca as J,la as K,aa as L,lx as M,Vv as N,na as O,ha as P,pa as Q,ua as R,HM as S,Jh as T,Da as U,xa as V,ga as W,jE as X,ba as Y,Ov as Z,xi as _,Wr as a,Hm as a0,wi as a1,sy as a2,yi as a3,nr as a4,zn as a5,po as a6,or as a7,Na as a8,Ta as a9,zg as aA,vp as aB,Eg as aC,Ig as aD,Ag as aE,tb as aF,Ey as aG,Jv as aH,Qv as aI,Qn as aJ,Zn as aK,Dn as aL,ki as aM,eo as aN,ra as aa,sa as ab,wa as ac,ka as ad,bf as ae,Pa as af,Ea as ag,cr as ah,Zh as ai,ia as aj,WM as ak,KM as al,rP as am,mf as an,Fa as ao,Oa as ap,_a as aq,ob as ar,yy as as,Va as at,Ba as au,Ny as av,cy as aw,gC as ax,fy as ay,Fg as az,Df as b,Hf as c,Gf as d,Wf as e,Kf as f,em as g,MC as h,SC as i,bn as j,kC as k,wC as l,xC as m,iy as n,bC as o,vC as p,Cg as q,cx as r,dx as s,Ng as t,cm as u,pf as v,$M as w,Ha as x,Cy as y,Aa as z};
