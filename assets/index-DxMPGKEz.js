const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BuzzmachineSynth-BZ2o_Ut7.js","assets/vendor-utils-Cm-70yv0.js","assets/vendor-react-LeNVipsj.js","assets/vendor-tone-MhHxAwwC.js","assets/vendor-ui-C64XGON6.js","assets/instrumentFactory-yThb9Tjn.js","assets/TD3PatternTranslator-BjkPGM14.js","assets/HelpModal-D2qKXot6.js","assets/ExportDialog-DnUR5P5S.js","assets/EditInstrumentModal-CBV1UQnt.js","assets/sortable.esm-lxC05b89.js","assets/index-DdWT8iC5.js","assets/TD3PatternDialog-tuexvlDs.js","assets/TD3PatternLoader-C1bZAG-1.js","assets/DrumpadEditorModal-CWHBekV5.js","assets/TipOfTheDay-BGHy40vt.js","assets/PatternManagement-y3rDGB0F.js","assets/SamplePackBrowser-hod1PL00.js"])))=>i.map(i=>d[i]);
import{R as e,p as t,a as n,c as a,r as s,b as r,e as o}from"./vendor-utils-Cm-70yv0.js";import{r as i,a as l,g as c,b as d}from"./vendor-react-LeNVipsj.js";import{T as u,G as p,W as h,F as m,E as f,D as y,R as g,a as v,L as b,c as x,P as w,g as k,C as S,M,b as N,d as C,e as E,V as P,f as T,O as A,S as _,h as I,N as D,A as O,i as F,j as R,J as j,k as L,l as B,m as V,n as z,B as U,o as G,p as W,q as K,r as H,s as $,t as q,u as Y,v as X,w as Q,x as Z,y as J,z as ee,H as te,I as ne,K as ae,Q as se,U as re,X as oe,Y as ie,Z as le,_ as ce,$ as de,a0 as ue,a1 as pe,a2 as he,a3 as me,a4 as fe,a5 as ye,a6 as ge,a7 as ve,a8 as be,a9 as xe,aa as we,ab as ke,ac as Se}from"./vendor-tone-MhHxAwwC.js";import{C as Me,U as Ne,a as Ce,X as Ee,R as Pe,S as Te,M as Ae,Z as _e,b as Ie,c as De,d as Oe,e as Fe,T as Re,f as je,L as Le,g as Be,A as Ve,h as ze,D as Ue,E as Ge,i as We,j as Ke,k as He,l as $e,P as qe,m as Ye,n as Xe,o as Qe,p as Ze,V as Je,q as et,H as tt,W as nt,r as at,s as st,t as rt,u as ot,v as it,w as lt,x as ct,y as dt,z as ut,B as pt,F as ht,G as mt,I as ft,J as yt,K as gt,N as vt,O as bt,Q as xt,Y as wt,_ as kt,$ as St,a0 as Mt,a1 as Nt,a2 as Ct,a3 as Et,a4 as Pt,a5 as Tt,a6 as At,a7 as _t,a8 as It,a9 as Dt,aa as Ot,ab as Ft,ac as Rt,ad as jt,ae as Lt,af as Bt,ag as Vt,ah as zt,ai as Ut,aj as Gt,ak as Wt,al as Kt,am as Ht,an as $t,ao as qt,ap as Yt,aq as Xt,ar as Qt,as as Zt,at as Jt,au as en,av as tn,aw as nn,ax as an,ay as sn,az as rn,aA as on,aB as ln,aC as cn,aD as dn,aE as un,aF as pn}from"./vendor-ui-C64XGON6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var hn,mn,fn={exports:{}},yn={};var gn,vn,bn,xn,wn=(mn||(mn=1,fn.exports=function(){if(hn)return yn;hn=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(t,n,a){var s=null;if(void 0!==a&&(s=""+a),void 0!==n.key&&(s=""+n.key),"key"in n)for(var r in a={},n)"key"!==r&&(a[r]=n[r]);else a=n;return n=a.ref,{$$typeof:e,type:t,key:s,ref:void 0!==n?n:null,props:a}}return yn.Fragment=t,yn.jsx=n,yn.jsxs=n,yn}()),fn.exports),kn={exports:{}},Sn={},Mn={exports:{}},Nn={};function Cn(){return vn||(vn=1,Mn.exports=(gn||(gn=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var a=n-1>>>1,r=e[a];if(!(0<s(r,t)))break e;e[a]=t,e[n]=r,n=a}}function n(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var a=0,r=e.length,o=r>>>1;a<o;){var i=2*(a+1)-1,l=e[i],c=i+1,d=e[c];if(0>s(l,n))c<r&&0>s(d,l)?(e[a]=d,e[c]=n,a=c):(e[a]=l,e[i]=n,a=i);else{if(!(c<r&&0>s(d,n)))break e;e[a]=d,e[c]=n,a=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var r=performance;e.unstable_now=function(){return r.now()}}else{var o=Date,i=o.now();e.unstable_now=function(){return o.now()-i}}var l=[],c=[],d=1,u=null,p=3,h=!1,m=!1,f=!1,y=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var s=n(c);null!==s;){if(null===s.callback)a(c);else{if(!(s.startTime<=e))break;a(c),s.sortIndex=s.expirationTime,t(l,s)}s=n(c)}}function w(e){if(f=!1,x(e),!m)if(null!==n(l))m=!0,S||(S=!0,k());else{var t=n(c);null!==t&&_(w,t.startTime-e)}}var k,S=!1,M=-1,N=5,C=-1;function E(){return!(!y&&e.unstable_now()-C<N)}function P(){if(y=!1,S){var t=e.unstable_now();C=t;var s=!0;try{e:{m=!1,f&&(f=!1,v(M),M=-1),h=!0;var r=p;try{t:{for(x(t),u=n(l);null!==u&&!(u.expirationTime>t&&E());){var o=u.callback;if("function"==typeof o){u.callback=null,p=u.priorityLevel;var i=o(u.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof i){u.callback=i,x(t),s=!0;break t}u===n(l)&&a(l),x(t)}else a(l);u=n(l)}if(null!==u)s=!0;else{var d=n(c);null!==d&&_(w,d.startTime-t),s=!1}}break e}finally{u=null,p=r,h=!1}s=void 0}}finally{s?k():S=!1}}}if("function"==typeof b)k=function(){b(P)};else if("undefined"!=typeof MessageChannel){var T=new MessageChannel,A=T.port2;T.port1.onmessage=P,k=function(){A.postMessage(null)}}else k=function(){g(P,0)};function _(t,n){M=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(N=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_requestPaint=function(){y=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_scheduleCallback=function(a,s,r){var o=e.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?o+r:o,a){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return a={id:d++,callback:s,priorityLevel:a,startTime:r,expirationTime:i=r+i,sortIndex:-1},r>o?(a.sortIndex=r,t(c,a),null===n(l)&&a===n(c)&&(f?(v(M),M=-1):f=!0,_(w,r-o))):(a.sortIndex=i,t(l,a),m||h||(m=!0,S||(S=!0,k()))),a},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}}(Nn)),Nn)),Mn.exports}function En(){if(bn)return Sn;bn=1;var e=Cn(),t=i(),n=l();function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function r(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function o(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(r(e)!==e)throw Error(a(188))}function u(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=u(e)))return t;e=e.sibling}return null}var p=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),E=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function T(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var A=Symbol.for("react.client.reference");function _(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===A?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case y:return"Fragment";case v:return"Profiler";case g:return"StrictMode";case k:return"Suspense";case S:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case f:return"Portal";case x:return e.displayName||"Context";case b:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:_(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return _(e(t))}catch(n){}}return null}var I=Array.isArray,D=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F={pending:!1,data:null,method:null,action:null},R=[],j=-1;function L(e){return{current:e}}function B(e){0>j||(e.current=R[j],R[j]=null,j--)}function V(e,t){j++,R[j]=e.current,e.current=t}var z,U,G=L(null),W=L(null),K=L(null),H=L(null);function $(e,t){switch(V(K,t),V(W,e),V(G,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?bu(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=xu(t=bu(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(G),V(G,e)}function q(){B(G),B(W),B(K)}function Y(e){null!==e.memoizedState&&V(H,e);var t=G.current,n=xu(t,e.type);t!==n&&(V(W,e),V(G,n))}function X(e){W.current===e&&(B(G),B(W)),H.current===e&&(B(H),pp._currentValue=F)}function Q(e){if(void 0===z)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||"",U=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+z+e+U}var Z=!1;function J(e,t){if(!e||Z)return"";Z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var a={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(s){var a=s}Reflect.construct(e,[],n)}else{try{n.call()}catch(r){a=r}e.call(n.prototype)}}else{try{throw Error()}catch(o){a=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(i){if(i&&a&&"string"==typeof i.stack)return[i.stack,a.stack]}return[null,null]}};a.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(a.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(a.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=a.DetermineComponentFrameRoot(),o=r[0],i=r[1];if(o&&i){var l=o.split("\n"),c=i.split("\n");for(s=a=0;a<l.length&&!l[a].includes("DetermineComponentFrameRoot");)a++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(a===l.length||s===c.length)for(a=l.length-1,s=c.length-1;1<=a&&0<=s&&l[a]!==c[s];)s--;for(;1<=a&&0<=s;a--,s--)if(l[a]!==c[s]){if(1!==a||1!==s)do{if(a--,0>--s||l[a]!==c[s]){var d="\n"+l[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=a&&0<=s);break}}}finally{Z=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Q(n):""}function ee(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return J(e.type,!1);case 11:return J(e.type.render,!1);case 1:return J(e.type,!0);case 31:return Q("Activity");default:return""}}function te(e){try{var t="",n=null;do{t+=ee(e,n),n=e,e=e.return}while(e);return t}catch(a){return"\nError generating stack: "+a.message+"\n"+a.stack}}var ne=Object.prototype.hasOwnProperty,ae=e.unstable_scheduleCallback,se=e.unstable_cancelCallback,re=e.unstable_shouldYield,oe=e.unstable_requestPaint,ie=e.unstable_now,le=e.unstable_getCurrentPriorityLevel,ce=e.unstable_ImmediatePriority,de=e.unstable_UserBlockingPriority,ue=e.unstable_NormalPriority,pe=e.unstable_LowPriority,he=e.unstable_IdlePriority,me=e.log,fe=e.unstable_setDisableYieldValue,ye=null,ge=null;function ve(e){if("function"==typeof me&&fe(e),ge&&"function"==typeof ge.setStrictMode)try{ge.setStrictMode(ye,e)}catch(t){}}var be=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/we|0)|0},xe=Math.log,we=Math.LN2;var ke=256,Se=262144,Me=4194304;function Ne(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t,n){var a=e.pendingLanes;if(0===a)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var i=134217727&a;return 0!==i?0!==(a=i&~r)?s=Ne(a):0!==(o&=i)?s=Ne(o):n||0!==(n=i&~e)&&(s=Ne(n)):0!==(i=a&~r)?s=Ne(i):0!==o?s=Ne(o):n||0!==(n=a&~e)&&(s=Ne(n)),0===s?0:0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(n=t&-t)||32===r&&4194048&n)?t:s}function Ee(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Pe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Te(){var e=Me;return!(62914560&(Me<<=1))&&(Me=4194304),e}function Ae(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _e(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ie(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var a=31-be(t);e.entangledLanes|=t,e.entanglements[a]=1073741824|e.entanglements[a]|261930&n}function De(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var a=31-be(n),s=1<<a;s&t|e[a]&t&&(e[a]|=t),n&=~s}}function Oe(e,t){var n=t&-t;return 0!==((n=42&n?1:Fe(n))&(e.suspendedLanes|t))?0:n}function Fe(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Re(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function je(){var e=O.p;return 0!==e?e:void 0===(e=window.event)?32:Pp(e.type)}function Le(e,t){var n=O.p;try{return O.p=e,t()}finally{O.p=n}}var Be=Math.random().toString(36).slice(2),Ve="__reactFiber$"+Be,ze="__reactProps$"+Be,Ue="__reactContainer$"+Be,Ge="__reactEvents$"+Be,We="__reactListeners$"+Be,Ke="__reactHandles$"+Be,He="__reactResources$"+Be,$e="__reactMarker$"+Be;function qe(e){delete e[Ve],delete e[ze],delete e[Ge],delete e[We],delete e[Ke]}function Ye(e){var t=e[Ve];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ue]||n[Ve]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Lu(e);null!==e;){if(n=e[Ve])return n;e=Lu(e)}return t}n=(e=n).parentNode}return null}function Xe(e){if(e=e[Ve]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Ze(e){var t=e[He];return t||(t=e[He]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Je(e){e[$e]=!0}var et=new Set,tt={};function nt(e,t){at(e,t),at(e+"Capture",t)}function at(e,t){for(tt[e]=t,e=0;e<t.length;e++)et.add(t[e])}var st=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},ot={};function it(e,t,n){if(s=t,ne.call(ot,s)||!ne.call(rt,s)&&(st.test(s)?ot[s]=!0:(rt[s]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var a=t.toLowerCase().slice(0,5);if("data-"!==a&&"aria-"!==a)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var s}function lt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ct(e,t,n,a){if(null===a)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+a)}}function dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=ut(e)?"checked":"value";e._valueTracker=function(e,t,n){var a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==a&&"function"==typeof a.get&&"function"==typeof a.set){var s=a.get,r=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=ut(e)?e.checked?"true":"false":e.value),(e=a)!==n&&(t.setValue(e),!0)}function mt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function yt(e){return e.replace(ft,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,n,a,s,r,o,i){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+dt(t)):e.value!==""+dt(t)&&(e.value=""+dt(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?bt(e,o,dt(t)):null!=n?bt(e,o,dt(n)):null!=a&&e.removeAttribute("value"),null==s&&null!=r&&(e.defaultChecked=!!r),null!=s&&(e.checked=s&&"function"!=typeof s&&"symbol"!=typeof s),null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?e.name=""+dt(i):e.removeAttribute("name")}function vt(e,t,n,a,s,r,o,i){if(null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&(e.type=r),null!=t||null!=n){if(("submit"===r||"reset"===r)&&null==t)return void pt(e);n=null!=n?""+dt(n):"",t=null!=t?""+dt(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}a="function"!=typeof(a=null!=a?a:s)&&"symbol"!=typeof a&&!!a,e.checked=i?e.checked:!!a,e.defaultChecked=!!a,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o),pt(e)}function bt(e,t,n){"number"===t&&mt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function xt(e,t,n,a){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&a&&(e[n].defaultSelected=!0)}else{for(n=""+dt(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(a&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+dt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+dt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function kt(e,t,n,s){if(null==t){if(null!=s){if(null!=n)throw Error(a(92));if(I(s)){if(1<s.length)throw Error(a(93));s=s[0]}n=s}null==n&&(n=""),t=n}n=dt(t),e.defaultValue=n,(s=e.textContent)===n&&""!==s&&null!==s&&(e.value=s),pt(e)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Mt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,n){var a=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?a?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":a?e.setProperty(t,n):"number"!=typeof n||0===n||Mt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ct(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var s in n)!n.hasOwnProperty(s)||null!=t&&t.hasOwnProperty(s)||(0===s.indexOf("--")?e.setProperty(s,""):"float"===s?e.cssFloat="":e[s]="");for(var r in t)s=t[r],t.hasOwnProperty(r)&&n[r]!==s&&Nt(e,r,s)}else for(var o in t)t.hasOwnProperty(o)&&Nt(e,o,t[o])}function Et(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function At(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function _t(){}var It=null;function Dt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ot=null,Ft=null;function Rt(e){var t=Xe(e);if(t&&(e=t.stateNode)){var n=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=s[ze]||null;if(!r)throw Error(a(90));gt(s,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(s=n[t]).form===e.form&&ht(s)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&xt(e,!!n.multiple,t,!1)}}}var jt=!1;function Lt(e,t,n){if(jt)return e(t,n);jt=!0;try{return e(t)}finally{if(jt=!1,(null!==Ot||null!==Ft)&&(td(),Ot&&(t=Ot,e=Ft,Ft=Ot=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Bt(e,t){var n=e.stateNode;if(null===n)return null;var s=n[ze]||null;if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Vt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),zt=!1;if(Vt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Jp){zt=!1}var Gt=null,Wt=null,Kt=null;function Ht(){if(Kt)return Kt;var e,t,n=Wt,a=n.length,s="value"in Gt?Gt.value:Gt.textContent,r=s.length;for(e=0;e<a&&n[e]===s[e];e++);var o=a-e;for(t=1;t<=o&&n[a-t]===s[r-t];t++);return Kt=s.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Yt(){return!1}function Xt(e){function t(t,n,a,s,r){for(var o in this._reactName=t,this._targetInst=a,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?qt:Yt,this.isPropagationStopped=Yt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var Qt,Zt,Jt,en={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tn=Xt(en),nn=p({},en,{view:0,detail:0}),an=Xt(nn),sn=p({},nn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Qt=e.screenX-Jt.screenX,Zt=e.screenY-Jt.screenY):Zt=Qt=0,Jt=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:Zt}}),rn=Xt(sn),on=Xt(p({},sn,{dataTransfer:0})),ln=Xt(p({},nn,{relatedTarget:0})),cn=Xt(p({},en,{animationName:0,elapsedTime:0,pseudoElement:0})),dn=Xt(p({},en,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),un=Xt(p({},en,{data:0})),pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=mn[e])&&!!t[e]}function yn(){return fn}var gn=Xt(p({},nn,{key:function(e){if(e.key){var t=pn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),vn=Xt(p({},sn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=Xt(p({},nn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yn})),wn=Xt(p({},en,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=Xt(p({},sn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Mn=Xt(p({},en,{newState:0,oldState:0})),Nn=[9,13,27,32],En=Vt&&"CompositionEvent"in window,Pn=null;Vt&&"documentMode"in document&&(Pn=document.documentMode);var Tn=Vt&&"TextEvent"in window&&!Pn,An=Vt&&(!En||Pn&&8<Pn&&11>=Pn),_n=String.fromCharCode(32),In=!1;function Dn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function On(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Fn=!1;var Rn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Rn[e.type]:"textarea"===t}function Ln(e,t,n,a){Ot?Ft?Ft.push(a):Ft=[a]:Ot=a,0<(t=ru(t,"onChange")).length&&(n=new tn("onChange","change",null,n,a),e.push({event:n,listeners:t}))}var Bn=null,Vn=null;function zn(e){Qd(e,0)}function Un(e){if(ht(Qe(e)))return e}function Gn(e,t){if("change"===e)return t}var Wn=!1;if(Vt){var Kn;if(Vt){var Hn="oninput"in document;if(!Hn){var $n=document.createElement("div");$n.setAttribute("oninput","return;"),Hn="function"==typeof $n.oninput}Kn=Hn}else Kn=!1;Wn=Kn&&(!document.documentMode||9<document.documentMode)}function qn(){Bn&&(Bn.detachEvent("onpropertychange",Yn),Vn=Bn=null)}function Yn(e){if("value"===e.propertyName&&Un(Vn)){var t=[];Ln(t,Vn,e,Dt(e)),Lt(zn,t)}}function Xn(e,t,n){"focusin"===e?(qn(),Vn=n,(Bn=t).attachEvent("onpropertychange",Yn)):"focusout"===e&&qn()}function Qn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Un(Vn)}function Zn(e,t){if("click"===e)return Un(t)}function Jn(e,t){if("input"===e||"change"===e)return Un(t)}var ea="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ta(e,t){if(ea(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var s=n[a];if(!ne.call(t,s)||!ea(e[s],t[s]))return!1}return!0}function na(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function aa(e,t){var n,a=na(e);for(e=0;a;){if(3===a.nodeType){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=na(a)}}function sa(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?sa(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ra(e){for(var t=mt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(a){n=!1}if(!n)break;t=mt((e=t.contentWindow).document)}return t}function oa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ia=Vt&&"documentMode"in document&&11>=document.documentMode,la=null,ca=null,da=null,ua=!1;function pa(e,t,n){var a=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ua||null==la||la!==mt(a)||("selectionStart"in(a=la)&&oa(a)?a={start:a.selectionStart,end:a.selectionEnd}:a={anchorNode:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset},da&&ta(da,a)||(da=a,0<(a=ru(ca,"onSelect")).length&&(t=new tn("onSelect","select",null,t,n),e.push({event:t,listeners:a}),t.target=la)))}function ha(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ma={animationend:ha("Animation","AnimationEnd"),animationiteration:ha("Animation","AnimationIteration"),animationstart:ha("Animation","AnimationStart"),transitionrun:ha("Transition","TransitionRun"),transitionstart:ha("Transition","TransitionStart"),transitioncancel:ha("Transition","TransitionCancel"),transitionend:ha("Transition","TransitionEnd")},fa={},ya={};function ga(e){if(fa[e])return fa[e];if(!ma[e])return e;var t,n=ma[e];for(t in n)if(n.hasOwnProperty(t)&&t in ya)return fa[e]=n[t];return e}Vt&&(ya=document.createElement("div").style,"AnimationEvent"in window||(delete ma.animationend.animation,delete ma.animationiteration.animation,delete ma.animationstart.animation),"TransitionEvent"in window||delete ma.transitionend.transition);var va=ga("animationend"),ba=ga("animationiteration"),xa=ga("animationstart"),wa=ga("transitionrun"),ka=ga("transitionstart"),Sa=ga("transitioncancel"),Ma=ga("transitionend"),Na=new Map,Ca="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ea(e,t){Na.set(e,t),nt(t,[e])}Ca.push("scrollEnd");var Pa="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},Ta=[],Aa=0,_a=0;function Ia(){for(var e=Aa,t=_a=Aa=0;t<e;){var n=Ta[t];Ta[t++]=null;var a=Ta[t];Ta[t++]=null;var s=Ta[t];Ta[t++]=null;var r=Ta[t];if(Ta[t++]=null,null!==a&&null!==s){var o=a.pending;null===o?s.next=s:(s.next=o.next,o.next=s),a.pending=s}0!==r&&Ra(n,s,r)}}function Da(e,t,n,a){Ta[Aa++]=e,Ta[Aa++]=t,Ta[Aa++]=n,Ta[Aa++]=a,_a|=a,e.lanes|=a,null!==(e=e.alternate)&&(e.lanes|=a)}function Oa(e,t,n,a){return Da(e,t,n,a),ja(e)}function Fa(e,t){return Da(e,null,null,t),ja(e)}function Ra(e,t,n){e.lanes|=n;var a=e.alternate;null!==a&&(a.lanes|=n);for(var s=!1,r=e.return;null!==r;)r.childLanes|=n,null!==(a=r.alternate)&&(a.childLanes|=n),22===r.tag&&(null===(e=r.stateNode)||1&e._visibility||(s=!0)),e=r,r=r.return;return 3===e.tag?(r=e.stateNode,s&&null!==t&&(s=31-be(n),null===(a=(e=r.hiddenUpdates)[s])?e[s]=[t]:a.push(t),t.lane=536870912|n),r):null}function ja(e){if(50<Hc)throw Hc=0,$c=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var La={};function Ba(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Va(e,t,n,a){return new Ba(e,t,n,a)}function za(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ua(e,t){var n=e.alternate;return null===n?((n=Va(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Ga(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Wa(e,t,n,s,r,o){var i=0;if(s=e,"function"==typeof e)za(e)&&(i=1);else if("string"==typeof e)i=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,G.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Va(31,n,t,r)).elementType=C,e.lanes=o,e;case y:return Ka(n.children,r,o,t);case g:i=8,r|=24;break;case v:return(e=Va(12,n,t,2|r)).elementType=v,e.lanes=o,e;case k:return(e=Va(13,n,t,r)).elementType=k,e.lanes=o,e;case S:return(e=Va(19,n,t,r)).elementType=S,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:i=10;break e;case b:i=9;break e;case w:i=11;break e;case M:i=14;break e;case N:i=16,s=null;break e}i=29,n=Error(a(130,null===e?"null":typeof e,"")),s=null}return(t=Va(i,n,t,r)).elementType=e,t.type=s,t.lanes=o,t}function Ka(e,t,n,a){return(e=Va(7,e,a,t)).lanes=n,e}function Ha(e,t,n){return(e=Va(6,e,null,t)).lanes=n,e}function $a(e){var t=Va(18,null,null,0);return t.stateNode=e,t}function qa(e,t,n){return(t=Va(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Ya=new WeakMap;function Xa(e,t){if("object"==typeof e&&null!==e){var n=Ya.get(e);return void 0!==n?n:(t={value:e,source:t,stack:te(t)},Ya.set(e,t),t)}return{value:e,source:t,stack:te(t)}}var Qa=[],Za=0,Ja=null,es=0,ts=[],ns=0,as=null,ss=1,rs="";function os(e,t){Qa[Za++]=es,Qa[Za++]=Ja,Ja=e,es=t}function is(e,t,n){ts[ns++]=ss,ts[ns++]=rs,ts[ns++]=as,as=e;var a=ss;e=rs;var s=32-be(a)-1;a&=~(1<<s),n+=1;var r=32-be(t)+s;if(30<r){var o=s-s%5;r=(a&(1<<o)-1).toString(32),a>>=o,s-=o,ss=1<<32-be(t)+s|n<<s|a,rs=r+e}else ss=1<<r|n<<s|a,rs=e}function ls(e){null!==e.return&&(os(e,1),is(e,1,0))}function cs(e){for(;e===Ja;)Ja=Qa[--Za],Qa[Za]=null,es=Qa[--Za],Qa[Za]=null;for(;e===as;)as=ts[--ns],ts[ns]=null,rs=ts[--ns],ts[ns]=null,ss=ts[--ns],ts[ns]=null}function ds(e,t){ts[ns++]=ss,ts[ns++]=rs,ts[ns++]=as,ss=t.id,rs=t.overflow,as=e}var us=null,ps=null,hs=!1,ms=null,fs=!1,ys=Error(a(519));function gs(e){throw Ss(Xa(Error(a(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),ys}function vs(e){var t=e.stateNode,n=e.type,a=e.memoizedProps;switch(t[Ve]=e,t[ze]=a,n){case"dialog":Zd("cancel",t),Zd("close",t);break;case"iframe":case"object":case"embed":Zd("load",t);break;case"video":case"audio":for(n=0;n<Yd.length;n++)Zd(Yd[n],t);break;case"source":Zd("error",t);break;case"img":case"image":case"link":Zd("error",t),Zd("load",t);break;case"details":Zd("toggle",t);break;case"input":Zd("invalid",t),vt(t,a.value,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name,!0);break;case"select":Zd("invalid",t);break;case"textarea":Zd("invalid",t),kt(t,a.value,a.defaultValue,a.children)}"string"!=typeof(n=a.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===a.suppressHydrationWarning||uu(t.textContent,n)?(null!=a.popover&&(Zd("beforetoggle",t),Zd("toggle",t)),null!=a.onScroll&&Zd("scroll",t),null!=a.onScrollEnd&&Zd("scrollend",t),null!=a.onClick&&(t.onclick=_t),t=!0):t=!1,t||gs(e,!0)}function bs(e){for(us=e.return;us;)switch(us.tag){case 5:case 31:case 13:return void(fs=!1);case 27:case 3:return void(fs=!0);default:us=us.return}}function xs(e){if(e!==us)return!1;if(!hs)return bs(e),hs=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||wu(e.type,e.memoizedProps)),t=!t),t&&ps&&gs(e),bs(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ps=ju(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));ps=ju(e)}else 27===n?(n=ps,Pu(e.type)?(e=Ru,Ru=null,ps=e):ps=n):ps=us?Fu(e.stateNode.nextSibling):null;return!0}function ws(){ps=us=null,hs=!1}function ks(){var e=ms;return null!==e&&(null===Ic?Ic=e:Ic.push.apply(Ic,e),ms=null),e}function Ss(e){null===ms?ms=[e]:ms.push(e)}var Ms=L(null),Ns=null,Cs=null;function Es(e,t,n){V(Ms,t._currentValue),t._currentValue=n}function Ps(e){e._currentValue=Ms.current,B(Ms)}function Ts(e,t,n){for(;null!==e;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==a&&(a.childLanes|=t)):null!==a&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===n)break;e=e.return}}function As(e,t,n,s){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var i=r.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ts(o.return,n,e),s||(i=null);break e}o=l.next}}else if(18===r.tag){if(null===(i=r.return))throw Error(a(341));i.lanes|=n,null!==(o=i.alternate)&&(o.lanes|=n),Ts(i,n,e),i=null}else i=r.child;if(null!==i)i.return=r;else for(i=r;null!==i;){if(i===e){i=null;break}if(null!==(r=i.sibling)){r.return=i.return,i=r;break}i=i.return}r=i}}function _s(e,t,n,s){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(524288&r.flags)o=!0;else if(262144&r.flags)break;if(10===r.tag){var i=r.alternate;if(null===i)throw Error(a(387));if(null!==(i=i.memoizedProps)){var l=r.type;ea(r.pendingProps.value,i.value)||(null!==e?e.push(l):e=[l])}}else if(r===H.current){if(null===(i=r.alternate))throw Error(a(387));i.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(pp):e=[pp])}r=r.return}null!==e&&As(t,e,n,s),t.flags|=262144}function Is(e){for(e=e.firstContext;null!==e;){if(!ea(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ds(e){Ns=e,Cs=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Os(e){return Rs(Ns,e)}function Fs(e,t){return null===Ns&&Ds(e),Rs(e,t)}function Rs(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Cs){if(null===e)throw Error(a(308));Cs=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Cs=Cs.next=t;return n}var js="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ls=e.unstable_scheduleCallback,Bs=e.unstable_NormalPriority,Vs={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zs(){return{controller:new js,data:new Map,refCount:0}}function Us(e){e.refCount--,0===e.refCount&&Ls(Bs,function(){e.controller.abort()})}var Gs=null,Ws=0,Ks=0,Hs=null;function $s(){if(0===--Ws&&null!==Gs){null!==Hs&&(Hs.status="fulfilled");var e=Gs;Gs=null,Ks=0,Hs=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var qs=D.S;D.S=function(e,t){Fc=ie(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Gs){var n=Gs=[];Ws=0,Ks=Wd(),Hs={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ws++,t.then($s,$s)}(0,t),null!==qs&&qs(e,t)};var Ys=L(null);function Xs(){var e=Ys.current;return null!==e?e:yc.pooledCache}function Qs(e,t){V(Ys,null===t?Ys.current:t.pool)}function Zs(){var e=Xs();return null===e?null:{parent:Vs._currentValue,pool:e}}var Js=Error(a(460)),er=Error(a(474)),tr=Error(a(542)),nr={then:function(){}};function ar(e){return"fulfilled"===(e=e.status)||"rejected"===e}function sr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(_t,_t),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e;default:if("string"==typeof t.status)t.then(_t,_t);else{if(null!==(e=yc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e}throw or=t,Js}}function rr(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw or=t,Js;throw t}}var or=null;function ir(){if(null===or)throw Error(a(459));var e=or;return or=null,e}function lr(e){if(e===Js||e===tr)throw Error(a(483))}var cr=null,dr=0;function ur(e){var t=dr;return dr+=1,null===cr&&(cr=[]),sr(cr,e,t)}function pr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function hr(e,t){if(t.$$typeof===h)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mr(e){function t(t,n){if(e){var a=t.deletions;null===a?(t.deletions=[n],t.flags|=16):a.push(n)}}function n(n,a){if(!e)return null;for(;null!==a;)t(n,a),a=a.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Ua(e,t)).index=0,e.sibling=null,e}function o(t,n,a){return t.index=a,e?null!==(a=t.alternate)?(a=a.index)<n?(t.flags|=67108866,n):a:(t.flags|=67108866,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,a){return null===t||6!==t.tag?((t=Ha(n,e.mode,a)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,a){var s=n.type;return s===y?u(e,t,n.props.children,a,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===N&&rr(s)===t.type)?(pr(t=r(t,n.props),n),t.return=e,t):(pr(t=Wa(n.type,n.key,n.props,null,e.mode,a),n),t.return=e,t)}function d(e,t,n,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qa(n,e.mode,a)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,a,s){return null===t||7!==t.tag?((t=Ka(n,e.mode,a,s)).return=e,t):((t=r(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Ha(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case m:return pr(n=Wa(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case f:return(t=qa(t,e.mode,n)).return=e,t;case N:return p(e,t=rr(t),n)}if(I(t)||T(t))return(t=Ka(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return p(e,ur(t),n);if(t.$$typeof===x)return p(e,Fs(e,t),n);hr(e,t)}return null}function h(e,t,n,a){var s=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==s?null:l(e,t,""+n,a);if("object"==typeof n&&null!==n){switch(n.$$typeof){case m:return n.key===s?c(e,t,n,a):null;case f:return n.key===s?d(e,t,n,a):null;case N:return h(e,t,n=rr(n),a)}if(I(n)||T(n))return null!==s?null:u(e,t,n,a,null);if("function"==typeof n.then)return h(e,t,ur(n),a);if(n.$$typeof===x)return h(e,t,Fs(e,n),a);hr(e,n)}return null}function g(e,t,n,a,s){if("string"==typeof a&&""!==a||"number"==typeof a||"bigint"==typeof a)return l(t,e=e.get(n)||null,""+a,s);if("object"==typeof a&&null!==a){switch(a.$$typeof){case m:return c(t,e=e.get(null===a.key?n:a.key)||null,a,s);case f:return d(t,e=e.get(null===a.key?n:a.key)||null,a,s);case N:return g(e,t,n,a=rr(a),s)}if(I(a)||T(a))return u(t,e=e.get(n)||null,a,s,null);if("function"==typeof a.then)return g(e,t,n,ur(a),s);if(a.$$typeof===x)return g(e,t,n,Fs(t,a),s);hr(t,a)}return null}function v(l,c,d,u){if("object"==typeof d&&null!==d&&d.type===y&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case m:e:{for(var b=d.key;null!==c;){if(c.key===b){if((b=d.type)===y){if(7===c.tag){n(l,c.sibling),(u=r(c,d.props.children)).return=l,l=u;break e}}else if(c.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===N&&rr(b)===c.type){n(l,c.sibling),pr(u=r(c,d.props),d),u.return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}d.type===y?((u=Ka(d.props.children,l.mode,u,d.key)).return=l,l=u):(pr(u=Wa(d.type,d.key,d.props,null,l.mode,u),d),u.return=l,l=u)}return i(l);case f:e:{for(b=d.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===d.containerInfo&&c.stateNode.implementation===d.implementation){n(l,c.sibling),(u=r(c,d.children||[])).return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}(u=qa(d,l.mode,u)).return=l,l=u}return i(l);case N:return v(l,c,d=rr(d),u)}if(I(d))return function(a,r,i,l){for(var c=null,d=null,u=r,m=r=0,f=null;null!==u&&m<i.length;m++){u.index>m?(f=u,u=null):f=u.sibling;var y=h(a,u,i[m],l);if(null===y){null===u&&(u=f);break}e&&u&&null===y.alternate&&t(a,u),r=o(y,r,m),null===d?c=y:d.sibling=y,d=y,u=f}if(m===i.length)return n(a,u),hs&&os(a,m),c;if(null===u){for(;m<i.length;m++)null!==(u=p(a,i[m],l))&&(r=o(u,r,m),null===d?c=u:d.sibling=u,d=u);return hs&&os(a,m),c}for(u=s(u);m<i.length;m++)null!==(f=g(u,a,m,i[m],l))&&(e&&null!==f.alternate&&u.delete(null===f.key?m:f.key),r=o(f,r,m),null===d?c=f:d.sibling=f,d=f);return e&&u.forEach(function(e){return t(a,e)}),hs&&os(a,m),c}(l,c,d,u);if(T(d)){if("function"!=typeof(b=T(d)))throw Error(a(150));return function(r,i,l,c){if(null==l)throw Error(a(151));for(var d=null,u=null,m=i,f=i=0,y=null,v=l.next();null!==m&&!v.done;f++,v=l.next()){m.index>f?(y=m,m=null):y=m.sibling;var b=h(r,m,v.value,c);if(null===b){null===m&&(m=y);break}e&&m&&null===b.alternate&&t(r,m),i=o(b,i,f),null===u?d=b:u.sibling=b,u=b,m=y}if(v.done)return n(r,m),hs&&os(r,f),d;if(null===m){for(;!v.done;f++,v=l.next())null!==(v=p(r,v.value,c))&&(i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return hs&&os(r,f),d}for(m=s(m);!v.done;f++,v=l.next())null!==(v=g(m,r,f,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?f:v.key),i=o(v,i,f),null===u?d=v:u.sibling=v,u=v);return e&&m.forEach(function(e){return t(r,e)}),hs&&os(r,f),d}(l,c,d=b.call(d),u)}if("function"==typeof d.then)return v(l,c,ur(d),u);if(d.$$typeof===x)return v(l,c,Fs(l,d),u);hr(l,d)}return"string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d?(d=""+d,null!==c&&6===c.tag?(n(l,c.sibling),(u=r(c,d)).return=l,l=u):(n(l,c),(u=Ha(d,l.mode,u)).return=l,l=u),i(l)):n(l,c)}return function(e,t,n,a){try{dr=0;var s=v(e,t,n,a);return cr=null,s}catch(o){if(o===Js||o===tr)throw o;var r=Va(29,o,null,e.mode);return r.lanes=a,r.return=e,r}}}var fr=mr(!0),yr=mr(!1),gr=!1;function vr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function br(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function xr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wr(e,t,n){var a=e.updateQueue;if(null===a)return null;if(a=a.shared,2&fc){var s=a.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),a.pending=t,t=ja(e),Ra(e,null,n),t}return Da(e,a,t,n),ja(e)}function kr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,De(e,n)}}function Sr(e,t){var n=e.updateQueue,a=e.alternate;if(null!==a&&n===(a=a.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===r?s=r=o:r=r.next=o,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:a.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:a.shared,callbacks:a.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Mr=!1;function Nr(){if(Mr){if(null!==Hs)throw Hs}}function Cr(e,t,n,a){Mr=!1;var s=e.updateQueue;gr=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,i=s.shared.pending;if(null!==i){s.shared.pending=null;var l=i,c=l.next;l.next=null,null===o?r=c:o.next=c,o=l;var d=e.alternate;null!==d&&((i=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===i?d.firstBaseUpdate=c:i.next=c,d.lastBaseUpdate=l))}if(null!==r){var u=s.baseState;for(o=0,d=c=l=null,i=r;;){var h=-536870913&i.lane,m=h!==i.lane;if(m?(vc&h)===h:(a&h)===h){0!==h&&h===Ks&&(Mr=!0),null!==d&&(d=d.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{var f=e,y=i;h=t;var g=n;switch(y.tag){case 1:if("function"==typeof(f=y.payload)){u=f.call(g,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=y.payload)?f.call(g,u,h):f))break e;u=p({},u,h);break e;case 2:gr=!0}}null!==(h=i.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=s.callbacks)?s.callbacks=[h]:m.push(h))}else m={lane:h,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===d?(c=d=m,l=u):d=d.next=m,o|=h;if(null===(i=i.next)){if(null===(i=s.shared.pending))break;i=(m=i).next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null===r&&(s.shared.lanes=0),Cc|=o,e.lanes=o,e.memoizedState=u}}function Er(e,t){if("function"!=typeof e)throw Error(a(191,e));e.call(t)}function Pr(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Er(n[e],t)}var Tr=L(null),Ar=L(0);function _r(e,t){V(Ar,e=Mc),V(Tr,t),Mc=e|t.baseLanes}function Ir(){V(Ar,Mc),V(Tr,Tr.current)}function Dr(){Mc=Ar.current,B(Tr),B(Ar)}var Or=L(null),Fr=null;function Rr(e){var t=e.alternate;V(zr,1&zr.current),V(Or,e),null===Fr&&(null===t||null!==Tr.current||null!==t.memoizedState)&&(Fr=e)}function jr(e){V(zr,zr.current),V(Or,e),null===Fr&&(Fr=e)}function Lr(e){22===e.tag?(V(zr,zr.current),V(Or,e),null===Fr&&(Fr=e)):Br()}function Br(){V(zr,zr.current),V(Or,Or.current)}function Vr(e){B(Or),Fr===e&&(Fr=null),B(zr)}var zr=L(0);function Ur(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Du(n)||Ou(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gr=0,Wr=null,Kr=null,Hr=null,$r=!1,qr=!1,Yr=!1,Xr=0,Qr=0,Zr=null,Jr=0;function eo(){throw Error(a(321))}function to(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ea(e[n],t[n]))return!1;return!0}function no(e,t,n,a,s,r){return Gr=r,Wr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=null===e||null===e.memoizedState?vi:bi,Yr=!1,r=n(a,s),Yr=!1,qr&&(r=so(t,n,a,s)),ao(e),r}function ao(e){D.H=gi;var t=null!==Kr&&null!==Kr.next;if(Gr=0,Hr=Kr=Wr=null,$r=!1,Qr=0,Zr=null,t)throw Error(a(300));null===e||Fi||null!==(e=e.dependencies)&&Is(e)&&(Fi=!0)}function so(e,t,n,s){Wr=e;var r=0;do{if(qr&&(Zr=null),Qr=0,qr=!1,25<=r)throw Error(a(301));if(r+=1,Hr=Kr=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}D.H=xi,o=t(n,s)}while(qr);return o}function ro(){var e=D.H,t=e.useState()[0];return t="function"==typeof t.then?po(t):t,e=e.useState()[0],(null!==Kr?Kr.memoizedState:null)!==e&&(Wr.flags|=1024),t}function oo(){var e=0!==Xr;return Xr=0,e}function io(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function lo(e){if($r){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}$r=!1}Gr=0,Hr=Kr=Wr=null,qr=!1,Qr=Xr=0,Zr=null}function co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Hr?Wr.memoizedState=Hr=e:Hr=Hr.next=e,Hr}function uo(){if(null===Kr){var e=Wr.alternate;e=null!==e?e.memoizedState:null}else e=Kr.next;var t=null===Hr?Wr.memoizedState:Hr.next;if(null!==t)Hr=t,Kr=e;else{if(null===e){if(null===Wr.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(Kr=e).memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},null===Hr?Wr.memoizedState=Hr=e:Hr=Hr.next=e}return Hr}function po(e){var t=Qr;return Qr+=1,null===Zr&&(Zr=[]),e=sr(Zr,e,t),t=Wr,null===(null===Hr?t.memoizedState:Hr.next)&&(t=t.alternate,D.H=null===t||null===t.memoizedState?vi:bi),e}function ho(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return po(e);if(e.$$typeof===x)return Os(e)}throw Error(a(438,String(e)))}function mo(e){var t=null,n=Wr.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var a=Wr.alternate;null!==a&&(null!==(a=a.updateQueue)&&(null!=(a=a.memoCache)&&(t={data:a.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),a=0;a<e;a++)n[a]=E;return t.index++,n}function fo(e,t){return"function"==typeof t?t(e):t}function yo(e){return go(uo(),Kr,e)}function go(e,t,n){var s=e.queue;if(null===s)throw Error(a(311));s.lastRenderedReducer=n;var r=e.baseQueue,o=s.pending;if(null!==o){if(null!==r){var i=r.next;r.next=o.next,o.next=i}t.baseQueue=r=o,s.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var l=i=null,c=null,d=t=r.next,u=!1;do{var p=-536870913&d.lane;if(p!==d.lane?(vc&p)===p:(Gr&p)===p){var h=d.revertLane;if(0===h)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),p===Ks&&(u=!0);else{if((Gr&h)===h){d=d.next,h===Ks&&(u=!0);continue}p={lane:0,revertLane:d.revertLane,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=p,i=o):c=c.next=p,Wr.lanes|=h,Cc|=h}p=d.action,Yr&&n(o,p),o=d.hasEagerState?d.eagerState:n(o,p)}else h={lane:p,revertLane:d.revertLane,gesture:d.gesture,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=h,i=o):c=c.next=h,Wr.lanes|=p,Cc|=p;d=d.next}while(null!==d&&d!==t);if(null===c?i=o:c.next=l,!ea(o,e.memoizedState)&&(Fi=!0,u&&null!==(n=Hs)))throw n;e.memoizedState=o,e.baseState=i,e.baseQueue=c,s.lastRenderedState=o}return null===r&&(s.lanes=0),[e.memoizedState,s.dispatch]}function vo(e){var t=uo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var i=r=r.next;do{o=e(o,i.action),i=i.next}while(i!==r);ea(o,t.memoizedState)||(Fi=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function bo(e,t,n){var s=Wr,r=uo(),o=hs;if(o){if(void 0===n)throw Error(a(407));n=n()}else n=t();var i=!ea((Kr||r).memoizedState,n);if(i&&(r.memoizedState=n,Fi=!0),r=r.queue,Wo(ko.bind(null,s,r,e),[e]),r.getSnapshot!==t||i||null!==Hr&&1&Hr.memoizedState.tag){if(s.flags|=2048,Bo(9,{destroy:void 0},wo.bind(null,s,r,n,t),null),null===yc)throw Error(a(349));o||127&Gr||xo(s,t,n)}return n}function xo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Wr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function wo(e,t,n,a){t.value=n,t.getSnapshot=a,So(t)&&Mo(e)}function ko(e,t,n){return n(function(){So(t)&&Mo(e)})}function So(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ea(e,n)}catch(a){return!0}}function Mo(e){var t=Fa(e,2);null!==t&&Xc(t,e,2)}function No(e){var t=co();if("function"==typeof e){var n=e;if(e=n(),Yr){ve(!0);try{n()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:e},t}function Co(e,t,n,a){return e.baseState=n,go(e,Kr,"function"==typeof a?a:fo)}function Eo(e,t,n,s,r){if(mi(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==D.T?n(!0):o.isTransition=!1,s(o),null===(n=t.pending)?(o.next=t.pending=o,Po(t,o)):(o.next=n.next,t.pending=n.next=o)}}function Po(e,t){var n=t.action,a=t.payload,s=e.state;if(t.isTransition){var r=D.T,o={};D.T=o;try{var i=n(s,a),l=D.S;null!==l&&l(o,i),To(e,t,i)}catch(c){_o(e,t,c)}finally{null!==r&&null!==o.types&&(r.types=o.types),D.T=r}}else try{To(e,t,r=n(s,a))}catch(d){_o(e,t,d)}}function To(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Ao(e,t,n)},function(n){return _o(e,t,n)}):Ao(e,t,n)}function Ao(e,t,n){t.status="fulfilled",t.value=n,Io(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Po(e,n)))}function _o(e,t,n){var a=e.pending;if(e.pending=null,null!==a){a=a.next;do{t.status="rejected",t.reason=n,Io(t),t=t.next}while(t!==a)}e.action=null}function Io(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Do(e,t){return t}function Oo(e,t){if(hs){var n=yc.formState;if(null!==n){e:{var a=Wr;if(hs){if(ps){t:{for(var s=ps,r=fs;8!==s.nodeType;){if(!r){s=null;break t}if(null===(s=Fu(s.nextSibling))){s=null;break t}}s="F!"===(r=s.data)||"F"===r?s:null}if(s){ps=Fu(s.nextSibling),a="F!"===s.data;break e}}gs(a)}a=!1}a&&(t=n[0])}}return(n=co()).memoizedState=n.baseState=t,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Do,lastRenderedState:t},n.queue=a,n=ui.bind(null,Wr,a),a.dispatch=n,a=No(!1),r=hi.bind(null,Wr,!1,a.queue),s={state:t,dispatch:null,action:e,pending:null},(a=co()).queue=s,n=Eo.bind(null,Wr,s,r,n),s.dispatch=n,a.memoizedState=e,[t,n,!1]}function Fo(e){return Ro(uo(),Kr,e)}function Ro(e,t,n){if(t=go(e,t,Do)[0],e=yo(fo)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var a=po(t)}catch(o){if(o===Js)throw tr;throw o}else a=t;var s=(t=uo()).queue,r=s.dispatch;return n!==t.memoizedState&&(Wr.flags|=2048,Bo(9,{destroy:void 0},jo.bind(null,s,n),null)),[a,r,e]}function jo(e,t){e.action=t}function Lo(e){var t=uo(),n=Kr;if(null!==n)return Ro(t,n,e);uo(),t=t.memoizedState;var a=(n=uo()).queue.dispatch;return n.memoizedState=e,[t,a,!1]}function Bo(e,t,n,a){return e={tag:e,create:n,deps:a,inst:t,next:null},null===(t=Wr.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e),e}function Vo(){return uo().memoizedState}function zo(e,t,n,a){var s=co();Wr.flags|=e,s.memoizedState=Bo(1|t,{destroy:void 0},n,void 0===a?null:a)}function Uo(e,t,n,a){var s=uo();a=void 0===a?null:a;var r=s.memoizedState.inst;null!==Kr&&null!==a&&to(a,Kr.memoizedState.deps)?s.memoizedState=Bo(t,r,n,a):(Wr.flags|=e,s.memoizedState=Bo(1|t,r,n,a))}function Go(e,t){zo(8390656,8,e,t)}function Wo(e,t){Uo(2048,8,e,t)}function Ko(e){var t=uo().memoizedState;return function(e){Wr.flags|=4;var t=Wr.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&fc)throw Error(a(440));return t.impl.apply(void 0,arguments)}}function Ho(e,t){return Uo(4,2,e,t)}function $o(e,t){return Uo(4,4,e,t)}function qo(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Yo(e,t,n){n=null!=n?n.concat([e]):null,Uo(4,4,qo.bind(null,t,e),n)}function Xo(){}function Qo(e,t){var n=uo();t=void 0===t?null:t;var a=n.memoizedState;return null!==t&&to(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function Zo(e,t){var n=uo();t=void 0===t?null:t;var a=n.memoizedState;if(null!==t&&to(t,a[1]))return a[0];if(a=e(),Yr){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[a,t],a}function Jo(e,t,n){return void 0===n||1073741824&Gr&&!(261930&vc)?e.memoizedState=t:(e.memoizedState=n,e=Yc(),Wr.lanes|=e,Cc|=e,n)}function ei(e,t,n,a){return ea(n,t)?n:null!==Tr.current?(e=Jo(e,n,a),ea(e,t)||(Fi=!0),e):42&Gr&&(!(1073741824&Gr)||261930&vc)?(e=Yc(),Wr.lanes|=e,Cc|=e,t):(Fi=!0,e.memoizedState=n)}function ti(e,t,n,a,s){var r=O.p;O.p=0!==r&&8>r?r:8;var o,i,l,c=D.T,d={};D.T=d,hi(e,!1,t,n);try{var u=s(),p=D.S;if(null!==p&&p(d,u),null!==u&&"object"==typeof u&&"function"==typeof u.then)pi(e,t,(o=a,i=[],l={status:"pending",value:null,reason:null,then:function(e){i.push(e)}},u.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<i.length;e++)(0,i[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<i.length;e++)(0,i[e])(void 0)}),l),qc());else pi(e,t,a,qc())}catch(h){pi(e,t,{then:function(){},status:"rejected",reason:h},qc())}finally{O.p=r,null!==c&&null!==d.types&&(c.types=d.types),D.T=c}}function ni(){}function ai(e,t,n,s){if(5!==e.tag)throw Error(a(476));var r=si(e).queue;ti(e,r,t,F,null===n?ni:function(){return ri(e),n(s)})}function si(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:F},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ri(e){var t=si(e);null===t.next&&(t=e.alternate.memoizedState),pi(e,t.next.queue,{},qc())}function oi(){return Os(pp)}function ii(){return uo().memoizedState}function li(){return uo().memoizedState}function ci(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=qc(),a=wr(t,e=xr(n),n);return null!==a&&(Xc(a,t,n),kr(a,t,n)),t={cache:zs()},void(e.payload=t)}t=t.return}}function di(e,t,n){var a=qc();n={lane:a,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},mi(e)?fi(t,n):null!==(n=Oa(e,t,n,a))&&(Xc(n,e,a),yi(n,t,a))}function ui(e,t,n){pi(e,t,n,qc())}function pi(e,t,n,a){var s={lane:a,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(mi(e))fi(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var o=t.lastRenderedState,i=r(o,n);if(s.hasEagerState=!0,s.eagerState=i,ea(i,o))return Da(e,t,s,0),null===yc&&Ia(),!1}catch(l){}if(null!==(n=Oa(e,t,s,a)))return Xc(n,e,a),yi(n,t,a),!0}return!1}function hi(e,t,n,s){if(s={lane:2,revertLane:Wd(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},mi(e)){if(t)throw Error(a(479))}else null!==(t=Oa(e,n,s,2))&&Xc(t,e,2)}function mi(e){var t=e.alternate;return e===Wr||null!==t&&t===Wr}function fi(e,t){qr=$r=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function yi(e,t,n){if(4194048&n){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,De(e,n)}}var gi={readContext:Os,use:ho,useCallback:eo,useContext:eo,useEffect:eo,useImperativeHandle:eo,useLayoutEffect:eo,useInsertionEffect:eo,useMemo:eo,useReducer:eo,useRef:eo,useState:eo,useDebugValue:eo,useDeferredValue:eo,useTransition:eo,useSyncExternalStore:eo,useId:eo,useHostTransitionStatus:eo,useFormState:eo,useActionState:eo,useOptimistic:eo,useMemoCache:eo,useCacheRefresh:eo};gi.useEffectEvent=eo;var vi={readContext:Os,use:ho,useCallback:function(e,t){return co().memoizedState=[e,void 0===t?null:t],e},useContext:Os,useEffect:Go,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,zo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){zo(4,2,e,t)},useMemo:function(e,t){var n=co();t=void 0===t?null:t;var a=e();if(Yr){ve(!0);try{e()}finally{ve(!1)}}return n.memoizedState=[a,t],a},useReducer:function(e,t,n){var a=co();if(void 0!==n){var s=n(t);if(Yr){ve(!0);try{n(t)}finally{ve(!1)}}}else s=t;return a.memoizedState=a.baseState=s,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},a.queue=e,e=e.dispatch=di.bind(null,Wr,e),[a.memoizedState,e]},useRef:function(e){return e={current:e},co().memoizedState=e},useState:function(e){var t=(e=No(e)).queue,n=ui.bind(null,Wr,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Xo,useDeferredValue:function(e,t){return Jo(co(),e,t)},useTransition:function(){var e=No(!1);return e=ti.bind(null,Wr,e.queue,!0,!1),co().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var s=Wr,r=co();if(hs){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===yc)throw Error(a(349));127&vc||xo(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Go(ko.bind(null,s,o,e),[e]),s.flags|=2048,Bo(9,{destroy:void 0},wo.bind(null,s,o,n,t),null),n},useId:function(){var e=co(),t=yc.identifierPrefix;if(hs){var n=rs;t="_"+t+"R_"+(n=(ss&~(1<<32-be(ss)-1)).toString(32)+n),0<(n=Xr++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Jr++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:oi,useFormState:Oo,useActionState:Oo,useOptimistic:function(e){var t=co();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=hi.bind(null,Wr,!0,n),n.dispatch=t,[e,t]},useMemoCache:mo,useCacheRefresh:function(){return co().memoizedState=ci.bind(null,Wr)},useEffectEvent:function(e){var t=co(),n={impl:e};return t.memoizedState=n,function(){if(2&fc)throw Error(a(440));return n.impl.apply(void 0,arguments)}}},bi={readContext:Os,use:ho,useCallback:Qo,useContext:Os,useEffect:Wo,useImperativeHandle:Yo,useInsertionEffect:Ho,useLayoutEffect:$o,useMemo:Zo,useReducer:yo,useRef:Vo,useState:function(){return yo(fo)},useDebugValue:Xo,useDeferredValue:function(e,t){return ei(uo(),Kr.memoizedState,e,t)},useTransition:function(){var e=yo(fo)[0],t=uo().memoizedState;return["boolean"==typeof e?e:po(e),t]},useSyncExternalStore:bo,useId:ii,useHostTransitionStatus:oi,useFormState:Fo,useActionState:Fo,useOptimistic:function(e,t){return Co(uo(),0,e,t)},useMemoCache:mo,useCacheRefresh:li};bi.useEffectEvent=Ko;var xi={readContext:Os,use:ho,useCallback:Qo,useContext:Os,useEffect:Wo,useImperativeHandle:Yo,useInsertionEffect:Ho,useLayoutEffect:$o,useMemo:Zo,useReducer:vo,useRef:Vo,useState:function(){return vo(fo)},useDebugValue:Xo,useDeferredValue:function(e,t){var n=uo();return null===Kr?Jo(n,e,t):ei(n,Kr.memoizedState,e,t)},useTransition:function(){var e=vo(fo)[0],t=uo().memoizedState;return["boolean"==typeof e?e:po(e),t]},useSyncExternalStore:bo,useId:ii,useHostTransitionStatus:oi,useFormState:Lo,useActionState:Lo,useOptimistic:function(e,t){var n=uo();return null!==Kr?Co(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:mo,useCacheRefresh:li};function wi(e,t,n,a){n=null==(n=n(a,t=e.memoizedState))?t:p({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}xi.useEffectEvent=Ko;var ki={enqueueSetState:function(e,t,n){e=e._reactInternals;var a=qc(),s=xr(a);s.payload=t,null!=n&&(s.callback=n),null!==(t=wr(e,s,a))&&(Xc(t,e,a),kr(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var a=qc(),s=xr(a);s.tag=1,s.payload=t,null!=n&&(s.callback=n),null!==(t=wr(e,s,a))&&(Xc(t,e,a),kr(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=qc(),a=xr(n);a.tag=2,null!=t&&(a.callback=t),null!==(t=wr(e,a,n))&&(Xc(t,e,n),kr(t,e,n))}};function Si(e,t,n,a,s,r,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(a,r,o):!t.prototype||!t.prototype.isPureReactComponent||(!ta(n,a)||!ta(s,r))}function Mi(e,t,n,a){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,a),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&ki.enqueueReplaceState(t,t.state,null)}function Ni(e,t){var n=t;if("ref"in t)for(var a in n={},t)"ref"!==a&&(n[a]=t[a]);if(e=e.defaultProps)for(var s in n===t&&(n=p({},n)),e)void 0===n[s]&&(n[s]=e[s]);return n}function Ci(e){Pa(e)}function Ei(e){}function Pi(e){Pa(e)}function Ti(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Ai(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function _i(e,t,n){return(n=xr(n)).tag=3,n.payload={element:null},n.callback=function(){Ti(e,t)},n}function Ii(e){return(e=xr(e)).tag=3,e}function Di(e,t,n,a){var s=n.type.getDerivedStateFromError;if("function"==typeof s){var r=a.value;e.payload=function(){return s(r)},e.callback=function(){Ai(t,n,a)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){Ai(t,n,a),"function"!=typeof s&&(null===Lc?Lc=new Set([this]):Lc.add(this));var e=a.stack;this.componentDidCatch(a.value,{componentStack:null!==e?e:""})})}var Oi=Error(a(461)),Fi=!1;function Ri(e,t,n,a){t.child=null===e?yr(t,null,n,a):fr(t,e.child,n,a)}function ji(e,t,n,a,s){n=n.render;var r=t.ref;if("ref"in a){var o={};for(var i in a)"ref"!==i&&(o[i]=a[i])}else o=a;return Ds(t),a=no(e,t,n,o,r,s),i=oo(),null===e||Fi?(hs&&i&&ls(t),t.flags|=1,Ri(e,t,a,s),t.child):(io(e,t,s),ol(e,t,s))}function Li(e,t,n,a,s){if(null===e){var r=n.type;return"function"!=typeof r||za(r)||void 0!==r.defaultProps||null!==n.compare?((e=Wa(n.type,null,a,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Bi(e,t,r,a,s))}if(r=e.child,!il(e,s)){var o=r.memoizedProps;if((n=null!==(n=n.compare)?n:ta)(o,a)&&e.ref===t.ref)return ol(e,t,s)}return t.flags|=1,(e=Ua(r,a)).ref=t.ref,e.return=t,t.child=e}function Bi(e,t,n,a,s){if(null!==e){var r=e.memoizedProps;if(ta(r,a)&&e.ref===t.ref){if(Fi=!1,t.pendingProps=a=r,!il(e,s))return t.lanes=e.lanes,ol(e,t,s);131072&e.flags&&(Fi=!0)}}return Hi(e,t,n,a,s)}function Vi(e,t,n,a){var s=a.children,r=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===a.mode){if(128&t.flags){if(r=null!==r?r.baseLanes|n:n,null!==e){for(a=t.child=e.child,s=0;null!==a;)s=s|a.lanes|a.childLanes,a=a.sibling;a=s&~r}else a=0,t.child=null;return Ui(e,t,r,n,a)}if(!(536870912&n))return a=t.lanes=536870912,Ui(e,t,null!==r?r.baseLanes|n:n,n,a);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Qs(0,null!==r?r.cachePool:null),null!==r?_r(t,r):Ir(),Lr(t)}else null!==r?(Qs(0,r.cachePool),_r(t,r),Br(),t.memoizedState=null):(null!==e&&Qs(0,null),Ir(),Br());return Ri(e,t,s,n),t.child}function zi(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ui(e,t,n,a,s){var r=Xs();return r=null===r?null:{parent:Vs._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Qs(0,null),Ir(),Lr(t),null!==e&&_s(e,t,a,!0),t.childLanes=s,null}function Gi(e,t){return(t=tl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Wi(e,t,n){return fr(t,e.child,null,n),(e=Gi(t,t.pendingProps)).flags|=2,Vr(t),t.memoizedState=null,e}function Ki(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Hi(e,t,n,a,s){return Ds(t),n=no(e,t,n,a,void 0,s),a=oo(),null===e||Fi?(hs&&a&&ls(t),t.flags|=1,Ri(e,t,n,s),t.child):(io(e,t,s),ol(e,t,s))}function $i(e,t,n,a,s,r){return Ds(t),t.updateQueue=null,n=so(t,a,n,s),ao(e),a=oo(),null===e||Fi?(hs&&a&&ls(t),t.flags|=1,Ri(e,t,n,r),t.child):(io(e,t,r),ol(e,t,r))}function qi(e,t,n,a,s){if(Ds(t),null===t.stateNode){var r=La,o=n.contextType;"object"==typeof o&&null!==o&&(r=Os(o)),r=new n(a,r),t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=ki,t.stateNode=r,r._reactInternals=t,(r=t.stateNode).props=a,r.state=t.memoizedState,r.refs={},vr(t),o=n.contextType,r.context="object"==typeof o&&null!==o?Os(o):La,r.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(wi(t,n,o,a),r.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(o=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),o!==r.state&&ki.enqueueReplaceState(r,r.state,null),Cr(t,a,r,s),Nr(),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308),a=!0}else if(null===e){r=t.stateNode;var i=t.memoizedProps,l=Ni(n,i);r.props=l;var c=r.context,d=n.contextType;o=La,"object"==typeof d&&null!==d&&(o=Os(d));var u=n.getDerivedStateFromProps;d="function"==typeof u||"function"==typeof r.getSnapshotBeforeUpdate,i=t.pendingProps!==i,d||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(i||c!==o)&&Mi(t,r,a,o),gr=!1;var p=t.memoizedState;r.state=p,Cr(t,a,r,s),Nr(),c=t.memoizedState,i||p!==c||gr?("function"==typeof u&&(wi(t,n,u,a),c=t.memoizedState),(l=gr||Si(t,n,l,a,p,c,o))?(d||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4194308)):("function"==typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=c),r.props=a,r.state=c,r.context=o,a=l):("function"==typeof r.componentDidMount&&(t.flags|=4194308),a=!1)}else{r=t.stateNode,br(e,t),d=Ni(n,o=t.memoizedProps),r.props=d,u=t.pendingProps,p=r.context,c=n.contextType,l=La,"object"==typeof c&&null!==c&&(l=Os(c)),(c="function"==typeof(i=n.getDerivedStateFromProps)||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o!==u||p!==l)&&Mi(t,r,a,l),gr=!1,p=t.memoizedState,r.state=p,Cr(t,a,r,s),Nr();var h=t.memoizedState;o!==u||p!==h||gr||null!==e&&null!==e.dependencies&&Is(e.dependencies)?("function"==typeof i&&(wi(t,n,i,a),h=t.memoizedState),(d=gr||Si(t,n,d,a,p,h,l)||null!==e&&null!==e.dependencies&&Is(e.dependencies))?(c||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(a,h,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(a,h,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=h),r.props=a,r.state=h,r.context=l,a=d):("function"!=typeof r.componentDidUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),a=!1)}return r=a,Ki(e,t),a=!!(128&t.flags),r||a?(r=t.stateNode,n=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render(),t.flags|=1,null!==e&&a?(t.child=fr(t,e.child,null,s),t.child=fr(t,null,n,s)):Ri(e,t,n,s),t.memoizedState=r.state,e=t.child):e=ol(e,t,s),e}function Yi(e,t,n,a){return ws(),t.flags|=256,Ri(e,t,n,a),t.child}var Xi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qi(e){return{baseLanes:e,cachePool:Zs()}}function Zi(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Tc),e}function Ji(e,t,n){var s,r=t.pendingProps,o=!1,i=!!(128&t.flags);if((s=i)||(s=(null===e||null!==e.memoizedState)&&!!(2&zr.current)),s&&(o=!0,t.flags&=-129),s=!!(32&t.flags),t.flags&=-33,null===e){if(hs){if(o?Rr(t):Br(),(e=ps)?null!==(e=null!==(e=Iu(e,fs))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==as?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(n=$a(e)).return=t,t.child=n,us=t,ps=null):e=null,null===e)throw gs(t);return Ou(e)?t.lanes=32:t.lanes=536870912,null}var l=r.children;return r=r.fallback,o?(Br(),l=tl({mode:"hidden",children:l},o=t.mode),r=Ka(r,o,n,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(r=t.child).memoizedState=Qi(n),r.childLanes=Zi(e,s,n),t.memoizedState=Xi,zi(null,r)):(Rr(t),el(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(i)256&t.flags?(Rr(t),t.flags&=-257,t=nl(e,t,n)):null!==t.memoizedState?(Br(),t.child=e.child,t.flags|=128,t=null):(Br(),l=r.fallback,o=t.mode,r=tl({mode:"visible",children:r.children},o),(l=Ka(l,o,n,null)).flags|=2,r.return=t,l.return=t,r.sibling=l,t.child=r,fr(t,e.child,null,n),(r=t.child).memoizedState=Qi(n),r.childLanes=Zi(e,s,n),t.memoizedState=Xi,t=zi(null,r));else if(Rr(t),Ou(l)){if(s=l.nextSibling&&l.nextSibling.dataset)var d=s.dgst;s=d,(r=Error(a(419))).stack="",r.digest=s,Ss({value:r,source:null,stack:null}),t=nl(e,t,n)}else if(Fi||_s(e,t,n,!1),s=0!==(n&e.childLanes),Fi||s){if(null!==(s=yc)&&(0!==(r=Oe(s,n))&&r!==c.retryLane))throw c.retryLane=r,Fa(e,r),Xc(s,e,r),Oi;Du(l)||ld(),t=nl(e,t,n)}else Du(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ps=Fu(l.nextSibling),us=t,hs=!0,ms=null,fs=!1,null!==e&&ds(t,e),(t=el(t,r.children)).flags|=4096);return t}return o?(Br(),l=r.fallback,o=t.mode,d=(c=e.child).sibling,(r=Ua(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==d?l=Ua(d,l):(l=Ka(l,o,n,null)).flags|=2,l.return=t,r.return=t,r.sibling=l,t.child=r,zi(null,r),r=t.child,null===(l=e.child.memoizedState)?l=Qi(n):(null!==(o=l.cachePool)?(c=Vs._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=Zs(),l={baseLanes:l.baseLanes|n,cachePool:o}),r.memoizedState=l,r.childLanes=Zi(e,s,n),t.memoizedState=Xi,zi(e.child,r)):(Rr(t),e=(n=e.child).sibling,(n=Ua(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function el(e,t){return(t=tl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function tl(e,t){return(e=Va(22,e,null,t)).lanes=0,e}function nl(e,t,n){return fr(t,e.child,null,n),(e=el(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function al(e,t,n){e.lanes|=t;var a=e.alternate;null!==a&&(a.lanes|=t),Ts(e.return,t,n)}function sl(e,t,n,a,s,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:s,treeForkCount:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=a,o.tail=n,o.tailMode=s,o.treeForkCount=r)}function rl(e,t,n){var a=t.pendingProps,s=a.revealOrder,r=a.tail;a=a.children;var o=zr.current,i=!!(2&o);if(i?(o=1&o|2,t.flags|=128):o&=1,V(zr,o),Ri(e,t,a,n),a=hs?es:0,!i&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&al(e,n,t);else if(19===e.tag)al(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===Ur(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),sl(t,!1,s,n,r,a);break;case"backwards":case"unstable_legacy-backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Ur(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}sl(t,!0,n,null,r,a);break;case"together":sl(t,!1,null,null,void 0,a);break;default:t.memoizedState=null}return t.child}function ol(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(_s(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Ua(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ua(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function il(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Is(e))}function ll(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Fi=!0;else{if(!(il(e,n)||128&t.flags))return Fi=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),Es(0,Vs,e.memoizedState.cache),ws();break;case 27:case 5:Y(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:Es(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,jr(t),null;break;case 13:var a=t.memoizedState;if(null!==a)return null!==a.dehydrated?(Rr(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ji(e,t,n):(Rr(t),null!==(e=ol(e,t,n))?e.sibling:null);Rr(t);break;case 19:var s=!!(128&e.flags);if((a=0!==(n&t.childLanes))||(_s(e,t,n,!1),a=0!==(n&t.childLanes)),s){if(a)return rl(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),V(zr,zr.current),a)break;return null;case 22:return t.lanes=0,Vi(e,t,n,t.pendingProps);case 24:Es(0,Vs,e.memoizedState.cache)}return ol(e,t,n)}(e,t,n);Fi=!!(131072&e.flags)}else Fi=!1,hs&&1048576&t.flags&&is(t,es,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=rr(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var r=e.$$typeof;if(r===w){t.tag=11,t=ji(null,t,e,s,n);break e}if(r===M){t.tag=14,t=Li(null,t,e,s,n);break e}}throw t=_(e)||e,Error(a(306,t,""))}za(e)?(s=Ni(e,s),t.tag=1,t=qi(null,t,e,s,n)):(t.tag=0,t=Hi(null,t,e,s,n))}return t;case 0:return Hi(e,t,t.type,t.pendingProps,n);case 1:return qi(e,t,s=t.type,r=Ni(s,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(a(387));s=t.pendingProps;var o=t.memoizedState;r=o.element,br(e,t),Cr(t,s,null,n);var i=t.memoizedState;if(s=i.cache,Es(0,Vs,s),s!==o.cache&&As(t,[Vs],n,!0),Nr(),s=i.element,o.isDehydrated){if(o={element:s,isDehydrated:!1,cache:i.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Yi(e,t,s,n);break e}if(s!==r){Ss(r=Xa(Error(a(424)),t)),t=Yi(e,t,s,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ps=Fu(e.firstChild),us=t,hs=!0,ms=null,fs=!0,n=yr(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ws(),s===r){t=ol(e,t,n);break e}Ri(e,t,s,n)}t=t.child}return t;case 26:return Ki(e,t),null===e?(n=$u(t.type,null,t.pendingProps,null))?t.memoizedState=n:hs||(n=t.type,e=t.pendingProps,(s=vu(K.current).createElement(n))[Ve]=t,s[ze]=e,mu(s,n,e),Je(s),t.stateNode=s):t.memoizedState=$u(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Y(t),null===e&&hs&&(s=t.stateNode=Bu(t.type,t.pendingProps,K.current),us=t,fs=!0,r=ps,Pu(t.type)?(Ru=r,ps=Fu(s.firstChild)):ps=r),Ri(e,t,t.pendingProps.children,n),Ki(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&hs&&((r=s=ps)&&(null!==(s=function(e,t,n,a){for(;1===e.nodeType;){var s=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!a&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(a){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(r=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(r!==s.rel||e.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||e.getAttribute("title")!==(null==s.title?null:s.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((r=e.getAttribute("src"))!==(null==s.src?null:s.src)||e.getAttribute("type")!==(null==s.type?null:s.type)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&r&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var r=null==s.name?null:""+s.name;if("hidden"===s.type&&e.getAttribute("name")===r)return e}if(null===(e=Fu(e.nextSibling)))break}return null}(s,t.type,t.pendingProps,fs))?(t.stateNode=s,us=t,ps=Fu(s.firstChild),fs=!1,r=!0):r=!1),r||gs(t)),Y(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,wu(r,o)?s=null:null!==i&&wu(r,i)&&(t.flags|=32),null!==t.memoizedState&&(r=no(e,t,ro,null,null,n),pp._currentValue=r),Ki(e,t),Ri(e,t,s,n),t.child;case 6:return null===e&&hs&&((e=n=ps)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Fu(e.nextSibling)))return null}return e}(n,t.pendingProps,fs))?(t.stateNode=n,us=t,ps=null,e=!0):e=!1),e||gs(t)),null;case 13:return Ji(e,t,n);case 4:return $(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=fr(t,null,s,n):Ri(e,t,s,n),t.child;case 11:return ji(e,t,t.type,t.pendingProps,n);case 7:return Ri(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ri(e,t,t.pendingProps.children,n),t.child;case 10:return s=t.pendingProps,Es(0,t.type,s.value),Ri(e,t,s.children,n),t.child;case 9:return r=t.type._context,s=t.pendingProps.children,Ds(t),s=s(r=Os(r)),t.flags|=1,Ri(e,t,s,n),t.child;case 14:return Li(e,t,t.type,t.pendingProps,n);case 15:return Bi(e,t,t.type,t.pendingProps,n);case 19:return rl(e,t,n);case 31:return function(e,t,n){var s=t.pendingProps,r=!!(128&t.flags);if(t.flags&=-129,null===e){if(hs){if("hidden"===s.mode)return e=Gi(t,s),t.lanes=536870912,zi(null,e);if(jr(t),(e=ps)?null!==(e=null!==(e=Iu(e,fs))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==as?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(n=$a(e)).return=t,t.child=n,us=t,ps=null):e=null,null===e)throw gs(t);return t.lanes=536870912,null}return Gi(t,s)}var o=e.memoizedState;if(null!==o){var i=o.dehydrated;if(jr(t),r)if(256&t.flags)t.flags&=-257,t=Wi(e,t,n);else{if(null===t.memoizedState)throw Error(a(558));t.child=e.child,t.flags|=128,t=null}else if(Fi||_s(e,t,n,!1),r=0!==(n&e.childLanes),Fi||r){if(null!==(s=yc)&&0!==(i=Oe(s,n))&&i!==o.retryLane)throw o.retryLane=i,Fa(e,i),Xc(s,e,i),Oi;ld(),t=Wi(e,t,n)}else e=o.treeContext,ps=Fu(i.nextSibling),us=t,hs=!0,ms=null,fs=!1,null!==e&&ds(t,e),(t=Gi(t,s)).flags|=4096;return t}return(e=Ua(e.child,{mode:s.mode,children:s.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Vi(e,t,n,t.pendingProps);case 24:return Ds(t),s=Os(Vs),null===e?(null===(r=Xs())&&(r=yc,o=zs(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=n),r=o),t.memoizedState={parent:s,cache:r},vr(t),Es(0,Vs,r)):(0!==(e.lanes&n)&&(br(e,t),Cr(t,null,null,n),Nr()),r=e.memoizedState,o=t.memoizedState,r.parent!==s?(r={parent:s,cache:s},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),Es(0,Vs,s)):(s=o.cache,Es(0,Vs,s),s!==r.cache&&As(t,[Vs],n,!0))),Ri(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function cl(e){e.flags|=4}function dl(e,t,n,a,s){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&s)===s)if(e.stateNode.complete)e.flags|=8192;else{if(!rd())throw or=nr,er;e.flags|=8192}}else e.flags&=-16777217}function ul(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!op(t)){if(!rd())throw or=nr,er;e.flags|=8192}}function pl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Te():536870912,e.lanes|=t,Ac|=t)}function hl(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;null!==n;)null!==n.alternate&&(a=n),n=n.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function ml(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,a=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=65011712&s.subtreeFlags,a|=65011712&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=s.subtreeFlags,a|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=a,e.childLanes=n,t}function fl(e,t,n){var s=t.pendingProps;switch(cs(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return ml(t),null;case 3:return n=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Ps(Vs),q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(xs(t)?cl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,ks())),ml(t),null;case 26:var r=t.type,o=t.memoizedState;return null===e?(cl(t),null!==o?(ml(t),ul(t,o)):(ml(t),dl(t,r,0,0,n))):o?o!==e.memoizedState?(cl(t),ml(t),ul(t,o)):(ml(t),t.flags&=-16777217):((e=e.memoizedProps)!==s&&cl(t),ml(t),dl(t,r,0,0,n)),null;case 27:if(X(t),n=K.current,r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return ml(t),null}e=G.current,xs(t)?vs(t):(e=Bu(r,s,n),t.stateNode=e,cl(t))}return ml(t),null;case 5:if(X(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(a(166));return ml(t),null}if(o=G.current,xs(t))vs(t);else{var i=vu(K.current);switch(o){case 1:o=i.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:o=i.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":o=i.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":o=i.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(o=i.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o="string"==typeof s.is?i.createElement("select",{is:s.is}):i.createElement("select"),s.multiple?o.multiple=!0:s.size&&(o.size=s.size);break;default:o="string"==typeof s.is?i.createElement(r,{is:s.is}):i.createElement(r)}}o[Ve]=t,o[ze]=s;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)o.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=o;e:switch(mu(o,r,s),r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&cl(t)}}return ml(t),dl(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if("string"!=typeof s&&null===t.stateNode)throw Error(a(166));if(e=K.current,xs(t)){if(e=t.stateNode,n=t.memoizedProps,s=null,null!==(r=us))switch(r.tag){case 27:case 5:s=r.memoizedProps}e[Ve]=t,(e=!!(e.nodeValue===n||null!==s&&!0===s.suppressHydrationWarning||uu(e.nodeValue,n)))||gs(t,!0)}else(e=vu(e).createTextNode(s))[Ve]=t,t.stateNode=e}return ml(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(s=xs(t),null!==n){if(null===e){if(!s)throw Error(a(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(557));e[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),e=!1}else n=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(Vr(t),t):(Vr(t),null);if(128&t.flags)throw Error(a(558))}return ml(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=xs(t),null!==s&&null!==s.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),r=!1}else r=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(Vr(t),t):(Vr(t),null)}return Vr(t),128&t.flags?(t.lanes=n,t):(n=null!==s,e=null!==e&&null!==e.memoizedState,n&&(r=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(r=s.alternate.memoizedState.cachePool.pool),o=null,null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(o=s.memoizedState.cachePool.pool),o!==r&&(s.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),pl(t,t.updateQueue),ml(t),null);case 4:return q(),null===e&&tu(t.stateNode.containerInfo),ml(t),null;case 10:return Ps(t.type),ml(t),null;case 19:if(B(zr),null===(s=t.memoizedState))return ml(t),null;if(r=!!(128&t.flags),null===(o=s.rendering))if(r)hl(s,!1);else{if(0!==Nc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Ur(e))){for(t.flags|=128,hl(s,!1),e=o.updateQueue,t.updateQueue=e,pl(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ga(n,e),n=n.sibling;return V(zr,1&zr.current|2),hs&&os(t,s.treeForkCount),t.child}e=e.sibling}null!==s.tail&&ie()>Rc&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ur(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,pl(t,e),hl(s,!0),null===s.tail&&"hidden"===s.tailMode&&!o.alternate&&!hs)return ml(t),null}else 2*ie()-s.renderingStartTime>Rc&&536870912!==n&&(t.flags|=128,r=!0,hl(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=s.last)?e.sibling=o:t.child=o,s.last=o)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ie(),e.sibling=null,n=zr.current,V(zr,r?1&n|2:1&n),hs&&os(t,s.treeForkCount),e):(ml(t),null);case 22:case 23:return Vr(t),Dr(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?!!(536870912&n)&&!(128&t.flags)&&(ml(t),6&t.subtreeFlags&&(t.flags|=8192)):ml(t),null!==(n=t.updateQueue)&&pl(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==n&&(t.flags|=2048),null!==e&&B(Ys),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Ps(Vs),ml(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function yl(e,t){switch(cs(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ps(Vs),q(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return X(t),null;case 31:if(null!==t.memoizedState){if(Vr(t),null===t.alternate)throw Error(a(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Vr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(zr),null;case 4:return q(),null;case 10:return Ps(t.type),null;case 22:case 23:return Vr(t),Dr(),null!==e&&B(Ys),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Ps(Vs),null;default:return null}}function gl(e,t){switch(cs(t),t.tag){case 3:Ps(Vs),q();break;case 26:case 27:case 5:X(t);break;case 4:q();break;case 31:null!==t.memoizedState&&Vr(t);break;case 13:Vr(t);break;case 19:B(zr);break;case 10:Ps(t.type);break;case 22:case 23:Vr(t),Dr(),null!==e&&B(Ys);break;case 24:Ps(Vs)}}function vl(e,t){try{var n=t.updateQueue,a=null!==n?n.lastEffect:null;if(null!==a){var s=a.next;n=s;do{if((n.tag&e)===e){a=void 0;var r=n.create,o=n.inst;a=r(),o.destroy=a}n=n.next}while(n!==s)}}catch(i){Nd(t,t.return,i)}}function bl(e,t,n){try{var a=t.updateQueue,s=null!==a?a.lastEffect:null;if(null!==s){var r=s.next;a=r;do{if((a.tag&e)===e){var o=a.inst,i=o.destroy;if(void 0!==i){o.destroy=void 0,s=t;var l=n,c=i;try{c()}catch(d){Nd(s,l,d)}}}a=a.next}while(a!==r)}}catch(d){Nd(t,t.return,d)}}function xl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Pr(t,n)}catch(a){Nd(e,e.return,a)}}}function wl(e,t,n){n.props=Ni(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(a){Nd(e,t,a)}}function kl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var a=e.stateNode;break;default:a=e.stateNode}"function"==typeof n?e.refCleanup=n(a):n.current=a}}catch(s){Nd(e,t,s)}}function Sl(e,t){var n=e.ref,a=e.refCleanup;if(null!==n)if("function"==typeof a)try{a()}catch(s){Nd(e,t,s)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(r){Nd(e,t,r)}else n.current=null}function Ml(e){var t=e.type,n=e.memoizedProps,a=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&a.focus();break e;case"img":n.src?a.src=n.src:n.srcSet&&(a.srcset=n.srcSet)}}catch(s){Nd(e,e.return,s)}}function Nl(e,t,n){try{var s=e.stateNode;!function(e,t,n,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,i=null,l=null,c=null,d=null,u=null;for(m in n){var p=n[m];if(n.hasOwnProperty(m)&&null!=p)switch(m){case"checked":case"value":break;case"defaultValue":c=p;default:s.hasOwnProperty(m)||pu(e,t,m,null,s,p)}}for(var h in s){var m=s[h];if(p=n[h],s.hasOwnProperty(h)&&(null!=m||null!=p))switch(h){case"type":o=m;break;case"name":r=m;break;case"checked":d=m;break;case"defaultChecked":u=m;break;case"value":i=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(a(137,t));break;default:m!==p&&pu(e,t,h,m,s,p)}}return void gt(e,i,l,c,d,u,o,r);case"select":for(o in m=i=l=h=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":m=c;default:s.hasOwnProperty(o)||pu(e,t,o,null,s,c)}for(r in s)if(o=s[r],c=n[r],s.hasOwnProperty(r)&&(null!=o||null!=c))switch(r){case"value":h=o;break;case"defaultValue":l=o;break;case"multiple":i=o;default:o!==c&&pu(e,t,r,o,s,c)}return t=l,n=i,s=m,void(null!=h?xt(e,!!n,h,!1):!!s!=!!n&&(null!=t?xt(e,!!n,t,!0):xt(e,!!n,n?[]:"",!1)));case"textarea":for(l in m=h=null,n)if(r=n[l],n.hasOwnProperty(l)&&null!=r&&!s.hasOwnProperty(l))switch(l){case"value":case"children":break;default:pu(e,t,l,null,s,r)}for(i in s)if(r=s[i],o=n[i],s.hasOwnProperty(i)&&(null!=r||null!=o))switch(i){case"value":h=r;break;case"defaultValue":m=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==o&&pu(e,t,i,r,s,o)}return void wt(e,h,m);case"option":for(var f in n)if(h=n[f],n.hasOwnProperty(f)&&null!=h&&!s.hasOwnProperty(f))if("selected"===f)e.selected=!1;else pu(e,t,f,null,s,h);for(c in s)if(h=s[c],m=n[c],s.hasOwnProperty(c)&&h!==m&&(null!=h||null!=m))if("selected"===c)e.selected=h&&"function"!=typeof h&&"symbol"!=typeof h;else pu(e,t,c,h,s,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var y in n)h=n[y],n.hasOwnProperty(y)&&null!=h&&!s.hasOwnProperty(y)&&pu(e,t,y,null,s,h);for(d in s)if(h=s[d],m=n[d],s.hasOwnProperty(d)&&h!==m&&(null!=h||null!=m))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(a(137,t));break;default:pu(e,t,d,h,s,m)}return;default:if(Et(t)){for(var g in n)h=n[g],n.hasOwnProperty(g)&&void 0!==h&&!s.hasOwnProperty(g)&&hu(e,t,g,void 0,s,h);for(u in s)h=s[u],m=n[u],!s.hasOwnProperty(u)||h===m||void 0===h&&void 0===m||hu(e,t,u,h,s,m);return}}for(var v in n)h=n[v],n.hasOwnProperty(v)&&null!=h&&!s.hasOwnProperty(v)&&pu(e,t,v,null,s,h);for(p in s)h=s[p],m=n[p],!s.hasOwnProperty(p)||h===m||null==h&&null==m||pu(e,t,p,h,s,m)}(s,e.type,n,t),s[ze]=t}catch(r){Nd(e,e.return,r)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Pu(e.type)||4===e.tag}function El(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Pu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Pl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=_t));else if(4!==a&&(27===a&&Pu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Pl(e,t,n),e=e.sibling;null!==e;)Pl(e,t,n),e=e.sibling}function Tl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==a&&(27===a&&Pu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Tl(e,t,n),e=e.sibling;null!==e;)Tl(e,t,n),e=e.sibling}function Al(e){var t=e.stateNode,n=e.memoizedProps;try{for(var a=e.type,s=t.attributes;s.length;)t.removeAttributeNode(s[0]);mu(t,a,n),t[Ve]=e,t[ze]=n}catch(r){Nd(e,e.return,r)}}var _l=!1,Il=!1,Dl=!1,Ol="function"==typeof WeakSet?WeakSet:Set,Fl=null;function Rl(e,t,n){var a=n.flags;switch(n.tag){case 0:case 11:case 15:Xl(e,n),4&a&&vl(5,n);break;case 1:if(Xl(e,n),4&a)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){Nd(n,n.return,o)}else{var s=Ni(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(s,t,e.__reactInternalSnapshotBeforeUpdate)}catch(i){Nd(n,n.return,i)}}64&a&&xl(n),512&a&&kl(n,n.return);break;case 3:if(Xl(e,n),64&a&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Pr(e,t)}catch(o){Nd(n,n.return,o)}}break;case 27:null===t&&4&a&&Al(n);case 26:case 5:Xl(e,n),null===t&&4&a&&Ml(n),512&a&&kl(n,n.return);break;case 12:Xl(e,n);break;case 31:Xl(e,n),4&a&&Ul(e,n);break;case 13:Xl(e,n),4&a&&Gl(e,n),64&a&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var a=function(){t(),n.removeEventListener("DOMContentLoaded",a)};n.addEventListener("DOMContentLoaded",a),e._reactRetry=a}}(e,n=Td.bind(null,n))));break;case 22:if(!(a=null!==n.memoizedState||_l)){t=null!==t&&null!==t.memoizedState||Il,s=_l;var r=Il;_l=a,(Il=t)&&!r?Zl(e,n,!!(8772&n.subtreeFlags)):Xl(e,n),_l=s,Il=r}break;case 30:break;default:Xl(e,n)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ll=null,Bl=!1;function Vl(e,t,n){for(n=n.child;null!==n;)zl(e,t,n),n=n.sibling}function zl(e,t,n){if(ge&&"function"==typeof ge.onCommitFiberUnmount)try{ge.onCommitFiberUnmount(ye,n)}catch(r){}switch(n.tag){case 26:Il||Sl(n,t),Vl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Il||Sl(n,t);var a=Ll,s=Bl;Pu(n.type)&&(Ll=n.stateNode,Bl=!1),Vl(e,t,n),Vu(n.stateNode),Ll=a,Bl=s;break;case 5:Il||Sl(n,t);case 6:if(a=Ll,s=Bl,Ll=null,Vl(e,t,n),Bl=s,null!==(Ll=a))if(Bl)try{(9===Ll.nodeType?Ll.body:"HTML"===Ll.nodeName?Ll.ownerDocument.body:Ll).removeChild(n.stateNode)}catch(o){Nd(n,t,o)}else try{Ll.removeChild(n.stateNode)}catch(o){Nd(n,t,o)}break;case 18:null!==Ll&&(Bl?(Tu(9===(e=Ll).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Hp(e)):Tu(Ll,n.stateNode));break;case 4:a=Ll,s=Bl,Ll=n.stateNode.containerInfo,Bl=!0,Vl(e,t,n),Ll=a,Bl=s;break;case 0:case 11:case 14:case 15:bl(2,n,t),Il||bl(4,n,t),Vl(e,t,n);break;case 1:Il||(Sl(n,t),"function"==typeof(a=n.stateNode).componentWillUnmount&&wl(n,t,a)),Vl(e,t,n);break;case 21:Vl(e,t,n);break;case 22:Il=(a=Il)||null!==n.memoizedState,Vl(e,t,n),Il=a;break;default:Vl(e,t,n)}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Hp(e)}catch(n){Nd(t,t.return,n)}}}function Gl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Hp(e)}catch(n){Nd(t,t.return,n)}}function Wl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Ol),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Ol),t;default:throw Error(a(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var a=Ad.bind(null,e,t);t.then(a,a)}})}function Kl(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var r=n[s],o=e,i=t,l=i;e:for(;null!==l;){switch(l.tag){case 27:if(Pu(l.type)){Ll=l.stateNode,Bl=!1;break e}break;case 5:Ll=l.stateNode,Bl=!1;break e;case 3:case 4:Ll=l.stateNode.containerInfo,Bl=!0;break e}l=l.return}if(null===Ll)throw Error(a(160));zl(o,i,r),Ll=null,Bl=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)$l(t,e),t=t.sibling}var Hl=null;function $l(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Kl(t,e),ql(e),4&s&&(bl(3,e,e.return),vl(3,e),bl(5,e,e.return));break;case 1:Kl(t,e),ql(e),512&s&&(Il||null===n||Sl(n,n.return)),64&s&&_l&&(null!==(e=e.updateQueue)&&(null!==(s=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?s:n.concat(s))));break;case 26:var r=Hl;if(Kl(t,e),ql(e),512&s&&(Il||null===n||Sl(n,n.return)),4&s){var o=null!==n?n.memoizedState:null;if(s=e.memoizedState,null===n)if(null===s)if(null===e.stateNode){e:{s=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(s){case"title":(!(o=r.getElementsByTagName("title")[0])||o[$e]||o[Ve]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(s),r.head.insertBefore(o,r.querySelector("head > title"))),mu(o,s,n),o[Ve]=e,Je(o),s=o;break e;case"link":var i=sp("link","href",r).get(s+(n.href||""));if(i)for(var l=0;l<i.length;l++)if((o=i[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){i.splice(l,1);break t}mu(o=r.createElement(s),s,n),r.head.appendChild(o);break;case"meta":if(i=sp("meta","content",r).get(s+(n.content||"")))for(l=0;l<i.length;l++)if((o=i[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){i.splice(l,1);break t}mu(o=r.createElement(s),s,n),r.head.appendChild(o);break;default:throw Error(a(468,s))}o[Ve]=e,Je(o),s=o}e.stateNode=s}else rp(r,e.type,e.stateNode);else e.stateNode=Ju(r,s,e.memoizedProps);else o!==s?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===s?rp(r,e.type,e.stateNode):Ju(r,s,e.memoizedProps)):null===s&&null!==e.stateNode&&Nl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Kl(t,e),ql(e),512&s&&(Il||null===n||Sl(n,n.return)),null!==n&&4&s&&Nl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Kl(t,e),ql(e),512&s&&(Il||null===n||Sl(n,n.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(f){Nd(e,e.return,f)}}4&s&&null!=e.stateNode&&Nl(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&s&&(Dl=!0);break;case 6:if(Kl(t,e),ql(e),4&s){if(null===e.stateNode)throw Error(a(162));s=e.memoizedProps,n=e.stateNode;try{n.nodeValue=s}catch(f){Nd(e,e.return,f)}}break;case 3:if(ap=null,r=Hl,Hl=Gu(t.containerInfo),Kl(t,e),Hl=r,ql(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Hp(t.containerInfo)}catch(f){Nd(e,e.return,f)}Dl&&(Dl=!1,Yl(e));break;case 4:s=Hl,Hl=Gu(e.stateNode.containerInfo),Kl(t,e),ql(e),Hl=s;break;case 12:default:Kl(t,e),ql(e);break;case 31:case 19:Kl(t,e),ql(e),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 13:Kl(t,e),ql(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Oc=ie()),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 22:r=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,d=_l,u=Il;if(_l=d||r,Il=u||c,Kl(t,e),Il=u,_l=d,ql(e),8192&s)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||c||_l||Il||Ql(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,r)"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{l=c.stateNode;var p=c.memoizedProps.style,h=null!=p&&p.hasOwnProperty("display")?p.display:null;l.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(f){Nd(c,c.return,f)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(f){Nd(c,c.return,f)}}}else if(18===t.tag){if(null===n){c=t;try{var m=c.stateNode;r?Au(m,!0):Au(c.stateNode,!1)}catch(f){Nd(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&s&&(null!==(s=e.updateQueue)&&(null!==(n=s.retryQueue)&&(s.retryQueue=null,Wl(e,n))));case 30:case 21:}}function ql(e){var t=e.flags;if(2&t){try{for(var n,s=e.return;null!==s;){if(Cl(s)){n=s;break}s=s.return}if(null==n)throw Error(a(160));switch(n.tag){case 27:var r=n.stateNode;Tl(e,El(e),r);break;case 5:var o=n.stateNode;32&n.flags&&(St(o,""),n.flags&=-33),Tl(e,El(e),o);break;case 3:case 4:var i=n.stateNode.containerInfo;Pl(e,El(e),i);break;default:throw Error(a(161))}}catch(l){Nd(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Yl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Yl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Xl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Rl(e,t.alternate,t),t=t.sibling}function Ql(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:bl(4,t,t.return),Ql(t);break;case 1:Sl(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&wl(t,t.return,n),Ql(t);break;case 27:Vu(t.stateNode);case 26:case 5:Sl(t,t.return),Ql(t);break;case 22:null===t.memoizedState&&Ql(t);break;default:Ql(t)}e=e.sibling}}function Zl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var a=t.alternate,s=e,r=t,o=r.flags;switch(r.tag){case 0:case 11:case 15:Zl(s,r,n),vl(4,r);break;case 1:if(Zl(s,r,n),"function"==typeof(s=(a=r).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){Nd(a,a.return,c)}if(null!==(s=(a=r).updateQueue)){var i=a.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)Er(l[s],i)}catch(c){Nd(a,a.return,c)}}n&&64&o&&xl(r),kl(r,r.return);break;case 27:Al(r);case 26:case 5:Zl(s,r,n),n&&null===a&&4&o&&Ml(r),kl(r,r.return);break;case 12:Zl(s,r,n);break;case 31:Zl(s,r,n),n&&4&o&&Ul(s,r);break;case 13:Zl(s,r,n),n&&4&o&&Gl(s,r);break;case 22:null===r.memoizedState&&Zl(s,r,n),kl(r,r.return);break;case 30:break;default:Zl(s,r,n)}t=t.sibling}}function Jl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Us(n))}function ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e))}function tc(e,t,n,a){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)nc(e,t,n,a),t=t.sibling}function nc(e,t,n,a){var s=t.flags;switch(t.tag){case 0:case 11:case 15:tc(e,t,n,a),2048&s&&vl(9,t);break;case 1:case 31:case 13:default:tc(e,t,n,a);break;case 3:tc(e,t,n,a),2048&s&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e)));break;case 12:if(2048&s){tc(e,t,n,a),e=t.stateNode;try{var r=t.memoizedProps,o=r.id,i=r.onPostCommit;"function"==typeof i&&i(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Nd(t,t.return,l)}}else tc(e,t,n,a);break;case 23:break;case 22:r=t.stateNode,o=t.alternate,null!==t.memoizedState?2&r._visibility?tc(e,t,n,a):sc(e,t):2&r._visibility?tc(e,t,n,a):(r._visibility|=2,ac(e,t,n,a,!!(10256&t.subtreeFlags)||!1)),2048&s&&Jl(o,t);break;case 24:tc(e,t,n,a),2048&s&&ec(t.alternate,t)}}function ac(e,t,n,a,s){for(s=s&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var r=e,o=t,i=n,l=a,c=o.flags;switch(o.tag){case 0:case 11:case 15:ac(r,o,i,l,s),vl(8,o);break;case 23:break;case 22:var d=o.stateNode;null!==o.memoizedState?2&d._visibility?ac(r,o,i,l,s):sc(r,o):(d._visibility|=2,ac(r,o,i,l,s)),s&&2048&c&&Jl(o.alternate,o);break;case 24:ac(r,o,i,l,s),s&&2048&c&&ec(o.alternate,o);break;default:ac(r,o,i,l,s)}t=t.sibling}}function sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,a=t,s=a.flags;switch(a.tag){case 22:sc(n,a),2048&s&&Jl(a.alternate,a);break;case 24:sc(n,a),2048&s&&ec(a.alternate,a);break;default:sc(n,a)}t=t.sibling}}var rc=8192;function oc(e,t,n){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)ic(e,t,n),e=e.sibling}function ic(e,t,n){switch(e.tag){case 26:oc(e,t,n),e.flags&rc&&null!==e.memoizedState&&function(e,t,n,a){if(!("stylesheet"!==n.type||"string"==typeof a.media&&!1===matchMedia(a.media).matches||4&n.state.loading)){if(null===n.instance){var s=qu(a.href),r=t.querySelector(Yu(s));if(r)return null!==(t=r._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=lp.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=r,void Je(r);r=t.ownerDocument||t,a=Xu(a),(s=zu.get(s))&&tp(a,s),Je(r=r.createElement("link"));var o=r;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),mu(r,"link",a),n.instance=r}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=lp.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Hl,e.memoizedState,e.memoizedProps);break;case 5:default:oc(e,t,n);break;case 3:case 4:var a=Hl;Hl=Gu(e.stateNode.containerInfo),oc(e,t,n),Hl=a;break;case 22:null===e.memoizedState&&(null!==(a=e.alternate)&&null!==a.memoizedState?(a=rc,rc=16777216,oc(e,t,n),rc=a):oc(e,t,n))}}function lc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];Fl=a,pc(a,e)}lc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)dc(e),e=e.sibling}function dc(e){switch(e.tag){case 0:case 11:case 15:cc(e),2048&e.flags&&bl(9,e,e.return);break;case 3:case 12:default:cc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,uc(e)):cc(e)}}function uc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];Fl=a,pc(a,e)}lc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:bl(8,t,t.return),uc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,uc(t));break;default:uc(t)}e=e.sibling}}function pc(e,t){for(;null!==Fl;){var n=Fl;switch(n.tag){case 0:case 11:case 15:bl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var a=n.memoizedState.cachePool.pool;null!=a&&a.refCount++}break;case 24:Us(n.memoizedState.cache)}if(null!==(a=n.child))a.return=n,Fl=a;else e:for(n=e;null!==Fl;){var s=(a=Fl).sibling,r=a.return;if(jl(a),a===n){Fl=null;break e}if(null!==s){s.return=r,Fl=s;break e}Fl=r}}}var hc={getCacheForType:function(e){var t=Os(Vs),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Os(Vs).controller.signal}},mc="function"==typeof WeakMap?WeakMap:Map,fc=0,yc=null,gc=null,vc=0,bc=0,xc=null,wc=!1,kc=!1,Sc=!1,Mc=0,Nc=0,Cc=0,Ec=0,Pc=0,Tc=0,Ac=0,_c=null,Ic=null,Dc=!1,Oc=0,Fc=0,Rc=1/0,jc=null,Lc=null,Bc=0,Vc=null,zc=null,Uc=0,Gc=0,Wc=null,Kc=null,Hc=0,$c=null;function qc(){return 2&fc&&0!==vc?vc&-vc:null!==D.T?Wd():je()}function Yc(){if(0===Tc)if(536870912&vc&&!hs)Tc=536870912;else{var e=Se;!(3932160&(Se<<=1))&&(Se=262144),Tc=e}return null!==(e=Or.current)&&(e.flags|=32),Tc}function Xc(e,t,n){(e!==yc||2!==bc&&9!==bc)&&null===e.cancelPendingCommit||(ad(e,0),ed(e,vc,Tc,!1)),_e(e,n),2&fc&&e===yc||(e===yc&&(!(2&fc)&&(Ec|=n),4===Nc&&ed(e,vc,Tc,!1)),jd(e))}function Qc(e,t,n){if(6&fc)throw Error(a(327));for(var s=!n&&!(127&t)&&0===(t&e.expiredLanes)||Ee(e,t),r=s?function(e,t){var n=fc;fc|=2;var s=od(),r=id();yc!==e||vc!==t?(jc=null,Rc=ie()+500,ad(e,t)):kc=Ee(e,t);e:for(;;)try{if(0!==bc&&null!==gc){t=gc;var o=xc;t:switch(bc){case 1:bc=0,xc=null,md(e,t,o,1);break;case 2:case 9:if(ar(o)){bc=0,xc=null,hd(t);break}t=function(){2!==bc&&9!==bc||yc!==e||(bc=7),jd(e)},o.then(t,t);break e;case 3:bc=7;break e;case 4:bc=5;break e;case 7:ar(o)?(bc=0,xc=null,hd(t)):(bc=0,xc=null,md(e,t,o,7));break;case 5:var i=null;switch(gc.tag){case 26:i=gc.memoizedState;case 5:case 27:var l=gc;if(i?op(i):l.stateNode.complete){bc=0,xc=null;var c=l.sibling;if(null!==c)gc=c;else{var d=l.return;null!==d?(gc=d,fd(d)):gc=null}break t}}bc=0,xc=null,md(e,t,o,5);break;case 6:bc=0,xc=null,md(e,t,o,6);break;case 8:nd(),Nc=6;break e;default:throw Error(a(462))}}ud();break}catch(u){sd(e,u)}return Cs=Ns=null,D.H=s,D.A=r,fc=n,null!==gc?0:(yc=null,vc=0,Ia(),Nc)}(e,t):cd(e,t,!0),o=s;;){if(0===r){kc&&!s&&ed(e,t,0,!1);break}if(n=e.current.alternate,!o||Jc(n)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){t=i;e:{var l=e;r=_c;var c=l.current.memoizedState.isDehydrated;if(c&&(ad(l,i).flags|=256),2!==(i=cd(l,i,!1))){if(Sc&&!c){l.errorRecoveryDisabledLanes|=o,Ec|=o,r=4;break e}o=Ic,Ic=r,null!==o&&(null===Ic?Ic=o:Ic.push.apply(Ic,o))}r=i}if(o=!1,2!==r)continue}}if(1===r){ad(e,0),ed(e,t,0,!0);break}e:{switch(s=e,o=r){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:ed(s,t,Tc,!wc);break e;case 2:Ic=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(r=Oc+300-ie())){if(ed(s,t,Tc,!wc),0!==Ce(s,0,!0))break e;Uc=t,s.timeoutHandle=Su(Zc.bind(null,s,n,Ic,jc,Dc,t,Tc,Ec,Ac,wc,o,"Throttled",-0,0),r)}else Zc(s,n,Ic,jc,Dc,t,Tc,Ec,Ac,wc,o,null,-0,0)}break}r=cd(e,t,!1),o=!1}jd(e)}function Zc(e,t,n,a,s,r,o,i,l,c,d,u,p,h){if(e.timeoutHandle=-1,8192&(u=t.subtreeFlags)||!(16785408&~u)){ic(t,r,u={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_t});var m=(62914560&r)===r?Oc-ie():(4194048&r)===r?Fc-ie():0;if(null!==(m=function(e,t){return e.stylesheets&&0===e.count&&dp(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var a=setTimeout(function(){if(e.stylesheets&&dp(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===ip&&(ip=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),a=0;a<n.length;a++){var s=n[a],r=s.transferSize,o=s.initiatorType,i=s.duration;if(r&&i&&fu(o)){for(o=0,i=s.responseEnd,a+=1;a<n.length;a++){var l=n[a],c=l.startTime;if(c>i)break;var d=l.transferSize,u=l.initiatorType;d&&fu(u)&&(o+=d*((l=l.responseEnd)<i?1:(i-c)/(l-c)))}if(--a,t+=8*(r+o)/(s.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var s=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&dp(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>ip?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(a),clearTimeout(s)}}:null}(u,m)))return Uc=r,e.cancelPendingCommit=m(gd.bind(null,e,t,r,n,a,s,o,i,l,d,u,null,p,h)),void ed(e,r,o,!c)}gd(e,t,r,n,a,s,o,i,l)}function Jc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var a=0;a<n.length;a++){var s=n[a],r=s.getSnapshot;s=s.value;try{if(!ea(r(),s))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ed(e,t,n,a){t&=~Pc,t&=~Ec,e.suspendedLanes|=t,e.pingedLanes&=~t,a&&(e.warmLanes|=t),a=e.expirationTimes;for(var s=t;0<s;){var r=31-be(s),o=1<<r;a[r]=-1,s&=~o}0!==n&&Ie(e,n,t)}function td(){return!!(6&fc)||(Ld(0),!1)}function nd(){if(null!==gc){if(0===bc)var e=gc.return;else Cs=Ns=null,lo(e=gc),cr=null,dr=0,e=gc;for(;null!==e;)gl(e.alternate,e),e=e.return;gc=null}}function ad(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Mu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Uc=0,nd(),yc=e,gc=n=Ua(e.current,null),vc=t,bc=0,xc=null,wc=!1,kc=Ee(e,t),Sc=!1,Ac=Tc=Pc=Ec=Cc=Nc=0,Ic=_c=null,Dc=!1,8&t&&(t|=32&t);var a=e.entangledLanes;if(0!==a)for(e=e.entanglements,a&=t;0<a;){var s=31-be(a),r=1<<s;t|=e[s],a&=~r}return Mc=t,Ia(),n}function sd(e,t){Wr=null,D.H=gi,t===Js||t===tr?(t=ir(),bc=3):t===er?(t=ir(),bc=4):bc=t===Oi?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,xc=t,null===gc&&(Nc=1,Ti(e,Xa(t,e.current)))}function rd(){var e=Or.current;return null===e||((4194048&vc)===vc?null===Fr:!!((62914560&vc)===vc||536870912&vc)&&e===Fr)}function od(){var e=D.H;return D.H=gi,null===e?gi:e}function id(){var e=D.A;return D.A=hc,e}function ld(){Nc=4,wc||(4194048&vc)!==vc&&null!==Or.current||(kc=!0),!(134217727&Cc)&&!(134217727&Ec)||null===yc||ed(yc,vc,Tc,!1)}function cd(e,t,n){var a=fc;fc|=2;var s=od(),r=id();yc===e&&vc===t||(jc=null,ad(e,t)),t=!1;var o=Nc;e:for(;;)try{if(0!==bc&&null!==gc){var i=gc,l=xc;switch(bc){case 8:nd(),o=6;break e;case 3:case 2:case 9:case 6:null===Or.current&&(t=!0);var c=bc;if(bc=0,xc=null,md(e,i,l,c),n&&kc){o=0;break e}break;default:c=bc,bc=0,xc=null,md(e,i,l,c)}}dd(),o=Nc;break}catch(d){sd(e,d)}return t&&e.shellSuspendCounter++,Cs=Ns=null,fc=a,D.H=s,D.A=r,null===gc&&(yc=null,vc=0,Ia()),o}function dd(){for(;null!==gc;)pd(gc)}function ud(){for(;null!==gc&&!re();)pd(gc)}function pd(e){var t=ll(e.alternate,e,Mc);e.memoizedProps=e.pendingProps,null===t?fd(e):gc=t}function hd(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=$i(n,t,t.pendingProps,t.type,void 0,vc);break;case 11:t=$i(n,t,t.pendingProps,t.type.render,t.ref,vc);break;case 5:lo(t);default:gl(n,t),t=ll(n,t=gc=Ga(t,Mc),Mc)}e.memoizedProps=e.pendingProps,null===t?fd(e):gc=t}function md(e,t,n,s){Cs=Ns=null,lo(t),cr=null,dr=0;var r=t.return;try{if(function(e,t,n,s,r){if(n.flags|=32768,null!==s&&"object"==typeof s&&"function"==typeof s.then){if(null!==(t=n.alternate)&&_s(t,n,r,!0),null!==(n=Or.current)){switch(n.tag){case 31:case 13:return null===Fr?ld():null===n.alternate&&0===Nc&&(Nc=3),n.flags&=-257,n.flags|=65536,n.lanes=r,s===nr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([s]):t.add(s),Cd(e,s,r)),!1;case 22:return n.flags|=65536,s===nr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([s]):n.add(s),Cd(e,s,r)),!1}throw Error(a(435,n.tag))}return Cd(e,s,r),ld(),!1}if(hs)return null!==(t=Or.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,s!==ys&&Ss(Xa(e=Error(a(422),{cause:s}),n))):(s!==ys&&Ss(Xa(t=Error(a(423),{cause:s}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,s=Xa(s,n),Sr(e,r=_i(e.stateNode,s,r)),4!==Nc&&(Nc=2)),!1;var o=Error(a(520),{cause:s});if(o=Xa(o,n),null===_c?_c=[o]:_c.push(o),4!==Nc&&(Nc=2),null===t)return!0;s=Xa(s,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,Sr(n,e=_i(n.stateNode,s,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==Lc&&Lc.has(o))))return n.flags|=65536,r&=-r,n.lanes|=r,Di(r=Ii(r),e,n,s),Sr(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,vc))return Nc=1,Ti(e,Xa(n,e.current)),void(gc=null)}catch(o){if(null!==r)throw gc=r,o;return Nc=1,Ti(e,Xa(n,e.current)),void(gc=null)}32768&t.flags?(hs||1===s?e=!0:kc||536870912&vc?e=!1:(wc=e=!0,(2===s||9===s||3===s||6===s)&&(null!==(s=Or.current)&&13===s.tag&&(s.flags|=16384))),yd(t,e)):fd(t)}function fd(e){var t=e;do{if(32768&t.flags)return void yd(t,wc);e=t.return;var n=fl(t.alternate,t,Mc);if(null!==n)return void(gc=n);if(null!==(t=t.sibling))return void(gc=t);gc=t=e}while(null!==t);0===Nc&&(Nc=5)}function yd(e,t){do{var n=yl(e.alternate,e);if(null!==n)return n.flags&=32767,void(gc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(gc=e);gc=e=n}while(null!==e);Nc=6,gc=null}function gd(e,t,n,s,r,o,i,l,c){e.cancelPendingCommit=null;do{kd()}while(0!==Bc);if(6&fc)throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(o=t.lanes|t.childLanes,function(e,t,n,a,s,r){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var d=31-be(n),u=1<<d;i[d]=0,l[d]=-1;var p=c[d];if(null!==p)for(c[d]=null,d=0;d<p.length;d++){var h=p[d];null!==h&&(h.lane&=-536870913)}n&=~u}0!==a&&Ie(e,a,0),0!==r&&0===s&&0!==e.tag&&(e.suspendedLanes|=r&~(o&~t))}(e,n,o|=_a,i,l,c),e===yc&&(gc=yc=null,vc=0),zc=t,Vc=e,Uc=n,Gc=o,Wc=r,Kc=s,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ae(ue,function(){return Sd(),null})):(e.callbackNode=null,e.callbackPriority=0),s=!!(13878&t.flags),13878&t.subtreeFlags||s){s=D.T,D.T=null,r=O.p,O.p=2,i=fc,fc|=4;try{!function(e,t){if(e=e.containerInfo,yu=wp,oa(e=ra(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch(y){n=null;break e}var i=0,l=-1,c=-1,d=0,u=0,p=e,h=null;t:for(;;){for(var m;p!==n||0!==r&&3!==p.nodeType||(l=i+r),p!==o||0!==s&&3!==p.nodeType||(c=i+s),3===p.nodeType&&(i+=p.nodeValue.length),null!==(m=p.firstChild);)h=p,p=m;for(;;){if(p===e)break t;if(h===n&&++d===r&&(l=i),h===o&&++u===s&&(c=i),null!==(m=p.nextSibling))break;h=(p=h).parentNode}p=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(gu={focusedElem:e,selectionRange:n},wp=!1,Fl=t;null!==Fl;)if(e=(t=Fl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fl=e;else for(;null!==Fl;){switch(o=(t=Fl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(r=e[n]).ref.impl=r.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==o){e=void 0,n=t,r=o.memoizedProps,o=o.memoizedState,s=n.stateNode;try{var f=Ni(n.type,r);e=s.getSnapshotBeforeUpdate(f,o),s.__reactInternalSnapshotBeforeUpdate=e}catch(g){Nd(n,n.return,g)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))_u(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":_u(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Fl=e;break}Fl=t.return}}(e,t)}finally{fc=i,O.p=r,D.T=s}}Bc=1,vd(),bd(),xd()}}function vd(){if(1===Bc){Bc=0;var e=Vc,t=zc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=D.T,D.T=null;var a=O.p;O.p=2;var s=fc;fc|=4;try{$l(t,e);var r=gu,o=ra(e.containerInfo),i=r.focusedElem,l=r.selectionRange;if(o!==i&&i&&i.ownerDocument&&sa(i.ownerDocument.documentElement,i)){if(null!==l&&oa(i)){var c=l.start,d=l.end;if(void 0===d&&(d=c),"selectionStart"in i)i.selectionStart=c,i.selectionEnd=Math.min(d,i.value.length);else{var u=i.ownerDocument||document,p=u&&u.defaultView||window;if(p.getSelection){var h=p.getSelection(),m=i.textContent.length,f=Math.min(l.start,m),y=void 0===l.end?f:Math.min(l.end,m);!h.extend&&f>y&&(o=y,y=f,f=o);var g=aa(i,f),v=aa(i,y);if(g&&v&&(1!==h.rangeCount||h.anchorNode!==g.node||h.anchorOffset!==g.offset||h.focusNode!==v.node||h.focusOffset!==v.offset)){var b=u.createRange();b.setStart(g.node,g.offset),h.removeAllRanges(),f>y?(h.addRange(b),h.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),h.addRange(b))}}}}for(u=[],h=i;h=h.parentNode;)1===h.nodeType&&u.push({element:h,left:h.scrollLeft,top:h.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<u.length;i++){var x=u[i];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}wp=!!yu,gu=yu=null}finally{fc=s,O.p=a,D.T=n}}e.current=t,Bc=2}}function bd(){if(2===Bc){Bc=0;var e=Vc,t=zc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=D.T,D.T=null;var a=O.p;O.p=2;var s=fc;fc|=4;try{Rl(e,t.alternate,t)}finally{fc=s,O.p=a,D.T=n}}Bc=3}}function xd(){if(4===Bc||3===Bc){Bc=0,oe();var e=Vc,t=zc,n=Uc,a=Kc;10256&t.subtreeFlags||10256&t.flags?Bc=5:(Bc=0,zc=Vc=null,wd(e,e.pendingLanes));var s=e.pendingLanes;if(0===s&&(Lc=null),Re(n),t=t.stateNode,ge&&"function"==typeof ge.onCommitFiberRoot)try{ge.onCommitFiberRoot(ye,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==a){t=D.T,s=O.p,O.p=2,D.T=null;try{for(var r=e.onRecoverableError,o=0;o<a.length;o++){var i=a[o];r(i.value,{componentStack:i.stack})}}finally{D.T=t,O.p=s}}3&Uc&&kd(),jd(e),s=e.pendingLanes,261930&n&&42&s?e===$c?Hc++:(Hc=0,$c=e):Hc=0,Ld(0)}}function wd(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Us(t)))}function kd(){return vd(),bd(),xd(),Sd()}function Sd(){if(5!==Bc)return!1;var e=Vc,t=Gc;Gc=0;var n=Re(Uc),s=D.T,r=O.p;try{O.p=32>n?32:n,D.T=null,n=Wc,Wc=null;var o=Vc,i=Uc;if(Bc=0,zc=Vc=null,Uc=0,6&fc)throw Error(a(331));var l=fc;if(fc|=4,dc(o.current),nc(o,o.current,i,n),fc=l,Ld(0,!1),ge&&"function"==typeof ge.onPostCommitFiberRoot)try{ge.onPostCommitFiberRoot(ye,o)}catch(c){}return!0}finally{O.p=r,D.T=s,wd(e,t)}}function Md(e,t,n){t=Xa(n,t),null!==(e=wr(e,t=_i(e.stateNode,t,2),2))&&(_e(e,2),jd(e))}function Nd(e,t,n){if(3===e.tag)Md(e,e,n);else for(;null!==t;){if(3===t.tag){Md(t,e,n);break}if(1===t.tag){var a=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof a.componentDidCatch&&(null===Lc||!Lc.has(a))){e=Xa(n,e),null!==(a=wr(t,n=Ii(2),2))&&(Di(n,a,t,e),_e(a,2),jd(a));break}}t=t.return}}function Cd(e,t,n){var a=e.pingCache;if(null===a){a=e.pingCache=new mc;var s=new Set;a.set(t,s)}else void 0===(s=a.get(t))&&(s=new Set,a.set(t,s));s.has(n)||(Sc=!0,s.add(n),e=Ed.bind(null,e,t,n),t.then(e,e))}function Ed(e,t,n){var a=e.pingCache;null!==a&&a.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,yc===e&&(vc&n)===n&&(4===Nc||3===Nc&&(62914560&vc)===vc&&300>ie()-Oc?!(2&fc)&&ad(e,0):Pc|=n,Ac===vc&&(Ac=0)),jd(e)}function Pd(e,t){0===t&&(t=Te()),null!==(e=Fa(e,t))&&(_e(e,t),jd(e))}function Td(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Pd(e,n)}function Ad(e,t){var n=0;switch(e.tag){case 31:case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==s&&s.delete(t),Pd(e,n)}var _d=null,Id=null,Dd=!1,Od=!1,Fd=!1,Rd=0;function jd(e){e!==Id&&null===e.next&&(null===Id?_d=Id=e:Id=Id.next=e),Od=!0,Dd||(Dd=!0,Cu(function(){6&fc?ae(ce,Bd):Vd()}))}function Ld(e,t){if(!Fd&&Od){Fd=!0;do{for(var n=!1,a=_d;null!==a;){if(0!==e){var s=a.pendingLanes;if(0===s)var r=0;else{var o=a.suspendedLanes,i=a.pingedLanes;r=(1<<31-be(42|e)+1)-1,r=201326741&(r&=s&~(o&~i))?201326741&r|1:r?2|r:0}0!==r&&(n=!0,Gd(a,r))}else r=vc,!(3&(r=Ce(a,a===yc?r:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle)))||Ee(a,r)||(n=!0,Gd(a,r));a=a.next}}while(n);Fd=!1}}function Bd(){Vd()}function Vd(){Od=Dd=!1;var e=0;0!==Rd&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ku&&(ku=e,!0);return ku=null,!1}()&&(e=Rd);for(var t=ie(),n=null,a=_d;null!==a;){var s=a.next,r=zd(a,t);0===r?(a.next=null,null===n?_d=s:n.next=s,null===s&&(Id=n)):(n=a,(0!==e||3&r)&&(Od=!0)),a=s}0!==Bc&&5!==Bc||Ld(e),0!==Rd&&(Rd=0)}function zd(e,t){for(var n=e.suspendedLanes,a=e.pingedLanes,s=e.expirationTimes,r=-62914561&e.pendingLanes;0<r;){var o=31-be(r),i=1<<o,l=s[o];-1===l?0!==(i&n)&&0===(i&a)||(s[o]=Pe(i,t)):l<=t&&(e.expiredLanes|=i),r&=~i}if(n=vc,n=Ce(e,e===(t=yc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),a=e.callbackNode,0===n||e===t&&(2===bc||9===bc)||null!==e.cancelPendingCommit)return null!==a&&null!==a&&se(a),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Ee(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==a&&se(a),Re(n)){case 2:case 8:n=de;break;case 32:default:n=ue;break;case 268435456:n=he}return a=Ud.bind(null,e),n=ae(n,a),e.callbackPriority=t,e.callbackNode=n,t}return null!==a&&null!==a&&se(a),e.callbackPriority=2,e.callbackNode=null,2}function Ud(e,t){if(0!==Bc&&5!==Bc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(kd()&&e.callbackNode!==n)return null;var a=vc;return 0===(a=Ce(e,e===yc?a:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Qc(e,a,t),zd(e,ie()),null!=e.callbackNode&&e.callbackNode===n?Ud.bind(null,e):null)}function Gd(e,t){if(kd())return null;Qc(e,t,!0)}function Wd(){if(0===Rd){var e=Ks;0===e&&(e=ke,!(261888&(ke<<=1))&&(ke=256)),Rd=e}return Rd}function Kd(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:At(""+e)}function Hd(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var $d=0;$d<Ca.length;$d++){var qd=Ca[$d];Ea(qd.toLowerCase(),"on"+(qd[0].toUpperCase()+qd.slice(1)))}Ea(va,"onAnimationEnd"),Ea(ba,"onAnimationIteration"),Ea(xa,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(wa,"onTransitionRun"),Ea(ka,"onTransitionStart"),Ea(Sa,"onTransitionCancel"),Ea(Ma,"onTransitionEnd"),at("onMouseEnter",["mouseout","mouseover"]),at("onMouseLeave",["mouseout","mouseover"]),at("onPointerEnter",["pointerout","pointerover"]),at("onPointerLeave",["pointerout","pointerover"]),nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yd));function Qd(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var a=e[n],s=a.event;a=a.listeners;e:{var r=void 0;if(t)for(var o=a.length-1;0<=o;o--){var i=a[o],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==r&&s.isPropagationStopped())break e;r=i,s.currentTarget=c;try{r(s)}catch(d){Pa(d)}s.currentTarget=null,r=l}else for(o=0;o<a.length;o++){if(l=(i=a[o]).instance,c=i.currentTarget,i=i.listener,l!==r&&s.isPropagationStopped())break e;r=i,s.currentTarget=c;try{r(s)}catch(d){Pa(d)}s.currentTarget=null,r=l}}}}function Zd(e,t){var n=t[Ge];void 0===n&&(n=t[Ge]=new Set);var a=e+"__bubble";n.has(a)||(nu(t,e,2,!1),n.add(a))}function Jd(e,t,n){var a=0;t&&(a|=4),nu(n,e,a,t)}var eu="_reactListening"+Math.random().toString(36).slice(2);function tu(e){if(!e[eu]){e[eu]=!0,et.forEach(function(t){"selectionchange"!==t&&(Xd.has(t)||Jd(t,!1,e),Jd(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[eu]||(t[eu]=!0,Jd("selectionchange",!1,t))}}function nu(e,t,n,a){switch(Pp(t)){case 2:var s=kp;break;case 8:s=Sp;break;default:s=Mp}n=s.bind(null,t,n,e),s=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),a?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function au(e,t,n,a,s){var o=a;if(!(1&t||2&t||null===a))e:for(;;){if(null===a)return;var i=a.tag;if(3===i||4===i){var l=a.stateNode.containerInfo;if(l===s)break;if(4===i)for(i=a.return;null!==i;){var c=i.tag;if((3===c||4===c)&&i.stateNode.containerInfo===s)return;i=i.return}for(;null!==l;){if(null===(i=Ye(l)))return;if(5===(c=i.tag)||6===c||26===c||27===c){a=o=i;continue e}l=l.parentNode}}a=a.return}Lt(function(){var a=o,s=Dt(n),i=[];e:{var l=Na.get(e);if(void 0!==l){var c=tn,d=e;switch(e){case"keypress":if(0===$t(n))break e;case"keydown":case"keyup":c=gn;break;case"focusin":d="focus",c=ln;break;case"focusout":d="blur",c=ln;break;case"beforeblur":case"afterblur":c=ln;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=xn;break;case va:case ba:case xa:c=cn;break;case Ma:c=wn;break;case"scroll":case"scrollend":c=an;break;case"wheel":c=kn;break;case"copy":case"cut":case"paste":c=dn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=vn;break;case"toggle":case"beforetoggle":c=Mn}var u=!!(4&t),p=!u&&("scroll"===e||"scrollend"===e),h=u?null!==l?l+"Capture":null:l;u=[];for(var m,f=a;null!==f;){var y=f;if(m=y.stateNode,5!==(y=y.tag)&&26!==y&&27!==y||null===m||null===h||null!=(y=Bt(f,h))&&u.push(su(f,y,m)),p)break;f=f.return}0<u.length&&(l=new c(l,d,null,n,s),i.push({event:l,listeners:u}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===It||!(d=n.relatedTarget||n.fromElement)||!Ye(d)&&!d[Ue])&&(c||l)&&(l=s.window===s?s:(l=s.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=a,null!==(d=(d=n.relatedTarget||n.toElement)?Ye(d):null)&&(p=r(d),u=d.tag,d!==p||5!==u&&27!==u&&6!==u)&&(d=null)):(c=null,d=a),c!==d)){if(u=rn,y="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=vn,y="onPointerLeave",h="onPointerEnter",f="pointer"),p=null==c?l:Qe(c),m=null==d?l:Qe(d),(l=new u(y,f+"leave",c,n,s)).target=p,l.relatedTarget=m,y=null,Ye(s)===a&&((u=new u(h,f+"enter",d,n,s)).target=m,u.relatedTarget=p,y=u),p=y,c&&d)e:{for(u=ou,f=d,m=0,y=h=c;y;y=u(y))m++;y=0;for(var g=f;g;g=u(g))y++;for(;0<m-y;)h=u(h),m--;for(;0<y-m;)f=u(f),y--;for(;m--;){if(h===f||null!==f&&h===f.alternate){u=h;break e}h=u(h),f=u(f)}u=null}else u=null;null!==c&&iu(i,l,c,u,!1),null!==d&&null!==p&&iu(i,p,d,u,!0)}if("select"===(c=(l=a?Qe(a):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var v=Gn;else if(jn(l))if(Wn)v=Jn;else{v=Qn;var b=Xn}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?a&&Et(a.elementType)&&(v=Gn):v=Zn;switch(v&&(v=v(e,a))?Ln(i,v,n,s):(b&&b(e,l,a),"focusout"===e&&a&&"number"===l.type&&null!=a.memoizedProps.value&&bt(l,"number",l.value)),b=a?Qe(a):window,e){case"focusin":(jn(b)||"true"===b.contentEditable)&&(la=b,ca=a,da=null);break;case"focusout":da=ca=la=null;break;case"mousedown":ua=!0;break;case"contextmenu":case"mouseup":case"dragend":ua=!1,pa(i,n,s);break;case"selectionchange":if(ia)break;case"keydown":case"keyup":pa(i,n,s)}var x;if(En)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Fn?Dn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(An&&"ko"!==n.locale&&(Fn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Fn&&(x=Ht()):(Wt="value"in(Gt=s)?Gt.value:Gt.textContent,Fn=!0)),0<(b=ru(a,w)).length&&(w=new un(w,e,null,n,s),i.push({event:w,listeners:b}),x?w.data=x:null!==(x=On(n))&&(w.data=x))),(x=Tn?function(e,t){switch(e){case"compositionend":return On(t);case"keypress":return 32!==t.which?null:(In=!0,_n);case"textInput":return(e=t.data)===_n&&In?null:e;default:return null}}(e,n):function(e,t){if(Fn)return"compositionend"===e||!En&&Dn(e,t)?(e=Ht(),Kt=Wt=Gt=null,Fn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return An&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=ru(a,"onBeforeInput")).length&&(b=new un("onBeforeInput","beforeinput",null,n,s),i.push({event:b,listeners:w}),b.data=x)),function(e,t,n,a,s){if("submit"===t&&n&&n.stateNode===s){var r=Kd((s[ze]||null).action),o=a.submitter;o&&null!==(t=(t=o[ze]||null)?Kd(t.formAction):o.getAttribute("formAction"))&&(r=t,o=null);var i=new tn("action","action",null,a,s);e.push({event:i,listeners:[{instance:null,listener:function(){if(a.defaultPrevented){if(0!==Rd){var e=o?Hd(s,o):new FormData(s);ai(n,{pending:!0,data:e,method:s.method,action:r},null,e)}}else"function"==typeof r&&(i.preventDefault(),e=o?Hd(s,o):new FormData(s),ai(n,{pending:!0,data:e,method:s.method,action:r},r,e))},currentTarget:s}]})}}(i,e,a,n,s)}Qd(i,t)})}function su(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ru(e,t){for(var n=t+"Capture",a=[];null!==e;){var s=e,r=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===r||(null!=(s=Bt(e,n))&&a.unshift(su(e,s,r)),null!=(s=Bt(e,t))&&a.push(su(e,s,r))),3===e.tag)return a;e=e.return}return[]}function ou(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function iu(e,t,n,a,s){for(var r=t._reactName,o=[];null!==n&&n!==a;){var i=n,l=i.alternate,c=i.stateNode;if(i=i.tag,null!==l&&l===a)break;5!==i&&26!==i&&27!==i||null===c||(l=c,s?null!=(c=Bt(n,r))&&o.unshift(su(n,c,l)):s||null!=(c=Bt(n,r))&&o.push(su(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var lu=/\r\n?/g,cu=/\u0000|\uFFFD/g;function du(e){return("string"==typeof e?e:""+e).replace(lu,"\n").replace(cu,"")}function uu(e,t){return t=du(t),du(e)===t}function pu(e,t,n,s,r,o){switch(n){case"children":"string"==typeof s?"body"===t||"textarea"===t&&""===s||St(e,s):("number"==typeof s||"bigint"==typeof s)&&"body"!==t&&St(e,""+s);break;case"className":lt(e,"class",s);break;case"tabIndex":lt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":lt(e,n,s);break;case"style":Ct(e,s,o);break;case"data":if("object"!==t){lt(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==s||"function"==typeof s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}s=At(""+s),e.setAttribute(n,s);break;case"action":case"formAction":if("function"==typeof s){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&pu(e,t,"name",r.name,r,null),pu(e,t,"formEncType",r.formEncType,r,null),pu(e,t,"formMethod",r.formMethod,r,null),pu(e,t,"formTarget",r.formTarget,r,null)):(pu(e,t,"encType",r.encType,r,null),pu(e,t,"method",r.method,r,null),pu(e,t,"target",r.target,r,null))),null==s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}s=At(""+s),e.setAttribute(n,s);break;case"onClick":null!=s&&(e.onclick=_t);break;case"onScroll":null!=s&&Zd("scroll",e);break;case"onScrollEnd":null!=s&&Zd("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"muted":e.muted=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"==typeof s||"boolean"==typeof s||"symbol"==typeof s){e.removeAttribute("xlink:href");break}n=At(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,""+s):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===s?e.setAttribute(n,""):!1!==s&&null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,s):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&!isNaN(s)&&1<=s?e.setAttribute(n,s):e.removeAttribute(n);break;case"rowSpan":case"start":null==s||"function"==typeof s||"symbol"==typeof s||isNaN(s)?e.removeAttribute(n):e.setAttribute(n,s);break;case"popover":Zd("beforetoggle",e),Zd("toggle",e),it(e,"popover",s);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":it(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&it(e,n=Pt.get(n)||n,s)}}function hu(e,t,n,s,r,o){switch(n){case"style":Ct(e,s,o);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(a(61));if(null!=(n=s.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"==typeof s?St(e,s):("number"==typeof s||"bigint"==typeof s)&&St(e,""+s);break;case"onScroll":null!=s&&Zd("scroll",e);break;case"onScrollEnd":null!=s&&Zd("scrollend",e);break;case"onClick":null!=s&&(e.onclick=_t);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:tt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"==typeof(o=null!=(o=e[ze]||null)?o[n]:null)&&e.removeEventListener(t,o,r),"function"!=typeof s)?n in e?e[n]=s:!0===s?e.setAttribute(n,""):it(e,n,s):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,s,r)))}}function mu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zd("error",e),Zd("load",e);var s,r=!1,o=!1;for(s in n)if(n.hasOwnProperty(s)){var i=n[s];if(null!=i)switch(s){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:pu(e,t,s,i,n,null)}}return o&&pu(e,t,"srcSet",n.srcSet,n,null),void(r&&pu(e,t,"src",n.src,n,null));case"input":Zd("invalid",e);var l=s=i=o=null,c=null,d=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(null!=u)switch(r){case"name":o=u;break;case"type":i=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":s=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:pu(e,t,r,u,n,null)}}return void vt(e,s,l,c,d,i,o,!1);case"select":for(o in Zd("invalid",e),r=i=s=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":s=l;break;case"defaultValue":i=l;break;case"multiple":r=l;default:pu(e,t,o,l,n,null)}return t=s,n=i,e.multiple=!!r,void(null!=t?xt(e,!!r,t,!1):null!=n&&xt(e,!!r,n,!0));case"textarea":for(i in Zd("invalid",e),s=o=r=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":r=l;break;case"defaultValue":o=l;break;case"children":s=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:pu(e,t,i,l,n,null)}return void kt(e,r,o,s);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(r=n[c]))if("selected"===c)e.selected=r&&"function"!=typeof r&&"symbol"!=typeof r;else pu(e,t,c,r,n,null);return;case"dialog":Zd("beforetoggle",e),Zd("toggle",e),Zd("cancel",e),Zd("close",e);break;case"iframe":case"object":Zd("load",e);break;case"video":case"audio":for(r=0;r<Yd.length;r++)Zd(Yd[r],e);break;case"image":Zd("error",e),Zd("load",e);break;case"details":Zd("toggle",e);break;case"embed":case"source":case"link":Zd("error",e),Zd("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(r=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:pu(e,t,d,r,n,null)}return;default:if(Et(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(r=n[u])&&hu(e,t,u,r,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(r=n[l])&&pu(e,t,l,r,n,null))}function fu(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var yu=null,gu=null;function vu(e){return 9===e.nodeType?e:e.ownerDocument}function bu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xu(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function wu(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ku=null;var Su="function"==typeof setTimeout?setTimeout:void 0,Mu="function"==typeof clearTimeout?clearTimeout:void 0,Nu="function"==typeof Promise?Promise:void 0,Cu="function"==typeof queueMicrotask?queueMicrotask:void 0!==Nu?function(e){return Nu.resolve(null).then(e).catch(Eu)}:Su;function Eu(e){setTimeout(function(){throw e})}function Pu(e){return"head"===e}function Tu(e,t){var n=t,a=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)||"/&"===n){if(0===a)return e.removeChild(s),void Hp(t);a--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)a++;else if("html"===n)Vu(e.ownerDocument.documentElement);else if("head"===n){Vu(n=e.ownerDocument.head);for(var r=n.firstChild;r;){var o=r.nextSibling,i=r.nodeName;r[$e]||"SCRIPT"===i||"STYLE"===i||"LINK"===i&&"stylesheet"===r.rel.toLowerCase()||n.removeChild(r),r=o}}else"body"===n&&Vu(e.ownerDocument.body);n=s}while(n);Hp(t)}function Au(e,t){var n=e;e=0;do{var a=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=a}while(n)}function _u(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":_u(n),qe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Iu(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Fu(e.nextSibling)))return null}return e}function Du(e){return"$?"===e.data||"$~"===e.data}function Ou(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Fu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Ru=null;function ju(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Fu(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Lu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Bu(e,t,n){switch(t=vu(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function Vu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);qe(e)}var zu=new Map,Uu=new Set;function Gu(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Wu=O.d;O.d={f:function(){var e=Wu.f(),t=td();return e||t},r:function(e){var t=Xe(e);null!==t&&5===t.tag&&"form"===t.type?ri(t):Wu.r(e)},D:function(e){Wu.D(e),Hu("dns-prefetch",e,null)},C:function(e,t){Wu.C(e,t),Hu("preconnect",e,t)},L:function(e,t,n){Wu.L(e,t,n);var a=Ku;if(a&&e&&t){var s='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(s+='[imagesrcset="'+yt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(s+='[imagesizes="'+yt(n.imageSizes)+'"]')):s+='[href="'+yt(e)+'"]';var r=s;switch(t){case"style":r=qu(e);break;case"script":r=Qu(e)}zu.has(r)||(e=p({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),zu.set(r,e),null!==a.querySelector(s)||"style"===t&&a.querySelector(Yu(r))||"script"===t&&a.querySelector(Zu(r))||(mu(t=a.createElement("link"),"link",e),Je(t),a.head.appendChild(t)))}},m:function(e,t){Wu.m(e,t);var n=Ku;if(n&&e){var a=t&&"string"==typeof t.as?t.as:"script",s='link[rel="modulepreload"][as="'+yt(a)+'"][href="'+yt(e)+'"]',r=s;switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Qu(e)}if(!zu.has(r)&&(e=p({rel:"modulepreload",href:e},t),zu.set(r,e),null===n.querySelector(s))){switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Zu(r)))return}mu(a=n.createElement("link"),"link",e),Je(a),n.head.appendChild(a)}}},X:function(e,t){Wu.X(e,t);var n=Ku;if(n&&e){var a=Ze(n).hoistableScripts,s=Qu(e),r=a.get(s);r||((r=n.querySelector(Zu(s)))||(e=p({src:e,async:!0},t),(t=zu.get(s))&&np(e,t),Je(r=n.createElement("script")),mu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},a.set(s,r))}},S:function(e,t,n){Wu.S(e,t,n);var a=Ku;if(a&&e){var s=Ze(a).hoistableStyles,r=qu(e);t=t||"default";var o=s.get(r);if(!o){var i={loading:0,preload:null};if(o=a.querySelector(Yu(r)))i.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},n),(n=zu.get(r))&&tp(e,n);var l=o=a.createElement("link");Je(l),mu(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){i.loading|=1}),l.addEventListener("error",function(){i.loading|=2}),i.loading|=4,ep(o,t,a)}o={type:"stylesheet",instance:o,count:1,state:i},s.set(r,o)}}},M:function(e,t){Wu.M(e,t);var n=Ku;if(n&&e){var a=Ze(n).hoistableScripts,s=Qu(e),r=a.get(s);r||((r=n.querySelector(Zu(s)))||(e=p({src:e,async:!0,type:"module"},t),(t=zu.get(s))&&np(e,t),Je(r=n.createElement("script")),mu(r,"link",e),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},a.set(s,r))}}};var Ku="undefined"==typeof document?null:document;function Hu(e,t,n){var a=Ku;if(a&&"string"==typeof t&&t){var s=yt(t);s='link[rel="'+e+'"][href="'+s+'"]',"string"==typeof n&&(s+='[crossorigin="'+n+'"]'),Uu.has(s)||(Uu.add(s),e={rel:e,crossOrigin:n,href:t},null===a.querySelector(s)&&(mu(t=a.createElement("link"),"link",e),Je(t),a.head.appendChild(t)))}}function $u(e,t,n,s){var r,o,i,l,c=(c=K.current)?Gu(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=qu(n.href),(s=(n=Ze(c).hoistableStyles).get(t))||(s={type:"style",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=qu(n.href);var d=Ze(c).hoistableStyles,u=d.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=c.querySelector(Yu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),zu.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},zu.set(e,n),d||(r=c,o=e,i=n,l=u.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=r.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),mu(o,"link",i),Je(o),r.head.appendChild(o))))),t&&null===s)throw Error(a(528,""));return u}if(t&&null!==s)throw Error(a(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Qu(n),(s=(n=Ze(c).hoistableScripts).get(t))||(s={type:"script",instance:null,count:0,state:null},n.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function qu(e){return'href="'+yt(e)+'"'}function Yu(e){return'link[rel="stylesheet"]['+e+"]"}function Xu(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Qu(e){return'[src="'+yt(e)+'"]'}function Zu(e){return"script[async]"+e}function Ju(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+yt(n.href)+'"]');if(s)return t.instance=s,Je(s),s;var r=p({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Je(s=(e.ownerDocument||e).createElement("style")),mu(s,"style",r),ep(s,n.precedence,e),t.instance=s;case"stylesheet":r=qu(n.href);var o=e.querySelector(Yu(r));if(o)return t.state.loading|=4,t.instance=o,Je(o),o;s=Xu(n),(r=zu.get(r))&&tp(s,r),Je(o=(e.ownerDocument||e).createElement("link"));var i=o;return i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),mu(o,"link",s),t.state.loading|=4,ep(o,n.precedence,e),t.instance=o;case"script":return o=Qu(n.src),(r=e.querySelector(Zu(o)))?(t.instance=r,Je(r),r):(s=n,(r=zu.get(o))&&np(s=p({},n),r),Je(r=(e=e.ownerDocument||e).createElement("script")),mu(r,"link",s),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(s=t.instance,t.state.loading|=4,ep(s,n.precedence,e));return t.instance}function ep(e,t,n){for(var a=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=a.length?a[a.length-1]:null,r=s,o=0;o<a.length;o++){var i=a[o];if(i.dataset.precedence===t)r=i;else if(r!==s)break}r?r.parentNode.insertBefore(e,r.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function tp(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function np(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var ap=null;function sp(e,t,n){if(null===ap){var a=new Map,s=ap=new Map;s.set(n,a)}else(a=(s=ap).get(n))||(a=new Map,s.set(n,a));if(a.has(e))return a;for(a.set(e,null),n=n.getElementsByTagName(e),s=0;s<n.length;s++){var r=n[s];if(!(r[$e]||r[Ve]||"link"===e&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var o=r.getAttribute(t)||"";o=e+o;var i=a.get(o);i?i.push(r):a.set(o,[r])}}return a}function rp(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function op(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var ip=0;function lp(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)dp(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var cp=null;function dp(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cp=new Map,t.forEach(up,e),cp=null,lp.call(e))}function up(e,t){if(!(4&t.state.loading)){var n=cp.get(e);if(n)var a=n.get(null);else{n=new Map,cp.set(e,n);for(var s=e.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var o=s[r];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),a=o)}a&&n.set(null,a)}o=(s=t.instance).getAttribute("data-precedence"),(r=n.get(o)||a)===a&&n.set(null,s),n.set(o,s),this.count++,a=lp.bind(this),s.addEventListener("load",a),s.addEventListener("error",a),r?r.parentNode.insertBefore(s,r.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(s,e.firstChild),t.state.loading|=4}}var pp={$$typeof:x,Provider:null,Consumer:null,_currentValue:F,_currentValue2:F,_threadCount:0};function hp(e,t,n,a,s,r,o,i,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ae(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ae(0),this.hiddenUpdates=Ae(null),this.identifierPrefix=a,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function mp(e,t,n,a,s,r,o,i,l,c,d,u){return e=new hp(e,t,n,o,l,c,d,u,i),t=1,!0===r&&(t|=24),r=Va(3,null,null,t),e.current=r,r.stateNode=e,(t=zs()).refCount++,e.pooledCache=t,t.refCount++,r.memoizedState={element:a,isDehydrated:n,cache:t},vr(r),e}function fp(e){return e?e=La:La}function yp(e,t,n,a,s,r){s=fp(s),null===a.context?a.context=s:a.pendingContext=s,(a=xr(t)).payload={element:n},null!==(r=void 0===r?null:r)&&(a.callback=r),null!==(n=wr(e,a,t))&&(Xc(n,0,t),kr(n,e,t))}function gp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function vp(e,t){gp(e,t),(e=e.alternate)&&gp(e,t)}function bp(e){if(13===e.tag||31===e.tag){var t=Fa(e,67108864);null!==t&&Xc(t,0,67108864),vp(e,67108864)}}function xp(e){if(13===e.tag||31===e.tag){var t=qc(),n=Fa(e,t=Fe(t));null!==n&&Xc(n,0,t),vp(e,t)}}var wp=!0;function kp(e,t,n,a){var s=D.T;D.T=null;var r=O.p;try{O.p=2,Mp(e,t,n,a)}finally{O.p=r,D.T=s}}function Sp(e,t,n,a){var s=D.T;D.T=null;var r=O.p;try{O.p=8,Mp(e,t,n,a)}finally{O.p=r,D.T=s}}function Mp(e,t,n,a){if(wp){var s=Np(a);if(null===s)au(e,t,a,Cp,n),jp(e,a);else if(function(e,t,n,a,s){switch(t){case"focusin":return Ap=Lp(Ap,e,t,n,a,s),!0;case"dragenter":return _p=Lp(_p,e,t,n,a,s),!0;case"mouseover":return Ip=Lp(Ip,e,t,n,a,s),!0;case"pointerover":var r=s.pointerId;return Dp.set(r,Lp(Dp.get(r)||null,e,t,n,a,s)),!0;case"gotpointercapture":return r=s.pointerId,Op.set(r,Lp(Op.get(r)||null,e,t,n,a,s)),!0}return!1}(s,e,t,n,a))a.stopPropagation();else if(jp(e,a),4&t&&-1<Rp.indexOf(e)){for(;null!==s;){var r=Xe(s);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var o=Ne(r.pendingLanes);if(0!==o){var i=r;for(i.pendingLanes|=2,i.entangledLanes|=2;o;){var l=1<<31-be(o);i.entanglements[1]|=l,o&=~l}jd(r),!(6&fc)&&(Rc=ie()+500,Ld(0))}}break;case 31:case 13:null!==(i=Fa(r,2))&&Xc(i,0,2),td(),vp(r,2)}if(null===(r=Np(a))&&au(e,t,a,Cp,n),r===s)break;s=r}null!==s&&a.stopPropagation()}else au(e,t,a,null,n)}}function Np(e){return Ep(e=Dt(e))}var Cp=null;function Ep(e){if(Cp=null,null!==(e=Ye(e))){var t=r(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=o(t)))return e;e=null}else if(31===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Cp=e,null}function Pp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case ce:return 2;case de:return 8;case ue:case pe:return 32;case he:return 268435456;default:return 32}default:return 32}}var Tp=!1,Ap=null,_p=null,Ip=null,Dp=new Map,Op=new Map,Fp=[],Rp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jp(e,t){switch(e){case"focusin":case"focusout":Ap=null;break;case"dragenter":case"dragleave":_p=null;break;case"mouseover":case"mouseout":Ip=null;break;case"pointerover":case"pointerout":Dp.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Op.delete(t.pointerId)}}function Lp(e,t,n,a,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:a,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=Xe(t))&&bp(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Bp(e){var t=Ye(e.target);if(null!==t){var n=r(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=o(n)))return e.blockedOn=t,void Le(e.priority,function(){xp(n)})}else if(31===t){if(null!==(t=c(n)))return e.blockedOn=t,void Le(e.priority,function(){xp(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Vp(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Np(e.nativeEvent);if(null!==n)return null!==(t=Xe(n))&&bp(t),e.blockedOn=n,!1;var a=new(n=e.nativeEvent).constructor(n.type,n);It=a,n.target.dispatchEvent(a),It=null,t.shift()}return!0}function zp(e,t,n){Vp(e)&&n.delete(t)}function Up(){Tp=!1,null!==Ap&&Vp(Ap)&&(Ap=null),null!==_p&&Vp(_p)&&(_p=null),null!==Ip&&Vp(Ip)&&(Ip=null),Dp.forEach(zp),Op.forEach(zp)}function Gp(t,n){t.blockedOn===n&&(t.blockedOn=null,Tp||(Tp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Up)))}var Wp=null;function Kp(t){Wp!==t&&(Wp=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Wp===t&&(Wp=null);for(var e=0;e<t.length;e+=3){var n=t[e],a=t[e+1],s=t[e+2];if("function"!=typeof a){if(null===Ep(a||n))continue;break}var r=Xe(n);null!==r&&(t.splice(e,3),e-=3,ai(r,{pending:!0,data:s,method:n.method,action:a},a,s))}}))}function Hp(e){function t(t){return Gp(t,e)}null!==Ap&&Gp(Ap,e),null!==_p&&Gp(_p,e),null!==Ip&&Gp(Ip,e),Dp.forEach(t),Op.forEach(t);for(var n=0;n<Fp.length;n++){var a=Fp[n];a.blockedOn===e&&(a.blockedOn=null)}for(;0<Fp.length&&null===(n=Fp[0]).blockedOn;)Bp(n),null===n.blockedOn&&Fp.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(a=0;a<n.length;a+=3){var s=n[a],r=n[a+1],o=s[ze]||null;if("function"==typeof r)o||Kp(n);else if(o){var i=null;if(r&&r.hasAttribute("formAction")){if(s=r,o=r[ze]||null)i=o.formAction;else if(null!==Ep(s))continue}else i=o.action;"function"==typeof i?n[a+1]=i:(n.splice(a,3),a-=3),Kp(n)}}}function $p(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return s=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==s&&(s(),s=null),a||setTimeout(n,20)}function n(){if(!a&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var a=!1,s=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){a=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==s&&(s(),s=null)}}}function qp(e){this._internalRoot=e}function Yp(e){this._internalRoot=e}Yp.prototype.render=qp.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));yp(t.current,qc(),e,t,null,null)},Yp.prototype.unmount=qp.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;yp(e.current,2,null,e,null,null),td(),t[Ue]=null}},Yp.prototype.unstable_scheduleHydration=function(e){if(e){var t=je();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Fp.length&&0!==t&&t<Fp[n].priority;n++);Fp.splice(n,0,e),0===n&&Bp(e)}};var Xp=t.version;if("19.2.3"!==Xp)throw Error(a(527,Xp,"19.2.3"));O.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=r(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(s=o.return)){n=s;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return d(o),e;if(i===s)return d(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==s.return)n=o,s=i;else{for(var l=!1,c=o.child;c;){if(c===n){l=!0,n=o,s=i;break}if(c===s){l=!0,s=o,n=i;break}c=c.sibling}if(!l){for(c=i.child;c;){if(c===n){l=!0,n=i,s=o;break}if(c===s){l=!0,s=i,n=o;break}c=c.sibling}if(!l)throw Error(a(189))}}if(n.alternate!==s)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?u(e):null)?null:e.stateNode};var Qp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.3"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Zp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zp.isDisabled&&Zp.supportsFiber)try{ye=Zp.inject(Qp),ge=Zp}catch(eh){}}return Sn.createRoot=function(e,t){if(!s(e))throw Error(a(299));var n=!1,r="",o=Ci,i=Ei,l=Pi;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=mp(e,1,!1,null,0,n,r,null,o,i,l,$p),e[Ue]=t.current,tu(e),new qp(t)},Sn.hydrateRoot=function(e,t,n){if(!s(e))throw Error(a(299));var r=!1,o="",i=Ci,l=Ei,c=Pi,d=null;return null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(d=n.formState)),(t=mp(e,1,!0,t,0,r,o,d,i,l,c,$p)).context=fp(null),n=t.current,(o=xr(r=Fe(r=qc()))).callback=null,wr(n,o,r),n=r,t.current.lanes=n,_e(t,n),jd(t),e[Ue]=t.current,tu(e),new Yp(t)},Sn.version="19.2.3",Sn}var Pn=(xn||(xn=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),kn.exports=En()),kn.exports);const Tn={},An=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=n?.nonce||n?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/DEViLBOX/"+e}(e))in Tn)return;Tn[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},_n=e=>Symbol.iterator in e,In=e=>"entries"in e,Dn=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),a=t instanceof Map?t:new Map(t.entries());if(n.size!==a.size)return!1;for(const[s,r]of n)if(!a.has(s)||!Object.is(r,a.get(s)))return!1;return!0};function On(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(_n(e)&&_n(t)?In(e)&&In(t)?Dn(e,t):((e,t)=>{const n=e[Symbol.iterator](),a=t[Symbol.iterator]();let s=n.next(),r=a.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=n.next(),r=a.next()}return!!s.done&&!!r.done})(e,t):Dn({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function Fn(t){const n=e.useRef(void 0);return e=>{const a=t(e);return On(n.current,a)?n.current:n.current=a}}const Rn=e=>(n,a,s)=>(s.setState=(e,a,...s)=>{const r="function"==typeof e?t(e):e;return n(r,a,...s)},e(s.setState,a,s));function jn(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t="/DEViLBOX/",n=t.endsWith("/")?t.slice(0,-1):t;if(""===n||"/"===n)return e;const a=e.startsWith("/")?e:"/"+e;if(a.startsWith(n))return a;return n+a}function Ln(e,t,n){const a=e.replace(/\.wav$/i,"");return{filename:e,name:a.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/\s+/g," ").trim()||a,category:t,url:jn(`${n}/${t}/${encodeURIComponent(e)}`)}}const Bn="data/samples/packs/drumnibus",Vn={id:"drumnibus",name:"Drumnibus Electro Drums",author:"Legowelt",description:"A collection of 229 electro drum machine samples. Classic analog-style kicks, snares, hi-hats, percussion and FX sounds perfect for electro, techno, and electronic music production.",coverImage:jn("data/samples/packs/drumnibus/cover.png"),basePath:Bn,categories:["kicks","snares","hihats","percussion","fx"],samples:{kicks:["BB_Electro1short.wav","BD_Drumaxia.wav","BD_Pufsub.wav","BD_808A1200.wav","BD_DiggerLong.wav","BD_Digidap.wav","BD_Digimozzy.wav","BD_Dikkie.wav","BD_Dome_Long.wav","BD_EchoRam1.wav","BD_EchoRam2.wav","BD_Electro1shorter.wav","BD_Juxtapos.wav","BD_Lite2021.wav","BD_LofiHuman.wav","BD_Losamplix.wav","BD_Magnotron..wav","BD_Matrixtape1.wav","BD_Matrixtape2.wav","BD_Plastiklog.wav","BD_Punchtron.wav","BD_Punchysplur.wav","BD_Pziforze.wav","BD_Ritmo.wav","BD_Romkick1.wav","BD_Rubydub.wav","BD_Ruflex.wav","BD_Simpletron.wav","BD_Springworth.wav","BD_Spriverbion.wav","BD_Stuf.wav","BD_SubThud.wav","BD_Zistort.wav"].map(e=>Ln(e,"kicks",Bn)),snares:["SD_808A1200.wav","SD_Analog_Noise_2.wav","SD_Analog_Noise_4.wav","SD_Analog_Noise_5.wav","SD_Analog_Noise1.wav","SD_CompuCrunchy.wav","SD_Digidap.wav","SD_Draconis1.wav","SD_Draconis2.wav","SD_Drumaxia.wav","SD_Echoram1.wav","SD_Echoram2.wav","SD_Echoram3.wav","SD_electro7000.wav","SD_Hark.wav","SD_Juxtapos.wav","SD_Kitcatlitter.wav","SD_LoDigital_1.wav","SD_LoDigital_2.wav","SD_LofiHuman.wav","SD_Magnotron.wav","SD_Mamba.wav","SD_Mambalazesnare.wav","SD_Mambalazesnare2.wav","SD_NomiSnare.wav","SD_NomiSnareLazer.wav","SD_NomiSnareWhip.wav","SD_Punchtron..wav","SD_Reverz1.wav","SD_Reverz2.wav","SD_Reverz3.wav","SD_Ritmo.wav","SD_Rubydubwav.wav","SD_Ruflex.wav","SD_Strakker.wav","SD_Turbosound.wav","SD_Wolf_3.wav","SD_Wolf_5.wav","SD_Wolf_6.wav","SD_Wolf_7.wav","SD_Wolf_8.wav","SD_Wolf_9.wav","SD_Wolf1.wav","SD_Wolf2.wav","SD_Wolfsweep1.wav"].map(e=>Ln(e,"snares",Bn)),hihats:["CH_Digidap.wav","CH_DistortedRitmo.wav","CH_DraconisD921.wav","CH_DraconisD922.wav","CH_Fantio_Closed_Hat.wav","CH_Filtix_Closed_Hat.wav","CH_Juxtapos.wav","CH_LofiHuman.wav","CH_Magnotron.wav","CH_Punchtron.wav","CH_Rezmatix_Closed_Hat.wav","CH_Rubydub.wav","CH_Ruflex.wav","CH_Sizzel_Closed_Hat.wav","CYM_Juxtapos.wav","CYM_Magnotron.wav","CYM_Punchtron.wav","CYM_Ruflex.wav","CYM_Synthique.wav","OH_AnalogHihat1.wav","OH_AnalogOpenhatwav.wav","OH_AnalogVeryLongHat.wav","OH_Digidap.wav","OH_DistortedRitmo.wav","OH_DraconisD921.wav","OH_DraconisD922.wav","OH_Drumaxia.wav","OH_Fantio_Open_Hat.wav","OH_Filtix_Open_Hat.wav","OH_Juxtapos.wav","OH_LofiHuman.wav","OH_Magnotron.wav","OH_Punchtron.wav","OH_Rezmatix_Open_Hat_Long.wav","OH_Rezmatix_Open_Hat.wav","OH_Rubydub.wav","OH_Ruflex.wav","OH_Sizzel_Open_Hat.wav"].map(e=>Ln(e,"hihats",Bn)),claps:[],percussion:["BELL_Darkgong.wav","BELL_Filterbell.wav","BELL_Hypnoschaal.wav","BELL_Hypnoschaal2.wav","BELL_Hypnoschaal3.wav","BONGO_Ryhtmbox.wav","BONGO_Ryhtmbox2.wav","BONGO_Simple.wav","CLAP_Juxtapos.wav","CLAP_LofiHuman.wav","CLAP_Magnotron.wav","CLAP_Punchtron.wav","CLAP_Rubydub.wav","CLAP_Ruflex.wav","CLAVE_Punchtron.wav","CLAVE_Simple.wav","CLAVE_Singalique.wav","CLAVE_Syntheticblox.wav","CONGA_Lowpark.wav","CONGA_Syntique.wav","COW_Syntique.wav","LAZ_Drumaxia.wav","LAZ_Blip1.wav","LAZ_Blip2.wav","LAZ_Blip3.wav","LAZ_Chewy1.wav","LAZ_Digidap.wav","LAZ_Lectrophy.wav","LAZ_Lectrophy2.wav","LAZ_lowvix1.wav","LAZ_lowvix2.wav","LAZ_lowvix3.wav","LAZ_Mambalazesnare.wav","LAZ_R900.wav","LAZ_Softrond.wav","LAZ_Softrond2.wav","LAZ_Softrond3.wav","RIM_Losimple.wav","RIM_Magnotron.wav","RIM_Rubydub.wav","SHAKE_AnalogShaker1.wav","SHAKE_AnalogShaker2.wav","SHAKE_AnalogShaker3.wav","SHAKE_Ritmo.wav","SNAP_Juxtapos.wav","TABLA_Mamba.wav","TAMB_Tamb&Shaker.wav","TAMB_TapeShake1.wav","TAMB_TapeShake2.wav","TAMB_TapeShake3.wav","TOM_digger.wav","TOM_DistortedRitmo.wav","TOM_DistortedRitmoHi.wav","TOM_DraconisDS92.wav","TOM_DraconisDS92high.wav","TOM_Druimaxia.wav","TOM_Juxtapos.wav","TOM_LofiHuman.wav","TOM_Magnotron.wav","TOM_Osciaz.wav","TOM_Punchtron.wav","TOM_Rubydub.wav","TOM_Ruflex.wav","TOM_Stofelectro1.wav","TOM_TamborineTom.wav","TOM_TamborineTom2.wav","TOM_TamborineTom3.wav","TOM_Warped.wav"].map(e=>Ln(e,"percussion",Bn)),fx:["FX_AnalogFX1.wav","FX_AnalogFX2.wav","FX_Blarper.wav","FX_Briesherfst.wav","FX_Briesherfst2.wav","FX_Briesherfst3.wav","FX_Burst1.wav","FX_Burst2.wav","FX_Chainmalz.wav","FX_Digidap2.wav","FX_Digidap3.wav","FX_Drumaxia.wav","FX_Drumaxia2.wav","FX_ElectroIsland.wav","FX_ElectroIsland2.wav","FX_Emerx1.wav","FX_Emerx2.wav","FX_Emerx3.wav","FX_LofiHuman.wav","FX_LofiHuman2.wav","FX_Magstorm1.wav","FX_Magstorm2.wav","FX_NomiElastiek.wav","FX_NomiLaser1.wav","FX_NomiLectric.wav","FX_NomiLectric2.wav","FX_NomiSnip.wav","FX_NomiSpring.wav","FX_Poni1.wav","FX_Poni2.wav","FX_Poni3.wav","FX_Quarkulator.wav","FX_Quarkulator2.wav","FX_Sloiz.wav","FX_Snakamon1.wav","FX_Snakamon2.wav","FX_Snakamon3.wav","FX_Snakamon3B.wav","FX_Snakamon5.wav","FX_Sonar.wav","FX_Sonar2.wav","FX_Sydrum1.wav","FX_Sydrum2.wav","FX_Sydrum3.wav","FX_Timpio.wav"].map(e=>Ln(e,"fx",Bn)),bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:229},zn="data/samples/packs/casio-mt40",Un=[Vn,{id:"casio-mt40",name:"Casio MT-40",author:"Casio",description:"Classic 8-bit instrument sounds from the legendary Casio MT-40 keyboard. Home of the Sleng Teng riddim.",coverImage:jn("data/samples/packs/casio-mt40/cover.jpg"),basePath:zn,categories:["leads"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:["accordion.wav","banjo.wav","bass.wav","brass.wav","celesta.wav","cello.wav","clarinet.wav","elec piano.wav","flute.wav","folk flute.wav","funny fuzz.wav","glocken.wav","guitar.wav","harpsichord.wav","organ.wav","oriental.wav","pipe-organ.wav","recorder.wav","st ensemble.wav","synth fuzz.wav","trumpet.wav","violin.wav","xylophone.wav"].map(e=>Ln(e,"leads",zn)),pads:[],loops:[],vocals:[],other:[]},sampleCount:23}];const Gn=c(n()),Wn={kicks:"kicks",kick:"kicks",bd:"kicks",bassdrum:"kicks","bass drum":"kicks",snares:"snares",snare:"snares",sd:"snares",hihats:"hihats",hihat:"hihats","hi-hats":"hihats","hi-hat":"hihats",hh:"hihats",claps:"claps",clap:"claps",cp:"claps",percussion:"percussion",perc:"percussion",fx:"fx",effects:"fx",sfx:"fx",bass:"bass",leads:"leads",lead:"leads",pads:"pads",pad:"pads",loops:"loops",loop:"loops",vocals:"vocals",vocal:"vocals",vox:"vocals",toms:"percussion",tom:"percussion",cymbals:"hihats",cymbal:"hihats",rides:"hihats",ride:"hihats",crash:"hihats",open:"hihats",closed:"hihats",oh:"hihats",ch:"hihats"},Kn=[".wav",".mp3",".ogg",".flac",".aiff",".aif"],Hn=[".png",".jpg",".jpeg",".webp"];function $n(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Kn.includes(t)}function qn(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Hn.includes(t)}function Yn(e){const t=e.toLowerCase();return t.includes("cover")||t.includes("folder")||t.includes("front")||t.includes("artwork")}function Xn(e,t){const n=e.toLowerCase();return".ds_store"===n||"thumbs.db"===n||n.startsWith("._")||t.includes("__MACOSX")||e.startsWith(".")}function Qn(e){const t=e.toLowerCase().trim();return Wn[t]||"other"}function Zn(e){const t=e.replace(/\.(wav|mp3|ogg|flac|aiff|aif)$/i,"");return t.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim()||t}const Jn=a()(Rn((e,t)=>({userPacks:[],uploadZip:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let n,a=e.name.replace(/\.zip$/i,""),s=[];const r=new Set;try{const l=await Gn.loadAsync(e),c=Object.entries(l.files);let d=0;for(const[e,n]of c){if(n.dir)continue;const a=e.split("/").filter(e=>e.length>0);if(0===a.length)continue;const i=a[a.length-1];if(Xn(i,e))continue;if(qn(i)){const t=Yn(i)?2:a.length<=2?1:0;s.push({path:e,filename:i,priority:t});continue}if(!$n(i))continue;let l="other";a.length>=2&&(l=Qn(a[a.length-2]));try{const e=await n.async("blob"),a=URL.createObjectURL(e),s={filename:i,name:Zn(i),category:l,url:a};t[l].push(s),r.add(l),d++}catch(o){}}if(s.length>0){s.sort((e,t)=>t.priority-e.priority);const e=s[0],t=l.files[e.path];if(t)try{const e=await t.async("blob");n=URL.createObjectURL(e)}catch(i){}}const u=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===u)throw new Error("No audio files found in the ZIP.");return{id:`user-${Date.now()}`,name:a,author:"User Upload",description:`User-uploaded sample pack with ${u} samples`,coverImage:n,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:u,isUserUploaded:!0}}catch(l){throw l}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},uploadDirectory:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let n,a="",s=[];const r=new Set;for(let l=0;l<e.length;l++){const n=e[l],o=n.webkitRelativePath||n.name;if(Xn(n.name,o))continue;const c=o.split("/").filter(e=>e.length>0),d=c[c.length-1];if(c.length>1&&!a&&(a=c[0]),qn(d)){const e=Yn(d)?2:c.length<=2?1:0;s.push({file:n,priority:e});continue}if(!$n(d))continue;let u="other";c.length>=2&&(u=Qn(c.length>=3?c[c.length-2]:c[1]));try{const e=URL.createObjectURL(n),a={filename:d,name:Zn(d),category:u,url:e};t[u].push(a),r.add(u)}catch(i){}}if(a||(a="Uploaded Pack"),s.length>0){s.sort((e,t)=>t.priority-e.priority);try{n=URL.createObjectURL(s[0].file)}catch(i){}}const o=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===o)throw new Error("No audio files found in the directory.");return{id:`user-${Date.now()}`,name:a,author:"User Upload",description:`User-uploaded sample pack with ${o} samples`,coverImage:n,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:o,isUserUploaded:!0}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},removeUserPack:t=>{e(e=>{e.userPacks=e.userPacks.filter(e=>e.id!==t)})},clearUserPacks:()=>{e(e=>{e.userPacks=[]})}}))),ea=()=>{const e=Jn(e=>e.userPacks);return[...Un,...e]},ta=[null,"#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],na={note:!0,instrument:!0,volume:!0,effect:!0,effect2:!0,flag1:!1,flag2:!1,cutoff:!1,resonance:!1,envMod:!1,pan:!1,probability:!1},aa={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},sa={wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ra={sampleUrl:"",grainSize:100,grainOverlap:50,playbackRate:1,detune:0,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:4,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}},oa={type:"vfx",clock:16e6,romsLoaded:!1,registers:{}},ia={type:"doc",clock:1e6,romsLoaded:!1,registers:{}},la={type:"swp30",clock:33868800,romsLoaded:!1,registers:{}},ca={moduleData:"",format:"UNKNOWN",useLibopenmpt:!0,repeatCount:0,stereoSeparation:100,interpolationFilter:0},da={voices:7,detune:30,mix:50,stereoSpread:80,envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ua={voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100},portamento:0},pa={drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:50,decay:"fast",harmonic:"third"},keyClick:30,vibrato:{type:"C3",depth:50},rotary:{enabled:!0,speed:"slow"}},ha={drumType:"kick",machineType:"909",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},snare:{pitch:220,pitchHigh:476,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},hihat:{tone:50,decay:100,metallic:50},clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},conga:{pitch:310,decay:180,tuning:50},cowbell:{decay:400,filterFreq:2640},rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450},maracas:{decay:30,filterFreq:5e3},cymbal:{tone:50,decay:2e3}},ma={channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop",swing:0}},fa={pulseWidth:50,pwmDepth:30,pwmRate:2,pwmWaveform:"sine",oscillators:2,detune:10,envelope:{attack:50,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:4e3,resonance:20,envelopeAmount:30,keyTracking:50},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ya={sections:{violin:100,viola:70,cello:50,bass:30},ensemble:{depth:60,rate:3,voices:4},attack:200,release:1e3,brightness:60},ga={A:{f1:800,f2:1200,f3:2500},E:{f1:400,f2:2e3,f3:2600},I:{f1:300,f2:2300,f3:3e3},O:{f1:500,f2:800,f3:2500},U:{f1:350,f2:600,f3:2400}},va={mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},ba={machineType:"ArguruDistortion",parameters:{}},xa={vowel:"A",vowelMorph:{target:"O",amount:0,rate:1,mode:"manual"},oscillator:{type:"sawtooth"},formants:{...ga.A,bandwidth:100},envelope:{attack:50,decay:500,sustain:0,release:100},brightness:70},wa={VOL:0,ARP:1,DUTY:2,WAVE:3,PITCH:4,EX1:5,EX2:6,EX3:7,ALG:8,FB:9,FMS:10,AMS:11,PAN_L:12,PAN_R:13,PHASE_RESET:14,EX4:15,EX5:16,EX6:17,EX7:18,EX8:19},ka={chipType:1,algorithm:4,feedback:4,fms:0,ams:0,fms2:0,ams2:0,ops:4,opllPreset:0,fixedDrums:!1,operators:[{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:50,ar:28,dr:6,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:10,d2r:4,sl:2,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:8,d2r:3,sl:3,rr:5,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0}],macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]},Sa={algorithm:0,feedback:0,oscSync:!0,operators:Array.from({length:6},()=>({level:99,coarse:1,fine:0,detune:7,mode:"ratio",egRates:[99,99,99,99],egLevels:[99,99,99,0],breakPoint:0,leftDepth:0,rightDepth:0,leftCurve:0,rightCurve:0,rateScaling:0,ampModSens:0,velocitySens:0})),pitchEgRates:[99,99,99,99],pitchEgLevels:[50,50,50,50],lfoSpeed:35,lfoDelay:0,lfoPitchModDepth:0,lfoAmpModDepth:0,lfoSync:!1,lfoWave:"triangle",lfoPitchModSens:0,transpose:0,name:"INIT VOICE"},Ma={osc1Waveform:"saw",osc1Octave:0,osc1Detune:0,osc1PulseWidth:.5,osc1Level:1,osc2Waveform:"saw",osc2Octave:0,osc2Detune:.1,osc2PulseWidth:.5,osc2Level:.7,oscSync:!1,oscXor:!1,filterCutoff:.7,filterResonance:.3,filterType:"lp24",filterEnvAmount:.5,filterKeyTrack:0,filterVelocity:.3,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:"sine",lfoDelay:0,lfoOscAmount:0,lfoFilterAmount:0,lfoAmpAmount:0,lfoPwAmount:0,masterVolume:.7,voices:8,unison:!1,unisonDetune:.1,portamento:0,panSpread:.3,velocitySensitivity:.5,noiseLevel:0,subOscLevel:0,subOscOctave:-1,drift:.02},Na={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1},Ca={keymap:[],polyphony:"poly",maxVoices:8,noteCut:!1},Ea={enabled:!1,waveform:"sine",rate:5,sync:!1,syncDivision:"1/4",filterAmount:0,filterTarget:"cutoff",pitchAmount:0,volumeAmount:0,phase:0,retrigger:!0},Pa={oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"square",rate:2,depth:100},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:1.5,wet:.1}},Ta={text:"COMMODORE SIXTY FOUR",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},Aa={moduleUrl:"",pluginState:null,pluginStateVersion:1,pluginStateTimestamp:0},_a={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0},Ia={osc1:{mode:1,transpose:0,detune:0,color:64,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:10,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:-10,color:64,level:0},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:127,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:32},envelope2:{attack:0,decay:64,sustain:127,release:32},lfo1:{rate:64,depth:0}},Da={laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:40,ratio:2.5},noise:{amount:10,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:40},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:2,wet:.2}},Oa={oscillator:{type:"square",tune:200,fine:0},oscillator2:{enabled:!1,detune:0,mix:.5},noise:{enabled:!0,type:"white",mix:.2,color:100},filter:{cutoff:800,resonance:60,envMod:70,decay:200},lfo:{enabled:!1,rate:5,depth:0,target:"pitch"},envelope:{decay:300,sustain:0},sweep:{enabled:!0,amount:24,time:150}},Fa={type:"sawtooth",detune:0,octave:0},Ra={attack:10,decay:500,sustain:0,release:100},ja={type:"lowpass",frequency:2e3,Q:1,rolloff:-24},La={engineType:"db303",volume:.8,oscillator:{type:"sawtooth",pulseWidth:1,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.5},slide:{time:.17,mode:"exponential"},overdrive:{amount:0},devilFish:{enabled:!0,normalDecay:.5,accentDecay:.1,softAttack:0,accentSoftAttack:.5,passbandCompensation:.9,resTracking:.7,filterInputDrive:0,filterSelect:1,diodeCharacter:0,duffingAmount:0,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.5,feedback:0,tone:.5,mix:0,stereo:.75}},Ba=[{id:"straight",name:"Straight",category:"straight",description:"No groove, all rows on the grid",values:[0,0]},{id:"light-shuffle",name:"Light Shuffle",category:"shuffle",description:"Subtle rhythmic bounce (16th)",values:[0,8],velocityOffsets:[0,-.05]},{id:"medium-shuffle",name:"Medium Shuffle",category:"shuffle",description:"Classic bouncy shuffle feel",values:[0,16],velocityOffsets:[0,-.1]},{id:"heavy-shuffle",name:"Heavy Shuffle",category:"shuffle",description:"Strong triplet-style bounce",values:[0,25],velocityOffsets:[0,-.15]},{id:"triplet",name:"Full Triplet",category:"shuffle",description:"True 2:1 triplet timing (66%)",values:[0,33],velocityOffsets:[0,-.2]},{id:"mpc-50",name:"MPC 50%",category:"swing",description:"MPC straight (no swing)",values:[0,0]},{id:"mpc-54",name:"MPC 54%",category:"swing",description:"MPC light swing",values:[0,8],velocityOffsets:[0,-.08]},{id:"mpc-58",name:"MPC 58%",category:"swing",description:"MPC medium swing",values:[0,16],velocityOffsets:[0,-.12]},{id:"mpc-62",name:"MPC 62%",category:"swing",description:"MPC heavy swing",values:[0,25],velocityOffsets:[0,-.18]},{id:"mpc-66",name:"MPC 66%",category:"swing",description:"MPC maximum swing",values:[0,33],velocityOffsets:[0,-.25]},{id:"funk-16th",name:"Funk 16th",category:"funk",description:"16th note funk groove",values:[0,5,-3,10],velocityOffsets:[.1,-.2,.05,-.3],suggestedBpmRange:[90,130]},{id:"funk-lazy",name:"Lazy Funk",category:"funk",description:"Relaxed funk feel, everything slightly late",values:[3,8,5,12],velocityOffsets:[.05,-.1,.05,-.15],suggestedBpmRange:[80,110]},{id:"funk-tight",name:"Tight Funk",category:"funk",description:"Rushed funk feel, snappy timing",values:[-2,5,-5,8],velocityOffsets:[.15,-.15,.1,-.2],suggestedBpmRange:[100,140]},{id:"boom-bap",name:"Boom Bap",category:"hip-hop",description:"Classic 90s hip-hop swing",values:[0,12,0,8],velocityOffsets:[.1,-.15,.05,-.1],suggestedBpmRange:[85,100]},{id:"lo-fi",name:"Lo-Fi",category:"hip-hop",description:"Drunk/loose timing for lo-fi beats",values:[5,15,-3,18],velocityOffsets:[-.05,-.2,-.1,-.25],suggestedBpmRange:[70,95]},{id:"trap-triplet",name:"Trap Triplet",category:"hip-hop",description:"Triplet hi-hat groove for trap",values:[0,22,11,33,0,22],velocityOffsets:[.1,-.2,-.1,-.3,.05,-.25],suggestedBpmRange:[130,160]},{id:"drunken",name:"Drunken Master",category:"custom",description:"Irregular timing for experimental feel",values:[0,8,-5,15,3,20,-8,12],velocityOffsets:[0,-.1,.05,-.2,.1,-.15,.05,-.3]},{id:"push-pull",name:"Push-Pull",category:"custom",description:"Alternating early/late for tension",values:[-10,10,-10,10],velocityOffsets:[.1,-.1,.1,-.1]}];const Va=[{id:"ramp-up",name:"Ramp Up",shape:"rampUp",points:[{row:0,value:0},{row:63,value:1}]},{id:"ramp-down",name:"Ramp Down",shape:"rampDown",points:[{row:0,value:1},{row:63,value:0}]},{id:"triangle",name:"Triangle",shape:"triangle",points:[{row:0,value:0},{row:31,value:1},{row:63,value:0}]},{id:"sine",name:"Sine Wave",shape:"sine",points:Array.from({length:64},(e,t)=>({row:t,value:(Math.sin(t/64*Math.PI*2)+1)/2}))}];(new Date).toISOString(),(new Date).toISOString();const za=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Ua(e){if(null===e||""===e||"..."===e)return 0;if("==="===e||"OFF"===e)return 97;const t=e.match(/^([A-G])([#-])(\d)$/);if(!t)return 0;const[,n,a,s]=t,r=parseInt(s,10),o=n+a,i=za.indexOf(o);if(-1===i)return 0;const l=12*r+i+1;return l<1||l>96?0:l}function Ga(e){if(0===e)return"...";if(97===e)return"===";if(e<1||e>96)return"...";const t=e-1,n=Math.floor(t/12);return`${za[t%12]}${n}`}const Wa={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,K:20,L:21,P:25,R:27,T:29,X:33},Ka=Object.fromEntries(Object.entries(Wa).map(([e,t])=>[t,e]));function Ha(e){if(!e||"..."===e||"000"===e)return[0,0];const t=e.match(/^([0-9A-Z])([0-9A-F]{2})$/i);if(!t)return[0,0];const[,n,a]=t;return[Wa[n.toUpperCase()]??0,parseInt(a,16)]}function $a(e,t){if(0===e&&0===t)return"...";return`${Ka[e]??"0"}${t.toString(16).toUpperCase().padStart(2,"0")}`}function qa(e){return 0===e||97===e||e<1||e>96?null:e+11}function Ya(e){const t=e-11;return Math.min(96,Math.max(1,t))}function Xa(e){if(!e||"object"!=typeof e)return!1;if(!e.output||"object"!=typeof e.output)return!1;const t=e.output,n="function"==typeof t.connect&&"function"==typeof t.disconnect&&"number"==typeof t.numberOfOutputs&&"function"!=typeof t.toDestination,a="function"==typeof e.toDestination;return n&&!a}const Qa=globalThis.BaseAudioContext||globalThis.AudioContext||globalThis.webkitAudioContext;let Za=null;function Ja(){if(!Za)throw new Error("[audio-context] AudioContext not initialized  ToneEngine must be created first");return Za}function es(e){if(!e)throw new Error("[audio-context] getNativeContext called with null/undefined context");if(Qa&&e instanceof Qa)return e;let t=[e],n=new Set,a=0;for(;t.length>0&&a<50;){const e=t.shift();if(e&&!n.has(e)){if(n.add(e),a++,Qa&&e instanceof Qa)return e;e.rawContext&&t.push(e.rawContext),e._nativeAudioContext&&t.push(e._nativeAudioContext),e.nativeContext&&t.push(e.nativeContext),e.baseAudioContext&&t.push(e.baseAudioContext),e.context&&t.push(e.context),e._context&&t.push(e._context)}}return e}function ts(e){if(!e||"object"!=typeof e)return!1;if(!("function"==typeof e.connect&&"function"==typeof e.disconnect&&"number"==typeof e.numberOfInputs&&"number"==typeof e.numberOfOutputs&&void 0!==e.context))return!1;const t=e.constructor?.name||"",n=t.endsWith("Node")||"AudioNode"===t,a="function"==typeof e.toDestination||"function"==typeof e.toMaster;return n&&!a}function ns(e){if(!e)return null;if(ts(e))return e;if(e.input&&ts(e.input))return e.input;if(e.output&&ts(e.output))return e.output;const t=[e._gainNode,e._node,e._input,e._output,e._nativeNode];for(const n of t)if(ts(n))return n;if(e.input&&"object"==typeof e.input&&!ts(e.input)){const t=[e.input._gainNode,e.input._node,e.input.input];for(const e of t)if(ts(e))return e}return null}const as=/^([A-Ga-g])([#b]?)(-?\d+)$/,ss={C:0,D:2,E:4,F:5,G:7,A:9,B:11};function rs(e){if("number"==typeof e)return Math.max(0,Math.min(127,Math.round(12*Math.log2(e/440)+69)));const t=e.match(as);if(!t)return 60;const[,n,a,s]=t,r=ss[n.toUpperCase()]??0,o="#"===a?1:"b"===a?-1:0,i=parseInt(s);return Math.max(0,Math.min(127,12*(i+1)+r+o))}function os(e){if("number"==typeof e)return e>=0&&e<=127&&Number.isInteger(e)?440*Math.pow(2,(e-69)/12):e;const t=rs(e);return 440*Math.pow(2,(t-69)/12)}function is(){return Za?Za.currentTime:0}function ls(e,t=120){if("number"==typeof e)return e;const n=e.match(/^(\d+)n$/);if(n){return 4/parseInt(n[1])*(60/t)}const a=parseFloat(e);return isNaN(a)?0:a}const cs="cutoff",ds="cutoffHz",us="resonance",ps="envMod",hs="envModPercent",ms="decay",fs="accent",ys="waveform",gs="pulseWidth",vs="pitchToPw",bs="subOscGain",xs="subOscBlend",ws="normalDecay",ks="accentDecay",Ss="softAttack",Ms="accentSoftAttack",Ns="passbandCompensation",Cs="resTracking",Es="filterInputDrive",Ps="filterSelect",Ts="diodeCharacter",As="duffingAmount",_s="filterFmDepth",Is="korgIbiasScale",Ds="korgBite",Os="korgClip",Fs="korgCrossmod",Rs="korgQSag",js="korgSharpness",Ls="lpBpMix",Bs="filterTracking",Vs="stageNLAmount",zs="ensembleAmount",Us="slideTime",Gs="lfoRate",Ws="lfoContour",Ks="lfoPitchDepth",Hs="lfoPwmDepth",$s="lfoFilterDepth",qs="lfoStiffDepth",Ys="chorusMix",Xs="phaserLfoRate",Qs="phaserLfoWidth",Zs="phaserFeedback",Js="phaserMix",er="delayTime",tr="delayFeedback",nr="delayTone",ar="delayMix",sr="delaySpread",rr="tuning",or="volume",ir="lfoWaveform",lr="chorusMode",cr="oversamplingOrder";class dr{name="DB303Synth";output;workletNode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;overdrive=null;overdriveGain=null;overdriveAmount=0;config={};audioContext;_disposed=!1;_initPromise;_resolveInit=null;_pendingParams=[];_releaseTimeout=null;constructor(){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{if(await dr.ensureInitialized(this.audioContext),this._disposed)return;this.createNode()}catch(e){}}static wasmBinary=null;static jsCode=null;static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}db303/DB303.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode){const[e,n]=await Promise.all([fetch(`${t}db303/DB303.wasm`),fetch(`${t}db303/DB303.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar DB303 = createDB303Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){if(this._disposed)return;const e=this.audioContext;if(this.workletNode=new AudioWorkletNode(e,"db303-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?this._resolveInit&&(this._resolveInit(),this._resolveInit=null):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:dr.wasmBinary,jsCode:dr.jsCode}),this._pendingParams.length>0){for(const{paramId:e,value:t}of this._pendingParams)this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t});this._pendingParams=[]}this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch(t){}}_savedSlideTime=.5;_currentSlideTime=.5;triggerAttack(e,t,n=1,a=!1,s=!1,r=!1){if(!this.workletNode||this._disposed)return;null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null);const o="string"==typeof e?rs(e):Math.round(12*Math.log2(e/440)+69);let i=Math.floor(127*n);if(a&&i<100&&(i=127),!a&&i>=100&&(i=99),"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=Math.floor(o/12)-1;e[o%12]}r&&(this._savedSlideTime=this._currentSlideTime,this.setSlideTime(0));const l=t??is();this.workletNode.port.postMessage({type:"noteOn",time:l,note:o,velocity:i,slide:s}),r&&setTimeout(()=>{this._disposed||this.setSlideTime(this._savedSlideTime)},50)}triggerRelease(e){if(!this.workletNode||this._disposed)return;const t=e??is();this.workletNode.port.postMessage({type:"gateOff",time:t})}releaseAll(){this.workletNode&&!this._disposed&&(null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode.port.postMessage({type:"allNotesOff"}))}noteOn(e,t,n,a){const s=os(e);this.triggerAttack(s,void 0,t/127,n,a,!1)}noteOff(){this.triggerRelease()}triggerAttackRelease(e,t,n,a,s=!1,r=!1,o=!1){if(this._disposed)return;const i=n??is();this.triggerAttack(e,i,a||1,s,r,o);const l=1e3*(i+ls(t)-is());null!==this._releaseTimeout&&clearTimeout(this._releaseTimeout),this._releaseTimeout=setTimeout(()=>{this._releaseTimeout=null,this._disposed||this.triggerRelease()},Math.max(0,l))}setParameterByName(e,t){if(!this._disposed){if(!this.workletNode){const n=this._pendingParams.findIndex(t=>t.paramId===e);return void(n>=0?this._pendingParams[n].value=t:this._pendingParams.push({paramId:e,value:t}))}this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}}setParam(e,t){switch(e){case"cutoff":this.setCutoff(t);break;case"cutoff_hz":this.setCutoffHz(t);break;case"resonance":this.setResonance(t);break;case"env_mod":this.setEnvMod(t);break;case"env_mod_percent":this.setEnvModPercent(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"waveform":this.setWaveform(t);break;case"pulse_width":this.setPulseWidth(t);break;case"pitch_to_pw":this.setPitchToPw(t);break;case"sub_osc_gain":this.setSubOscGain(t);break;case"sub_osc_blend":this.setSubOscBlend(t);break;case"normal_decay":this.setNormalDecay(t);break;case"accent_decay":this.setAccentDecay(t);break;case"soft_attack":this.setSoftAttack(t);break;case"accent_soft_attack":this.setAccentSoftAttack(t);break;case"passband_compensation":this.setPassbandCompensation(t);break;case"res_tracking":this.setResTracking(t);break;case"filter_input_drive":this.setFilterInputDrive(t);break;case"filter_select":this.setFilterSelect(t);break;case"diode_character":this.setDiodeCharacter(t);break;case"duffing_amount":this.setDuffingAmount(t);break;case"filter_fm_depth":this.setFilterFmDepth(t);break;case"korg_bite":this.setKorgBite(t);break;case"korg_clip":this.setKorgClip(t);break;case"korg_crossmod":this.setKorgCrossmod(t);break;case"korg_q_sag":this.setKorgQSag(t);break;case"korg_sharpness":this.setKorgSharpness(t);break;case"lp_bp_mix":this.setLpBpMix(t);break;case"filter_tracking":this.setFilterTracking(t);break;case"stage_nl_amount":this.setStageNLAmount(t);break;case"ensemble_amount":this.setEnsembleAmount(t);break;case"slide_time":this.setSlideTime(t);break;case"lfo_rate":this.setLfoRate(t);break;case"lfo_contour":this.setLfoContour(t);break;case"lfo_pitch_depth":this.setLfoPitchDepth(t);break;case"lfo_pwm_depth":this.setLfoPwmDepth(t);break;case"lfo_filter_depth":this.setLfoFilterDepth(t);break;case"lfo_stiff_depth":this.setLfoStiffDepth(t);break;case"chorus_mix":this.setChorusMix(t);break;case"phaser_rate":this.setPhaserRate(t);break;case"phaser_width":this.setPhaserWidth(t);break;case"phaser_feedback":this.setPhaserFeedback(t);break;case"phaser_mix":this.setPhaserMix(t);break;case"delay_time":this.setDelayTime(t);break;case"delay_feedback":this.setDelayFeedback(t);break;case"delay_tone":this.setDelayTone(t);break;case"delay_mix":this.setDelayMix(t);break;case"delay_spread":this.setDelaySpread(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"lfo_waveform":this.setLfoWaveform(t);break;case"chorus_mode":this.setChorusMode(t);break;case"oversampling_order":this.setOversamplingOrder(t)}}setCutoff(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(cs,t)}setResonance(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(us,t)}setEnvMod(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ps,t)}setDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ms,t)}setAccent(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(fs,t)}setAccentAmount(e){this.setAccent(e)}setSlideTime(e){const t=Math.max(0,Math.min(1,e));this._currentSlideTime=e,this.setParameterByName(Us,t)}setVolume(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(or,t)}setWaveform(e){this.setParameterByName(ys,e)}setTuning(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(rr,t)}setLfoWaveform(e){this.setParameterByName(ir,e)}setLfoRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Gs,t)}setLfoContour(e){this.setParameterByName(Ws,e)}setLfoPitchDepth(e){this.setParameterByName(Ks,e)}setLfoPwmDepth(e){this.setParameterByName(Hs,e)}setLfoFilterDepth(e){this.setParameterByName($s,e)}setLfoStiffDepth(e){this.setParameterByName(qs,e)}setNormalDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ws,t)}setAccentDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ks,t)}setSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ss,t)}setAccentSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ms,t)}setPassbandCompensation(e){this.setParameterByName(Ns,e)}setFeedbackHighpass(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName("feedbackHighpass",t)}setResTracking(e){this.setParameterByName(Cs,e)}setFilterInputDrive(e){this.setParameterByName(Es,e)}setFilterSelect(e){this.setParameterByName(Ps,e)}setDiodeCharacter(e){this.setParameterByName(Ts,e)}setDuffingAmount(e){let t;if(Math.abs(e)<.16)t=0;else{t=(e>0?1:-1)*(Math.abs(e)-.16)/.84}this.setParameterByName(As,t)}setFilterFmDepth(e){this.setParameterByName(_s,e)}setLpBpMix(e){this.setParameterByName(Ls,e)}setFilterTracking(e){this.setParameterByName(Bs,e)}setKorgIbiasScale(e){this.setParameterByName(Is,e)}setKorgBite(e){this.setParameterByName(Ds,e)}setKorgClip(e){this.setParameterByName(Os,e)}setKorgCrossmod(e){this.setParameterByName(Fs,e)}setKorgQSag(e){this.setParameterByName(Rs,e)}setKorgSharpness(e){this.setParameterByName(js,e)}setPitchToPw(e){this.setParameterByName(vs,e)}setCutoffHz(e){this.setParameterByName(ds,Math.max(10,Math.min(5e3,e)))}setEnvModPercent(e){this.setParameterByName(hs,Math.max(0,Math.min(300,e)))}setStageNLAmount(e){this.setParameterByName(Vs,e)}setEnsembleAmount(e){this.setParameterByName(zs,e)}setChorusMode(e){this.setParameterByName(lr,e)}setOversamplingOrder(e){this.setParameterByName(cr,e)}setPulseWidth(e){this.setParameterByName(gs,e)}setSubOscGain(e){this.setParameterByName(bs,e)}setSubOscBlend(e){this.setParameterByName(xs,e)}setChorusMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ys,t)}setPhaserRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Xs,t)}setPhaserWidth(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Qs,t)}setPhaserFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Zs,t)}setPhaserMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Js,t)}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(er,t)}setDelayFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(tr,t)}setDelayTone(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(nr,t)}setDelayMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ar,t)}setDelaySpread(e){this.setParameterByName(sr,e)}setOverdrive(e){if(this._disposed||!this.workletNode)return;this.overdriveAmount=Math.min(Math.max(e,0),100)/100;const t=this.audioContext.currentTime;if(this.overdriveAmount>0){this.overdrive&&this.overdriveGain||(this.overdriveGain=this.audioContext.createGain(),this.overdrive=this.audioContext.createWaveShaper());const e=new Float32Array(4096),a=1+8*this.overdriveAmount;for(let t=0;t<4096;t++){const n=t/4096*2-1;e[t]=Math.tanh(n*a)/Math.tanh(a)}this.overdrive.curve=e,this.overdriveGain.gain.linearRampToValueAtTime(1+2*this.overdriveAmount,t+.03);try{this.workletNode.disconnect(this.output)}catch(n){}try{this.workletNode.connect(this.overdriveGain),this.overdriveGain.connect(this.overdrive),this.overdrive.connect(this.output)}catch(n){}}else{if(this.overdrive&&this.overdriveGain){try{this.workletNode.disconnect(this.overdriveGain),this.overdriveGain.disconnect(this.overdrive),this.overdrive.disconnect(this.output)}catch(n){}this.overdriveGain.gain.linearRampToValueAtTime(1,t+.03)}try{this.workletNode.connect(this.output)}catch(n){}}}setVegDecay(e){}setVegSustain(e){}setFilterFM(e){this.setFilterFmDepth(e/100)}setMuffler(e){switch(e){case"soft":this.setOverdrive(15);break;case"hard":this.setOverdrive(45);break;case"dark":this.setOverdrive(30);break;case"mid":this.setOverdrive(25);break;case"bright":this.setOverdrive(35);break;default:this.setOverdrive(0)}}setSweepSpeed(e){}setHighResonanceEnabled(e){}setAccentSweepEnabled(e){}setChorusEnabled(e){e||this.setParameterByName(Ys,0)}setPhaserEnabled(e){e||this.setParameterByName(Js,0)}setPhaserDepth(e){this.setParameterByName(Qs,e)}setDelayEnabled(e){e||this.setParameterByName(ar,0)}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}enableDevilFish(e){}setHighResonance(e){}dispose(){this._disposed=!0,null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveGain&&(this.overdriveGain.disconnect(),this.overdriveGain=null),this.output.disconnect()}}const ur="vfx",pr="rsa",hr="swp30",mr={vfx:0,doc:1,rsa:2,swp30:3,segapcm:4,ga20:5,upd933:6};class fr{static instance;module=null;isInitialized=!1;heapU8=null;constructor(){}static getInstance(){return fr.instance||(fr.instance=new fr),fr.instance}async init(){if(this.isInitialized)return;const e="/DEViLBOX/";try{const t=await fetch(`${e}mame/MAMEChips.js`),n=await t.text(),a=new Function(`${n}; return MAMEChips;`)(),s=await fetch(`${e}mame/MAMEChips.wasm`),r=await s.arrayBuffer();this.module=await a({wasmBinary:r}),this.module.wasmMemory&&(this.heapU8=new Uint8Array(this.module.wasmMemory.buffer)),this.isInitialized=!0}catch(t){throw new Error(`MAMEChips WASM failed to load: ${t}`)}}createInstance(e,t){if(!this.isInitialized)return 0;const n=mr[e];return this.module._mame_create_instance(n,t)}deleteInstance(e){this.isInitialized&&0!==e&&this.module._mame_delete_instance(e)}write(e,t,n){this.isInitialized&&0!==e&&this.module._mame_write(e,t,n)}write16(e,t,n){this.isInitialized&&0!==e&&this.module._mame_write16(e,t,n)}read(e,t){return this.isInitialized&&0!==e?this.module._mame_read(e,t):0}setRom(e,t){if(!this.isInitialized||!this.heapU8)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_set_rom(e,n,t.length)}addMidiEvent(e,t){if(!this.isInitialized||0===e||!this.heapU8)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_add_midi_event(e,n,t.length),this.module._free(n)}rsaLoadRoms(e,t,n,a){if(!this.isInitialized||0===e||!this.heapU8)return;const s=this.module._malloc(t.length),r=this.module._malloc(n.length),o=this.module._malloc(a.length);this.heapU8.set(t,s),this.heapU8.set(n,r),this.heapU8.set(a,o),this.module._rsa_load_roms(e,s,r,o)}render(e,t=128){if(!this.isInitialized||0===e||!this.module.wasmMemory)return{left:new Float32Array(t),right:new Float32Array(t)};const n=this.module._malloc(4*t),a=this.module._malloc(4*t);this.module._mame_render(e,n,a,t);const s=this.module.wasmMemory.buffer,r=new Float32Array(s,n,t).slice(),o=new Float32Array(s,a,t).slice();return this.module._free(n),this.module._free(a),{left:r,right:o}}}class yr{name="MAMESynth";output;engine=fr.getInstance();config;isInitialized=!1;initInProgress=!1;handle=0;voices=[];numHardwareVoices=32;constructor(e){this.output=Ja().createGain(),this.config=e,"rsa"===e.type?this.numHardwareVoices=16:"swp30"===e.type&&(this.numHardwareVoices=64);for(let t=0;t<this.numHardwareVoices;t++)this.voices.push({note:"",active:!1,voiceIndex:t,startTime:0});this.initEngine()}async ensureInitialized(){if(!this.isInitialized)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.isInitialized&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.isInitialized){this.initInProgress=!0;try{await this.engine.init();let e=16e6;"rsa"===this.config.type?e=2e7:"swp30"===this.config.type&&(e=33868800);const t=this.config.clock||e;if(this.handle=this.engine.createInstance(this.config.type,t),this.config.roms)for(const n of this.config.roms)this.engine.setRom(n.bank,n.data);this.isInitialized=!0,"vfx"===this.config.type&&(this.engine.write(this.handle,88,31),this.engine.write(this.handle,96,1)),this.startRendering()}catch(e){}finally{this.initInProgress=!1}}}startRendering(){const e=Ja();if(!e||!e.createScriptProcessor)return;const t=e.createScriptProcessor(512,0,2);t.onaudioprocess=e=>{if(!this.isInitialized||0===this.handle)return;const t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1),{left:a,right:s}=this.engine.render(this.handle,512);t.set(a),n.set(s)},t.connect(this.output)}getHandle(){return this.handle}write(e,t){this.isInitialized&&0!==this.handle&&this.engine.write(this.handle,e,t)}write16(e,t){this.isInitialized&&0!==this.handle&&this.engine.write16(this.handle,e,t)}read(e){return this.isInitialized&&0!==this.handle?this.engine.read(this.handle,e):0}findFreeVoice(){const e=this.voices.find(e=>!e.active);return e||this.voices.sort((e,t)=>e.startTime-t.startTime)[0]}triggerAttack(e,t,n=1){if(!this.isInitialized||0===this.handle)return this;const a=os(e),s=this.findFreeVoice();s.note=e,s.active=!0,s.startTime=Date.now();const r=s.voiceIndex;if("vfx"===this.config.type){this.engine.write(this.handle,120,r),this.engine.write16(this.handle,0,1);const e=44100,t=Math.floor(2048*a*32/e);this.engine.write16(this.handle,8,65535&t),this.engine.write(this.handle,10,t>>16&255),this.engine.write16(this.handle,136,0),this.engine.write16(this.handle,144,8192);const s=Math.floor(65535*n);this.engine.write16(this.handle,16,s),this.engine.write16(this.handle,0,0)}else if("doc"===this.config.type){this.engine.write(this.handle,224,0),this.engine.write(this.handle,0+r,0);const e=Math.floor(65536*a/1e3);this.engine.write(this.handle,0+r,255&e),this.engine.write(this.handle,32+r,e>>8&255),this.engine.write(this.handle,64+r,Math.floor(255*n)),this.engine.write(this.handle,128+r,0)}else if("rsa"===this.config.type){const e=Math.floor(16384*a/32e3);for(let t=0;t<10;t++){const n=256*r+16*t;this.engine.write(this.handle,n+0,255&e),this.engine.write(this.handle,n+1,e>>8&255),this.engine.write(this.handle,n+5,127)}}else if("swp30"===this.config.type){const e=r<<6,t=Math.floor(1024*a/44100);this.engine.write16(this.handle,10|e,t)}return this}triggerRelease(e,t){if(!this.isInitialized||0===this.handle)return this;const n=this.voices.find(t=>t.active&&t.note===e);if(!n)return this;n.active=!1;const a=n.voiceIndex;if("vfx"===this.config.type)this.engine.write(this.handle,120,a),this.engine.write16(this.handle,0,1);else if("doc"===this.config.type)this.engine.write(this.handle,128+a,1);else if("rsa"===this.config.type)for(let s=0;s<10;s++){const e=256*a+16*s;this.engine.write(this.handle,e+5,255)}return this}dispose(){0!==this.handle&&(this.engine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const gr=new Map,vr=new WeakMap;function br(e,t){return e.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory')}const xr={VOLUME:0,ARPEGGIO:1,DUTY:2,WAVETABLE:3,PITCH:4,PANNING:5,PHASE_RESET:6,ALG:7,FB:8,FMS:9,AMS:10};const wr={numVoices:1,numOperators:0,hasFM:!1,hasAlgorithm:!1,hasFeedback:!1,hasVibrato:!1,hasTremolo:!1,hasPitchLFO:!1,hasAmpLFO:!1,hasWavetable:!1,hasPCM:!1,hasNoise:!1,hasADSR:!0,hasSSG:!1,hasPanning:!1,hasStereo:!1,hasDSP:!1,hasReverb:!1,sampleRAMSize:0},kr={AICA:{numVoices:64,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:2097152},SCSP:{numVoices:32,numOperators:4,hasFM:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:524288},C352:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},ES5503:{numVoices:32,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:65536},YMF271:{numVoices:12,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:4194304},YMOPQ:{numVoices:8,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasADSR:!0,hasPanning:!1,hasStereo:!1},K054539:{numVoices:8,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:8388608},ICS2115:{numVoices:32,hasWavetable:!0,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},RF5C400:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},SN76477:{numVoices:1,hasNoise:!0,hasVibrato:!0},TMS36XX:{numVoices:6,hasADSR:!1},TMS5220:{numVoices:1},MEA8000:{numVoices:1},Votrax:{numVoices:1},Astrocade:{numVoices:3,hasNoise:!0,hasVibrato:!0},SNKWave:{numVoices:3,hasWavetable:!0},SP0250:{numVoices:1},UPD931:{numVoices:1},UPD933:{numVoices:8,hasWavetable:!0,hasADSR:!0},TR707:{numVoices:15,hasPCM:!0,sampleRAMSize:32768},VASynth:{numVoices:16,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0},CEM3394:{numVoices:1,hasADSR:!0,hasVibrato:!0},ASC:{numVoices:4,hasWavetable:!0,hasStereo:!0}};function Sr(e){return{...wr,...kr[e]||{}}}const Mr=0,Nr=1,Cr=2,Er=3;class Pr{channelMemory=new Map;speed=6;bpm=125;constructor(){}getChannelMemory(e){return this.channelMemory.has(e)||this.channelMemory.set(e,{arpeggioX:0,arpeggioY:0,arpeggioTick:0,pitchSlideUp:0,pitchSlideDown:0,tonePortamento:0,tonePortamentoTarget:null,vibratoSpeed:0,vibratoDepth:0,vibratoPhase:0,vibratoWaveform:0,tremoloSpeed:0,tremoloDepth:0,tremoloPhase:0,tremoloWaveform:0,volumeSlide:0,currentVolume:64,currentPanning:128,currentPitch:440,currentPitchOffset:0,noteCutTick:-1,noteDelayTick:-1,retriggerTick:0,retriggerVolume:0,sampleOffset:0,loopStart:0,loopCount:0,loopRow:0}),this.channelMemory.get(e)}setSpeed(e){this.speed=Math.max(1,Math.min(31,e))}setBPM(e){this.bpm=Math.max(32,Math.min(255,e))}getSpeed(){return this.speed}getBPM(){return this.bpm}processTickZero(e,t,n,a,s){const r=this.getChannelMemory(t),o={positionJump:null,patternBreak:null,patternDelay:0};if(!e||e.length<3)return o;const i=e.charAt(0).toUpperCase(),l=parseInt(e.substring(1),16),c=l>>4&15,d=15&l;switch(n>0&&(r.currentPitch=n),i){case"0":l>0&&(r.arpeggioX=c,r.arpeggioY=d,r.arpeggioTick=0);break;case"1":l>0&&(r.pitchSlideUp=l);break;case"2":l>0&&(r.pitchSlideDown=l);break;case"3":l>0&&(r.tonePortamento=l),n>0&&(r.tonePortamentoTarget=n);break;case"4":c>0&&(r.vibratoSpeed=c),d>0&&(r.vibratoDepth=d);break;case"5":case"6":case"A":l>0&&(r.volumeSlide=l);break;case"7":c>0&&(r.tremoloSpeed=c),d>0&&(r.tremoloDepth=d);break;case"8":r.currentPanning=l,s.setPanning(l);break;case"9":l>0&&(r.sampleOffset=l),s.setSampleOffset(256*r.sampleOffset);break;case"B":o.positionJump=l;break;case"C":r.currentVolume=Math.min(l,64),s.setVolume(r.currentVolume);break;case"D":o.patternBreak=10*c+d;break;case"E":this.processExtendedTick0(l,t,a,s,o);break;case"F":0===l||(l<32?this.speed=l:this.bpm=l)}return o}processExtendedTick0(e,t,n,a,s){const r=this.getChannelMemory(t),o=15&e;switch(e>>4&15){case 1:r.currentPitchOffset+=4*o,a.setPitchOffset(r.currentPitchOffset);break;case 2:r.currentPitchOffset-=4*o,a.setPitchOffset(r.currentPitchOffset);break;case 3:case 5:break;case 4:r.vibratoWaveform=3&o;break;case 6:0===o?r.loopStart=n:0===r.loopCount?(r.loopCount=o,r.loopRow=r.loopStart):(r.loopCount--,r.loopCount>0&&(r.loopRow=r.loopStart));break;case 7:r.tremoloWaveform=3&o;break;case 8:r.currentPanning=17*o,a.setPanning(r.currentPanning);break;case 9:o>0&&(r.retriggerTick=o);break;case 10:r.currentVolume=Math.min(r.currentVolume+o,64),a.setVolume(r.currentVolume);break;case 11:r.currentVolume=Math.max(r.currentVolume-o,0),a.setVolume(r.currentVolume);break;case 12:r.noteCutTick=o,0===o&&a.cutNote();break;case 13:r.noteDelayTick=o;break;case 14:s.patternDelay=o}}processTickN(e,t,n,a){const s=this.getChannelMemory(t);if(!e)return;switch(e.charAt(0).toUpperCase()){case"0":this.processArpeggio(s,n,a);break;case"1":this.processPitchSlideUp(s,a);break;case"2":this.processPitchSlideDown(s,a);break;case"3":this.processTonePortamento(s,a);break;case"4":this.processVibrato(s,a);break;case"5":this.processTonePortamento(s,a),this.processVolumeSlide(s,a);break;case"6":this.processVibrato(s,a),this.processVolumeSlide(s,a);break;case"7":this.processTremolo(s,a);break;case"A":this.processVolumeSlide(s,a);break;case"E":this.processExtendedTickN(e,s,n,a)}}processExtendedTickN(e,t,n,a){switch(parseInt(e.substring(1),16)>>4&15){case 9:t.retriggerTick>0&&n%t.retriggerTick===0&&a.retriggerNote(t.currentVolume/64);break;case 12:n===t.noteCutTick&&a.cutNote()}}processArpeggio(e,t,n){if(0===e.arpeggioX&&0===e.arpeggioY)return;let a=0;switch(t%3){case 0:a=0;break;case 1:a=e.arpeggioX;break;case 2:a=e.arpeggioY}const s=e.currentPitch*Math.pow(2,a/12);n.setFrequency(s)}processPitchSlideUp(e,t){e.pitchSlideUp>0&&(e.currentPitchOffset+=4*e.pitchSlideUp,t.setPitchOffset(e.currentPitchOffset))}processPitchSlideDown(e,t){e.pitchSlideDown>0&&(e.currentPitchOffset-=4*e.pitchSlideDown,t.setPitchOffset(e.currentPitchOffset))}processTonePortamento(e,t){if(0===e.tonePortamento||null===e.tonePortamentoTarget)return;const n=e.tonePortamentoTarget-e.currentPitch,a=4*e.tonePortamento;Math.abs(n)<a?e.currentPitch=e.tonePortamentoTarget:e.currentPitch+=n>0?a:-a,t.setFrequency(e.currentPitch)}processVibrato(e,t){if(0===e.vibratoDepth)return;const n=4*this.calculateWaveformValue(e.vibratoWaveform,e.vibratoPhase,e.vibratoDepth);t.setPitchOffset(e.currentPitchOffset+n),e.vibratoPhase=e.vibratoPhase+e.vibratoSpeed&63}processTremolo(e,t){if(0===e.tremoloDepth)return;const n=this.calculateWaveformValue(e.tremoloWaveform,e.tremoloPhase,e.tremoloDepth),a=Math.round(n),s=Math.max(0,Math.min(64,e.currentVolume+a));t.setVolume(s),e.tremoloPhase=e.tremoloPhase+e.tremoloSpeed&63}processVolumeSlide(e,t){if(0===e.volumeSlide)return;const n=e.volumeSlide>>4&15,a=15&e.volumeSlide;n>0?e.currentVolume=Math.min(e.currentVolume+n,64):a>0&&(e.currentVolume=Math.max(e.currentVolume-a,0)),t.setVolume(e.currentVolume)}calculateWaveformValue(e,t,n){const a=t/64*Math.PI*2;switch(e){case Mr:return Math.sin(a)*n;case Nr:return((64-t)/32-1)*n;case Cr:return(t<32?1:-1)*n;case Er:return(2*Math.random()-1)*n;default:return 0}}hasNoteDelay(e){return!!e&&(e.toUpperCase().startsWith("ED")&&"ED0"!==e)}getNoteDelayTick(e){return e&&e.toUpperCase().startsWith("ED")&&parseInt(e.substring(2),16)||0}reset(){this.channelMemory.clear(),this.speed=6,this.bpm=125}resetChannel(e){const t=this.getChannelMemory(e);t.currentPitchOffset=0,t.arpeggioX=0,t.arpeggioY=0,t.arpeggioTick=0,t.pitchSlideUp=0,t.pitchSlideDown=0,t.tonePortamentoTarget=null,t.vibratoPhase=0,t.tremoloPhase=0,t.noteCutTick=-1,t.noteDelayTick=-1}}function Tr(e,t){const n=t/64;return e*Math.pow(2,n/12)}function Ar(e){const t=function(e){return 69+12*Math.log2(e/440)}(e),n=Math.floor(t),a=t-n,s=Math.max(0,Math.min(127,n)),r=Math.round(64*a);return{kc:s,kf:Math.max(0,Math.min(63,r))}}class _r{output;workletNode=null;_initPromise;_pendingCalls=[];_isReady=!1;_disposed=!1;capabilities;config={};currentNote=60;currentFreq=261.63;currentVelocity=1;isNoteOn=!1;noteOnTime=0;static MIN_GATE_TIME=50;macros=new Map;opMacros=[];effectRouter;channelIndex=0;basePitchOffset=0;effectPitchOffset=0;oscBuffer=null;oscCallbacks=new Set;constructor(){this.output=Ja().createGain(),this.effectRouter=new Pr,this.capabilities=Sr("default")}initSynth(){this.capabilities=Sr(this.chipName),this._initPromise=this.initialize(),this.capabilities.numOperators>0&&(this.opMacros=Array.from({length:this.capabilities.numOperators},()=>({})))}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=Ja(),{wasmBinary:t,jsCode:n}=await async function(e,t,n){const a="/DEViLBOX/";let s=vr.get(e);if(s||(s=new Set,vr.set(e,s)),!s.has("__mame_init_helper__")){try{await e.audioWorklet.addModule(`${a}mame/mame-worklet-init.js`)}catch(r){}s.add("__mame_init_helper__")}if(!s.has(t)){try{await e.audioWorklet.addModule(`${a}mame/${n}`)}catch(r){}s.add(t)}if(!gr.has(t)){const e=(async()=>{const[e,n]=await Promise.all([fetch(`${a}mame/${t}.wasm`),fetch(`${a}mame/${t}.js`)]);if(!e.ok)throw new Error(`Failed to load ${t}.wasm: ${e.status}`);if(!n.ok)throw new Error(`Failed to load ${t}.js: ${n.status}`);const[s,r]=await Promise.all([e.arrayBuffer(),n.text()]);return{wasmBinary:s,jsCode:br(r,`${a}mame/`)}})();gr.set(t,e)}return gr.get(t)}(e,this.chipName,this.workletFile);if(this._disposed)return;const a=this.output,{workletNode:s,readyPromise:r}=function(e,t,n,a,s){const r=new AudioWorkletNode(e,t,{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),o=new Promise((e,n)=>{const a=setTimeout(()=>n(new Error(`${t} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=o=>{"ready"===o.data.type?(clearTimeout(a),e()):"error"===o.data.type&&(clearTimeout(a),n(new Error(o.data.message||`${t} init error`))),s&&s.call(r.port,o)}});r.port.postMessage({type:"init",wasmBinary:n,jsCode:a,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch(i){}return{workletNode:r,readyPromise:o}}(e,this.processorName,t,n,a);this.workletNode=s;const o=this.workletNode.port.onmessage;this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data),o&&o.call(this.workletNode.port,e)},await r}catch(e){}}handleWorkletMessage(e){switch(e.type){case"ready":this._isReady=!0;for(const e of this._pendingCalls)this.processPendingCall(e);this._pendingCalls=[];break;case"oscData":e.buffer&&(this.oscBuffer=new Float32Array(e.buffer),this.oscCallbacks.forEach(e=>e(this.oscBuffer)))}}processPendingCall(e){"setParam"===e.method&&this.setParam(e.args[0],e.args[1])}triggerAttack(e,t,n=1){this._disposed||(this.currentNote="string"==typeof e?function(e){const t=e.match(/^([A-Ga-g][#b]?)[-]?(\d)$/);if(!t)return 60;const n=t[1].toUpperCase(),a=parseInt(t[2]),s={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===s?60:12*(a+1)+s}(e):e>127?Math.round(12*Math.log2(e/440)+69):e,this.currentFreq=function(e){return 440*Math.pow(2,(e-69)/12)}(this.currentNote),this.currentVelocity=n,this.isNoteOn=!0,this.noteOnTime=Date.now(),this.resetMacros(),this.effectRouter.resetChannel(this.channelIndex),this.writeKeyOn(this.currentNote,n))}triggerRelease(e){if(this._disposed)return;const t=Date.now()-this.noteOnTime;t<_r.MIN_GATE_TIME?setTimeout(()=>this.triggerRelease(e),_r.MIN_GATE_TIME-t):(this.isNoteOn=!1,this.releaseMacros(),this.writeKeyOff())}triggerAttackRelease(e,t,n,a){if(this._disposed)return;this.triggerAttack(e,n,a||1);const s=ls(t);setTimeout(()=>{this._disposed||this.triggerRelease()},1e3*s)}releaseAll(){this.workletNode&&!this._disposed&&(this.workletNode.port.postMessage({type:"allNotesOff"}),this.isNoteOn=!1)}setFrequency(e){this.currentFreq=e,this.writeFrequency(e)}setPitchOffset(e){this.effectPitchOffset=e;const t=Tr(this.currentFreq,this.basePitchOffset+e);this.writeFrequency(t)}setVolume(e){const t=e/64;this.writeVolume(t*this.currentVelocity)}setPanning(e){this.writePanning(e)}setSampleOffset(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setSampleOffset",offset:e})}retriggerNote(e){this.writeKeyOn(this.currentNote,e)}cutNote(){this.writeVolume(0),this.isNoteOn=!1}writeDuty(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:100,value:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"selectWavetable",index:e})}writePhaseReset(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"phaseReset"})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dr",value:t})}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"sl",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dt",value:t})}setMacro(e){const t={type:e.type,data:e.data,loop:e.loop??-1,release:e.release??-1,position:0,active:e.data.length>0,released:!1};this.macros.set(e.type,t)}setMacros(e){for(const t of e)this.setMacro(t)}clearMacros(){this.macros.clear()}resetMacros(){this.macros.forEach(e=>{e.position=0,e.released=!1});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.position=0,n.released=!1)}}releaseMacros(){this.macros.forEach(e=>{e.released=!0,e.release>=0&&e.release<e.data.length&&(e.position=e.release)});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.released=!0,n.release>=0&&n.release<n.data.length&&(n.position=n.release))}}processTick(e=is()){this.isNoteOn&&(this.macros.forEach((e,t)=>{if(!e.active||0===e.data.length)return;let n=e.position;n>=e.data.length&&(n=e.data.length-1);const a=e.data[n];this.applyMacroValue(t,a),n++,n>=e.data.length&&(n=e.loop>=0?e.loop:e.data.length-1),e.position=n}),this.processOperatorMacros())}applyMacroValue(e,t){switch(e){case xr.VOLUME:const e=t/127*this.currentVelocity;this.writeVolume(e);break;case xr.ARPEGGIO:const n=t>127?t-256:t,a=this.currentFreq*Math.pow(2,n/12);this.writeFrequency(a);break;case xr.DUTY:this.writeDuty(t);break;case xr.WAVETABLE:this.writeWavetableSelect(t);break;case xr.PITCH:const s=t>127?t-256:t;this.basePitchOffset=s;const r=Tr(this.currentFreq,this.basePitchOffset+this.effectPitchOffset);this.writeFrequency(r);break;case xr.PANNING:const o=t>127?t-256:t;this.writePanning(128+o);break;case xr.PHASE_RESET:0!==t&&this.writePhaseReset();break;case xr.ALG:this.setFMAlgorithm(t);break;case xr.FB:this.setFMFeedback(t);break;case xr.FMS:this.setFMSensitivity(t);break;case xr.AMS:this.setAMSensitivity(t)}}processOperatorMacros(){for(let e=0;e<this.opMacros.length;e++){const t=this.opMacros[e];if(t){if(t.tl?.active){const n=this.advanceOpMacro(t.tl);this.setOperatorTL(e,n)}if(t.ar?.active){const n=this.advanceOpMacro(t.ar);this.setOperatorAR(e,n)}if(t.dr?.active){const n=this.advanceOpMacro(t.dr);this.setOperatorDR(e,n)}if(t.sl?.active){const n=this.advanceOpMacro(t.sl);this.setOperatorSL(e,n)}if(t.rr?.active){const n=this.advanceOpMacro(t.rr);this.setOperatorRR(e,n)}if(t.mult?.active){const n=this.advanceOpMacro(t.mult);this.setOperatorMult(e,n)}if(t.dt?.active){const n=this.advanceOpMacro(t.dt);this.setOperatorDetune(e,n)}}}}advanceOpMacro(e){if(!e.active||0===e.data.length)return 0;let t=e.position;t>=e.data.length&&(t=e.data.length-1);const n=e.data[t];return t++,t>=e.data.length&&(t=e.loop>=0?e.loop:e.data.length-1),e.position=t,n}setFMAlgorithm(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:200,value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:201,value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:202,value:e})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:203,value:e})}processEffectTick0(e,t,n){return this.effectRouter.processTickZero(e,this.channelIndex,t,n,this)}processEffectTickN(e,t){this.effectRouter.processTickN(e,this.channelIndex,t,this)}hasNoteDelay(e){return this.effectRouter.hasNoteDelay(e)}getNoteDelayTick(e){return this.effectRouter.getNoteDelayTick(e)}setChannelIndex(e){this.channelIndex=e}getOscData(){return this.oscBuffer}onOscData(e){return this.oscCallbacks.add(e),this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!0}),()=>{this.oscCallbacks.delete(e),0===this.oscCallbacks.size&&this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!1})}}setParam(e,t){this._isReady||this._pendingCalls.push({method:"setParam",args:[e,t]})}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r??0})}dispose(){this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.oscCallbacks.clear(),this.output.disconnect()}}class Ir extends u{name="TapeSaturation";inputGain;saturation;toneFilter;outputGain;dryGain;wetGain;_drive;_tone;_wet;input;output;constructor(e={}){super(),this._drive=e.drive??.5,this._tone=e.tone??12e3,this._wet=e.wet??1,this.input=new p(1),this.output=new p(1),this.inputGain=new p(this.calculateInputGain(this._drive)),this.saturation=new h(this.createSaturationCurve(this._drive),4096),this.toneFilter=new m({type:"lowpass",frequency:this._tone,rolloff:-12,Q:.7}),this.outputGain=new p(this.calculateMakeupGain(this._drive)),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.input.connect(this.inputGain),this.inputGain.connect(this.saturation),this.saturation.connect(this.toneFilter),this.toneFilter.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output)}createSaturationCurve(e){const t=new Float32Array(4096),n=1+8*e;for(let a=0;a<4096;a++){const e=a/4096*2-1;t[a]=e>=0?.95*Math.tanh(e*n)+.02*e:Math.tanh(e*n*.85)}return t}calculateInputGain(e){return 1+2*e}calculateMakeupGain(e){return 1/(1+.5*e)}get drive(){return this._drive}set drive(e){this._drive=Math.max(0,Math.min(1,e)),this.inputGain.gain.value=this.calculateInputGain(this._drive),this.saturation.curve=this.createSaturationCurve(this._drive),this.outputGain.gain.value=this.calculateMakeupGain(this._drive)}get tone(){return this._tone}set tone(e){this._tone=Math.max(2e3,Math.min(2e4,e)),this.toneFilter.frequency.value=this._tone}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.inputGain.dispose(),this.saturation.dispose(),this.toneFilter.dispose(),this.outputGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this}}const Dr=2048;function Or(e){const t=new Float32Array(Dr),n=new Float32Array(Dr);switch(e){case"sine":n[1]=1;break;case"saw":for(let e=1;e<1024;e++)n[e]=2/(e*Math.PI)*(e%2==0?1:-1);break;case"square":for(let e=1;e<1024;e+=2)n[e]=4/(e*Math.PI);break;case"triangle":for(let e=1;e<1024;e+=2)n[e]=8/(Math.PI*Math.PI*e*e)*((e-1)/2%2==0?1:-1)}return{real:t,imag:n}}function Fr(e){const t=new Float32Array(Dr),n=new Float32Array(Dr);for(let a=1;a<1024;a++)n[a]=2/(a*Math.PI)*Math.sin(a*Math.PI*e);return{real:t,imag:n}}function Rr(e,t,n){const a=new Float32Array(Dr),s=new Float32Array(Dr),r=[e,t,n],o=[100,150,200];for(let i=1;i<1024;i++){const e=100*i;let t=0;for(let n=0;n<r.length;n++){const a=Math.abs(e-r[n]);t+=Math.exp(-a*a/(2*o[n]*o[n]))}s[i]=t/(.5*i+1)}return{real:a,imag:s}}const jr=[{id:"basic-saw",name:"Saw",category:"Basic",frames:[Or("saw")]},{id:"basic-square",name:"Square",category:"Basic",frames:[Or("square")]},{id:"basic-triangle",name:"Triangle",category:"Basic",frames:[Or("triangle")]},{id:"basic-sine",name:"Sine",category:"Basic",frames:[Or("sine")]},{id:"analog-sweep",name:"Analog Sweep",category:"Analog",frames:[Or("sine"),Or("triangle"),Or("saw"),Or("square")]},{id:"pwm",name:"PWM",category:"Analog",frames:[Fr(.1),Fr(.25),Fr(.5),Fr(.75),Fr(.9)]},{id:"saw-stack",name:"Saw Stack",category:"Analog",frames:[Or("saw"),(()=>{const e=Or("saw");for(let t=1;t<1024;t++){const n=.1*Math.PI*t,a=Math.cos(n),s=Math.sin(n),r=e.real[t],o=e.imag[t];e.real[t]=r*a-o*s,e.imag[t]=r*s+o*a}return e})()]},{id:"digital-harmonics",name:"Digital",category:"Digital",frames:[(()=>{const e=new Float32Array(Dr),t=new Float32Array(Dr);for(let n=1;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})(),(()=>{const e=new Float32Array(Dr),t=new Float32Array(Dr);for(let n=2;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})()]},{id:"vocal-a",name:"Vocal A",category:"Vocal",frames:[Rr(800,1200,2800)]},{id:"vocal-morph",name:"Vocal Morph",category:"Vocal",frames:[Rr(300,2300,3e3),Rr(500,1800,2500),Rr(800,1200,2800),Rr(450,800,2500),Rr(300,600,2300)]},{id:"metallic",name:"Metallic",category:"FX",frames:[(()=>{const e=new Float32Array(Dr),t=new Float32Array(Dr);return[1,2.756,5.404,8.933,13.344].forEach((e,n)=>{const a=Math.round(e);a<1024&&(t[a]=1/(n+1))}),{real:e,imag:t}})()]}];function Lr(e,t){if(1===e.frames.length)return e.frames[0];const n=t*(e.frames.length-1),a=Math.floor(n),s=n-a;return a>=e.frames.length-1?e.frames[e.frames.length-1]:function(e,t,n){const a=new Float32Array(Dr),s=new Float32Array(Dr);for(let r=0;r<Dr;r++)a[r]=e.real[r]*(1-n)+t.real[r]*n,s[r]=e.imag[r]*(1-n)+t.imag[r]*n;return{real:a,imag:s}}(e.frames[a],e.frames[a+1],s)}class Br{name="WavetableSynth";output;voices=new Map;voicePool=[];config;audioContext;filter;outputGain;baseMorphPosition=0;constructor(e){this.config=e,this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.filter=this.audioContext.createBiquadFilter(),this.filter.type=e.filter.type,this.filter.frequency.value=e.filter.cutoff,this.filter.Q.value=e.filter.resonance/10,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=2,this.filter.connect(this.outputGain),this.outputGain.connect(this.output);for(let t=0;t<8;t++)this.voicePool.push(this.createVoice());this.baseMorphPosition=e.morphPosition/100}createVoice(){return new Vr(this.config,this.filter,this.audioContext)}getCurrentMorphPosition(){return Math.max(0,Math.min(1,this.baseMorphPosition))}triggerAttack(e,t,n=1){const a=t??is(),s="string"==typeof e?os(e):e,r="string"==typeof e?rs(e):Math.round(69+12*Math.log2(e/440));let o=this.voicePool.pop();if(!o){const e=this.voices.keys().next().value;void 0!==e&&(o=this.voices.get(e),this.voices.delete(e))}if(o){const e=this.getCurrentMorphPosition();if(o.setMorphPosition(e),o.triggerAttack(s,a,n),this.voices.set(r,o),0!==this.config.filter.envelopeAmount){const e=this.config.filter.cutoff,t=this.config.filter.envelopeAmount/100,n=Math.min(2e4,e+t*(2e4-e)),s=this.config.filterEnvelope.attack/1e3,r=this.config.filterEnvelope.decay/1e3,o=e+(n-e)*(this.config.filterEnvelope.sustain/100);this.filter.frequency.cancelScheduledValues(a),this.filter.frequency.setValueAtTime(e,a),this.filter.frequency.linearRampToValueAtTime(n,a+s),this.filter.frequency.linearRampToValueAtTime(o,a+s+r)}}}triggerRelease(e,t){const n=t??is(),a="string"==typeof e?rs(e):Math.round(69+12*Math.log2(e/440)),s=this.voices.get(a);s&&(s.triggerRelease(n),this.voices.delete(a),setTimeout(()=>{this.voicePool.push(s)},this.config.envelope.release+100))}triggerAttackRelease(e,t,n,a=1){const s=n??is(),r="string"==typeof t?ls(t):t;this.triggerAttack(e,s,a),this.triggerRelease(e,s+r)}setMorphPosition(e){this.baseMorphPosition=Math.max(0,Math.min(1,e));const t=this.getCurrentMorphPosition();this.voices.forEach(e=>{e.setMorphPosition(t)})}setMorphLFORate(e){this.config.morphLFORate=e}setFilterCutoff(e){this.config.filter.cutoff=e,this.filter.frequency.value=e}setFilterResonance(e){this.config.filter.resonance=e,this.filter.Q.value=e/10}updateConfig(e){this.config={...this.config,...e},e.filter&&(e.filter.type&&(this.filter.type=e.filter.type),void 0!==e.filter.cutoff&&(this.filter.frequency.value=e.filter.cutoff),void 0!==e.filter.resonance&&(this.filter.Q.value=e.filter.resonance/10))}dispose(){this.voices.forEach(e=>e.dispose()),this.voicePool.forEach(e=>e.dispose()),this.filter.disconnect(),this.outputGain.disconnect(),this.output.disconnect()}}class Vr{oscillators=[];gains=[];panners=[];config;audioContext;attackTime;decayTime;sustainLevel;releaseTime;constructor(e,t,n){this.config=e,this.audioContext=n,this.attackTime=e.envelope.attack/1e3,this.decayTime=e.envelope.decay/1e3,this.sustainLevel=e.envelope.sustain/100,this.releaseTime=e.envelope.release/1e3;const a=e.unison.voices,s=e.unison.detune,r=e.unison.stereoSpread/100;for(let o=0;o<a;o++){let e=0;a>1&&(e=(o/(a-1)*2-1)*s);let i=0;a>1&&(i=(o/(a-1)*2-1)*r);const l=n.createOscillator();l.detune.value=e;const c=n.createGain();c.gain.value=0;const d=n.createStereoPanner();d.pan.value=i,l.connect(c),c.connect(d),d.connect(t),this.oscillators.push(l),this.gains.push(c),this.panners.push(d)}this.setMorphPosition(e.morphPosition/100)}setMorphPosition(e){const t=(n=this.config.wavetableId,jr.find(e=>e.id===n));var n;if(!t)return;const a=Lr(t,e),s=Math.min(32,a.imag.length),r=new Float32Array(s+1),o=new Float32Array(s+1);for(let l=1;l<s;l++)o[l+1-1]=a.imag[l];const i=this.audioContext.createPeriodicWave(r,o,{disableNormalization:!1});this.oscillators.forEach(e=>{e.setPeriodicWave(i)})}triggerAttack(e,t,n){this.oscillators.forEach(n=>{n.frequency.setValueAtTime(e,t),n.start(t)}),this.gains.forEach(e=>{const n=e.gain;n.cancelScheduledValues(t),n.setValueAtTime(0,t),n.linearRampToValueAtTime(1,t+this.attackTime),n.linearRampToValueAtTime(this.sustainLevel,t+this.attackTime+this.decayTime)})}triggerRelease(e){this.gains.forEach(t=>{const n=t.gain;n.cancelScheduledValues(e),n.setValueAtTime(n.value,e),n.linearRampToValueAtTime(0,e+this.releaseTime)});const t=e+this.releaseTime+.1;this.oscillators.forEach(e=>{e.stop(t)})}dispose(){this.oscillators.forEach(e=>{try{e.stop()}catch(t){}e.disconnect()}),this.gains.forEach(e=>e.disconnect()),this.panners.forEach(e=>e.disconnect())}}class zr{audioContext;workletNode=null;isInitialized=!1;currentModel=null;outputGain;static BUILT_IN_MODELS=[{name:"Ibanez TS9",fileName:"TS9_DriveKnob.json",type:"pedal"},{name:"Ibanez Mostortion Clone",fileName:"Ibanez_Mostortion_Clone_GainKnob.json",type:"pedal"},{name:"Mooer CaliMkIV",fileName:"Mooer_CaliMkIV_GainKnob.json",type:"pedal"},{name:"Boss MT2",fileName:"BossMT2_PedalHighGain.json",type:"pedal"},{name:"Pro Co RAT Distortion",fileName:"ProcoRatPedal_HighGain.json",type:"pedal"},{name:"MXR 78",fileName:"MXR78_pedal_DistKnob.json",type:"pedal"},{name:"Ibanez TS808",fileName:"Ibanez808TubeScreamer.json",type:"pedal"},{name:"RevvG3 Pedal",fileName:"RevvG3_Pedal_GainKnob.json",type:"pedal"},{name:"Jeckyl and Hyde Distortion",fileName:"Jeckyl_and_Hyde_Distortion_DriveKnob.json",type:"pedal"},{name:"Friedman BEOD Pedal",fileName:"Friedman_BEOD_Pedal_GainKnob.json",type:"pedal"},{name:"Blackstar HT40 Clean",fileName:"BlackstarHT40_AmpClean.json",type:"amp"},{name:"Mesa Mini Rec High Gain",fileName:"MesaMiniRec_HighGain_DirectOut.json",type:"amp"},{name:"Splawn OD High Gain",fileName:"Splawn_OD_FractalFM3_HighGain.json",type:"amp"},{name:"Ethos Lead Channel",fileName:"EthosLeadChan_GainKnob.json",type:"amp"},{name:"Princeton Amp Clean",fileName:"PrincetonAmp_Clean.json",type:"amp"},{name:"Dumble Kit High Gain",fileName:"DumbleKit_HighG_DirectOut.json",type:"amp"},{name:"Blackstar HT40 Gain",fileName:"BlackstarHT40_GainKnob_SM57mic.json",type:"amp"},{name:"T-Rex Mudhoney + Pork Loin",fileName:"TRexMudhoney_plus_PorkLoin_HighGain.json",type:"pedal"},{name:"Prince Of Tone OD",fileName:"PrinceOfToneClone_OD_Knob.json",type:"pedal"},{name:"Pork Loin Pedal",fileName:"PorkLoinPedal_LowGain.json",type:"pedal"},{name:"Prince Of Tone Dist",fileName:"PrinceOfToneClone_Dist_Knob.json",type:"pedal"},{name:"Aguilar Agro Bright Bass",fileName:"AguilarAgro_Bright_Bass.json",type:"bass"},{name:"Aguilar Agro Dark Bass",fileName:"AguilarAgro_Dark_Bass.json",type:"bass"},{name:"BadCat50 Med Gain",fileName:"BadCat50_MedGain_PREAMP.json",type:"amp"},{name:"ShiftTwin Clean2",fileName:"ShiftTwin_Clean2_PREAMP.json",type:"amp"},{name:"Sovtek50 Med Gain",fileName:"Sovtek50_MedGain_DIRECT.json",type:"amp"},{name:"ShiftTwin StampedeDT",fileName:"ShiftTwin_StampedeDT_PREAMP.json",type:"amp"},{name:"Sovtek50 Dod FX56B",fileName:"Sovtek50_DodFX56B_DIRECT.json",type:"amp"},{name:"ENGL E645 Clean",fileName:"ENGL_E645_Clean_EdoardoNapoli.json",type:"amp"},{name:"Filmosound with Cab",fileName:"Filmosound_with_cab.json",type:"amp"},{name:"ENGL E430 Clean",fileName:"ENGL_E430_Clean_EdoardoNapoli.json",type:"amp"},{name:"El Coyote Trainwreck",fileName:"ElCoyote_Trainwreck_Crunch.json",type:"amp"},{name:"Supro Bold Drive",fileName:"Supro_Bold_DriveKnob.json",type:"amp"},{name:"Goat Pedal High Gain",fileName:"GoatPedal_HighGain.json",type:"pedal"},{name:"Protein Blue Pedal",fileName:"ProteinBlue_pedal_DriveKnob.json",type:"pedal"},{name:"Little Big Muff",fileName:"LittleBigMuff_HighGainPedal.json",type:"pedal"},{name:"Big Muff V6",fileName:"BigMuff_V6_T3_S5.json",type:"pedal"}];constructor(e){this.audioContext=e,this.outputGain=e.createGain(),this.outputGain.gain.value=1}async initialize(){if(!this.isInitialized)try{const e="/DEViLBOX/";await this.audioContext.audioWorklet.addModule(`${e}GuitarML.worklet.js`),this.workletNode=new AudioWorkletNode(this.audioContext,"guitarml-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]}),this.workletNode.connect(this.outputGain),this.workletNode.port.onmessage=e=>this.handleWorkletMessage(e.data),this.isInitialized=!0}catch(e){throw e}}handleWorkletMessage(e){if("modelLoaded"===e.type)e.success}async loadModel(e){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");if(e<0||e>=zr.BUILT_IN_MODELS.length)throw new Error(`Invalid model index: ${e}`);const t=zr.BUILT_IN_MODELS[e];try{const e="/DEViLBOX/",n=await fetch(`${e}models/guitarml/${t.fileName}`);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const a=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:a}),this.currentModel=t}catch(n){throw n}}async loadModelFromURL(e,t){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const a=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:a}),this.currentModel={name:t,fileName:e,type:"pedal"}}catch(n){throw n}}setParameter(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setGain(e){this.setParameter("gain",e)}setCondition(e){this.setParameter("condition",e)}setDryWet(e){this.setParameter("dryWet",e)}setEnabled(e){this.setParameter("enabled",e?1:0)}setUseSRCFilter(e){this.setParameter("useSRCFilter",e?1:0)}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}connect(e){this.outputGain.connect(e)}disconnect(){this.outputGain.disconnect()}getInput(){if(!this.workletNode)throw new Error("GuitarML not initialized - call initialize() first");return this.workletNode}getOutput(){return this.outputGain}isReady(){return this.isInitialized}getCurrentModel(){return this.currentModel}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.outputGain.disconnect(),this.isInitialized=!1}}class Ur extends u{name="NeuralEffectWrapper";input;output;guitarML;_wet;dryGain;wetGain;modelIndex;neuralOutputGain;eq3;presenceFilter;constructor(e){super(),this.modelIndex=e.modelIndex,this._wet=e.wet??1;const t=es(this.context);this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.guitarML=new zr(t),this.neuralOutputGain=new p(1),this.eq3=new f({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500}),this.presenceFilter=new m({type:"highshelf",frequency:4e3,gain:0,Q:.7}),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.neuralOutputGain.connect(this.eq3),this.eq3.connect(this.presenceFilter),this.presenceFilter.connect(this.wetGain),this.wetGain.connect(this.output)}async loadModel(){await this.guitarML.initialize();const e=ns(this.input),t=e?._nativeAudioNode||e;t&&t.connect(this.guitarML.getInput());const n=ns(this.neuralOutputGain),a=n?._nativeAudioNode||n;a&&this.guitarML.getOutput().connect(a),await this.guitarML.loadModel(this.modelIndex)}setParameter(e,t){const n=Math.max(0,Math.min(100,t))/100;switch(e){case"drive":case"gain":case"condition":this.guitarML.setCondition(n);break;case"dryWet":this.guitarML.setDryWet(n);break;case"level":case"output":this.wetGain.gain.value=n*this._wet;break;case"tone":case"presence":this.presenceFilter.gain.value=20*(n-.5);break;case"bass":this.eq3.low.value=30*(n-.5);break;case"mid":this.eq3.mid.value=30*(n-.5);break;case"treble":this.eq3.high.value=30*(n-.5)}}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.guitarML.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.neuralOutputGain.dispose(),this.eq3.dispose(),this.presenceFilter.dispose(),this}}class Gr extends u{name="SpaceEcho";input;output;head1;head2;head3;head1Gain;head2Gain;head3Gain;feedbackGain;saturation;eq;reverb;reverbGain;echoGain;wowLFO;wowGain;dryGain;wetGain;_options;constructor(e={}){super(),this._options={mode:e.mode??4,rate:e.rate??300,intensity:e.intensity??.5,echoVolume:e.echoVolume??.8,reverbVolume:e.reverbVolume??.3,bass:e.bass??0,treble:e.treble??0,wow:e.wow??.15,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.head1=new y(this._options.rate/1e3),this.head2=new y(2*this._options.rate/1e3),this.head3=new y(3*this._options.rate/1e3),this.head1Gain=new p(0),this.head2Gain=new p(0),this.head3Gain=new p(0),this.reverb=new g({decay:2.5,preDelay:.01}),this.reverb.generate(),this.reverbGain=new p(this._options.reverbVolume),this.echoGain=new p(this._options.echoVolume),this.feedbackGain=new p(this._options.intensity),this.saturation=new v(.1),this.eq=new f({low:this._options.bass,mid:0,high:this._options.treble,lowFrequency:200,highFrequency:2500}),this.wowLFO=new b(.5+.2*Math.random(),-.002,.002),this.wowLFO.type="sine",this.wowGain=new p(this._options.wow),this.wowLFO.connect(this.wowGain),this.wowLFO.start(),this.wowGain.connect(this.head1.delayTime),this.wowGain.connect(this.head2.delayTime),this.wowGain.connect(this.head3.delayTime),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.head1),this.input.connect(this.head2),this.input.connect(this.head3),this.input.connect(this.reverb),this.head1.connect(this.head1Gain),this.head2.connect(this.head2Gain),this.head3.connect(this.head3Gain);const t=new p(1);this.head1Gain.connect(t),this.head2Gain.connect(t),this.head3Gain.connect(t),t.connect(this.echoGain),this.echoGain.connect(this.eq),this.eq.connect(this.saturation),this.saturation.connect(this.feedbackGain),this.feedbackGain.connect(this.head1),this.feedbackGain.connect(this.head2),this.feedbackGain.connect(this.head3),this.reverb.connect(this.reverbGain),this.eq.connect(this.wetGain),this.reverbGain.connect(this.wetGain),this.wetGain.connect(this.output),this.setMode(this._options.mode)}setMode(e){this._options.mode=e;const t=[1,5,8,10,11].includes(e),n=[2,4,6,8,9,11].includes(e),a=[3,4,7,9,10,11].includes(e);this.head1Gain.gain.rampTo(t?1:0,.1),this.head2Gain.gain.rampTo(n?1:0,.1),this.head3Gain.gain.rampTo(a?1:0,.1);const s=e>=5;this.reverbGain.gain.rampTo(s?this._options.reverbVolume:0,.1)}setRate(e){this._options.rate=e,this.head1.delayTime.rampTo(e/1e3,.1),this.head2.delayTime.rampTo(2*e/1e3,.1),this.head3.delayTime.rampTo(3*e/1e3,.1)}setIntensity(e){this._options.intensity=e,this.feedbackGain.gain.rampTo(e,.1)}setEchoVolume(e){this._options.echoVolume=e,this.echoGain.gain.rampTo(e,.1)}setReverbVolume(e){this._options.reverbVolume=e,this._options.mode>=5&&this.reverbGain.gain.rampTo(e,.1)}setBass(e){this._options.bass=e,this.eq.low.value=e}setTreble(e){this._options.treble=e,this.eq.high.value=e}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.head1.dispose(),this.head2.dispose(),this.head3.dispose(),this.head1Gain.dispose(),this.head2Gain.dispose(),this.head3Gain.dispose(),this.feedbackGain.dispose(),this.reverb.dispose(),this.reverbGain.dispose(),this.echoGain.dispose(),this.eq.dispose(),this.saturation.dispose(),this.wowLFO.dispose(),this.wowGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}let Wr=null,Kr=null,Hr=!1,$r=null;class qr extends u{name="SpaceyDelayer";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={firstTap:e.firstTap??250,tapSize:e.tapSize??150,feedback:Math.min(e.feedback??40,95),multiTap:e.multiTap??1,tapeFilter:e.tapeFilter??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=es(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await qr.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"spacey-delayer-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("firstTap",this._options.firstTap),this.sendParam("tapSize",this._options.tapSize),this.sendParam("feedback",this._options.feedback),this.sendParam("multiTap",this._options.multiTap),this.sendParam("tapeFilter",this._options.tapeFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Wr,jsCode:Kr}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!Hr){if($r)return $r;$r=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}spacey-delayer/SpaceyDelayer.worklet.js`)}catch(n){const e=n?.message||String(n);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load SpaceyDelayer worklet: ${e}`)}if(!Wr||!Kr){const[e,n]=await Promise.all([fetch(`${t}spacey-delayer/SpaceyDelayer.wasm`),fetch(`${t}spacey-delayer/SpaceyDelayer.js`)]);if(!e.ok||!n.ok)throw $r=null,new Error(`Failed to fetch SpaceyDelayer WASM/JS: wasm=${e.status} js=${n.status}`);Wr=await e.arrayBuffer();let a=await n.text();a=a.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),a+="\nvar createSpaceyDelayer = createSpaceyDelayer || Module;",Kr=a}Hr=!0})();try{await $r}catch(t){throw $r=null,Hr=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setFirstTap(e){this._options.firstTap=Math.max(10,Math.min(e,2e3)),this.sendParam("firstTap",this._options.firstTap)}setTapSize(e){this._options.tapSize=Math.max(10,Math.min(e,1e3)),this.sendParam("tapSize",this._options.tapSize)}setFeedback(e){this._options.feedback=Math.max(0,Math.min(e,95)),this.sendParam("feedback",this._options.feedback)}setMultiTap(e){this._options.multiTap=e?1:0,this.sendParam("multiTap",e?1:0)}setTapeFilter(e){this._options.tapeFilter=e?1:0,this.sendParam("tapeFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}let Yr=null,Xr=null,Qr=!1,Zr=null;class Jr extends u{name="RETapeEcho";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={mode:Math.max(0,Math.min(e.mode??3,5)),repeatRate:Math.max(0,Math.min(e.repeatRate??.5,1)),intensity:Math.max(0,Math.min(e.intensity??.5,1)),echoVolume:Math.max(0,Math.min(e.echoVolume??.8,1)),wow:Math.max(0,Math.min(e.wow??0,1)),flutter:Math.max(0,Math.min(e.flutter??0,1)),dirt:Math.max(0,Math.min(e.dirt??0,1)),inputBleed:e.inputBleed??0,loopAmount:Math.max(0,Math.min(e.loopAmount??0,1)),playheadFilter:e.playheadFilter??1,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initialize()}async initialize(){try{const e=es(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await Jr.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"re-tape-echo-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("mode",this._options.mode),this.sendParam("repeatRate",this._options.repeatRate),this.sendParam("intensity",this._options.intensity),this.sendParam("echoVolume",this._options.echoVolume),this.sendParam("wow",this._options.wow),this.sendParam("flutter",this._options.flutter),this.sendParam("dirt",this._options.dirt),this.sendParam("inputBleed",this._options.inputBleed),this.sendParam("loopAmount",this._options.loopAmount),this.sendParam("playheadFilter",this._options.playheadFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Yr,jsCode:Xr}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain),this.wetGain.connect(this.output)}catch(e){}}static async ensureModuleLoaded(e){if(!Qr){if(Zr)return Zr;Zr=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}re-tape-echo/RETapeEcho.worklet.js`)}catch(n){const e=n?.message||String(n);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load RETapeEcho worklet: ${e}`)}if(!Yr||!Xr){const[e,n]=await Promise.all([fetch(`${t}re-tape-echo/RETapeEcho.wasm`),fetch(`${t}re-tape-echo/RETapeEcho.js`)]);if(!e.ok||!n.ok)throw Zr=null,new Error(`Failed to fetch RETapeEcho WASM/JS: wasm=${e.status} js=${n.status}`);Yr=await e.arrayBuffer();let a=await n.text();a=a.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),a+="\nvar createRETapeEcho = createRETapeEcho || Module;",Xr=a}Qr=!0})();try{await Zr}catch(t){throw Zr=null,Qr=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setMode(e){this._options.mode=Math.max(0,Math.min(Math.round(e),5)),this.sendParam("mode",this._options.mode)}setRepeatRate(e){this._options.repeatRate=Math.max(0,Math.min(e,1)),this.sendParam("repeatRate",this._options.repeatRate)}setIntensity(e){this._options.intensity=Math.max(0,Math.min(e,1)),this.sendParam("intensity",this._options.intensity)}setEchoVolume(e){this._options.echoVolume=Math.max(0,Math.min(e,1)),this.sendParam("echoVolume",this._options.echoVolume)}setWow(e){this._options.wow=Math.max(0,Math.min(e,1)),this.sendParam("wow",this._options.wow)}setFlutter(e){this._options.flutter=Math.max(0,Math.min(e,1)),this.sendParam("flutter",this._options.flutter)}setDirt(e){this._options.dirt=Math.max(0,Math.min(e,1)),this.sendParam("dirt",this._options.dirt)}setInputBleed(e){this._options.inputBleed=e?1:0,this.sendParam("inputBleed",e?1:0)}setLoopAmount(e){this._options.loopAmount=Math.max(0,Math.min(e,1)),this.sendParam("loopAmount",this._options.loopAmount)}setPlayheadFilter(e){this._options.playheadFilter=e?1:0,this.sendParam("playheadFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class eo extends u{name="BiPhase";input;output;phaserA;phaserB;parallelInB;seriesInB;outputA;outputB;dryGain;wetGain;_options;constructor(e={}){super(),this._options={rateA:e.rateA??.5,depthA:e.depthA??.6,rateB:e.rateB??4,depthB:e.depthB??.4,feedback:e.feedback??.3,routing:e.routing??"parallel",wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.phaserA=new w({frequency:this._options.rateA,octaves:5*this._options.depthA,baseFrequency:350,stages:6,Q:20*this._options.feedback}),this.phaserB=new w({frequency:this._options.rateB,octaves:5*this._options.depthB,baseFrequency:450,stages:6,Q:20*this._options.feedback}),this.parallelInB=new p(0),this.seriesInB=new p(0),this.outputA=new p(1),this.outputB=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.phaserA),this.input.connect(this.parallelInB),this.parallelInB.connect(this.phaserB),this.phaserA.connect(this.seriesInB),this.seriesInB.connect(this.phaserB),this.phaserA.connect(this.outputA),this.outputA.connect(this.wetGain),this.phaserB.connect(this.outputB),this.outputB.connect(this.wetGain),this.wetGain.connect(this.output),this.setRouting(this._options.routing)}setRouting(e){this._options.routing=e,"parallel"===e?(this.parallelInB.gain.rampTo(1,.1),this.seriesInB.gain.rampTo(0,.1),this.outputA.gain.rampTo(1,.1),this.outputB.gain.rampTo(1,.1)):(this.parallelInB.gain.rampTo(0,.1),this.seriesInB.gain.rampTo(1,.1),this.outputA.gain.rampTo(0,.1),this.outputB.gain.rampTo(1,.1))}setRateA(e){this._options.rateA=e,this.phaserA.frequency.rampTo(e,.1)}setDepthA(e){this._options.depthA=e,this.phaserA.octaves=5*e}setRateB(e){this._options.rateB=e,this.phaserB.frequency.rampTo(e,.1)}setDepthB(e){this._options.depthB=e,this.phaserB.octaves=5*e}setFeedback(e){this._options.feedback=e;const t=20*e;this.phaserA.Q.value=t,this.phaserB.Q.value=t}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.phaserA.dispose(),this.phaserB.dispose(),this.parallelInB.dispose(),this.seriesInB.dispose(),this.outputA.dispose(),this.outputB.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}class to extends u{name="DubFilter";input;output;filter;drive;gainNode;dryGain;wetGain;_options;constructor(e={}){super(),this._options={cutoff:e.cutoff??20,resonance:e.resonance??1,gain:e.gain??1,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.filter=new m({frequency:this._options.cutoff,type:"highpass",rolloff:-24,Q:this._options.resonance/100*20}),this.drive=new v({distortion:.1,wet:.5}),this.gainNode=new p(this._options.gain),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.filter),this.filter.connect(this.drive),this.drive.connect(this.gainNode),this.gainNode.connect(this.wetGain),this.wetGain.connect(this.output)}setCutoff(e){this._options.cutoff=e,this.filter.frequency.rampTo(e,.05)}setResonance(e){this._options.resonance=e;const t=e/100*20;this.filter.Q.rampTo(t,.1)}setGain(e){this._options.gain=e,this.gainNode.gain.rampTo(e,.1)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.filter.dispose(),this.drive.dispose(),this.gainNode.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const no=0,ao=1;class so extends u{name="MoogFilter";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackFilter=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={cutoff:e.cutoff??1e3,resonance:e.resonance??.1,drive:e.drive??1,model:e.model??no,filterMode:e.filterMode??ao,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setCutoff(e){this._options.cutoff=Math.max(20,Math.min(2e4,e)),this.sendParam(1,this._options.cutoff),this.fallbackFilter&&this.fallbackFilter.setCutoff(this._options.cutoff)}setResonance(e){this._options.resonance=Math.max(0,Math.min(1,e)),this.sendParam(2,this._options.resonance),this.fallbackFilter&&this.fallbackFilter.setResonance(this._options.resonance)}setDrive(e){this._options.drive=Math.max(.1,Math.min(4,e)),this.sendParam(3,this._options.drive)}setModel(e){this._options.model=e,this.sendParam(0,e)}setFilterMode(e){this._options.filterMode=e,this.sendParam(4,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await so.ensureInitialized(e),!so.wasmBinary||!so.jsCode)return;this.workletNode=new AudioWorkletNode(e,"moogfilters-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.model),this.sendParam(1,this._options.cutoff),this.sendParam(2,this._options.resonance),this.sendParam(3,this._options.drive),this.sendParam(4,this._options.filterMode),this.sendParam(5,1),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:so.wasmBinary,jsCode:so.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}moogfilters/MoogFilters.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode)try{const[e,n]=await Promise.all([fetch(`${t}moogfilters/MoogFilters.wasm`),fetch(`${t}moogfilters/MoogFilters.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackFilter=new ro(e.sampleRate),this.fallbackFilter.setCutoff(this._options.cutoff),this.fallbackFilter.setResonance(this._options.resonance),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackFilter.process(t,n,a,s)};const t=this.input,n=this.wetGain,a=t._gainNode||t,s=n._gainNode||n,r=a._nativeAudioNode||a._node||a,o=s._nativeAudioNode||s._node||s;r.connect(this.fallbackNode),this.fallbackNode.connect(o),o.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;n.connect(this.workletNode),this.workletNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class ro{sampleRate;stateL=new Float64Array(5);delayL=new Float64Array(5);stateR=new Float64Array(5);delayR=new Float64Array(5);wc=0;g=0;gRes=0;gComp=1;drive=1;constructor(e){this.sampleRate=e,this.setCutoff(1e3),this.setResonance(.1)}setCutoff(e){this.wc=2*Math.PI*e/this.sampleRate,this.g=.9892*this.wc-.4342*this.wc**2+.1381*this.wc**3-.0202*this.wc**4,this.updateResonance()}setResonance(e){this._resonance=e,this.updateResonance()}_resonance=.1;updateResonance(){this.gRes=this._resonance*(1.0029+.0526*this.wc-.926*this.wc**2+.0218*this.wc**3)}process(e,t,n,a){const s=e.length,{stateL:r,delayL:o,stateR:i,delayR:l,g:c,gRes:d,gComp:u,drive:p}=this;for(let h=0;h<s;h++){r[0]=Math.tanh(p*(e[h]-4*d*(r[4]-u*e[h])));for(let e=0;e<4;e++)r[e+1]=oo(c*(.3/1.3*r[e]+1/1.3*o[e]-r[e+1])+r[e+1]),o[e]=r[e];n[h]=r[4],i[0]=Math.tanh(p*(t[h]-4*d*(i[4]-u*t[h])));for(let e=0;e<4;e++)i[e+1]=oo(c*(.3/1.3*i[e]+1/1.3*l[e]-i[e+1])+i[e+1]),l[e]=i[e];a[h]=i[4]}}}function oo(e){return Math.min(Math.max(e,-1e30),1e30)}class io extends u{name="MVerb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={damping:e.damping??.5,density:e.density??.5,bandwidth:e.bandwidth??.5,decay:e.decay??.7,predelay:e.predelay??0,size:e.size??.8,gain:e.gain??1,mix:e.mix??.4,earlyMix:e.earlyMix??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setDamping(e){this._options.damping=lo(e),this.sendParam(0,e)}setDensity(e){this._options.density=lo(e),this.sendParam(1,e)}setBandwidth(e){this._options.bandwidth=lo(e),this.sendParam(2,e)}setDecay(e){this._options.decay=lo(e),this.sendParam(3,e)}setPredelay(e){this._options.predelay=lo(e),this.sendParam(4,e)}setSize(e){this._options.size=lo(e),this.sendParam(5,e)}setGain(e){this._options.gain=lo(e),this.sendParam(6,e)}setMix(e){this._options.mix=lo(e),this.sendParam(7,e)}setEarlyMix(e){this._options.earlyMix=lo(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=lo(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await io.ensureInitialized(e),!io.wasmBinary||!io.jsCode)return;this.workletNode=new AudioWorkletNode(e,"mverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.damping),this.sendParam(1,this._options.density),this.sendParam(2,this._options.bandwidth),this.sendParam(3,this._options.decay),this.sendParam(4,this._options.predelay),this.sendParam(5,this._options.size),this.sendParam(6,this._options.gain),this.sendParam(7,1),this.sendParam(8,this._options.earlyMix),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:io.wasmBinary,jsCode:io.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}mverb/MVerb.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode)try{const[e,n]=await Promise.all([fetch(`${t}mverb/MVerb.wasm`),fetch(`${t}mverb/MVerb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new co(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,n,a,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;n.connect(this.workletNode),this.workletNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function lo(e){return Math.max(0,Math.min(1,e))}class co{combs;allpasses;constructor(e){const t=e/44100;this.combs=[new uo(Math.round(1116*t),.84),new uo(Math.round(1188*t),.84),new uo(Math.round(1277*t),.84),new uo(Math.round(1356*t),.84)],this.allpasses=[new po(Math.round(556*t),.5),new po(Math.round(441*t),.5)]}process(e,t,n,a){const s=e.length;for(let r=0;r<s;r++){const s=.5*(e[r]+t[r]);let o=0;for(const e of this.combs)o+=e.process(s);o*=.25;for(const e of this.allpasses)o=e.process(o);n[r]=o,a[r]=o}}}class uo{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index];return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,t}}class po{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index],n=-e+t;return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,n}}class ho extends u{name="Leslie";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackLeslie=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={speed:e.speed??0,hornRate:e.hornRate??6.8,drumRate:e.drumRate??5.9,hornDepth:e.hornDepth??.7,drumDepth:e.drumDepth??.5,doppler:e.doppler??.5,mix:e.mix??1,width:e.width??.8,acceleration:e.acceleration??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setSpeed(e){this._options.speed=mo(e),this.sendParam(0,e)}setHornRate(e){this._options.hornRate=Math.max(.1,Math.min(10,e)),this.sendParam(1,e)}setDrumRate(e){this._options.drumRate=Math.max(.1,Math.min(8,e)),this.sendParam(2,e)}setHornDepth(e){this._options.hornDepth=mo(e),this.sendParam(3,e)}setDrumDepth(e){this._options.drumDepth=mo(e),this.sendParam(4,e)}setDoppler(e){this._options.doppler=mo(e),this.sendParam(5,e)}setMix(e){this._options.mix=mo(e),this.sendParam(6,e)}setWidth(e){this._options.width=mo(e),this.sendParam(7,e)}setAcceleration(e){this._options.acceleration=mo(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=mo(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await ho.ensureInitialized(e),!ho.wasmBinary||!ho.jsCode)return;this.workletNode=new AudioWorkletNode(e,"leslie-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.speed),this.sendParam(1,this._options.hornRate),this.sendParam(2,this._options.drumRate),this.sendParam(3,this._options.hornDepth),this.sendParam(4,this._options.drumDepth),this.sendParam(5,this._options.doppler),this.sendParam(6,1),this.sendParam(7,this._options.width),this.sendParam(8,this._options.acceleration),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:ho.wasmBinary,jsCode:ho.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}leslie/Leslie.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode)try{const[e,n]=await Promise.all([fetch(`${t}leslie/Leslie.wasm`),fetch(`${t}leslie/Leslie.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackLeslie=new fo(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackLeslie.process(t,n,a,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;n.connect(this.workletNode),this.workletNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function mo(e){return Math.max(0,Math.min(1,e))}class fo{phase=0;rate=6.8;sampleRate;constructor(e){this.sampleRate=e}process(e,t,n,a){const s=e.length;for(let r=0;r<s;r++){const s=Math.sin(2*this.phase*Math.PI),o=.7+.3*s;n[r]=e[r]*o,a[r]=t[r]*(.7-.3*s),this.phase+=this.rate/this.sampleRate,this.phase>=1&&(this.phase-=1)}}}class yo extends u{name="SpringReverb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={decay:e.decay??.6,damping:e.damping??.4,tension:e.tension??.5,mix:e.mix??.35,drip:e.drip??.5,diffusion:e.diffusion??.7,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.initFallback(),this.initWasm()}setDecay(e){this._options.decay=go(e),this.sendParam(0,e)}setDamping(e){this._options.damping=go(e),this.sendParam(1,e)}setTension(e){this._options.tension=go(e),this.sendParam(2,e)}setSpringMix(e){this._options.mix=go(e),this.sendParam(3,e)}setDrip(e){this._options.drip=go(e),this.sendParam(4,e)}setDiffusion(e){this._options.diffusion=go(e),this.sendParam(5,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=go(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await yo.ensureInitialized(e),!yo.wasmBinary||!yo.jsCode)return;this.workletNode=new AudioWorkletNode(e,"springreverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.decay),this.sendParam(1,this._options.damping),this.sendParam(2,this._options.tension),this.sendParam(3,1),this.sendParam(4,this._options.drip),this.sendParam(5,this._options.diffusion),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:yo.wasmBinary,jsCode:yo.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}springreverb/SpringReverb.worklet.js`)}catch(n){}if(!this.wasmBinary||!this.jsCode)try{const[e,n]=await Promise.all([fetch(`${t}springreverb/SpringReverb.wasm`),fetch(`${t}springreverb/SpringReverb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new vo(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,n,a,s)};const t=this.input._nativeAudioNode||this.input._node||this.input,n=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;t.connect(this.fallbackNode),this.fallbackNode.connect(n),n.connect(this.output._nativeAudioNode||this.output._node||this.output),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain),this.wetGain.connect(this.output)}}swapToWasm(){if(this.workletNode)try{const t=k().rawContext;if(this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=this.input._nativeAudioNode||this.input._node||this.input,a=this.wetGain._nativeAudioNode||this.wetGain._node||this.wetGain;n.connect(this.workletNode),this.workletNode.connect(a),a.connect(this.output._nativeAudioNode||this.output._node||this.output);const s=t.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(t.destination)}catch(t){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch(e){}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch(e){}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function go(e){return Math.max(0,Math.min(1,e))}class vo{combs;constructor(e){const t=e/44100;this.combs=[{buffer:new Float32Array(Math.round(1116*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1188*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1277*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1356*t)),index:0,feedback:.8,lp:0}]}process(e,t,n,a){const s=e.length;for(let r=0;r<s;r++){const s=.5*(e[r]+t[r]);let o=0;for(const e of this.combs){const t=e.buffer[e.index];e.lp=t+.4*(e.lp-t),e.buffer[e.index]=s+e.lp*e.feedback,e.index=(e.index+1)%e.buffer.length,o+=t}o*=.25,n[r]=o,a[r]=o}}}const bo={"1/1":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3};function xo(e,t){return 6e4/e*bo[t]}const wo=[{value:"1/1",label:"1/1",category:"Straight"},{value:"1/2",label:"1/2",category:"Straight"},{value:"1/4",label:"1/4",category:"Straight"},{value:"1/8",label:"1/8",category:"Straight"},{value:"1/16",label:"1/16",category:"Straight"},{value:"1/32",label:"1/32",category:"Straight"},{value:"1/2d",label:"1/2.",category:"Dotted"},{value:"1/4d",label:"1/4.",category:"Dotted"},{value:"1/8d",label:"1/8.",category:"Dotted"},{value:"1/16d",label:"1/16.",category:"Dotted"},{value:"1/2t",label:"1/2T",category:"Triplet"},{value:"1/4t",label:"1/4T",category:"Triplet"},{value:"1/8t",label:"1/8T",category:"Triplet"}],ko={Delay:[{param:"time",unit:"seconds"}],FeedbackDelay:[{param:"time",unit:"seconds"}],PingPongDelay:[{param:"time",unit:"seconds"}],SpaceEcho:[{param:"rate",unit:"ms"}],SpaceyDelayer:[{param:"firstTap",unit:"ms"}],RETapeEcho:[{param:"repeatRate",unit:"normalized"}],Chorus:[{param:"frequency",unit:"hz"}],BiPhase:[{param:"rateA",unit:"hz"}]};function So(e,t,n){switch(n){case"seconds":return function(e,t){return xo(e,t)/1e3}(e,t);case"ms":default:return xo(e,t);case"hz":return function(e,t){return 1e3/xo(e,t)}(e,t);case"normalized":return Math.min(1,Math.max(0,xo(e,t)/1e3))}}function Mo(e){return 1===e.bpmSync}function No(e){const t=e.syncDivision;return t&&t in bo?t:"1/8"}class Co extends u{name="SidechainCompressor";compressor;dryGain;wetGain;sidechainInput;sidechainGainNode;sidechainAnalyser;_threshold;_ratio;_attack;_release;_knee;_sidechainGain;_wet;animationFrame=null;baseThreshold;input;output;constructor(e={}){super(),this._threshold=e.threshold??-24,this._ratio=e.ratio??4,this._attack=e.attack??.003,this._release=e.release??.25,this._knee=e.knee??6,this._sidechainGain=e.sidechainGain??1,this._wet=e.wet??1,this.baseThreshold=this._threshold,this.input=new p(1),this.output=new p(1),this.compressor=new S({threshold:this._threshold,ratio:this._ratio,attack:this._attack,release:this._release,knee:this._knee}),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.sidechainInput=new p(1),this.sidechainGainNode=new p(this._sidechainGain),this.sidechainAnalyser=new M({smoothing:.8,normalRange:!1}),this.input.connect(this.compressor),this.compressor.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.sidechainInput.connect(this.sidechainGainNode),this.sidechainGainNode.connect(this.sidechainAnalyser),this.startSidechainPolling()}getSidechainInput(){return this.sidechainInput}startSidechainPolling=()=>{this.updateSidechain()};updateSidechain=()=>{const e=this.sidechainAnalyser.getValue(),t="number"==typeof e?e:e[0];if(t>-60){const e=24*Math.min(1,Math.max(0,(t+60)/60))*this._sidechainGain;this.compressor.threshold.value=this.baseThreshold-e}else this.compressor.threshold.value=this.baseThreshold;this.animationFrame=requestAnimationFrame(this.updateSidechain)};get threshold(){return this._threshold}set threshold(e){this._threshold=Math.max(-60,Math.min(0,e)),this.baseThreshold=this._threshold,this.compressor.threshold.value=this._threshold}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.max(1,Math.min(20,e)),this.compressor.ratio.value=this._ratio}get attack(){return this._attack}set attack(e){this._attack=Math.max(.001,Math.min(.5,e)),this.compressor.attack.value=this._attack}get release(){return this._release}set release(e){this._release=Math.max(.01,Math.min(1,e)),this.compressor.release.value=this._release}get knee(){return this._knee}set knee(e){this._knee=Math.max(0,Math.min(40,e)),this.compressor.knee.value=this._knee}get sidechainGain(){return this._sidechainGain}set sidechainGain(e){this._sidechainGain=Math.max(0,Math.min(2,e)),this.sidechainGainNode.gain.value=this._sidechainGain}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}getReduction(){return this.compressor.reduction}dispose(){return null!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),super.dispose(),this.compressor.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.sidechainInput.dispose(),this.sidechainGainNode.dispose(),this.sidechainAnalyser.dispose(),this}}class Eo{config;loop=null;currentStepIndex=0;pingPongDirection=1;baseNote="C4";baseVelocity=1;isPlaying=!1;heldNotes=new Set;onStep;onNoteOn;onNoteOff;currentPlayingNote=null;constructor(e){this.config={...e.config},this.onStep=e.onStep,this.onNoteOn=e.onNoteOn,this.onNoteOff=e.onNoteOff}getSteps(){return this.config.steps&&this.config.steps.length>0?this.config.steps:this.config.pattern&&this.config.pattern.length>0?this.config.pattern.map(e=>({noteOffset:e})):[{noteOffset:0}]}getInterval(){const{speed:e,speedUnit:t}=this.config,n=N().bpm.value;switch(t){case"hz":return 1/Math.max(1,Math.min(60,e));case"ticks":return 60/n*(e/48);case"division":return{1:"1n",2:"2n",4:"4n",8:"8n",16:"16n",32:"32n",64:"64n"}[e]||`${e}n`;default:return 1/15}}getSwingAdjustedTime(e,t){const n=(this.config.swing??0)/100;if(0===n)return e;if(t%2==0){return e+("number"==typeof this.getInterval()?this.getInterval():.066)*n*.5}return e}getNextStepIndex(){const e=this.getSteps().length;switch(this.config.mode){case"loop":default:return(this.currentStepIndex+1)%e;case"pingpong":let t=this.currentStepIndex+this.pingPongDirection;return t>=e?(this.pingPongDirection=-1,t=e-2):t<0&&(this.pingPongDirection=1,t=1),e<=2?(this.currentStepIndex+1)%e:Math.max(0,Math.min(e-1,t));case"oneshot":const n=this.currentStepIndex+1;return n>=e?(this.isPlaying=!1,e-1):n;case"random":return Math.floor(Math.random()*e)}}midiToNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}noteNameToMidi(e){const t=e.match(/^([A-Ga-g][#b]?)(-?\d+)$/);if(!t)return 60;const n=t[1].charAt(0).toUpperCase()+t[1].slice(1);return 12*(parseInt(t[2],10)+1)+({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n]??0)}processStep(e){if(!this.isPlaying)return;const t=this.getSteps()[this.currentStepIndex];if(!t)return;if("skip"===t.effect)return void(this.currentStepIndex=this.getNextStepIndex());const n=this.noteNameToMidi(this.baseNote)+t.noteOffset,a=this.midiToNoteName(n),s=(t.volume??100)/100,r="accent"===t.effect?1.2:1,o=Math.min(1,this.baseVelocity*s*r),i=(t.gate??100)/100,l=("number"==typeof this.getInterval()?this.getInterval():C(this.getInterval()).toSeconds())*i*.95;this.currentPlayingNote&&this.onNoteOff&&this.onNoteOff(this.currentPlayingNote),this.onNoteOn&&this.onNoteOn(a,o,l),this.currentPlayingNote=a,this.onStep&&this.onStep(this.currentStepIndex,t,t.noteOffset),this.currentStepIndex=this.getNextStepIndex()}start(e,t=1){if(this.isPlaying)return this.baseNote=e,this.baseVelocity=t,void this.heldNotes.add(e);this.baseNote=e,this.baseVelocity=t,this.currentStepIndex=0,this.pingPongDirection=1,this.isPlaying=!0,this.heldNotes.add(e);const n=this.getInterval();this.loop=new E(e=>{this.processStep(e)},n),this.loop.start(0)}stop(e){if(e){if(this.heldNotes.delete(e),this.heldNotes.size>0){const e=Array.from(this.heldNotes)[this.heldNotes.size-1];return void(this.baseNote=e)}}else this.heldNotes.clear();this.currentPlayingNote&&this.onNoteOff&&(this.onNoteOff(this.currentPlayingNote),this.currentPlayingNote=null),this.loop&&(this.loop.stop(),this.loop.dispose(),this.loop=null),this.isPlaying=!1,this.currentStepIndex=0,this.pingPongDirection=1}stopAll(){this.heldNotes.clear(),this.stop()}updateConfig(e){if(this.config={...this.config,...e},this.loop&&this.isPlaying){const e=this.getInterval();this.loop.interval=e}"oneshot"===e.mode&&(this.currentStepIndex=0)}getCurrentStep(){return this.currentStepIndex}getIsPlaying(){return this.isPlaying}getConfig(){return{...this.config}}dispose(){this.stopAll(),this.loop&&(this.loop.dispose(),this.loop=null)}}const Po={OPN2:0,OPM:1,OPL3:2,OPLL:11,OPNA:13,OPNB:14,OPZ:22,Y8950:23,OPL4:26,OPN:47,OPNB_B:48,ESFM:49,PSG:3,AY:12,SAA:18,T6W28:43,AY8930:50,NES:4,GB:5,SNES:24,FDS:16,MMC5:17,VRC6:9,N163:8,VB:44,NDS:51,GBA_DMA:52,GBA_MINMOD:53,POKEMINI:54,PCE:6,SCC:7,SWAN:19,SM8521:37,BUBBLE:38,X1_010:41,NAMCO:55,SID:10,SID_6581:45,SID_8580:46,VIC:33,TED:34,PET:56,TIA:15,POKEY:57,LYNX:25,OKI:20,ES5506:21,SEGAPCM:27,YMZ280B:28,RF5C68:29,GA20:30,C140:31,QSOUND:32,K007232:39,K053260:40,MSM6258:58,MSM5232:59,MULTIPCM:60,AMIGA:61,VERA:36,SUPERVISION:35,UPD1771:42,PCSPKR:62,PONG:63,PV1000:64,DAVE:65,SU:66,BIFURCATOR:67,POWERNOISE:68,ZXBEEPER:69,ZXBEEPER_QT:70,SCVTONE:71,PCMDAC:72},To="__FurnaceChipEngineInstance__";class Ao{static instance=null;static instanceId=0;myInstanceId;isLoaded=!1;initPromise=null;initFailedPermanently=!1;workletNode=null;lastInitAttempt=0;writeCount=0;nativeContext=null;rawContext=null;outputGain=null;constructor(){this.myInstanceId=++Ao.instanceId}static getInstance(){const e=globalThis[To];return e?(Ao.instance!==e&&(Ao.instance=e),e):(Ao.instance||(Ao.instance=new Ao,globalThis[To]=Ao.instance),Ao.instance)}async init(e){if(this.isLoaded)return;if(this.initFailedPermanently)return;if(this.initPromise)return this.initPromise;const t=Date.now();return t-this.lastInitAttempt<500?void 0:(this.lastInitAttempt=t,this.initPromise=this.doInit(e),this.initPromise)}async doInit(e){try{const s=e,r=s.rawContext||s._context||e,o=es(e);if(!r||!r.audioWorklet)return void(this.initPromise=null);if("running"!==r.state){try{await r.resume()}catch{}if("running"!==r.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===r.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const i="/DEViLBOX/",l=`?v=${Date.now()}`,c=o instanceof AudioContext?o:r,d=`${i}FurnaceChips.worklet.js${l}`;try{await c.audioWorklet.addModule(d)}catch(t){if(!t?.message?.includes("already")&&"InvalidStateError"!==t?.name)return void(this.initPromise=null)}const u=`${i}FurnaceChips.wasm${l}`,p=`${i}FurnaceChips.js${l}`,[h,m]=await Promise.all([fetch(u,{cache:"no-store"}),fetch(p,{cache:"no-store"})]);if(!h.ok)return void(this.initPromise=null);if(!m.ok)return void(this.initPromise=null);const f=await h.arrayBuffer();let y=await m.text();y='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+y.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');try{this.nativeContext=o,this.workletNode=new AudioWorkletNode(c,"furnace-chips-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode}catch(t){return void(this.initPromise=null)}const g=new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4),n=a=>{"initialized"===a.data.type&&(clearTimeout(t),this.workletNode?.port.removeEventListener("message",n),e(!0))};this.workletNode.port.addEventListener("message",n),this.workletNode.port.start()});this.workletNode&&this.workletNode.port.postMessage({type:"init",wasmBinary:f,jsCode:y});if(await g){this.isLoaded=!0,this.rawContext=c;try{const e=c.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(c.destination),this.outputGain=e}catch(n){try{if(o&&o.destination){const e=o.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(o.destination),this.outputGain=e}}catch(a){}}this.workletNode.port.addEventListener("message",e=>{"debug"===e.data.type?e.data.msgType:e.data.type}),setTimeout(()=>{this.requestWorkletStatus()},500)}else this.initPromise=null}catch(t){this.initPromise=null}}write(e,t,n){if(this.writeCount,!this.workletNode)return this.writeCount,void this.writeCount++;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(()=>{});const a={type:"write",chipType:e,register:t,value:n,writeId:this.writeCount};this.workletNode.port.postMessage(a);const s=8===t||40===t||t>=160&&t<=167;if(this.writeCount<10||s){this.nativeContext}this.writeCount++}getDiagnostics(){return{loaded:this.isLoaded,hasWorklet:null!==this.workletNode,contextState:this.nativeContext?.state||null}}requestWorkletStatus(){this.workletNode&&this.workletNode.port.postMessage({type:"getStatus"})}testPing(){this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now()})}testWrite(){this.workletNode&&this.workletNode.port.postMessage({type:"write",chipType:0,register:255,value:170,writeId:-1})}getNativeOutput(){return this.outputGain}getWorkletDiagnostics(){const e=null!==this.workletNode,t=null!==this.workletNode?.port;return{hasNode:e,hasPort:t,portId:t?`port-inst-${this.myInstanceId}`:"none"}}resetWriteCount(){this.writeCount=0;this.rawContext;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(e=>{}),this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now(),label:"post-reset"})}setWavetable(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",chipType:e,index:t,data:n})}setLogging(e){this.workletNode&&this.workletNode.port.postMessage({type:"setLogging",enabled:e})}async getLog(){return this.workletNode?new Promise(e=>{const t=n=>{"logData"===n.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(n.data.data))};this.workletNode?.port.addEventListener("message",t),this.workletNode?.port.postMessage({type:"getLog"})}):new Uint8Array(0)}getOutput(){if(!this.workletNode)throw new Error("Engine not initialized");return this.workletNode}setOutputGain(e){this.outputGain&&this.outputGain.gain.setValueAtTime(e,this.rawContext?.currentTime||0)}getOutputGainValue(){return this.outputGain?.gain.value??1}isInitialized(){return this.isLoaded&&null!==this.workletNode}deactivate(e){this.workletNode&&this.workletNode.port.postMessage({type:"deactivate",chipType:e})}}const _o=[{id:"32x16FunkyLead",name:"Funky Lead",category:"32x16",len:32,max:15,data:[8,15,14,11,9,6,4,4,6,7,6,4,3,3,4,6,8,9,11,12,12,11,9,8,9,11,11,9,6,4,1,0]},{id:"32x16NamcoBass",name:"Namco Bass",category:"32x16",len:32,max:15,data:[7,10,12,13,14,13,12,10,7,4,2,1,0,1,2,4,7,11,13,14,13,11,7,3,1,0,1,3,7,14,7,0]},{id:"32x16ataribass",name:"Atari Bass",category:"32x16",len:32,max:15,data:[15,15,0,0,15,15,0,0,0,0,15,15,15,15,0,0,15,15,15,15,15,15,0,0,0,0,0,0,0,0,0,0]},{id:"32x16brass",name:"Brass",category:"32x16",len:32,max:15,data:[15,14,13,12,11,8,6,2,4,3,7,9,9,7,5,0,15,15,13,13,13,11,11,8,8,0,0,0,0,0,0,0]},{id:"32x16clarinet",name:"Clarinet",category:"32x16",len:32,max:15,data:[12,14,15,15,15,15,15,15,15,15,15,15,15,15,14,12,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,3]},{id:"32x16distortedsquare",name:"Distorted Square",category:"32x16",len:32,max:15,data:[14,12,10,11,14,9,10,13,9,14,10,15,13,7,14,6,5,1,6,0,3,2,4,5,0,3,2,4,2,3,6,1]},{id:"32x16eguitar",name:"E-Guitar",category:"32x16",len:32,max:15,data:[0,12,9,6,13,2,9,12,4,3,4,12,10,8,8,1,2,0,9,10,10,12,0,0,5,3,0,15,0,0,10,10]},{id:"32x16flute",name:"Flute",category:"32x16",len:32,max:15,data:[12,14,15,15,14,14,14,15,13,14,15,15,14,13,11,9,6,4,2,0,0,2,2,2,1,1,1,1,0,1,2,4]},{id:"32x16guitar",name:"Guitar",category:"32x16",len:32,max:15,data:[9,15,15,14,15,15,15,15,15,15,15,13,5,1,1,3,7,7,5,4,2,1,0,4,8,7,4,1,2,3,5,6]},{id:"32x16opllpiano",name:"OPLL Piano",category:"32x16",len:32,max:15,data:[7,13,15,15,15,15,14,11,10,12,15,14,8,3,2,4,7,11,13,13,10,4,0,2,5,5,3,1,0,0,0,1]},{id:"32x16opllvibra",name:"OPLL Vibraphone",category:"32x16",len:32,max:15,data:[5,14,12,9,8,15,15,15,14,15,12,13,15,15,11,4,7,11,9,1,0,2,4,1,1,0,0,0,4,7,4,1]},{id:"32x16reedorgan",name:"Reed Organ",category:"32x16",len:32,max:15,data:[8,12,10,11,10,12,12,13,12,15,14,13,12,13,13,9,6,2,2,3,2,1,0,3,2,3,3,5,4,5,3,7]},{id:"32x16saw",name:"Saw",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]},{id:"32x16saw2",name:"Saw 2",category:"32x16",len:32,max:15,data:[15,14,13,12,11,10,9,8,15,14,13,12,11,10,9,8,12,14,12,10,8,6,5,4,3,3,2,2,1,1,0,0]},{id:"32x16sax",name:"Sax",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,0,15,10,11,12,13,14,15,15]},{id:"32x16slapbass",name:"Slap Bass",category:"32x16",len:32,max:15,data:[8,13,15,15,13,11,8,7,6,8,10,14,15,12,4,0,8,15,12,3,0,2,5,8,9,9,7,5,2,0,0,3]},{id:"32x16synthbass",name:"Synth Bass",category:"32x16",len:32,max:15,data:[10,9,9,8,5,7,7,5,4,4,5,7,8,9,10,10,10,9,7,6,8,10,12,12,12,11,8,4,3,2,3,1]},{id:"32x16synthbrass",name:"Synth Brass",category:"32x16",len:32,max:15,data:[2,15,5,0,0,9,15,13,11,9,12,14,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x16trumpet",name:"Trumpet",category:"32x16",len:32,max:15,data:[7,15,13,12,10,10,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,6,5,5,3,2,0,0]},{id:"32x16voice",name:"Voice",category:"32x16",len:32,max:15,data:[7,8,9,10,10,11,11,12,12,12,12,12,12,12,12,12,11,11,10,10,9,8,7,2,1,0,0,0,0,0,1,2]},{id:"32x32KeygenBass",name:"Keygen Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,25,27,29,30,31,31,31,31,31,31,31,31,31]},{id:"32x32accordion",name:"Accordion",category:"32x32",len:32,max:31,data:[0,8,1,13,20,23,20,17,23,17,9,9,18,17,16,26,31,26,27,24,20,14,5,12,10,18,11,15,21,12,5,11]},{id:"32x32accordion2",name:"Accordion 2",category:"32x32",len:32,max:31,data:[16,17,21,22,22,22,20,19,13,12,11,10,10,13,15,17,27,27,31,31,31,29,25,23,9,7,3,1,0,2,4,6]},{id:"32x32acousticguitar",name:"Acoustic Guitar",category:"32x32",len:32,max:31,data:[2,18,26,28,29,28,28,28,29,31,31,27,14,2,1,0,1,2,2,0,1,1,1,1,1,1,1,0,0,0,0,0]},{id:"32x32agogo",name:"Agogo",category:"32x32",len:32,max:31,data:[16,8,6,31,13,16,16,14,25,21,8,12,28,18,18,12,16,16,23,0,13,16,20,16,6,12,18,17,8,15,15,26]},{id:"32x32ataribass",name:"Atari Bass",category:"32x32",len:32,max:31,data:[31,31,31,31,31,31,31,31,0,0,0,0,0,0,0,0,31,31,31,0,0,0,31,31,31,31,31,0,0,0,0,0]},{id:"32x32bass2",name:"Bass 2",category:"32x32",len:32,max:31,data:[15,25,31,31,26,18,12,7,4,3,3,3,4,6,8,12,15,19,23,26,28,29,29,29,28,26,22,16,8,2,0,5]},{id:"32x32bass3",name:"Bass 3",category:"32x32",len:32,max:31,data:[15,15,12,7,2,0,2,7,15,24,29,31,29,24,19,16,15,16,17,18,17,17,16,15,15,15,15,14,14,13,14,15]},{id:"32x32bell",name:"Bell",category:"32x32",len:32,max:31,data:[16,31,30,16,26,25,13,28,31,15,0,0,8,4,10,26,13,4,20,30,29,30,30,19,1,9,23,9,5,11,0,0]},{id:"32x32brass",name:"Brass",category:"32x32",len:32,max:31,data:[31,31,29,27,25,23,21,19,16,14,12,10,8,6,4,2,28,26,23,21,19,17,14,12,22,20,17,15,13,11,9,6]},{id:"32x32brass2",name:"Brass 2",category:"32x32",len:32,max:31,data:[16,18,21,24,27,29,30,31,31,31,30,29,27,24,21,18,0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29]},{id:"32x32chime",name:"Chime",category:"32x32",len:32,max:31,data:[15,27,23,17,23,27,21,15,23,30,26,17,21,23,15,6,15,24,15,7,9,13,4,0,7,15,9,3,7,13,7,3]},{id:"32x32choir",name:"Choir",category:"32x32",len:32,max:31,data:[0,3,8,13,22,26,30,31,31,30,28,24,20,18,17,16,15,15,15,15,16,16,16,16,15,14,12,10,8,5,2,0]},{id:"32x32clarinet",name:"Clarinet",category:"32x32",len:32,max:31,data:[20,31,29,26,26,28,30,31,31,30,28,26,25,27,30,31,15,0,4,6,6,4,2,0,0,1,3,5,6,6,2,2]},{id:"32x32clarinet2",name:"Clarinet 2",category:"32x32",len:32,max:31,data:[21,27,30,28,24,22,24,26,24,22,19,18,19,26,23,19,12,6,0,1,4,8,7,5,7,10,13,11,9,7,5,10]},{id:"32x32distortedpulse",name:"Distorted Pulse",category:"32x32",len:32,max:31,data:[31,31,31,31,0,0,0,0,16,16,16,16,0,0,0,0,8,8,8,8,0,0,0,0,3,3,3,3,0,0,0,0]},{id:"32x32distortedpulse2",name:"Distorted Pulse 2",category:"32x32",len:32,max:31,data:[3,25,13,15,18,16,17,15,15,15,17,15,12,11,6,15,27,0,13,15,18,3,8,15,15,20,17,15,12,31,29,15]},{id:"32x32distortedsaw",name:"Distorted Saw",category:"32x32",len:32,max:31,data:[0,7,10,10,14,14,17,17,21,21,25,25,27,27,29,29,29,29,31,31,31,31,31,5,8,11,14,16,18,20,22,0]},{id:"32x32ebass",name:"E-Bass",category:"32x32",len:32,max:31,data:[17,21,31,28,23,27,30,13,0,8,11,10,7,8,14,21,27,27,26,25,31,19,0,2,0,0,0,8,15,18,18,16]},{id:"32x32eguitar",name:"E-Guitar",category:"32x32",len:32,max:31,data:[3,9,16,23,28,31,31,29,26,23,25,27,28,29,28,22,8,0,12,28,0,14,2,0,1,31,30,4,3,1,0,0]},{id:"32x32eguitar2",name:"E-Guitar 2",category:"32x32",len:32,max:31,data:[16,27,31,28,31,25,16,0,3,0,11,7,5,16,18,17,23,23,30,31,29,30,0,12,3,4,4,8,11,10,20,21]},{id:"32x32englishhorn",name:"English Horn",category:"32x32",len:32,max:31,data:[16,22,31,22,15,9,15,9,15,13,11,8,6,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,6,8,11]},{id:"32x32fantasia",name:"Fantasia",category:"32x32",len:32,max:31,data:[0,6,14,15,14,8,5,7,15,15,21,26,27,26,21,15,17,23,29,31,31,28,22,12,11,15,19,20,19,17,6,1]},{id:"32x32filteredsaw",name:"Filtered Saw",category:"32x32",len:32,max:31,data:[16,18,20,21,23,25,26,28,29,30,31,31,31,31,30,26,19,9,3,1,0,0,1,2,3,4,6,7,9,11,12,14]},{id:"32x32filteredsquare",name:"Filtered Square",category:"32x32",len:32,max:31,data:[20,24,27,28,29,30,31,31,31,31,30,29,28,27,24,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32flute",name:"Flute",category:"32x32",len:32,max:31,data:[16,19,23,27,30,31,31,31,29,25,21,17,12,8,6,4,3,3,3,3,3,3,3,3,4,5,6,7,8,9,11,13]},{id:"32x32frenchhorn",name:"French Horn",category:"32x32",len:32,max:31,data:[16,22,27,29,30,31,31,26,22,16,14,9,4,5,8,15,19,20,18,16,14,10,8,8,8,8,9,13,14,13,13,13]},{id:"32x32frenchhorn2",name:"French Horn 2",category:"32x32",len:32,max:31,data:[29,31,29,27,24,22,18,11,2,0,2,4,8,13,16,17,18,17,16,13,8,4,2,0,2,11,18,22,24,27,29,31]},{id:"32x32glockenspiel",name:"Glockenspiel",category:"32x32",len:33,max:31,data:[16,29,24,17,24,29,20,16,24,31,26,16,20,22,15,5,16,26,15,11,15,15,5,0,7,15,11,2,7,15,7,2,16]},{id:"32x32hardslap",name:"Hard Slap",category:"32x32",len:32,max:31,data:[18,30,21,16,15,17,22,31,2,11,29,0,20,10,15,31,6,21,30,0,7,11,12,8,1,11,30,16,1,31,18,4]},{id:"32x32jazzguitar",name:"Jazz Guitar",category:"32x32",len:32,max:31,data:[0,2,3,2,1,0,0,2,11,19,24,29,30,30,29,28,27,28,30,31,30,25,17,13,13,15,16,17,16,13,7,0]},{id:"32x32lead",name:"Lead",category:"32x32",len:32,max:31,data:[31,23,18,14,11,9,7,5,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,5,7,9,11,14,18,23,31]},{id:"32x32lead2",name:"Lead 2",category:"32x32",len:32,max:31,data:[11,20,26,30,31,31,30,22,12,0,1,1,1,17,16,16,16,16,30,31,30,0,5,8,18,20,21,22,20,19,15,11]},{id:"32x32mutetrumpet",name:"Mute Trumpet",category:"32x32",len:32,max:31,data:[31,29,20,15,12,11,12,12,13,13,13,14,14,15,16,15,15,15,14,14,15,15,16,16,16,16,16,16,17,17,17,24]},{id:"32x32oboe",name:"Oboe",category:"32x32",len:32,max:31,data:[21,31,14,0,1,8,14,18,20,22,22,22,21,20,18,17,15,13,12,11,10,9,9,10,12,15,20,27,31,30,13,1]},{id:"32x32octavelead",name:"Octave Lead",category:"32x32",len:32,max:31,data:[6,11,15,19,23,27,29,31,13,14,15,16,17,18,18,0,3,6,9,12,14,16,17,18,0,0,0,0,0,0,0,0]},{id:"32x32octavesaw",name:"Octave Saw",category:"32x32",len:32,max:31,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]},{id:"32x32organ",name:"Organ",category:"32x32",len:32,max:31,data:[23,31,31,28,27,26,19,15,19,23,17,10,9,11,8,10,20,29,28,22,19,17,9,5,8,13,8,3,2,6,5,9]},{id:"32x32organ2",name:"Organ 2",category:"32x32",len:32,max:31,data:[16,19,26,30,31,27,23,14,10,6,8,9,9,8,13,14,18,17,20,22,26,24,24,19,18,13,12,9,5,2,5,8]},{id:"32x32organ3",name:"Organ 3",category:"32x32",len:32,max:31,data:[16,31,31,24,22,24,20,15,16,18,17,17,22,22,11,6,16,25,21,11,10,15,16,14,16,17,12,8,10,9,0,0]},{id:"32x32piano",name:"Piano",category:"32x32",len:32,max:31,data:[18,30,31,29,31,30,30,31,31,31,31,26,10,2,2,6,14,14,10,8,5,3,1,9,17,15,8,2,4,7,10,13]},{id:"32x32piano2",name:"Piano 2",category:"32x32",len:32,max:31,data:[14,27,31,31,31,31,28,22,21,24,31,29,16,7,5,8,15,22,26,26,21,8,0,4,10,11,6,2,0,1,0,2]},{id:"32x32reedorgan",name:"Reed Organ",category:"32x32",len:32,max:31,data:[16,22,31,22,15,8,0,8,16,22,31,22,15,8,16,22,15,13,16,18,16,16,16,16,16,16,31,31,31,31,31,31]},{id:"32x32sam",name:"SAM",category:"32x32",len:32,max:31,data:[5,10,15,10,10,15,15,26,31,31,31,26,21,15,10,10,10,10,15,21,26,26,26,26,21,26,21,21,10,5,0,0]},{id:"32x32saw2",name:"Saw 2",category:"32x32",len:32,max:31,data:[15,31,30,25,23,20,19,17,17,16,15,15,15,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{id:"32x32sax",name:"Sax",category:"32x32",len:32,max:31,data:[0,16,22,27,29,31,29,27,22,16,9,5,2,0,2,5,9,16,24,29,31,29,24,16,7,2,0,2,7,16,31,16]},{id:"32x32strings",name:"Strings",category:"32x32",len:32,max:31,data:[5,31,10,0,0,18,31,26,23,19,25,28,31,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32strings2",name:"Strings 2",category:"32x32",len:32,max:31,data:[21,26,26,21,16,16,16,24,29,31,29,21,15,12,12,16,19,19,15,7,2,0,2,7,16,16,10,5,5,10,16,16]},{id:"32x32synthbass",name:"Synth Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,15,15,0,0,15,15,31,31,31,31,31,31,0,7,7,7,7,7,7,0,23,23,23,23,23,23,0]},{id:"32x32synthbell",name:"Synth Bell",category:"32x32",len:32,max:31,data:[16,31,26,31,19,12,16,19,11,0,6,0,29,18,4,28,19,0,7,0,15,19,16,12,23,31,27,31,4,14,28,5]},{id:"32x32synthlead",name:"Synth Lead",category:"32x32",len:32,max:31,data:[0,0,0,0,3,26,1,0,1,28,0,29,0,18,5,4,0,0,3,0,31,0,20,31,5,2,0,20,27,31,0,16]},{id:"32x32synthlead2",name:"Synth Lead 2",category:"32x32",len:32,max:31,data:[16,16,15,0,16,31,31,31,16,16,15,0,15,15,15,0,0,0,0,15,0,0,15,15,15,15,0,0,0,15,0,0]},{id:"32x32synthpiano",name:"Synth Piano",category:"32x32",len:32,max:31,data:[14,7,8,8,7,3,2,5,3,4,13,25,31,31,31,30,25,14,14,18,22,17,9,9,8,9,15,25,30,29,23,5]},{id:"32x32synthstrings",name:"Synth Strings",category:"32x32",len:32,max:31,data:[17,26,31,31,27,22,17,14,13,16,21,28,31,25,8,1,16,31,24,7,0,5,11,17,19,18,15,10,4,1,1,7]},{id:"32x32trumpet",name:"Trumpet",category:"32x32",len:32,max:31,data:[15,31,26,24,21,20,19,19,18,17,17,17,17,16,17,16,16,16,16,16,16,16,15,14,14,12,11,10,7,4,1,0]},{id:"32x32tuba",name:"Tuba",category:"32x32",len:32,max:31,data:[19,28,31,30,26,22,19,17,16,15,14,14,15,15,15,16,17,17,18,18,18,18,18,17,16,14,11,8,4,1,0,7]},{id:"32x32vibraphone",name:"Vibraphone",category:"32x32",len:32,max:31,data:[10,28,25,18,17,30,31,31,29,31,25,26,30,31,22,9,15,22,19,2,1,5,9,2,3,1,0,0,8,15,8,3]},{id:"32x32voice",name:"Voice",category:"32x32",len:32,max:31,data:[16,25,28,31,28,25,12,8,8,13,19,29,31,29,24,19,9,8,3,2,1,1,0,1,0,0,2,1,5,5,8,14]},{id:"32x32voice2",name:"Voice 2",category:"32x32",len:32,max:31,data:[0,6,8,17,19,21,21,19,16,12,10,12,20,26,29,30,29,21,13,0,1,1,2,2,16,31,30,30,28,16,8,2]},{id:"128x256bass",name:"Bass",category:"128x256",len:128,max:255,data:[0,1,5,17,41,76,120,164,201,227,242,249,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,250,248,244,240,236,232,228,224,222,220,218,217,216,215,214,213,212,210,207,204,199,194,189,184,178,172,166,160,154,148,144,140,136,133,131,129,127,125,123,122,121,120,119,118,117,114,111,107,102,97,90,83,76,70,64,58,52,46,42,39,37,35,34,33,32,31,30,29,28,25,22,17,13,9,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"128x256chime",name:"Chime",category:"128x256",len:128,max:255,data:[128,154,184,203,201,192,190,187,181,176,172,167,164,161,160,161,165,174,188,210,235,252,255,254,253,253,252,250,249,248,246,245,244,244,246,248,252,255,251,233,210,212,223,224,225,230,233,235,237,239,240,240,239,236,230,217,192,151,110,101,118,122,123,130,136,140,144,148,151,151,150,145,136,118,91,55,23,13,20,25,24,28,33,35,38,41,44,44,44,41,35,26,13,2,2,12,9,5,5,4,2,1,1,0,0,0,0,0,1,3,9,25,57,92,95,80,77,76,69,64,61,57,54,52,52,53,58,67]},{id:"128x256lead",name:"Lead",category:"128x256",len:128,max:255,data:[96,159,151,135,187,216,196,170,210,251,206,157,149,151,191,242,206,206,248,206,168,164,166,208,247,200,156,186,218,207,179,212,255,241,241,255,255,255,255,255,248,241,248,255,255,255,232,195,217,212,179,221,250,242,223,163,105,134,164,126,94,110,150,123,102,153,132,104,144,161,128,90,120,149,91,31,13,4,34,76,42,37,60,22,0,0,0,7,13,6,0,0,0,0,0,14,14,0,43,75,48,37,68,98,54,8,47,88,91,87,49,6,49,49,13,64,103,105,98,49,4,44,84,58,38,67,119,104]}];function Io(e,t){if(e.max===t)return e.data;const n=t/e.max;return e.data.map(e=>Math.round(Math.max(0,Math.min(t,e*n))))}function Do(e,t){const n=(a=e,_o.find(e=>e.id===a));var a;if(!n)return null;switch(t){case"gb":case"n163":case"swan":return Io(n,15);case"pce":case"vb":return 31===n.max?n.data:Io(n,31);case"scc":return Io(n,255).map(e=>e-128);case"lynx":return Io(n,255);default:return n.data}}class Oo{static mapOPN2(e,t,n){const a=Po.OPN2,s=t%3,r=0===(t<3?0:1)?0:256;if(e.write(a,34,8),n.fms||n.ams){const t=n.fms??0;e.write(a,34,8|7&t)}const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapOPM(e,t,n){const a=Po.OPM,s=7&t;if(e.write(a,1,2),e.write(a,24,0),e.write(a,25,127),e.write(a,25,255),n.fms||n.ams){const t=n.fms??0;e.write(a,24,16*t&255);const s=n.fms??127,r=n.ams??127;e.write(a,25,128|127&s),e.write(a,25,127&r)}const r=192|(7&n.feedback)<<3|7&n.algorithm;e.write(a,32+s,r);const o=n.fms??0,i=n.ams??0;e.write(a,56+s,(7&o)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const r=l[n]+s,o=this.furnaceDtToOPN2(t.dt??0);e.write(a,64+r,(7&o)<<4|15&(t.mult??1)),e.write(a,96+r,127&(t.tl??0)),e.write(a,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(a,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(a,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(a,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapOPL3(e,t,n,a){const s=a??Po.OPL3;e.write(s,261,1),e.write(s,1,32);const r=t<9?0:256,o=t%9,i=48|(7&n.feedback)<<1|1&n.algorithm;e.write(s,r|192+o,i);const l=this.getOPL3Slots(o);n.operators.slice(0,2).forEach((t,n)=>{const a=r|l[n],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(s,32+a,o),e.write(s,64+a,(3&t.ksl)<<6|63&t.tl),e.write(s,96+a,t.ar>>1<<4|t.dr>>1),e.write(s,128+a,(15&t.sl)<<4|15&t.rr),e.write(s,224+a,7&t.ws)})}static mapPSG(e,t,n){const a=Po.PSG;e.write(a,0,231),e.write(a,1,255);const s=144|(3&t)<<5|15&Math.min(15,Math.floor(n.operators[0].tl/8));e.write(a,0,s)}static mapGB(e,t,n){const a=Po.GB;e.write(a,16,0),e.write(a,38,143),e.write(a,37,255),e.write(a,36,255)}static mapC64(e,t,n){const a=n.c64,s=n.chipType===Po.SID_6581||n.chipType===Po.SID_8580,r=s?n.chipType:Po.SID;if(s){const n=7*t,s=a?.a??0,o=a?.d??8;e.write(r,n+5,(15&s)<<4|15&o);const i=a?.s??15,l=a?.r??4;e.write(r,n+6,(15&i)<<4|15&l);const c=a?.duty??2048;e.write(r,n+2,255&c),e.write(r,n+3,c>>8&15);let d=0;a?(a.noiseOn&&(d|=128),a.pulseOn&&(d|=64),a.sawOn&&(d|=32),a.triOn&&(d|=16),a.ringMod&&(d|=4),a.oscSync&&(d|=2)):d=64,e.write(r,n+4,d),e.write(r,24,15);const u=a?.filterResonance??a?.filterRes??0;let p=0;a?.filterOn&&!0!==a?.filterCh3Off&&(p|=1<<t),e.write(r,23,(15&u)<<4|p)}else{const n=0,s=1,o=2,i=3,l=5,c=6,d=7,u=8,p=13,h=50,m=51,f=t*64,y=17*(a?.a??0),g=17*(a?.d??8),v=17*(a?.s??15),b=17*(a?.r??4);e.write(r,f+s,255&y),e.write(r,f+o,255&g),e.write(r,f+i,255&v),e.write(r,f+l,255&b);let x=0;a?(a.triOn&&(x|=1),a.sawOn&&(x|=2),a.pulseOn&&(x|=4),a.noiseOn&&(x|=8)):x=4,e.write(r,f+c,x);const w=a?.duty??2048;e.write(r,f+d,w>>8&255),e.write(r,f+u,255&w),e.write(r,f+p,255),e.write(r,f+h,255),e.write(r,f+m,255),e.write(r,f+n,0)}}static mapNES(e,t,n){const a=Po.NES;if(e.write(a,16405,31),e.write(a,16385,8),e.write(a,16389,8),e.write(a,16384,48),e.write(a,16386,0),e.write(a,16387,8),e.write(a,16388,48),e.write(a,16390,0),e.write(a,16391,8),e.write(a,16392,0),e.write(a,16394,0),e.write(a,16395,8),e.write(a,16396,48),e.write(a,16398,8),e.write(a,16399,8),t<2){const s=4*t,r=3&Math.floor((n.operators[0]?.mult??2)/4),o=Math.max(0,15-Math.floor(n.operators[0].tl/8));e.write(a,16384+s,r<<6|48|15&o)}else if(2===t)e.write(a,16392,255);else if(3===t){const t=Math.max(0,15-Math.floor(n.operators[0].tl/8));e.write(a,16396,48|15&t)}}static mapAY(e,t,n){const a=Po.AY;e.write(a,7,56)}static mapPCE(e,t,n){const a=Po.PCE;e.write(a,0,0),e.write(a,1,255)}static mapSNES(e,t,n){const a=Po.SNES;e.write(a,93,2),e.write(a,12,127),e.write(a,28,127),e.write(a,108,0),e.write(a,76,0),e.write(a,92,0);for(let s=0;s<8;s++)e.write(a,16*s+4,s)}static mapOPLL(e,t,n){const a=Po.OPLL,s=n.opllPreset??3;if(0===s&&n.operators.length>=2){const t=n.operators[0],s=n.operators[1],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(a,0,r);const o=(s.am?128:0)|(s.vib?64:0)|(s.sus?32:0)|(s.ksr?16:0)|15&s.mult;e.write(a,1,o);const i=Math.min(63,t.tl>>1);e.write(a,2,(3&t.ksl)<<6|63&i);const l=1&(s.ws??0),c=1&(t.ws??0);e.write(a,3,l<<4|c<<3|7&n.feedback),e.write(a,4,(15&t.ar)<<4|15&t.dr),e.write(a,5,(15&s.ar)<<4|15&s.dr),e.write(a,6,(15&t.sl)<<4|15&t.rr),e.write(a,7,(15&s.sl)<<4|15&s.rr)}e.write(a,48+t,(15&s)<<4),e.write(a,14,0)}static mapOPNA(e,t,n){const a=Po.OPNA,s=t%3,r=0===(t<3?0:1)?0:256;e.write(a,34,8),e.write(a,41,159),e.write(a,257,63);const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapOPN(e,t,n){const a=Po.OPN,s=t%3;e.write(a,34,8);const r=(7&n.feedback)<<3|7&n.algorithm;e.write(a,176+s,r);const o=(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,180+s,o);const i=[0,8,4,12];n.operators.forEach((t,n)=>{const r=i[n]+s,o=this.furnaceDtToOPN2(t.dt);e.write(a,48+r,(7&o)<<4|15&t.mult),e.write(a,64+r,127&t.tl),e.write(a,80+r,(3&t.rs)<<6|31&t.ar),e.write(a,96+r,(t.am?128:0)|31&t.dr),e.write(a,112+r,31&t.d2r),e.write(a,128+r,(15&t.sl)<<4|15&t.rr),e.write(a,144+r,15&t.ssg)})}static mapOPNB(e,t,n){const a=Po.OPNB,s=t%3,r=0===(t<3?0:1)?0:256;e.write(a,34,0);const o=(7&n.feedback)<<3|7&n.algorithm;e.write(a,r|176+s,o);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(a,r|180+s,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const o=l[n]+s,i=this.furnaceDtToOPN2(t.dt);e.write(a,r|48+o,(7&i)<<4|15&t.mult),e.write(a,r|64+o,127&t.tl),e.write(a,r|80+o,(3&t.rs)<<6|31&t.ar),e.write(a,r|96+o,(t.am?128:0)|31&t.dr),e.write(a,r|112+o,31&t.d2r),e.write(a,r|128+o,(15&t.sl)<<4|15&t.rr),e.write(a,r|144+o,15&t.ssg)})}static mapVRC6(e,t,n){const a=Po.VRC6;e.write(a,36867,0)}static mapN163(e,t,n){const a=Po.N163;e.write(a,127,0)}static mapSCC(e,t,n){const a=Po.SCC;for(let s=0;s<5;s++)e.write(a,138+s,15);e.write(a,143,31)}static mapFDS(e,t,n){const a=Po.FDS;e.write(a,16419,0),e.write(a,16419,131),e.write(a,16521,0)}static mapMMC5(e,t,n){const a=Po.MMC5;e.write(a,20501,3),e.write(a,20496,0)}static mapTIA(e,t,n){const a=Po.TIA;e.write(a,25,15),e.write(a,26,15)}static mapSAA(e,t,n){const a=Po.SAA;e.write(a,28,2),e.write(a,28,1)}static mapSWAN(e,t,n){const a=Po.SWAN;for(let s=0;s<4;s++)e.write(a,8+s,255);e.write(a,15,0),e.write(a,17,15)}static mapOKI(e,t,n){const a=Po.OKI;e.write(a,12,0)}static mapES5506(e,t,n){}static mapOPZ(e,t,n){const a=Po.OPZ,s=7&t;e.write(a,1,2),e.write(a,24,0),e.write(a,25,127),e.write(a,25,255);const r=192|(7&n.feedback)<<3|7&n.algorithm;e.write(a,32+s,r);const o=n.fms??0,i=n.ams??0;e.write(a,56+s,(7&o)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const r=l[n]+s,o=this.furnaceDtToOPN2(t.dt??0);e.write(a,64+r,(7&o)<<4|15&(t.mult??1)),e.write(a,96+r,127&(t.tl??0)),e.write(a,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(a,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(a,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(a,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapY8950(e,t,n){const a=Po.Y8950;e.write(a,1,32),e.write(a,4,0),e.write(a,8,0);const s=t%9,r=(7&n.feedback)<<1|1&n.algorithm;e.write(a,192+s,r);const o=this.getOPL3Slots(s);n.operators.slice(0,2).forEach((t,n)=>{const s=o[n],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(a,32+s,r),e.write(a,64+s,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(a,96+s,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(a,128+s,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(a,224+s,3&(t.ws??0))})}static mapOPL4(e,t,n){const a=Po.OPL4;e.write(a,261,3),e.write(a,514,16),e.write(a,1,32);const s=t<9?0:256,r=t%9,o=48|(7&n.feedback)<<1|1&n.algorithm;e.write(a,s|192+r,o);const i=this.getOPL3Slots(r);n.operators.slice(0,2).forEach((t,n)=>{const r=s|i[n],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(a,32+r,o),e.write(a,64+r,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(a,96+r,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(a,128+r,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(a,224+r,7&(t.ws??0))})}static mapSEGAPCM(e,t,n){const a=Po.SEGAPCM;for(let s=0;s<16;s++){const t=s<<3;e.write(a,134+t,3),e.write(a,2+t,127),e.write(a,3+t,127)}}static mapYMZ280B(e,t,n){const a=Po.YMZ280B;e.write(a,255,128);for(let s=0;s<8;s++)e.write(a,2+4*s,255),e.write(a,3+4*s,8)}static mapRF5C68(e,t,n){const a=Po.RF5C68;e.write(a,8,255);for(let s=0;s<8;s++)e.write(a,0+s,0),e.write(a,1+s,0);e.write(a,8,0)}static mapGA20(e,t,n){const a=Po.GA20;for(let s=0;s<4;s++)e.write(a,5+8*s,0),e.write(a,6+8*s,0)}static mapC140(e,t,n){const a=Po.C140;for(let s=0;s<24;s++)e.write(a,5+(s<<4),0)}static mapQSOUND(e,t,n){const a=Po.QSOUND;e.write(a,0,0)}static mapVIC(e,t,n){const a=Po.VIC;e.write(a,14,15)}static mapTED(e,t,n){const a=Po.TED;e.write(a,17,15)}static mapSUPERVISION(e,t,n){}static mapVERA(e,t,n){const a=Po.VERA;for(let s=0;s<16;s++)e.write(a,129472+4*s+2,3)}static mapSM8521(e,t,n){const a=Po.SM8521;e.write(a,64,128)}static mapBUBBLE(e,t,n){}static mapK007232(e,t,n){const a=Po.K007232;e.write(a,12,255),e.write(a,13,0)}static mapK053260(e,t,n){const a=Po.K053260;e.write(a,40,0),e.write(a,47,2)}static mapX1_010(e,t,n){const a=Po.X1_010;for(let s=0;s<16;s++)e.write(a,8*s,0)}static mapUPD1771(e,t,n){}static mapT6W28(e,t,n){const a=Po.T6W28;e.write(a,1,231)}static mapVB(e,t,n){const a=Po.VB;for(let s=0;s<6;s++){const t=1024+64*s;e.write(a,t+4,255),e.write(a,t+16,240)}}static mapLYNX(e,t,n){const a=Po.LYNX;e.write(a,80,0)}static mapNAMCO(e,t,n){}static mapPET(e,t,n){}static mapPOKEY(e,t,n){}static mapAMIGA(e,t,n){}static mapPCSPKR(e,t,n){}static getOPL3Slots(e){return[[0,1,2,8,9,10,16,17,18][e],[3,4,5,11,12,13,19,20,21][e]]}static furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}static uploadWavetable(e,t,n){switch(t){case Po.GB:for(let s=0;s<16;s++){const t=15&(n[2*s]||0),a=15&(n[2*s+1]||0);e.write(Po.GB,48+s,t<<4|a)}break;case Po.SCC:for(let s=0;s<32;s++)e.write(Po.SCC,s,255&n[s]);break;case Po.N163:e.write(Po.N163,57344,128);for(let s=0;s<Math.min(128,n.length);s++)e.write(Po.N163,63488,255&n[s]);break;case Po.PCE:for(let s=0;s<32;s++)e.write(Po.PCE,6,31&n[s]);break;case Po.SWAN:for(let s=0;s<16;s++){const t=15&(n[2*s]||0),a=15&(n[2*s+1]||0);e.write(Po.SWAN,64+s,t<<4|a)}break;case Po.BUBBLE:const t=new Uint8Array(n.slice(0,32));e.setWavetable(Po.BUBBLE,0,t),e.setWavetable(Po.BUBBLE,1,t);break;case Po.X1_010:const a=n.some(e=>e<0);for(let s=0;s<16;s++){const t=4096|s<<7;for(let s=0;s<128;s++){const r=s*n.length/128,o=Math.floor(r),i=r-o,l=n[o]||0,c=l+((n[(o+1)%n.length]||0)-l)*i;let d;d=a?255&Math.round(4*c):17*c-128&255,e.write(Po.X1_010,t+s,d)}}}}static loadWavetablePreset(e,t,n){let a;switch(t){case Po.GB:a="gb";break;case Po.PCE:a="pce";break;case Po.N163:a="n163";break;case Po.SCC:a="scc";break;case Po.SWAN:a="swan";break;case Po.VB:a="vb";break;case Po.LYNX:a="lynx";break;default:return!1}const s=Do(n,a);return!!s&&(this.uploadWavetable(e,t,s),!0)}static getRecommendedWavetables(e){switch(e){case Po.GB:case Po.N163:case Po.SWAN:return["32x16saw","32x16FunkyLead","32x16NamcoBass","32x16brass","32x16clarinet","32x16flute","32x16guitar","32x16opllpiano","32x16synthbass","32x16trumpet","32x16voice"];case Po.PCE:case Po.VB:return["32x32piano","32x32brass","32x32flute","32x32lead","32x32organ","32x32strings","32x32synthbass","32x32trumpet","32x32voice","32x32bell","32x32choir","32x32vibraphone"];case Po.SCC:return["32x32piano","32x32brass","32x32lead","32x32organ","32x32synthbass","32x32trumpet","32x32strings","32x32flute"];case Po.LYNX:return["128x256bass","128x256chime","128x256lead","32x32piano","32x32brass","32x32lead","32x32synthbass"];default:return[]}}}class Fo{static CLOCK_OPN2=7670454;static CLOCK_OPN2_PAL=7600489;static CLOCK_OPN=4e6;static CLOCK_OPM=3579545;static FREQ_BASE_OPN2=9440540;static FREQ_BASE_OPN=4720270;static FREQ_BASE_OPM=3579545;static freqToOPN2(e){if(e<=0)return{block:0,fnum:0};const t=this.CLOCK_OPN2;let n=7,a=0;for(n=7;n>=0;n--){const s=Math.pow(2,n);if(a=Math.round(144*e*2097152/(t*s)),a<=2047&&a>=600)break;if(!(a<=2047&&a<600&&n>0)&&(0===n&&a<=2047))break}return a>2047&&(n=7,a=2047),n=Math.max(0,Math.min(7,n)),a=Math.max(0,Math.min(2047,a)),{block:n,fnum:a}}static freqToOPM(e){if(e<=0)return{kc:0,kf:0};const t=12*Math.log2(e/440)+69,n=Math.floor(t),a=t-n,s=Math.floor(n/12)-1,r=n%12;return{kc:Math.max(0,Math.min(7,s))<<4|[0,1,2,4,5,6,8,9,10,12,13,14][r],kf:63&Math.floor(64*a)}}static freqToGB(e){if(e<=0)return 0;const t=2048-131072/e;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNES(e){if(e<=0)return 0;const t=1789773/(16*e)-1;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNESNoise(e){const t=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];if(e<=0)return 15;const n=1789773/e;let a=0,s=Math.abs(t[0]-n);for(let r=1;r<16;r++){const e=Math.abs(t[r]-n);e<s&&(s=e,a=r)}return a}static freqToAY(e,t=1789773){if(e<=0)return 0;const n=Math.floor(t/(16*e));return Math.max(0,Math.min(4095,n))}static freqToPCE(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(4095,t))}static freqToSCC(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToSID(e,t=!0){if(e<=0)return 0;const n=t?985248:1022727,a=Math.floor(16777216*e/n);return Math.max(0,Math.min(65535,a))}static freqToPSG(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(1023,t))}static freqToSNES(e){if(e<=0)return 0;const t=Math.floor(4096*e/32e3);return Math.max(0,Math.min(16383,t))}static freqToFDS(e){if(e<=0)return 0;const t=Math.floor(65536*e/1789773);return Math.max(0,Math.min(4095,t))}static freqToVRC6(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToPOKEY(e){if(e<=0)return 0;const t=Math.floor(1789773/(2*e))-1;return Math.max(0,Math.min(255,t))}static freqToTIA(e){if(e<=0)return 0;const t=Math.floor(31440/(32*e))-1;return Math.max(0,Math.min(31,t))}static freqToVIC(e){if(e<=0)return 0;const t=Math.floor(256-1022727/(32*e));return Math.max(0,Math.min(127,t))}static freqToTED(e){if(e<=0)return 0;const t=Math.floor(1024-1773447/(8*e));return Math.max(0,Math.min(1023,t))}static freqToAmiga(e,t=!0){if(e<=0)return 65535;const n=t?3546895:3579545,a=Math.floor(n/(2*e));return Math.max(124,Math.min(65535,a))}}let Ro=0;const jo=a((e,t)=>({errors:[],activeError:null,reportError:t=>{const n="synth-error-"+ ++Ro,a={timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",audioContextState:"undefined"!=typeof AudioContext?(new AudioContext).state:"AudioContext not available",wasmSupported:"undefined"!=typeof WebAssembly,...t.debugData},s={id:n,synthType:t.synthType,synthName:t.synthName,errorType:t.errorType,message:t.message,stack:t.stack,debugData:a,dismissed:!1};return e(e=>({errors:[...e.errors,s],activeError:s})),n},dismissError:t=>{e(e=>({errors:e.errors.map(e=>e.id===t?{...e,dismissed:!0}:e),activeError:e.activeError?.id===t?null:e.activeError}))},dismissAll:()=>{e(e=>({errors:e.errors.map(e=>({...e,dismissed:!0})),activeError:null}))},clearDismissed:()=>{e(e=>({errors:e.errors.filter(e=>!e.dismissed)}))},getDebugString:e=>{const t=["=== DEViLBOX Synth Error Report ===","",`Synth Type: ${e.synthType}`,e.synthName?`Synth Name: ${e.synthName}`:null,`Error Type: ${e.errorType}`,`Message: ${e.message}`,"","--- Debug Data ---",`Timestamp: ${e.debugData.timestamp}`,`User Agent: ${e.debugData.userAgent}`,`AudioContext State: ${e.debugData.audioContextState}`,`WASM Supported: ${e.debugData.wasmSupported}`,""].filter(Boolean),n=Object.keys(e.debugData).filter(e=>!["timestamp","userAgent","audioContextState","wasmSupported","synthConfig"].includes(e));if(n.length>0){t.push("--- Additional Info ---");for(const a of n)t.push(`${a}: ${JSON.stringify(e.debugData[a])}`);t.push("")}return e.debugData.synthConfig&&(t.push("--- Synth Config ---"),t.push(JSON.stringify(e.debugData.synthConfig,null,2)),t.push("")),e.stack&&(t.push("--- Stack Trace ---"),t.push(e.stack)),t.join("\n")},copyToClipboard:async e=>{const n=t().getDebugString(e);try{return await navigator.clipboard.writeText(n),!0}catch(a){return!1}}})),Lo=(e,t,n)=>jo.getState().reportError({synthType:e,message:t,synthName:n?.synthName,errorType:n?.errorType??"init",stack:n?.error?.stack,debugData:n?.debugData});class Bo{name="FurnaceSynth";output;chipEngine=Ao.getInstance();config;channelIndex=0;macroPositions=new Map;opMacroPositions=Array.from({length:4},()=>({}));activeNoteFreq=440;isNoteOn=!1;currentDuty=2;currentPan=0;velocity=1;baseTLValues=[];_oplBlock=0;_oplFnum=0;useWasmEngine=!1;errorReported=!1;gbFreqHigh=0;gbFreqVal=0;nesNoiseIndex=0;initInProgress=!1;wasmNoteTriggered=!1;noteOnTime=0;static MIN_GATE_TIME=.05;_volumeOffsetDb=0;constructor(e=ka,t=0){this.config={...e,operators:e.operators?.map(e=>({...e}))||[]},this.channelIndex=t,this.output=Ja().createGain(),this.chipEngine=Ao.getInstance(),this.initEngine()}getChipType(){return this.config.chipType}setVolumeOffset(e){this._volumeOffsetDb=e,this.useWasmEngine&&this.chipEngine.setOutputGain(Math.pow(10,e/20))}async ensureInitialized(){if(!this.useWasmEngine){if(this.initInProgress){for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);if(this.useWasmEngine)return}await this.initEngine(),!this.useWasmEngine&&this.chipEngine.isInitialized()&&(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters())}}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=Ja();if("running"!==e.state){if(!(await Promise.race([new Promise(t=>{const n=()=>{"running"===e.state?t(!0):setTimeout(n,100)};n()}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return this.reportInitError("audio","AudioContext failed to start. Click anywhere to enable audio, then try again."),void(this.initInProgress=!1)}await this.chipEngine.init(e),this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters(),this.isNoteOn&&this.activeNoteFreq>0&&(this.updateFrequency(this.activeNoteFreq),this.writeKeyOn(this.velocity),this.wasmNoteTriggered=!0)):this.reportInitError("wasm","WASM chip engine failed to initialize. This synth requires WebAssembly support.")}catch(e){const t=e instanceof Error?e:new Error(String(e));this.reportInitError("wasm",t.message,t)}finally{this.initInProgress=!1}}}reportInitError(e,t,n){this.errorReported||(this.errorReported=!0,Lo(`Furnace/${this.config.chipType||"Unknown"}`,t,{errorType:e,error:n,debugData:{chipType:this.config.chipType,channelIndex:this.channelIndex,synthConfig:this.config}}))}processTick(e=is()){this.isNoteOn&&(this.config.macros.forEach(t=>{if(!t.data||0===t.data.length)return;let n=this.macroPositions.get(t.type)||0;n>=t.data.length&&(n=t.data.length-1);const a=t.data[n];switch(t.type){case 0:const t=Math.max(0,a/127*this.velocity);this.output.gain.setValueAtTime(t,e);break;case 1:this.updateFrequency(this.activeNoteFreq*Math.pow(2,a/12));break;case 2:this.currentDuty=a,this.writeDutyRegister(a);break;case 3:this.writeWavetableSelect(a);break;case 4:const n=a>127?a-256:a;this.updateFrequency(this.activeNoteFreq*Math.pow(2,n/1200));break;case 5:this.currentPan=a>127?a-256:a,this.writePanRegister(this.currentPan);break;case 6:0!==a&&this.writePhaseReset()}n++,n>=t.data.length&&(n=t.loop>=0?t.loop:t.data.length-1),this.macroPositions.set(t.type,n)}),this.config.opMacros.forEach((e,t)=>{if(!e)return;const n=this.config.operators[t];if(n){if(e.tl&&e.tl.data.length>0){const a=this.advanceOpMacro(e.tl,t,"tl");n.tl=a,this.writeOperatorTL(t,a)}if(e.mult&&e.mult.data.length>0){const a=this.advanceOpMacro(e.mult,t,"mult");n.mult=a,this.writeOperatorMult(t,a)}if(e.ar&&e.ar.data.length>0){const a=this.advanceOpMacro(e.ar,t,"ar");n.ar=a,this.writeOperatorAR(t,a)}if(e.dr&&e.dr.data.length>0){const a=this.advanceOpMacro(e.dr,t,"dr");n.dr=a,this.writeOperatorDR(t,a)}if(e.sl&&e.sl.data.length>0){const a=this.advanceOpMacro(e.sl,t,"sl");n.sl=a,this.writeOperatorSL(t,a)}if(e.rr&&e.rr.data.length>0){const a=this.advanceOpMacro(e.rr,t,"rr");n.rr=a,this.writeOperatorRR(t,a)}}}))}advanceOpMacro(e,t,n){let a=this.opMacroPositions[t][n]||0;a>=e.data.length&&(a=e.data.length-1);const s=e.data[a];return a++,a>=e.data.length&&(a=e.loop>=0?e.loop:e.data.length-1),this.opMacroPositions[t][n]=a,s}writeDutyRegister(e){const t=this.channelIndex;if(this.config.chipType===Po.NES){if(t<2){const n=16384+4*t,a=48|15&(this.config.operators[0]?.tl||15);this.chipEngine.write(Po.NES,n,(3&e)<<6|a)}}else if(this.config.chipType===Po.GB){if(t<2){const n=0===t?17:22;this.chipEngine.write(Po.GB,n,(3&e)<<6)}}else this.config.chipType,Po.PSG}writeWavetableSelect(e){if(this.config.wavetables&&this.config.wavetables[e]){const t=this.config.wavetables[e].data;Oo.uploadWavetable(this.chipEngine,this.config.chipType,t)}}writePanRegister(e){const t=this.channelIndex;if(this.config.chipType===Po.OPN2){const n=t%3,a=0===(t<3?0:1)?0:256;let s=192;e<-32?s=128:e>32&&(s=64),this.chipEngine.write(Po.OPN2,a|180+n,s)}else if(this.config.chipType===Po.OPM){let n=192;e<-32?n=128:e>32&&(n=64);const a=(7&this.config.feedback)<<3|7&this.config.algorithm;this.chipEngine.write(Po.OPM,32+(7&t),n|a)}else this.config.chipType===Po.GB&&this.chipEngine.write(Po.GB,37,255)}writePhaseReset(){if(this.config.chipType===Po.OPN2){const e=this.channelIndex%3,t=this.channelIndex<3?0:1;this.chipEngine.write(Po.OPN2,40,t<<2|e),this.chipEngine.write(Po.OPN2,40,240|t<<2|e)}}writeOperatorTL(e,t){const n=this.channelIndex;if(this.config.chipType===Po.OPN2){const a=0===(n<3?0:1)?0:256,s=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,a|64+s,127&t)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const a=[0,16,8,24][e]+(7&n),s=this.config.chipType;this.chipEngine.write(s,96+a,127&t)}}writeOperatorMult(e,t){const n=this.channelIndex,a=this.config.operators[e];if(!a)return;const s=this.furnaceDtToOPN2(a.dt);if(this.config.chipType===Po.OPN2){const a=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,a|48+r,(7&s)<<4|15&t)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const a=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,64+a,(7&s)<<4|15&t)}}writeOperatorAR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Po.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,s|80+r,(3&a.rs)<<6|31&t)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,128+s,(3&a.rs)<<6|31&t)}}writeOperatorDR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Po.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,s|96+r,(a.am?128:0)|31&t)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,160+s,(a.am?128:0)|31&t)}}writeOperatorSL(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Po.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,s|128+r,(15&t)<<4|15&a.rr)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&t)<<4|15&a.rr)}}writeOperatorRR(e,t){const n=this.channelIndex,a=this.config.operators[e];if(a)if(this.config.chipType===Po.OPN2){const s=0===(n<3?0:1)?0:256,r=[0,8,4,12][e]+n%3;this.chipEngine.write(Po.OPN2,s|128+r,(15&a.sl)<<4|15&t)}else if(this.config.chipType===Po.OPM||this.config.chipType===Po.OPZ){const s=[0,16,8,24][e]+(7&n),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&a.sl)<<4|15&t)}}furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}updateFrequency(e){const t=this.channelIndex%3,n=0===(this.channelIndex<3?0:1)?0:256;if(this.config.chipType===Po.OPN2){const{block:a,fnum:s}=Fo.freqToOPN2(e);this.chipEngine.write(Po.OPN2,n|160+t,255&s),this.chipEngine.write(Po.OPN2,n|164+t,(7&a)<<3|s>>8&7)}else if(this.config.chipType===Po.OPN){const{block:t,fnum:n}=Fo.freqToOPN2(e),a=this.channelIndex%3;this.chipEngine.write(Po.OPN,160+a,255&n),this.chipEngine.write(Po.OPN,164+a,(7&t)<<3|n>>8&7)}else if(this.config.chipType===Po.OPM){const{kc:t,kf:n}=Fo.freqToOPM(e);this.chipEngine.write(Po.OPM,40+(7&this.channelIndex),t),this.chipEngine.write(Po.OPM,48+(7&this.channelIndex),n<<2)}else if(this.config.chipType===Po.OPZ){const t=[0,1,2,4,5,6,8,9,10,12,13,14],n=Math.round(12*Math.log2(e/440)+69),a=Math.max(0,Math.min(127,n)),s=(7&Math.floor(a/12))<<4|t[a%12],r=12*Math.log2(e/440)+69-a,o=63&Math.floor(64*r);this.chipEngine.write(Po.OPZ,40+(7&this.channelIndex),s),this.chipEngine.write(Po.OPZ,48+(7&this.channelIndex),o<<2)}else if(this.config.chipType===Po.OPL3||this.config.chipType===Po.Y8950||this.config.chipType===Po.OPL4||this.config.chipType===Po.ESFM){const t=this.channelIndex%9,n=this.channelIndex<9?0:256;let a=4,s=Math.floor(e*(1<<19)/2e5);for(;s>1023&&a<7;)s>>=1,a++;for(;s<256&&a>0;)s<<=1,a--;s&=1023,this._oplBlock=a,this._oplFnum=s,this.chipEngine.write(this.config.chipType,n|160+t,255&s),this.chipEngine.write(this.config.chipType,n|176+t,(7&a)<<2|s>>8&3)}else if(this.config.chipType===Po.OPLL){const t=this.channelIndex%9;let n=4,a=Math.floor(e*(1<<18)/2e5);for(;a>511&&n<7;)a>>=1,n++;for(;a<128&&n>0;)a<<=1,n--;a&=511,this._oplBlock=n,this._oplFnum=a,this.chipEngine.write(Po.OPLL,16+t,255&a)}else if(this.config.chipType===Po.OPNA||this.config.chipType===Po.OPNB||this.config.chipType===Po.OPNB_B){const{block:t,fnum:n}=Fo.freqToOPN2(e),a=this.channelIndex%3,s=0===(this.channelIndex<3?0:1)?0:256;this.chipEngine.write(this.config.chipType,s|160+a,255&n),this.chipEngine.write(this.config.chipType,s|164+a,(7&t)<<3|n>>8&7)}else if(this.config.chipType===Po.AY||this.config.chipType===Po.AY8930){const t=1789773,n=4095&Math.floor(t/(16*e)),a=this.channelIndex%3;this.chipEngine.write(this.config.chipType,2*a,255&n),this.chipEngine.write(this.config.chipType,2*a+1,n>>8&15)}else if(this.config.chipType===Po.SID||this.config.chipType===Po.SID_6581||this.config.chipType===Po.SID_8580){const t=985248,n=65535&Math.floor(16777216*e/t),a=this.channelIndex%3*7;this.chipEngine.write(this.config.chipType,a+0,255&n),this.chipEngine.write(this.config.chipType,a+1,n>>8&255)}else if(this.config.chipType===Po.PSG){const t=1023&Math.floor(3579545/(32*e)),n=3&this.channelIndex;this.chipEngine.write(Po.PSG,0,128|n<<5|15&t),this.chipEngine.write(Po.PSG,0,t>>4&63)}else if(this.config.chipType===Po.NES){const t=this.channelIndex;if(t<2){const n=Fo.freqToNES(e),a=16384+4*t;this.chipEngine.write(Po.NES,a+2,255&n),this.chipEngine.write(Po.NES,a+3,n>>8&7)}else if(2===t){const t=Fo.freqToNES(e);this.chipEngine.write(Po.NES,16394,255&t),this.chipEngine.write(Po.NES,16395,t>>8&7)}else if(3===t){const t=Fo.freqToNESNoise(e);this.nesNoiseIndex=t,this.chipEngine.write(Po.NES,16398,15&t)}}else if(this.config.chipType===Po.GB){const t=Fo.freqToGB(e);this.gbFreqVal=t}else if(this.config.chipType===Po.PCE){const t=this.channelIndex,n=4095&Math.floor(3579545/(32*e));this.chipEngine.write(Po.PCE,0,7&t),this.chipEngine.write(Po.PCE,2,255&n),this.chipEngine.write(Po.PCE,3,n>>8&15)}else if(this.config.chipType===Po.SNES){const t=16*(7&this.channelIndex),n=16383&Math.floor(4096*e/32e3);this.chipEngine.write(Po.SNES,t+2,255&n),this.chipEngine.write(Po.SNES,t+3,n>>8&63)}}updateParameters(){switch(this.config.chipType){case 0:Oo.mapOPN2(this.chipEngine,this.channelIndex,this.config);break;case 1:Oo.mapOPM(this.chipEngine,this.channelIndex,this.config);break;case 2:Oo.mapOPL3(this.chipEngine,this.channelIndex,this.config);break;case 11:Oo.mapOPLL(this.chipEngine,this.channelIndex,this.config);break;case 13:Oo.mapOPNA(this.chipEngine,this.channelIndex,this.config);break;case 14:case 48:Oo.mapOPNB(this.chipEngine,this.channelIndex,this.config);break;case 22:Oo.mapOPZ(this.chipEngine,this.channelIndex,this.config);break;case 23:Oo.mapY8950(this.chipEngine,this.channelIndex,this.config);break;case 26:Oo.mapOPL4(this.chipEngine,this.channelIndex,this.config);break;case 47:Oo.mapOPN(this.chipEngine,this.channelIndex,this.config);break;case 49:Oo.mapOPL3(this.chipEngine,this.channelIndex,this.config,Po.ESFM);break;case 3:Oo.mapPSG(this.chipEngine,this.channelIndex,this.config);break;case 12:Oo.mapAY(this.chipEngine,this.channelIndex,this.config);break;case 18:Oo.mapSAA(this.chipEngine,this.channelIndex,this.config);break;case 43:Oo.mapT6W28(this.chipEngine,this.channelIndex,this.config);break;case 4:Oo.mapNES(this.chipEngine,this.channelIndex,this.config);break;case 5:Oo.mapGB(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.GB,this.config.wavetables[0].data);break;case 6:Oo.mapPCE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.PCE,this.config.wavetables[0].data);break;case 24:Oo.mapSNES(this.chipEngine,this.channelIndex,this.config);break;case 44:Oo.mapVB(this.chipEngine,this.channelIndex,this.config);break;case 16:Oo.mapFDS(this.chipEngine,this.channelIndex,this.config);break;case 17:Oo.mapMMC5(this.chipEngine,this.channelIndex,this.config);break;case 8:Oo.mapN163(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.N163,this.config.wavetables[0].data);break;case 9:Oo.mapVRC6(this.chipEngine,this.channelIndex,this.config);break;case 7:Oo.mapSCC(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.SCC,this.config.wavetables[0].data);break;case 19:Oo.mapSWAN(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.SWAN,this.config.wavetables[0].data);break;case 36:Oo.mapVERA(this.chipEngine,this.channelIndex,this.config);break;case 37:Oo.mapSM8521(this.chipEngine,this.channelIndex,this.config);break;case 38:Oo.mapBUBBLE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.BUBBLE,this.config.wavetables[0].data);break;case 10:case 45:case 46:Oo.mapC64(this.chipEngine,this.channelIndex,this.config);break;case 20:Oo.mapOKI(this.chipEngine,this.channelIndex,this.config);break;case 21:Oo.mapES5506(this.chipEngine,this.channelIndex,this.config);break;case 27:Oo.mapSEGAPCM(this.chipEngine,this.channelIndex,this.config);break;case 28:Oo.mapYMZ280B(this.chipEngine,this.channelIndex,this.config);break;case 29:Oo.mapRF5C68(this.chipEngine,this.channelIndex,this.config);break;case 30:Oo.mapGA20(this.chipEngine,this.channelIndex,this.config);break;case 31:Oo.mapC140(this.chipEngine,this.channelIndex,this.config);break;case 32:Oo.mapQSOUND(this.chipEngine,this.channelIndex,this.config);break;case 39:Oo.mapK007232(this.chipEngine,this.channelIndex,this.config);break;case 40:Oo.mapK053260(this.chipEngine,this.channelIndex,this.config);break;case 41:Oo.mapX1_010(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&Oo.uploadWavetable(this.chipEngine,Po.X1_010,this.config.wavetables[0].data);break;case 15:Oo.mapTIA(this.chipEngine,this.channelIndex,this.config);break;case 33:Oo.mapVIC(this.chipEngine,this.channelIndex,this.config);break;case 34:Oo.mapTED(this.chipEngine,this.channelIndex,this.config);break;case 35:Oo.mapSUPERVISION(this.chipEngine,this.channelIndex,this.config);break;case 42:Oo.mapUPD1771(this.chipEngine,this.channelIndex,this.config);break;case 25:Oo.mapLYNX(this.chipEngine,this.channelIndex,this.config);break;case 55:Oo.mapNAMCO(this.chipEngine,this.channelIndex,this.config);break;case 56:Oo.mapPET(this.chipEngine,this.channelIndex,this.config);break;case 57:Oo.mapPOKEY(this.chipEngine,this.channelIndex,this.config);break;case 61:Oo.mapAMIGA(this.chipEngine,this.channelIndex,this.config);break;case 62:Oo.mapPCSPKR(this.chipEngine,this.channelIndex,this.config)}}triggerAttack(e,t,n){const a=os(e);this.activeNoteFreq=a,this.isNoteOn=!0,this.velocity=void 0!==n?n:1;const s=t||is();return this.noteOnTime=is(),this.useWasmEngine||(this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters()):this.initInProgress||this.initEngine()),this.useWasmEngine?(this.macroPositions.clear(),this.opMacroPositions=Array.from({length:4},()=>({})),this.currentDuty=2,this.currentPan=0,this.baseTLValues=this.config.operators.map(e=>e.tl),this.applyVelocityToCarriers(),this.updateParameters(),this.updateFrequency(a),this.writeKeyOn(n),this.wasmNoteTriggered=!0,this.processTick(s),this):this}applyVelocityToCarriers(){if(this.config.chipType!==Po.OPN2&&this.config.chipType!==Po.OPM)return;const e=[[3],[3],[3],[3],[2,3],[2,3],[1,2,3],[0,1,2,3]][7&this.config.algorithm]||[3],t=Math.floor(32*(1-this.velocity));for(const n of e)if(this.config.operators[n]){const e=this.baseTLValues[n];this.config.operators[n].tl=Math.min(127,e+t)}}writeKeyOn(e){const t=this.channelIndex,n=void 0!==e?Math.floor(15*e):15;switch(this.config.chipType){case Po.OPN2:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(Po.OPN2,40,e),this.chipEngine.write(Po.OPN2,40,n);break}case Po.OPM:this.chipEngine.write(Po.OPM,8,7&t),this.chipEngine.write(Po.OPM,8,120|7&t);break;case Po.NES:if(this.chipEngine.write(Po.NES,16405,31),t<2){const e=16384+4*t,a=Fo.freqToNES(this.activeNoteFreq);this.chipEngine.write(Po.NES,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(Po.NES,e+1,8),this.chipEngine.write(Po.NES,e+2,255&a),this.chipEngine.write(Po.NES,e+3,8|a>>8&7)}else if(2===t){const e=Fo.freqToNES(this.activeNoteFreq);this.chipEngine.write(Po.NES,16392,255),this.chipEngine.write(Po.NES,16394,255&e),this.chipEngine.write(Po.NES,16395,8|e>>8&7)}else 3===t&&(this.chipEngine.write(Po.NES,16396,48|n),this.chipEngine.write(Po.NES,16398,15&this.nesNoiseIndex),this.chipEngine.write(Po.NES,16399,8));break;case Po.GB:{const e=this.gbFreqVal||0;if(t<2){const a=0===t?16:21;this.chipEngine.write(Po.GB,a+1,(3&this.currentDuty)<<6|63),this.chipEngine.write(Po.GB,a+2,n<<4|8),this.chipEngine.write(Po.GB,a+3,2048-e&255),this.chipEngine.write(Po.GB,a+4,2048-e>>8&7|128)}else 2===t?(this.chipEngine.write(Po.GB,26,128),this.chipEngine.write(Po.GB,27,255),this.chipEngine.write(Po.GB,28,32),this.chipEngine.write(Po.GB,29,2048-e&255),this.chipEngine.write(Po.GB,30,2048-e>>8&7|128)):3===t&&(this.chipEngine.write(Po.GB,32,63),this.chipEngine.write(Po.GB,33,n<<4|8),this.chipEngine.write(Po.GB,34,0),this.chipEngine.write(Po.GB,35,128));this.chipEngine.write(Po.GB,38,128);break}case Po.PSG:const e=15-Math.min(15,n);this.chipEngine.write(Po.PSG,0,144|(3&t)<<5|e);break;case Po.PCE:{const e=4095&Math.floor(3579545/(32*this.activeNoteFreq));this.chipEngine.write(Po.PCE,0,7&t),this.chipEngine.write(Po.PCE,4,95),this.chipEngine.write(Po.PCE,4,31);for(let t=0;t<32;t++){const e=t<16?31:0;this.chipEngine.write(Po.PCE,6,e)}this.chipEngine.write(Po.PCE,2,255&e),this.chipEngine.write(Po.PCE,3,e>>8&15),this.chipEngine.write(Po.PCE,5,255),this.chipEngine.write(Po.PCE,4,128|31&n);break}case Po.SNES:{const e=16*(7&t),a=1<<(7&t);this.chipEngine.write(Po.SNES,92,a);const s=16383&Math.floor(4096*this.activeNoteFreq/32e3);this.chipEngine.write(Po.SNES,e+2,255&s),this.chipEngine.write(Po.SNES,e+3,s>>8&63),this.chipEngine.write(Po.SNES,e+5,255),this.chipEngine.write(Po.SNES,e+6,224),this.chipEngine.write(Po.SNES,e+0,8*n),this.chipEngine.write(Po.SNES,e+1,8*n),this.chipEngine.write(Po.SNES,92,0),this.chipEngine.write(Po.SNES,76,a);break}case Po.OPL3:{const e=t%9,n=t<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(Po.OPL3,n|176+e,a),this.chipEngine.write(Po.OPL3,n|176+e,s);break}case Po.OPLL:{const e=t%9,n=(7&this._oplBlock)<<1|this._oplFnum>>8&1,a=16|n;this.chipEngine.write(Po.OPLL,32+e,n),this.chipEngine.write(Po.OPLL,32+e,a);break}case Po.OPNA:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(Po.OPNA,40,e),this.chipEngine.write(Po.OPNA,40,n);break}case Po.OPNB:{const e=[1,2,5,6][3&t];this.chipEngine.write(Po.OPNB,40,e),this.chipEngine.write(Po.OPNB,40,240|e);break}case Po.OPN:{const e=t%3;this.chipEngine.write(Po.OPN,40,e),this.chipEngine.write(Po.OPN,40,240|e);break}case Po.OPZ:{const e=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7,n=64|e;this.chipEngine.write(Po.OPZ,32+(7&t),e),this.chipEngine.write(Po.OPZ,32+(7&t),n);break}case Po.Y8950:case Po.OPL4:{const e=this.config.chipType,n=t%9,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(e,176+n,a),this.chipEngine.write(e,176+n,s);break}case Po.AY:{const e=4095&Math.floor(1789773/(16*this.activeNoteFreq));this.chipEngine.write(Po.AY,2*t,255&e),this.chipEngine.write(Po.AY,2*t+1,e>>8&15),this.chipEngine.write(Po.AY,8+t,15&n);const a=63&~(1<<t);this.chipEngine.write(Po.AY,7,a);break}case Po.SAA:{const e=8e6;let a=4,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));for(;s<0&&a<7;)a++,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));for(;s>255&&a>0;)a--,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-a)));s=Math.max(0,Math.min(255,s)),this.chipEngine.write(Po.SAA,0+t,n<<4|n),this.chipEngine.write(Po.SAA,8+t,s);const r=16+Math.floor(t/2),o=t%2*4;this.chipEngine.write(Po.SAA,r,a<<o|a<<4*(1-t%2)),this.chipEngine.write(Po.SAA,20,1<<t);break}case Po.T6W28:{const e=3072e3,a=3===t?15:16,s=Math.floor(e/(a*this.activeNoteFreq))-1,r=Math.max(0,Math.min(1023,s)),o=15-Math.min(15,n);this.chipEngine.write(Po.T6W28,0,128|(3&t)<<5|15&r),this.chipEngine.write(Po.T6W28,0,r>>4&63),this.chipEngine.write(Po.T6W28,1,128|(3&t)<<5|15&r),this.chipEngine.write(Po.T6W28,1,r>>4&63),this.chipEngine.write(Po.T6W28,0,144|(3&t)<<5|o),this.chipEngine.write(Po.T6W28,1,144|(3&t)<<5|o);break}case Po.VRC6:if(t<2){const e=0===t?36864:40960,a=Math.floor(3579545/(16*this.activeNoteFreq))-1;this.chipEngine.write(Po.VRC6,e,(7&this.currentDuty)<<4|n),this.chipEngine.write(Po.VRC6,e+1,255&a),this.chipEngine.write(Po.VRC6,e+2,128|a>>8&15)}else{const e=Math.floor(3579545/(14*this.activeNoteFreq))-1;this.chipEngine.write(Po.VRC6,45056,63&n),this.chipEngine.write(Po.VRC6,45057,255&e),this.chipEngine.write(Po.VRC6,45058,128|e>>8&15)}break;case Po.N163:{const e=Math.floor(7864320*this.activeNoteFreq/3579545);this.chipEngine.write(Po.N163,120,255&e),this.chipEngine.write(Po.N163,122,e>>8&255),this.chipEngine.write(Po.N163,124,224|e>>16&3),this.chipEngine.write(Po.N163,127,240|n);break}case Po.FDS:{const e=4095&Math.floor(65536*this.activeNoteFreq/1789773);this.chipEngine.write(Po.FDS,16512,128|2*n),this.chipEngine.write(Po.FDS,16514,255&e),this.chipEngine.write(Po.FDS,16515,e>>8&15);break}case Po.MMC5:{const e=0===t?20480:20484,a=Fo.freqToNES(this.activeNoteFreq);this.chipEngine.write(Po.MMC5,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(Po.MMC5,e+2,255&a),this.chipEngine.write(Po.MMC5,e+3,8|a>>8&7);break}case Po.SCC:{const e=Math.floor(3579545/(16*this.activeNoteFreq))-1,a=128;this.chipEngine.write(Po.SCC,a+2*t,255&e),this.chipEngine.write(Po.SCC,a+2*t+1,e>>8&15),this.chipEngine.write(Po.SCC,a+10+t,15&n),this.chipEngine.write(Po.SCC,a+15,1<<t);break}case Po.SWAN:{const e=3072e3,a=2047&Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Po.SWAN,2*t,255&a),this.chipEngine.write(Po.SWAN,2*t+1,a>>8&7),this.chipEngine.write(Po.SWAN,8+t,n<<4|n),this.chipEngine.write(Po.SWAN,16,1<<t),this.chipEngine.write(Po.SWAN,17,15);break}case Po.VERA:{const e=25e6,a=65535&Math.floor(2097152*this.activeNoteFreq/e),s=4*t;this.chipEngine.write(Po.VERA,s+0,255&a),this.chipEngine.write(Po.VERA,s+1,a>>8&255),this.chipEngine.write(Po.VERA,s+2,(63&n)<<2|3),this.chipEngine.write(Po.VERA,s+3,63);break}case Po.SM8521:{const e=756e3,a=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a)),r=[[71,70],[73,72],[77,76]],o=[66,68,74];this.chipEngine.write(Po.SM8521,o[t]||66,31&n),r[t]&&(this.chipEngine.write(Po.SM8521,r[t][0],s>>8&15),this.chipEngine.write(Po.SM8521,r[t][1],255&s)),this.chipEngine.write(Po.SM8521,64,128|1<<t);break}case Po.BUBBLE:{const e=3579545,a=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a));this.chipEngine.write(Po.BUBBLE,1&t,255&s),this.chipEngine.write(Po.BUBBLE,2+(1&t),15&n);break}case Po.X1_010:{const e=4194304,a=65535&Math.floor(this.activeNoteFreq*e/1e6),s=t<<3;this.chipEngine.write(Po.X1_010,s+2,255&a),this.chipEngine.write(Po.X1_010,s+3,a>>8&255),this.chipEngine.write(Po.X1_010,s+1,n<<4),this.chipEngine.write(Po.X1_010,s,3);break}case Po.VB:{const e=5e6,a=Math.floor(2048-e/(16*this.activeNoteFreq)),s=Math.max(0,Math.min(2047,a)),r=1024+64*t;this.chipEngine.write(Po.VB,r+8,2047-s&255),this.chipEngine.write(Po.VB,r+12,2047-s>>8&7),this.chipEngine.write(Po.VB,r+4,255),this.chipEngine.write(Po.VB,r+16,(15&n)<<4),this.chipEngine.write(Po.VB,r+20,0),this.chipEngine.write(Po.VB,r+0,128);break}case Po.LYNX:{const e=16e6,a=Math.floor(e/(256*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,a)),r=32+8*t;this.chipEngine.write(Po.LYNX,r+0,n<<4|n),this.chipEngine.write(Po.LYNX,r+1,1),this.chipEngine.write(Po.LYNX,r+4,s),this.chipEngine.write(Po.LYNX,r+5,128),this.chipEngine.write(Po.LYNX,80,255);break}case Po.SID:{const e=t*64;this.chipEngine.write(Po.SID,e+0,1);break}case Po.SID_6581:case Po.SID_8580:{const e=7*t,n=45===this.config.chipType?Po.SID_6581:Po.SID_8580,a=0,s=8,r=15,o=8,i=64,l=1,c=2048;this.chipEngine.write(n,e+2,255&c),this.chipEngine.write(n,e+3,c>>8&15),this.chipEngine.write(n,e+5,a<<4|s),this.chipEngine.write(n,e+6,r<<4|o),this.chipEngine.write(n,e+4,i|l);break}case Po.TIA:{const e=31440,a=Math.floor(e/(32*this.activeNoteFreq))-1,s=Math.max(0,Math.min(31,a)),r=0===t?21:22;this.chipEngine.write(Po.TIA,r,4),this.chipEngine.write(Po.TIA,r+2,31&s),this.chipEngine.write(Po.TIA,r+4,15&n);break}case Po.VIC:{const e=1022727;let a=Math.floor(256-e/(32*this.activeNoteFreq));a>>=t<3?2-t:1;const s=Math.max(0,Math.min(127,a));this.chipEngine.write(Po.VIC,10+t,255-s),this.chipEngine.write(Po.VIC,14,15&n);break}case Po.TED:{const e=1773447,a=Math.floor(1024-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(1023,a));0===t?(this.chipEngine.write(Po.TED,14,1022-s&255),this.chipEngine.write(Po.TED,18,1022-s>>8&3)):(this.chipEngine.write(Po.TED,15,1022-s&255),this.chipEngine.write(Po.TED,16,1022-s>>8&3));const r=15&n|(0===t?16:32);this.chipEngine.write(Po.TED,17,r);break}case Po.SUPERVISION:{const e=4e6;if(t<2){const n=Math.floor(2*e/(32*this.activeNoteFreq)),a=Math.max(1,Math.min(2047,n)),s=16+4*t;this.chipEngine.write(Po.SUPERVISION,s,255&a),this.chipEngine.write(Po.SUPERVISION,s+1,a>>8&7);const r=30|(3&this.currentDuty)<<4;this.chipEngine.write(Po.SUPERVISION,s+2,r),this.chipEngine.write(Po.SUPERVISION,s+3,255)}else if(3===t){const e=15-(15&Math.floor(12*Math.log2(this.activeNoteFreq/440)+69))<<4|15&n;this.chipEngine.write(Po.SUPERVISION,40,e),this.chipEngine.write(Po.SUPERVISION,41,200),this.chipEngine.write(Po.SUPERVISION,42,30)}break}case Po.UPD1771:this.chipEngine.write(Po.UPD1771,0,2);break;case Po.OKI:this.chipEngine.write(Po.OKI,t,128|n<<3);break;case Po.SEGAPCM:{const e=8*t;this.chipEngine.write(Po.SEGAPCM,e+134,255),this.chipEngine.write(Po.SEGAPCM,e+2,n<<3),this.chipEngine.write(Po.SEGAPCM,e+3,n<<3);break}case Po.YMZ280B:{const e=4*t;this.chipEngine.write(Po.YMZ280B,1+e,192|n<<1);break}case Po.RF5C68:this.chipEngine.write(Po.RF5C68,7,t),this.chipEngine.write(Po.RF5C68,8,255&~(1<<t));break;case Po.GA20:this.chipEngine.write(Po.GA20,0+8*t+5,0);break;case Po.C140:{const e=16*t;this.chipEngine.write(Po.C140,e+5,96);break}case Po.QSOUND:this.chipEngine.write(Po.QSOUND,8*t+6,n<<4);break;case Po.K007232:this.chipEngine.write(Po.K007232,6*t+0,128);break;case Po.K053260:this.chipEngine.write(Po.K053260,40,1<<t);break;case Po.ES5506:break;case Po.OPN:{const e=t%3;this.chipEngine.write(Po.OPN,40,e),this.chipEngine.write(Po.OPN,40,240|e);break}case Po.OPNB_B:{const e=[1,2,5,6,0,4][t%6];this.chipEngine.write(Po.OPNB_B,40,e),this.chipEngine.write(Po.OPNB_B,40,240|e);break}case Po.ESFM:{const e=t%18,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|a;this.chipEngine.write(Po.ESFM,n|176+e%9,a),this.chipEngine.write(Po.ESFM,n|176+e%9,s);break}case Po.AY8930:{const e=1789773,a=65535&Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Po.AY8930,2*t,255&a),this.chipEngine.write(Po.AY8930,2*t+1,a>>8&255),this.chipEngine.write(Po.AY8930,8+t,31&n),this.chipEngine.write(Po.AY8930,7,63&~(1<<t)),this.chipEngine.write(Po.AY8930,22+t,8);break}case Po.NDS:{const e=16*t,a=65535&Math.floor(65536*this.activeNoteFreq/32768);this.chipEngine.write(Po.NDS,e+8,255&a),this.chipEngine.write(Po.NDS,e+9,a>>8&255),this.chipEngine.write(Po.NDS,e+3,128|n<<1);break}case Po.GBA_DMA:this.chipEngine.write(Po.GBA_DMA,130,11);break;case Po.GBA_MINMOD:this.chipEngine.write(Po.GBA_MINMOD,0,128|n);break;case Po.POKEMINI:{const e=4e6,t=Math.floor(e/(16*this.activeNoteFreq)),a=Math.max(1,Math.min(65535,t));this.chipEngine.write(Po.POKEMINI,74,255&a),this.chipEngine.write(Po.POKEMINI,75,a>>8&255),this.chipEngine.write(Po.POKEMINI,76,a>>1&255),this.chipEngine.write(Po.POKEMINI,77,a>>1>>8&255),this.chipEngine.write(Po.POKEMINI,72,4),this.chipEngine.write(Po.POKEMINI,113,n>8?3:n>4?2:1);break}case Po.NAMCO:{const e=4194304,a=1048575&Math.floor(this.activeNoteFreq*e/192e3);if(0===t)this.chipEngine.write(Po.NAMCO,16,a>>4&15),this.chipEngine.write(Po.NAMCO,17,15&a),this.chipEngine.write(Po.NAMCO,18,a>>8&15),this.chipEngine.write(Po.NAMCO,19,a>>12&15),this.chipEngine.write(Po.NAMCO,20,a>>16&15);else{const e=21+5*(t-1);this.chipEngine.write(Po.NAMCO,e+1,15&a),this.chipEngine.write(Po.NAMCO,e+2,a>>8&15),this.chipEngine.write(Po.NAMCO,e+3,a>>12&15),this.chipEngine.write(Po.NAMCO,e+4,a>>16&15)}this.chipEngine.write(Po.NAMCO,21+5*t,15&n),this.chipEngine.write(Po.NAMCO,5+5*t,0);break}case Po.PET:{const e=1e6,t=Math.floor(e/(16*this.activeNoteFreq))-1,n=Math.max(0,Math.min(65535,t));this.chipEngine.write(Po.PET,8,255&n),this.chipEngine.write(Po.PET,9,n>>8&255),this.chipEngine.write(Po.PET,11,16);break}case Po.POKEY:{const e=1789773,a=Math.floor(e/(2*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,a));this.chipEngine.write(Po.POKEY,2*t,s),this.chipEngine.write(Po.POKEY,2*t+1,160|15&n),this.chipEngine.write(Po.POKEY,8,0),this.chipEngine.write(Po.POKEY,15,3);break}case Po.MSM6258:this.chipEngine.write(Po.MSM6258,0,2);break;case Po.MSM5232:this.chipEngine.write(Po.MSM5232,t,128|n);break;case Po.MULTIPCM:{const e=t<<3;this.chipEngine.write(Po.MULTIPCM,e+4,128),this.chipEngine.write(Po.MULTIPCM,e+5,15-n<<3);break}case Po.AMIGA:{const e=3546895,a=Math.floor(e/(2*this.activeNoteFreq)),s=Math.max(124,Math.min(65535,a)),r=160+16*t;this.chipEngine.write(Po.AMIGA,r+6,s>>8&255),this.chipEngine.write(Po.AMIGA,r+7,255&s),this.chipEngine.write(Po.AMIGA,r+8,4*n&127),this.chipEngine.write(Po.AMIGA,150,32768|1<<t);break}case Po.PCSPKR:{const e=1193182,t=Math.floor(e/this.activeNoteFreq),n=Math.max(1,Math.min(65535,t));this.chipEngine.write(Po.PCSPKR,0,255&n),this.chipEngine.write(Po.PCSPKR,1,n>>8&255);break}case Po.PONG:this.chipEngine.write(Po.PONG,0,1);break;case Po.PV1000:{const e=3579545,n=Math.floor(63-e/(1024*this.activeNoteFreq)),a=Math.max(0,Math.min(62,n));this.chipEngine.write(Po.PV1000,t,a);break}case Po.DAVE:{const e=8e6,a=Math.floor(4096-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,a));this.chipEngine.write(Po.DAVE,2*t,255&s),this.chipEngine.write(Po.DAVE,2*t+1,s>>8&15),this.chipEngine.write(Po.DAVE,8+t,n<<2&63),this.chipEngine.write(Po.DAVE,12+t,n<<2&63),this.chipEngine.write(Po.DAVE,7,15);break}case Po.SU:{const e=t<<3;this.chipEngine.write(Po.SU,e+4,128|n);break}case Po.BIFURCATOR:this.chipEngine.write(Po.BIFURCATOR,t,n);break;case Po.POWERNOISE:{const e=t<<2;this.chipEngine.write(Po.POWERNOISE,e+0,128|n);break}case Po.ZXBEEPER:{const e=35e5,t=Math.floor(e/(2*this.activeNoteFreq));this.chipEngine.write(Po.ZXBEEPER,0,255&t),this.chipEngine.write(Po.ZXBEEPER,1,t>>8&255);break}case Po.ZXBEEPER_QT:{const e=35e5,n=Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(Po.ZXBEEPER_QT,2*t,255&n),this.chipEngine.write(Po.ZXBEEPER_QT,2*t+1,n>>8&255);break}case Po.SCVTONE:{const e=3579545,a=Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(Po.SCVTONE,2*t,255&a),this.chipEngine.write(Po.SCVTONE,2*t+1,a>>8&15|n<<4);break}case Po.PCMDAC:this.chipEngine.write(Po.PCMDAC,0,128|n)}}triggerRelease(e){if(this.isNoteOn=!1,!this.useWasmEngine)return this;const t=is()-this.noteOnTime;if(t<Bo.MIN_GATE_TIME){setTimeout(()=>this.writeKeyOff(),1e3*(Bo.MIN_GATE_TIME-t))}else this.writeKeyOff();return this}writeKeyOff(){if(!this.wasmNoteTriggered)return;this.wasmNoteTriggered=!1;const e=this.channelIndex;switch(this.config.chipType){case Po.OPN2:{const t=e%3,n=e<3?0:1,a=0===n?0:256,s=n<<2|t;this.chipEngine.write(Po.OPN2,40,s);const r=[0,8,4,12];for(let e=0;e<4;e++){const n=r[e]+t;this.chipEngine.write(Po.OPN2,a|64+n,127)}this.chipEngine.deactivate(Po.OPN2);break}case Po.OPM:{const t=7&e;this.chipEngine.write(Po.OPM,8,t);const n=[0,16,8,24];for(let a=0;a<4;a++){const t=n[a]+(7&e);this.chipEngine.write(Po.OPM,96+t,127)}this.chipEngine.deactivate(Po.OPM);break}case Po.OPL3:{const t=e%9,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Po.OPL3,n|176+t,a);break}case Po.OPLL:{const t=e%9,n=3579545;let a=0,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-a)/n);for(;s>511&&a<7;)a++,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-a)/n);s=Math.min(511,Math.max(0,s));const r=(7&a)<<1|s>>8&1;this.chipEngine.write(Po.OPLL,32+t,r);break}case Po.OPNA:{const t=(e<3?0:1)<<2|e%3;this.chipEngine.write(Po.OPNA,40,t);break}case Po.OPNB:{const t=[1,2,5,6][3&e];this.chipEngine.write(Po.OPNB,40,t);break}case Po.OPN:{const t=e%3;this.chipEngine.write(Po.OPN,40,t);break}case Po.OPZ:{const t=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7;this.chipEngine.write(Po.OPZ,32+(7&e),t),this.chipEngine.deactivate(Po.OPZ);break}case Po.Y8950:case Po.OPL4:{const t=this.config.chipType,n=e%9,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(t,176+n,a);break}case Po.PSG:this.chipEngine.write(Po.PSG,0,159|(3&e)<<5);break;case Po.AY:this.chipEngine.write(Po.AY,8+e,0);break;case Po.SAA:this.chipEngine.write(Po.SAA,0+e,0),this.chipEngine.write(Po.SAA,20,0);break;case Po.T6W28:this.chipEngine.write(Po.T6W28,0,159|(3&e)<<5),this.chipEngine.write(Po.T6W28,1,159|(3&e)<<5);break;case Po.NES:if(e<2){const t=16384+4*e;this.chipEngine.write(Po.NES,t,48)}else 2===e?this.chipEngine.write(Po.NES,16392,0):3===e&&this.chipEngine.write(Po.NES,16396,48);break;case Po.GB:{const t=16+5*e;e<2?this.chipEngine.write(Po.GB,t+2,8):2===e?this.chipEngine.write(Po.GB,28,0):3===e&&this.chipEngine.write(Po.GB,33,8);break}case Po.PCE:this.chipEngine.write(Po.PCE,0,7&e),this.chipEngine.write(Po.PCE,5,0);break;case Po.SNES:this.chipEngine.write(Po.SNES,92,1<<(7&e));break;case Po.VB:{const t=1024+64*e;this.chipEngine.write(Po.VB,t+16,0);break}case Po.LYNX:{const t=32+8*e;this.chipEngine.write(Po.LYNX,t+0,0);break}case Po.VRC6:if(e<2){const t=0===e?36864:40960;this.chipEngine.write(Po.VRC6,t,0)}else this.chipEngine.write(Po.VRC6,45056,0);break;case Po.N163:this.chipEngine.write(Po.N163,127,0);break;case Po.FDS:this.chipEngine.write(Po.FDS,16512,128);break;case Po.MMC5:{const t=0===e?20480:20484;this.chipEngine.write(Po.MMC5,t,48);break}case Po.SCC:this.chipEngine.write(Po.SCC,170+e,0);break;case Po.SWAN:this.chipEngine.write(Po.SWAN,8+e,0);break;case Po.VERA:{const t=4*e;this.chipEngine.write(Po.VERA,t+2,0);break}case Po.SM8521:{const t=[66,68,74][e]||66;this.chipEngine.write(Po.SM8521,t,0);break}case Po.BUBBLE:this.chipEngine.write(Po.BUBBLE,2+e,0);break;case Po.X1_010:{const t=e<<3;this.chipEngine.write(Po.X1_010,t,0);break}case Po.SID:{const t=0,n=e*64;this.chipEngine.write(Po.SID,n+t,0);break}case Po.SID_6581:case Po.SID_8580:{const t=7*e,n=45===this.config.chipType?Po.SID_6581:Po.SID_8580;this.chipEngine.write(n,t+4,0);break}case Po.TIA:this.chipEngine.write(Po.TIA,25+e,0);break;case Po.VIC:this.chipEngine.write(Po.VIC,10+e,0);break;case Po.TED:this.chipEngine.write(Po.TED,17,0);break;case Po.SUPERVISION:{const t=16+4*e;this.chipEngine.write(Po.SUPERVISION,t+2,0);break}case Po.UPD1771:this.chipEngine.write(Po.UPD1771,0,0);break;case Po.YMZ280B:{const t=4*e;this.chipEngine.write(Po.YMZ280B,1+t,64);break}case Po.RF5C68:this.chipEngine.write(Po.RF5C68,8,255);break;case Po.GA20:{const t=8*e;this.chipEngine.write(Po.GA20,t+5,0),this.chipEngine.write(Po.GA20,t+6,0);break}case Po.SEGAPCM:{const t=8*(15&e);this.chipEngine.write(Po.SEGAPCM,134+t,0);break}case Po.K007232:this.chipEngine.write(Po.K007232,12,0);break;case Po.K053260:this.chipEngine.write(Po.K053260,40,0);break;case Po.QSOUND:{const t=e%16,n=t<8?6+8*t:70+8*(t-8);this.chipEngine.write(Po.QSOUND,0,0),this.chipEngine.write(Po.QSOUND,1,0),this.chipEngine.write(Po.QSOUND,2,n);break}case Po.C140:{const t=16*(e%24);this.chipEngine.write(Po.C140,t+5,0);break}case Po.ES5506:case Po.OKI:break;case Po.OPN:{const t=e%3;this.chipEngine.write(Po.OPN,40,t);break}case Po.OPNB_B:{const t=[1,2,5,6][3&e];this.chipEngine.write(Po.OPNB_B,40,t);break}case Po.ESFM:{const t=e%9,n=e<9?0:256,a=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(Po.ESFM,n|176+t,a);break}case Po.AY8930:this.chipEngine.write(Po.AY8930,8+e,0);break;case Po.NDS:{const t=16*e;this.chipEngine.write(Po.NDS,t+3,0);break}case Po.GBA_DMA:this.chipEngine.write(Po.GBA_DMA,132,0);break;case Po.GBA_MINMOD:this.chipEngine.write(Po.GBA_MINMOD,132,0);break;case Po.POKEMINI:this.chipEngine.write(Po.POKEMINI,113,0);break;case Po.NAMCO:{const t=8*e;this.chipEngine.write(Po.NAMCO,21+t,0);break}case Po.PET:this.chipEngine.write(Po.PET,0,0);break;case Po.POKEY:this.chipEngine.write(Po.POKEY,2*e+1,0);break;case Po.MSM6258:this.chipEngine.write(Po.MSM6258,0,1);break;case Po.MSM5232:{const t=10+e;this.chipEngine.write(Po.MSM5232,t,0);break}case Po.MULTIPCM:{const t=8*e;this.chipEngine.write(Po.MULTIPCM,t+5,0);break}case Po.AMIGA:this.chipEngine.write(Po.AMIGA,150,1<<e);break;case Po.PCSPKR:this.chipEngine.write(Po.PCSPKR,97,0);break;case Po.PONG:break;case Po.PV1000:this.chipEngine.write(Po.PV1000,252+e,0);break;case Po.DAVE:{const t=8+3*e+2;this.chipEngine.write(Po.DAVE,t,0);break}case Po.SU:{const t=e<<5;this.chipEngine.write(Po.SU,t+2,0);break}case Po.BIFURCATOR:break;case Po.POWERNOISE:{const t=4*e;this.chipEngine.write(Po.POWERNOISE,t,0);break}case Po.ZXBEEPER:case Po.ZXBEEPER_QT:break;case Po.SCVTONE:this.chipEngine.write(Po.SCVTONE,e,0);break;case Po.PCMDAC:this.chipEngine.write(Po.PCMDAC,0,128)}}dispose(){this.output.disconnect()}}function Vo(e){switch(e){case Wo.GENESIS:case Wo.GENESIS_EXT:case Wo.YM2151:case Wo.YM2612:case Wo.YM2203:case Wo.YM2203_EXT:case Wo.YM2608:case Wo.YM2608_EXT:case Wo.YM2610:case Wo.YM2610_EXT:case Wo.YM2610B:case Wo.YM2610B_EXT:case Wo.ARCADE:case Wo.TX81Z:case Wo.OPL:case Wo.OPL2:case Wo.OPL3:case Wo.OPL4:case Wo.OPLL:case Wo.VRC7:case Wo.ESFM:return"fm";case Wo.AY8910:case Wo.AY8930:case Wo.SMS:case Wo.SAA1099:case Wo.T6W28:return"psg";case Wo.C64_6581:case Wo.C64_8580:case Wo.SID2:case Wo.SID3:return"c64";case Wo.SNES:return"snes";case Wo.GB:return"gb";case Wo.NES:case Wo.NES_VRC7:case Wo.NES_FDS:case Wo.VRC6:case Wo.MMC5:case Wo.FDS:return"nes";case Wo.PCE:return"pce";case Wo.NAMCO:case Wo.NAMCO_15XX:case Wo.NAMCO_CUS30:case Wo.N163:return"namco";case Wo.AMIGA:case Wo.SEGAPCM:case Wo.QSOUND:case Wo.MULTIPCM:case Wo.RF5C68:case Wo.MSM6295:case Wo.MSM6258:case Wo.YMZ280B:case Wo.K007232:case Wo.K053260:case Wo.GA20:case Wo.C140:case Wo.ES5506:return"sample";default:return"other"}}class zo{platformType;family;effectMemory=new Map;constructor(e=Wo.GB){this.platformType=e,this.family=Vo(e)}setPlatform(e){this.platformType=e,this.family=Vo(e)}getMemory(e,t){const n=this.effectMemory.get(e);return n?n.get(t)??0:0}setMemory(e,t,n){this.effectMemory.has(e)||this.effectMemory.set(e,new Map),this.effectMemory.get(e).set(t,n)}resetMemory(){this.effectMemory.clear()}routeEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];0===a?a=this.getMemory(t,n):this.setMemory(t,n,a);const r=a>>4&15,o=15&a;switch(n){case 0:0!==a&&s.push({cmd:Ho.NOTE_PORTA,chan:t,val1:r,val2:o});break;case 1:s.push({cmd:Ho.PITCH,chan:t,val1:a,val2:0});break;case 2:s.push({cmd:Ho.PITCH,chan:t,val1:-a,val2:0});break;case 3:s.push({cmd:Ho.NOTE_PORTA,chan:t,val1:a,val2:1});break;case 4:s.push({cmd:Ho.HINT_VIBRATO,chan:t,val1:r,val2:o});break;case 7:s.push({cmd:Ho.HINT_TREMOLO,chan:t,val1:r,val2:o});break;case 8:s.push({cmd:Ho.PANNING,chan:t,val1:a,val2:a});break;case 10:s.push({cmd:Ho.HINT_VOL_SLIDE,chan:t,val1:r,val2:o});break;case 12:s.push({cmd:Ho.VOLUME,chan:t,val1:a,val2:0});break;case 14:s.push(...this.routeExtendedEffect(this.platformType,t,r,o));break;default:s.push(...this.routePlatformEffect(this.platformType,t,n,a))}return s}routeExtendedEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];switch(n){case 1:s.push({cmd:Ho.PITCH,chan:t,val1:a,val2:0});break;case 2:s.push({cmd:Ho.PITCH,chan:t,val1:-a,val2:0});break;case 3:s.push({cmd:Ho.LEGATO,chan:t,val1:a,val2:0});break;case 4:s.push({cmd:Ho.HINT_VIBRATO_SHAPE,chan:t,val1:a,val2:0});break;case 5:s.push({cmd:Ho.PITCH,chan:t,val1:a-8,val2:1});break;case 9:s.push({cmd:Ho.NOTE_ON,chan:t,val1:-1,val2:a});break;case 10:s.push({cmd:Ho.HINT_VOL_SLIDE,chan:t,val1:a,val2:0});break;case 11:s.push({cmd:Ho.HINT_VOL_SLIDE,chan:t,val1:0,val2:a});break;case 12:s.push({cmd:Ho.NOTE_OFF,chan:t,val1:a,val2:0});break;case 13:s.push({cmd:Ho.PRE_NOTE,chan:t,val1:a,val2:0});break;case 15:s.push({cmd:Ho.MACRO_ON,chan:t,val1:a,val2:0})}return s.push(...this.routePlatformExtendedEffect(this.platformType,t,n,a)),s}routePlatformEffect(e,t,n,a){e!==this.platformType&&this.setPlatform(e);const s=[];switch(this.family){case"fm":s.push(...this.routeFMEffect(t,n,a));break;case"c64":s.push(...this.routeC64Effect(t,n,a));break;case"snes":s.push(...this.routeSNESEffect(t,n,a));break;case"gb":s.push(...this.routeGBEffect(t,n,a));break;case"nes":s.push(...this.routeNESEffect(t,n,a));break;case"pce":s.push(...this.routePCEEffect(t,n,a));break;case"psg":s.push(...this.routePSGEffect(t,n,a));break;case"namco":s.push(...this.routeNamcoEffect(t,n,a));break;case"sample":s.push(...this.routeSampleEffect(t,n,a))}return s}routePlatformExtendedEffect(e,t,n,a){const s=[];switch(e!==this.platformType&&this.setPlatform(e),this.family){case"gb":6===n&&s.push({cmd:Ho.GB_SWEEP_TIME,chan:t,val1:a,val2:0});break;case"nes":6===n&&s.push({cmd:Ho.NES_SWEEP,chan:t,val1:a,val2:0});break;case"c64":6===n&&s.push({cmd:Ho.C64_FILTER_MODE,chan:t,val1:a,val2:0})}return s}routeFMEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:Ho.FM_LFO,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.FM_TL,chan:e,val1:s,val2:8*r});break;case 18:a.push({cmd:Ho.FM_AR,chan:e,val1:s,val2:2*r});break;case 19:a.push({cmd:Ho.FM_DR,chan:e,val1:s,val2:2*r});break;case 20:a.push({cmd:Ho.FM_MULT,chan:e,val1:s,val2:r});break;case 21:a.push({cmd:Ho.FM_RR,chan:e,val1:s,val2:r});break;case 22:a.push({cmd:Ho.FM_SL,chan:e,val1:s,val2:r});break;case 23:a.push({cmd:Ho.FM_DT,chan:e,val1:s,val2:r});break;case 24:a.push({cmd:Ho.FM_FB,chan:e,val1:n>>4,val2:0});break;case 25:a.push({cmd:Ho.FM_FB,chan:e,val1:0,val2:7&n});break;case 26:a.push({cmd:Ho.FM_SSG,chan:e,val1:s,val2:r});break;case 27:a.push({cmd:Ho.FM_AM_DEPTH,chan:e,val1:s,val2:0}),a.push({cmd:Ho.FM_PM_DEPTH,chan:e,val1:r,val2:0});break;case 31:a.push({cmd:Ho.FM_HARD_RESET,chan:e,val1:n,val2:0})}return a}routeC64Effect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.C64_CUTOFF,chan:e,val1:8*n,val2:0});break;case 17:a.push({cmd:Ho.C64_FINE_CUTOFF,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.C64_RESONANCE,chan:e,val1:15&n,val2:0});break;case 19:a.push({cmd:Ho.C64_FILTER_MODE,chan:e,val1:7&n,val2:0});break;case 20:a.push({cmd:Ho.C64_EXTENDED,chan:e,val1:0,val2:n});break;case 21:a.push({cmd:Ho.C64_EXTENDED,chan:e,val1:1,val2:n});break;case 22:a.push({cmd:Ho.C64_DUTY_RESET,chan:e,val1:16*n,val2:0});break;case 23:a.push({cmd:Ho.C64_FINE_DUTY,chan:e,val1:n,val2:0})}return a}routeSNESEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.SNES_ECHO,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.SNES_ECHO_DELAY,chan:e,val1:15&n,val2:0});break;case 18:a.push({cmd:Ho.SNES_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:Ho.SNES_ECHO_VOL_LEFT,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:Ho.SNES_ECHO_VOL_RIGHT,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:Ho.SNES_ECHO_FIR,chan:e,val1:n,val2:0});break;case 22:a.push({cmd:Ho.SNES_PITCH_MOD,chan:e,val1:n,val2:0});break;case 23:a.push({cmd:Ho.SNES_GAIN_MODE,chan:e,val1:n,val2:0});break;case 24:a.push({cmd:Ho.SNES_GAIN,chan:e,val1:n,val2:0});break;case 25:a.push({cmd:Ho.SNES_INVERT,chan:e,val1:n,val2:0})}return a}routeGBEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:Ho.GB_SWEEP_TIME,chan:e,val1:s,val2:0}),a.push({cmd:Ho.GB_SWEEP_DIR,chan:e,val1:r>>3,val2:0});break;case 17:a.push({cmd:Ho.WAVE,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.STD_NOISE_MODE,chan:e,val1:n,val2:0})}return a}routeNESEffect(e,t,n){const a=[],s=n>>4&15,r=15&n;switch(t){case 16:a.push({cmd:Ho.NES_SWEEP,chan:e,val1:s,val2:r});break;case 17:a.push({cmd:Ho.NES_DMC,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.NES_ENV_MODE,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:Ho.NES_LENGTH,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:Ho.FDS_MOD_DEPTH,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:Ho.FDS_MOD_HIGH,chan:e,val1:n,val2:0});break;case 22:a.push({cmd:Ho.FDS_MOD_LOW,chan:e,val1:n,val2:0})}return a}routePCEEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.PCE_LFO_MODE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.PCE_LFO_SPEED,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.WAVE,chan:e,val1:n,val2:0})}return a}routePSGEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.AY_ENVELOPE_SET,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.AY_ENVELOPE_LOW,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.AY_ENVELOPE_HIGH,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:Ho.AY_AUTO_ENVELOPE,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:Ho.STD_NOISE_FREQ,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:Ho.STD_NOISE_MODE,chan:e,val1:n,val2:0})}return a}routeNamcoEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.WAVE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.N163_WAVE_POSITION,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.N163_WAVE_LENGTH,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:Ho.N163_WAVE_LOADPOS,chan:e,val1:n,val2:0});break;case 20:a.push({cmd:Ho.N163_CHANNEL_LIMIT,chan:e,val1:n,val2:0})}return a}routeSampleEffect(e,t,n){const a=[];switch(t){case 16:a.push({cmd:Ho.SAMPLE_MODE,chan:e,val1:n,val2:0});break;case 17:a.push({cmd:Ho.SAMPLE_BANK,chan:e,val1:n,val2:0});break;case 18:a.push({cmd:Ho.SAMPLE_DIR,chan:e,val1:n,val2:0});break;case 19:a.push({cmd:Ho.SAMPLE_POS,chan:e,val1:n<<8,val2:0});break;case 20:a.push({cmd:Ho.ES5506_FILTER_MODE,chan:e,val1:n,val2:0});break;case 21:a.push({cmd:Ho.ES5506_FILTER_K1,chan:e,val1:n<<8,val2:65280});break;case 22:a.push({cmd:Ho.ES5506_FILTER_K2,chan:e,val1:n<<8,val2:65280});break;case 23:a.push({cmd:Ho.QSOUND_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 24:a.push({cmd:Ho.QSOUND_ECHO_LEVEL,chan:e,val1:n,val2:0});break;case 25:a.push({cmd:Ho.QSOUND_SURROUND,chan:e,val1:n,val2:0})}return a}clearMemory(){this.effectMemory.clear()}clearChannelMemory(e){this.effectMemory.delete(e)}}let Uo=null;function Go(){return Uo||(Uo=new zo),Uo}new Proxy({},{get:(e,t)=>Go()[t],set:(e,t,n)=>(Go()[t]=n,!0)});const Wo={GENESIS:2,GENESIS_EXT:3,ARCADE:13,NES_VRC7:9,NES_FDS:10,SMS:4,GB:6,PCE:7,NES:8,SNES:26,SWAN:43,LYNX:60,VBOY:47,NDS:103,POKEMINI:45,TIA:21,POKEY:41,C64_6581:11,C64_8580:12,PET:25,VIC20:24,TED:97,FDS:29,MMC5:30,N163:31,VRC6:27,VRC7:48,AY:17,AY8910:17,AY8930:23,SAA1099:22,T6W28:83,YM2612:20,YM2151:19,TX81Z:44,YM2203:32,YM2203_EXT:33,YM2608:34,YM2608_EXT:35,YM2610:57,YM2610_EXT:58,YM2610B:49,YM2610B_EXT:63,OPL:36,OPL2:37,OPL3:38,OPL4:67,OPLL:28,ESFM:100,AMIGA:18,SEGAPCM:46,SEGAPCM_COMPAT:64,MULTIPCM:39,QSOUND:61,RF5C68:42,PCM_DAC:86,ES5506:69,K007232:84,K053260:96,GA20:85,C140:98,C219:99,YMZ280B:76,MSM6258:75,MSM6295:74,SCC:53,SCC_PLUS:72,NAMCO:77,NAMCO_15XX:78,NAMCO_CUS30:79,BUBSYS_WSG:66,X1_010:65,VERA:62,SOUND_UNIT:73,PCSPKR:40,PONG:87,PV1000:95,MSM5232:82,SM8521:94,DAVE:102,POWERNOISE:101,SFX_BEEPER:50,GBA_DMA:104,GBA_MINMOD:105,SID2:108,SID3:111,SUPERVISION:109,UPD1771C:110},Ko=10,Ho={NOTE_ON:0,NOTE_OFF:1,INSTRUMENT:4,VOLUME:5,NOTE_PORTA:8,PITCH:9,PANNING:10,LEGATO:11,PRE_NOTE:13,HINT_VIBRATO:14,HINT_VIBRATO_SHAPE:16,HINT_VOL_SLIDE:20,HINT_TREMOLO:24,SAMPLE_MODE:28,SAMPLE_BANK:30,SAMPLE_POS:31,SAMPLE_DIR:32,FM_HARD_RESET:33,FM_LFO:34,FM_TL:36,FM_AR:38,FM_DR:39,FM_SL:40,FM_RR:42,FM_DT:43,FM_SSG:50,FM_FB:53,FM_MULT:54,FM_AM_DEPTH:58,FM_PM_DEPTH:59,STD_NOISE_FREQ:62,STD_NOISE_MODE:63,WAVE:64,GB_SWEEP_TIME:65,GB_SWEEP_DIR:66,PCE_LFO_MODE:67,PCE_LFO_SPEED:68,NES_SWEEP:69,NES_DMC:70,C64_CUTOFF:71,C64_RESONANCE:72,C64_FILTER_MODE:73,C64_DUTY_RESET:77,C64_EXTENDED:78,C64_FINE_DUTY:79,C64_FINE_CUTOFF:80,AY_ENVELOPE_SET:81,AY_ENVELOPE_LOW:82,AY_ENVELOPE_HIGH:83,AY_AUTO_ENVELOPE:87,FDS_MOD_DEPTH:90,FDS_MOD_HIGH:91,FDS_MOD_LOW:92,QSOUND_ECHO_FEEDBACK:100,QSOUND_ECHO_LEVEL:102,QSOUND_SURROUND:103,N163_WAVE_POSITION:113,N163_WAVE_LENGTH:114,N163_WAVE_LOADPOS:117,N163_CHANNEL_LIMIT:120,SNES_ECHO:132,SNES_PITCH_MOD:133,SNES_INVERT:134,SNES_GAIN_MODE:135,SNES_GAIN:136,SNES_ECHO_DELAY:138,SNES_ECHO_VOL_LEFT:139,SNES_ECHO_VOL_RIGHT:140,SNES_ECHO_FEEDBACK:141,SNES_ECHO_FIR:142,NES_ENV_MODE:143,NES_LENGTH:144,MACRO_ON:147,ES5506_FILTER_MODE:151,ES5506_FILTER_K1:152,ES5506_FILTER_K2:153},$o=1;class qo{static instance=null;workletNode=null;_nativeCtx=null;initialized=!1;initializing=!1;chips=new Map;_audioRouted=!1;_sharedGain=null;_wasmReadyResolve=null;_wasmReadyReject=null;_wasmReadyPromise=null;_chipCreatedResolve=null;_chipCreatedPromise=null;oscCallbacks=new Set;latestOscData=[];static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;effectRouter=new zo;constructor(){}static getInstance(){return qo.instance||(qo.instance=new qo),qo.instance}get isInitialized(){return this.initialized}getChannelCount(e){return void 0!==e?this.chips.get(e)?.numChannels??0:this.chips.values().next().value?.numChannels??0}get channelCount(){return this.getChannelCount()}get platform(){return this.chips.keys().next().value??0}get handle(){return this.chips.values().next().value?.handle??0}hasChip(e){return this.chips.has(e)}get audioRouted(){return this._audioRouted}getOrCreateSharedGain(){if(this._sharedGain)return this._sharedGain;const e=this.getWorkletNode(),t=this.getNativeCtx();return e&&t?(this._sharedGain=t.createGain(),e.connect(this._sharedGain),this._sharedGain.connect(t.destination),this._audioRouted=!0,this._sharedGain):null}async init(e){if(!this.initialized&&!this.initializing){this.initializing=!0;try{const a=es(e);if(!a)throw new Error("Could not get native AudioContext");if(this._nativeCtx=a,"running"!==a.state)try{await a.resume()}catch(t){throw new Error(`AudioContext not running (state: ${a.state})`)}if("running"!==a.state)throw new Error(`AudioContext still not running after resume (state: ${a.state})`);await qo.ensureModuleLoaded(a);try{this.workletNode=new AudioWorkletNode(a,"furnace-dispatch-processor",{outputChannelCount:[2],processorOptions:{sampleRate:a.sampleRate}})}catch(n){throw n}this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this._wasmReadyPromise=new Promise((e,t)=>{this._wasmReadyResolve=e,this._wasmReadyReject=t,setTimeout(()=>t(new Error("FurnaceDispatch WASM ready timeout after 10s")),1e4)}),this.workletNode.port.postMessage({type:"init",sampleRate:a.sampleRate,wasmBinary:qo.wasmBinary,jsCode:qo.jsCode}),await this._wasmReadyPromise;try{const e=a.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(a.destination)}catch(t){}this.initialized=!0}catch(a){throw a}finally{this.initializing=!1}}}static async ensureModuleLoaded(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t="/DEViLBOX/",n=`?v=${Date.now()}`;if("running"!==e.state)try{await e.resume()}catch(a){}try{await e.audioWorklet.addModule(`${t}furnace-dispatch/FurnaceDispatch.worklet.js${n}`)}catch(a){const e=a?.message||String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load FurnaceDispatch worklet: ${e}`)}if(!this.wasmBinary||!this.jsCode){const[e,a]=await Promise.all([fetch(`${t}furnace-dispatch/FurnaceDispatch.wasm${n}`,{cache:"no-store"}),fetch(`${t}furnace-dispatch/FurnaceDispatch.js${n}`,{cache:"no-store"})]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar createFurnaceDispatch = createFurnaceDispatch || Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}handleWorkletMessage(e){switch(e.type){case"ready":this._wasmReadyResolve&&(this._wasmReadyResolve(),this._wasmReadyResolve=null);break;case"chipCreated":this.chips.set(e.platformType,{handle:e.handle,numChannels:e.numChannels});let t=0;for(const e of this.chips.values())t+=e.numChannels;this.latestOscData=new Array(t).fill(null),this._chipCreatedResolve&&(this._chipCreatedResolve(),this._chipCreatedResolve=null);break;case"oscData":this.latestOscData=e.channels;for(const n of this.oscCallbacks)n(e.channels);break;case"error":this._wasmReadyReject&&(this._wasmReadyReject(new Error(e.message)),this._wasmReadyReject=null,this._wasmReadyResolve=null)}}async createChip(e,t){this._nativeCtx&&await qo.ensureModuleLoaded(this._nativeCtx),this.workletNode&&(this._chipCreatedPromise=new Promise(e=>{this._chipCreatedResolve=e}),this.workletNode.port.postMessage({type:"createChip",platformType:e,sampleRate:t}))}async waitForChipCreated(){this._chipCreatedPromise&&await this._chipCreatedPromise}dispatch(e,t,n=0,a=0,s){this.workletNode&&this.workletNode.port.postMessage({type:"dispatch",cmd:e,chan:t,val1:n,val2:a,platformType:s})}noteOn(e,t,n){this.dispatch(Ho.NOTE_ON,e,t,0,n)}noteOff(e,t){this.dispatch(Ho.NOTE_OFF,e,0,0,t)}setInstrument(e,t,n){this.dispatch(Ho.INSTRUMENT,e,t,0,n)}setVolume(e,t,n){this.dispatch(Ho.VOLUME,e,t,0,n)}setGBInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setGBInstrument",insIndex:e,insData:t,platformType:n})}setWavetable(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",waveIndex:e,waveData:t,platformType:n})}setFMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setFMInstrument",insIndex:e,insData:t,platformType:n})}setC64Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setC64Instrument",insIndex:e,insData:t,platformType:n})}setNESInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setNESInstrument",insIndex:e,insData:t,platformType:n})}setSNESInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setSNESInstrument",insIndex:e,insData:t,platformType:n})}setN163Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setN163Instrument",insIndex:e,insData:t,platformType:n})}setFDSInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setFDSInstrument",insIndex:e,insData:t,platformType:n})}uploadFurnaceInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:n})}setAmigaInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setAmigaInstrument",insIndex:e,insData:t,platformType:n})}setMultiPCMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setMultiPCMInstrument",insIndex:e,insData:t,platformType:n})}setES5506Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setES5506Instrument",insIndex:e,insData:t,platformType:n})}setESFMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setESFMInstrument",insIndex:e,insData:t,platformType:n})}setWaveSynth(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWaveSynth",insIndex:e,insData:t,platformType:n})}setMacro(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setMacro",insIndex:e,macroData:t,platformType:n})}setInstrumentFull(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:n})}setSample(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setSample",sampleIndex:e,sampleData:t,platformType:n})}renderSamples(e){this.workletNode&&this.workletNode.port.postMessage({type:"renderSamples",platformType:e})}setMacrosEnabled(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMacrosEnabled",enabled:e,platformType:t})}clearMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"clearMacros",insIndex:e,platformType:t})}releaseMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"releaseMacros",chan:e,platformType:t})}setCompatFlags(e,t){if(!this.workletNode)return;const n=new Uint8Array(57);n[0]=e.limitSlides?1:0,n[1]=e.linearPitch??2,n[2]=e.pitchSlideSpeed??0,n[3]=e.loopModality??0,n[4]=e.delayBehavior??0,n[5]=e.jumpTreatment??0,n[6]=e.properNoiseLayout?1:0,n[7]=e.waveDutyIsVol?1:0,n[8]=e.resetMacroOnPorta?1:0,n[9]=e.legacyVolumeSlides?1:0,n[10]=e.compatibleArpeggio?1:0,n[11]=e.noteOffResetsSlides?1:0,n[12]=e.targetResetsSlides?1:0,n[13]=e.arpNonPorta?1:0,n[14]=e.algMacroBehavior?1:0,n[15]=e.brokenShortcutSlides?1:0,n[16]=e.ignoreDuplicateSlides?1:0,n[17]=e.stopPortaOnNoteOff?1:0,n[18]=e.continuousVibrato?1:0,n[19]=e.brokenDACMode?1:0,n[20]=e.oneTickCut?1:0,n[21]=e.newInsTriggersInPorta?1:0,n[22]=e.arp0Reset?1:0,n[23]=e.brokenSpeedSel?1:0,n[24]=e.noSlidesOnFirstTick?1:0,n[25]=e.rowResetsArpPos?1:0,n[26]=e.ignoreJumpAtEnd?1:0,n[27]=e.buggyPortaAfterSlide?1:0,n[28]=e.gbInsAffectsEnvelope?1:0,n[29]=e.sharedExtStat?1:0,n[30]=e.ignoreDACModeOutsideChannel?1:0,n[31]=e.e1e2AlsoTakePriority?1:0,n[32]=e.newSegaPCM?1:0,n[33]=e.fbPortaPause?1:0,n[34]=e.snDutyReset?1:0,n[35]=e.pitchMacroIsLinear?1:0,n[36]=e.oldOctaveBoundary?1:0,n[37]=e.noOPN2Vol?1:0,n[38]=e.newVolumeScaling?1:0,n[39]=e.volMacroLinger?1:0,n[40]=e.brokenOutVol?1:0,n[41]=e.brokenOutVol2?1:0,n[42]=e.e1e2StopOnSameNote?1:0,n[43]=e.brokenPortaArp?1:0,n[44]=e.snNoLowPeriods?1:0,n[45]=e.disableSampleMacro?1:0,n[46]=e.oldArpStrategy?1:0,n[47]=e.brokenPortaLegato?1:0,n[48]=e.brokenFMOff?1:0,n[49]=e.preNoteNoEffect?1:0,n[50]=e.oldDPCM?1:0,n[51]=e.resetArpPhaseOnNewNote?1:0,n[52]=e.ceilVolumeScaling?1:0,n[53]=e.oldAlwaysSetVolume?1:0,n[54]=e.oldSampleOffset?1:0,n[55]=e.oldCenterRate?1:0,n[56]=e.noVolSlideReset?1:0,this.workletNode.port.postMessage({type:"setCompatFlags",flags:n,platformType:t})}setCompatFlag(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setCompatFlag",flagIndex:e,value:t,platformType:n})}resetCompatFlags(e){this.workletNode&&this.workletNode.port.postMessage({type:"resetCompatFlags",platformType:e})}setLinearPitch(e,t){this.setCompatFlag($o,e,t)}setTickRate(e){this.workletNode&&this.workletNode.port.postMessage({type:"setTickRate",hz:e})}reset(e){this.workletNode&&this.workletNode.port.postMessage({type:"reset",platformType:e})}forceIns(e){this.workletNode&&this.workletNode.port.postMessage({type:"forceIns",platformType:e})}mute(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"mute",chan:e,mute:t,platformType:n})}onOscData(e){return this.oscCallbacks.add(e),()=>{this.oscCallbacks.delete(e)}}getOscData(){return this.latestOscData}getWorkletNode(){return this.workletNode}getNativeCtx(){return this._nativeCtx}dispatchFM(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchC64(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchSNES(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchGB(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchNES(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchAY(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchES5506(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchN163(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchSample(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchMacro(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}applyEffect(e,t,n,a){const s=a??this.platform,r=this.effectRouter.routeEffect(s,e,t,n);for(const o of r)this.dispatch(o.cmd,o.chan,o.val1,o.val2,a)}applyExtendedEffect(e,t,n,a){const s=a??this.platform,r=this.effectRouter.routeExtendedEffect(s,e,t,n);for(const o of r)this.dispatch(o.cmd,o.chan,o.val1,o.val2,a)}applyPlatformEffect(e,t,n,a){const s=a??this.platform,r=this.effectRouter.routePlatformEffect(s,e,t,n);for(const o of r)this.dispatch(o.cmd,o.chan,o.val1,o.val2,a)}resetEffectMemory(){this.effectRouter.resetMemory()}getEffectRouter(){return this.effectRouter}dispose(){if(this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.chips.clear(),this._audioRouted=!1,this._sharedGain){try{this._sharedGain.disconnect()}catch{}this._sharedGain=null}this.oscCallbacks.clear(),this.latestOscData=[],qo.instance=null}}const Yo=a(e=>({channelData:[],numChannels:0,platformType:0,isActive:!1,updateChannelData:t=>e({channelData:t,isActive:!0}),setChipInfo:(t,n)=>e({numChannels:t,platformType:n,channelData:new Array(t).fill(null)}),clear:()=>e({channelData:[],numChannels:0,platformType:0,isActive:!1})})),Xo={[Wo.GB]:["PU1","PU2","WAV","NOI"],[Wo.NES]:["PU1","PU2","TRI","NOI","DPCM"],[Wo.SMS]:["SQ1","SQ2","SQ3","NOI"],[Wo.AY]:["A","B","C"],[Wo.AY8930]:["A","B","C"],[Wo.PCE]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Wo.SNES]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Wo.VRC6]:["PU1","PU2","SAW"],[Wo.FDS]:["FDS"],[Wo.MMC5]:["PU1","PU2","PCM"],[Wo.N163]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Wo.C64_6581]:["V1","V2","V3"],[Wo.C64_8580]:["V1","V2","V3"],[Wo.VIC20]:["BASS","ALT","SOP","NOI"],[Wo.SAA1099]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Wo.TIA]:["AUD0","AUD1"],[Wo.POKEY]:["CH1","CH2","CH3","CH4"],[Wo.LYNX]:["CH1","CH2","CH3","CH4"],[Wo.SWAN]:["CH1","CH2","CH3","CH4"],[Wo.VERA]:["PU1","PU2","PU3","PU4","PU5","PU6","PU7","PU8","PU9","PU10","PU11","PU12","PU13","PU14","PU15","PU16","PCM"],[Wo.SCC]:["CH1","CH2","CH3","CH4","CH5"],[Wo.VBOY]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Wo.AMIGA]:["CH1","CH2","CH3","CH4"],[Wo.PET]:["CH"],[Wo.PCSPKR]:["SPK"],[Wo.SFX_BEEPER]:["CH1","CH2","CH3","CH4","CH5","CH6"],[Wo.PONG]:["CH"],[Wo.TED]:["SQ1","SQ2"],[Wo.POKEMINI]:["CH"],[Wo.PV1000]:["CH1","CH2","CH3"],[Wo.SOUND_UNIT]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Wo.NAMCO]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[Wo.QSOUND]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8","CH9","CH10","CH11","CH12","CH13","CH14","CH15","CH16"],[Wo.DAVE]:["CH1","CH2","CH3","NOI"]},Qo={[Wo.GB]:15,[Wo.SMS]:15,[Wo.NES]:15,[Wo.PCE]:31,[Wo.VIC20]:15,[Wo.TIA]:15,[Wo.POKEY]:15,[Wo.PV1000]:15,[Wo.POKEMINI]:3,[Wo.PONG]:1,[Wo.PCSPKR]:1,[Wo.SFX_BEEPER]:15,[Wo.TED]:8,[Wo.VRC6]:15,[Wo.MMC5]:15,[Wo.SWAN]:15,[Wo.LYNX]:127};function Zo(e){return Qo[e]??127}class Jo{name="FurnaceDispatchSynth";output;engine;_disposed=!1;_ready=!1;_readyPromise;_resolveReady;currentChannel=0;platformType;activeNotes=new Map;_releaseTimeouts=new Map;_volumeOffsetDb=0;furnaceInstrumentIndex=0;constructor(e=Wo.GB){this.output=Ja().createGain(),this.platformType=e,this.engine=qo.getInstance(),this._readyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize()}get ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}setFurnaceInstrumentIndex(e){this.furnaceInstrumentIndex=e}async uploadInstrumentFromConfig(e,t){await this.ensureInitialized();const{updateFurnaceInstrument:n}=await An(async()=>{const{updateFurnaceInstrument:e}=await import("./FurnaceInstrumentEncoder-DUItTP_3.js");return{updateFurnaceInstrument:e}},[]),a=n(e,t,this.furnaceInstrumentIndex);this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,a,this.platformType)}async uploadInstrumentData(e){e&&0!==e.length&&(await this.ensureInitialized(),this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,e,this.platformType))}setVolumeOffset(e){this._volumeOffsetDb=e;const t=this._nativeGain;t&&(t.gain.value=Math.pow(10,e/20))}async initialize(){try{const e=Ja();if(await this.engine.init(e),this._disposed)return;const t=this.engine.getNativeCtx()?.sampleRate??e.sampleRate;await this.engine.createChip(this.platformType,t),await this.engine.waitForChipCreated();const n=this.engine.getOrCreateSharedGain();n&&(this._nativeGain=n,0!==this._volumeOffsetDb&&(n.gain.value=Math.pow(10,this._volumeOffsetDb/20))),this.setupDefaultInstrument(),this._ready=!0,this._resolveReady();const a=Yo.getState(),s=this.getChannelNames();a.setChipInfo(s.length,this.platformType),this.engine.onOscData(e=>{Yo.getState().updateChannelData(e)})}catch(e){this._resolveReady()}}setupDefaultInstrument(){const e=Wo,t=this.platformType,n=this.engine.getChannelCount(t)||4,a=Zo(t),s=(e,n,a=0,s=0)=>this.engine.dispatch(e,n,a,s,t),r=(e,n)=>this.engine.setInstrument(e,n,t),o=(e,n)=>this.engine.setVolume(e,n,t);switch(t){case e.GB:this.setupDefaultGBInstrument();break;case e.PCE:this.setupDefaultWavetable(32,31);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.SCC:case e.SCC_PLUS:this.setupDefaultWavetable(32,255);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.VBOY:this.setupDefaultWavetable(32,63);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.NAMCO:case e.NAMCO_15XX:case e.NAMCO_CUS30:case e.BUBSYS_WSG:this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.SWAN:this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.FDS:this.setupDefaultWavetable(64,63),s(Ho.WAVE,0,0,0);break;case e.N163:this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.X1_010:case e.SOUND_UNIT:this.setupDefaultWavetable(32,255);for(let e=0;e<n;e++)s(Ho.WAVE,e,0,0);break;case e.AMIGA:case e.SEGAPCM:case e.SEGAPCM_COMPAT:case e.RF5C68:case e.K007232:case e.K053260:case e.GA20:case e.GBA_DMA:case e.GBA_MINMOD:case e.NDS:case e.MSM6295:case e.YMZ280B:case e.QSOUND:case e.MULTIPCM:this.loadTestSample8bit(),this.engine.renderSamples(t);for(let e=0;e<n;e++)r(e,0),o(e,a);break;case e.MSM6258:this.loadTestSampleVOX(),this.engine.renderSamples(t);for(let e=0;e<n;e++)r(e,0),o(e,a);break;case e.ES5506:case e.C140:case e.C219:case e.PCM_DAC:this.loadTestSample16bit(),this.engine.renderSamples(t);for(let e=0;e<n;e++)r(e,0),o(e,a);break;case e.SNES:this.loadTestSampleBRR(),this.engine.renderSamples(t);for(let e=0;e<n;e++)r(e,0),o(e,a)}if(![e.AMIGA,e.SEGAPCM,e.SEGAPCM_COMPAT,e.RF5C68,e.K007232,e.K053260,e.GA20,e.GBA_DMA,e.GBA_MINMOD,e.NDS,e.MSM6295,e.YMZ280B,e.QSOUND,e.MULTIPCM,e.MSM6258,e.ES5506,e.C140,e.C219,e.PCM_DAC,e.SNES].includes(t))for(let i=0;i<n;i++)r(i,0),o(i,a)}setupDefaultGBInstrument(){const e=this.platformType,t=new Uint8Array([15,0,2,0,0,1,0,0]);this.engine.setGBInstrument(0,t,e);for(let r=0;r<4;r++)this.engine.setInstrument(r,0,e),this.engine.setVolume(r,15,e);const n=32,a=new Uint8Array(136),s=new DataView(a.buffer);s.setInt32(0,n,!0),s.setInt32(4,15,!0);for(let r=0;r<n;r++){const e=r<16?Math.round(r/16*15):Math.round((n-r)/16*15);s.setInt32(8+4*r,e,!0)}this.engine.setWavetable(0,a,e)}setupDefaultWavetable(e,t){const n=new Uint8Array(8+4*e),a=new DataView(n.buffer);a.setInt32(0,e,!0),a.setInt32(4,t,!0);for(let s=0;s<e;s++){const n=Math.round(s/(e-1)*t);a.setInt32(8+4*s,n,!0)}this.engine.setWavetable(0,n,this.platformType)}buildSampleHeader(e,t,n=8363,a=0,s,r=!0){const o=new DataView(new ArrayBuffer(32));return o.setUint32(0,e,!0),o.setInt32(4,a,!0),o.setInt32(8,s??e,!0),o.setUint8(12,t),o.setUint8(13,0),o.setUint8(14,0),o.setUint8(15,0),o.setUint32(16,n,!0),o.setUint8(22,r?1:0),o}loadTestSample8bit(){const e=new Uint8Array(64),t=this.buildSampleHeader(32,8,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<32;n++)e[32+n]=n<16?127:128;this.engine.setSample(0,e,this.platformType)}loadTestSample16bit(){const e=new Uint8Array(96),t=this.buildSampleHeader(32,16,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));const n=new DataView(e.buffer);for(let a=0;a<32;a++){const e=a<16?32767:-32768;n.setInt16(32+2*a,e,!0)}this.engine.setSample(0,e,this.platformType)}loadTestSampleBRR(){const e=Math.ceil(2),t=new Uint8Array(32+9*e),n=this.buildSampleHeader(32,9,8363);new Uint8Array(t.buffer,0,32).set(new Uint8Array(n.buffer));for(let a=0;a<e;a++){const n=32+9*a,s=a===e-1;t[n]=194|(s?1:0);for(let e=0;e<8;e++){const s=16*a+2*e,r=s<16?7:8,o=s+1<16?7:8;t[n+1+e]=(15&r)<<4|15&o}}this.engine.setSample(0,t,this.platformType)}loadTestSampleVOX(){const e=new Uint8Array(48.5),t=this.buildSampleHeader(32,Ko,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<16.5;n++){const t=2*n,a=t<16?15:0,s=t+1<16?15:0;e[32+n]=a<<4|s}this.engine.setSample(0,e,this.platformType)}getChannelNames(){const e=Xo[this.platformType];if(e)return e;const t=this.engine.getChannelCount(this.platformType)||1;return Array.from({length:t},(e,t)=>`CH${t+1}`)}getNumChannels(){return this.engine.getChannelCount(this.platformType)}onOscData(e){return this.engine.onOscData(e)}getOscData(){return this.engine.getOscData()}triggerAttack(e,t,n=1){if(!this._ready||this._disposed)return;const a="string"==typeof e?rs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,s=this.currentChannel,r=this._releaseTimeouts.get(s);r&&(clearTimeout(r),this._releaseTimeouts.delete(s));const o=this.platformType;this.engine.setInstrument(s,this.furnaceInstrumentIndex,o);const i=Zo(o),l=Math.round(n*i);this.engine.setVolume(s,l,o),this.engine.noteOn(s,a,o),this.activeNotes.set(a,s)}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a);const s=this.engine.getNativeCtx();if(s){const a=this.currentChannel,r=(n??s.currentTime)+t,o=setTimeout(()=>{this._releaseTimeouts.delete(a),this.triggerRelease(e)},Math.max(0,1e3*(r-s.currentTime)));this._releaseTimeouts.set(a,o)}}triggerRelease(e,t){if(this._ready&&!this._disposed)if(void 0!==e){const t="string"==typeof e?rs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,n=this.activeNotes.get(t);void 0!==n&&(this.engine.noteOff(n,this.platformType),this.activeNotes.delete(t))}else{for(const[,e]of this.activeNotes)this.engine.noteOff(e,this.platformType);this.activeNotes.clear()}}releaseAll(){this.triggerRelease()}setChannel(e){this.currentChannel=e}sendCommand(e,t,n=0,a=0){this._ready&&!this._disposed&&this.engine.dispatch(e,t,n,a,this.platformType)}applyEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyEffect(n??this.currentChannel,e,t,this.platformType)}applyExtendedEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyExtendedEffect(n??this.currentChannel,e,t,this.platformType)}applyPlatformEffect(e,t,n){this._ready&&!this._disposed&&this.engine.applyPlatformEffect(n??this.currentChannel,e,t,this.platformType)}resetEffectMemory(){this.engine.resetEffectMemory()}setGBInstrument(e,t){this.engine.setGBInstrument(e,t,this.platformType)}setWavetable(e,t){this.engine.setWavetable(e,t,this.platformType)}renderSamples(){this.engine.renderSamples(this.platformType)}setParam(e,t){switch(e){case"volume":this.engine.setVolume(this.currentChannel,t,this.platformType);break;case"channel":this.currentChannel=t}}dispose(){this._disposed=!0,this.activeNotes.clear();for(const e of this._releaseTimeouts.values())clearTimeout(e);this._releaseTimeouts.clear(),this._nativeGain=null,this.output.disconnect()}}class ei{name="DrumKitSynth";config;sampleBuffers=new Map;activeVoices=[];audioContext;outputGain;output;onSampleNeeded;constructor(e){this.config=e,this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=.8,this.outputGain.connect(this.output)}setSampleLoader(e){this.onSampleNeeded=e}async preloadSamples(){if(!this.onSampleNeeded)return;const e=this.config.keymap.map(async e=>{if(!this.sampleBuffers.has(e.id)){const t=await this.onSampleNeeded(e.sampleId,e.sampleUrl);t&&this.sampleBuffers.set(e.id,t)}});await Promise.all(e)}loadSample(e,t){this.sampleBuffers.set(e,t)}findMapping(e){for(const t of this.config.keymap)if(e>=t.noteStart&&e<=t.noteEnd)return t;return null}noteToMidiNumber(e){return"number"==typeof e?e+11:function(e){if("number"==typeof e)return e+11;if(null==e||""===e||"..."===e||"==="===e)return 60;const t=e.match(/^([A-G])([#b])?-?(\d)$/i);if(!t)return 60;const[,n,a,s]=t,r=parseInt(s,10),o=n.toUpperCase(),i=a?o+a:o+"-",l=za.indexOf(i);return-1===l?60:12*(r+1)+l}(e)}triggerAttack(e,t,n=.8){const a=this.noteToMidiNumber(e),s=this.findMapping(a);if(!s)return;const r=this.sampleBuffers.get(s.id);if(!r)return;if(this.activeVoices.length>=this.config.maxVoices){const e=this.activeVoices.shift();e&&this.disposeVoice(e)}if("mono"===this.config.polyphony||this.config.noteCut){this.activeVoices.filter(e=>e.mappingId===s.id).forEach(e=>{this.disposeVoice(e);const t=this.activeVoices.indexOf(e);-1!==t&&this.activeVoices.splice(t,1)})}const o=this.calculatePlaybackRate(s,a),i=this.audioContext.createBufferSource();i.buffer=r,i.playbackRate.value=o;const l=(s.panOffset||0)/100,c=this.audioContext.createStereoPanner();c.pan.value=l;const d=Math.pow(10,(s.volumeOffset||0)/20),u=this.audioContext.createGain();u.gain.value=n*d,i.connect(c),c.connect(u),u.connect(this.outputGain);const p=t??is();i.start(p);const h={source:i,panner:c,gain:u,midiNote:a,mappingId:s.id,startTime:p};this.activeVoices.push(h);const m=r.duration/o;setTimeout(()=>{const e=this.activeVoices.indexOf(h);-1!==e&&(this.activeVoices.splice(e,1),this.disposeVoice(h))},1e3*(m+.1))}calculatePlaybackRate(e,t){let n=1;if(e.pitchOffset&&(n*=Math.pow(2,e.pitchOffset/12)),e.fineTune&&(n*=Math.pow(2,e.fineTune/1200)),e.baseNote){const a=t-this.noteToMidiNumber(e.baseNote);n*=Math.pow(2,a/12)}return Math.max(.1,Math.min(4,n))}triggerRelease(e,t){const n=this.noteToMidiNumber(e);this.activeVoices.filter(e=>e.midiNote===n).forEach(e=>{const n=t??is();e.gain.gain.setValueAtTime(e.gain.gain.value,n),e.gain.gain.linearRampToValueAtTime(0,n+.05),setTimeout(()=>{const t=this.activeVoices.indexOf(e);-1!==t&&(this.activeVoices.splice(t,1),this.disposeVoice(e))},100)})}disposeVoice(e){try{e.source.stop()}catch(t){}try{e.source.disconnect(),e.panner.disconnect(),e.gain.disconnect()}catch(t){}}releaseAll(){this.activeVoices.forEach(e=>this.disposeVoice(e)),this.activeVoices=[]}updateConfig(e){this.config={...this.config,...e}}getKeymap(){return[...this.config.keymap]}addMapping(e){this.config.keymap.push(e)}removeMapping(e){const t=this.config.keymap.findIndex(t=>t.id===e);-1!==t&&(this.config.keymap.splice(t,1),this.sampleBuffers.delete(e))}clearKeymap(){this.config.keymap=[],this.sampleBuffers.clear(),this.releaseAll()}dispose(){this.releaseAll(),this.sampleBuffers.clear(),this.outputGain.disconnect(),this.output.disconnect()}}const ti={type:"sine",frequency:440},ni={enabled:!0,type:"square",rate:2,depth:100},ai={enabled:!0,time:.3,feedback:.4,wet:.3},si={enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},ri={enabled:!0,decay:1.5,wet:.1};class oi{name="DubSirenSynth";output;osc;filter;reverb;delay;distortion;gate;_toneOutput;signal;lfo;constructor(e){const t={oscillator:{...ti,...e?.oscillator},lfo:{...ni,...e?.lfo},delay:{...ai,...e?.delay},filter:{...si,...e?.filter},reverb:{...ri,...e?.reverb}};this.output=Ja().createGain(),this._toneOutput=new P(0);const n=ns(this._toneOutput);n&&n.connect(this.output),this.reverb=new g({decay:t.reverb.decay,wet:t.reverb.enabled?t.reverb.wet:0}),this.delay=new T({delayTime:t.delay.time,feedback:t.delay.feedback,wet:t.delay.enabled?t.delay.wet:0}),this.filter=new m({frequency:t.filter.frequency,type:t.filter.type,rolloff:t.filter.rolloff,Q:1}),this.distortion=new v(.1),this.gate=new p(0),this.osc=new A({type:t.oscillator.type}),this.signal=new _({units:"frequency",value:t.oscillator.frequency}),this.lfo=new b({type:t.lfo.type,frequency:t.lfo.rate,amplitude:1,min:-t.lfo.depth,max:t.lfo.depth}),this.osc.frequency.value=0,this.signal.connect(this.osc.frequency),t.lfo.enabled&&(this.lfo.connect(this.osc.frequency),this.lfo.start()),this.osc.connect(this.gate),this.gate.connect(this.filter),this.filter.connect(this.distortion),this.distortion.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.osc.start()}applyConfig(e){this.osc.type=e.oscillator.type,this.setFrequency(e.oscillator.frequency),this.lfo.type=e.lfo.type,this.setLFORate(e.lfo.rate),this.setLFODepth(e.lfo.depth),e.lfo.enabled?"started"!==this.lfo.state&&(this.lfo.start(),this.lfo.connect(this.osc.frequency)):(this.lfo.stop(),this.lfo.disconnect()),this.setDelayTime(e.delay.time),this.setDelayFeedback(e.delay.feedback),this.setDelayMix(e.delay.enabled?e.delay.wet:0),this.setFilterFreq(e.filter.frequency),this.filter.type=e.filter.type,this.filter.rolloff=e.filter.rolloff,this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n){const a=t||is();if(e){const t=os(e);this.signal.setValueAtTime(t,a)}this.gate.gain.cancelScheduledValues(a),this.gate.gain.setValueAtTime(1,a)}triggerRelease(e){const t=e||is();this.gate.gain.cancelScheduledValues(t),this.gate.gain.setValueAtTime(0,t)}setOscType(e){this.osc.type=e}setFrequency(e){this.signal.rampTo(e,.1)}setLFOType(e){this.lfo.type=e}setLFORate(e){this.lfo.frequency.rampTo(e,.1)}setLFODepth(e){this.lfo.min=-e,this.lfo.max=e}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.delay.delayTime.rampTo(t,.1)}setDelayFeedback(e){this.delay.feedback.rampTo(e,.1)}setDelayMix(e){this.delay.wet.rampTo(e,.1)}setFilterFreq(e){this.filter.frequency.rampTo(e,.1)}dispose(){this.osc.dispose(),this.gate.dispose(),this.filter.dispose(),this.distortion.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect(),this.signal.dispose(),this.lfo.dispose()}get volume(){return this._toneOutput.volume}}class ii{name="SpaceLaserSynth";output;synth;filter;noise;noiseGain;reverb;delay;_toneOutput;config;constructor(e){this.config=e,this.output=Ja().createGain(),this._toneOutput=new P(0);const t=ns(this._toneOutput);t&&t.connect(this.output),this.reverb=new g({decay:e.reverb.decay,wet:e.reverb.enabled?e.reverb.wet:0}),this.delay=new T({delayTime:e.delay.time,feedback:e.delay.feedback,wet:e.delay.enabled?e.delay.wet:0}),this.filter=new m({frequency:e.filter.cutoff,type:e.filter.type,Q:e.filter.resonance/10}),this.synth=new I({harmonicity:e.fm.ratio,modulationIndex:e.fm.amount,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1},modulationEnvelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1}}),this.noise=new D({type:e.noise.type,volume:-1/0}),this.noiseGain=new p(e.noise.amount/100),this.noise.connect(this.noiseGain),this.synth.connect(this.filter),this.noiseGain.connect(this.filter),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.noise.start()}applyConfig(e){this.config=e,this.synth.harmonicity.value=e.fm.ratio,this.synth.modulationIndex.value=e.fm.amount,this.synth.envelope.decay=e.laser.sweepTime/1e3,this.synth.modulationEnvelope.decay=e.laser.sweepTime/1e3,this.noise.type=e.noise.type,this.noiseGain.gain.rampTo(e.noise.amount/100,.1),this.filter.type=e.filter.type,this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.delay.delayTime.rampTo(e.delay.time,.1),this.delay.feedback.rampTo(e.delay.feedback,.1),this.delay.wet.rampTo(e.delay.enabled?e.delay.wet:0,.1),this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n=1){const a=t||is(),s=this.config.laser.sweepTime/1e3,r=e?os(e):this.config.laser.startFreq,o=this.config.laser.endFreq;this.synth.triggerAttack(r,a,n),this.synth.frequency.cancelScheduledValues(a+.001),"exponential"===this.config.laser.sweepCurve?this.synth.frequency.exponentialRampToValueAtTime(o,a+s):this.synth.frequency.linearRampToValueAtTime(o,a+s),this.synth.triggerRelease(a+s)}triggerRelease(e){const t=null==e?is():e;this.synth.triggerRelease(t)}dispose(){this.noise.stop(),this.synth.dispose(),this.filter.dispose(),this.noise.dispose(),this.noiseGain.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}class li{name="SynareSynth";output;osc1;osc2;noise;osc1Gain;osc2Gain;noiseGain;filter;ampEnv;_toneOutput;filterFreqEnv;pitchEnv;lfo;lfoGain;config;constructor(e){this.config=e,this.osc1=new A({type:"square",frequency:e.oscillator.tune}),this.osc2=new A({type:"square",frequency:e.oscillator.tune}),this.noise=new D({type:e.noise.type}),this.osc1Gain=new p(1),this.osc2Gain=new p(e.oscillator2.enabled?e.oscillator2.mix:0),this.noiseGain=new p(e.noise.enabled?e.noise.mix:0),this.filter=new m({frequency:e.filter.cutoff,type:"lowpass",rolloff:-24,Q:e.filter.resonance/10}),this.ampEnv=new O({attack:.005,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain,release:.1}),this.output=Ja().createGain(),this._toneOutput=new P(0);const t=ns(this._toneOutput);t&&t.connect(this.output),this.filterFreqEnv=new F({attack:.005,decay:e.filter.decay/1e3,sustain:0,release:.1}),this.pitchEnv=new F({attack:.005,decay:e.sweep.time/1e3,sustain:0,release:.1}),this.lfo=new b({frequency:e.lfo.rate,amplitude:e.lfo.depth/100}),this.lfoGain=new p(0),this.lfo.connect(this.lfoGain),this.lfo.start(),this.osc1.connect(this.osc1Gain),this.osc2.connect(this.osc2Gain),this.noise.connect(this.noiseGain);const n=new p(1);this.osc1Gain.connect(n),this.osc2Gain.connect(n),this.noiseGain.connect(n),n.connect(this.filter),this.filter.connect(this.ampEnv),this.ampEnv.connect(this._toneOutput),this.applyConfig(e),this.osc1.start(),this.osc2.start(),this.noise.start()}applyConfig(e){this.config=e,this.osc1.frequency.rampTo(e.oscillator.tune,.1),this.osc2.frequency.rampTo(e.oscillator.tune*Math.pow(2,e.oscillator2.detune/12),.1),this.osc1Gain.gain.rampTo(1,.1),this.osc2Gain.gain.rampTo(e.oscillator2.enabled?e.oscillator2.mix:0,.1),this.noiseGain.gain.rampTo(e.noise.enabled?e.noise.mix:0,.1),this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.ampEnv.decay=e.envelope.decay/1e3,this.ampEnv.sustain=e.envelope.sustain,this.filterFreqEnv.decay=e.filter.decay/1e3,this.pitchEnv.decay=e.sweep.time/1e3,this.lfo.frequency.rampTo(e.lfo.rate,.1),this.lfoGain.gain.rampTo(e.lfo.enabled?e.lfo.depth/100:0,.1)}triggerAttack(e,t,n){const a=t||is();if(e){const t=os(e);this.osc1.frequency.setValueAtTime(t,a),this.osc2.frequency.setValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),a)}if(this.ampEnv.triggerAttack(a,n),this.config.filter.envMod>0){const e=Math.min(2e4,this.config.filter.cutoff+100*this.config.filter.envMod);this.filter.frequency.cancelScheduledValues(a),this.filter.frequency.setValueAtTime(this.config.filter.cutoff,a),this.filter.frequency.exponentialRampToValueAtTime(e,a+.005),this.filter.frequency.exponentialRampToValueAtTime(this.config.filter.cutoff,a+this.config.filter.decay/1e3)}if(this.config.sweep.enabled){const t=e?os(e):this.config.oscillator.tune,n=t*Math.pow(2,this.config.sweep.amount/12);this.osc1.frequency.cancelScheduledValues(a),this.osc2.frequency.cancelScheduledValues(a),this.osc1.frequency.setValueAtTime(n,a),this.osc1.frequency.exponentialRampToValueAtTime(t,a+this.config.sweep.time/1e3),this.osc2.frequency.setValueAtTime(n*Math.pow(2,this.config.oscillator2.detune/12),a),this.osc2.frequency.exponentialRampToValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),a+this.config.sweep.time/1e3)}}triggerRelease(e){const t=e||is();this.ampEnv.triggerRelease(t)}updateParameter(e,t){this.applyConfig(this.config)}dispose(){this.osc1.dispose(),this.osc2.dispose(),this.noise.dispose(),this.osc1Gain.dispose(),this.osc2Gain.dispose(),this.noiseGain.dispose(),this.filter.dispose(),this.ampEnv.dispose(),this.filterFreqEnv.dispose(),this.pitchEnv.dispose(),this.lfo.dispose(),this.lfoGain.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}let ci=(e,t)=>0!==(e&t),di=e=>{let t=new Uint8Array(e.length);return e.split("").forEach((e,n)=>{t[n]=e.charCodeAt(0)}),t},ui=e=>{let t=new Uint8Array(4);return t[0]=e,t[1]=e>>8,t[2]=e>>16,t[3]=e>>24,t},pi=e=>{let t=new Uint8Array(2);return t[0]=e,t[1]=e>>8,t},hi=null,mi=e=>{if(null===hi&&(hi=new AudioContext),!hi)throw new Error("No player available!");return((e,t)=>{let n,a=new Promise((a,s)=>{let r=e.createBufferSource(),o=e.createBuffer(1,t.length,22050),i=o.getChannelData(0);for(let e=0;e<t.length;e++)i[e]=t[e];r.buffer=o,r.connect(e.destination),r.onended=()=>{a(!0)},n=e=>{r.disconnect(),s(e)},r.start(0)});return a.abort=n,a})(hi,e)},fi=e=>{let t=new Uint8Array(44+e.length),n=0,a=e=>{t.set(e,n),n+=e.length};return a(di("RIFF")),a(ui(e.length+12+16+8-8)),a(di("WAVE")),a(di("fmt ")),a(ui(16)),a(pi(1)),a(pi(1)),a(ui(22050)),a(ui(22050)),a(pi(1)),a(pi(8)),a(di("data")),a(ui(e.length)),a(e),t},yi={" ":0,"!":2,'"':2,"#":2,$:2,"%":2,"&":2,"'":130,"(":0,")":0,"*":2,"+":2,",":2,"-":2,".":2,"/":2,0:3,1:3,2:3,3:3,4:3,5:3,6:3,7:3,8:3,9:3,":":2,";":2,"<":2,"=":2,">":2,"?":2,"@":2,A:192,B:168,C:176,D:172,E:192,F:160,G:184,H:160,I:192,J:188,K:160,L:172,M:168,N:172,O:192,P:160,Q:160,R:172,S:180,T:164,U:192,V:168,W:168,X:176,Y:192,Z:188,"[":0,"\\":0,"]":0,"^":2,_:0,"`":32},gi='(A)=|(!)=.|(") =-AH5NKWOWT-|(")=KWOW4T-|(#)= NAH4MBER|($)= DAA4LER|(%)= PERSEH4NT|(&)= AEND|(\')=|(*)= AE4STERIHSK|(+)= PLAH4S|(,)=,| (-) =-|(-)=|(.)= POYNT|(/)= SLAE4SH|(0)= ZIY4ROW| (1ST)=FER4ST| (10TH)=TEH4NTH|(1)= WAH4N| (2ND)=SEH4KUND|(2)= TUW4| (3RD)=THER4D|(3)= THRIY4|(4)= FOH4R| (5TH)=FIH4FTH|(5)= FAY4V| (64) =SIH4KSTIY FOHR|(6)= SIH4KS|(7)= SEH4VUN| (8TH)=EY4TH|(8)= EY4T|(9)= NAY4N|(:)=.|(;)=.|(<)= LEH4S DHAEN|(=)= IY4KWULZ|(>)= GREY4TER DHAEN|(?)=?|(@)= AE6T|(^)= KAE4RIXT',vi=128,bi=(e,t)=>0!==(yi[e]&t),xi=(e,t,n)=>bi(e[t],n),wi=(e,t)=>-1!==t.indexOf(e),ki=e=>{let t=e.split("=");const n=t.pop(),a=t.join("=").split("("),s=a.pop().split(")"),r=a[0],o=s[0],i=s[1];let l=["T","C","S"],c=["E","I","Y"],d=(e,t)=>!!e.startsWith(o,t)&&(!!((e,t)=>{for(let n=r.length-1;n>-1;n--){let a=r[n];if(bi(a,vi)){if(e[--t]!==a)return!1}else if(!{" ":()=>!xi(e,--t,vi),"#":()=>xi(e,--t,64),".":()=>xi(e,--t,8),"&":()=>xi(e,--t,16)||wi(e.substr(--t,2),["CH","SH"]),"@":()=>{if(xi(e,--t,4))return!0;let n=e[t];if("H"!==n)return!1;if(!wi(n,l))return!1;throw new Error("Is always false but happened? "+n)},"^":()=>xi(e,--t,32),"+":()=>wi(e[--t],c),":":()=>{for(;t>=0&&xi(e,t-1,32);)t--;return!0}}[a]())return!1}return!0})(e,t)&&((e,t)=>{for(let n=0;n<i.length;n++){let a=i[n];if(bi(a,vi)){if(e[++t]!==a)return!1}else if(!{" ":()=>!xi(e,++t,vi),"#":()=>xi(e,++t,64),".":()=>xi(e,++t,8),"&":()=>xi(e,++t,16)||wi(e.substr(++t-2,2),["HC","HS"]),"@":()=>{if(xi(e,++t,4))return!0;let n=e[t];if("H"!==n)return!1;if(!wi(n,l))return!1;throw new Error("This should not be possible ",n)},"^":()=>xi(e,++t,32),"+":()=>wi(e[++t],c),":":()=>{for(;xi(e,t+1,32);)t++;return!0},"%":()=>"E"!==e[t+1]?"ING"===e.substr(t+1,3)&&(t+=3,!0):xi(e,t+2,vi)?wi(e[t+2],["R","S","D"])?(t+=2,!0):"L"!==e[t+2]?"FUL"===e.substr(t+2,3)&&(t+=4,!0):"Y"===e[t+3]&&(t+=3,!0):(t++,!0)}[a]())return!1}return!0})(e,t+(o.length-1))),u=(e,t,a)=>{if(d(e,t))return a(n,o.length),!0};return u.c=o[0],u},Si={};" (A.)=EH4Y. |(A) =AH| (ARE) =AAR| (AR)O=AXR|(AR)#=EH4R| ^(AS)#=EY4S|(A)WA=AX|(AW)=AO5| :(ANY)=EH4NIY|(A)^+#=EY5|#:(ALLY)=ULIY| (AL)#=UL|(AGAIN)=AXGEH4N|#:(AG)E=IHJ|(A)^%=EY|(A)^+:#=AE| :(A)^+ =EY4| (ARR)=AXR|(ARR)=AE4R| ^(AR) =AA5R|(AR)=AA5R|(AIR)=EH4R|(AI)=EY4|(AY)=EY5|(AU)=AO4|#:(AL) =UL|#:(ALS) =ULZ|(ALK)=AO4K|(AL)^=AOL| :(ABLE)=EY4BUL|(ABLE)=AXBUL|(A)VO=EY4|(ANG)+=EY4NJ|(ATARI)=AHTAA4RIY|(A)TOM=AE|(A)TTI=AE| (AT) =AET| (A)T=AH|(A)=AE| (B) =BIY4| (BE)^#=BIH|(BEING)=BIY4IHNX| (BOTH) =BOW4TH| (BUS)#=BIH4Z|(BREAK)=BREY5K|(BUIL)=BIH4L|(B)=B| (C) =SIY4| (CH)^=K|^E(CH)=K|(CHA)R#=KEH5|(CH)=CH| S(CI)#=SAY4|(CI)A=SH|(CI)O=SH|(CI)EN=SH|(CITY)=SIHTIY|(C)+=S|(CK)=K|(COMMODORE)=KAA4MAHDOHR|(COM)=KAHM|(CUIT)=KIHT|(CREA)=KRIYEY|(C)=K| (D) =DIY4| (DR.) =DAA4KTER|#:(DED) =DIHD|.E(D) =D|#:^E(D) =T| (DE)^#=DIH| (DO) =DUW| (DOES)=DAHZ|(DONE) =DAH5N|(DOING)=DUW4IHNX| (DOW)=DAW|#(DU)A=JUW|#(DU)^#=JAX|(D)=D| (E) =IYIY4|#:(E) =|':^(E) =| :(E) =IY|#(ED) =D|#:(E)D =|(EV)ER=EH4V|(E)^%=IY4|(ERI)#=IY4RIY|(ERI)=EH4RIH|#:(ER)#=ER|(ERROR)=EH4ROHR|(ERASE)=IHREY5S|(ER)#=EHR|(ER)=ER| (EVEN)=IYVEHN|#:(E)W=|@(EW)=UW|(EW)=YUW|(E)O=IY|#:&(ES) =IHZ|#:(E)S =|#:(ELY) =LIY|#:(EMENT)=MEHNT|(EFUL)=FUHL|(EE)=IY4|(EARN)=ER5N| (EAR)^=ER5|(EAD)=EHD|#:(EA) =IYAX|(EA)SU=EH5|(EA)=IY5|(EIGH)=EY4|(EI)=IY4| (EYE)=AY4|(EY)=IY|(EU)=YUW5|(EQUAL)=IY4KWUL|(E)=EH| (F) =EH4F|(FUL)=FUHL|(FRIEND)=FREH5ND|(FATHER)=FAA4DHER|(F)F=|(F)=F| (G) =JIY4|(GIV)=GIH5V| (G)I^=G|(GE)T=GEH5|SU(GGES)=GJEH4S|(GG)=G| B#(G)=G|(G)+=J|(GREAT)=GREY4T|(GON)E=GAO5N|#(GH)=| (GN)=N|(G)=G| (H) =EY4CH| (HAV)=/HAE6V| (HERE)=/HIYR| (HOUR)=AW5ER|(HOW)=/HAW|(H)#=/H|(H)=| (IN)=IHN| (I) =AY4|(I) =AY|(IN)D=AY5N|SEM(I)=IY| ANT(I)=AY|(IER)=IYER|#:R(IED) =IYD|(IED) =AY5D|(IEN)=IYEHN|(IE)T=AY4EH|(I')=AY5| :(I)^%=AY5| :(IE) =AY4|(I)%=IY|(IE)=IY4| (IDEA)=AYDIY5AH|(I)^+:#=IH|(IR)#=AYR|(IZ)%=AYZ|(IS)%=AYZ|I^(I)^#=IH|+^(I)^+=AY|#:^(I)^+=IH|(I)^+=AY|(IR)=ER|(IGH)=AY4|(ILD)=AY5LD| (IGN)=IHGN|(IGN) =AY4N|(IGN)^=AY4N|(IGN)%=AY4N|(ICRO)=AY4KROH|(IQUE)=IY4K|(I)=IH| (J) =JEY4|(J)=J| (K) =KEY4| (K)N=|(K)=K| (L) =EH4L|(LO)C#=LOW|L(L)=|#:^(L)%=UL|(LEAD)=LIYD| (LAUGH)=LAE4F|(L)=L| (M) =EH4M| (MR.) =MIH4STER| (MS.)=MIH5Z| (MRS.) =MIH4SIXZ|(MOV)=MUW4V|(MACHIN)=MAHSHIY5N|M(M)=|(M)=M| (N) =EH4N|E(NG)+=NJ|(NG)R=NXG|(NG)#=NXG|(NGL)%=NXGUL|(NG)=NX|(NK)=NXK| (NOW) =NAW4|N(N)=|(NON)E=NAH4N|(N)=N| (O) =OH4W|(OF) =AHV| (OH) =OW5|(OROUGH)=ER4OW|#:(OR) =ER|#:(ORS) =ERZ|(OR)=AOR| (ONE)=WAHN|#(ONE) =WAHN|(OW)=OW| (OVER)=OW5VER|PR(O)V=UW4|(OV)=AH4V|(O)^%=OW5|(O)^EN=OW|(O)^I#=OW5|(OL)D=OW4L|(OUGHT)=AO5T|(OUGH)=AH5F| (OU)=AW|H(OU)S#=AW4|(OUS)=AXS|(OUR)=OHR|(OULD)=UH5D|(OU)^L=AH5|(OUP)=UW5P|(OU)=AW|(OY)=OY|(OING)=OW4IHNX|(OI)=OY5|(OOR)=OH5R|(OOK)=UH5K|F(OOD)=UW5D|L(OOD)=AH5D|M(OOD)=UW5D|(OOD)=UH5D|F(OOT)=UH5T|(OO)=UW5|(O')=OH|(O)E=OW|(O) =OW|(OA)=OW4| (ONLY)=OW4NLIY| (ONCE)=WAH4NS|(ON'T)=OW4NT|C(O)N=AA|(O)NG=AO| :^(O)N=AH|I(ON)=UN|#:(ON)=UN|#^(ON)=UN|(O)ST=OW|(OF)^=AO4F|(OTHER)=AH5DHER|R(O)B=RAA|^R(O):#=OW5|(OSS) =AO5S|#:^(OM)=AHM|(O)=AA| (P) =PIY4|(PH)=F|(PEOPL)=PIY5PUL|(POW)=PAW4|(PUT) =PUHT|(P)P=|(P)S=|(P)N=|(PROF.)=PROHFEH4SER|(P)=P| (Q) =KYUW4|(QUAR)=KWOH5R|(QU)=KW|(Q)=K| (R) =AA5R| (RE)^#=RIY|(R)R=|(R)=R| (S) =EH4S|(SH)=SH|#(SION)=ZHUN|(SOME)=SAHM|#(SUR)#=ZHER|(SUR)#=SHER|#(SU)#=ZHUW|#(SSU)#=SHUW|#(SED)=ZD|#(S)#=Z|(SAID)=SEHD|^(SION)=SHUN|(S)S=|.(S) =Z|#:.E(S) =Z|#:^#(S) =S|U(S) =S| :#(S) =Z|##(S) =Z| (SCH)=SK|(S)C+=|#(SM)=ZUM|#(SN)'=ZUM|(STLE)=SUL|(S)=S| (T) =TIY4| (THE) #=DHIY| (THE) =DHAX|(TO) =TUX| (THAT)=DHAET| (THIS) =DHIHS| (THEY)=DHEY| (THERE)=DHEHR|(THER)=DHER|(THEIR)=DHEHR| (THAN) =DHAEN| (THEM) =DHAEN|(THESE) =DHIYZ| (THEN)=DHEHN|(THROUGH)=THRUW4|(THOSE)=DHOHZ|(THOUGH) =DHOW|(TODAY)=TUXDEY|(TOMO)RROW=TUMAA5|(TO)TAL=TOW5| (THUS)=DHAH4S|(TH)=TH|#:(TED)=TIXD|S(TI)#N=CH|(TI)O=SH|(TI)A=SH|(TIEN)=SHUN|(TUR)#=CHER|(TU)A=CHUW| (TWO)=TUW|&(T)EN =|(T)=T| (U) =YUW4| (UN)I=YUWN| (UN)=AHN| (UPON)=AXPAON|@(UR)#=UH4R|(UR)#=YUH4R|(UR)=ER|(U)^ =AH|(U)^^=AH5|(UY)=AY5| G(U)#=|G(U)%=|G(U)#=W|#N(U)=YUW|@(U)=UW|(U)=YUW| (V) =VIY4|(VIEW)=VYUW5|(V)=V| (W) =DAH4BULYUW| (WERE)=WER|(WA)SH=WAA|(WA)ST=WEY|(WA)S=WAH|(WA)T=WAA|(WHERE)=WHEHR|(WHAT)=WHAHT|(WHOL)=/HOWL|(WHO)=/HUW|(WH)=WH|(WAR)#=WEHR|(WAR)=WAOR|(WOR)^=WER|(WR)=R|(WOM)A=WUHM|(WOM)E=WIHM|(WEA)R=WEH|(WANT)=WAA5NT|ANS(WER)=ER|(W)=W| (X) =EH4KR| (X)=Z|(X)=KS| (Y) =WAY4|(YOUNG)=YAHNX| (YOUR)=YOHR| (YOU)=YUW| (YES)=YEHS| (Y)=Y|F(Y)=AY|PS(YCH)=AYK|#:^(Y)=IY|#:^(Y)I=IY| :(Y) =AY| :(Y)#=AY| :(Y)^+:#=IH| :(Y)^#=AY|(Y)=IH| (Z) =ZIY4|(Z)=Z".split("|").map(e=>{let t=ki(e),n=t.c;Si[n]=Si[n]||[],Si[n].push(t)});let Mi=gi.split("|").map(ki),Ni="*12345678".split(""),Ci=" *.*?*,*-*IYIHEHAEAAAHAOUHAXIXERUXOHRXLXWXYXWHR*L*W*Y*M*N*NXDXQ*S*SHF*TH/H/XZ*ZHV*DHCH**J*******EYAYOYAWOWUWB*****D*****G*****GX****P*****T*****K*****KX****ULUMUN".match(/.{1,2}/g),Ei=[32768,49408,49408,49408,49408,164,164,164,164,164,164,132,132,164,164,132,132,132,132,132,132,132,68,4164,4164,4164,4164,2124,3148,2124,1096,16460,9280,8256,8256,9280,64,64,9284,8260,8260,9284,8264,8256,76,8260,0,0,180,180,180,148,148,148,78,78,78,1102,1102,1102,78,78,78,78,78,78,75,75,75,1099,1099,1099,75,75,75,75,75,75,128,193,193],Pi=[0,4626,4626,4626,2056,2824,2312,2824,3592,3851,2822,4108,3082,1541,1541,3595,3082,3594,3082,2825,2056,2055,2825,2567,2310,2056,2054,2055,2055,2055,770,1285,514,514,514,514,514,514,1542,1542,2055,1542,1542,514,2312,1027,513,286,3597,3852,3852,3852,3598,3593,2054,513,514,1797,513,257,1798,513,514,1798,513,514,2056,514,514,1540,514,514,1798,513,1028,1798,257,1028,1479,1535],Ti=(e,t)=>{let n=Ci.findIndex(n=>n===e+t&&"*"!==n[1]);return-1!==n&&n},Ai=e=>{let t=Ci.findIndex(t=>t===e+"*");return-1!==t&&t},_i=(e,t)=>ci(Ei[e],t),Ii=128,Di=e=>{if(!e)return!1;let t=e=>{if(e<0||e>l.length)throw new Error("Out of bounds: "+e);return e===l.length?null:l[e]},n=(e,t,n,r)=>{for(let c=l.length-1;c>=e;c--)l[c+1]=l[c],i[c+1]=s(c),o[c+1]=a(c);l[e]=t,i[e]=0|r,o[e]=n},a=e=>0|o[e],s=e=>0|i[e],r=(e,t)=>{if(128&t)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");if(e<0||e>l.length)throw new Error("Out of bounds: "+e);i[e]=t},o=[],i=[],l=[],c=0;return((e,t,n)=>{for(let a=0;a<e.length;a++){e.toLowerCase();let s,r=e[a],o=e[a+1]||"";if(!1===(s=Ti(r,o)))if(!1===(s=Ai(r))){for(s=Ni.length;r!==Ni[s]&&s>0;)--s;if(0===s)throw Error(`Could not parse char ${r}`);n(s)}else t(s);else a++,t(s)}})(e,e=>{o[c]=0,i[c]=0,l[c++]=e},e=>{if(128&e)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");o[c-1]=e}),Oi(l,i,o),((e,t,n,a)=>{let s,r=(s,r)=>{switch(s){case 53:_i(n(r-1),1024)&&t(r,16);break;case 42:e(r+1,43,a(r));break;case 44:e(r+1,45,a(r))}},o=(n,s)=>{t(n,13),e(n+1,s,a(n))},i=-1;for(;null!==(s=n(++i));){if(0===s)continue;if(_i(s,16)){e(i+1,_i(s,32)?21:20,a(i)),r(s,i);continue}if(78===s){o(i,24);continue}if(79===s){o(i,27);continue}if(80===s){o(i,28);continue}if(_i(s,Ii)&&a(i)){0===n(i+1)&&(s=n(i+2),null!==s&&_i(s,Ii)&&a(i+2)&&e(i+2,31,0));continue}let l=0===i?null:n(i-1);if(23!==s)if(24===s&&_i(l,Ii))t(i,19);else if(60!==l||32!==s){if(60===s){let e=n(i+1);_i(e,32)||null===e||t(i,63);continue}if(72===s){let e=n(i+1);_i(e,32)&&null!==e||(t(i,75),s=75)}_i(s,1)&&32===l?t(i,s-12):_i(s,1)||r(s,i),69!==s&&57!==s||i>0&&_i(n(i-1),Ii)&&(s=n(i+1),0===s&&(s=n(i+2)),_i(s,Ii)&&!a(i+1)&&t(i,30))}else t(i,38);else switch(l){case 69:t(i-1,42);break;case 57:t(i-1,44);break;default:_i(l,Ii)&&t(i,18)}}})(n,(e,t)=>{l[e]=t},t,a),((e,t,n)=>{let a,s=0;for(;null!==(a=e(s));){if(_i(a,64)&&(a=e(s+1),null!==a&&_i(a,Ii))){let e=t(s+1);0!==e&&e<128&&n(s,e+1)}++s}})(t,a,(e,t)=>{o[e]=t}),((e,t,n)=>{let a,s=0;for(;null!==(a=e(s));){let e=t(s);n(s,0===e||e>127?255&Pi[a]:Pi[a]>>8),s++}})(t,a,r),((e,t,n)=>{for(let r=0;null!==e(r);r++){if(!_i(e(r),256))continue;let a=r;for(;--r>1&&!_i(e(r),Ii););if(0===r)break;for(;r<a;r++)if(!_i(e(r),8192)||_i(e(r),4)){let e=n(r);t(r,(e>>1)+e+1)}}let a,s=-1;for(;null!==(a=e(++s));){let r=s;if(_i(a,Ii)){if(a=e(++r),!_i(a,64)){18!==a&&19!==a||!_i(e(++r),64)||t(s,n(s)-1);continue}let o=null===a?65:Ei[a];if(!ci(o,4)){if(ci(o,1)){let e=n(s);t(s,e-(e>>3))}continue}let i=n(s);t(s,(i>>2)+i+1);continue}if(_i(a,2048))a=e(++r),null!==a&&_i(a,2)&&(t(r,6),t(r-1,5));else if(_i(a,2)){for(;0===(a=e(++r)););null!==a&&_i(a,2)&&(t(r,1+(n(r)>>1)),t(s,1+(n(s)>>1)))}else r>0&&_i(a,4096)&&_i(e(r-1),2)&&t(r,n(r)-2)}})(t,r,s),((e,t,n)=>{let a,s=-1;for(;null!==(a=e(++s));)if(_i(a,2)){if(_i(a,1)){let t,n=s;do{t=e(++n)}while(0===t);if(null!==t&&(_i(t,8)||36===t||37===t))continue}t(s+1,a+1,n(s),255&Pi[a+1]),t(s+2,a+2,n(s),255&Pi[a+2]),s+=2}})(t,n,a),Oi(l,i,o),l.map((e,t)=>e?[e,0|i[t],0|o[t]]:null).filter(e=>e)},Oi=(e,t,n)=>{for(let a=0;a<e.length;a++){}},Fi=[24,26,23,23,23],Ri=[0,224,230,236,243,249,0,6,12,6],ji=[0,31,31,31,31,2,2,2,2,2,2,2,2,2,5,5,2,10,2,8,5,5,11,10,9,8,8,160,8,8,23,31,18,18,18,18,30,30,20,20,20,20,23,23,26,26,29,29,2,2,2,2,2,2,26,29,27,26,29,27,26,29,27,26,29,27,23,29,23,23,29,23,23,29,23,23,29,23,23,23],Li=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,4,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,0,1,0,1,0,5,5,5,5,5,4,4,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,1,3,0,2,3,0,2,160,160],Bi=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3,3,3,3,1,2,3,2,1,3,3,3,3,1,1,3,3,3,2,2,3,2,3,0,0,5,5,5,5,4,4,2,0,2,2,0,3,2,0,4,2,0,3,2,0,2,2,0,2,3,0,3,3,0,3,176,160],Vi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,241,226,211,187,124,149,1,2,3,3,0,114,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,25,0,0,0,0,0,0,0,0,0],zi=[0,5980947,5980947,5980947,5980947,7230474,6113550,5980947,5783320,5842971,5712919,5775125,5383440,5844244,6113550,4075794,5383182,5774866,4076306,7218448,5250317,6112527,5904395,3944978,7216654,5904395,7230217,5320198,7943686,6641158,7943686,5980945,6506758,6967046,5315078,7946758,6113550,5383440,6107913,6767114,4990984,6106890,6639366,6639366,7946758,6639365,7958022,0,5916691,5777179,5775125,5778203,5774866,5382669,5315078,5315078,5315078,7946758,7946758,7946758,7368198,7237126,7237126,6181894,6181894,6181894,5315078,5315078,5315078,7946758,7946758,7946758,6647046,6641162,7367946,6181894,6181894,6181894,556844,98067],Ui=[0,0,0,0,0,526861,461581,527630,527887,68879,68623,3087,68367,2316,461581,330508,68623,3087,396301,67597,2061,461838,2061,330252,67597,2061,526861,780,2313,198153,0,0,0,0,0,0,0,0,779,66827,779,1035,0,0,1,66827,920064,66050,593422,68879,3087,68879,3087,2061,2,260,0,2,260,0,1,260,0,1,260,0,0,0,0,0,0,0,0,461324,0,0,330240,0,1245199,1048591],Gi=[56,132,107,25,198,99,24,134,115,152,198,177,28,202,49,140,199,49,136,194,48,152,70,49,24,198,53,12,202,49,12,198,33,16,36,105,18,194,49,20,196,113,8,74,34,73,171,106,168,172,73,81,50,213,82,136,147,108,148,34,21,84,210,37,150,212,80,165,70,33,8,133,107,24,196,99,16,206,107,24,140,113,25,140,99,53,12,198,51,153,204,108,181,78,162,153,70,33,40,130,149,46,227,48,156,197,48,156,162,177,156,103,49,136,102,89,44,83,24,132,103,80,202,227,10,172,171,48,172,98,48,140,99,16,148,98,177,140,130,40,150,51,152,214,181,76,98,41,165,74,181,156,198,49,20,214,56,156,75,180,134,101,24,174,103,28,166,99,25,150,35,25,132,19,8,166,82,172,202,34,137,110,171,25,140,98,52,196,98,25,134,99,24,196,35,88,214,163,80,66,84,74,173,74,37,17,107,100,137,74,99,57,138,35,49,42,234,162,169,68,197,18,205,66,52,140,98,24,140,99,17,72,102,49,157,68,51,29,70,49,156,198,177,12,205,50,136,196,115,24,134,115,8,214,99,88,7,129,224,240,60,7,135,144,60,124,15,199,192,192,240,124,30,7,128,128,0,28,120,112,241,199,31,192,12,254,28,31,31,14,10,122,192,113,242,131,143,3,15,15,12,0,121,248,97,224,67,15,131,231,24,249,193,19,218,233,99,143,15,131,131,135,195,31,60,112,240,225,225,227,135,184,113,14,32,227,141,72,120,28,147,135,48,225,193,193,228,120,33,131,131,195,135,6,57,229,195,135,7,14,28,28,112,244,113,156,96,54,50,195,30,60,243,143,14,60,112,227,199,143,15,15,14,60,120,240,227,135,6,240,227,7,193,153,135,15,24,120,112,112,252,243,16,177,140,140,49,124,112,225,134,60,100,108,176,225,227,15,35,143,15,30,62,56,60,56,123,143,7,14,60,244,23,30,60,120,242,158,114,73,227,37,54,56,88,57,226,222,60,120,120,225,199,97,225,225,176,240,240,195,199,14,56,192,240,206,115,115,24,52,176,225,199,142,28,60,248,56,240,225,193,139,134,143,28,120,112,240,120,172,177,143,57,49,219,56,97,195,14,14,56,120,115,23,30,57,30,56,100,225,241,193,78,15,64,162,2,197,143,129,161,252,18,8,100,224,60,34,224,69,7,142,12,50,144,240,31,32,73,224,248,12,96,240,23,26,65,170,164,208,141,18,130,30,30,3,248,62,3,12,115,128,112,68,38,3,36,225,62,4,78,4,28,193,9,204,158,144,33,7,144,67,100,192,15,198,144,156,193,91,3,226,29,129,224,94,29,3,132,184,44,15,128,177,131,224,48,65,30,67,137,131,80,252,36,46,19,131,241,124,76,44,201,13,131,176,181,130,228,232,6,156,7,160,153,29,7,62,130,143,112,48,116,64,202,16,228,232,15,146,20,63,6,248,132,136,67,129,10,52,57,65,198,227,28,71,3,176,184,19,10,194,100,248,24,249,96,179,192,101,32,96,166,140,195,129,32,48,38,30,28,56,211,1,176,38,64,244,11,195,66,31,133,50,38,96,64,201,203,1,236,17,40,64,250,4,52,224,112,76,140,29,7,105,3,22,200,4,35,232,198,154,11,26,3,224,118,6,5,207,30,188,88,49,113,102,0,248,63,4,252,12,116,39,138,128,113,194,58,38,6,192,31,5,15,152,64,174,1,127,192,7,255,0,14,254,0,3,223,128,3,239,128,27,241,194,0,231,224,24,252,224,33,252,128,60,252,64,14,126,0,63,62,0,15,254,0,31,255,0,62,240,7,252,0,126,16,63,255,0,63,56,14,124,1,135,12,252,199,0,62,4,15,62,31,15,15,31,15,2,131,135,207,3,135,15,63,192,7,158,96,63,192,3,254,0,63,224,119,225,192,254,224,195,224,1,223,248,3,7,0,126,112,0,124,56,24,254,12,30,120,28,124,62,14,31,30,30,62,0,127,131,7,219,135,131,7,199,7,16,113,255,0,63,226,1,224,193,195,225,0,127,192,5,240,32,248,240,112,254,120,121,248,2,63,12,143,3,15,159,224,193,199,135,3,195,195,176,225,225,193,227,224,113,240,0,252,112,124,12,62,56,14,28,112,195,199,3,129,193,199,231,0,15,199,135,25,9,239,196,51,224,193,252,248,112,240,120,248,240,97,199,0,31,248,1,124,248,240,120,112,60,124,206,14,33,131,207,8,7,143,8,193,135,143,128,199,227,0,7,248,224,239,0,57,247,128,14,248,225,227,248,33,159,192,255,3,248,7,192,31,248,196,4,252,196,193,188,135,240,15,192,127,5,224,37,236,192,62,132,71,240,142,3,248,3,251,192,25,248,7,156,12,23,248,7,224,31,161,252,15,252,1,240,63,0,254,3,240,31,0,253,0,255,136,13,249,1,255,0,112,7,192,62,66,243,13,196,127,128,252,7,240,94,192,63,0,120,63,129,255,1,248,1,195,232,12,228,100,143,228,15,240,7,240,194,31,0,127,192,111,128,126,3,248,7,240,63,192,120,15,130,7,254,34,119,112,2,118,3,254,0,254,103,0,124,199,241,142,198,59,224,63,132,243,25,216,3,153,252,9,184,15,248,0,157,36,97,249,13,0,253,3,240,31,144,63,1,248,31,208,15,248,55,1,248,7,240,15,192,63,0,254,3,248,15,192,63,0,250,3,240,15,128,255,1,184,7,240,1,252,1,188,128,19,30,0,127,225,64,127,160,127,176,0,63,192,31,192,56,15,240,31,128,255,1,252,3,241,126,1,254,1,240,255,0,127,192,29,7,240,15,192,126,6,224,7,224,15,248,6,193,254,1,252,3,224,15,0,252],Wi=(e,t,n,a,s)=>{let r=((e,t)=>{let n=(e,t)=>(e*t>>8&255)<<1,a=[[],[],[]];zi.map((e,t)=>{a[0][t]=255&e,a[1][t]=e>>8&255,a[2][t]=e>>16&255});for(let s=5;s<30;s++)a[0][s]=n(e,a[0][s]),a[1][s]=n(t,a[1][s]);for(let s=48;s<54;s++)a[0][s]=n(e,a[0][s]),a[1][s]=n(t,a[1][s]);return a})(n,a);const[o,i,l,c]=((e,t,n)=>{let a=(e,t,n)=>{let a,s=t;for(t<30?t=0:t-=30;127===(a=n[t]);)++t;for(;t!==s;)for(a+=e,n[t]=255&a;++t!==s&&255===n[t];);},s=[],r=[[],[],[]],o=[[],[],[]],i=[],l=0;for(let c=0;c<t.length;c++){let d=t[c][0];1===d?a(1,l,s):2===d&&a(255,l,s);let u=Ri[t[c][2]];for(let a=t[c][1];a>0;a--)r[0][l]=n[0][d],r[1][l]=n[1][d],r[2][l]=n[2][d],o[0][l]=255&Ui[d],o[1][l]=Ui[d]>>8&255,o[2][l]=Ui[d]>>16&255,i[l]=Vi[d],s[l]=e+u&255,l++}return[s,r,o,i]})(t,e,r);let d=((e,t,n,a)=>{let s,r,o=[e,t[0],t[1],t[2],n[0],n[1],n[2]],i=(e,t)=>{if(e<0||e>o.length-1)throw new Error(`Error invalid table in Read: ${e}`);return o[e][t]},l=(e,t,n,a)=>{let s=a<0,r=Math.abs(a)%e,l=a/e|0,c=0,d=e;for(;--d>0;){let a=i(t,n)+l;if(c+=r,c>=e&&(c-=e,s?a--:a&&a++),t<0||t>o.length-1)throw new Error(`Error invalid table in Read: ${t}`);o[t][++n]=a,a+=l}},c=0;for(let d=0;d<a.length-1;d++){let t=a[d][0],n=a[d+1][0],o=ji[n],u=ji[t];u===o?(s=Li[t],r=Li[n]):u<o?(s=Bi[n],r=Li[n]):(s=Li[t],r=Bi[t]),c+=a[d][1];let p=c+r,h=c-s,m=s+r;if(!(m-2&128)){let t=a[d][1]>>1,n=a[d+1][1]>>1;l(t+n,0,h,e[c+n]-e[c-t]);for(let e=1;e<7;e++)l(m,e,h,i(e,p)-i(e,h))}}return c+a[a.length-1][1]})(o,i,l,e);if(!s)for(let p=0;p<o.length;p++)o[p]-=i[0][p]>>1;let u=[0,1,2,2,2,3,3,4,4,5,6,8,9,11,13,15];for(let p=l[0].length-1;p>=0;p--)l[0][p]=u[l[0][p]],l[1][p]=u[l[1][p]],l[2][p]=u[l[2][p]];return[d,i,o,l,c]},Ki=(e,t,n,a)=>{let s=(7&n)-1,r=256*s&65535,o=248&n,i=(t,n,a,s)=>{let i=8,l=Gi[r+o];do{128&l?e(t,n):e(a,s),l<<=1}while(--i)};if(0===o){let e=a>>4^255;o=255&t;do{i(3,26,4,6),o++,o&=255}while(255&++e);return o}o^=255;let l=255&Fi[s];do{i(2,5,1,l)}while(255&++o);return t},Hi=e=>127*Math.sin(2*Math.PI*(e/256))|0,$i=(e,t,n,a,s,r)=>{s=255&(s||72);let o=Wi(e,t=void 0===t?64:255&t,n=void 0===n?128:255&n,a=void 0===a?128:255&a,r=r||!1),i=(e=>{let t=new Uint8Array(e),n=0,a=0,s=(e,t)=>{let n=16*(15&t);s.ary(e,[n,n,n,n,n])};return s.ary=(e,s)=>{if(n+=[[162,167,167,127,128],[226,60,60,0,0],[225,60,59,0,0],[200,0,0,54,55],[199,0,0,54,54]][a][e],(n/50|0)>t.length)throw new Error(`Buffer overflow, want ${n/50|0} but buffersize is only ${t.length}!`);a=e;for(let a=0;a<5;a++)t[(n/50|0)+a]=s[a]},s.get=()=>t.slice(0,n/50|0),s})(176.4*e.reduce((e,t)=>e+t[1],0)*s|0);const[l,c,d,u,p]=o;return qi(d,c,u,p),((e,t,n,a,s,r,o)=>{let i=n,l=0,c=0,d=0,u=0,p=0,h=s[0],m=.75*h|0;for(;t;){let f=o[p];if(248&f)u=Ki(e,u,f,s[255&p]),p+=2,t-=2,i=n;else{{let t=[],n=256*l,s=256*c,o=256*d;for(let e=0;e<5;e++){const i=Hi(255&n>>8),l=Hi(255&s>>8),c=(255&o>>8)<129?-112:112;let d=i*(15&r[0][p])+l*(15&r[1][p])+c*(15&r[2][p]);d/=32,d+=128,t[e]=0|d,n+=256*a[0][p]/4,s+=256*a[1][p]/4,o+=256*a[2][p]/4}e.ary(0,t)}if(i--,0===i){if(p++,0===--t)return;i=n}if(h--,0!==h){if(m--,0!==m||0===f){l+=a[0][p],c+=a[1][p],d+=a[2][p];continue}u=Ki(e,u,f,s[255&p])}}h=s[p],m=.75*h|0,l=0,c=0,d=0}})(i,l,s,c,d,u,p),i.get()},qi=(e,t,n,a)=>{for(let s=0;s<a.length;s++)s++},Yi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Di(e);return!1!==n&&$i(n,t.pitch,t.mouth,t.throat,t.speed,t.singmode)},Xi=e=>{let t=" "+e.toUpperCase(),n=0,a="",s=(e,t)=>{n+=t,a+=e},r=0;for(;n<t.length&&r++<1e4;){t.toLowerCase();let e=t[n];if("."!==e||xi(t,n+1,1)){if(bi(e,2)){Mi.some(e=>e(t,n,s));continue}if(0!==yi[e]){if(!bi(e,vi))return!1;Si[e].some(e=>e(t,n,s));continue}a+=" ",n++}else a+=".",n++}return a},Qi=Yi,Zi=(e,t)=>{let n=Yi(e,t);return!1!==n&&(e=>{let t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=(e[n]-128)/256;return t})(n)};function Ji(e){let t=e||{},n=(e,n)=>n||t.phonetic?e.toUpperCase():Xi(e);this.buf8=(e,a)=>Qi(n(e,a),t),this.buf32=(e,a)=>Zi(n(e,a),t),this.speak=(e,t)=>mi(this.buf32(e,t)),this.download=(e,t)=>{(e=>{let t=new Blob([fi(e)],{type:"audio/vnd.wave"}),n=window.URL||window.webkitURL,a=n.createObjectURL(t),s=document.createElement("a");s.href=a,s.target="_blank",s.download="sam.wav",document.body.appendChild(s),s.click(),document.body.removeChild(s),n.revokeObjectURL(a)})(this.buf8(e,t))},this.wav=(e,t)=>fi(this.buf8(e,t))}Ji.buf8=Qi,Ji.buf32=Zi,Ji.convert=Xi;class el{name="SAMSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={...e},this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._sam=new Ji({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()}async ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch(e){}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const n=this.audioContext.createBufferSource();n.buffer=this._buffer,n.loop=this._config.singmode,n.connect(this._playerGain),n.onended=()=>{this._sourceNode===n&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=n,n.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,this._config.phonetic);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const n=this._isPlaying;this._buffer=t,n&&this._config.singmode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.mouth&&e.mouth!==this._config.mouth||void 0!==e.throat&&e.throat!==this._config.throat||void 0!==e.singmode&&e.singmode!==this._config.singmode||void 0!==e.phonetic&&e.phonetic!==this._config.phonetic;this._config={...this._config,...e},void 0!==e.singmode&&this._sourceNode&&(this._sourceNode.loop=e.singmode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{this._sam=new Ji({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()},50))}triggerAttack(e,t,n=1){if(this._buffer)if(this._config.singmode){const a="string"==typeof e?rs(e):e,s=Math.pow(2,(a-60)/12);this._isPlaying&&this._sourceNode?this._sourceNode.playbackRate.value=s:(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s)),this._playerGain.gain.value=n}else this._startSource(t),this._playerGain.gain.value=n}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a)}triggerRelease(){}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}class tl{name="V2Synth";output;_worklet=null;_initialized=!1;_initPromise;_pendingNotes=[];_releaseTimers=new Set;_initialConfig;constructor(e){this.output=Ja().createGain(),this._initialConfig=e,this._initPromise=this._initialize()}async _initialize(){const e=Ja();if("running"!==e.state){try{await e.resume()}catch{}"running"!==e.state&&await Promise.race([new Promise(t=>{const n=()=>{"running"===e.state?t():setTimeout(n,100)};setTimeout(n,100)}),new Promise((e,t)=>setTimeout(()=>t(new Error("AudioContext not running after 5s")),5e3))])}const t="/DEViLBOX/",n=`?v=${Date.now()}`;try{await e.audioWorklet.addModule(`${t}V2Synth.worklet.js${n}`)}catch(l){}const[a,s]=await Promise.all([fetch(`${t}V2Synth.wasm${n}`,{cache:"no-store"}),fetch(`${t}V2Synth.js${n}`,{cache:"no-store"})]);if(!a.ok)throw new Error(`Failed to load V2Synth.wasm: ${a.status}`);if(!s.ok)throw new Error(`Failed to load V2Synth.js: ${s.status}`);const[r,o]=await Promise.all([a.arrayBuffer(),s.text()]),i='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+o.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/(_malloc=wasmExports\["\w+"\])/,'$1;Module["_malloc"]=_malloc').replace(/(_free=wasmExports\["\w+"\])/,'$1;Module["_free"]=_free');this._worklet=new AudioWorkletNode(e,"v2-synth-processor",{outputChannelCount:[2]}),await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("V2Synth initialization timeout after 10s"))},1e4);this._worklet.port.onmessage=t=>{"ready"===t.data.type?(clearTimeout(n),this._initialized=!0,this._initialConfig&&this._applyV2Config(this._initialConfig),this._pendingNotes.forEach(e=>this._sendMIDI([144,e.note,e.vel])),this._pendingNotes=[],e()):t.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:i})}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch(l){}}async ready(){return this._initPromise}async ensureInitialized(){return this._initPromise}triggerAttack(e,t,n=1){const a="string"==typeof e?rs(e):e,s=Math.floor(127*n);this._initialized?this._sendMIDI([144,a,s]):this._pendingNotes.push({note:a,vel:s})}triggerRelease(e){this._initialized}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,void 0,a);const s="string"==typeof e?rs(e):e,r="number"==typeof t?t:parseFloat(String(t)),o=setTimeout(()=>{this._releaseTimers.delete(o),this._initialized&&this._worklet&&this._sendMIDI([128,s,0])},1e3*r);this._releaseTimers.add(o)}setParameter(e,t){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"param",index:e,value:t})}applyConfig(e){this._initialized?this._applyV2Config(e):this._initialConfig=e}_applyV2Config(e){e.osc1&&(this.setParameter(2,e.osc1.mode),this.setParameter(4,e.osc1.transpose+64),this.setParameter(5,e.osc1.detune+64),this.setParameter(6,e.osc1.color),this.setParameter(7,e.osc1.level)),e.osc2&&(this.setParameter(8,e.osc2.mode),this.setParameter(9,e.osc2.ringMod?1:0),this.setParameter(10,e.osc2.transpose+64),this.setParameter(11,e.osc2.detune+64),this.setParameter(12,e.osc2.color),this.setParameter(13,e.osc2.level)),e.osc3&&(this.setParameter(14,e.osc3.mode),this.setParameter(15,e.osc3.ringMod?1:0),this.setParameter(16,e.osc3.transpose+64),this.setParameter(17,e.osc3.detune+64),this.setParameter(18,e.osc3.color),this.setParameter(19,e.osc3.level)),e.filter1&&(this.setParameter(20,e.filter1.mode),this.setParameter(21,e.filter1.cutoff),this.setParameter(22,e.filter1.resonance)),e.filter2&&(this.setParameter(23,e.filter2.mode),this.setParameter(24,e.filter2.cutoff),this.setParameter(25,e.filter2.resonance)),e.routing&&(this.setParameter(26,e.routing.mode),this.setParameter(27,e.routing.balance)),e.envelope&&(this.setParameter(32,e.envelope.attack),this.setParameter(33,e.envelope.decay),this.setParameter(34,e.envelope.sustain),this.setParameter(36,e.envelope.release)),e.envelope2&&(this.setParameter(38,e.envelope2.attack),this.setParameter(39,e.envelope2.decay),this.setParameter(40,e.envelope2.sustain),this.setParameter(42,e.envelope2.release)),e.lfo1&&(this.setParameter(47,e.lfo1.rate),this.setParameter(50,e.lfo1.depth))}_sendMIDI(e){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"midi",msg:e})}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._initialized=!1,this._worklet&&this._worklet.disconnect(),this.output.disconnect()}}class nl{name="V2SpeechSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;constructor(e){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,...e},this._readyPromise=new Promise(e=>{this._readyResolve=e});const t=Math.round(this._config.pitch/127*255),n=Math.round(this._config.speed/127*255),a=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+a)),r=Math.max(0,Math.min(255,128-a));this._sam=new Ji({pitch:t,speed:n,mouth:Math.round(s),throat:Math.round(r),singmode:this._config.singMode,phonetic:!1}),this._render()}async ready(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch(e){}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const n=this.audioContext.createBufferSource();n.buffer=this._buffer,n.loop=this._config.singMode,n.connect(this._playerGain),n.onended=()=>{this._sourceNode===n&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=n,n.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,!1);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const n=this._isPlaying;this._buffer=t,n&&this._config.singMode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.formantShift&&e.formantShift!==this._config.formantShift||void 0!==e.singMode&&e.singMode!==this._config.singMode;this._config={...this._config,...e},void 0!==e.singMode&&this._sourceNode&&(this._sourceNode.loop=e.singMode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{const e=Math.round(this._config.pitch/127*255),t=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,a=Math.max(0,Math.min(255,128+n)),s=Math.max(0,Math.min(255,128-n));this._sam=new Ji({pitch:e,speed:t,mouth:Math.round(a),throat:Math.round(s),singmode:this._config.singMode,phonetic:!1}),this._render()},50))}triggerAttack(e,t,n=1){if(this._buffer)if(this._config.singMode){const a="string"==typeof e?rs(e):e,s=Math.pow(2,(a-60)/12);this._isPlaying&&this._sourceNode?this._sourceNode.playbackRate.value=s:(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s)),this._playerGain.gain.value=n}else this._startSource(t),this._playerGain.gain.value=n}triggerRelease(e){}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a)}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}const al={ARGURU_DISTORTION:"ArguruDistortion",ELAK_DIST2:"ElakDist2",JESKOLA_DISTORTION:"JeskolaDistortion",GEONIK_OVERDRIVE:"GeonikOverdrive",GRAUE_SOFTSAT:"GraueSoftSat",WHITENOISE_STEREODIST:"WhiteNoiseStereoDist",ELAK_SVF:"ElakSVF",CYANPHASE_NOTCH:"CyanPhaseNotch",Q_ZFILTER:"QZfilter",FSM_PHILTA:"FSMPhilta",JESKOLA_DELAY:"JeskolaDelay",JESKOLA_CROSSDELAY:"JeskolaCrossDelay",JESKOLA_FREEVERB:"JeskolaFreeverb",FSM_PANZERDELAY:"FSMPanzerDelay",FSM_CHORUS:"FSMChorus",FSM_CHORUS2:"FSMChorus2",WHITENOISE_WHITECHORUS:"WhiteNoiseWhiteChorus",BIGYO_FREQUENCYSHIFTER:"BigyoFrequencyShifter",GEONIK_COMPRESSOR:"GeonikCompressor",LD_SLIMIT:"LdSLimit",OOMEK_EXCITER:"OomekExciter",OOMEK_MASTERIZER:"OomekMasterizer",DEDACODE_STEREOGAIN:"DedaCodeStereoGain",FSM_KICK:"FSMKick",FSM_KICKXP:"FSMKickXP",JESKOLA_TRILOK:"JeskolaTrilok",JESKOLA_NOISE:"JeskolaNoise",OOMEK_AGGRESSOR:"OomekAggressor",OOMEK_AGGRESSOR_DF:"OomekAggressorDF",MADBRAIN_4FM2F:"MadBrain4FM2F",MADBRAIN_DYNAMITE6:"MadBrainDynamite6",MAKK_M3:"MakkM3",MAKK_M4:"MakkM4",CYANPHASE_DTMF:"CyanPhaseDTMF",ELENZIL_FREQUENCYBOMB:"ElenzilFrequencyBomb"},sl={[al.ARGURU_DISTORTION]:{name:"Arguru Distortion",shortName:"Distortion",author:"Arguru",type:"effect",parameters:[{index:0,name:"Input Gain",description:"Input Gain",minValue:1,maxValue:2048,defaultValue:256,type:"word"},{index:1,name:"Threshold (-)",description:"Threshold level (negative)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:2,name:"Threshold (+)",description:"Threshold level (positive)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:3,name:"Output Gain",description:"Output Gain",minValue:1,maxValue:2048,defaultValue:1024,type:"word"},{index:4,name:"Phase Inversor",description:"Stereo phase inversor",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:5,name:"Mode",description:"Operational mode (0=Clip, 1=Saturate)",minValue:0,maxValue:1,defaultValue:0,type:"byte"}]},[al.ELAK_SVF]:{name:"Elak SVF Filter",shortName:"SVF",author:"Elak",type:"effect",parameters:[{index:0,name:"Cutoff",description:"Cut-off frequency",minValue:0,maxValue:1e3,defaultValue:512,type:"word"},{index:1,name:"Resonance",description:"Resonance",minValue:0,maxValue:65534,defaultValue:512,type:"word"}]},[al.FSM_KICK]:{name:"FSM Kick",shortName:"Kick",author:"FSM",type:"generator",parameters:[]},[al.FSM_KICKXP]:{name:"FSM KickXP",shortName:"KickXP",author:"FSM",type:"generator",parameters:[]},[al.JESKOLA_TRILOK]:{name:"Jeskola Trilok",shortName:"Trilok",author:"Jeskola",type:"generator",parameters:[]},[al.JESKOLA_NOISE]:{name:"Jeskola Noise",shortName:"Noise",author:"Jeskola",type:"generator",parameters:[]},[al.OOMEK_AGGRESSOR]:{name:"Oomek Aggressor",shortName:"Aggressor",author:"Oomek",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"}]},[al.OOMEK_AGGRESSOR_DF]:{name:"Oomek Aggressor Devil Fish",shortName:"AggressorDF",author:"Oomek + Devil Fish Mods",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Normal envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:8,name:"Accent Decay",description:"Accent envelope decay time (Devil Fish)",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:9,name:"VEG Decay",description:"Volume envelope decay (Devil Fish)",minValue:0,maxValue:128,defaultValue:96,type:"byte"},{index:10,name:"VEG Sustain",description:"Volume envelope sustain 0-100% (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:11,name:"Soft Attack",description:"Soft attack time 0.3-30ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:12,name:"Filter Tracking",description:"Filter tracking 0-200% (Devil Fish)",minValue:0,maxValue:200,defaultValue:0,type:"byte"},{index:13,name:"High Resonance",description:"High resonance mode - self oscillation (Devil Fish)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:14,name:"Slide Time",description:"Slide/glide time 10-500ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:30,type:"byte"},{index:15,name:"Muffler",description:"Output soft clipping 0=off, 1=soft, 2=hard (Devil Fish)",minValue:0,maxValue:2,defaultValue:0,type:"byte"},{index:16,name:"Sweep Speed",description:"Accent sweep speed 0=fast, 1=normal, 2=slow (Devil Fish)",minValue:0,maxValue:2,defaultValue:1,type:"byte"}]},[al.MADBRAIN_4FM2F]:{name:"MadBrain 4FM2F",shortName:"4FM2F",author:"MadBrain",type:"generator",parameters:[]},[al.MADBRAIN_DYNAMITE6]:{name:"MadBrain Dynamite6",shortName:"Dynamite6",author:"MadBrain",type:"generator",parameters:[]},[al.MAKK_M3]:{name:"Makk M3",shortName:"M3",author:"Makk",type:"generator",parameters:[]},[al.MAKK_M4]:{name:"Makk M4",shortName:"M4",author:"Makk",type:"generator",parameters:[]},[al.ELAK_DIST2]:{name:"Elak Dist2",shortName:"Dist2",author:"Elak",type:"effect",parameters:[]},[al.JESKOLA_DISTORTION]:{name:"Jeskola Distortion",shortName:"JDist",author:"Jeskola",type:"effect",parameters:[]},[al.GEONIK_OVERDRIVE]:{name:"Geonik Overdrive",shortName:"Overdrive",author:"Geonik",type:"effect",parameters:[]},[al.GRAUE_SOFTSAT]:{name:"Graue SoftSat",shortName:"SoftSat",author:"Graue",type:"effect",parameters:[]},[al.WHITENOISE_STEREODIST]:{name:"WhiteNoise StereoDist",shortName:"StereoDist",author:"WhiteNoise",type:"effect",parameters:[]},[al.CYANPHASE_NOTCH]:{name:"CyanPhase Notch",shortName:"Notch",author:"CyanPhase",type:"effect",parameters:[]},[al.Q_ZFILTER]:{name:"Q Zfilter",shortName:"Zfilter",author:"Q",type:"effect",parameters:[]},[al.FSM_PHILTA]:{name:"FSM Philta",shortName:"Philta",author:"FSM",type:"effect",parameters:[]},[al.JESKOLA_DELAY]:{name:"Jeskola Delay",shortName:"JDelay",author:"Jeskola",type:"effect",parameters:[]},[al.JESKOLA_CROSSDELAY]:{name:"Jeskola CrossDelay",shortName:"CrossDelay",author:"Jeskola",type:"effect",parameters:[]},[al.JESKOLA_FREEVERB]:{name:"Jeskola Freeverb",shortName:"Freeverb",author:"Jeskola",type:"effect",parameters:[]},[al.FSM_PANZERDELAY]:{name:"FSM PanzerDelay",shortName:"PanzerDelay",author:"FSM",type:"effect",parameters:[]},[al.FSM_CHORUS]:{name:"FSM Chorus",shortName:"Chorus",author:"FSM",type:"effect",parameters:[]},[al.FSM_CHORUS2]:{name:"FSM Chorus2",shortName:"Chorus2",author:"FSM",type:"effect",parameters:[]},[al.WHITENOISE_WHITECHORUS]:{name:"WhiteNoise WhiteChorus",shortName:"WhiteChorus",author:"WhiteNoise",type:"effect",parameters:[]},[al.BIGYO_FREQUENCYSHIFTER]:{name:"Bigyo FrequencyShifter",shortName:"FreqShift",author:"Bigyo",type:"effect",parameters:[]},[al.GEONIK_COMPRESSOR]:{name:"Geonik Compressor",shortName:"Compressor",author:"Geonik",type:"effect",parameters:[]},[al.LD_SLIMIT]:{name:"Ld SLimit",shortName:"SLimit",author:"Ld",type:"effect",parameters:[]},[al.OOMEK_EXCITER]:{name:"Oomek Exciter",shortName:"Exciter",author:"Oomek",type:"effect",parameters:[]},[al.OOMEK_MASTERIZER]:{name:"Oomek Masterizer",shortName:"Masterizer",author:"Oomek",type:"master",parameters:[]},[al.DEDACODE_STEREOGAIN]:{name:"DedaCode StereoGain",shortName:"StereoGain",author:"DedaCode",type:"effect",parameters:[]},[al.CYANPHASE_DTMF]:{name:"CyanPhase DTMF",shortName:"DTMF",author:"CyanPhase",type:"generator",parameters:[]},[al.ELENZIL_FREQUENCYBOMB]:{name:"Elenzil FrequencyBomb",shortName:"FreqBomb",author:"Elenzil",type:"generator",parameters:[]}};class rl{static instance=null;isLoaded=!1;initPromise=null;workletNode=null;nativeContext=null;constructor(){}static getInstance(){return rl.instance||(rl.instance=new rl),rl.instance}async init(e){if(!this.isLoaded)return this.initPromise||(this.initPromise=this.doInit(e)),this.initPromise}async doInit(e){try{const t=e,n=t.rawContext||t._context||es(e);if(this.nativeContext=n,!n||!n.audioWorklet)return void(this.initPromise=null);if("running"!==n.state){try{await n.resume()}catch{}if("running"!==n.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===n.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const a="/DEViLBOX/",s=`?v=${Date.now()}`;await n.audioWorklet.addModule(`${a}Buzzmachine.worklet.js${s}`),this.isLoaded=!0}catch(t){throw this.initPromise=null,t}}isInitialized(){return this.isLoaded}async createMachineNode(e,t){this.isLoaded||await this.init(e);const n=e,a=n.rawContext||n._context||es(e),s=new AudioWorkletNode(a,"buzzmachine-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});return await this.loadMachineWasm(s,t),s}async loadMachineWasm(e,t){const n=this.getMachineFilename(t),a="/DEViLBOX/",[s,r]=await Promise.all([fetch(`${a}buzzmachines/${n}.js`),fetch(`${a}buzzmachines/${n}.wasm`)]);if(!s.ok||!r.ok)throw new Error(`Failed to load buzzmachine: ${t}`);const o=await s.text(),i=await r.arrayBuffer();return new Promise((n,a)=>{const s=setTimeout(()=>{a(new Error("Buzzmachine init timeout"))},5e3);e.port.onmessage=e=>{"initialized"===e.data.type?(clearTimeout(s),n()):"error"===e.data.type&&(clearTimeout(s),a(new Error(e.data.error)))},e.port.postMessage({type:"init",wasmBinary:i,jsCode:o,machineType:t})})}getMachineFilename(e){const t={[al.ARGURU_DISTORTION]:"Arguru_Distortion",[al.ELAK_DIST2]:"Elak_Dist2",[al.JESKOLA_DISTORTION]:"Jeskola_Distortion",[al.GEONIK_OVERDRIVE]:"Geonik_Overdrive",[al.GRAUE_SOFTSAT]:"Graue_SoftSat",[al.WHITENOISE_STEREODIST]:"WhiteNoise_StereoDist",[al.ELAK_SVF]:"Elak_SVF",[al.CYANPHASE_NOTCH]:"CyanPhase_Notch",[al.Q_ZFILTER]:"Q_Zfilter",[al.FSM_PHILTA]:"FSM_Philta",[al.JESKOLA_DELAY]:"Jeskola_Delay",[al.JESKOLA_CROSSDELAY]:"Jeskola_CrossDelay",[al.JESKOLA_FREEVERB]:"Jeskola_Freeverb",[al.FSM_PANZERDELAY]:"FSM_PanzerDelay",[al.FSM_CHORUS]:"FSM_Chorus",[al.FSM_CHORUS2]:"FSM_Chorus2",[al.WHITENOISE_WHITECHORUS]:"WhiteNoise_WhiteChorus",[al.BIGYO_FREQUENCYSHIFTER]:"Bigyo_FrequencyShifter",[al.GEONIK_COMPRESSOR]:"Geonik_Compressor",[al.LD_SLIMIT]:"Ld_SLimit",[al.OOMEK_EXCITER]:"Oomek_Exciter",[al.OOMEK_MASTERIZER]:"Oomek_Masterizer",[al.DEDACODE_STEREOGAIN]:"DedaCode_StereoGain",[al.FSM_KICK]:"FSM_Kick",[al.FSM_KICKXP]:"FSM_KickXP",[al.JESKOLA_TRILOK]:"Jeskola_Trilok",[al.JESKOLA_NOISE]:"Jeskola_Noise",[al.OOMEK_AGGRESSOR]:"Oomek_Aggressor",[al.OOMEK_AGGRESSOR_DF]:"Oomek_Aggressor_DF",[al.MADBRAIN_4FM2F]:"MadBrain_4FM2F",[al.MADBRAIN_DYNAMITE6]:"MadBrain_Dynamite6",[al.MAKK_M3]:"Makk_M3",[al.MAKK_M4]:"Makk_M4",[al.CYANPHASE_DTMF]:"CyanPhase_DTMF",[al.ELENZIL_FREQUENCYBOMB]:"Elenzil_FrequencyBomb"}[e];if(!t)throw new Error(`Unknown machine type: ${e}`);return t}setParameter(e,t,n){e.port.postMessage({type:"setParameter",paramIndex:t,paramValue:n})}stop(e){e.port.postMessage({type:"stop"})}getMachineInfo(e){return sl[e]}}class ol{name="BuzzmachineGenerator";output;audioContext;engine=rl.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;preGain=null;overdrive=null;overdriveDry=null;overdriveWet=null;mufflerFilter=null;postFilter=null;postGain=null;overdriveAmount=0;mufflerMode="off";filterTrackingAmount=0;currentCutoff=1e3;constructor(e){this.audioContext=Ja(),this.machineType=e,this.output=this.audioContext.createGain(),this.is303Style()&&this.createEffectsChain(),this.initEngine()}createEffectsChain(){const e=this.audioContext;this.preGain=e.createGain(),this.overdrive=e.createWaveShaper(),this.overdrive.oversample="2x",this.updateOverdriveCurve(.4),this.overdriveDry=e.createGain(),this.overdriveDry.gain.value=1,this.overdriveWet=e.createGain(),this.overdriveWet.gain.value=0,this.mufflerFilter=e.createBiquadFilter(),this.mufflerFilter.type="lowpass",this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7,this.postFilter=e.createBiquadFilter(),this.postFilter.type="lowpass",this.postFilter.frequency.value=2e4,this.postFilter.Q.value=1,this.postGain=e.createGain();const t=e.createGain();this.preGain.connect(this.overdriveDry),this.preGain.connect(this.overdrive),this.overdrive.connect(this.overdriveWet),this.overdriveDry.connect(t),this.overdriveWet.connect(t),t.connect(this.mufflerFilter),this.mufflerFilter.connect(this.postFilter),this.postFilter.connect(this.postGain),this.postGain.connect(this.output)}updateOverdriveCurve(e){if(!this.overdrive)return;const t=4096,n=new Float32Array(t),a=100*e;for(let s=0;s<t;s++){const e=s/t*2-1;n[s]=(1+a)*e/(1+a*Math.abs(e))}this.overdrive.curve=n}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const t=this.audioContext;if(await this.engine.init(t),this.workletNode=await this.engine.createMachineNode(t,this.machineType),!this.workletNode)throw new Error("Worklet node creation failed");const n=this.is303Style()&&this.preGain?this.preGain:this.output;this.workletNode.connect(n);try{const e=this.audioContext.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(this.audioContext.destination)}catch(e){}this.useWasmEngine=!0}catch(t){this.initError=t instanceof Error?t:new Error(String(t)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=sl[this.machineType];Lo("BuzzmachineGenerator",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}triggerAttack(e,t,n=1,a,s){if(!this.useWasmEngine||!this.workletNode)return;const r=os(e);this.is303Style()&&this.filterTrackingAmount>0&&this.applyFilterTracking(r),this.workletNode.port.postMessage({type:"noteOn",frequency:r,velocity:Math.round(127*n),time:t,accent:a,slide:s})}triggerRelease(e){this.useWasmEngine&&this.workletNode&&this.workletNode.port.postMessage({type:"noteOff",time:e})}triggerAttackRelease(e,t,n,a=1,s,r){const o=void 0!==n?ls(n):is(),i=ls(t);this.triggerAttack(e,o,a,s,r),this.triggerRelease(o+i)}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}releaseAll(){this.stop()}is303Style(){return this.machineType===al.OOMEK_AGGRESSOR||this.machineType===al.OOMEK_AGGRESSOR_DF}isDevilFishWasm(){return this.machineType===al.OOMEK_AGGRESSOR_DF}setCutoff(e){if(!this.is303Style())return;const t=200*Math.pow(100,e);this.currentCutoff=Math.max(200,Math.min(5e3,t)),this.postFilter&&0===this.filterTrackingAmount&&(this.postFilter.frequency.value=Math.min(18e3,1.5*this.currentCutoff));const n=Math.round(240*e);this.setParameter(1,Math.min(240,Math.max(0,n)))}setResonance(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(2,Math.min(128,Math.max(0,t)))}setEnvMod(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(3,Math.min(128,Math.max(0,t)))}setDecay(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(4,Math.min(128,Math.max(0,t)))}setAccentAmount(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(5,Math.min(128,Math.max(0,t)))}setAccent(e){this.setAccentAmount(e)}setTuning(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(6,Math.min(200,Math.max(0,t)))}setVolume(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(7,Math.min(200,Math.max(0,t)))}setWaveform(e){if(!this.is303Style())return;let t;t="number"==typeof e?e>=.5?1:0:"square"===e?1:0,this.setParameter(0,t)}setSlideTime(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(14,t)}}enableDevilFish(e,t){this.is303Style()&&(e?(this.setOverdrive(t?.overdrive??.3),this.setMuffler(t?.muffler??"mid"),this.setHighResonanceEnabled(!0),this.isDevilFishWasm()&&(this.setFilterTracking(.5),this.setSlideTime(.17),this.setSweepSpeed("normal"))):(this.setOverdrive(0),this.setMuffler("off"),this.setHighResonanceEnabled(!1),this.setFilterTracking(0)))}setOverdrive(e){if(this.is303Style()&&this.overdrive)if(this.overdriveAmount=Math.min(Math.max(e,0),1),0===this.overdriveAmount)this.overdriveDry&&(this.overdriveDry.gain.value=1),this.overdriveWet&&(this.overdriveWet.gain.value=0);else{const e=.8*this.overdriveAmount;this.overdriveDry&&(this.overdriveDry.gain.value=1-e),this.overdriveWet&&(this.overdriveWet.gain.value=e),this.updateOverdriveCurve(.2+.6*this.overdriveAmount)}}setMuffler(e){if(this.is303Style()){if(this.mufflerMode=e,this.isDevilFishWasm()){let e;switch(this.mufflerMode){case"dark":case"mid":e=1;break;case"bright":e=2;break;default:e=0}this.setParameter(15,e)}if(this.mufflerFilter)switch(this.mufflerMode){case"dark":this.mufflerFilter.frequency.value=2e3,this.mufflerFilter.Q.value=.5;break;case"mid":this.mufflerFilter.frequency.value=6e3,this.mufflerFilter.Q.value=.7;break;case"bright":this.mufflerFilter.frequency.value=12e3,this.mufflerFilter.Q.value=.7;break;default:this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7}}}applyFilterTracking(e){if(!this.postFilter||0===this.filterTrackingAmount)return;const t=Math.log2(e/440)*this.filterTrackingAmount*2e3,n=Math.max(200,Math.min(18e3,this.currentCutoff+t));this.postFilter.frequency.value=n}setFilterTracking(e){if(this.is303Style()&&(this.filterTrackingAmount=Math.min(Math.max(e,0),1),this.isDevilFishWasm())){const t=Math.round(200*e);this.setParameter(12,Math.min(200,t))}}setHighResonanceEnabled(e){this.is303Style()&&(this.isDevilFishWasm()&&this.setParameter(13,e?1:0),this.postFilter&&(this.postFilter.Q.value=e?4:1))}setHighResonance(e){this.setHighResonanceEnabled(e)}setNormalDecay(e){this.is303Style()&&this.setDecay(e)}setAccentDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(8,Math.min(128,Math.max(0,t)))}}setVegDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(9,Math.min(128,Math.max(0,t)))}}setVegSustain(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(10,t)}}setSoftAttack(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(11,Math.min(100,Math.max(0,t)))}}setFilterFM(e){this.is303Style()&&this.isDevilFishWasm()&&this.setParameter(19,Math.round(100*e))}setSweepSpeed(e){if(this.is303Style()&&this.isDevilFishWasm()){let t;if("number"==typeof e)t=Math.round(2*e);else switch(e.toLowerCase()){case"fast":t=0;break;case"slow":t=2;break;default:t=1}this.setParameter(16,t)}}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}dispose(){this.output.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.preGain&&(this.preGain.disconnect(),this.preGain=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveDry&&(this.overdriveDry.disconnect(),this.overdriveDry=null),this.overdriveWet&&(this.overdriveWet.disconnect(),this.overdriveWet=null),this.mufflerFilter&&(this.mufflerFilter.disconnect(),this.mufflerFilter=null),this.postFilter&&(this.postFilter.disconnect(),this.postFilter=null),this.postGain&&(this.postGain.disconnect(),this.postGain=null)}}const il=0,ll=1,cl=2,dl=3,ul=4,pl=5,hl=6,ml=7,fl=8,yl=9,gl=10,vl=11,bl=12,xl=13,wl=14,kl=15,Sl=16,Ml=17,Nl=18,Cl=19,El=20,Pl=126,Tl=127,Al=128,_l=129,Il=130,Dl=131,Ol=132,Fl=133,Rl=134,jl=135,Ll=136,Bl=137,Vl=138,zl=139,Ul=140,Gl=141,Wl=142,Kl=143,Hl=144,$l={"E.PIANO 1":{algorithm:5,feedback:6,operators:[{level:99,coarse:1,fine:0,detune:7},{level:70,coarse:14,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:60,coarse:1,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:80,coarse:1,fine:0,detune:7}]},"BRASS 1":{algorithm:22,feedback:7},"STRINGS 1":{algorithm:2,feedback:4},"INIT VOICE":{algorithm:0,feedback:0}};class ql{name="DexedSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=Ja().createGain(),this.config={algorithm:0,feedback:0,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=Ja(),n="/DEViLBOX/";ql.isWorkletLoaded||(ql.workletLoadPromise||(ql.workletLoadPromise=t.audioWorklet.addModule(`${n}dexed/Dexed.worklet.js`)),await ql.workletLoadPromise,ql.isWorkletLoaded=!0);const[a,s]=await Promise.all([fetch(`${n}dexed/Dexed.wasm`),fetch(`${n}dexed/Dexed.js`)]);if(!a.ok)throw new Error(`Failed to load Dexed.wasm: ${a.status}`);if(!s.ok)throw new Error(`Failed to load Dexed.js: ${s.status}`);const[r,o]=await Promise.all([a.arrayBuffer(),s.text()]),i=o.replace(/import\.meta\.url/g,`"${n}dexed/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(t,"dexed-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:i}),this._worklet.connect(this.output);try{const e=t.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(t.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){this._worklet&&this.isInitialized&&(void 0!==e.algorithm&&this.setParameter(Rl,e.algorithm),void 0!==e.feedback&&this.setParameter(jl,e.feedback),void 0!==e.oscSync&&this.setParameter(Ll,e.oscSync?1:0),void 0!==e.transpose&&this.setParameter(Hl,e.transpose),void 0!==e.lfoSpeed&&this.setParameter(Bl,e.lfoSpeed),void 0!==e.lfoDelay&&this.setParameter(Vl,e.lfoDelay),void 0!==e.lfoPmd&&this.setParameter(zl,e.lfoPmd),void 0!==e.lfoAmd&&this.setParameter(Ul,e.lfoAmd),void 0!==e.lfoSync&&this.setParameter(Gl,e.lfoSync?1:0),void 0!==e.lfoWave&&this.setParameter(Wl,e.lfoWave),void 0!==e.lfoPms&&this.setParameter(Kl,e.lfoPms),e.pitchEgRates&&(this.setParameter(Pl,e.pitchEgRates[0]),this.setParameter(Tl,e.pitchEgRates[1]),this.setParameter(Al,e.pitchEgRates[2]),this.setParameter(_l,e.pitchEgRates[3])),e.pitchEgLevels&&(this.setParameter(Il,e.pitchEgLevels[0]),this.setParameter(Dl,e.pitchEgLevels[1]),this.setParameter(Ol,e.pitchEgLevels[2]),this.setParameter(Fl,e.pitchEgLevels[3])),e.operators&&e.operators.forEach((e,t)=>{if(t>=6)return;const n=21*t;void 0!==e.level&&this.setParameter(n+Sl,e.level),void 0!==e.coarse&&this.setParameter(n+Nl,e.coarse),void 0!==e.fine&&this.setParameter(n+Cl,e.fine),void 0!==e.detune&&this.setParameter(n+El,e.detune),void 0!==e.mode&&this.setParameter(n+Ml,e.mode),e.egRates&&(this.setParameter(n+il,e.egRates[0]),this.setParameter(n+ll,e.egRates[1]),this.setParameter(n+cl,e.egRates[2]),this.setParameter(n+dl,e.egRates[3])),e.egLevels&&(this.setParameter(n+ul,e.egLevels[0]),this.setParameter(n+pl,e.egLevels[1]),this.setParameter(n+hl,e.egLevels[2]),this.setParameter(n+ml,e.egLevels[3])),void 0!==e.breakPoint&&this.setParameter(n+fl,e.breakPoint),void 0!==e.leftDepth&&this.setParameter(n+yl,e.leftDepth),void 0!==e.rightDepth&&this.setParameter(n+gl,e.rightDepth),void 0!==e.leftCurve&&this.setParameter(n+vl,e.leftCurve),void 0!==e.rightCurve&&this.setParameter(n+bl,e.rightCurve),void 0!==e.rateScaling&&this.setParameter(n+xl,e.rateScaling),void 0!==e.ampModSens&&this.setParameter(n+wl,e.ampModSens),void 0!==e.velocitySens&&this.setParameter(n+kl,e.velocitySens)}))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadSysEx(e){this._worklet?.port.postMessage({type:"loadSysEx",sysexData:Array.from(e)})}loadPreset(e){const t=$l[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setAlgorithm(e){this.config.algorithm=Math.max(0,Math.min(31,e)),this.setParameter(Rl,this.config.algorithm)}setFeedback(e){this.config.feedback=Math.max(0,Math.min(7,e)),this.setParameter(jl,this.config.feedback)}setOperatorLevel(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Sl,Math.max(0,Math.min(99,t)))}setOperatorCoarse(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Nl,Math.max(0,Math.min(31,t)))}setOperatorFine(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+Cl,Math.max(0,Math.min(99,t)))}setOperatorDetune(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+El,Math.max(0,Math.min(14,t)))}setLfoSpeed(e){this.config.lfoSpeed=Math.max(0,Math.min(99,e)),this.setParameter(Bl,this.config.lfoSpeed)}setLfoPitchModDepth(e){this.config.lfoPmd=Math.max(0,Math.min(99,e)),this.setParameter(zl,this.config.lfoPmd)}setLfoAmpModDepth(e){this.config.lfoAmd=Math.max(0,Math.min(99,e)),this.setParameter(Ul,this.config.lfoAmd)}setLfoWaveform(e){this.config.lfoWave=Math.max(0,Math.min(5,e)),this.setParameter(Wl,this.config.lfoWave)}setTranspose(e){this.config.transpose=Math.max(0,Math.min(48,e)),this.setParameter(Hl,this.config.transpose)}triggerAttack(e,t,n=1){const a=rs(e),s=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}),this):(this.pendingNotes.push({note:a,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Yl=0,Xl=1,Ql=2,Zl=3,Jl=4,ec=5,tc=6,nc=7,ac=8,sc=9,rc=11,oc=12,ic=13,lc=14,cc=15,dc=16,uc=17,pc=18,hc=19,mc=20,fc=21,yc=22,gc=23,vc=24,bc=25,xc=26,wc=27,kc=28,Sc=29,Mc=30,Nc=31,Cc=32,Ec=33,Pc=34,Tc=35,Ac=36,_c=37,Ic=38,Dc=39,Oc=40,Fc=41,Rc=42,jc=43,Lc=44,Bc=0,Vc=1,zc=0,Uc={"Classic Brass":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Detune:.05,osc1Level:1,osc2Level:.8,filterCutoff:.4,filterResonance:.2,filterEnvAmount:.6,filterAttack:.1,filterDecay:.3,filterSustain:.4,filterRelease:.2,ampAttack:.05,ampDecay:.1,ampSustain:.8,ampRelease:.3},"Fat Lead":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Octave:-1,osc2Detune:.1,osc1Level:1,osc2Level:1,filterCutoff:.6,filterResonance:.4,filterEnvAmount:.3,lfoRate:.3,lfoOscAmount:.1},"Pulse Pad":{osc1Waveform:Vc,osc2Waveform:Vc,osc1PulseWidth:.3,osc2PulseWidth:.7,osc2Detune:.02,filterCutoff:.3,filterResonance:.1,filterEnvAmount:.2,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,lfoRate:.15,lfoPwAmount:.3},"Sync Lead":{osc1Waveform:Bc,osc2Waveform:Bc,osc2Octave:1,oscSync:!0,filterCutoff:.5,filterResonance:.3,filterEnvAmount:.5},Init:{osc1Waveform:Bc,osc1Level:1,osc2Level:0,filterCutoff:.7,filterResonance:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3}};class Gc{name="OBXdSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=Ja().createGain(),this.config={osc1Waveform:Bc,osc1Octave:0,osc1Level:1,osc1PulseWidth:.5,osc2Waveform:Bc,osc2Octave:0,osc2Detune:.1,osc2Level:.7,osc2PulseWidth:.5,filterCutoff:.7,filterResonance:.3,filterEnvAmount:.5,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:zc,masterVolume:.7,velocitySensitivity:.5,panSpread:.3,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const t=Ja(),n="/DEViLBOX/";Gc.isWorkletLoaded||(Gc.workletLoadPromise||(Gc.workletLoadPromise=t.audioWorklet.addModule(`${n}obxd/OBXd.worklet.js`)),await Gc.workletLoadPromise,Gc.isWorkletLoaded=!0);const[a,s]=await Promise.all([fetch(`${n}obxd/OBXd.wasm`),fetch(`${n}obxd/OBXd.js`)]);if(!a.ok)throw new Error(`Failed to load OBXd.wasm: ${a.status}`);if(!s.ok)throw new Error(`Failed to load OBXd.js: ${s.status}`);const[r,o]=await Promise.all([a.arrayBuffer(),s.text()]),i=o.replace(/import\.meta\.url/g,`"${n}obxd/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(t,"obxd-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:i}),this._worklet.connect(this.output);try{const e=t.createGain();e.gain.value=0,this._worklet.connect(e),e.connect(t.destination)}catch(e){}}catch(t){throw t}}applyConfig(e){if(!this._worklet||!this.isInitialized)return;const t=[["osc1Waveform",Yl],["osc1Octave",Xl],["osc1Detune",Ql],["osc1PulseWidth",Zl],["osc1Level",Jl],["osc2Waveform",ec],["osc2Octave",tc],["osc2Detune",nc],["osc2PulseWidth",ac],["osc2Level",sc],["filterCutoff",ic],["filterResonance",lc],["filterType",cc],["filterEnvAmount",dc],["filterKeyTrack",uc],["filterVelocity",pc],["filterAttack",hc],["filterDecay",mc],["filterSustain",fc],["filterRelease",yc],["ampAttack",gc],["ampDecay",vc],["ampSustain",bc],["ampRelease",xc],["lfoRate",wc],["lfoWaveform",kc],["lfoDelay",Sc],["lfoOscAmount",Mc],["lfoFilterAmount",Nc],["lfoAmpAmount",Cc],["lfoPwAmount",Ec],["masterVolume",Pc],["voices",Tc],["unisonDetune",_c],["portamento",Ic],["velocitySensitivity",Oc],["panSpread",Dc],["noiseLevel",Fc],["subOscLevel",Rc],["subOscOctave",jc],["drift",Lc]];for(const[n,a]of t){const t=e[n];void 0!==t&&this.setParameter(a,t)}void 0!==e.oscSync&&this.setParameter(rc,e.oscSync?1:0),void 0!==e.oscXor&&this.setParameter(oc,e.oscXor?1:0),void 0!==e.unison&&this.setParameter(Ac,e.unison?1:0)}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadPreset(e){const t=Uc[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setCutoff(e){this.config.filterCutoff=Math.max(0,Math.min(1,e)),this.setParameter(ic,this.config.filterCutoff)}setResonance(e){this.config.filterResonance=Math.max(0,Math.min(1,e)),this.setParameter(lc,this.config.filterResonance)}setFilterEnvAmount(e){this.config.filterEnvAmount=Math.max(0,Math.min(1,e)),this.setParameter(dc,this.config.filterEnvAmount)}setOsc1Waveform(e){this.config.osc1Waveform=e,this.setParameter(Yl,e)}setOsc2Waveform(e){this.config.osc2Waveform=e,this.setParameter(ec,e)}setOsc2Detune(e){this.config.osc2Detune=Math.max(-1,Math.min(1,e)),this.setParameter(nc,this.config.osc2Detune)}setLfoRate(e){this.config.lfoRate=Math.max(0,Math.min(1,e)),this.setParameter(wc,this.config.lfoRate)}setLfoOscAmount(e){this.config.lfoOscAmount=Math.max(0,Math.min(1,e)),this.setParameter(Mc,this.config.lfoOscAmount)}setLfoFilterAmount(e){this.config.lfoFilterAmount=Math.max(0,Math.min(1,e)),this.setParameter(Nc,this.config.lfoFilterAmount)}setPortamento(e){this.config.portamento=Math.max(0,Math.min(1,e)),this.setParameter(Ic,this.config.portamento)}setUnison(e){this.config.unison=e,this.setParameter(Ac,e?1:0)}setUnisonDetune(e){this.config.unisonDetune=Math.max(0,Math.min(1,e)),this.setParameter(_c,this.config.unisonDetune)}setVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.setParameter(Pc,this.config.masterVolume)}triggerAttack(e,t,n=1){const a=rs(e),s=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}),this):(this.pendingNotes.push({note:a,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Wc=0,Kc=0,Hc=0,$c=16,qc=32,Yc=96,Xc=104,Qc=152;class Zc{name="CZ101Synth";output;audioContext;workletNode=null;voices=[];currentPatch=null;isInitialized=!1;initPromise=null;static DEFAULT_PATCH={name:"Init",line1:{waveform1:Wc,dcaEnvelope:[{rate:99,level:99},{rate:60,level:80},{rate:40,level:60},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:0,level:0}],dcwEnvelope:[{rate:99,level:99},{rate:50,level:70},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:2,level:2},{rate:0,level:0}]}};constructor(){this.audioContext=Ja(),this.output=this.audioContext.createGain();for(let e=0;e<8;e++)this.voices.push({note:0,velocity:0,active:!1,envStage:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){const e=this.audioContext;if(!e.audioWorklet)throw new Error("AudioWorklet not supported");try{await e.audioWorklet.addModule("/DEViLBOX/cz101/CZ101.worklet.js")}catch(t){if(!t?.message?.includes("already"))throw t}this.workletNode=new AudioWorkletNode(e,"cz101-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch(n){}await new Promise((e,t)=>{const n=setTimeout(()=>t(new Error("CZ101 init timeout")),5e3),a=t=>{"initialized"===t.data.type&&(clearTimeout(n),this.workletNode?.port.removeEventListener("message",a),e())};this.workletNode.port.addEventListener("message",a),this.workletNode.port.start(),this.workletNode.port.postMessage({type:"init"})}),this.isInitialized=!0,this.loadPatch(Zc.DEFAULT_PATCH)}writeReg(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"writeReg",register:e,value:t})}midiNoteToPitch(e,t=0){return(e-7<<9)+4*t}encodeDCAStep(e,t,n,a){return(1&e)<<15|(127&t)<<8|(1&n)<<7|127&a}_encodeDCOStep(e,t,n,a,s){return(1&e)<<15|(127&t)<<8|(1&n)<<7|(1&a)<<6|63&s}encodeWaveform(e,t,n,a,s,r){return(7&e)<<13|(7&(t??e))<<10|(void 0!==t?1:0)<<9|(7&n)<<6|(a?1:0)<<5|(3&s)<<3|(r?1:0)<<2}loadPatch(e){if(this.currentPatch=e,this.workletNode)for(let t=0;t<8;t++){const n=this.encodeWaveform(e.line1.waveform1,e.line1.waveform2,Kc,e.ringMod??!1,e.noiseMode?2:0,!1);this.writeReg(Xc+t,n)}}triggerAttack(e,t,n=.8){const a="string"==typeof e?rs(e):e;let s=this.voices.findIndex(e=>!e.active);-1===s&&(s=0);const r=this.voices[s];if(r.note=a,r.velocity=Math.floor(127*n),r.active=!0,r.envStage=0,!this.workletNode||!this.currentPatch)return;const o=this.midiNoteToPitch(a,this.currentPatch.detune??0);this.writeReg(Yc+s,o),this.writeReg(Qc+s,0);const i=this.currentPatch.line1.dcaEnvelope[0],l=this.encodeDCAStep(0,i.rate,0,Math.floor(i.level*r.velocity/127));this.writeReg(Hc+s,l);const c=this.currentPatch.line1.dcwEnvelope[0],d=this.encodeDCAStep(0,c.rate,0,c.level);if(this.writeReg(qc+s,d),this.currentPatch.line1.dcoEnvelope&&this.currentPatch.line1.dcoEnvelope.length>0){const e=this.currentPatch.line1.dcoEnvelope[0],t=this._encodeDCOStep(0,e.rate,0,0,e.level);this.writeReg($c+s,t)}}triggerRelease(e,t){const n="string"==typeof e?rs(e):e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return;if(this.voices[a].active=!1,!this.workletNode||!this.currentPatch)return;const s=this.encodeDCAStep(1,40,0,0);this.writeReg(Hc+a,s)}setParameter(e,t){}getParameters(){return{}}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.disconnect()}}const Jc=0,ed=1,td=2,nd=3,ad=4,sd=5,rd=6,od=7,id=1,ld=2,cd=4;class dd extends _r{name="CEM3394Synth";chipName="CEM3394";workletFile="CEM3394.worklet.js";processorName="cem3394-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setCutoff(e){this.setParameterById(rd,e)}setResonance(e){this.setParameterById(sd,e)}setFilterModulation(e){this.setParameterById(ed,e)}setPulseWidth(e){this.setParameterById(nd,e)}setWaveform(e){let t=ld|cd;if("string"==typeof e)switch(e.toLowerCase()){case"triangle":t=id;break;case"sawtooth":case"saw":t=ld;break;case"pulse":case"square":t=cd;break;case"all":t=id|ld|cd}else t=e;this.setParameterById(td,t)}setVolume(e){this.setParameterById(od,e)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_frequency:Jc,modulation:ed,wave_select:td,pulse_width:nd,mixer_balance:ad,resonance:sd,cutoff:rd,volume:od}[e];void 0!==n&&this.setParameterById(n,t)}}const ud=0;class pd extends _r{name="SCSPSynth";chipName="SCSP";workletFile="SCSP.worklet.js";processorName="scsp-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t/2,a=Math.log2(e/n),s=Math.floor(a)+1,r=Math.round(1024*(e/(n*Math.pow(2,s-1))-1));return{oct:Math.max(-8,Math.min(7,s)),fns:Math.max(0,Math.min(1023,r))}}(e);this.workletNode.port.postMessage({type:"setFrequency",oct:t.oct,fns:t.fns,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",tl:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*31),n=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",sdl:t,sdr:n,slot:this.currentSlot})}setFMLevel(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMLevel",slot:e,level:t})}setFMInputSlot(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMInputSlot",slot:e,inputSlot:t})}setSlot(e){this.currentSlot=Math.max(0,Math.min(31,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r??0})}setEnvelope(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,ar:t,d1r:n,d2r:a,rr:s,dl:r})}setLFO(e,t,n,a,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,plfos:t,alfos:n,freq:a,wave:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:ud,volume:ud}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(ud,e)}}const hd={chipName:"TR707",basePath:"/roms/tr707",zipFile:"tr707.zip",combinedFile:"tr707_combined.bin",combinedSize:131072,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768}]},md={chipName:"TR707-Expansion",basePath:"/roms/tr707",zipFile:"tr707_expansion.zip",combinedFile:"tr707_expansion.bin",combinedSize:262144,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768},{name:"tr707_expansion.bin",offset:131072,size:131072}]},fd={chipName:"C352",basePath:"/roms/c352",zipFile:"c352.zip",combinedFile:"c352_samples.bin",combinedSize:8388608,files:[{name:"c352_samples_0.bin",offset:0,size:4194304,required:!0},{name:"c352_samples_1.bin",offset:4194304,size:4194304,required:!0}]},yd={chipName:"K054539",basePath:"/roms/k054539",zipFile:"k054539.zip",combinedFile:"k054539_samples.bin",combinedSize:6291456,files:[{name:"k054539_samples_0.bin",offset:0,size:2097152,required:!0},{name:"k054539_samples_1.bin",offset:2097152,size:1048576,required:!0},{name:"k054539_samples_2.bin",offset:3145728,size:1048576,required:!0},{name:"k054539_samples_3.bin",offset:4194304,size:2097152,required:!0}]},gd={chipName:"ICS2115",basePath:"/roms/ics2115",zipFile:"ics2115.zip",combinedFile:"ics2115_wavetable.bin",combinedSize:262144,files:[{name:"ics2115_wavetable_0.bin",offset:0,size:262144,required:!0}]},vd={chipName:"RF5C400",basePath:"/roms/rf5c400",zipFile:"rf5c400.zip",combinedFile:"rf5c400_samples.bin",files:[{name:"rf5c400_samples.bin",offset:0,required:!0}]},bd={chipName:"ES5503",basePath:"/roms/es5503",zipFile:"es5503.zip",combinedFile:"es5503_wavetable.bin",files:[{name:"es5503_wavetable.bin",offset:0,required:!0}]},xd={chipName:"D50",basePath:"/roms/d50",zipFile:"d50.zip",files:[{name:"d50_firmware.bin",offset:0,size:65536,required:!0},{name:"d50_ic30.bin",offset:65536,size:524288,required:!0},{name:"d50_ic29.bin",offset:589824,size:524288,required:!0}]},wd={chipName:"VFX",basePath:"/roms/vfx",zipFile:"vfx.zip",files:[{name:"u14.bin",offset:0,size:524288,required:!0},{name:"u15.bin",offset:524288,size:524288,required:!0},{name:"u16.bin",offset:1048576,size:524288,required:!0},{name:"vfx210b-low.bin",offset:1572864,size:65536},{name:"vfx210b-high.bin",offset:1638400,size:65536}]};async function kd(e){try{if(e.zipFile){const t=`${e.basePath}/${e.zipFile}`,n=await async function(e,t){try{const n=await fetch(jn(e));if(!n.ok)return null;if((n.headers.get("content-type")||"").includes("text/html"))return null;const a=await n.arrayBuffer();if(a.byteLength<4)return null;const s=new Uint8Array(a,0,4);if(80!==s[0]||75!==s[1])return null;const r=await Gn.loadAsync(a),o=t.files.filter(e=>e.size).map(e=>e.offset+e.size),i=o.length>0?Math.max(...o):t.combinedSize||4194304;let l=new Uint8Array(i),c=0;for(const e of t.files){let t=r.file(e.name);if(!t){const n=Object.keys(r.files).find(t=>t.endsWith("/"+e.name)||t===e.name);n&&(t=r.file(n))}if(!t){if(e.required)return null;continue}const n=await t.async("uint8array");e.size&&(n.length,e.size);const a=e.offset+n.length;if(a>l.length){const e=new Uint8Array(a);e.set(l),l=e}l.set(n,e.offset),c++}return 0===c?null:l}catch(n){return null}}(t,e);if(n)return n}if(e.combinedFile)try{const t=await fetch(jn(`${e.basePath}/${e.combinedFile}`)),n=t.headers.get("content-type")||"";if(t.ok&&!n.includes("text/html")){const n=await t.arrayBuffer(),a=new Uint8Array(n);return e.combinedSize&&(a.length,e.combinedSize),a}}catch(t){}const n=Math.max(...e.files.map(e=>e.offset+(e.size||0))),a=new Uint8Array(n||1048576);let s=0;const r=await Promise.allSettled(e.files.map(async t=>{try{const n=await fetch(jn(`${e.basePath}/${t.name}`)),r=n.headers.get("content-type")||"";if(!n.ok||r.includes("text/html")){if(t.required)throw new Error(`${t.name} not found (HTTP ${n.status}, type: ${r})`);return}const o=await n.arrayBuffer(),i=new Uint8Array(o);t.size&&(i.length,t.size),a.set(i,t.offset),s++}catch(n){if(t.required)throw n}}));if(0===s)throw new Error(`No ROM files loaded for ${e.chipName}`);if(r.find((t,n)=>"rejected"===t.status&&e.files[n].required))throw new Error(`Required ROM file failed to load for ${e.chipName}`);return a}catch(n){throw new Error(`${e.chipName} ROM files not found or invalid.\nPlease place ROM files in ${e.basePath}/\nRequired files: ${e.files.filter(e=>e.required).map(e=>e.name).join(", ")}`)}}const Sd=1,Md=0,Nd=1,Cd=3,Ed=5,Pd=6,Td=7,Ad=8,_d=10,Id=12;class Dd{name="VFXSynth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=16e6;static NUM_VOICES=32;constructor(){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<Dd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,looping:!1})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(ur,Dd.CLOCK),0===this.handle)throw new Error("Failed to create ES5506 instance");this.isInitialized=!0;try{const e=await async function(){const e=await kd(wd);return[e.slice(0,524288),e.slice(524288,1048576),e.slice(1048576,1572864)]}();for(let t=0;t<e.length;t++)await this.loadSampleROM(t,e[t].buffer)}catch(e){}}async loadSampleROM(e,t){this.isInitialized||await this.init(),this.mameEngine.setRom(e,new Uint8Array(t)),this.romLoaded=!0}writeVoiceReg(e,t,n){if(0===this.handle)return;const a=16*e+t;this.mameEngine.write16(this.handle,a,n)}midiNoteToFreqCount(e,t=44100){const n=440*Math.pow(2,(e-69)/12);return 4294967295&Math.floor(n*Math.pow(2,32)/t)}velocityToVolume(e){const t=e/127,n=Math.pow(t,2);return Math.floor(65535*n)}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return;const a="string"==typeof e?rs(e):e,s=this.allocateVoice(),r=this.voices[s];r.note=a,r.velocity=Math.floor(127*n),r.active=!0;const o=this.midiNoteToFreqCount(a);this.writeVoiceReg(s,Nd,o>>>16),this.writeVoiceReg(s,Nd+1,65535&o);const i=this.velocityToVolume(r.velocity);this.writeVoiceReg(s,Cd,i),this.writeVoiceReg(s,Td,i),this.writeVoiceReg(s,Pd,0);let l=Sd;this.writeVoiceReg(s,Md,l)}triggerAttackRelease(e,t=.5,n,a=.8){this.triggerAttack(e,n,a);const s="string"==typeof t?ls(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?rs(e):e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return;this.voices[a].active=!1,this.writeVoiceReg(a,Ed,128),this.writeVoiceReg(a,Ad,128)}setFilter(e,t,n){this.writeVoiceReg(e,Id,Math.floor(65535*t)),this.writeVoiceReg(e,_d,Math.floor(65535*n))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const Od=0,Fd=6144;class Rd{name="D50Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=2e7;static NUM_VOICES=16;constructor(){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<Rd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,partialMask:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(pr,Rd.CLOCK),0===this.handle)throw new Error("Failed to create Roland SA instance");this.isInitialized=!0;try{const{firmware:e,ic30:t,ic29:n}=await async function(){const e=await kd(xd);return{firmware:e.slice(0,65536),ic30:e.slice(65536,589824),ic29:e.slice(589824,1114112)}}();await this.loadROMs(t.buffer,n.buffer,e.buffer)}catch(e){}}async loadROMs(e,t,n){this.isInitialized||await this.init(),this.mameEngine.rsaLoadRoms(this.handle,new Uint8Array(e),new Uint8Array(t),new Uint8Array(n)),this.romLoaded=!0}writeControl(e,t){0!==this.handle&&this.mameEngine.write(this.handle,e,t)}_midiNoteToPitch(e,t=0){return e}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e,this.isInitialized}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return;const a="string"==typeof e?rs(e):e,s=this.allocateVoice(),r=this.voices[s],o=this._currentPatch?.effects?.chorusRate??0,i=this._midiNoteToPitch(a,o);r.note=a,r.velocity=Math.floor(127*n),r.active=!0,r.partialMask=15;const l=Od+128*s;this.writeControl(l+0,i),this.writeControl(l+1,r.velocity),this.writeControl(l+2,1)}triggerAttackRelease(e,t=.5,n,a=.8){this.triggerAttack(e,n,a);const s="string"==typeof t?ls(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?rs(e):e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return;this.voices[a].active=!1;const s=Od+128*a;this.writeControl(s+2,0)}setChorus(e,t){this.writeControl(Fd+0,Math.floor(127*e)),this.writeControl(Fd+1,Math.floor(127*t))}setReverb(e){this.writeControl(Fd+16,Math.floor(127*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const jd=0,Ld=1,Bd=2,Vd=3,zd=4,Ud=5,Gd=6,Wd=7,Kd=8,Hd=9,$d=[{ic5:"mks20_15179738.BIN",ic6:"mks20_15179737.BIN",ic7:"mks20_15179736.BIN",ic18:"mks20_15179757.BIN"},{ic5:"mks20_15179741.BIN",ic6:"mks20_15179740.BIN",ic7:"mks20_15179739.BIN",ic18:"mks20_15179757.BIN"},{ic5:"MK80_IC5.bin",ic6:"MK80_IC6.bin",ic7:"MK80_IC7.bin",ic18:"MK80_IC18.bin"}],qd=[{name:"MKS-20: Piano 1",romSet:0},{name:"MKS-20: Piano 2",romSet:0},{name:"MKS-20: Piano 3",romSet:0},{name:"MKS-20: Harpsichord",romSet:1},{name:"MKS-20: Clavi",romSet:1},{name:"MKS-20: Vibraphone",romSet:1},{name:"MKS-20: E-Piano 1",romSet:1},{name:"MKS-20: E-Piano 2",romSet:1},{name:"MK-80: Classic",romSet:2},{name:"MK-80: Special",romSet:2},{name:"MK-80: Blend",romSet:2},{name:"MK-80: Contemporary",romSet:2},{name:"MK-80: A. Piano 1",romSet:2},{name:"MK-80: A. Piano 2",romSet:2},{name:"MK-80: Clavi",romSet:2},{name:"MK-80: Vibraphone",romSet:2}];class Yd{name="RdPianoSynth";output;audioContext;_worklet=null;config;isInitialized=!1;pendingNotes=[];loadedRomSets=new Set;currentPatch=0;romLoadError=!1;_initPromise;static romCache=new Map;static isWorkletLoaded=!1;static workletLoadPromise=null;static wasmBinary=null;static jsCode=null;constructor(e={}){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.config={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.audioContext,t="/DEViLBOX/";if(!Yd.isWorkletLoaded){if(!Yd.workletLoadPromise){const n=`?v=${Date.now()}`;Yd.workletLoadPromise=e.audioWorklet.addModule(`${t}rdpiano/RdPiano.worklet.js${n}`)}await Yd.workletLoadPromise,Yd.isWorkletLoaded=!0}if(!Yd.wasmBinary||!Yd.jsCode){const[e,n]=await Promise.all([fetch(`${t}rdpiano/RdPiano.wasm`),fetch(`${t}rdpiano/RdPiano.js`)]);if(!e.ok||!n.ok)throw new Error("Failed to fetch RdPiano WASM files");const[a,s]=await Promise.all([e.arrayBuffer(),n.text()]);Yd.jsCode=s.replace(/import\.meta\.url/g,`"${t}rdpiano/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),Yd.wasmBinary=a}this._worklet=new AudioWorkletNode(this.audioContext,"rdpiano-processor"),this._worklet.port.onmessage=e=>{const{type:t}=e.data;if("wasmReady"===t)this.loadROMs();else if("ready"===t){this.isInitialized=!0,this.applyConfig(),null!=this.config.patch&&0!==this.config.patch&&this.selectPatch(this.config.patch);for(const{note:e,velocity:t}of this.pendingNotes)this._worklet?.port.postMessage({type:"noteOn",note:e,velocity:t});this.pendingNotes=[]}},this._worklet.port.postMessage({type:"init",wasmBinary:Yd.wasmBinary,jsCode:Yd.jsCode}),this._worklet.connect(this.output)}catch(e){}}async loadROMs(){try{const e=`${"/DEViLBOX/"}rdpiano/roms/`,t=await this.fetchROM(e+"RD200_B.bin");if(!t)return void(this.romLoadError=!0);this._worklet?.port.postMessage({type:"loadProgramROM",romData:t}),await new Promise(e=>setTimeout(e,50));const n=this.config.patch||0,a=qd[n].romSet;await this.loadROMSet(a),await new Promise(e=>setTimeout(e,100)),this._worklet?.port.postMessage({type:"initMCU"})}catch(e){this.romLoadError=!0}}async loadROMSet(e){if(this.loadedRomSets.has(e))return!0;if(e<0||e>2)return!1;const t="/DEViLBOX/rdpiano/roms/",n=$d[e],[a,s,r,o]=await Promise.all([this.fetchROM(t+n.ic5),this.fetchROM(t+n.ic6),this.fetchROM(t+n.ic7),this.fetchROM(t+n.ic18)]);return!!(a&&s&&r&&o)&&(this._worklet?.port.postMessage({type:"loadROMSet",setIndex:e,ic5:a,ic6:s,ic7:r,ic18:o}),this.loadedRomSets.add(e),!0)}async fetchROM(e){const t=Yd.romCache.get(e);if(t)return t.slice(0);try{const t=await fetch(e);if(!t.ok)return null;const n=await t.arrayBuffer();return Yd.romCache.set(e,n),n.slice(0)}catch(n){return null}}applyConfig(){this._worklet&&this.isInitialized&&(null!=this.config.chorusEnabled&&this.setParameter(jd,this.config.chorusEnabled?1:0),null!=this.config.chorusRate&&this.setParameter(Ld,this.config.chorusRate),null!=this.config.chorusDepth&&this.setParameter(Bd,this.config.chorusDepth),null!=this.config.efxEnabled&&this.setParameter(Vd,this.config.efxEnabled?1:0),null!=this.config.phaserRate&&this.setParameter(zd,this.config.phaserRate),null!=this.config.phaserDepth&&this.setParameter(Ud,this.config.phaserDepth),null!=this.config.tremoloEnabled&&this.setParameter(Gd,this.config.tremoloEnabled?1:0),null!=this.config.tremoloRate&&this.setParameter(Wd,this.config.tremoloRate),null!=this.config.tremoloDepth&&this.setParameter(Kd,this.config.tremoloDepth),null!=this.config.volume&&this.setParameter(Hd,this.config.volume))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}async selectPatch(e){if(e<0||e>=16)return;const t=qd[e];if(!this.loadedRomSets.has(t.romSet)){if(!(await this.loadROMSet(t.romSet)))return}this._worklet?.port.postMessage({type:"selectPatch",patchIndex:e}),this.currentPatch=e}setChorusEnabled(e){this.config.chorusEnabled=e,this.setParameter(jd,e?1:0)}setChorusRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusRate=e,this.setParameter(Ld,e)}setChorusDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusDepth=e,this.setParameter(Bd,e)}setEfxEnabled(e){this.config.efxEnabled=e,this.setParameter(Vd,e?1:0)}setPhaserRate(e){e=Math.max(0,Math.min(1,e)),this.config.phaserRate=e,this.setParameter(zd,e)}setPhaserDepth(e){e=Math.max(0,Math.min(1,e)),this.config.phaserDepth=e,this.setParameter(Ud,e)}setTremoloEnabled(e){this.config.tremoloEnabled=e,this.setParameter(Gd,e?1:0)}setTremoloRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloRate=e,this.setParameter(Wd,e)}setTremoloDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloDepth=e,this.setParameter(Kd,e)}setVolume(e){e=Math.max(0,Math.min(1,e)),this.config.volume=e,this.setParameter(Hd,e)}triggerAttack(e,t,n=1){const a=rs(e),s=Math.round(127*Math.max(0,Math.min(1,n)));this.romLoadError||(this.isInitialized?this._worklet?.port.postMessage({type:"noteOn",note:a,velocity:s}):this.pendingNotes.push({note:a,velocity:s}))}triggerRelease(e,t){if(this._worklet)if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}getCurrentPatch(){return this.currentPatch}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Xd=8,Qd=10,Zd=12,Jd=50,eu=4096;class tu{name="MU2000Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;static CLOCK=33868800;static NUM_VOICES=64;constructor(){this.audioContext=Ja(),this.output=this.audioContext.createGain(),this.mameEngine=fr.getInstance();for(let e=0;e<tu.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,channel:0,active:!1,startTime:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(hr,tu.CLOCK),0===this.handle)throw new Error("Failed to create SWP30 instance");this.isInitialized=!0}async loadWaveROM(e){this.isInitialized||await this.init();const t=new Uint8Array(e);this.mameEngine.setRom(0,t),this.romLoaded=!0}midiNoteToPitch(e,t=0){const n=e-60+t/8192,a=Math.pow(2,n/12);return 65535&Math.floor(8192*a)}velocityToVolume(e){return Math.floor(2*e)}allocateVoice(e){let t=this.voices.findIndex(e=>!e.active);if(-1===t){let n=1/0,a=0;for(let t=0;t<this.voices.length;t++)this.voices[t].channel===e&&this.voices[t].startTime<n&&(n=this.voices[t].startTime,a=t);if(n===1/0)for(let e=0;e<this.voices.length;e++)this.voices[e].startTime<n&&(n=this.voices[e].startTime,a=e);t=a}return t}writeReg(e,t){0!==this.handle&&this.mameEngine.write16(this.handle,e,t)}triggerAttack(e,t,n=.8,a=0){if(!this.isInitialized||!this.romLoaded)return;const s="string"==typeof e?rs(e):e,r=this.allocateVoice(a),o=this.voices[r];o.note=s,o.velocity=Math.floor(127*n),o.channel=a,o.active=!0,o.startTime=performance.now();const i=64*r,l=this.midiNoteToPitch(s);this.writeReg(i+Zd,l);const c=this.velocityToVolume(o.velocity);this.writeReg(i+Jd,c),this.writeReg(i+Xd,0),this.writeReg(i+Qd,0)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?rs(e):e,a=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===a)return;this.voices[a].active=!1;const s=64*a;this.writeReg(s+Jd,0)}sendMidi(e){0!==this.handle&&this.mameEngine.addMidiEvent(this.handle,e)}setMasterVolume(e){this.writeReg(eu,Math.floor(255*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const nu=0;class au extends _r{name="AICASynth";chipName="AICA";workletFile="AICA.worklet.js";processorName="aica-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",volume:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",pan:t,slot:this.currentSlot})}setSlot(e){this.currentSlot=Math.max(0,Math.min(63,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,a,s,r=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:a,loop:s,format:r})}setEnvelope(e,t,n,a,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,attack:t,decay1:n,decay2:a,release:s,sustainLevel:r})}setLFO(e,t,n,a,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,pitchDepth:t,ampDepth:n,rate:a,waveform:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:nu,volume:nu}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(nu,e)}}const su=0,ru=1,ou=2,iu=3,lu=4,cu=5,du=6,uu=7;class pu extends _r{name="ASCSynth";chipName="ASC";workletFile="ASC.worklet.js";processorName="asc-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=(e-128)/128*.5;this.workletNode.port.postMessage({type:"setPanning",width:t})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveform(e){this.writeWavetableSelect(e)}setAttack(e){this.setParameterById(ou,e)}setDecay(e){this.setParameterById(iu,e)}setSustain(e){this.setParameterById(lu,e)}setRelease(e){this.setParameterById(cu,e)}setStereoWidth(e){this.setParameterById(du,e)}setDetune(e){this.setParameterById(uu,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:su,waveform:ru,attack:ou,decay:iu,sustain:lu,release:cu,stereo_width:du,detune:uu}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const hu=0,mu=1,fu=2,yu=3,gu=4,vu=5,bu=6,xu=7;class wu extends _r{name="AstrocadeSynth";chipName="Astrocade";workletFile="Astrocade.worklet.js";processorName="astrocade-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVibratoSpeed(e){this.sendMessage("setVibratoSpeed",e)}setVibratoDepth(e){this.sendMessage("setVibratoDepth",e)}setNoiseVolume(e){this.sendMessage("setNoiseVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:hu,vibrato_speed:mu,vibrato_depth:fu,noise_am:yu,noise_mod:gu,noise_vol:vu,master_freq:bu,stereo_width:xu}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ku=0;class Su extends _r{name="C352Synth";chipName="C352";workletFile="C352.worklet.js";processorName="c352-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return kd(fd)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t,a=Math.round(e/n*65536);return Math.max(0,Math.min(65535,a))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,voice:this.currentVoice})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,voice:this.currentVoice})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*255),n=Math.round(e/255*255);this.workletNode.port.postMessage({type:"setPanning",vol_f:t<<8|n,vol_r:t<<8|n,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureVoice(e,t,n,a,s,r,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureVoice",voice:e,bank:t,start:n,end:a,loop:s,freq:r,flags:o})}setVoiceVolume(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVoiceVolume",voice:e,vol_f:t,vol_r:n})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",voice:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",voice:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:ku,volume:ku}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(ku,e)}}const Mu=0,Nu=1,Cu=2,Eu=3,Pu=4,Tu=5,Au=6,_u=7;class Iu extends _r{name="ES5503Synth";chipName="ES5503";workletFile="ES5503.worklet.js";processorName="es5503-processor";currentOsc=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return kd(bd)}();await super.initialize(),this.loadWaveData(e,2048)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),osc:this.currentOsc})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,osc:this.currentOsc})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=894886){const n=Math.round(e*Math.pow(2,17)/t);return Math.max(0,Math.min(131071,n))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,osc:this.currentOsc})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,osc:this.currentOsc})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*7);this.workletNode.port.postMessage({type:"setPanning",channel:t,osc:this.currentOsc})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e,osc:this.currentOsc})}setOscillator(e){this.currentOsc=Math.max(0,Math.min(31,e))}setWaveform(e){this.writeWavetableSelect(e)}setWaveSize(e){this.sendMessage("setWaveSize",e)}setResolution(e){this.sendMessage("setResolution",e)}setOscMode(e){this.sendMessage("setOscMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setReleaseTime(e){this.sendMessage("setReleaseTime",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setNumOscillators(e){this.sendMessage("setNumOscillators",e)}loadWaveData(e,t=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadWaveData",waveData:e.buffer,offset:t})}loadWavePage(e,t){this.loadWaveData(e.slice(0,256),256*t)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={waveform:Mu,wave_size:Nu,resolution:Cu,osc_mode:Eu,volume:Pu,num_oscillators:Tu,attack_time:Au,release_time:_u}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Du=0,Ou=1;class Fu extends _r{name="ICS2115Synth";chipName="ICS2115";workletFile="ICS2115.worklet.js";processorName="ics2115-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return kd(gd)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",voice:e,reg:t,data:n})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Du,volume:Du,active_osc:Ou,voices:Ou}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Du,e)}setActiveOscillators(e){this.setParameterById(Ou,e)}}const Ru=0,ju=1;class Lu extends _r{name="K054539Synth";chipName="K054539";workletFile="K054539.worklet.js";processorName="k054539-processor";currentChannel=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return kd(yd)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=261.63){const n=e/t,a=Math.round(4096*n);return Math.max(0,Math.min(65535,a))}(e);this.workletNode.port.postMessage({type:"setChannelPitch",channel:this.currentChannel,delta:t})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(64*(1-e));this.workletNode.port.postMessage({type:"setChannelVolume",channel:this.currentChannel,volume:t})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*14);this.workletNode.port.postMessage({type:"setChannelPan",channel:this.currentChannel,pan:t})}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureChannel(e,t,n,a=0,s=!1,r=!1){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureChannel",channel:e,startAddr:t,loopAddr:n,sampleType:a,loopEnable:s,reverse:r})}setChannelPitch(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPitch",channel:e,delta:t})}setChannelVolume(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelVolume",channel:e,volume:t})}setChannelPan(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPan",channel:e,pan:t})}setChannelGain(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelGain",channel:e,gain:t})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",channel:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",channel:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Ru,volume:Ru,reverb_enable:ju,reverb:ju}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Ru,e)}setReverbEnable(e){this.setParameterById(ju,e?1:0)}}const Bu=0,Vu=1,zu=2,Uu=3,Gu=4,Wu=5,Ku=6,Hu=7,$u=8;class qu extends _r{name="MEA8000Synth";chipName="MEA8000";workletFile="MEA8000.worklet.js";processorName="mea8000-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",f1:e,f2:t,f3:n})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setBandwidth(e){this.setParameterById(Wu,e)}setInterpTime(e){this.setParameterById($u,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Bu,noise_mode:Vu,f1_index:zu,f2_index:Uu,f3_index:Gu,bw_index:Wu,amplitude:Ku,stereo_width:Hu,interp_time:$u}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Yu=0,Xu=1;class Qu extends _r{name="RF5C400Synth";chipName="RF5C400";workletFile="RF5C400.worklet.js";processorName="rf5c400-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return kd(vd)}();await super.initialize(),this.loadROM(0,e)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,data:t})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Yu,volume:Yu,clock:Xu}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Yu,e)}setClock(e){this.setParameterById(Xu,e)}}const Zu=0,Ju=1,ep=2,tp=3,np=4,ap=5,sp=6,rp=7,op=8,ip=9,lp=10,cp=11,dp=12;class up extends _r{name="SN76477Synth";chipName="SN76477";workletFile="SN76477.worklet.js";processorName="sn76477-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVCOFreq(e){this.sendMessage("setVCOFreq",e)}setSLFFreq(e){this.sendMessage("setSLFFreq",e)}setNoiseFreq(e){this.sendMessage("setNoiseFreq",e)}setVCODutyCycle(e){this.sendMessage("setVCODutyCycle",e)}setMixerMode(e){this.sendMessage("setMixerMode",e)}setEnvelopeMode(e){this.sendMessage("setEnvelopeMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setDecayTime(e){this.sendMessage("setDecayTime",e)}setOneShotTime(e){this.sendMessage("setOneShotTime",e)}setNoiseFilterFreq(e){this.sendMessage("setNoiseFilterFreq",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setVCOMode(e){this.sendMessage("setVCOMode",e)}setChipEnable(e){this.sendMessage("setEnable",e?0:1)}setVCORes(e){this.sendMessage("setVCORes",e)}setVCOCap(e){this.sendMessage("setVCOCap",e)}setVCOVoltage(e){this.sendMessage("setVCOVoltage",e)}setPitchVoltage(e){this.sendMessage("setPitchVoltage",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}static RES_K(e){return 1e3*e}static RES_M(e){return 1e6*e}static CAP_U(e){return 1e-6*e}static CAP_N(e){return 1e-9*e}static CAP_P(e){return 1e-12*e}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_freq:Zu,slf_freq:Ju,noise_freq:ep,vco_duty_cycle:tp,mixer_mode:np,envelope_mode:ap,attack_time:sp,decay_time:rp,one_shot_time:op,noise_filter_freq:ip,amplitude:lp,vco_mode:cp,enable:dp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const pp=0,hp=1,mp=2,fp=3;class yp extends _r{name="SNKWaveSynth";chipName="SNKWave";workletFile="SNKWave.worklet.js";processorName="snkwave-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e){this.writeWavetableSelect(e)}setCustomWaveform(e,t,n,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setCustomWaveform",b0:e,b1:t,b2:n,b3:a})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:pp,waveform:hp,stereo_width:mp,detune:fp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const gp=0,vp=1,bp=2,xp=3,wp=4,kp=5;class Sp extends _r{name="SP0250Synth";chipName="SP0250";workletFile="SP0250.worklet.js";processorName="sp0250-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVowel(e){this.sendMessage("setVowel",e)}setVoiced(e){this.setParameterById(bp,e?1:0)}setBrightness(e){this.setParameterById(xp,e)}writeFIFO(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeFIFO",index:e,data:t})}setFilterCoeff(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFilterCoeff",filterIdx:e,isB:t,value:n})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:gp,vowel:vp,voiced:bp,brightness:xp,stereo_width:wp,filter_mix:kp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Mp=0,Np=1,Cp=2,Ep=3,Pp=4,Tp=5;class Ap extends _r{name="TMS36XXSynth";chipName="TMS36XX";workletFile="TMS36XX.worklet.js";processorName="tms36xx-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setStopEnable(e){this.sendMessage("setStopEnable",e)}setOctave(e){this.sendMessage("setOctave",e)}setDecayRate(e){this.setParameterById(Cp,e)}setDetune(e){this.setParameterById(Tp,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Mp,stop_enable:Np,decay_rate:Cp,octave:Ep,stereo_width:Pp,detune:Tp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const _p=0,Ip=1,Dp=2,Op=3,Fp=4,Rp=5,jp=6,Lp=7,Bp=8,Vp=9;class zp extends _r{name="TMS5220Synth";chipName="TMS5220";workletFile="TMS5220.worklet.js";processorName="tms5220-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",k1:e,k2:t,k3:n})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setChirpType(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChirpType",value:e})}setEnergy(e){this.setParameterById(Rp,e)}setBrightness(e){this.setParameterById(Vp,e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:_p,chirp_type:Ip,k1_index:Dp,k2_index:Op,k3_index:Fp,energy_index:Rp,pitch_index:jp,noise_mode:Lp,stereo_width:Bp,brightness:Vp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Up=0,Gp=1,Wp=2,Kp=3,Hp=4,$p=5,qp=6,Yp=7,Xp=8,Qp=9,Zp=10,Jp=11,eh=12,th={BASS_1:36,SNARE_1:38,SNARE_2:40,LOW_TOM:41,MID_TOM:47,HI_TOM:50,RIMSHOT:37,COWBELL:56,HANDCLAP:39,TAMBOURINE:54,CLOSED_HIHAT:42,OPEN_HIHAT:46,CRASH:49,RIDE:51};class nh extends _r{name="TR707Synth";chipName="TR707";workletFile="TR707.worklet.js";processorName="tr707-processor";constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(e=!1){if(e)try{return await kd(md)}catch(t){}return kd(hd)}(!1);await super.initialize(),this.loadCombinedROM(e);for(let t=0;t<10;t++)this.setParameterById(Gp+t,.8);this.setParameterById(Up,.8),this.setParameterById(Jp,.5),this.setParameterById(eh,.5)}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"allNotesOff"})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}loadCombinedROM(e){this.loadROM(0,e)}loadROMs(e,t,n){this.loadROM(0,e),this.loadROM(65536,t),this.loadROM(98304,n)}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setVoiceLevel(e,t){this.setParameterById(Gp+e,t)}setAccent(e){this.setParameterById(Jp,e)}setDecay(e){this.setParameterById(eh,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Up,bass:Gp,snare:Wp,low_tom:Kp,mid_tom:Hp,hi_tom:$p,rimshot:qp,handclap:Yp,hihat:Xp,crash:Qp,ride:Zp,accent:Jp,decay:eh}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ah=0,sh=1,rh=2,oh=3,ih=4,lh=5,ch=6,dh=7;class uh extends _r{name="UPD931Synth";chipName="UPD931";workletFile="UPD931.worklet.js";processorName="upd931-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveA(e){this.setParameterById(sh,e)}setWaveB(e){this.setParameterById(rh,e)}setMirror(e){this.setParameterById(oh,e?1:0)}setInvert(e){this.setParameterById(ih,e?1:0)}setModeA(e){this.setParameterById(lh,e)}setModeB(e){this.setParameterById(ch,e)}setKeyScaling(e){this.setParameterById(dh,e?1:0)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:ah,wave_a:sh,wave_b:rh,mirror:oh,invert:ih,mode_a:lh,mode_b:ch,key_scaling:dh}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ph=0,hh=1,mh=2,fh=3,yh=4,gh=5,vh=6,bh=7,xh=8,wh=9,kh=10;class Sh extends _r{name="UPD933Synth";chipName="UPD933";workletFile="UPD933.worklet.js";processorName="upd933-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",wave1:e,wave2:t})}setWindow(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWindow",value:e})}setDCWDepth(e){this.setParameterById(yh,e)}setDCARate(e){this.setParameterById(gh,e)}setDCWRate(e){this.setParameterById(vh,e)}setDCODepth(e){this.setParameterById(xh,e)}setRingMod(e){this.setParameterById(wh,e?1:0)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:ph,waveform1:hh,waveform2:mh,window:fh,dcw_depth:yh,dca_rate:gh,dcw_rate:vh,dco_rate:bh,dco_depth:xh,ring_mod:wh,stereo_width:kh}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Mh=0,Nh=1,Ch=2,Eh=3,Ph=4,Th=5,Ah=6;class _h extends _r{name="VotraxSynth";chipName="Votrax";workletFile="Votrax.worklet.js";processorName="votrax-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setPhoneme(e){this.sendMessage("setPhoneme",e)}setInflection(e){this.setParameterById(Ch,e)}setF1Override(e){this.setParameterById(Eh,e)}setF2Override(e){this.setParameterById(Ph,e)}setF3Override(e){this.setParameterById(Th,e)}writePhone(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writePhone",value:e})}writeInflection(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeInflection",value:e})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Mh,phoneme:Nh,inflection:Ch,f1_override:Eh,f2_override:Ph,f3_override:Th,stereo_width:Ah}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Ih=0,Dh=1,Oh=2,Fh=3,Rh=4,jh=5,Lh=6,Bh=7,Vh=8,zh=9,Uh=10,Gh=11,Wh=12,Kh=13,Hh=14,$h=15;class qh extends _r{name="YMF271Synth";chipName="YMF271";workletFile="YMF271.worklet.js";processorName="ymf271-processor";currentGroup=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),group:this.currentGroup})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,group:this.currentGroup})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=16384e3){let n=0,a=0;for(n=0;n<8&&(a=Math.round(1024*e*Math.pow(2,20-n)/t),!(a<1024));n++);return{block:Math.min(7,n),fnum:Math.max(0,Math.min(1023,a))}}(e);this.workletNode.port.postMessage({type:"setFrequency",block:t.block,fnum:t.fnum,group:this.currentGroup})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const a of t)this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:a,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,group:this.currentGroup})}getCarrierOperators(){return{0:[3],1:[2,3],2:[2,3],3:[1,3],4:[1,3],5:[0,2,3],6:[0,2,3],7:[0,1,2,3]}[this.currentAlgorithm%8]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Dh,value:e/15})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Oh,value:e/7})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Hh,value:e/7})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:$h,value:e/3})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d1r",value:t})}setOperatorD2R(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d2r",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"dt",value:t})}setOperatorWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"waveform",value:t})}setGroup(e){this.currentGroup=Math.max(0,Math.min(11,e))}setLFOFrequency(e){this.setParameterById(Wh,e/255)}setLFOWaveform(e){this.setParameterById(Kh,e/3)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Ih,volume:Ih,algorithm:Dh,feedback:Oh,waveform:Fh,tl:Rh,total_level:Rh,ar:jh,attack:jh,d1r:Lh,decay1:Lh,d2r:Bh,decay2:Bh,rr:Vh,release:Vh,d1l:zh,decay1_level:zh,multiple:Uh,detune:Gh,lfo_freq:Wh,lfo_wave:Kh,pms:Hh,ams:$h}[e];void 0!==n&&this.setParameterById(n,t)}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setWaveform(e){this.setParameterById(Fh,e/6)}setAttackRate(e){this.setParameterById(jh,e/31)}setDecay1Rate(e){this.setParameterById(Lh,e/31)}setDecay2Rate(e){this.setParameterById(Bh,e/31)}setReleaseRate(e){this.setParameterById(Vh,e/15)}setTotalLevel(e){this.setParameterById(Rh,e/127)}setMultiple(e){this.setParameterById(Uh,e/15)}setMasterVolume(e){this.setParameterById(Ih,e)}}const Yh=0,Xh=1,Qh=2,Zh=3,Jh=4,em=5,tm=6,nm=10,am=11,sm=12,rm=13,om=14,im=15,lm=16,cm=17,dm=18,um=19,pm=20;class hm extends _r{name="YMOPQSynth";chipName="YMOPQ";workletFile="YMOPQ.worklet.js";processorName="ymopq-processor";currentChannel=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=Ar(e);this.workletNode.port.postMessage({type:"setFrequency",kc:t.kc,kf:t.kf,channel:this.currentChannel})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const a of t)this.workletNode.port.postMessage({type:"setOperatorParam",channel:this.currentChannel,op:a,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,channel:this.currentChannel})}getCarrierOperators(){return{0:[3],1:[3],2:[3],3:[3],4:[1,3],5:[1,2,3],6:[1,2,3],7:[0,1,2,3]}[this.currentAlgorithm]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setAlgorithm",value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFeedback",value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Zh,e/7)}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Jh,e/3)}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+nm,t/127)}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+am,t/31)}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+sm,t/31)}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+om,t/15)}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+im,t/15)}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+lm,t/15)}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+cm,t/7)}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setLFORate(e){this.sendMessage("setLFORate",e)}setVolume(e){this.sendMessage("setVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n=e.match(/^op(\d+)_(.+)$/);if(n)return void this.setOperatorParamByName(parseInt(n[1]),n[2],t);const a={algorithm:Yh,feedback:Xh,lfo_rate:Qh,lfo_pm_sens:Zh,lfo_am_sens:Jh,reverb:em,volume:tm}[e];void 0!==a&&this.setParameterById(a,t)}setOperatorParamByName(e,t,n){const a={total_level:nm,attack_rate:am,decay_rate:sm,sustain_rate:rm,sustain_level:om,release_rate:im,multiple:lm,detune:cm,waveform:dm,ksr:um,am_enable:pm}[t];void 0!==a&&e>=1&&e<=4&&this.setParameterById(100*e+a,n)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const mm=0,fm=1,ym=2,gm=3,vm=4,bm=5,xm=6,wm=7;class km extends _r{name="VASynthSynth";chipName="VASynth";workletFile="VASynth.worklet.js";processorName="vasynth-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e){return Math.max(20,Math.min(2e4,e))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setOsc1Wave(e){this.setParameterById(fm,e)}setOsc2Wave(e){this.setParameterById(ym,e)}setOscMix(e){this.setParameterById(gm,e)}setOsc2Detune(e){this.setParameterById(vm,e)}setFilterCutoff(e){this.setParameterById(bm,e)}setFilterResonance(e){this.setParameterById(xm,e)}setFilterEnvDepth(e){this.setParameterById(wm,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:mm,osc1_wave:fm,osc2_wave:ym,osc_mix:gm,osc2_detune:vm,filter_cutoff:bm,filter_res:xm,filter_env_depth:wm}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Sm=(e,t,...n)=>{const a=`(${t.toString()})(${n.map(e=>JSON.stringify(e)).join(", ")});`,s=URL.createObjectURL(new Blob([a],{type:"text/javascript"}));return e.addModule(s)},Mm=e=>{const t=globalThis;if(t.AudioWorkletProcessor&&t.webAudioModules)return;const n=new Map,a=new Map;class s{get apiVersion(){return e}getModuleScope(e){return n.has(e)||n.set(e,{}),n.get(e)}getGroup(e,t){const n=a.get(e);if(n.validate(t))return n;throw new Error("Invalid key")}addGroup(e){a.has(e.groupId)||a.set(e.groupId,e)}removeGroup(e){a.delete(e.groupId)}addWam(e){a.get(e.groupId)?.addWam(e)}removeWam(e){a.get(e.groupId)?.removeWam(e)}connectEvents(e,t,n,s=0){a.get(e)?.connectEvents(t,n,s)}disconnectEvents(e,t,n,s){a.get(e)?.disconnectEvents(t,n,s)}emitEvents(e,...t){a.get(e.groupId)?.emitEvents(e,...t)}}t.AudioWorkletProcessor&&(t.webAudioModules||(t.webAudioModules=new s))},Nm=(e,t)=>{const n=globalThis;class a{_groupId;_validate;_processors=new Map;_eventGraph=new Map;constructor(e,t){this._groupId=e,this._validate=e=>e===t}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(e){return this._validate(e)}addWam(e){this._processors.set(e.instanceId,e)}removeWam(e){this._eventGraph.has(e)&&this._eventGraph.delete(e),this._eventGraph.forEach(t=>{t.forEach(t=>{t&&t.delete(e)})}),this._processors.delete(e.instanceId)}connectEvents(e,t,n=0){const a=this._processors.get(e),s=this._processors.get(t);let r;if(this._eventGraph.has(a)?r=this._eventGraph.get(a):(r=[],this._eventGraph.set(a,r)),r[n])r[n].add(s);else{const e=new Set;e.add(s),r[n]=e}}disconnectEvents(e,t,n){const a=this._processors.get(e);if(!this._eventGraph.has(a))return;const s=this._eventGraph.get(a);if(void 0===t)return void s.forEach(e=>{e&&e.clear()});const r=this._processors.get(t);void 0!==n?s[n]&&s[n].delete(r):s.forEach(e=>{e&&e.delete(r)})}emitEvents(e,...t){this._eventGraph.has(e)&&this._eventGraph.get(e).forEach(e=>{e&&e.forEach(e=>e.scheduleEvents(...t))})}}n.AudioWorkletProcessor&&n.webAudioModules.addGroup(new a(e,t))};class Cm{name="WAMSynth";output;_wamInstance=null;_wamNode=null;_config;_isInitialized=!1;_initPromise;_releaseTimers=new Set;_activeNotes=new Set;_audioContext;static _hostInitPromise=null;static initializeHost(e){if(Cm._hostInitPromise)return Cm._hostInitPromise;const t=`devilbox-host-${performance.now()}`,n=performance.now().toString();return Cm._hostInitPromise=(async()=>(await Sm(e.audioWorklet,Mm,"2.0.0-alpha.6"),await Sm(e.audioWorklet,Nm,t,n),[t,n]))(),Cm._hostInitPromise}constructor(e){this._audioContext=Ja(),this.output=this._audioContext.createGain(),this.output.gain.value=1,this._config=e,this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}async _initialize(){if(this._config.moduleUrl)try{const t=this._audioContext,[n]=await Cm.initializeHost(t),{default:a}=await import(this._config.moduleUrl);if(!a||"function"!=typeof a)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const s=/^class\s/.test(a.toString());if(s&&"function"==typeof a.createInstance)this._wamInstance=await a.createInstance(n,t);else if(s){const e=new a(n,t);"function"==typeof e.initialize&&await e.initialize(),this._wamInstance=e}else this._wamInstance=await a(t,n);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");if(this._wamNode.connect(this.output),this._config.pluginState&&this._wamInstance.setState)try{await this._wamInstance.setState(this._config.pluginState)}catch(e){this._config.pluginState=null}this._isInitialized=!0}catch(t){const e=t instanceof Error?t.message:String(t);let n;throw n=e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("net::ERR_")?`Network error loading WAM module. Check that the URL is correct and accessible: ${this._config.moduleUrl}`:e.includes("CORS")||e.includes("cross-origin")||e.includes("has been blocked")?`CORS policy blocked loading this WAM module. The server hosting the plugin must allow cross-origin requests. URL: ${this._config.moduleUrl}`:e.includes("not a valid JavaScript MIME type")||e.includes("SyntaxError")||e.includes("Unexpected token")?"Invalid module format. The URL does not point to a valid WAM 2.0 JavaScript module. Ensure the URL points to the plugin's index.js entry point.":`WAM initialization failed: ${e}`,new Error(n)}}_sendMidi(e,t){this._wamInstance.onMidi?this._wamInstance.onMidi(e,t):this._wamNode?.scheduleEvents?this._wamNode.scheduleEvents({type:"wam-midi",data:{bytes:e},time:t}):this._wamNode?.port&&this._wamNode.port.postMessage({type:"wam-midi",data:{bytes:e},time:t})}triggerAttack(e,t,n=1){if(!this._isInitialized||!this._wamInstance)return this;const a=rs(e),s=Math.round(127*n),r=t??this._audioContext.currentTime;return this._activeNotes.add(a),this._sendMidi([144,a,s],r),this}triggerRelease(e,t){if(!this._isInitialized||!this._wamInstance)return this;const n=t??this._audioContext.currentTime;if(void 0!==e){const t=rs(e);this._activeNotes.delete(t),this._sendMidi([128,t,0],n)}else{for(const e of this._activeNotes)this._sendMidi([128,e,0],n);this._activeNotes.clear(),this._sendMidi([176,123,0],n)}return this}triggerAttackRelease(e,t,n,a=1){this.triggerAttack(e,n,a);const s=(n??this._audioContext.currentTime)+t,r=setTimeout(()=>{this._releaseTimers.delete(r),this._isInitialized&&this._wamInstance&&this.triggerRelease(e,s)},1e3*t);return this._releaseTimers.add(r),this}releaseAll(e){return this.triggerRelease(void 0,e)}async setPluginState(e){if(this._isInitialized&&this._wamInstance?.setState)try{await this._wamInstance.setState(e),this._config.pluginState=e,this._config.pluginStateTimestamp=Date.now()}catch(t){}else this._config.pluginState=e}async getPluginState(){if(this._isInitialized&&this._wamInstance?.getState){return{state:await this._wamInstance.getState(),timestamp:Date.now(),version:1}}return this._config.pluginState}async setParameter(e,t){if(this._isInitialized&&this._wamInstance&&this._wamInstance.setParameterValues){const n="number"==typeof e?e.toString():e;await this._wamInstance.setParameterValues({[n]:{id:n,value:t}})}}async getParameters(){return this._isInitialized&&this._wamInstance&&this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():{}}async createGui(){return this._isInitialized&&this._wamInstance&&this._wamInstance.createGui?await this._wamInstance.createGui():null}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._activeNotes.clear(),this._wamNode&&this._wamNode.disconnect(),this._wamInstance?.destroy&&this._wamInstance.destroy(),this.output.disconnect()}}const Em=new Map,Pm=new WeakMap;class Tm{name;output;_worklet=null;_descriptor;_isReady=!1;_initPromise;_params=[];_paramValues=new Map;_pendingNotes=[];constructor(e,t){this._descriptor=e,this.name=`VSTBridge:${e.id}`;const n=Ja();if(this.output=n.createGain(),e.volumeOffsetDb){const t=Math.pow(10,e.volumeOffsetDb/20);this.output.gain.value=t}this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}getParams(){return this._params}getDescriptor(){return this._descriptor}async _initialize(){try{const e=Ja(),{wasmBinary:t,jsCode:n}=await async function(e,t){const n="/DEViLBOX/";if(!Pm.get(e)){try{await e.audioWorklet.addModule(`${n}vstbridge/VSTBridge.worklet.js`)}catch(s){}Pm.set(e,!0)}const a=t.id;if(!Em.has(a)){const e=(async()=>{const e=`${n}${t.wasmDir}/${t.wasmFile}.wasm`,a=`${n}${t.wasmDir}/${t.wasmFile}.js`,[s,r]=await Promise.all([fetch(e),fetch(a)]);if(!s.ok)throw new Error(`Failed to load ${e}: ${s.status}`);if(!r.ok)throw new Error(`Failed to load ${a}: ${r.status}`);const[o,i]=await Promise.all([s.arrayBuffer(),r.text()]);return{wasmBinary:o,jsCode:br(i,`${n}${t.wasmDir}/`)}})();Em.set(a,e)}return Em.get(a)}(e,this._descriptor),{workletNode:a,readyPromise:s}=function(e,t,n,a,s){const r=new AudioWorkletNode(e,"vstbridge-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate,synthClassName:t.synthClassName,moduleFactoryName:t.moduleFactoryName}}),o=new Promise((e,n)=>{const a=setTimeout(()=>n(new Error(`VSTBridge ${t.id} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=o=>{"ready"===o.data.type?(clearTimeout(a),e()):"error"===o.data.type&&(clearTimeout(a),n(new Error(o.data.error||`VSTBridge ${t.id} init error`))),s&&s.call(r.port,o)}});r.port.postMessage({type:"init",wasmBinary:n,jsCode:a,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch(i){}return{workletNode:r,readyPromise:o}}(e,this._descriptor,t,n,this.output);this._worklet=a;const r=a.port.onmessage;a.port.onmessage=e=>{if("params"===e.data.type){this._params=e.data.params;for(const e of this._params)this._paramValues.has(e.id)||this._paramValues.set(e.id,e.defaultValue)}r&&r.call(a.port,e)},await s,this._isReady=!0,this._worklet.port.postMessage({type:"getParams"});for(const{note:o,velocity:i}of this._pendingNotes)this._worklet.port.postMessage({type:"noteOn",note:o,velocity:i});this._pendingNotes=[]}catch(e){}}triggerAttack(e,t,n=1){const a=rs(e),s=Math.round(127*n);return this._worklet&&this._isReady?this._worklet.port.postMessage({type:"noteOn",note:a,velocity:s}):this._pendingNotes.push({note:a,velocity:s}),this}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=rs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}triggerAttackRelease(e,t,n,a=1){return this.triggerAttack(e,n,a),setTimeout(()=>this.triggerRelease(e),1e3*t),this}set(e,t){if(!this._worklet)return;let n;if(/^\d+$/.test(e))n=parseInt(e,10);else{const t=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!t)return;n=t.id}this._paramValues.set(n,t),this._worklet.port.postMessage({type:"parameter",paramId:n,value:t})}get(e){let t;if(/^\d+$/.test(e))t=parseInt(e,10);else{const n=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!n)return;t=n.id}return this._paramValues.get(t)}setParameter(e,t){this._worklet&&(this._paramValues.set(e,t),this._worklet.port.postMessage({type:"parameter",paramId:e,value:t}))}getParameter(e){return this._paramValues.get(e)}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}programChange(e){this._worklet?.port.postMessage({type:"programChange",program:e})}async sendCommand(e,t){return!(!this._worklet||!this._isReady)&&new Promise(n=>{const a=setTimeout(()=>n(!1),2e3),s=t=>{"commandResult"===t.data.type&&t.data.commandType===e&&(clearTimeout(a),this._worklet?.port.removeEventListener("message",s),n(t.data.handled))};this._worklet.port.addEventListener("message",s),this._worklet.port.postMessage({type:"command",commandType:e,data:t?Array.from(t):[]})})}setVolumeOffset(e){const t=Math.pow(10,e/20);this.output.gain.value=t}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Am=new Map;function _m(e){Am.set(e.id,e)}_m({id:"DexedBridge",name:"Dexed DX7 (Bridge)",wasmDir:"dexed",wasmFile:"Dexed",synthClassName:"DexedSynth",moduleFactoryName:"createDexedModule",volumeOffsetDb:41,commands:["loadSysEx","loadPatch"]}),_m({id:"Vital",name:"Vital (Wavetable)",wasmDir:"vital",wasmFile:"Vital",synthClassName:"VitalSynth",moduleFactoryName:"createVitalModule",volumeOffsetDb:0,panelComponent:"VitalControls",commands:["loadWavetable","loadPreset"]}),_m({id:"Odin2",name:"Odin2 (Hybrid)",wasmDir:"odin2",wasmFile:"Odin2",synthClassName:"Odin2Synth",moduleFactoryName:"createOdin2Module",volumeOffsetDb:0,panelComponent:"Odin2Controls",commands:["loadPatch"]}),_m({id:"Surge",name:"Surge XT (Hybrid)",wasmDir:"surge",wasmFile:"Surge",synthClassName:"SurgeSynth",moduleFactoryName:"createSurgeModule",volumeOffsetDb:0,panelComponent:"SurgeControls",commands:["loadPatch","loadWavetable"]}),_m({id:"TonewheelOrgan",name:"Tonewheel Organ",wasmDir:"tonewheel",wasmFile:"Tonewheel",synthClassName:"TonewheelOrganSynth",moduleFactoryName:"createTonewheelModule",volumeOffsetDb:0}),_m({id:"Melodica",name:"Melodica",wasmDir:"melodica",wasmFile:"Melodica",synthClassName:"MelodicaWASMSynth",moduleFactoryName:"createMelodicaModule",volumeOffsetDb:0}),_m({id:"Monique",name:"Monique (Monosynth)",wasmDir:"monique",wasmFile:"Monique",synthClassName:"MoniqueSynth",moduleFactoryName:"createMoniqueModule",volumeOffsetDb:0}),_m({id:"Helm",name:"Helm (Poly)",wasmDir:"helm",wasmFile:"Helm",synthClassName:"HelmSynth",moduleFactoryName:"createHelmModule",volumeOffsetDb:0}),_m({id:"Sorcer",name:"Sorcer (Wavetable)",wasmDir:"sorcer",wasmFile:"Sorcer",synthClassName:"SorcerSynth",moduleFactoryName:"createSorcerModule",volumeOffsetDb:0}),_m({id:"Amsynth",name:"amsynth (Analog)",wasmDir:"amsynth",wasmFile:"Amsynth",synthClassName:"AmsynthSynth",moduleFactoryName:"createAmsynthModule",volumeOffsetDb:0}),_m({id:"OBXf",name:"OB-Xf (Analog)",wasmDir:"obxf",wasmFile:"OBXf",synthClassName:"OBXfSynth",moduleFactoryName:"createOBXfModule",volumeOffsetDb:0});const Im={FurnaceNES:Wo.NES,FurnaceGB:Wo.GB,FurnaceSNES:Wo.SNES,FurnacePCE:Wo.PCE,FurnacePSG:Wo.SMS,FurnaceVB:Wo.VBOY,FurnaceLynx:Wo.LYNX,FurnaceSWAN:Wo.SWAN,FurnaceVRC6:Wo.VRC6,FurnaceN163:Wo.N163,FurnaceFDS:Wo.FDS,FurnaceMMC5:Wo.MMC5,FurnaceGBA:Wo.GBA_DMA,FurnaceNDS:Wo.NDS,FurnacePOKEMINI:Wo.POKEMINI,FurnaceC64:Wo.C64_6581,FurnaceSID6581:Wo.C64_6581,FurnaceSID8580:Wo.C64_8580,FurnaceAY:Wo.AY8910,FurnaceAY8930:Wo.AY8930,FurnaceVIC:Wo.VIC20,FurnaceSAA:Wo.SAA1099,FurnaceTED:Wo.TED,FurnaceVERA:Wo.VERA,FurnaceSCC:Wo.SCC,FurnaceTIA:Wo.TIA,FurnaceAMIGA:Wo.AMIGA,FurnacePET:Wo.PET,FurnacePCSPKR:Wo.PCSPKR,FurnaceZXBEEPER:Wo.SFX_BEEPER,FurnacePOKEY:Wo.POKEY,FurnacePONG:Wo.PONG,FurnacePV1000:Wo.PV1000,FurnaceDAVE:Wo.DAVE,FurnaceSU:Wo.SOUND_UNIT,FurnacePOWERNOISE:Wo.POWERNOISE,FurnaceSEGAPCM:Wo.SEGAPCM,FurnaceQSOUND:Wo.QSOUND,FurnaceES5506:Wo.ES5506,FurnaceRF5C68:Wo.RF5C68,FurnaceC140:Wo.C140,FurnaceK007232:Wo.K007232,FurnaceK053260:Wo.K053260,FurnaceGA20:Wo.GA20,FurnaceOKI:Wo.MSM6295,FurnaceYMZ280B:Wo.YMZ280B,FurnaceX1_010:Wo.X1_010,FurnaceMSM6258:Wo.MSM6258,FurnaceMSM5232:Wo.MSM5232,FurnaceMULTIPCM:Wo.MULTIPCM,FurnaceNAMCO:Wo.NAMCO,FurnacePCMDAC:Wo.PCM_DAC,FurnaceBUBBLE:Wo.BUBSYS_WSG,FurnaceSM8521:Wo.SM8521,FurnaceT6W28:Wo.T6W28,FurnaceSUPERVISION:Wo.SUPERVISION,FurnaceUPD1771:Wo.UPD1771C,FurnaceSCVTONE:Wo.UPD1771C};class Dm{static VOLUME_NORMALIZATION_OFFSETS={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7,PolySynth:8,TB303:15,JC303:15,Buzz3o3:5,Furnace:0,FurnaceOPN:7,FurnaceOPM:2,FurnaceOPL:10,FurnaceOPLL:2,FurnaceESFM:0,FurnaceOPZ:0,FurnaceOPNA:5,FurnaceOPNB:5,FurnaceOPL4:6,FurnaceY8950:6,FurnaceVRC7:2,FurnaceOPN2203:0,FurnaceOPNBB:2,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:3,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:6,FurnaceSID6581:6,FurnaceSID8580:6,FurnaceAY:3,FurnaceAY8930:3,FurnaceVIC:3,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:17,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:3,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:3,FurnaceSU:8,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:5,FurnaceES5506:38,FurnaceRF5C68:0,FurnaceC140:8,FurnaceK007232:-4,FurnaceK053260:3,FurnaceGA20:3,FurnaceOKI:44,FurnaceYMZ280B:14,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:14,FurnaceNAMCO:3,FurnacePCMDAC:-5,FurnaceBUBBLE:3,FurnaceSM8521:3,FurnaceT6W28:3,FurnaceSUPERVISION:3,FurnaceUPD1771:3,BuzzKick:3,BuzzKickXP:5,BuzzNoise:7,BuzzTrilok:5,Buzz4FM2F:7,BuzzFreqBomb:4,Buzz3o3DF:8,Synare:7,DubSiren:13,SpaceLaser:24,V2:0,Sam:16,SuperSaw:9,WobbleBass:13,FormantSynth:9,StringMachine:11,PWMSynth:9,ChipSynth:5,Wavetable:5,Organ:3,Sampler:10,Player:10,GranularSynth:-47,DrumMachine:18,ChiptuneModule:-6,DrumKit:0,MAMEVFX:0,MAMEDOC:0,MAMERSA:0,MAMESWP30:0,CZ101:0,Dexed:41,OBXd:9,CEM3394:19,SCSP:15,MAMEAstrocade:18,MAMESN76477:5,MAMEASC:11,MAMEES5503:62,MAMEMEA8000:12,MAMESNKWave:8,MAMESP0250:26,MAMETMS36XX:6,MAMEVotrax:20,MAMEYMOPQ:19,MAMEUPD931:23,MAMEUPD933:28,MAMETMS5220:37,MAMEYMF271:15,MAMETR707:22,MAMEVASynth:20,MAMEAICA:0,MAMEICS2115:35,MAMEK054539:22,MAMEC352:17,MAMERF5C400:0};static getNormalizedVolume(e,t){return(t??-12)+(this.VOLUME_NORMALIZATION_OFFSETS[e]??0)}static createInstrument(e){let t;switch(e.synthType){case"Synth":case"ChiptuneModule":t=this.createSynth(e);break;case"MonoSynth":t=this.createMonoSynth(e);break;case"DuoSynth":t=this.createDuoSynth(e);break;case"FMSynth":t=this.createFMSynth(e);break;case"AMSynth":t=this.createAMSynth(e);break;case"PluckSynth":t=this.createPluckSynth(e);break;case"MetalSynth":t=this.createMetalSynth(e);break;case"MembraneSynth":t=this.createMembraneSynth(e);break;case"NoiseSynth":t=this.createNoiseSynth(e);break;case"TB303":t=this.createTB303(e);break;case"Furnace":t=this.createFurnace(e);break;case"Buzzmachine":t=this.createBuzzmachine(e);break;case"FurnaceOPN":t=this.createFurnaceWithChip(e,Po.OPN2);break;case"FurnaceOPM":t=this.createFurnaceWithChip(e,Po.OPM);break;case"FurnaceOPL":t=this.createFurnaceWithChip(e,Po.OPL3);break;case"FurnaceOPLL":case"FurnaceVRC7":t=this.createFurnaceWithChip(e,Po.OPLL);break;case"FurnaceESFM":t=this.createFurnaceWithChip(e,Po.ESFM);break;case"FurnaceOPZ":t=this.createFurnaceWithChip(e,Po.OPZ);break;case"FurnaceOPNA":t=this.createFurnaceWithChip(e,Po.OPNA);break;case"FurnaceOPNB":t=this.createFurnaceWithChip(e,Po.OPNB);break;case"FurnaceOPL4":t=this.createFurnaceWithChip(e,Po.OPL4);break;case"FurnaceY8950":t=this.createFurnaceWithChip(e,Po.Y8950);break;case"FurnaceNES":case"FurnaceGB":case"FurnaceSNES":case"FurnacePCE":case"FurnacePSG":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceGBA":case"FurnaceNDS":case"FurnacePOKEMINI":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceAY8930":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSCC":case"FurnaceTIA":case"FurnaceAMIGA":case"FurnacePET":case"FurnacePCSPKR":case"FurnaceZXBEEPER":case"FurnacePOKEY":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceX1_010":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceNAMCO":case"FurnacePCMDAC":case"FurnaceBUBBLE":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":{const n=Im[e.synthType];void 0!==n?(t=new Jo(n),void 0!==e.furnace?.furnaceIndex&&(t.setFurnaceInstrumentIndex(e.furnace.furnaceIndex),t.uploadInstrumentFromConfig(e.furnace,e.name).catch(e=>{}))):t=this.createFurnaceWithChip(e,Po.OPN2);break}case"FurnaceOPN2203":t=this.createFurnaceWithChip(e,Po.OPN);break;case"FurnaceOPNBB":t=this.createFurnaceWithChip(e,Po.OPNB_B);break;case"Sampler":const n=e.metadata?.modPlayback?.usePeriodPlayback;t=n?this.createPlayer(e):this.createSampler(e);break;case"Player":t=this.createPlayer(e);break;case"Wavetable":t=this.createWavetable(e);break;case"GranularSynth":t=this.createGranularSynth(e);break;case"SuperSaw":t=this.createSuperSaw(e);break;case"PolySynth":t=this.createPolySynth(e);break;case"Organ":t=this.createOrgan(e);break;case"DrumMachine":t=this.createDrumMachine(e);break;case"ChipSynth":t=this.createChipSynth(e);break;case"PWMSynth":t=this.createPWMSynth(e);break;case"StringMachine":t=this.createStringMachine(e);break;case"FormantSynth":t=this.createFormantSynth(e);break;case"WobbleBass":t=this.createWobbleBass(e);break;case"DrumKit":t=this.createDrumKit(e);break;case"DubSiren":t=this.createDubSiren(e);break;case"SpaceLaser":t=this.createSpaceLaser(e);break;case"V2":t=this.createV2(e);break;case"Sam":t=this.createSam(e);break;case"Synare":t=this.createSynare(e);break;case"WAM":t=this.createWAM(e);break;case"Dexed":t=this.createDexed(e);break;case"OBXd":t=this.createOBXd(e);break;case"MAMEVFX":case"VFX":t=this.createVFX(e);break;case"D50":t=this.createD50(e);break;case"MAMEDOC":t=new yr({type:"doc"});break;case"MAMERSA":t=this.createRdPiano(e);break;case"MAMESWP30":t=this.createMU2000(e);break;case"CZ101":t=this.createCZ101(e);break;case"CEM3394":t=this.createCEM3394(e);break;case"SCSP":t=this.createSCSP(e);break;case"BuzzDTMF":t=this.createBuzzGenerator(al.CYANPHASE_DTMF,"BuzzDTMF",e);break;case"BuzzFreqBomb":t=this.createBuzzGenerator(al.ELENZIL_FREQUENCYBOMB,"BuzzFreqBomb",e);break;case"BuzzKick":t=this.createBuzzGenerator(al.FSM_KICK,"BuzzKick",e);break;case"BuzzKickXP":t=this.createBuzzGenerator(al.FSM_KICKXP,"BuzzKickXP",e);break;case"BuzzNoise":t=this.createBuzzGenerator(al.JESKOLA_NOISE,"BuzzNoise",e);break;case"BuzzTrilok":t=this.createBuzzGenerator(al.JESKOLA_TRILOK,"BuzzTrilok",e);break;case"Buzz4FM2F":t=this.createBuzzGenerator(al.MADBRAIN_4FM2F,"Buzz4FM2F",e);break;case"BuzzDynamite6":t=this.createBuzzGenerator(al.MADBRAIN_DYNAMITE6,"BuzzDynamite6",e);break;case"BuzzM3":t=this.createBuzzGenerator(al.MAKK_M3,"BuzzM3",e);break;case"Buzz3o3":t=this.createBuzz3o3(e);break;case"Buzz3o3DF":t=this.createBuzz3o3DF(e);break;case"BuzzM4":t=this.createBuzzGenerator(al.MAKK_M4,"BuzzM4",e);break;case"MAMEAICA":t=this.createMAMEAICA(e);break;case"MAMEASC":t=this.createMAMEASC(e);break;case"MAMEAstrocade":t=this.createMAMEAstrocade(e);break;case"MAMEC352":t=this.createMAMEC352(e);break;case"MAMEES5503":t=this.createMAMEES5503(e);break;case"MAMEICS2115":t=this.createMAMEICS2115(e);break;case"MAMEK054539":t=this.createMAMEK054539(e);break;case"MAMEMEA8000":t=this.createMAMEMEA8000(e);break;case"MAMERF5C400":t=this.createMAMERF5C400(e);break;case"MAMESN76477":t=this.createMAMESN76477(e);break;case"MAMESNKWave":t=this.createMAMESNKWave(e);break;case"MAMESP0250":t=this.createMAMESP0250(e);break;case"MAMETMS36XX":t=this.createMAMETMS36XX(e);break;case"MAMETMS5220":t=this.createMAMETMS5220(e);break;case"MAMETR707":t=this.createMAMETR707(e);break;case"MAMEUPD931":t=this.createMAMEUPD931(e);break;case"MAMEUPD933":t=this.createMAMEUPD933(e);break;case"MAMEVotrax":t=this.createMAMEVotrax(e);break;case"MAMEYMF271":t=this.createMAMEYMF271(e);break;case"MAMEYMOPQ":t=this.createMAMEYMOPQ(e);break;case"MAMEVASynth":t=this.createMAMEVASynth(e);break;default:{const n=Am.get(e.synthType);t=n?new Tm(n,e):this.createSynth(e)}}if(e.synthType.startsWith("Furnace")&&t){const n=this.VOLUME_NORMALIZATION_OFFSETS[e.synthType]??0;0!==n&&"setVolumeOffset"in t&&t.setVolumeOffset(n)}return t}static async createEffectChain(e,t){const n=e.filter(e=>e.enabled);return Promise.all(n.map(e=>this.createEffect(e,t)))}static async createEffect(e,t){const n=e.wet/100;if("neural"===e.category){if(void 0===e.neuralModelIndex)throw new Error("Neural effect requires neuralModelIndex");const t=new Ur({modelIndex:e.neuralModelIndex,wet:n});return await t.loadModel(),Object.entries(e.parameters).forEach(([e,n])=>{t.setParameter(e,n)}),t}let a;switch(e.type){case"Distortion":a=new v({distortion:e.parameters.drive||.4,oversample:e.parameters.oversample||"none",wet:n});break;case"Reverb":{const t=new g({decay:e.parameters.decay||1.5,preDelay:e.parameters.preDelay||.01,wet:n});await t.ready,a=t;break}case"Delay":case"FeedbackDelay":a=new T({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:n});break;case"Chorus":{const t=new q({frequency:e.parameters.frequency||1.5,delayTime:e.parameters.delayTime||3.5,depth:e.parameters.depth||.7,wet:n});t.start(),a=t;break}case"Phaser":a=new w({frequency:e.parameters.frequency||.5,octaves:e.parameters.octaves||3,baseFrequency:e.parameters.baseFrequency||350,wet:n});break;case"Tremolo":{const t=new $({frequency:e.parameters.frequency||10,depth:e.parameters.depth||.5,wet:n});t.start(),a=t;break}case"Vibrato":a=new H({frequency:e.parameters.frequency||5,depth:e.parameters.depth||.1,wet:n});break;case"AutoFilter":{const t=new K({frequency:e.parameters.frequency||1,baseFrequency:e.parameters.baseFrequency||200,octaves:e.parameters.octaves||2.6,filter:{type:e.parameters.filterType||"lowpass",rolloff:-12,Q:1},wet:n});t.start(),a=t;break}case"AutoPanner":{const t=new W({frequency:e.parameters.frequency||1,depth:e.parameters.depth||1,wet:n});t.start(),a=t;break}case"AutoWah":a=new G({baseFrequency:e.parameters.baseFrequency||100,octaves:e.parameters.octaves||6,sensitivity:e.parameters.sensitivity||0,Q:e.parameters.Q||2,gain:e.parameters.gain||2,follower:e.parameters.follower||.1,wet:n});break;case"BitCrusher":a=new U({bits:e.parameters.bits||4,wet:n});break;case"Chebyshev":a=new z({order:e.parameters.order||50,oversample:e.parameters.oversample||"none",wet:n});break;case"FrequencyShifter":a=new V({frequency:e.parameters.frequency||0,wet:n});break;case"PingPongDelay":a=new B({delayTime:e.parameters.time||.25,feedback:e.parameters.feedback||.5,wet:n});break;case"PitchShift":a=new L({pitch:e.parameters.pitch||0,windowSize:e.parameters.windowSize||.1,delayTime:e.parameters.delayTime||0,feedback:e.parameters.feedback||0,wet:n});break;case"Compressor":a=new S({threshold:e.parameters.threshold||-24,ratio:e.parameters.ratio||12,attack:e.parameters.attack||.003,release:e.parameters.release||.25});break;case"EQ3":a=new f({low:e.parameters.low||0,mid:e.parameters.mid||0,high:e.parameters.high||0,lowFrequency:e.parameters.lowFrequency||400,highFrequency:e.parameters.highFrequency||2500});break;case"Filter":a=new m({type:e.parameters.type||"lowpass",frequency:e.parameters.frequency||350,rolloff:e.parameters.rolloff||-12,Q:e.parameters.Q||1,gain:e.parameters.gain||0});break;case"JCReverb":a=new j({roomSize:e.parameters.roomSize||.5,wet:n});break;case"StereoWidener":a=new R({width:e.parameters.width||.5});break;case"TapeSaturation":a=new Ir({drive:(e.parameters.drive||50)/100,tone:e.parameters.tone||12e3,wet:n});break;case"SidechainCompressor":a=new Co({threshold:e.parameters.threshold??-24,ratio:e.parameters.ratio??4,attack:e.parameters.attack??.003,release:e.parameters.release??.25,knee:e.parameters.knee??6,sidechainGain:(e.parameters.sidechainGain??100)/100,wet:n});break;case"SpaceEcho":a=new Gr({mode:Number(e.parameters.mode)||4,rate:Number(e.parameters.rate)||300,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,reverbVolume:Number(e.parameters.reverbVolume)||.3,bass:Number(e.parameters.bass)||0,treble:Number(e.parameters.treble)||0,wet:n});break;case"SpaceyDelayer":a=new qr({firstTap:Number(e.parameters.firstTap)||250,tapSize:Number(e.parameters.tapSize)||150,feedback:Number(e.parameters.feedback)||40,multiTap:null!=e.parameters.multiTap?Number(e.parameters.multiTap):1,tapeFilter:Number(e.parameters.tapeFilter)||0,wet:n});break;case"RETapeEcho":a=new Jr({mode:null!=e.parameters.mode?Number(e.parameters.mode):3,repeatRate:Number(e.parameters.repeatRate)||.5,intensity:Number(e.parameters.intensity)||.5,echoVolume:Number(e.parameters.echoVolume)||.8,wow:Number(e.parameters.wow)||0,flutter:Number(e.parameters.flutter)||0,dirt:Number(e.parameters.dirt)||0,inputBleed:null!=e.parameters.inputBleed?Number(e.parameters.inputBleed):0,loopAmount:Number(e.parameters.loopAmount)||0,playheadFilter:null!=e.parameters.playheadFilter?Number(e.parameters.playheadFilter):1,wet:n});break;case"BiPhase":a=new eo({rateA:Number(e.parameters.rateA)||.5,depthA:Number(e.parameters.depthA)||.6,rateB:Number(e.parameters.rateB)||4,depthB:Number(e.parameters.depthB)||.4,feedback:Number(e.parameters.feedback)||.3,routing:1===Number(e.parameters.routing)?"series":"parallel",wet:n});break;case"DubFilter":a=new to({cutoff:Number(e.parameters.cutoff)||20,resonance:Number(e.parameters.resonance)||1,gain:Number(e.parameters.gain)||1,wet:n});break;case"BuzzDistortion":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ArguruDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzSVF":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakSVF");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDelay":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzChorus":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzCompressor":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikCompressor");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzOverdrive":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikOverdrive");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDistortion2":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzCrossDelay":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaCrossDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzPhilta":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPhilta");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzDist2":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakDist2");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzFreeverb":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaFreeverb");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzFreqShift":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("BigyoFrequencyShifter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzNotch":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("CyanPhaseNotch");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzStereoGain":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("DedaCodeStereoGain");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzSoftSat":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GraueSoftSat");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzLimiter":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("LdSLimit");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzExciter":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekExciter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzMasterizer":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekMasterizer");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzStereoDist":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseStereoDist");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzWhiteChorus":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseWhiteChorus");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzZfilter":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("QZfilter");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzChorus2":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus2");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"BuzzPanzerDelay":{const{BuzzmachineSynth:t}=await An(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-BZ2o_Ut7.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPanzerDelay");Object.entries(e.parameters).forEach(([e,t])=>{const a=parseInt(e,10);isNaN(a)||n.setParameter(a,t)}),a=n;break}case"MoogFilter":a=new so({cutoff:Number(e.parameters.cutoff)||1e3,resonance:(Number(e.parameters.resonance)||10)/100,drive:Number(e.parameters.drive)||1,model:Number(e.parameters.model)||no,filterMode:Number(e.parameters.filterMode)||ao,wet:n});break;case"MVerb":a=new io({damping:Number(e.parameters.damping)??.5,density:Number(e.parameters.density)??.5,bandwidth:Number(e.parameters.bandwidth)??.5,decay:Number(e.parameters.decay)??.7,predelay:Number(e.parameters.predelay)??0,size:Number(e.parameters.size)??.8,gain:Number(e.parameters.gain)??1,mix:Number(e.parameters.mix)??.4,earlyMix:Number(e.parameters.earlyMix)??.5,wet:n});break;case"Leslie":a=new ho({speed:Number(e.parameters.speed)??0,hornRate:Number(e.parameters.hornRate)??6.8,drumRate:Number(e.parameters.drumRate)??5.9,hornDepth:Number(e.parameters.hornDepth)??.7,drumDepth:Number(e.parameters.drumDepth)??.5,doppler:Number(e.parameters.doppler)??.5,width:Number(e.parameters.width)??.8,acceleration:Number(e.parameters.acceleration)??.5,wet:n});break;case"SpringReverb":a=new yo({decay:Number(e.parameters.decay)??.6,damping:Number(e.parameters.damping)??.4,tension:Number(e.parameters.tension)??.5,mix:Number(e.parameters.mix)??.35,drip:Number(e.parameters.drip)??.5,diffusion:Number(e.parameters.diffusion)??.7,wet:n});break;default:a=new p(1)}if(a._fxType=e.type,Mo(e.parameters)){const t=ko[e.type];if(t){const n=N().bpm.value,s=No(e.parameters);for(const r of t){const t=So(n,s,r.unit);switch(e.type){case"Delay":case"FeedbackDelay":"time"===r.param&&a instanceof T&&(a.delayTime.value=t);break;case"PingPongDelay":"time"===r.param&&a instanceof B&&(a.delayTime.value=t);break;case"SpaceEcho":"rate"===r.param&&a instanceof Gr&&a.setRate(t);break;case"SpaceyDelayer":"firstTap"===r.param&&a instanceof qr&&a.setFirstTap(t);break;case"RETapeEcho":"repeatRate"===r.param&&a instanceof Jr&&a.setRepeatRate(t);break;case"Chorus":"frequency"===r.param&&a instanceof q&&(a.frequency.value=t);break;case"BiPhase":"rateA"===r.param&&a instanceof eo&&(a.rateA=t)}}}}return a}static connectWithEffects(e,t,n){if(0!==t.length){e.connect(t[0]);for(let e=0;e<t.length-1;e++)t[e].connect(t[e+1]);t[t.length-1].connect(n)}else e.connect(n)}static disposeInstrument(e,t){t.forEach(e=>e.dispose()),e.dispose()}static createSynth(e){const t=new Y(X,{oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("Synth",e.volume)}),n=e.pitchEnvelope;return n?.enabled&&0!==n.amount?{triggerAttackRelease:(e,a,s,r)=>{const o=s??Q();this.applyPitchEnvelope(t,n,o,a),t.triggerAttackRelease(e,a,o,r)},triggerAttack:(e,a,s)=>{const r=a??Q();this.triggerPitchEnvelopeAttack(t,n,r),t.triggerAttack(e,r,s)},triggerRelease:(e,a)=>{const s=a??Q();this.triggerPitchEnvelopeRelease(t,n,s),t.triggerRelease(e,s)},releaseAll:()=>{t.set({detune:0}),t.releaseAll()},connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}:t}static createMonoSynth(e){const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new Z(t)}static createDuoSynth(e){return new J({voice0:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:this.getNormalizedVolume("DuoSynth",e.volume)})}static createFMSynth(e){return new Y(I,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},modulationIndex:10,volume:this.getNormalizedVolume("FMSynth",e.volume)})}static createAMSynth(e){return new Y(ee,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("AMSynth",e.volume)})}static createPluckSynth(e){return new Y(te,{attackNoise:1,dampening:4e3,resonance:.7,volume:this.getNormalizedVolume("PluckSynth",e.volume)})}static createMetalSynth(e){return new ne({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MetalSynth",e.volume)})}static createMembraneSynth(e){return new ae({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MembraneSynth",e.volume)})}static createNoiseSynth(e){return new se({noise:{type:"white"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("NoiseSynth",e.volume)})}static createTB303(e){const t=e.tb303||{...La},n=this.getNormalizedVolume("TB303",e.volume);return this.createDB303(t,n)}static createWAM(e){const t=e.wam||{moduleUrl:"",pluginState:null},n=new Cm(t);return n.output.gain.value=re(e.volume??-12),n}static createDB303(e,t){const n=new dr,a=200,s=2e3,r=(e,t,n)=>e>=0&&e<=1?e:n>100?Math.log(e/t)/Math.log(n/t):(e-t)/(n-t);window.DEBUG_TB303_PARAMS,n.setCutoff(r(e.filter.cutoff,314,2394)),n.setResonance(e.filter.resonance>1?e.filter.resonance/100:e.filter.resonance),n.setEnvMod(e.filterEnvelope.envMod>1?e.filterEnvelope.envMod/100:e.filterEnvelope.envMod),n.setDecay(r(e.filterEnvelope.decay,a,s)),n.setAccent(e.accent.amount>1?e.accent.amount/100:e.accent.amount);const o=void 0!==e.oscillator.waveformBlend?e.oscillator.waveformBlend:"square"===e.oscillator.type?1:0;n.setWaveform(o),void 0!==e.oscillator.pulseWidth&&n.setPulseWidth(e.oscillator.pulseWidth>1?e.oscillator.pulseWidth/100:e.oscillator.pulseWidth),void 0!==e.oscillator.subOscGain&&n.setSubOscGain(e.oscillator.subOscGain>1?e.oscillator.subOscGain/100:e.oscillator.subOscGain),void 0!==e.oscillator.subOscBlend&&n.setSubOscBlend(e.oscillator.subOscBlend>1?e.oscillator.subOscBlend/100:e.oscillator.subOscBlend),n.setVegDecay(r(1230,a,s)),void 0!==e.tuning&&n.setTuning(e.tuning>1?(e.tuning-440)/440:e.tuning);const i=e.devilFish;if(i){if(void 0!==i.filterFmDepth&&n.setFilterFmDepth(i.filterFmDepth),void 0!==i.accentSweepEnabled&&n.setAccentSweepEnabled(i.accentSweepEnabled),void 0!==i.accentSoftAttack&&n.setAccentSoftAttack(i.accentSoftAttack>1?i.accentSoftAttack/100:i.accentSoftAttack),void 0!==i.passbandCompensation){const e=i.passbandCompensation>1?i.passbandCompensation/100:i.passbandCompensation;n.setPassbandCompensation(1-e)}if(void 0!==i.resTracking){const e=i.resTracking>1?i.resTracking/100:i.resTracking;n.setResTracking(1-e),n.setKorgIbiasScale(.1+3.9*e)}void 0!==i.duffingAmount&&n.setDuffingAmount(i.duffingAmount>1?i.duffingAmount/100:i.duffingAmount),void 0!==i.lpBpMix&&n.setLpBpMix(i.lpBpMix>1?i.lpBpMix/100:i.lpBpMix),void 0!==i.filterSelect&&n.setFilterSelect(i.filterSelect),void 0!==i.diodeCharacter&&n.setDiodeCharacter(i.diodeCharacter>1?i.diodeCharacter/100:i.diodeCharacter),void 0!==i.filterInputDrive&&n.setFilterInputDrive(i.filterInputDrive>1?i.filterInputDrive/100:i.filterInputDrive),void 0!==i.filterTracking&&n.setFilterTracking(i.filterTracking>1?i.filterTracking/100:i.filterTracking),void 0!==i.stageNLAmount&&n.setStageNLAmount(i.stageNLAmount>1?i.stageNLAmount/100:i.stageNLAmount),void 0!==i.ensembleAmount&&n.setEnsembleAmount(i.ensembleAmount>1?i.ensembleAmount/100:i.ensembleAmount),void 0!==i.oversamplingOrder&&n.setOversamplingOrder(i.oversamplingOrder),void 0!==i.normalDecay&&n.setNormalDecay(r(i.normalDecay,a,s)),void 0!==i.accentDecay&&n.setAccentDecay(r(i.accentDecay,a,s)),void 0!==i.softAttack&&n.setSoftAttack(i.softAttack>1?i.softAttack/100:i.softAttack),void 0!==i.muffler&&n.setMuffler(i.muffler),void 0!==i.sweepSpeed&&n.setSweepSpeed(i.sweepSpeed),void 0!==i.highResonance&&n.setHighResonanceEnabled(i.highResonance)}const l=e.lfo;l&&(void 0!==l.waveform&&n.setLfoWaveform(l.waveform),void 0!==l.rate&&n.setLfoRate(l.rate>1?l.rate/100:l.rate),void 0!==l.contour&&n.setLfoContour(l.contour),void 0!==l.pitchDepth&&n.setLfoPitchDepth(l.pitchDepth>1?l.pitchDepth/100:l.pitchDepth),void 0!==l.pwmDepth&&n.setLfoPwmDepth(l.pwmDepth>1?l.pwmDepth/100:l.pwmDepth),void 0!==l.filterDepth&&n.setLfoFilterDepth(l.filterDepth>1?l.filterDepth/100:l.filterDepth),void 0!==l.stiffDepth&&n.setLfoStiffDepth(l.stiffDepth>1?l.stiffDepth/100:l.stiffDepth));const c=e.chorus;c&&(void 0!==c.enabled&&n.setChorusEnabled(c.enabled),void 0!==c.mode&&n.setChorusMode(c.mode),void 0!==c.mix&&n.setChorusMix(c.mix>1?c.mix/100:c.mix));const d=e.phaser;d&&(void 0!==d.enabled&&n.setPhaserEnabled(d.enabled),void 0!==d.rate&&n.setPhaserRate(d.rate>1?d.rate/100:d.rate),void 0!==d.depth&&n.setPhaserDepth(d.depth>1?d.depth/100:d.depth),void 0!==d.feedback&&n.setPhaserFeedback(d.feedback>1?d.feedback/100:d.feedback),void 0!==d.mix&&n.setPhaserMix(d.mix>1?d.mix/100:d.mix));const u=e.delay;return u&&(void 0!==u.enabled&&n.setDelayEnabled(u.enabled),void 0!==u.time&&n.setDelayTime(u.time>1?u.time/2e3:u.time),void 0!==u.feedback&&n.setDelayFeedback(u.feedback>1?u.feedback/100:u.feedback),void 0!==u.tone&&n.setDelayTone(u.tone>1?u.tone/100:u.tone),void 0!==u.mix&&n.setDelayMix(u.mix>1?u.mix/100:u.mix),void 0!==u.stereo&&n.setDelaySpread(u.stereo>1?u.stereo/100:u.stereo)),void 0!==t&&(n.output.gain.value=re(t)),void 0!==e.volume&&n.setVolume(e.volume),n}static createBuzzGenerator(e,t,n){const a=new ol(e),s=this.getNormalizedVolume(t,n.volume);return a.output.gain.value=re(s),a}static createBuzz3o3(e){const t=new ol(al.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const a=this.getNormalizedVolume("Buzz3o3",e.volume);t.setVolume(a)}return t}static createWavetable(e){const t=e.wavetable||sa,n=new Br(t);return n.output.gain.value=re(this.getNormalizedVolume("Wavetable",e.volume)),n}static createSampler(e){if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new oe({urls:e.sample.multiMap,volume:this.getNormalizedVolume("Sampler",e.volume)});const t=e.parameters?.sampleUrl||e.sample?.url,n=e.sample?.baseNote||"C4";if(!t&&e.metadata,t){const a={};return a[n]=t,new oe({urls:a,volume:this.getNormalizedVolume("Sampler",e.volume)})}return new oe({volume:this.getNormalizedVolume("Sampler",e.volume)})}static createPlayer(e){const t=e.parameters?.sampleUrl,n=e.parameters?.reverseMode||"forward";if(t){return new ie({url:t,volume:this.getNormalizedVolume("Player",e.volume),reverse:"reverse"===n})}return new ie({volume:this.getNormalizedVolume("Player",e.volume)})}static createGranularSynth(e){const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,n=e.granular;if(t){return new le({url:t,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}return new le({grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}static createSuperSaw(e){const t=e.superSaw||da,n=t.detune,a=new Y(X,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??80)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("SuperSaw",e.volume)}),s=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),r=new q({frequency:4,delayTime:2.5,depth:Math.min(1,n/50),wet:.8});r.start(),a.connect(s),s.connect(r);const o=e.pitchEnvelope,i=o?.enabled&&0!==o.amount;return{triggerAttackRelease:(e,t,n,s)=>{const r=n??Q();i&&this.applyPitchEnvelope(a,o,r,t),a.triggerAttackRelease(e,t,r,s)},triggerAttack:(e,t,n)=>{const s=t??Q();i&&this.triggerPitchEnvelopeAttack(a,o,s),a.triggerAttack(e,s,n)},triggerRelease:(e,t)=>{const n=t??Q();i&&this.triggerPitchEnvelopeRelease(a,o,n),a.triggerRelease(e,n)},releaseAll:()=>{a.set({detune:0}),a.releaseAll()},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{a.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||da;a.set({envelope:{attack:(t.envelope.attack||10)/1e3,decay:(t.envelope.decay||100)/1e3,sustain:(t.envelope.sustain||80)/100,release:(t.envelope.release||300)/1e3}}),s.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),r.set({depth:Math.min(1,t.detune/50)})},volume:a.volume}}static createPolySynth(e){const t=e.polySynth||ua;let n=X;"FMSynth"===t.voiceType?n=I:"AMSynth"===t.voiceType&&(n=ee);const a=new Y(n,{maxPolyphony:t.voiceCount,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||50)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||500)/1e3},volume:this.getNormalizedVolume("PolySynth",e.volume)}),s=e.pitchEnvelope;return s?.enabled&&0!==s.amount?{triggerAttackRelease:(e,t,n,r)=>{const o=n??Q();this.applyPitchEnvelope(a,s,o,t),a.triggerAttackRelease(e,t,o,r)},triggerAttack:(e,t,n)=>{const r=t??Q();this.triggerPitchEnvelopeAttack(a,s,r),a.triggerAttack(e,r,n)},triggerRelease:(e,t)=>{const n=t??Q();this.triggerPitchEnvelopeRelease(a,s,n),a.triggerRelease(e,n)},releaseAll:()=>{a.set({detune:0}),a.releaseAll()},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>a.dispose(),volume:a.volume}:a}static createOrgan(e){const t=e.organ||pa,n=t.drawbars||pa.drawbars,a=new p(1),s=new Y(X,{maxPolyphony:32,oscillator:{type:"sine",partials:[n[0]/8,n[1]/8,n[2]/8,n[3]/8,n[4]/8,n[5]/8,n[6]/8,n[7]/8,n[8]/8]},envelope:{attack:.005,decay:.1,sustain:1,release:.1},volume:this.getNormalizedVolume("Organ",e.volume)});let r=null;return t.rotary?.enabled?(r=new $({frequency:"fast"===t.rotary.speed?6:1,depth:.3,wet:.5}),r.start(),s.connect(r),r.connect(a)):s.connect(a),{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(e,t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(e,t)},releaseAll:()=>s.releaseAll(),connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{s.dispose(),r?.dispose(),a.dispose()},applyConfig:e=>{const t=e||pa;s.set({oscillator:{partials:[(t.drawbars[0]||0)/8,(t.drawbars[1]||0)/8,(t.drawbars[2]||0)/8,(t.drawbars[3]||0)/8,(t.drawbars[4]||0)/8,(t.drawbars[5]||0)/8,(t.drawbars[6]||0)/8,(t.drawbars[7]||0)/8,(t.drawbars[8]||0)/8]}}),r&&r.frequency.rampTo("fast"===t.rotary?.speed?6:1,.1)},volume:s.volume}}static createDrumMachine(e){const t=e.drumMachine||ha,n="808"===t.machineType;switch(t.drumType){case"kick":{const a={...n?{pitch:48,pitchDecay:50,tone:40,toneDecay:30,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},...t.kick},s=new ae({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)});let r=s,o=null,i=null;a.drive>0&&(o=new v({distortion:a.drive/100*.5,oversample:"2x",wet:1})),i=new m({type:"lowpass",frequency:a.filterFreq,Q:1,rolloff:-24}),o?(s.connect(o),o.connect(i)):s.connect(i),r=i;const l=ce(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(l,t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(l,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{s.dispose(),o?.dispose(),i?.dispose()},applyConfig:e=>{const t=(e||ha).kick;t&&(s.set({pitchDecay:t.envDuration/1e3,octaves:2*Math.log2(t.envAmount),envelope:{decay:t.decay/1e3}}),o&&(o.distortion=t.drive/100*.5),i&&i.frequency.rampTo(t.filterFreq,.1))},volume:s.volume}}case"snare":{const a={...n?{pitch:238,tone:35,toneDecay:200,snappy:55,decay:150,envAmount:2.5,envDuration:25,filterType:"lowpass",filterFreq:2500}:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},...t.snare},s=new ae({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3,sustain:0,release:.05},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(a.snappy/15-3)}),o=new m({type:a.filterType,frequency:a.filterFreq,Q:2}),i=new p(1);s.connect(i),r.connect(o),o.connect(i);const l=ce(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(l,t,n,a),r.triggerAttackRelease(t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(l,t,n),r.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose(),i.dispose()},applyConfig:t=>{const n=(t||DEFAULT_DR_MACHINE).snare;n&&(s.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),r.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(n.snappy/15-3)}),o.set({type:n.filterType,frequency:n.filterFreq}))},volume:s.volume}}case"hihat":{const a={...n?{tone:40,decay:80,metallic:70}:{tone:50,decay:100,metallic:50},...t.hihat};return new ne({frequency:n?180+1.5*a.tone:200+2*a.tone,envelope:{attack:.001,decay:a.decay/1e3,release:n?.02:.01},harmonicity:5.1,modulationIndex:32+a.metallic/3,resonance:4e3+40*a.tone,octaves:1.5,volume:e.volume||-12})}case"clap":{const a={...n?{tone:45,decay:120,toneDecay:350,spread:15,filterFreqs:[700,1e3],modulatorFreq:30}:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},...t.clap},s=new p(1),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.05},volume:e.volume??-10}),o=new m({type:"highpass",frequency:a.filterFreqs[0],Q:1.2}),i=new m({type:"bandpass",frequency:a.filterFreqs[1],Q:.7}),l=new m({type:"bandpass",frequency:1e3+24*a.tone,Q:2});r.connect(l),l.connect(o),o.connect(i),i.connect(s);const c=[],d=4;for(let t=0;t<d;t++){const n=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3/(t+1),sustain:0,release:.02},volume:(e.volume??-10)-3*t});n.connect(l),c.push(n)}return{triggerAttackRelease:(e,t,n,s)=>{const o=n??Q(),i=a.spread/1e3;c.forEach((e,n)=>{const a=o+n*i,r=(s??1)*(1-.15*n);e.triggerAttackRelease(t/(n+1),a,r)}),r.triggerAttackRelease(t,o+d*i,s)},triggerAttack:(e,t,n)=>{const s=t??Q(),o=a.spread/1e3;c.forEach((e,t)=>{e.triggerAttack(s+t*o,(n??1)*(1-.15*t))}),r.triggerAttack(s+d*o,n)},triggerRelease:(e,t)=>{r.triggerRelease(t),c.forEach(e=>e.triggerRelease(t))},releaseAll:()=>{try{r.triggerRelease()}catch{}c.forEach(e=>{try{e.triggerRelease()}catch{}})},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{r.dispose(),c.forEach(e=>e.dispose()),o.dispose(),i.dispose(),l.dispose(),s.dispose()},applyConfig:e=>{const t=(e||ha).clap;t&&(r.set({envelope:{decay:t.decay/1e3}}),o.frequency.rampTo(t.filterFreqs[0],.1),i.frequency.rampTo(t.filterFreqs[1],.1),l.frequency.rampTo(1e3+24*t.tone,.1),c.forEach((e,n)=>{e.set({envelope:{decay:t.toneDecay/1e3/(n+1)}})}))},volume:r.volume}}case"tom":{const a={...n?{pitch:160,decay:300,tone:2,toneDecay:50,envAmount:1.5,envDuration:150}:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},...t.tom},s=new ae({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.toneDecay/1e3,sustain:0,release:.02},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+a.tone/5}),o=new p(1);s.connect(o),r.connect(o);const i=ce(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(i,t,n,a),r.triggerAttackRelease(.3*t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(i,t,n),r.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose()},applyConfig:t=>{const n=(t||DEFAULT_DR_MACHINE).tom;n&&(s.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),r.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+n.tone/5}))},volume:s.volume}}case"rimshot":{const a={...n?{decay:45,filterFreqs:[280,450,850],filterQ:8,saturation:2}:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},...t.rimshot},s=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.01},volume:e.volume??-10}),r=new m({type:"bandpass",frequency:a.filterFreqs[0],Q:a.filterQ}),o=new m({type:"bandpass",frequency:a.filterFreqs[1],Q:a.filterQ}),i=new m({type:"bandpass",frequency:a.filterFreqs[2],Q:a.filterQ}),l=new p(1);s.connect(r),s.connect(o),s.connect(i),r.connect(l),o.connect(l),i.connect(l);const c=new v({distortion:a.saturation/5*.8,oversample:"2x",wet:1}),d=new m({type:"highpass",frequency:100,Q:.5});return l.connect(c),c.connect(d),{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>d.connect(e),disconnect:()=>d.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose(),c.dispose(),d.dispose()},applyConfig:e=>{const t=(e||ha).rimshot;t&&(s.set({envelope:{decay:t.decay/1e3}}),r.frequency.rampTo(t.filterFreqs[0],.1),o.frequency.rampTo(t.filterFreqs[1],.1),i.frequency.rampTo(t.filterFreqs[2],.1),r.Q.value=t.filterQ,o.Q.value=t.filterQ,i.Q.value=t.filterQ,c.distortion=t.saturation/5*.8)},volume:s.volume}}case"conga":{const n={pitch:310,decay:180,...t.conga},a=new X({oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:e.volume??-8}),s=new m({type:"lowpass",frequency:1e4,Q:1});a.connect(s);const r=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(r,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(r,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).conga;t&&a.set({envelope:{decay:t.decay/1e3}})},volume:a.volume}}case"cowbell":{const e={decay:400,filterFreq:2640,...t.cowbell},n=new A({type:"square",frequency:540,volume:-6}),a=new A({type:"square",frequency:800,volume:-6}),s=new p(0),r=new p(0),o=new m({type:"bandpass",frequency:e.filterFreq,Q:1}),i=new p(.3);n.connect(i),a.connect(i),i.connect(s),i.connect(r);const l=new p(1);return s.connect(o),r.connect(o),o.connect(l),n.start(),a.start(),{triggerAttackRelease:(t,n,a,o)=>{const i=a??Q(),l=o??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.375*l,i+.002),s.gain.linearRampToValueAtTime(0,i+.017),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.001,i+.015),r.gain.exponentialRampToValueAtTime(.125*l,i+.017),r.gain.exponentialRampToValueAtTime(.001,i+.017+e.decay/1e3)},triggerAttack:(t,n,a)=>{const o=n??Q(),i=a??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(0,o),s.gain.linearRampToValueAtTime(.375*i,o+.002),s.gain.linearRampToValueAtTime(0,o+.017),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.001,o+.015),r.gain.exponentialRampToValueAtTime(.125*i,o+.017),r.gain.exponentialRampToValueAtTime(.001,o+.017+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),a.stop(),n.dispose(),a.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).cowbell;t&&o.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"clave":{const e={decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450,...t.clave},n=new A({type:"triangle",frequency:e.pitch,volume:-6}),a=new A({type:"sine",frequency:e.pitchSecondary,volume:-8}),s=new p(0),r=new p(0),o=new m({type:"bandpass",frequency:e.filterFreq,Q:5}),i=new v({distortion:.5,oversample:"2x",wet:1}),l=new p(1);return n.connect(s),a.connect(r),s.connect(o),r.connect(o),o.connect(i),i.connect(l),n.start(),a.start(),{triggerAttackRelease:(t,n,a,o)=>{const i=a??Q(),l=o??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(.7*l,i),s.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.5*l,i),r.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3)},triggerAttack:(t,n,a)=>{const o=n??Q(),i=a??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(.7*i,o),s.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.5*i,o),r.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),a.stop(),n.dispose(),a.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).clave;t&&o.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"maracas":{const n={decay:30,filterFreq:5e3,...t.maracas},a=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.01},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),s=new m({type:"highpass",frequency:n.filterFreq,Q:1});return a.connect(s),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),s.dispose()},applyConfig:e=>{const t=(e||DEFAULT_DR_MACHINE).maracas;t&&(a.set({envelope:{decay:t.decay/1e3}}),s.frequency.rampTo(t.filterFreq,.1))},volume:a.volume}}case"cymbal":{const e={tone:50,decay:2e3,...t.cymbal},n=[263,400,421,474,587,845],a=[],s=new p(.3);for(const t of n){const e=new A({type:"square",frequency:t,volume:-10});e.connect(s),e.start(),a.push(e)}const r=new m({type:"bandpass",frequency:5e3,Q:1}),o=new p(0),i=new m({type:"bandpass",frequency:1e4,Q:1}),l=new p(0),c=new m({type:"highpass",frequency:8e3,Q:1}),d=new p(0);s.connect(r),s.connect(i),s.connect(c),r.connect(o),i.connect(l),c.connect(d);const u=new p(1);o.connect(u),l.connect(u),d.connect(u);const h=.666-e.tone/100*.666,f=.333,y=.666-.666*(1-e.tone/100);return{triggerAttackRelease:(t,n,a,s)=>{const r=a??Q(),i=s??1;o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(.001,r),o.gain.exponentialRampToValueAtTime(h*i,r+.01),o.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3),l.gain.cancelScheduledValues(r),l.gain.setValueAtTime(.001,r),l.gain.exponentialRampToValueAtTime(f*i,r+.01),l.gain.exponentialRampToValueAtTime(.001,r+.4),d.gain.cancelScheduledValues(r),d.gain.setValueAtTime(.001,r),d.gain.exponentialRampToValueAtTime(y*i,r+.01),d.gain.exponentialRampToValueAtTime(.001,r+.15)},triggerAttack:(t,n,a)=>{const s=n??Q(),r=a??1;o.gain.cancelScheduledValues(s),o.gain.setValueAtTime(.001,s),o.gain.exponentialRampToValueAtTime(h*r,s+.01),o.gain.exponentialRampToValueAtTime(.001,s+e.decay/1e3),l.gain.cancelScheduledValues(s),l.gain.setValueAtTime(.001,s),l.gain.exponentialRampToValueAtTime(f*r,s+.01),l.gain.exponentialRampToValueAtTime(.001,s+.4),d.gain.cancelScheduledValues(s),d.gain.setValueAtTime(.001,s),d.gain.exponentialRampToValueAtTime(y*r,s+.01),d.gain.exponentialRampToValueAtTime(.001,s+.15)},triggerRelease:(e,t)=>{},releaseAll:()=>{},connect:e=>u.connect(e),disconnect:()=>u.disconnect(),dispose:()=>{a.forEach(e=>{e.stop(),e.dispose()}),s.dispose(),r.dispose(),i.dispose(),c.dispose(),o.dispose(),l.dispose(),d.dispose(),u.dispose()},applyConfig:e=>{},volume:u.gain}}default:return new ae({pitchDecay:.05,octaves:3,envelope:{attack:.001,decay:.3,sustain:0,release:.1},volume:e.volume||-12})}}static createChipSynth(e){const t=e.chipSynth||ma,n=t.arpeggio;let a="square";if("triangle"===t.channel&&(a="triangle"),"noise"===t.channel){const n=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack||5)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??0)/100,release:(t.envelope?.release||50)/1e3},volume:e.volume||-12}),a=new U({bits:t.bitDepth,wet:1});return n.connect(a),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{n.dispose(),a.dispose()},applyConfig:e=>{const t=e||ma;n.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),a.bits=t.bitDepth},volume:n.volume}}const s=new Y(X,{maxPolyphony:32,oscillator:{type:a},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:this.getNormalizedVolume("ChipSynth",e.volume)}),r=new U({bits:t.bitDepth,wet:1});s.connect(r);let o=null,i=null;n?.enabled&&(o=new Eo({config:n,onNoteOn:(e,t,n,a)=>{i&&s.triggerRelease(i,a),s.triggerAttackRelease(e,n,a,t),i=e},onNoteOff:(e,t)=>{s.triggerRelease(e,t),i===e&&(i=null)}}));return{triggerAttackRelease:(e,t,a,r)=>{if(o&&n?.enabled){if(o.start(e,r??1),t&&"number"==typeof t){const n=(a??Q())+t;N().scheduleOnce(()=>{o.stop(e)},n)}}else s.triggerAttackRelease(e,t,a,r)},triggerAttack:(e,t,a)=>{o&&n?.enabled?o.start(e,a??1):s.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{o&&n?.enabled?o.stop(e):s.triggerRelease(e,t)},releaseAll:()=>{o&&o.stopAll(),s.releaseAll(),i=null},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{o&&o.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||ma;s.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),r.bits=t.bitDepth},volume:s.volume,updateArpeggio:e=>{o&&e&&o.updateConfig(e)},getArpeggioEngine:()=>o,getCurrentArpeggioStep:()=>o?.getCurrentStep()??0,isArpeggioPlaying:()=>o?.getIsPlaying()??!1}}static createFurnace(e){if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new Bo(e.furnace)}static createBuzzmachine(e){const t=e.buzzmachine?.machineType||"ArguruDistortion",n=new ol({ArguruDistortion:al.ARGURU_DISTORTION,ElakDist2:al.ELAK_DIST2,JeskolaDistortion:al.JESKOLA_DISTORTION,GeonikOverdrive:al.GEONIK_OVERDRIVE,GraueSoftSat:al.GRAUE_SOFTSAT,WhiteNoiseStereoDist:al.WHITENOISE_STEREODIST,ElakSVF:al.ELAK_SVF,CyanPhaseNotch:al.CYANPHASE_NOTCH,QZfilter:al.Q_ZFILTER,FSMPhilta:al.FSM_PHILTA,JeskolaDelay:al.JESKOLA_DELAY,JeskolaCrossDelay:al.JESKOLA_CROSSDELAY,JeskolaFreeverb:al.JESKOLA_FREEVERB,FSMPanzerDelay:al.FSM_PANZERDELAY,FSMChorus:al.FSM_CHORUS,FSMChorus2:al.FSM_CHORUS2,WhiteNoiseWhiteChorus:al.WHITENOISE_WHITECHORUS,BigyoFrequencyShifter:al.BIGYO_FREQUENCYSHIFTER,GeonikCompressor:al.GEONIK_COMPRESSOR,LdSLimit:al.LD_SLIMIT,OomekExciter:al.OOMEK_EXCITER,OomekMasterizer:al.OOMEK_MASTERIZER,DedaCodeStereoGain:al.DEDACODE_STEREOGAIN,FSMKick:al.FSM_KICK,FSMKickXP:al.FSM_KICKXP,JeskolaTrilok:al.JESKOLA_TRILOK,JeskolaNoise:al.JESKOLA_NOISE,OomekAggressor:al.OOMEK_AGGRESSOR,MadBrain4FM2F:al.MADBRAIN_4FM2F,MadBrainDynamite6:al.MADBRAIN_DYNAMITE6,MakkM3:al.MAKK_M3,CyanPhaseDTMF:al.CYANPHASE_DTMF,ElenzilFrequencyBomb:al.ELENZIL_FREQUENCYBOMB}[t]??al.ARGURU_DISTORTION),a=this.getNormalizedVolume("Buzzmachine",e.volume);return n.output.gain.value=re(a),n}static CHIP_DEFAULTS={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]},2:{algorithm:0,feedback:3,operators:[{enabled:!0,mult:2,tl:30,ar:15,dr:4,d2r:0,sl:8,rr:5,dt:0,ws:1,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:2,d2r:0,sl:4,rr:8,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1}]},11:{algorithm:0,feedback:2,operators:[{enabled:!0,mult:4,tl:35,ar:15,dr:5,d2r:0,sl:6,rr:7,dt:0,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:3,d2r:0,sl:3,rr:6,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},4:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},5:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:28,dr:2,d2r:0,sl:2,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},3:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},12:{algorithm:7,feedback:1,operators:[{enabled:!0,mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:50,ar:31,dr:8,d2r:0,sl:8,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},10:{algorithm:4,feedback:4,operators:[{enabled:!0,mult:1,tl:15,ar:25,dr:8,d2r:3,sl:5,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:6,rr:10,dt:1,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},6:{algorithm:6,feedback:2,operators:[{enabled:!0,mult:1,tl:12,ar:31,dr:5,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:0,sl:4,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},9:{algorithm:5,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:31,dr:3,d2r:0,sl:1,rr:10,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:6,d2r:0,sl:3,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},8:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]},15:{algorithm:7,feedback:7,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4,dt:0,am:!1},{enabled:!0,mult:5,tl:45,ar:31,dr:20,d2r:0,sl:10,rr:6,dt:2,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]}};static createFurnaceWithChip(e,t){const n=this.CHIP_DEFAULTS[t]||{algorithm:0,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}]},a={...e.furnace||{algorithm:n.algorithm??0,feedback:n.feedback??0,operators:n.operators||[],macros:[],opMacros:[],wavetables:n.wavetables||[]},chipType:t};return new Bo(a)}static createPWMSynth(e){const t=e.pwmSynth||fa,n=new Y(X,{maxPolyphony:32,oscillator:{type:"square"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("PWMSynth",e.volume)}),a=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),s=new q({frequency:t.pwmRate,delayTime:2,depth:t.pwmDepth/100,wet:.6});return s.start(),n.connect(a),a.connect(s),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),a.dispose(),s.dispose()},applyConfig:e=>{const t=e||fa;n.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),a.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),s.set({frequency:t.pwmRate,depth:t.pwmDepth/100})},volume:n.volume}}static createStringMachine(e){const t=e.stringMachine||ya,n=new Y(X,{maxPolyphony:32,oscillator:{type:"sawtooth"},envelope:{attack:(t.attack||100)/1e3,decay:.2,sustain:.9,release:(t.release||500)/1e3},volume:this.getNormalizedVolume("StringMachine",e.volume)}),a=new q({frequency:t.ensemble.rate,delayTime:3.5,depth:t.ensemble.depth/100,wet:.8});a.start();const s=new m({type:"lowpass",frequency:2e3+80*t.brightness,Q:.5,rolloff:-12});return n.connect(s),s.connect(a),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{n.dispose(),a.dispose(),s.dispose()},applyConfig:e=>{const t=e||ya;n.set({envelope:{attack:t.attack/1e3,release:t.release/1e3}}),a.set({frequency:t.ensemble.rate,depth:t.ensemble.depth/100}),s.frequency.rampTo(2e3+80*t.brightness,.1)},volume:n.volume}}static createFormantSynth(e){const t=e.formantSynth||xa,n=ga[t.vowel]||ga.a,a=new Y(X,{maxPolyphony:32,oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("FormantSynth",e.volume)}),s=new m({type:"bandpass",frequency:n.f1,Q:3}),r=new m({type:"bandpass",frequency:n.f2,Q:3}),o=new m({type:"bandpass",frequency:n.f3,Q:3}),i=new p(2);return a.connect(s),a.connect(r),a.connect(o),s.connect(i),r.connect(i),o.connect(i),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{a.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose()},applyConfig:e=>{const t=e||xa,n=ga[t.vowel];a.set({envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3}}),s.frequency.rampTo(n.f1,.1),r.frequency.rampTo(n.f2,.1),o.frequency.rampTo(n.f3,.1)},volume:a.volume}}static createWobbleBass(e){const t=e.wobbleBass||va,n=Math.max(1,t.unison.voices),a=t.unison.detune,s=new Y(X,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc1.level/100*6-6-6}),r=new Y(X,{maxPolyphony:32,oscillator:{type:t.osc2.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc2.level/100*6-6-6});s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune});let o=null;t.sub.enabled&&(o=new Y(X,{maxPolyphony:32,oscillator:{type:"sine"},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.sub.level/100*12-12-6}),o.set({detune:1200*t.sub.octave}));const i=[],l=[];if(n>1)for(let p=1;p<Math.min(n,8);p++){const e=(p/n-.5)*a*2,s=(p/n-.5)*(t.unison.stereoSpread/50),r=new Y(X,{maxPolyphony:32,oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-12-1.5*n});r.set({detune:1200*t.osc1.octave+e});const o=new de(s);r.connect(o),i.push(r),l.push(o)}let c=null;t.fm.enabled&&t.fm.amount>0&&(c=new Y(I,{maxPolyphony:32,modulationIndex:t.fm.amount/10,harmonicity:t.fm.ratio,envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-6}),c.set({detune:1200*t.osc1.octave}));const d=new p(1),u=new m({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:t.filter.rolloff});let h=null;t.filter.drive>0&&(h=new v({distortion:t.filter.drive/100,oversample:"2x"}));const f=t.filterEnvelope.amount/100,y=t.filter.cutoff,g=4*Math.abs(f),x=new ue({baseFrequency:y,octaves:g,attack:t.filterEnvelope.attack/1e3,decay:t.filterEnvelope.decay/1e3,sustain:t.filterEnvelope.sustain/100,release:t.filterEnvelope.release/1e3});(!t.wobbleLFO.enabled||t.filterEnvelope.amount>0)&&x.connect(u.frequency);let w=null;if(t.wobbleLFO.enabled){let e=t.wobbleLFO.rate;if("free"!==t.wobbleLFO.sync){e=(N().bpm.value||120)/60*(({"1/1":1,"1/2":2,"1/2T":3,"1/2D":1.5,"1/4":4,"1/4T":6,"1/4D":3,"1/8":8,"1/8T":12,"1/8D":6,"1/16":16,"1/16T":24,"1/16D":12,"1/32":32,"1/32T":48}[t.wobbleLFO.sync]||4)/4)}const n={sine:"sine",triangle:"triangle",saw:"sawtooth",square:"square",sample_hold:"square"},a=4*y,s=Math.max(20,.1*y),r=Math.min(2e4,y+a*(t.wobbleLFO.amount/100));w=new b({frequency:e,type:n[t.wobbleLFO.shape]||"sine",min:s,max:r,phase:t.wobbleLFO.phase}),w.connect(u.frequency),w.start()}let k=null;if(t.distortion.enabled)switch(t.distortion.type){case"soft":k=new v({distortion:t.distortion.drive/100,oversample:"2x"});break;case"hard":k=new z({order:Math.floor(1+t.distortion.drive/100*50)});break;case"fuzz":k=new v({distortion:.5+t.distortion.drive/200,oversample:"4x"});break;case"bitcrush":k=new U({bits:Math.max(2,12-Math.floor(t.distortion.drive/10))})}const S=new m({type:"lowpass",frequency:500+t.distortion.tone/100*15e3,Q:.5});let M=[],C=null;if(t.formant.enabled){const e=ga[t.formant.vowel];M=[new m({type:"bandpass",frequency:e.f1,Q:5}),new m({type:"bandpass",frequency:e.f2,Q:5}),new m({type:"bandpass",frequency:e.f3,Q:5})],C=new p(.5)}const E=new p(1);E.gain.value=Math.pow(10,this.getNormalizedVolume("WobbleBass",e.volume)/20),s.connect(d),r.connect(d),o&&o.connect(d),c&&c.connect(d),l.forEach(e=>e.connect(d)),h?(d.connect(h),h.connect(u)):d.connect(u);let P=u;k&&(P.connect(k),P=k),P.connect(S),P=S,C&&M.length>0?(M.forEach(e=>{P.connect(e),e.connect(C)}),C.connect(E),P.connect(E)):P.connect(E);const T=new Set;return{triggerAttackRelease:(e,n,a,l)=>{const d=a??Q(),u=l??.8;t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(d),s.triggerAttackRelease(e,n,d,u),r.triggerAttackRelease(e,n,d,u),o&&o.triggerAttackRelease(e,n,d,u),c&&c.triggerAttackRelease(e,n,d,u),i.forEach(t=>t.triggerAttackRelease(e,n,d,.6*u))},triggerAttack:(e,n,a)=>{const l=n??Q(),d=a??.8;T.add(e),t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(l),s.triggerAttack(e,l,d),r.triggerAttack(e,l,d),o&&o.triggerAttack(e,l,d),c&&c.triggerAttack(e,l,d),i.forEach(t=>t.triggerAttack(e,l,.6*d))},triggerRelease:(e,t)=>{const n=t??Q();T.delete(e),x.triggerRelease(n),s.triggerRelease(e,n),r.triggerRelease(e,n),o&&o.triggerRelease(e,n),c&&c.triggerRelease(e,n),i.forEach(t=>t.triggerRelease(e,n))},releaseAll:()=>{s.releaseAll(),r.releaseAll(),o&&o.releaseAll(),c&&c.releaseAll(),i.forEach(e=>e.releaseAll()),T.clear()},connect:e=>E.connect(e),disconnect:()=>E.disconnect(),dispose:()=>{s.dispose(),r.dispose(),o&&o.dispose(),c&&c.dispose(),i.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),d.dispose(),u.dispose(),h&&h.dispose(),x.dispose(),w&&w.dispose(),k&&k.dispose(),S.dispose(),M.forEach(e=>e.dispose()),C&&C.dispose(),E.dispose()},applyConfig:e=>{const t=e||va,n={attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3};s.set({envelope:n}),r.set({envelope:n}),o&&o.set({envelope:n}),c&&c.set({envelope:n}),i.forEach(e=>e.set({envelope:n})),s.volume.rampTo(t.osc1.level/100*6-6-6,.1),r.volume.rampTo(t.osc2.level/100*6-6-6,.1),s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune}),o&&(o.volume.rampTo(t.sub.level/100*12-12-6,.1),o.set({detune:1200*t.sub.octave})),u.set({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10}),w&&w.frequency.rampTo(t.wobbleLFO.rate,.1)},volume:s.volume,wobbleLFO:w,filter:u}}static reverseAudioBuffer(e){const t=k().rawContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let n=0;n<e.numberOfChannels;n++){const a=e.getChannelData(n),s=t.getChannelData(n);for(let e=0;e<a.length;e++)s[e]=a[a.length-1-e]}return t}static createDrumKit(e){const t=e.drumKit||Ca;return new ei(t)}static applyPitchEnvelope(e,t,n,a){const s=100*t.amount,r=t.sustain/100*s,o=t.attack/1e3;t.decay;const i=t.release/1e3,l=e;if(!l.set)return;l.set({detune:s});setTimeout(()=>{l.set&&l.set({detune:r})},1e3*(n+o-Q()));setTimeout(()=>{l.set&&l.set({detune:0})},1e3*(n+a-Q())+1e3*i)}static triggerPitchEnvelopeAttack(e,t,n){const a=100*t.amount,s=t.sustain/100*a,r=t.attack/1e3,o=t.decay/1e3,i=e;if(!i.set)return;i.set({detune:a});setTimeout(()=>{i.set&&i.set({detune:s})},1e3*(r+o))}static createDubSiren(e){const t=e.dubSiren||Pa,n=new oi(t);return n.volume.value=this.getNormalizedVolume("DubSiren",e.volume),n}static createSpaceLaser(e){const t=e.spaceLaser||Da,n=new ii(t);return n.volume.value=this.getNormalizedVolume("SpaceLaser",e.volume),n}static createV2(e){if(e.v2Speech){const t=new nl(e.v2Speech);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}const t=new tl(e.v2||void 0);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}static createSam(e){const t=e.sam||Ta,n=new el(t);return n.output.gain.value=re(this.getNormalizedVolume("Sam",e.volume)),n}static createSynare(e){const t=e.synare||Oa,n=new li(t);return n.volume.value=this.getNormalizedVolume("Synare",e.volume),n}static createDexed(e){const t=e.dexed||{},n=new ql(t);return n.output.gain.value=re(this.getNormalizedVolume("Dexed",e.volume)),n}static createOBXd(e){const t=e.obxd||{},n=new Gc(t);return n.output.gain.value=re(this.getNormalizedVolume("OBXd",e.volume)),n}static createCZ101(e){const t=new Zc;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("CZ101",e.volume)),t}static createCEM3394(e){const t=new dd;return t.output.gain.value=re(this.getNormalizedVolume("CEM3394",e.volume)),t}static createSCSP(e){const t=new pd;return t.output.gain.value=re(this.getNormalizedVolume("SCSP",e.volume)),t}static createVFX(e){const t=new Dd;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMEVFX",e.volume)),t}static createD50(e){const t=new Rd;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),t}static createRdPiano(e){const t=e.rdpiano||{},n=new Yd(t);return n.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),n}static createMU2000(e){const t=new tu;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMESWP30",e.volume)),t}static createBuzz3o3DF(e){const t=new ol(al.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.slideTime&&t.setSlideTime(e.slideTime),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.accentAttack&&t.setParam("accent_attack",e.accentAttack),void 0!==e.filterFM&&t.setFilterFM(e.filterFM),void 0!==e.accentSweepEnabled&&t.setAccentSweepEnabled(e.accentSweepEnabled)}const a=this.getNormalizedVolume("Buzz3o3DF",e.volume);t.setVolume(a)}return t}static applyChipParameters(e,t){const n=t.parameters;if(n){"number"==typeof n._program&&"function"==typeof e.loadPreset&&e.loadPreset(n._program);for(const[t,a]of Object.entries(n))"_program"!==t&&"number"==typeof a&&e.setParam(t,a)}}static createMAMEAICA(e){const t=new au;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAICA",e.volume)),this.applyChipParameters(t,e),t}static createMAMEASC(e){const t=new pu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEASC",e.volume)),this.applyChipParameters(t,e),t}static createMAMEAstrocade(e){const t=new wu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAstrocade",e.volume)),this.applyChipParameters(t,e),t}static createMAMEC352(e){const t=new Su;return t.output.gain.value=re(this.getNormalizedVolume("MAMEC352",e.volume)),this.applyChipParameters(t,e),t}static createMAMEES5503(e){const t=new Iu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEES5503",e.volume)),this.applyChipParameters(t,e),t}static createMAMEICS2115(e){const t=new Fu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEICS2115",e.volume)),this.applyChipParameters(t,e),t}static createMAMEK054539(e){const t=new Lu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEK054539",e.volume)),this.applyChipParameters(t,e),t}static createMAMEMEA8000(e){const t=new qu;return t.output.gain.value=re(this.getNormalizedVolume("MAMEMEA8000",e.volume)),this.applyChipParameters(t,e),t}static createMAMERF5C400(e){const t=new Qu;return t.output.gain.value=re(this.getNormalizedVolume("MAMERF5C400",e.volume)),this.applyChipParameters(t,e),t}static createMAMESN76477(e){const t=new up;return t.output.gain.value=re(this.getNormalizedVolume("MAMESN76477",e.volume)),this.applyChipParameters(t,e),t}static createMAMESNKWave(e){const t=new yp;return t.output.gain.value=re(this.getNormalizedVolume("MAMESNKWave",e.volume)),this.applyChipParameters(t,e),t}static createMAMESP0250(e){const t=new Sp;return t.output.gain.value=re(this.getNormalizedVolume("MAMESP0250",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS36XX(e){const t=new Ap;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS36XX",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS5220(e){const t=new zp;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS5220",e.volume)),this.applyChipParameters(t,e),t}static createMAMETR707(e){const t=new nh;return t.output.gain.value=re(this.getNormalizedVolume("MAMETR707",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD931(e){const t=new uh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD931",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD933(e){const t=new Sh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD933",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVotrax(e){const t=new _h;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVotrax",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMF271(e){const t=new qh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMF271",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMOPQ(e){const t=new hm;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMOPQ",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVASynth(e){const t=new km;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVASynth",e.volume)),this.applyChipParameters(t,e),t}static triggerPitchEnvelopeRelease(e,t,n){const a=t.release/1e3,s=e;s.set&&setTimeout(()=>{s.set&&s.set({detune:0})},1e3*a)}}function Om(e){const t={FurnaceOPN:0,FurnaceOPM:1,FurnaceOPL:2,FurnacePSG:3,FurnaceNES:4,FurnaceGB:5,FurnacePCE:6,FurnaceSCC:7,FurnaceN163:8,FurnaceVRC6:9,FurnaceC64:10,FurnaceOPLL:11,FurnaceAY:12,FurnaceOPNA:13,FurnaceOPNB:14,FurnaceTIA:15,FurnaceFDS:16,FurnaceMMC5:17,FurnaceSAA:18,FurnaceSWAN:19,FurnaceOKI:20,FurnaceES5506:21,FurnaceOPZ:22,FurnaceY8950:23,FurnaceSNES:24,FurnaceLYNX:25,FurnaceOPL4:26,FurnaceSEGAPCM:27,FurnaceYMZ280B:28,FurnaceRF5C68:29,FurnaceGA20:30,FurnaceC140:31,FurnaceQSOUND:32,FurnaceVIC:33,FurnaceTED:34,FurnaceSUPERVISION:35,FurnaceVERA:36,FurnaceSM8521:37,FurnaceBUBBLE:38,FurnaceK007232:39,FurnaceK053260:40,FurnaceX1_010:41,FurnaceUPD1771:42,FurnaceT6W28:43,FurnaceVB:44,FurnaceSID6581:45,FurnaceSID8580:46,FurnaceOPN2203:47,FurnaceOPNBB:48,FurnaceESFM:49,FurnaceAY8930:50,FurnaceNDS:51,FurnaceGBA:52,FurnacePOKEMINI:54,FurnaceNAMCO:55,FurnacePET:56,FurnacePOKEY:57,FurnaceMSM6258:58,FurnaceMSM5232:59,FurnaceMULTIPCM:60,FurnaceAMIGA:61,FurnacePCSPKR:62,FurnacePONG:63,FurnacePV1000:64,FurnaceDAVE:65,FurnaceSU:66,FurnacePOWERNOISE:68,FurnaceZXBEEPER:69,FurnaceSCVTONE:71,FurnacePCMDAC:72,Furnace:0}[e];if(void 0===t)return;const n={...ka,chipType:t,operators:ka.operators.map(e=>({...e}))};return"FurnaceC64"!==e&&"FurnaceSID6581"!==e&&"FurnaceSID8580"!==e||(n.c64={triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:12,r:6,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}),n}const Fm=[[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]];function Rm(e,t=0){if(e>=36&&e<72&&Math.abs(t)<=8){const n=function(e){const t=Math.max(-8,Math.min(7,Math.round(e)));return t<0?t+16:t}(t);return Fm[n][e-36]}const n=e-48+t/128;return Math.round(428/Math.pow(2,n/12))}function jm(e,t=0){if(e<=0)return-1;const n=3546895/e,a=48+12*Math.log2(n/8287.13);return Math.round(a)}class Lm extends u{name="AmigaFilter";hp_a1=0;hp_a2=0;lp1_a1=0;lp1_a2=0;lp2_a1=0;lp2_a2=0;lp2_b1=0;lp2_b2=0;_ledFilterEnabled=!0;_sampleRate;input;output;_worklet=null;_initialized=!1;_initializing=!1;_retryCount=0;static MAX_RETRIES=3;static _loadPromises=new WeakMap;constructor(){super(),this.input=new p,this.output=new p,this._sampleRate=k().sampleRate,this.setupCoefficients(),this.input.connect(this.output),this.tryInitWorklet()}async tryInitWorklet(){if(this._initialized||this._initializing)return;const e=k();if("running"!==e.state){const t=()=>{"running"===e.state&&this.initWorklet()};return e.on("statechange",t),void setTimeout(()=>{"running"!==e.state||this._initialized||this.initWorklet()},100)}await this.initWorklet()}async initWorklet(){if(!(this._initialized||this._initializing||this._retryCount>=Lm.MAX_RETRIES)){this._initializing=!0;try{const t=this.context,n=t.rawContext||t._context;if(!n||!n.audioWorklet)return void(this._initializing=!1);if("running"!==n.state)return void(this._initializing=!1);const a="/DEViLBOX/",s=`?v=${Date.now()}`;let r=Lm._loadPromises.get(n);r||(r=(async()=>{try{await n.audioWorklet.addModule(`${a}AmigaFilter.worklet.js${s}`)}catch(e){if(!(e?.message?.includes("already")||e?.message?.includes("duplicate")))throw Lm._loadPromises.delete(n),e}})(),Lm._loadPromises.set(n,r)),await r;try{this._worklet=new AudioWorkletNode(n,"amiga-filter-processor")}catch(e){if("InvalidStateError"===e?.name)return this._retryCount++,Lm._loadPromises.delete(n),this._initializing=!1,void(this._retryCount<Lm.MAX_RETRIES&&setTimeout(()=>this.initWorklet(),500));throw e}if(this._worklet&&this._worklet.port.postMessage({type:"INIT",coeffs:{hp:{a1:this.hp_a1,a2:this.hp_a2},lp1:{a1:this.lp1_a1,a2:this.lp1_a2},lp2:{a1:this.lp2_a1,a2:this.lp2_a2,b1:this.lp2_b1,b2:this.lp2_b2}}}),this._worklet){try{this.input.disconnect(this.output)}catch{}x(this.input,this._worklet),x(this._worklet,this.output),this._initialized=!0}else this._initializing=!1}catch(e){this._initializing=!1,this._retryCount++}}}setupCoefficients(){const e=this._sampleRate,t=Math.PI,n=2-Math.cos(2*t*5.128/e),a=n-Math.sqrt(n*n-1);this.hp_a1=1-a,this.hp_a2=a;const s=2-Math.cos(2*t*4420.971/e),r=s-Math.sqrt(s*s-1);this.lp1_a1=1-r,this.lp1_a2=r;const o=1/Math.tan(3090.533*t/e),i=1/.660225;this.lp2_a1=1/(1+i*o+o*o),this.lp2_a2=2*this.lp2_a1,this.lp2_b1=2*(1-o*o)*this.lp2_a1,this.lp2_b2=(1-i*o+o*o)*this.lp2_a1}get ledFilterEnabled(){return this._ledFilterEnabled}set ledFilterEnabled(e){this._ledFilterEnabled=e,this._worklet&&this._worklet.port.postMessage({type:"SET_LED",enabled:e})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this}}class Bm{points=[];enabled=!1;sustainPoint=null;loopStart=null;loopEnd=null;tick=0;isKeyOff=!1;currentValue=64;finished=!1;constructor(e){e&&this.init(e)}init(e){this.enabled=e.enabled,this.points=e.points,this.sustainPoint=e.sustainPoint,this.loopStart=e.loopStartPoint,this.loopEnd=e.loopEndPoint,this.reset()}reset(){this.tick=0,this.isKeyOff=!1,this.currentValue=this.points.length>0?this.points[0].value:64,this.finished=!1}keyOff(){this.isKeyOff=!0}tickNext(){if(!this.enabled||0===this.points.length)return 64;if(this.finished)return this.points[this.points.length-1].value;if(!this.isKeyOff&&null!==this.sustainPoint){const e=this.points[this.sustainPoint];if(this.tick>=e.tick)return this.tick=e.tick,this.currentValue=e.value,this.currentValue}if(null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd],t=this.points[this.loopStart];this.tick>=e.tick&&(this.tick=t.tick)}if(this.currentValue=this.interpolate(this.tick),this.tick++,null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd];this.tick>=e.tick&&(this.tick=this.points[this.loopStart].tick)}return this.tick>this.points[this.points.length-1].tick&&(this.finished=!0,this.tick=this.points[this.points.length-1].tick),this.currentValue}interpolate(e){if(0===this.points.length)return 64;if(e<=this.points[0].tick)return this.points[0].value;if(e>=this.points[this.points.length-1].tick)return this.points[this.points.length-1].value;for(let t=0;t<this.points.length-1;t++){const n=this.points[t],a=this.points[t+1];if(e>=n.tick&&e<=a.tick){const t=a.tick-n.tick;if(0===t)return a.value;const s=(a.value-n.value<<16)/t,r=(e-n.tick)*s;return n.value+(r>>16)}}return 64}isEnabled(){return this.enabled}isFinished(){return this.finished}getCurrentValue(){return this.currentValue}}class Vm{input;output;analyser;fft;disposed=!1;cachedWaveform=null;cachedFFT=null;constructor(){this.input=new p(1),this.output=new p(1),this.analyser=new pe("waveform",256),this.fft=new he(1024),this.input.connect(this.analyser),this.input.connect(this.fft),this.input.connect(this.output)}getWaveform(){if(this.disposed)return this.cachedWaveform||new Float32Array(256);const e=this.analyser.getValue();return this.cachedWaveform&&this.cachedWaveform.length===e.length||(this.cachedWaveform=new Float32Array(e.length)),this.cachedWaveform.set(e),this.cachedWaveform}getFFT(){if(this.disposed)return this.cachedFFT||new Float32Array(1024);const e=this.fft.getValue();return this.cachedFFT&&this.cachedFFT.length===e.length||(this.cachedFFT=new Float32Array(e.length)),this.cachedFFT.set(e),this.cachedFFT}getLevel(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}getPeak(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let n=0;n<e.length;n++){const a=Math.abs(e[n]);a>t&&(t=a)}return t}hasActivity(){return this.getPeak()>.001}connectInstrument(e){if(!this.disposed)if(Xa(e)){const t=ns(this.input);t&&e.output.connect(t)}else e.connect(this.input)}disconnectInstrument(e){if(!this.disposed)try{Xa(e)?e.output.disconnect():e.disconnect(this.input)}catch{}}dispose(){if(!this.disposed){this.disposed=!0;try{this.input.disconnect(),this.analyser.disconnect(),this.fft.disconnect(),this.output.disconnect(),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.fft.dispose()}catch{}this.cachedWaveform=null,this.cachedFFT=null}}}function zm(e,t){let n;try{n=e()}catch(a){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=n.getItem(e))?t:null;return s instanceof Promise?s.then(a):a(s)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}const Um=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>Um(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>Um(e)(n)}}},Gm=(e,t)=>(n,a,s)=>{let r={storage:zm(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1,i=0;const l=new Set,c=new Set;let d=r.storage;if(!d)return e((...e)=>{n(...e)},a,s);const u=()=>{const e=r.partialize({...a()});return d.setItem(r.name,{state:e,version:r.version})},p=s.setState;s.setState=(e,t)=>(p(e,t),u());const h=e((...e)=>(n(...e),u()),a,s);let m;s.getInitialState=()=>h;const f=()=>{var e,t;if(!d)return;const s=++i;o=!1,l.forEach(e=>{var t;return e(null!=(t=a())?t:h)});const p=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=a())?e:h))||void 0;return Um(d.getItem.bind(d))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(s!==i)return;const[o,l]=e;return m=r.merge(l,null!=(t=a())?t:h),n(m,!0),o?u():void 0}).then(()=>{s===i&&(null==p||p(m,void 0),m=a(),o=!0,c.forEach(e=>e(m)))}).catch(e=>{s===i&&(null==p||p(void 0,e))})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>f(),hasHydrated:()=>o,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},r.skipHydration||f(),m||h},Wm=a()(Gm(Rn(e=>({amigaLimits:!1,linearInterpolation:!0,masterTuning:440,performanceQuality:"high",audioLatency:"balanced",autoLatency:!0,midiPolyphonic:!0,setAmigaLimits:t=>e(e=>{e.amigaLimits=t}),setLinearInterpolation:t=>e(e=>{e.linearInterpolation=t}),setMasterTuning:t=>e(e=>{e.masterTuning=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setAudioLatency:t=>e(e=>{e.audioLatency=t}),setAutoLatency:t=>e(e=>{e.autoLatency=t}),setMidiPolyphonic:t=>e(e=>{e.midiPolyphonic=t})})),{name:"devilbox-settings",partialize:e=>({amigaLimits:e.amigaLimits,linearInterpolation:e.linearInterpolation,masterTuning:e.masterTuning,performanceQuality:e.performanceQuality,audioLatency:e.audioLatency,autoLatency:e.autoLatency,midiPolyphonic:e.midiPolyphonic})}));class Km{static instance=null;static itFilterWorkletLoaded=!1;static itFilterWorkletPromise=null;masterInput;synthBus;masterEffectsInput;masterChannel;analyser;fft;_nativeContext=null;wasmInstance=null;instruments;instrumentSynthTypes=new Map;instrumentLoadingPromises=new Map;decodedAudioBuffers=new Map;liveVoiceAllocation=new Map;liveVoicePool=[];static LIVE_VOICE_BASE_CHANNEL=100;static MAX_LIVE_VOICES=16;activeVoices=new Map;masterEffectsNodes=[];masterEffectConfigs=new Map;channelOutputs=new Map;channelMuteStates=new Map;channelPitchState=new Map;channelActivePlayer=new Map;channelLastNote=new Map;static SLIDE_TIME_CONSTANT=.06;static ACCENT_BOOST=1.35;static MIDI_FREQ_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=440*Math.pow(2,(t-69)/12);return e})();static FILTER_CUTOFF_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=100*Math.pow(100,t/127);return e})();static PITCH_CENTS_CACHE=new Map;metronomeSynth=null;metronomeVolume=null;metronomeEnabled=!1;metronomePart=null;amigaFilter;amigaFilterEnabled=!0;instrumentEffectChains=new Map;instrumentEffectNodes=new Map;instrumentAnalysers=new Map;releaseRestoreTimeouts=new Map;preloadGeneration=0;constructor(){var e;this._nativeContext=new AudioContext({sampleRate:44100,latencyHint:"interactive"}),me(this._nativeContext),e=this._nativeContext,Za=e,this.masterInput=new p(1),this.amigaFilter=new Lm,this.masterChannel=new fe({volume:-6,pan:0}).toDestination(),this.analyser=new pe("waveform",1024),this.fft=new he(1024),this.masterChannel.connect(this.analyser),this.masterChannel.connect(this.fft),this.masterEffectsInput=new p(1),this.masterInput.connect(this.amigaFilter),this.amigaFilter.connect(this.masterEffectsInput),this.masterEffectsInput.connect(this.masterChannel),this.synthBus=new p(1),this.synthBus.connect(this.masterEffectsInput),this.instruments=new Map,this.liveVoicePool=[];for(let t=0;t<Km.MAX_LIVE_VOICES;t++)this.liveVoicePool.push(Km.LIVE_VOICE_BASE_CHANNEL+t)}static getInstance(){return Km.instance||(Km.instance=new Km),Km.instance}get nativeContext(){return this._nativeContext}connectNativeSynth(e,t){const n=ns(t);if(n)try{e.connect(n)}catch(a){}else if(t.input)try{e.connect(t.input)}catch(a){}}async decodeAudioData(e){if(e instanceof AudioBuffer)return e;if(e instanceof Uint8Array){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await k().rawContext.decodeAudioData(t)}if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer type: "+typeof e);return await k().rawContext.decodeAudioData(e.slice(0))}async encodeAudioData(e){return e.getChannelData(0).buffer.slice(0)}getDecodedBuffer(e){return this.decodedAudioBuffers.get(e)}getWasmInstance(){return this.wasmInstance}async init(){"suspended"===k().state&&await ye();const e=Wm.getState().audioLatency||"balanced";this.setAudioLatency(e),N().bpm.value=125;const t=this._nativeContext;"running"!==t.state&&await new Promise(e=>{const n=()=>{"running"===t.state?e():setTimeout(n,10)};n()});let n=null;const a=async()=>{if(n)return n;const e=await fetch("/DEViLBOX/DevilboxDSP.wasm");if(e.ok){n=await e.arrayBuffer();try{const e={env:{abort:()=>{}}},{instance:t}=await WebAssembly.instantiate(n,e);this.wasmInstance=t.exports,this.wasmInstance.init&&this.wasmInstance.init()}catch(t){}return n}return null};Km.itFilterWorkletLoaded||(Km.itFilterWorkletPromise||(Km.itFilterWorkletPromise=(async()=>{try{const e="/DEViLBOX/";await t.audioWorklet.addModule(`${e}ITFilter.worklet.js`);const n=await a();if(n){const e=new AudioWorkletNode(t,"it-filter-processor");e.port.postMessage({type:"init",wasmBinary:n}),e.disconnect()}Km.itFilterWorkletLoaded=!0}catch(e){e?.message?.includes("already")||e?.message?.includes("duplicate")||(Km.itFilterWorkletPromise=null)}})()),await Km.itFilterWorkletPromise);try{const e=Ao.getInstance();await e.init(k())}catch(s){}}getContextState(){return k().state}async preloadInstruments(e){const t=++this.preloadGeneration;e.forEach(e=>{const t=this.getInstrumentKey(e.id,-1);this.instruments.has(t)&&this.disposeInstrument(e.id)});const n=e.filter(e=>"Sampler"===e.synthType||"Player"===e.synthType),a=e.filter(e=>"Sam"===e.synthType||"V2"===e.synthType&&e.v2Speech);e.filter(e=>"Sampler"!==e.synthType&&"Player"!==e.synthType&&"Sam"!==e.synthType&&!("V2"===e.synthType&&e.v2Speech)).forEach(e=>{this.getInstrument(e.id,e)}),n.forEach(e=>{this.getInstrument(e.id,e)});const s=[];if(a.forEach(e=>{const t=this.getInstrument(e.id,e);t?.ready&&s.push(t.ready())}),n.length>0)try{if(await ge(),t!==this.preloadGeneration)return;const e=Array.from(this.instrumentLoadingPromises.values());if(e.length>0&&(await Promise.all(e),t!==this.preloadGeneration))return}catch(i){}if(s.length>0)try{if(await Promise.all(s),t!==this.preloadGeneration)return}catch(i){}const r=e.filter(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType);if(r.length>0){const e=[];for(const t of r){const n=this.getInstrumentKey(t.id,-1),a=this.instruments.get(n);a?.ensureInitialized&&e.push(a.ensureInitialized())}if(e.length>0)try{if(await Promise.all(e),t!==this.preloadGeneration)return}catch(i){}}const o=["MetalSynth","MembraneSynth","NoiseSynth","FMSynth"];for(const c of e)if(o.includes(c.synthType||"")){const e=this.getInstrumentKey(c.id,-1),t=this.instruments.get(e);if(t&&!Xa(t))try{const e=t.volume.value;t.volume.value=-1/0,"NoiseSynth"===c.synthType||"MetalSynth"===c.synthType?t.triggerAttackRelease(.001,Q()):"MembraneSynth"===c.synthType?t.triggerAttackRelease("C2",.001,Q()):t.triggerAttackRelease?.("C4",.001,Q()),t.volume.value=e}catch(l){}}}async ensureWASMSynthsReady(e){const t=e.filter(e=>["TB303","Buzz3o3","V2","Sam","Synare","DubSiren","SpaceLaser","Dexed","OBXd"].includes(e.synthType||""));if(0===t.length)return;const n=[];for(const a of t){const e=this.getInstrument(a.id,a);e?.ensureInitialized&&n.push(e.ensureInitialized())}n.length>0&&await Promise.all(n)}setMasterVolume(e){this.masterChannel.volume.value=e}setMasterMute(e){this.masterChannel.mute=e}_currentLatency="";setAudioLatency(e){if(this._currentLatency===e)return;this._currentLatency=e;let t=.05;switch(e){case"interactive":t=.01;break;case"balanced":t=.05;break;case"playback":t=.15}k().lookAhead=t}setAmigaFilter(e){this.amigaFilterEnabled=e,this.amigaFilter.ledFilterEnabled=e}getAmigaFilterEnabled(){return this.amigaFilterEnabled}processInstrumentTicks(e=Q()){this.instruments.forEach(t=>{t&&"function"==typeof t.processTick&&t.processTick(e)})}setBPM(e){const t=N();"started"===t.state?t.bpm.rampTo(e,.02):t.bpm.value=e,this.updateBpmSyncedEffects(e)}getBPM(){return N().bpm.value}async start(){"suspended"===k().state&&await ye(),N().start()}stop(){this.releaseAll();const e=this.masterChannel.volume.value;this.masterChannel.volume.value=-1/0,setTimeout(()=>{this.masterChannel.volume.value=e},50),N().stop()}pause(){N().pause()}getPosition(){return N().position}setPosition(e){N().position=e}getInstrumentKey(e,t){return`${e}-${t??-1}`}lastTriggerTime=0;getSafeTime(e){if("running"!==ve.state)return null;const t=null==e||isNaN(e)||e<=0?be():Q();let n;return n=null!=e&&!isNaN(e)&&e>0?e:t+.001,n<=this.lastTriggerTime&&(n=this.lastTriggerTime+5e-4),this.lastTriggerTime=n,n}getImmediateTime(){let e=be();return e<=this.lastTriggerTime&&(e=this.lastTriggerTime+1e-4),this.lastTriggerTime=e,e}getInstrument(e,t,n){const a=t.synthType?.startsWith("MAME")||"CZ101"===t.synthType||"CEM3394"===t.synthType||"SCSP"===t.synthType,s=t.synthType?.startsWith("Furnace")||"Furnace"===t.synthType,r=t.synthType?.startsWith("Buzz")||"Buzzmachine"===t.synthType,o=["TB303","V2","Sam","DubSiren","SpaceLaser","Synare","Dexed","OBXd","WAM"].includes(t.synthType||""),i=!o&&"string"==typeof t.synthType&&Am.has(t.synthType),l="Sampler"===t.synthType||"Player"===t.synthType||a||s||r||o||i,c=l?this.getInstrumentKey(e,-1):this.getInstrumentKey(e,n);if(this.instruments.has(c))return this.instruments.get(c);const d=void 0!==n&&n>=Km.LIVE_VOICE_BASE_CHANNEL,u=this.getInstrumentKey(e,-1);if(!l&&!d&&this.instruments.has(u))return this.instruments.get(u);let p;switch(t.synthType){case"Synth":const n="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new Y({voice:X,maxPolyphony:n,options:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"MonoSynth":p=new Z({oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume||-12});break;case"DuoSynth":p=new J({voice0:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},vibratoAmount:t.oscillator?.detune?t.oscillator.detune/100:.5,vibratoRate:5,volume:t.volume||-12});break;case"FMSynth":const a="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?6:3;p=new Y({voice:I,maxPolyphony:a,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},modulationIndex:10},volume:t.volume||-12});break;case"AMSynth":const s="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new Y({voice:ee,maxPolyphony:s,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break;case"PluckSynth":const r="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new Y({voice:te,maxPolyphony:r,options:{attackNoise:1,dampening:t.filter?.frequency||4e3,resonance:.7},volume:t.volume||-12});break;case"MetalSynth":p=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??100)/1e3,sustain:0,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"MembraneSynth":p=new X({oscillator:{type:"sine"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??400)/1e3,sustain:.01,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"NoiseSynth":{const e=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume??-12});if(t.filter&&"lowpass"!==t.filter.type){const n=new m({type:t.filter.type,frequency:t.filter.frequency,Q:t.filter.Q||1,rolloff:t.filter.rolloff||-12});e.connect(n),p={triggerAttackRelease:(t,n,a)=>{e.triggerAttackRelease(t,n,a)},triggerAttack:(t,n)=>{e.triggerAttack(t,n)},triggerRelease:t=>{e.triggerRelease(t)},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{e.dispose(),n.dispose()},volume:e.volume}}else p=e;break}case"TB303":case"SuperSaw":case"PolySynth":case"Organ":case"DrumMachine":case"ChipSynth":case"PWMSynth":case"StringMachine":case"FormantSynth":case"Wavetable":case"WobbleBass":case"Furnace":case"FurnaceOPN":case"FurnaceOPM":case"FurnaceOPL":case"FurnaceOPLL":case"FurnaceOPZ":case"FurnaceOPNA":case"FurnaceOPNB":case"FurnaceOPL4":case"FurnaceY8950":case"FurnaceESFM":case"FurnaceNES":case"FurnaceGB":case"FurnacePSG":case"FurnacePCE":case"FurnaceSNES":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceVRC7":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceSCC":case"FurnaceX1_010":case"FurnaceBUBBLE":case"FurnaceTIA":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":case"FurnaceOPN2203":case"FurnaceOPNBB":case"FurnaceAY8930":case"FurnaceNDS":case"FurnaceGBA":case"FurnacePOKEMINI":case"FurnaceNAMCO":case"FurnacePET":case"FurnacePOKEY":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceAMIGA":case"FurnacePCSPKR":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceZXBEEPER":case"FurnaceSCVTONE":case"FurnacePCMDAC":case"DrumKit":case"ChiptuneModule":case"Dexed":case"OBXd":case"MAMEVFX":case"MAMEDOC":case"MAMERSA":case"MAMESWP30":case"CZ101":case"CEM3394":case"SCSP":case"MAMEAICA":case"MAMEASC":case"MAMEAstrocade":case"MAMEC352":case"MAMEES5503":case"MAMEICS2115":case"MAMEK054539":case"MAMEMEA8000":case"MAMEMSM5232":case"MAMERF5C400":case"MAMESN76477":case"MAMESNKWave":case"MAMESP0250":case"MAMETIA":case"MAMETMS36XX":case"MAMETMS5220":case"MAMETR707":case"MAMEUPD931":case"MAMEUPD933":case"MAMEVotrax":case"MAMEYMF271":case"MAMEYMOPQ":case"MAMEVASynth":case"BuzzDTMF":case"BuzzFreqBomb":case"BuzzKick":case"BuzzKickXP":case"BuzzNoise":case"BuzzTrilok":case"Buzz4FM2F":case"BuzzDynamite6":case"BuzzM3":case"Buzz3o3":case"DubSiren":case"SpaceLaser":case"V2":case"Sam":case"Synare":case"WAM":case"Buzzmachine":p=Dm.createInstrument(t);break;case"Sampler":{let n=t.parameters?.sampleUrl||t.sample?.url;const a=t.sample?.baseNote||"C4",s=!0===t.sample?.loop,r=t.sample?.loopStart||0,o=t.sample?.loopEnd||0,i=t.sample?.audioBuffer;if(n&&n.startsWith("blob:")&&(n=void 0),n&&(n=jn(n)),i){let n=i;if("string"==typeof i)try{const e=atob(i),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);n=t.buffer}catch(h){n=null}if(n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||s){p=new ie({loop:s,volume:t.volume||0}),this.instrumentSynthTypes.set(c,"Player");const a=n,i=p,l=(async()=>{try{const n=await this.decodeAudioData(a);if(i.buffer=new xe(n),s){const e=t.sample?.sampleRate||8363,a=n.duration;i.loopStart=Math.min(r/e,a-1e-4),i.loopEnd=Math.min(o/e,a),i.loopEnd<=i.loopStart&&(i.loopEnd=a)}this.decodedAudioBuffers.set(e,n)}catch(n){}})();this.instrumentLoadingPromises.set(c,l)}else{p=new oe({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"Sampler");const s=n,r=p,o=(async()=>{try{const t=await this.decodeAudioData(s),n=new xe(t);r.add(a,n),this.decodedAudioBuffers.set(e,t)}catch(t){}})();this.instrumentLoadingPromises.set(c,o)}}}if(!p&&n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||s){const a=new ie({url:n,loop:s,volume:t.volume||0,onload:()=>{if(s){const e=t.sample?.sampleRate||8363,n=a.buffer.get(),s=n?n.duration:0;s>0&&(a.loopStart=Math.min(r/e,s-1e-4),a.loopEnd=Math.min(o/e,s),a.loopEnd<=a.loopStart&&(a.loopEnd=s))}const n=a.buffer.get();n&&this.decodedAudioBuffers.set(e,n)},onerror:e=>{}});p=a,this.instrumentSynthTypes.set(c,"Player")}else{const e=t.sample?.multiMap||{};t.sample?.multiMap||(e[a]=n),p=new oe({urls:e,volume:t.volume||-12,onerror:e=>{}}),this.instrumentSynthTypes.set(c,"Sampler")}}p||(p=new oe({volume:t.volume||-12}));break}case"Player":{const e=t.parameters?.sampleUrl;p=new ie(e?{url:e,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{volume:t.volume||-12});break}case"GranularSynth":{const e=t.granular?.sampleUrl||t.parameters?.sampleUrl,n=t.granular;p=new le(e?{url:e,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{grainSize:.1,overlap:.5,loop:!0,volume:t.volume||-12});break}default:if(Am.has(t.synthType||"")){p=Dm.createInstrument(t);break}return Lo(t.synthType||"Unknown",`Unsupported synth type "${t.synthType}". This instrument cannot produce sound.`,{synthName:t.name,errorType:"init",debugData:{synthType:t.synthType,instrumentId:e}}),null}return p?(t.filter&&p.filter&&(p.filter.type=t.filter.type,p.filter.frequency.value=t.filter.frequency,p.filter.Q.value=t.filter.Q),this.instruments.set(c,p),this.instrumentSynthTypes.has(c)||this.instrumentSynthTypes.set(c,t.synthType),this.buildInstrumentEffectChain(c,t.effects||[],p).catch(e=>{}),p):null}getInstrumentAnalyser(e){let t=this.instrumentAnalysers.get(e);if(t)return t;t=new Vm;let n=this.masterInput;for(const[a,s]of this.instruments)if(a.startsWith(`${e}-`)){Xa(s)&&(n=this.synthBus);break}t.output.connect(n);return this.instrumentEffectChains.forEach((n,a)=>{const[s]=String(a).split("-");if(s===String(e)){try{n.output.disconnect(this.masterInput)}catch{}try{n.output.disconnect(this.synthBus)}catch{}n.output.connect(t.input)}}),this.instrumentAnalysers.set(e,t),t}disposeInstrumentAnalyser(e){const t=this.instrumentAnalysers.get(e);if(!t)return;const n=this.getInstrumentKey(e,-1);let a=this.instruments.get(n);if(!a)for(const[s,r]of this.instruments)if(s.startsWith(`${e}-`)){a=r;break}if(a){const e=Xa(a);try{e?a.output.disconnect():a.disconnect()}catch{}const t=this.instrumentEffectChains.get(n),s=t=>{e?this.connectNativeSynth(a.output,t):a.connect(t)};t?t.effects.length>0?s(t.effects[0]):s(t.output):s(e?this.synthBus:this.masterInput)}t.dispose(),this.instrumentAnalysers.delete(e)}disposeAllInstrumentAnalysers(){this.instrumentAnalysers.forEach((e,t)=>{this.disposeInstrumentAnalyser(t)})}applyAutomation(e,t,n,a){const s=this.getInstrumentKey(e,a),r=this.instruments.get(s);if(!r){const a=this.instruments.get(this.getInstrumentKey(e,-1));if(!a)return;return void this.applyAutomationToInstrument(a,t,n)}this.applyAutomationToInstrument(r,t,n)}applyAutomationToInstrument(e,t,n){const a=this.getSafeTime();if(null!==a)try{switch(t){case"cutoff":if(e instanceof dr){const t=200*Math.pow(100,n);e.setCutoff(t)}else if(e.filter){const t=200*Math.pow(100,n);e.filter.frequency.setValueAtTime(t,a)}break;case"resonance":e instanceof dr?e.setResonance(100*n):e.filter&&e.filter.Q.setValueAtTime(10*n,a);break;case"envMod":e instanceof dr&&e.setEnvMod(100*n);break;case"volume":const s=40*n-40;if(Xa(e)){const t=Math.pow(10,s/20);e.output.gain.setValueAtTime(t,a)}else e.volume&&e.volume.setValueAtTime(s,a);break;case"pan":const r=2*n-1;e.pan&&e.pan.setValueAtTime(r,a);break;case"decay":if(e instanceof dr){const t=30+2970*n;e.setDecay(t)}break;case"accent":e instanceof dr&&e.setAccentAmount(100*n);break;case"tuning":if(e instanceof dr){const t=200*(n-.5);e.setTuning(t)}break;case"overdrive":e instanceof dr&&e.setOverdrive(100*n);break;case"normalDecay":if(e instanceof dr){const t=30+2970*n;e.setNormalDecay(t)}break;case"accentDecay":if(e instanceof dr){const t=30+2970*n;e.setAccentDecay(t)}break;case"vegDecay":if(e instanceof dr){const t=16+2984*n;e.setVegDecay(t)}break;case"vegSustain":e instanceof dr&&e.setVegSustain(100*n);break;case"softAttack":if(e instanceof dr){const t=.3*Math.pow(100,n);e.setSoftAttack(t)}break;case"filterTracking":e instanceof dr&&e.setFilterTracking(200*n);break;case"filterFM":e instanceof dr&&e.setFilterFM(100*n);break;case"distortion":case"delay":case"reverb":break;default:e instanceof Cm?e.setParameter(t,n):"function"==typeof e.setParam&&e.setParam(t,n)}}catch(s){}}applySlideAndAccent(e,t,n,a,s,r,o,i){let l=a;if(s&&(l=Math.min(1,a*Km.ACCENT_BOOST)),r&&void 0!==o){const a=this.channelLastNote.get(o);if(a&&a.frequency>0){let s=null;if(e.oscillator?.frequency?s=e.oscillator.frequency:e.voice0?.oscillator?.frequency?s=e.voice0.oscillator.frequency:e.frequency&&(s=e.frequency),s)try{s.setValueAtTime(a.frequency,n),s.setTargetAtTime(t,n,Km.SLIDE_TIME_CONSTANT)}catch(c){}}}return void 0!==o&&void 0!==i&&this.channelLastNote.set(o,{frequency:t,time:n,instrumentId:i}),l}triggerNoteAttack(e,t,n,a=1,s,r,o,i,l,c){const d=this.getInstrument(e,s,l);if(!d)return;if(!(d.triggerAttack||d.start))return;const u=s.isLive?this.getImmediateTime():this.getSafeTime(n);if(null!==u)try{if(d instanceof dr)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,d.triggerAttack(t,u,a,o,i);else if(d instanceof dr)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,d.triggerAttack(t,u,a,o,i,c);else if("NoiseSynth"===s.synthType)d.triggerAttack(u,a);else if("Sampler"===s.synthType){const n=this.getInstrumentKey(e,void 0);if("Player"===this.instrumentSynthTypes.get(n)){const e=d;if(!e.buffer||!e.buffer.loaded)return;const n=a>0?we(a):-1/0;if(e.volume.value=n,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let n=r;if(0!==t.finetune){const e=jm(r,0);e>=0&&(n=Rm(e,t.finetune))}const a=t.periodMultiplier/n,o=a/(s.sample?.sampleRate||8363);e.playbackRate=o}else{const n=s.sample?.baseNote||"C4",a=ce(n).toFrequency(),r=ce(t).toFrequency()/a;e.playbackRate=r}e.start(u)}else{const e=d;if(!e.loaded)return;e.triggerAttack(t,u,a)}}else if("Player"===s.synthType||"GranularSynth"===s.synthType){const e=d;if(!e.buffer||!e.buffer.loaded)return;const n=a>0?we(a):-1/0;if(e.volume.value=n,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let n=r;if(0!==t.finetune){const e=jm(r,0);e>=0&&(n=Rm(e,t.finetune))}const a=t.periodMultiplier/n,o=a/(s.sample?.sampleRate||8363);e.playbackRate=o}else{const n=s.sample?.baseNote||"C4",a=ce(n).toFrequency(),r=ce(t).toFrequency()/a;e.playbackRate=r}e.start(u)}else if("NoiseSynth"===s.synthType){const e=d,t=o?Math.min(1,a*Km.ACCENT_BOOST):a;e.triggerAttack(u,t)}else if("MetalSynth"===s.synthType){const e=d,t=o?Math.min(1,a*Km.ACCENT_BOOST):a;e.triggerAttack(u,t)}else if("MembraneSynth"===s.synthType){const e=d,n=o?Math.min(1,a*Km.ACCENT_BOOST):a;e.triggerAttack(t,u,n)}else if("BuzzmachineGenerator"===d.constructor.name)d.triggerAttack(t,u,a,o,i);else if(d instanceof Cm)d.triggerAttack(t,u,a);else{const n=ce(t).toFrequency(),s=this.applySlideAndAccent(d,n,u,a,o,i,l,e);d.triggerAttack(t,u,s)}}catch(p){}}triggerNoteRelease(e,t,n,a,s){const r=this.getInstrument(e,a,s);if(!r||!r.triggerRelease)return;const o=a.isLive?this.getImmediateTime():this.getSafeTime(n);if(null!==o)try{if("Sampler"===a.synthType){const e=r;if(!e.loaded)return;return void e.triggerRelease(t,o)}if("Player"===a.synthType||"GranularSynth"===a.synthType){const e=r;return void("started"===e.state&&e.stop(o))}"NoiseSynth"===a.synthType||"MonoSynth"===a.synthType||"DuoSynth"===a.synthType||"MetalSynth"===a.synthType||"MembraneSynth"===a.synthType||"TB303"===a.synthType||"DubSiren"===a.synthType||"Synare"===a.synthType||"Furnace"===a.synthType||"BuzzKick"===a.synthType||"BuzzKickXP"===a.synthType||"BuzzNoise"===a.synthType||"BuzzTrilok"===a.synthType||"Buzz4FM2F"===a.synthType||"BuzzDynamite6"===a.synthType||"BuzzM3"===a.synthType||"Buzz3o3"===a.synthType||"SpaceLaser"===a.synthType||"Sam"===a.synthType||"V2"===a.synthType||"V2Speech"===a.synthType||"MAMEVFX"===a.synthType||"MAMEDOC"===a.synthType||"MAMERSA"===a.synthType||"MAMESWP30"===a.synthType||"CZ101"===a.synthType||"CEM3394"===a.synthType||"SCSP"===a.synthType||a.synthType.startsWith("MAME")?r.triggerRelease(o):r.triggerRelease(t,o)}catch(i){}}static NATIVE_POLY_TYPES=new Set(["Synth","FMSynth","AMSynth","PluckSynth","Sampler","SuperSaw","PolySynth","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth","Wavetable","WobbleBass"]);triggerPolyNoteAttack(e,t,n,a,s=!1,r=!1){!0===a.monophonic&&(r||this.releaseAllPolyNotes(e,a));const o=a.synthType;if((!o||Km.NATIVE_POLY_TYPES.has(o))&&!0!==a.monophonic){this.liveVoiceAllocation.set(t,-1);const o=a.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,o,n,a,void 0,s,r)}if("TB303"===o||"Buzz3o3"===o){r||this.releaseAllPolyNotes(e,a),this.liveVoiceAllocation.set(t,-1);const o=a.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,o,n,a,void 0,s,r)}if(this.liveVoiceAllocation.has(t)&&(r||this.triggerPolyNoteRelease(e,t,a)),0===this.liveVoicePool.length)return;const i=this.liveVoicePool.shift();this.liveVoiceAllocation.set(t,i);const l=this.getImmediateTime();this.triggerNoteAttack(e,t,l,n,a,void 0,s,r,i)}triggerPolyNoteRelease(e,t,n){const a=this.liveVoiceAllocation.get(t);if(void 0===a)return;this.liveVoiceAllocation.delete(t);const s=n.isLive?this.getImmediateTime():0;-1===a?this.triggerNoteRelease(e,t,s,n):(this.triggerNoteRelease(e,t,s,n,a),this.liveVoicePool.push(a))}releaseAllPolyNotes(e,t){for(const[n,a]of this.liveVoiceAllocation.entries())-1===a?this.triggerNoteRelease(e,n,0,t):(this.triggerNoteRelease(e,n,0,t,a),this.liveVoicePool.push(a));this.liveVoiceAllocation.clear()}hasActivePolyNotes(){return this.liveVoiceAllocation.size>0}releaseNote(e,t,n,a){const s=this.getInstrumentKey(e,a);let r=this.instruments.get(s);if(r||(r=this.instruments.get(this.getInstrumentKey(e,-1))),!r)return;const o=this.getSafeTime(n);if(null===o)return;const i=this.instrumentSynthTypes.get(s)||this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if("Sampler"===i){const e=r;if(e.loaded&&e.triggerRelease)try{e.triggerRelease(t,o)}catch{}return}if("Player"===i||"GranularSynth"===i){const e=r;if("started"===e.state)try{e.stop(o)}catch{}return}if(!r.triggerRelease)return;const l="MonoSynth"===i||"DuoSynth"===i||"MetalSynth"===i||"MembraneSynth"===i||"NoiseSynth"===i||"TB303"===i||"Buzz3o3"===i||"BuzzKick"===i||"BuzzKickXP"===i||"BuzzNoise"===i||"BuzzTrilok"===i||"Buzz4FM2F"===i||"BuzzDynamite6"===i||"BuzzM3"===i||"DubSiren"===i||"Synare"===i;try{l?r.triggerRelease(o):r.triggerRelease(t,o)}catch{try{r.triggerRelease(o)}catch{}}}triggerNote(e,t,n,a,s=1,r,o,i,l,c,d,u=0,p){const h=this.getSafeTime(a);if(null===h)return;const m=this.getInstrument(e,r,l);if(m){if(void 0!==l){let n,a=this.activeVoices.get(l)||[];0===u?(a.forEach(e=>{e.instrument!==m&&this.stopVoice(e,h)}),a=a.filter(e=>e.instrument===m)):a.forEach(e=>{2===u&&e.volumeEnv.keyOff(),3===u&&(e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024))}),"Sampler"===r.synthType||"Player"===r.synthType?(n=new ie(m.buffer),n.loop=m.loop,n.loopStart=m.loopStart,n.loopEnd=m.loopEnd):n="Synth"===r.synthType?new X(m.get()):m;const p=a.findIndex(e=>e.instrument===n);if(p>=0)a[p].note=t;else{const e=this.createVoice(l,n,t,r);Xa(n)||n.connect(e.nodes.gain),a.push(e)}this.activeVoices.set(l,a);try{if(n instanceof ie){const e=s>0?we(s):-1/0;if(n.volume.value=e,r.metadata?.modPlayback?.usePeriodPlayback&&c){const e=r.metadata.modPlayback.periodMultiplier/c,t=r.sample?.sampleRate||8363;n.playbackRate=e/t}else{const e=r.sample?.baseNote||"C4",a=ce(e).toFrequency(),s=ce(t).toFrequency()/a;n.playbackRate=s}const a=d?d/(n.buffer.sampleRate||44100):0;n.start(h,a)}else if(n.triggerAttack){if(Xa(n)){const e=n.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}if("NoiseSynth"===r.synthType||"MetalSynth"===r.synthType){const e=o?Math.min(1,s*Km.ACCENT_BOOST):s;n.triggerAttack(h,e)}else if(n instanceof dr)n.triggerAttack(t,h,s,o,i);else if(n instanceof dr)n.triggerAttack(t,h,s,o,i);else{const a=ce(t).toFrequency(),r=this.applySlideAndAccent(n,a,h,s,o,i,l,e);n.triggerAttack(t,h,r)}}}catch(f){}return}if(Xa(m)){const e=m.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}try{if(m instanceof dr)m.triggerAttackRelease(t,n,h,s,o,i);else if(m instanceof dr)m.triggerAttackRelease(t,n,h,s,o,i,p);else if("NoiseSynth"===r.synthType)m.triggerAttackRelease(n,h,s);else if("MetalSynth"===r.synthType)m.triggerAttackRelease(n,h,s);else if("MembraneSynth"===r.synthType)m.triggerAttackRelease(t,n,h,s);else if("GranularSynth"===r.synthType){const e=m;if(e.buffer&&e.buffer.loaded){const a=s>0?we(s):-1/0;if(e.volume.value=a,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=jm(c,0);e>=0&&(n=Rm(e,t.finetune))}const a=t.periodMultiplier/n,s=a/(r.sample?.sampleRate||8363);e.playbackRate=s*(r.granular?.playbackRate||1)}else{const n=ce("C4").toFrequency(),a=ce(t).toFrequency()/n;e.playbackRate=a*(r.granular?.playbackRate||1)}e.start(h),e.stop(h+n)}}else if("Player"===r.synthType||"Sampler"===r.synthType&&r.sample?.loop||"Sampler"===r.synthType&&r.metadata?.modPlayback?.usePeriodPlayback){const e=m;if(e.buffer&&e.buffer.loaded){const a=o?Math.min(1,s*Km.ACCENT_BOOST):s,i=a>0?we(a):-1/0;if(e.volume.value=i,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=jm(c,0);e>=0&&(n=Rm(e,t.finetune))}const a=t.periodMultiplier/n,s=a/(r.sample?.sampleRate||8363);e.playbackRate=s}else if(r.metadata?.modPlayback?.usePeriodPlayback&&!c);else{const n=ce("C4").toFrequency(),a=ce(t).toFrequency()/n;e.playbackRate=a}const u=d&&d>0?d/(e.buffer?.sampleRate||k().sampleRate):0;if(e.loop){if(void 0!==l){const t=this.channelActivePlayer.get(l);t&&"started"===t.state&&t.stop(h),this.channelActivePlayer.set(l,e)}e.start(h,u)}else e.start(h,u),e.stop(h+n)}}else if("Sampler"!==r.synthType||r.sample?.loop){if("SuperSaw"===r.synthType||"PolySynth"===r.synthType||"Organ"===r.synthType||"ChipSynth"===r.synthType||"PWMSynth"===r.synthType||"StringMachine"===r.synthType||"FormantSynth"===r.synthType){if(m.triggerAttackRelease){const a=ce(t).toFrequency(),r=this.applySlideAndAccent(m,a,h,s,o,i,l,e);m.triggerAttackRelease(t,n,h,r)}}else if(m instanceof Cm)m.triggerAttackRelease(t,n,h,s);else if("DrumMachine"===r.synthType){if(m.triggerAttackRelease){const e=o?Math.min(1,s*Km.ACCENT_BOOST):s;m.triggerAttackRelease(t,n,h,e)}}else if(m.triggerAttackRelease){const a=ce(t).toFrequency(),r=this.applySlideAndAccent(m,a,h,s,o,i,l,e);m.triggerAttackRelease(t,n,h,r)}}else{const e=m;if(e.loaded)if(d&&d>0){const a=r.sample?.baseNote||"C4",o=e._buffers?.get(a)||e._buffers?._buffers?.[a];if(o&&o.duration){const i=256*d/(o.sampleRate||k().sampleRate),l=Math.min(i,o.duration-.001);try{const e=new ie({url:o,volume:we(s)+(r.volume||-12)}).toDestination(),i=ce(a).toFrequency(),c=ce(t).toFrequency()/i;e.playbackRate=c,e.start(h,l),e.stop(h+n),N().scheduleOnce(()=>{e.dispose()},h+n+.1)}catch(f){e.triggerAttackRelease(t,n,h,s)}}else e.triggerAttackRelease(t,n,h,s)}else e.triggerAttackRelease(t,n,h,s)}}catch(y){}}}schedulePatternEvents(e,t){N().cancel(),e.forEach(e=>{N().schedule(t=>{this.triggerNote(e.instrumentId,e.note,e.duration,t,e.velocity,e.config)},e.time)})}clearSchedule(){N().cancel()}releaseAll(){const e=Q();this.instruments.forEach((t,n)=>{try{if(t instanceof ie||t instanceof le?"started"===t.state&&t.stop(e):t instanceof dr?t.releaseAll():t.releaseAll?t.releaseAll(e):Xa(t)&&t.triggerRelease&&t.triggerRelease(void 0,e),t.volume&&"function"==typeof t.volume.rampTo){const a=t.volume.value;t.volume.rampTo(-1/0,.05,e);const s=this.releaseRestoreTimeouts.get(n);s&&clearTimeout(s);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(n);try{t.volume&&(t.volume.value=a)}catch{}},100);this.releaseRestoreTimeouts.set(n,r)}else if(Xa(t)){const a=t.output.gain,s=this.releaseRestoreTimeouts.get(n);s&&clearTimeout(s),a.cancelScheduledValues(e),a.setValueAtTime(a.value||1,e),a.linearRampToValueAtTime(0,e+.05);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(n);try{a.cancelScheduledValues(0),a.value=1}catch{}},100);this.releaseRestoreTimeouts.set(n,r)}}catch(a){}}),this.channelPitchState.clear(),this.channelActivePlayer.clear()}disposeInstrumentByKey(e){const t=this.instruments.get(e);if(t){this.instruments.delete(e),this.instrumentSynthTypes.delete(e),this.instrumentLoadingPromises.delete(e);try{t.disposed||(t.releaseAll?t.releaseAll():t.triggerRelease&&t.triggerRelease())}catch(n){}this.disposeInstrumentEffectChain(e);try{t.disposed||t.dispose()}catch(n){}}}disposeInstrument(e){const t=[];this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&t.push(a)}),t.forEach(e=>{this.disposeInstrumentByKey(e)})}invalidateInstrument(e){this.disposeInstrument(e)}updateInstrument(e,t){this.disposeInstrument(e),this.getInstrument(e,t)}async previewSlice(e,t,n){await ye();const a=(await An(()=>Promise.resolve().then(()=>Ty),void 0).then(e=>e.useInstrumentStore.getState())).instruments.find(t=>t.id===e),s=a?.sample?.audioBuffer,r=a?.sample?.url;if(s||r)try{let e;if(s)e=await this.decodeAudioData(s);else{const t=await fetch(r),n=await t.arrayBuffer();e=await this.decodeAudioData(n)}const a=e.sampleRate,o=n-t;if(o<=0)return;const i=ve.createBuffer(e.numberOfChannels,o,a);for(let n=0;n<e.numberOfChannels;n++){const a=e.getChannelData(n),s=i.getChannelData(n);for(let e=0;e<o;e++)s[e]=a[t+e]}const l=new ie(i).toDestination();l.start();setTimeout(()=>{try{l.stop(),l.dispose()}catch{}},o/a*1e3+100)}catch(o){}}async bakeInstrument(e,t=2,n="C4"){return await ke(async()=>{const t=Dm.createInstrument(e);if(e.effects&&e.effects.length>0){const n=await Dm.createEffectChain(e.effects);let a;if(Xa(t)){const e=new p(1),n=ns(e);n&&t.output.connect(n),a=e}else a=t;let s=a;for(const e of n)s.connect(e),s=e;s.toDestination()}else if(Xa(t)){const e=new p(1),n=ns(e);n&&t.output.connect(n),e.toDestination()}else t.toDestination();t.triggerAttack&&(t.triggerAttack(n,0),t.triggerRelease&&t.triggerRelease(1))},t)}updateWAMParameters(e,t){const n=[];this.instruments.forEach((t,a)=>{const[s]=a.split("-");s===String(e)&&t instanceof Cm&&n.push(t)}),0!==n.length?n.forEach(e=>{t.parameterValues&&Object.entries(t.parameterValues).forEach(([t,n])=>{e.setParameter(t,n)}),t.pluginState&&e.setPluginState(t.pluginState)}):this.invalidateInstrument(e)}updateTB303Parameters(e,t){const n=[];if(this.instruments.forEach((t,a)=>{const[s]=a.split("-");s===String(e)&&t instanceof dr&&n.push(t)}),0===n.length)return void this.invalidateInstrument(e);const a=200,s=2e3,r=(e,t,n)=>{if(e>=0&&e<=1)return e;const a=Math.max(t,Math.min(n,e));return Math.log(a/t)/Math.log(n/t)},o=e=>e>=0&&e<=1?e:Math.max(0,Math.min(1,e/100));n.forEach(e=>{if(void 0!==t.tuning&&e.setTuning(t.tuning),void 0!==t.volume&&e.setVolume(t.volume),t.filter&&(e.setCutoff(r(t.filter.cutoff,314,2394)),e.setResonance(o(t.filter.resonance))),t.filterEnvelope&&(e.setEnvMod(o(t.filterEnvelope.envMod)),e.setDecay(r(t.filterEnvelope.decay,a,s))),t.accent&&e.setAccentAmount(o(t.accent.amount)),t.slide&&e.setSlideTime(r(t.slide.time,2,360)),t.overdrive&&e.setOverdrive(o(t.overdrive.amount)),t.oscillator){const n=void 0!==t.oscillator.waveformBlend?t.oscillator.waveformBlend:"square"===t.oscillator.type?1:0;e.setWaveform(n),void 0!==t.oscillator.pulseWidth&&e.setPulseWidth(o(t.oscillator.pulseWidth)),void 0!==t.oscillator.subOscGain&&e.setSubOscGain(o(t.oscillator.subOscGain)),void 0!==t.oscillator.subOscBlend&&e.setSubOscBlend(o(t.oscillator.subOscBlend)),void 0!==t.oscillator.pitchToPw&&e.setPitchToPw(t.oscillator.pitchToPw)}if(t.devilFish?.enabled){const n=t.devilFish;if(e.enableDevilFish(!0),e.setNormalDecay(r(n.normalDecay,a,s)),e.setAccentDecay(r(n.accentDecay,a,s)),e.setSoftAttack(o(n.softAttack)),void 0!==n.accentSoftAttack&&e.setAccentSoftAttack(o(n.accentSoftAttack)),e.setVegDecay(r(n.vegDecay,a,s)),e.setVegSustain(o(n.vegSustain)),e.setFilterTracking(o(n.filterTracking)),e.setFilterFmDepth(o(n.filterFmDepth)),void 0!==n.filterInputDrive&&e.setFilterInputDrive(o(n.filterInputDrive)),void 0!==n.passbandCompensation&&e.setPassbandCompensation(1-o(n.passbandCompensation)),void 0!==n.resTracking){const t=o(n.resTracking);e.setResTracking(1-t),e.setKorgIbiasScale(.1+3.9*t)}void 0!==n.duffingAmount&&e.setDuffingAmount(o(n.duffingAmount)),void 0!==n.lpBpMix&&e.setLpBpMix(o(n.lpBpMix)),void 0!==n.filterSelect&&e.setFilterSelect(n.filterSelect),void 0!==n.diodeCharacter&&e.setDiodeCharacter(o(n.diodeCharacter)),void 0!==n.stageNLAmount&&"function"==typeof e.setStageNLAmount&&e.setStageNLAmount(o(n.stageNLAmount)),void 0!==n.ensembleAmount&&"function"==typeof e.setEnsembleAmount&&e.setEnsembleAmount(o(n.ensembleAmount)),void 0!==n.oversamplingOrder&&"function"==typeof e.setOversamplingOrder&&e.setOversamplingOrder(n.oversamplingOrder),void 0!==n.korgBite&&e.setKorgBite(n.korgBite),void 0!==n.korgClip&&e.setKorgClip(n.korgClip),void 0!==n.korgCrossmod&&e.setKorgCrossmod(n.korgCrossmod),void 0!==n.korgQSag&&e.setKorgQSag(n.korgQSag),void 0!==n.korgSharpness&&e.setKorgSharpness(n.korgSharpness),"function"==typeof e.setMuffler&&e.setMuffler(n.muffler),"function"==typeof e.setHighResonance&&e.setHighResonance(n.highResonance)}else t.devilFish&&e.enableDevilFish(!1);if(t.lfo&&(e.setLfoWaveform(t.lfo.waveform),e.setLfoRate(t.lfo.rate),e.setLfoContour(t.lfo.contour),e.setLfoPitchDepth(t.lfo.pitchDepth),e.setLfoPwmDepth(t.lfo.pwmDepth),e.setLfoFilterDepth(t.lfo.filterDepth),void 0!==t.lfo.stiffDepth&&e.setLfoStiffDepth(t.lfo.stiffDepth)),t.chorus){e.setChorusMode(t.chorus.mode);const n=o(t.chorus.mix);e.setChorusMix(t.chorus.enabled?n:0)}if(t.phaser){e.setPhaserRate(o(t.phaser.rate)),e.setPhaserWidth(o(t.phaser.depth)),e.setPhaserFeedback(o(t.phaser.feedback));const n=o(t.phaser.mix);e.setPhaserMix(t.phaser.enabled?n:0)}t.delay&&(e.setDelayTime(t.delay.time>1?t.delay.time/2e3:t.delay.time),e.setDelayFeedback(o(t.delay.feedback)),e.setDelayTone(o(t.delay.tone)),e.setDelayMix(t.delay.enabled?o(t.delay.mix):0),e.setDelaySpread(o(t.delay.stereo)))})}updateFurnaceInstrument(e,t){if(!t.furnace||!t.synthType?.startsWith("Furnace"))return;const n=[];this.instruments.forEach((t,a)=>{const[s]=a.split("-");s===String(e)&&t.uploadInstrumentData&&n.push(t)}),0!==n.length?An(async()=>{const{updateFurnaceInstrument:e}=await import("./FurnaceInstrumentEncoder-DUItTP_3.js");return{updateFurnaceInstrument:e}},[]).then(({updateFurnaceInstrument:e})=>{const a=t.furnace.furnaceIndex??0,s=e(t.furnace,t.name,a);n.forEach(e=>{e.uploadInstrumentData(s)})}).catch(e=>{}):this.invalidateInstrument(e)}getMAMESynthHandle(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);return n instanceof yr?n.getHandle():0}getMAMEChipSynth(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);if(n instanceof _r)return n;for(const[a,s]of this.instruments)if(a.startsWith(`${e}-`)&&s instanceof _r)return s;return null}updateMAMEParameters(e,t){const n=this.getInstrumentKey(e,-1);this.instruments.get(n)}updateMAMEChipParam(e,t,n){const a=this.getInstrumentKey(e,-1),s=this.instruments.get(a);s&&"function"==typeof s.setParam&&s.setParam(t,n)}loadMAMEChipPreset(e,t){const n=this.getInstrumentKey(e,-1),a=this.instruments.get(n);a&&"function"==typeof a.loadPreset&&a.loadPreset(t)}updateMAMEChipTextParam(e,t,n){const a=this.getInstrumentKey(e,-1),s=this.instruments.get(a);s&&("function"==typeof s.setTextParam?s.setTextParam(t,n):"function"==typeof s.applyConfig&&s.applyConfig({[t]:n}))}loadSynthROM(e,t,n,a){const s=this.getInstrumentKey(e,-1),r=this.instruments.get(s);if(!r)return;const o=r;"MAMERSA"===t?"function"==typeof o.loadROM&&o.loadROM(n,a):"MAMESWP30"===t?"function"==typeof o.loadWaveROM&&o.loadWaveROM(a.buffer):"function"==typeof o.loadROM?o.loadROM(n,a):"function"==typeof o.setRom&&o.setRom(n,a)}updateDubSirenParameters(e,t){let n=!1;this.instruments.forEach((a,s)=>{const[r]=s.split("-");r===String(e)&&a&&"function"==typeof a.applyConfig&&(a.applyConfig(t),n=!0)})}updateSpaceLaserParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateV2Parameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");if(s===String(e)&&n&&"V2Synth"===n.name){const e=n;t.osc1&&(e.setParameter(2,t.osc1.mode),e.setParameter(4,t.osc1.transpose+64),e.setParameter(5,t.osc1.detune+64),e.setParameter(6,t.osc1.color),e.setParameter(7,t.osc1.level)),t.osc2&&(e.setParameter(8,t.osc2.mode),e.setParameter(9,t.osc2.ringMod?1:0),e.setParameter(10,t.osc2.transpose+64),e.setParameter(11,t.osc2.detune+64),e.setParameter(12,t.osc2.color),e.setParameter(13,t.osc2.level)),t.osc3&&(e.setParameter(14,t.osc3.mode),e.setParameter(15,t.osc3.ringMod?1:0),e.setParameter(16,t.osc3.transpose+64),e.setParameter(17,t.osc3.detune+64),e.setParameter(18,t.osc3.color),e.setParameter(19,t.osc3.level)),t.filter1&&(e.setParameter(20,t.filter1.mode),e.setParameter(21,t.filter1.cutoff),e.setParameter(22,t.filter1.resonance)),t.filter2&&(e.setParameter(23,t.filter2.mode),e.setParameter(24,t.filter2.cutoff),e.setParameter(25,t.filter2.resonance)),t.routing&&(e.setParameter(26,t.routing.mode),e.setParameter(27,t.routing.balance)),t.envelope&&(e.setParameter(32,t.envelope.attack),e.setParameter(33,t.envelope.decay),e.setParameter(34,t.envelope.sustain),e.setParameter(36,t.envelope.release)),t.envelope2&&(e.setParameter(38,t.envelope2.attack),e.setParameter(39,t.envelope2.decay),e.setParameter(40,t.envelope2.sustain),e.setParameter(42,t.envelope2.release)),t.lfo1&&(e.setParameter(47,t.lfo1.rate),e.setParameter(50,t.lfo1.depth))}})}updateSynareParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateFurnaceParameters(e,t){this.instruments.forEach((t,n)=>{const[a]=n.split("-");a===String(e)&&t&&"function"==typeof t.updateParameters&&t.updateParameters()})}applyFurnaceEffect(e,t,n,a=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,o]of this.instruments){const[s]=r.split("-");if(s===String(e)){if(o instanceof Jo)return o.applyEffect(t,n,a),!0;if(o instanceof Bo)return this.applyFurnaceSynthEffect(o,t,n),!0}}return!1}applyFurnaceExtendedEffect(e,t,n,a=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,o]of this.instruments){const[s]=r.split("-");if(s===String(e)&&o instanceof Jo)return o.applyExtendedEffect(t,n,a),!0}return!1}applyFurnaceSynthEffect(e,t,n){const a=n>>4&15,s=15&n,r=e.getChipType();8!==t?this.isFMChip(r)?this.applyFMEffect(e,t,n,a,s):this.isPSGChip(r)?this.applyPSGEffect(e,t,n,r):this.isWavetableChip(r)?this.applyWavetableEffect(e,t,n,r):this.isC64Chip(r)&&this.applyC64Effect(e,t,n):e.writePanRegister(n)}isFMChip(e){return[Po.OPN2,Po.OPM,Po.OPL3,Po.OPLL,Po.OPNA,Po.OPNB,Po.OPZ,Po.Y8950,Po.OPL4,Po.OPN,Po.OPNB_B,Po.ESFM].includes(e)}isPSGChip(e){return[Po.NES,Po.GB,Po.PSG,Po.AY,Po.AY8930,Po.SAA,Po.VIC,Po.TED].includes(e)}isWavetableChip(e){return[Po.PCE,Po.SCC,Po.SWAN,Po.N163,Po.NAMCO,Po.FDS,Po.BUBBLE,Po.X1_010,Po.SM8521].includes(e)}isC64Chip(e){return[Po.SID,Po.SID_6581,Po.SID_8580].includes(e)}applyFMEffect(e,t,n,a,s){switch(t){case 17:e.writeOperatorTL(a,8*s);break;case 18:e.writeOperatorAR(a,2*s);break;case 19:e.writeOperatorDR(a,2*s);break;case 20:e.writeOperatorMult(a,s);break;case 21:e.writeOperatorRR(a,s);break;case 22:e.writeOperatorSL(a,s)}}applyPSGEffect(e,t,n,a){switch(a){case Po.GB:17===t?e.writeWavetableSelect(n):18===t&&e.writeDutyRegister(3&n);break;case Po.NES:18===t&&e.writeDutyRegister(n>>6&3)}}applyWavetableEffect(e,t,n,a){switch(a){case Po.PCE:18===t&&e.writeWavetableSelect(n);break;case Po.SCC:case Po.N163:case Po.NAMCO:16===t&&e.writeWavetableSelect(n);break;case Po.FDS:break;case Po.SWAN:case Po.SM8521:case Po.BUBBLE:case Po.X1_010:16!==t&&17!==t||e.writeWavetableSelect(n)}}applyC64Effect(e,t,n){16!==t&&18!==t||e.writeDutyRegister(n)}updateDexedParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateOBXdParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateComplexSynthParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateBuzzmachineParameters(e,t){this.instruments.forEach((n,a)=>{const[s]=a.split("-");s===String(e)&&n&&"function"==typeof n.setParameter&&Object.entries(t.parameters).forEach(([e,t])=>{n.setParameter(Number(e),t)})})}async updateTB303Pedalboard(e,t){if(!t)return;const n=[];if(this.instruments.forEach((t,a)=>{a.startsWith(`${e}-`)&&t instanceof dr&&n.push(t)}),0===n.length)return;const a=t.enabled&&t.chain.some(e=>e.enabled&&"neural"===e.type);for(const r of n)if(a){const e=t.chain.find(e=>e.enabled&&"neural"===e.type);if(e&&void 0!==e.modelIndex)try{await r.loadGuitarMLModel(e.modelIndex),await r.setGuitarMLEnabled(!0),void 0!==e.parameters?.dryWet&&r.setGuitarMLMix(e.parameters.dryWet)}catch(s){}}else try{await r.setGuitarMLEnabled(!1)}catch(s){}}updateChipSynthArpeggio(e,t){t&&this.instruments.forEach((n,a)=>{a.startsWith(`${e}-`)&&n.updateArpeggio&&n.updateArpeggio(t)})}getChipSynthArpeggioStep(e){for(const[t,n]of this.instruments.entries())if(t.startsWith(`${e}-`)&&n.getCurrentArpeggioStep)return n.getCurrentArpeggioStep();return 0}isChipSynthArpeggioPlaying(e){for(const[t,n]of this.instruments.entries())if(t.startsWith(`${e}-`)&&n.isArpeggioPlaying)return n.isArpeggioPlaying();return!1}initMetronome(){this.metronomeSynth||(this.metronomeSynth=new ae({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}),this.metronomeVolume=new p(.5),this.metronomeSynth.connect(this.metronomeVolume),this.metronomeVolume.connect(this.masterChannel))}setMetronomeEnabled(e){this.metronomeEnabled=e,e&&this.initMetronome()}isMetronomeEnabled(){return this.metronomeEnabled}setMetronomeVolume(e){this.metronomeVolume||this.initMetronome();const t=Math.max(0,Math.min(1,e/100));this.metronomeVolume?.set({gain:t})}triggerMetronomeClick(e,t=!1){if(!this.metronomeEnabled||!this.metronomeSynth)return;const n=t?"C5":"C4",a=t?.8:.5;this.metronomeSynth.triggerAttackRelease(n,"32n",e,a)}stopMetronome(){this.metronomePart&&(this.metronomePart.stop(),this.metronomePart.dispose(),this.metronomePart=null)}disposeMetronome(){this.stopMetronome(),this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.metronomeVolume&&(this.metronomeVolume.dispose(),this.metronomeVolume=null)}dispose(){this.stop(),this.clearSchedule(),this.disposeMetronome(),this.disposeAllInstrumentAnalysers(),this.instrumentEffectChains.forEach((e,t)=>{e.effects.forEach(e=>{try{e.dispose()}catch(t){}});try{e.output.dispose()}catch(n){}}),this.instrumentEffectChains.clear(),this.instrumentEffectNodes.clear(),this.instruments.forEach((e,t)=>{try{e.dispose()}catch(n){}}),this.instruments.clear(),this.disposeChannelOutputs(),this.masterEffectsNodes.forEach(e=>{try{e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.analyser.dispose(),this.fft.dispose(),this.amigaFilter.dispose(),this.synthBus.dispose(),this.masterEffectsInput.dispose(),this.masterInput.dispose(),this.masterChannel.dispose(),Km.instance=null}async buildInstrumentEffectChain(e,t,n){const a=this.instrumentEffectChains.get(e);if(a){for(const[e,t]of this.instrumentEffectNodes)a.effects.includes(t.node)&&this.instrumentEffectNodes.delete(e);if(a.effects.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),a.bridge)try{a.bridge.disconnect(),a.bridge.dispose()}catch{}a.output.disconnect(),a.output.dispose()}const s=new p(1),r=Xa(n),o=e=>{r?this.connectNativeSynth(n.output,e):n.connect(e)},i=t.filter(e=>e.enabled);if(0===i.length){o(s);const[t]=String(e).split("-"),n=parseInt(t),a=this.instrumentAnalysers.get(n);return a?s.connect(a.input):s.connect(r?this.synthBus:this.masterInput),void this.instrumentEffectChains.set(e,{effects:[],output:s})}const l=await Promise.all(i.map(e=>Dm.createEffect(e)));let c;if(l.length>0){r?(c=new p(1),o(c),c.connect(l[0])):n.connect(l[0]);for(let e=0;e<l.length-1;e++)l[e].connect(l[e+1]);l[l.length-1].connect(s)}else o(s);const[d]=String(e).split("-"),u=parseInt(d),h=this.instrumentAnalysers.get(u);h?s.connect(h.input):s.connect(r?this.synthBus:this.masterInput),this.instrumentEffectChains.set(e,{effects:l,output:s,bridge:c}),i.forEach((e,t)=>{this.instrumentEffectNodes.set(e.id,{node:l[t],config:e})})}async rebuildInstrumentEffects(e,t){const n=this.getInstrumentKey(e,-1),a=this.instruments.get(n);if(a){try{Xa(a)?a.output.disconnect():a.disconnect()}catch(s){}await this.buildInstrumentEffectChain(n,t,a)}}throwInstrumentToEffect(e,t,n=1,a=0){const s=[];this.instrumentEffectChains.forEach((t,n)=>{const[a]=String(n).split("-");a===String(e)&&s.push(t)}),0!==s.length&&s.forEach(e=>{const s=e.effects.find(e=>e._fxType===t);if(s&&s.wet){const e=s.wet,t=be();e.cancelScheduledValues(t),e.rampTo(n,.01,t),a>0&&e.rampTo(0,.1,t+a/1e3)}})}disposeInstrumentEffectChain(e){const t=this.instrumentEffectChains.get(e);if(t){t.effects.forEach(e=>{try{e.dispose()}catch{}});try{t.output.dispose()}catch{}this.instrumentEffectChains.delete(e)}}async rebuildMasterEffects(e){const t=JSON.parse(JSON.stringify(e));this.masterEffectsInput.disconnect(),this.masterEffectsNodes.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear();const n=t.filter(e=>e.enabled);if(0===n.length)return void this.masterEffectsInput.connect(this.masterChannel);(await Promise.all(n.map(e=>Dm.createEffect(e)))).forEach((e,t)=>{this.masterEffectsNodes.push(e),this.masterEffectConfigs.set(n[t].id,{node:e,config:n[t]})}),this.masterEffectsInput.connect(this.masterEffectsNodes[0]);for(let a=0;a<this.masterEffectsNodes.length-1;a++)this.masterEffectsNodes[a].connect(this.masterEffectsNodes[a+1]);this.masterEffectsNodes[this.masterEffectsNodes.length-1].connect(this.masterChannel)}updateMasterEffectParams(e,t){const n=this.masterEffectConfigs.get(e);if(!n)return;const{node:a}=n,s=t.wet/100;try{"wet"in a&&a.wet instanceof _&&(a.wet.value=s),this.applyEffectParameters(a,t),n.config=t}catch(r){}}updateInstrumentEffectParams(e,t){const n=this.instrumentEffectNodes.get(e);if(!n)return;const{node:a}=n,s=t.wet/100;try{"wet"in a&&a.wet instanceof _&&(a.wet.value=s),this.applyEffectParameters(a,t),n.config=t}catch(r){}}applyEffectParameters(e,t){const n=t.parameters;switch(t.type){case"Distortion":e instanceof v&&(e.distortion=n.drive??.4,e.oversample=n.oversample??"none");break;case"Reverb":break;case"Delay":case"FeedbackDelay":e instanceof T&&(e.delayTime.value=n.time??.25,e.feedback.value=n.feedback??.5);break;case"Chorus":e instanceof q&&(e.frequency.value=n.frequency??1.5,e.depth=n.depth??.7);break;case"Phaser":e instanceof w&&(e.frequency.value=n.frequency??.5,e.octaves=n.octaves??3);break;case"Tremolo":e instanceof $&&(e.frequency.value=n.frequency??10,e.depth.value=n.depth??.5);break;case"Vibrato":e instanceof H&&(e.frequency.value=n.frequency??5,e.depth.value=n.depth??.1);break;case"BitCrusher":e instanceof U&&(e.bits.value=n.bits??4);break;case"PingPongDelay":e instanceof B&&(e.delayTime.value=n.time??.25,e.feedback.value=n.feedback??.5);break;case"PitchShift":e instanceof L&&(e.pitch=n.pitch??0);break;case"Compressor":e instanceof S&&(e.threshold.value=n.threshold??-24,e.ratio.value=n.ratio??12,e.attack.value=n.attack??.003,e.release.value=n.release??.25);break;case"EQ3":e instanceof f&&(e.low.value=n.low??0,e.mid.value=n.mid??0,e.high.value=n.high??0);break;case"Filter":e instanceof m&&(e.frequency.value=n.frequency??350,e.Q.value=n.Q??1);break;case"AutoFilter":e instanceof K&&(e.frequency.value=n.frequency??1,e.baseFrequency=n.baseFrequency??200,e.octaves=n.octaves??2.6);break;case"AutoPanner":e instanceof W&&(e.frequency.value=n.frequency??1,e.depth.value=n.depth??1);break;case"StereoWidener":e instanceof R&&(e.width.value=n.width??.5);break;case"SpaceyDelayer":e instanceof qr&&(null!=n.firstTap&&e.setFirstTap(Number(n.firstTap)),null!=n.tapSize&&e.setTapSize(Number(n.tapSize)),null!=n.feedback&&e.setFeedback(Number(n.feedback)),null!=n.multiTap&&e.setMultiTap(Number(n.multiTap)),null!=n.tapeFilter&&e.setTapeFilter(Number(n.tapeFilter)));break;case"RETapeEcho":e instanceof Jr&&(null!=n.mode&&e.setMode(Number(n.mode)),null!=n.repeatRate&&e.setRepeatRate(Number(n.repeatRate)),null!=n.intensity&&e.setIntensity(Number(n.intensity)),null!=n.echoVolume&&e.setEchoVolume(Number(n.echoVolume)),null!=n.wow&&e.setWow(Number(n.wow)),null!=n.flutter&&e.setFlutter(Number(n.flutter)),null!=n.dirt&&e.setDirt(Number(n.dirt)),null!=n.inputBleed&&e.setInputBleed(Number(n.inputBleed)),null!=n.loopAmount&&e.setLoopAmount(Number(n.loopAmount)),null!=n.playheadFilter&&e.setPlayheadFilter(Number(n.playheadFilter)));break;case"SpaceEcho":e instanceof Gr&&(null!=n.mode&&e.setMode(Number(n.mode)),null!=n.rate&&e.setRate(Number(n.rate)),null!=n.intensity&&e.setIntensity(Number(n.intensity)),null!=n.echoVolume&&e.setEchoVolume(Number(n.echoVolume)),null!=n.reverbVolume&&e.setReverbVolume(Number(n.reverbVolume)),null!=n.bass&&e.setBass(Number(n.bass)),null!=n.treble&&e.setTreble(Number(n.treble)));break;case"BiPhase":e instanceof eo&&(null!=n.rateA&&(e.rateA=Number(n.rateA)),null!=n.depthA&&(e.depthA=Number(n.depthA)),null!=n.rateB&&(e.rateB=Number(n.rateB)),null!=n.depthB&&(e.depthB=Number(n.depthB)),null!=n.feedback&&(e.feedback=Number(n.feedback)));break;case"DubFilter":e instanceof to&&(null!=n.cutoff&&(e.cutoff=Number(n.cutoff)),null!=n.resonance&&(e.resonance=Number(n.resonance)),null!=n.gain&&(e.gain=Number(n.gain)));break;case"MoogFilter":e instanceof so&&(null!=n.cutoff&&e.setCutoff(Number(n.cutoff)),null!=n.resonance&&e.setResonance(Number(n.resonance)),null!=n.drive&&e.setDrive(Number(n.drive)),null!=n.model&&e.setModel(Number(n.model)),null!=n.filterMode&&e.setFilterMode(Number(n.filterMode)));break;case"MVerb":e instanceof io&&(null!=n.damping&&e.setDamping(Number(n.damping)),null!=n.density&&e.setDensity(Number(n.density)),null!=n.bandwidth&&e.setBandwidth(Number(n.bandwidth)),null!=n.decay&&e.setDecay(Number(n.decay)),null!=n.predelay&&e.setPredelay(Number(n.predelay)),null!=n.size&&e.setSize(Number(n.size)),null!=n.gain&&e.setGain(Number(n.gain)),null!=n.mix&&e.setMix(Number(n.mix)),null!=n.earlyMix&&e.setEarlyMix(Number(n.earlyMix)));break;case"Leslie":e instanceof ho&&(null!=n.speed&&e.setSpeed(Number(n.speed)),null!=n.hornRate&&e.setHornRate(Number(n.hornRate)),null!=n.drumRate&&e.setDrumRate(Number(n.drumRate)),null!=n.hornDepth&&e.setHornDepth(Number(n.hornDepth)),null!=n.drumDepth&&e.setDrumDepth(Number(n.drumDepth)),null!=n.doppler&&e.setDoppler(Number(n.doppler)),null!=n.mix&&e.setMix(Number(n.mix)),null!=n.width&&e.setWidth(Number(n.width)),null!=n.acceleration&&e.setAcceleration(Number(n.acceleration)));break;case"SpringReverb":e instanceof yo&&(null!=n.decay&&e.setDecay(Number(n.decay)),null!=n.damping&&e.setDamping(Number(n.damping)),null!=n.tension&&e.setTension(Number(n.tension)),null!=n.mix&&e.setSpringMix(Number(n.mix)),null!=n.drip&&e.setDrip(Number(n.drip)),null!=n.diffusion&&e.setDiffusion(Number(n.diffusion)))}}updateBpmSyncedEffects(e){this.masterEffectConfigs.forEach(({node:t,config:n})=>{if(!Mo(n.parameters))return;const a=ko[n.type];if(!a)return;const s=No(n.parameters);for(const r of a){const a=So(e,s,r.unit);this.applyBpmSyncedParam(t,n.type,r.param,a)}});try{const{useInstrumentStore:t}=require("../stores/useInstrumentStore"),n=t.getState().instruments;this.instrumentEffectChains.forEach((t,a)=>{const s="number"==typeof a?a:Number(String(a).split("-")[0]),r=n.find(e=>e.id===s);if(!r?.effects)return;r.effects.filter(e=>e.enabled).forEach((n,a)=>{if(a>=t.effects.length)return;if(!Mo(n.parameters))return;const s=ko[n.type];if(!s)return;const r=No(n.parameters),o=t.effects[a];for(const t of s){const a=So(e,r,t.unit);this.applyBpmSyncedParam(o,n.type,t.param,a)}})})}catch{}}applyBpmSyncedParam(e,t,n,a){try{switch(t){case"Delay":case"FeedbackDelay":"time"===n&&e instanceof T&&e.delayTime.rampTo(a,.02);break;case"PingPongDelay":"time"===n&&e instanceof B&&e.delayTime.rampTo(a,.02);break;case"SpaceEcho":"rate"===n&&e instanceof Gr&&e.setRate(a);break;case"SpaceyDelayer":"firstTap"===n&&e instanceof qr&&e.setFirstTap(a);break;case"RETapeEcho":"repeatRate"===n&&e instanceof Jr&&e.setRepeatRate(a);break;case"Chorus":"frequency"===n&&e instanceof q&&e.frequency.rampTo(a,.02);break;case"BiPhase":"rateA"===n&&e instanceof eo&&(e.rateA=a)}}catch(s){}}getChannelOutput(e){if(!this.channelOutputs.has(e)){const t=new p(1),n=new fe({volume:0,pan:0}),a=new M({smoothing:.8});t.connect(n),n.connect(a),n.connect(this.masterInput),this.channelOutputs.set(e,{input:t,channel:n,meter:a})}return this.channelOutputs.get(e).input}createVoice(e,t,n,a){const s=this.channelOutputs.get(e);if(!s)throw new Error(`Channel ${e} not initialized`);const r=new p(1);let o;if("IT"===a.metadata?.importedFrom&&Km.itFilterWorkletLoaded){const e=this._nativeContext;o=new AudioWorkletNode(e,"it-filter-processor")}else o=new m({type:"lowpass",frequency:2e4,Q:0,rolloff:-12});const i=new de(0);o instanceof m?(r.connect(o),o.connect(i)):(r.connect(o),x(o,i)),i.connect(s.input);const l=a.metadata?.envelopes?.[a.id],c=new Bm,d=new Bm,u=new Bm;return l?.volumeEnvelope&&c.init(l.volumeEnvelope),l?.panningEnvelope&&d.init(l.panningEnvelope),l?.pitchEnvelope&&u.init(l.pitchEnvelope),{instrument:t,note:n,volumeEnv:c,panningEnv:d,pitchEnv:u,fadeout:65536,fadeoutStep:a.metadata?.modPlayback?.fadeout||0,isKeyOff:!1,isFilterEnvelope:"filter"===l?.pitchEnvelope?.type,lastCutoff:127,lastResonance:0,nodes:{gain:r,filter:o,panner:i}}}stopVoice(e,t){e.instrument.stop?e.instrument.stop(t):e.instrument.triggerRelease&&e.instrument.triggerRelease(t),setTimeout(()=>{e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()},100)}setChannelVolume(e,t){const n=this.activeVoices.get(e);if(n&&n.length>0){const e=Q(),a=t<=-60?0:Math.pow(10,t/20);for(const t of n)t.nodes.gain&&t.nodes.gain.gain.setValueAtTime(a,e)}this.channelOutputs.get(e)}setChannelFilterCutoff(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1];a.lastCutoff=t;const s=a.lastResonance,r=a.nodes.filter,o=Q();if(t>=127&&0===s||255===t)r instanceof m?(r.frequency.setValueAtTime(24e3,o),r.Q.setValueAtTime(0,o)):r instanceof AudioWorkletNode&&(r.parameters.get("cutoff")?.setValueAtTime(127,o),r.parameters.get("resonance")?.setValueAtTime(0,o));else if(r instanceof m){const e=100*Math.pow(100,t/127);r.frequency.setValueAtTime(e,o)}else r instanceof AudioWorkletNode&&r.parameters.get("cutoff")?.setValueAtTime(t,o)}setChannelFilterResonance(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1];a.lastResonance=t;const s=a.lastCutoff,r=a.nodes.filter,o=Q();if(r instanceof m){const e=t/127*(t/127)*25;r.Q.setValueAtTime(e,o)}else r instanceof AudioWorkletNode&&r.parameters.get("resonance")?.setValueAtTime(t,o);t>0&&s>=127&&this.setChannelFilterCutoff(e,s)}setChannelPan(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=(t??0)/100;n[n.length-1].nodes.panner.pan.setValueAtTime(a,Q())}setChannelFunkRepeat(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const a=n[n.length-1].instrument;if(a instanceof ie&&a.loop){if(0===t)return;if(a.buffer.loaded){const e=a._originalLoopStart??a.loopStart;void 0===a._originalLoopStart&&(a._originalLoopStart=a.loopStart);const n=t/128*(a.loopEnd-e);a.loopStart=e+n}}}handlePastNoteAction(e,t){const n=this.activeVoices.get(e);if(!n||n.length<=1)return;const a=n.slice(0,n.length-1),s=n[n.length-1];0===t?(a.forEach(e=>this.stopVoice(e,Q())),this.activeVoices.set(e,[s])):2===t?a.forEach(e=>e.volumeEnv.keyOff()):3===t&&a.forEach(e=>{e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024)})}setChannelPitch(e,t){const n=this.channelPitchState.get(e);if(!n)return;n.currentPitchMult=t;const a=this.activeVoices.get(e);if(!a||0===a.length){const e=this.instruments.get(n.instrumentKey);if(!e)return;return void this.applyPitchToNode(e,t,n.basePlaybackRate,n.instrumentKey)}const s=a[a.length-1];this.applyPitchToNode(s.instrument,t,n.basePlaybackRate,n.instrumentKey)}applyPitchToNode(e,t,n,a){const s=this.instrumentSynthTypes.get(a),r=1200*Math.log2(t);e instanceof ie||e instanceof le?e.playbackRate=n*t:"Sampler"===s?void 0!==e.detune&&(e.detune.value=r):void 0!==e.detune&&e.detune instanceof _?e.detune.value=r:void 0!==e.oscillator?.detune?e.oscillator.detune.value=r:void 0!==e.detune&&(e.detune=r)}setChannelFrequency(e,t){const n=this.channelPitchState.get(e);if(!n||0===n.baseFrequency)return;const a=t/n.baseFrequency;this.setChannelPitch(e,a)}initChannelPitch(e,t,n,a=1){this.channelPitchState.set(e,{instrumentKey:t,basePlaybackRate:a,baseFrequency:n,currentPitchMult:1})}clearChannelPitch(e){this.channelPitchState.get(e)&&(this.setChannelPitch(e,1),this.channelPitchState.delete(e))}setChannelMute(e,t){this.channelOutputs.has(e)||this.getChannelOutput(e);const n=this.channelOutputs.get(e);n&&(n.channel.mute=t)}updateMuteStates(e){const t=e.some(e=>e.solo);e.forEach((e,n)=>{const a=t?!e.solo:e.muted;this.channelMuteStates.set(n,a),this.setChannelMute(n,a)})}isChannelMuted(e){return this.channelMuteStates.get(e)??!1}disposeChannelOutputs(){this.channelOutputs.forEach((e,t)=>{try{e.meter.dispose()}catch(n){}try{e.channel.dispose()}catch(n){}try{e.input.dispose()}catch(n){}}),this.channelOutputs.clear()}getChannelLevels(e){const t=[];for(let n=0;n<e;n++){const e=this.channelOutputs.get(n);if(e){const n=e.meter.getValue(),a=Math.max(0,Math.min(1,(n+60)/60));t.push(a)}else t.push(0)}return t}channelTriggerLevels=new Map;triggerLevelsCache=[];triggerChannelMeter(e,t){this.channelTriggerLevels.set(e,Math.min(1,1.2*t))}getChannelTriggerLevels(e){this.triggerLevelsCache.length!==e&&(this.triggerLevelsCache=new Array(e).fill(0));for(let t=0;t<e;t++){const e=this.channelTriggerLevels.get(t)||0;this.triggerLevelsCache[t]=e,e>0&&this.channelTriggerLevels.set(t,0)}return this.triggerLevelsCache}getWaveform(){return this.analyser.getValue()}getFFT(){return this.fft.getValue()}currentPerformanceQuality="high";setPerformanceQuality(e){if(this.currentPerformanceQuality===e)return;this.currentPerformanceQuality=e,this.instruments.forEach((t,n)=>{t instanceof dr&&t.setQuality(e)});const t=[];this.instruments.forEach((e,n)=>{if(e&&"object"==typeof e&&"maxPolyphony"in e){const e=n.split("-"),a=parseInt(e[0],10),s="-1"===e[1]?void 0:parseInt(e[1],10),r=this.instrumentSynthTypes.get(n);r&&["Synth","FMSynth","AMSynth","PluckSynth"].includes(r)&&t.push({key:n,instrumentId:a,channelIndex:s,config:{synthType:r}})}}),t.length>0&&t.forEach(({key:e})=>{const t=this.instruments.get(e);if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(n){}this.instruments.delete(e),this.instrumentSynthTypes.delete(e)})}updateChannelEnvelopes(e){const t=this.activeVoices.get(e),n=this.channelOutputs.get(e);if(!t||0===t.length||!n)return;const a=Q(),s=n.channel.pan.value;let r=0;const o=t.length;for(let i=0;i<o;i++){const e=t[i],n=e.volumeEnv.tickNext();e.isKeyOff&&e.fadeout>0&&(e.fadeout=Math.max(0,e.fadeout-e.fadeoutStep));const o=n/64*(e.fadeout/65536);e.nodes.gain.gain.setValueAtTime(o,a);const l=e.panningEnv.tickNext();if(32!==l){const t=(l-32)/32,n=Math.max(-1,Math.min(1,s+t));e.nodes.panner.pan.setValueAtTime(n,a)}const c=e.pitchEnv.tickNext();if(e.pitchEnv.isEnabled())if(e.isFilterEnvelope){const t=e.lastCutoff,n=c-32,s=Math.max(0,Math.min(127,t+n));if(e.nodes.filter instanceof m){const t=Km.FILTER_CUTOFF_LUT[s];e.nodes.filter.frequency.setValueAtTime(t,a)}else e.nodes.filter instanceof AudioWorkletNode&&e.nodes.filter.parameters.get("cutoff")?.setValueAtTime(s,a)}else{const t=(c-32)/32*12;void 0!==e.instrument.detune&&(e.instrument.detune.value=100*t)}e.isKeyOff&&e.fadeout<=0||e.volumeEnv.isFinished()&&e.isKeyOff?(e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()):t[r++]=e}r>0?t.length=r:this.activeVoices.delete(e)}setChannelKeyOff(e){const t=this.activeVoices.get(e);t&&t.forEach(e=>{e.isKeyOff=!0,e.volumeEnv.keyOff(),e.panningEnv.keyOff(),e.pitchEnv.keyOff()})}getPerformanceQuality(){return this.currentPerformanceQuality}}const Hm=()=>Km.getInstance(),$m=Object.freeze(Object.defineProperty({__proto__:null,ToneEngine:Km,getToneEngine:Hm},Symbol.toStringTag,{value:"Module"}));let qm=0;const Ym={generate:(e="id")=>(qm++,`${e}-${qm}-${Date.now()}`),reset(){qm=0}},Xm=16,Qm=31,Zm=(e,t)=>0!==(e&t),Jm=(e,t)=>e^t,ef=(e=64,t=4)=>({id:Ym.generate("pattern"),name:"Untitled Pattern",length:e,channels:Array.from({length:t},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,rows:Array.from({length:e},()=>({...aa})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}),tf=a()(Rn((e,t)=>({patterns:[ef()],currentPatternIndex:0,cursor:{channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},selection:null,clipboard:null,trackClipboard:null,followPlayback:!1,showGhostPatterns:!0,columnVisibility:{...na},copyMask:Qm,pasteMask:Qm,transposeMask:1,macroSlots:Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),insertMode:!1,currentOctave:4,recordMode:!1,editStep:1,multiRecEnabled:!1,multiEditEnabled:!1,multiRecChannels:Array(16).fill(!0),multiKeyJazz:!1,recQuantEnabled:!1,recQuantRes:16,recReleaseEnabled:!1,keyOnTab:Array(16).fill(0),keyOffTime:Array(16).fill(0),keyOffCounter:0,ptnJumpPos:[0,0,0,0],patternOrder:[0],currentPositionIndex:0,originalModuleData:null,setCurrentPattern:t=>e(e=>{t>=0&&t<e.patterns.length&&(e.currentPatternIndex=t)}),moveCursor:t=>e(e=>{const n=e.patterns[e.currentPatternIndex],a=n.channels.length,s=n.length,r=e.cursor.rowIndex,o=e.cursor.channelIndex,i=e.cursor.columnType,l=e.cursor.digitIndex,c={instrument:2,volume:2,effTyp:1,effParam:2,effTyp2:1,effParam2:2,cutoff:2,resonance:2,envMod:2,pan:2,probability:2},d=c[e.cursor.columnType]||0;switch(t){case"up":e.cursor.rowIndex>0?e.cursor.rowIndex--:e.cursor.rowIndex=s-1;break;case"down":e.cursor.rowIndex<s-1?e.cursor.rowIndex++:e.cursor.rowIndex=0;break;case"left":{if(d>0&&e.cursor.digitIndex>0){e.cursor.digitIndex--;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],n=t.indexOf(e.cursor.columnType);if(-1===n){e.cursor.columnType="note",e.cursor.digitIndex=0;break}if(n>0){e.cursor.columnType=t[n-1];const a=c[e.cursor.columnType]||0;e.cursor.digitIndex=a>0?a-1:0}else{e.cursor.channelIndex>0?e.cursor.channelIndex--:e.cursor.channelIndex=a-1,e.cursor.columnType=t[t.length-1];const n=c[e.cursor.columnType]||0;e.cursor.digitIndex=n>0?n-1:0}break}case"right":{if(d>0&&e.cursor.digitIndex<d-1){e.cursor.digitIndex++;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],n=t.indexOf(e.cursor.columnType);if(-1===n){e.cursor.columnType="note",e.cursor.digitIndex=0;break}n<t.length-1?(e.cursor.columnType=t[n+1],e.cursor.digitIndex=0):(e.cursor.channelIndex<a-1?e.cursor.channelIndex++:e.cursor.channelIndex=0,e.cursor.columnType="note",e.cursor.digitIndex=0);break}}if(e.cursor.rowIndex===r&&e.cursor.channelIndex===o&&e.cursor.columnType===i&&e.cursor.digitIndex===l)return e}),moveCursorToRow:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.length&&(e.cursor.rowIndex=t)}),moveCursorToChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&(e.cursor.channelIndex=t)}),moveCursorToColumn:t=>e(e=>{e.cursor.columnType=t,e.cursor.digitIndex=0}),setCell:(t,n,a)=>e(e=>{const s=e.patterns[e.currentPatternIndex];t>=0&&t<s.channels.length&&n>=0&&n<s.length&&Object.assign(s.channels[t].rows[n],a)}),clearCell:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&n>=0&&n<a.length&&(a.channels[t].rows[n]={...aa})}),clearChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&(n.channels[t].rows=n.channels[t].rows.map(()=>({...aa})))}),clearPattern:()=>e(e=>{e.patterns[e.currentPatternIndex].channels.forEach(e=>{e.rows=e.rows.map(()=>({...aa}))})}),insertRow:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length&&n>=0&&n<a.length){const e=a.channels[t].rows;for(let t=a.length-1;t>n;t--)e[t]={...e[t-1]};e[n]={...aa}}}),deleteRow:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length&&n>=0&&n<a.length){const e=a.channels[t].rows;for(let t=n;t<a.length-1;t++)e[t]={...e[t+1]};e[a.length-1]={...aa}}}),setFollowPlayback:t=>e(e=>{e.followPlayback=t}),setShowGhostPatterns:t=>e(e=>{e.showGhostPatterns=t}),setColumnVisibility:t=>e(e=>{Object.assign(e.columnVisibility,t)}),setCopyMask:t=>e(e=>{e.copyMask=t&Qm}),setPasteMask:t=>e(e=>{e.pasteMask=t&Qm}),setTransposeMask:t=>e(e=>{e.transposeMask=t&Qm}),toggleMaskBit:(t,n)=>e(e=>{"copy"===t?e.copyMask=Jm(e.copyMask,n):"paste"===t?e.pasteMask=Jm(e.pasteMask,n):"transpose"===t&&(e.transposeMask=Jm(e.transposeMask,n))}),setCurrentOctave:t=>e(e=>{e.currentOctave=Math.max(1,Math.min(7,t))}),toggleRecordMode:()=>e(e=>{e.recordMode=!e.recordMode}),setEditStep:t=>e(e=>{e.editStep=Math.max(0,Math.min(16,t))}),toggleInsertMode:()=>e(e=>{e.insertMode=!e.insertMode}),setMultiRecEnabled:t=>e(e=>{e.multiRecEnabled=t}),setMultiEditEnabled:t=>e(e=>{e.multiEditEnabled=t}),toggleMultiRecChannel:t=>e(e=>{t>=0&&t<e.multiRecChannels.length&&(e.multiRecChannels[t]=!e.multiRecChannels[t])}),setMultiKeyJazz:t=>e(e=>{e.multiKeyJazz=t}),setRecQuantEnabled:t=>e(e=>{e.recQuantEnabled=t}),setRecQuantRes:t=>e(e=>{[1,2,4,8,16].includes(t)&&(e.recQuantRes=t)}),setRecReleaseEnabled:t=>e(e=>{e.recReleaseEnabled=t}),setKeyOn:(t,n)=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOnTab[t]=n)}),setKeyOff:t=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOffCounter++,e.keyOnTab[t]=0,e.keyOffTime[t]=e.keyOffCounter)}),findBestChannel:()=>{const e=t(),n=e.patterns[e.currentPatternIndex],a=n?.channels.length||1;if(!e.multiRecEnabled&&!e.multiEditEnabled)return e.cursor.channelIndex;let s=e.cursor.channelIndex,r=1/0;for(let t=0;t<a;t++)e.multiRecChannels[t]&&0===e.keyOnTab[t]&&e.keyOffTime[t]<r&&(s=t,r=e.keyOffTime[t]);return s},resetKeyTracking:()=>e(e=>{e.keyOnTab=e.keyOnTab.map(()=>0),e.keyOffTime=e.keyOffTime.map(()=>0),e.keyOffCounter=0}),setPtnJumpPos:(t,n)=>e(e=>{t>=0&&t<4&&(e.ptnJumpPos[t]=n)}),getPtnJumpPos:e=>{const n=t();return e>=0&&e<4?n.ptnJumpPos[e]:0},startSelection:()=>e(e=>{e.selection={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,columnTypes:[e.cursor.columnType]}}),updateSelection:(t,n)=>e(e=>{e.selection&&(e.selection.endChannel=t,e.selection.endRow=n)}),endSelection:()=>e(e=>{e.selection&&(e.selection.endChannel=e.cursor.channelIndex,e.selection.endRow=e.cursor.rowIndex)}),clearSelection:()=>e(e=>{e.selection=null}),selectColumn:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:a.length-1,columnTypes:[n]}}),selectChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:n.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),selectPattern:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];e.selection={startChannel:0,endChannel:t.channels.length-1,startRow:0,endRow:t.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),copySelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r),d=[];for(let u=o;u<=i;u++){const e=[];for(let n=l;n<=c;n++)e.push({...t.channels[u].rows[n]});d.push(e)}e.clipboard={channels:i-o+1,rows:c-l+1,data:d}}),cutSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r),d=[];for(let u=o;u<=i;u++){const e=[];for(let n=l;n<=c;n++)e.push({...t.channels[u].rows[n]}),t.channels[u].rows[n]={...aa};d.push(e)}e.clipboard={channels:i-o+1,rows:c-l+1,data:d},e.selection=null}),paste:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let o=0;o<s.length;o++){const e=n+o;if(e>=t.channels.length)break;for(let n=0;n<s[o].length;n++){const i=a+n;if(i>=t.length)break;const l=s[o][n],c=t.channels[e].rows[i];Zm(r,1)&&(c.note=l.note),Zm(r,2)&&(c.instrument=l.instrument),Zm(r,4)&&(c.volume=l.volume),Zm(r,8)&&(c.effTyp=l.effTyp,c.eff=l.eff),Zm(r,Xm)&&(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteMix:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let o=0;o<s.length;o++){const e=n+o;if(e>=t.channels.length)break;for(let n=0;n<s[o].length;n++){const i=a+n;if(i>=t.length)break;const l=s[o][n],c=t.channels[e].rows[i];Zm(r,1)&&0!==l.note&&0===c.note&&(c.note=l.note),Zm(r,2)&&0!==l.instrument&&0===c.instrument&&(c.instrument=l.instrument),Zm(r,4)&&0!==l.volume&&0===c.volume&&(c.volume=l.volume),!Zm(r,8)||0===l.effTyp&&0===l.eff||0!==c.effTyp||0!==c.eff||(c.effTyp=l.effTyp,c.eff=l.eff),!Zm(r,Xm)||0===l.effTyp2&&0===l.eff2||0!==c.effTyp2||0!==c.eff2||(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteFlood:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,o=s[0]?.length||0;if(0!==o)for(let i=0;i<s.length;i++){const e=n+i;if(e>=t.channels.length)break;let l=a;for(;l<t.length;){for(let n=0;n<s[i].length;n++){const a=l+n;if(a>=t.length)break;const o=s[i][n],c=t.channels[e].rows[a];Zm(r,1)&&(c.note=o.note),Zm(r,2)&&(c.instrument=o.instrument),Zm(r,4)&&(c.volume=o.volume),Zm(r,8)&&(c.effTyp=o.effTyp,c.eff=o.eff),Zm(r,Xm)&&(c.effTyp2=o.effTyp2,c.eff2=o.eff2)}l+=o}}}),pastePushForward:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:a}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,o=s[0]?.length||0;if(0!==o)for(let i=0;i<s.length;i++){const e=n+i;if(e>=t.channels.length)break;const l=t.channels[e];for(let n=t.length-1;n>=a+o;n--){const e=n-o;e>=a&&(l.rows[n]={...l.rows[e]})}for(let n=0;n<s[i].length;n++){const e=a+n;if(e>=t.length)break;const o=s[i][n],c=l.rows[e];c.note=0,c.instrument=0,c.volume=0,c.effTyp=0,c.eff=0,c.effTyp2=0,c.eff2=0,Zm(r,1)&&(c.note=o.note),Zm(r,2)&&(c.instrument=o.instrument),Zm(r,4)&&(c.volume=o.volume),Zm(r,8)&&(c.effTyp=o.effTyp,c.eff=o.eff),Zm(r,Xm)&&(c.effTyp2=o.effTyp2,c.eff2=o.eff2)}}}),copyTrack:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t];e.trackClipboard=a.rows.map(e=>({...e}))}),cutTrack:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t];e.trackClipboard=a.rows.map(e=>({...e})),a.rows=a.rows.map(()=>({...aa}))}),pasteTrack:t=>e(e=>{if(!e.trackClipboard)return;const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const a=n.channels[t],{pasteMask:s}=e,r=Math.min(e.trackClipboard.length,n.length);for(let t=0;t<r;t++){const n=e.trackClipboard[t],r=a.rows[t];Zm(s,1)&&(r.note=n.note),Zm(s,2)&&(r.instrument=n.instrument),Zm(s,4)&&(r.volume=n.volume),Zm(s,8)&&(r.effTyp=n.effTyp,r.eff=n.eff),Zm(s,Xm)&&(r.effTyp2=n.effTyp2,r.eff2=n.eff2)}}),writeMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const n=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:s}=e.cursor,r=n.channels[a].rows[s];e.macroSlots[t]={note:r.note,instrument:r.instrument,volume:r.volume,effTyp:r.effTyp,eff:r.eff,effTyp2:r.effTyp2,eff2:r.eff2}}),readMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const n=e.macroSlots[t],a=e.patterns[e.currentPatternIndex],{channelIndex:s,rowIndex:r}=e.cursor,{pasteMask:o}=e;if(e.insertMode){const e=a.channels[s],t={...aa};Zm(o,1)&&0!==n.note&&(t.note=n.note),Zm(o,2)&&0!==n.instrument&&(t.instrument=n.instrument),Zm(o,4)&&0!==n.volume&&(t.volume=n.volume),Zm(o,8)&&(t.effTyp=n.effTyp,t.eff=n.eff),!Zm(o,Xm)||0===n.effTyp2&&0===n.eff2||(t.effTyp2=n.effTyp2,t.eff2=n.eff2),e.rows.splice(r,0,t),e.rows.length>a.length&&e.rows.pop()}else{const e=a.channels[s].rows[r];Zm(o,1)&&0!==n.note&&(e.note=n.note),Zm(o,2)&&0!==n.instrument&&(e.instrument=n.instrument),Zm(o,4)&&0!==n.volume&&(e.volume=n.volume),Zm(o,8)&&(e.effTyp=n.effTyp,e.eff=n.eff),!Zm(o,Xm)||0===n.effTyp2&&0===n.eff2||(e.effTyp2=n.effTyp2,e.eff2=n.eff2)}}),transposeSelection:(t,n=!1)=>e(e=>{const a=e.patterns[e.currentPatternIndex],s=n?e.patterns[e.currentPatternIndex].channels[e.cursor.channelIndex].rows[e.cursor.rowIndex].instrument:null;let r,o,i,l;e.selection?(r=Math.min(e.selection.startChannel,e.selection.endChannel),o=Math.max(e.selection.startChannel,e.selection.endChannel),i=Math.min(e.selection.startRow,e.selection.endRow),l=Math.max(e.selection.startRow,e.selection.endRow)):(r=e.cursor.channelIndex,o=e.cursor.channelIndex,i=e.cursor.rowIndex,l=e.cursor.rowIndex);for(let c=r;c<=o;c++)if(!(c>=a.channels.length))for(let e=i;e<=l;e++){if(e>=a.length)continue;const r=a.channels[c].rows[e];if(!r.note||0===r.note||97===r.note)continue;if(n&&null!==s&&r.instrument!==s)continue;const o=qa(r.note);if(null===o)continue;const i=o+t;i>=12&&i<=107&&(r.note=Ya(i))}}),remapInstrument:(t,n,a)=>e(e=>{const s=(e,a,s,r)=>{const o=void 0!==a?a:0,i=void 0!==a?a:e.channels.length-1,l=void 0!==s?s:0,c=void 0!==r?r:e.length-1;for(let d=o;d<=i;d++)for(let a=l;a<=c;a++)e.channels[d].rows[a]?.instrument===t&&(e.channels[d].rows[a].instrument=n)};if("block"===a&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),n=Math.max(e.selection.startChannel,e.selection.endChannel),a=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let o=t;o<=n;o++)s(e.patterns[e.currentPatternIndex],o,a,r)}else"track"===a?s(e.patterns[e.currentPatternIndex],e.cursor.channelIndex):"pattern"===a?s(e.patterns[e.currentPatternIndex]):"song"===a&&e.patterns.forEach(e=>s(e))}),interpolateSelection:(t,n,a,s="linear")=>e(e=>{if(!e.selection)return;const r=e.patterns[e.currentPatternIndex],{startChannel:o,endChannel:i,startRow:l,endRow:c}=e.selection,d=Math.min(o,i),u=Math.max(o,i),p=Math.min(l,c),h=Math.max(l,c),m=h-p+1;if(m<2)return;const f=e=>{switch(s){case"log":return Math.log(1+9*e)/Math.log(10);case"exp":return(Math.pow(10,e)-1)/9;case"scurve":return e*e*(3-2*e);default:return e}};for(let s=d;s<=u;s++)if(!(s>=r.channels.length))for(let e=p;e<=h;e++){if(e>=r.length)continue;const o=r.channels[s].rows[e],i=f((e-p)/(m-1)),l=Math.round(n+(a-n)*i);"volume"===t?o.volume=Math.max(0,Math.min(64,l)):"cutoff"===t?o.cutoff=Math.max(0,Math.min(127,l)):"resonance"===t?o.resonance=Math.max(0,Math.min(127,l)):"envMod"===t?o.envMod=Math.max(0,Math.min(127,l)):"pan"===t&&(o.pan=Math.max(-100,Math.min(100,l)))}}),humanizeSelection:t=>e(e=>{if(!e.selection)return;const n=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:s,startRow:r,endRow:o}=e.selection,i=Math.min(a,s),l=Math.max(a,s),c=Math.min(r,o),d=Math.max(r,o);for(let u=i;u<=l;u++)if(!(u>=n.channels.length))for(let e=c;e<=d;e++){if(e>=n.length)continue;const a=n.channels[u].rows[e];if(!a.note||0===a.note||97===a.note)continue;const s=a.volume>=16&&a.volume<=80?a.volume-16:48,r=Math.floor(s*(t/100)),o=Math.floor(Math.random()*(2*r+1))-r,i=Math.max(0,Math.min(64,s+o));a.volume=16+i}}),strumSelection:(t,n)=>e(e=>{if(!e.selection)return;const a=e.patterns[e.currentPatternIndex],{startChannel:s,endChannel:r,startRow:o,endRow:i}=e.selection,l=Math.min(s,r),c=Math.max(s,r),d=Math.min(o,i),u=Math.max(o,i);for(let p=d;p<=u;p++)if(!(p>=a.length))for(let e=l;e<=c;e++){if(e>=a.channels.length)continue;const s=a.channels[e].rows[p];if(!s.note||0===s.note||97===s.note)continue;const r="down"===n?e-l:c-e,o=Math.min(15,r*t);o>0&&(s.effTyp=14,s.eff=208+o)}}),legatoSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:a,startRow:s,endRow:r}=e.selection,o=Math.min(n,a),i=Math.max(n,a),l=Math.min(s,r),c=Math.max(s,r);for(let d=o;d<=i;d++){if(d>=t.channels.length)continue;let e=-1;for(let n=l;n<=c;n++){if(n>=t.length)continue;const a=t.channels[d].rows[n];a.note>0&&a.note<97&&(e>=0&&n>e+1&&0===a.effTyp&&(a.effTyp=3,a.eff=255),e=n)}}}),scaleVolume:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];(()=>{const n=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),s=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),o=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=s;e++)for(let t=r;t<=o;t++)e<a.channels.length&&t<a.length&&n.push(a.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<a.channels.length&&n.push(...a.channels[t].rows)}else"pattern"===t&&a.channels.forEach(e=>{n.push(...e.rows)});return n})().forEach(e=>{null!==e.volume&&void 0!==e.volume&&(e.volume=Math.min(64,Math.max(0,Math.round(e.volume*n))))})}),fadeVolume:(t,n,a)=>e(e=>{const s=e.patterns[e.currentPatternIndex],r=(()=>{const n=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),o=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=a;e++)for(let t=r;t<=o;t++)e<s.channels.length&&t<s.length&&n.push(s.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<s.channels.length&&n.push(...s.channels[t].rows)}else"pattern"===t&&s.channels.forEach(e=>{n.push(...e.rows)});return n})(),o=r.length;o<2||r.forEach((e,t)=>{const s=t/(o-1),r=Math.round(n+s*(a-n));e.volume=Math.min(64,Math.max(0,r))})}),addPattern:(t=64)=>e(e=>{const n=e.patterns[0]?.channels.length||4;e.patterns.push(ef(t,n)),"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN ADDED")})}),deletePattern:t=>e(e=>{e.patterns.length>1&&t>=0&&t<e.patterns.length&&(e.patterns.splice(t,1),e.currentPatternIndex>=e.patterns.length&&(e.currentPatternIndex=e.patterns.length-1),"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN DELETED")}))}),clonePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=JSON.parse(JSON.stringify(n));a.id=Ym.generate("pattern"),a.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,a),"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN CLONED")})}}),resizePattern:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>0){const a=e.patterns[t],s=a.length;a.length=n,a.channels.forEach(e=>{if(n>s)for(let t=s;t<n;t++)e.rows.push({...aa});else e.rows.splice(n)})}}),resizeAllPatterns:t=>e(e=>{t>0&&e.patterns.forEach(e=>{const n=e.length;e.length=t,e.channels.forEach(e=>{if(t>n)for(let a=n;a<t;a++)e.rows.push({...aa});else e.rows.splice(t)})})}),duplicatePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=JSON.parse(JSON.stringify(n));a.id=Ym.generate("pattern"),a.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,a),e.currentPatternIndex=t+1}}),expandPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=n.length,s=Math.min(2*a,256);if(s===a)return;n.length=s,n.channels.forEach(e=>{const t=[];for(let n=0;n<a;n++)t.push(e.rows[n]),t.push({...aa});e.rows=t})}}),shrinkPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],a=n.length,s=Math.max(Math.floor(a/2),1);if(s===a)return;n.length=s,n.channels.forEach(e=>{const t=[];for(let n=0;n<s;n++)t.push(e.rows[2*n]);e.rows=t})}}),reorderPatterns:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>=0&&n<e.patterns.length&&t!==n){const[a]=e.patterns.splice(t,1);e.patterns.splice(n,0,a),e.currentPatternIndex===t?e.currentPatternIndex=n:t<e.currentPatternIndex&&n>=e.currentPatternIndex?e.currentPatternIndex--:t>e.currentPatternIndex&&n<=e.currentPatternIndex&&e.currentPatternIndex++}}),updatePatternName:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n.trim()&&(e.patterns[t].name=n.trim())}),addChannel:()=>e(e=>{const t=ta.filter(e=>null!==e),n=t[Math.floor(Math.random()*t.length)];e.patterns.forEach(e=>{if(e.channels.length<16){const t=e.channels.length;e.channels.push({id:Ym.generate("channel"),name:`Channel ${t+1}`,rows:Array.from({length:e.length},()=>({...aa})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:n})}}),"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL ADDED")})}),removeChannel:t=>e(e=>{e.patterns.forEach(e=>{e.channels.length>1&&t>=0&&t<e.channels.length&&e.channels.splice(t,1)}),e.cursor.channelIndex>=e.patterns[0]?.channels.length&&(e.cursor.channelIndex=Math.max(0,e.patterns[0].channels.length-1)),"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL REMOVED")})}),toggleChannelMute:n=>{let a=!1;e(e=>{e.patterns.forEach(e=>{n>=0&&n<e.channels.length&&(e.channels[n].muted=!e.channels[n].muted,a=e.channels[n].muted)})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Hm().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(a?"MUTED":"UNMUTED")})},toggleChannelSolo:n=>{let a=!1;e(e=>{e.patterns.forEach(e=>{if(n>=0&&n<e.channels.length){const t=e.channels[n].solo;e.channels.forEach(e=>{e.solo=!1}),t||(e.channels[n].solo=!0,a=!0)}})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Hm().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&An(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>_y);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(a?"SOLO ON":"SOLO OFF")})},toggleChannelCollapse:t=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].collapsed=!e.channels[t].collapsed)})}),setChannelVolume:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].volume=Math.max(0,Math.min(100,n)))})}),setChannelPan:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].pan=Math.max(-100,Math.min(100,n)))})}),setChannelColor:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].color=n)})}),setChannelRows:(t,n)=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t>=0&&t<a.channels.length){const e=[...n];for(;e.length<a.length;)e.push({...aa});a.channels[t].rows=e.slice(0,a.length)}}),reorderChannel:(t,n)=>e(e=>{e.patterns.forEach(e=>{if(t>=0&&t<e.channels.length&&n>=0&&n<e.channels.length&&t!==n){const[a]=e.channels.splice(t,1);e.channels.splice(n,0,a)}}),e.cursor.channelIndex===t?e.cursor.channelIndex=n:t<e.cursor.channelIndex&&n>=e.cursor.channelIndex?e.cursor.channelIndex--:t>e.cursor.channelIndex&&n<=e.cursor.channelIndex&&e.cursor.channelIndex++}),setChannelRecordGroup:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].recordGroup=n)})}),getChannelsInRecordGroup:e=>{const n=t(),a=n.patterns[n.currentPatternIndex];return a?a.channels.map((t,n)=>t.recordGroup===e?n:-1).filter(e=>e>=0):[]},loadPatterns:t=>e(e=>{if(t.length>0){const n=t.map(e=>({...e,length:Math.max(1,e.length),channels:e.channels.map(e=>({...e,color:e.color??null}))}));e.patterns=n,e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null}}),setPatternOrder:t=>e(e=>{t.length>0&&(e.patternOrder=t,e.currentPositionIndex=0)}),setOriginalModuleData:t=>e(e=>{e.originalModuleData=t}),importPattern:n=>{const a=t().patterns.length;return e(e=>{const t={...n,length:Math.max(1,n.length),channels:n.channels.map(e=>({...e,color:e.color??null}))};e.patterns.push(t)}),a},replacePattern:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(e.patterns[t]=JSON.parse(JSON.stringify(n)))}),addToOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(void 0!==n&&n>=0&&n<=e.patternOrder.length?e.patternOrder.splice(n,0,t):e.patternOrder.push(t))}),removeFromOrder:t=>e(e=>{t>=0&&t<e.patternOrder.length&&e.patternOrder.length>1&&(e.patternOrder.splice(t,1),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1))}),insertInOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n>=0&&n<=e.patternOrder.length&&e.patternOrder.splice(n,0,t)}),duplicatePosition:t=>e(e=>{if(t>=0&&t<e.patternOrder.length){const n=e.patternOrder[t];e.patternOrder.splice(t+1,0,n)}}),clearOrder:()=>e(e=>{e.patternOrder=[0],e.currentPositionIndex=0}),reorderPositions:(t,n)=>e(e=>{if(t>=0&&t<e.patternOrder.length&&n>=0&&n<e.patternOrder.length){const[a]=e.patternOrder.splice(t,1);e.patternOrder.splice(n,0,a),e.currentPositionIndex===t?e.currentPositionIndex=n:t<e.currentPositionIndex&&n>=e.currentPositionIndex?e.currentPositionIndex--:t>e.currentPositionIndex&&n<=e.currentPositionIndex&&e.currentPositionIndex++}}),setCurrentPosition:t=>e(e=>{t>=0&&t<e.patternOrder.length&&(e.currentPositionIndex=t,e.currentPatternIndex=e.patternOrder[t])}),reset:()=>e(e=>{e.patterns=[ef()],e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null,e.trackClipboard=null,e.currentOctave=4,e.recordMode=!1,e.editStep=1,e.insertMode=!1,e.columnVisibility={...na},e.copyMask=Qm,e.pasteMask=Qm,e.transposeMask=1,e.macroSlots=Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),e.patternOrder=[0],e.currentPositionIndex=0})}))),nf=Object.freeze(Object.defineProperty({__proto__:null,MASK_ALL:Qm,MASK_EFFECT:8,MASK_EFFECT2:Xm,MASK_INSTRUMENT:2,MASK_NOTE:1,MASK_VOLUME:4,hasMaskBit:Zm,toggleMaskBit:Jm,useTrackerStore:tf},Symbol.toStringTag,{value:"Module"})),af=[{type:"synth",name:"JC303 Default",synthType:"TB303",tb303:{engineType:"jc303",oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.743,filterSelect:1,diodeCharacter:1,duffingAmount:.03,lpBpMix:0,stageNLAmount:0,ensembleAmount:0,oversamplingOrder:2,filterTracking:0,filterFmDepth:0,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:.1875,feedback:.3,tone:.5,mix:0,stereo:.5}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.65},filterEnvelope:{envMod:.6,decay:.3},accent:{amount:.7},slide:{time:.17,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.82},filterEnvelope:{envMod:.85,decay:.4},accent:{amount:.9},slide:{time:.15,mode:"exponential"}},effects:[],volume:.7,pan:0},{type:"synth",name:"303 Deep Sub",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.15,resonance:.35},filterEnvelope:{envMod:.25,decay:.2},accent:{amount:.45},slide:{time:.3,mode:"exponential"}},effects:[],volume:.8,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:.45,resonance:.68},filterEnvelope:{envMod:.55,decay:.25},accent:{amount:.65},slide:{time:.15,mode:"exponential"}},effects:[],volume:.75,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.75,resonance:.88},filterEnvelope:{envMod:.95,decay:.5},accent:{amount:1},slide:{time:.1,mode:"exponential"}},effects:[{id:"distortion-1",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.6}}],volume:.6,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.8},filterEnvelope:{envMod:.75,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{enabled:!0,normalDecay:.2,accentDecay:.1,vegDecay:.3,vegSustain:.15,softAttack:.05,filterTracking:.6,filterFmDepth:.5,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:.6,pan:0},{type:"synth",name:"Acid RAT",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.75},filterEnvelope:{envMod:.7,decay:.35},accent:{amount:.85},slide:{time:.12,mode:"exponential"}},effects:[{id:"acid-rat-neural",category:"neural",type:"Neural",enabled:!0,wet:60,parameters:{gain:.55},neuralModelIndex:1,neuralModelName:"ProCo RAT"},{id:"acid-rat-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:.6,pan:0},{type:"synth",name:"Acid DS-1",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.7},filterEnvelope:{envMod:.65,decay:.3},accent:{amount:.8},slide:{time:.15,mode:"exponential"}},effects:[{id:"acid-ds1-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.5,oversample:"2x"}},{id:"acid-ds1-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:0,mid:3,high:1}},{id:"acid-ds1-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:.6,pan:0},{type:"synth",name:"Acid Warm",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.6},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.65},slide:{time:.2,mode:"exponential"}},effects:[{id:"acid-warm-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:60,parameters:{drive:.35,tone:8e3}},{id:"acid-warm-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}}],volume:.7,pan:0},{type:"synth",name:"Acid Dub",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.55},filterEnvelope:{envMod:.45,decay:.5},accent:{amount:.6},slide:{time:.25,mode:"exponential"}},effects:[{id:"acid-dub-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:30,parameters:{drive:.2,tone:1e4}},{id:"acid-dub-echo",category:"tonejs",type:"SpaceEcho",enabled:!0,wet:35,parameters:{mode:4,rate:400,intensity:.5,echoVolume:.7,reverbVolume:.2}},{id:"acid-dub-spring",category:"wasm",type:"SpringReverb",enabled:!0,wet:25,parameters:{decay:.6,damping:.5,tension:.4,mix:.5,drip:.3}}],volume:.7,pan:0},{type:"synth",name:"Acid Trance",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.6,resonance:.72},filterEnvelope:{envMod:.75,decay:.4},accent:{amount:.8},slide:{time:.15,mode:"exponential"}},effects:[{id:"acid-trance-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.35}},{id:"acid-trance-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{time:.375,feedback:.45}},{id:"acid-trance-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:30,parameters:{decay:3,preDelay:.03}}],volume:.65,pan:0},{type:"synth",name:"Acid Techno",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.8},filterEnvelope:{envMod:.85,decay:.35},accent:{amount:.9},slide:{time:.1,mode:"exponential"}},effects:[{id:"acid-techno-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.55}},{id:"acid-techno-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:6,attack:.002,release:.1}},{id:"acid-techno-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:3,high:1}}],volume:.55,pan:0},{type:"synth",name:"Acid Industrial",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.7,resonance:.85},filterEnvelope:{envMod:.9,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"}},effects:[{id:"acid-ind-cheby",category:"tonejs",type:"Chebyshev",enabled:!0,wet:35,parameters:{order:6}},{id:"acid-ind-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.7}},{id:"acid-ind-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}}],volume:.5,pan:0},{type:"synth",name:"Acid Space",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.5},filterEnvelope:{envMod:.4,decay:.55},accent:{amount:.5},slide:{time:.3,mode:"exponential"}},effects:[{id:"acid-space-chorus",category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.4,depth:.4}},{id:"acid-space-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:35,parameters:{time:.5,feedback:.5}},{id:"acid-space-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}}],volume:.65,pan:0}],sf=(e={})=>({enabled:!0,am:!1,ar:31,dr:0,mult:1,rr:15,sl:0,tl:0,dt2:0,rs:0,dt:0,d2r:0,ssg:0,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0,...e}),rf=()=>sf({enabled:!1,tl:127,ar:0,rr:0}),of=[{name:"Genesis Bass",type:"synth",synthType:"FurnaceOPN",volume:-6,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:5,operators:[sf({mult:1,tl:20,ar:31,dr:8,sl:2,rr:8}),sf({mult:2,tl:30,ar:31,dr:12,sl:4,rr:6,dt:3}),sf({mult:1,tl:25,ar:31,dr:10,sl:3,rr:8}),sf({mult:4,tl:35,ar:28,dr:15,sl:5,rr:10,dt:-1})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Lead",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:5,feedback:6,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:1,rr:6}),sf({mult:3,tl:35,ar:31,dr:8,sl:3,rr:8,dt:2}),sf({mult:2,tl:30,ar:31,dr:6,sl:2,rr:8,dt:-2}),sf({mult:1,tl:15,ar:31,dr:10,sl:4,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Brass",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:2,feedback:7,operators:[sf({mult:1,tl:25,ar:28,dr:10,sl:4,rr:8}),sf({mult:1,tl:20,ar:31,dr:8,sl:3,rr:10}),sf({mult:2,tl:30,ar:31,dr:12,sl:5,rr:8,dt:1}),sf({mult:1,tl:15,ar:25,dr:6,sl:2,rr:6})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Bell",type:"synth",synthType:"FurnaceOPN",volume:-10,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:0,operators:[sf({mult:1,tl:15,ar:31,dr:8,sl:0,rr:10}),sf({mult:7,tl:40,ar:31,dr:12,sl:2,rr:12,dt:3}),sf({mult:1,tl:20,ar:31,dr:10,sl:1,rr:10}),sf({mult:14,tl:45,ar:31,dr:15,sl:3,rr:14,dt:-2})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Strings",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:1,feedback:3,operators:[sf({mult:1,tl:20,ar:20,dr:5,sl:2,rr:8}),sf({mult:2,tl:35,ar:25,dr:8,sl:4,rr:10,dt:1}),sf({mult:1,tl:25,ar:22,dr:6,sl:3,rr:8,dt:-1}),sf({mult:3,tl:40,ar:28,dr:10,sl:5,rr:12,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Synth Lead",type:"synth",synthType:"FurnaceOPM",volume:-8,pan:0,effects:[],furnace:{chipType:33,algorithm:5,feedback:6,operators:[sf({mult:1,tl:15,ar:31,dr:5,sl:1,rr:6}),sf({mult:3,tl:40,ar:31,dr:8,sl:3,rr:8,dt:2}),sf({mult:2,tl:35,ar:31,dr:10,sl:4,rr:8,dt:-2}),sf({mult:1,tl:25,ar:31,dr:12,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Electric Piano",type:"synth",synthType:"FurnaceOPM",volume:-10,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:2,operators:[sf({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),sf({mult:14,tl:50,ar:31,dr:15,sl:5,rr:10}),sf({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),sf({mult:1,tl:45,ar:31,dr:18,sl:6,rr:12,dt:1})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Metallic Drum",type:"synth",synthType:"FurnaceOPM",volume:-6,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:7,operators:[sf({mult:1,tl:20,ar:31,dr:15,sl:0,rr:15}),sf({mult:5,tl:30,ar:31,dr:12,sl:0,rr:15,dt:2}),sf({mult:9,tl:40,ar:31,dr:10,sl:0,rr:15,dt:-2}),sf({mult:2,tl:50,ar:31,dr:8,sl:0,rr:15})],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Organ",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:3,operators:[sf({mult:2,tl:30,ar:15,dr:4,sl:8,rr:5,ws:1}),sf({mult:1,tl:0,ar:15,dr:2,sl:4,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Slap Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:5,operators:[sf({mult:4,tl:35,ar:15,dr:6,sl:3,rr:4,ws:0}),sf({mult:1,tl:0,ar:15,dr:3,sl:2,rr:6,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Bass Drum",type:"synth",synthType:"FurnaceOPL",volume:-4,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[sf({mult:1,tl:10,ar:31,dr:6,sl:2,rr:6,ws:0}),sf({mult:0,tl:0,ar:31,dr:8,sl:0,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Snare",type:"synth",synthType:"FurnaceOPL",volume:-6,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:10,sl:0,rr:10,ws:3}),sf({mult:4,tl:20,ar:31,dr:8,sl:0,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[sf({mult:1,tl:25,ar:12,dr:5,sl:5,rr:6,ws:0}),sf({mult:1,tl:5,ar:14,dr:4,sl:3,rr:8,ws:0}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:0,ar:31,dr:0,sl:0,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:4,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Triangle",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:2,sl:1,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Pulse",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:5,ar:28,dr:2,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:5,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Arp Lead",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[sf({mult:1,tl:3,ar:31,dr:3,sl:1,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:4,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:31,dr:6,sl:4,rr:6}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:4,operators:[sf({mult:1,tl:15,ar:25,dr:8,sl:5,rr:8}),sf({mult:2,tl:35,ar:31,dr:10,sl:6,rr:10,dt:1}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Bass",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:3,algorithm:4,feedback:5,operators:[sf({mult:1,tl:10,ar:31,dr:6,sl:3,rr:6}),sf({mult:3,tl:40,ar:31,dr:12,sl:8,rr:8,dt:2}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SID Pad",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:3,algorithm:2,feedback:3,operators:[sf({mult:1,tl:18,ar:18,dr:4,sl:2,rr:10}),sf({mult:2,tl:30,ar:20,dr:6,sl:4,rr:12,dt:-1}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Buzzy Lead",type:"synth",synthType:"FurnaceAY",volume:-8,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:1,operators:[sf({mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6}),sf({mult:3,tl:50,ar:31,dr:8,sl:8,rr:10}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Square Bass",type:"synth",synthType:"FurnaceAY",volume:-6,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:0,operators:[sf({mult:1,tl:15,ar:31,dr:8,sl:5,rr:5}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:4,algorithm:6,feedback:2,operators:[sf({mult:1,tl:12,ar:31,dr:5,sl:2,rr:8}),sf({mult:2,tl:40,ar:31,dr:8,sl:4,rr:10}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:4,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:6,sl:3,rr:6}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Pulse Lead",type:"synth",synthType:"FurnaceVRC6",volume:-8,pan:0,effects:[],furnace:{chipType:21,algorithm:5,feedback:0,operators:[sf({mult:1,tl:5,ar:31,dr:3,sl:1,rr:10}),sf({mult:2,tl:30,ar:31,dr:6,sl:3,rr:12}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Saw Bass",type:"synth",synthType:"FurnaceVRC6",volume:-6,pan:0,effects:[],furnace:{chipType:21,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:5,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"N163 Wave Lead",type:"synth",synthType:"FurnaceN163",volume:-8,pan:0,effects:[],furnace:{chipType:22,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:4,sl:2,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]}},{name:"TIA Buzzy",type:"synth",synthType:"FurnaceTIA",volume:-10,pan:0,effects:[],furnace:{chipType:38,algorithm:7,feedback:7,operators:[sf({mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4}),sf({mult:5,tl:45,ar:31,dr:20,sl:10,rr:6,dt:2}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"VERA PSG Lead",type:"synth",synthType:"FurnaceVERA",volume:-8,pan:0,effects:[],furnace:{chipType:42,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SCC Wave",type:"synth",synthType:"FurnaceSCC",volume:-8,pan:0,effects:[],furnace:{chipType:10,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:5,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[0,32,64,96,127,96,64,32,0,-32,-64,-96,-127,-96,-64,-32]}]}},{name:"OPLL Piano",type:"synth",synthType:"FurnaceOPLL",volume:-10,pan:0,effects:[],furnace:{chipType:9,algorithm:0,feedback:2,operators:[sf({mult:4,tl:35,ar:15,dr:5,sl:6,rr:7}),sf({mult:1,tl:0,ar:15,dr:3,sl:3,rr:6}),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Pad",type:"synth",synthType:"FurnaceSNES",volume:-10,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:20,dr:4,sl:2,rr:12}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Bass",type:"synth",synthType:"FurnaceSNES",volume:-6,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[sf({mult:1,tl:8,ar:31,dr:6,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"FDS Wave",type:"synth",synthType:"FurnaceFDS",volume:-8,pan:0,effects:[],furnace:{chipType:23,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[{id:0,data:[32,40,48,56,63,56,48,40,32,24,16,8,0,8,16,24]}]}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:32,algorithm:7,feedback:0,operators:[sf({mult:1,tl:12,ar:31,dr:5,sl:3,rr:8}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"SAA Square",type:"synth",synthType:"FurnaceSAA",volume:-8,pan:0,effects:[],furnace:{chipType:31,algorithm:7,feedback:0,operators:[sf({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),rf(),rf(),rf()],macros:[],opMacros:[],wavetables:[]}},{name:"ESFM Lead",type:"synth",synthType:"FurnaceESFM",volume:-8,pan:0,effects:[],furnace:{chipType:48,algorithm:5,feedback:5,operators:[sf({mult:1,tl:15,ar:15,dr:4,sl:2,rr:6}),sf({mult:3,tl:35,ar:15,dr:6,sl:4,rr:8,dt:1}),sf({mult:2,tl:30,ar:15,dr:5,sl:3,rr:8}),sf({mult:1,tl:20,ar:15,dr:8,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPZ E.Piano",type:"synth",synthType:"FurnaceOPZ",volume:-10,pan:0,effects:[],furnace:{chipType:40,algorithm:4,feedback:3,operators:[sf({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),sf({mult:14,tl:48,ar:31,dr:14,sl:5,rr:10,dt:1}),sf({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),sf({mult:1,tl:45,ar:31,dr:16,sl:6,rr:12})],macros:[],opMacros:[],wavetables:[]}}],lf=[{type:"synth",name:"Classic Siren",synthType:"DubSiren",dubSiren:{...Pa,oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"triangle",rate:2,depth:200},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1.5,wet:.2}},effects:[],volume:-10,pan:0},{type:"synth",name:"Code Red",synthType:"DubSiren",dubSiren:{...Pa,oscillator:{type:"square",frequency:600},lfo:{enabled:!0,type:"square",rate:8,depth:100},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:2,wet:.4}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Echo",synthType:"DubSiren",dubSiren:{...Pa,oscillator:{type:"sawtooth",frequency:220},lfo:{enabled:!0,type:"sine",rate:.5,depth:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},filter:{enabled:!0,type:"highpass",frequency:300,rolloff:-12},reverb:{enabled:!0,decay:4,wet:.6}},effects:[],volume:-12,pan:0},{type:"synth",name:"Air Horn",synthType:"DubSiren",dubSiren:{...Pa,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0}],cf=[{type:"synth",name:"Standard Zap",synthType:"SpaceLaser",spaceLaser:{...Da,laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:30,ratio:2},noise:{amount:5,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:30}},effects:[],volume:-10,pan:0},{type:"synth",name:"Cosmic Burst",synthType:"SpaceLaser",spaceLaser:{...Da,laser:{startFreq:8e3,endFreq:400,sweepTime:300,sweepCurve:"exponential"},fm:{amount:60,ratio:4.5},noise:{amount:20,type:"pink"},filter:{type:"highpass",cutoff:1e3,resonance:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},reverb:{enabled:!0,decay:4,wet:.4}},effects:[],volume:-12,pan:0},{type:"synth",name:"Anime Pew",synthType:"SpaceLaser",spaceLaser:{...Da,laser:{startFreq:6e3,endFreq:2e3,sweepTime:80,sweepCurve:"exponential"},fm:{amount:80,ratio:8},noise:{amount:0,type:"white"},filter:{type:"bandpass",cutoff:4e3,resonance:60},delay:{enabled:!0,time:.1,feedback:.3,wet:.3},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Blaster",synthType:"SpaceLaser",spaceLaser:{...Da,laser:{startFreq:1500,endFreq:40,sweepTime:500,sweepCurve:"linear"},fm:{amount:20,ratio:1.5},noise:{amount:40,type:"brown"},filter:{type:"lowpass",cutoff:800,resonance:40},delay:{enabled:!0,time:.33,feedback:.6,wet:.6},reverb:{enabled:!0,decay:2.5,wet:.3}},effects:[],volume:-10,pan:0}],df={type:"synth",name:"V2 Trance Lead",synthType:"V2",v2:{...Ia,osc1:{mode:1,detune:0,transpose:0,color:64,level:100},osc2:{mode:1,ringMod:!1,detune:15,transpose:0,color:64,level:80},filter1:{mode:1,cutoff:80,resonance:40},envelope:{attack:5,decay:60,sustain:40,release:40}},effects:[],volume:-10,pan:0},uf={type:"synth",name:"V2 Silk Pad",synthType:"V2",v2:{...Ia,osc1:{mode:1,detune:5,transpose:0,color:64,level:60},osc2:{mode:3,ringMod:!1,detune:0,transpose:12,color:64,level:40},filter1:{mode:1,cutoff:40,resonance:20},envelope:{attack:80,decay:100,sustain:100,release:100}},effects:[],volume:-12,pan:0},pf={type:"synth",name:"V2 4k Bass",synthType:"V2",v2:{...Ia,osc1:{mode:1,detune:0,transpose:-12,color:64,level:100},osc2:{mode:2,ringMod:!1,detune:0,transpose:-12,color:64,level:60},filter1:{mode:1,cutoff:30,resonance:60},envelope:{attack:0,decay:40,sustain:0,release:10}},effects:[],volume:-8,pan:0},hf={type:"synth",name:"V2 4k Kick",synthType:"V2",v2:{...Ia,osc1:{mode:3,detune:0,transpose:-24,color:64,level:120},filter1:{mode:1,cutoff:20,resonance:40},envelope:{attack:0,decay:30,sustain:0,release:10}},effects:[],volume:-6,pan:0},mf={type:"synth",name:"V2 Noise Snare",synthType:"V2",v2:{...Ia,osc1:{mode:4,detune:0,transpose:0,color:64,level:100},filter1:{mode:2,cutoff:60,resonance:20},envelope:{attack:0,decay:45,sustain:0,release:20}},effects:[],volume:-10,pan:0},ff={type:"synth",name:"V2 Metal Hat",synthType:"V2",v2:{...Ia,osc1:{mode:4,detune:0,transpose:0,color:64,level:80},filter1:{mode:3,cutoff:100,resonance:10},envelope:{attack:0,decay:15,sustain:0,release:10}},effects:[],volume:-14,pan:0},yf=[df,uf,pf,hf,mf,ff,{type:"synth",name:"V2 Retro Zap",synthType:"V2",v2:{...Ia,osc1:{mode:1,detune:0,transpose:12,color:64,level:100},filter1:{mode:1,cutoff:120,resonance:80},envelope:{attack:0,decay:25,sustain:0,release:10}},effects:[],volume:-10,pan:0},{name:"V2 Speech",type:"synth",synthType:"V2Speech",volume:-6,pan:0,effects:[],parameters:{text:"Ready"}}],gf=[{type:"synth",name:"Disco Tom",synthType:"Synare",synare:{...Oa,oscillator:{type:"square",tune:150,fine:0},sweep:{enabled:!0,amount:24,time:200},envelope:{decay:400,sustain:0},noise:{enabled:!1,type:"white",mix:0,color:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Perc",synthType:"Synare",synare:{...Oa,oscillator:{type:"square",tune:80,fine:0},sweep:{enabled:!0,amount:12,time:100},filter:{cutoff:400,resonance:85,envMod:80,decay:150},envelope:{decay:200,sustain:0},noise:{enabled:!0,type:"white",mix:.1,color:50}},effects:[],volume:-10,pan:0},{type:"synth",name:"Synare Snare",synthType:"Synare",synare:{...Oa,oscillator:{type:"square",tune:220,fine:0},noise:{enabled:!0,type:"white",mix:.6,color:80},filter:{cutoff:2e3,resonance:30,envMod:40,decay:100},envelope:{decay:150,sustain:0},sweep:{enabled:!1,amount:0,time:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Zap",synthType:"Synare",synare:{...Oa,oscillator:{type:"square",tune:600,fine:0},sweep:{enabled:!0,amount:48,time:300},lfo:{enabled:!0,rate:12,depth:50,target:"pitch"},envelope:{decay:500,sustain:0}},effects:[],volume:-12,pan:0}],vf=(e,t,n)=>({id:`map-${e}-${Date.now()}-${Math.random()}`,noteStart:e,noteEnd:e,sampleId:t,sampleName:t,sampleUrl:`data/samples/packs/drumnibus/${n}`,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0}),bf=(e,t)=>({type:"synth",name:e,synthType:"DrumKit",drumKit:{keymap:t,polyphony:"poly",maxVoices:8,noteCut:!0},effects:[],volume:-6,pan:0}),xf=[vf(36,"Kick","kicks/BD_808A1200.wav"),vf(38,"Snare","snares/SD_Analog Noise1.wav"),vf(39,"Clap","percussion/CLAP_Juxtapos.wav"),vf(42,"Closed Hat","hihats/CH_AnalogHihat1.wav"),vf(46,"Open Hat","hihats/OH_AnalogOpenhatwav.wav"),vf(41,"Tom Low","percussion/TOM_Warped.wav"),vf(45,"Tom Mid","percussion/TOM_Stofelectro1.wav"),vf(49,"Crash","hihats/CYM_Synthique.wav"),vf(51,"Ride","hihats/CYM_Magnotron.wav"),vf(60,"FX","fx/FX_AnalogFX1.wav")],wf=[vf(36,"Kick","kicks/BD_Digidap.wav"),vf(38,"Snare","snares/SD_Digidap.wav"),vf(39,"Clap","percussion/CLAP_Punchtron.wav"),vf(42,"Closed Hat","hihats/CH_Digidap.wav"),vf(46,"Open Hat","hihats/OH_Digidap.wav"),vf(41,"Tom","percussion/TOM_Punchtron.wav"),vf(49,"Crash","hihats/CYM_Punchtron.wav"),vf(60,"Zap","fx/FX_Digidap2.wav")],kf=[vf(36,"Kick","kicks/BD_LofiHuman.wav"),vf(38,"Snare","snares/SD_LofiHuman.wav"),vf(39,"Clap","percussion/CLAP_LofiHuman.wav"),vf(42,"Closed Hat","hihats/CH_LofiHuman.wav"),vf(46,"Open Hat","hihats/OH_LofiHuman.wav"),vf(41,"Tom","percussion/TOM_LofiHuman.wav"),vf(60,"Vocal FX","fx/FX_LofiHuman.wav")],Sf=[vf(36,"Kick","kicks/BD_Pziforze.wav"),vf(38,"Snare","snares/SD_Wolf 3.wav"),vf(39,"Clap","percussion/CLAP_Magnotron.wav"),vf(42,"Closed Hat","hihats/CH_Magnotron.wav"),vf(46,"Open Hat","hihats/OH_Magnotron.wav"),vf(41,"Tom Low","percussion/TOM_Magnotron.wav"),vf(49,"Crash","hihats/CYM_Magnotron.wav"),vf(60,"Rumble FX","fx/FX_Magstorm1.wav")],Mf=[bf("Drumnibus Analog",xf),bf("Drumnibus Digital",wf),bf("Drumnibus LoFi",kf),bf("Drumnibus Techno",Sf)],Nf=[{type:"synth",name:"SP_TheProduct",synthType:"V2",v2Speech:{text:"!DHAX_ !prAA_dAHkt",speed:64,pitch:40,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP_Demoscene",synthType:"V2",v2Speech:{text:"!dEH_mOW_sIYn",speed:64,pitch:64,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"KY_Rhodesano0",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:0},osc2:{mode:5,ringMod:!1,transpose:0,detune:9,color:0,level:122},osc3:{mode:0,ringMod:!1,transpose:31,detune:29,color:72,level:0},filter1:{mode:1,cutoff:99,resonance:0},filter2:{mode:0,cutoff:94,resonance:99},routing:{mode:1,balance:64},envelope:{attack:13,decay:104,sustain:0,release:44},envelope2:{attack:4,decay:93,sustain:0,release:64},lfo1:{rate:74,depth:75}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_AnaBass#005",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:7,color:0,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:64,level:125},osc3:{mode:0,ringMod:!1,transpose:-12,detune:0,color:0,level:125},filter1:{mode:1,cutoff:52,resonance:91},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_French HornZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Dry BD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:22,level:122},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:0},filter1:{mode:1,cutoff:122,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:5,release:45},envelope2:{attack:0,decay:35,sustain:0,release:33},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Morseh #000",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:-6,detune:0,color:62,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:94,depth:108}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Transortion",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:63,resonance:95},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:90,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Long Pad007",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:16,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-8,color:64,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:4,cutoff:39,resonance:0},filter2:{mode:1,cutoff:35,resonance:69},routing:{mode:1,balance:64},envelope:{attack:71,decay:94,sustain:96,release:106},envelope2:{attack:114,decay:120,sustain:113,release:112},lfo1:{rate:7,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_JarreStrings",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:12,color:1,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:61,level:34},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:5,cutoff:74,resonance:42},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:26,decay:64,sustain:64,release:49},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:78,depth:2}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_His Shadow's Breath",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:4,level:122},osc2:{mode:4,ringMod:!1,transpose:45,detune:0,color:41,level:77},osc3:{mode:1,ringMod:!1,transpose:12,detune:16,color:3,level:122},filter1:{mode:5,cutoff:67,resonance:97},filter2:{mode:2,cutoff:76,resonance:120},routing:{mode:2,balance:64},envelope:{attack:27,decay:64,sustain:122,release:30},envelope2:{attack:0,decay:102,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Deepness001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:14,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-15,color:0,level:126},filter1:{mode:1,cutoff:76,resonance:47},filter2:{mode:1,cutoff:76,resonance:47},routing:{mode:1,balance:42},envelope:{attack:0,decay:14,sustain:115,release:54},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 SD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Marsian Pan Flute",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:28,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:-27,color:64,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:18,resonance:118},filter2:{mode:1,cutoff:100,resonance:70},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:37,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Lullaby09",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:80,resonance:44},filter2:{mode:2,cutoff:115,resonance:108},routing:{mode:2,balance:64},envelope:{attack:0,decay:64,sustain:64,release:75},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Morpher#072",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-8,color:8,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:12,color:24,level:72},osc3:{mode:1,ringMod:!1,transpose:0,detune:-7,color:97,level:126},filter1:{mode:2,cutoff:0,resonance:86},filter2:{mode:2,cutoff:123,resonance:51},routing:{mode:2,balance:63},envelope:{attack:0,decay:25,sustain:126,release:7},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:24,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Jarresque06",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:124},osc2:{mode:4,ringMod:!1,transpose:23,detune:0,color:98,level:49},osc3:{mode:1,ringMod:!1,transpose:12,detune:10,color:6,level:124},filter1:{mode:2,cutoff:68,resonance:0},filter2:{mode:3,cutoff:120,resonance:0},routing:{mode:2,balance:29},envelope:{attack:75,decay:0,sustain:125,release:98},envelope2:{attack:125,decay:125,sustain:125,release:125},lfo1:{rate:10,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_Awaych #000",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-11,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:12,color:0,level:126},filter1:{mode:2,cutoff:86,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:86,decay:114,sustain:109,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:74,depth:23}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Kicking Saw",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:68,resonance:98},filter2:{mode:1,cutoff:62,resonance:105},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:105,depth:32}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Hiphop BaZZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:42,resonance:0},filter2:{mode:2,cutoff:126,resonance:0},routing:{mode:2,balance:64},envelope:{attack:0,decay:12,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Woodblock",synthType:"V2",v2:{osc1:{mode:3,transpose:12,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:21,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:21,sustain:0,release:25},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Electrons68",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:1,ringMod:!0,transpose:0,detune:-19,color:32,level:125},osc3:{mode:3,ringMod:!0,transpose:31,detune:0,color:114,level:125},filter1:{mode:2,cutoff:67,resonance:95},filter2:{mode:3,cutoff:60,resonance:89},routing:{mode:1,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:91,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Garage Organ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:15,level:125},osc2:{mode:3,ringMod:!1,transpose:48,detune:0,color:32,level:25},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:33},filter1:{mode:1,cutoff:108,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:49,sustain:108,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Lonely Square Lead",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:97},osc2:{mode:2,ringMod:!1,transpose:0,detune:-9,color:64,level:66},osc3:{mode:2,ringMod:!1,transpose:0,detune:6,color:64,level:47},filter1:{mode:2,cutoff:66,resonance:35},filter2:{mode:3,cutoff:98,resonance:10},routing:{mode:2,balance:32},envelope:{attack:0,decay:73,sustain:36,release:55},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Strangeland",synthType:"V2",v2:{osc1:{mode:2,transpose:-12,detune:0,color:2,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:5,color:123,level:126},osc3:{mode:2,ringMod:!1,transpose:0,detune:-9,color:24,level:126},filter1:{mode:3,cutoff:117,resonance:14},filter2:{mode:2,cutoff:91,resonance:15},routing:{mode:2,balance:42},envelope:{attack:10,decay:96,sustain:65,release:102},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:14,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old Saw Percs",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:9,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:23,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:67,resonance:13},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:68},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:50,depth:114}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_SawBass#004",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:4,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-5,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:0,color:6,level:126},filter1:{mode:1,cutoff:64,resonance:7},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:90,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Ridesecken",synthType:"V2",v2:{osc1:{mode:2,transpose:-4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:4,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:2,cutoff:104,resonance:95},routing:{mode:1,balance:64},envelope:{attack:0,decay:26,sustain:57,release:100},envelope2:{attack:0,decay:90,sustain:0,release:95},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Powerbeam15",synthType:"V2",v2:{osc1:{mode:3,transpose:-45,detune:0,color:0,level:124},osc2:{mode:3,ringMod:!0,transpose:-38,detune:0,color:32,level:124},osc3:{mode:5,ringMod:!1,transpose:-2,detune:0,color:67,level:124},filter1:{mode:1,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:125,sustain:0,release:2},envelope2:{attack:0,decay:125,sustain:0,release:0},lfo1:{rate:94,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Glimpse Of a Clavi",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:13,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:82,resonance:102},filter2:{mode:3,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:13},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_PWM Leade)",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:125},osc2:{mode:0,ringMod:!1,transpose:-12,detune:7,color:4,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:73,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:60,decay:114,sustain:80,release:64},envelope2:{attack:126,decay:126,sustain:126,release:0},lfo1:{rate:77,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_LoFi Choir9",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-20,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:82,resonance:98},filter2:{mode:3,cutoff:80,resonance:106},routing:{mode:1,balance:64},envelope:{attack:67,decay:64,sustain:64,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old SawsrnZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_I like to move it",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-13,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:20,color:32,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:58},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:31},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Industrial VeloHammer",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:15,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:61,resonance:113},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:55,sustain:0,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Rave Siren",synthType:"V2",v2:{osc1:{mode:2,transpose:8,detune:4,color:69,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:53,level:107},osc3:{mode:2,ringMod:!1,transpose:-4,detune:5,color:69,level:126},filter1:{mode:3,cutoff:58,resonance:95},filter2:{mode:2,cutoff:100,resonance:90},routing:{mode:1,balance:64},envelope:{attack:0,decay:13,sustain:28,release:86},envelope2:{attack:0,decay:72,sustain:58,release:73},lfo1:{rate:104,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Doj's Organ",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:0,color:32,level:125},osc3:{mode:3,ringMod:!1,transpose:36,detune:0,color:32,level:78},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:38,sustain:107,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Phunny #002",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:26,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:75,resonance:82},filter2:{mode:1,cutoff:64,resonance:0},routing:{mode:2,balance:26},envelope:{attack:7,decay:37,sustain:64,release:53},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:73,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Fairies#001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:63},osc2:{mode:1,ringMod:!1,transpose:0,detune:8,color:0,level:63},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:121},filter1:{mode:3,cutoff:42,resonance:101},filter2:{mode:0,cutoff:108,resonance:0},routing:{mode:0,balance:64},envelope:{attack:72,decay:121,sustain:70,release:100},envelope2:{attack:0,decay:125,sustain:56,release:108},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nastyn-303",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:0,level:125},osc2:{mode:0,ringMod:!1,transpose:0,detune:19,color:0,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:49,resonance:114},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:18},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:61,depth:82}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Squaredance",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:65,level:126},osc3:{mode:2,ringMod:!0,transpose:12,detune:0,color:64,level:22},filter1:{mode:1,cutoff:57,resonance:63},filter2:{mode:2,cutoff:60,resonance:31},routing:{mode:0,balance:64},envelope:{attack:0,decay:26,sustain:100,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Biiiig Drumdamm",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:0,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:81},envelope2:{attack:0,decay:57,sustain:0,release:52},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Random Zaps",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:44,detune:0,color:53,level:126},filter1:{mode:3,cutoff:80,resonance:51},filter2:{mode:1,cutoff:93,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:0},envelope2:{attack:0,decay:0,sustain:46,release:3},lfo1:{rate:22,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_What They Called Pian",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:32,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:34,level:124},filter1:{mode:1,cutoff:95,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:79,sustain:64,release:69},envelope2:{attack:96,decay:0,sustain:124,release:62},lfo1:{rate:76,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Debil? ICH?",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:52,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:97,resonance:62},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:32,sustain:0,release:64},lfo1:{rate:78,depth:113}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Formants From The Cry",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:17,level:126},osc2:{mode:3,ringMod:!0,transpose:36,detune:4,color:112,level:76},osc3:{mode:1,ringMod:!1,transpose:31,detune:0,color:22,level:27},filter1:{mode:2,cutoff:81,resonance:83},filter2:{mode:1,cutoff:73,resonance:104},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_You broke me!bass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:2,level:11},osc2:{mode:1,ringMod:!1,transpose:0,detune:2,color:0,level:10},osc3:{mode:4,ringMod:!1,transpose:6,detune:0,color:53,level:38},filter1:{mode:1,cutoff:78,resonance:30},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:25,depth:117}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Airy HH003",synthType:"V2",v2:{osc1:{mode:4,transpose:35,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:115,resonance:8},filter2:{mode:1,cutoff:116,resonance:24},routing:{mode:1,balance:64},envelope:{attack:0,decay:55,sustain:24,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:97,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Tag You're Its",synthType:"V2",v2:{osc1:{mode:3,transpose:-6,detune:0,color:60,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:61,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:106,resonance:126},filter2:{mode:3,cutoff:95,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:35,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Slow Synthbrass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-9,color:0,level:126},filter1:{mode:1,cutoff:74,resonance:24},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:45,decay:66,sustain:64,release:73},envelope2:{attack:98,decay:91,sustain:121,release:72},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Random Arp3",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:11,color:18,level:98},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:83},filter2:{mode:0,cutoff:58,resonance:0},routing:{mode:0,balance:64},envelope:{attack:4,decay:50,sustain:0,release:57},envelope2:{attack:0,decay:26,sustain:0,release:31},lfo1:{rate:64,depth:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Analog Mod Bass",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:25,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:19,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:39,resonance:105},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:32,decay:64,sustain:64,release:62},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:97}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_HighSnare02",synthType:"V2",v2:{osc1:{mode:3,transpose:3,detune:0,color:0,level:68},osc2:{mode:3,ringMod:!1,transpose:10,detune:0,color:32,level:64},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:23,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:107,sustain:0,release:64},lfo1:{rate:93,depth:25}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Whistling Wind",synthType:"V2",v2:{osc1:{mode:4,transpose:31,detune:0,color:61,level:126},osc2:{mode:4,ringMod:!1,transpose:-10,detune:-13,color:23,level:126},osc3:{mode:0,ringMod:!1,transpose:24,detune:-5,color:96,level:126},filter1:{mode:4,cutoff:62,resonance:40},filter2:{mode:1,cutoff:80,resonance:53},routing:{mode:1,balance:64},envelope:{attack:46,decay:78,sustain:126,release:66},envelope2:{attack:0,decay:0,sustain:11,release:4},lfo1:{rate:5,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Sweeping Dist",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:11,level:126},osc2:{mode:0,ringMod:!1,transpose:38,detune:0,color:65,level:24},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:126},filter2:{mode:0,cutoff:80,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:30}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lofi Squares",synthType:"V2",v2:{osc1:{mode:3,transpose:10,detune:0,color:72,level:126},osc2:{mode:3,ringMod:!0,transpose:12,detune:-1,color:55,level:126},osc3:{mode:2,ringMod:!1,transpose:4,detune:0,color:65,level:126},filter1:{mode:1,cutoff:52,resonance:104},filter2:{mode:2,cutoff:126,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:41,sustain:43,release:8},envelope2:{attack:0,decay:23,sustain:126,release:14},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Not From This World",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:2,color:52,level:126},osc2:{mode:2,ringMod:!0,transpose:4,detune:13,color:23,level:126},osc3:{mode:5,ringMod:!0,transpose:-24,detune:3,color:56,level:126},filter1:{mode:2,cutoff:50,resonance:53},filter2:{mode:2,cutoff:78,resonance:82},routing:{mode:2,balance:63},envelope:{attack:0,decay:83,sustain:126,release:6},envelope2:{attack:0,decay:41,sustain:126,release:10},lfo1:{rate:9,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:-3,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-3,detune:0,color:96,level:126},osc3:{mode:4,ringMod:!1,transpose:21,detune:0,color:36,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:69,sustain:0,release:55},envelope2:{attack:0,decay:32,sustain:0,release:31},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Mod Perc004",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:10,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:60,resonance:110},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:13,decay:39,sustain:24,release:59},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:0,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nice Saws87",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:13,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-13,color:0,level:126},filter1:{mode:1,cutoff:126,resonance:107},filter2:{mode:2,cutoff:113,resonance:65},routing:{mode:2,balance:64},envelope:{attack:0,decay:66,sustain:19,release:70},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:12,depth:102}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Roaar! 007",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:3,color:126,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:-7,color:126,level:26},filter1:{mode:1,cutoff:62,resonance:75},filter2:{mode:3,cutoff:41,resonance:15},routing:{mode:1,balance:64},envelope:{attack:20,decay:64,sustain:126,release:20},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Dist Kick",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_XPlosion007",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:-46,detune:0,color:65,level:126},osc3:{mode:0,ringMod:!1,transpose:-11,detune:0,color:32,level:14},filter1:{mode:1,cutoff:92,resonance:0},filter2:{mode:1,cutoff:25,resonance:10},routing:{mode:1,balance:64},envelope:{attack:0,decay:96,sustain:0,release:96},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Whistlotronic",synthType:"V2",v2:{osc1:{mode:2,transpose:12,detune:0,color:66,level:127},osc2:{mode:0,ringMod:!1,transpose:7,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:4,detune:0,color:27,level:126},filter1:{mode:2,cutoff:86,resonance:0},filter2:{mode:2,cutoff:116,resonance:0},routing:{mode:2,balance:21},envelope:{attack:34,decay:64,sustain:53,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:99,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Tech Arp100",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:13,resonance:32},filter2:{mode:2,cutoff:29,resonance:104},routing:{mode:2,balance:78},envelope:{attack:0,decay:48,sustain:18,release:23},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:1,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Mightyass1",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:9,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:47},filter1:{mode:1,cutoff:25,resonance:69},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:105,sustain:6,release:81},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Rim#003",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:6,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:38,detune:0,color:0,level:121},filter1:{mode:0,cutoff:73,resonance:117},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:11,sustain:0,release:0},envelope2:{attack:0,decay:6,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Hell's Bell",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:91,level:28},osc2:{mode:5,ringMod:!1,transpose:23,detune:50,color:30,level:126},osc3:{mode:3,ringMod:!0,transpose:-64,detune:0,color:102,level:24},filter1:{mode:1,cutoff:80,resonance:106},filter2:{mode:3,cutoff:37,resonance:77},routing:{mode:1,balance:64},envelope:{attack:0,decay:65,sustain:126,release:77},envelope2:{attack:0,decay:46,sustain:15,release:13},lfo1:{rate:28,depth:52}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Farscape04",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:4,ringMod:!1,transpose:-44,detune:-10,color:0,level:6},osc3:{mode:3,ringMod:!1,transpose:0,detune:1,color:32,level:126},filter1:{mode:1,cutoff:86,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:80,decay:64,sustain:112,release:94},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:27,depth:109}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lethal PWM0",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:80,resonance:0},filter2:{mode:5,cutoff:114,resonance:91},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:116,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:68,depth:34}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Soaring#088",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-4,color:126,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:-11,color:0,level:126},filter1:{mode:1,cutoff:33,resonance:51},filter2:{mode:1,cutoff:77,resonance:115},routing:{mode:1,balance:64},envelope:{attack:0,decay:126,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:8,depth:46}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_Trombrato02",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:14,color:0,level:121},osc2:{mode:0,ringMod:!1,transpose:0,detune:-15,color:0,level:82},osc3:{mode:0,ringMod:!1,transpose:12,detune:2,color:0,level:76},filter1:{mode:1,cutoff:70,resonance:0},filter2:{mode:1,cutoff:70,resonance:23},routing:{mode:1,balance:64},envelope:{attack:46,decay:64,sustain:121,release:20},envelope2:{attack:94,decay:125,sustain:125,release:26},lfo1:{rate:0,depth:17}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noiseh #004",synthType:"V2",v2:{osc1:{mode:4,transpose:5,detune:0,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:67,resonance:83},filter2:{mode:2,cutoff:86,resonance:66},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:113,release:26},envelope2:{attack:0,decay:25,sustain:20,release:121},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Disturbing7",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:122},osc2:{mode:4,ringMod:!1,transpose:52,detune:0,color:32,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:122},filter1:{mode:2,cutoff:89,resonance:89},filter2:{mode:2,cutoff:78,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:77,sustain:123,release:0},envelope2:{attack:0,decay:106,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Bontempi002",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:5,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:2,cutoff:45,resonance:0},filter2:{mode:0,cutoff:47,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:41,release:70},envelope2:{attack:0,decay:64,sustain:64,release:90},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_FlangeHats2",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Screeeam!IKAAAA!!!",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-17,color:63,level:55},osc2:{mode:1,ringMod:!1,transpose:12,detune:-43,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:92,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:14,decay:64,sustain:64,release:42},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:82,depth:87}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Kick075",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Synth Jew's Harp",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:5,level:123},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},filter1:{mode:2,cutoff:9,resonance:113},filter2:{mode:1,cutoff:81,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:27},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Snaree",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:124},osc2:{mode:4,ringMod:!1,transpose:25,detune:0,color:102,level:108},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:0,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:39,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Cheap Arp08",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:14,color:0,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:1,cutoff:83,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:42,sustain:38,release:71},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 HHs 104",synthType:"V2",v2:{osc1:{mode:2,transpose:4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:24,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:3,cutoff:104,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_VeloFuzz001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:1,color:0,level:126},osc2:{mode:2,ringMod:!0,transpose:24,detune:14,color:63,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:4,resonance:116},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Hefty Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:-54,detune:3,color:70,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:0,color:65,level:126},filter1:{mode:1,cutoff:122,resonance:11},filter2:{mode:3,cutoff:41,resonance:42},routing:{mode:1,balance:64},envelope:{attack:0,decay:98,sustain:126,release:47},envelope2:{attack:0,decay:54,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_yasgch #005",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:9,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:59},filter2:{mode:0,cutoff:59,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:118,sustain:114,release:35},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Synth Kick",synthType:"V2",v2:{osc1:{mode:1,transpose:-3,detune:0,color:61,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:0,cutoff:27,resonance:56},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:34,sustain:0,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Hihats 2",synthType:"V2",v2:{osc1:{mode:2,transpose:-10,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:91},filter2:{mode:2,cutoff:108,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 1001",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:26,resonance:126},filter2:{mode:2,cutoff:25,resonance:126},routing:{mode:1,balance:64},envelope:{attack:0,decay:61,sustain:0,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 13",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:3,ringMod:!1,transpose:0,detune:7,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:60},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:76,depth:104}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 28",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:70,sustain:0,release:92},envelope2:{attack:0,decay:37,sustain:0,release:40},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistSnare11",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:32,level:0},osc2:{mode:3,ringMod:!1,transpose:8,detune:36,color:32,level:0},osc3:{mode:4,ringMod:!1,transpose:35,detune:0,color:70,level:124},filter1:{mode:5,cutoff:73,resonance:115},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:56,sustain:0,release:65},envelope2:{attack:0,decay:15,sustain:0,release:0},lfo1:{rate:64,depth:105}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 Ride",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:14},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:18},osc3:{mode:4,ringMod:!1,transpose:50,detune:0,color:66,level:123},filter1:{mode:3,cutoff:124,resonance:0},filter2:{mode:2,cutoff:104,resonance:100},routing:{mode:1,balance:64},envelope:{attack:0,decay:54,sustain:0,release:75},envelope2:{attack:0,decay:64,sustain:123,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 HHs + Dis",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 1 #000",synthType:"V2",v2:{osc1:{mode:3,transpose:-7,detune:0,color:32,level:127},osc2:{mode:3,ringMod:!1,transpose:-7,detune:9,color:32,level:127},osc3:{mode:4,ringMod:!1,transpose:29,detune:0,color:64,level:0},filter1:{mode:0,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:47,sustain:0,release:43},envelope2:{attack:0,decay:46,sustain:1,release:75},lfo1:{rate:90,depth:107}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:4,detune:-64,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:-1,detune:-13,color:32,level:91},osc3:{mode:4,ringMod:!1,transpose:-11,detune:44,color:0,level:34},filter1:{mode:1,cutoff:68,resonance:0},filter2:{mode:2,cutoff:84,resonance:63},routing:{mode:2,balance:15},envelope:{attack:0,decay:0,sustain:65,release:64},envelope2:{attack:0,decay:63,sustain:99,release:76},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_March Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:6,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:12,detune:1,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Nice Synth HH",synthType:"V2",v2:{osc1:{mode:4,transpose:53,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:121,resonance:121},filter2:{mode:1,cutoff:117,resonance:114},routing:{mode:2,balance:64},envelope:{attack:0,decay:20,sustain:20,release:8},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Crash",synthType:"V2",v2:{osc1:{mode:4,transpose:62,detune:62,color:106,level:126},osc2:{mode:4,ringMod:!1,transpose:62,detune:50,color:51,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:26,color:108,level:126},filter1:{mode:3,cutoff:126,resonance:55},filter2:{mode:1,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:47,sustain:21,release:77},envelope2:{attack:0,decay:113,sustain:70,release:124},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Open HH",synthType:"V2",v2:{osc1:{mode:4,transpose:36,detune:0,color:82,level:126},osc2:{mode:0,ringMod:!1,transpose:9,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:112,resonance:106},filter2:{mode:0,cutoff:104,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:44,sustain:0,release:32},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Pop BD #003",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:121},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:36,detune:0,color:90,level:0},filter1:{mode:1,cutoff:121,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:0,release:52},envelope2:{attack:0,decay:23,sustain:0,release:0},lfo1:{rate:80,depth:84}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Snappy Snare",synthType:"V2",v2:{osc1:{mode:1,transpose:-10,detune:0,color:72,level:126},osc2:{mode:5,ringMod:!1,transpose:0,detune:0,color:64,level:38},osc3:{mode:4,ringMod:!1,transpose:33,detune:0,color:76,level:126},filter1:{mode:3,cutoff:53,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:45,sustain:0,release:19},envelope2:{attack:0,decay:18,sustain:0,release:0},lfo1:{rate:105,depth:11}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Ver|bt Snare",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:60,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:-21,color:126,level:88},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:82,resonance:126},filter2:{mode:1,cutoff:22,resonance:126},routing:{mode:2,balance:17},envelope:{attack:0,decay:0,sustain:126,release:14},envelope2:{attack:0,decay:83,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #100",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #101",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #102",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #103",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #104",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #105",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #106",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #107",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #108",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #109",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #110",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #111",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #112",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #113",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #114",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #115",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #116",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #117",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #118",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #119",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #120",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #121",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #122",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #123",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #124",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #125",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #126",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #127",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0}],Cf=[{type:"synth",name:"SAM_Classic",synthType:"Sam",sam:{text:"SAM IS BACK",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_C64",synthType:"Sam",sam:{text:"COMMODORE SIXTY FOUR",pitch:64,speed:64,mouth:150,throat:110,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_Robotic",synthType:"Sam",sam:{text:"EXTERMINATE",pitch:40,speed:80,mouth:200,throat:200,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_High",synthType:"Sam",sam:{text:"I HAVE A HIGH VOICE",pitch:100,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0}],Ef=[{type:"synth",name:"Astrocade Clean Square",synthType:"MAMEAstrocade",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Vibrato Lead",synthType:"MAMEAstrocade",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Buzz",synthType:"MAMEAstrocade",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Rumble",synthType:"MAMEAstrocade",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Laser",synthType:"MAMESN76477",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Explosion",synthType:"MAMESN76477",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Engine",synthType:"MAMESN76477",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Siren",synthType:"MAMESN76477",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Organ",synthType:"MAMEMSM5232",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Full Brass",synthType:"MAMEMSM5232",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Strings",synthType:"MAMEMSM5232",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Reedy Combo",synthType:"MAMEMSM5232",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Piano",synthType:"MAMETMS36XX",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Banjo",synthType:"MAMETMS36XX",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Organ",synthType:"MAMETMS36XX",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Sine",synthType:"MAMESNKWave",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Square",synthType:"MAMESNKWave",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Triangle",synthType:"MAMESNKWave",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"YMOPQ E.Piano",synthType:"MAMEYMOPQ",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Brass",synthType:"MAMEYMOPQ",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Strings",synthType:"MAMEYMOPQ",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bass",synthType:"MAMEYMOPQ",parameters:{_program:3},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Organ",synthType:"MAMEYMOPQ",parameters:{_program:4},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Lead",synthType:"MAMEYMOPQ",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Pad",synthType:"MAMEYMOPQ",parameters:{_program:6},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bell",synthType:"MAMEYMOPQ",parameters:{_program:7},effects:[],volume:-8,pan:0},{type:"synth",name:"MEA8000 Vowel A",synthType:"MAMEMEA8000",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel E",synthType:"MAMEMEA8000",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel O",synthType:"MAMEMEA8000",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Nasal",synthType:"MAMEMEA8000",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel AH",synthType:"MAMESP0250",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel EE",synthType:"MAMESP0250",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel OO",synthType:"MAMESP0250",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax EH",synthType:"MAMEVotrax",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AW",synthType:"MAMEVotrax",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AH",synthType:"MAMEVotrax",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax OO",synthType:"MAMEVotrax",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"ES5503 Default",synthType:"MAMEES5503",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"YMF271 FM Piano",synthType:"MAMEYMF271",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Brass",synthType:"MAMEYMF271",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Strings",synthType:"MAMEYMF271",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"TR707 Default Kit",synthType:"MAMETR707",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Bass",synthType:"MAMEVASynth",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Lead",synthType:"MAMEVASynth",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pad",synthType:"MAMEVASynth",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pluck",synthType:"MAMEVASynth",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"TIA Square",synthType:"MAMETIA",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TIA Buzz",synthType:"MAMETIA",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD931 Default",synthType:"MAMEUPD931",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD933 Default",synthType:"MAMEUPD933",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS5220 Speech",synthType:"MAMETMS5220",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Sine",synthType:"MAMEASC",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Square",synthType:"MAMEASC",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"AICA Default",synthType:"MAMEAICA",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"SCSP Default",synthType:"SCSP",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"C352 Default",synthType:"MAMEC352",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"RF5C400 Default",synthType:"MAMERF5C400",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"ICS2115 Default",synthType:"MAMEICS2115",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"K054539 Default",synthType:"MAMEK054539",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Bass",synthType:"CEM3394",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"CEM3394 Lead",synthType:"CEM3394",parameters:{_program:1,volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Pad",synthType:"CEM3394",parameters:{_program:2,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"SCSP Synth Bass",synthType:"SCSP",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"SCSP Poly Pad",synthType:"SCSP",parameters:{_program:1,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"AICA FM Piano",synthType:"MAMEAICA",parameters:{_program:0,volume:.8},effects:[],volume:-10,pan:0}],Pf=(e,t,n=0,a=7)=>({level:e,coarse:t,fine:n,detune:a,egRates:[99,99,99,99],egLevels:[99,99,99,0]}),Tf=[{name:"DX7 E.Piano 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["E.PIANO 1"]},{name:"DX7 E.Piano Bright",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{...$l["E.PIANO 1"],feedback:7}},{name:"DX7 Clavinet",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,60,30,60],egLevels:[99,0,0,0]},{level:80,coarse:2,egRates:[99,50,20,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Organ",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:3,feedback:0,operators:[{level:99,coarse:1},{level:90,coarse:2},{level:85,coarse:3},{level:80,coarse:4},Pf(0,1),Pf(0,1)]}},{name:"DX7 Bass 1",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:5,feedback:7,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:75,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:50,coarse:2,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Slap Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:16,feedback:6,operators:[{level:99,coarse:1,egRates:[99,60,40,60],egLevels:[99,95,0,0]},{level:88,coarse:4,egRates:[99,80,60,80],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Solid Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:18,feedback:4,operators:[{level:99,coarse:0,fine:50},{level:80,coarse:1},{level:70,coarse:1},Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Tubular Bells",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:1,feedback:5,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,40,20,50],egLevels:[99,0,0,0]},{level:85,coarse:3,fine:50,detune:7,egRates:[99,60,30,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Marimba",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,70,30,60],egLevels:[99,0,0,0]},{level:80,coarse:4,egRates:[99,60,20,50],egLevels:[99,0,0,0]},Pf(0,1),Pf(0,1),Pf(0,1),Pf(0,1)]}},{name:"DX7 Brass 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["BRASS 1"]},{name:"DX7 Strings 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["STRINGS 1"]},{name:"DX7 Init Voice",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:$l["INIT VOICE"]}],Af=[{name:"OB-X Classic Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Classic Brass"]},{name:"OB-X Bright Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{...Uc["Classic Brass"],filterCutoff:.6,filterEnvAmount:.7,unison:!0,unisonDetune:.1}},{name:"OB-X Fat Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Fat Lead"]},{name:"OB-X Sync Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Sync Lead"]},{name:"OB-X Unison Saw",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,unison:!0,unisonDetune:.2,panSpread:.5,filterCutoff:1,ampRelease:.2}},{name:"OB-X Rez Bass",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:1,osc2Detune:.08,filterCutoff:.3,filterResonance:.6,filterEnvAmount:.7,filterAttack:.05,filterDecay:.2,ampAttack:.01,ampDecay:.3}},{name:"OB-X Sub Bass",type:"synth",synthType:"OBXd",volume:-6,pan:0,effects:[],obxd:{osc1Waveform:2,osc2Waveform:0,osc2Octave:-1,filterCutoff:.2,filterResonance:0,filterEnvAmount:.3,filterDecay:.4}},{name:"OB-X PWM Strings",type:"synth",synthType:"OBXd",volume:-12,pan:0,effects:[],obxd:{osc1Waveform:1,osc2Waveform:1,osc1PulseWidth:.5,osc2Detune:.03,lfoRate:.2,lfoPwAmount:.4,filterCutoff:.4,filterResonance:.1,ampAttack:.2,ampRelease:.5}},{name:"OB-X Pulse Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc["Pulse Pad"]},{name:"OB-X Sweep Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,filterCutoff:.3,filterResonance:.5,lfoRate:.1,lfoFilterAmount:.4,ampAttack:.5,ampRelease:.8}},{name:"OB-X S&H Sci-Fi",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:1,lfoWaveform:4,lfoRate:.7,lfoFilterAmount:.8,lfoOscAmount:.3,filterResonance:.7}},{name:"OB-X Init",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Uc.Init}],_f=[{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Po.NES}},{name:"NES Pulse 12.5%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Po.NES,nes:{dutyNoise:0,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Pulse 25%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:Po.NES,nes:{dutyNoise:1,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Triangle Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:Po.NES}},{name:"NES Noise Drums",type:"synth",synthType:"FurnaceNES",volume:-10,pan:0,effects:[],furnace:{chipType:Po.NES}},{name:"MMC5 Expansion Init",type:"synth",synthType:"FurnaceMMC5",volume:-8,pan:0,effects:[],furnace:{chipType:Po.MMC5}},{name:"GB Pulse 50%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"GB Pulse 25%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"GB Noise Snare",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"GB Wave Organ",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"GB Noise HiHat",type:"synth",synthType:"FurnaceGB",volume:-12,pan:0,effects:[],furnace:{chipType:Po.GB}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:Po.PSG}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:Po.PSG}},{name:"PSG Periodic Noise",type:"synth",synthType:"FurnacePSG",volume:-10,pan:0,effects:[],furnace:{chipType:Po.PSG}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:Po.PCE}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:Po.PCE}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:Po.VIC}},{name:"VIC Noise",type:"synth",synthType:"FurnaceVIC",volume:-10,pan:0,effects:[],furnace:{chipType:Po.VIC}},{name:"TIA Square",type:"synth",synthType:"FurnaceTIA",volume:-8,pan:0,effects:[],furnace:{chipType:Po.TIA}},{name:"TIA Bass",type:"synth",synthType:"FurnaceTIA",volume:-6,pan:0,effects:[],furnace:{chipType:Po.TIA}},{name:"OPL3 FM Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:Po.OPL3,algorithm:0,feedback:6}},{name:"OPL3 FM Strings",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Po.OPL3,algorithm:1,feedback:2}},{name:"OPL3 FM Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:Po.OPL3,algorithm:0,feedback:4}},{name:"Amiga ST-01 Bass",type:"synth",synthType:"FurnaceAMIGA",volume:-6,pan:0,effects:[],furnace:{chipType:Po.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Lead Strings",type:"synth",synthType:"FurnaceAMIGA",volume:-8,pan:0,effects:[],furnace:{chipType:Po.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Poly Pad",type:"synth",synthType:"FurnaceAMIGA",volume:-10,pan:0,effects:[],furnace:{chipType:Po.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"PET Bleep",type:"synth",synthType:"FurnacePET",volume:-10,pan:0,effects:[],furnace:{chipType:Po.PET}},{name:"PC Speaker Beeper",type:"synth",synthType:"FurnacePCSPKR",volume:-10,pan:0,effects:[],furnace:{chipType:Po.PCSPKR}},{name:"ZX Beeper QuadTone",type:"synth",synthType:"FurnaceZXBEEPER",volume:-10,pan:0,effects:[],furnace:{chipType:Po.ZXBEEPER_QT}},{name:"SID Pulse PWM",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:Po.SID}},{name:"SID Ring Mod",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:Po.SID}},{name:"GBA Synth Bass",type:"synth",synthType:"FurnaceGBA",volume:-8,pan:0,effects:[],furnace:{chipType:Po.GBA_DMA}},{name:"GBA Lead Strings",type:"synth",synthType:"FurnaceGBA",volume:-10,pan:0,effects:[],furnace:{chipType:Po.GBA_DMA}},{name:"NDS Piano",type:"synth",synthType:"FurnaceNDS",volume:-10,pan:0,effects:[],furnace:{chipType:Po.NDS}},{name:"NDS Pad",type:"synth",synthType:"FurnaceNDS",volume:-12,pan:0,effects:[],furnace:{chipType:Po.NDS}},{name:"Virtual Boy Lead",type:"synth",synthType:"FurnaceVB",volume:-10,pan:0,effects:[],furnace:{chipType:Po.VB}},{name:"WonderSwan Wave",type:"synth",synthType:"FurnaceSWAN",volume:-10,pan:0,effects:[],furnace:{chipType:Po.SWAN}},{name:"Atari Lynx Pulse",type:"synth",synthType:"FurnaceLynx",volume:-10,pan:0,effects:[],furnace:{chipType:Po.LYNX}},{name:"Neo Geo Pocket Bass",type:"synth",synthType:"FurnaceT6W28",volume:-8,pan:0,effects:[],furnace:{chipType:Po.T6W28}},{name:"QSound Fat Bass",type:"synth",synthType:"FurnaceQSOUND",volume:-6,pan:0,effects:[],furnace:{chipType:Po.QSOUND}},{name:"Sega MultiPCM Strings",type:"synth",synthType:"FurnaceMULTIPCM",volume:-10,pan:0,effects:[],furnace:{chipType:Po.MULTIPCM}},{name:"Sega PCM Lead",type:"synth",synthType:"FurnaceSEGAPCM",volume:-8,pan:0,effects:[],furnace:{chipType:Po.SEGAPCM}},{name:"Namco C140 Drum",type:"synth",synthType:"FurnaceC140",volume:-6,pan:0,effects:[],furnace:{chipType:Po.C140}},{name:"OKI MSM6295 Kick",type:"synth",synthType:"FurnaceOKI",volume:-4,pan:0,effects:[],furnace:{chipType:Po.OKI}},{name:"OKI MSM6258 Snare",type:"synth",synthType:"FurnaceMSM6258",volume:-6,pan:0,effects:[],furnace:{chipType:Po.MSM6258}},{name:"YM2203 FM Bass",type:"synth",synthType:"FurnaceOPN2203",volume:-8,pan:0,effects:[],furnace:{chipType:Po.OPN,algorithm:4,feedback:5}},{name:"YM2608 FM Strings",type:"synth",synthType:"FurnaceOPNA",volume:-10,pan:0,effects:[],furnace:{chipType:Po.OPNA,algorithm:5,feedback:3}},{name:"YM2610 FM Lead",type:"synth",synthType:"FurnaceOPNB",volume:-8,pan:0,effects:[],furnace:{chipType:Po.OPNB,algorithm:4,feedback:6}},{name:"YMF278B FM Piano",type:"synth",synthType:"FurnaceOPL4",volume:-10,pan:0,effects:[],furnace:{chipType:Po.OPL4,algorithm:4,feedback:2}},{name:"VRC7 FM Brass",type:"synth",synthType:"FurnaceVRC7",volume:-10,pan:0,effects:[],furnace:{chipType:Po.OPLL,algorithm:0,feedback:4}}],If="/data/samples/packs/casio-mt40/leads",Df="/data/samples/packs/drumnibus",Of=[{name:"MT-40 Accordion",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/accordion.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/brass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Clarinet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/clarinet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Elec Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/elec piano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Harpsichord",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/harpsichord.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Pipe Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/pipe-organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Trumpet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/trumpet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Violin",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/violin.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Celesta",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${If}/celesta.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Funny Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/funny fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Xylophone",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/xylophone.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Gloken",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${If}/glocken.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Folk Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/folk flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 ST Ensemble",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${If}/st ensemble.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Synth Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${If}/synth fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${Df}/kicks/BD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Analog",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Df}/snares/SD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Wolf",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Df}/snares/SD_Wolf1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Percussion Tom",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Df}/percussion/TOM_Magnotron.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus HiHat Digidap",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Df}/hihats/CH_Digidap.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Player Analog Kick",type:"synth",synthType:"Player",volume:-6,pan:0,effects:[],parameters:{sampleUrl:`${Df}/kicks/BD_Analog1.wav`}},{name:"Player Analog Snare",type:"synth",synthType:"Player",volume:-8,pan:0,effects:[],parameters:{sampleUrl:`${Df}/snares/SD_Analog1.wav`}},{name:"Player Sci-Fi FX",type:"synth",synthType:"Player",volume:-10,pan:0,effects:[],parameters:{sampleUrl:`${Df}/fx/FX_AnalogFX1.wav`}},{name:"Granular Casio Flute",type:"synth",synthType:"GranularSynth",volume:-10,pan:0,effects:[],granular:{sampleUrl:`${If}/flute.wav`,grainSize:100,grainOverlap:50,detune:10,randomPitch:20,density:8,scanSpeed:10,playbackRate:1,randomPosition:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"Granular Drumnibus Texture",type:"synth",synthType:"GranularSynth",volume:-12,pan:0,effects:[],granular:{sampleUrl:`${Df}/fx/FX_Blarper.wav`,grainSize:200,grainOverlap:10,detune:-5,randomPosition:30,density:12,scanSpeed:5,playbackRate:1,randomPitch:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"MT-40 Full Lead Set",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:"",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1,multiMap:{C2:`${If}/bass.wav`,C3:`${If}/cello.wav`,C4:`${If}/elec piano.wav`,C5:`${If}/glocken.wav`,C6:`${If}/funny fuzz.wav`}}}],Ff=[{name:"Wavetable Bell",type:"synth",synthType:"Wavetable",volume:-12,pan:0,effects:[],wavetable:{wavetableId:"bell-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:1,detune:0,stereoSpread:0},envelope:{attack:10,decay:1e3,sustain:0,release:100},filter:{type:"lowpass",cutoff:12e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Brass",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"brass-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:2,detune:10,stereoSpread:50},envelope:{attack:50,decay:500,sustain:50,release:200},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:30},filterEnvelope:{attack:100,decay:300,sustain:0,release:100}}},{name:"Wavetable Choir",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"choir-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:4,detune:15,stereoSpread:80},envelope:{attack:200,decay:500,sustain:100,release:500},filter:{type:"lowpass",cutoff:4e3,resonance:5,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Heavy Bass",type:"synth",synthType:"Wavetable",volume:-8,pan:0,effects:[],wavetable:{wavetableId:"m4-bass01",morphPosition:0,morphModSource:"envelope",morphModAmount:50,morphLFORate:0,unison:{voices:2,detune:15,stereoSpread:40},envelope:{attack:5,decay:400,sustain:20,release:150},filter:{type:"lowpass",cutoff:2e3,resonance:40,envelopeAmount:60},filterEnvelope:{attack:10,decay:300,sustain:0,release:100}}}],Rf={"Soft Clip":{machineType:al.ARGURU_DISTORTION,parameters:{0:256,1:1024,2:1024,3:1024,4:0,5:0}},"Hard Clip":{machineType:al.ARGURU_DISTORTION,parameters:{0:512,1:256,2:256,3:768,4:0,5:0}},"Heavy Saturate":{machineType:al.ARGURU_DISTORTION,parameters:{0:768,1:512,2:512,3:1280,4:0,5:1}}},jf={"Low Pass":{machineType:al.ELAK_SVF,parameters:{0:500,1:512}},"Low Pass Resonant":{machineType:al.ELAK_SVF,parameters:{0:300,1:40960}},"High Pass":{machineType:al.ELAK_SVF,parameters:{0:700,1:1024}}},Lf={[al.ARGURU_DISTORTION]:Rf,[al.ELAK_SVF]:jf,[al.FSM_KICK]:{"Hard Kick":{machineType:al.FSM_KICK,parameters:{0:100,1:80}},"Soft Kick":{machineType:al.FSM_KICK,parameters:{0:60,1:40}},"Long 808-ish":{machineType:al.FSM_KICK,parameters:{0:80,1:120}}},[al.FSM_KICKXP]:{"Init KickXP":{machineType:al.FSM_KICKXP,parameters:{}},"Extreme Kick":{machineType:al.FSM_KICKXP,parameters:{0:127,1:127}}},[al.JESKOLA_TRILOK]:{"Punchy BD":{machineType:al.JESKOLA_TRILOK,parameters:{0:80,1:60}},"Deep BD":{machineType:al.JESKOLA_TRILOK,parameters:{0:40,1:90}}},[al.JESKOLA_NOISE]:{"White Noise":{machineType:al.JESKOLA_NOISE,parameters:{0:0}},"Pink Noise":{machineType:al.JESKOLA_NOISE,parameters:{0:1}},"Noisy FX":{machineType:al.JESKOLA_NOISE,parameters:{0:2,1:100}}},[al.OOMEK_AGGRESSOR]:{"Acid Bass":{machineType:al.OOMEK_AGGRESSOR,parameters:{1:120,2:96,3:80,4:64}},"Squelchy Lead":{machineType:al.OOMEK_AGGRESSOR,parameters:{1:160,2:127,3:96,4:80}},"Soft Sub":{machineType:al.OOMEK_AGGRESSOR,parameters:{1:48,2:32,3:32,4:96}}},[al.OOMEK_AGGRESSOR_DF]:{"DF Screamer":{machineType:al.OOMEK_AGGRESSOR_DF,parameters:{1:176,2:127,13:1,15:2}},"DF Infinite":{machineType:al.OOMEK_AGGRESSOR_DF,parameters:{1:96,10:100,9:127}}},[al.MADBRAIN_4FM2F]:{"FM Bass":{machineType:al.MADBRAIN_4FM2F,parameters:{0:10,1:80,2:40}},"FM Lead":{machineType:al.MADBRAIN_4FM2F,parameters:{0:40,1:100,2:60}},"FM Pad":{machineType:al.MADBRAIN_4FM2F,parameters:{0:60,1:50,2:100}}},[al.MADBRAIN_DYNAMITE6]:{"Additive Lead":{machineType:al.MADBRAIN_DYNAMITE6,parameters:{0:80,1:40}},"Organ-like":{machineType:al.MADBRAIN_DYNAMITE6,parameters:{0:60,1:100}}},[al.MAKK_M3]:{"M3 Lead":{machineType:al.MAKK_M3,parameters:{0:64,1:64}},"M3 Bass":{machineType:al.MAKK_M3,parameters:{0:127,1:32}}},[al.MAKK_M4]:{"M4 Wavetable":{machineType:al.MAKK_M4,parameters:{0:0}},"M4 Sweep":{machineType:al.MAKK_M4,parameters:{0:50,1:100}}},[al.CYANPHASE_DTMF]:{"Phone Tones":{machineType:al.CYANPHASE_DTMF,parameters:{}}},[al.ELENZIL_FREQUENCYBOMB]:{"Freq Bomb":{machineType:al.ELENZIL_FREQUENCYBOMB,parameters:{0:100}}},[al.ELAK_DIST2]:{},[al.JESKOLA_DISTORTION]:{},[al.GEONIK_OVERDRIVE]:{},[al.GRAUE_SOFTSAT]:{},[al.WHITENOISE_STEREODIST]:{},[al.CYANPHASE_NOTCH]:{},[al.Q_ZFILTER]:{},[al.FSM_PHILTA]:{},[al.JESKOLA_DELAY]:{},[al.JESKOLA_CROSSDELAY]:{},[al.JESKOLA_FREEVERB]:{},[al.FSM_PANZERDELAY]:{},[al.FSM_CHORUS]:{},[al.FSM_CHORUS2]:{},[al.WHITENOISE_WHITECHORUS]:{},[al.BIGYO_FREQUENCYSHIFTER]:{},[al.GEONIK_COMPRESSOR]:{},[al.LD_SLIMIT]:{},[al.OOMEK_EXCITER]:{},[al.OOMEK_MASTERIZER]:{},[al.DEDACODE_STEREOGAIN]:{}};function Bf(e){return Object.keys(function(e){return Lf[e]||{}}(e))}const Vf=[al.FSM_KICK,al.FSM_KICKXP,al.JESKOLA_TRILOK,al.JESKOLA_NOISE,al.OOMEK_AGGRESSOR,al.OOMEK_AGGRESSOR_DF,al.MADBRAIN_4FM2F,al.MADBRAIN_DYNAMITE6,al.MAKK_M3,al.MAKK_M4,al.CYANPHASE_DTMF,al.ELENZIL_FREQUENCYBOMB],zf=[];for(const MA of Vf){const e=Lf[MA];if(e)for(const[t,n]of Object.entries(e)){const e=`Buzz ${t}`;zf.push({name:e,type:"synth",synthType:`Buzz${Uf(MA)}`,volume:-10,pan:0,effects:[],parameters:n.parameters})}}function Uf(e){switch(e){case al.FSM_KICK:return"Kick";case al.FSM_KICKXP:return"KickXP";case al.JESKOLA_TRILOK:return"Trilok";case al.JESKOLA_NOISE:return"Noise";case al.OOMEK_AGGRESSOR:return"Aggressor";case al.OOMEK_AGGRESSOR:return"3o3";case al.OOMEK_AGGRESSOR_DF:return"3o3DF";case al.MADBRAIN_4FM2F:return"4FM2F";case al.MADBRAIN_DYNAMITE6:return"Dynamite6";case al.MAKK_M3:return"M3";case al.MAKK_M4:return"M4";case al.CYANPHASE_DTMF:return"DTMF";case al.ELENZIL_FREQUENCYBOMB:return"FreqBomb";default:return e}}const Gf=[{name:"M4 Deep Bass",type:"synth",synthType:"BuzzM4",volume:-8,pan:0,effects:[],parameters:{0:1,1:64,2:32,3:80}},{name:"M4 Sub Bass",type:"synth",synthType:"BuzzM4",volume:-6,pan:0,effects:[],parameters:{0:5,1:0,2:20}},{name:"M4 Rezzy Growl",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:13,1:127,2:45,3:110}},{name:"M4 Sharp Saw",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:20,1:64,2:100,3:20}},{name:"M4 Digi Lead",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:45,1:80,2:120}},{name:"M4 Sync Lead",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:30,1:64,4:12}},{name:"M4 Soft Pad",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:60,1:64,2:60,3:10}},{name:"M4 Metallic Text",type:"synth",synthType:"BuzzM4",volume:-14,pan:0,effects:[],parameters:{0:85,1:100,2:80,3:90}}],Wf=[{type:"synth",name:"Classic Wobble",synthType:"WobbleBass",wobbleBass:{mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Growl Bass",synthType:"WobbleBass",wobbleBass:{mode:"growl",osc1:{type:"sawtooth",octave:-2,detune:0,level:100},osc2:{type:"square",octave:-2,detune:5,level:70},sub:{enabled:!0,octave:-2,level:80},fm:{enabled:!0,amount:40,ratio:1,envelope:60},unison:{voices:2,detune:10,stereoSpread:30},filter:{type:"bandpass",cutoff:600,resonance:40,rolloff:-12,drive:50,keyTracking:20},filterEnvelope:{amount:50,attack:10,decay:400,sustain:40,release:200},wobbleLFO:{enabled:!0,sync:"1/8",rate:4,shape:"saw",amount:60,pitchAmount:0,fmAmount:30,phase:0,retrigger:!0},envelope:{attack:5,decay:300,sustain:60,release:200},distortion:{enabled:!0,type:"hard",drive:60,tone:50},formant:{enabled:!0,vowel:"O",morph:50,lfoAmount:40}},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Wobble",synthType:"WobbleBass",wobbleBass:{mode:"reese",osc1:{type:"sawtooth",octave:-1,detune:-10,level:90},osc2:{type:"sawtooth",octave:-1,detune:10,level:90},sub:{enabled:!0,octave:-2,level:70},fm:{enabled:!1,amount:0,ratio:1,envelope:0},unison:{voices:6,detune:25,stereoSpread:80},filter:{type:"lowpass",cutoff:1200,resonance:30,rolloff:-24,drive:20,keyTracking:0},filterEnvelope:{amount:0,attack:0,decay:0,sustain:0,release:0},wobbleLFO:{enabled:!0,sync:"1/2",rate:1,shape:"triangle",amount:50,pitchAmount:0,fmAmount:0,phase:0,retrigger:!1},envelope:{attack:20,decay:500,sustain:100,release:800},distortion:{enabled:!0,type:"soft",drive:30,tone:60},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Pluck Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:300,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Fat Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:5,octave:-1},envelope:{attack:10,decay:400,sustain:.4,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Sine Sub",synthType:"Synth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:65},filterEnvelope:{envMod:60,decay:200},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:85},filterEnvelope:{envMod:80,decay:150},accent:{amount:80},slide:{time:50,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Deep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:40},filterEnvelope:{envMod:30,decay:300},accent:{amount:60},slide:{time:80,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:700,resonance:60},filterEnvelope:{envMod:50,decay:180},accent:{amount:70},slide:{time:60,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:92},filterEnvelope:{envMod:95,decay:100},accent:{amount:90},slide:{time:40,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Bubbly",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:75},filterEnvelope:{envMod:70,decay:80},accent:{amount:75},slide:{time:30,mode:"exponential"}},effects:[],volume:-12,pan:0},{type:"synth",name:"303 Self-Osc",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:98},filterEnvelope:{envMod:85,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"}},effects:[],volume:-14,pan:0},{type:"synth",name:"303 Plastikman",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:40,decay:250},accent:{amount:65},slide:{time:100,mode:"exponential"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Classic",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:70},filterEnvelope:{envMod:55,decay:250},accent:{amount:75},slide:{time:50,mode:"exponential"},devilFish:{enabled:!0,normalDecay:300,accentDecay:150,vegDecay:2500,vegSustain:0,softAttack:2,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Infinite Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:600,resonance:55},filterEnvelope:{envMod:30,decay:400},accent:{amount:50},slide:{time:120,mode:"exponential"},devilFish:{enabled:!0,normalDecay:800,accentDecay:600,vegDecay:3e3,vegSustain:100,softAttack:15,filterTracking:50,filterFmDepth:10,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1400,resonance:85},filterEnvelope:{envMod:80,decay:350},accent:{amount:100},slide:{time:30,mode:"exponential"},overdrive:{amount:70,modelIndex:0,drive:70,dryWet:100},devilFish:{enabled:!0,normalDecay:200,accentDecay:100,vegDecay:500,vegSustain:20,softAttack:.5,filterTracking:80,filterFmDepth:80,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!0,muffler:"hard"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Whistler",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1600,resonance:92},filterEnvelope:{envMod:70,decay:500},accent:{amount:80},slide:{time:100,mode:"exponential"},devilFish:{enabled:!0,normalDecay:400,accentDecay:300,vegDecay:1500,vegSustain:30,softAttack:5,filterTracking:150,filterFmDepth:25,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Muffled Punch",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:800,resonance:60},filterEnvelope:{envMod:65,decay:150},accent:{amount:90},slide:{time:45,mode:"exponential"},devilFish:{enabled:!0,normalDecay:100,accentDecay:80,vegDecay:200,vegSustain:0,softAttack:.5,filterTracking:30,filterFmDepth:15,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Acid Low",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:400,resonance:72},filterEnvelope:{envMod:50,decay:300},accent:{amount:80},slide:{time:80,mode:"exponential"},devilFish:{enabled:!0,normalDecay:250,accentDecay:120,vegDecay:800,vegSustain:15,softAttack:1.5,filterTracking:40,filterFmDepth:20,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Resonant Sweep",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1200,resonance:88},filterEnvelope:{envMod:90,decay:600},accent:{amount:95},slide:{time:60,mode:"exponential"},devilFish:{enabled:!0,normalDecay:500,accentDecay:400,vegDecay:1200,vegSustain:10,softAttack:3,filterTracking:100,filterFmDepth:35,sweepSpeed:"slow",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Soft Pad",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:700,resonance:40},filterEnvelope:{envMod:20,decay:800},accent:{amount:30},slide:{time:200,mode:"exponential"},devilFish:{enabled:!0,normalDecay:1500,accentDecay:1200,vegDecay:3e3,vegSustain:80,softAttack:25,filterTracking:60,filterFmDepth:5,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Hardstyle",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1800,resonance:75},filterEnvelope:{envMod:85,decay:80},accent:{amount:100},slide:{time:25,mode:"exponential"},overdrive:{amount:60,modelIndex:0,drive:60,dryWet:100},devilFish:{enabled:!0,normalDecay:60,accentDecay:40,vegDecay:150,vegSustain:0,softAttack:.3,filterTracking:50,filterFmDepth:45,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-12,pan:0},{type:"synth",name:"DF Singing Filter",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2200,resonance:95},filterEnvelope:{envMod:60,decay:700},accent:{amount:70},slide:{time:150,mode:"exponential"},devilFish:{enabled:!0,normalDecay:600,accentDecay:500,vegDecay:2e3,vegSustain:50,softAttack:8,filterTracking:180,filterFmDepth:15,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Gritty Bass",synthType:"TB303",tb303:{oscillator:{type:"square"},filter:{cutoff:500,resonance:65},filterEnvelope:{envMod:45,decay:200},accent:{amount:85},slide:{time:70,mode:"exponential"},overdrive:{amount:40,modelIndex:0,drive:40,dryWet:100},devilFish:{enabled:!0,normalDecay:180,accentDecay:100,vegDecay:400,vegSustain:5,softAttack:1,filterTracking:25,filterFmDepth:55,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"hard"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Bubbly Acid",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:1500,resonance:78},filterEnvelope:{envMod:75,decay:50},accent:{amount:90},slide:{time:20,mode:"exponential"},devilFish:{enabled:!0,normalDecay:40,accentDecay:30,vegDecay:100,vegSustain:0,softAttack:.5,filterTracking:70,filterFmDepth:30,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"off"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Ambient Drone",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:900,resonance:50},filterEnvelope:{envMod:25,decay:1500},accent:{amount:35},slide:{time:300,mode:"exponential"},devilFish:{enabled:!0,normalDecay:2500,accentDecay:2e3,vegDecay:3e3,vegSustain:95,softAttack:30,filterTracking:80,filterFmDepth:8,sweepSpeed:"slow",accentSweepEnabled:!1,highResonance:!1,muffler:"soft"}},effects:[],volume:-14,pan:0},{type:"synth",name:"DF Techno Stab",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:2e3,resonance:70},filterEnvelope:{envMod:70,decay:100},accent:{amount:100},slide:{time:30,mode:"exponential"},devilFish:{enabled:!0,normalDecay:80,accentDecay:50,vegDecay:180,vegSustain:0,softAttack:.3,filterTracking:45,filterFmDepth:40,sweepSpeed:"fast",accentSweepEnabled:!0,highResonance:!1,muffler:"soft"}},effects:[],volume:-10,pan:0},{type:"synth",name:"DF Screaming Lead",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:3e3,resonance:90},filterEnvelope:{envMod:95,decay:400},accent:{amount:100},slide:{time:50,mode:"exponential"},overdrive:{amount:50,modelIndex:0,drive:50,dryWet:100},devilFish:{enabled:!0,normalDecay:350,accentDecay:250,vegDecay:800,vegSustain:25,softAttack:2,filterTracking:150,filterFmDepth:60,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!0,muffler:"off"}},effects:[],volume:-16,pan:0},{type:"synth",name:"808 Sub",synthType:"MonoSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:1,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:15,octave:0},envelope:{attack:10,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:800,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"House Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Wobble Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:400,sustain:0,release:100},filter:{type:"lowpass",frequency:1e3,Q:8,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Duo Sub Bass",synthType:"DuoSynth",oscillator:{type:"triangle",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:1,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},...af,...lf],Kf=[{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Pluck Keys",synthType:"PluckSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2500,Q:1,rolloff:-12},effects:[],volume:-10,pan:0},{type:"synth",name:"Guitar Pluck",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:200,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"AM Bell",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"AM Sci-Fi",synthType:"AMSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:.5,release:1e3},effects:[],volume:-6,pan:0},{type:"synth",name:"FM Electric Piano",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:.2,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Saw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:10,decay:200,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Square Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:100,sustain:.8,release:100},effects:[],volume:-10,pan:0},{type:"synth",name:"Supersaw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:20,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Acid Lead",synthType:"MonoSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:350,sustain:0,release:200},filter:{type:"lowpass",frequency:2e3,Q:5,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Sync Lead",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:10,decay:450,sustain:0,release:300},filter:{type:"lowpass",frequency:2500,Q:3,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:3e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Detuned Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:25,octave:0},envelope:{attack:30,decay:450,sustain:0,release:400},filter:{type:"lowpass",frequency:2800,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Filtered Lead",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"AM Tremolo Lead",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"FM Bell Lead",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:1e3,sustain:0,release:800},effects:[],volume:-10,pan:0},{type:"synth",name:"Harp Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:800,sustain:0,release:500},effects:[],volume:-8,pan:0},{type:"synth",name:"Nylon Guitar",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1,decay:1200,sustain:0,release:1e3},effects:[],volume:-8,pan:0},{type:"synth",name:"PWM Solo Lead",synthType:"PWMSynth",pwmSynth:{pulseWidth:20,pwmDepth:40,pwmRate:1.5,pwmWaveform:"sine",oscillators:2,detune:5,envelope:{attack:10,decay:300,sustain:.6,release:200},filter:{type:"lowpass",cutoff:3e3,resonance:30,envelopeAmount:20,keyTracking:50},filterEnvelope:{attack:5,decay:400,sustain:.2,release:100}},effects:[],volume:-10,pan:0},{type:"synth",name:"Poly Brass",synthType:"PolySynth",polySynth:{voiceCount:6,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:50,decay:400,sustain:.7,release:200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SuperSaw Lead",synthType:"SuperSaw",superSaw:{voices:7,detune:40,mix:70,stereoSpread:80,envelope:{attack:10,decay:300,sustain:50,release:200},filter:{type:"lowpass",cutoff:5e3,resonance:20,envelopeAmount:50},filterEnvelope:{attack:5,decay:400,sustain:0,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Robot Talk",synthType:"FormantSynth",formantSynth:{vowel:"E",vowelMorph:{target:"U",amount:80,rate:2,mode:"manual"},oscillator:{type:"square"},formants:{...ga.E,bandwidth:120},envelope:{attack:5,decay:200,sustain:.5,release:100},brightness:80},effects:[],volume:-10,pan:0}],Hf=[{type:"synth",name:"Ambient Pad",synthType:"Synth",oscillator:{type:"sine",detune:3,octave:0},envelope:{attack:800,decay:2e3,sustain:0,release:1500},filter:{type:"lowpass",frequency:1500,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Dark Pad",synthType:"DuoSynth",oscillator:{type:"triangle",detune:8,octave:0},envelope:{attack:1e3,decay:2500,sustain:0,release:2e3},filter:{type:"lowpass",frequency:800,Q:2,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"String Pad",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:500,decay:1800,sustain:0,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1.5,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Noise Sweep",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:1500,sustain:0,release:1e3},filter:{type:"bandpass",frequency:1e3,Q:5,rolloff:-24},effects:[],volume:-18,pan:0},{type:"synth",name:"AM Atmospheric",synthType:"AMSynth",oscillator:{type:"sine",detune:5,octave:0},envelope:{attack:1500,decay:3e3,sustain:.8,release:2e3},effects:[],volume:-12,pan:0},{type:"synth",name:"Wavetable Evolving Pad",synthType:"Wavetable",wavetable:{wavetableId:"evolve-1",morphPosition:0,morphModSource:"lfo",morphModAmount:80,morphLFORate:.1,unison:{voices:4,detune:12,stereoSpread:60},envelope:{attack:1e3,decay:2e3,sustain:.7,release:1500},filter:{type:"lowpass",cutoff:1500,resonance:20,envelopeAmount:30},filterEnvelope:{attack:2e3,decay:1e3,sustain:.5,release:1e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"Poly Soft Strings",synthType:"PolySynth",polySynth:{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:500,decay:1e3,sustain:.8,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-14,pan:0},{type:"synth",name:"PWM Strings",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:30,pwmRate:.5,pwmWaveform:"sine",oscillators:3,detune:12,envelope:{attack:800,decay:1500,sustain:.9,release:1500},filter:{type:"lowpass",cutoff:1200,resonance:15,envelopeAmount:0,keyTracking:30},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Solina Ensemble",synthType:"StringMachine",stringMachine:{sections:{violin:100,viola:80,cello:60,bass:40},ensemble:{depth:70,rate:2.5,voices:4},attack:300,release:1500,brightness:50},effects:[],volume:-10,pan:0},{type:"synth",name:"Ethereal Choir",synthType:"FormantSynth",formantSynth:{vowel:"A",vowelMorph:{target:"O",amount:50,rate:.2,mode:"lfo"},oscillator:{type:"sawtooth"},formants:{...ga.A,bandwidth:80},envelope:{attack:1e3,decay:2e3,sustain:.8,release:2e3},brightness:60},effects:[],volume:-12,pan:0},{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"Wavetable Morph Pad",synthType:"Wavetable",wavetable:{wavetableId:"morph-2",morphPosition:50,morphModSource:"lfo",morphModAmount:40,morphLFORate:.2,unison:{voices:6,detune:20,stereoSpread:90},envelope:{attack:1200,decay:2500,sustain:.8,release:2e3},filter:{type:"lowpass",cutoff:2e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"PWM Soft Pad",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:20,pwmRate:.3,pwmWaveform:"sine",oscillators:2,detune:8,envelope:{attack:1500,decay:2e3,sustain:.9,release:2e3},filter:{type:"lowpass",cutoff:800,resonance:5,envelopeAmount:0,keyTracking:20},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-14,pan:0},{type:"synth",name:"Granular Cloud",synthType:"GranularSynth",granular:{sampleUrl:"",grainSize:.1,grainOverlap:.05,detune:5,playbackRate:1,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:1,reverse:!1,envelope:{attack:10,release:100},filter:{type:"lowpass",cutoff:2e3,resonance:1}},effects:[],volume:-10,pan:0}],$f=[hf,mf,ff,{type:"synth",name:"808 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:100,Q:1,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:300,sustain:0,release:50},filter:{type:"lowpass",frequency:80,Q:2,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"Hardcore Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:150,sustain:0,release:20},filter:{type:"lowpass",frequency:120,Q:3,rolloff:-24},effects:[],volume:-4,pan:0},{type:"synth",name:"DnB Snare",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:300,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Clap",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:150,sustain:0,release:50},filter:{type:"bandpass",frequency:1e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Closed Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:50,sustain:0,release:20},filter:{type:"highpass",frequency:8e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Open Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:200},filter:{type:"highpass",frequency:7e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:1500,sustain:0,release:1e3},filter:{type:"highpass",frequency:6e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Synth Low Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:400,sustain:0,release:100},effects:[],volume:-8,pan:-20},{type:"synth",name:"Synth Mid Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:350,sustain:0,release:80},effects:[],volume:-8,pan:0},{type:"synth",name:"Synth Hi Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:60},effects:[],volume:-8,pan:20},...gf],qf=[{type:"synth",name:"NES Major Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:15,delay:200},arpeggio:{enabled:!0,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"C64 Minor Arp",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:4,depth:10,delay:300},arpeggio:{enabled:!0,speed:12,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"SID Dim7 Pad",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:50,decay:600,sustain:0,release:500},vibrato:{speed:3,depth:8,delay:100},arpeggio:{enabled:!0,speed:8,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:6},{noteOffset:9}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Gameboy Sus4",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:12.5},bitDepth:4,sampleRate:16384,envelope:{attack:1,decay:200,sustain:0,release:100},vibrato:{speed:6,depth:20,delay:150},arpeggio:{enabled:!0,speed:18,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:5},{noteOffset:7}],mode:"loop"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Atari Dom7",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:4,sampleRate:15720,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:20,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Amiga Power Oct",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:8,sampleRate:28867,envelope:{attack:5,decay:300,sustain:0,release:250},vibrato:{speed:4,depth:12,delay:200},arpeggio:{enabled:!0,speed:14,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Fast Maj9 Stab",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:150,sustain:0,release:80},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:30,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:11},{noteOffset:14}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Slow Min7 Sweep",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:100,decay:800,sustain:0,release:600},vibrato:{speed:3,depth:15,delay:500},arpeggio:{enabled:!0,speed:4,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Square Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:200},vibrato:{speed:6,depth:15,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Triangle Bass",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:4,sampleRate:22050,envelope:{attack:1,decay:400,sustain:0,release:150},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12}],mode:"loop"}},effects:[],volume:-6,pan:0},{type:"synth",name:"Noise Snare",synthType:"ChipSynth",chipSynth:{channel:"noise",bitDepth:1,sampleRate:22050,envelope:{attack:1,decay:100,sustain:0,release:50},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Octave Jump",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:10,delay:250},arpeggio:{enabled:!0,speed:10,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12},{noteOffset:24}],mode:"loop"}},effects:[],volume:-10,pan:0}],Yf=[{type:"synth",name:"909 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3}},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",snare:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Rim",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:100,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:300,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:60,decay:50,metallic:65}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:55,decay:350,metallic:60}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Ride",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:800,sustain:.1,release:500},filter:{type:"highpass",frequency:5e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"909 Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:2e3,sustain:.05,release:1500},filter:{type:"highpass",frequency:4e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0}],Xf=[{type:"synth",name:"808 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",machineType:"808",kick:{pitch:48,pitchDecay:110,tone:50,toneDecay:20,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",machineType:"808",snare:{pitch:238,pitchHigh:476,tone:50,toneDecay:75,snappy:50,decay:100,envAmount:1,envDuration:100,filterType:"highpass",filterFreq:1300}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",machineType:"808",clap:{tone:50,decay:115,toneDecay:200,spread:100,filterFreqs:[1e3,1e3],modulatorFreq:10}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Rimshot",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",machineType:"808",rimshot:{decay:40,filterFreqs:[480,1750,2450],filterQ:5,saturation:2.5}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Clave",synthType:"DrumMachine",drumMachine:{drumType:"clave",machineType:"808",clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Cowbell",synthType:"DrumMachine",drumMachine:{drumType:"cowbell",machineType:"808",cowbell:{decay:400,filterFreq:2640}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Maracas",synthType:"DrumMachine",drumMachine:{drumType:"maracas",machineType:"808",maracas:{decay:30,filterFreq:5e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:90,decay:200,tone:20,toneDecay:155,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:140,decay:190,tone:20,toneDecay:130,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:190,decay:180,tone:20,toneDecay:100,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Low Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:190,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:280,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:410,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:50,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:270,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Cymbal",synthType:"DrumMachine",drumMachine:{drumType:"cymbal",machineType:"808",cymbal:{tone:50,decay:3e3}},effects:[],volume:-14,pan:0}],Qf=[{type:"synth",name:"Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"Downlifter",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:2e3,sustain:0,release:100},filter:{type:"lowpass",frequency:5e3,Q:3,rolloff:-24},effects:[],volume:-14,pan:0},{type:"synth",name:"Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:2,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Laser Zap",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-12,pan:0}],Zf=[{type:"synth",name:"Web Audio Module (WAM)",synthType:"WAM",wam:{moduleUrl:"",pluginState:null},effects:[],volume:-12,pan:0}],Jf=[{type:"synth",name:"505 Kick",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Snare",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Clap",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Rim",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"505 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"505 Crash",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"505 Ride",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"505 Low Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 High Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Low Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-20},{type:"synth",name:"505 High Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:20},{type:"synth",name:"505 Timbale",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-timbal.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}],ey=[{type:"synth",name:"707 Kick",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Kick Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Snare",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Clap",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Rim",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Low Tom Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"707 Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-cowbell.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Crash",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"707 Ride",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"707 Tambourine",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tambourine.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0}],ty=[{type:"synth",name:"DN 808 A1200",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN SubThud",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_SubThud.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Punchtron Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN 808 Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Analog Noise",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro 7000",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_electro7000.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Wolf Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Wolf1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Closed Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Open Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Analog Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Cymbal",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CYM_Synthique.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Clap",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Clave",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Tom",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Lazer",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/LAZ_R900.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Sonar",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Sonar.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Laser",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Burst",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Burst1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0}],ny=[{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"VFX Evolving",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},{type:"synth",name:"ESQ-1 Gritty Keys",synthType:"MAMEDOC",effects:[],volume:-10,pan:0},{type:"synth",name:"MKS-20 E.Piano 1",synthType:"MAMERSA",effects:[],volume:-10,pan:0},{type:"synth",name:"RD-1000 Grand",synthType:"MAMERSA",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Grand Piano",synthType:"MAMESWP30",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Synth Brass",synthType:"MAMESWP30",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Brass 1",synthType:"CZ101",effects:[],volume:-8,pan:0},{type:"synth",name:"CZ Electric Piano",synthType:"CZ101",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Synth Bass",synthType:"CZ101",effects:[],volume:-6,pan:0},{type:"synth",name:"CZ Digital Pad",synthType:"CZ101",effects:[],volume:-10,pan:0}],ay=[{type:"synth",name:"Jazz Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!0,volume:60,decay:"fast",harmonic:"third"},keyClick:40,vibrato:{type:"C3",depth:60},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Gospel Organ",synthType:"Organ",organ:{drawbars:[8,8,8,8,8,8,8,8,8],percussion:{enabled:!1,volume:50,decay:"slow",harmonic:"second"},keyClick:20,vibrato:{type:"V3",depth:40},rotary:{enabled:!0,speed:"slow"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Church Organ",synthType:"Organ",organ:{drawbars:[8,0,8,0,8,0,0,8,8],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:0,vibrato:{type:"V1",depth:20},rotary:{enabled:!1,speed:"slow"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Rock Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:80,vibrato:{type:"C3",depth:80},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-8,pan:0}],sy=[{type:"synth",name:"Generic Module",synthType:"ChiptuneModule",effects:[],volume:-6,pan:0}],ry=[...Wf,...Kf,...Hf,...$f,...ny,...Ef,...ay,...sy,...Xf,...Yf,...ey,...Jf,...qf,...of,..._f,...Qf,...Zf,...lf,...cf,...yf,...Nf,...Cf,...ty,...Mf,...Tf,...Af,...Of,...Ff,...zf,...Gf,{type:"synth",name:"Sample Player",synthType:"Player",volume:-6,pan:0,effects:[]}],oy={Bass:Wf,Leads:Kf,Pads:Hf,Drums:$f,MAME:[...ny,...Ef],Keys:ay,Module:sy,"TR-808":Xf,"TR-909":Yf,"TR-707":ey,"TR-505":Jf,Chip:qf,Furnace:[...of,..._f],FX:Qf,WAM:Zf,Dub:[...lf,...cf,...yf,...Nf,...gf],DubSiren:lf,SpaceLaser:cf,V2:[...yf,...Nf],Sam:Cf,Synare:gf,Drumnibus:[...Mf,...ty],Dexed:Tf,OBXd:Af,Samples:Of,Wavetables:Ff,Buzz:zf,Makk:Gf};function iy(e){const t=oy[e];if(t&&t.length>0)return t[0];const n=ry.find(t=>t.synthType===e);if(n)return n;const a=af.find(t=>t.synthType===e);if(a)return a;const s=gf.find(t=>t.synthType===e);return s||null}class ly{view;offset=0;size;constructor(e){e instanceof DataView?this.view=e:this.view=new DataView(e),this.size=this.view.byteLength}getOffset(){return this.offset}setOffset(e){this.offset=e}getSize(){return this.size}seek(e){this.offset=e}skip(e){this.offset+=e}isEOF(){return this.offset>=this.size}readUint8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.view.getInt8(this.offset);return this.offset+=1,e}readUint16(e=!0){const t=this.view.getUint16(this.offset,e);return this.offset+=2,t}readInt16(e=!0){const t=this.view.getInt16(this.offset,e);return this.offset+=2,t}readUint32(e=!0){const t=this.view.getUint32(this.offset,e);return this.offset+=4,t}readInt32(e=!0){const t=this.view.getInt32(this.offset,e);return this.offset+=4,t}readFloat32(e=!0){const t=this.view.getFloat32(this.offset,e);return this.offset+=4,t}readString(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);this.offset+=e;let n=0;for(;n<e&&0!==t[n];)n++;return(new TextDecoder).decode(t.slice(0,n))}readNullTerminatedString(){let e=0;for(;this.offset+e<this.size&&0!==this.view.getUint8(this.offset+e);)e++;const t=this.readString(e);return this.offset<this.size&&this.offset++,t}readPrefixedString(){const e=this.readUint8();return 0===e?"":this.readString(e)}readPrefixedString16(){const e=this.readUint16();return 0===e?"":this.readString(e)}readPrefixedString32(){const e=this.readUint32();return 0===e?"":this.readString(e)}readBytes(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,new Uint8Array(t)}readMagic(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,Array.from(t).map(e=>String.fromCharCode(e)).join("")}}class cy{static parse(e){const t=new ly(e);if(t.readMagic(16).startsWith("-Furnace instr."))return this.parseOldFormat(t);t.seek(0);const n=t.readMagic(4);if("FINS"===n||"INS2"===n||"INST"===n)return this.parseNewFormat(t,n);throw new Error(`Invalid Furnace instrument header: ${n}`)}static parseNewFormat(e,t){"INS2"===t&&e.skip(4),e.skip(2);const n=e.readUint8(),a={...ka,chipType:n,operators:Array.from({length:4},()=>({...ka.operators[0]})),macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]};let s="Furnace Instrument";const r=[];for(;!e.isEOF();)try{if(e.getOffset()+4>e.getSize())break;const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),o=e.getOffset()+n;if(o>e.getSize())break;switch(t){case"NA":case"NM":s=e.readString(n);break;case"FM":this.readFMFeature(e,a);break;case"WV":case"WL":case"LW":this.readWavePointers(e,r)}e.seek(o)}catch(o){break}return this.loadWavetables(e,r,a),{name:s,config:a}}static parseOldFormat(e){e.seek(16),e.skip(4);const t=e.readUint32(),n=e.readUint16(),a=e.readUint16();e.skip(4);const s=[];for(let l=0;l<n;l++)s.push(e.readUint32());if(e.skip(4*a),t>=e.getSize())throw new Error("Invalid data pointer");if(e.seek(t),"INST"!==e.readMagic(4))throw new Error("Invalid INST block");e.skip(4),e.skip(2);const r=e.readUint8();e.skip(1);const o=e.readNullTerminatedString(),i={...ka,chipType:r,operators:[],macros:[],opMacros:[],wavetables:[]};if(e.getOffset()+8<=e.getSize()){i.algorithm=e.readUint8(),i.feedback=e.readUint8(),e.skip(2);const t=e.readUint8();e.skip(3);for(let n=0;n<4&&!(e.getOffset()+12>e.getSize());n++){const a={enabled:n<t,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.getOffset()+10<=e.getSize()&&e.skip(10),i.operators.push(a)}}return 0===i.operators.length&&(i.operators=Array.from({length:4},()=>({...ka.operators[0]}))),this.loadWavetables(e,s,i),{name:o,config:i}}static readFMFeature(e,t){const n=e.readUint8(),a=15&n,s=n>>4&15;t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),e.skip(2),t.operators=[];for(let r=0;r<a;r++){const n={enabled:!!(s>>r&1),mult:15&e.readUint8(),dt:e.readUint8()>>4&7,dt2:0,tl:e.readUint8(),ar:31&e.readUint8(),dr:31&e.readUint8(),d2r:0,sl:e.readUint8()>>4&15,rr:15&e.readUint8(),rs:0,ssg:15&e.readUint8(),am:!1,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};t.operators.push(n)}}static readWavePointers(e,t){const n=e.readUint16();e.skip(2*n);for(let a=0;a<n;a++)t.push(e.readUint32())}static loadWavetables(e,t,n){for(const a of t)if(a>0&&a<e.getSize()){e.seek(a);const t=this.readWaveBlock(e);t&&n.wavetables.push(t)}}static readWaveBlock(e){if(e.getOffset()+4>e.getSize())return null;if("WAVE"!==e.readMagic(4))return null;e.skip(20);const t=e.readUint32();e.skip(8);const n=[];for(let a=0;a<t&&!(e.getOffset()+4>e.getSize());a++)n.push(e.readInt32());return{id:0,data:n}}}const dy={1:{id:1,name:"YMU759",chipType:19,fmChannels:17,psgChannels:0,totalChannels:17},2:{id:2,name:"Genesis",chipType:0,fmChannels:6,psgChannels:4,totalChannels:10},3:{id:3,name:"SMS",chipType:3,fmChannels:0,psgChannels:4,totalChannels:4},4:{id:4,name:"Game Boy",chipType:5,fmChannels:0,psgChannels:4,totalChannels:4},5:{id:5,name:"PC Engine",chipType:6,fmChannels:0,psgChannels:6,totalChannels:6},6:{id:6,name:"NES",chipType:4,fmChannels:0,psgChannels:5,totalChannels:5},7:{id:7,name:"C64",chipType:10,fmChannels:0,psgChannels:3,totalChannels:3},8:{id:8,name:"Arcade",chipType:1,fmChannels:13,psgChannels:0,totalChannels:13},9:{id:9,name:"Neo Geo",chipType:14,fmChannels:4,psgChannels:7,totalChannels:13},10:{id:10,name:"Genesis Ext",chipType:0,fmChannels:9,psgChannels:4,totalChannels:13},11:{id:11,name:"SMS + OPLL",chipType:11,fmChannels:9,psgChannels:4,totalChannels:13},12:{id:12,name:"NES + VRC7",chipType:4,fmChannels:6,psgChannels:5,totalChannels:11},13:{id:13,name:"NES + FDS",chipType:16,fmChannels:0,psgChannels:6,totalChannels:6}};class uy{static SYSTEM_MAP={1:19,2:0,3:3,4:5,5:6,6:4,7:10,8:1,9:14,10:0,11:11,12:4,13:16};static parse(e,t){const n=new ly(e),a=n.readMagic(16);if("dmf"===t){if(!a.startsWith(".DeFleMask."))throw new Error("Invalid DMF magic");return this.parseDMF(n,a)}if("dmp"===t)return n.seek(0),this.parseDMP(n);if("dmw"===t)return n.seek(0),this.parseDMW(n);throw new Error(`Unknown format: ${t}`)}static parseDMF(e,t){const n=this.extractVersion(t),a=e.readUint8(),s=dy[a]??dy[2],r={version:n,system:s,name:"",author:"",timeBase:0,ticksPerRow:[6,6],framesPerTick:1,patternRows:64,matrixRows:1,arpeggioTickSpeed:1,instruments:[],wavetables:[],patterns:[],patternMatrix:[],channelCount:s.totalChannels};if(n>=17?(r.name=e.readPrefixedString(),r.author=e.readPrefixedString(),e.readUint8(),e.readUint8()):n>=10&&(r.name=e.readNullTerminatedString(),r.author=e.readNullTerminatedString()),r.timeBase=e.readUint8(),r.ticksPerRow=[e.readUint8(),e.readUint8()],n>=14&&(r.framesPerTick=e.readUint8()),n>=19){e.readUint8()&&(e.readUint8(),e.readUint8(),e.readUint8())}r.patternRows=e.readUint32(),r.matrixRows=e.readUint8(),n>=21&&(r.arpeggioTickSpeed=e.readUint8()),r.patternMatrix=[];for(let l=0;l<r.channelCount;l++){const t=[];for(let n=0;n<r.matrixRows;n++)t.push(e.readUint8());r.patternMatrix.push(t)}const o=e.readUint8();for(let l=0;l<o;l++){const t=this.parseInstrument(e,n,s);r.instruments.push(t)}const i=e.readUint8();for(let l=0;l<i;l++){const t=e.readUint32(),n=[];for(let a=0;a<t;a++)n.push(e.readUint32());r.wavetables.push(n)}for(let l=0;l<r.channelCount;l++){const t=e.readUint8();for(let n=0;n<r.matrixRows;n++){const n={rows:[]};for(let a=0;a<r.patternRows;a++){const s={note:e.readUint16(),octave:e.readUint16(),volume:e.readInt16(),instrument:e.readInt16(),effects:[]};for(let n=0;n<t;n++){const t=e.readInt16(),n=e.readInt16();t>=0&&s.effects.push({code:t,value:n})}n.rows[a]||(n.rows[a]=[]),n.rows[a][l]=s}r.patterns.push(n)}}return r}static extractVersion(e){const t=e.match(/\.DeFleMask\.(\d+)/);return t?parseInt(t[1],10):24}static parseInstrument(e,t,n){const a=t>=17?e.readPrefixedString():e.readNullTerminatedString(),s=e.readUint8(),r={...ka,chipType:this.SYSTEM_MAP[n.id]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===s){r.algorithm=e.readUint8(),r.feedback=e.readUint8();const a=11===n.id||12===n.id?2:4;t>=19&&(e.readUint8(),e.readUint8());for(let n=0;n<a;n++){const n=this.parseOperator(e,t);r.operators.push(n)}}else this.readMacros(e,r);return{name:a,config:r}}static parseOperator(e,t){const n={enabled:!0,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt:0,dt2:0,rs:0,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};return t>=11&&(n.dt=e.readInt8(),n.rs=e.readUint8()),t>=12&&e.readUint8(),t>=15&&(n.ssg=e.readUint8()),n}static parseDMP(e){e.readUint8();const t=e.readUint8(),n=e.readUint8(),a={...ka,chipType:this.SYSTEM_MAP[t]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===n){a.algorithm=e.readUint8(),a.feedback=e.readUint8();for(let t=0;t<4;t++){const t={enabled:!0,mult:e.readUint8(),tl:e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,sl:e.readUint8(),rr:e.readUint8(),dt:e.readInt8(),dt2:0,rs:e.readUint8(),am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};a.operators.push(t)}}else this.readMacros(e,a);return{name:"DefleMask Instrument",config:a}}static parseDMW(e){const t=[];for(;!e.isEOF();)t.push(e.readUint8());return t}static readMacros(e,t){const n=["volume","arp","duty","wave","pitch"];for(const a of n){if(e.readUint8()){const s=e.readUint8(),r=e.readUint8(),o=[];for(let t=0;t<s;t++)o.push(e.readInt32());t.macros.push({type:n.indexOf(a),data:o,loop:r,release:-1,mode:0})}}}}function py(e,t){const n={...e};for(const a of Object.keys(t)){const s=t[a],r=e[a];null!=s&&("object"!=typeof s||Array.isArray(s)||"object"!=typeof r||Array.isArray(r)?n[a]=s:n[a]=py(r,s))}return n}function hy(e){const t={...e};switch(e.synthType){case"TB303":case"Buzz3o3":t.tb303=py(La,e.tb303||{}),t.tb303?.devilFish&&(void 0===t.tb303.devilFish.filterSelect||t.tb303.devilFish.filterSelect>5)&&(t.tb303.devilFish.filterSelect=1);break;case"DrumMachine":t.drumMachine=py(ha,e.drumMachine||{});break;case"ChipSynth":t.chipSynth=py(ma,e.chipSynth||{});break;case"PWMSynth":t.pwmSynth=py(fa,e.pwmSynth||{});break;case"Wavetable":t.wavetable=py(sa,e.wavetable||{});break;case"GranularSynth":t.granular=py(ra,e.granular||{});break;case"SuperSaw":t.superSaw=py(da,e.superSaw||{});break;case"PolySynth":t.polySynth=py(ua,e.polySynth||{});break;case"Organ":t.organ=py(pa,e.organ||{});break;case"StringMachine":t.stringMachine=py(ya,e.stringMachine||{});break;case"FormantSynth":t.formantSynth=py(xa,e.formantSynth||{});break;case"WobbleBass":t.wobbleBass=py(va,e.wobbleBass||{});break;case"DubSiren":t.dubSiren=py(Pa,e.dubSiren||{});break;case"SpaceLaser":t.spaceLaser=py(Da,e.spaceLaser||{});break;case"V2":t.v2=py(Ia,e.v2||{});break;case"Sam":t.sam=py(Ta,e.sam||{});break;case"Synare":t.synare=py(Oa,e.synare||{});break;case"Buzzmachine":t.buzzmachine=py(ba,e.buzzmachine||{});break;case"Dexed":t.dexed=py(Sa,e.dexed||{});break;case"OBXd":t.obxd=py(Ma,e.obxd||{});break;case"DrumKit":t.drumKit=py(Ca,e.drumKit||{});break;case"Furnace":t.furnace=py(ka,e.furnace||{})}return t}function my(e){return"string"==typeof e.note}function fy(e){return e.some(e=>{const t=e.id;return 0===t||t>0&&t%100==0&&t<3200})}function yy(e){return 0===e?1:e%100==0&&e<3200?e/100+1:e}function gy(e){const t={...e};if("string"==typeof e.note?t.note=Ua(e.note):null!==e.note&&void 0!==e.note||(t.note=0),null===e.instrument||void 0===e.instrument?t.instrument=0:"number"==typeof e.instrument&&(t.instrument=yy(e.instrument)),null===e.volume||void 0===e.volume?t.volume=0:"number"==typeof e.volume&&e.volume<=64&&(t.volume=16+e.volume),"effect"in e&&"string"==typeof e.effect){const n=e.effect;if(n&&"..."!==n&&"000"!==n){const[e,a]=Ha(n);t.effTyp=e,t.eff=a}else t.effTyp=0,t.eff=0;delete t.effect}if(t.effTyp||0===t.effTyp||(t.effTyp=0),t.eff||0===t.eff||(t.eff=0),"effect2"in e&&"string"==typeof e.effect2){const n=e.effect2;if(n&&"..."!==n&&"000"!==n){const[e,a]=Ha(n);t.effTyp2=e,t.eff2=a}else t.effTyp2=0,t.eff2=0;delete t.effect2}return void 0!==t.effTyp2&&null!==t.effTyp2||(t.effTyp2=0),void 0!==t.eff2&&null!==t.eff2||(t.eff2=0),t}function vy(e){return{...e,channels:e.channels.map(e=>({...e,rows:e.rows.map(e=>gy(e)),instrumentId:null!==e.instrumentId&&void 0!==e.instrumentId?yy(e.instrumentId):1}))}}function by(e){const t=new Map;let n=1;for(const a of e)if(!t.has(a.id)){const e=yy(a.id);Array.from(t.values()).includes(e)?t.set(a.id,n++):(t.set(a.id,e),n=Math.max(n,e+1))}return e.map(e=>{const n=t.get(e.id)??e.id,a="Sampler"===e.synthType||"Player"===e.synthType?"sample":"synth";return{...hy(e),id:n,type:e.type||a}})}function xy(e,t){const n=e.some(e=>e.channels.some(e=>e.rows.some(e=>my(e)))),a=fy(t),s=t.some(e=>!e.type),r=t.some(e=>function(e){switch(e.synthType){case"TB303":case"Buzz3o3":return!e.tb303||!e.tb303.filter||!e.tb303.filterEnvelope;case"DrumMachine":return!e.drumMachine;case"ChipSynth":return!e.chipSynth||!e.chipSynth.envelope;case"PWMSynth":return!e.pwmSynth||!e.pwmSynth.envelope;case"SuperSaw":return!e.superSaw||!e.superSaw.envelope;case"PolySynth":return!e.polySynth||!e.polySynth.envelope;case"Organ":return!e.organ||!e.organ.drawbars;case"StringMachine":return!e.stringMachine;case"FormantSynth":return!e.formantSynth||!e.formantSynth.envelope;case"WobbleBass":return!e.wobbleBass||!e.wobbleBass.envelope;case"DubSiren":return!e.dubSiren||!e.dubSiren.reverb;case"SpaceLaser":return!e.spaceLaser;case"Dexed":return!e.dexed;case"OBXd":return!e.obxd;case"DrumKit":return!e.drumKit;case"Furnace":return!e.furnace;default:return!1}}(e));return n||a||s||r}function wy(e,t){return{patterns:e.map(e=>vy(e)),instruments:by(t)}}const ky=Object.freeze(Object.defineProperty({__proto__:null,deepMerge:py,ensureCompleteInstrumentConfig:hy,hasOldInstrumentIds:fy,isOldFormatCell:my,migrateCell:gy,migrateInstrumentId:yy,migrateInstruments:by,migratePattern:vy,migrateProject:wy,needsMigration:xy},Symbol.toStringTag,{value:"Module"}));class Sy{static reverse(e){const t=e.numberOfChannels,n=e.length,a=e.sampleRate,s=new AudioBuffer({length:n,numberOfChannels:t,sampleRate:a});for(let r=0;r<t;r++){const t=e.getChannelData(r),a=s.getChannelData(r);for(let e=0;e<n;e++)a[e]=t[n-1-e]}return s}static normalize(e){const t=e.numberOfChannels,n=e.length,a=e.sampleRate;let s=0;for(let i=0;i<t;i++){const t=e.getChannelData(i);for(let e=0;e<n;e++){const n=Math.abs(t[e]);n>s&&(s=n)}}if(0===s||1===s)return e;const r=1/s,o=new AudioBuffer({length:n,numberOfChannels:t,sampleRate:a});for(let i=0;i<t;i++){const t=e.getChannelData(i),a=o.getChannelData(i);for(let e=0;e<n;e++)a[e]=t[e]*r}return o}static invertLoop(e,t,n){const a=e.numberOfChannels,s=e.length,r=e.sampleRate,o=new AudioBuffer({length:s,numberOfChannels:a,sampleRate:r});for(let i=0;i<a;i++){const a=e.getChannelData(i),r=o.getChannelData(i);for(let e=0;e<t;e++)r[e]=a[e];for(let e=t;e<n&&e<s;e++)r[e]=-a[e];for(let e=n;e<s;e++)r[e]=a[e]}return o}static applyGain(e,t){const n=e.numberOfChannels,a=e.length,s=e.sampleRate,r=new AudioBuffer({length:a,numberOfChannels:n,sampleRate:s});for(let o=0;o<n;o++){const n=e.getChannelData(o),s=r.getChannelData(o);for(let e=0;e<a;e++)s[e]=n[e]*t}return r}static async bufferToWav(e){const t=e.numberOfChannels,n=e.sampleRate,a=e.length,s=2*t,r=n*s,o=a*s,i=44+o,l=new ArrayBuffer(i),c=new DataView(l);this.writeString(c,0,"RIFF"),c.setUint32(4,i-8,!0),this.writeString(c,8,"WAVE"),this.writeString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,n,!0),c.setUint32(28,r,!0),c.setUint16(32,s,!0),c.setUint16(34,16,!0),this.writeString(c,36,"data"),c.setUint32(40,o,!0);let d=44;for(let u=0;u<a;u++)for(let n=0;n<t;n++){let t=e.getChannelData(n)[u];t=Math.max(-1,Math.min(1,t));const a=t<0?32768*t:32767*t;c.setInt16(d,a,!0),d+=2}return l}static writeString(e,t,n){for(let a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}}function My(e){e&&(e.url&&URL.revokeObjectURL(e.url),e.multiMap&&Object.values(e.multiMap).forEach(e=>URL.revokeObjectURL(e)))}const Ny=new Set;function Cy(e,t){const n=new Set;return e.forEach(e=>{e.rows.forEach(e=>{e.cells.forEach(e=>{e.instrument===t&&e.note&&n.add(e.note)})})}),Array.from(n).sort()}function Ey(e){for(let t=1;t<=128;t++)if(!e.includes(t))return t;return 1}const Py=a()(Rn((e,t)=>({instruments:[],currentInstrumentId:0,get currentInstrument(){const e=t();return e.instruments.find(t=>t.id===e.currentInstrumentId)||null},previewInstrument:null,presets:[],setCurrentInstrument:t=>e(e=>{e.instruments.find(e=>e.id===t)&&(e.currentInstrumentId=t)}),setPreviewInstrument:t=>e(e=>{e.previewInstrument=t}),getInstrument:e=>t().instruments.find(t=>t.id===e),updateInstrument:(n,a)=>{const s=t().instruments.find(e=>e.id===n),r=s&&a.synthType&&a.synthType!==s.synthType,o=a.name&&a.synthType,i=!!(a.oscillator||a.envelope||a.filter||a.filterEnvelope||a.superSaw||a.polySynth||a.organ||a.drumMachine||a.chipSynth||a.pwmSynth||a.stringMachine||a.formantSynth||a.wavetable||a.granular||a.furnace||a.dubSiren||a.synare||a.sam||a.v2Speech||a.tb303||a.buzzmachine||a.spaceLaser||a.v2||a.wam);if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const{id:e,...n}=a;if(Object.keys(n).forEach(e=>{const a=n[e];a&&"object"==typeof a&&!Array.isArray(a)&&t[e]?t[e]={...t[e],...a}:t[e]=a}),r&&a.synthType?.startsWith("Furnace")){const e=Om(a.synthType);e&&(t.furnace=e)}if(r&&"DubSiren"===a.synthType&&!t.dubSiren&&(t.dubSiren={...Pa}),r&&"SpaceLaser"===a.synthType&&!t.spaceLaser&&(t.spaceLaser={...Da}),r&&"V2"===a.synthType&&!t.v2&&(t.v2={...Ia}),r&&"Synare"===a.synthType&&!t.synare&&(t.synare={...Oa}),r&&"Sam"===a.synthType&&!t.sam&&(t.sam={...Ta}),r&&!o&&a.synthType){const e=t.furnace?.chipType,n=t.buzzmachine?.machineType,s=iy(a.synthType);if(s){const{name:r,type:o,synthType:i,...l}=s;Object.keys(l).forEach(e=>{const n=l[e];n&&"object"==typeof n&&!Array.isArray(n)&&t[e]?Object.assign(t[e],n):t[e]=n}),t.synthType=a.synthType,void 0!==e&&t.furnace&&(t.furnace.chipType=e),n&&t.buzzmachine&&(t.buzzmachine.machineType=n)}}}}),!r&&!o)try{const s=Hm(),r=t().instruments.find(e=>e.id===n);if(r){if(("TB303"===r.synthType||"Buzz3o3"===r.synthType)&&r.tb303&&a.tb303)return void s.updateTB303Parameters(n,r.tb303);if("DubSiren"===r.synthType&&r.dubSiren&&a.dubSiren)return void s.updateDubSirenParameters(n,r.dubSiren);if("SpaceLaser"===r.synthType&&r.spaceLaser&&a.spaceLaser)return void s.updateSpaceLaserParameters(n,r.spaceLaser);if("V2"===r.synthType&&r.v2&&a.v2)return void s.updateV2Parameters(n,r.v2);if("V2"===r.synthType&&r.v2Speech&&a.v2Speech)return void s.updateComplexSynthParameters(n,r.v2Speech);if("Sam"===r.synthType&&r.sam&&a.sam)return void s.updateComplexSynthParameters(n,r.sam);if("Synare"===r.synthType&&r.synare&&a.synare)return void s.updateSynareParameters(n,r.synare);if(r.synthType?.startsWith("Furnace")&&r.furnace&&a.furnace)return void s.updateFurnaceInstrument(n,r);if("Buzz3o3"===r.synthType&&r.tb303&&a.tb303){const t=r.tb303,a=r.buzzmachine||{machineType:"OomekAggressor",parameters:{}},o={...a.parameters};return o[0]="square"===t.oscillator.type?1:0,o[1]=Math.round(Math.log2(t.filter.cutoff/200)/Math.log2(25)*240),o[2]=Math.round(t.filter.resonance/100*128),o[3]=Math.round(t.filterEnvelope.envMod/100*128),o[4]=Math.round(Math.log2(t.filterEnvelope.decay/30)/Math.log2(100)*128),o[5]=Math.round(t.accent.amount/100*128),o[6]=Math.round((t.tuning||0)+100),e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.buzzmachine={...a,parameters:o})}),void s.updateBuzzmachineParameters(n,{...a,parameters:o})}if(r.synthType.startsWith("Buzz")&&r.buzzmachine&&a.buzzmachine)return void s.updateBuzzmachineParameters(n,r.buzzmachine);if(("Furnace"===r.synthType||r.synthType.startsWith("Furnace"))&&r.furnace&&a.furnace)return void s.updateFurnaceParameters(n,r.furnace);if("WAM"===r.synthType&&r.wam&&a.wam)return void s.updateWAMParameters(n,r.wam);if(["SuperSaw","WobbleBass","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth"].includes(r.synthType)){const e=r.synthType.charAt(0).toLowerCase()+r.synthType.slice(1),t=r[e];if(t&&a[e])return void s.updateComplexSynthParameters(n,t)}}}catch(l){}if(r||o||i)try{Hm().invalidateInstrument(n)}catch(l){}},createInstrument:n=>{const a=Ey(t().instruments.map(e=>e.id));return e(e=>{const t={id:s=a,name:`TB303 ${String(s).padStart(2,"0")}`,type:"synth",synthType:"TB303",tb303:{...La},oscillator:{...Fa},envelope:{...Ra},filter:{...ja},effects:[],volume:-6,pan:0};var s;const r=n?py(t,n):t;r.id=a,e.instruments.push(r),e.currentInstrumentId=a}),a},addInstrument:t=>{e(e=>{const n=e.instruments.find(e=>e.id===t.id);n?Object.assign(n,t):e.instruments.push({...t}),e.currentInstrumentId=t.id})},deleteInstrument:t=>e(e=>{const n=e.instruments.findIndex(e=>e.id===t);-1!==n&&e.instruments.length>1&&(My(e.instruments[n].sample),e.instruments.splice(n,1),e.currentInstrumentId===t&&(e.currentInstrumentId=e.instruments[0].id))}),cloneInstrument:n=>{const a=t().instruments.find(e=>e.id===n);if(!a)return n;const s=Ey(t().instruments.map(e=>e.id));return e(e=>{const t=JSON.parse(JSON.stringify(a));t.id=s,t.name=`${a.name} (Copy)`,e.instruments.push(t),e.currentInstrumentId=s}),s},resetInstrument:t=>{e(e=>{const n=e.instruments.find(e=>e.id===t);if(n){const e=n.synthType,t=function(e){const t={synthType:e,effects:[],volume:-12,pan:0};switch(e){case"TB303":t.tb303={...La};break;case"DrumMachine":t.drumMachine={...ha};break;case"ChipSynth":t.chipSynth={...ma};break;case"PWMSynth":t.pwmSynth={...fa};break;case"Wavetable":t.wavetable={...sa};break;case"GranularSynth":t.granular={...ra};break;case"SuperSaw":t.superSaw={...da};break;case"PolySynth":t.polySynth={...ua};break;case"Organ":t.organ={...pa};break;case"StringMachine":t.stringMachine={...ya};break;case"FormantSynth":t.formantSynth={...xa};break;case"WobbleBass":t.wobbleBass={...va};break;case"DubSiren":t.dubSiren={...Pa};break;case"SpaceLaser":t.spaceLaser={...Da};break;case"V2":t.v2={...Ia};break;case"Sam":t.sam={...Ta};break;case"Synare":t.synare={...Oa};break;case"WAM":t.wam={...Aa};break;case"Buzz3o3":t.tb303={...La},t.buzzmachine={...ba,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}};break;case"Buzzmachine":t.buzzmachine={...ba};break;case"Dexed":t.dexed={...Sa};break;case"OBXd":t.obxd={...Ma};break;case"DrumKit":t.drumKit={...Ca};break;case"ChiptuneModule":t.chiptuneModule={...ca};break;case"MAMEVFX":t.mame={...oa};break;case"MAMEDOC":t.mame={...ia};break;case"MAMERSA":t.rdpiano={...Na};break;case"MAMESWP30":t.mame={...la}}const n=iy(e);if(n){const{name:a,type:s,synthType:r,...o}=n;Object.assign(t,o),t.synthType=e}return t}(e);if(Object.assign(n,{...t,synthType:e,name:n.name,tb303:void 0,drumMachine:void 0,chipSynth:void 0,pwmSynth:void 0,wavetable:void 0,granular:void 0,superSaw:void 0,polySynth:void 0,organ:void 0,stringMachine:void 0,formantSynth:void 0,furnace:void 0,chiptuneModule:void 0,wobbleBass:void 0,drumKit:void 0,dubSiren:void 0,spaceLaser:void 0,synare:void 0,v2:void 0}),"TB303"===e||"Buzz3o3"===e)n.tb303={...La},"Buzz3o3"===e&&(n.buzzmachine={...ba,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}});else if("DubSiren"===e)n.dubSiren={...Pa};else if("SpaceLaser"===e)n.spaceLaser={...Da};else if("V2"===e)n.v2={...Ia};else if("Synare"===e)n.synare={...Oa};else if(e.startsWith("Furnace")){const t=Om(e);t&&(n.furnace=t)}}});try{Hm().invalidateInstrument(t)}catch(n){}},bakeInstrument:async(n,a="lite")=>{const s=t().instruments.find(e=>e.id===n);if(s&&"Sampler"!==s.synthType&&!Ny.has(n)){Ny.add(n);try{const r=Hm();s.sample&&My(s.sample);const o=JSON.parse(JSON.stringify(s));if(delete o.metadata,"pro"===a){const a=Cy((await An(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>nf);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,n);if(0===a.length)return t().bakeInstrument(n,"lite");const i={};for(const e of a){const t=await r.bakeInstrument(s,2,e),n=await Sy.bufferToWav(t),a=new Blob([n],{type:"audio/wav"});i[e]=URL.createObjectURL(a)}e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:o,bakeType:"pro"}},t.synthType="Sampler",t.sample={url:"",multiMap:i,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}else{const t=await r.bakeInstrument(s,2,"C4"),a=await Sy.bufferToWav(t),i=new Blob([a],{type:"audio/wav"}),l=URL.createObjectURL(i);e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:o,bakeType:"lite"}},t.synthType="Sampler",t.sample={url:l,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}r.invalidateInstrument(n)}catch(r){}finally{Ny.delete(n)}}},unbakeInstrument:n=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t&&t.metadata?.preservedSynth){const{synthType:e,config:n}=t.metadata.preservedSynth;My(t.sample);const a={...t.metadata};delete a.preservedSynth,Object.assign(t,n),t.synthType=e,t.metadata=a,t.sample=void 0}});try{const e=Hm();e.invalidateInstrument(n);const a=t().instruments.find(e=>e.id===n);a&&e.rebuildInstrumentEffects(n,a.effects)}catch(a){}},autoBakeInstruments:async()=>{const n=t().instruments.filter(e=>e.metadata?.preservedSynth&&!e.sample?.url&&!e.sample?.multiMap);if(0!==n.length)for(const t of n){const n=t.metadata.preservedSynth,s={...t,...n.config,synthType:n.synthType},r=n.bakeType||"lite";try{const n=Hm();if("pro"===r){const a=Cy((await An(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>nf);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,t.id),r={};for(const e of a){const t=await n.bakeInstrument(s,2,e),a=await Sy.bufferToWav(t),o=new Blob([a],{type:"audio/wav"});r[e]=URL.createObjectURL(o)}e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.multiMap=r)})}else{const a=await n.bakeInstrument(s,2,"C4"),r=await Sy.bufferToWav(a),o=new Blob([r],{type:"audio/wav"}),i=URL.createObjectURL(o);e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.url=i)})}n.invalidateInstrument(t.id)}catch(a){}}},addEffect:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:a,enabled:!0,wet:50,parameters:{}};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=Hm();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},addEffectConfig:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={...a,id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=Hm();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},removeEffect:(n,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.findIndex(e=>e.id===a);-1!==e&&t.effects.splice(e,1)}});const s=t().instruments.find(e=>e.id===n);s&&(async()=>{try{const e=Hm();await e.rebuildInstrumentEffects(n,s.effects)}catch(e){}})()},updateEffect:(n,a,s)=>{if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.find(e=>e.id===a);e&&Object.assign(e,s)}}),void 0!==s.enabled){const e=t().instruments.find(e=>e.id===n);e&&(async()=>{try{const t=Hm();await t.rebuildInstrumentEffects(n,e.effects)}catch(t){}})()}else{const e=t().instruments.find(e=>e.id===n),s=e?.effects.find(e=>e.id===a);if(s)try{Hm().updateInstrumentEffectParams(a,s)}catch{}}const r=t().instruments.find(e=>e.id===n),o=r?.effects.find(e=>e.id===a);if(1===o?.parameters.bpmSync)try{const e=Hm(),t=e.getBPM();e.updateBpmSyncedEffects(t)}catch{}},reorderEffects:(n,a,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const[e]=t.effects.splice(a,1);t.effects.splice(s,0,e)}});const r=t().instruments.find(e=>e.id===n);r&&(async()=>{try{const e=Hm();await e.rebuildInstrumentEffects(n,r.effects)}catch(e){}})()},loadPreset:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===n);a&&(Object.assign(a,t.config),a.id=n)});try{Hm().invalidateInstrument(n)}catch(a){}},saveAsPreset:(t,n,a)=>e(e=>{const s=e.instruments.find(e=>e.id===t);if(s){const t={id:`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:n,category:a,tags:[],author:"User",config:{name:s.name,type:s.type,synthType:s.synthType,oscillator:s.oscillator,envelope:s.envelope,filter:s.filter,filterEnvelope:s.filterEnvelope,tb303:s.tb303,effects:s.effects,volume:s.volume,pan:s.pan}};e.presets.push(t)}}),loadInstruments:n=>{const a=Hm();t().instruments.forEach(e=>{try{a.invalidateInstrument(e.id)}catch(t){}});const s=n.map(e=>({...hy(e),synthType:e.tb303&&"TB303"!==e.synthType&&"Buzz3o3"!==e.synthType?"TB303":e.synthType,type:e.type||("Sampler"===e.synthType?"sample":"synth"),effects:e.effects?.map(e=>({...e,category:e.category||"tonejs"}))||[]}));e(e=>{e.instruments=s,e.currentInstrumentId=s.length>0?s[0].id:null}),Hm().preloadInstruments(s).catch(e=>{})},loadFurnaceInstrument:n=>{try{const{name:a,config:s}=cy.parse(n),r=Ey(t().instruments.map(e=>e.id));e(e=>{const t={id:r,name:a||"Furnace Patch",type:"synth",synthType:"Furnace",furnace:s,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=r})}catch(a){}},loadDefleMaskInstrument:n=>{try{const a=uy.parse(n,"dmp"),{name:s,config:r}=a,o=Ey(t().instruments.map(e=>e.id));e(e=>{const t={id:o,name:s||"DefleMask Patch",type:"synth",synthType:"Furnace",furnace:r,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=o})}catch(a){}},loadDefleMaskWavetable:n=>{try{const a=uy.parse(n,"dmw"),s=t().currentInstrumentId;if(!s)return;e(e=>{const t=e.instruments.find(e=>e.id===s);"Furnace"===t?.synthType&&t.furnace&&t.furnace.wavetables.push({id:t.furnace.wavetables.length,data:a})})}catch(a){}},transformInstrument:(n,a,s)=>{const r=t().instruments.find(e=>e.id===n);if(!r)return;if("Sampler"!==r.synthType)return;const o=r.sample?{...r.sample,envelope:r.envelope||{...Ra}}:void 0;if(!o)return;let i;function l(t,n,a,s,r){e(e=>{const r=e.instruments.find(e=>e.id===t);if(!r)return;delete r.tb303,delete r.polySynth,delete r.wavetable,delete r.granular,delete r.superSaw,delete r.organ,delete r.drumMachine,delete r.chipSynth,delete r.pwmSynth,delete r.stringMachine,delete r.formantSynth,delete r.sample,r.type="synth",r.synthType=n;r[n.toLowerCase()]=a,r.metadata||(r.metadata={}),r.metadata.preservedSample=s,r.metadata.transformHistory||(r.metadata.transformHistory=[]),r.metadata.transformHistory.push({timestamp:(new Date).toISOString(),fromType:"Sampler",toType:n})});try{Hm().invalidateInstrument(t)}catch(o){}}"analyze"===s?An(async()=>{const{analyzeSample:e,suggestSynthConfig:t}=await Promise.resolve().then(()=>aP);return{analyzeSample:e,suggestSynthConfig:t}},void 0).then(({analyzeSample:e,suggestSynthConfig:t})=>{const s=e({id:n,name:r.name,pcmData:o.audioBuffer||new ArrayBuffer(0),loopStart:o.loopStart,loopLength:o.loopEnd-o.loopStart,loopType:o.loop?"forward":"none",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:44100,length:1e3},r.metadata?.originalEnvelope);i=t(a,s),l(n,a,i,o)}):(i=function(e){switch(e){case"TB303":return{...La};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{...Fa},envelope:{...Ra},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{...Ra},filter:{...ja,cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{...Ra}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{...Ra,attack:5,decay:300},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{...Fa},envelope:{...Ra}}}}(a),l(n,a,i,o))},revertToSample:n=>{const a=t().instruments.find(e=>e.id===n);if(!a)return;const s=a.metadata?.preservedSample;if(s){e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(delete t.tb303,delete t.polySynth,delete t.wavetable,delete t.granular,delete t.superSaw,delete t.organ,delete t.drumMachine,delete t.chipSynth,delete t.pwmSynth,delete t.stringMachine,delete t.formantSynth,t.type="sample",t.synthType="Sampler",t.sample={audioBuffer:s.audioBuffer,url:s.url,baseNote:s.baseNote,detune:s.detune,loop:s.loop,loopStart:s.loopStart,loopEnd:s.loopEnd,reverse:!1,playbackRate:1},t.envelope=s.envelope)});try{Hm().invalidateInstrument(n)}catch(r){}}},reverseSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer)return;const s=a.sample.audioBuffer,r=await Hm().decodeAudioData(s),o=Sy.reverse(r),i=await Hm().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Hm().invalidateInstrument(n)},normalizeSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer)return;const s=a.sample.audioBuffer,r=await Hm().decodeAudioData(s),o=Sy.normalize(r),i=await Hm().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Hm().invalidateInstrument(n)},invertLoopSample:async n=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample?.audioBuffer||!a.sample.loop)return;const s=a.sample.audioBuffer,r=await Hm().decodeAudioData(s),o=Sy.invertLoop(r,a.sample.loopStart,a.sample.loopEnd),i=await Hm().encodeAudioData(o);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Hm().invalidateInstrument(n)},updateSampleBuffer:async(n,a)=>{const s=t().instruments.find(e=>e.id===n);if(!s?.sample)return;const r=await Hm().encodeAudioData(a);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=r)}),Hm().invalidateInstrument(n)},updateSlices:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);a?.sample&&(a.sample.slices=n)})},updateSliceConfig:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);a?.sample&&(a.sample.sliceConfig=n)})},removeSlice:(t,n)=>{e(e=>{const a=e.instruments.find(e=>e.id===t);if(a?.sample?.slices){const e=a.sample.slices,t=e.findIndex(e=>e.id===n);if(-1!==t&&e.length>1){const n=e[t];t>0?(e[t-1].endFrame=n.endFrame,e[t-1].endTime=n.endTime):t<e.length-1&&(e[t+1].startFrame=n.startFrame,e[t+1].startTime=n.startTime),e.splice(t,1)}}})},createSlicedInstruments:async(n,a,s="Slice")=>{const r=t().instruments.find(e=>e.id===n);if(!r?.sample?.url)return[];const o=[],i=Hm();try{const n=await fetch(r.sample.url),l=await n.arrayBuffer(),c=await i.decodeAudioData(l),d=t().instruments.map(e=>e.id);for(let t=0;t<a.length;t++){const n=a[t],l=Ey([...d,...o]);o.push(l);const u=n.endFrame-n.startFrame,p=c.numberOfChannels,h=c.sampleRate,m=new OfflineAudioContext(p,u,h).createBuffer(p,u,h);for(let e=0;e<p;e++){const t=c.getChannelData(e),a=m.getChannelData(e);for(let e=0;e<u;e++)a[e]=t[n.startFrame+e]}const f=await i.encodeAudioData(m),y=new Blob([f],{type:"audio/wav"}),g=await new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(y)}),v=n.label||`${s} ${t+1}`,b=r.name?`${r.name} - ${v}`:v;e(e=>{const t={id:l,name:b.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:g,audioBuffer:f,baseNote:r.sample?.baseNote||"C-4",detune:r.sample?.detune||0,loop:!1,loopStart:0,loopEnd:u,sampleRate:h,reverse:!1,playbackRate:1},envelope:r.envelope||{...Ra},effects:[],volume:r.volume||-6,pan:r.pan||0};e.instruments.push(t)})}return o.length>0&&e(e=>{e.currentInstrumentId=o[0]}),o}catch(l){return[]}},reset:()=>{const n=Hm();t().instruments.forEach(e=>{try{n.invalidateInstrument(e.id)}catch(t){}}),e(e=>{e.instruments=[{...af[0],id:1,type:"synth"}],e.currentInstrumentId=1,e.presets=[]})}}))),Ty=Object.freeze(Object.defineProperty({__proto__:null,useInstrumentStore:Py},Symbol.toStringTag,{value:"Module"})),Ay=a()(Gm(Rn((e,t)=>({visiblePanels:["tracker","oscilloscope","pattern-list"],trackerZoom:100,activePanel:"tracker",modalOpen:null,sidebarCollapsed:!1,useHexNumbers:!0,rowHighlightInterval:4,showBeatLabels:!1,chordEntryMode:!1,blankEmptyCells:!1,tb303Collapsed:!0,oscilloscopeVisible:!0,compactToolbar:!1,autoCompactApplied:!1,showSamplePackModal:!1,uiVersion:8,performanceQuality:"high",statusMessage:"All Right",prevStatusMessage:"All Right",pendingModuleFile:null,togglePanel:t=>e(e=>{const n=e.visiblePanels.indexOf(t);-1!==n?e.visiblePanels.splice(n,1):e.visiblePanels.push(t)}),setActivePanel:t=>e(e=>{e.activePanel=t,e.visiblePanels.includes(t)||e.visiblePanels.push(t)}),setTrackerZoom:t=>e(e=>{e.trackerZoom=Math.max(80,Math.min(200,t))}),openModal:t=>e(e=>{e.modalOpen=t}),closeModal:()=>e(e=>{e.modalOpen=null}),toggleSidebar:()=>e(e=>{e.sidebarCollapsed=!e.sidebarCollapsed}),setSidebarCollapsed:t=>e(e=>{e.sidebarCollapsed=t}),setUseHexNumbers:t=>e(e=>{e.useHexNumbers=t}),setRowHighlightInterval:t=>e(e=>{e.rowHighlightInterval=Math.max(1,Math.min(32,t))}),toggleBeatLabels:()=>e(e=>{e.showBeatLabels=!e.showBeatLabels}),toggleChordEntryMode:()=>e(e=>{e.chordEntryMode=!e.chordEntryMode}),setBlankEmptyCells:t=>e(e=>{e.blankEmptyCells=t}),setStatusMessage:(t,n=!1,a=2e3)=>e(e=>{n&&(e.prevStatusMessage=t),e.statusMessage=t,a>0&&(window._statusTimeout&&clearTimeout(window._statusTimeout),window._statusTimeout=setTimeout(()=>{const e=Ay.getState().prevStatusMessage;Ay.getState().setStatusMessage(e||"All Right",!1,0),window._statusTimeout=null},a))}),toggleTB303Collapsed:()=>e(e=>{e.tb303Collapsed=!e.tb303Collapsed}),setTB303Collapsed:t=>e(e=>{e.tb303Collapsed=t}),toggleOscilloscopeVisible:()=>e(e=>{e.oscilloscopeVisible=!e.oscilloscopeVisible}),setOscilloscopeVisible:t=>e(e=>{e.oscilloscopeVisible=t}),toggleCompactToolbar:()=>e(e=>{e.compactToolbar=!e.compactToolbar}),setCompactToolbar:t=>e(e=>{e.compactToolbar=t}),applyAutoCompact:()=>e(e=>{const t="undefined"!=typeof window?window.innerHeight:1080;e.uiVersion<8&&(e.uiVersion=8,e.tb303Collapsed=!0,e.compactToolbar=!1),e.autoCompactApplied||(e.autoCompactApplied=!0,t<800&&(e.oscilloscopeVisible=!1))}),setShowSamplePackModal:t=>e(e=>{e.showSamplePackModal=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setPendingModuleFile:t=>e(e=>{e.pendingModuleFile=t})})),{name:"devilbox-ui-settings",partialize:e=>({tb303Collapsed:e.tb303Collapsed,oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar,sidebarCollapsed:e.sidebarCollapsed,trackerZoom:e.trackerZoom,useHexNumbers:e.useHexNumbers,rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels,chordEntryMode:e.chordEntryMode,blankEmptyCells:e.blankEmptyCells,performanceQuality:e.performanceQuality,uiVersion:e.uiVersion})})),_y=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:Ay},Symbol.toStringTag,{value:"Module"}));let Iy,Dy=0,Oy=null,Fy=null;const Ry=a()(Rn((e,t)=>({bpm:125,timeSignature:[4,4],swing:100,position:"0:0:0",isPlaying:!1,isPaused:!1,isLooping:!0,currentRow:0,currentPatternIndex:0,continuousRow:0,smoothScrolling:!1,metronomeEnabled:!1,metronomeVolume:75,speed:6,loopStartRow:0,grooveTemplateId:"straight",grooveSteps:2,jitter:0,useMpcScale:!1,setBPM:t=>e(e=>{e.bpm=Math.max(20,Math.min(999,t));try{Ay.getState().setStatusMessage(`BPM ${e.bpm}`,!1,1500)}catch(n){}}),setTimeSignature:(t,n)=>e(e=>{e.timeSignature=[t,n]}),setSwing:t=>e(e=>{e.useMpcScale?e.swing=Math.max(50,Math.min(75,t)):e.swing=Math.max(0,Math.min(200,t))}),setJitter:t=>e(e=>{e.jitter=Math.max(0,Math.min(100,t))}),setUseMpcScale:t=>e(e=>{e.useMpcScale!==t&&(e.useMpcScale=t,e.swing=t?50+e.swing/200*25:(e.swing-50)/25*200)}),setPosition:t=>e(e=>{e.position=t}),play:()=>{Py.getState().autoBakeInstruments(),e(e=>{e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow})},pause:()=>e(e=>{e.isPlaying=!1,e.isPaused=!0}),stop:()=>e(e=>{e.isPlaying=!1,e.isPaused=!1,e.currentRow=0,e.continuousRow=0,e.position="0:0:0"}),togglePlayPause:()=>{t().isPlaying||Py.getState().autoBakeInstruments(),e(e=>{e.isPlaying?(e.isPlaying=!1,e.isPaused=!0):(e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow)})},setIsLooping:t=>e(e=>{e.isLooping=t}),setCurrentRow:(t,n)=>e(e=>{const a=e.currentRow;if(e.currentRow=t,t>a)e.continuousRow+=t-a;else if(t===a);else if(t<a){if(n?a-t>=n/2:0===t&&a>2){const s=n||a+1;e.continuousRow+=s-a+t}}}),setCurrentRowThrottled:(e,n)=>{const a=performance.now();Oy=e,Iy=n,a-Dy>=20?(Dy=a,t().setCurrentRow(e,n),Oy=null,Iy=void 0,null!==Fy&&(window.clearTimeout(Fy),Fy=null)):null===Fy&&(Fy=window.setTimeout(()=>{null!==Oy&&(Dy=performance.now(),t().setCurrentRow(Oy,Iy),Oy=null,Iy=void 0),Fy=null},20-(a-Dy)))},setCurrentPattern:t=>e(e=>{e.currentPatternIndex=t}),setSmoothScrolling:t=>e(e=>{e.smoothScrolling=t}),setMetronomeEnabled:t=>e(e=>{e.metronomeEnabled=t}),setMetronomeVolume:t=>e(e=>{e.metronomeVolume=Math.max(0,Math.min(100,t))}),toggleMetronome:()=>e(e=>{e.metronomeEnabled=!e.metronomeEnabled}),setSpeed:t=>e(e=>{e.speed=Math.max(1,Math.min(31,t))}),setLoopStartRow:t=>e(e=>{e.loopStartRow=Math.max(0,t)}),setGrooveTemplate:t=>e(e=>{Ba.find(e=>e.id===t)&&(e.grooveTemplateId=t)}),setGrooveSteps:t=>e(e=>{e.grooveSteps=Math.max(1,Math.min(64,t))}),getGrooveTemplate:()=>{const e=t();return Ba.find(t=>t.id===e.grooveTemplateId)||Ba[0]},reset:()=>e(e=>{e.bpm=125,e.timeSignature=[4,4],e.swing=100,e.position="0:0:0",e.isPlaying=!1,e.isPaused=!1,e.isLooping=!0,e.currentRow=0,e.currentPatternIndex=0,e.continuousRow=0,e.speed=6,e.loopStartRow=0,e.grooveTemplateId="straight",e.grooveSteps=2,e.jitter=0,e.useMpcScale=!1})}))),jy=Object.freeze(Object.defineProperty({__proto__:null,useTransportStore:Ry},Symbol.toStringTag,{value:"Module"})),Ly=a()(Rn((e,t)=>({initialized:!1,contextState:"suspended",masterVolume:0,masterMuted:!1,analyserNode:null,fftNode:null,toneEngineInstance:null,masterEffects:[],setInitialized:t=>e(e=>{e.initialized=t}),setContextState:t=>e(e=>{e.contextState=t}),setMasterVolume:n=>e(e=>{e.masterVolume=Math.max(-60,Math.min(0,n));const a=t().toneEngineInstance;a&&a.setMasterVolume(e.masterVolume)}),setMasterMuted:n=>e(e=>{e.masterMuted=n;const a=t().toneEngineInstance;a&&a.setMasterMute(n)}),toggleMasterMute:()=>e(e=>{e.masterMuted=!e.masterMuted;const n=t().toneEngineInstance;n&&n.setMasterMute(e.masterMuted)}),setAnalyserNode:t=>e(e=>{e.analyserNode=t}),setFFTNode:t=>e(e=>{e.fftNode=t}),setToneEngineInstance:t=>e(e=>{e.toneEngineInstance=t}),addMasterEffect:n=>e(e=>{const a={id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:n,enabled:!0,wet:50,parameters:{}};e.masterEffects.push(a);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),addMasterEffectConfig:n=>e(e=>{const a={...n,id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};e.masterEffects.push(a);const s=JSON.parse(JSON.stringify(e.masterEffects)),r=t().toneEngineInstance;r&&(async()=>{try{await r.rebuildMasterEffects(s)}catch(e){}})()}),removeMasterEffect:n=>e(e=>{const a=e.masterEffects.findIndex(e=>e.id===n);if(-1!==a){e.masterEffects.splice(a,1);const n=JSON.parse(JSON.stringify(e.masterEffects)),s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(n)}catch(e){}})()}}),updateMasterEffect:(n,a)=>e(e=>{const s=e.masterEffects.find(e=>e.id===n);if(s){Object.assign(s,a);const e=t().toneEngineInstance;if(e&&(e.updateMasterEffectParams(n,s),1===s.parameters.bpmSync)){const t=e.getBPM();e.updateBpmSyncedEffects(t)}}}),reorderMasterEffects:(n,a)=>e(e=>{const[s]=e.masterEffects.splice(n,1);e.masterEffects.splice(a,0,s);const r=JSON.parse(JSON.stringify(e.masterEffects)),o=t().toneEngineInstance;o&&(async()=>{try{await o.rebuildMasterEffects(r)}catch(e){}})()}),setMasterEffects:n=>e(e=>{const a=n.map(e=>({...e,category:e.category||"tonejs"}));e.masterEffects=a;const s=t().toneEngineInstance;s&&(async()=>{try{await s.rebuildMasterEffects(a)}catch(e){}})()})}))),By=a()(Rn((e,t)=>({metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},isDirty:!1,lastSavedAt:null,setMetadata:t=>e(e=>{Object.assign(e.metadata,t),e.metadata.modifiedAt=(new Date).toISOString(),e.isDirty=!0}),setIsDirty:t=>e(e=>{e.isDirty=t}),markAsSaved:()=>e(e=>{e.isDirty=!1,e.lastSavedAt=(new Date).toISOString()}),markAsModified:()=>e(e=>{e.isDirty=!0,e.metadata.modifiedAt=(new Date).toISOString()}),resetProject:()=>e(e=>{e.metadata={id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},e.isDirty=!1,e.lastSavedAt=null})}))),Vy=a()(Rn((e,t)=>({curves:[],selectedCurveId:null,editMode:"pencil",presets:[...Va],automation:{},channelLanes:new Map,addCurve:(t,n,a)=>{const s={id:`curve-${Date.now()}`,patternId:t,channelIndex:n,parameter:a,mode:"curve",interpolation:"linear",points:[],enabled:!0};return e(e=>{e.curves.push(s),e.selectedCurveId=s.id,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),s.id},removeCurve:t=>e(e=>{const n=e.curves.findIndex(e=>e.id===t);-1!==n&&(e.curves.splice(n,1),e.selectedCurveId===t&&(e.selectedCurveId=null),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),updateCurve:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(Object.assign(a,n),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),setSelectedCurve:t=>e(e=>{e.selectedCurveId=t}),setEditMode:t=>e(e=>{e.editMode=t}),addPoint:(t,n,a)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.findIndex(e=>e.row===n);-1!==t?s.points[t].value=a:(s.points.push({row:n,value:a}),s.points.sort((e,t)=>e.row-t.row)),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}}),removePoint:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);if(a){const t=a.points.findIndex(e=>e.row===n);-1!==t&&(a.points.splice(t,1),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),updatePoint:(t,n,a)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.find(e=>e.row===n);t&&(t.value=a,e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}}),clearPoints:t=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(n.points=[],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),applyPreset:(t,n)=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(a.points=[...n.points],e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t}))}),getCurvesForPattern:(e,n)=>t().curves.filter(t=>t.patternId===e&&t.channelIndex===n),getValueAtRow:(e,n)=>{const a=t().curves.find(t=>t.id===e);if(!a||0===a.points.length)return null;let s=null,r=null;for(let t=0;t<a.points.length;t++)if(a.points[t].row<=n&&(s=a.points[t]),a.points[t].row>=n){r=a.points[t];break}if(s&&s.row===n)return s.value;if(r&&r.row===n)return r.value;if(s&&r&&"linear"===a.interpolation){const e=(n-s.row)/(r.row-s.row);return s.value+(r.value-s.value)*e}if(s&&r&&"exponential"===a.interpolation){const e=(n-s.row)/(r.row-s.row),t=e*e;return s.value+(r.value-s.value)*t}return a.mode,s?s.value:r?r.value:null},getAutomation:(e,n,a)=>{const s=t().curves.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===a);return s||{id:`temp-${e}-${n}-${a}`,patternId:e,channelIndex:n,parameter:a,mode:"curve",interpolation:"linear",points:[],enabled:!0}},setAutomation:(t,n,a,s)=>e(e=>{const r=e.curves.findIndex(e=>e.patternId===t&&e.channelIndex===n&&e.parameter===a);-1!==r?e.curves[r]=s:e.curves.push(s),e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),buildAutomationData:()=>{const e=t(),n={};return e.curves.forEach(e=>{n[e.patternId]||(n[e.patternId]={}),n[e.patternId][e.channelIndex]||(n[e.patternId][e.channelIndex]={}),n[e.patternId][e.channelIndex][e.parameter]=e}),n},loadCurves:t=>e(e=>{e.curves=t,e.selectedCurveId=null,e.automation={},t.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}),getCurves:()=>t().curves,setActiveParameter:(t,n)=>e(e=>{const a=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...a,activeParameter:n})}),getActiveParameter:e=>{const n=t();return n.channelLanes.get(e)?.activeParameter||"cutoff"},setShowLane:(t,n)=>e(e=>{const a=e.channelLanes.get(t)||{activeParameter:"cutoff",showLane:!1};e.channelLanes.set(t,{...a,showLane:n})}),getShowLane:e=>{const n=t();return n.channelLanes.get(e)?.showLane||!1},reset:()=>e(e=>{e.curves=[],e.selectedCurveId=null,e.editMode="pencil",e.automation={},e.channelLanes=new Map})}))),zy=a()(Rn((e,t)=>({undoStack:[],redoStack:[],maxStackSize:100,currentActionId:null,pushAction:(t,n,a,s,r)=>e(e=>{const o={id:`action-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),description:n,patternIndex:a,beforeState:JSON.parse(JSON.stringify(s)),afterState:JSON.parse(JSON.stringify(r))};e.undoStack.push(o),e.undoStack.length>e.maxStackSize&&e.undoStack.shift(),e.redoStack=[],e.currentActionId=o.id}),undo:()=>{const n=t();if(0===n.undoStack.length)return null;const a=n.undoStack[n.undoStack.length-1];return e(e=>{const t=e.undoStack.pop();t&&(e.redoStack.push(t),e.currentActionId=e.undoStack.length>0?e.undoStack[e.undoStack.length-1].id:null)}),a.beforeState},redo:()=>{const n=t();if(0===n.redoStack.length)return null;const a=n.redoStack[n.redoStack.length-1];return e(e=>{const t=e.redoStack.pop();t&&(e.undoStack.push(t),e.currentActionId=t.id)}),a.afterState},canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,clearHistory:()=>e(e=>{e.undoStack=[],e.redoStack=[],e.currentActionId=null}),setMaxStackSize:t=>e(e=>{e.maxStackSize=Math.max(1,t),e.undoStack.length>e.maxStackSize&&(e.undoStack=e.undoStack.slice(-e.maxStackSize)),e.redoStack.length>e.maxStackSize&&(e.redoStack=e.redoStack.slice(-e.maxStackSize))}),getUndoCount:()=>t().undoStack.length,getRedoCount:()=>t().redoStack.length,getLastAction:()=>{const e=t().undoStack;return e.length>0?e[e.length-1]:null},getActionHistory:()=>t().undoStack.slice(-20)}))),Uy=e=>({EDIT_CELL:"Edit Cell",PASTE_BLOCK:"Paste Block",DELETE_BLOCK:"Delete Block",CUT_BLOCK:"Cut Block",TRANSPOSE_BLOCK:"Transpose Block",AMPLIFY_BLOCK:"Amplify Block",INTERPOLATE_BLOCK:"Interpolate Block",CLEAR_CELL:"Clear Cell",CLEAR_ROW:"Clear Row",CLEAR_CHANNEL:"Clear Channel",CLEAR_PATTERN:"Clear Pattern",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",RESIZE_PATTERN:"Resize Pattern"}[e]||e),Gy=e=>{switch(e){case"EDIT_CELL":return"text-blue-400";case"PASTE_BLOCK":case"CUT_BLOCK":case"DELETE_BLOCK":return"text-green-400";case"TRANSPOSE_BLOCK":case"AMPLIFY_BLOCK":case"INTERPOLATE_BLOCK":return"text-yellow-400";case"CLEAR_CELL":case"CLEAR_ROW":case"CLEAR_CHANNEL":case"CLEAR_PATTERN":return"text-red-400";case"INSERT_ROW":case"DELETE_ROW":case"RESIZE_PATTERN":return"text-purple-400";default:return"text-gray-400"}},Wy=()=>{const e=tf.getState(),t=Py.getState(),n=Vy.getState(),a=By.getState(),s=Ry.getState();return{patterns:JSON.parse(JSON.stringify(e.patterns)),currentPatternIndex:e.currentPatternIndex,instruments:JSON.parse(JSON.stringify(t.instruments)),currentInstrumentId:t.currentInstrumentId,automationCurves:JSON.parse(JSON.stringify(n.curves)),metadata:JSON.parse(JSON.stringify(a.metadata)),bpm:s.bpm}},Ky=e=>{const t=Hm();try{t.stop()}catch(n){}Ry.getState().reset(),Ry.getState().setBPM(e.bpm),By.getState().setMetadata(e.metadata),By.getState().setIsDirty(!1),tf.getState().loadPatterns(e.patterns),tf.getState().setCurrentPattern(e.currentPatternIndex),Py.getState().loadInstruments(e.instruments),null!==e.currentInstrumentId&&Py.getState().setCurrentInstrument(e.currentInstrumentId),Vy.getState().loadCurves(e.automationCurves)},Hy=()=>({id:`tab-${Date.now()}`,name:"Untitled",isDirty:!1,state:null}),$y=Hy(),qy=a()(Rn((e,t)=>({tabs:[$y],activeTabId:$y.id,addTab:()=>{const n=t().activeTabId,a=Wy();e(e=>{const t=e.tabs.find(e=>e.id===n);t&&(t.state=a);const s=Hy();e.tabs.push(s),e.activeTabId=s.id});const s={patterns:[{id:`pattern-${Date.now()}`,name:"Untitled Pattern",length:64,channels:Array.from({length:4},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}],currentPatternIndex:0,instruments:[{id:0,name:"TB303 Classic",type:"synth",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:15},filterEnvelope:{envMod:50,decay:300},accent:{amount:.8},slide:{time:60,mode:"exponential"}},oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0}],currentInstrumentId:0,automationCurves:[],metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},bpm:125};Ky(s)},closeTab:n=>{const a=t();if(a.tabs.length<=1)return;const s=a.tabs.findIndex(e=>e.id===n);if(-1===s)return;let r=a.activeTabId,o=!1;if(a.activeTabId===n){const e=0===s?1:s-1;r=a.tabs[e].id,o=!0}const i=a.tabs.find(e=>e.id===r),l=i?.state;e(e=>{e.activeTabId=r,e.tabs.splice(s,1);const t=e.tabs.find(e=>e.id===r);t&&(t.state=null)}),o&&l&&Ky(l)},setActiveTab:n=>{const a=t();if(!a.tabs.some(e=>e.id===n))return;if(a.activeTabId===n)return;const s=a.activeTabId,r=Wy(),o=a.tabs.find(e=>e.id===n),i=o?.state;e(e=>{const t=e.tabs.find(e=>e.id===s);t&&(t.state=r),e.activeTabId=n;const a=e.tabs.find(e=>e.id===n);a&&(a.state=null)}),i&&Ky(i)},updateTabName:(t,n)=>e(e=>{const a=e.tabs.find(e=>e.id===t);a&&(a.name=n)}),markTabDirty:(t,n)=>e(e=>{const a=e.tabs.find(e=>e.id===t);a&&(a.isDirty=n)})}))),Yy={id:"devilbox",name:"DEViLBOX",colors:{bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",bgHover:"#262020",bgActive:"#2f2828",border:"#2f2525",borderLight:"#403535",accent:"#ef4444",accentSecondary:"#f97316",accentGlow:"rgba(239, 68, 68, 0.15)",text:"#f2f0f0",textSecondary:"#a8a0a0",textMuted:"#686060",textInverse:"#0b0909",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0f0c0c",trackerRowOdd:"#131010",trackerRowHighlight:"#181414",trackerRowCurrent:"#2a1a1a",trackerRowCursor:"#251010",cellNote:"#f2f0f0",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#ef4444",cellSlide:"#fb7185",cellEmpty:"#484040"}},Xy=[Yy,{id:"neodark",name:"NeoDark",colors:{bg:"#0a0a0b",bgSecondary:"#111113",bgTertiary:"#1a1a1d",bgHover:"#222226",bgActive:"#2a2a2f",border:"#2a2a2f",borderLight:"#3a3a40",accent:"#00d4aa",accentSecondary:"#7c3aed",accentGlow:"rgba(0, 212, 170, 0.15)",text:"#f0f0f2",textSecondary:"#a0a0a8",textMuted:"#606068",textInverse:"#0a0a0b",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0d0d0f",trackerRowOdd:"#111113",trackerRowHighlight:"#151518",trackerRowCurrent:"#1a2a25",trackerRowCursor:"#0d2520",cellNote:"#f0f0f2",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#00d4aa",cellSlide:"#a78bfa",cellEmpty:"#404048"}},{id:"cyan-lineart",name:"Cyan Lineart",colors:{bg:"#030808",bgSecondary:"#051010",bgTertiary:"#071414",bgHover:"#0a1a1a",bgActive:"#0c2020",border:"#00808080",borderLight:"#00b8b8",accent:"#00ffff",accentSecondary:"#00e0e0",accentGlow:"rgba(0, 255, 255, 0.12)",text:"#00ffff",textSecondary:"#00c8c8",textMuted:"#006060",textInverse:"#030808",error:"#ff4080",success:"#00ff88",warning:"#00ffaa",trackerRowEven:"#030808",trackerRowOdd:"#041010",trackerRowHighlight:"#061414",trackerRowCurrent:"#081818",trackerRowCursor:"#0a1c1c",cellNote:"#00ffff",cellInstrument:"#00e8e8",cellVolume:"#00d0d0",cellEffect:"#00b8b8",cellAccent:"#00ffff",cellSlide:"#00a0a0",cellEmpty:"#003838"}}],Qy=e=>{const t=document.documentElement,{colors:n}=e;t.setAttribute("data-theme",e.id),t.style.setProperty("--color-bg",n.bg),t.style.setProperty("--color-bg-secondary",n.bgSecondary),t.style.setProperty("--color-bg-tertiary",n.bgTertiary),t.style.setProperty("--color-bg-hover",n.bgHover),t.style.setProperty("--color-bg-active",n.bgActive),t.style.setProperty("--color-border",n.border),t.style.setProperty("--color-border-light",n.borderLight),t.style.setProperty("--color-accent",n.accent),t.style.setProperty("--color-accent-secondary",n.accentSecondary),t.style.setProperty("--color-accent-glow",n.accentGlow),t.style.setProperty("--color-text",n.text),t.style.setProperty("--color-text-secondary",n.textSecondary),t.style.setProperty("--color-text-muted",n.textMuted),t.style.setProperty("--color-text-inverse",n.textInverse),t.style.setProperty("--color-error",n.error),t.style.setProperty("--color-success",n.success),t.style.setProperty("--color-warning",n.warning),t.style.setProperty("--color-tracker-row-even",n.trackerRowEven),t.style.setProperty("--color-tracker-row-odd",n.trackerRowOdd),t.style.setProperty("--color-tracker-row-highlight",n.trackerRowHighlight),t.style.setProperty("--color-tracker-row-current",n.trackerRowCurrent),t.style.setProperty("--color-tracker-row-cursor",n.trackerRowCursor),t.style.setProperty("--color-cell-note",n.cellNote),t.style.setProperty("--color-cell-instrument",n.cellInstrument),t.style.setProperty("--color-cell-volume",n.cellVolume),t.style.setProperty("--color-cell-effect",n.cellEffect),t.style.setProperty("--color-cell-accent",n.cellAccent),t.style.setProperty("--color-cell-slide",n.cellSlide),t.style.setProperty("--color-cell-empty",n.cellEmpty)},Zy=a()(Gm((e,t)=>({currentThemeId:"devilbox",setTheme:t=>{const n=Xy.find(e=>e.id===t);n&&(Qy(n),e({currentThemeId:t}))},getCurrentTheme:()=>{const{currentThemeId:e}=t();return Xy.find(t=>t.id===e)||Yy}}),{name:"devilbox-theme",onRehydrateStorage:()=>e=>{if(e){const t=Xy.find(t=>t.id===e.currentThemeId)||Yy;Qy(t)}}}));if("undefined"!=typeof window){const e=localStorage.getItem("devilbox-theme");let t="devilbox";if(e)try{const n=JSON.parse(e);t=n.state?.currentThemeId||"devilbox"}catch{}const n=Xy.find(e=>e.id===t)||Yy;Qy(n)}let Jy=0;const eg=a((e,t)=>({notifications:[],addNotification:n=>{const a="notification-"+ ++Jy,s={...n,id:a,duration:n.duration??5e3};return e(e=>({notifications:[...e.notifications,s]})),s.duration&&s.duration>0&&setTimeout(()=>{t().removeNotification(a)},s.duration),a},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),tg={success:(e,t)=>eg.getState().addNotification({type:"success",message:e,duration:t}),error:(e,t)=>eg.getState().addNotification({type:"error",message:e,duration:t??8e3}),warning:(e,t)=>eg.getState().addNotification({type:"warning",message:e,duration:t}),info:(e,t)=>eg.getState().addNotification({type:"info",message:e,duration:t})};class ng{static instance=null;midiAccess=null;inputs=new Map;outputs=new Map;selectedInputId=null;selectedOutputId=null;messageHandlers=new Set;deviceChangeCallbacks=new Set;lastActivityTimestamp=0;boundMessageHandler=null;clockTickCount=0;lastClockTimestamp=0;clockBPM=0;clockSyncEnabled=!1;clockSyncCallbacks=new Set;transportCallbacks=new Set;constructor(){}static getInstance(){return ng.instance||(ng.instance=new ng),ng.instance}isSupported(){return"requestMIDIAccess"in navigator}async init(){if(!this.isSupported())return!1;try{return this.midiAccess=await navigator.requestMIDIAccess({sysex:!0}),this.updateDevices(),this.midiAccess.onstatechange=()=>{this.updateDevices(),this.notifyDeviceChange()},!0}catch(e){return!1}}updateDevices(){if(this.midiAccess){if(this.inputs.clear(),this.outputs.clear(),this.midiAccess.inputs.forEach((e,t)=>{this.inputs.set(t,e)}),this.midiAccess.outputs.forEach((e,t)=>{this.outputs.set(t,e)}),!this.selectedInputId){const e=this.detectTD3Devices().input;e&&this.selectInput(e.id)}if(!this.selectedOutputId){const e=this.detectTD3Devices().output;e&&this.selectOutput(e.id)}}}portToDeviceInfo(e,t){const n=e.name||"Unknown Device",a=e.manufacturer||"";return{id:e.id,name:n,manufacturer:a,type:t,isConnected:"open"===e.connection||"connected"===e.state,isTD3:this.isTD3Device(n,a)}}isTD3Device(e,t){const n=e.toLowerCase(),a=t.toLowerCase();return n.includes("td-3")||n.includes("td3")||a.includes("behringer")&&n.includes("303")}getInputDevices(){const e=[];return this.inputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"input"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}getOutputDevices(){const e=[];return this.outputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"output"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}detectTD3Devices(){const e=this.getInputDevices(),t=this.getOutputDevices();return{input:e.find(e=>e.isTD3)||null,output:t.find(e=>e.isTD3)||null}}async selectInput(e){if(this.selectedInputId){const e=this.inputs.get(this.selectedInputId);if(e){e.onmidimessage=null;try{await e.close()}catch{}}}if(this.selectedInputId=e,e){const n=this.inputs.get(e);if(n)try{await n.open(),this.boundMessageHandler=this.handleMIDIMessage.bind(this),n.onmidimessage=this.boundMessageHandler}catch(t){}}}selectOutput(e){this.selectedOutputId=e,e&&this.outputs.get(e)}getSelectedInput(){if(!this.selectedInputId)return null;const e=this.inputs.get(this.selectedInputId);return e?this.portToDeviceInfo(e,"input"):null}getSelectedOutput(){if(!this.selectedOutputId)return null;const e=this.outputs.get(this.selectedOutputId);return e?this.portToDeviceInfo(e,"output"):null}handleMIDIMessage(e){const t=e.data;if(!t||0===t.length)return;const n=t[0];if(248!==n){Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join(" "),t[0]>=240||(176==(240&t[0])||(144==(240&t[0])||(128==(240&t[0])||(224==(240&t[0])||t[0]))))}this.lastActivityTimestamp=Date.now();const a=this.parseMIDIMessage(n,t,e.timeStamp);this.clockSyncEnabled&&("clock"===a.type?this.processClockTick(e.timeStamp):"start"!==a.type&&"stop"!==a.type&&"continue"!==a.type||this.processTransportCommand(a.type)),"cc"===a.type||"noteOn"===a.type||"noteOff"===a.type||"pitchBend"===a.type||a.type,this.messageHandlers.forEach(e=>{try{e(a,this.selectedInputId||"")}catch(t){}})}processClockTick(e){if(this.clockTickCount++,this.lastClockTimestamp>0){const t=e-this.lastClockTimestamp;if(t>0){const e=2500/t;if(0===this.clockBPM?this.clockBPM=e:this.clockBPM=.9*this.clockBPM+.1*e,this.clockTickCount%24==0){const e=Math.round(10*this.clockBPM)/10;this.clockSyncCallbacks.forEach(t=>{try{t(e)}catch(n){}})}}}this.lastClockTimestamp=e}processTransportCommand(e){"start"===e&&(this.clockTickCount=0,this.lastClockTimestamp=0),this.transportCallbacks.forEach(t=>{try{t(e)}catch(n){}})}parseMIDIMessage(e,t,n){let a,s,r,o,i,l,c,d="other";if(e>=240)switch(a=-1,e){case 240:d="sysex";break;case 248:d="clock";break;case 250:d="start";break;case 251:d="continue";break;case 252:d="stop";break;default:d="other"}else{switch(a=15&e,240&e){case 144:d="noteOn",s=t[1],r=t[2],0===r&&(d="noteOff");break;case 128:d="noteOff",s=t[1],r=t[2];break;case 176:d="cc",o=t[1],i=t[2];break;case 192:d="programChange",c=t[1];break;case 224:d="pitchBend",l=(t[2]<<7|t[1])-8192;break;default:d="other"}}return{type:d,channel:a,data:t,timestamp:n,note:s,velocity:r,cc:o,value:i,pitchBend:l,program:c}}addMessageHandler(e){this.messageHandlers.add(e)}removeMessageHandler(e){this.messageHandlers.delete(e)}sendCC(e,t,n){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const s=new Uint8Array([176|15&e,127&t,127&n]);a.send(s)}sendSysEx(e){if(!this.selectedOutputId)return;const t=this.outputs.get(this.selectedOutputId);if(t)try{t.send(e)}catch(n){throw n}}sendNoteOn(e,t,n){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const s=new Uint8Array([144|15&e,127&t,127&n]);a.send(s)}sendNoteOff(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=new Uint8Array([128|15&e,127&t,0]);n.send(a)}sendPitchBend(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=Math.max(0,Math.min(16383,t+8192)),s=new Uint8Array([224|15&e,127&a,a>>7&127]);n.send(s)}sendProgramChange(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const a=new Uint8Array([192|15&e,127&t]);n.send(a)}setClockSyncEnabled(e){this.clockSyncEnabled=e,e||(this.clockTickCount=0,this.lastClockTimestamp=0,this.clockBPM=0)}isClockSyncEnabled(){return this.clockSyncEnabled}getClockBPM(){return Math.round(10*this.clockBPM)/10}onClockSync(e){return this.clockSyncCallbacks.add(e),()=>{this.clockSyncCallbacks.delete(e)}}onTransportCommand(e){return this.transportCallbacks.add(e),()=>{this.transportCallbacks.delete(e)}}onDeviceChange(e){return this.deviceChangeCallbacks.add(e),()=>{this.deviceChangeCallbacks.delete(e)}}notifyDeviceChange(){this.deviceChangeCallbacks.forEach(e=>{try{e()}catch(t){}})}getLastActivityTimestamp(){return this.lastActivityTimestamp}isInitialized(){return null!==this.midiAccess}dispose(){this.midiAccess&&(this.midiAccess.onstatechange=null),this.inputs.forEach(e=>{e.onmidimessage=null}),this.inputs.clear(),this.outputs.clear(),this.messageHandlers.clear(),this.deviceChangeCallbacks.clear(),this.clockSyncCallbacks.clear(),this.transportCallbacks.clear(),this.selectedInputId=null,this.selectedOutputId=null,this.midiAccess=null,this.clockSyncEnabled=!1,this.clockBPM=0,this.clockTickCount=0,this.lastClockTimestamp=0}}function ag(){return ng.getInstance()}class sg{static instance=null;mappings=new Map;lastCCValues=new Map;smoothedValues=new Map;globalSensitivity=.3;controlledInstrumentId=null;controlledInstrumentListeners=new Set;learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null};changeCallbacks=new Set;learnListeners=new Set;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return sg.instance||(sg.instance=new sg),sg.instance}init(){if(this.handlerRegistered)return;ag().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("cc"!==e.type||void 0===e.cc||void 0===e.value)return;if(this.learnState.isLearning&&this.learnState.callback)return void this.learnState.callback(e.cc,e.channel);const t=`${e.cc}-${e.channel}`,n=e.value,a=this.smoothedValues.get(t)??n,s=this.globalSensitivity,r=a+(n-a)*s;this.smoothedValues.set(t,r),this.mappings.forEach(t=>{if(t.ccNumber!==e.cc)return;if(void 0!==t.midiChannel&&t.midiChannel!==e.channel)return;const s=t.sensitivity??1,o=s<1?a+(n-a)*s:r,i=this.ccToParameter(o,t);this.notifyParameterChange(t.instrumentId,t.parameterPath,i)})};ccToParameter(e,t){const n=e/127;if("logarithmic"===t.curve){const e=Math.max(1,t.min),a=Math.max(e+1,t.max),s=Math.log(e),r=Math.log(a);return Math.exp(s+n*(r-s))}return t.min+n*(t.max-t.min)}parameterToCC(e,t){let n;if("logarithmic"===t.curve){const a=Math.max(1,t.min),s=Math.max(a+1,t.max),r=Math.log(a),o=Math.log(s);n=(Math.log(Math.max(a,e))-r)/(o-r)}else n=(e-t.min)/(t.max-t.min);return Math.round(Math.max(0,Math.min(127,127*n)))}startLearn(e,t,n,a,s,r="linear"){return new Promise(o=>{this.learnState={isLearning:!0,instrumentId:e,parameterPath:t,displayName:n,min:a,max:s,curve:r,callback:(e,t)=>{this.learnState.isLearning=!1,this.learnState.callback=null,this.notifyLearnChange(!1,null),o({ccNumber:e,channel:t})}},this.notifyLearnChange(!0,t)})}cancelLearn(){this.learnState.isLearning&&(this.learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null},this.notifyLearnChange(!1,null))}isLearning(){return this.learnState.isLearning}getLearningParameter(){return this.learnState.parameterPath}setMapping(e){this.mappings.forEach((t,n)=>{t.instrumentId===e.instrumentId&&t.parameterPath===e.parameterPath&&this.mappings.delete(n)}),this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}removeMappingsForInstrument(e){const t=[];this.mappings.forEach((n,a)=>{n.instrumentId===e&&t.push(a)}),t.forEach(e=>this.mappings.delete(e)),t.length>0&&(this.saveMappings(),this.notifyMappingChange())}getMappingForParameter(e,t){for(const n of this.mappings.values())if(n.instrumentId===e&&n.parameterPath===t)return n}getMappingsForInstrument(e){const t=[];return this.mappings.forEach(n=>{n.instrumentId===e&&t.push(n)}),t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}onParameterChange(e){return this.changeCallbacks.add(e),()=>this.changeCallbacks.delete(e)}onLearnChange(e){return this.learnListeners.add(e),()=>this.learnListeners.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyParameterChange(e,t,n){this.changeCallbacks.forEach(a=>{try{a(e,t,n)}catch(s){}})}notifyLearnChange(e,t){this.learnListeners.forEach(n=>{try{n(e,t)}catch(a){}})}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}setGlobalSensitivity(e){this.globalSensitivity=Math.max(.05,Math.min(1,e))}getGlobalSensitivity(){return this.globalSensitivity}resetSmoothing(){this.smoothedValues.clear(),this.lastCCValues.clear()}setControlledInstrument(e){this.controlledInstrumentId=e,this.resetSmoothing(),this.notifyControlledInstrumentChange(e)}getControlledInstrument(){return this.controlledInstrumentId}onControlledInstrumentChange(e){return this.controlledInstrumentListeners.add(e),()=>this.controlledInstrumentListeners.delete(e)}notifyControlledInstrumentChange(e){this.controlledInstrumentListeners.forEach(t=>{try{t(e)}catch(n){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("cc-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("cc-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){ag().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.changeCallbacks.clear(),this.learnListeners.clear(),this.mappingListeners.clear()}}function rg(){return sg.getInstance()}class og{static instance=null;mappings=new Map;actionHandlers=new Map;isLearning=!1;learningAction=null;learnCallback=null;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return og.instance||(og.instance=new og),og.instance}init(){if(this.handlerRegistered)return;ag().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if(this.isLearning&&this.learnCallback)return"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?void this.learnCallback(e.note,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63?void this.learnCallback(-e.cc-1,e.channel):void 0;"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?this.triggerButtonAction(e.note,void 0,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63&&this.triggerButtonAction(void 0,e.cc,e.channel)};triggerButtonAction(e,t,n){for(const a of this.mappings.values()){const s=void 0!==e&&a.midiNote===e,r=void 0!==t&&a.ccNumber===t;if(!s&&!r)continue;if(void 0!==a.midiChannel&&void 0!==n&&a.midiChannel!==n)continue;const o=this.actionHandlers.get(a.action);return void(o&&o())}}startLearn(e){return new Promise(t=>{this.isLearning=!0,this.learningAction=e,this.learnCallback=(e,n)=>{this.isLearning=!1,this.learningAction=null,this.learnCallback=null,t(e<0?{type:"cc",number:-e-1,channel:n}:{type:"note",number:e,channel:n})}})}cancelLearn(){this.isLearning=!1,this.learningAction=null,this.learnCallback=null}isInLearnMode(){return this.isLearning}getLearningAction(){return this.learningAction}setMapping(e){for(const[t,n]of this.mappings.entries())n.action===e.action&&this.mappings.delete(t);this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}getMappingForAction(e){for(const t of this.mappings.values())if(t.action===e)return t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}registerAction(e,t){return this.actionHandlers.set(e,t),()=>this.actionHandlers.delete(e)}unregisterAction(e){this.actionHandlers.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("button-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("button-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){ag().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.actionHandlers.clear(),this.mappingListeners.clear()}}function ig(){return og.getInstance()}class lg{static instance=null;mappings=new Map;triggerCallbacks=new Set;handlerRegistered=!1;isLearning=!1;learnCallback=null;constructor(){}static getInstance(){return lg.instance||(lg.instance=new lg),lg.instance}init(){if(this.handlerRegistered)return;ag().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("noteOn"!==e.type&&"noteOff"!==e.type)return;if(void 0===e.note)return;if(this.isLearning&&"noteOn"===e.type&&this.learnCallback)return void this.learnCallback(e.note,e.channel);const t=`${e.channel}-${e.note}`,n=this.mappings.get(t);if(n){const t="noteOff"===e.type?0:e.velocity??0;this.notifyTrigger(n,t)}};onTrigger(e){return this.triggerCallbacks.add(e),()=>this.triggerCallbacks.delete(e)}notifyTrigger(e,t){this.triggerCallbacks.forEach(n=>{try{n(e,t)}catch(a){}})}setMapping(e){this.mappings.set(e.id,e),this.saveMappings()}removeMapping(e){this.mappings.delete(e),this.saveMappings()}getMapping(e,t){return this.mappings.get(`${e}-${t}`)}getAllMappings(){return Array.from(this.mappings.values())}clearMappings(){this.mappings.clear(),this.saveMappings()}startLearn(e){this.isLearning=!0,this.learnCallback=(t,n)=>{this.isLearning=!1,this.learnCallback=null,e(t,n)}}cancelLearn(){this.isLearning=!1,this.learnCallback=null}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("pad-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("pad-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>this.mappings.set(e.id,e))}}catch(e){}}dispose(){this.handlerRegistered&&(ag().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1),this.triggerCallbacks.clear()}}function cg(){return lg.getInstance()}const dg={HEADER:new Uint8Array([240,0,32,50,0,1,10]),FOOTER:247,CMD_REQUEST_PATTERN:119,CMD_SEND_PATTERN:120},ug=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function pg(e){const{name:t,octave:n}=function(e){const t=Math.floor(e/12)-1;return{name:ug[e%12],octave:t}}(e);return t.includes("#")?`${t}${n}`:`${t}-${n}`}const hg={303:[{cc:70,param:"cutoff",label:"Cutoff"},{cc:71,param:"resonance",label:"Resonance"},{cc:72,param:"envMod",label:"Env Mod"},{cc:73,param:"decay",label:"Decay"},{cc:74,param:"accent",label:"Accent"},{cc:75,param:"overdrive",label:"Drive"},{cc:76,param:"slideTime",label:"Slide"},{cc:77,param:"mixer.volume",label:"Volume"}],Siren:[{cc:70,param:"siren.osc.frequency",label:"Osc Freq"},{cc:71,param:"siren.lfo.rate",label:"LFO Rate"},{cc:72,param:"siren.lfo.depth",label:"LFO Depth"},{cc:73,param:"siren.delay.time",label:"Delay Time"},{cc:74,param:"siren.delay.feedback",label:"Feedback"},{cc:75,param:"siren.delay.wet",label:"Delay Mix"},{cc:76,param:"siren.filter.frequency",label:"Filter"},{cc:77,param:"siren.reverb.wet",label:"Reverb"}],Furnace:[{cc:70,param:"furnace.algorithm",label:"Algorithm"},{cc:71,param:"furnace.feedback",label:"Feedback"},{cc:72,param:"furnace.op1TL",label:"Op1 TL"},{cc:73,param:"furnace.op1AR",label:"Op1 AR"},{cc:74,param:"furnace.op1DR",label:"Op1 DR"},{cc:75,param:"furnace.op1SL",label:"Op1 SL"},{cc:76,param:"furnace.op1RR",label:"Op1 RR"},{cc:77,param:"furnace.fms",label:"FM Sens"}],V2:[{cc:70,param:"v2.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"v2.filter1Cutoff",label:"Cutoff"},{cc:72,param:"v2.filter1Reso",label:"Reso"},{cc:73,param:"v2.envAttack",label:"Attack"},{cc:74,param:"v2.envDecay",label:"Decay"},{cc:75,param:"v2.envSustain",label:"Sustain"},{cc:76,param:"v2.envRelease",label:"Release"},{cc:77,param:"v2.lfo1Depth",label:"LFO Dep"}],Synare:[{cc:70,param:"synare.tune",label:"Tune"},{cc:71,param:"synare.osc2Mix",label:"Osc2 Mix"},{cc:72,param:"synare.filterCutoff",label:"Cutoff"},{cc:73,param:"synare.filterReso",label:"Reso"},{cc:74,param:"synare.filterEnvMod",label:"Env Mod"},{cc:75,param:"synare.filterDecay",label:"Flt Dcy"},{cc:76,param:"synare.sweepAmount",label:"Sweep"},{cc:77,param:"synare.sweepTime",label:"Swp Time"}],Dexed:[{cc:70,param:"dexed.algorithm",label:"Algorithm"},{cc:71,param:"dexed.feedback",label:"Feedback"},{cc:72,param:"dexed.op1Level",label:"Op1 Lvl"},{cc:73,param:"dexed.op1Coarse",label:"Op1 Coarse"},{cc:74,param:"dexed.lfoSpeed",label:"LFO Spd"},{cc:75,param:"dexed.lfoPitchMod",label:"LFO Pitch"},{cc:76,param:"dexed.lfoAmpMod",label:"LFO Amp"},{cc:77,param:"dexed.transpose",label:"Transpose"}],OBXd:[{cc:70,param:"obxd.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"obxd.osc2Level",label:"Osc2 Lvl"},{cc:72,param:"obxd.filterCutoff",label:"Cutoff"},{cc:73,param:"obxd.filterReso",label:"Reso"},{cc:74,param:"obxd.filterEnv",label:"Flt Env"},{cc:75,param:"obxd.ampAttack",label:"Attack"},{cc:76,param:"obxd.ampDecay",label:"Decay"},{cc:77,param:"obxd.volume",label:"Volume"}],SpaceLaser:[{cc:70,param:"spacelaser.startFreq",label:"Start Hz"},{cc:71,param:"spacelaser.endFreq",label:"End Hz"},{cc:72,param:"spacelaser.sweepTime",label:"Sweep"},{cc:73,param:"spacelaser.fmAmount",label:"FM Amt"},{cc:74,param:"spacelaser.fmRatio",label:"FM Ratio"},{cc:75,param:"spacelaser.filterCutoff",label:"Cutoff"},{cc:76,param:"spacelaser.filterReso",label:"Reso"},{cc:77,param:"spacelaser.delayWet",label:"Delay"}],SAM:[{cc:70,param:"sam.pitch",label:"Pitch"},{cc:71,param:"sam.speed",label:"Speed"},{cc:72,param:"sam.mouth",label:"Mouth"},{cc:73,param:"sam.throat",label:"Throat"},{cc:74,param:"mixer.volume",label:"Volume"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],Organ:[{cc:70,param:"organ.drawbar16",label:"16'"},{cc:71,param:"organ.drawbar8",label:"8'"},{cc:72,param:"organ.drawbar4",label:"4'"},{cc:73,param:"organ.percussion",label:"Perc"},{cc:74,param:"organ.vibratoType",label:"Vib Type"},{cc:75,param:"organ.vibratoDepth",label:"Vib Dep"},{cc:76,param:"organ.overdrive",label:"Drive"},{cc:77,param:"organ.volume",label:"Volume"}],Melodica:[{cc:70,param:"melodica.breath",label:"Breath"},{cc:71,param:"melodica.brightness",label:"Bright"},{cc:72,param:"melodica.vibratoRate",label:"Vib Rate"},{cc:73,param:"melodica.vibratoDepth",label:"Vib Dep"},{cc:74,param:"melodica.detune",label:"Detune"},{cc:75,param:"melodica.portamento",label:"Porta"},{cc:76,param:"melodica.attack",label:"Attack"},{cc:77,param:"melodica.volume",label:"Volume"}],FX:[{cc:70,param:"echo.rate",label:"Echo Rate"},{cc:71,param:"echo.intensity",label:"Intensity"},{cc:72,param:"echo.echoVolume",label:"Echo Vol"},{cc:73,param:"echo.reverbVolume",label:"Rev Vol"},{cc:74,param:"echo.mode",label:"Echo Mode"},{cc:75,param:"biphase.rateA",label:"Phase A"},{cc:76,param:"biphase.feedback",label:"Phase FB"},{cc:77,param:"biphase.routing",label:"Routing"}],Mixer:[{cc:70,param:"mixer.volume",label:"Vol 1"},{cc:71,param:"mixer.volume",label:"Vol 2"},{cc:72,param:"mixer.volume",label:"Vol 3"},{cc:73,param:"mixer.volume",label:"Vol 4"},{cc:74,param:"mixer.pan",label:"Pan 1"},{cc:75,param:"mixer.pan",label:"Pan 2"},{cc:76,param:"mixer.pan",label:"Pan 3"},{cc:77,param:"mixer.pan",label:"Pan 4"}]},mg={303:{x:{param:"cutoff",min:200,max:5e3,curve:"log"},y:{param:"resonance",min:0,max:100,curve:"linear"}},Siren:{x:{param:"siren.osc.frequency",min:60,max:1500,curve:"linear"},y:{param:"siren.lfo.rate",min:.1,max:20,curve:"linear"}},Furnace:{x:{param:"furnace.fms",min:0,max:7,curve:"linear"},y:{param:"furnace.op1SL",min:0,max:15,curve:"linear"}},V2:{x:{param:"v2.filter1Cutoff",min:0,max:127,curve:"linear"},y:{param:"v2.filter1Reso",min:0,max:127,curve:"linear"}},Synare:{x:{param:"synare.filterCutoff",min:20,max:2e4,curve:"log"},y:{param:"synare.filterEnvMod",min:0,max:100,curve:"linear"}},Dexed:{x:{param:"dexed.lfoPitchMod",min:0,max:99,curve:"linear"},y:{param:"dexed.lfoAmpMod",min:0,max:99,curve:"linear"}},OBXd:{x:{param:"obxd.filterCutoff",min:0,max:1,curve:"linear"},y:{param:"obxd.filterReso",min:0,max:1,curve:"linear"}},SpaceLaser:{x:{param:"spacelaser.fmAmount",min:0,max:100,curve:"linear"},y:{param:"spacelaser.filterCutoff",min:20,max:2e4,curve:"log"}},SAM:{x:{param:"sam.pitch",min:0,max:255,curve:"linear"},y:{param:"sam.speed",min:0,max:255,curve:"linear"}},Organ:{x:{param:"organ.vibratoDepth",min:0,max:1,curve:"linear"},y:{param:"organ.overdrive",min:0,max:1,curve:"linear"}},Melodica:{x:{param:"melodica.vibratoRate",min:0,max:10,curve:"linear"},y:{param:"melodica.brightness",min:0,max:1,curve:"linear"}}};const fg=e=>{const t=`${e}--1`;return Hm().instruments.get(t)},yg=(e,t)=>{const n=t/127,a=Py.getState(),s=a.currentInstrumentId,r=a.instruments.find(e=>e.id===s);if(r)switch(e){case"cutoff":a.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,cutoff:200*Math.pow(25,n)}}});break;case"resonance":a.updateInstrument(r.id,{tb303:{...r.tb303,filter:{...r.tb303.filter,resonance:100*n}}});break;case"envMod":a.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,envMod:100*n}}});break;case"decay":a.updateInstrument(r.id,{tb303:{...r.tb303,filterEnvelope:{...r.tb303.filterEnvelope,decay:30+2970*n}}});break;case"accent":a.updateInstrument(r.id,{tb303:{...r.tb303,accent:{amount:100*n}}});break;case"overdrive":a.updateInstrument(r.id,{tb303:{...r.tb303,overdrive:{...r.tb303.overdrive,amount:100*n}}});break;case"slideTime":a.updateInstrument(r.id,{tb303:{...r.tb303,slide:{...r.tb303.slide,time:2+358*n}}});break;case"siren.osc.frequency":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,oscillator:{...r.dubSiren.oscillator,frequency:60+940*n}}});break;case"siren.lfo.rate":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,rate:.1+19.9*n}}});break;case"siren.lfo.depth":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,lfo:{...r.dubSiren.lfo,depth:500*n}}});break;case"siren.delay.time":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,time:.01+.99*n}}});break;case"siren.delay.feedback":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,feedback:.95*n}}});break;case"siren.delay.wet":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,delay:{...r.dubSiren.delay,wet:n}}});break;case"siren.filter.frequency":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,filter:{...r.dubSiren.filter,frequency:20+9980*n}}});break;case"siren.reverb.wet":r.dubSiren&&a.updateInstrument(r.id,{dubSiren:{...r.dubSiren,reverb:{...r.dubSiren.reverb,wet:n}}});break;case"furnace.algorithm":r.furnace&&a.updateInstrument(r.id,{furnace:{...r.furnace,algorithm:Math.round(7*n)}});break;case"furnace.feedback":r.furnace&&a.updateInstrument(r.id,{furnace:{...r.furnace,feedback:Math.round(7*n)}});break;case"furnace.op1TL":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],tl:Math.round(127*n)},a.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1AR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],ar:Math.round(31*n)},a.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1DR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],dr:Math.round(31*n)},a.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1SL":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],sl:Math.round(15*n)},a.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.op1RR":if(r.furnace?.operators?.[0]){const e=[...r.furnace.operators];e[0]={...e[0],rr:Math.round(15*n)},a.updateInstrument(r.id,{furnace:{...r.furnace,operators:e}})}break;case"furnace.fms":r.furnace&&a.updateInstrument(r.id,{furnace:{...r.furnace,fms:Math.round(7*n)}});break;case"v2.osc1Level":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,osc1:{...r.v2.osc1,level:Math.round(127*n)}}});break;case"v2.filter1Cutoff":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,filter1:{...r.v2.filter1,cutoff:Math.round(127*n)}}});break;case"v2.filter1Reso":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,filter1:{...r.v2.filter1,resonance:Math.round(127*n)}}});break;case"v2.envAttack":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,attack:Math.round(127*n)}}});break;case"v2.envDecay":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,decay:Math.round(127*n)}}});break;case"v2.envSustain":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,sustain:Math.round(127*n)}}});break;case"v2.envRelease":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,envelope:{...r.v2.envelope,release:Math.round(127*n)}}});break;case"v2.lfo1Depth":r.v2&&a.updateInstrument(r.id,{v2:{...r.v2,lfo1:{...r.v2.lfo1,depth:Math.round(127*n)}}});break;case"synare.tune":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,oscillator:{...r.synare.oscillator,tune:20+980*n}}});break;case"synare.osc2Mix":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,oscillator2:{...r.synare.oscillator2,mix:n}}});break;case"synare.filterCutoff":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,cutoff:20*Math.pow(1e3,n)}}});break;case"synare.filterReso":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,resonance:100*n}}});break;case"synare.filterEnvMod":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,envMod:100*n}}});break;case"synare.filterDecay":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,filter:{...r.synare.filter,decay:10+1990*n}}});break;case"synare.sweepAmount":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,sweep:{...r.synare.sweep,amount:48*n}}});break;case"synare.sweepTime":r.synare&&a.updateInstrument(r.id,{synare:{...r.synare,sweep:{...r.synare.sweep,time:5+495*n}}});break;case"dexed.algorithm":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,algorithm:Math.round(31*n)}});break;case"dexed.feedback":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,feedback:Math.round(7*n)}});break;case"dexed.op1Level":if(r.dexed?.operators?.[0]){const e=[...r.dexed.operators];e[0]={...e[0],level:Math.round(99*n)},a.updateInstrument(r.id,{dexed:{...r.dexed,operators:e}})}break;case"dexed.op1Coarse":if(r.dexed?.operators?.[0]){const e=[...r.dexed.operators];e[0]={...e[0],coarse:Math.round(31*n)},a.updateInstrument(r.id,{dexed:{...r.dexed,operators:e}})}break;case"dexed.lfoSpeed":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,lfoSpeed:Math.round(99*n)}});break;case"dexed.lfoPitchMod":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,lfoPitchModDepth:Math.round(99*n)}});break;case"dexed.lfoAmpMod":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,lfoAmpModDepth:Math.round(99*n)}});break;case"dexed.transpose":r.dexed&&a.updateInstrument(r.id,{dexed:{...r.dexed,transpose:Math.round(48*n-24)}});break;case"obxd.osc1Level":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,osc1Level:n}});break;case"obxd.osc2Level":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,osc2Level:n}});break;case"obxd.filterCutoff":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,filterCutoff:n}});break;case"obxd.filterReso":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,filterResonance:n}});break;case"obxd.filterEnv":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,filterEnvAmount:n}});break;case"obxd.ampAttack":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,ampAttack:n}});break;case"obxd.ampDecay":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,ampDecay:n}});break;case"obxd.volume":r.obxd&&a.updateInstrument(r.id,{obxd:{...r.obxd,masterVolume:n}});break;case"spacelaser.startFreq":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,startFreq:100+9900*n}}});break;case"spacelaser.endFreq":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,endFreq:20+4980*n}}});break;case"spacelaser.sweepTime":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,laser:{...r.spaceLaser.laser,sweepTime:10+2990*n}}});break;case"spacelaser.fmAmount":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,fm:{...r.spaceLaser.fm,amount:100*n}}});break;case"spacelaser.fmRatio":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,fm:{...r.spaceLaser.fm,ratio:.5+15.5*n}}});break;case"spacelaser.filterCutoff":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,filter:{...r.spaceLaser.filter,cutoff:20*Math.pow(1e3,n)}}});break;case"spacelaser.filterReso":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,filter:{...r.spaceLaser.filter,resonance:100*n}}});break;case"spacelaser.delayWet":r.spaceLaser&&a.updateInstrument(r.id,{spaceLaser:{...r.spaceLaser,delay:{...r.spaceLaser.delay,wet:n}}});break;case"sam.pitch":r.sam&&a.updateInstrument(r.id,{sam:{...r.sam,pitch:Math.round(255*n)}});break;case"sam.speed":r.sam&&a.updateInstrument(r.id,{sam:{...r.sam,speed:Math.round(255*n)}});break;case"sam.mouth":r.sam&&a.updateInstrument(r.id,{sam:{...r.sam,mouth:Math.round(255*n)}});break;case"sam.throat":r.sam&&a.updateInstrument(r.id,{sam:{...r.sam,throat:Math.round(255*n)}});break;case"organ.drawbar16":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(0,8*n);break}case"organ.drawbar8":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(2,8*n);break}case"organ.drawbar4":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(3,8*n);break}case"organ.percussion":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(9,n);break}case"organ.vibratoType":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(13,Math.round(5*n));break}case"organ.vibratoDepth":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(14,n);break}case"organ.overdrive":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(15,n);break}case"organ.volume":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(16,n);break}case"melodica.breath":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(0,n);break}case"melodica.brightness":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(1,n);break}case"melodica.vibratoRate":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(2,10*n);break}case"melodica.vibratoDepth":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(3,n);break}case"melodica.detune":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(4,100*n-50);break}case"melodica.portamento":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(6,n);break}case"melodica.attack":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(7,n);break}case"melodica.volume":{const e=fg(r.id);e&&"setParameter"in e&&e.setParameter(9,n);break}case"echo.rate":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,rate:50+950*n}});break}case"echo.intensity":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,intensity:1.2*n}});break}case"echo.echoVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,echoVolume:n}});break}case"echo.reverbVolume":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,reverbVolume:n}});break}case"echo.mode":{const e=r.effects.find(e=>"SpaceEcho"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,mode:Math.floor(1+11*n)}});break}case"biphase.rateA":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,rateA:.1+9.9*n}});break}case"biphase.feedback":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,feedback:.95*n}});break}case"biphase.routing":{const e=r.effects.find(e=>"BiPhase"===e.type);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,routing:n>.5?1:0}});break}case"mixer.volume":a.updateInstrument(r.id,{volume:60*n-60});break;case"mixer.pan":a.updateInstrument(r.id,{pan:200*n-100})}};function gg(e,t){return`${e}:${t}`}function vg(e,t,n,a){return t+function(e,t="linear"){const n=Math.max(0,Math.min(127,e))/127;switch(t){case"exponential":return Math.pow(n,2);case"logarithmic":return Math.sqrt(n);default:return n}}(e,a)*(n-t)}const bg=[{ccNumber:74,parameter:"cutoff",min:200,max:2e4,curve:"logarithmic"},{ccNumber:71,parameter:"resonance",min:0,max:100,curve:"linear"},{ccNumber:10,parameter:"envMod",min:0,max:100,curve:"linear"},{ccNumber:75,parameter:"decay",min:30,max:3e3,curve:"logarithmic"},{ccNumber:16,parameter:"accent",min:0,max:100,curve:"linear"}],xg=new Map,wg=new Map,kg=a()(Gm(Rn((e,t)=>({isSupported:null,isInitialized:!1,lastError:null,inputDevices:[],outputDevices:[],selectedInputId:null,selectedOutputId:null,ccMappings:[...bg],isLearning:!1,learningParameter:null,lastActivityTimestamp:0,controlledInstrumentId:null,knobBank:"303",padBank:"A",midiOctaveOffset:0,showPatternDialog:!1,showKnobBar:!1,midiOutputEnabled:!0,init:async()=>{const n=ag();if(!n.isSupported())return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported in this browser"}),!1;e(e=>{e.isSupported=!0});try{if(await n.init()){n.addMessageHandler(e=>{const n=t();if(n.updateActivity(),"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){if(cg().getMapping(e.channel,e.note))return;if(36===e.note)return void n.setKnobBank("303");if(37===e.note)return void n.setKnobBank("Siren");if(38===e.note)return void n.setKnobBank("FX");if(39===e.note)return void n.setKnobBank("Mixer");const t=n.midiOctaveOffset||0,s=e.note+12*t,r=pg(s).replace("-",""),o=Py.getState(),i=o.currentInstrumentId,l=o.instruments.find(e=>e.id===i),c=o.previewInstrument||l||o.instruments[0];Math.pow(2,(s-69)/12);if(c){const t="TB303"===(a=c.synthType)||"Buzz3o3"===a||"Buzz3o3DF"===a?"303":"DubSiren"===a?"Siren":a.startsWith("Furnace")?"Furnace":"V2"===a||"V2Speech"===a?"V2":"Synare"===a?"Synare":"Dexed"===a||"DexedBridge"===a?"Dexed":"OBXd"===a?"OBXd":"SpaceLaser"===a?"SpaceLaser":"Sam"===a?"SAM":"TonewheelOrgan"===a?"Organ":"Melodica"===a?"Melodica":null;t&&n.knobBank!==t&&n.setKnobBank(t);const s=Hm(),{midiPolyphonic:o}=Wm.getState(),i=e.velocity/127,l=Math.max(.5,Math.sqrt(i));if(wg.set(e.note,r),o)s.triggerPolyNoteAttack(c.id,r,l,c);else{if(wg.size>1){for(const[n,a]of wg.entries())n!==e.note&&s.triggerPolyNoteRelease(c.id,a,c);const t=wg.get(e.note);wg.clear(),t&&wg.set(e.note,t)}s.triggerPolyNoteAttack(c.id,r,l,c)}}return}var a;if("noteOff"===e.type&&void 0!==e.note){if(cg().getMapping(e.channel,e.note))return;const t=wg.get(e.note);if(t){wg.delete(e.note);const n=Py.getState(),a=n.currentInstrumentId,s=n.instruments.find(e=>e.id===a),r=n.previewInstrument||s||n.instruments[0];if(r){Hm().triggerPolyNoteRelease(r.id,t,r)}}return}if("pitchBend"===e.type&&void 0!==e.pitchBend){const t=mg[n.knobBank];if(t?.x){const n=Math.round((e.pitchBend+8192)/16383*127);yg(t.x.param,n)}return}if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value){if(1===e.cc){const t=mg[n.knobBank];t?.y&&yg(t.y.param,e.value)}if(n.isLearning&&n.learningParameter)return void n.handleLearnedCC(e.cc);if(e.cc>=70&&e.cc<=77){const t=hg[n.knobBank].find(t=>t.cc===e.cc);if(t)return void yg(t.param,e.value)}const t=n.ccMappings.find(t=>t.ccNumber===e.cc);if(t){const n=e.value/127;let a;if("logarithmic"===t.curve){const e=Math.max(1,t.min),s=Math.max(e+1,t.max),r=Math.log(e),o=Math.log(s);a=Math.exp(r+n*(o-r))}else a=t.min+n*(t.max-t.min);const s=xg.get(t.parameter);s&&s(a)}}}),n.onDeviceChange(()=>{t().refreshDevices();const n=t();!n.selectedInputId&&n.inputDevices.length>0&&t().selectInput(n.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0})}),t().refreshDevices();const a=t();!a.selectedInputId&&a.inputDevices.length>0&&await t().selectInput(a.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0});rg().init();return ig().init(),e(e=>{e.isInitialized=!0,e.lastError=null}),!0}return e(e=>{e.lastError="Failed to initialize MIDI access"}),!1}catch(a){return e(e=>{e.lastError=a instanceof Error?a.message:"Unknown error"}),!1}},refreshDevices:()=>{const t=ag();e(e=>{e.inputDevices=t.getInputDevices(),e.outputDevices=t.getOutputDevices();const n=t.getSelectedInput(),a=t.getSelectedOutput();e.selectedInputId=n?.id||null,e.selectedOutputId=a?.id||null})},selectInput:async t=>{const n=ag();await n.selectInput(t),e(e=>{e.selectedInputId=t})},selectOutput:t=>{ag().selectOutput(t),e(e=>{e.selectedOutputId=t})},setMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t.ccNumber&&e.parameter!==t.parameter),e.ccMappings.push(t)})},removeMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t)})},resetMappings:()=>{e(e=>{e.ccMappings=[...bg]})},startLearn:t=>{e(e=>{e.isLearning=!0,e.learningParameter=t})},cancelLearn:()=>{e(e=>{e.isLearning=!1,e.learningParameter=null})},handleLearnedCC:n=>{const{learningParameter:a}=t();if(!a)return;const s=bg.find(e=>e.parameter===a),r=s?{...s,ccNumber:n}:{ccNumber:n,parameter:a,min:0,max:100,curve:"linear"};e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==n&&e.parameter!==a),e.ccMappings.push(r),e.isLearning=!1,e.learningParameter=null})},updateActivity:()=>{const n=Date.now(),a=t().lastActivityTimestamp;n-a>100&&e(e=>{e.lastActivityTimestamp=n})},openPatternDialog:()=>{e(e=>{e.showPatternDialog=!0})},closePatternDialog:()=>{e(e=>{e.showPatternDialog=!1})},registerCCHandler:(e,t)=>{xg.set(e,t)},unregisterCCHandler:e=>{xg.delete(e)},setControlledInstrument:t=>{e(e=>{e.controlledInstrumentId=t})},setKnobBank:t=>e(e=>{e.knobBank=t}),togglePadBank:()=>e(e=>{e.padBank="A"===e.padBank?"B":"A"}),setPadBank:t=>e(e=>{e.padBank=t}),setShowKnobBar:t=>{e(e=>{e.showKnobBar=t})},sendCC:(e,n,a=0)=>{const{midiOutputEnabled:s}=t();if(!s)return;const r=ag(),o=Math.max(0,Math.min(127,Math.round(n)));r.sendCC(a,e,o)},setMidiOutputEnabled:t=>{e(e=>{e.midiOutputEnabled=t})},setMidiOctaveOffset:t=>{e(e=>{e.midiOctaveOffset=Math.max(-4,Math.min(4,t))})},gridMappings:{},gridIsLearning:!1,gridLearningParameter:null,addGridMapping:t=>{t.channel<0||t.channel>15||t.controller<0||t.controller>127||t.min>t.max||e(e=>{const n=gg(t.channel,t.controller);e.gridMappings[n]=t})},removeGridMapping:(t,n)=>{e(e=>{const a=gg(t,n);delete e.gridMappings[a]})},getGridMapping:(e,n)=>{const a=gg(e,n);return t().gridMappings[a]},clearGridMappings:()=>{e(e=>{e.gridMappings={}})},startGridLearning:n=>{t().gridIsLearning||e(e=>{e.gridIsLearning=!0,e.gridLearningParameter=n})},stopGridLearning:()=>{e(e=>{e.gridIsLearning=!1,e.gridLearningParameter=null})},applyGridMIDIValue:(e,n,a)=>{const s=t().getGridMapping(e,n);return s?vg(a,s.min,s.max,s.curve):null}})),{name:"midi-settings",partialize:e=>({ccMappings:e.ccMappings,selectedInputId:e.selectedInputId,selectedOutputId:e.selectedOutputId,controlledInstrumentId:e.controlledInstrumentId,knobBank:e.knobBank,showKnobBar:e.showKnobBar,midiOutputEnabled:e.midiOutputEnabled,midiOctaveOffset:e.midiOctaveOffset,gridMappings:e.gridMappings})})),Sg=a((e,t)=>({activeNotes:new Map,adsrStages:new Map,adsrProgress:new Map,lfoPhases:new Map,samplePositions:new Map,setActiveNote:(t,n)=>{e(e=>{const a=new Map(e.activeNotes),s=a.get(t)||[],r=s.findIndex(e=>e.note===n.note);return r>=0?s[r]=n:s.push(n),a.set(t,s),{activeNotes:a}})},clearActiveNote:(t,n)=>{e(e=>{const a=new Map(e.activeNotes),s=(a.get(t)||[]).filter(e=>e.note!==n);return 0===s.length?a.delete(t):a.set(t,s),{activeNotes:a}})},clearChannelNotes:t=>{e(e=>{const n=new Map(e.activeNotes);return n.delete(t),{activeNotes:n}})},clearAllNotes:()=>{e({activeNotes:new Map})},setADSRStage:(t,n,a=0)=>{e(e=>{const s=new Map(e.adsrStages),r=new Map(e.adsrProgress);return s.set(t,n),r.set(t,a),{adsrStages:s,adsrProgress:r}})},setADSRProgress:(t,n)=>{e(e=>{const a=new Map(e.adsrProgress);return a.set(t,n),{adsrProgress:a}})},setLFOPhase:(t,n)=>{e(e=>{const a=new Map(e.lfoPhases);return a.set(t,n),{lfoPhases:a}})},setSamplePosition:(t,n)=>{e(e=>{const a=new Map(e.samplePositions);return a.set(t,Math.max(0,Math.min(1,n))),{samplePositions:a}})},clearSamplePosition:t=>{e(e=>{const n=new Map(e.samplePositions);return n.delete(t),{samplePositions:n}})}})),Mg=a()(Rn((e,t)=>({isLiveMode:!1,pendingPatternIndex:null,pendingPositionIndex:null,queueMode:"end-of-pattern",channelQueues:new Map,showQueueCountdown:!0,barsUntilSwitch:0,toggleLiveMode:()=>{const n=!t().isLiveMode;e(e=>{e.isLiveMode=n,n||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues=new Map)})},setLiveMode:t=>{e(e=>{e.isLiveMode=t,t||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues.clear())})},queuePattern:t=>{e(e=>{e.pendingPatternIndex=t})},queuePosition:t=>{e(e=>{e.pendingPositionIndex=t})},clearQueue:()=>{e(e=>{e.pendingPatternIndex=null,e.pendingPositionIndex=null})},setQueueMode:t=>{e(e=>{e.queueMode=t})},queueChannelAction:(t,n)=>{e(e=>{const a=e.channelQueues.get(t)||[];a.push(n),e.channelQueues.set(t,a)})},clearChannelQueue:t=>{e(e=>{e.channelQueues.delete(t)})},popChannelAction:n=>{const a=t().channelQueues.get(n);if(!a||0===a.length)return;const s=a.shift();return e(e=>{0===a.length?e.channelQueues.delete(n):e.channelQueues.set(n,a)}),s},updateBarsUntilSwitch:t=>{e(e=>{e.barsUntilSwitch=t})},setShowQueueCountdown:t=>{e(e=>{e.showQueueCountdown=t})}}))),Ng={horizontalZoom:16,verticalZoom:12,scrollX:0,scrollY:48,snapToGrid:!0,gridDivision:4,showVelocity:!0,showVelocityLane:!1,channelIndex:0,multiChannel:!1,scaleKey:"chromatic",scaleRoot:0,noteLengthPreset:0},Cg={notes:new Set,startRow:null,endRow:null,startNote:null,endNote:null},Eg=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Pg(e){const t=Math.floor(e/12)-1;return`${Eg[e%12]}${t}`}function Tg(e){return[1,3,6,8,10].includes(e%12)}const Ag=[{label:"Grid",value:0},{label:"1/32",value:1},{label:"1/16",value:2},{label:"1/8",value:4},{label:"1/4",value:8},{label:"1/2",value:16},{label:"1/1",value:32}],_g=a()(Rn((e,t)=>({view:{...Ng},selection:{...Cg,notes:new Set},drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},tool:"select",clipboard:null,contextMenu:{visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},ghostNotes:[],setHorizontalZoom:t=>e(e=>{e.view.horizontalZoom=Math.max(4,Math.min(64,t))}),setVerticalZoom:t=>e(e=>{e.view.verticalZoom=Math.max(8,Math.min(32,t))}),setScroll:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,t),e.view.scrollY=Math.max(0,Math.min(127,n))}),scrollBy:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,e.view.scrollX+t),e.view.scrollY=Math.max(0,Math.min(127,e.view.scrollY+n))}),setSnapToGrid:t=>e(e=>{e.view.snapToGrid=t}),setGridDivision:t=>e(e=>{e.view.gridDivision=t}),setShowVelocity:t=>e(e=>{e.view.showVelocity=t}),setShowVelocityLane:t=>e(e=>{e.view.showVelocityLane=t}),setChannelIndex:t=>e(e=>{e.view.channelIndex=t}),setMultiChannel:t=>e(e=>{e.view.multiChannel=t}),setScaleKey:t=>e(e=>{e.view.scaleKey=t}),setScaleRoot:t=>e(e=>{e.view.scaleRoot=Math.max(0,Math.min(11,t))}),setNoteLengthPreset:t=>e(e=>{e.view.noteLengthPreset=t}),selectNote:(t,n=!1)=>e(e=>{n?e.selection.notes.add(t):e.selection.notes=new Set([t])}),selectNotes:t=>e(e=>{e.selection.notes=new Set(t)}),selectAll:t=>e(e=>{e.selection.notes=new Set(t)}),deselectNote:t=>e(e=>{e.selection.notes.delete(t)}),clearSelection:()=>e(e=>{e.selection.notes=new Set,e.selection.startRow=null,e.selection.endRow=null,e.selection.startNote=null,e.selection.endNote=null}),setSelectionBox:(t,n,a,s)=>e(e=>{e.selection.startRow=t,e.selection.endRow=n,e.selection.startNote=a,e.selection.endNote=s}),startDrag:(t,n,a,s)=>e(e=>{e.drag.isDragging=!0,e.drag.mode=t,e.drag.startX=n,e.drag.startY=a,e.drag.currentX=n,e.drag.currentY=a,e.drag.noteId=s||null}),updateDrag:(t,n)=>e(e=>{e.drag.currentX=t,e.drag.currentY=n}),endDrag:()=>e(e=>{e.drag.isDragging=!1,e.drag.mode="none",e.drag.noteId=null,e.drag.originalNotes=[],e.ghostNotes=[]}),setTool:t=>e(e=>{e.tool=t}),copyNotes:t=>e(e=>{if(0===t.length)return;const n=Math.min(...t.map(e=>e.startRow)),a=Math.min(...t.map(e=>e.midiNote));e.clipboard={notes:t.map(e=>({...e})),minRow:n,minNote:a}}),getClipboard:()=>t().clipboard,showContextMenu:(t,n,a,s,r)=>e(e=>{e.contextMenu={visible:!0,x:t,y:n,noteId:a,row:s,midiNote:r}}),hideContextMenu:()=>e(e=>{e.contextMenu.visible=!1}),setGhostNotes:t=>e(e=>{e.ghostNotes=t}),clearGhostNotes:()=>e(e=>{e.ghostNotes=[]}),resetView:()=>e(e=>{e.view={...Ng},e.selection={...Cg,notes:new Set},e.drag={isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},e.tool="select",e.clipboard=null,e.contextMenu={visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},e.ghostNotes=[]})}))),Ig=0,Dg=1,Og=2,Fg=3,Rg="Synthesis",jg="Filter",Lg="Envelope",Bg="LFO",Vg="Effects",zg="Modulation",Ug="Arpeggiator",Gg="Output",Wg=1313559366,Kg=1313428297,Hg=1313426241,$g=1347179847,qg=1,Yg=0,Xg="DEViLBOX",Qg="devilbox-tracker-v1",Zg=[{id:"tb303.cutoff",name:"Cutoff",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:74,isAutomatable:!0},{id:"tb303.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,ccNumber:71,isAutomatable:!0},{id:"tb303.envMod",name:"Env Mod",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,ccNumber:102,isAutomatable:!0},{id:"tb303.decay",name:"Decay",section:Lg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,ccNumber:103,isAutomatable:!0},{id:"tb303.accent",name:"Accent",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,ccNumber:104,isAutomatable:!0},{id:"tb303.tuning",name:"Tuning",section:Rg,type:Ig,min:-1,max:1,defaultValue:0,unit:"semi",formatString:"%.1f",page:0,index:5,ccNumber:105,isAutomatable:!0},{id:"tb303.waveform",name:"Waveform",section:Rg,type:Fg,min:0,max:1,defaultValue:0,valueStrings:["Saw","Square"],page:0,index:6,ccNumber:106,isAutomatable:!0},{id:"tb303.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"dB",formatString:"%.1f",page:0,index:7,ccNumber:7,isAutomatable:!0},{id:"tb303.distortion",name:"Distortion",section:Vg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:0,ccNumber:94,isAutomatable:!0},{id:"tb303.delay.time",name:"Delay Time",section:Vg,type:Ig,min:0,max:1,defaultValue:.375,unit:"ms",formatString:"%.0f",page:1,index:1,ccNumber:85,isAutomatable:!0},{id:"tb303.delay.feedback",name:"Delay Fdbk",section:Vg,type:Ig,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,ccNumber:86,isAutomatable:!0},{id:"tb303.delay.mix",name:"Delay Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,ccNumber:87,isAutomatable:!0},{id:"tb303.reverb.size",name:"Reverb Size",section:Vg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:4,ccNumber:91,isAutomatable:!0},{id:"tb303.reverb.mix",name:"Reverb Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:5,ccNumber:92,isAutomatable:!0}],Jg=[{id:"dexed.algorithm",name:"Algorithm",section:Rg,type:Dg,min:0,max:31,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"dexed.feedback",name:"Feedback",section:Rg,type:Dg,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"dexed.lfoSpeed",name:"LFO Speed",section:Bg,type:Dg,min:0,max:99,defaultValue:35,page:0,index:2,isAutomatable:!0},{id:"dexed.lfoPitchModDepth",name:"LFO Pitch",section:Bg,type:Dg,min:0,max:99,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"dexed.lfoAmpModDepth",name:"LFO Amp",section:Bg,type:Dg,min:0,max:99,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"dexed.lfoWave",name:"LFO Wave",section:Bg,type:Fg,min:0,max:5,defaultValue:0,valueStrings:["Triangle","Saw Down","Saw Up","Square","Sine","S&H"],page:0,index:5,isAutomatable:!0},{id:"dexed.transpose",name:"Transpose",section:Rg,type:Dg,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:6,isAutomatable:!0},{id:"dexed.oscSync",name:"Osc Sync",section:Rg,type:Og,min:0,max:1,defaultValue:1,page:0,index:7,isAutomatable:!0},...function(){const e=[];for(let t=0;t<6;t++){const n=t+1;e.push({id:`dexed.op${t+1}.level`,name:`OP${t+1} Level`,section:Rg,type:Dg,min:0,max:99,defaultValue:0===t?99:0,page:n,index:0,isAutomatable:!0},{id:`dexed.op${t+1}.coarse`,name:`OP${t+1} Coarse`,section:Rg,type:Dg,min:0,max:31,defaultValue:1,page:n,index:1,isAutomatable:!0},{id:`dexed.op${t+1}.fine`,name:`OP${t+1} Fine`,section:Rg,type:Dg,min:0,max:99,defaultValue:0,page:n,index:2,isAutomatable:!0},{id:`dexed.op${t+1}.detune`,name:`OP${t+1} Detune`,section:Rg,type:Dg,min:0,max:14,defaultValue:7,page:n,index:3,isAutomatable:!0},{id:`dexed.op${t+1}.egRate1`,name:`OP${t+1} R1`,section:Lg,type:Dg,min:0,max:99,defaultValue:99,page:n,index:4,isAutomatable:!0},{id:`dexed.op${t+1}.egRate2`,name:`OP${t+1} R2`,section:Lg,type:Dg,min:0,max:99,defaultValue:99,page:n,index:5,isAutomatable:!0},{id:`dexed.op${t+1}.egRate3`,name:`OP${t+1} R3`,section:Lg,type:Dg,min:0,max:99,defaultValue:99,page:n,index:6,isAutomatable:!0},{id:`dexed.op${t+1}.egRate4`,name:`OP${t+1} R4`,section:Lg,type:Dg,min:0,max:99,defaultValue:99,page:n,index:7,isAutomatable:!0})}return e}()];const ev=[{id:"polysynth.oscillator.type",name:"Waveform",section:Rg,type:Fg,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"polysynth.oscillator.detune",name:"Detune",section:Rg,type:Ig,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"polysynth.filter.frequency",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"polysynth.filter.Q",name:"Resonance",section:jg,type:Ig,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"polysynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"polysynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"polysynth.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"polysynth.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"polysynth.maxPolyphony",name:"Voices",section:Rg,type:Dg,min:1,max:32,defaultValue:8,page:1,index:0,isAutomatable:!0},{id:"polysynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0}],tv=[{id:"noisesynth.noise.type",name:"Noise Type",section:Rg,type:Fg,min:0,max:2,defaultValue:0,valueStrings:["White","Pink","Brown"],page:0,index:0,isAutomatable:!0},{id:"noisesynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.005,unit:"s",formatString:"%.3f",page:0,index:1,isAutomatable:!0},{id:"noisesynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"noisesynth.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"noisesynth.envelope.release",name:"Release",section:Lg,type:Ig,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"noisesynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],nv=[{id:"sampler.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:0,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"sampler.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"sampler.baseUrl",name:"Sample",section:Rg,type:Fg,min:0,max:0,defaultValue:0,page:0,index:2,isAutomatable:!1},{id:"sampler.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],av=[{id:"furnace.algorithm",name:"Algorithm",section:Rg,type:Dg,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"furnace.feedback",name:"Feedback",section:Rg,type:Dg,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"furnace.op1.level",name:"OP1 Level",section:Rg,type:Dg,min:0,max:127,defaultValue:99,page:0,index:2,isAutomatable:!0},{id:"furnace.op1.mult",name:"OP1 Mult",section:Rg,type:Dg,min:0,max:15,defaultValue:1,page:0,index:3,isAutomatable:!0},{id:"furnace.op2.level",name:"OP2 Level",section:Rg,type:Dg,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.op2.mult",name:"OP2 Mult",section:Rg,type:Dg,min:0,max:15,defaultValue:1,page:0,index:5,isAutomatable:!0},{id:"furnace.lfoRate",name:"LFO Rate",section:Bg,type:Dg,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],sv=[{id:"furnace.duty",name:"Duty Cycle",section:Rg,type:Fg,min:0,max:3,defaultValue:2,valueStrings:["12.5%","25%","50%","75%"],page:0,index:0,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Gg,type:Dg,min:0,max:15,defaultValue:15,page:0,index:1,isAutomatable:!0},{id:"furnace.arpSpeed",name:"Arp Speed",section:Ug,type:Dg,min:0,max:15,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"furnace.pitchSlide",name:"Pitch Slide",section:zg,type:Dg,min:-127,max:127,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"furnace.vibrato",name:"Vibrato",section:Bg,type:Dg,min:0,max:15,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.noise",name:"Noise",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"furnace.envelope",name:"Env Mode",section:Lg,type:Dg,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0}],rv=[{id:"buzzmachine.param0",name:"Param 1",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"buzzmachine.param1",name:"Param 2",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"buzzmachine.param2",name:"Param 3",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"buzzmachine.param3",name:"Param 4",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"buzzmachine.param4",name:"Param 5",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"buzzmachine.param5",name:"Param 6",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"buzzmachine.param6",name:"Param 7",section:Lg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"buzzmachine.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ov=[{id:"generic.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:7,isAutomatable:!0},{id:"generic.pan",name:"Pan",section:Gg,type:Ig,min:-1,max:1,defaultValue:0,formatString:"%.2f",page:0,index:1,ccNumber:10,isAutomatable:!0}],iv={TB303:Zg,Dexed:Jg,OBXd:[{id:"obxd.osc1Waveform",name:"Osc1 Wave",section:Rg,type:Fg,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"obxd.osc1Octave",name:"Osc1 Oct",section:Rg,type:Dg,min:-2,max:2,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"obxd.osc1PulseWidth",name:"Osc1 PW",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"obxd.osc1Level",name:"Osc1 Level",section:Rg,type:Ig,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"obxd.osc2Waveform",name:"Osc2 Wave",section:Rg,type:Fg,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:4,isAutomatable:!0},{id:"obxd.osc2Octave",name:"Osc2 Oct",section:Rg,type:Dg,min:-2,max:2,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"obxd.osc2Detune",name:"Osc2 Detune",section:Rg,type:Ig,min:-1,max:1,defaultValue:.1,unit:"semi",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"obxd.osc2Level",name:"Osc2 Level",section:Rg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"obxd.filterCutoff",name:"Cutoff",section:jg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:0,isAutomatable:!0},{id:"obxd.filterResonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"obxd.filterEnvAmount",name:"Env Amount",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"obxd.filterKeyTrack",name:"Key Track",section:jg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"obxd.filterAttack",name:"Flt Attack",section:Lg,type:Ig,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:1,index:4,isAutomatable:!0},{id:"obxd.filterDecay",name:"Flt Decay",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:5,isAutomatable:!0},{id:"obxd.filterSustain",name:"Flt Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"obxd.filterRelease",name:"Flt Release",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:7,isAutomatable:!0},{id:"obxd.ampAttack",name:"Amp Attack",section:Lg,type:Ig,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:2,index:0,isAutomatable:!0},{id:"obxd.ampDecay",name:"Amp Decay",section:Lg,type:Ig,min:0,max:1,defaultValue:.2,unit:"s",formatString:"%.2f",page:2,index:1,isAutomatable:!0},{id:"obxd.ampSustain",name:"Amp Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:2,isAutomatable:!0},{id:"obxd.ampRelease",name:"Amp Release",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:2,index:3,isAutomatable:!0},{id:"obxd.masterVolume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:4,isAutomatable:!0},{id:"obxd.portamento",name:"Portamento",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:2,index:5,isAutomatable:!0},{id:"obxd.unison",name:"Unison",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:2,index:6,isAutomatable:!0},{id:"obxd.unisonDetune",name:"Uni Detune",section:Rg,type:Ig,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:2,index:7,isAutomatable:!0},{id:"obxd.lfoRate",name:"LFO Rate",section:Bg,type:Ig,min:0,max:1,defaultValue:.2,unit:"Hz",formatString:"%.1f",page:3,index:0,isAutomatable:!0},{id:"obxd.lfoWaveform",name:"LFO Wave",section:Bg,type:Fg,min:0,max:4,defaultValue:0,valueStrings:["Sine","Triangle","Saw","Square","S&H"],page:3,index:1,isAutomatable:!0},{id:"obxd.lfoOscAmount",name:"LFO>Pitch",section:Bg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:2,isAutomatable:!0},{id:"obxd.lfoFilterAmount",name:"LFO>Filter",section:Bg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:3,isAutomatable:!0},{id:"obxd.lfoAmpAmount",name:"LFO>Amp",section:Bg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:4,isAutomatable:!0},{id:"obxd.lfoPwAmount",name:"LFO>PW",section:Bg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:5,isAutomatable:!0},{id:"obxd.oscSync",name:"Osc Sync",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:3,index:6,isAutomatable:!0},{id:"obxd.oscXor",name:"Ring Mod",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:3,index:7,isAutomatable:!0}],DubSiren:[{id:"dubsiren.oscillator.type",name:"Osc Type",section:Rg,type:Fg,min:0,max:3,defaultValue:0,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:0,isAutomatable:!0},{id:"dubsiren.oscillator.frequency",name:"Frequency",section:Rg,type:Ig,min:60,max:1e3,defaultValue:440,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"dubsiren.lfo.enabled",name:"LFO On",section:Bg,type:Og,min:0,max:1,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"dubsiren.lfo.type",name:"LFO Type",section:Bg,type:Fg,min:0,max:3,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:3,isAutomatable:!0},{id:"dubsiren.lfo.rate",name:"LFO Rate",section:Bg,type:Ig,min:0,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"dubsiren.lfo.depth",name:"LFO Depth",section:Bg,type:Ig,min:0,max:1e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"dubsiren.filter.enabled",name:"Filter On",section:jg,type:Og,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"dubsiren.filter.frequency",name:"Filter Freq",section:jg,type:Ig,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"dubsiren.delay.enabled",name:"Delay On",section:Vg,type:Og,min:0,max:1,defaultValue:1,page:1,index:0,isAutomatable:!0},{id:"dubsiren.delay.time",name:"Delay Time",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"dubsiren.delay.feedback",name:"Delay Fdbk",section:Vg,type:Ig,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"dubsiren.delay.wet",name:"Delay Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"dubsiren.reverb.enabled",name:"Reverb On",section:Vg,type:Og,min:0,max:1,defaultValue:1,page:1,index:4,isAutomatable:!0},{id:"dubsiren.reverb.decay",name:"Reverb Dec",section:Vg,type:Ig,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"dubsiren.reverb.wet",name:"Reverb Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],SpaceLaser:[{id:"spacelaser.laser.startFreq",name:"Start Freq",section:Rg,type:Ig,min:100,max:1e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"spacelaser.laser.endFreq",name:"End Freq",section:Rg,type:Ig,min:20,max:2e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"spacelaser.laser.sweepTime",name:"Sweep Time",section:Lg,type:Ig,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"spacelaser.laser.sweepCurve",name:"Curve",section:Lg,type:Fg,min:0,max:1,defaultValue:0,valueStrings:["Exp","Linear"],page:0,index:3,isAutomatable:!0},{id:"spacelaser.fm.amount",name:"FM Amount",section:zg,type:Ig,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"spacelaser.fm.ratio",name:"FM Ratio",section:zg,type:Ig,min:.5,max:16,defaultValue:1,formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"spacelaser.noise.amount",name:"Noise",section:Rg,type:Ig,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"spacelaser.filter.cutoff",name:"Filter",section:jg,type:Ig,min:20,max:2e4,defaultValue:2e4,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"spacelaser.delay.enabled",name:"Delay On",section:Vg,type:Og,min:0,max:1,defaultValue:0,page:1,index:0,isAutomatable:!0},{id:"spacelaser.delay.time",name:"Delay Time",section:Vg,type:Ig,min:0,max:1,defaultValue:.25,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"spacelaser.delay.feedback",name:"Delay Fdbk",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"spacelaser.delay.wet",name:"Delay Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"spacelaser.reverb.enabled",name:"Reverb On",section:Vg,type:Og,min:0,max:1,defaultValue:0,page:1,index:4,isAutomatable:!0},{id:"spacelaser.reverb.decay",name:"Reverb Dec",section:Vg,type:Ig,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"spacelaser.reverb.wet",name:"Reverb Mix",section:Vg,type:Ig,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],Synare:[{id:"synare.oscillator.tune",name:"Tune",section:Rg,type:Ig,min:20,max:1e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"synare.oscillator.fine",name:"Fine Tune",section:Rg,type:Ig,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"synare.oscillator2.enabled",name:"Osc2 On",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"synare.oscillator2.detune",name:"Osc2 Detune",section:Rg,type:Ig,min:-24,max:24,defaultValue:7,unit:"semi",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"synare.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"synare.filter.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:100,defaultValue:20,unit:"%",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"synare.filter.envMod",name:"Flt Env",section:jg,type:Ig,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"synare.filter.decay",name:"Flt Decay",section:Lg,type:Ig,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"synare.envelope.decay",name:"Amp Decay",section:Lg,type:Ig,min:10,max:2e3,defaultValue:300,unit:"ms",formatString:"%.0f",page:1,index:0,isAutomatable:!0},{id:"synare.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"synare.sweep.enabled",name:"Sweep On",section:zg,type:Og,min:0,max:1,defaultValue:1,page:1,index:2,isAutomatable:!0},{id:"synare.sweep.amount",name:"Sweep Amt",section:zg,type:Ig,min:0,max:48,defaultValue:12,unit:"semi",formatString:"%.0f",page:1,index:3,isAutomatable:!0},{id:"synare.sweep.time",name:"Sweep Time",section:zg,type:Ig,min:1,max:500,defaultValue:50,unit:"ms",formatString:"%.0f",page:1,index:4,isAutomatable:!0},{id:"synare.noise.enabled",name:"Noise On",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"synare.noise.mix",name:"Noise Mix",section:Rg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"synare.noise.color",name:"Noise Color",section:Rg,type:Ig,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:1,index:7,isAutomatable:!0}],V2:[{id:"v2.osc1.mode",name:"Osc1 Mode",section:Rg,type:Fg,min:0,max:7,defaultValue:1,valueStrings:["Off","Saw/Tri","Pulse","Sin","Noise","XX","AuxA","AuxB"],page:0,index:0,isAutomatable:!0},{id:"v2.osc1.transpose",name:"Osc1 Trans",section:Rg,type:Dg,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:1,isAutomatable:!0},{id:"v2.osc1.color",name:"Osc1 Color",section:Rg,type:Dg,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"v2.osc1.level",name:"Osc1 Level",section:Rg,type:Dg,min:0,max:127,defaultValue:127,page:0,index:3,isAutomatable:!0},{id:"v2.osc2.mode",name:"Osc2 Mode",section:Rg,type:Fg,min:0,max:7,defaultValue:0,valueStrings:["!Off","Tri","Pulse","Sin","Noise","FM","AuxA","AuxB"],page:0,index:4,isAutomatable:!0},{id:"v2.osc2.transpose",name:"Osc2 Trans",section:Rg,type:Dg,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:5,isAutomatable:!0},{id:"v2.osc2.detune",name:"Osc2 Detune",section:Rg,type:Dg,min:-64,max:63,defaultValue:10,page:0,index:6,isAutomatable:!0},{id:"v2.osc2.level",name:"Osc2 Level",section:Rg,type:Dg,min:0,max:127,defaultValue:0,page:0,index:7,isAutomatable:!0},{id:"v2.filter1.mode",name:"Flt1 Mode",section:jg,type:Fg,min:0,max:7,defaultValue:1,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:0,isAutomatable:!0},{id:"v2.filter1.cutoff",name:"Flt1 Cutoff",section:jg,type:Dg,min:0,max:127,defaultValue:127,page:1,index:1,isAutomatable:!0},{id:"v2.filter1.resonance",name:"Flt1 Reso",section:jg,type:Dg,min:0,max:127,defaultValue:0,page:1,index:2,isAutomatable:!0},{id:"v2.filter2.mode",name:"Flt2 Mode",section:jg,type:Fg,min:0,max:7,defaultValue:0,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:3,isAutomatable:!0},{id:"v2.filter2.cutoff",name:"Flt2 Cutoff",section:jg,type:Dg,min:0,max:127,defaultValue:127,page:1,index:4,isAutomatable:!0},{id:"v2.filter2.resonance",name:"Flt2 Reso",section:jg,type:Dg,min:0,max:127,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"v2.routing.mode",name:"Routing",section:jg,type:Fg,min:0,max:2,defaultValue:0,valueStrings:["Single","Serial","Parallel"],page:1,index:6,isAutomatable:!0},{id:"v2.routing.balance",name:"Balance",section:jg,type:Dg,min:0,max:127,defaultValue:64,page:1,index:7,isAutomatable:!0},{id:"v2.envelope.attack",name:"Amp Attack",section:Lg,type:Dg,min:0,max:127,defaultValue:0,page:2,index:0,isAutomatable:!0},{id:"v2.envelope.decay",name:"Amp Decay",section:Lg,type:Dg,min:0,max:127,defaultValue:64,page:2,index:1,isAutomatable:!0},{id:"v2.envelope.sustain",name:"Amp Sustain",section:Lg,type:Dg,min:0,max:127,defaultValue:127,page:2,index:2,isAutomatable:!0},{id:"v2.envelope.release",name:"Amp Release",section:Lg,type:Dg,min:0,max:127,defaultValue:32,page:2,index:3,isAutomatable:!0},{id:"v2.envelope2.attack",name:"Env2 Attack",section:Lg,type:Dg,min:0,max:127,defaultValue:0,page:2,index:4,isAutomatable:!0},{id:"v2.envelope2.decay",name:"Env2 Decay",section:Lg,type:Dg,min:0,max:127,defaultValue:64,page:2,index:5,isAutomatable:!0},{id:"v2.lfo1.rate",name:"LFO Rate",section:Bg,type:Dg,min:0,max:127,defaultValue:64,page:2,index:6,isAutomatable:!0},{id:"v2.lfo1.depth",name:"LFO Depth",section:Bg,type:Dg,min:0,max:127,defaultValue:0,page:2,index:7,isAutomatable:!0}],Sam:[{id:"sam.speed",name:"Speed",section:Rg,type:Dg,min:20,max:200,defaultValue:72,page:0,index:0,isAutomatable:!0},{id:"sam.pitch",name:"Pitch",section:Rg,type:Dg,min:20,max:200,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"sam.mouth",name:"Mouth",section:Rg,type:Dg,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"sam.throat",name:"Throat",section:Rg,type:Dg,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"sam.singMode",name:"Sing Mode",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"sam.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MonoSynth:[{id:"monosynth.oscillator.type",name:"Waveform",section:Rg,type:Fg,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"monosynth.oscillator.detune",name:"Detune",section:Rg,type:Ig,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"monosynth.filter.frequency",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"monosynth.filter.Q",name:"Resonance",section:jg,type:Ig,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"monosynth.filterEnvelope.amount",name:"Flt Env",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"monosynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monosynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.2,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"monosynth.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"monosynth.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:1,index:0,isAutomatable:!0},{id:"monosynth.portamento",name:"Portamento",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"monosynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],DuoSynth:[{id:"duosynth.voice0.oscillator.type",name:"V0 Wave",section:Rg,type:Fg,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"duosynth.voice0.filter.frequency",name:"V0 Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"duosynth.voice0.filter.Q",name:"V0 Reso",section:jg,type:Ig,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"duosynth.voice0.envelope.attack",name:"V0 Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"duosynth.voice1.oscillator.type",name:"V1 Wave",section:Rg,type:Fg,min:0,max:4,defaultValue:2,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:4,isAutomatable:!0},{id:"duosynth.voice1.filter.frequency",name:"V1 Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"duosynth.voice1.filter.Q",name:"V1 Reso",section:jg,type:Ig,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"duosynth.harmonicity",name:"Harmonicity",section:Rg,type:Ig,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"duosynth.vibratoRate",name:"Vib Rate",section:Bg,type:Ig,min:0,max:20,defaultValue:5,unit:"Hz",formatString:"%.1f",page:1,index:0,isAutomatable:!0},{id:"duosynth.vibratoAmount",name:"Vib Amount",section:Bg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"duosynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],PolySynth:ev,Synth:ev,FMSynth:[{id:"fmsynth.modulationIndex",name:"Mod Index",section:zg,type:Ig,min:0,max:100,defaultValue:10,formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"fmsynth.harmonicity",name:"Harmonicity",section:Rg,type:Ig,min:.5,max:8,defaultValue:1,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.attack",name:"Mod Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.decay",name:"Mod Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.sustain",name:"Mod Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"fmsynth.envelope.attack",name:"Amp Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"fmsynth.envelope.decay",name:"Amp Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"fmsynth.envelope.sustain",name:"Amp Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],AMSynth:[{id:"amsynth.harmonicity",name:"Harmonicity",section:Rg,type:Ig,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"amsynth.modulationEnvelope.attack",name:"Mod Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"amsynth.modulationEnvelope.decay",name:"Mod Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"amsynth.envelope.attack",name:"Amp Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"amsynth.envelope.decay",name:"Amp Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"amsynth.envelope.sustain",name:"Amp Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"amsynth.envelope.release",name:"Amp Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"amsynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MembraneSynth:[{id:"membranesynth.pitchDecay",name:"Pitch Decay",section:Lg,type:Ig,min:0,max:.5,defaultValue:.05,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"membranesynth.octaves",name:"Octaves",section:Rg,type:Ig,min:.5,max:8,defaultValue:4,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"membranesynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:2,isAutomatable:!0},{id:"membranesynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:.01,max:2,defaultValue:.4,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"membranesynth.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.01,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"membranesynth.envelope.release",name:"Release",section:Lg,type:Ig,min:.01,max:2,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"membranesynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],MetalSynth:[{id:"metalsynth.frequency",name:"Frequency",section:Rg,type:Ig,min:20,max:8e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"metalsynth.harmonicity",name:"Harmonicity",section:Rg,type:Ig,min:1,max:10,defaultValue:5.1,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"metalsynth.modulationIndex",name:"Mod Index",section:zg,type:Ig,min:0,max:100,defaultValue:32,formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"metalsynth.resonance",name:"Resonance",section:Rg,type:Ig,min:0,max:7e3,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"metalsynth.octaves",name:"Octaves",section:Rg,type:Ig,min:.5,max:4,defaultValue:1.5,formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"metalsynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:5,isAutomatable:!0},{id:"metalsynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:.01,max:4,defaultValue:1.4,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"metalsynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],NoiseSynth:tv,PluckSynth:[{id:"plucksynth.attackNoise",name:"Attack Noise",section:Rg,type:Ig,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"plucksynth.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.9,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"plucksynth.dampening",name:"Dampening",section:jg,type:Ig,min:1e3,max:1e4,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"plucksynth.release",name:"Release",section:Lg,type:Ig,min:.1,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"plucksynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0}],Sampler:nv,Player:nv,SuperSaw:[{id:"supersaw.detune",name:"Detune",section:Rg,type:Ig,min:0,max:100,defaultValue:30,unit:"ct",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"supersaw.mix",name:"Mix",section:Rg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"supersaw.voices",name:"Voices",section:Rg,type:Dg,min:1,max:7,defaultValue:7,page:0,index:2,isAutomatable:!0},{id:"supersaw.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:8e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"supersaw.filter.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"supersaw.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"supersaw.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"supersaw.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Organ:[{id:"organ.drawbar1",name:"16'",section:Rg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"organ.drawbar2",name:"5 1/3'",section:Rg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"organ.drawbar3",name:"8'",section:Rg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"organ.drawbar4",name:"4'",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"organ.drawbar5",name:"2 2/3'",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"organ.drawbar6",name:"2'",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"organ.percussion",name:"Percussion",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"organ.vibrato",name:"Vibrato",section:Bg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DrumMachine:[{id:"drummachine.kick.tune",name:"Kick Tune",section:Rg,type:Ig,min:20,max:200,defaultValue:60,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"drummachine.kick.decay",name:"Kick Decay",section:Lg,type:Ig,min:.05,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"drummachine.snare.tune",name:"Snare Tune",section:Rg,type:Ig,min:100,max:400,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"drummachine.snare.snappy",name:"Snare Snap",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"drummachine.hihat.decay",name:"HiHat Decay",section:Lg,type:Ig,min:.01,max:1,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"drummachine.tone",name:"Tone",section:jg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"drummachine.accent",name:"Accent",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"drummachine.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],ChipSynth:[{id:"chipsynth.waveform",name:"Waveform",section:Rg,type:Fg,min:0,max:4,defaultValue:1,valueStrings:["Square","Pulse25","Pulse12","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"chipsynth.duty",name:"Duty",section:Rg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"chipsynth.pitchBend",name:"Pitch Bend",section:Rg,type:Dg,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:2,isAutomatable:!0},{id:"chipsynth.vibrato",name:"Vibrato",section:Bg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"chipsynth.arpSpeed",name:"Arp Speed",section:Ug,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"chipsynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"chipsynth.envelope.decay",name:"Decay",section:Lg,type:Ig,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"chipsynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],PWMSynth:[{id:"pwmsynth.pulseWidth",name:"Pulse Width",section:Rg,type:Ig,min:.01,max:.99,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"pwmsynth.lfo.rate",name:"LFO Rate",section:Bg,type:Ig,min:.1,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"pwmsynth.lfo.depth",name:"LFO Depth",section:Bg,type:Ig,min:0,max:.49,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"pwmsynth.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"pwmsynth.filter.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"pwmsynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"pwmsynth.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"pwmsynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WobbleBass:[{id:"wobblebass.lfo.rate",name:"Wobble Rate",section:Bg,type:Ig,min:.1,max:20,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"wobblebass.lfo.depth",name:"Wobble Depth",section:Bg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"wobblebass.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:5e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wobblebass.filter.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.6,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wobblebass.distortion",name:"Distortion",section:Vg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"wobblebass.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wobblebass.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"wobblebass.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],StringMachine:[{id:"stringmachine.ensemble",name:"Ensemble",section:Vg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"stringmachine.detune",name:"Detune",section:Rg,type:Ig,min:0,max:50,defaultValue:15,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"stringmachine.voices",name:"Voices",section:Rg,type:Dg,min:2,max:8,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"stringmachine.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:1e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"stringmachine.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:3,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"stringmachine.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"stringmachine.chorus",name:"Chorus",section:Vg,type:Ig,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"stringmachine.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],FormantSynth:[{id:"formantsynth.vowel",name:"Vowel",section:Rg,type:Fg,min:0,max:4,defaultValue:0,valueStrings:["A","E","I","O","U"],page:0,index:0,isAutomatable:!0},{id:"formantsynth.formant1",name:"Formant 1",section:jg,type:Ig,min:200,max:2e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"formantsynth.formant2",name:"Formant 2",section:jg,type:Ig,min:500,max:4e3,defaultValue:1200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"formantsynth.nasality",name:"Nasality",section:Rg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"formantsynth.vibrato",name:"Vibrato",section:Bg,type:Ig,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"formantsynth.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"formantsynth.envelope.release",name:"Release",section:Lg,type:Ig,min:0,max:3,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"formantsynth.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],GranularSynth:[{id:"granular.grainSize",name:"Grain Size",section:Rg,type:Ig,min:.01,max:.5,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"granular.overlap",name:"Overlap",section:Rg,type:Ig,min:.1,max:2,defaultValue:.5,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"granular.playbackRate",name:"Speed",section:Rg,type:Ig,min:.25,max:4,defaultValue:1,formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"granular.detune",name:"Detune",section:Rg,type:Dg,min:-1200,max:1200,defaultValue:0,unit:"ct",page:0,index:3,isAutomatable:!0},{id:"granular.drift",name:"Drift",section:zg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"granular.reverse",name:"Reverse",section:Rg,type:Og,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"granular.loop",name:"Loop",section:Rg,type:Og,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"granular.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Wavetable:[{id:"wavetable.tablePosition",name:"Position",section:Rg,type:Ig,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"wavetable.morphSpeed",name:"Morph Speed",section:zg,type:Ig,min:0,max:10,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"wavetable.filter.cutoff",name:"Cutoff",section:jg,type:Ig,min:20,max:2e4,defaultValue:1e4,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wavetable.filter.resonance",name:"Resonance",section:jg,type:Ig,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wavetable.envelope.attack",name:"Attack",section:Lg,type:Ig,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"wavetable.envelope.decay",name:"Decay",section:Lg,type:Ig,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wavetable.envelope.sustain",name:"Sustain",section:Lg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"wavetable.volume",name:"Volume",section:Gg,type:Ig,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Buzz3o3:Zg,BuzzM3:rv,Buzz4FM2F:av,BuzzDynamite6:rv,BuzzKick:rv,BuzzKickXP:rv,BuzzTrilok:rv,BuzzNoise:tv,BuzzFreqBomb:rv,BuzzDTMF:rv,Buzzmachine:rv,Furnace:av,FurnaceOPN:av,FurnaceOPN2203:av,FurnaceOPNA:av,FurnaceOPNB:av,FurnaceOPNBB:av,FurnaceOPM:av,FurnaceOPL:av,FurnaceOPLL:av,FurnaceOPL4:av,FurnaceOPZ:av,FurnaceY8950:av,FurnaceESFM:av,FurnaceVRC7:av,FurnaceNES:sv,FurnaceGB:sv,FurnacePSG:sv,FurnacePCE:sv,FurnaceSNES:sv,FurnaceVB:sv,FurnaceLynx:sv,FurnaceSWAN:sv,FurnaceNDS:sv,FurnaceGBA:sv,FurnacePOKEMINI:sv,FurnaceVRC6:sv,FurnaceN163:sv,FurnaceFDS:sv,FurnaceMMC5:sv,FurnaceC64:sv,FurnaceSID6581:sv,FurnaceSID8580:sv,FurnaceAY:sv,FurnaceAY8930:sv,FurnaceVIC:sv,FurnacePET:sv,FurnaceSAA:sv,FurnaceTED:sv,FurnaceDAVE:sv,FurnaceVERA:sv,FurnaceSCC:sv,FurnaceTIA:sv,FurnacePOKEY:sv,FurnaceZXBEEPER:sv,FurnaceAMIGA:sv,FurnacePCSPKR:sv,FurnaceSEGAPCM:nv,FurnaceQSOUND:nv,FurnaceES5506:nv,FurnaceRF5C68:nv,FurnaceC140:nv,FurnaceK007232:nv,FurnaceK053260:nv,FurnaceGA20:nv,FurnaceOKI:nv,FurnaceYMZ280B:nv,FurnaceX1_010:nv,FurnaceBUBBLE:nv,FurnaceMULTIPCM:nv,FurnaceMSM6258:nv,FurnaceMSM5232:nv,FurnaceNAMCO:sv,FurnaceSM8521:sv,FurnaceT6W28:sv,FurnaceSUPERVISION:sv,FurnaceUPD1771:sv,FurnacePONG:sv,FurnacePV1000:sv,FurnaceSU:sv,FurnacePOWERNOISE:tv,FurnaceSCVTONE:sv,FurnacePCMDAC:nv,MAMEVFX:av,MAMEDOC:av,MAMERSA:ev,MAMESWP30:av,CZ101:av};function lv(e){return iv[e]||ov}function cv(e){const t=new Map;for(const a of e)t.has(a.page)||t.set(a.page,[]),t.get(a.page).push(a);const n=[];for(const[a,s]of t.entries()){s.sort((e,t)=>e.index-t.index);const e=s.map(e=>e.section),t=new Map;for(const n of e)t.set(n,(t.get(n)||0)+1);let r=e[0],o=0;for(const[n,a]of t.entries())a>o&&(r=n,o=a);n.push({id:`page_${a}`,name:`${r} ${a+1}`,parameters:s})}return n.sort((e,t)=>parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])),n}function dv(e,t){switch(e.type){case Og:return t>=.5?"On":"Off";case Fg:if(e.valueStrings){const n=Math.round(t*(e.valueStrings.length-1));return e.valueStrings[Math.min(n,e.valueStrings.length-1)]||""}return String(Math.round(t));case Dg:return String(Math.round(t*(e.max-e.min)+e.min));default:{const n=t*(e.max-e.min)+e.min,a=e.formatString?e.formatString.replace("%.0f",String(Math.round(n))).replace("%.1f",n.toFixed(1)).replace("%.2f",n.toFixed(2)).replace("%.3f",n.toFixed(3)):n.toFixed(2);return e.unit?`${a}${e.unit}`:a}}}async function uv(e){const t=new DataView(e);let n=0;if(t.getUint32(n,!1)!==Wg)throw new Error("Invalid NKSF file: missing magic header");n+=4;const a=t.getUint16(n,!1),s=t.getUint16(n+2,!1);n+=4;const r={vendor:Xg,uuid:Qg,version:`${a}.${s}`},o={};let i;for(;n<e.byteLength;){const a=t.getUint32(n,!1),s=t.getUint32(n+4,!0);n+=8;const c=n,d=n+s;switch(a){case Kg:{const t=mv(new Uint8Array(e,c,s));try{const e=JSON.parse(t);Object.assign(r,e)}catch(l){}break}case Hg:{const t=new DataView(e,c,s);let n=0;const a=t.getUint32(n,!0);n+=4;for(let s=0;s<a;s++){const a=t.getUint8(n);n+=1;const s=new Uint8Array(e,c+n,a),r=(new TextDecoder).decode(s);n+=a;const i=t.getFloat32(n,!0);n+=4,o[r]=i}break}case $g:i=e.slice(c,d)}n=d}return{metadata:r,parameters:o,blob:i}}function pv(e){const t=[],n=JSON.stringify(e.metadata),a=(new TextEncoder).encode(n);t.push(hv(Kg,a.buffer));const s=Object.entries(e.parameters),r=4+s.reduce((e,[t])=>e+1+t.length+4,0),o=new ArrayBuffer(r),i=new DataView(o);let l=0;i.setUint32(l,s.length,!0),l+=4;for(const[h,m]of s){const e=(new TextEncoder).encode(h);i.setUint8(l,e.length),l+=1,new Uint8Array(o,l,e.length).set(e),l+=e.length,i.setFloat32(l,m,!0),l+=4}t.push(hv(Hg,o)),e.blob&&t.push(hv($g,e.blob));const c=8+t.reduce((e,t)=>e+t.byteLength,0),d=new ArrayBuffer(c),u=new DataView(d);let p=0;u.setUint32(p,Wg,!1),p+=4,u.setUint16(p,qg,!1),u.setUint16(p+2,Yg,!1),p+=4;for(const h of t)new Uint8Array(d,p,h.byteLength).set(new Uint8Array(h)),p+=h.byteLength;return d}function hv(e,t){const n=new ArrayBuffer(8+t.byteLength),a=new DataView(n);return a.setUint32(0,e,!1),a.setUint32(4,t.byteLength,!0),new Uint8Array(n,8,t.byteLength).set(new Uint8Array(t)),n}function mv(e){let t=e.indexOf(0);return-1===t&&(t=e.length),(new TextDecoder).decode(e.subarray(0,t))}const fv={Bass:["Bass","Synth Bass"],Lead:["Lead","Synth Lead"],Pad:["Pad","Ambient"],Drum:["Drums","Electronic"],FX:["FX","Sound Design"],User:["User","Custom"]};function yv(e){const t=e[0]?.toLowerCase()||"";return t.includes("bass")?"Bass":t.includes("lead")?"Lead":t.includes("pad")||t.includes("ambient")?"Pad":t.includes("drum")||t.includes("perc")?"Drum":t.includes("fx")||t.includes("effect")?"FX":"User"}function gv(e,t){const n=[];return e&&n.push(...e.map(e=>e.toLowerCase())),t&&n.push(...t.map(e=>e.toLowerCase())),[...new Set(n)]}function vv(e,t){const n=e.synthType,a=function(e,t){const n={},a=e.synthType.toLowerCase();for(const s of t){const t=s.id.replace(`${a}.`,"").split(".");let r=e;const o=e[a];o&&"object"==typeof o&&(r=o);for(const n of t){if(!r||"object"!=typeof r||!(n in r)){if("cutoff"===n&&void 0!==e.filter?.frequency){r=e.filter.frequency;break}if("resonance"===n&&void 0!==e.filter?.Q){r=e.filter.Q;break}if("attack"===n&&void 0!==e.envelope?.attack){r=e.envelope.attack;break}if("decay"===n&&void 0!==e.envelope?.decay){r=e.envelope.decay;break}if("sustain"===n&&void 0!==e.envelope?.sustain){r=e.envelope.sustain;break}if("release"===n&&void 0!==e.envelope?.release){r=e.envelope.release;break}r=void 0;break}r=r[n]}if("number"==typeof r){const e=(r-s.min)/(s.max-s.min);n[s.id]=Math.max(0,Math.min(1,e))}else if("boolean"==typeof r)n[s.id]=r?1:0;else if("string"==typeof r&&s.valueStrings){const e=s.valueStrings.indexOf(r);n[s.id]=-1!==e?e/Math.max(1,s.valueStrings.length-1):s.defaultValue}else n[s.id]=s.defaultValue}return n}(e,lv(n)),{types:s,modes:r}=function(e){const t=[],n=[],a=["bass","lead","pad","drum","fx","synth","keys","strings","brass","vocal"],s=["mono","poly","analog","digital","fm","wavetable","granular","acoustic","electric"];for(const r of e){const e=r.toLowerCase();a.some(t=>e.includes(t))?t.push(r.charAt(0).toUpperCase()+r.slice(1)):s.some(t=>e.includes(t))&&n.push(r.charAt(0).toUpperCase()+r.slice(1))}return{types:t,modes:n}}(t?.tags||[]),o=t?.category?fv[t.category]:["User",e.synthType];return{metadata:{vendor:Xg,uuid:Qg,version:"1.0",name:t?.name||e.name,author:t?.author||"DEViLBOX User",comment:t?.comment||`${n} preset for DEViLBOX`,deviceType:"INST",bankChain:o,types:s.length>0?s:[n],modes:r.length>0?r:void 0,isUser:!0},parameters:a,blob:(new TextEncoder).encode(JSON.stringify(e)).buffer}}function bv(e,t,n){if(e.blob)try{const n=(new TextDecoder).decode(new Uint8Array(e.blob)),a=JSON.parse(n);if(a.synthType)return{...a,id:t,name:e.metadata.name||a.name||"NKS Preset"}}catch{}const a=n||function(e){const t=e.bankChain.join(" ").toLowerCase(),n=(e.types||[]).join(" ").toLowerCase(),a=(e.comment||"").toLowerCase(),s=`${t} ${n} ${a}`;return s.includes("tb303")||s.includes("303")?"TB303":s.includes("tb808")||s.includes("808")?"DrumMachine":s.includes("dub siren")||s.includes("dubsiren")?"DubSiren":s.includes("space laser")||s.includes("spacelaser")?"SpaceLaser":s.includes("fm")||s.includes("dexed")?"FMSynth":s.includes("wavetable")?"Wavetable":s.includes("granular")?"GranularSynth":s.includes("mono")?"MonoSynth":s.includes("poly")?"PolySynth":s.includes("membrane")||s.includes("kick")?"MembraneSynth":s.includes("metal")||s.includes("hihat")||s.includes("cymbal")?"MetalSynth":s.includes("pluck")?"PluckSynth":s.includes("noise")?"NoiseSynth":s.includes("am ")?"AMSynth":s.includes("duo")?"DuoSynth":null}(e.metadata)||"Synth",s=lv(a),r={id:t,name:e.metadata.name||"NKS Preset",type:"synth",synthType:a,effects:[],volume:-6,pan:0};return function(e,t,n){const a=e.synthType.toLowerCase(),s={};for(const r of n){const n=t[r.id];if(void 0===n)continue;const o=n*(r.max-r.min)+r.min,i=r.id.replace(`${a}.`,""),l=i.split(".");let c=s;for(let e=0;e<l.length-1;e++)l[e]in c||(c[l[e]]={}),c=c[l[e]];const d=l[l.length-1];if(r.valueStrings&&r.valueStrings.length>0){const e=Math.round(n*(r.valueStrings.length-1));c[d]=r.valueStrings[Math.min(e,r.valueStrings.length-1)]}else 2===r.type?c[d]=n>=.5:c[d]=o;"cutoff"!==d&&"frequency"!==d||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.frequency=o),"resonance"!==d&&"Q"!==d||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.Q=o),"attack"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.attack=o),"decay"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.decay=o),"sustain"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.sustain=o),"release"!==d||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.release=o)}Object.keys(s).length>0&&(e[a]=s)}(r,e.parameters,s),r}function xv(e){return vv({id:0,...e.config},{name:e.name,category:e.category,tags:e.tags})}function wv(e,t){const n=bv(e,0,t),{id:a,...s}=n;return{name:e.metadata.name||"NKS Preset",category:yv(e.metadata.bankChain),synthType:n.synthType,tags:gv(e.metadata.types,e.metadata.modes),config:s}}function kv(e,t){const n=pv(vv(e,t)),a=new Blob([n],{type:"application/octet-stream"}),s=URL.createObjectURL(a),r=`${t?.name||e.name||"preset"}.nksf`,o=document.createElement("a");o.href=s,o.download=r,o.click(),URL.revokeObjectURL(s)}const Sv=a()(Gm(Rn((e,t)=>({userPresets:[],recentPresetIds:[],savePreset:(t,n,a,s=[])=>{const r=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return e(e=>{const o={id:r,name:n,category:a,synthType:t.synthType,tags:s,createdAt:Date.now(),updatedAt:Date.now(),config:{name:t.name,type:t.type,synthType:t.synthType,oscillator:t.oscillator,envelope:t.envelope,filter:t.filter,filterEnvelope:t.filterEnvelope,tb303:t.tb303,wavetable:t.wavetable,effects:t.effects?[...t.effects]:[],volume:t.volume,pan:t.pan,parameters:t.parameters}};e.userPresets.push(o)}),r},deletePreset:t=>e(e=>{const n=e.userPresets.findIndex(e=>e.id===t);-1!==n&&e.userPresets.splice(n,1);const a=e.recentPresetIds.indexOf(t);-1!==a&&e.recentPresetIds.splice(a,1)}),updatePreset:(t,n)=>e(e=>{const a=e.userPresets.find(e=>e.id===t);a&&(Object.assign(a,n),a.updatedAt=Date.now())}),getPreset:e=>t().userPresets.find(t=>t.id===e),getPresetsByCategory:e=>t().userPresets.filter(t=>t.category===e),getPresetsBySynthType:e=>t().userPresets.filter(t=>t.synthType===e),addToRecent:t=>e(e=>{const n=e.recentPresetIds.indexOf(t);-1!==n&&e.recentPresetIds.splice(n,1),e.recentPresetIds.unshift(t),e.recentPresetIds.length>10&&e.recentPresetIds.pop()}),clearRecent:()=>e(e=>{e.recentPresetIds=[]}),importPresets:t=>e(e=>{t.forEach(t=>{const n=e.userPresets.findIndex(e=>e.id===t.id);-1!==n?e.userPresets[n]=t:e.userPresets.push(t)})}),exportPresets:()=>t().userPresets,exportPresetAsNKSF:e=>{const n=t().getPreset(e);if(n)try{const e=pv(xv(n)),t=new Blob([e],{type:"application/octet-stream"}),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`${n.name}.nksf`,s.click(),URL.revokeObjectURL(a)}catch(a){}},exportAllPresetsAsNKSF:e=>{const n=t().userPresets;if(0!==n.length)try{const t=function(e,t){return e.map(e=>{const n=xv(e);return t&&(n.metadata.author=t),{filename:`${e.name}.nksf`,buffer:pv(n)}})}(n,e);t.forEach((e,t)=>{setTimeout(()=>{const t=new Blob([e.buffer],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e.filename,a.click(),URL.revokeObjectURL(n)},100*t)})}catch(a){}},importNKSFFiles:async t=>{const n=[];try{const a=await async function(e){const t=[];for(const a of e)try{const e=await a.arrayBuffer(),n=await uv(e);t.push(wv(n))}catch(n){}return t}(t);for(const t of a){const a=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e(e=>{const n={id:a,...t,createdAt:Date.now(),updatedAt:Date.now()};e.userPresets.push(n)}),n.push(a)}}catch(a){}return n}})),{name:"devilbox-user-presets",version:1})),Mv="390",Nv="1a663f7",Cv=`1.0.1.${Mv}`,Ev=[{version:"1.0.1",date:"2026-02-11",changes:[{type:"fix",description:"Remove unused patterns variable from TD-3 import"},{type:"improvement",description:"Chore: update generated changelog"},{type:"fix",description:"Fix knob drag interference on TB-303 panel"},{type:"feature",description:"Add classic acid effect chain presets and fix preset loader"},{type:"fix",description:"Fix TD-3 pattern import and parameter editor null guard"},{type:"fix",description:"Improve master routing and synth engine stability"},{type:"feature",description:"Expand Odin2 WASM engine with full parameter coverage"},{type:"feature",description:"Add Helm, Sorcer, amsynth, and OB-Xf WASM synth engines"},{type:"fix",description:"Resolve Tone.js compatibility issues from DevilboxSynth refactor"},{type:"fix",description:"Load Behringer .sqs/.seq files via file browser"},{type:"fix",description:"Clean up synth controls - fix Odin2 ranges, add OTHER tab, show all params"},{type:"fix",description:"Bridge native DevilboxSynths into Tone.js effect chains"},{type:"fix",description:"Clean up SurgeControls component"},{type:"fix",description:"Clean up VitalControls component"},{type:"fix",description:"Register Vital, Odin2, and Surge panel components in synth registry"},{type:"feature",description:"Test: add swing timing test scripts and XML test patterns"},{type:"feature",description:"Add Tonewheel Organ, Vital, Odin2, Surge, and Melodica controls"},{type:"feature",description:"Add effect engine modules, BPM sync, and compiled WASM binaries"},{type:"feature",description:"Chore: add documentation, changelog, test pages, and gitignore updates"},{type:"feature",description:"Add Moog filters, MVerb, Leslie, Spring reverb, and synth templates"},{type:"feature",description:"Expand knob banks and controller mappings for all synth types"},{type:"feature",description:"Add auto-preview oscilloscope hook and expand synth parameter editors"},{type:"feature",description:"Add BPM sync controls, genre presets, and enhanced visual editors"},{type:"improvement",description:"Decouple synth engines from Tone.js and expand audio architecture"},{type:"feature",description:"Update editors, presets, tracker, and DB303 controls"},{type:"feature",description:"Improve import/export engine and song parser"},{type:"feature",description:"Add WAM host, VST bridge, and JUCE WASM build template"},{type:"improvement",description:"Introduce DevilboxSynth interface and decouple synths from Tone.js"}]},{version:"2026-02-10",date:"2026-02-10",changes:[{type:"fix",description:"Chore(infra): update electron, packages, and local debug tools"},{type:"improvement",description:"Enhance audio engine and fix multiple stability issues"},{type:"feature",description:"Add new channel visualizers and standardize styling"},{type:"feature",description:"Implement 1:1 logic port of FT2 Nibbles"},{type:"feature",description:"Improve TD-3 pattern import/export and audit .seq format"}]},{version:"2026-02-09",date:"2026-02-09",changes:[{type:"fix",description:"Use absolute paths for worklet/wasm loading on GitHub Pages"},{type:"fix",description:"Test page uses direct worklet loading + correct case-sensitive filenames"},{type:"fix",description:"Test page now uses direct worklet loading instead of TypeScript imports"},{type:"fix",description:"Tracker knobs now update live synth + improve test page tracking params"},{type:"feature",description:"Comprehensive parameter testing with smoothing, retrigger, and auto-setup"},{type:"feature",description:"Complete DB303 synth overhaul with full parameter test suite"},{type:"improvement",description:"Update changelog and minor UI refinements"},{type:"improvement",description:"303 UI improvements: full-width responsive layout with collapsible sections"},{type:"fix",description:"Rebrand file formats: .dbx for songs, .dbi for instruments + fix speech synth singing modes"},{type:"improvement",description:"Optimize engine and shared control components"},{type:"improvement",description:"Optimize effect and specialty synth controls"},{type:"improvement",description:"Add refs to high-complexity synth controls"},{type:"improvement",description:"Prevent knob handler re-creation with refs"},{type:"fix",description:"Eliminate stale state bug preventing first drag response"},{type:"fix",description:"Chore: Add demo channel fix script and update build"},{type:"fix",description:"Improve VU meter timing and visibility"}]}],Pv=Cv,Tv=Cv,Av=({label:e,devices:t,selectedId:n,onSelect:a,disabled:s=!1})=>{const r=t.find(e=>e.id===n);return wn.jsxs("div",{className:"space-y-1",children:[wn.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:e}),wn.jsxs("div",{className:"relative",children:[wn.jsxs("select",{value:n||"",onChange:e=>a(e.target.value||null),disabled:s,className:`\n            w-full px-3 py-2 pr-8 rounded-md text-sm\n            bg-dark-bgTertiary border border-dark-border\n            text-text-primary appearance-none cursor-pointer\n            hover:border-dark-borderLight focus:border-accent-primary focus:outline-none\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${r?.isTD3?"border-accent-success/50":""}\n          `,children:[wn.jsx("option",{value:"",children:"No device"}),t.map(e=>wn.jsxs("option",{value:e.id,children:[e.isTD3?" ":"",e.name,e.manufacturer?` (${e.manufacturer})`:""]},e.id))]}),wn.jsx(Me,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"})]}),r?.isTD3&&wn.jsxs("div",{className:"flex items-center gap-1 text-xs text-accent-success",children:[wn.jsx(Ne,{size:12}),wn.jsx("span",{children:"TD-3 detected"})]})]})};function _v(){const[e,t]=s.useState([]),[n,a]=s.useState(!1),[r,o]=s.useState(!1),[i,l]=s.useState(null),c=s.useRef(null),d=s.useRef(null),u=s.useRef(new Set);s.useEffect(()=>{a("requestMIDIAccess"in navigator)},[]);const p=s.useCallback(e=>{const t=function(e){if(e.length<1)return{type:"unknown",channel:0,raw:e};const[t,n=0,a=0]=e,s=15&t;switch(t>>4&15){case 9:return{type:a>0?"noteon":"noteoff",channel:s,note:n,velocity:a,raw:e};case 8:return{type:"noteoff",channel:s,note:n,velocity:a,raw:e};case 11:return{type:"cc",channel:s,controller:n,value:a,raw:e};case 14:return{type:"pitchbend",channel:s,value:a<<7|n,raw:e};case 13:return{type:"aftertouch",channel:s,value:n,raw:e};default:return{type:"unknown",channel:s,raw:e}}}(e.data);l(t),u.current.forEach(e=>{e(t)})},[]),h=s.useCallback(e=>{const n=[];e.inputs.forEach(e=>{n.push({id:e.id,name:e.name||"Unknown Device",manufacturer:e.manufacturer||"Unknown",state:e.state})}),t(n)},[]),m=s.useCallback(async()=>{if(!n)throw new Error("Web MIDI API not supported in this browser");if(!r)try{const e=await navigator.requestMIDIAccess();c.current=e,e.inputs.forEach(e=>{e.addEventListener("midimessage",p)});const t=()=>{h(e),e.inputs.forEach(e=>{e.removeEventListener("midimessage",p),e.addEventListener("midimessage",p)})};d.current=t,e.addEventListener("statechange",t),h(e),o(!0)}catch(e){throw e}},[n,r,p,h]),f=s.useCallback(()=>{c.current&&(c.current.inputs.forEach(e=>{e.removeEventListener("midimessage",p)}),d.current&&(c.current.removeEventListener("statechange",d.current),d.current=null),c.current=null),o(!1),t([]),l(null)},[p]),y=s.useCallback(e=>(u.current.add(e),()=>{u.current.delete(e)}),[]);return s.useEffect(()=>()=>{f()},[f]),{devices:e,isSupported:n,isEnabled:r,lastMessage:i,enableMIDI:m,disableMIDI:f,onMessage:y}}const Iv={1:{mode:92,cc:93,min:94,max:95,name:96},2:{mode:112,cc:113,min:114,max:115,name:116},3:{mode:132,cc:133,min:134,max:135,name:136},4:{mode:152,cc:153,min:154,max:155,name:156},5:{mode:172,cc:173,min:174,max:175,name:176},6:{mode:192,cc:193,min:194,max:195,name:196},7:{mode:212,cc:213,min:214,max:215,name:216},8:{mode:232,cc:233,min:234,max:235,name:236}};class Dv{static instance=null;currentPreset=null;deviceName=null;constructor(){}static getInstance(){return Dv.instance||(Dv.instance=new Dv),Dv.instance}checkConnection(){const e=ag().getInputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return this.deviceName=t.name||"MPK Mini",!0}return this.deviceName=null,!1}getDeviceName(){return this.deviceName}createDefaultPreset(){const e=new Uint8Array(246);e[0]=0;const t=this.stringToBytes("DEViLBOX       ",16);e.set(t,1),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let n=1;n<=8;n++){const t=Iv[n];e[t.mode-7]=0,e[t.cc-7]=70+n-1,e[t.min-7]=0,e[t.max-7]=127;const a=`Knob ${n}        `,s=this.stringToBytes(a,16);e.set(s,t.name-7)}return e}stringToBytes(e,t){const n=new Uint8Array(t);for(let a=0;a<t;a++)a<e.length?n[a]=Math.min(127,e.charCodeAt(a)):n[a]=32;return n}buildSysExMessage(e){const t=e.length,n=t>>7&127,a=127&t,s=new Uint8Array(7+e.length+1);return s[0]=240,s[1]=71,s[2]=127,s[3]=73,s[4]=100,s[5]=n,s[6]=a,s.set(e,7),s[s.length-1]=247,s}findMPKMiniOutputId(){const e=ag().getOutputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return t.id}return null}async sendSysEx(e){const t=ag(),n=this.findMPKMiniOutputId();if(!n)return!1;const a=t.getSelectedOutput(),s=a?.id||null;try{return t.selectOutput(n),t.sendSysEx(e),s&&s!==n&&t.selectOutput(s),!0}catch(r){if(s)try{t.selectOutput(s)}catch{}return!1}}async setKnobName(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=Iv[e],a=this.stringToBytes(t,16);this.currentPreset.set(a,n.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async setKnobNames(e){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());for(const[n,a]of Object.entries(e)){const e=parseInt(n);if(e>=1&&e<=8){const t=Iv[e],n=this.stringToBytes(a,16);this.currentPreset.set(n,t.name-7)}}const t=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(t)}async setKnobConfig(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=Iv[e];void 0!==t.mode&&(this.currentPreset[n.mode-7]="relative"===t.mode?1:0),void 0!==t.cc&&(this.currentPreset[n.cc-7]=127&t.cc),void 0!==t.min&&(this.currentPreset[n.min-7]=127&t.min),void 0!==t.max&&(this.currentPreset[n.max-7]=127&t.max);const a=this.stringToBytes(t.name,16);this.currentPreset.set(a,n.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async applyDEViLBOXPreset(){return this.setKnobNames({1:"Cutoff",2:"Resonance",3:"Env Mod",4:"Decay",5:"Accent",6:"Overdrive",7:"Slide Time",8:"Filter FM"})}async resetKnobNames(){this.currentPreset=this.createDefaultPreset();const e=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(e)}}function Ov(){return Dv.getInstance()}const Fv={"transport.play":{label:"Play",category:"Transport"},"transport.stop":{label:"Stop",category:"Transport"},"transport.pause":{label:"Pause",category:"Transport"},"transport.record":{label:"Record",category:"Transport"},"transport.loop":{label:"Toggle Loop",category:"Transport"},"nav.patternUp":{label:"Pattern Up",category:"Navigation"},"nav.patternDown":{label:"Pattern Down",category:"Navigation"},"nav.positionUp":{label:"Song Position Up",category:"Navigation"},"nav.positionDown":{label:"Song Position Down",category:"Navigation"},"nav.rowUp":{label:"Row Up",category:"Navigation"},"nav.rowDown":{label:"Row Down",category:"Navigation"},"nav.toStart":{label:"Go to Start",category:"Navigation"},"nav.toEnd":{label:"Go to End",category:"Navigation"},"edit.octaveUp":{label:"Octave Up",category:"Editing"},"edit.octaveDown":{label:"Octave Down",category:"Editing"},"edit.instrumentUp":{label:"Instrument Up",category:"Editing"},"edit.instrumentDown":{label:"Instrument Down",category:"Editing"},"edit.undo":{label:"Undo",category:"Editing"},"edit.redo":{label:"Redo",category:"Editing"},"edit.copy":{label:"Copy",category:"Editing"},"edit.paste":{label:"Paste",category:"Editing"},"edit.delete":{label:"Delete",category:"Editing"},"edit.insertRow":{label:"Insert Row",category:"Editing"},"edit.deleteRow":{label:"Delete Row",category:"Editing"},"channel.mute1":{label:"Mute Ch 1",category:"Channels"},"channel.mute2":{label:"Mute Ch 2",category:"Channels"},"channel.mute3":{label:"Mute Ch 3",category:"Channels"},"channel.mute4":{label:"Mute Ch 4",category:"Channels"},"channel.mute5":{label:"Mute Ch 5",category:"Channels"},"channel.mute6":{label:"Mute Ch 6",category:"Channels"},"channel.mute7":{label:"Mute Ch 7",category:"Channels"},"channel.mute8":{label:"Mute Ch 8",category:"Channels"},"channel.solo1":{label:"Solo Ch 1",category:"Channels"},"channel.solo2":{label:"Solo Ch 2",category:"Channels"},"channel.solo3":{label:"Solo Ch 3",category:"Channels"},"channel.solo4":{label:"Solo Ch 4",category:"Channels"},"pattern.new":{label:"New Pattern",category:"Pattern"},"pattern.clone":{label:"Clone Pattern",category:"Pattern"},"pattern.delete":{label:"Delete Pattern",category:"Pattern"},"view.toggleEditor":{label:"Toggle Editor",category:"View"},"view.toggleMixer":{label:"Toggle Mixer",category:"View"}},Rv={"tb303.cutoff":{label:"Cutoff",min:200,max:5e3,category:"303 Main"},"tb303.resonance":{label:"Resonance",min:0,max:100,category:"303 Main"},"tb303.envMod":{label:"Env Mod",min:0,max:100,category:"303 Main"},"tb303.decay":{label:"Decay",min:200,max:2e3,category:"303 Main"},"tb303.accent":{label:"Accent",min:0,max:100,category:"303 Main"},"tb303.slideTime":{label:"Slide Time",min:2,max:360,category:"303 Main"},"tb303.overdrive":{label:"Overdrive",min:0,max:100,category:"303 Main"},"tb303.normalDecay":{label:"Normal Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.accentDecay":{label:"Accent Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.softAttack":{label:"Soft Attack",min:.3,max:30,category:"Devil Fish"},"tb303.vegSustain":{label:"VEG Sustain",min:0,max:100,category:"Devil Fish"},"tb303.filterFM":{label:"Filter FM",min:0,max:100,category:"Devil Fish"},"tb303.filterTracking":{label:"Key Track",min:0,max:200,category:"Devil Fish"}},jv=[{id:"akai-mpk-mini-mk3",name:"MPK Mini MK3",manufacturer:"Akai",detectPatterns:["mpk mini","mpk mini mk3","mpkmini"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime"}}},{id:"akai-mpk-mini-plus",name:"MPK Mini Plus",manufacturer:"Akai",detectPatterns:["mpk mini plus","mpkminiplus"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1}}},{id:"novation-launchkey-mini-mk3",name:"Launchkey Mini MK3",manufacturer:"Novation",detectPatterns:["launchkey mini","launchkey"],knobs:[{cc:21,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:22,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:23,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:24,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:25,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:26,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:27,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:28,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"},{note:44,name:"Pad 9"},{note:45,name:"Pad 10"},{note:46,name:"Pad 11"},{note:47,name:"Pad 12"},{note:48,name:"Pad 13"},{note:49,name:"Pad 14"},{note:50,name:"Pad 15"},{note:51,name:"Pad 16"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}},{id:"arturia-minilab-3",name:"MiniLab 3",manufacturer:"Arturia",detectPatterns:["minilab","arturia minilab"],knobs:[{cc:74,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:71,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:76,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:77,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:93,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:73,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:75,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:114,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:85,name:"Fader 1"},{cc:86,name:"Fader 2"},{cc:87,name:"Fader 3"},{cc:88,name:"Fader 4"}]}},{id:"korg-nanokontrol2",name:"nanoKONTROL2",manufacturer:"Korg",detectPatterns:["nanokontrol","nano kontrol","korg nano"],knobs:[{cc:16,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:17,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:18,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:19,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:20,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:21,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:22,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:23,name:"Knob 8"}],pads:[{cc:32,name:"S1",defaultMapping:"channel.solo1"},{cc:33,name:"S2",defaultMapping:"channel.solo2"},{cc:34,name:"S3",defaultMapping:"channel.solo3"},{cc:35,name:"S4",defaultMapping:"channel.solo4"},{cc:48,name:"M1",defaultMapping:"channel.mute1"},{cc:49,name:"M2",defaultMapping:"channel.mute2"},{cc:50,name:"M3",defaultMapping:"channel.mute3"},{cc:51,name:"M4",defaultMapping:"channel.mute4"},{cc:64,name:"R1"},{cc:65,name:"R2"},{cc:66,name:"R3"},{cc:67,name:"R4"},{cc:41,name:"Play",defaultMapping:"transport.play"},{cc:42,name:"Stop",defaultMapping:"transport.stop"},{cc:43,name:"Rewind",defaultMapping:"nav.toStart"},{cc:44,name:"Forward",defaultMapping:"nav.toEnd"},{cc:45,name:"Record",defaultMapping:"transport.record"},{cc:46,name:"Cycle",defaultMapping:"transport.loop"}],extras:{faders:[{cc:0,name:"Fader 1"},{cc:1,name:"Fader 2"},{cc:2,name:"Fader 3"},{cc:3,name:"Fader 4"},{cc:4,name:"Fader 5"},{cc:5,name:"Fader 6"},{cc:6,name:"Fader 7"},{cc:7,name:"Fader 8"}]}},{id:"behringer-xtouch-mini",name:"X-Touch Mini",manufacturer:"Behringer",detectPatterns:["x-touch","xtouch","behringer x-touch"],knobs:[{cc:1,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:2,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:3,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:4,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:5,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:6,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:7,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:8,name:"Encoder 8"}],pads:[{note:0,name:"Button 1",defaultMapping:"transport.play"},{note:1,name:"Button 2",defaultMapping:"transport.stop"},{note:2,name:"Button 3",defaultMapping:"transport.record"},{note:3,name:"Button 4",defaultMapping:"transport.loop"},{note:4,name:"Button 5"},{note:5,name:"Button 6"},{note:6,name:"Button 7"},{note:7,name:"Button 8"},{note:8,name:"Button 9"},{note:9,name:"Button 10"},{note:10,name:"Button 11"},{note:11,name:"Button 12"},{note:12,name:"Button 13"},{note:13,name:"Button 14"},{note:14,name:"Button 15"},{note:15,name:"Button 16"}],extras:{faders:[{cc:9,name:"Fader"}]}},{id:"generic",name:"Generic MIDI Controller",manufacturer:"Unknown",detectPatterns:[],knobs:[{cc:1,name:"CC 1"},{cc:7,name:"CC 7 (Volume)"},{cc:10,name:"CC 10 (Pan)"},{cc:11,name:"CC 11 (Expression)"},{cc:74,name:"CC 74 (Cutoff)"},{cc:71,name:"CC 71 (Resonance)"}],pads:[],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}}];function Lv(e){const t=e.toLowerCase();for(const n of jv)for(const e of n.detectPatterns)if(t.includes(e.toLowerCase()))return n;return null}const Bv=({isOpen:e,onClose:t})=>{const{devices:n,isSupported:a,isEnabled:r,lastMessage:o,enableMIDI:i}=_v(),l=rg(),c=Py(e=>e.instruments);s.useEffect(()=>{e&&r&&l.init()},[e,r,l]);const[d,u]=s.useState("devices"),[p,h]=s.useState(null),[m,f]=s.useState(null),[y,g]=s.useState(!1),[v,b]=s.useState(null),[x,w]=s.useState([]),[k,S]=s.useState(new Set(["Transport","303 Main"])),[M,N]=s.useState(l.getGlobalSensitivity()),[C,E]=s.useState(!1),[P,T]=s.useState("idle"),[A,_]=s.useState(l.getControlledInstrument());s.useEffect(()=>l.onControlledInstrumentChange(e=>{_(e)}),[l]);const I=s.useCallback(e=>{l.setControlledInstrument(e),_(e)},[l]);s.useEffect(()=>{if(r&&n.length>0){const e=Ov();E(e.checkConnection())}},[r,n]);const D=s.useCallback(async()=>{const e=Ov();if(!e.checkConnection())return void T("error");T("syncing");const t={},n={70:1,71:2,72:3,73:4,74:5,75:6,76:7,77:8};x.forEach(e=>{const a=n[e.ccNumber];a&&e.displayName&&(t[a]=e.displayName.substring(0,16))});try{const n=await e.setKnobNames(t);T(n?"success":"error"),n&&setTimeout(()=>T("idle"),2e3)}catch{T("error")}},[x]),O=s.useCallback(async()=>{const e=Ov();T("syncing");try{const t=await e.applyDEViLBOXPreset();T(t?"success":"error"),t&&setTimeout(()=>T("idle"),2e3)}catch{T("error")}},[]),F=s.useCallback(()=>{w(l.getAllMappings())},[l]);s.useEffect(()=>{if(n.length>0){const e=Lv(n[0].name||"");h(e),e&&!m&&f(e)}},[n,m]),s.useEffect(()=>(F(),l.onMappingChange(F)),[l,F]),s.useEffect(()=>{if(!y||!v)return;return l.onLearnChange((e,t)=>{e||(g(!1),b(null),F())})},[y,v,l,F]);const R=async e=>{g(!0),b(e);const t=await l.startLearn(0,e.id,e.label,"parameter"===e.type?e.min:0,"parameter"===e.type?e.max:127,"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear");t&&l.setMapping({id:`${t.channel}-${t.ccNumber}-${e.id}`,ccNumber:t.ccNumber,midiChannel:t.channel,instrumentId:0,parameterPath:e.id,min:"parameter"===e.type?e.min:0,max:"parameter"===e.type?e.max:127,curve:"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear",displayName:e.label}),g(!1),b(null)},j=()=>{m&&(m.knobs.forEach(e=>{if(e.defaultMapping){const t=Rv[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:t.min,max:t.max,curve:e.defaultMapping.includes("cutoff")?"logarithmic":"linear",displayName:t.label})}}),m.pads.forEach(e=>{if(e.defaultMapping&&void 0!==e.cc){const t=Fv[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:0,max:127,curve:"linear",displayName:t.label})}}),F())},L=()=>{l.clearAllMappings(),F()},B=e=>{S(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},V=e=>x.some(t=>t.parameterPath===e),z=e=>x.find(t=>t.parameterPath===e);if(!e)return null;const U=Object.entries(Rv).reduce((e,[t,n])=>{const a=n.category;return e[a]||(e[a]=[]),e[a].push({id:t,...n}),e},{}),G=Object.entries(Fv).reduce((e,[t,n])=>{const a=n.category;return e[a]||(e[a]=[]),e[a].push({id:t,...n}),e},{});return wn.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:wn.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] max-h-[85vh] flex flex-col",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[wn.jsxs("h2",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[wn.jsx(Ce,{size:20}),"MIDI Controller Setup"]}),wn.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors",children:wn.jsx(Ee,{size:20})})]}),y&&v&&wn.jsxs("div",{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-10 rounded-lg",children:[wn.jsx(Pe,{size:48,className:"text-accent-primary animate-spin mb-4"}),wn.jsx("p",{className:"text-text-primary text-lg mb-2",children:"Move a controller to map to:"}),wn.jsx("p",{className:"text-accent-primary text-xl font-bold mb-4",children:v.label}),o&&"cc"===o.type&&wn.jsxs("p",{className:"text-text-muted text-sm mb-4",children:["Last: CH",o.channel+1," CC",o.controller," = ",o.value]}),wn.jsx("button",{onClick:()=>{l.cancelLearn(),g(!1),b(null)},className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Cancel"})]}),wn.jsx("div",{className:"flex border-b border-dark-border",children:[{id:"devices",label:"Devices",icon:Ce},{id:"parameters",label:"TB-303",icon:Te},{id:"actions",label:"Tracker",icon:Ae},{id:"mappings",label:"Mappings",icon:_e},{id:"settings",label:"Settings",icon:Ie}].map(e=>wn.jsxs("button",{onClick:()=>u(e.id),className:`\n                flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors\n                ${d===e.id?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"}\n              `,children:[wn.jsx(e.icon,{size:16}),e.label]},e.id))}),wn.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["devices"===d&&wn.jsx("div",{className:"space-y-4",children:a?r?0===n.length?wn.jsxs("div",{className:"text-center py-8",children:[wn.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),wn.jsx("p",{className:"text-text-secondary",children:"No MIDI devices detected"}),wn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Connect a MIDI controller and refresh"})]}):wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Connected Devices"}),wn.jsx("div",{className:"space-y-2",children:n.map(e=>wn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded p-3",children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("span",{className:"w-3 h-3 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),wn.jsxs("div",{children:[wn.jsx("div",{className:"text-text-primary font-medium",children:e.name}),wn.jsx("div",{className:"text-text-muted text-xs",children:e.manufacturer})]})]}),p&&e.name?.toLowerCase().includes(p.detectPatterns[0])&&wn.jsxs("span",{className:"text-xs bg-accent-primary/20 text-accent-primary px-2 py-1 rounded",children:["Auto-detected: ",p.name]})]},e.id))})]}),wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Controller Profile"}),wn.jsxs("select",{value:m?.id||"",onChange:e=>{const t=jv.find(t=>t.id===e.target.value);f(t||null)},className:"w-full bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 text-text-primary",children:[wn.jsx("option",{value:"",children:"Select a profile..."}),jv.map(e=>wn.jsxs("option",{value:e.id,children:[e.manufacturer," ",e.name]},e.id))]})]}),m&&wn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[wn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[wn.jsxs("h4",{className:"text-sm font-medium text-text-primary",children:[m.manufacturer," ",m.name]}),wn.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white text-sm rounded transition-colors",children:"Apply Suggested Mappings"})]}),wn.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[wn.jsxs("div",{children:[wn.jsx("span",{className:"text-text-muted",children:"Knobs:"})," ",wn.jsx("span",{className:"text-text-secondary",children:m.knobs.length})]}),wn.jsxs("div",{children:[wn.jsx("span",{className:"text-text-muted",children:"Pads:"})," ",wn.jsx("span",{className:"text-text-secondary",children:m.pads.length})]}),m.extras?.faders&&wn.jsxs("div",{children:[wn.jsx("span",{className:"text-text-muted",children:"Faders:"})," ",wn.jsx("span",{className:"text-text-secondary",children:m.extras.faders.length})]})]})]})]}):wn.jsxs("div",{className:"text-center py-8",children:[wn.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),wn.jsx("p",{className:"text-text-secondary mb-4",children:"Enable MIDI to connect your controller"}),wn.jsx("button",{onClick:i,className:"px-6 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded font-medium transition-colors",children:"Enable MIDI"})]}):wn.jsxs("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-4",children:[wn.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[wn.jsx(De,{size:20}),wn.jsx("span",{children:"Web MIDI API not supported"})]}),wn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})}),"parameters"===d&&wn.jsx("div",{className:"space-y-3",children:Object.entries(U).map(([e,t])=>wn.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[wn.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[wn.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?wn.jsx(Me,{size:16,className:"text-text-muted"}):wn.jsx(Oe,{size:16,className:"text-text-muted"})]}),k.has(e)&&wn.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),n=z(e.id),a=y&&v?.id===e.id;return wn.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${a?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[t&&wn.jsx(Fe,{size:14,className:"text-accent-success"}),wn.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[n&&wn.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]}),wn.jsx("button",{onClick:()=>R({type:"parameter",id:e.id,label:e.label,min:e.min,max:e.max,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${a?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:a?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"actions"===d&&wn.jsx("div",{className:"space-y-3",children:Object.entries(G).map(([e,t])=>wn.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[wn.jsxs("button",{onClick:()=>B(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[wn.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?wn.jsx(Me,{size:16,className:"text-text-muted"}):wn.jsx(Oe,{size:16,className:"text-text-muted"})]}),k.has(e)&&wn.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),n=z(e.id),a=y&&v?.id===e.id;return wn.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${a?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[t&&wn.jsx(Fe,{size:14,className:"text-accent-success"}),wn.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[n&&wn.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]}),wn.jsx("button",{onClick:()=>R({type:"action",id:e.id,label:e.label,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${a?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:a?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"mappings"===d&&wn.jsx("div",{className:"space-y-4",children:0===x.length?wn.jsxs("div",{className:"text-center py-8",children:[wn.jsx(_e,{size:48,className:"mx-auto text-text-muted mb-4"}),wn.jsx("p",{className:"text-text-secondary",children:"No mappings configured"}),wn.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Go to TB-303 or Tracker tabs to create mappings"})]}):wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"flex justify-end",children:wn.jsxs("button",{onClick:L,className:"flex items-center gap-1 text-sm text-accent-error hover:underline",children:[wn.jsx(Re,{size:14}),"Clear All"]})}),wn.jsx("div",{className:"space-y-2",children:x.map(e=>wn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded px-4 py-3",children:[wn.jsxs("div",{children:[wn.jsx("div",{className:"text-text-primary font-medium",children:e.displayName||e.parameterPath}),wn.jsx("div",{className:"text-text-muted text-xs",children:e.parameterPath})]}),wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsxs("div",{className:"text-right",children:[wn.jsxs("div",{className:"text-text-secondary font-mono text-sm",children:[void 0!==e.midiChannel?`CH${e.midiChannel+1} `:"","CC",e.ccNumber]}),wn.jsxs("div",{className:"text-text-muted text-xs",children:[e.min," - ",e.max," (",e.curve,")"]})]}),wn.jsx("button",{onClick:()=>{return t=e.id,l.removeMapping(t),void F();var t},className:"text-accent-error hover:text-accent-error/80 transition-colors",children:wn.jsx(Re,{size:16})})]})]},e.id))})]})}),"settings"===d&&wn.jsxs("div",{className:"space-y-6",children:[wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Knob Sensitivity"}),wn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[wn.jsxs("div",{className:"flex items-center justify-between mb-2",children:[wn.jsx("span",{className:"text-text-muted text-sm",children:"Slow (Smooth)"}),wn.jsx("span",{className:"text-text-primary font-mono",children:M.toFixed(2)}),wn.jsx("span",{className:"text-text-muted text-sm",children:"Fast (Direct)"})]}),wn.jsx("input",{type:"range",min:"0.05",max:"1",step:"0.05",value:M,onChange:e=>{return t=parseFloat(e.target.value),N(t),void l.setGlobalSensitivity(t);var t},className:"w-full accent-accent-primary"}),wn.jsx("p",{className:"text-text-muted text-xs mt-2",children:"Lower values make knobs respond more smoothly but slower. Higher values give immediate response."})]})]}),wn.jsxs("div",{children:[wn.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[wn.jsx(Te,{size:16}),"Controlled Instrument"]}),wn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[wn.jsxs("select",{value:A??"all",onChange:e=>{const t=e.target.value;I("all"===t?null:parseInt(t))},className:"w-full bg-dark-bgTertiary border border-dark-border rounded px-3 py-2 text-text-primary mb-2",children:[wn.jsx("option",{value:"all",children:"All TB-303 Instruments"}),c.map(e=>wn.jsxs("option",{value:e.id,children:[e.id,". ",e.name," (",e.synthType||"Sampler",")"]},e.id))]}),wn.jsx("p",{className:"text-text-muted text-xs",children:'Choose which instrument responds to MIDI CC knobs. "All TB-303" controls every TB-303 synth at once.'})]})]}),wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Quick Setup"}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("button",{onClick:j,disabled:!m,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgSecondary disabled:text-text-muted text-white rounded font-medium transition-colors",children:[wn.jsx(_e,{size:18}),"Apply Suggested Mappings"]}),wn.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:[wn.jsx(Re,{size:18}),"Clear All Mappings"]})]})]}),C&&wn.jsxs("div",{children:[wn.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[wn.jsx(je,{size:16}),"MPK Mini MK3 Display"]}),wn.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4 space-y-3",children:[wn.jsx("p",{className:"text-text-muted text-xs",children:"Sync parameter names to your MPK Mini's OLED display. Names will show when you turn the knobs."}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("button",{onClick:D,disabled:"syncing"===P||0===x.length,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgTertiary disabled:text-text-muted text-white rounded text-sm transition-colors",children:[wn.jsx(je,{size:16}),"syncing"===P?"Syncing...":"Sync Current Mappings"]}),wn.jsxs("button",{onClick:O,disabled:"syncing"===P,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-sm transition-colors",children:[wn.jsx(_e,{size:16}),"Apply DEViLBOX Preset (TB-303)"]})]}),"success"===P&&wn.jsxs("p",{className:"text-accent-success text-xs flex items-center gap-1",children:[wn.jsx(Fe,{size:12})," Display updated!"]}),"error"===P&&wn.jsxs("p",{className:"text-accent-error text-xs flex items-center gap-1",children:[wn.jsx(De,{size:12})," Failed to update display"]})]})]}),wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Supported Controllers"}),wn.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:jv.filter(e=>"generic"!==e.id).map(e=>wn.jsxs("div",{className:"bg-dark-bgSecondary rounded px-3 py-2 text-text-muted",children:[e.manufacturer," ",e.name]},e.id))})]})]})]}),wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-dark-border",children:[wn.jsxs("div",{className:"text-xs text-text-muted",children:[x.length," mapping",1!==x.length?"s":""," active"]}),wn.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Close"})]})]})})},Vv="TB303",zv=lv(Vv),Uv=cv(zv),Gv=a()(Rn((e,t)=>({isConnected:!1,controllerInfo:null,currentSynthType:Vv,currentPreset:null,currentPage:0,pages:Uv,parameters:zv,parameterValues:{},changedParameters:new Set,presets:[],availablePresets:[],currentBank:[],displayInfo:null,lightGuide:[],totalPages:Uv.length,init:async n=>{const a=n||t().currentSynthType,s=lv(a),r=cv(s),o={};for(const e of s)o[e.id]=e.defaultValue;e(e=>{e.currentSynthType=a,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=o,e.changedParameters=new Set,e.currentPage=0}),await async function(){}(),t().updateDisplay()},setSynth:n=>{const{currentSynthType:a}=t();if(n===a)return;const s=lv(n),r=cv(s),o={};for(const e of s)o[e.id]=e.defaultValue;e(e=>{e.currentSynthType=n,e.parameters=s,e.pages=r,e.totalPages=r.length,e.parameterValues=o,e.changedParameters=new Set,e.currentPage=0,e.currentPreset=null}),t().updateDisplay()},disconnect:()=>{e(e=>{e.isConnected=!1,e.controllerInfo=null})},loadPreset:n=>{e(e=>{e.currentPreset=n,e.parameterValues={...n.parameters},e.changedParameters=new Set,e.currentPage=0}),t().updateDisplay()},loadPresetFromFile:async e=>{try{const n=await e.arrayBuffer(),a=await uv(n);t().loadPreset(a)}catch(n){throw n}},savePreset:(n,a)=>{const{parameterValues:s,currentPreset:r}=t(),o={metadata:{...r?.metadata,name:n,vendor:"DEViLBOX",uuid:"devilbox-tracker-v1",version:"1.0",deviceType:"INST",bankChain:a?.bankChain||["User","Saved"],author:a?.author,comment:a?.comment,isUser:!0,...a},parameters:{...s},blob:r?.blob};e(e=>{e.currentPreset=o,e.changedParameters=new Set})},exportPreset:()=>{const{currentPreset:e}=t();if(!e)return;const n=pv(e),a=new Blob([n],{type:"application/octet-stream"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`${e.metadata.name||"preset"}.nksf`,r.click(),URL.revokeObjectURL(s)},addPreset:t=>{e(e=>{e.presets.push(t)})},setParameterValue:(n,a)=>{const{parameters:s}=t(),r=s.find(e=>e.id===n);if(!r)return;const o=Math.max(0,Math.min(1,a));e(e=>{e.parameterValues[n]=o,Math.abs(o-r.defaultValue)>.001?e.changedParameters.add(n):e.changedParameters.delete(n)}),t().updateDisplay()},resetParameter:e=>{const{parameters:n}=t(),a=n.find(t=>t.id===e);a&&t().setParameterValue(e,a.defaultValue)},resetAllParameters:()=>{const{parameters:n}=t();e(e=>{for(const t of n)e.parameterValues[t.id]=t.defaultValue;e.changedParameters.clear()}),t().updateDisplay()},nextPage:()=>{const{currentPage:e,pages:n}=t(),a=(e+1)%n.length;t().setPage(a)},prevPage:()=>{const{currentPage:e,pages:n}=t(),a=0===e?n.length-1:e-1;t().setPage(a)},setPage:n=>{const{pages:a}=t();n<0||n>=a.length||(e(e=>{e.currentPage=n}),t().updateDisplay())},updateDisplay:()=>{const{currentPreset:n,currentPage:a,pages:s,parameterValues:r,currentSynthType:o}=t(),i=s[a];if(!i)return;const l=[`DEViLBOX - ${o}`,n?.metadata.name||"Untitled"];for(const e of i.parameters.slice(0,4)){const t=dv(e,r[e.id]||e.defaultValue);l.push(`${e.name}: ${t}`)}e(e=>{e.displayInfo=l})},setLightGuide:t=>{e(e=>{e.lightGuide=t})},clearLightGuide:()=>{e(e=>{e.lightGuide=[]})},setDisplayInfo:t=>{e(e=>{e.displayInfo=t})},syncParametersFromConfig:n=>{const{parameters:a,currentSynthType:s}=t(),r={};for(const e of a){const t=e.id.replace(`${s.toLowerCase()}.`,"").split(".");let a=n;for(const e of t){if(!a||"object"!=typeof a||!(e in a)){a=void 0;break}a=a[e]}if("number"==typeof a){const t=(a-e.min)/(e.max-e.min);r[e.id]=Math.max(0,Math.min(1,t))}else if("boolean"==typeof a)r[e.id]=a?1:0;else if("string"==typeof a&&e.valueStrings){const t=e.valueStrings.indexOf(a);-1!==t&&(r[e.id]=t/(e.valueStrings.length-1))}}Object.keys(r).length>0&&(e(e=>{for(const[t,n]of Object.entries(r)){e.parameterValues[t]=n;const s=a.find(e=>e.id===t);s&&Math.abs(n-s.defaultValue)>.001&&e.changedParameters.add(t)}}),t().updateDisplay())}})));const Wv=6092,Kv=2536,Hv=7285,$v=8137,qv=1891,Yv=7285,Xv=8137,Qv=1,Zv=3,Jv=16,eb=17,tb=18,nb=240,ab=241,sb={PLAY:1,STOP:2,REC:3,LOOP:4,METRO:5,BROWSE:32,PRESET:34,PAGE_LEFT:48,PAGE_RIGHT:49,SHIFT:80,CLEAR:81,OCTAVE_UP:96,OCTAVE_DOWN:97,SCALE:112};class rb{device=null;deviceInfo=null;knobValues=new Array(8).fill(0);buttonStates=new Map;onKnobChange;onButtonPress;onButtonRelease;constructor(){this.handleInputReport=this.handleInputReport.bind(this)}async requestDevice(){if(!("hid"in navigator))return!1;try{const e=await navigator.hid.requestDevice({filters:[{vendorId:Wv},{vendorId:Kv},{vendorId:Hv},{vendorId:$v},{vendorId:qv},{vendorId:Yv},{vendorId:Xv},{vendorId:15}]});return 0!==e.length&&await this.connect(e[0])}catch(e){return!1}}async connect(e){try{e.opened||await e.open(),this.device=e,this.deviceInfo=this.parseDeviceInfo(e),e.addEventListener("inputreport",this.handleInputReport);try{await this.sendPing()}catch(t){}return!0}catch(n){return!1}}async disconnect(){this.device&&(this.device.removeEventListener("inputreport",this.handleInputReport),this.device.opened&&await this.device.close(),this.device=null,this.deviceInfo=null)}getDeviceInfo(){return this.deviceInfo}parseDeviceInfo(e){const t=e.productId,n=e.vendorId,a=e.productName||"Unknown Controller";let s="Native Instruments";n===Kv?s="Akai":n===Hv?s="Arturia":n===$v?s="Nektar":n===qv?s="M-Audio":n===Yv?s="Studiologic":n===Xv?s="iCON":15===n&&(s="Alesis");let r=!1,o=0,i=0,l=!1,c=0,d=8;[4928,4944,4960,5136].includes(t)?(r=!0,o=2,i=72,l=!0,4928===t?c=25:4944===t?c=49:4960===t?c=61:5136===t&&(c=88)):t>=5664&&t<=5968?(r=!0,o=4,i=144,l=!0,5664===t||5920===t?c=49:5680===t||5936===t?c=61:5712!==t&&5968!==t||(c=88)):t>=5648&&t<=5650?(r=!0,o=2,i=72,l=!0,5648===t?c=25:5649===t?c=49:5650===t&&(c=61)):5632===t?(r=!0,o=2,i=72,l=!0,c=32):2056===t?(r=!0,o=2,i=128,l=!1,d=8):5888===t||5904===t?(r=!0,o=2,i=144,l=!1,d=8):4416===t?(r=!0,o=2,i=160,l=!1,d=8):2067===t||5893===t?(r=!1,o=0,i=0,l=!1,d=8):5376===t&&(r=!0,o=2,i=96,l=!1,d=8);n===Kv&&([309,312].includes(t)||a.toLowerCase().includes("mpk mini"))?(r=!0,o=2,i=16,l=!0,c=8,d=8):n===Kv&&[305,306,307].includes(t)&&(r=!0,o=2,i=80,l=!1,d=8);n===Hv&&[1319,1320,1321].includes(t)?(r=!0,o=2,i=64,l=!1,d=9):n===Hv&&[1553,1554,1555].includes(t)&&(r=!0,o=2,i=80,l=!1,d=9);return n===$v&&[8240,8241,8242,8243].includes(t)?(r=!0,o=2,i=40,l=!1,d=8):n===$v&&[8224,8225].includes(t)&&(r=!0,o=4,i=128,l=!0,c=49,d=8),n===qv&&[405,406,407].includes(t)&&(r=!0,o=2,i=64,l=!1,d=16),n===Yv&&[2048,2064].includes(t)&&(r=!0,o=2,i=40,l=!1,d=8),n===Xv&&[12304,12305].includes(t)&&(r=!0,o=2,i=64,l=!1,d=8),15===n&&[311,312,313].includes(t)&&(r=!1,o=0,i=0,l=!1,d=8),{id:`nks_${n.toString(16)}_${t.toString(16)}`,name:a,vendor:s,hasDisplay:r,displayLines:o,displayChars:i,hasLightGuide:l,lightGuideKeys:c,hasKnobs:!0,knobCount:d,hasButtons:!0,hasPads:5888===t||5904===t,hasTransport:!0,hasJogWheel:5888===t||5904===t,hasBrowserControls:!0,hasTouchStrip:t>=5920&&t<=5968}}async sendDisplayUpdate(e){if(!this.device||!this.deviceInfo?.hasDisplay)return;const t=e.slice(0,this.deviceInfo.displayLines).map(e=>e.padEnd(this.deviceInfo.displayChars," ").substring(0,this.deviceInfo.displayChars)),n=new TextEncoder,a=this.deviceInfo.displayLines*this.deviceInfo.displayChars,s=t.join("").substring(0,a),r=n.encode(s),o=new Uint8Array(64);o[0]=Qv,o[1]=this.deviceInfo.displayLines,o[2]=255&r.length,o[3]=r.length>>8&255,o.set(r.slice(0,60),4);try{await this.device.sendReport(Qv,o)}catch(i){}}async sendLightGuide(e){if(this.device&&this.deviceInfo?.hasLightGuide)try{const t=new Uint8Array(256);for(const n of e){if(n.note<0||n.note>=128)continue;const e=2*n.note;t[e]=n.color,t[e+1]=Math.round(255*n.brightness)}for(let e=0;e<t.length;e+=60){const n=t.slice(e,e+60),a=new Uint8Array(64);a[0]=Zv,a[1]=e/60&255,a[2]=n.length,a.set(n,3),await this.device.sendReport(Zv,a)}}catch(t){}}handleInputReport(e){const{data:t,reportId:n}=e,a=new Uint8Array(t.buffer);switch(n){case Jv:this.handleKnobValues(a);break;case eb:this.handleButtonState(a);break;case tb:this.handleTransport(a);break;case ab:this.handleDeviceInfo(a)}}handleKnobValues(e){const t=e[1];for(let n=0;n<t;n++){const t=2+2*n,a=e[t],s=e[t+1]/127;this.knobValues[a]!==s&&(this.knobValues[a]=s,this.onKnobChange?.(a,s))}}handleButtonState(e){const t=e[1],n=1===e[2];n!==(this.buttonStates.get(t)||!1)&&(this.buttonStates.set(t,n),n?this.onButtonPress?.(t):this.onButtonRelease?.(t))}handleTransport(e){const t=e[1];this.handleButtonState(new Uint8Array([0,t,1]))}handleDeviceInfo(e){}async sendPing(){if(!this.device)return;const e=new Uint8Array(64);e[0]=nb,e[1]=1,await this.device.sendReport(nb,e)}onKnobChanged(e){this.onKnobChange=e}onButtonPressed(e){this.onButtonPress=e}onButtonReleased(e){this.onButtonRelease=e}getKnobValues(){return[...this.knobValues]}getButtonState(e){return this.buttonStates.get(e)||!1}}function ob(){return"hid"in navigator}const ib=Object.freeze(Object.defineProperty({__proto__:null,AKAI_VENDOR_ID:Kv,ALESIS_VENDOR_ID:15,ARTURIA_VENDOR_ID:Hv,ICON_VENDOR_ID:Xv,M_AUDIO_VENDOR_ID:qv,NEKTAR_VENDOR_ID:$v,NI_VENDOR_ID:Wv,NKSHIDProtocol:rb,NKS_BUTTONS:sb,STUDIOLOGIC_VENDOR_ID:Yv,getPairedDevices:async function(){if(!ob())return[];const e=await navigator.hid.getDevices(),t=[Wv,Kv,Hv,$v,qv,Yv,Xv,15];return e.filter(e=>t.includes(e.vendorId))},isHIDSupported:ob},Symbol.toStringTag,{value:"Module"})),lb=[240,71,127],cb=16,db=14,ub=32,pb=128,hb=64,mb=[[13,19,25,31,37,43,49],[0,20,26,32,38,44,50],[1,7,27,33,39,45,51],[2,8,14,34,40,46,52],[3,9,15,21,41,47,53],[4,10,16,22,28,48,54],[5,11,17,23,29,35,55],[6,12,18,24,30,36,42]];async function fb(e,t){if(!kg.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const n=await navigator.requestMIDIAccess({sysex:!0}),a=Array.from(n.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(a)try{const n=e.padEnd(16," ").substring(0,16),s=t.padEnd(16," ").substring(0,16),r=Array.from(n).map(e=>e.charCodeAt(0)),o=Array.from(s).map(e=>e.charCodeAt(0)),i=new Uint8Array([...lb,73,cb,0,...r,1,...o,247]);a.send(i)}catch(s){}}async function yb(e,t,n,a){if(!kg.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const s=await navigator.requestMIDIAccess({sysex:!0}),r=Array.from(s.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(r&&!(e<0||e>7))try{const s=Math.max(0,Math.min(127,t)),o=Math.max(0,Math.min(127,n)),i=Math.max(0,Math.min(127,a)),l=new Uint8Array([...lb,73,ub,e,s,o,i,247]);r.send(l)}catch(o){}}async function gb(e){for(const t of e)await yb(t.pad,t.red,t.green,t.blue)}async function vb(e){if(1024!==e.length)return;if(!kg.getState().outputDevices.find(e=>e.name?.includes("MPK mini")))return;const t=await navigator.requestMIDIAccess({sysex:!0}),n=Array.from(t.outputs.values()).find(e=>e.name?.includes("MPK mini"));if(n)try{const t=function(e){const t=[];for(let n=0;n<8;n++)for(let a=0;a<pb;a+=7){const s=new Array(8).fill(0);for(let t=0;t<8;t++){const r=16*(8*n+t)+Math.floor(a/8);for(let n=0;n<7&&a+n<pb;n++){const o=7-(a+n)%8,i=e[r]>>o&1,l=mb[t][n],c=Math.floor(l/7),d=l%7;i&&(s[c]|=1<<d)}}t.push(...s)}return new Uint8Array(t)}(e),a=t.length+4,s=a>>7&127,r=127&a,o=new Uint8Array([...lb,73,db,s,r,0,7,0,127,...t,247]);n.send(o)}catch(a){}}async function bb(){const e=Array(hb).fill(null).map(()=>Array(pb).fill(!1));for(let a=0;a<pb;a++)e[0][a]=!0,e[63][a]=!0;for(let a=0;a<hb;a++)e[a][0]=!0,e[a][127]=!0;for(let a=0;a<Math.min(pb,hb);a++)e[a][a]=!0,e[a][127-a]=!0;let t=16;for(const a of"DEVILBOX")xb(e,a,t,28),t+=12;const n=function(e){const t=new Uint8Array(1024);for(let n=0;n<hb;n++)for(let a=0;a<pb;a++)if(e[n]&&e[n][a]){const e=7-a%8;t[16*n+Math.floor(a/8)]|=1<<e}return t}(e);await vb(n)}function xb(e,t,n,a){const s={D:[126,66,66,66,66,66,126,0],E:[126,64,64,124,64,64,126,0],V:[66,66,66,36,36,24,24,0],I:[60,24,24,24,24,24,60,0],L:[64,64,64,64,64,64,126,0],B:[124,66,66,124,66,66,124,0],O:[60,66,66,66,66,66,60,0],X:[66,66,36,24,36,66,66,0]},r=s[t.toUpperCase()]||s.O;for(let o=0;o<8;o++)for(let t=0;t<8;t++)if(r[o]>>7-t&1){const s=n+t,r=a+o;s>=0&&s<pb&&r>=0&&r<hb&&(e[r][s]=!0)}}class wb{protocol;updateInterval=null;lightGuideEnabled=!0;isAkaiDevice=!1;constructor(){this.protocol=new rb,this.protocol.onKnobChanged((e,t)=>{this.handleKnobChange(e,t)}),this.protocol.onButtonPressed(e=>{this.handleButtonPress(e)})}async requestConnection(){if(!ob())return!1;const e=await this.protocol.requestDevice();if(e){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return e}async connectToPairedDevice(){if(!ob())return!1;try{const{getPairedDevices:e}=await An(async()=>{const{getPairedDevices:e}=await Promise.resolve().then(()=>ib);return{getPairedDevices:e}},void 0),t=await e();if(0===t.length)return!1;const n=await this.protocol.connect(t[0]);if(n){const e=this.protocol.getDeviceInfo();this.isAkaiDevice=e?.vendor.toLowerCase().includes("akai")||!1,this.startDisplayUpdates(),this.updateLightGuide()}return n}catch(e){return!1}}async disconnect(){this.stopDisplayUpdates(),await this.protocol.disconnect()}getDeviceInfo(){return this.protocol.getDeviceInfo()}isConnected(){return null!==this.protocol.getDeviceInfo()}startDisplayUpdates(){null===this.updateInterval&&(this.updateInterval=window.setInterval(()=>{this.updateDisplay()},100),this.updateDisplay())}stopDisplayUpdates(){null!==this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}async updateDisplay(){const e=Gv.getState().displayInfo;if(e&&0!==e.length)if(this.isAkaiDevice){const t=e[0]||"",n=e[1]||"";await fb(t,n)}else await this.protocol.sendDisplayUpdate(e)}async updateLightGuide(){if(!this.lightGuideEnabled)return;const e=Gv.getState().lightGuide||[];this.isAkaiDevice?await async function(e){const t=[];for(let n=0;n<Math.min(8,e.length);n++){const a=e[n],s=Math.round(127*a.brightness);let r=0,o=0,i=0;switch(a.color){case 0:break;case 1:r=o=i=s;break;case 2:r=s;break;case 3:r=s,o=Math.round(.5*s);break;case 4:r=o=s;break;case 5:o=s;break;case 6:o=i=s;break;case 7:i=s;break;case 8:r=Math.round(.5*s),i=s;break;case 9:r=i=s}t.push({pad:n,red:r,green:o,blue:i})}await gb(t)}(e):await this.protocol.sendLightGuide(e)}handleKnobChange(e,t){const n=Gv.getState(),a=8*n.currentPage+e,s=n.parameters[a];s&&n.setParameterValue(s.id,t)}handleButtonPress(e){const t=Gv.getState();switch(e){case sb.PAGE_LEFT:t.prevPage(),this.updateDisplay();break;case sb.PAGE_RIGHT:t.nextPage(),this.updateDisplay();break;case sb.PRESET:case sb.BROWSE:case sb.SHIFT:break;case sb.CLEAR:const e=8*t.currentPage,n=t.parameters[e];n&&t.setParameterValue(n.id,0);break;case sb.OCTAVE_UP:this.shiftLightGuide(12);break;case sb.OCTAVE_DOWN:this.shiftLightGuide(-12)}}shiftLightGuide(e){const t=Gv.getState(),n=(t.lightGuide||[]).map(t=>({...t,note:Math.max(0,Math.min(127,t.note+e))}));t.setLightGuide(n),this.updateLightGuide()}setScaleLights(e,t){const n=[];for(let a=0;a<11;a++)for(const s of t){const t=12*a+e+s;t>=0&&t<128&&n.push({note:t,color:0===s?2:1,brightness:.5})}Gv.getState().setLightGuide(n),this.updateLightGuide()}clearLightGuide(){Gv.getState().setLightGuide([]),this.updateLightGuide()}setLightGuideEnabled(e){this.lightGuideEnabled=e,e?this.updateLightGuide():this.clearLightGuide()}async syncKnobsToParameters(){await this.updateDisplay()}}let kb=null;function Sb(){return kb||(kb=new wb),kb}function Mb(){return ob()}const Nb=Object.freeze(Object.defineProperty({__proto__:null,NKSHardwareController:wb,connectToNKSPairedDevice:async function(){return Sb().connectToPairedDevice()},getNKSHardwareController:Sb,isNKSHardwareAvailable:Mb},Symbol.toStringTag,{value:"Module"}));function Cb(e){return e.split(".")}function Eb(e,t,n){if(0===t.length)return e;const[a,...s]=t,r=e[a];return 0===s.length?{...e,[a]:n}:{...e,[a]:Eb(r||{},s,n)}}function Pb(){!function(e){const{currentSynthType:t,setSynth:n,parameters:a,syncParametersFromConfig:r}=Gv(),{getInstrument:o,updateInstrument:i}=Py(),l=s.useRef(""),c=e?o(e):void 0;s.useEffect(()=>{if(!c)return;const e=c.synthType;e!==t&&n(e);const a=e.toLowerCase(),s=c[a];if(s&&"object"==typeof s){const e=JSON.stringify(s);e!==l.current&&(l.current=e,r(s))}},[c,t,n,r]),s.useEffect(()=>{if(e&&c)return Gv.subscribe((t,n)=>{if(t.parameterValues!==n.parameterValues){const a=c.synthType.toLowerCase();let s={},r=!1;for(const e of t.parameters){const o=t.parameterValues[e.id],i=n.parameterValues[e.id];if(void 0!==o&&o!==i){let t;switch(e.type){case 2:t=o>=.5;break;case 3:if(e.valueStrings){const n=Math.round(o*(e.valueStrings.length-1));t=e.valueStrings[n]||e.valueStrings[0]}else t=Math.round(o*(e.max-e.min)+e.min);break;case 1:t=Math.round(o*(e.max-e.min)+e.min);break;default:t=o*(e.max-e.min)+e.min}const n=Cb(e.id);if(n[0]===a&&n.length>1){const e=n.slice(1),o=Eb(c[a]||{},e,t);s={...s,[a]:o},r=!0}}}if(r){const t=JSON.stringify(s[a]);l.current=t,i(e,s)}}})},[e,c,a,i])}(Py(e=>e.currentInstrumentId))}const Tb=(e,t,n)=>{const a=Math.log(t),s=Math.log(n);return(Math.log(e)-a)/(s-a)},Ab=e.memo(({value:e,min:t,max:n,label:a,title:r,unit:o="",onChange:i,logarithmic:l=!1,defaultValue:c,size:d="md",color:u="#00d4aa",displayValue:p,isActive:h=!1,bipolar:m=!1,formatValue:f,step:y,disabled:g=!1})=>{const v=s.useRef(null),[b,x]=s.useState(!1),w=s.useRef(0),k=s.useRef(0),S=s.useRef(null),M=s.useRef(null),N=s.useId(),C=s.useRef(i);C.current=i;const E=s.useRef(t);E.current=t;const P=s.useRef(n);P.current=n;const T=s.useRef(l);T.current=l;const A=s.useRef(y);A.current=y;const _="cyan-lineart"===Zy(e=>e.currentThemeId),I=_?"#00ffff":u,D=_?"#0a3a3a":"#2a2a2a",O=_?"#0a4a4a":"#444",F=_?"#0a4a4a":"#4a4a4a",R=_?"#0a3a3a":"#3a3a3a",j=_?"#0a2a2a":"#2a2a2a",{knob:L,fontSize:B,stroke:V}={sm:{knob:40,fontSize:10,stroke:3},md:{knob:56,fontSize:11,stroke:4},lg:{knob:72,fontSize:12,stroke:5}}[d],z=s.useCallback(()=>l?Tb(Math.max(t,Math.min(n,e)),t,n):(e-t)/(n-t),[e,t,n,l]),U=s.useCallback(()=>{const a=void 0!==p?p:e,s=Math.max(t,Math.min(n,a));return l?Tb(s,t,n):(s-t)/(n-t)},[p,e,t,n,l])(),G=isNaN(U)||!isFinite(U)?-135:270*U-135,W=f||(e=>isNaN(e)||null==e?"0":e>=1e3?`${(e/1e3).toFixed(1)}k`:e<10?e.toFixed(1):Math.round(e).toString()),K=m?0:-135,H=G,$=(L-2*V)/2,q=L/2,Y=e=>{const t=((isNaN(e)||!isFinite(e)?-135:e)-90)*Math.PI/180;return{x:q+$*Math.cos(t),y:q+$*Math.sin(t)}},X=(e,t)=>{const n=Y(e),a=Y(t),s=Math.abs(t-e)>180?1:0,r=t>e?1:0;return`M ${n.x} ${n.y} A ${$} ${$} 0 ${s} ${r} ${a.x} ${a.y}`},Q=s.useCallback(e=>{if(g)return;e.preventDefault(),x(!0);const t="touches"in e?e.touches[0].clientY:e.clientY;w.current=t,k.current=z(),document.body.style.cursor="ns-resize";const n=e=>{const t="touches"in e?e.touches[0].clientY:e.clientY,n=(w.current-t)/150,a=Math.max(0,Math.min(1,k.current+n));let s;s=T.current?((e,t,n)=>{const a=Math.log(t),s=Math.log(n);return Math.exp(a+e*(s-a))})(a,E.current,P.current):E.current+a*(P.current-E.current);const r=A.current;s=void 0!==r&&r>0?Math.round(s/r)*r:Math.round(100*s)/100,M.current=s,S.current||(S.current=requestAnimationFrame(()=>{null!==M.current&&(C.current(M.current),M.current=null),S.current=null}))},a=()=>{x(!1),document.body.style.cursor="",window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",a),S.current&&(cancelAnimationFrame(S.current),S.current=null)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",a),window.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("touchend",a)},[z,g]),Z=s.useCallback(()=>{g||i(void 0!==c?c:m?(n+t)/2:t)},[c,m,t,n,i,g]),J=s.useCallback(e=>{e.preventDefault(),g||i(void 0!==c?c:m?(n+t)/2:t)},[c,m,t,n,i,g]),ee=s.useCallback(a=>{let s=e;const r=y||(l?(n-t)/100:(n-t)/50),o=10*r;switch(a.key){case"ArrowUp":case"ArrowRight":a.preventDefault(),s=Math.min(n,e+(a.shiftKey?o:r));break;case"ArrowDown":case"ArrowLeft":a.preventDefault(),s=Math.max(t,e-(a.shiftKey?o:r));break;case"Home":a.preventDefault(),s=t;break;case"End":a.preventDefault(),s=n;break;case"PageUp":a.preventDefault(),s=Math.min(n,e+o);break;case"PageDown":a.preventDefault(),s=Math.max(t,e-o);break;default:return}s=void 0!==y&&y>0?Math.round(s/y)*y:n-t>100?Math.round(s):Math.round(10*s)/10,i(s)},[e,t,n,l,y,i]);s.useEffect(()=>()=>{S.current&&cancelAnimationFrame(S.current)},[]);const te=Y(G),ne={x:q+($-8)*Math.cos((G-90)*Math.PI/180),y:q+($-8)*Math.sin((G-90)*Math.PI/180)};return wn.jsxs("div",{className:"knob-container",style:{width:L+20,opacity:g?.4:1,pointerEvents:g?"none":"auto"},title:r,children:[a&&wn.jsx("div",{className:"knob-label",style:{fontSize:B-1},children:a}),wn.jsx("div",{ref:v,className:"knob-body "+(b?"cursor-grabbing":""),style:{width:L,height:L},onMouseDown:Q,onTouchStart:Q,onDoubleClick:Z,onContextMenu:J,onKeyDown:ee,role:"slider","aria-label":`${a||"Knob"}${o?` (${o})`:""}`,"aria-valuemin":t,"aria-valuemax":n,"aria-valuenow":Math.round(10*e)/10,"aria-valuetext":`${W(void 0!==p?p:e)}${o}`,tabIndex:0,children:wn.jsxs("svg",{width:L,height:L,viewBox:`0 0 ${L} ${L}`,children:[wn.jsx("path",{d:X(-135,135),fill:"none",stroke:D,strokeWidth:V,strokeLinecap:"round"}),m?.5!==U&&wn.jsx("path",{d:X(U>.5?K:H,U>.5?H:K),fill:"none",stroke:I,strokeWidth:V,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${I})`:`drop-shadow(0 0 2px ${I})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}):wn.jsx("path",{d:X(-135,G),fill:"none",stroke:I,strokeWidth:V,strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 4px ${I})`:`drop-shadow(0 0 2px ${I})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}),wn.jsx("circle",{cx:q,cy:q,r:$-V-4,fill:`url(#kg-${N})`,stroke:O,strokeWidth:"1"}),wn.jsx("line",{x1:ne.x,y1:ne.y,x2:te.x,y2:te.y,stroke:I,strokeWidth:"2",strokeLinecap:"round",style:{filter:h?`drop-shadow(0 0 3px ${I})`:"none",transition:void 0!==p?"transform 0.016s linear":"transform 0.1s ease-out"}}),wn.jsx("defs",{children:wn.jsxs("linearGradient",{id:`kg-${N}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[wn.jsx("stop",{offset:"0%",stopColor:F}),wn.jsx("stop",{offset:"50%",stopColor:R}),wn.jsx("stop",{offset:"100%",stopColor:j})]})})]})}),wn.jsxs("div",{className:"knob-value",style:{fontSize:B,color:h?I:void 0,textShadow:h?`0 0 4px ${I}80`:"none"},children:[W(void 0!==p?p:e),o]})]})},(e,t)=>e.value===t.value&&e.displayValue===t.displayValue&&e.isActive===t.isActive&&e.min===t.min&&e.max===t.max&&e.label===t.label&&e.color===t.color&&e.size===t.size&&e.disabled===t.disabled);Ab.displayName="Knob";const _b=()=>{const[e,t]=s.useState(null),[n,a]=s.useState(!1),[r,o]=s.useState(null),i=s.useRef(null);Pb();const{currentPreset:l,currentPage:c,totalPages:d,currentSynthType:u,pages:p,parameterValues:h,setParameterValue:m}=Gv(),f=Sb();s.useEffect(()=>{const e=f.getDeviceInfo();e&&t(e)},[]);return Mb()?wn.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg space-y-4",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{children:[wn.jsx("h3",{className:"text-lg font-semibold text-white",children:"Native Kontrol Standard"}),wn.jsx("div",{className:"text-xs text-cyan-400 mt-0.5",children:u})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("div",{className:"w-2 h-2 rounded-full "+(e?"bg-green-500":"bg-gray-500")}),wn.jsx("span",{className:"text-xs text-gray-400",children:e?"Connected":"Disconnected"})]})]}),e?wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[wn.jsx("div",{className:"text-sm font-medium text-white",children:e.name}),wn.jsx("div",{className:"text-xs text-gray-400",children:e.vendor}),wn.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-400",children:[e.hasDisplay&&wn.jsx("span",{children:" Display"}),e.hasLightGuide&&wn.jsxs("span",{children:[" Light Guide (",e.lightGuideKeys," keys)"]}),e.hasKnobs&&wn.jsxs("span",{children:[" ",e.knobCount," Knobs"]}),e.hasTransport&&wn.jsx("span",{children:" Transport"})]})]}),wn.jsx("button",{onClick:async()=>{await f.disconnect(),t(null)},className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"Disconnect"})]}):wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("p",{className:"text-sm text-gray-300",children:"Connect a Native Instruments controller to enable hardware control."}),wn.jsx("button",{onClick:async()=>{a(!0),o(null);try{if(await f.requestConnection()){const e=f.getDeviceInfo();t(e)}else o("Failed to connect to device")}catch(e){o(e instanceof Error?e.message:"Unknown error")}finally{a(!1)}},disabled:n,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:n?"Connecting...":"Connect Hardware"}),r&&wn.jsx("div",{className:"text-xs text-red-400 bg-red-900/20 rounded p-2",children:r})]}),l&&wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Current Preset"}),wn.jsxs("div",{className:"bg-gray-700 rounded p-3",children:[wn.jsx("div",{className:"text-sm font-medium text-white",children:l.metadata.name}),l.metadata.author&&wn.jsxs("div",{className:"text-xs text-gray-400",children:["by ",l.metadata.author]}),l.metadata.comment&&wn.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l.metadata.comment})]}),wn.jsx("button",{onClick:()=>{const e=Gv.getState();e.currentPreset&&e.exportPreset()},className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-sm",children:"Export .nksf File"})]}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("div",{className:"text-xs font-medium text-gray-400 uppercase",children:["Parameter Pages - ",p[c]?.name||"Page"]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("button",{onClick:()=>{Gv.getState().prevPage()},disabled:0===c,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:" Previous"}),wn.jsxs("div",{className:"px-4 py-2 bg-gray-700 rounded text-white text-sm font-mono",children:[c+1," / ",d]}),wn.jsx("button",{onClick:()=>{Gv.getState().nextPage()},disabled:c>=d-1,className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded transition-colors text-sm",children:"Next "})]})]}),p[c]&&wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:"Parameters"}),wn.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3",children:wn.jsx("div",{className:"grid grid-cols-4 gap-3",children:p[c].parameters.slice(0,8).map(e=>{const t=h[e.id]??e.defaultValue,n=dv(e,t);return wn.jsxs("div",{className:"flex flex-col items-center",children:[wn.jsx(Ab,{value:t*(e.max-e.min)+e.min,min:e.min,max:e.max,onChange:t=>{const n=(t-e.min)/(e.max-e.min);m(e.id,n)},label:e.name,color:"#00ffff",size:"sm"}),wn.jsx("div",{className:"text-[10px] text-gray-400 mt-1 text-center truncate w-full",children:n})]},e.id)})})})]}),e?.hasLightGuide&&wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"Pad LEDs":"Light Guide"}),wn.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.vendor.toLowerCase().includes("akai")?wn.jsxs(wn.Fragment,{children:[wn.jsx("button",{onClick:()=>async function(){await gb([{pad:0,red:127,green:0,blue:0},{pad:1,red:127,green:64,blue:0},{pad:2,red:127,green:127,blue:0},{pad:3,red:0,green:127,blue:0},{pad:4,red:0,green:127,blue:127},{pad:5,red:0,green:0,blue:127},{pad:6,red:64,green:0,blue:127},{pad:7,red:127,green:0,blue:127}])}(),className:"px-3 py-2 bg-gradient-to-r from-red-500 via-yellow-500 to-blue-500 hover:opacity-80 text-white rounded transition-colors text-xs font-medium",children:"Rainbow"}),wn.jsx("button",{onClick:()=>async function(){const e=Array.from({length:8},(e,t)=>({pad:t,red:0,green:0,blue:0}));await gb(e)}(),className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear LEDs"})]}):wn.jsxs(wn.Fragment,{children:[wn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,4,5,7,9,11])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Major Scale"}),wn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,2,3,5,7,8,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"C Minor Scale"}),wn.jsx("button",{onClick:()=>{f.setScaleLights(0,[0,3,5,7,10])},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Pentatonic"}),wn.jsx("button",{onClick:()=>{f.clearLightGuide()},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors text-xs",children:"Clear"})]})})]}),e?.hasDisplay&&wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("div",{className:"text-xs font-medium text-gray-400 uppercase",children:e.vendor.toLowerCase().includes("akai")?"OLED Display (128x64)":"Display Test"}),e.vendor.toLowerCase().includes("akai")?wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsx("button",{onClick:()=>fb("  DEViLBOX  ","  Tracker DAW  "),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Text"}),wn.jsx("button",{onClick:()=>bb(),className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Pattern"})]}),wn.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;const n=new Image;n.onload=async()=>{const e=document.createElement("canvas");e.width=128,e.height=64;const t=e.getContext("2d");if(!t)return;t.fillStyle="black",t.fillRect(0,0,128,64);const a=Math.min(128/n.width,64/n.height),s=(128-n.width*a)/2,r=(64-n.height*a)/2;t.drawImage(n,s,r,n.width*a,n.height*a);const i=function(e){const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");const n=t.getImageData(0,0,pb,hb),a=new Uint8Array(1024);for(let s=0;s<hb;s++)for(let e=0;e<pb;e++){const t=4*(s*pb+e);if(n.data[t]>127){const t=7-e%8;a[16*s+Math.floor(e/8)]|=1<<t}}return a}(e);await vb(i),o(null)},n.onerror=()=>{o("Failed to load image")},n.src=URL.createObjectURL(t)},className:"hidden"}),wn.jsx("button",{onClick:()=>{i.current?.click()},className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors text-xs font-medium",children:" Upload Custom Image (128x64)"}),wn.jsx("div",{className:"text-[10px] text-gray-500 italic",children:"Tip: Upload any image - it will be auto-converted to monochrome 12864"})]}):wn.jsx("button",{onClick:()=>{Gv.getState().setDisplayInfo(["    DEViLBOX    ","  Tracker DAW   ","  NKS Active    ","  Connected!    "])},className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors text-xs",children:"Test Display"})]}),wn.jsx("div",{className:"pt-2 border-t border-gray-700",children:wn.jsxs("div",{className:"text-xs text-gray-500",children:[wn.jsx("p",{children:"NKS enables deep hardware integration with Native Instruments controllers."}),wn.jsx("p",{className:"mt-1",children:"Knobs, displays, and light guides sync automatically."})]})})]}):wn.jsxs("div",{className:"nks-settings-panel p-4 bg-gray-800 rounded-lg",children:[wn.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Web HID Not Supported"}),wn.jsx("p",{className:"text-sm text-gray-300",children:"Your browser does not support Web HID API. Please use Chrome/Edge 89+ or Opera 75+."})]})},Ib=({onClose:e})=>{const[t,n]=s.useState(""),[a,r]=s.useState("all"),[o,i]=s.useState("name"),{presets:l,loadPreset:c}=Gv(),d=s.useMemo(()=>{let e=[...l];if(t.trim()){const n=t.toLowerCase();e=e.filter(e=>e.metadata.name.toLowerCase().includes(n)||e.metadata.author?.toLowerCase().includes(n)||e.metadata.comment?.toLowerCase().includes(n)||e.metadata.bankChain.some(e=>e.toLowerCase().includes(n)))}return"all"!==a&&(e=e.filter(e=>e.metadata.bankChain.includes(a))),e.sort((e,t)=>{switch(o){case"name":case"date":return e.metadata.name.localeCompare(t.metadata.name);case"author":return(e.metadata.author||"").localeCompare(t.metadata.author||"");default:return 0}}),e},[l,t,a,o]),u=s.useMemo(()=>{const e=new Set;return l.forEach(t=>{t.metadata.bankChain.forEach(t=>e.add(t))}),Array.from(e).sort()},[l]);return wn.jsx("div",{className:"nks-preset-browser fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:wn.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl max-h-[80vh] flex flex-col",children:[wn.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[wn.jsx("h2",{className:"text-xl font-semibold text-white",children:"NKS Preset Browser"}),wn.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:wn.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:wn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),wn.jsxs("div",{className:"p-4 border-b border-gray-700 space-y-3",children:[wn.jsxs("div",{className:"relative",children:[wn.jsx("input",{type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"Search presets...",className:"w-full px-4 py-2 pl-10 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500 outline-none"}),wn.jsx("svg",{className:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:wn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),wn.jsxs("div",{className:"flex gap-3",children:[wn.jsxs("select",{value:a,onChange:e=>r(e.target.value),className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[wn.jsx("option",{value:"all",children:"All Categories"}),u.map(e=>wn.jsx("option",{value:e,children:e},e))]}),wn.jsxs("select",{value:o,onChange:e=>i(e.target.value),className:"px-3 py-2 bg-gray-700 text-white rounded border border-gray-600 outline-none",children:[wn.jsx("option",{value:"name",children:"Sort by Name"}),wn.jsx("option",{value:"author",children:"Sort by Author"}),wn.jsx("option",{value:"date",children:"Sort by Date"})]}),wn.jsxs("label",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded cursor-pointer transition-colors",children:["Import .nksf",wn.jsx("input",{type:"file",accept:".nksf",onChange:async e=>{const t=e.target.files?.[0];if(t)try{const e=await t.arrayBuffer(),n=await uv(e);if(n){Gv.getState().addPreset(n),c(n)}}catch(n){alert("Failed to import preset file")}},className:"hidden"})]})]})]}),wn.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:0===d.length?wn.jsxs("div",{className:"text-center text-gray-400 py-8",children:[wn.jsx("p",{children:"No presets found"}),0===l.length&&wn.jsx("p",{className:"text-sm mt-2",children:"Import .nksf files to get started"})]}):wn.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:d.map((t,n)=>wn.jsxs("button",{onClick:()=>(t=>{c(t),e?.()})(t),className:"text-left p-4 bg-gray-700 hover:bg-gray-600 rounded transition-colors group",children:[wn.jsxs("div",{className:"flex items-start justify-between",children:[wn.jsxs("div",{className:"flex-1 min-w-0",children:[wn.jsx("div",{className:"font-medium text-white truncate group-hover:text-blue-400 transition-colors",children:t.metadata.name}),t.metadata.author&&wn.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["by ",t.metadata.author]}),t.metadata.bankChain.length>0&&wn.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:t.metadata.bankChain.join("  ")}),t.metadata.comment&&wn.jsx("div",{className:"text-xs text-gray-500 mt-2 line-clamp-2",children:t.metadata.comment})]}),wn.jsx("svg",{className:"w-5 h-5 text-gray-500 group-hover:text-blue-400 transition-colors ml-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:wn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),wn.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[Object.keys(t.parameters).length," parameters"]})]},`${t.metadata.uuid}-${n}`))})}),wn.jsxs("div",{className:"p-4 border-t border-gray-700 text-xs text-gray-500",children:["Showing ",d.length," of ",l.length," presets"]})]})})},Db=e.memo(()=>{const[e,t]=s.useState(!1),[n,a]=s.useState(!1),[r,o]=s.useState(!1),[i,l]=s.useState(!1),c=s.useRef(null),d=kg(e=>e.isSupported),u=kg(e=>e.isInitialized),p=kg(e=>e.lastError),h=kg(e=>e.inputDevices),m=kg(e=>e.outputDevices),f=kg(e=>e.selectedInputId),y=kg(e=>e.selectedOutputId),g=kg(e=>e.isLearning),v=kg(e=>e.lastActivityTimestamp),b=kg(e=>e.init),x=kg(e=>e.selectInput),w=kg(e=>e.selectOutput),k=kg(e=>e.cancelLearn),S=kg(e=>e.openPatternDialog);s.useEffect(()=>{u||null!==d||(a(!0),b().finally(()=>a(!1)))},[u,d,b]),s.useEffect(()=>{if(!e)return;const n=e=>{c.current&&!c.current.contains(e.target)&&(t(!1),g&&k())};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[e,g,k]);const[M,N]=s.useState(!1);s.useEffect(()=>{if(v>0){N(!0);const e=setTimeout(()=>N(!1),100);return()=>clearTimeout(e)}},[v]);return wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{className:"relative",ref:c,children:[wn.jsxs("button",{onClick:()=>t(!e),className:`\n          flex items-center gap-2 px-2 py-1 rounded text-sm font-medium\n          transition-all duration-150\n          ${e?"bg-dark-bgActive text-text-primary":"hover:bg-dark-bgHover"}\n          ${null===d||!1===d?"text-text-muted":p?"text-accent-error":u?f||y?"text-accent-success":"text-accent-warning":"text-text-muted"}\n        `,title:d?u?f||y?"MIDI connected":"No MIDI device":"MIDI not initialized":"MIDI not supported",children:[wn.jsxs("div",{className:"relative",children:[wn.jsx(Ce,{size:16}),M&&wn.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-primary rounded-full animate-ping"})]}),wn.jsx("span",{className:"hidden sm:inline",children:"MIDI"})]}),e&&wn.jsxs("div",{className:"absolute right-0 top-full mt-1 w-80 max-h-[80vh] bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl z-50 overflow-y-auto",children:[wn.jsxs("div",{className:"px-4 py-3 border-b border-dark-border bg-dark-bgSecondary",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"MIDI Settings"}),n&&wn.jsx(Le,{size:14,className:"animate-spin text-accent-primary"})]}),p&&wn.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-accent-error",children:[wn.jsx(De,{size:12}),wn.jsx("span",{children:p})]})]}),!1===d?wn.jsxs("div",{className:"px-4 py-6 text-center",children:[wn.jsx(De,{size:24,className:"mx-auto mb-2 text-text-muted"}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"Web MIDI API is not supported in this browser."}),wn.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Try Chrome, Edge, or Opera."})]}):null===d?wn.jsxs("div",{className:"px-4 py-6 text-center",children:[wn.jsx(Le,{size:24,className:"mx-auto mb-2 text-text-muted animate-spin"}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"Checking MIDI support..."})]}):wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{className:"px-4 py-3 space-y-3 border-b border-dark-border",children:[wn.jsx(Av,{label:"Input Device",devices:h,selectedId:f,onSelect:x}),wn.jsx(Av,{label:"Output Device",devices:m,selectedId:y,onSelect:w})]}),wn.jsxs("div",{className:"px-4 py-2 border-b border-dark-border space-y-2",children:[wn.jsxs("button",{onClick:()=>{t(!1),o(!0)},className:"w-full px-3 py-2 text-sm font-medium bg-accent-primary/20 border border-accent-primary/30 rounded flex items-center justify-center gap-2 hover:bg-accent-primary/30 transition-colors text-accent-primary",children:[wn.jsx(Be,{size:14}),"MIDI Controller Setup..."]}),wn.jsxs("button",{onClick:()=>{t(!1),S()},className:"w-full px-3 py-2 text-sm font-medium bg-dark-bgActive rounded flex items-center justify-center gap-2 hover:bg-dark-bgHover transition-colors",children:[wn.jsx(Ve,{size:14}),"TD-3 Patterns..."]})]}),wn.jsx("div",{className:"border-t border-dark-border",children:wn.jsx(_b,{})}),f&&wn.jsx("div",{className:"px-4 py-2 border-t border-dark-border bg-dark-bgSecondary",children:wn.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[wn.jsx(ze,{size:10,className:M?"text-accent-success":"text-text-muted"}),wn.jsx("span",{children:M?"Receiving MIDI...":"Listening for MIDI input"})]})})]})]})]}),i&&wn.jsx(Ib,{onClose:()=>l(!1)}),wn.jsx(Bv,{isOpen:r,onClose:()=>o(!1)})]})}),Ob=({variant:e="default",size:t="md",color:n="default",fullWidth:a=!1,loading:s=!1,icon:r,iconPosition:o="left",children:i,className:l="",disabled:c,...d})=>{const u={primary:"btn-primary",default:"btn",ghost:"btn-ghost",icon:"btn-icon",danger:"btn-danger",ft2:""},p={sm:"btn-sm",md:"btn-md",lg:"btn-lg",icon:""};let h="inline-flex items-center justify-center gap-2 font-medium transition-colors focus:outline-none";if("ft2"===e)h+=` ft2-btn ${{sm:"ft2-btn-small",md:"",lg:"",icon:""}[t]} ${{default:"",red:"ft2-btn-red",green:"ft2-btn-green",yellow:"ft2-btn-yellow",blue:"ft2-btn-blue",purple:"ft2-btn-purple",cyan:"",amber:""}[n]}`;else{h+=` ${u[e]||u.default}`,p[t]&&(h+=` ${p[t]}`)}a&&(h+=" w-full"),(c||s)&&(h+=" opacity-50 cursor-not-allowed"),l&&(h+=` ${l}`);const m=wn.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[wn.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),wn.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return wn.jsxs("button",{...d,className:h,disabled:c||s,children:[s&&m,!s&&r&&"left"===o&&r,i,!s&&r&&"right"===o&&r]})},Fb=({isOpen:e,onClose:t})=>{if(!e)return null;const n=[{name:"Windows",icon:wn.jsx(je,{size:24}),desc:"Installer (.exe) or Portable (.zip)",color:"text-blue-400"},{name:"macOS",icon:wn.jsx(We,{size:24}),desc:"Disk Image (.dmg) for Intel/Apple Silicon",color:"text-gray-300"},{name:"Linux",icon:wn.jsx(Ke,{size:24}),desc:"AppImage, Debian, or Tarball",color:"text-orange-400"}];return wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100] animate-fade-in",children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden animate-slide-in-up",children:[wn.jsxs("div",{className:"bg-dark-bgTertiary px-6 py-4 flex items-center justify-between border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:wn.jsx(Ue,{size:20})}),wn.jsxs("div",{children:[wn.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Download DEViLBOX"}),wn.jsx("p",{className:"text-xs text-text-muted font-mono",children:"Native Desktop Applications"})]})]}),wn.jsx(Ob,{variant:"icon",size:"icon",onClick:t,"aria-label":"Close dialog",children:wn.jsx(Ee,{size:20})})]}),wn.jsxs("div",{className:"p-6",children:[wn.jsx("p",{className:"text-sm text-text-secondary mb-6 leading-relaxed",children:"Experience DEViLBOX with lower latency, better performance, and offline support. Native apps provide full access to system audio and MIDI resources."}),wn.jsx("div",{className:"space-y-3",children:n.map(e=>wn.jsxs("a",{href:"https://github.com/spotUP/DEViLBOX/releases/latest",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-4 p-4 rounded-xl border border-dark-border bg-dark-bg hover:bg-dark-bgHover hover:border-accent-primary/50 transition-all duration-200 shadow-sm",children:[wn.jsx("div",{className:`p-3 rounded-lg bg-dark-bgSecondary ${e.color} group-hover:scale-110 transition-transform duration-200`,children:e.icon}),wn.jsxs("div",{className:"flex-1",children:[wn.jsx("h3",{className:"font-semibold text-text-primary group-hover:text-accent-primary transition-colors",children:e.name}),wn.jsx("p",{className:"text-xs text-text-muted",children:e.desc})]}),wn.jsx(Ge,{size:16,className:"text-text-muted group-hover:text-text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"})]},e.name))}),wn.jsx("div",{className:"mt-8 pt-6 border-t border-dark-border text-center",children:wn.jsx("p",{className:"text-[10px] text-text-muted font-mono uppercase tracking-widest",children:"Built with Electron & Tone.js"})})]})]})})},Rb={Synth:1,MonoSynth:2,DuoSynth:3,FMSynth:4,AMSynth:5,TB303:10,Sampler:11,WobbleBass:12,DubSiren:13,SpaceLaser:14,V2:20,Synare:15,DrumMachine:16,ChipSynth:17};class jb{static export(e,t,n,a,s){const r=[];r.push(219,88,78,33),r.push(1),r.push(Math.min(255,a)),r.push(Math.min(255,s));const o=this.getUsedInstrumentIds(t,n),i=e.filter(e=>o.has(e.id));r.push(i.length),r.push(n.length),i.forEach(e=>{r.push(e.id),r.push(Rb[e.synthType]||0),r.push(Math.round((e.volume+60)/60*255)),r.push(Math.round((e.pan+100)/200*255));this.packSynthParams(e).forEach(e=>r.push(e))}),n.forEach(e=>r.push(e));const l=Array.from(new Set(n));return r.push(l.length),l.forEach(e=>{const n=t[e];if(n){r.push(e),r.push(n.length);for(let e=0;e<n.length;e++){const t=[];n.channels.forEach((n,a)=>{const s=n.rows[e];s&&this.isCellActive(s)&&t.push({cell:s,channel:a})}),0!==t.length?(r.push(t.length),t.forEach(({cell:e,channel:t})=>{let n=0;e.note>0&&(n|=8),e.instrument>0&&(n|=4),e.volume>0&&(n|=2),e.effTyp>0&&(n|=1),r.push(t<<4|n),8&n&&r.push(e.note),4&n&&r.push(e.instrument),2&n&&r.push(e.volume),1&n&&(r.push(e.effTyp),r.push(e.eff))})):r.push(0)}}}),new Uint8Array(r)}static getUsedInstrumentIds(e,t){const n=new Set;return t.forEach(t=>{const a=e[t];a&&a.channels.forEach(e=>{e.rows.forEach(e=>{e.instrument>0&&n.add(e.instrument)})})}),n}static isCellActive(e){return e.note>0||e.instrument>0||e.volume>0||e.effTyp>0}static packSynthParams(e){const t=new Array(8).fill(0);return"TB303"===e.synthType&&e.tb303?(t[0]=e.tb303.filter.cutoff,t[1]=e.tb303.filter.resonance,t[2]=e.tb303.filterEnvelope.envMod,t[3]=e.tb303.filterEnvelope.decay):"SpaceLaser"===e.synthType&&e.spaceLaser?(t[0]=e.spaceLaser.laser.sweepTime/2e3*255,t[1]=e.spaceLaser.fm.amount,t[2]=10*e.spaceLaser.fm.ratio,t[3]=e.spaceLaser.filter.cutoff/100):"V2"===e.synthType&&e.v2&&(t[0]=e.v2.osc1.transpose+64,t[1]=e.v2.osc1.detune+64,t[2]=e.v2.filter1.cutoff,t[3]=e.v2.filter1.resonance),t.map(e=>Math.floor(Math.min(255,Math.max(0,e))))}}const Lb=({onClose:e})=>{const[t,n]=s.useState(!1),{instruments:a}=Py(),{patterns:r,patternOrder:o}=tf(),{bpm:i,speed:l}=Ry(),c=s.useMemo(()=>jb.export(a,r,o,i,l),[a,r,o,i,l]),d=s.useMemo(()=>{let e="";const t=new Uint8Array(c),n=t.byteLength;for(let a=0;a<n;a++)e+=String.fromCharCode(t[a]);return window.btoa(e)},[c]),u=s.useMemo(()=>({bytes:c.length,kb:(c.length/1024).toFixed(2),instr:a.length}),[c,a]);return wn.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:wn.jsxs("div",{className:"w-full max-w-2xl bg-[#1a1a1a] border-2 border-amber-500/50 shadow-[0_0_30px_rgba(245,158,11,0.2)] rounded-xl overflow-hidden flex flex-col",children:[wn.jsxs("div",{className:"px-6 py-4 bg-gradient-to-r from-amber-900/40 to-transparent border-b border-amber-500/30 flex items-center justify-between",children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("div",{className:"p-2 bg-amber-500 rounded-lg",children:wn.jsx(_e,{size:20,className:"text-black"})}),wn.jsxs("div",{children:[wn.jsx("h2",{className:"text-xl font-bold text-amber-400 tracking-tight",children:"NANO EXPORTER"}),wn.jsx("p",{className:"text-[10px] text-amber-500/60 uppercase font-black tracking-[0.2em]",children:"4k Intro Binary Packing"})]})]}),wn.jsx("button",{onClick:e,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:wn.jsx(Ee,{size:20})})]}),wn.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[wn.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[wn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[wn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Total Size"}),wn.jsxs("div",{className:"text-lg font-mono text-white",children:[u.bytes," ",wn.jsx("span",{className:"text-xs text-gray-500",children:"bytes"})]})]}),wn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[wn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Kilobytes"}),wn.jsxs("div",{className:"text-lg font-mono text-white",children:[u.kb," ",wn.jsx("span",{className:"text-xs text-gray-500",children:"KB"})]})]}),wn.jsxs("div",{className:"bg-black/40 border border-white/5 p-3 rounded-lg text-center",children:[wn.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1",children:"Target"}),wn.jsx("div",{className:"text-lg font-mono text-green-500",children:"4K OK"})]})]}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Binary Data (Base64)"}),wn.jsxs("div",{className:"relative group",children:[wn.jsx("textarea",{readOnly:!0,value:d,className:"w-full h-32 bg-black/60 border border-white/10 rounded-lg p-4 font-mono text-[10px] text-amber-400/80 resize-none focus:outline-none focus:border-amber-500/50"}),wn.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d),n(!0),setTimeout(()=>n(!1),2e3)},className:"absolute top-2 right-2 p-2 bg-amber-500 text-black rounded-md hover:bg-amber-400 transition-colors shadow-lg flex items-center gap-2",children:[t?wn.jsx(Fe,{size:14}):wn.jsx(He,{size:14}),wn.jsx("span",{className:"text-[10px] font-bold uppercase",children:t?"Copied":"Copy"})]})]})]}),wn.jsxs("div",{className:"bg-amber-500/5 border border-amber-500/20 p-4 rounded-lg",children:[wn.jsx("h4",{className:"text-xs font-bold text-amber-400 uppercase mb-2",children:"How to use in 4k Intro:"}),wn.jsxs("ul",{className:"text-[11px] text-gray-400 space-y-1 list-disc pl-4",children:[wn.jsx("li",{children:"Copy the Base64 string into your source code."}),wn.jsx("li",{children:"Decode it into a Uint8Array at startup."}),wn.jsx("li",{children:"Parse the fixed-length header (8 bytes)."}),wn.jsx("li",{children:"Precalc (Bake) instruments into RAM using the packed parameters."}),wn.jsx("li",{children:"Use a lightweight replay routine to process the 4-byte packed patterns."})]})]})]}),wn.jsxs("div",{className:"p-6 bg-black/20 border-t border-white/5 flex gap-3",children:[wn.jsxs("button",{onClick:()=>{const e=new Blob([new Uint8Array(c)],{type:"application/octet-stream"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="song.nano",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},className:"flex-1 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg font-bold text-xs text-white transition-all flex items-center justify-center gap-2",children:[wn.jsx($e,{size:16}),"DOWNLOAD .NANO"]}),wn.jsx("button",{onClick:e,className:"flex-1 py-3 bg-amber-500 hover:bg-amber-400 text-black rounded-lg font-bold text-xs transition-all",children:"DONE"})]})]})})},Bb=()=>"undefined"!=typeof window&&!0===window.electron?.isElectron,Vb=()=>Bb()&&!!window.electron?.fs,zb=e.memo(()=>{const e=By(e=>e.metadata),t=By(e=>e.isDirty),n=Ly(e=>e.masterVolume),a=Ly(e=>e.setMasterVolume),r=qy(e=>e.tabs),o=qy(e=>e.activeTabId),i=qy(e=>e.addTab),l=qy(e=>e.closeTab),c=qy(e=>e.setActiveTab),d=qy(e=>e.updateTabName),u=qy(e=>e.markTabDirty),p=Zy(e=>e.currentThemeId),h=Zy(e=>e.setTheme),m=Zy(e=>e.getCurrentTheme),[f,y]=s.useState(!1),[g,v]=s.useState(!1),[b,x]=s.useState(!1),w=m();s.useEffect(()=>{e.name&&o&&d(o,e.name)},[e.name,o,d]),s.useEffect(()=>{o&&u(o,t)},[t,o,u]),s.useEffect(()=>{if(!f)return;const e=e=>{e.target.closest("[data-theme-menu]")||y(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[f]);return wn.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border relative z-40",children:[wn.jsxs("nav",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsx("h1",{className:"font-bold text-lg tracking-tight",children:wn.jsx("span",{className:"text-accent-primary",children:"DEViLBOX"})}),wn.jsxs("span",{className:"text-xs font-medium text-text-inverse bg-accent-primary px-2 py-0.5 rounded cursor-help",title:`${Nv}  2026-02-11`,children:["1.0.",Mv]})]}),wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>x(!0),icon:wn.jsx(_e,{size:14,className:"text-amber-400"}),className:"text-amber-400 hover:text-amber-300 hover:bg-amber-400/10 border border-amber-400/20",title:"Nano Exporter: Demoscene-grade binary packing",children:"NANO"}),!Bb()&&wn.jsx(Ob,{variant:"primary",size:"sm",onClick:()=>v(!0),icon:wn.jsx(Ue,{size:14}),iconPosition:"left",title:"Download Desktop App",children:wn.jsx("span",{className:"hidden sm:inline uppercase whitespace-nowrap",children:"Desktop App"})}),wn.jsx(Db,{}),wn.jsxs("div",{className:"relative","data-theme-menu":!0,children:[wn.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors whitespace-nowrap",title:"Change theme",children:[wn.jsx(qe,{size:16}),wn.jsx("span",{className:"text-sm",children:w.name})]}),f&&wn.jsx("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[140px]",children:Xy.map(e=>wn.jsxs("button",{onClick:()=>{h(e.id),y(!1)},className:`\n                      w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2\n                      ${p===e.id?"bg-dark-bgActive text-text-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"}\n                    `,children:[wn.jsx("span",{className:"w-3 h-3 rounded-full border border-dark-borderLight",style:{backgroundColor:e.colors.accent}}),e.name]},e.id))})]}),wn.jsx("input",{type:"range",value:n,onChange:e=>{const t=parseInt(e.target.value,10);a(t)},min:"-60",max:"0",step:"1",className:"w-24",title:`Volume: ${n} dB`})]})]}),wn.jsxs("div",{className:"flex items-center px-2 py-1 border-b border-dark-border bg-dark-bgTertiary",children:[wn.jsx("div",{className:"flex items-center gap-1 flex-1 overflow-x-auto scrollbar-none",children:r.map(e=>wn.jsxs("button",{onClick:()=>c(e.id),className:`\n                group flex items-center gap-2 px-3 py-1.5 rounded-t-md text-sm font-medium\n                transition-all duration-150 min-w-0 max-w-[200px]\n                ${o===e.id?"bg-dark-bg text-text-primary border-t border-x border-dark-border -mb-px":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary hover:bg-dark-bg/50"}\n              `,children:[wn.jsxs("span",{className:"truncate",children:[e.name||"Untitled",e.isDirty&&wn.jsx("span",{className:"text-accent-primary ml-1",children:"*"})]}),r.length>1&&wn.jsx("span",{onClick:t=>((e,t)=>{e.stopPropagation(),l(t)})(t,e.id),className:`\n                    flex-shrink-0 p-0.5 rounded hover:bg-dark-border/50\n                    ${o===e.id?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:!opacity-100"}\n                  `,children:wn.jsx(Ee,{size:12})})]},e.id))}),wn.jsx("button",{onClick:()=>{i()},className:"flex-shrink-0 p-1.5 ml-1 rounded hover:bg-dark-border/50 text-text-muted hover:text-text-primary transition-colors",title:"New project tab",children:wn.jsx(Ye,{size:16})})]}),wn.jsx(Fb,{isOpen:g,onClose:()=>v(!1)}),b&&wn.jsx(Lb,{onClose:()=>x(!1)})]})}),Ub=({children:e})=>wn.jsxs("div",{className:"h-screen flex flex-col bg-dark-bg text-text-primary overflow-y-hidden",children:[wn.jsx(zb,{}),wn.jsx("main",{className:"flex-1 flex min-h-0 overflow-y-hidden",children:e})]}),Gb=(e,t)=>{if(!e||0===e.points.length)return null;const n=e.points;let a=null,s=null;for(let r=0;r<n.length;r++)if(n[r].row<=t&&(a=n[r]),n[r].row>=t){s=n[r];break}if(a&&a.row===t)return a.value;if(s&&s.row===t)return s.value;if(!a&&s)return s.value;if(a&&!s)return a.value;if(a&&s){const e=(t-a.row)/(s.row-a.row);return a.value+(s.value-a.value)*e}return null},Wb=20,Kb=({patternId:e,patternLength:t,rowHeight:n,channelCount:a,channelWidth:r,rowNumWidth:o,scrollOffset:i,visibleStart:l,parameter:c="cutoff",prevPatternId:d,prevPatternLength:u,nextPatternId:p,nextPatternLength:h})=>{const m=Vy(e=>e.curves),f=Vy(e=>e.addPoint),y=Vy(e=>e.removePoint),[g,v]=s.useState(null),b=s.useRef(null),x=s.useMemo(()=>{const t=[];for(let n=0;n<a;n++){const a=m.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===c);t.push(a&&a.points.length>0?a:null)}return t},[e,a,c,m]),w=s.useMemo(()=>{if(!d)return[];const e=[];for(let t=0;t<a;t++){const n=m.find(e=>e.patternId===d&&e.channelIndex===t&&e.parameter===c);e.push(n&&n.points.length>0?n:null)}return e},[d,a,c,m]),k=s.useMemo(()=>{if(!p)return[];const e=[];for(let t=0;t<a;t++){const n=m.find(e=>e.patternId===p&&e.channelIndex===t&&e.parameter===c);e.push(n&&n.points.length>0?n:null)}return e},[p,a,c,m]),S=(e=>({cutoff:"var(--color-synth-filter)",resonance:"var(--color-synth-filter)",envMod:"var(--color-synth-envelope)",decay:"var(--color-synth-envelope)",accent:"var(--color-synth-accent)",overdrive:"var(--color-synth-drive)",distortion:"var(--color-synth-drive)",volume:"var(--color-synth-volume)",pan:"var(--color-synth-pan)",delay:"var(--color-synth-effects)",reverb:"var(--color-synth-effects)"}[e]||"var(--color-synth-filter)"))(c),M=d?u||t:0,N=p?h||t:0,C=M*n+t*n+N*n;if(!(x.some(e=>null!==e)||w.some(e=>null!==e)||k.some(e=>null!==e)))return null;const E=s.useCallback((e,a,s,r,o)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const i=b.current?.getBoundingClientRect();if(!i)return;const l=e.clientY-i.top-o,c=Math.floor(l/n);if(c<0||c>=t)return;const d=e.clientX-i.left-r,u=Math.max(0,Math.min(1,(d-1)/18));f(a.id,c,u),v({curveId:a.id,row:c,channelIndex:s})},[t,n,f]),P=s.useCallback(e=>{if(!g||!b.current)return;const a=b.current.getBoundingClientRect(),s=x[g.channelIndex];if(!s)return;const o=g.channelIndex*r+r-Wb-4,i=M*n,l=e.clientY-a.top-i,c=Math.floor(l/n);if(c<0||c>=t)return;const d=e.clientX-a.left-o,u=Math.max(0,Math.min(1,(d-1)/18));f(s.id,c,u)},[g,x,r,M,n,t,f]),T=s.useCallback(()=>{v(null)},[]),A=s.useCallback((e,a,s)=>{const r=b.current?.getBoundingClientRect();if(!r)return;const o=e.clientY-r.top-s,i=Math.floor(o/n);if(i<0||i>=t)return;a.points.find(e=>e.row===i)&&y(a.id,i)},[t,n,y]),_=(e,t,a,s,o,i)=>e.map((e,l)=>{if(!e)return null;const c=l*r+r-Wb-4,d=t*n,u=a*n,p=[],h=[`M 20 ${d}`];for(let a=0;a<t;a++){const t=Gb(e,a);if(null!==t){const e=18*t+1,s=a*n+n/2;p.push(`${0===p.length?"M":"L"} ${e} ${s}`)}}for(let a=t-1;a>=0;a--){const t=Gb(e,a);if(null!==t){const e=18*t+1,s=a*n+n/2;h.push(`L ${e} ${s}`)}}return h.push("L 20 0 Z"),wn.jsx("div",{style:{position:"absolute",left:c,top:u,width:Wb,height:d,cursor:i?"crosshair":"default"},onMouseDown:i?t=>E(t,e,l,c,u):void 0,onDoubleClick:i?t=>A(t,e,u):void 0,children:wn.jsxs("svg",{width:Wb,height:d,children:[wn.jsx("path",{d:h.join(" "),fill:S,fillOpacity:.1*s}),wn.jsx("path",{d:p.join(" "),fill:"none",stroke:S,strokeWidth:1.5,strokeOpacity:.6*s,strokeLinecap:"round",strokeLinejoin:"round"}),1===s&&e.points.map((e,t)=>wn.jsx("circle",{cx:18*e.value+1,cy:e.row*n+n/2,r:2,fill:S,fillOpacity:.8},t))]})},`${o}-${l}`)});return wn.jsxs("div",{ref:b,className:"automation-lanes",style:{position:"absolute",top:i-l*n-M*n,left:o,right:0,height:C,zIndex:5},onMouseMove:P,onMouseUp:T,onMouseLeave:T,children:[w.length>0&&_(w,M,0,.5,"prev",!1),_(x,t,M,1,"current",!0),k.length>0&&_(k,N,M+t,.5,"next",!1)]})},Hb=e.memo(({level:e,isActive:t})=>null);Hb.displayName="ChannelVUMeter";const $b=25,qb=(e,t,n=0)=>{if(!t)return{bg:"transparent",glow:"none"};const a=`hsl(${n}, ${180===n?100:75+10*e}%, ${180===n?45+15*e:40+20*e}%)`;return{bg:a,glow:`0 0 6px ${a}`}},Yb=s.memo(({channelWidth:e,scrollLeft:t=0})=>{const{patterns:n,currentPatternIndex:a}=tf(Fn(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),r=Zy(e=>e.currentThemeId),o=Ay(e=>e.performanceQuality),i=n[a],l=i?.channels.length||4,c=s.useRef(null),d=s.useRef([]),u=s.useRef([]),p=s.useRef([]),h=s.useRef(null),m=s.useRef(200),f="cyan-lineart"===r?180:0;s.useEffect(()=>{p.current=Array(l).fill(null).map((e,t)=>({level:0,position:(t%2==0?-1:1)*$b*.5,direction:t%2==0?1:-1})),d.current=Array(l).fill(null),u.current=Array(l).fill(null).map(()=>Array(26).fill(null))},[l]),s.useEffect(()=>{const e=()=>{c.current&&(m.current=c.current.clientHeight,d.current.forEach(e=>{e&&(e.style.height=m.current-4+"px")}))};e();const t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);const y=s.useCallback(()=>{const e=Hm().getChannelTriggerLevels(l);c.current&&(c.current.style.transform=`translateX(${-t}px)`);for(let t=0;t<l;t++){const n=p.current[t];if(!n)continue;const a=e[t]||0,s=.012*t;if(a>0)n.level=a;else{const e=.92-s;n.level=n.level*e,n.level<.01&&(n.level=0)}if(n.level>.02){const e=Math.abs(n.position)/$b,t=.8*(1-.7*Math.max(0,(e-.7)/.3));n.position+=t*n.direction,n.position>=$b?(n.position=$b,n.direction=-1):n.position<=-25&&(n.position=-25,n.direction=1)}const r=d.current[t];r&&(r.style.transform=`translateX(${n.position}px)`);const o=Math.round(26*n.level),i=u.current[t];if(i)for(let e=0;e<26;e++){const t=i[e];if(!t)continue;const n=e<o,a=e/25,{bg:s,glow:r}=qb(a,n,f);t.style.backgroundColor=s,t.style.boxShadow=r}}h.current=requestAnimationFrame(y)},[l,f,t]);if(s.useEffect(()=>{if("low"!==o)return h.current=requestAnimationFrame(y),()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)};h.current&&(cancelAnimationFrame(h.current),h.current=null)},[y,o]),"low"===o)return null;const g=e||260;return wn.jsx("div",{ref:c,className:"vu-meters-overlay",children:Array(l).fill(0).map((t,n)=>{const a=(t=>{if(e)return t*g+g/2;if(!i)return t*g+g/2;let n=0;for(let e=0;e<t;e++){const t=i.channels[e]?.collapsed;n+=t?60:g}return n+(i.channels[t]?.collapsed?60:g)/2})(n);return wn.jsx("div",{ref:e=>{d.current[n]=e},className:"vu-meter-vertical",style:{left:a-14+"px",width:"28px",height:m.current-4+"px",display:"flex",flexDirection:"column-reverse",alignItems:"stretch",gap:"4px"},children:Array.from({length:26},(e,t)=>wn.jsx("div",{ref:e=>{u.current[n]||(u.current[n]=[]),u.current[n][t]=e},style:{height:"4px",backgroundColor:"transparent",borderRadius:"1px"}},t))},n)})})});Yb.displayName="ChannelVUMeters";var Xb=l();const Qb=({currentColor:e,onColorSelect:t})=>{const[n,a]=s.useState(!1),[r,o]=s.useState({top:0,left:0}),i=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{if(n&&i.current){const e=i.current.getBoundingClientRect();o({top:e.bottom+4,left:e.left})}},[n]),s.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&i.current&&!i.current.contains(e.target)&&a(!1)};if(n)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&a(!1)};if(n)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const c=n?wn.jsxs("div",{ref:l,className:"fixed bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-2 animate-fade-in",style:{top:r.top,left:r.left,zIndex:9999,minWidth:"140px"},children:[wn.jsx("div",{className:"text-xs text-text-muted mb-2 px-1",children:"Channel Color"}),wn.jsx("div",{className:"grid grid-cols-4 gap-1",children:ta.map((n,s)=>wn.jsx("button",{type:"button",onClick:e=>((e,n)=>{n.stopPropagation(),t(e),a(!1)})(n,e),className:"w-7 h-7 rounded border-2 transition-all flex items-center justify-center "+(e===n?"border-accent-primary scale-110":"border-transparent hover:border-dark-borderLight hover:scale-105"),style:{backgroundColor:n||"transparent"},title:n||"No color",children:null===n&&wn.jsx(Ee,{size:14,className:"text-text-muted"})},s))})]}):null;return wn.jsxs(wn.Fragment,{children:[wn.jsx("button",{ref:i,type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),a(!n)},className:"p-1 rounded transition-colors "+(e?"text-text-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),style:e?{color:e}:void 0,title:"Channel Color",children:wn.jsx(qe,{size:12})}),c&&Xb.createPortal(c,document.body)]})},Zb=({items:e,position:t,onClose:n,className:a=""})=>{const r=s.useRef(null),[o,i]=s.useState(t),[l,c]=s.useState(null),[d,u]=s.useState(null),p=s.useRef(null);s.useEffect(()=>{if(!t||!r.current)return;const e=r.current.getBoundingClientRect(),n=window.innerWidth,a=window.innerHeight;let s=t.x,o=t.y;s+e.width>n-10&&(s=n-e.width-10),s<10&&(s=10),o+e.height>a-10&&(o=a-e.height-10),o<10&&(o=10),i({x:s,y:o})},[t]),s.useEffect(()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&n()},t=e=>{"Escape"===e.key&&n()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),p.current&&clearTimeout(p.current)}},[n]);const h=s.useCallback((e,t)=>{p.current&&(clearTimeout(p.current),p.current=null);const n=t.getBoundingClientRect();c(e),u({x:n.right-2,y:n.top-4})},[]),m=s.useCallback(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(null),u(null)},300)},[]),f=s.useCallback(()=>{p.current&&(clearTimeout(p.current),p.current=null)},[]);return t?Xb.createPortal(wn.jsx("div",{ref:r,className:`\n        fixed z-[100] min-w-[180px] py-1\n        bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl\n        ${a}\n      `,style:{left:o?.x??t.x,top:o?.y??t.y},onMouseEnter:f,children:0===e.length?wn.jsx("div",{className:"px-4 py-2 text-xs text-text-muted italic",children:"Empty"}):e.map((e,t)=>{if(!e)return null;if("divider"===e.type)return wn.jsx("div",{className:"h-px bg-dark-border my-1 mx-2"},`divider-${t}`);const a=e.submenu&&e.submenu.length>0;return wn.jsxs("div",{className:`\n                flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer transition-colors\n                ${e.disabled?"opacity-50 cursor-not-allowed":"hover:bg-dark-bgHover"}\n                ${e.danger?"text-accent-error hover:bg-accent-error/10":"text-text-secondary"}\n                ${l===e.id?"bg-dark-bgHover":""}\n              `,onClick:()=>{e.disabled||a||(e.onClick?.(),n())},onMouseEnter:t=>{a?h(e.id,t.currentTarget):(c(null),u(null))},onMouseLeave:()=>{a&&m()},children:[void 0!==e.checked&&wn.jsx("span",{className:"w-4 flex justify-center",children:e.radio?e.checked?wn.jsx(Xe,{size:8,className:"fill-accent-primary text-accent-primary"}):null:e.checked?wn.jsx(Fe,{size:14,className:"text-accent-primary"}):null}),e.icon&&wn.jsx("span",{className:"w-4 flex justify-center",children:e.icon}),wn.jsx("span",{className:"flex-1",children:e.label}),e.shortcut&&wn.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.shortcut}),a&&wn.jsx(Oe,{size:14,className:"text-text-muted"}),a&&l===e.id&&d&&wn.jsx(Jb,{items:e.submenu,position:d,onClose:n})]},e.id)})}),document.body):null},Jb=e=>wn.jsx(Zb,{...e}),ex=()=>{const[e,t]=s.useState(null);return{position:e,open:s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY})},[]),close:s.useCallback(()=>{t(null)},[]),isOpen:null!==e}},tx=({items:e,children:t,className:n="",disabled:a=!1})=>{const r=s.useRef(null),[o,i]=s.useState(!1),[l,c]=s.useState(null),d=s.useCallback(()=>{if(!a&&r.current){const e=r.current.getBoundingClientRect();c({x:e.left,y:e.bottom+4}),i(!0)}},[a]),u=s.useCallback(()=>{i(!1),c(null)},[]);return wn.jsxs(wn.Fragment,{children:[wn.jsx("button",{ref:r,onClick:d,disabled:a,className:n,children:t}),o&&l&&wn.jsx(Zb,{items:e,position:l,onClose:u})]})},nx=()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),ax=(e,t,n=64,a=!1)=>({note:e,instrument:t,volume:16+n,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:a?1:0});const sx={"4on4":{name:"4/4 Kicks",description:"Every 4 rows on beat",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[];for(let i=0;i<t;i++)if(i%4==0){const e=i%16==0;o.push(ax(a,n,s,r||e))}else o.push(nx());return o}},offbeat:{name:"Offbeat",description:"Every 4 rows, offset by 2",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56,accent:r}=e,o=[];for(let i=0;i<t;i++)(i+2)%4==0?o.push(ax(a,n,s,r)):o.push(nx());return o}},"8ths":{name:"8th Notes",description:"Every 2 rows",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56,accent:r}=e,o=[];for(let i=0;i<t;i++)if(i%2==0){const e=i%8==0;o.push(ax(a,n,e?s:s-8,r))}else o.push(nx());return o}},"16ths":{name:"16th Notes",description:"Every row",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=48,accent:r}=e,o=[];for(let i=0;i<t;i++){const e=i%4==0?s:i%2==0?s-8:s-16;o.push(ax(a,n,Math.max(16,e),r))}return o}},backbeat:{name:"Backbeat (2&4)",description:"Snare on beats 2 and 4",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[];for(let i=0;i<t;i++)i%16==4||i%16==12?o.push(ax(a,n,s,r)):o.push(nx());return o}},random:{name:"Random",description:"30% density random fill",category:"general",generate:e=>function(e,t=.3){const{patternLength:n,instrumentId:a,note:s,velocity:r=64,accent:o}=e,i=[];for(let l=0;l<n;l++)if(Math.random()<t){const e=Math.max(32,r-Math.floor(16*Math.random())),t=o||Math.random()<.25;i.push(ax(s,a,e,t))}else i.push(nx());return i}(e,.3)},build:{name:"Build",description:"Increasing density for transitions",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[],i=t/4;for(let l=0;l<t;l++){const e=Math.floor(l/i);let t;switch(e){case 0:t=8;break;case 1:default:t=4;break;case 2:t=2;break;case 3:t=1}if(l%t===0){const t=Math.min(64,s-16+8*e);o.push(ax(a,n,t,r))}else o.push(nx())}return o}},breakdown:{name:"Breakdown",description:"Sparse, minimal pattern",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=48,accent:r}=e,o=[];for(let i=0;i<t;i++)i%16==0?o.push(ax(a,n,s,r)):o.push(nx());return o}},syncopated:{name:"Syncopated",description:"Offbeat acid pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=64,accent:r}=e,o=[],i=[0,3,8,11,14];for(let l=0;l<t;l++){const e=l%16;if(i.includes(e)){const t=3===e||11===e,i=ax(a,n,s,r);i.flag2=t?2:0,o.push(i)}else o.push(nx())}return o}},walking:{name:"Walking Bass",description:"Simple ascending pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:a,velocity:s=56}=e,r=[],o=a||Ua("C-4"),i=qa(o);if(null===i)return r;const l=e=>{const t=i+e;return t>=12&&t<=107?Ya(t):o},c=[0,5,7,5];for(let d=0;d<t;d++)if(d%4==0){const e=l(c[Math.floor(d/4)%c.length]);r.push(ax(e,n,s,!1))}else r.push(nx());return r}},hiHats:{name:"Hi-Hats",description:"Open/closed hat pattern",category:"drums",generate:function(e,t){const{patternLength:n,instrumentId:a,note:s,velocity:r=56,accent:o}=e,i=[],l=t||Ua("A#3");for(let c=0;c<n;c++)if(c%2==0){const e=(c+4)%8==0,t=e?l:s,n=e?r:r-8;i.push(ax(t,a,n,o))}else i.push(nx());return i}},clear:{name:"Clear",description:"Remove all notes",category:"general",generate:e=>{return t=e.patternLength,Array(t).fill(null).map(()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));var t}}},rx=[{name:"Clean Master",description:"Subtle compression and EQ for polished output",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1,mid:0,high:.5}}]},{name:"Transparent",description:"Very light processing, preserves dynamics",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:2,attack:.02,release:.3}}]},{name:"Stereo Wide",description:"Clean stereo enhancement for wider soundstage",category:"Clean",effects:[{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:2.5,attack:.015,release:.25}}]},{name:"Club Ready",description:"Punchy compression with subs, ready for the dancefloor",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}]},{name:"Techno Master",description:"Hard compression and subs for driving techno",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:15,parameters:{distortion:.15}}]},{name:"Acid House",description:"Warm compression with subtle room reverb",category:"Club",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3.5,attack:.01,release:.2}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:1.5,preDelay:.01}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Deep House",description:"Smooth and warm with controlled dynamics",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:1,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2.5,attack:.02,release:.3}},{category:"tonejs",type:"Chorus",enabled:!0,wet:15,parameters:{frequency:.5,depth:.3}}]},{name:"Lo-Fi Crunch",description:"Bit-crushed and filtered for retro vibes",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:40,parameters:{bits:8}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:8e3,type:"lowpass",Q:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Tape Warmth",description:"Subtle saturation and filtering like vintage tape",category:"Lo-Fi",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.2}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:12e3,type:"lowpass",Q:.7}},{category:"tonejs",type:"Chorus",enabled:!0,wet:8,parameters:{frequency:.2,depth:.15}}]},{name:"VHS Vibe",description:"Wobbly and degraded like old VHS audio",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:25,parameters:{bits:12}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:30,parameters:{frequency:4,depth:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:15,parameters:{decay:1.2,preDelay:.02}}]},{name:"Ambient Space",description:"Lush reverb and delay for atmospheric soundscapes",category:"Ambient",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.4,feedback:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2,attack:.05,release:.4}}]},{name:"Dreamy Haze",description:"Soft and floaty with modulated delays",category:"Ambient",effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:35,parameters:{frequency:.3,depth:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:55,parameters:{decay:6,preDelay:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:5e3,type:"lowpass",Q:.5}}]},{name:"Cathedral",description:"Massive reverb for epic, cavernous sound",category:"Ambient",effects:[{category:"tonejs",type:"JCReverb",enabled:!0,wet:60,parameters:{roomSize:.9}},{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{delayTime:.25,feedback:.3}}]},{name:"Underwater",description:"Filtered and submerged atmospheric effect",category:"Ambient",effects:[{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:1200,type:"lowpass",Q:2}},{category:"tonejs",type:"Chorus",enabled:!0,wet:40,parameters:{frequency:.4,depth:.6}},{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:4,preDelay:.03}}]},{name:"Industrial",description:"Harsh distortion and compression for aggressive sound",category:"Aggressive",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:45,parameters:{distortion:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:2,high:4}}]},{name:"Crushed",description:"Heavy bit-crushing and distortion",category:"Aggressive",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:60,parameters:{bits:6}},{category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:10,attack:.001,release:.05}}]},{name:"Hardstyle",description:"Punchy kick-focused processing for hard dance",category:"Aggressive",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.002,release:.08}},{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.3}}]},{name:"Gabber",description:"Extreme compression and saturation for hardcore",category:"Aggressive",effects:[{category:"tonejs",type:"Chebyshev",enabled:!0,wet:50,parameters:{order:8}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-6,ratio:20,attack:5e-4,release:.03}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:0,high:5}}]},{name:"Dub Station",description:"Space Echo and Bi-Phase for authentic dub vibes",category:"Dub",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:40,parameters:{mode:4,rate:300,intensity:.6,echoVolume:.8,reverbVolume:.2}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0}}]},{name:"Sound System",description:"Heavy subs and performance filtering",category:"Dub",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:-2,high:1}},{category:"tonejs",type:"DubFilter",enabled:!0,wet:100,parameters:{cutoff:20,resonance:15,gain:1.2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Reggae",description:"Dotted-eighth skank echo with warm bass  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:25,parameters:{mode:4,rate:375,intensity:.4,echoVolume:.7,reverbVolume:.15,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:0,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.25}}]},{name:"Dub",description:"Heavy quarter-note echo with phaser swirl  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:45,parameters:{mode:4,rate:500,intensity:.7,echoVolume:.85,reverbVolume:.2,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0,bpmSync:1,syncDivision:"1/2"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:25,parameters:{decay:3,preDelay:.03}}]},{name:"Techno",description:"Driving eighth-note delay with hard compression  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{time:.25,feedback:.35,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:12,parameters:{distortion:.15}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}}]},{name:"House",description:"Ping-pong delay and chorus groove  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:18,parameters:{time:.25,feedback:.4,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:20,parameters:{frequency:1,depth:.4,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3.5,attack:.008,release:.18}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Ambient",description:"Long reverb with dotted-quarter ping-pong  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:6,preDelay:.06}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{time:.375,feedback:.5,bpmSync:1,syncDivision:"1/4d"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.25,depth:.5,bpmSync:1,syncDivision:"1/1"}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}}]},{name:"Lo-Fi Hip Hop",description:"Lazy swing delay with vinyl crunch  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:20,parameters:{bits:10}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:7e3,type:"lowpass",Q:.8}},{category:"tonejs",type:"Delay",enabled:!0,wet:22,parameters:{time:.375,feedback:.3,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:15,parameters:{frequency:4,depth:.06}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.015,release:.25}}]},{name:"Drum & Bass",description:"Tight sixteenth-note delay with sub boost  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:5,attack:.002,release:.08}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:15,parameters:{time:.125,feedback:.3,bpmSync:1,syncDivision:"1/16"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:.8,preDelay:.01}}]}],ox=({channelIndex:e,channel:t,patternId:n,patternLength:a,onFillPattern:r,onClearChannel:o,onCopyChannel:i,onCutChannel:l,onPasteChannel:c,onTranspose:d,onHumanize:u,onInterpolate:p,onAcidGenerator:h})=>{const{isLiveMode:m,queueChannelAction:f}=Mg(),{toggleChannelMute:y,toggleChannelSolo:g,removeChannel:v,setChannelColor:b,patterns:x}=tf(),{setActiveParameter:w,setShowLane:k,getShowLane:S,removeCurve:M,getCurvesForPattern:N}=Vy(),{updateInstrument:C}=Py(),E=s.useCallback(n=>{const a=rx.find(e=>e.name===n);if(!a||!t.instrumentId)return;const s=a.effects.map((e,t)=>({...e,id:`channel-fx-${Date.now()}-${t}`}));C(t.instrumentId,{effects:s}),tg.success(`Applied ${a.name} to CH ${(e+1).toString().padStart(2,"0")}`)},[t.instrumentId,e,C]),P=S(e),T=N(n,e),A=T.length>0,_=[{id:"cutoff",label:"Cutoff",color:"#4f9d69"},{id:"resonance",label:"Resonance",color:"#3b82f6"},{id:"envMod",label:"Env Mod",color:"#f59e0b"},{id:"volume",label:"Volume",color:"#ef4444"},{id:"pan",label:"Pan",color:"#8b5cf6"},{id:"decay",label:"Decay",color:"#06b6d4"}],I=s.useMemo(()=>m?[{id:"trigger",label:"Trigger",icon:wn.jsx(_e,{size:14}),submenu:[{id:"trigger-kicks",label:"4/4 Kicks",onClick:()=>{f(e,{type:"trigger",pattern:"kicks"}),r(e,"4on4")}},{id:"trigger-build",label:"Build",onClick:()=>{f(e,{type:"trigger",pattern:"build"}),r(e,"build")}},{id:"trigger-drop",label:"Drop",onClick:()=>{f(e,{type:"trigger",pattern:"drop"}),r(e,"16ths")}},{id:"trigger-breakdown",label:"Breakdown",onClick:()=>{f(e,{type:"trigger",pattern:"breakdown"}),r(e,"breakdown")}}]},{id:"stutter",label:"Stutter",icon:wn.jsx(Qe,{size:14}),onClick:()=>f(e,{type:"stutter"})},{id:"roll",label:"Roll",icon:wn.jsx(Pe,{size:14}),submenu:[{id:"roll-4",label:"1/4 Note",onClick:()=>f(e,{type:"roll",division:"1/4"})},{id:"roll-8",label:"1/8 Note",onClick:()=>f(e,{type:"roll",division:"1/8"})},{id:"roll-16",label:"1/16 Note",onClick:()=>f(e,{type:"roll",division:"1/16"})}]},{type:"divider"},{id:"automation",label:"Automation",icon:wn.jsx(Ze,{size:14}),submenu:[{id:"auto-sweep-up",label:"Filter Sweep Up",onClick:()=>f(e,{type:"filterSweep",direction:"up",bars:4})},{id:"auto-sweep-down",label:"Filter Sweep Down",onClick:()=>f(e,{type:"filterSweep",direction:"down",bars:4})},{id:"auto-fade-in",label:"Volume Fade In",onClick:()=>f(e,{type:"volumeFade",direction:"in",bars:4})},{id:"auto-fade-out",label:"Volume Fade Out",onClick:()=>f(e,{type:"volumeFade",direction:"out",bars:4})},{type:"divider"},{id:"auto-show-cutoff",label:"Show Cutoff",onClick:()=>{w(e,"cutoff"),k(e,!0)}},{id:"auto-show-volume",label:"Show Volume",onClick:()=>{w(e,"volume"),k(e,!0)}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?wn.jsx(Je,{size:14}):wn.jsx(et,{size:14}),checked:t.muted,onClick:()=>y(e)},{id:"solo",label:"Solo",icon:wn.jsx(tt,{size:14}),checked:t.solo,onClick:()=>g(e)},{id:"kill",label:"Kill",icon:wn.jsx(_e,{size:14}),danger:!0,onClick:()=>{f(e,{type:"kill"}),y(e)}}]:[{id:"fill",label:"Fill",icon:wn.jsx(Ae,{size:14}),submenu:[{id:"fill-4on4",label:sx["4on4"].name,onClick:()=>r(e,"4on4")},{id:"fill-offbeat",label:sx.offbeat.name,onClick:()=>r(e,"offbeat")},{id:"fill-backbeat",label:sx.backbeat.name,onClick:()=>r(e,"backbeat")},{id:"fill-hihats",label:sx.hiHats.name,onClick:()=>r(e,"hiHats")},{type:"divider"},{id:"fill-8ths",label:sx["8ths"].name,onClick:()=>r(e,"8ths")},{id:"fill-16ths",label:sx["16ths"].name,onClick:()=>r(e,"16ths")},{id:"fill-random",label:sx.random.name,onClick:()=>r(e,"random")},{id:"fill-acid",label:" Acid Generator...",icon:wn.jsx(nt,{size:14}),onClick:()=>h(e)},{type:"divider"},{id:"fill-syncopated",label:sx.syncopated.name,onClick:()=>r(e,"syncopated")},{id:"fill-walking",label:sx.walking.name,onClick:()=>r(e,"walking")},{type:"divider"},{id:"fill-build",label:sx.build.name,onClick:()=>r(e,"build")},{id:"fill-breakdown",label:sx.breakdown.name,onClick:()=>r(e,"breakdown")}]},{id:"clear",label:"Clear Channel",icon:wn.jsx(Re,{size:14}),onClick:()=>o(e)},{id:"copy",label:"Copy Track",icon:wn.jsx(He,{size:14}),onClick:()=>i(e)},{id:"cut",label:"Cut Track",icon:wn.jsx(at,{size:14}),onClick:()=>l(e)},{id:"paste",label:"Paste Track",icon:wn.jsx(st,{size:14}),onClick:()=>c(e)},{type:"divider"},{id:"fx-presets",label:"FX Presets",icon:wn.jsx(rt,{size:14}),submenu:(()=>{const e={};return rx.forEach(t=>{const n=t.category||"General";e[n]||(e[n]=[]),e[n].push(t)}),Object.keys(e).sort().map(t=>({id:`fx-cat-${t.toLowerCase()}`,label:t,submenu:e[t].map(e=>({id:`fx-preset-${e.name.replace(/\s+/g,"-")}`,label:e.name,onClick:()=>E(e.name)}))}))})()},{type:"divider"},{id:"transpose",label:"Transpose",icon:wn.jsx(Ve,{size:14}),submenu:[{id:"transpose-12",label:"+12 (Octave Up)",onClick:()=>d(e,12)},{id:"transpose-7",label:"+7 (Fifth)",onClick:()=>d(e,7)},{id:"transpose-1",label:"+1 (Semitone)",onClick:()=>d(e,1)},{type:"divider"},{id:"transpose--1",label:"-1 (Semitone)",onClick:()=>d(e,-1)},{id:"transpose--7",label:"-7 (Fifth)",onClick:()=>d(e,-7)},{id:"transpose--12",label:"-12 (Octave Down)",onClick:()=>d(e,-12)}]},{id:"humanize",label:"Humanize",icon:wn.jsx(nt,{size:14}),shortcut:"Ctrl+H",onClick:()=>u(e)},{id:"interpolate",label:"Interpolate",icon:wn.jsx(ot,{size:14}),shortcut:"Ctrl+I",onClick:()=>p(e)},{type:"divider"},{id:"automation",label:"Automation",icon:wn.jsx(ct,{size:14}),submenu:[..._.map(t=>({id:`auto-${t.id}`,label:t.label,icon:wn.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),onClick:()=>{w(e,t.id),k(e,!0)}})),{type:"divider"},{id:"auto-toggle-lane",label:P?"Hide Lane":"Show Lane",icon:P?wn.jsx(it,{size:14}):wn.jsx(lt,{size:14}),onClick:()=>k(e,!P)},{id:"auto-clear-all",label:"Clear All Automation",icon:wn.jsx(Re,{size:14}),danger:!0,disabled:!A,onClick:()=>{T.forEach(e=>M(e.id))}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?wn.jsx(Je,{size:14}):wn.jsx(et,{size:14}),checked:t.muted,onClick:()=>y(e)},{id:"solo",label:"Solo",icon:wn.jsx(tt,{size:14}),checked:t.solo,onClick:()=>g(e)},{id:"color",label:"Color",icon:wn.jsx(qe,{size:14}),submenu:ta.map((n,a)=>({id:`color-${a}`,label:null===n?"None":"",icon:n?wn.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:n}}):wn.jsx("span",{className:"w-4 h-4 rounded border border-dark-border"}),checked:t.color===n,onClick:()=>b(e,n)}))},{id:"delete",label:"Delete Channel",icon:wn.jsx(dt,{size:14}),danger:!0,disabled:x[0]?.channels.length<=1,onClick:()=>v(e)}],[m,e,t,P,A,T,x,r,o,i,l,c,d,u,p,h,y,g,v,b,f,w,k,M,E]);return wn.jsx(tx,{items:I,className:`\n        p-1 rounded transition-colors\n        ${m?"text-accent-error hover:bg-accent-error/20":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"}\n      `,children:wn.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[wn.jsx("circle",{cx:"12",cy:"12",r:"1"}),wn.jsx("circle",{cx:"12",cy:"5",r:"1"}),wn.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})},ix=({position:e,onClose:t,rowIndex:n,channelIndex:a,onInterpolate:r,onHumanize:o,onStrum:i,onLegato:l,onOpenParameterEditor:c})=>{const{patterns:d,currentPatternIndex:u,setCell:p,cursor:h,selectColumn:m,selectChannel:f}=tf(),y=d[u],g=s.useCallback(()=>{if(!y)return;const e=y.channels[a].rows[n];localStorage.setItem("devilbox-cell-clipboard",JSON.stringify(e))},[y,a,n]),v=s.useCallback(()=>{g(),p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[g,p,a,n]),b=s.useCallback(()=>{const e=localStorage.getItem("devilbox-cell-clipboard");if(e)try{const t=JSON.parse(e);p(a,n,t)}catch(t){}},[p,a,n]),x=s.useCallback(()=>{p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[p,a,n]),w=s.useCallback(()=>{if(y){for(let e=y.length-1;e>n;e--){const t=y.channels[a].rows[e-1];p(a,e,t)}p(a,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,a,n,p]),k=s.useCallback(()=>{if(y){for(let e=n;e<y.length-1;e++){const t=y.channels[a].rows[e+1];p(a,e,t)}p(a,y.length-1,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,a,n,p]),S=s.useCallback(()=>{m(a,h.columnType),t()},[a,h.columnType,m,t]),M=s.useCallback(()=>{f(a),t()},[a,f,t]),N=s.useMemo(()=>[{id:"cut",label:"Cut",icon:wn.jsx(at,{size:14}),shortcut:"Ctrl+X",onClick:v},{id:"copy",label:"Copy",icon:wn.jsx(He,{size:14}),shortcut:"Ctrl+C",onClick:g},{id:"paste",label:"Paste",icon:wn.jsx(st,{size:14}),shortcut:"Ctrl+V",onClick:b},{id:"clear",label:"Clear",icon:wn.jsx(Re,{size:14}),shortcut:"Del",onClick:x},{type:"divider"},{id:"insert-row",label:"Insert Row",icon:wn.jsx(ut,{size:14}),shortcut:"Ins",onClick:w},{id:"delete-row",label:"Delete Row",icon:wn.jsx(pt,{size:14}),shortcut:"Backspace",onClick:k},{type:"divider"},{id:"interpolate",label:"Interpolate",icon:wn.jsx(ot,{size:14}),shortcut:"Ctrl+I",onClick:r},{id:"humanize",label:"Humanize",icon:wn.jsx(nt,{size:14}),shortcut:"Ctrl+H",onClick:o},{id:"strum",label:"Strum/Arpeggiate",icon:wn.jsx(Ae,{size:14}),onClick:i},{id:"legato",label:"Legato (Connect Notes)",icon:wn.jsx(ht,{size:14}),onClick:l},{type:"divider"},{id:"param-editor",label:"Visual Parameter Editor",icon:wn.jsx(mt,{size:14}),submenu:[{id:"param-volume",label:"Edit Volume...",onClick:()=>c?.("volume")},{id:"param-effect",label:"Edit Effect Type...",onClick:()=>c?.("effect")},{id:"param-effectparam",label:"Edit Effect Parameter...",onClick:()=>c?.("effectParam")}]},{type:"divider"},{id:"select-column",label:"Select Column",icon:wn.jsx(ft,{size:14}),onClick:S},{id:"select-channel",label:"Select Channel",icon:wn.jsx(yt,{size:14}),onClick:M}],[v,g,b,x,w,k,r,o,i,l,c,S,M]);return e?wn.jsx(Zb,{items:N,position:e,onClose:t}):null},lx={volume:{label:"Volume",min:0,max:64,default:64,color:"#22c55e",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effectParam:{label:"Effect Parameter",min:0,max:255,default:0,color:"#f59e0b",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effect:{label:"Effect Type",min:0,max:35,default:0,color:"#8b5cf6",format:e=>e<10?e.toString():String.fromCharCode(55+e)},note:{label:"Note",min:0,max:119,default:48,color:"#3b82f6",format:e=>{const t=Math.floor(e/12);return`${["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"][e%12]}${t}`}},instrument:{label:"Instrument",min:0,max:99,default:1,color:"#ec4899",format:e=>e.toString().padStart(2,"0")}},cx=({onClose:e,channelIndex:t,startRow:n,endRow:a,field:r})=>{const o=s.useRef(null),i=s.useRef(null),[l,c]=s.useState(!1),[d,u]=s.useState("overwrite"),[p,h]=s.useState([]),[m,f]=s.useState(null),y=Ay(e=>e.useHexNumbers),g=tf(e=>e.patterns),v=tf(e=>e.currentPatternIndex),b=tf(e=>e.setCell),x=lx[r],w=a-n+1,k=12,S=20,M=Math.max(400,14*w+40),N=200;s.useEffect(()=>{const e=g[v];if(!e)return;const s=e.channels[t];if(!s)return;const o=[];for(let t=n;t<=a;t++){const e=s.rows[t];if(!e){o.push(x.default);continue}let n=x.default;switch(r){case"volume":n=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(n=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(n=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(n=e.note);break;case"instrument":n=e.instrument??x.default}o.push(n)}h(o)},[g,v,t,n,a,r,x.default]);const C=s.useCallback(()=>{const e=o.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#1a1a2e",t.fillRect(0,0,M,N),t.strokeStyle="#2a2a4a",t.lineWidth=1;for(let n=0;n<=4;n++){const e=S+n/4*160;t.beginPath(),t.moveTo(S,e),t.lineTo(M-S,e),t.stroke();const a=Math.round(x.max-(x.max-x.min)*(n/4));t.fillStyle="#666",t.font="10px monospace",t.textAlign="right",t.fillText(x.format(a),16,e+3)}(m||p).forEach((e,a)=>{const s=S+14*a,r=160*((e-x.min)/(x.max-x.min)),o=180-r,i=t.createLinearGradient(s,o,s,180);i.addColorStop(0,x.color),i.addColorStop(1,x.color+"40"),t.fillStyle=i,t.fillRect(s,o,k,r),t.strokeStyle=x.color,t.lineWidth=1,t.strokeRect(s,o,k,r),(n+a)%4==0&&(t.fillStyle="#888",t.font="9px monospace",t.textAlign="center",t.fillText(y?(n+a).toString(16).toUpperCase().padStart(2,"0"):(n+a).toString().padStart(2,"0"),s+6,196))})},[p,m,M,N,x,n,y]);s.useEffect(()=>{C()},[C]);const E=s.useCallback(e=>{const t=o.current;if(!t)return null;const n=t.getBoundingClientRect(),a=e.clientX-n.left,s=e.clientY-n.top,r=Math.floor((a-S)/14);if(r<0||r>=w)return null;const i=1-(s-S)/160,l=Math.round(x.min+i*(x.max-x.min));return{rowIndex:r,value:Math.max(x.min,Math.min(x.max,l))}},[w,x,N]),P=s.useCallback((e,t,n)=>{h(a=>{const s=[...a],r=s[e];switch(n){case"overwrite":s[e]=t;break;case"fill_blanks":0!==r&&r!==x.default||(s[e]=t);break;case"add":s[e]=Math.max(x.min,Math.min(x.max,r+(t-x.max/2)));break;case"scale":const n=t/x.max;s[e]=Math.round(r*n)}return s})},[x]),T=s.useCallback(e=>{const t=E(e);if(t){if(2===e.button)return e.preventDefault(),void P(t.rowIndex,t.value,"overwrite");c(!0),P(t.rowIndex,t.value,d)}},[E,P,d]),A=s.useCallback(e=>{if(!l){const t=E(e);return void(t&&f(()=>{const e=[...p];return e[t.rowIndex]=t.value,e}))}const t=E(e);t&&P(t.rowIndex,t.value,d)},[l,E,P,d,p]),_=s.useCallback(()=>{c(!1)},[]),I=s.useCallback(()=>{c(!1),f(null)},[]),D=s.useCallback(e=>{e.preventDefault()},[]),O=s.useCallback(()=>{p.forEach((e,a)=>{const s=n+a,o=g[v];if(!o)return;const i=o.channels[t]?.rows[s];if(!i)return;const l={};switch(r){case"volume":l.volume=e;break;case"effect":const t=i.effect||"000",n=t.length>=3?t.substring(1):"00";l.effect=x.format(e)+n;break;case"effectParam":const a=i.effect?.[0]||"0";l.effect=a+e.toString(16).toUpperCase().padStart(2,"0");break;case"note":l.note=e;break;case"instrument":l.instrument=e}b(t,s,l)}),e()},[p,n,g,v,t,r,x,b,e]),F=s.useCallback(e=>{const t=Array(w).fill(0).map((t,n)=>{const a=n/(w-1||1),s=x.max-x.min;switch(e){case"ramp_up":return Math.round(x.min+a*s);case"ramp_down":return Math.round(x.max-a*s);case"triangle":return Math.round(x.min+Math.abs(1-2*a)*s);case"random":return Math.round(x.min+Math.random()*s);case"sine":return Math.round(x.min+(Math.sin(a*Math.PI*2)+1)/2*s);default:return x.default}});h(t)},[w,x]),R=s.useCallback(()=>{if(p.length<2)return;const e=p[0],t=p[p.length-1],n=p.map((n,a)=>{const s=a/(p.length-1);return Math.round(e+(t-e)*s)});h(n)},[p]),j=s.useCallback(()=>{const e=g[v];if(!e)return;const s=e.channels[t];if(!s)return;const o=[];for(let t=n;t<=a;t++){const e=s.rows[t];let n=x.default;if(e)switch(r){case"volume":n=e.volume??x.default;break;case"effect":e.effect&&"..."!==e.effect&&(n=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(n=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(n=e.note);break;case"instrument":n=e.instrument??x.default}o.push(n)}h(o)},[g,v,t,n,a,r,x.default]);return wn.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:wn.jsxs("div",{ref:i,className:"bg-dark-bg border border-dark-border rounded-lg shadow-2xl max-w-[95vw] overflow-hidden",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-dark-bgSecondary border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsxs("h2",{className:"text-text-primary font-bold",children:[x.label," Editor"]}),wn.jsxs("span",{className:"text-xs text-text-secondary",children:["Channel ",t+1,", Rows ",n,"-",a]})]}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:e,children:wn.jsx(Ee,{size:18})})]}),wn.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-dark-bgSecondary/50 border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[wn.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Mode:"}),["overwrite","fill_blanks","add","scale"].map(e=>wn.jsx("button",{onClick:()=>u(e),className:"px-2 py-1 text-xs rounded "+(d===e?"bg-blue-600 text-white":"bg-dark-bg text-text-secondary hover:bg-dark-bgSecondary"),children:"fill_blanks"===e?"Fill Empty":e.charAt(0).toUpperCase()+e.slice(1)},e))]}),wn.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[wn.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Generate:"}),wn.jsx("button",{onClick:()=>F("ramp_up"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Up",children:""}),wn.jsx("button",{onClick:()=>F("ramp_down"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Down",children:""}),wn.jsx("button",{onClick:()=>F("triangle"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Triangle",children:""}),wn.jsx("button",{onClick:()=>F("sine"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Sine",children:""}),wn.jsx("button",{onClick:()=>F("random"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Random",children:"?"})]}),wn.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:R,title:"Interpolate between first and last",children:wn.jsx(Ve,{size:14})}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:j,title:"Reset to original",children:wn.jsx(gt,{size:14})})]})]}),wn.jsx("div",{className:"p-4 overflow-x-auto",children:wn.jsx("canvas",{ref:o,width:M,height:N,onMouseDown:T,onMouseMove:A,onMouseUp:_,onMouseLeave:I,onContextMenu:D,className:"cursor-crosshair border border-dark-border rounded",style:{minWidth:M}})}),wn.jsxs("div",{className:"px-4 py-2 text-xs text-text-secondary bg-dark-bgSecondary/30 border-t border-dark-border",children:[wn.jsx("span",{className:"font-medium",children:"Tips:"})," Click + drag to paint values. Right-click for single-row precision."]}),wn.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 bg-dark-bgSecondary border-t border-dark-border",children:[wn.jsx(Ob,{variant:"ghost",onClick:e,children:"Cancel"}),wn.jsxs(Ob,{variant:"primary",onClick:O,children:[wn.jsx(nt,{size:14,className:"mr-1"}),"Apply"]})]})]})})},dx=640,ux=1024;function px(){const[e,t]=s.useState(()=>"undefined"!=typeof window?window.innerWidth:1024);return s.useEffect(()=>{if("undefined"==typeof window)return;let e;t(window.innerWidth);const n=()=>{clearTimeout(e),e=setTimeout(()=>{t(window.innerWidth)},100)};return window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{clearTimeout(e),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),s.useMemo(()=>{const t=function(e){return e<dx?"mobile":e<ux?"tablet":"desktop"}(e);return{breakpoint:t,isMobile:"mobile"===t,isTablet:"tablet"===t,isDesktop:"desktop"===t,width:e}},[e])}const hx=s.createContext(null);function mx({children:e}){const t={...px(),isTouch:function(){const[e,t]=s.useState(!1);return s.useEffect(()=>{t("ontouchstart"in window||navigator.maxTouchPoints>0)},[]),e}()};return wn.jsx(hx.Provider,{value:t,children:e})}const fx=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114],yx=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],gx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function vx(e){if(e<=0||e>96)return"C4";const t=e+11,n=Math.floor(t/12)-1;return`${gx[t%12]}${n}`}function bx(e){for(let t=0;t<8;t++)for(let n=0;n<12;n++){const a=12*t+n;if(a<36&&fx[a]<=e)return`${yx[n].replace("-","")}${t+1}`}return"C4"}const xx=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];class wx{song=null;playing=!1;songPos=0;pattPos=0;currentTick=0;speed=6;bpm=125;globalVolume=64;pBreakPos=0;pBreakFlag=!1;posJumpFlag=!1;posJumpPos=0;patternDelay=0;channels=[];masterGain;stateQueue=[];lastDequeuedState=null;static MAX_STATE_QUEUE_SIZE=256;bufferCache=new Map;onRowChange=null;onSongEnd=null;onTickProcess=null;constructor(){this.masterGain=new p(1).toDestination()}loadSong(e){this.stop(),this.song=e,this.bufferCache.clear();for(const n of this.channels){for(const e of n.playerPool)try{e.dispose()}catch(t){}try{n.gainNode.dispose()}catch(t){}try{n.panNode.dispose()}catch(t){}}this.channels=[];for(let n=0;n<e.numChannels;n++)this.channels.push(this.createChannel(n,e.numChannels));this.songPos=0,this.pattPos=0,this.currentTick=0,this.speed=e.initialSpeed,this.bpm=e.initialBPM,this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0}createChannel(e,t){let n=0;n=4===t?0===e||3===e?-.7:.7:e%2==0?-.5:.5;const a=new de(n),s=new p(1);s.connect(a),a.connect(this.masterGain);const r=[];for(let o=0;o<2;o++){const e=new ie;e.connect(s),r.push(e)}return{note:0,period:0,volume:64,panning:128,sampleNum:0,sampleOffset:0,finetune:0,portaSpeed:0,portaTarget:0,tonePortaSpeed:0,vibratoPos:0,vibratoCmd:0,tremoloPos:0,tremoloCmd:0,waveControl:0,retrigCount:0,retrigVolSlide:0,patternLoopRow:0,patternLoopCount:0,globalVolSlide:0,panSlide:0,macroPos:0,macroReleased:!1,macroPitchOffset:0,macroArpNote:0,macroDuty:0,macroWaveform:0,previousSlideFlag:!1,gateHigh:!1,lastPlayedNoteName:null,xmNote:0,player:null,playerPool:r,activePlayerIdx:0,gainNode:s,panNode:a,instrument:null}}scheduleAheadTime=.1;schedulerInterval=.015;nextScheduleTime=0;startTime=0;totalTicksScheduled=0;lastGrooveTemplateId="straight";lastSwingAmount=100;lastGrooveSteps=2;schedulerTimerId=null;async play(){if(!this.song||this.playing)return;await ye();const e=Hm();await e.ensureWASMSynthsReady(this.song.instruments),this.playing=!0;const t=Ry.getState();this.lastGrooveTemplateId=t.grooveTemplateId,this.lastSwingAmount=t.swing,this.lastGrooveSteps=t.grooveSteps,this.startScheduler()}stop(){this.playing=!1,null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null);for(const e of this.channels)this.stopChannel(e);this.songPos=0,this.pattPos=0,this.currentTick=0,this.totalTicksScheduled=0,this.lastGrooveTemplateId="straight",this.lastSwingAmount=100,this.lastGrooveSteps=2,this.clearStateQueue()}pause(){null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1}resume(){this.song&&!this.playing&&(this.playing=!0,this.startScheduler())}startScheduler(){this.startTime=Q()+.02,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0;const e=()=>{if(!this.playing)return;const e=Q(),t=e+this.scheduleAheadTime,n=Ry.getState();(n.grooveTemplateId!==this.lastGrooveTemplateId||n.swing!==this.lastSwingAmount||n.grooveSteps!==this.lastGrooveSteps||Math.abs(n.bpm-this.bpm)>.1)&&(this.startTime=e+.01,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0,this.lastGrooveTemplateId=n.grooveTemplateId,this.lastSwingAmount=n.swing,this.lastGrooveSteps=n.grooveSteps,this.bpm=n.bpm,this.speed=n.speed);const a=2.5/this.bpm;for(;this.nextScheduleTime<t&&this.playing;)this.processTick(this.nextScheduleTime),this.totalTicksScheduled++,this.nextScheduleTime=this.startTime+this.totalTicksScheduled*a};e(),this.schedulerTimerId=setInterval(e,1e3*this.schedulerInterval)}calculateGrooveOffset(e,t,n){const a=Ba.find(e=>e.id===n.grooveTemplateId);if(a&&"straight"!==a.id){const s=n.swing/100,r=function(e,t,n){if(!e.values||0===e.values.length)return 0;const a=t%e.values.length;return e.values[a]/100*n}(a,e,t)*s;return r}{const a=(n.swing-100)/100,s=n.grooveSteps||2,r=e%s>=s/2;if(100!==n.swing&&r){return a*.3333*t}}return 0}processTick(e){if(!this.song||!this.playing)return;if(this.patternDelay>0)return void this.patternDelay--;const t=Ry.getState();t.bpm!==this.bpm&&(this.bpm=t.bpm);const n=2.5/this.bpm;let a=e;if(0===this.currentTick){const e=n*this.speed;a+=this.calculateGrooveOffset(this.pattPos,e,t)}if(t.jitter>0){const e=t.jitter/100*.01;a+=(2*Math.random()-1)*e}const s=this.song.songPositions[this.songPos],r=this.song.patterns[s];if(r){0===this.currentTick&&this.queueDisplayState(a,this.pattPos,s,this.songPos,0);for(let e=0;e<this.channels.length;e++){const t=this.channels[e],s=r.channels[e]?.rows[this.pattPos];s&&(0===this.currentTick?this.processRow(e,t,s,a):this.processEffectTick(e,t,s,a+this.currentTick*n),this.processMacros(t,a+this.currentTick*n))}this.onTickProcess&&this.onTickProcess(this.currentTick,this.pattPos),this.currentTick++,this.currentTick>=this.speed&&(this.currentTick=0,this.advanceRow())}}queueDisplayState(e,t,n,a,s){const r={time:e,row:t,pattern:n,position:a,tick:s};this.stateQueue.length>=wx.MAX_STATE_QUEUE_SIZE&&this.stateQueue.shift(),this.stateQueue.push(r)}getStateAtTime(e,t=!1){if(!this.playing)return this.lastDequeuedState;if(t){let t=this.lastDequeuedState;for(const n of this.stateQueue){if(!(n.time<=e))break;t=n}return t}let n=this.lastDequeuedState;for(;this.stateQueue.length>0;){if(!(this.stateQueue[0].time<=e))break;n=this.stateQueue.shift(),this.lastDequeuedState=n}return n}clearStateQueue(){this.stateQueue=[],this.lastDequeuedState=null}processRow(e,t,n,a){if(!this.song)return;const s=1===n.flag1||1===n.flag2,r=2===n.flag1||2===n.flag2,o=3===n.flag1||3===n.flag2,i=4===n.flag1||4===n.flag2;if(o){if(t.gainNode.gain.setValueAtTime(0,a),t.player){try{t.player.stop(a)}catch(v){}t.player=null}return}const l=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),c=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0),d=n.instrument??0;if(d>0){const e=this.song.instruments.find(e=>e.id===d);e&&(t.instrument=e,t.sampleNum=d,t.volume=64,t.finetune=e.metadata?.modPlayback?.finetune??0,t.gainNode.gain.setValueAtTime(t.volume/64,a))}const u=n.note,p=n.period,h=n.probability,m=void 0!==h&&h>0&&h<100&&100*Math.random()>=h,f=r||i;if(u&&0!==u&&97!==u&&!m){t.xmNote=u;const n=p||this.noteToPeriod(u,t.finetune);if(3===l||5===l)t.portaTarget=n,0!==c&&3===l&&(t.tonePortaSpeed=c);else{t.note=n,t.period=t.note;let r=0;9===l&&(r=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const o=t.previousSlideFlag&&null!==u&&!i,d="TB303"===t.instrument?.synthType||"Buzz3o3"===t.instrument?.synthType;if("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED&&d){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=u?u+11:0,n=Math.floor(t/12)-1;u&&e[t%12]}const p=d?vx(u):bx(n);o&&null!==t.lastPlayedNoteName&&t.lastPlayedNoteName;t.lastPlayedNoteName=p,this.triggerNote(t,a,r,e,s,o,f,i),4&t.waveControl||(t.vibratoPos=0),64&t.waveControl||(t.tremoloPos=0)}}if(u&&97!==u&&(t.previousSlideFlag=(r||i)??!1),97===u){t.previousSlideFlag=!1;"TB303"===t.instrument?.synthType||t.instrument;"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,this.releaseMacros(t),this.stopChannel(t),t.lastPlayedNoteName=null}void 0!==n.volume&&n.volume>=16&&n.volume<=80&&(t.volume=n.volume-16,t.gainNode.gain.setValueAtTime(t.volume/64,a)),this.processEffect0(e,t,l,c,a);const y=n.effTyp2??0,g=n.eff2??0;0===y&&0===g||this.processEffect0(e,t,y,g,a)}processEffect0(e,t,n,a,s){const r=a>>4&15,o=15&a;if(t.instrument?.synthType?.startsWith("Furnace")){const s=Hm();11===n||13===n||15===n||(14===n?s.applyFurnaceExtendedEffect(t.instrument.id,r,o,e):s.applyFurnaceEffect(t.instrument.id,n,a,e))}switch(n){case 0:case 5:case 6:case 10:break;case 1:case 2:0!==a&&(t.portaSpeed=a);break;case 3:0!==a&&(t.tonePortaSpeed=a);break;case 4:0!==r&&(t.vibratoCmd=15&t.vibratoCmd|r<<4),0!==o&&(t.vibratoCmd=240&t.vibratoCmd|o);break;case 7:0!==r&&(t.tremoloCmd=15&t.tremoloCmd|r<<4),0!==o&&(t.tremoloCmd=240&t.tremoloCmd|o);break;case 8:t.panning=a,t.panNode.pan.setValueAtTime((a-128)/128,s);break;case 9:0!==a&&(t.sampleOffset=a);break;case 11:this.posJumpPos=a,this.posJumpFlag=!0,this.pBreakFlag=!0;break;case 12:t.volume=Math.min(64,a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 13:this.pBreakPos=10*r+o,this.pBreakPos>63&&(this.pBreakPos=0),this.pBreakFlag=!0;break;case 14:this.processExtendedEffect0(e,t,r,o,s);break;case 15:0===a||(a<32?this.speed!==a&&(this.speed=a,Ry.getState().setSpeed(a)):this.bpm!==a&&(this.bpm=a,Ry.getState().setBPM(a)));break;case 16:this.globalVolume=Math.min(64,a),this.updateAllChannelVolumes(s);break;case 17:0!==a&&(t.globalVolSlide=a);break;case 25:0!==a&&(t.panSlide=a);break;case 27:t.retrigCount=15&a,t.retrigVolSlide=a>>4&15}}processExtendedEffect0(e,t,n,a,s){switch(n){case 1:t.period=Math.max(113,t.period-a),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+a),this.updatePeriod(t);break;case 4:t.waveControl=240&t.waveControl|15&a;break;case 5:t.finetune=a>7?a-16:a;break;case 6:0===a?t.patternLoopRow=this.pattPos:(0===t.patternLoopCount?t.patternLoopCount=a:t.patternLoopCount--,0!==t.patternLoopCount&&(this.pBreakPos=t.patternLoopRow,this.pBreakFlag=!0));break;case 7:t.waveControl=15&t.waveControl|(15&a)<<4;break;case 9:t.retrigCount=a;break;case 10:t.volume=Math.min(64,t.volume+a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 11:t.volume=Math.max(0,t.volume-a),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 14:this.patternDelay=a*this.speed}}processEffectTick(e,t,n,a){const s=1===n.flag1||1===n.flag2,r=2===n.flag1||2===n.flag2,o=3===n.flag1||3===n.flag2;if(4===n.flag1||n.flag2,o)return;const i=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),l=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0),c=l>>4&15,d=15&l,u=n.effTyp2??0,p=n.eff2??0;switch(0===u&&0===p||this.processEffectTickSingle(e,t,n,u,p,a),t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,i,l,c,d),i){case 0:0!==l&&this.doArpeggio(t,l);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,l,a);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,l,a);break;case 7:this.doTremolo(t,a);break;case 10:this.doVolumeSlide(t,l,a);break;case 14:if(9===c&&d>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=d,this.triggerNote(t,a,0,e,s,!1,!1));else if(12===c&&d===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,a);else if(13===c&&d===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,a,0,e,s,n,r)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,a);break;case 25:this.doPanSlide(t,t.panSlide,a);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&l,this.applyRetrigVolSlide(t,t.retrigVolSlide,a),this.triggerNote(t,a,0,e,s,!1,!1)))}}processEffectTickSingle(e,t,n,a,s,r){const o=1===n.flag1||1===n.flag2,i=2===n.flag1||2===n.flag2,l=s>>4&15,c=15&s;switch(t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,a,s,l,c),a){case 0:0!==s&&this.doArpeggio(t,s);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,s,r);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,s,r);break;case 7:this.doTremolo(t,r);break;case 10:this.doVolumeSlide(t,s,r);break;case 14:if(9===l&&c>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=c,this.triggerNote(t,r,0,e,o,!1,!1));else if(12===l&&c===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,r);else if(13===l&&c===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,r,0,e,o,n,i)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,r);break;case 25:this.doPanSlide(t,t.panSlide,r);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&s,this.applyRetrigVolSlide(t,t.retrigVolSlide,r),this.triggerNote(t,r,0,e,o,!1,!1)))}}forwardEffectToFurnace(e,t,n,a,s,r){if(11===n||13===n||15===n||0===n&&0===a)return;const o=Hm();14===n?o.applyFurnaceExtendedEffect(e.instrument.id,s,r,t):o.applyFurnaceEffect(e.instrument.id,n,a,t)}doArpeggio(e,t){const n=t>>4&15,a=15&t,s=this.currentTick%3;let r=e.note;1===s?r=this.periodPlusSemitones(e.note,n,e.finetune):2===s&&(r=this.periodPlusSemitones(e.note,a,e.finetune)),this.updatePeriodDirect(e,r)}doTonePortamento(e){0!==e.portaTarget&&e.period!==e.portaTarget&&(e.period<e.portaTarget?(e.period+=e.tonePortaSpeed,e.period>e.portaTarget&&(e.period=e.portaTarget)):(e.period-=e.tonePortaSpeed,e.period<e.portaTarget&&(e.period=e.portaTarget)),this.updatePeriod(e))}doVibrato(e){const t=e.vibratoCmd>>4&15,n=15&e.vibratoCmd,a=3&e.waveControl;let s;0===a?s=xx[31&e.vibratoPos]:1===a?(s=8*(31&e.vibratoPos),e.vibratoPos>=32&&(s=255-s)):s=255;let r=s*n>>7;e.vibratoPos>=32&&(r=-r),this.updatePeriodDirect(e,e.period+r),e.vibratoPos=e.vibratoPos+t&63}doTremolo(e,t){const n=e.tremoloCmd>>4&15,a=15&e.tremoloCmd,s=e.waveControl>>4&3;let r;0===s?r=xx[31&e.tremoloPos]:1===s?(r=8*(31&e.tremoloPos),e.tremoloPos>=32&&(r=255-r)):r=255;let o=r*a>>6;e.tremoloPos>=32&&(o=-o);const i=Math.max(0,Math.min(64,e.volume+o));e.gainNode.gain.setValueAtTime(i/64,t),e.tremoloPos=e.tremoloPos+n&63}doVolumeSlide(e,t,n){const a=t>>4&15,s=15&t;a>0?e.volume=Math.min(64,e.volume+a):s>0&&(e.volume=Math.max(0,e.volume-s)),e.gainNode.gain.setValueAtTime(e.volume/64,n)}doGlobalVolumeSlide(e,t){const n=e>>4&15,a=15&e;n>0?this.globalVolume=Math.min(64,this.globalVolume+n):a>0&&(this.globalVolume=Math.max(0,this.globalVolume-a)),this.updateAllChannelVolumes(t)}doPanSlide(e,t,n){const a=t>>4&15,s=15&t;a>0?e.panning=Math.min(255,e.panning+a):s>0&&(e.panning=Math.max(0,e.panning-s)),e.panNode.pan.setValueAtTime((e.panning-128)/128,n)}applyRetrigVolSlide(e,t,n){switch(t){case 0:case 8:break;case 1:e.volume=Math.max(0,e.volume-1);break;case 2:e.volume=Math.max(0,e.volume-2);break;case 3:e.volume=Math.max(0,e.volume-4);break;case 4:e.volume=Math.max(0,e.volume-8);break;case 5:e.volume=Math.max(0,e.volume-16);break;case 6:e.volume=Math.floor(2*e.volume/3);break;case 7:e.volume=Math.floor(e.volume/2);break;case 9:e.volume=Math.min(64,e.volume+1);break;case 10:e.volume=Math.min(64,e.volume+2);break;case 11:e.volume=Math.min(64,e.volume+4);break;case 12:e.volume=Math.min(64,e.volume+8);break;case 13:e.volume=Math.min(64,e.volume+16);break;case 14:e.volume=Math.min(64,Math.floor(3*e.volume/2));break;case 15:e.volume=Math.min(64,2*e.volume)}e.gainNode.gain.setValueAtTime(e.volume/64,n)}processMacros(e,t){if(!e.instrument?.furnace?.macros)return;const n=e.instrument.furnace.macros;if(0!==n.length){for(const a of n){if(!a.data||0===a.data.length)continue;let n=e.macroPos;const s=a.speed||1;if(this.currentTick%s!==0)continue;e.macroReleased&&a.release>=0&&n<a.release&&(n=a.release),n>=a.data.length&&(n=a.loop>=0&&a.loop<a.data.length?e.macroReleased&&a.release>=0&&a.loop<a.release?a.data.length-1:a.loop:a.data.length-1);const r=a.data[n]??0;this.applyMacroValue(e,a.type,r,t)}e.macroPos++}}applyMacroValue(e,t,n,a){switch(t){case wa.VOL:e.volume=Math.round(n/15*64),e.gainNode.gain.setValueAtTime(e.volume/64*(this.globalVolume/64),a);break;case wa.ARP:if(e.macroArpNote=n>127?n-256:n,e.period>0){const t=Math.pow(2,e.macroArpNote/12),n=Math.round(e.note/t);this.updatePeriodDirect(e,n)}break;case wa.DUTY:e.macroDuty=n;break;case wa.WAVE:e.macroWaveform=n;break;case wa.PITCH:if(e.macroPitchOffset=n>127?n-256:n,e.period>0){const t=e.macroPitchOffset/64,n=Math.round(e.period*(1-.01*t));this.updatePeriodDirect(e,Math.max(113,Math.min(856,n)))}break;case wa.EX1:case wa.EX2:case wa.EX3:case wa.EX4:case wa.EX5:case wa.EX6:case wa.EX7:case wa.EX8:case wa.ALG:case wa.FB:case wa.FMS:case wa.AMS:break;case wa.PAN_L:e.panning=Math.max(0,128-8*n),e.panNode.pan.setValueAtTime((e.panning-128)/128,a);break;case wa.PAN_R:e.panning=Math.min(255,128+8*n),e.panNode.pan.setValueAtTime((e.panning-128)/128,a)}}releaseMacros(e){e.macroReleased=!0}triggerNote(e,t,n,a,s,r,o,i){if(void 0!==a){if(Hm().isChannelMuted(a))return}const l=t??Q();if(e.player)try{e.player.stop(l)}catch(E){}if(e.macroPos=0,e.macroReleased=!1,e.macroPitchOffset=0,e.macroArpNote=0,!e.instrument){if(!(this.song&&this.song.instruments.length>0))return;e.instrument=this.song.instruments[0],e.sampleNum=this.song.instruments[0].id,e.volume=64,e.finetune=e.instrument.metadata?.modPlayback?.finetune??0}const c=Hm(),d=e.instrument.synthType&&"Sampler"!==e.instrument.synthType&&e.xmNote>0&&e.xmNote<97?vx(e.xmNote):bx(e.period),u=Ry.getState(),p=u.grooveTemplateId,h=Ba.find(e=>e.id===p),m=u.swing/100;let f=0;h&&(f=function(e,t){if(!e.velocityOffsets||0===e.velocityOffsets.length)return 0;const n=t%e.velocityOffsets.length;return e.velocityOffsets[n]}(h,this.pattPos)*m);const y=Math.max(0,Math.min(1,e.volume/64+f));if(100!==u.swing&&this.pattPos,void 0!==a&&Se.schedule(()=>{c.triggerChannelMeter(a,y)},l),e.instrument.synthType&&"Sampler"!==e.instrument.synthType){const t=2.5/this.bpm*this.speed,n=("TB303"===e.instrument.synthType||"Buzz3o3"===e.instrument.synthType)&&!o?.8*t:1.05*t;return void c.triggerNote(e.instrument.id,d,n,l,y,e.instrument,s,r,void 0,e.period,void 0,0,i)}const g=c.getDecodedBuffer(e.instrument.id);if(!g)return;const v=e.instrument.sample;if(!e.period||e.period<=0)return;const b=e.finetune,x=Math.pow(2,b/96),w=428/e.period*x;let k=this.bufferCache.get(e.instrument.id);k||(k=new xe(g),this.bufferCache.set(e.instrument.id,k));const S=(e.activePlayerIdx+1)%e.playerPool.length,M=e.playerPool[S];if(e.activePlayerIdx=S,"started"===M.state)try{M.stop(l)}catch(E){}M.buffer=k;const N=v?.sampleRate||8363,C=g.duration;v?.loop&&(v.loopEnd??0)>(v.loopStart??0)?(M.loop=!0,M.loopStart=Math.min((v.loopStart??0)/N,C-1e-4),M.loopEnd=Math.min((v.loopEnd??0)/N,C),M.loopEnd<=M.loopStart&&(M.loopEnd=C)):M.loop=!1,M.playbackRate=w,e.player=M;try{const e=n>0?n/N:0;M.start(l,Math.min(e,C-1e-4))}catch(E){}}stopChannel(e){for(const n of e.playerPool)try{"started"===n.state&&n.stop()}catch(t){}e.player=null,e.lastPlayedNoteName=null}updatePeriod(e){this.updatePeriodDirect(e,e.period)}updatePeriodDirect(e,t){if(!e.player||0===t)return;const n=e.instrument?.sample?.sampleRate||8363,a=3546895/t;e.player.playbackRate=a/n}updateAllChannelVolumes(e){const t=this.globalVolume/64;for(const n of this.channels){const a=n.volume/64*t;n.gainNode.gain.setValueAtTime(a,e)}}noteToPeriod(e,t){if("number"==typeof e&&e>0){if(e>=113&&e<=856)return e;if(e<97){let n=e-1,a=0;for(;n<12;)n+=12,a--;for(;n>47;)n-=12,a++;if(n-=12,n>=0&&n<36){let e=this.getPeriod(n,t);return a>0?e=Math.round(e/Math.pow(2,a)):a<0&&(e=Math.round(e*Math.pow(2,-a))),e}}}else if("string"==typeof e)return this.noteStringToPeriod(e,t);return 0}noteStringToPeriod(e,t){const n=e.match(/^([A-G][#]?)-?(\d)$/);if(!n)return 0;const a={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11}[n[1]]??0,s=12*(parseInt(n[2],10)-1)+a;return s<0||s>=36?0:this.getPeriod(s,t)}getPeriod(e,t){return fx[36*(t>=0?t:t+16)+Math.min(35,Math.max(0,e))]}periodPlusSemitones(e,t,n){const a=36*(n>=0?n:n+16);let s=0;for(let o=0;o<36;o++)if(fx[a+o]<=e){s=o;break}const r=Math.min(35,Math.max(0,s+t));return fx[a+r]}advanceRow(){if(!this.song)return;this.pBreakFlag?(this.pattPos=this.pBreakPos,this.pBreakFlag=!1,this.pBreakPos=0,this.posJumpFlag||this.songPos++):this.pattPos++,this.posJumpFlag&&(this.songPos=this.posJumpPos,this.posJumpFlag=!1);const e=this.song.songPositions[this.songPos],t=this.song.patterns[e],n=t?.length??64;if(this.pattPos>=n&&(this.pattPos=0,this.songPos++),this.songPos>=this.song.songLength&&(this.songPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0,this.onSongEnd?.()),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}}isPlaying(){return this.playing}getBPM(){return this.bpm}getSpeed(){return this.speed}getCurrentRow(){return this.pattPos}getCurrentPosition(){return this.songPos}getCurrentTick(){return this.currentTick}dispose(){this.stop();for(const t of this.channels){for(const n of t.playerPool)try{n.dispose()}catch(e){}t.gainNode.dispose(),t.panNode.dispose()}this.bufferCache.clear(),this.masterGain.dispose(),this.channels=[],this.song=null}}let kx=null;function Sx(){return kx||(kx=new wx),kx}const Mx=24,Nx=10,Cx=40,Ex=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Px(e){if(0===e)return"---";if(97===e)return"OFF";const t=(e-1)%12,n=Math.floor((e-1)/12);return`${Ex[t]}${n}`}function Tx(e){return e.toString(16).toUpperCase().padStart(2,"0")}const Ax=e.memo(({onAcidGenerator:t})=>{const{isMobile:n}=s.useContext(hx)||{breakpoint:"desktop",isMobile:!1,isTablet:!1,isDesktop:!0,width:1024,isTouch:!1},a=s.useRef(null),r=s.useRef(null),o=s.useRef(null),[i,l]=s.useState({width:800,height:600}),[c,d]=s.useState(0),[u,p]=s.useState(0),[h,m]=s.useState(0),[f,y]=s.useState(0),g=s.useRef([]),v=s.useRef({}),b=s.useRef({}),x=s.useRef({}),w=s.useRef(null),{pattern:k,patterns:S,currentPatternIndex:M,addChannel:N,removeChannel:C,toggleChannelMute:E,toggleChannelSolo:P,setChannelColor:T,setCell:A,moveCursorToChannel:_,copyTrack:I,cutTrack:D,pasteTrack:O,mobileChannelIndex:F,cursor:R,selection:j,showGhostPatterns:L}=tf(Fn(e=>({pattern:e.patterns[e.currentPatternIndex],patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,addChannel:e.addChannel,removeChannel:e.removeChannel,toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,setChannelColor:e.setChannelColor,setCell:e.setCell,moveCursorToChannel:e.moveCursorToChannel,copyTrack:e.copyTrack,cutTrack:e.cutTrack,pasteTrack:e.pasteTrack,mobileChannelIndex:e.cursor.channelIndex,cursor:e.cursor,selection:e.selection,showGhostPatterns:e.showGhostPatterns}))),{instruments:B}=Py(Fn(e=>({instruments:e.instruments}))),V=s.useRef(null),z=s.useRef(-1),U=s.useRef(0),G=Zy(e=>e.currentThemeId),W=s.useRef(G),K="cyan-lineart"===G,H=(()=>{const[t,n]=e.useState({position:null,rowIndex:0,channelIndex:0}),a=s.useCallback((e,t,a)=>{e.preventDefault(),e.stopPropagation(),n({position:{x:e.clientX,y:e.clientY},rowIndex:t,channelIndex:a})},[]),r=s.useCallback(()=>{n(e=>({...e,position:null}))},[]),o=s.useCallback(e=>{e.preventDefault()},[]);return{...t,openMenu:a,closeMenu:r,isOpen:null!==t.position,handleContextMenu:o,cellInfo:t.position?{rowIndex:t.rowIndex,channelIndex:t.channelIndex}:null}})(),[$,q]=s.useState(null),Y=s.useCallback(e=>{if(!k)return;const t=H.cellInfo?.channelIndex??R.channelIndex,n=j?.startRow??R.rowIndex,a=j?.endRow??Math.min(R.rowIndex+15,k.length-1);q({isOpen:!0,field:e,channelIndex:t,startRow:n,endRow:a}),H.closeMenu()},[H,R,j,k]);s.useEffect(()=>{W.current!==G&&(v.current={},b.current={},x.current={},W.current=G)},[G]);const X=s.useMemo(()=>({bg:"#0a0a0b",rowNormal:"#0d0d0e",rowHighlight:"#111113",centerLine:K?"rgba(0, 255, 255, 0.25)":"rgba(239, 68, 68, 0.25)",cursor:K?"#00ffff":"#ef4444",cursorBg:K?"rgba(0, 255, 255, 0.2)":"rgba(239, 68, 68, 0.2)",text:"#e0e0e0",textMuted:"#505050",textNote:"#909090",textNoteActive:"#ffffff",textInstrument:"#4ade80",textVolume:"#60a5fa",textEffect:"#f97316",border:"#252530",lineNumber:"#707070",lineNumberHighlight:"#f97316"}),[K]),Z=s.useCallback(()=>{if(!k||!n)return;const e=Math.min(k.channels.length-1,F+1);e!==F&&_(e)},[k,n,F,_]),J=s.useCallback(()=>{if(!k||!n)return;const e=Math.max(0,F-1);e!==F&&_(e)},[k,n,F,_]),ee=function({threshold:e=50,onSwipeLeft:t,onSwipeRight:n}){const a=s.useRef(null);return{onTouchStart:s.useCallback(e=>{const t=e.touches[0];a.current={startX:t.clientX,startY:t.clientY,startTime:Date.now()}},[]),onTouchEnd:s.useCallback(s=>{if(!a.current)return;const r=s.changedTouches[0],o=r.clientX-a.current.startX,i=r.clientY-a.current.startY,l=Date.now()-a.current.startTime;Math.abs(o)>e&&Math.abs(o)>1.5*Math.abs(i)&&l<500&&(o>0&&n?n():o<0&&t&&t()),a.current=null},[e,t,n]),onTouchCancel:s.useCallback(()=>{a.current=null},[])}}({threshold:50,onSwipeLeft:Z,onSwipeRight:J}),te=s.useCallback((e,t)=>{if(!k)return;const n=sx[t];if(!n)return;const a=k.channels[e].instrumentId??1;n.generate({patternLength:k.length,instrumentId:a,note:49,velocity:64}).forEach((t,n)=>{A(e,n,t)})},[k,A]),ne=s.useCallback(e=>{if(k){for(let t=0;t<k.length;t++)A(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0});Ay.getState().setStatusMessage("CHANNEL CLEARED")}},[k,A]),ae=s.useCallback(e=>{I(e)},[I]),se=s.useCallback(e=>{D(e)},[D]),re=s.useCallback(e=>{O(e)},[O]),oe=s.useCallback((e,t)=>{if(k){for(let n=0;n<k.length;n++){const a=k.channels[e].rows[n];if(a.note&&0!==a.note&&97!==a.note){let s=a.note+t;s=Math.max(1,Math.min(96,s)),A(e,n,{...a,note:s})}}Ay.getState().setStatusMessage(`TRANSPOSE ${t>0?"+":""}${t}`)}},[k,A]),ie=s.useCallback(e=>{if(k){for(let t=0;t<k.length;t++){const n=k.channels[e].rows[t];if(null!==n.volume&&n.volume>=16){const a=Math.floor(8*Math.random())-4,s=Math.max(16,Math.min(80,n.volume+a));A(e,t,{...n,volume:s})}}Ay.getState().setStatusMessage("HUMANIZED")}},[k,A]),le=s.useCallback(e=>{if(!k)return;const t=k.channels[e];if(!t)return;let n=-1,a=-1,s=0,r=0;for(let i=0;i<k.length;i++){const e=t.rows[i];null!==e.volume&&e.volume>=16&&e.volume<=80&&(-1===n&&(n=i,s=e.volume),a=i,r=e.volume)}if(-1===n||-1===a||a-n<2)return;const o=a-n;for(let i=n+1;i<a;i++){const a=(i-n)/o,l=Math.round(s+(r-s)*a),c=t.rows[i];A(e,i,{...c,volume:l})}Ay.getState().setStatusMessage("INTERPOLATED")},[k,A]);s.useEffect(()=>{k&&(g.current=k.channels.map(()=>({level:0,triggered:!1})))},[k?.channels.length]);const ce=s.useCallback((e,t=!1)=>{const n=`${e}-${t?"a":"n"}`;if(v.current[n])return v.current[n];const a=document.createElement("canvas");a.width=34,a.height=Mx;const s=a.getContext("2d");return s.font='14px "JetBrains Mono", "Fira Code", monospace',s.textBaseline="middle",s.fillStyle=0===e?X.textMuted:97===e?X.textEffect:t?X.textNoteActive:X.textNote,s.fillText(Px(e),0,12),v.current[n]=a,a},[X.textMuted,X.textEffect,X.textNote,X.textNoteActive]),de=s.useCallback((e,t,n,a,s,r,o,i,l,c)=>{const d=`${e}-${t}-${n}-${a}-${s}-${r}-f1${o??"x"}-f2${i??"x"}-p${l??"x"}-${c?"B":""}`;if(b.current[d])return b.current[d];const u=void 0!==o||void 0!==i,p=void 0!==l&&l>0,h=document.createElement("canvas");h.width=116+(u?28:0)+(p?24:0),h.height=Mx;const m=h.getContext("2d");m.font='14px "JetBrains Mono", "Fira Code", monospace',m.textBaseline="middle";let f=0;const y=12;0!==e?(m.fillStyle=X.textInstrument,m.fillText(Tx(e),f,y)):c||(m.fillStyle=X.textMuted,m.fillText("..",f,y)),f+=24;t>=16&&t<=80?(m.fillStyle=X.textVolume,m.fillText(Tx(t),f,y)):c||(m.fillStyle=X.textMuted,m.fillText("..",f,y)),f+=24;0!==n||0!==a?(m.fillStyle=X.textEffect,m.fillText(n.toString(16).toUpperCase()+Tx(a),f,y)):c||(m.fillStyle=X.textMuted,m.fillText("...",f,y)),f+=34;if(0!==s||0!==r?(m.fillStyle=X.textEffect,m.fillText(s.toString(16).toUpperCase()+Tx(r),f,y)):c||(m.fillStyle=X.textMuted,m.fillText("...",f,y)),f+=34,u&&(1===o?(m.fillStyle="#f59e0b",m.fillText("A",f,y)):2===o?(m.fillStyle="#06b6d4",m.fillText("S",f,y)):3===o?(m.fillStyle="#facc15",m.fillText("M",f,y)):4===o?(m.fillStyle="#22d3ee",m.fillText("H",f,y)):c||(m.fillStyle=X.textMuted,m.fillText(".",f,y)),f+=14,1===i?(m.fillStyle="#f59e0b",m.fillText("A",f,y)):2===i?(m.fillStyle="#06b6d4",m.fillText("S",f,y)):3===i?(m.fillStyle="#facc15",m.fillText("M",f,y)):4===i?(m.fillStyle="#22d3ee",m.fillText("H",f,y)):c||(m.fillStyle=X.textMuted,m.fillText(".",f,y)),f+=14),p){const e=Math.min(99,Math.max(0,l)),t=e>=75?"#4ade80":e>=50?"#facc15":e>=25?"#fb923c":"#f87171";m.fillStyle=t,m.fillText(e.toString(10).padStart(2,"0"),f,y)}return b.current[d]=h,h},[X.textMuted,X.textInstrument,X.textVolume,X.textEffect]),ue=s.useCallback((e,t)=>{const n=e%4==0,a=`${e}-${t}-${n}`;if(x.current[a])return x.current[a];const s=document.createElement("canvas");s.width=Cx,s.height=Mx;const r=s.getContext("2d");r.font=n?'bold 12px "JetBrains Mono", monospace':'12px "JetBrains Mono", monospace',r.textBaseline="middle",r.textAlign="center",r.fillStyle=n?X.lineNumberHighlight:X.lineNumber;const o=t?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return r.fillText(o,20,12),x.current[a]=s,s},[X.lineNumber,X.lineNumberHighlight]),pe=s.useCallback(()=>{const e=a.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const n=tf.getState(),s=Ry.getState(),r=Ay.getState(),o=n.patterns[n.currentPatternIndex],l=s.smoothScrolling,d=n.showGhostPatterns;if(!o)return t.fillStyle=X.bg,t.fillRect(0,0,i.width,i.height),t.fillStyle=X.textMuted,t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",void t.fillText("No pattern loaded",i.width/2,i.height/2);const f=n.cursor,g=s.isPlaying,v=r.useHexNumbers,b=r.blankEmptyCells,x=s.speed,w=s.bpm,{width:k,height:N}=i,C=o.length;let E,P=0;if(g){const e=Sx(),t=Q()+.01,n=e.getStateAtTime(t);if(n){if(V.current=n,E=n.row,l){const a=e.getStateAtTime(t+.5,!0);let s;s=a&&a.row!==n.row?a.time-n.time:2.5/w*x;const r=t-n.time;P=Math.min(Math.max(r/s,0),1)*Mx}else P=0;z.current=E,U.current=P}else E=s.currentRow}else E=f.rowIndex,V.current=null,z.current=-1,U.current=0;const T=Math.ceil(N/Mx)+2,A=Math.floor(T/2),_=E-A,I=_+T,D=Math.floor(N/2)-12,O=D-A*Mx-P,F=o.channels.length;(Math.abs(O-u)>.5||_!==h)&&(p(O),m(_),y(e=>e+1));let R=!1,j=!1;for(const a of o.channels){if(R&&j)break;if(!R&&null!==a.instrumentId){const e=B.find(e=>e.id===a.instrumentId);"TB303"!==e?.synthType&&"Buzz3o3"!==e?.synthType||(R=!0)}const e=a.rows[0];e&&(void 0===e.flag1&&void 0===e.flag2||(R=!0),void 0!==e.probability&&(j=!0))}const L=34+(116+(R?28:0)+(j?24:0)+20+4)+20;t.fillStyle=X.bg,t.fillRect(0,0,k,N);for(let a=h;a<I;a++){let e,n=!1,s=null;if(g)if(d&&a<0)if(M>0){if(s=S[M-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else{if(!(S.length>1))continue;if(s=S[S.length-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else if(d&&a>=C)if(M<S.length-1){if(s=S[M+1],e=a-C,e<0||e>=s.length)continue;n=!0}else{if(!(S.length>1))continue;if(s=S[0],e=a-C,e<0||e>=s.length)continue;n=!0}else{if(a<0||a>=C)continue;e=a}else if(d&&a<0)if(M>0){if(s=S[M-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else{if(!(S.length>1))continue;if(s=S[S.length-1],e=s.length+a,e<0||e>=s.length)continue;n=!0}else if(d&&a>=C)if(M<S.length-1){if(s=S[M+1],e=a-C,e<0||e>=s.length)continue;n=!0}else{if(!(S.length>1))continue;if(s=S[0],e=a-C,e<0||e>=s.length)continue;n=!0}else{if(a<0||a>=C)continue;e=a}const r=O+(a-_)*Mx;if(r<-24||r>N+Mx)continue;const i=e%4==0;n&&(t.globalAlpha=.35),t.fillStyle=i?X.rowHighlight:X.rowNormal,t.fillRect(0,r,k,Mx),n&&(t.globalAlpha=1);const l=ue(e,v);t.drawImage(l,4,r),n&&(t.globalAlpha=.35);const u=s||o;for(let a=0;a<F;a++){const s=Cx+a*L+8-c;if(s+L<0||s>k)continue;if(!u.channels[a]){t.fillStyle=X.border,t.fillRect(Cx+(a+1)*L-c,r,1,Mx);continue}const o=u.channels[a].rows[e];if(!o)continue;if(!o)continue;const i=g&&!n&&e===E,l=o.note||0;if(!b||0!==l){const e=ce(l,i&&l>0);t.drawImage(e,s,r)}const d=de(o.instrument||0,o.volume||0,o.effTyp||0,o.eff||0,o.effTyp2||0,o.eff2||0,o.flag1,o.flag2,o.probability,b);t.drawImage(d,s+34+4,r),t.fillStyle=X.border,t.fillRect(Cx+(a+1)*L-c,r,1,Mx)}n&&(t.globalAlpha=1)}t.fillStyle=X.centerLine,t.fillRect(0,D,k,Mx);{const e=Cx+f.channelIndex*L+8-c;let a=0,r=Nx;const i=38,l=0,d=24,u=48,p=82,h=116,m=h+(R?28:0);switch(f.columnType){case"note":r=34;break;case"instrument":a=i+l+f.digitIndex*Nx;break;case"volume":a=i+d+f.digitIndex*Nx;break;case"effTyp":default:a=i+u;break;case"effParam":a=i+u+Nx+f.digitIndex*Nx;break;case"effTyp2":a=i+p;break;case"effParam2":a=i+p+Nx+f.digitIndex*Nx;break;case"flag1":a=i+h;break;case"flag2":a=i+h+Nx+4;break;case"probability":a=i+m+f.digitIndex*Nx}const y=n.recordMode,v=s.isPlaying;let b;b=y?"#ef4444":v?"#22c55e":K?"#00ffff":"#3b82f6";const x=Mx,w=D,k=e+a,S=r;t.clearRect(k,w,S,x),t.fillStyle=b,t.fillRect(k,w,S,x);const M=g?E:f.rowIndex,N=o.channels[f.channelIndex]?.rows[M];if(N){let e="";const n=f.columnType,a=f.digitIndex;if("note"===n)e=Px(N.note??0);else if("instrument"===n){const t=Tx(N.instrument??0);e=0===(N.instrument??0)?"..":t,e=e[a]??"."}else if("volume"===n){const t=N.volume??0;e=(t>=16&&t<=80?Tx(t):"..")[a]??"."}else if("effTyp"===n){const t=N.effTyp??0,n=N.eff??0;e=0!==t||0!==n?t.toString(16).toUpperCase():"."}else if("effParam"===n){const t=N.effTyp??0,n=N.eff??0;e=(0!==t||0!==n?Tx(n):"..")[a]??"."}else if("effTyp2"===n){const t=N.effTyp2??0,n=N.eff2??0;e=0!==t||0!==n?t.toString(16).toUpperCase():"."}else if("effParam2"===n){const t=N.effTyp2??0,n=N.eff2??0;e=(0!==t||0!==n?Tx(n):"..")[a]??"."}else if("flag1"===n)e=1===N.flag1?"A":2===N.flag1?"S":".";else if("flag2"===n)e=1===N.flag2?"A":2===N.flag2?"S":".";else if("probability"===n){const t=N.probability??0;e=(t>0?t.toString(10).padStart(2,"0"):"..")[a]??"."}t.font='14px "JetBrains Mono", "Fira Code", monospace',t.textBaseline="middle",t.fillStyle="#ffffff",t.fillText(e,k,w+x/2)}}},[i,X,ce,de,ue,c,K]),he=s.useCallback(()=>{pe(),w.current=requestAnimationFrame(he)},[pe]);s.useEffect(()=>(w.current=requestAnimationFrame(he),()=>{w.current&&cancelAnimationFrame(w.current)}),[he]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:n}=t.contentRect;e>0&&n>0&&l({width:e,height:n})}});t.observe(e);const n=e.getBoundingClientRect();return n.width>0&&n.height>0&&l({width:n.width,height:n.height}),()=>t.disconnect()},[]),s.useEffect(()=>{const e=a.current;e&&(e.width=i.width,e.height=i.height,v.current={},b.current={},x.current={})},[i]),s.useEffect(()=>{const e=r.current;if(!e)return;const t=e=>{e.preventDefault();if(!Ry.getState().isPlaying)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){const t=2*Math.sign(e.deltaY),n=tf.getState(),a=n.patterns[n.currentPatternIndex];if(!a)return;const s=n.cursor.rowIndex,r=Math.min(a.length+32,s+t);tf.getState().moveCursorToRow(r)}else d(t=>Math.max(0,t+e.deltaX))};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]);const me=s.useCallback(e=>{d(e.currentTarget.scrollLeft)},[]),fe=k?.channels[0]?.rows[0],ye=34+(116+(void 0!==fe?.flag1||void 0!==fe?.flag2?28:0)+(void 0!==fe?.probability?24:0)+20+4)+20+20,ge=k?k.channels.length*ye:0;if(!k)return wn.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const ve=k.channels[F],be=g.current[F]||{level:0,triggered:!1};return wn.jsxs("div",{className:"flex flex-col h-full",...n?ee:{},children:[n&&wn.jsxs("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border relative",children:[wn.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[wn.jsx("button",{onClick:J,disabled:F<=0,className:"p-2 rounded-lg transition-colors "+(F<=0?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:wn.jsx(vt,{size:20})}),wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsxs("span",{className:"font-bold font-mono text-lg",style:{color:ve?.color||"var(--color-accent)"},children:["CH ",(F+1).toString().padStart(2,"0")]}),wn.jsxs("span",{className:"text-xs text-text-muted",children:["/ ",k.channels.length.toString().padStart(2,"0")]}),wn.jsx(Hb,{level:be.level,isActive:be.triggered})]}),wn.jsx("button",{onClick:Z,disabled:F>=k.channels.length-1,className:"p-2 rounded-lg transition-colors "+(F>=k.channels.length-1?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:wn.jsx(Oe,{size:20})})]}),wn.jsxs("div",{className:"flex items-center justify-center gap-2 px-3 py-1 border-t border-dark-border/50",children:[wn.jsx("button",{onClick:()=>E(F),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(ve?.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:bg-dark-bgHover"),children:ve?.muted?wn.jsx(et,{size:14}):wn.jsx(Je,{size:14})}),wn.jsx("button",{onClick:()=>P(F),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(ve?.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:bg-dark-bgHover"),children:wn.jsx(tt,{size:14})}),wn.jsx(Qb,{currentColor:ve?.color,onColorSelect:e=>T(F,e)})]})]}),!n&&wn.jsx("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border z-20 relative h-[37px]",children:wn.jsxs("div",{className:"flex h-full",children:[wn.jsx("div",{className:"flex-shrink-0 px-2 text-text-muted text-xs font-medium text-center border-r border-dark-border flex items-center justify-center",style:{width:Cx},children:"ROW"}),wn.jsx("div",{ref:o,onScroll:me,className:"overflow-x-auto scrollbar-hidden flex-1","data-vu-scroll":!0,children:wn.jsxs("div",{className:"flex",style:{width:ge},children:[k.channels.map((e,n)=>{const a=g.current[n]||{level:0,triggered:!1};return wn.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between gap-2 px-3 py-1.5\n                        border-r border-dark-border transition-colors relative\n                        ${e.muted?"opacity-50":""}\n                        ${e.solo?"bg-accent-primary/10":""}`,style:{width:ye,backgroundColor:e.color?`${e.color}15`:void 0,boxShadow:e.color?`inset 3px 0 0 ${e.color}`:void 0},children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("span",{className:"font-bold font-mono text-sm",style:{color:e.color||"var(--color-accent)"},children:(n+1).toString().padStart(2,"0")}),wn.jsx(Hb,{level:a.level,isActive:a.triggered})]}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx(ox,{channelIndex:n,channel:e,patternId:k.id,patternLength:k.length,onFillPattern:te,onClearChannel:ne,onCopyChannel:ae,onCutChannel:se,onPasteChannel:re,onTranspose:oe,onHumanize:ie,onInterpolate:le,onAcidGenerator:t||(()=>{})}),wn.jsx(Qb,{currentColor:e.color,onColorSelect:e=>T(n,e)}),wn.jsx("button",{onClick:()=>E(n),className:"p-1 rounded transition-colors "+(e.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.muted?"Unmute":"Mute",children:e.muted?wn.jsx(et,{size:12}):wn.jsx(Je,{size:12})}),wn.jsx("button",{onClick:()=>P(n),className:"p-1 rounded transition-colors "+(e.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.solo?"Unsolo":"Solo",children:wn.jsx(tt,{size:12})}),k.channels.length>1&&wn.jsx("button",{onClick:()=>C(n),className:"p-1 rounded text-text-muted hover:text-accent-error hover:bg-dark-bgHover transition-colors",title:"Remove Channel",children:wn.jsx(dt,{size:12})})]})]},e.id)}),k.channels.length<16&&wn.jsx("button",{onClick:N,className:"flex-shrink-0 w-12 flex items-center justify-center border-r border-dark-border\n                      text-text-muted hover:text-accent-primary hover:bg-dark-bgHover transition-colors",title:"Add Channel",children:wn.jsx(Ye,{size:16})})]})})]})}),wn.jsxs("div",{ref:r,className:"flex-1 relative bg-dark-bg",style:{minHeight:200},tabIndex:0,onContextMenu:H.handleContextMenu,children:[wn.jsx("canvas",{ref:a,style:{width:i.width,height:i.height,display:"block"}}),k&&wn.jsx(Kb,{patternId:k.id,patternLength:k.length,rowHeight:Mx,channelCount:k.channels.length,channelWidth:ye,rowNumWidth:Cx,scrollOffset:u,visibleStart:h,parameter:"cutoff",prevPatternId:L?M>0?S[M-1]?.id:S.length>1?S[S.length-1]?.id:void 0:void 0,prevPatternLength:L?M>0?S[M-1]?.length:S.length>1?S[S.length-1]?.length:void 0:void 0,nextPatternId:L?M<S.length-1?S[M+1]?.id:S.length>1?S[0]?.id:void 0:void 0,nextPatternLength:L?M<S.length-1?S[M+1]?.length:S.length>1?S[0]?.length:void 0:void 0},`automation-${k.id}-${f}`),wn.jsx("div",{className:"absolute right-0 pointer-events-none z-30 overflow-hidden",style:{top:0,left:Cx,height:"calc(50% - 12px)"},children:wn.jsx(Yb,{channelWidth:ye,scrollLeft:c})}),wn.jsx(ix,{isOpen:H.isOpen,position:H.position,onClose:H.closeMenu,channelIndex:H.cellInfo?.channelIndex??0,rowIndex:H.cellInfo?.rowIndex??0,onOpenParameterEditor:Y}),$?.isOpen&&wn.jsx(cx,{onClose:()=>q(null),channelIndex:$.channelIndex,startRow:$.startRow,endRow:$.endRow,field:$.field})]})]})}),_x=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ix={noteIndex:null,octaveShift:0,accent:!1,slide:!1,tie:!1,mute:!1,hammer:!1,velocity:100};function Dx(e,t){if(!e||0===e||97===e)return null;const n=Ga(e).match(/^([A-G])(#?)(-?\d)$/);if(!n)return null;const[,a,s,r]=n,o=parseInt(r,10),i=a+(s||""),l=_x.indexOf(i);if(-1===l)return null;const c=o-t;return c<-1||c>1?{noteIndex:l,octaveShift:Math.max(-1,Math.min(1,c))}:{noteIndex:l,octaveShift:c}}function Ox(e,t){if(null===e.noteIndex)return 0;const n=_x[e.noteIndex],a=t+e.octaveShift;let s;return s=n.includes("#")?`${n}${a}`:`${n}-${a}`,Ua(s)}function Fx(e){const{patterns:t,currentPatternIndex:n,setCell:a,resizePattern:r,resizeAllPatterns:o}=tf(),[i,l]=s.useState(3),c=t[n],d=c?.channels[e],u=d?.rows||[],p=c?.length||16,h=s.useCallback(e=>{r(n,e)},[n,r]),m=s.useMemo(()=>function(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e[s];if(!n){a.push({...Ix});continue}const r=Dx(n.note,t);let o=!1;if(s>0&&r&&e[s-1]){const n=Dx(e[s-1].note,t);n&&n.noteIndex===r.noteIndex&&n.octaveShift===r.octaveShift&&(o=!0)}a.push({noteIndex:r?.noteIndex??null,octaveShift:r?.octaveShift??0,accent:1===n.flag1||1===n.flag2,slide:2===n.flag1||2===n.flag2,tie:o,mute:3===n.flag1||3===n.flag2,hammer:4===n.flag1||4===n.flag2,velocity:n.volume??100})}return{steps:a,baseOctave:t,length:n}}(u,i,p),[u,i,p]),f=s.useCallback((t,n,s=0)=>{if(t<0||t>=p)return;const r=null!==n?Ox({noteIndex:n,octaveShift:s},i):0,o=u[t];if(0!==r&&0===(o?.instrument||0)){a(e,t,{note:r,instrument:d?.instrumentId??1})}else a(e,t,{note:r})},[e,a,i,p,u,d]),y=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=1===u[t]?.flag1||1===u[t]?.flag2;a(e,t,{flag1:n?0:1})},[e,u,a]),g=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=2===u[t]?.flag1||2===u[t]?.flag2;a(e,t,{flag2:n?0:2})},[e,u,a]),v=s.useCallback((t,n)=>{if(t<0||t>=u.length)return;const s=u[t];if(!s?.note)return;const r=Dx(s.note,i);if(!r)return;const o=Ox({noteIndex:r.noteIndex,octaveShift:n},i);a(e,t,{note:o})},[e,u,a,i]),b=s.useCallback(t=>{t<0||t>=p||a(e,t,{note:0,flag1:0,flag2:0})},[e,a,p]),x=s.useCallback(()=>{for(let t=0;t<p;t++)a(e,t,{note:0,flag1:0,flag2:0})},[e,a,p]),w=s.useCallback((t,n)=>{if(t<0||t>=u.length)return;const s=Math.max(0,Math.min(127,n));a(e,t,{volume:s})},[e,u,a]),k=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=3===u[t]?.flag1||3===u[t]?.flag2;a(e,t,{flag1:n?0:3})},[e,u,a]),S=s.useCallback(t=>{if(t<0||t>=u.length)return;const n=4===u[t]?.flag1||4===u[t]?.flag2;a(e,t,{flag2:n?0:4})},[e,u,a]);return{gridPattern:m,baseOctave:i,setBaseOctave:l,maxSteps:p,setMaxSteps:h,resizeAllPatterns:o,setNote:f,toggleAccent:y,toggleSlide:g,toggleMute:k,toggleHammer:S,setOctaveShift:v,setVelocity:w,clearStep:b,clearAll:x}}const Rx={chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],description:"All notes"},major:{name:"Major",intervals:[0,2,4,5,7,9,11],description:"Ionian mode"},minor:{name:"Natural Minor",intervals:[0,2,3,5,7,8,10],description:"Aeolian mode"},harmonicMinor:{name:"Harmonic Minor",intervals:[0,2,3,5,7,8,11],description:"Minor with raised 7th"},melodicMinor:{name:"Melodic Minor",intervals:[0,2,3,5,7,9,11],description:"Minor with raised 6th and 7th"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],description:"Minor with raised 6th"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],description:"Minor with lowered 2nd"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],description:"Major with raised 4th"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],description:"Major with lowered 7th"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],description:"Diminished scale"},pentatonicMajor:{name:"Pentatonic Major",intervals:[0,2,4,7,9],description:"5-note major scale"},pentatonicMinor:{name:"Pentatonic Minor",intervals:[0,3,5,7,10],description:"5-note minor scale"},blues:{name:"Blues",intervals:[0,3,5,6,7,10],description:"Minor pentatonic + blue note"},wholeTone:{name:"Whole Tone",intervals:[0,2,4,6,8,10],description:"All whole steps"},diminished:{name:"Diminished",intervals:[0,2,3,5,6,8,9,11],description:"Half-whole diminished"}};const jx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Lx=({scaleKey:e,rootNote:t,onScaleChange:n,onRootNoteChange:a})=>{const r=s.useMemo(()=>Object.entries(Rx).map(([e,t])=>({value:e,label:t.name,description:t.description})),[]),o=s.useMemo(()=>Rx[e]||Rx.chromatic,[e]);return wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Root:"}),wn.jsx("select",{value:t,onChange:e=>a(parseInt(e.target.value,10)),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary",children:jx.map((e,t)=>wn.jsx("option",{value:t,children:e},t))})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Scale:"}),wn.jsx("select",{value:e,onChange:e=>n(e.target.value),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary min-w-[140px]",title:o?.description,children:r.map(e=>wn.jsx("option",{value:e.value,title:e.description,children:e.label},e.value))})]}),"Chromatic"!==o.name&&wn.jsxs("span",{className:"text-[10px] text-text-muted",children:["(",o.intervals.length," notes)"]})]})},Bx={baseOctave:{label:"Base Octave",min:1,max:6,group:"General"},velocity:{label:"Velocity",min:0,max:127,group:"General"},cutoff:{label:"Cutoff",min:200,max:5e3,group:"303 Main"},resonance:{label:"Resonance",min:0,max:100,group:"303 Main"},envMod:{label:"Env Mod",min:0,max:100,group:"303 Main"},decay:{label:"Decay",min:200,max:2e3,group:"303 Main"},accent:{label:"Accent",min:0,max:100,group:"303 Main"},slideTime:{label:"Slide Time",min:2,max:360,group:"303 Main"},overdrive:{label:"Overdrive",min:0,max:100,group:"303 Main"},normalDecay:{label:"Normal Decay",min:30,max:3e3,group:"Devil Fish"},accentDecay:{label:"Accent Decay",min:30,max:3e3,group:"Devil Fish"},softAttack:{label:"Soft Attack",min:.3,max:30,group:"Devil Fish"},vegSustain:{label:"VEG Sustain",min:0,max:100,group:"Devil Fish"},filterFM:{label:"Filter FM",min:0,max:100,group:"Devil Fish"},filterTracking:{label:"Key Track",min:0,max:200,group:"Devil Fish"}},Vx=({onClose:e})=>{const{devices:t,isSupported:n,isEnabled:a,lastMessage:r,enableMIDI:o,disableMIDI:i,onMessage:l}=_v(),{gridMappings:c,gridIsLearning:d,gridLearningParameter:u,addGridMapping:p,removeGridMapping:h,clearGridMappings:m,startGridLearning:f,stopGridLearning:y}=kg(),[g,v]=s.useState(null);s.useEffect(()=>{if(!d||!u)return;return l(e=>{if("cc"===e.type&&void 0!==e.controller&&void 0!==e.value){const t=Bx[u];p({channel:e.channel,controller:e.controller,parameter:u,min:t.min,max:t.max,curve:"linear"}),y()}})},[d,u,l,p,y]);return n?wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4 space-y-4",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[wn.jsx(Ce,{size:16}),"MIDI Learn"]}),e&&wn.jsx("button",{onClick:e,className:"text-text-muted hover:text-text-primary text-xs",children:"Close"})]}),wn.jsx("div",{className:"flex items-center gap-3",children:a?wn.jsxs(wn.Fragment,{children:[wn.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-xs transition-colors",children:"Disable MIDI"}),wn.jsxs("span",{className:"flex items-center gap-1 text-xs text-accent-success",children:[wn.jsx("span",{className:"w-2 h-2 bg-accent-success rounded-full animate-pulse"}),"Connected"]})]}):wn.jsx("button",{onClick:async()=>{try{v(null),await o()}catch(e){v(e instanceof Error?e.message:"Failed to enable MIDI")}},className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white rounded text-xs font-medium transition-colors",children:"Enable MIDI"})}),g&&wn.jsx("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-2 text-xs text-accent-error",children:g}),a&&t.length>0&&wn.jsxs("div",{children:[wn.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-2",children:"Connected Devices"}),wn.jsx("div",{className:"space-y-1",children:t.map(e=>wn.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted bg-dark-bgTertiary rounded px-2 py-1",children:[wn.jsx("span",{className:"w-2 h-2 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),wn.jsx("span",{className:"flex-1",children:e.name}),wn.jsx("span",{className:"text-[10px] opacity-60",children:e.manufacturer})]},e.id))})]}),a&&r&&"cc"===r.type&&wn.jsxs("div",{className:"bg-dark-bgTertiary rounded p-2",children:[wn.jsx("div",{className:"text-xs text-text-muted",children:"Last CC Message:"}),wn.jsxs("div",{className:"text-xs font-mono text-text-primary mt-1",children:["CH",r.channel+1," CC",r.controller," = ",r.value]})]}),a&&wn.jsxs("div",{className:"space-y-3",children:[wn.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Map Parameters"}),["General","303 Main","Devil Fish"].map(e=>{const t=Object.keys(Bx).filter(t=>Bx[t].group===e);return 0===t.length?null:wn.jsxs("div",{children:[wn.jsx("div",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide mb-1.5",children:e}),wn.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:t.map(e=>{const t=Object.values(c).some(t=>t.parameter===e),n=d&&u===e;return wn.jsxs("button",{onClick:()=>{n?y():f(e)},className:`\n                          flex items-center gap-2 px-2 py-1.5 rounded text-xs transition-colors\n                          ${n?"bg-accent-primary text-white animate-pulse":t?"bg-accent-success/20 text-accent-success border border-accent-success/30":"bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary"}\n                        `,children:[n&&wn.jsx(Pe,{size:12,className:"animate-spin"}),wn.jsx("span",{className:"flex-1 text-left",children:Bx[e].label}),t&&!n&&wn.jsx("span",{className:"text-[10px]",children:""})]},e)})})]},e)}),d&&wn.jsxs("p",{className:"text-xs text-accent-primary mt-2 animate-pulse",children:["Move a MIDI controller to assign it to ",Bx[u].label,"..."]})]}),a&&Object.keys(c).length>0&&wn.jsxs("div",{children:[wn.jsxs("div",{className:"flex items-center justify-between mb-2",children:[wn.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Active Mappings"}),wn.jsxs("button",{onClick:m,className:"flex items-center gap-1 text-xs text-accent-error hover:underline",children:[wn.jsx(Re,{size:10}),"Clear All"]})]}),wn.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(c).map(([e,t])=>wn.jsxs("div",{className:"flex items-center justify-between bg-dark-bgTertiary rounded px-2 py-1 text-xs",children:[wn.jsx("span",{className:"text-text-primary",children:Bx[t.parameter].label}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsxs("span",{className:"font-mono text-text-muted text-[10px]",children:["CH",t.channel+1," CC",t.controller]}),wn.jsx("button",{onClick:()=>h(t.channel,t.controller),className:"text-accent-error hover:text-accent-error/80",children:wn.jsx(Re,{size:10})})]})]},e))})]})]}):wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4",children:[wn.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[wn.jsx(bt,{size:16}),wn.jsx("span",{className:"text-sm",children:"Web MIDI API not supported in this browser"})]}),wn.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})},zx=({baseOctave:e,onBaseOctaveChange:t,maxSteps:n,onMaxStepsChange:a,onResizeAllPatterns:r,scaleKey:o,rootNote:i,onScaleChange:l,onRootNoteChange:c,onClearAll:d,onRandomize:u,onAcidGenerator:p})=>{const[h,m]=s.useState(!1);return wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{className:"flex items-center gap-4 p-2 bg-dark-bgSecondary border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Octave"}),wn.jsxs("div",{className:"flex items-center",children:[wn.jsx("button",{onClick:()=>t(Math.max(1,e-1)),disabled:e<=1,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:wn.jsx(Me,{size:14})}),wn.jsx("span",{className:"w-8 text-center text-sm font-mono text-text-primary",children:e}),wn.jsx("button",{onClick:()=>t(Math.min(6,e+1)),disabled:e>=6,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:wn.jsx(xt,{size:14})})]}),wn.jsxs("span",{className:"text-xs text-text-muted",children:["C",e," - C",e+2]})]}),wn.jsx("div",{className:"w-px h-6 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Steps"}),wn.jsxs("select",{value:n,onChange:e=>a(Number(e.target.value)),className:"px-2 py-1 text-sm bg-dark-bgTertiary border border-dark-border rounded text-text-primary",children:[wn.jsx("option",{value:4,children:"4"}),wn.jsx("option",{value:8,children:"8"}),wn.jsx("option",{value:12,children:"12"}),wn.jsx("option",{value:16,children:"16"}),wn.jsx("option",{value:24,children:"24"}),wn.jsx("option",{value:32,children:"32"}),wn.jsx("option",{value:64,children:"64"})]}),wn.jsx("button",{onClick:()=>r(n),className:"px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Apply this step count to all patterns",children:"Apply All"})]}),wn.jsx("div",{className:"w-px h-6 bg-dark-border"}),wn.jsx(Lx,{scaleKey:o,rootNote:i,onScaleChange:l,onRootNoteChange:c}),wn.jsx("div",{className:"w-px h-6 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsxs("button",{onClick:()=>m(!h),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors "+(h?"bg-accent-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-dark-bgActive"),title:"MIDI Learn",children:[wn.jsx(Ce,{size:12}),"MIDI"]}),p&&wn.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate 303 acid pattern",children:[wn.jsx(nt,{size:12}),"Acid"]}),u&&wn.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate random pattern",children:[wn.jsx(wt,{size:12}),"Random"]}),wn.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-accent-error hover:bg-accent-error/10 rounded transition-colors",title:"Clear all steps",children:[wn.jsx(Re,{size:12}),"Clear"]})]})]}),h&&wn.jsx("div",{className:"border-b border-dark-border p-3 bg-dark-bg",children:wn.jsx(Vx,{onClose:()=>m(!1)})})]})},Ux=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Gx=127,Wx=s.memo(({isActive:e,isCurrentStep:t=!1,onClick:n,color:a="default",size:s="normal"})=>{const r="small"===s?"w-5 h-5":"w-7 h-7";return wn.jsx("button",{onClick:n,className:`\n        ${r} rounded transition-all duration-75 border\n        ${(()=>{if(!e)return"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border";switch(a){case"accent":return"bg-accent-warning hover:bg-accent-warning/80 border-accent-warning/50";case"slide":return"bg-accent-secondary hover:bg-accent-secondary/80 border-accent-secondary/50";case"octave":return"bg-accent-primary/50 hover:bg-accent-primary/70 border-accent-primary/50";default:return"bg-accent-primary hover:bg-accent-primary/80 border-accent-primary/50"}})()}\n        ${t?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":""}\n        ${e?"shadow-sm":""}\n      `})}),Kx=({x:e,y:t,accent:n,slide:a,mute:r,hammer:o,octaveShift:i,velocity:l,onToggleAccent:c,onToggleSlide:d,onToggleMute:u,onToggleHammer:p,onSetOctave:h,onSetVelocity:m,onClose:f})=>{const[y,g]=s.useState(l);return s.useEffect(()=>{const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"fixed inset-0 z-40",onClick:f}),wn.jsxs("div",{className:"fixed z-50 bg-dark-bgSecondary border border-dark-border rounded shadow-lg py-1 min-w-[160px]",style:{left:e,top:t},children:[wn.jsxs("button",{onClick:()=>{c(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(n?"text-accent-warning":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(n?"bg-accent-warning":"border border-text-muted")}),"Accent ",n&&""]}),wn.jsxs("button",{onClick:()=>{d(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(a?"text-accent-secondary":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 "+(a?"text-accent-secondary":"text-text-muted"),children:""}),"Slide ",a&&""]}),wn.jsx("div",{className:"border-t border-dark-border my-1"}),wn.jsxs("button",{onClick:()=>{u(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(r?"text-yellow-400":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(r?"bg-yellow-400":"border border-text-muted")}),"Mute ",r&&""]}),wn.jsxs("button",{onClick:()=>{p(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(o?"text-cyan-400":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(o?"bg-cyan-400":"border border-text-muted")}),"Hammer ",o&&""]}),wn.jsx("div",{className:"border-t border-dark-border my-1"}),wn.jsxs("button",{onClick:()=>{h(1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(1===i?"text-cyan-400":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(1===i?"bg-accent-primary ring-2 ring-cyan-400 ring-inset":"border border-text-muted")}),"Oct+ ",1===i&&""]}),wn.jsxs("button",{onClick:()=>{h(0),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(0===i?"text-accent-primary":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(0===i?"bg-accent-primary":"border border-text-muted")}),"Normal ",0===i&&""]}),wn.jsxs("button",{onClick:()=>{h(-1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(-1===i?"text-pink-400":"text-text-secondary"),children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm "+(-1===i?"bg-accent-primary ring-2 ring-pink-400 ring-inset":"border border-text-muted")}),"Oct- ",-1===i&&""]}),wn.jsx("div",{className:"border-t border-dark-border my-1"}),wn.jsxs("div",{className:"px-3 py-2",children:[wn.jsxs("div",{className:"flex items-center justify-between mb-1",children:[wn.jsx("span",{className:"text-xs text-text-secondary",children:"Velocity"}),wn.jsx("span",{className:"text-xs text-text-primary font-mono",children:y})]}),wn.jsx("input",{type:"range",min:1,max:Gx,value:y,onChange:e=>{const t=parseInt(e.target.value,10);g(t),m(t)},className:"w-full h-1 bg-dark-bgTertiary rounded-lg appearance-none cursor-pointer accent-accent-primary"}),wn.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-text-muted",children:[wn.jsx("button",{onClick:()=>{m(64),g(64)},className:"hover:text-text-secondary",children:"50%"}),wn.jsx("button",{onClick:()=>{m(100),g(100)},className:"hover:text-text-secondary",children:"Default"}),wn.jsx("button",{onClick:()=>{m(Gx),g(Gx)},className:"hover:text-text-secondary",children:"Max"})]})]})]})]})},Hx=s.memo(({noteIndex:e,stepIndex:t,isActive:n,isCurrentStep:a,isTriggered:r=!1,isFocused:o=!1,accent:i=!1,slide:l=!1,mute:c=!1,hammer:d=!1,octaveShift:u=0,velocity:p=100,onClick:h,onToggleAccent:m,onToggleSlide:f,onToggleMute:y,onToggleHammer:g,onSetOctave:v,onSetVelocity:b,onFocus:x})=>{const[w,k]=s.useState(null),S=s.useCallback(a=>{if(n){if(a.shiftKey&&m)return void m(t);if((a.ctrlKey||a.metaKey)&&f)return void f(t);if(a.altKey&&v){return void v(t,0===u?1:1===u?-1:0)}}h(e,t,{shift:a.shiftKey,ctrl:a.ctrlKey||a.metaKey,alt:a.altKey})},[h,e,t,n,m,f,v,u]),M=s.useCallback(e=>{n&&(e.preventDefault(),k({x:e.clientX,y:e.clientY}))},[n]),N=s.useCallback(()=>{k(null)},[]),C=s.useCallback(()=>{m?.(t)},[m,t]),E=s.useCallback(()=>{f?.(t)},[f,t]),P=s.useCallback(()=>{y?.(t)},[y,t]),T=s.useCallback(()=>{g?.(t)},[g,t]),A=s.useCallback(e=>{v?.(t,e)},[v,t]),_=s.useCallback(e=>{b?.(t,e)},[b,t]),I=s.useCallback(e=>{if(!n||!b)return;e.preventDefault();const a=e.deltaY>0?-5:5,s=Math.max(1,Math.min(Gx,p+a));b(t,s)},[n,b,t,p]),D=s.useCallback(()=>{x?.()},[x]);return wn.jsxs(wn.Fragment,{children:[wn.jsxs("button",{onClick:S,onContextMenu:M,onWheel:I,onFocus:D,tabIndex:o?0:-1,className:`\n          w-7 h-7 rounded transition-all duration-75 border relative\n          ${n?i?"bg-accent-warning hover:brightness-110 border-accent-warning/50":"bg-accent-primary hover:brightness-110 border-accent-primary/50":"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border"}\n          ${a?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":n&&0!==u?u>0?"ring-2 ring-cyan-400 ring-inset":"ring-2 ring-pink-400 ring-inset":""}\n          ${o&&!a?"ring-2 ring-text-secondary ring-offset-1 ring-offset-dark-bg":""}\n          ${n?"shadow-sm":""}\n          ${r&&n?"!bg-white scale-110 shadow-lg shadow-white/50":""}\n          ${!n||p>=100?"":p<50?"ring-1 ring-inset ring-black/30":p<80?"ring-1 ring-inset ring-black/15":""}\n          focus:outline-none\n        `,title:n?`Velocity: ${p} | Shift+click: accent, Ctrl+click: slide, Alt+click: octave, Scroll: velocity`:"","aria-label":`Step ${t+1}, Note ${Ux[e]}${n?", Active":""}`,"aria-pressed":n,children:[n&&l&&!c&&wn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-xs font-bold",children:""}),n&&c&&wn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400 text-xs font-bold",children:"M"}),n&&d&&!c&&wn.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-cyan-400 text-xs font-bold",children:"H"})]}),w&&wn.jsx(Kx,{x:w.x,y:w.y,accent:i,slide:l,mute:c,hammer:d,octaveShift:u,velocity:p,onToggleAccent:C,onToggleSlide:E,onToggleMute:P,onToggleHammer:T,onSetOctave:A,onSetVelocity:_,onClose:N})]})});s.memo(({stepIndex:t,isActive:n,isCurrentStep:a,color:s,onClick:r})=>{const o=e.useCallback(()=>{r(t)},[r,t]);return wn.jsx(Wx,{isActive:n,isCurrentStep:a,onClick:o,color:s})});const $x=["MINOR","MAJOR","DORIAN","MIXOLYDIAN","PHRYGIAN","HARMONIC_MINOR","PHRYGIAN_DOMINANT","MELODIC_MINOR","LYDIAN_DOMINANT","HUNGARIAN_MINOR"],qx={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]};function Yx(e,t){return Math.floor(Math.random()*(t-e+1))+e}function Xx(e,t){const n=[...e],a=[],s=Math.min(t,e.length);for(let r=0;r<s;r++){const e=Math.floor(Math.random()*(n.length-r))+r;[n[r],n[e]]=[n[e],n[r]],a.push(n[r])}return a}function Qx(e={}){const{patternLength:t=16,density:n=60,spread:a=60,accentsDensity:s=50,slidesDensity:r=40,scale:o="MINOR",rootNote:i="C2",instrumentId:l=1}=e,c=function(e){const{patternLength:t,density:n,spread:a,accentsDensity:s,slidesDensity:r}=e,o=Array.from({length:t},(e,t)=>t),i=Math.round(t*(n/100)),l=Yx(Math.round(i/2),i),c=Xx(o,l),d=Math.max(1,Math.round(l/2*(s/100))),u=Math.round(l/2*(r/100)),p=Xx(c,Yx(1,d)),h=Xx(c,Yx(0,u)),m=Math.round(a/100*6),f=Xx(Array.from({length:7},(e,t)=>t),Math.max(1,m)),y=Xx(c,Yx(0,l));return o.map(e=>{if(!c.includes(e))return{note:null,octave:null,accent:null,slide:null};const t=Yx(-1,1);return{note:y.includes(e)&&f.length>0?f[Yx(0,f.length-1)]:0,octave:t,accent:p.includes(e),slide:h.includes(e)}})}({patternLength:t,density:n,spread:a,accentsDensity:s,slidesDensity:r}),d=qx[o],u=function(e){const t=e.match(/^([A-G][b#]?)(-?\d+)$/);if(!t)return 36;const[,n,a]=t,s=parseInt(a,10),r={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===r?36:r+12*(s+1)}(i);return c.map(e=>{if(null===e.note||null===e.octave)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const t=function(e,t,n,a){return t[e]+n+12*a}(e.note,d,u,e.octave),n=Ya(t),a=e.accent?64:Yx(48,56);return{note:n,instrument:l,volume:16+a,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:void 0,flag2:e.slide?2:void 0}})}function Zx(e){return{MINOR:"Minor (Natural)",MAJOR:"Major",DORIAN:"Dorian",MIXOLYDIAN:"Mixolydian",PHRYGIAN:"Phrygian",HARMONIC_MINOR:"Harmonic Minor",PHRYGIAN_DOMINANT:"Phrygian Dominant",MELODIC_MINOR:"Melodic Minor",LYDIAN_DOMINANT:"Lydian Dominant",HUNGARIAN_MINOR:"Hungarian Minor"}[e]}const Jx=({channelIndex:e,onClose:t})=>{const{patterns:n,currentPatternIndex:a,setChannelRows:r}=tf(),o=n[a],i=o?.channels[e],l=i?.instrumentId??0,[c,d]=s.useState(60),[u,p]=s.useState(60),[h,m]=s.useState(50),[f,y]=s.useState(40),[g,v]=s.useState("MINOR"),[b,x]=s.useState("C2"),w=["C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"];return i?wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(nt,{size:18,className:"text-accent-primary"}),wn.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"Acid Pattern Generator"})]}),wn.jsx("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:wn.jsx(Ee,{size:18})})]}),wn.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[wn.jsx("div",{className:"bg-dark-bgTertiary p-3 rounded border border-ft2-border",children:wn.jsxs("div",{className:"text-sm text-ft2-textDim",children:["Generating for: ",wn.jsx("span",{className:"font-bold text-ft2-text",children:i.name}),wn.jsx("br",{}),"Pattern Length: ",wn.jsxs("span",{className:"font-mono",children:[o.length," steps"]})]})}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Scale"}),wn.jsx("select",{value:g,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:$x.map(e=>wn.jsx("option",{value:e,children:Zx(e)},e))})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Root Note"}),wn.jsx("select",{value:b,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:w.map(e=>wn.jsx("option",{value:e,children:e},e))})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Density: ",wn.jsxs("span",{className:"font-mono text-accent-primary",children:[c,"%"]})]}),wn.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:e=>d(parseInt(e.target.value)),className:"w-full"}),wn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many notes in the pattern (sparse   dense)"})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Spread: ",wn.jsxs("span",{className:"font-mono text-accent-primary",children:[u,"%"]})]}),wn.jsx("input",{type:"range",min:"0",max:"100",value:u,onChange:e=>p(parseInt(e.target.value)),className:"w-full"}),wn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"Note range variety (narrow   wide)"})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Accents: ",wn.jsxs("span",{className:"font-mono text-accent-primary",children:[h,"%"]})]}),wn.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:e=>m(parseInt(e.target.value)),className:"w-full"}),wn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many accented notes (subtle   punchy)"})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Slides: ",wn.jsxs("span",{className:"font-mono text-accent-primary",children:[f,"%"]})]}),wn.jsx("input",{type:"range",min:"0",max:"100",value:f,onChange:e=>y(parseInt(e.target.value)),className:"w-full"}),wn.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many slides/portamento (few   many)"})]})]}),wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[wn.jsxs("button",{onClick:()=>{d(Math.floor(60*Math.random())+40),p(Math.floor(60*Math.random())+40),m(Math.floor(60*Math.random())+20),y(Math.floor(60*Math.random())+20),v($x[Math.floor(Math.random()*$x.length)]);const e=w[Math.floor(Math.random()*w.length)];x(e)},className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[wn.jsx(kt,{size:14}),"Randomize"]}),wn.jsxs("div",{className:"flex gap-2",children:[wn.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"}),wn.jsx("button",{onClick:()=>{(()=>{if(!i)return;const t=Qx({patternLength:o.length,density:c,spread:u,accentsDensity:h,slidesDensity:f,scale:g,rootNote:b,instrumentId:l});r(e,t)})(),t()},className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Generate Pattern"})]})]})]})}):null},ew=["B","A#","A","G#","G","F#","F","E","D#","D","C#","C"],tw=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],nw=[11,10,9,8,7,6,5,4,3,2,1,0],aw=({channelIndex:e})=>{const{gridPattern:t,baseOctave:n,setBaseOctave:a,maxSteps:r,setMaxSteps:o,resizeAllPatterns:i,setNote:l,toggleAccent:c,toggleSlide:d,toggleMute:u,toggleHammer:p,setOctaveShift:h,setVelocity:m,clearAll:f}=Fx(e),{currentRow:y,isPlaying:g,smoothScrolling:v,bpm:b,speed:x}=Ry(),w=g?y%r:-1,k=s.useRef(null),S=s.useRef(-1),M=s.useRef(0),N=s.useRef(0),C=s.useRef(0),E=s.useRef(t.steps);E.current=t.steps;const[P,T]=s.useState(null),A=s.useRef(null),[_,I]=s.useState("chromatic"),[D,O]=s.useState(0),[F,R]=s.useState(!1),{onMessage:j}=_v(),{applyGridMIDIValue:L}=kg();s.useEffect(()=>{null===P&&r>0&&T({noteIndex:11,stepIndex:0})},[P,r]),s.useEffect(()=>{if(!g||!v)return S.current=-1,M.current=0,void(C.current&&(cancelAnimationFrame(C.current),C.current=0));const e=k.current;if(!e)return;const t=2.5/b*x*1e3,n=()=>{const a=performance.now();w!==S.current&&(S.current=w,M.current=a);const s=a-M.current,r=Math.min(s/t,1),o=48+32*(w+r),i=e.clientWidth,l=Math.max(0,o-.4*i);N.current+=.15*(l-N.current),e.scrollLeft=N.current,C.current=requestAnimationFrame(n)};return N.current=e.scrollLeft,C.current=requestAnimationFrame(n),()=>{C.current&&(cancelAnimationFrame(C.current),C.current=0)}},[g,v,b,x,w]),s.useEffect(()=>j(e=>{if("cc"!==e.type||void 0===e.controller||void 0===e.value)return;const t=L(e.channel,e.controller,e.value);if(null===t)return;const n=kg.getState().getGridMapping(e.channel,e.controller);if(n&&"baseOctave"===n.parameter)a(Math.round(t))}),[j,L,a]);const[B]=s.useState(!0),V=s.useCallback((t,a=0,s=!1,r=!1)=>{if(B)try{const o=Hm();if(!o)return;const{patterns:i,currentPatternIndex:l}=tf.getState(),c=i[l],d=c?.channels[e],u=d?.instrumentId??1,p=Py.getState().instruments.find(e=>e.id===u);if(p){const e=`${tw[t]}${n+a}`;o.triggerNote(u,e,.2,Q(),.8,p,s,r)}}catch(o){}},[B,e,n]),z=s.useCallback((e,t)=>{const n=E.current[t];if(n?.noteIndex===e)l(t,null);else{const a=null!==n?.noteIndex?n.octaveShift:0;l(t,e,a),V(e,a,n?.accent||!1,n?.slide||!1)}},[l,V]),U=s.useCallback((e,t)=>{h(e,t)},[h]),G=s.useCallback(()=>{for(let e=0;e<r;e++)if(Math.random()<.7){const t=Math.floor(12*Math.random()),n=Math.random()<.3?Math.random()<.5?-1:1:0;l(e,t,n),Math.random()<.25&&c(e),e>0&&Math.random()<.2&&d(e)}else l(e,null)},[r,l,c,d]),W=s.useCallback(()=>{R(!0)},[]),K=s.useMemo(()=>Array.from({length:r},(e,t)=>t),[r]),H=s.useMemo(()=>{const e=Rx[_];return e&&"chromatic"!==_?nw.filter(t=>function(e,t,n){if(e<0||e>11)return!1;if(t<0||t>11)return!1;const a=(e-t+12)%12;return n.intervals.includes(a)}(t,D,e)):nw},[_,D]),$=s.useCallback(e=>{if(!P)return;const{noteIndex:t,stepIndex:n}=P,a=E.current[n],s=a?.noteIndex===t;if("ArrowRight"===e.key)e.preventDefault(),T({noteIndex:t,stepIndex:Math.min(n+1,r-1)});else if("ArrowLeft"===e.key)e.preventDefault(),T({noteIndex:t,stepIndex:Math.max(n-1,0)});else if("ArrowDown"===e.key){e.preventDefault();const a=nw.indexOf(t),s=Math.min(a+1,nw.length-1);T({noteIndex:nw[s],stepIndex:n})}else if("ArrowUp"===e.key){e.preventDefault();const a=nw.indexOf(t),s=Math.max(a-1,0);T({noteIndex:nw[s],stepIndex:n})}else if("Enter"===e.key||" "===e.key)e.preventDefault(),z(t,n);else if(s)if("a"===e.key||"A"===e.key)e.preventDefault(),c(n);else if("s"===e.key||"S"===e.key)e.preventDefault(),d(n);else if("m"===e.key||"M"===e.key)e.preventDefault(),u(n);else if("h"===e.key||"H"===e.key)e.preventDefault(),p(n);else if("o"===e.key||"O"===e.key){e.preventDefault();const t=a?.octaveShift??0;h(n,0===t?1:1===t?-1:0)}else if("v"===e.key||"V"===e.key)e.preventDefault(),m(n,100);else if("+"===e.key||"="===e.key){e.preventDefault();const t=a?.velocity??100;m(n,Math.min(127,t+10))}else if("-"===e.key||"_"===e.key){e.preventDefault();const t=a?.velocity??100;m(n,Math.max(1,t-10))}},[P,z,r,c,d,u,p,h,m]);return wn.jsxs("div",{className:"flex flex-col h-full bg-dark-bg",children:[wn.jsx(zx,{baseOctave:n,onBaseOctaveChange:a,maxSteps:r,onMaxStepsChange:o,onResizeAllPatterns:i,scaleKey:_,rootNote:D,onScaleChange:I,onRootNoteChange:O,onClearAll:f,onRandomize:G,onAcidGenerator:W}),wn.jsxs("div",{ref:k,className:"flex-1 overflow-auto p-2",children:[wn.jsxs("div",{ref:A,className:"inline-block min-w-full",role:"grid","aria-label":"TB-303 Pattern Grid",onKeyDown:$,tabIndex:0,children:[wn.jsx("div",{className:"flex items-center mb-1 pl-12",role:"row",children:K.map(e=>wn.jsx("div",{className:`w-7 h-4 flex items-center justify-center text-[10px] font-mono mx-0.5\n                  ${e%4==0?"text-text-primary":"text-text-muted"}\n                  ${w===e?"text-accent-primary font-bold":""}\n                `,children:(e+1).toString().padStart(2,"0")},e))}),H.map(e=>{const n=nw.indexOf(e),a=e===D;return wn.jsxs("div",{className:"flex items-center mb-0.5",role:"row",children:[wn.jsxs("div",{className:`w-10 mr-2 text-right text-xs font-mono\n                    ${a?"text-accent-primary font-bold":ew[n].includes("#")?"text-text-muted":"text-text-secondary"}\n                  `,"aria-label":`Note ${ew[n]}${a?" (Root)":""}`,children:[ew[n],a&&wn.jsx("span",{className:"ml-0.5 text-[8px]",children:""})]}),K.map(n=>{const a=t.steps[n],s=a?.noteIndex===e,r=P?.noteIndex===e&&P?.stepIndex===n;return wn.jsx("div",{className:"mx-0.5",role:"gridcell",children:wn.jsx(Hx,{noteIndex:e,stepIndex:n,isActive:s,isCurrentStep:w===n,isTriggered:w===n&&s,isFocused:r,accent:!!s&&a?.accent,slide:!!s&&a?.slide,mute:!!s&&a?.mute,hammer:!!s&&a?.hammer,octaveShift:s?a?.octaveShift:0,velocity:s?a?.velocity:100,onClick:z,onToggleAccent:c,onToggleSlide:d,onToggleMute:u,onToggleHammer:p,onSetOctave:U,onSetVelocity:m,onFocus:()=>T({noteIndex:e,stepIndex:n})})},n)})]},e)})]}),wn.jsxs("div",{className:"mt-4 pt-3 border-t border-dark-border space-y-2",children:[wn.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[wn.jsx("span",{children:"Click: note"}),wn.jsxs("span",{className:"flex items-center gap-1",children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-warning/80"})," Shift+click: accent"]}),wn.jsxs("span",{className:"flex items-center gap-1",children:[wn.jsx("span",{className:"text-accent-secondary",children:""})," Ctrl+click: slide"]}),wn.jsxs("span",{className:"flex items-center gap-1",children:[wn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-cyan-400 ring-inset"}),wn.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-pink-400 ring-inset"}),"Alt+click: octave"]}),wn.jsx("span",{children:"Right-click: menu"}),wn.jsx("span",{children:"Scroll: velocity"})]}),wn.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[wn.jsx("span",{className:"font-semibold text-text-secondary",children:"Keyboard:"}),wn.jsx("span",{children:"Arrows: navigate"}),wn.jsx("span",{children:"Enter/Space: toggle"}),wn.jsx("span",{children:"A: accent"}),wn.jsx("span",{children:"S: slide"}),wn.jsx("span",{children:"M: mute"}),wn.jsx("span",{children:"H: hammer"}),wn.jsx("span",{children:"O: octave"}),wn.jsx("span",{children:"V: velocity reset"}),wn.jsx("span",{children:"+/-: velocity 10"})]})]})]}),F&&wn.jsx(Jx,{channelIndex:e,onClose:()=>R(!1)})]})},sw={z:{note:"C",octaveOffset:0},s:{note:"C#",octaveOffset:0},x:{note:"D",octaveOffset:0},d:{note:"D#",octaveOffset:0},c:{note:"E",octaveOffset:0},v:{note:"F",octaveOffset:0},g:{note:"F#",octaveOffset:0},b:{note:"G",octaveOffset:0},h:{note:"G#",octaveOffset:0},n:{note:"A",octaveOffset:0},j:{note:"A#",octaveOffset:0},m:{note:"B",octaveOffset:0},",":{note:"C",octaveOffset:1},q:{note:"C",octaveOffset:1},2:{note:"C#",octaveOffset:1},w:{note:"D",octaveOffset:1},3:{note:"D#",octaveOffset:1},e:{note:"E",octaveOffset:1},r:{note:"F",octaveOffset:1},5:{note:"F#",octaveOffset:1},t:{note:"G",octaveOffset:1},6:{note:"G#",octaveOffset:1},y:{note:"A",octaveOffset:1},7:{note:"A#",octaveOffset:1},u:{note:"B",octaveOffset:1},i:{note:"C",octaveOffset:2},9:{note:"C#",octaveOffset:2},o:{note:"D",octaveOffset:2},0:{note:"D#",octaveOffset:2},p:{note:"E",octaveOffset:2}},rw={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7},ow={a:8,s:9,d:10,f:11,g:12,h:13,j:14,k:15},iw="0123456789ABCDEFabcdef",lw={0:0,1:1,2:2,3:3,4:4,"-":6,"+":7,d:8,u:9,s:10,v:11,p:12,l:13,r:14,m:15},cw={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35};const dw=({isOpen:e,onClose:t,children:n,theme:a="modern",size:r="md",backdropOpacity:o="medium",rounded:i=!0,closeOnBackdropClick:l=!0,closeOnEscape:c=!0,animation:d="fade",className:u=""})=>{s.useEffect(()=>{if(!e||!c)return;const n=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,c,t]);if(!e)return null;const p=`\n    fixed inset-0 z-50 flex items-center justify-center p-4\n    ${{light:"bg-black/50",medium:"bg-black/60",dark:"bg-black/80"}[o]}\n  `,h=`\n    ${{sm:"w-80 max-w-sm",md:"w-96 max-w-md",lg:"max-w-2xl w-full",xl:"max-w-4xl w-full",fullscreen:"w-full h-full"}[r]}\n    ${"retro"===a?"bg-ft2-bg border-ft2-border":"bg-dark-bg border-dark-border"}\n    ${"retro"===a?"border-2":"border"}\n    ${i?"rounded-lg":""}\n    ${{fade:"animate-fade-in",slide:"animate-slide-in-up",scale:"animate-scale-in"}[d]}\n    ${"fullscreen"!==r?"shadow-xl max-h-[90vh] overflow-hidden":""}\n    ${u}\n    flex flex-col\n  `;return wn.jsx("div",{className:p,onClick:e=>{l&&e.target===e.currentTarget&&t()},children:wn.jsx("div",{className:h,children:n})})},uw=({title:e,subtitle:t,icon:n,onClose:a,theme:s="modern",showCloseButton:r=!0})=>{const o="retro"===s?"bg-ft2-header border-ft2-border text-ft2-highlight":"bg-dark-bgSecondary border-dark-border text-text-primary",i="retro"===s?"border-b-2":"border-b",l="retro"===s?"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none":"p-2 rounded-lg hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors focus:outline-none";return wn.jsxs("div",{className:`flex items-center justify-between px-4 py-3 ${i} ${o}`,children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[n&&wn.jsx("div",{className:"text-accent-primary",children:n}),wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("h2",{className:"font-bold tracking-wide "+("retro"===s?"text-sm":"text-base"),children:e}),t&&wn.jsx("p",{className:"text-text-secondary "+("retro"===s?"text-xs":"text-sm"),children:t})]})]}),r&&a&&wn.jsx("button",{onClick:a,className:l,"aria-label":"Close",title:"Close (Esc)",children:wn.jsx(Ee,{size:16})})]})},pw=({children:e,theme:t="modern",align:n="right"})=>{const a="retro"===t?"bg-ft2-header border-ft2-border":"bg-dark-bgSecondary border-dark-border",s="retro"===t?"border-t-2":"border-t";return wn.jsx("div",{className:`flex gap-2 px-4 py-3 ${s} ${a} ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[n]}`,children:e})},hw=[{value:"volume",label:"Volume",min:0,max:64},{value:"cutoff",label:"Cutoff",min:0,max:127},{value:"resonance",label:"Resonance",min:0,max:127},{value:"envMod",label:"Env Mod",min:0,max:127},{value:"pan",label:"Pan",min:-100,max:100}],mw=[{value:"linear",label:"Linear",description:"Constant rate of change"},{value:"log",label:"Logarithmic",description:"Fast start, gradual end"},{value:"exp",label:"Exponential",description:"Gradual start, fast end"},{value:"scurve",label:"S-Curve",description:"Smooth ease in/out"}],fw=({isOpen:e,onClose:t})=>{const{selection:n,interpolateSelection:a}=tf(),[r,o]=s.useState("volume"),[i,l]=s.useState(64),[c,d]=s.useState(0),[u,p]=s.useState("linear"),h=hw.find(e=>e.value===r);return wn.jsxs(dw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[wn.jsx(uw,{title:"Interpolate Selection",icon:wn.jsx(ot,{size:18}),onClose:t,theme:"modern"}),wn.jsxs("div",{className:"p-4 space-y-4",children:[wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Column"}),wn.jsx("select",{value:r,onChange:e=>(e=>{o(e);const t=hw.find(t=>t.value===e);"pan"===e?(l(-100),d(100)):(l(t.max),d(0))})(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:hw.map(e=>wn.jsx("option",{value:e.value,children:e.label},e.value))})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["Start Value (",h.min," - ",h.max,")"]}),wn.jsx("input",{type:"number",value:i,onChange:e=>l(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["End Value (",h.min," - ",h.max,")"]}),wn.jsx("input",{type:"number",value:c,onChange:e=>d(Math.max(h.min,Math.min(h.max,parseInt(e.target.value)||0))),min:h.min,max:h.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Curve"}),wn.jsx("div",{className:"grid grid-cols-4 gap-1",children:mw.map(e=>wn.jsx("button",{onClick:()=>p(e.value),className:"px-2 py-1.5 text-xs rounded border transition-colors "+(u===e.value?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),title:e.description,children:e.label},e.value))}),wn.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:mw.find(e=>e.value===u)?.description})]}),!n&&wn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),wn.jsxs(pw,{theme:"modern",align:"right",children:[wn.jsx(Ob,{variant:"ghost",onClick:t,children:"Cancel"}),wn.jsx(Ob,{variant:"primary",onClick:()=>{n?(a(r,i,c,u),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},yw=({isOpen:e,onClose:t})=>{const{selection:n,humanizeSelection:a}=tf(),[r,o]=s.useState(15);return wn.jsxs(dw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[wn.jsx(uw,{title:"Humanize Selection",icon:wn.jsx(rt,{size:18}),onClose:t,theme:"modern"}),wn.jsxs("div",{className:"p-4 space-y-4",children:[wn.jsx("p",{className:"text-xs text-text-muted",children:"Add random variation to volume values to create a more human feel."}),wn.jsxs("div",{children:[wn.jsxs("label",{className:"block text-xs text-text-muted mb-2",children:["Volume Variation: ",wn.jsxs("span",{className:"text-accent-primary font-mono",children:[r,"%"]})]}),wn.jsx("input",{type:"range",value:r,onChange:e=>o(parseInt(e.target.value)),min:0,max:50,className:"w-full accent-accent-primary"}),wn.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-1",children:[wn.jsx("span",{children:"0% (none)"}),wn.jsx("span",{children:"50% (max)"})]})]}),wn.jsx("div",{className:"bg-dark-bg rounded p-3 text-xs text-text-secondary",children:wn.jsxs("p",{children:["Each note's volume will be randomly adjusted by up to ",r,"% of its current value."]})}),!n&&wn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),wn.jsxs(pw,{theme:"modern",align:"right",children:[wn.jsx(Ob,{variant:"ghost",onClick:t,children:"Cancel"}),wn.jsx(Ob,{variant:"primary",onClick:()=>{n?(a(r),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},gw=({isOpen:e,onClose:t})=>{const{patterns:n,currentPatternIndex:a,selection:r}=tf(),[o,i]=s.useState("note"),[l,c]=s.useState("pattern"),[d,u]=s.useState(""),[p,h]=s.useState(""),[m,f]=s.useState(null),[y,g]=s.useState(null),v=n[a];return wn.jsxs(dw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[wn.jsx(uw,{title:"Find & Replace",icon:wn.jsx(St,{size:18}),onClose:t,theme:"modern"}),wn.jsxs("div",{className:"p-4 space-y-4",children:[wn.jsx("div",{className:"flex gap-2",children:["note","instrument","effect"].map(e=>wn.jsx("button",{onClick:()=>i(e),className:"flex-1 px-3 py-2 text-xs rounded transition-colors "+(o===e?"bg-accent-primary text-white":"bg-dark-bg text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Scope"}),wn.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[wn.jsxs("option",{value:"selection",disabled:!r,children:["Selection ",!r&&"(none)"]}),wn.jsx("option",{value:"pattern",children:"Current Pattern"}),wn.jsx("option",{value:"all",children:"All Patterns"})]})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Find"}),wn.jsxs("div",{className:"relative",children:[wn.jsx(St,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),wn.jsx("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"note"===o?"e.g., C-4":"instrument"===o?"e.g., 01":"e.g., A0F",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Replace with (empty to clear)"}),wn.jsxs("div",{className:"relative",children:[wn.jsx(Mt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),wn.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"Leave empty to clear",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),null!==m&&wn.jsxs("p",{className:"text-xs text-accent-primary",children:["Found ",m," match",1!==m?"es":""]}),null!==y&&wn.jsxs("p",{className:"text-xs text-accent-success",children:["Replaced ",y," occurrence",1!==y?"s":""]})]}),wn.jsxs(pw,{theme:"modern",align:"right",children:[wn.jsx(Ob,{variant:"ghost",onClick:t,children:"Close"}),wn.jsx(Ob,{variant:"default",onClick:()=>{let e=0;const t="all"===l?n:[v];for(const n of t)for(const t of n.channels)for(let a=0;a<n.length;a++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),s=Math.max(r.startChannel,r.endChannel),o=Math.min(r.startRow,r.endRow),i=Math.max(r.startRow,r.endRow),l=n.channels.indexOf(t);if(l<e||l>s||a<o||a>i)continue}const s=t.rows[a];if("note"===o&&s.note&&0!==s.note&&97!==s.note){Ga(s.note).toLowerCase().includes(d.toLowerCase())&&e++}else if("instrument"===o&&0!==s.instrument){s.instrument.toString(16).toUpperCase().padStart(2,"0").includes(d.toUpperCase())&&e++}else if("effect"===o&&(0!==s.effTyp||0!==s.eff)){$a(s.effTyp,s.eff).toLowerCase().includes(d.toLowerCase())&&e++}}f(e),g(null)},disabled:!d,children:"Find"}),wn.jsx(Ob,{variant:"primary",onClick:()=>{if(!d)return;let e=0;tf.setState(t=>{const n="all"===l?t.patterns:[t.patterns[a]];for(const a of n)for(let t=0;t<a.channels.length;t++){const n=a.channels[t];for(let s=0;s<a.length;s++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),n=Math.max(r.startChannel,r.endChannel),a=Math.min(r.startRow,r.endRow),o=Math.max(r.startRow,r.endRow);if(t<e||t>n||s<a||s>o)continue}const a=n.rows[s];if("note"===o&&a.note&&0!==a.note&&97!==a.note){Ga(a.note).toLowerCase().includes(d.toLowerCase())&&(a.note=""===p?0:Ua(p.toUpperCase()),e++)}else if("instrument"===o&&0!==a.instrument){a.instrument.toString(16).toUpperCase().padStart(2,"0").includes(d.toUpperCase())&&(a.instrument=""===p?0:parseInt(p,16)||0,e++)}else if("effect"===o&&(0!==a.effTyp||0!==a.eff)){if($a(a.effTyp,a.eff).toLowerCase().includes(d.toLowerCase())){if(""===p)a.effTyp=0,a.eff=0;else{const[e,t]=Ha(p.toUpperCase());a.effTyp=e,a.eff=t}e++}}}}}),g(e),f(null)},disabled:!d,children:"Replace All"})]})]})};class vw{context=null;gain=null;processNode=null;config;handlers=new Map;initialized=!1;initError=null;initPromise=null;meta=null;duration=0;currentTime=0;order=0;pattern=0;row=0;constructor(e={}){this.config={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,...e}}async ensureInitialized(){return!!this.initialized||!this.initError&&(this.initPromise?(await this.initPromise,this.initialized):(this.initPromise=this.initWorklet(),await this.initPromise,this.initialized))}async initWorklet(){try{this.context=new AudioContext,this.gain=this.context.createGain(),this.gain.gain.value=1;const e="/DEViLBOX/";await this.context.audioWorklet.addModule(`${e}chiptune3/chiptune3.worklet.js`),this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.processNode.connect(this.gain),this.gain.connect(this.context.destination),this.initialized=!0,this.fireEvent("onInitialized")}catch(e){const t=e instanceof Error?e.message:String(e);this.initError=t,this.fireEvent("onError",{type:"init",message:t})}}handleMessage(e){const{cmd:t,meta:n,pos:a,order:s,pattern:r,row:o,val:i}=e.data;switch(t){case"meta":this.meta=n,this.duration=n?.dur||0,this.fireEvent("onMetadata",n);break;case"pos":this.currentTime=a,this.order=s,this.pattern=r,this.row=o,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:i})}}fireEvent(e,t){const n=this.handlers.get(e);n&&n.forEach(e=>e(t))}addHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}onInitialized(e){this.initialized?e():this.initError?this.fireEvent("onError",{type:"init",message:this.initError}):(this.addHandler("onInitialized",e),this.ensureInitialized())}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}async play(e){await this.ensureInitialized()&&this.processNode&&this.context?("suspended"===this.context.state&&await this.context.resume(),this.processNode.port.postMessage({cmd:"play",val:e})):this.fireEvent("onError",{type:"not_initialized"})}stop(){this.processNode?.port.postMessage({cmd:"stop"})}pause(){this.processNode?.port.postMessage({cmd:"pause"})}unpause(){this.processNode?.port.postMessage({cmd:"unpause"})}setVol(e){this.gain&&(this.gain.gain.value=e)}setPos(e){this.processNode?.port.postMessage({cmd:"setPos",val:e})}setRepeatCount(e){this.processNode?.port.postMessage({cmd:"repeatCount",val:e})}isAvailable(){return this.initialized&&!this.initError}getInitError(){return this.initError}}async function bw(e){const t=new DataView(e);let n=0;const a=function(e,t){const n=Nw(e,t,17);if("Extended Module: "!==n)throw new Error("Invalid XM file: incorrect header signature");const a=Nw(e,t+17,20).trim();t+=38;const s=Nw(e,t,20).trim();t+=20;const r=e.getUint16(t,!0);t+=2;const o=e.getUint32(t,!0);t+=4;const i=e.getUint16(t,!0);t+=2;const l=e.getUint16(t,!0);t+=2;const c=e.getUint16(t,!0);t+=2;const d=e.getUint16(t,!0);t+=2;const u=e.getUint16(t,!0);t+=2;const p=e.getUint16(t,!0);t+=2;const h=e.getUint16(t,!0);t+=2;const m=e.getUint16(t,!0);t+=2;const f=[];for(let y=0;y<256;y++)f.push(e.getUint8(t+y));return{idText:n,moduleName:a,trackerName:s,versionNumber:r,headerSize:o,songLength:i,restartPosition:l,channelCount:c,patternCount:d,instrumentCount:u,flags:p,defaultTempo:h,defaultBPM:m,patternOrderTable:f}}(t,n);n+=a.headerSize;const s=[];for(let i=0;i<a.patternCount;i++){const e=xw(t,n,a.channelCount);s.push(e.notes),n+=e.totalSize}const r=[];for(let i=0;i<a.instrumentCount;i++){const e=ww(t,n);e.parsed.id=i+1,e.parsed.samples.forEach((e,t)=>{e.id=i+1}),r.push(e.parsed),n+=e.totalSize}const o={sourceFormat:"XM",sourceFile:a.moduleName,importedAt:(new Date).toISOString(),originalChannelCount:a.channelCount,originalPatternCount:a.patternCount,originalInstrumentCount:a.instrumentCount,modData:{moduleType:"XM",initialSpeed:a.defaultTempo,initialBPM:a.defaultBPM,amigaPeriods:!(1&a.flags),channelNames:Array.from({length:a.channelCount},(e,t)=>`Channel ${t+1}`),songLength:a.songLength,restartPosition:a.restartPosition,patternOrderTable:a.patternOrderTable},xmData:{frequencyType:1&a.flags?"linear":"amiga",defaultPanning:Array.from({length:a.channelCount},()=>128)},originalSamples:{},envelopes:{}};return r.forEach(e=>{e.samples.forEach(e=>{o.originalSamples[e.id]=e}),o.envelopes[e.id]={volumeEnvelope:e.volumeEnvelope,panningEnvelope:e.panningEnvelope,autoVibrato:e.autoVibrato,fadeout:e.fadeout}}),{header:a,patterns:s,instruments:r,metadata:o}}function xw(e,t,n){const a=t;e.getUint32(t,!0),t+=4,e.getUint8(t),t+=1;const s=e.getUint16(t,!0)||64;t+=2;const r=e.getUint16(t,!0);t+=2;const o=[],i=new Uint8Array(e.buffer,t,r);t+=r;let l=0;for(let c=0;c<s;c++){const e=[];for(let t=0;t<n;t++){const t={note:0,instrument:0,volume:0,effectType:0,effectParam:0};if(l>=i.length){e.push(t);continue}const n=i[l++];128&n?(1&n&&(t.note=i[l++]),2&n&&(t.instrument=i[l++]),4&n&&(t.volume=i[l++]),8&n&&(t.effectType=i[l++]),16&n&&(t.effectParam=i[l++])):(t.note=n,t.instrument=i[l++],t.volume=i[l++],t.effectType=i[l++],t.effectParam=i[l++]),e.push(t)}o.push(e)}return{notes:o,totalSize:t-a}}function ww(e,t){const n=t,a=e.getUint32(t,!0),s=Nw(e,t+=4,22).trim();t+=22,e.getUint8(t),t+=1;const r=e.getUint16(t,!0);t+=2;let o,i,l,c=0,d=[],u=0;if(r>0){c=e.getUint32(t,!0),t+=4,d=[];for(let o=0;o<96;o++)d.push(e.getUint8(t+o));o=kw(e,t+=96),i=kw(e,t+=48),t+=48;const n=e.getUint8(t);t+=1;const a=e.getUint8(t);t+=1,o.enabled=!!(1&n),i.enabled=!!(1&a);const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const p=e.getUint8(t);t+=1;const h=e.getUint8(t);t+=1,l={type:["sine","square","rampDown","rampUp"][s],sweep:r,depth:p,rate:h},u=e.getUint16(t,!0),t+=2,t+=22}t=n+a;const p=[];for(let m=0;m<r;m++)p.push(Sw(e,t)),t+=c;const h=[];for(let m=0;m<r;m++){const n=p[m],a=Mw(e,t,n);t+=n.length,h.push({id:m,name:n.name,pcmData:a,loopStart:n.loopStart/(16&n.type?2:1),loopLength:n.loopLength/(16&n.type?2:1),loopType:3&n.type?1==(3&n.type)?"forward":"pingpong":"none",volume:n.volume,finetune:n.finetune,relativeNote:n.relativeNote,panning:n.panning,bitDepth:16&n.type?16:8,sampleRate:44100,length:n.length/(16&n.type?2:1)})}return{parsed:{id:0,name:s,samples:h,volumeEnvelope:o,panningEnvelope:i,autoVibrato:l,fadeout:u,volumeType:"envelope",panningType:"envelope"},totalSize:t-n}}function kw(e,t){const n=[];for(let i=0;i<12;i++){const a=e.getUint16(t+4*i,!0),s=e.getUint16(t+4*i+2,!0);n.push({tick:a,value:s})}const a=e.getUint8(t+48),s=e.getUint8(t+49),r=e.getUint8(t+50),o=e.getUint8(t+51);return{enabled:!1,points:n.slice(0,a),sustainPoint:a>0?s:null,loopStartPoint:a>0?r:null,loopEndPoint:a>0?o:null}}function Sw(e,t){return{length:e.getUint32(t,!0),loopStart:e.getUint32(t+4,!0),loopLength:e.getUint32(t+8,!0),volume:e.getUint8(t+12),finetune:e.getInt8(t+13),type:e.getUint8(t+14),panning:e.getUint8(t+15),relativeNote:e.getInt8(t+16),reserved:e.getUint8(t+17),name:Nw(e,t+18,22).trim()}}function Mw(e,t,n){const a=!!(16&n.type),s=n.length;if(a){const n=new Int16Array(s/2);let a=0;for(let s=0;s<n.length;s++){a+=e.getInt16(t+2*s,!0),n[s]=a}return n.buffer}{const n=new Int8Array(s);let a=0;for(let s=0;s<n.length;s++){a+=e.getInt8(t+s),n[s]=a}return n.buffer}}function Nw(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e.getUint8(t+s);if(0===n)break;a.push(n)}return String.fromCharCode(...a)}const Cw={"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,"4CHN":4,"6CHN":6,"8CHN":8,OCTA:8,CD81:8,"2CHN":2,TDZ1:1,TDZ2:2,TDZ3:3};async function Ew(e){const t=new DataView(e);let n=0;const a=function(e){let t=0;const n=Aw(e,t,20).trim();t+=20;const a=[];for(let c=0;c<31;c++){const n=Aw(e,t,22).trim(),s=e.getUint16(t+22,!1),r=15&e.getUint8(t+24),o=Math.min(e.getUint8(t+25),64),i=e.getUint16(t+26,!1),l=e.getUint16(t+28,!1);a.push({name:n,length:s,finetune:r>7?r-16:r,volume:o,loopStart:i,loopLength:l}),t+=30}const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const o=[];let i=0;for(let c=0;c<128;c++){const n=e.getUint8(t+c);o.push(n),c<s&&n>i&&(i=n)}t+=128;const l=Aw(e,t,4);return{title:n,samples:a,songLength:s,restartPosition:r,patternOrderTable:o,formatTag:l,channelCount:Cw[l]||4,patternCount:i+1}}(t);n=1084;const s=[];for(let c=0;c<a.patternCount;c++){const e=Pw(t,n,a.channelCount);s.push(e),n+=64*a.channelCount*4}const{initialSpeed:r,initialBPM:o}=function(e,t){let n=6,a=125,s=!1,r=!1;const o=[];for(let d=0;d<e.length;d++){const t=e[d];if(t)for(let e=0;e<t.length;e++){const n=t[e];if(n)for(let t=0;t<n.length;t++){const a=n[t];15===a.effect&&0!==a.effectParam&&o.push({pat:d,row:e,ch:t,param:a.effectParam})}}}o.length;const i=t[0],l=e[i];if(!l)return{initialSpeed:n,initialBPM:a};const c=Math.min(16,l.length);for(let d=0;d<c&&(!s||!r);d++){const e=l[d];if(e)for(const t of e)if(15===t.effect){const e=t.effectParam;if(0===e)continue;e<32?s||(n=e,s=!0):r||(a=e,r=!0)}}return{initialSpeed:n,initialBPM:a}}(s,a.patternOrderTable),i=[];for(let c=0;c<31;c++){const e=a.samples[c];if(0===e.length)continue;const s=Tw(t,n,e);n+=2*e.length;const r=2*e.loopStart,o=2*e.loopLength,l=c+1,d={id:l,name:e.name,pcmData:s,loopStart:r,loopLength:o,loopType:e.loopLength>1?"forward":"none",volume:e.volume,finetune:e.finetune,relativeNote:0,panning:128,bitDepth:8,sampleRate:8363,length:2*e.length};i.push({id:l,name:e.name,samples:[d],fadeout:0,volumeType:"none",panningType:"none"})}const l={sourceFormat:"MOD",sourceFile:a.title,importedAt:(new Date).toISOString(),originalChannelCount:a.channelCount,originalPatternCount:a.patternCount,originalInstrumentCount:i.length,modData:{moduleType:a.formatTag,initialSpeed:r,initialBPM:o,amigaPeriods:!0,channelNames:Array.from({length:a.channelCount},(e,t)=>`Channel ${t+1}`),songLength:a.songLength,restartPosition:a.restartPosition,patternOrderTable:a.patternOrderTable},originalSamples:{},envelopes:{}};return i.forEach(e=>{e.samples.forEach(e=>{l.originalSamples[e.id]=e})}),{header:a,patterns:s,instruments:i,metadata:l}}function Pw(e,t,n){const a=[];for(let s=0;s<64;s++){const s=[];for(let a=0;a<n;a++){const n=e.getUint8(t++),a=e.getUint8(t++),r=e.getUint8(t++),o=(15&n)<<8|a,i=240&n|(240&r)>>4,l=15&r,c=e.getUint8(t++);s.push({period:o,instrument:i,effect:l,effectParam:c})}a.push(s)}return a}function Tw(e,t,n){const a=2*n.length,s=new Int8Array(a);for(let r=0;r<a;r++)s[r]=e.getInt8(t+r);return s.buffer}function Aw(e,t,n){const a=[];for(let s=0;s<n;s++){const n=e.getUint8(t+s);if(0===n)break;a.push(n)}return String.fromCharCode(...a)}function _w(e){let t=e.length;for(;--t>=0;)e[t]=0}const Iw=256,Dw=286,Ow=30,Fw=15,Rw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jw=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Lw=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Bw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vw=new Array(576);_w(Vw);const zw=new Array(60);_w(zw);const Uw=new Array(512);_w(Uw);const Gw=new Array(256);_w(Gw);const Ww=new Array(29);_w(Ww);const Kw=new Array(Ow);function Hw(e,t,n,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}let $w,qw,Yw;function Xw(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}_w(Kw);const Qw=e=>e<256?Uw[e]:Uw[256+(e>>>7)],Zw=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Jw=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Zw(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ek=(e,t,n)=>{Jw(e,n[2*t],n[2*t+1])},tk=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},nk=(e,t,n)=>{const a=new Array(16);let s,r,o=0;for(s=1;s<=Fw;s++)o=o+n[s-1]<<1,a[s]=o;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=tk(a[t]++,t))}},ak=e=>{let t;for(t=0;t<Dw;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ow;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},sk=e=>{e.bi_valid>8?Zw(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},rk=(e,t,n,a)=>{const s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&a[t]<=a[n]},ok=(e,t,n)=>{const a=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&rk(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!rk(t,a,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=a},ik=(e,t,n)=>{let a,s,r,o,i=0;if(0!==e.sym_next)do{a=255&e.pending_buf[e.sym_buf+i++],a+=(255&e.pending_buf[e.sym_buf+i++])<<8,s=e.pending_buf[e.sym_buf+i++],0===a?ek(e,s,t):(r=Gw[s],ek(e,r+Iw+1,t),o=Rw[r],0!==o&&(s-=Ww[r],Jw(e,s,o)),a--,r=Qw(a),ek(e,r,n),o=jw[r],0!==o&&(a-=Kw[r],Jw(e,a,o)))}while(i<e.sym_next);ek(e,256,t)},lk=(e,t)=>{const n=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,i,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<r;o++)0!==n[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=a[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)ok(e,n,o);l=r;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ok(e,n,1),i=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=i,n[2*l]=n[2*o]+n[2*i],e.depth[l]=(e.depth[o]>=e.depth[i]?e.depth[o]:e.depth[i])+1,n[2*o+1]=n[2*i+1]=l,e.heap[1]=l++,ok(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,a=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,i=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,u,p,h,m,f=0;for(p=0;p<=Fw;p++)e.bl_count[p]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],p=n[2*n[2*d+1]+1]+1,p>l&&(p=l,f++),n[2*d+1]=p,d>a||(e.bl_count[p]++,h=0,d>=i&&(h=o[d-i]),m=n[2*d],e.opt_len+=m*(p+h),r&&(e.static_len+=m*(s[2*d+1]+h)));if(0!==f){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(p=l;0!==p;p--)for(d=e.bl_count[p];0!==d;)u=e.heap[--c],u>a||(n[2*u+1]!==p&&(e.opt_len+=(p-n[2*u+1])*n[2*u],n[2*u+1]=p),d--)}})(e,t),nk(n,c,e.bl_count)},ck=(e,t,n)=>{let a,s,r=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)s=o,o=t[2*(a+1)+1],++i<l&&s===o||(i<c?e.bl_tree[2*s]+=i:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):i<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4))},dk=(e,t,n)=>{let a,s,r=-1,o=t[1],i=0,l=7,c=4;for(0===o&&(l=138,c=3),a=0;a<=n;a++)if(s=o,o=t[2*(a+1)+1],!(++i<l&&s===o)){if(i<c)do{ek(e,s,e.bl_tree)}while(0!==--i);else 0!==s?(s!==r&&(ek(e,s,e.bl_tree),i--),ek(e,16,e.bl_tree),Jw(e,i-3,2)):i<=10?(ek(e,17,e.bl_tree),Jw(e,i-3,3)):(ek(e,18,e.bl_tree),Jw(e,i-11,7));i=0,r=s,0===o?(l=138,c=3):s===o?(l=6,c=3):(l=7,c=4)}};let uk=!1;const pk=(e,t,n,a)=>{Jw(e,0+(a?1:0),3),sk(e),Zw(e,n),Zw(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var hk={_tr_init:e=>{uk||((()=>{let e,t,n,a,s;const r=new Array(16);for(n=0,a=0;a<28;a++)for(Ww[a]=n,e=0;e<1<<Rw[a];e++)Gw[n++]=a;for(Gw[n-1]=a,s=0,a=0;a<16;a++)for(Kw[a]=s,e=0;e<1<<jw[a];e++)Uw[s++]=a;for(s>>=7;a<Ow;a++)for(Kw[a]=s<<7,e=0;e<1<<jw[a]-7;e++)Uw[256+s++]=a;for(t=0;t<=Fw;t++)r[t]=0;for(e=0;e<=143;)Vw[2*e+1]=8,e++,r[8]++;for(;e<=255;)Vw[2*e+1]=9,e++,r[9]++;for(;e<=279;)Vw[2*e+1]=7,e++,r[7]++;for(;e<=287;)Vw[2*e+1]=8,e++,r[8]++;for(nk(Vw,287,r),e=0;e<Ow;e++)zw[2*e+1]=5,zw[2*e]=tk(e,5);$w=new Hw(Vw,Rw,257,Dw,Fw),qw=new Hw(zw,jw,0,Ow,Fw),Yw=new Hw(new Array(0),Lw,0,19,7)})(),uk=!0),e.l_desc=new Xw(e.dyn_ltree,$w),e.d_desc=new Xw(e.dyn_dtree,qw),e.bl_desc=new Xw(e.bl_tree,Yw),e.bi_buf=0,e.bi_valid=0,ak(e)},_tr_stored_block:pk,_tr_flush_block:(e,t,n,a)=>{let s,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Iw;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),lk(e,e.l_desc),lk(e,e.d_desc),o=(e=>{let t;for(ck(e,e.dyn_ltree,e.l_desc.max_code),ck(e,e.dyn_dtree,e.d_desc.max_code),lk(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Bw[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?pk(e,t,n,a):4===e.strategy||r===s?(Jw(e,2+(a?1:0),3),ik(e,Vw,zw)):(Jw(e,4+(a?1:0),3),((e,t,n,a)=>{let s;for(Jw(e,t-257,5),Jw(e,n-1,5),Jw(e,a-4,4),s=0;s<a;s++)Jw(e,e.bl_tree[2*Bw[s]+1],3);dk(e,e.dyn_ltree,t-1),dk(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ik(e,e.dyn_ltree,e.dyn_dtree)),ak(e),a&&sk(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Gw[n]+Iw+1)]++,e.dyn_dtree[2*Qw(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Jw(e,2,3),ek(e,256,Vw),(e=>{16===e.bi_valid?(Zw(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var mk=(e,t,n,a)=>{let s=65535&e,r=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{s=s+t[a++]|0,r=r+s|0}while(--o);s%=65521,r%=65521}return s|r<<16};const fk=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var yk=(e,t,n,a)=>{const s=fk,r=a+n;e^=-1;for(let o=a;o<r;o++)e=e>>>8^s[255&(e^t[o])];return-1^e},gk={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vk={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:bk,_tr_stored_block:xk,_tr_flush_block:wk,_tr_tally:kk,_tr_align:Sk}=hk,{Z_NO_FLUSH:Mk,Z_PARTIAL_FLUSH:Nk,Z_FULL_FLUSH:Ck,Z_FINISH:Ek,Z_BLOCK:Pk,Z_OK:Tk,Z_STREAM_END:Ak,Z_STREAM_ERROR:_k,Z_DATA_ERROR:Ik,Z_BUF_ERROR:Dk,Z_DEFAULT_COMPRESSION:Ok,Z_FILTERED:Fk,Z_HUFFMAN_ONLY:Rk,Z_RLE:jk,Z_FIXED:Lk,Z_DEFAULT_STRATEGY:Bk,Z_UNKNOWN:Vk,Z_DEFLATED:zk}=vk,Uk=258,Gk=262,Wk=42,Kk=113,Hk=666,$k=(e,t)=>(e.msg=gk[t],t),qk=e=>2*e-(e>4?9:0),Yk=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Xk=e=>{let t,n,a,s=e.w_size;t=e.hash_size,a=t;do{n=e.head[--a],e.head[a]=n>=s?n-s:0}while(--t);t=s,a=t;do{n=e.prev[--a],e.prev[a]=n>=s?n-s:0}while(--t)};let Qk=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Zk=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Jk=(e,t)=>{wk(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Zk(e.strm)},eS=(e,t)=>{e.pending_buf[e.pending++]=t},tS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},nS=(e,t,n,a)=>{let s=e.avail_in;return s>a&&(s=a),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=mk(e.adler,t,s,n):2===e.state.wrap&&(e.adler=yk(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},aS=(e,t)=>{let n,a,s=e.max_chain_length,r=e.strstart,o=e.prev_length,i=e.nice_match;const l=e.strstart>e.w_size-Gk?e.strstart-(e.w_size-Gk):0,c=e.window,d=e.w_mask,u=e.prev,p=e.strstart+Uk;let h=c[r+o-1],m=c[r+o];e.prev_length>=e.good_match&&(s>>=2),i>e.lookahead&&(i=e.lookahead);do{if(n=t,c[n+o]===m&&c[n+o-1]===h&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<p);if(a=Uk-(p-r),r=p-Uk,a>o){if(e.match_start=t,o=a,a>=i)break;h=c[r+o-1],m=c[r+o]}}}while((t=u[t&d])>l&&0!==--s);return o<=e.lookahead?o:e.lookahead},sS=e=>{const t=e.w_size;let n,a,s;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Gk)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Xk(e),a+=t),0===e.strm.avail_in)break;if(n=nS(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Qk(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Qk(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Gk&&0!==e.strm.avail_in)},rS=(e,t)=>{let n,a,s,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,i=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<r&&(0===n&&t!==Ek||t===Mk||n!==a+e.strm.avail_in))break;o=t===Ek&&n===a+e.strm.avail_in?1:0,xk(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Zk(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(nS(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return i-=e.strm.avail_in,i&&(i>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=i&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-i,e.strm.next_in),e.strstart),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Mk&&t!==Ek&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(nS(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=r||(a||t===Ek)&&t!==Mk&&0===e.strm.avail_in&&a<=s)&&(n=a>s?s:a,o=t===Ek&&0===e.strm.avail_in&&n===a?1:0,xk(e,e.block_start,n,o),e.block_start+=n,Zk(e.strm)),o?3:1)},oS=(e,t)=>{let n,a;for(;;){if(e.lookahead<Gk){if(sS(e),e.lookahead<Gk&&t===Mk)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Gk&&(e.match_length=aS(e,n)),e.match_length>=3)if(a=kk(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+1]);else a=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2},iS=(e,t)=>{let n,a,s;for(;;){if(e.lookahead<Gk){if(sS(e),e.lookahead<Gk&&t===Mk)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Gk&&(e.match_length=aS(e,n),e.match_length<=5&&(e.strategy===Fk||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,a=kk(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=Qk(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Jk(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=kk(e,0,e.window[e.strstart-1]),a&&Jk(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=kk(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2};function lS(e,t,n,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=s}const cS=[new lS(0,0,0,0,rS),new lS(4,4,8,4,oS),new lS(4,5,16,8,oS),new lS(4,6,32,32,oS),new lS(4,4,16,16,iS),new lS(8,16,32,32,iS),new lS(8,16,128,128,iS),new lS(8,32,128,256,iS),new lS(32,128,258,1024,iS),new lS(32,258,258,4096,iS)];function dS(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=zk,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Yk(this.dyn_ltree),Yk(this.dyn_dtree),Yk(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Yk(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Yk(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const uS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Wk&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Kk&&t.status!==Hk?1:0},pS=e=>{if(uS(e))return $k(e,_k);e.total_in=e.total_out=0,e.data_type=Vk;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Wk:Kk,e.adler=2===t.wrap?0:1,t.last_flush=-2,bk(t),Tk},hS=e=>{const t=pS(e);var n;return t===Tk&&((n=e.state).window_size=2*n.w_size,Yk(n.head),n.max_lazy_match=cS[n.level].max_lazy,n.good_match=cS[n.level].good_length,n.nice_match=cS[n.level].nice_length,n.max_chain_length=cS[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},mS=(e,t,n,a,s,r)=>{if(!e)return _k;let o=1;if(t===Ok&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),s<1||s>9||n!==zk||a<8||a>15||t<0||t>9||r<0||r>Lk||8===a&&1!==o)return $k(e,_k);8===a&&(a=9);const i=new dS;return e.state=i,i.strm=e,i.status=Wk,i.wrap=o,i.gzhead=null,i.w_bits=a,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=s+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<s+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=t,i.strategy=r,i.method=n,hS(e)};var fS={deflateInit:(e,t)=>mS(e,t,zk,15,8,Bk),deflateInit2:mS,deflateReset:hS,deflateResetKeep:pS,deflateSetHeader:(e,t)=>uS(e)||2!==e.state.wrap?_k:(e.state.gzhead=t,Tk),deflate:(e,t)=>{if(uS(e)||t>Pk||t<0)return e?$k(e,_k):_k;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Hk&&t!==Ek)return $k(e,0===e.avail_out?Dk:_k);const a=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Zk(e),0===e.avail_out)return n.last_flush=-1,Tk}else if(0===e.avail_in&&qk(t)<=qk(a)&&t!==Ek)return $k(e,Dk);if(n.status===Hk&&0!==e.avail_in)return $k(e,Dk);if(n.status===Wk&&0===n.wrap&&(n.status=Kk),n.status===Wk){let t=zk+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Rk||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=a<<6,0!==n.strstart&&(t|=32),t+=31-t%31,tS(n,t),0!==n.strstart&&(tS(n,e.adler>>>16),tS(n,65535&e.adler)),e.adler=1,n.status=Kk,Zk(e),0!==n.pending)return n.last_flush=-1,Tk}if(57===n.status)if(e.adler=0,eS(n,31),eS(n,139),eS(n,8),n.gzhead)eS(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),eS(n,255&n.gzhead.time),eS(n,n.gzhead.time>>8&255),eS(n,n.gzhead.time>>16&255),eS(n,n.gzhead.time>>24&255),eS(n,9===n.level?2:n.strategy>=Rk||n.level<2?4:0),eS(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(eS(n,255&n.gzhead.extra.length),eS(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=yk(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(eS(n,0),eS(n,0),eS(n,0),eS(n,0),eS(n,0),eS(n,9===n.level?2:n.strategy>=Rk||n.level<2?4:0),eS(n,3),n.status=Kk,Zk(e),0!==n.pending)return n.last_flush=-1,Tk;if(69===n.status){if(n.gzhead.extra){let t=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=yk(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,Zk(e),0!==n.pending)return n.last_flush=-1,Tk;t=0,a-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>t&&(e.adler=yk(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=yk(e.adler,n.pending_buf,n.pending-a,a)),Zk(e),0!==n.pending)return n.last_flush=-1,Tk;a=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,eS(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=yk(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=yk(e.adler,n.pending_buf,n.pending-a,a)),Zk(e),0!==n.pending)return n.last_flush=-1,Tk;a=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,eS(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=yk(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Zk(e),0!==n.pending))return n.last_flush=-1,Tk;eS(n,255&e.adler),eS(n,e.adler>>8&255),e.adler=0}if(n.status=Kk,Zk(e),0!==n.pending)return n.last_flush=-1,Tk}if(0!==e.avail_in||0!==n.lookahead||t!==Mk&&n.status!==Hk){let a=0===n.level?rS(n,t):n.strategy===Rk?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(sS(e),0===e.lookahead)){if(t===Mk)return 1;break}if(e.match_length=0,n=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===jk?((e,t)=>{let n,a,s,r;const o=e.window;for(;;){if(e.lookahead<=Uk){if(sS(e),e.lookahead<=Uk&&t===Mk)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,a=o[s],a===o[++s]&&a===o[++s]&&a===o[++s])){r=e.strstart+Uk;do{}while(a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&a===o[++s]&&s<r);e.match_length=Uk-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=kk(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=kk(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Jk(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ek?(Jk(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Jk(e,!1),0===e.strm.avail_out)?1:2})(n,t):cS[n.level].func(n,t);if(3!==a&&4!==a||(n.status=Hk),1===a||3===a)return 0===e.avail_out&&(n.last_flush=-1),Tk;if(2===a&&(t===Nk?Sk(n):t!==Pk&&(xk(n,0,0,!1),t===Ck&&(Yk(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Zk(e),0===e.avail_out))return n.last_flush=-1,Tk}return t!==Ek?Tk:n.wrap<=0?Ak:(2===n.wrap?(eS(n,255&e.adler),eS(n,e.adler>>8&255),eS(n,e.adler>>16&255),eS(n,e.adler>>24&255),eS(n,255&e.total_in),eS(n,e.total_in>>8&255),eS(n,e.total_in>>16&255),eS(n,e.total_in>>24&255)):(tS(n,e.adler>>>16),tS(n,65535&e.adler)),Zk(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Tk:Ak)},deflateEnd:e=>{if(uS(e))return _k;const t=e.state.status;return e.state=null,t===Kk?$k(e,Ik):Tk},deflateSetDictionary:(e,t)=>{let n=t.length;if(uS(e))return _k;const a=e.state,s=a.wrap;if(2===s||1===s&&a.status!==Wk||a.lookahead)return _k;if(1===s&&(e.adler=mk(e.adler,t,n,0)),a.wrap=0,n>=a.w_size){0===s&&(Yk(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(n-a.w_size,n),0),t=e,n=a.w_size}const r=e.avail_in,o=e.next_in,i=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,sS(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=Qk(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,sS(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=o,e.input=i,e.avail_in=r,a.wrap=s,Tk},deflateInfo:"pako deflate (from Nodeca project)"};const yS=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var gS=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)yS(n,t)&&(e[t]=n[t])}}return e},vS=e=>{let t=0;for(let a=0,s=e.length;a<s;a++)t+=e[a].length;const n=new Uint8Array(t);for(let a=0,s=0,r=e.length;a<r;a++){let t=e[a];n.set(t,s),s+=t.length}return n};let bS=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(SA){bS=!1}const xS=new Uint8Array(256);for(let MA=0;MA<256;MA++)xS[MA]=MA>=252?6:MA>=248?5:MA>=240?4:MA>=224?3:MA>=192?2:1;xS[254]=xS[254]=1;var wS=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,a,s,r,o=e.length,i=0;for(s=0;s<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),i+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(i),r=0,s=0;r<i;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<o&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),n<128?t[r++]=n:n<2048?(t[r++]=192|n>>>6,t[r++]=128|63&n):n<65536?(t[r++]=224|n>>>12,t[r++]=128|n>>>6&63,t[r++]=128|63&n):(t[r++]=240|n>>>18,t[r++]=128|n>>>12&63,t[r++]=128|n>>>6&63,t[r++]=128|63&n);return t},kS=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,s;const r=new Array(2*n);for(s=0,a=0;a<n;){let t=e[a++];if(t<128){r[s++]=t;continue}let o=xS[t];if(o>4)r[s++]=65533,a+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&a<n;)t=t<<6|63&e[a++],o--;o>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&bS)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n})(r,s)},SS=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+xS[e[n]]>t?n:t};var MS=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const NS=Object.prototype.toString,{Z_NO_FLUSH:CS,Z_SYNC_FLUSH:ES,Z_FULL_FLUSH:PS,Z_FINISH:TS,Z_OK:AS,Z_STREAM_END:_S,Z_DEFAULT_COMPRESSION:IS,Z_DEFAULT_STRATEGY:DS,Z_DEFLATED:OS}=vk;function FS(e){this.options=gS({level:IS,method:OS,chunkSize:16384,windowBits:15,memLevel:8,strategy:DS},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MS,this.strm.avail_out=0;let n=fS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==AS)throw new Error(gk[n]);if(t.header&&fS.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?wS(t.dictionary):"[object ArrayBuffer]"===NS.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=fS.deflateSetDictionary(this.strm,e),n!==AS)throw new Error(gk[n]);this._dict_set=!0}}function RS(e,t){const n=new FS(t);if(n.push(e,!0),n.err)throw n.msg||gk[n.err];return n.result}FS.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?TS:CS,"string"==typeof e?n.input=wS(e):"[object ArrayBuffer]"===NS.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),(r===ES||r===PS)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=fS.deflate(n,r),s===_S)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=fS.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===AS;if(0!==n.avail_out){if(r>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},FS.prototype.onData=function(e){this.chunks.push(e)},FS.prototype.onEnd=function(e){e===AS&&(this.result=vS(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jS={Deflate:FS,deflate:RS,deflateRaw:function(e,t){return(t=t||{}).raw=!0,RS(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,RS(e,t)}};const LS=16209;var BS=function(e,t){let n,a,s,r,o,i,l,c,d,u,p,h,m,f,y,g,v,b,x,w,k,S,M,N;const C=e.state;n=e.next_in,M=e.input,a=n+(e.avail_in-5),s=e.next_out,N=e.output,r=s-(t-e.avail_out),o=s+(e.avail_out-257),i=C.dmax,l=C.wsize,c=C.whave,d=C.wnext,u=C.window,p=C.hold,h=C.bits,m=C.lencode,f=C.distcode,y=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;e:do{h<15&&(p+=M[n++]<<h,h+=8,p+=M[n++]<<h,h+=8),v=m[p&y];t:for(;;){if(b=v>>>24,p>>>=b,h-=b,b=v>>>16&255,0===b)N[s++]=65535&v;else{if(!(16&b)){if(64&b){if(32&b){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=LS;break e}v=m[(65535&v)+(p&(1<<b)-1)];continue t}for(x=65535&v,b&=15,b&&(h<b&&(p+=M[n++]<<h,h+=8),x+=p&(1<<b)-1,p>>>=b,h-=b),h<15&&(p+=M[n++]<<h,h+=8,p+=M[n++]<<h,h+=8),v=f[p&g];;){if(b=v>>>24,p>>>=b,h-=b,b=v>>>16&255,16&b){if(w=65535&v,b&=15,h<b&&(p+=M[n++]<<h,h+=8,h<b&&(p+=M[n++]<<h,h+=8)),w+=p&(1<<b)-1,w>i){e.msg="invalid distance too far back",C.mode=LS;break e}if(p>>>=b,h-=b,b=s-r,w>b){if(b=w-b,b>c&&C.sane){e.msg="invalid distance too far back",C.mode=LS;break e}if(k=0,S=u,0===d){if(k+=l-b,b<x){x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}}else if(d<b){if(k+=l+d-b,b-=d,b<x){x-=b;do{N[s++]=u[k++]}while(--b);if(k=0,d<x){b=d,x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}}}else if(k+=d-b,b<x){x-=b;do{N[s++]=u[k++]}while(--b);k=s-w,S=N}for(;x>2;)N[s++]=S[k++],N[s++]=S[k++],N[s++]=S[k++],x-=3;x&&(N[s++]=S[k++],x>1&&(N[s++]=S[k++]))}else{k=s-w;do{N[s++]=N[k++],N[s++]=N[k++],N[s++]=N[k++],x-=3}while(x>2);x&&(N[s++]=N[k++],x>1&&(N[s++]=N[k++]))}break}if(64&b){e.msg="invalid distance code",C.mode=LS;break e}v=f[(65535&v)+(p&(1<<b)-1)]}}break}}while(n<a&&s<o);x=h>>3,n-=x,h-=x<<3,p&=(1<<h)-1,e.next_in=n,e.next_out=s,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=s<o?o-s+257:257-(s-o),C.hold=p,C.bits=h};const VS=15,zS=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),US=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),GS=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),WS=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var KS=(e,t,n,a,s,r,o,i)=>{const l=i.bits;let c,d,u,p,h,m,f=0,y=0,g=0,v=0,b=0,x=0,w=0,k=0,S=0,M=0,N=null;const C=new Uint16Array(16),E=new Uint16Array(16);let P,T,A,_=null;for(f=0;f<=VS;f++)C[f]=0;for(y=0;y<a;y++)C[t[n+y]]++;for(b=l,v=VS;v>=1&&0===C[v];v--);if(b>v&&(b=v),0===v)return s[r++]=20971520,s[r++]=20971520,i.bits=1,0;for(g=1;g<v&&0===C[g];g++);for(b<g&&(b=g),k=1,f=1;f<=VS;f++)if(k<<=1,k-=C[f],k<0)return-1;if(k>0&&(0===e||1!==v))return-1;for(E[1]=0,f=1;f<VS;f++)E[f+1]=E[f]+C[f];for(y=0;y<a;y++)0!==t[n+y]&&(o[E[t[n+y]]++]=y);if(0===e?(N=_=o,m=20):1===e?(N=zS,_=US,m=257):(N=GS,_=WS,m=0),M=0,y=0,f=g,h=r,x=b,w=0,u=-1,S=1<<b,p=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){P=f-w,o[y]+1<m?(T=0,A=o[y]):o[y]>=m?(T=_[o[y]-m],A=N[o[y]-m]):(T=96,A=0),c=1<<f-w,d=1<<x,g=d;do{d-=c,s[h+(M>>w)+d]=P<<24|T<<16|A}while(0!==d);for(c=1<<f-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,y++,0===--C[f]){if(f===v)break;f=t[n+o[y]]}if(f>b&&(M&p)!==u){for(0===w&&(w=b),h+=g,x=f-w,k=1<<x;x+w<v&&(k-=C[x+w],!(k<=0));)x++,k<<=1;if(S+=1<<x,1===e&&S>852||2===e&&S>592)return 1;u=M&p,s[u]=b<<24|x<<16|h-r}}return 0!==M&&(s[h+M]=f-w<<24|64<<16),i.bits=b,0};const{Z_FINISH:HS,Z_BLOCK:$S,Z_TREES:qS,Z_OK:YS,Z_STREAM_END:XS,Z_NEED_DICT:QS,Z_STREAM_ERROR:ZS,Z_DATA_ERROR:JS,Z_MEM_ERROR:eM,Z_BUF_ERROR:tM,Z_DEFLATED:nM}=vk,aM=16180,sM=16190,rM=16191,oM=16192,iM=16194,lM=16199,cM=16200,dM=16206,uM=16209,pM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function hM(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mM=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<aM||t.mode>16211?1:0},fM=e=>{if(mM(e))return ZS;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=aM,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,YS},yM=e=>{if(mM(e))return ZS;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,fM(e)},gM=(e,t)=>{let n;if(mM(e))return ZS;const a=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ZS:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,yM(e))},vM=(e,t)=>{if(!e)return ZS;const n=new hM;e.state=n,n.strm=e,n.window=null,n.mode=aM;const a=gM(e,t);return a!==YS&&(e.state=null),a};let bM,xM,wM=!0;const kM=e=>{if(wM){bM=new Int32Array(512),xM=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(KS(1,e.lens,0,288,bM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;KS(2,e.lens,0,32,xM,0,e.work,{bits:5}),wM=!1}e.lencode=bM,e.lenbits=9,e.distcode=xM,e.distbits=5},SM=(e,t,n,a)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),a>=r.wsize?(r.window.set(t.subarray(n-r.wsize,n),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>a&&(s=a),r.window.set(t.subarray(n-a,n-a+s),r.wnext),(a-=s)?(r.window.set(t.subarray(n-a,n),0),r.wnext=a,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var MM={inflateReset:yM,inflateReset2:gM,inflateResetKeep:fM,inflateInit:e=>vM(e,15),inflateInit2:vM,inflate:(e,t)=>{let n,a,s,r,o,i,l,c,d,u,p,h,m,f,y,g,v,b,x,w,k,S,M=0;const N=new Uint8Array(4);let C,E;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mM(e)||!e.output||!e.input&&0!==e.avail_in)return ZS;n=e.state,n.mode===rM&&(n.mode=oM),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,i=e.avail_in,c=n.hold,d=n.bits,u=i,p=l,S=YS;e:for(;;)switch(n.mode){case aM:if(0===n.wrap){n.mode=oM;break}for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,N[0]=255&c,N[1]=c>>>8&255,n.check=yk(n.check,N,2,0),c=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=uM;break}if((15&c)!==nM){e.msg="unknown compression method",n.mode=uM;break}if(c>>>=4,d-=4,k=8+(15&c),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=uM;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:rM,c=0,d=0;break;case 16181:for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==nM){e.msg="unknown compression method",n.mode=uM;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=uM;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=yk(n.check,N,2,0)),c=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,n.check=yk(n.check,N,4,0)),c=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=yk(n.check,N,2,0)),c=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(N[0]=255&c,N[1]=c>>>8&255,n.check=yk(n.check,N,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(h=n.length,h>i&&(h=i),h&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(a.subarray(r,r+h),k)),512&n.flags&&4&n.wrap&&(n.check=yk(n.check,a,h,r)),i-=h,r+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===i)break e;h=0;do{k=a[r+h++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&h<i);if(512&n.flags&&4&n.wrap&&(n.check=yk(n.check,a,h,r)),i-=h,r+=h,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===i)break e;h=0;do{k=a[r+h++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&h<i);if(512&n.flags&&4&n.wrap&&(n.check=yk(n.check,a,h,r)),i-=h,r+=h,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=uM;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=rM;break;case 16189:for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}e.adler=n.check=pM(c),c=0,d=0,n.mode=sM;case sM:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,QS;e.adler=n.check=1,n.mode=rM;case rM:if(t===$S||t===qS)break e;case oM:if(n.last){c>>>=7&d,d-=7&d,n.mode=dM;break}for(;d<3;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=16193;break;case 1:if(kM(n),n.mode=lM,t===qS){c>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=uM}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=uM;break}if(n.length=65535&c,c=0,d=0,n.mode=iM,t===qS)break e;case iM:n.mode=16195;case 16195:if(h=n.length,h){if(h>i&&(h=i),h>l&&(h=l),0===h)break e;s.set(a.subarray(r,r+h),o),i-=h,r+=h,l-=h,o+=h,n.length-=h;break}n.mode=rM;break;case 16196:for(;d<14;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=uM;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.lens[P[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[P[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},S=KS(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid code lengths set",n.mode=uM;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;M=n.lencode[c&(1<<n.lenbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(v<16)c>>>=y,d-=y,n.lens[n.have++]=v;else{if(16===v){for(E=y+2;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(c>>>=y,d-=y,0===n.have){e.msg="invalid bit length repeat",n.mode=uM;break}k=n.lens[n.have-1],h=3+(3&c),c>>>=2,d-=2}else if(17===v){for(E=y+3;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=y,d-=y,k=0,h=3+(7&c),c>>>=3,d-=3}else{for(E=y+7;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=y,d-=y,k=0,h=11+(127&c),c>>>=7,d-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=uM;break}for(;h--;)n.lens[n.have++]=k}}if(n.mode===uM)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=uM;break}if(n.lenbits=9,C={bits:n.lenbits},S=KS(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,S){e.msg="invalid literal/lengths set",n.mode=uM;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},S=KS(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,S){e.msg="invalid distances set",n.mode=uM;break}if(n.mode=lM,t===qS)break e;case lM:n.mode=cM;case cM:if(i>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,BS(e,p),o=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,a=e.input,i=e.avail_in,c=n.hold,d=n.bits,n.mode===rM&&(n.back=-1);break}for(n.back=0;M=n.lencode[c&(1<<n.lenbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(g&&!(240&g)){for(b=y,x=g,w=v;M=n.lencode[w+((c&(1<<b+x)-1)>>b)],y=M>>>24,g=M>>>16&255,v=65535&M,!(b+y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=y,d-=y,n.back+=y,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=rM;break}if(64&g){e.msg="invalid literal/length code",n.mode=uM;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(E=n.extra;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;M=n.distcode[c&(1<<n.distbits)-1],y=M>>>24,g=M>>>16&255,v=65535&M,!(y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(!(240&g)){for(b=y,x=g,w=v;M=n.distcode[w+((c&(1<<b+x)-1)>>b)],y=M>>>24,g=M>>>16&255,v=65535&M,!(b+y<=d);){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=y,d-=y,n.back+=y,64&g){e.msg="invalid distance code",n.mode=uM;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(E=n.extra;d<E;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=uM;break}n.mode=16204;case 16204:if(0===l)break e;if(h=p-l,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=uM;break}h>n.wnext?(h-=n.wnext,m=n.wsize-h):m=n.wnext-h,h>n.length&&(h=n.length),f=n.window}else f=s,m=o-n.offset,h=n.length;h>l&&(h=l),l-=h,n.length-=h;do{s[o++]=f[m++]}while(--h);0===n.length&&(n.mode=cM);break;case 16205:if(0===l)break e;s[o++]=n.length,l--,n.mode=cM;break;case dM:if(n.wrap){for(;d<32;){if(0===i)break e;i--,c|=a[r++]<<d,d+=8}if(p-=l,e.total_out+=p,n.total+=p,4&n.wrap&&p&&(e.adler=n.check=n.flags?yk(n.check,s,p,o-p):mk(n.check,s,p,o-p)),p=l,4&n.wrap&&(n.flags?c:pM(c))!==n.check){e.msg="incorrect data check",n.mode=uM;break}c=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===i)break e;i--,c+=a[r++]<<d,d+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=uM;break}c=0,d=0}n.mode=16208;case 16208:S=XS;break e;case uM:S=JS;break e;case 16210:return eM;default:return ZS}return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=i,n.hold=c,n.bits=d,(n.wsize||p!==e.avail_out&&n.mode<uM&&(n.mode<dM||t!==HS))&&SM(e,e.output,e.next_out,p-e.avail_out),u-=e.avail_in,p-=e.avail_out,e.total_in+=u,e.total_out+=p,n.total+=p,4&n.wrap&&p&&(e.adler=n.check=n.flags?yk(n.check,s,p,e.next_out-p):mk(n.check,s,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===rM?128:0)+(n.mode===lM||n.mode===iM?256:0),(0===u&&0===p||t===HS)&&S===YS&&(S=tM),S},inflateEnd:e=>{if(mM(e))return ZS;let t=e.state;return t.window&&(t.window=null),e.state=null,YS},inflateGetHeader:(e,t)=>{if(mM(e))return ZS;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,YS):ZS},inflateSetDictionary:(e,t)=>{const n=t.length;let a,s,r;return mM(e)?ZS:(a=e.state,0!==a.wrap&&a.mode!==sM?ZS:a.mode===sM&&(s=1,s=mk(s,t,n,0),s!==a.check)?JS:(r=SM(e,t,n,n),r?(a.mode=16210,eM):(a.havedict=1,YS)))},inflateInfo:"pako inflate (from Nodeca project)"};var NM=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const CM=Object.prototype.toString,{Z_NO_FLUSH:EM,Z_FINISH:PM,Z_OK:TM,Z_STREAM_END:AM,Z_NEED_DICT:_M,Z_STREAM_ERROR:IM,Z_DATA_ERROR:DM,Z_MEM_ERROR:OM}=vk;function FM(e){this.options=gS({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MS,this.strm.avail_out=0;let n=MM.inflateInit2(this.strm,t.windowBits);if(n!==TM)throw new Error(gk[n]);if(this.header=new NM,MM.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=wS(t.dictionary):"[object ArrayBuffer]"===CM.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=MM.inflateSetDictionary(this.strm,t.dictionary),n!==TM)))throw new Error(gk[n])}function RM(e,t){const n=new FM(t);if(n.push(e),n.err)throw n.msg||gk[n.err];return n.result}FM.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize,s=this.options.dictionary;let r,o,i;if(this.ended)return!1;for(o=t===~~t?t:!0===t?PM:EM,"[object ArrayBuffer]"===CM.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),r=MM.inflate(n,o),r===_M&&s&&(r=MM.inflateSetDictionary(n,s),r===TM?r=MM.inflate(n,o):r===DM&&(r=_M));n.avail_in>0&&r===AM&&n.state.wrap>0&&0!==e[n.next_in];)MM.inflateReset(n),r=MM.inflate(n,o);switch(r){case IM:case DM:case _M:case OM:return this.onEnd(r),this.ended=!0,!1}if(i=n.avail_out,n.next_out&&(0===n.avail_out||r===AM))if("string"===this.options.to){let e=SS(n.output,n.next_out),t=n.next_out-e,s=kS(n.output,e);n.next_out=t,n.avail_out=a-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==TM||0!==i){if(r===AM)return r=MM.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},FM.prototype.onData=function(e){this.chunks.push(e)},FM.prototype.onEnd=function(e){e===TM&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=vS(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jM={Inflate:FM,inflate:RM,inflateRaw:function(e,t){return(t=t||{}).raw=!0,RM(e,t)},ungzip:RM};const{Deflate:LM,deflate:BM,deflateRaw:VM,gzip:zM}=jS,{Inflate:UM,inflate:GM,inflateRaw:WM,ungzip:KM}=jM;var HM={Deflate:LM,deflate:BM,deflateRaw:VM,gzip:zM,Inflate:UM,inflate:GM,inflateRaw:WM,ungzip:KM,constants:vk};const $M={0:"ChipSynth",1:"FurnaceOPN",2:"FurnaceGB",3:"FurnaceC64",4:"Sampler",5:"FurnacePCE",6:"FurnaceAY",7:"FurnaceAY",8:"FurnaceTIA",9:"FurnaceSAA",10:"FurnaceVIC",11:"ChipSynth",12:"FurnaceVRC6",13:"FurnaceOPLL",14:"FurnaceOPL",15:"FurnaceFDS",16:"FurnaceVB",17:"FurnaceN163",18:"FurnaceSCC",19:"FurnaceOPZ",20:"ChipSynth",21:"ChipSynth",22:"FurnaceSWAN",23:"FurnaceLynx",24:"FurnaceVERA",25:"FurnaceX1_010",26:"FurnaceVRC6",27:"FurnaceES5506",28:"Sampler",29:"FurnaceSNES",30:"ChipSynth",31:"ChipSynth",32:"FurnaceOPL",33:"FurnaceOPM",34:"FurnaceNES",35:"Sampler",36:"FurnaceOKI",37:"Sampler",38:"Sampler",39:"FurnaceSEGAPCM",40:"FurnaceQSOUND",41:"FurnaceYMZ280B",42:"FurnaceRF5C68",43:"ChipSynth",44:"FurnaceT6W28",45:"FurnaceK007232",46:"FurnaceGA20",47:"ChipSynth",48:"FurnaceSM8521",49:"ChipSynth",50:"FurnaceK053260",52:"FurnaceTED",53:"FurnaceC140",54:"Sampler",55:"FurnaceESFM",56:"ChipSynth",57:"ChipSynth",58:"ChipSynth",59:"Sampler",60:"Sampler",61:"Sampler",62:"ChipSynth",63:"FurnaceC64",64:"FurnaceSUPERVISION",65:"FurnaceUPD1771",66:"FurnaceC64"};const qM=[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],YM=[250,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],XM={2:1,3:0,4:2,5:5,6:34,7:3,71:3,128:6,129:4,130:33,131:1,132:8,133:10,135:29,136:12,137:13,138:15,141:1,142:1,143:14,144:14,145:14,151:9,152:19,154:7,160:1},QM={0:0,1:17,2:10,3:4,4:4,5:6,6:5,7:3,71:3,128:3,129:4,130:8,131:6,132:2,133:4,134:1,135:8,136:3,137:9,138:1,139:3,140:8,141:6,142:16,143:9,144:9,145:18,146:28,147:1,148:4,149:8,150:4,151:6,152:8,153:1,154:3,155:16,156:6,157:6,158:16,159:6,160:9,161:5,162:11,163:11,164:20,165:14,166:17,167:11,168:4,170:4,171:1,172:17,173:2,174:42,175:44,176:16,177:32,178:10,179:12,180:5,181:8,182:9,183:19,184:8,185:3,186:8,187:8,188:8,189:11,190:7,191:4,192:1,193:10,194:18,195:10,196:20,197:20,198:2,199:4,200:3,202:5,203:3,204:4,205:2,206:24,207:16,209:18,212:4,213:6,214:16,215:2,216:16,217:4,222:19,224:19,226:4,227:4,229:4,240:3,241:5,245:7,252:1,253:8};function ZM(e){let t="";for(;!e.isEOF();){const n=e.readUint8();if(0===n)break;t+=String.fromCharCode(n)}return t}async function JM(e){const t=function(e){if(120===e[0])try{return HM.inflate(e)}catch(t){throw new Error("Failed to decompress Furnace file: "+t)}return e}(new Uint8Array(e)),n=new ly(t.buffer),a=n.readMagic(16);if(!a.startsWith("-Furnace module-"))throw new Error(`Invalid Furnace file header: "${a}"`);const s=n.readUint16();n.skip(2);const r=n.readUint32();n.seek(r);const o={name:"",author:"",category:"",systemName:"",tuning:440,masterVol:1,version:s,systemLen:0,systems:[],systemChans:[],systemVol:[],systemPan:[],systemPanFR:[],chans:0,subsongs:[],instruments:[],wavetables:[],samples:[],patterns:new Map,comment:""};return s>=240?await async function(e,t,n){const a=e.readMagic(4);if("INF2"!==a)throw new Error(`Expected INF2 block, got: "${a}"`);if(e.readUint32(),t.name=ZM(e),t.author=ZM(e),t.systemName=ZM(e),t.category=ZM(e),ZM(e),ZM(e),ZM(e),ZM(e),t.tuning=e.readFloat32(),e.readUint8(),t.masterVol=e.readFloat32(),t.chans=e.readUint16(),t.systemLen=e.readUint16(),t.systemLen<1)throw new Error("Zero chips in module!");let s=0;for(let h=0;h<t.systemLen;h++){const n=e.readUint16();t.systems.push(n);const a=e.readUint16();t.systemChans.push(a),s+=a,t.systemVol.push(e.readFloat32()),t.systemPan.push(e.readFloat32()),t.systemPanFR.push(e.readFloat32())}t.chans!==s&&(t.chans=s);const r=e.readUint32();e.skip(4*r),e.readUint8();const o=[],i=[],l=[],c=[],d=[];let u=0,p=!0;for(;p;){switch(e.readUint8()){case 0:p=!1;break;case 1:{const t=e.readUint32();for(let n=0;n<t;n++)c.push(e.readUint32());break}case 2:{const t=e.readUint32();e.skip(4*t);break}case 3:{const t=e.readUint32();e.skip(4*t);break}case 4:{const t=e.readUint32();for(let n=0;n<t;n++)o.push(e.readUint32());break}case 5:{const t=e.readUint32();for(let n=0;n<t;n++)i.push(e.readUint32());break}case 6:{const t=e.readUint32();for(let n=0;n<t;n++)l.push(e.readUint32());break}case 7:{const t=e.readUint32();for(let n=0;n<t;n++)d.push(e.readUint32());break}case 8:e.readUint32(),e.readUint32();break;case 9:e.readUint32(),u=e.readUint32();break;case 10:{const t=e.readUint32();e.skip(4*t);break}default:{const t=e.readUint32();e.skip(4*t);break}}}for(const h of c){e.seek(h);const a=eN(e,t.chans,n);t.subsongs.push(a)}for(let h=0;h<o.length;h++){const n=o[h];e.seek(n);const a=e.getOffset(),s=tN(e),r=e.getOffset()-a;e.seek(a);const i=e.readBytes(r);s.rawBinaryData=i,t.instruments.push(s)}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],n=XM[e]??0;t.instruments.push({name:"Default",type:n,macros:[],samples:[],wavetables:[]})}for(const h of i){e.seek(h);const n=sN(e);t.wavetables.push(n)}for(const h of l){e.seek(h);const a=rN(e,n);t.samples.push(a)}for(const h of d){e.seek(h);const a=oN(e,t.chans,t.subsongs,n),s=`${a.subsong}_${a.channel}_${a.index}`;if(t.patterns.set(s,a),t.patterns.size<=3){if(a.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)){a.rows.findIndex(e=>e.note>=0||e.instrument>=0)}}}if(u>0){e.seek(u);"CMNT"===e.readMagic(4)&&(e.readUint32(),t.comment=ZM(e))}}(n,o,s,t.buffer):await async function(e,t,n){const a=e.readMagic(4);if("INFO"!==a)throw new Error(`Expected INFO block, got: "${a}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8();const r=e.readUint16(),o=e.readUint16(),i=e.readUint16(),l=e.readUint32();const c=[];for(let y=0;y<32;y++){const t=e.readUint8();0!==t&&c.push(t)}t.systems=c.filter(e=>0!==e),t.systemLen=t.systems.length;for(let y=0;y<32;y++){const n=e.readInt8();y<t.systemLen&&t.systemVol.push(n/64)}for(let y=0;y<32;y++){const n=e.readInt8();y<t.systemLen&&t.systemPan.push(n/127)}e.skip(128);t.name=ZM(e),t.author=ZM(e),t.tuning=e.readFloat32(),e.skip(20);const d=[],u=[],p=[],h=[];for(let y=0;y<r;y++)d.push(e.readUint32());for(let y=0;y<o;y++)u.push(e.readUint32());for(let y=0;y<i;y++)p.push(e.readUint32());let m=0;for(const y of t.systems){const e=QM[y]||4;t.systemChans.push(e),m+=e}t.chans=m;for(let y=0;y<l;y++)h.push(e.readUint32());s.orders=[];for(let y=0;y<t.chans;y++){const t=[];for(let n=0;n<s.ordersLen;n++)t.push(e.readUint8());s.orders.push(t)}s.effectColumns=[];for(let y=0;y<t.chans;y++)s.effectColumns.push(e.readUint8());if(n>=39){e.skip(2*t.chans);for(let n=0;n<t.chans;n++)s.channelNames.push(ZM(e));for(let n=0;n<t.chans;n++)s.channelShortNames.push(ZM(e));t.comment=ZM(e)}t.masterVol=n>=59?e.readFloat32():2;n>=70&&e.skip(28);n>=96?(s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16()):e.skip(4);if(n>=95){ZM(e),ZM(e);const t=e.readUint8();e.skip(3);for(let n=0;n<t;n++)e.readUint32()}n>=103&&(ZM(e),ZM(e),ZM(e),ZM(e),ZM(e),ZM(e));if(n>=135){for(let a=0;a<t.systems.length;a++)e.skip(12);const n=e.readUint32();e.skip(4*n)}n>=136&&e.readUint8();n>=138&&e.skip(8);if(n>=139){e.skip(17);const t=e.readUint8();for(let n=0;n<t;n++)e.skip(17)}n>=156&&e.skip(12);t.subsongs.push(s);for(let y=0;y<d.length;y++){const a=d[y];if(0===a)continue;e.seek(a);const s=e.getOffset();try{const a=tN(e,n),r=e.getOffset()-s;e.seek(s);const o=e.readBytes(r);a.rawBinaryData=o,t.instruments.push(a)}catch(f){t.instruments.push({name:"Error",type:0,macros:[],samples:[],wavetables:[]})}}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],n=XM[e]??0;t.instruments.push({name:"Default",type:n,macros:[],samples:[],wavetables:[]})}for(const y of u)if(0!==y){e.seek(y);try{const n=sN(e);t.wavetables.push(n)}catch(f){}}for(const y of p)if(0!==y){e.seek(y);try{const a=rN(e,n);t.samples.push(a)}catch(f){}}for(const y of h)if(0!==y){e.seek(y);try{const a=oN(e,t.chans,t.subsongs,n),s=`${a.subsong}_${a.channel}_${a.index}`;if(t.patterns.set(s,a),t.patterns.size<=3){a.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)}}catch(f){}}}(n,o,s,t.buffer),o}function eN(e,t,n){const a=e.readMagic(4);if("SNG2"!==a&&"SONG"!==a)throw new Error(`Expected SNG2/SONG block, got: "${a}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};if("SNG2"===a){s.hz=e.readFloat32(),s.arpLen=e.readUint8(),e.readUint8(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16();const t=e.readUint8(),n=[];for(let a=0;a<16;a++)n.push(e.readUint16());s.speed1=n[0]||6,s.speed2=t>1?n[1]:s.speed1,s.name=ZM(e),s.comment=ZM(e)}else s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16(),s.name=ZM(e),s.comment=ZM(e);for(let r=0;r<t;r++){const t=[];for(let n=0;n<s.ordersLen;n++)t.push(e.readUint8());s.orders.push(t)}for(let r=0;r<t;r++)s.effectColumns.push(e.readUint8());e.skip(2*t);for(let r=0;r<t;r++)s.channelNames.push(ZM(e));for(let r=0;r<t;r++)s.channelShortNames.push(ZM(e));return n>=240&&e.skip(4*t),s}function tN(e,t){const n=e.readMagic(4),a={name:"",type:0,macros:[],samples:[],wavetables:[]};if("INS2"===n||"FINS"===n)for("INS2"===n&&e.readUint32(),e.readUint16(),a.type=e.readUint16();!e.isEOF();){const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),s=e.getOffset()+n;switch(t){case"NA":a.name=ZM(e);break;case"FM":a.fm=nN(e);break;case"MA":aN(e,a);break;case"SM":{const t=e.readInt16(),n=e.readUint8(),s=e.readUint8(),r=!!(1&n),o=!!(2&n),i=!!(4&n);if(t>=0&&a.samples.push(t),a.amiga={initSample:t,useNoteMap:r,useSample:o,useWave:i,waveLen:s},r){a.amiga.noteMap=[];const t=new Set(a.samples);for(let n=0;n<120;n++){const n=e.readInt16(),s=e.readInt16();a.amiga.noteMap.push({freq:n,map:s}),s>=0&&!t.has(s)&&(t.add(s),a.samples.push(s))}}break}case"SL":case"LS":{const n="LS"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LS"===t?a.samples.push(e.readUint16()):a.samples.push(e.readUint8());break}case"WL":case"LW":{const n="LW"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LW"===t?a.wavetables.push(e.readUint16()):a.wavetables.push(e.readUint8());break}case"GB":{const t=e.readUint8(),n=e.readUint8(),s=e.readUint8(),r=e.readUint8(),o=[];for(let a=0;a<r;a++)o.push({cmd:e.readUint8(),data:e.readInt16()});a.gb={envVol:15&t,envDir:16&t?1:0,envLen:t>>5&7,soundLen:n,softEnv:!!(1&s),alwaysInit:!!(2&s),doubleWave:!!(4&s),hwSeqLen:r,hwSeq:o};break}case"64":{const t=e.readUint8(),n=e.readUint8(),s=e.readUint8(),r=e.readUint8(),o=4095&e.readUint16(),i=e.readUint16();a.c64={triOn:!!(1&t),sawOn:!!(2&t),pulseOn:!!(4&t),noiseOn:!!(8&t),toFilter:!!(16&t),initFilter:!!(64&t),dutyIsAbs:!!(128&t),lp:!!(1&n),bp:!!(4&n),hp:!!(2&n),ch3off:!!(8&n),filterIsAbs:!!(16&n),noTest:!!(32&n),ringMod:!!(64&n),oscSync:!!(128&n),a:s>>4&15,d:15&s,s:r>>4&15,r:15&r,duty:o,cut:4095&i,res:i>>12};break}case"SN":{const t=e.readUint8(),n=e.readUint8(),s=e.readUint8(),r=e.readUint8();a.snes={a:15&t,d:t>>4&7,s:n>>5&7,r:31&n,useEnv:!!(16&s),sus:8&s?1:0,gainMode:7&s,gain:r,d2:0};break}case"N1":{const t=e.readInt32(),n=e.readUint8(),s=e.readUint8(),r=e.readUint8();a.n163={wave:t,wavePos:n,waveLen:s,waveMode:r};break}case"FD":{const t=e.readInt32(),n=e.readInt32(),s=0!==e.readUint8(),r=[];for(let a=0;a<32;a++)r.push(e.readUint8());a.fds={modSpeed:t,modDepth:n,initModTableWithFirstWave:s,modTable:r};break}}e.seek(s)}else{if("INST"!==n)throw new Error(`Unknown instrument format: "${n}"`);e.readUint32(),e.readUint16(),a.type=e.readUint8(),e.readUint8(),a.name=ZM(e),0!==a.type&&1!==a.type||(a.fm=function(e){const t={...ka,operators:[],macros:[],opMacros:[],wavetables:[]};t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),t.fms=7&e.readUint8(),t.ams=3&e.readUint8();const n=e.readUint8();t.ops=n,t.opllPreset=31&e.readUint8(),e.skip(2);for(let a=0;a<4;a++){const s={enabled:a<n,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.skip(10),t.operators.push(s)}return t}(e))}return a}function nN(e,t){const n={...ka,operators:[],macros:[],opMacros:[],wavetables:[]},a=e.readUint8(),s=15&a,r=a>>4&15;n.ops=s;const o=e.readUint8();n.algorithm=o>>4&7,n.feedback=7&o;const i=e.readUint8();n.fms2=i>>5&7,n.ams=i>>3&3,n.fms=7&i;const l=e.readUint8();n.ams2=l>>6&3,n.opllPreset=31&l;for(let c=0;c<s;c++){const t=e.readUint8(),a=e.readUint8(),s=e.readUint8(),o=e.readUint8(),i=e.readUint8(),l=e.readUint8(),d=e.readUint8(),u=e.readUint8(),p={enabled:!!(r>>c&1),mult:15&t,dt:t>>4&7,ksr:!!(t>>7&1),tl:127&a,sus:!!(a>>7&1),ar:31&s,vib:!!(s>>5&1),rs:s>>6&3,dr:31&o,ksl:o>>5&3,am:!!(o>>7&1),egt:!!(i>>7&1),kvs:i>>5&3,d2r:31&i,sl:l>>4&15,rr:15&l,dvb:d>>4&15,ssg:15&d,dam:u>>5&7,dt2:u>>3&3,ws:7&u};n.operators.push(p)}return n}function aN(e,t,n){const a=e.readUint16(),s=e.getOffset()+a;for(;e.getOffset()<s;){const n=e.readUint8();if(255===n)break;const a={code:n,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},s=a.type>>6&3;for(let t=0;t<a.length;t++)switch(s){case 0:a.data.push(e.readUint8());break;case 1:a.data.push(e.readInt8());break;case 2:a.data.push(e.readInt16());break;case 3:a.data.push(e.readInt32())}t.macros.push(a)}}function sN(e){const t=e.readMagic(4);if("WAVE"!==t)throw new Error(`Expected WAVE block, got: "${t}"`);e.readUint32();const n={name:ZM(e),width:e.readUint32(),height:0,data:[]};e.readUint32(),n.height=e.readUint32();for(let a=0;a<n.width;a++)n.data.push(e.readInt32());return n}function rN(e,t){const n=e.readMagic(4),a={name:"",length:0,compatRate:0,c4Rate:0,depth:16,loopStart:-1,loopEnd:-1,loopDirection:0,data:new Int16Array(0)};if("SMP2"===n)if(e.readUint32(),a.name=ZM(e),a.length=e.readUint32(),a.compatRate=e.readUint32(),a.c4Rate=e.readUint32(),a.depth=e.readUint8(),a.loopDirection=t>=123?e.readUint8():0,e.readUint8(),e.readUint8(),a.loopStart=e.readInt32(),a.loopEnd=e.readInt32(),e.skip(16),16===a.depth){const t=new Int16Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt16();a.data=t}else if(8===a.depth){const t=new Int8Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt8();a.data=t}else a.data=e.readBytes(a.length);else{if("SMPL"!==n)throw new Error(`Unknown sample format: "${n}"`);{e.readUint32(),a.name=ZM(e),a.length=e.readUint32(),a.compatRate=e.readUint32(),t<58?(e.readUint16(),e.readUint16()):e.skip(4),a.depth=e.readUint8(),e.readUint8(),t>=32&&(a.c4Rate=e.readUint16()),t>=19&&(a.loopStart=e.readInt32());const n=t<58?2*a.length:a.length;if(16===a.depth){const t=new Int16Array(a.length);for(let n=0;n<a.length;n++)t[n]=e.readInt16();a.data=t}else{const t=new Int8Array(n);for(let a=0;a<n;a++)t[a]=e.readInt8();a.data=t}}}return a}function oN(e,t,n,a){const s=e.readMagic(4),r={subsong:0,channel:0,index:0,name:"",rows:[]};if("PATN"===s){e.readUint32(),r.subsong=e.readUint8(),r.channel=e.readUint8(),r.index=e.readUint16(),a>=51&&(r.name=ZM(e));const t=n[r.subsong]||n[0],s=t?.patLen||64;t?.effectColumns[r.channel];for(let e=0;e<s;e++)r.rows.push({note:-1,octave:0,instrument:-1,volume:-1,effects:[]});let o=0;for(;o<s&&!e.isEOF();){const t=e.readUint8();if(255===t)break;if(128&t){o+=2+(127&t);continue}if(0===t){o++;continue}const n=r.rows[o],a=!!(1&t),s=!!(2&t),i=!!(4&t),l=!!(8&t),c=!!(16&t),d=!!(64&t);let u=0,p=0;if(!!(32&t)&&(u=e.readUint8()),d&&(p=e.readUint8()),a){const t=e.readUint8();t>=180?(n.note=t,n.octave=0):t<180&&(n.note=qM[t]||0,n.octave=YM[t]||0,n.octave>=250&&(n.octave=n.octave-256))}if(s&&(n.instrument=e.readUint8()),i&&(n.volume=e.readUint8()),l){const t=e.readUint8(),a=c?e.readUint8():0;n.effects.push({type:t,value:a})}else c&&e.readUint8();for(let r=1;r<=3;r++){const t=!!(u&1<<2*r+1);if(!!(u&1<<2*r)){const a=e.readUint8(),s=t?e.readUint8():0;n.effects.push({type:a,value:s})}else t&&e.readUint8()}for(let r=4;r<=7;r++){const t=!!(p&1<<2*(r-4)+1);if(!!(p&1<<2*(r-4))){const a=e.readUint8(),s=t?e.readUint8():0;n.effects.push({type:a,value:s})}else t&&e.readUint8()}o++}}else{if("PATR"!==s)throw new Error(`Unknown pattern format: "${s}"`);{e.readUint32(),r.channel=e.readUint16(),r.index=e.readUint16(),a>=95&&(r.subsong=e.readUint16()),e.skip(2);const t=n[r.subsong]||n[0],s=t?.patLen||64,o=t?.effectColumns[r.channel]||1;for(let n=0;n<s;n++){const t={note:e.readInt16(),octave:e.readInt16(),instrument:e.readInt16(),volume:e.readInt16(),effects:[]};0===t.note&&0===t.octave?t.note=-1:100===t.note?(t.note=180,t.octave=0):101===t.note?(t.note=181,t.octave=0):102===t.note?(t.note=182,t.octave=0):12===t.note?(t.note=12,t.octave++):t.note>=1&&t.note<=11&&t.octave>=128&&(t.octave=t.octave-256);for(let n=0;n<o;n++){const n=e.readInt16(),a=e.readInt16();n>=0&&t.effects.push({type:n,value:a>=0?a:0})}r.rows.push(t)}a>=51&&(r.name=ZM(e))}}return r}function iN(e){const t=e.instruments.map((t,n)=>{const a=[],s=(r=t.type,$M[r]||"ChipSynth");var r;const o="Sampler"===s||"Player"===s;if(t.samples&&t.samples.length>0){for(const c of t.samples)if(c<e.samples.length){const t=e.samples[c];a.push(cN(t,c))}}else if(o&&n<e.samples.length){const t=e.samples[n];a.push(cN(t,n))}const i={chipType:t.type,synthType:s,macros:t.macros.map(e=>({type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed,mode:e.mode,delay:e.delay})),wavetables:t.wavetables.filter(t=>t<e.wavetables.length).map(t=>{const n=e.wavetables[t];return{id:t,data:[...n.data],len:n.width,max:n.height}})};t.fm&&(i.fm={algorithm:t.fm.algorithm,feedback:t.fm.feedback,fms:t.fm.fms,ams:t.fm.ams,ops:t.fm.ops,opllPreset:t.fm.opllPreset,operators:t.fm.operators.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2,rs:e.rs,am:e.am,ksr:e.ksr,ksl:e.ksl,sus:e.sus,vib:e.vib,ws:e.ws,ssg:e.ssg,egt:e.egt,kvs:e.kvs,dvb:e.dvb,dam:e.dam}))});const l={};return t.gb&&(l.gb=t.gb),t.c64&&(l.c64=t.c64),t.snes&&(l.snes=t.snes),t.n163&&(l.n163=t.n163),t.fds&&(l.fds=t.fds),Object.keys(l).length>0&&(i.chipConfig=l),{id:n+1,name:t.name||`Instrument ${n+1}`,samples:a,fadeout:0,volumeType:"none",panningType:"none",furnace:i,rawBinaryData:t.rawBinaryData}}),n=[],a=e.subsongs[0];if(!a)return{instruments:t,patterns:[],metadata:lN(e)};for(let s=0;s<a.ordersLen;s++){const t=[];for(let n=0;n<a.patLen;n++){const r=[];for(let t=0;t<e.chans;t++){const o=`0_${t}_${a.orders[t]?.[s]??0}`,i=e.patterns.get(o);if(i&&i.rows[n]){const e=dN(i.rows[n]);r.push(e)}else r.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0,effectType2:0,effectParam2:0})}t.push(r)}n.push(t)}n.filter(e=>e.some(e=>e.some(e=>e.note>0||e.instrument>0||e.effectType>0)));return{instruments:t,patterns:n,metadata:lN(e)}}function lN(e){const t=e.subsongs[0],n=t?.virtualTempo||150,a=t?.virtualTempoD||150,s=t?.hz||60,r=t?.speed1||6,o=Math.round(2.5*s*(n/a));return{sourceFormat:"XM",sourceFile:e.name||"Furnace Module",importedAt:(new Date).toISOString(),originalChannelCount:e.chans,originalPatternCount:e.patterns.size,originalInstrumentCount:e.instruments.length,modData:{moduleType:"FUR",initialSpeed:r,initialBPM:o,amigaPeriods:!1,channelNames:t?.channelNames||Array.from({length:e.chans},(e,t)=>`Ch ${t+1}`),songLength:t?.ordersLen||1,restartPosition:0,patternOrderTable:Array.from({length:t?.ordersLen||1},(e,t)=>t),songMessage:e.comment}}}function cN(e,t){let n;if(16===e.depth&&e.data instanceof Int16Array)n=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);else if(e.data instanceof Int8Array){const t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=256*e.data[n];n=t.buffer}else n=new ArrayBuffer(2*e.length);return{id:t,name:e.name,pcmData:n,loopStart:e.loopStart>=0?e.loopStart:0,loopLength:e.loopEnd>e.loopStart?e.loopEnd-e.loopStart:0,loopType:e.loopStart<0?"none":2===e.loopDirection?"pingpong":"forward",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:e.c4Rate||e.compatRate||22050,length:e.length}}function dN(e){let t=0;if(180===e.note||181===e.note||182===e.note)t=97;else if(e.note>=0&&e.note<=12){const n=12===e.note?0:e.note,a=12===e.note?e.octave+1:e.octave;t=12*(a<0?0:a)+n+1-24,t>96&&(t=96),t<1&&(t=0)}let n=0;e.volume>=0&&(n=16+Math.min(64,Math.floor(e.volume/2)));let a=0,s=0,r=0,o=0;if(e.effects.length>0){const t=e.effects[0];if(a=uN(t.type),s=255&t.value,a>=224&&a<=239){const e=15&a;a=14,s=e<<4|15&s}}if(e.effects.length>1){const t=e.effects[1];if(r=uN(t.type),o=255&t.value,r>=224&&r<=239){const e=15&r;r=14,o=e<<4|15&o}}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:n,effectType:a,effectParam:s,effectType2:r,effectParam2:o}}function uN(e){return{0:0,1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:8,9:15,10:10,11:11,12:233,13:13,15:15,16:16,17:17,128:8,129:8,130:8,131:25,132:25,136:8,137:8,138:8,144:9,145:9,146:9,147:9,148:9,149:9,150:9,151:9,152:9,153:9,154:9,155:9,156:9,157:9,158:9,159:9,192:15,193:15,194:15,195:15,211:10,212:10,220:236,224:0,225:225,226:226,227:228,228:4,229:0,230:3,231:0,232:3,233:3,234:0,235:0,236:236,237:237,238:0,240:15,241:225,242:226,243:234,244:235,245:0,246:0,247:0,248:234,249:235,250:10,252:236,253:15,254:15,255:0}[e]??e}const pN=Object.freeze(Object.defineProperty({__proto__:null,convertFurnaceToDevilbox:iN,parseFurnaceSong:JM},Symbol.toStringTag,{value:"Module"}));async function hN(e){return new Promise((t,n)=>{const a=new FileReader;a.onload=async a=>{const s=a.target?.result;if(!s)return void n(new Error("Failed to read file"));const r=e.name.toLowerCase().slice(e.name.lastIndexOf(".")),o=".xm"===r||".mod"===r||".fur"===r||".dmf"===r;try{if(o)try{const n=await async function(e,t){try{if(".xm"===t){const t=await bw(e);return{format:"XM",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".mod"===t){const t=await Ew(e);return{format:"MOD",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".fur"===t){const t=iN(await JM(e));return{format:"FUR",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".dmf"===t){const t=function(e){const t=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,samples:[],fadeout:0,volumeType:"none",panningType:"none"})),n=[];for(let o=0;o<e.matrixRows;o++){const t=[];for(let n=0;n<e.patternRows;n++){const a=[];for(let t=0;t<e.channelCount;t++){const s=e.patternMatrix[t]?.[o]||0,r=t*e.matrixRows+s,i=e.patterns[r],l=i?.rows?.[n]?.[t];l?a.push(bN(l)):a.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(a)}n.push(t)}const a=60,s=Math.round(2.5*a/(e.timeBase+1)/e.ticksPerRow[0]*4),r={sourceFormat:"XM",sourceFile:e.name||"DefleMask Module",importedAt:(new Date).toISOString(),originalChannelCount:e.channelCount,originalPatternCount:n.length,originalInstrumentCount:e.instruments.length,modData:{moduleType:"DMF",initialSpeed:e.ticksPerRow[0],initialBPM:s>0?s:125,amigaPeriods:!1,channelNames:Array.from({length:e.channelCount},(e,t)=>`Ch ${t+1}`),songLength:e.matrixRows,restartPosition:0,patternOrderTable:Array.from({length:e.matrixRows},(e,t)=>t),songMessage:`${e.name} by ${e.author}`}};return{instruments:t,patterns:n,metadata:r}}(uy.parse(e,"dmf"));return{format:"DMF",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}}catch(n){return null}return null}(s,r,e.name);if(n){const a={title:n.importMetadata.sourceFile,type:".fur"===r?"Furnace":".dmf"===r?"DefleMask":n.format,channels:n.importMetadata.originalChannelCount,patterns:n.importMetadata.originalPatternCount,orders:n.importMetadata.modData?.songLength||1,instruments:n.importMetadata.originalInstrumentCount,samples:n.importMetadata.originalInstrumentCount,duration:0,message:n.importMetadata.modData?.songMessage};let o;return".fur"!==r&&".dmf"!==r&&(o=await yN(s,e)),void t({metadata:a,arrayBuffer:s,player:o,file:e,nativeData:n})}}catch(i){if(".fur"===r||".dmf"===r)return void n(new Error(`Failed to parse ${r} file: ${i instanceof Error?i.message:"unknown error"}`))}const a=await yN(s,e),l=await new Promise((t,n)=>{const s=setTimeout(()=>{n(new Error("Timeout waiting for metadata"))},5e3);a.onMetadata(n=>{let a;clearTimeout(s),n.song&&(a={channels:n.song.channels||[],instruments:n.song.instruments||[],samples:n.song.samples||[],orders:n.song.orders||[],patterns:n.song.patterns||[],numSubsongs:n.song.numSubsongs||1}),t({title:n.title||e.name.replace(/\.[^/.]+$/,""),type:n.type||"Unknown",channels:n.song?.channels?.length||n.channels||4,patterns:n.song?.patterns?.length||n.totalPatterns||n.patterns||1,orders:n.song?.orders?.length||n.totalOrders||n.orders||1,instruments:n.song?.instruments?.length||n.instruments||0,samples:n.song?.samples?.length||n.samples||0,duration:n.dur||0,message:n.message,song:a})}),a.onError(e=>{clearTimeout(s),n(new Error(`Failed to load module: ${e.type||e.message||"unknown error"}`))})});t({metadata:l,arrayBuffer:s,player:a,file:e})}catch(l){n(l)}},a.onerror=()=>n(new Error("Failed to read file")),a.readAsArrayBuffer(e)})}async function mN(e){e.player&&await e.player.play(e.arrayBuffer)}function fN(e){e.player&&e.player.stop()}async function yN(e,t){const n=new vw({repeatCount:0});if(!(await new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4);n.onInitialized(()=>{clearTimeout(t),e(!0)}),n.onError(n=>{"init"===n.type&&(clearTimeout(t),e(!1))})})))throw new Error("Module player not available. The audio worklet failed to load.");return await n.play(e),n.stop(),n}function gN(){return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"]}function vN(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].includes(t)}function bN(e){let t=0;if(100===e.note)t=97;else if(e.note>=0&&e.note<=11){t=12*Math.max(0,Math.min(7,e.octave))+e.note+1,t>96&&(t=96),t<1&&(t=0)}let n=0;e.volume>=0&&(n=16+Math.floor(4*e.volume));let a=0,s=0;if(e.effects.length>0){const t=e.effects[0];a={0:0,1:1,2:2,3:3,4:4,7:7,8:8,9:9,10:10,11:11,12:12,13:13,15:15,16:16,225:225,226:226,233:233,234:234,235:235,236:236,237:237}[t.code]??0,s=255&t.value}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:n,effectType:a,effectParam:s}}const xN=Object.freeze(Object.defineProperty({__proto__:null,getSupportedExtensions:gN,isSupportedModule:vN,loadModuleFile:hN,previewModule:mN,stopPreview:fN},Symbol.toStringTag,{value:"Module"})),wN=({isOpen:e,onClose:t,onImport:n,initialFile:a})=>{const[r,o]=s.useState(null),[i,l]=s.useState(!1),[c,d]=s.useState(null),[u,p]=s.useState(!1),[h,m]=s.useState(!0),f=s.useRef(null),y=s.useCallback(async e=>{if(vN(e.name)){l(!0),d(null),o(null);try{const t=await hN(e);o(t)}catch(t){d(t instanceof Error?t.message:"Failed to load module")}finally{l(!1)}}else d(`Unsupported file format. Supported: ${[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].slice(0,5).join(", ")}...`)},[]);s.useEffect(()=>{a&&e&&y(a)},[a,e,y]);const g=s.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&y(t)},[y]),v=s.useCallback(e=>{e.preventDefault()},[]),b=s.useCallback(e=>{const t=e.target.files?.[0];t&&y(t)},[y]),x=s.useCallback(()=>{r&&(u?(fN(r),p(!1)):(mN(r),p(!0)))},[r,u]),w=s.useCallback(()=>{r&&(u&&(fN(r),p(!1)),n(r,{useLibopenmpt:h}),t())},[r,u,n,t,h]),k=s.useCallback(()=>{r&&u&&fN(r),o(null),d(null),p(!1),t()},[r,u,t]);return e?wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[80vh] overflow-hidden",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(Nt,{size:18,className:"text-accent-primary"}),wn.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Tracker Module"})]}),wn.jsx(Ob,{variant:"icon",size:"icon",onClick:k,"aria-label":"Close dialog",children:wn.jsx(Ee,{size:16})})]}),wn.jsxs("div",{className:"p-4 space-y-4",children:[wn.jsxs("div",{onDrop:g,onDragOver:v,onClick:()=>f.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${i?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[wn.jsx("input",{ref:f,type:"file",accept:[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].join(","),onChange:b,className:"hidden"}),i?wn.jsxs("div",{className:"flex flex-col items-center gap-2",children:[wn.jsx("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),wn.jsx("p",{className:"text-sm text-text-muted",children:"Loading module..."})]}):wn.jsxs("div",{className:"flex flex-col items-center gap-2",children:[wn.jsx(Ct,{size:32,className:"text-text-muted"}),wn.jsx("p",{className:"text-sm text-text-primary",children:"Drop a tracker file here or click to browse"}),wn.jsx("p",{className:"text-xs text-text-muted",children:"Supports MOD, XM, IT, S3M and 20+ other formats"})]})]}),c&&wn.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[wn.jsx(De,{size:16}),c]}),r&&wn.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(Ae,{size:16,className:"text-accent-primary"}),wn.jsx("span",{className:"font-medium text-text-primary",children:r.metadata.title})]}),wn.jsx("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:r.metadata.type})]}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Channels:"}),wn.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.channels})]}),wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Patterns:"}),wn.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.patterns})]}),wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Instruments:"}),wn.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.instruments})]}),wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Samples:"}),wn.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.samples})]}),wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Orders:"}),wn.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.orders})]}),wn.jsxs("div",{className:"flex justify-between text-text-muted",children:[wn.jsx("span",{children:"Duration:"}),wn.jsxs("span",{className:"text-text-primary font-mono",children:[Math.floor(r.metadata.duration/60),":",String(Math.floor(r.metadata.duration%60)).padStart(2,"0")]})]})]}),r.metadata.message&&wn.jsx("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap",children:r.metadata.message}),wn.jsx(Ob,{variant:"ghost",fullWidth:!0,onClick:x,icon:u?wn.jsx(Et,{size:14}):wn.jsx(Pt,{size:14}),className:u?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:u?"Stop Preview":"Preview"})]}),r&&wn.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("input",{type:"checkbox",id:"useLibopenmpt",checked:h,onChange:e=>m(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bgSecondary accent-accent-primary"}),wn.jsx("label",{htmlFor:"useLibopenmpt",className:"text-sm text-text-primary cursor-pointer",children:"Use libopenmpt for sample-accurate playback"})]}),wn.jsxs("div",{className:"flex items-start gap-2 text-xs text-text-muted",children:[wn.jsx(Tt,{size:12,className:"mt-0.5 flex-shrink-0"}),wn.jsx("span",{children:"When enabled, uses libopenmpt WASM for authentic tracker effects (smooth vibrato, portamento). Editing will use Tone.js approximation."})]})]}),r&&!h&&wn.jsx("p",{className:"text-xs text-text-muted",children:"Note: Importing will create patterns and sampler instruments from this module. Complex effects may not translate perfectly."})]}),wn.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border",children:[wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:k,children:"Cancel"}),wn.jsx(Ob,{variant:"primary",size:"sm",onClick:w,disabled:!r,children:"Import Module"})]})]})}):null},kN=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(1),o=()=>{t(a)};return wn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:wn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),o()):"Escape"===e.key&&(e.preventDefault(),n())},children:[wn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Scale Volume (",e,")"]}),wn.jsxs("div",{className:"space-y-4",children:[wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Scale Factor"}),wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsx("input",{type:"range",min:"0",max:"2",step:"0.05",value:a,onChange:e=>r(parseFloat(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),wn.jsxs("span",{className:"text-neutral-100 font-mono text-sm w-20 text-right",children:[a.toFixed(2)," (",Math.round(100*a),"%)"]})]}),wn.jsxs("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[wn.jsx("span",{children:"0 (silence)"}),wn.jsx("span",{children:"1 (unchanged)"}),wn.jsx("span",{children:"2 (double)"})]})]}),wn.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[wn.jsxs("p",{className:"mb-1",children:[wn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Scale volume multiplies all volume values by the factor."]}),wn.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[wn.jsx("li",{children:"0.5 = half volume (50%)"}),wn.jsx("li",{children:"1.0 = no change (100%)"}),wn.jsx("li",{children:"2.0 = double volume (200%, clamped to max)"})]})]})]}),wn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[wn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",wn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),wn.jsxs("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",wn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},SN=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(64),[o,i]=s.useState(0),l=()=>{t(a,o)};return wn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:wn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),n())},children:[wn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Fade Volume (",e,")"]}),wn.jsxs("div",{className:"space-y-4",children:[wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Start Volume"}),wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:a,onChange:e=>r(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),wn.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:a.toString().padStart(2,"0")})]})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"End Volume"}),wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:o,onChange:e=>i(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),wn.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:o.toString().padStart(2,"0")})]})]}),wn.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3",children:wn.jsxs("div",{className:"text-xs text-neutral-400 space-y-2",children:[wn.jsxs("p",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Fade Direction:"})," ",a>o?wn.jsx("span",{className:"text-red-400",children:"Fade out (loud  quiet)"}):a<o?wn.jsx("span",{className:"text-green-400",children:"Fade in (quiet  loud)"}):wn.jsx("span",{className:"text-neutral-400",children:"No change (flat)"})]}),wn.jsxs("p",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Fade volume applies linear interpolation from start to end across all rows in the ",e,"."]})]})})]}),wn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[wn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",wn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),wn.jsxs("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",wn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},MN=({scope:e,onConfirm:t,onCancel:n})=>{const[a,r]=s.useState(0),[o,i]=s.useState(0),l=()=>{t(a,o)};return wn.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:wn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),n())},children:[wn.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Remap Instrument (",e,")"]}),wn.jsxs("div",{className:"space-y-4",children:[wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Source Instrument"}),wn.jsx("input",{type:"number",min:"0",max:"255",value:a,onChange:e=>r(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),wn.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to find (0-255)"})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Destination Instrument"}),wn.jsx("input",{type:"number",min:"0",max:"255",value:o,onChange:e=>i(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"}),wn.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to replace with (0-255)"})]}),wn.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[wn.jsxs("p",{className:"mb-1",children:[wn.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Remap instrument replaces all occurrences of the source instrument ID with the destination ID."]}),wn.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[wn.jsxs("li",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Block:"})," Only in selected region"]}),wn.jsxs("li",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Track:"})," Entire current channel"]}),wn.jsxs("li",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Pattern:"})," Entire current pattern"]}),wn.jsxs("li",{children:[wn.jsx("strong",{className:"text-neutral-300",children:"Song:"})," All patterns"]})]})]}),a===o&&wn.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded p-3 text-xs text-yellow-300",children:" Source and destination are the same - no changes will be made."})]}),wn.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[wn.jsxs("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",wn.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),wn.jsxs("button",{onClick:l,disabled:a===o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Remap ",wn.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},NN=({onClose:e})=>{const t=tf(e=>e.patternOrder),n=tf(e=>e.currentPositionIndex),a=tf(e=>e.currentPatternIndex),r=tf(e=>e.addToOrder),o=tf(e=>e.removeFromOrder),i=tf(e=>e.duplicatePosition),l=tf(e=>e.clearOrder),c=tf(e=>e.reorderPositions),d=tf(e=>e.setCurrentPosition),[u,p]=s.useState(null),h=e=>{e.currentTarget.classList.remove("bg-accent-primary/20")},m=()=>{p(null),document.querySelectorAll(".bg-accent-primary\\/20").forEach(e=>{e.classList.remove("bg-accent-primary/20")})};return wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center justify-between bg-ft2-header",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("span",{className:"text-lg font-bold text-ft2-text",children:"Pattern Order"}),wn.jsxs("span",{className:"text-sm text-ft2-textDim",children:["(",t.length," positions)"]})]}),wn.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-dark-bgHover transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:wn.jsx(Ee,{size:20})})]}),wn.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center gap-2 bg-dark-bgTertiary",children:[wn.jsxs("button",{onClick:()=>{r(a),tg.success(`Added Pattern ${a.toString(16).padStart(2,"0").toUpperCase()}`,2e3)},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Add current pattern to order",children:[wn.jsx(Ye,{size:14}),"Add Current Pattern"]}),wn.jsxs("button",{onClick:()=>{confirm("Clear all positions? This will reset to just the first pattern.")&&(l(),tg.info("Pattern order cleared",2e3))},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Clear all positions",children:[wn.jsx(Re,{size:14}),"Clear All"]}),wn.jsxs("div",{className:"ml-auto text-xs text-ft2-textDim",children:["Current Pattern: ",a.toString(16).padStart(2,"0").toUpperCase()]})]}),wn.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-ft2-bg",children:wn.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 xl:grid-cols-16 gap-2",children:t.map((e,a)=>wn.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{p(t),e.dataTransfer.effectAllowed="move"})(e,a),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==u&&u!==t&&e.currentTarget.classList.add("bg-accent-primary/20")})(e,a),onDragLeave:h,onDrop:e=>((e,t)=>{e.preventDefault(),e.currentTarget.classList.remove("bg-accent-primary/20"),null!==u&&u!==t&&(c(u,t),p(null),tg.success("Position reordered",2e3))})(e,a),onDragEnd:m,onClick:()=>d(a),onContextMenu:e=>{e.preventDefault(),e.shiftKey?(i(a),tg.success("Position duplicated",2e3)):(e.ctrlKey||e.metaKey)&&(e=>{t.length>1?(o(e),tg.info("Position removed",2e3)):tg.warning("Cannot remove last position",2e3)})(a)},className:`\n                  relative px-3 py-2 rounded border cursor-pointer transition-all\n                  ${a===n?"bg-dark-bgActive border-accent-primary text-accent-primary font-bold":"bg-dark-bgTertiary border-dark-border text-text-secondary hover:bg-dark-bgHover hover:border-dark-borderLight"}\n                  ${u===a?"opacity-50":""}\n                `,title:`Position ${a.toString(16).padStart(2,"0").toUpperCase()}: Pattern ${e.toString(16).padStart(2,"0").toUpperCase()}\nClick to select\nShift+Click to duplicate\nCtrl+Click to remove\nDrag to reorder`,children:[wn.jsx("div",{className:"text-xs text-center leading-none opacity-60",children:a.toString(16).padStart(2,"0").toUpperCase()}),wn.jsx("div",{className:"text-lg text-center font-mono leading-none mt-1",children:e.toString(16).padStart(2,"0").toUpperCase()})]},`pos-${a}`))})}),wn.jsxs("div",{className:"px-4 py-3 border-t border-ft2-border text-sm text-ft2-textDim bg-dark-bgTertiary",children:[wn.jsx("strong",{children:"Controls:"})," Click: Select  Drag: Reorder  Shift+Click: Duplicate  Ctrl+Click: Remove"]})]})})},CN=({isOpen:e,onClose:t})=>{const{selection:n,strumSelection:a}=tf(),[r,o]=s.useState(1),[i,l]=s.useState("down");return wn.jsxs(dw,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[wn.jsx(uw,{title:"Strum / Arpeggiate",icon:wn.jsx(Ae,{size:18}),onClose:t,theme:"modern"}),wn.jsxs("div",{className:"p-4 space-y-4",children:[wn.jsx("div",{className:"text-xs text-text-secondary",children:"Add incremental note delays (EDx) across channels to create a strum or arpeggio effect."}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Ticks per channel (1-15)"}),wn.jsx("input",{type:"number",value:r,onChange:e=>o(Math.max(1,Math.min(15,parseInt(e.target.value)||1))),min:1,max:15,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),wn.jsxs("div",{children:[wn.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Direction"}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsx("button",{onClick:()=>l("down"),className:"px-3 py-2 text-xs rounded border transition-colors "+("down"===i?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Down (left to right)"}),wn.jsx("button",{onClick:()=>l("up"),className:"px-3 py-2 text-xs rounded border transition-colors "+("up"===i?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Up (right to left)"})]})]}),!n&&wn.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),wn.jsxs(pw,{theme:"modern",align:"right",children:[wn.jsx(Ob,{variant:"ghost",onClick:t,children:"Cancel"}),wn.jsx(Ob,{variant:"primary",onClick:()=>{n?(a(r,i),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!n,children:"Apply"})]})]})},EN=()=>{const e=tf(e=>e.macroSlots),t=tf(e=>e.writeMacroSlot),n=tf(e=>e.readMacroSlot),a=e=>null==e?"..":"string"==typeof e?e:e.toString(16).padStart(2,"0").toUpperCase();return wn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4",children:[wn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[wn.jsx("h4",{className:"text-sm font-semibold text-neutral-100",children:"Macro Slots"}),wn.jsx("span",{className:"text-xs text-neutral-500",children:"FT2-Style Quick Entry"})]}),wn.jsx("div",{className:"space-y-2",children:e.map((e,s)=>{const r=0===e.note&&0===e.instrument&&0===e.volume&&0===e.effTyp&&0===e.eff&&0===e.effTyp2&&0===e.eff2;return wn.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:[wn.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-neutral-700 border border-neutral-600 rounded text-xs font-bold text-neutral-300",children:s+1}),wn.jsxs("div",{className:"flex-1 font-mono text-xs text-neutral-300 flex items-center gap-1",children:[wn.jsx("span",{className:e.note?"text-blue-400":"text-neutral-600",children:e.note||"..."}),wn.jsx("span",{className:null!==e.instrument?"text-green-400":"text-neutral-600",children:a(e.instrument)}),wn.jsx("span",{className:null!==e.volume?"text-yellow-400":"text-neutral-600",children:a(e.volume)}),wn.jsx("span",{className:0!==e.effTyp||0!==e.eff?"text-purple-400":"text-neutral-600",children:0!==e.effTyp||0!==e.eff?`${e.effTyp.toString(16).toUpperCase()}${e.eff.toString(16).padStart(2,"0").toUpperCase()}`:"..."}),wn.jsx("span",{className:0!==e.effTyp2||0!==e.eff2?"text-pink-400":"text-neutral-600",children:0!==e.effTyp2||0!==e.eff2?`${e.effTyp2.toString(16).toUpperCase()}${e.eff2.toString(16).padStart(2,"0").toUpperCase()}`:"..."})]}),wn.jsxs("div",{className:"flex gap-1",children:[wn.jsx("button",{onClick:()=>t(s),className:"px-2 py-1 text-xs font-medium text-neutral-300 bg-neutral-700 border border-neutral-600 rounded hover:bg-neutral-600 transition-colors",title:`Write current cell to slot ${s+1} (Ctrl+Shift+${s+1})`,children:"Write"}),wn.jsx("button",{onClick:()=>n(s),disabled:r,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:`Paste macro slot ${s+1} (Ctrl+${s+1})`,children:"Read"})]})]},s)})}),wn.jsxs("div",{className:"mt-4 p-3 bg-neutral-800/50 border border-neutral-700 rounded text-xs text-neutral-400",children:[wn.jsx("div",{className:"font-semibold text-neutral-300 mb-2",children:"Keyboard Shortcuts:"}),wn.jsxs("div",{className:"space-y-1",children:[wn.jsxs("div",{className:"flex justify-between",children:[wn.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+1-8"}),wn.jsx("span",{children:"Read macro slot 1-8"})]}),wn.jsxs("div",{className:"flex justify-between",children:[wn.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+Shift+1-8"}),wn.jsx("span",{children:"Write current cell to slot 1-8"})]})]}),wn.jsx("p",{className:"mt-2 text-neutral-500",children:"Macros store cell data for quick entry. Perfect for repeated patterns!"})]})]})},PN=({onClose:e,onShowScaleVolume:t,onShowFadeVolume:n,onShowRemapInstrument:a,onExportPattern:r,onExportTrack:o,onReverse:i,onExpand:l,onShrink:c,onDuplicate:d,onMath:u})=>{const{selection:p}=tf(),[h,m]=s.useState("macros"),[f,y]=s.useState(1),[g,v]=s.useState("volume"),b=null!==p,x=e=>{m(h===e?null:e)};return wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(Te,{size:18,className:"text-accent-primary"}),wn.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"FT2 Advanced Edit"})]}),wn.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:wn.jsx(Ee,{size:20})})]}),wn.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[wn.jsxs("div",{className:"border border-ft2-border rounded",children:[wn.jsxs("button",{onClick:()=>x("volume"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[wn.jsx("span",{children:"Volume Operations"}),wn.jsx("span",{children:"volume"===h?"":""})]}),"volume"===h&&wn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[wn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform volume values across selection, track, or pattern"}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsx("button",{onClick:()=>t?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Scale Block"}),wn.jsx("button",{onClick:()=>n?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Fade Block"}),wn.jsx("button",{onClick:()=>t?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Track"}),wn.jsx("button",{onClick:()=>n?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Track"}),wn.jsx("button",{onClick:()=>t?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Pattern"}),wn.jsx("button",{onClick:()=>n?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Pattern"})]})]})]}),wn.jsxs("div",{className:"border border-ft2-border rounded",children:[wn.jsxs("button",{onClick:()=>x("blockops"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[wn.jsxs("span",{className:"flex items-center gap-2",children:[wn.jsx(Ve,{size:14}),"Block Operations"]}),wn.jsx("span",{children:"blockops"===h?"":""})]}),"blockops"===h&&wn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[wn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform selected block content"}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsxs("button",{onClick:i,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[wn.jsx(Ve,{size:12}),"Reverse"]}),wn.jsxs("button",{onClick:d,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[wn.jsx(He,{size:12}),"Duplicate"]}),wn.jsxs("button",{onClick:l,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[wn.jsx(At,{size:12}),"Expand 2x"]}),wn.jsxs("button",{onClick:c,disabled:!b,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[wn.jsx(_t,{size:12}),"Shrink 2x"]})]}),wn.jsxs("div",{className:"mt-3 pt-2 border-t border-ft2-border",children:[wn.jsxs("div",{className:"text-xs text-ft2-textDim mb-2 flex items-center gap-1",children:[wn.jsx(It,{size:12}),"Math Operations"]}),wn.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[wn.jsxs("select",{value:g,onChange:e=>v(e.target.value),className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text",children:[wn.jsx("option",{value:"volume",children:"Volume"}),wn.jsx("option",{value:"eff",children:"Effect"})]}),wn.jsx("input",{type:"number",value:f,onChange:e=>{const t=Number(e.target.value);isNaN(t)||y(Math.max(0,Math.min(255,t)))},className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text w-16",min:0,max:255})]}),wn.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[wn.jsx("button",{onClick:()=>u?.("add",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"}),wn.jsx("button",{onClick:()=>u?.("sub",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),wn.jsx("button",{onClick:()=>u?.("mul",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),wn.jsx("button",{onClick:()=>u?.("div",f,g),disabled:!b,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""})]})]}),wn.jsx("div",{className:"text-[10px] text-ft2-textDim mt-1",children:"Alt+R = Reverse | Alt+D = Duplicate"})]})]}),wn.jsxs("div",{className:"border border-ft2-border rounded",children:[wn.jsxs("button",{onClick:()=>x("remap"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[wn.jsxs("span",{className:"flex items-center gap-2",children:[wn.jsx(wt,{size:14}),"Instrument Remap"]}),wn.jsx("span",{children:"remap"===h?"":""})]}),"remap"===h&&wn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[wn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Find and replace instrument IDs"}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsx("button",{onClick:()=>a?.("block"),disabled:!b,className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Remap Block"}),wn.jsx("button",{onClick:()=>a?.("track"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Track"}),wn.jsx("button",{onClick:()=>a?.("pattern"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Pattern"}),wn.jsx("button",{onClick:()=>a?.("song"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Song"})]})]})]}),wn.jsxs("div",{className:"border border-ft2-border rounded",children:[wn.jsxs("button",{onClick:()=>x("export"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[wn.jsxs("span",{className:"flex items-center gap-2",children:[wn.jsx(Ue,{size:14}),"Export/Import"]}),wn.jsx("span",{children:"export"===h?"":""})]}),"export"===h&&wn.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[wn.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Export patterns and tracks as FT2-compatible files"}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[wn.jsxs("button",{onClick:r,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[wn.jsx(Ue,{size:12}),"Pattern (.xp)"]}),wn.jsxs("button",{onClick:o,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[wn.jsx(Ue,{size:12}),"Track (.xt)"]})]}),wn.jsx("div",{className:"text-xs text-ft2-textDim mt-2",children:"Import: Use File  Open Module"})]})]}),wn.jsxs("div",{className:"border border-ft2-border rounded",children:[wn.jsxs("button",{onClick:()=>x("macros"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[wn.jsx("span",{children:"Macro Slots"}),wn.jsx("span",{children:"macros"===h?"":""})]}),"macros"===h&&wn.jsx("div",{className:"p-3 bg-dark-bgSecondary",children:wn.jsx(EN,{})})]})]})]})})},TN=[{title:"Navigation",shortcuts:[{keys:"Arrow Up/Down",action:"Move cursor up/down"},{keys:"Arrow Left/Right",action:"Move cursor left/right"},{keys:"Tab / Shift+Tab",action:"Next/prev channel"},{keys:"PageUp / PageDown",action:"Jump 16 rows"},{keys:"Home / End",action:"Jump to first/last row"},{keys:"F9-F12",action:"Jump to 0%/25%/50%/75%"},{keys:"Shift+Arrow L/R",action:"Prev/next pattern"},{keys:"Alt+Q-I",action:"Jump to tracks 0-7"},{keys:"Alt+A-K",action:"Jump to tracks 8-15"}]},{title:"Playback",shortcuts:[{keys:"Space",action:"Stop / toggle edit mode"},{keys:"Right Shift",action:"Record + play pattern"},{keys:"Right Ctrl",action:"Play song"},{keys:"Right Alt",action:"Play pattern"},{keys:"Ctrl+Enter",action:"Play song"}]},{title:"Note Entry",shortcuts:[{keys:"Z-M (bottom row)",action:"Notes C-B (lower octave)"},{keys:"Q-P (top row)",action:"Notes C-E (upper octave)"},{keys:"F1-F7",action:"Select octave 1-7"},{keys:"Numpad +/-",action:"Octave up/down"},{keys:"CapsLock",action:"Note off"},{keys:"` / ~",action:"Edit step +1 / -1"}]},{title:"Editing",shortcuts:[{keys:"Delete",action:"Delete at cursor"},{keys:"Shift+Delete",action:"Delete entire cell"},{keys:"Backspace",action:"Delete previous & move up"},{keys:"Insert",action:"Insert row / toggle insert mode"},{keys:"Shift+Insert",action:"Insert entire line"}]},{title:"Block Operations",shortcuts:[{keys:"Alt+B / Alt+E",action:"Mark block start/end"},{keys:"Ctrl+C / Ctrl+X",action:"Copy / Cut"},{keys:"Ctrl+V",action:"Paste"},{keys:"Ctrl+Shift+V",action:"Mix paste (fill empty)"},{keys:"Ctrl+Shift+F",action:"Flood paste (to end)"},{keys:"F3 / F4 / F5",action:"Cut / Copy / Paste (FT2)"},{keys:"Alt+Arrow keys",action:"Extend selection"}]},{title:"Transpose",shortcuts:[{keys:"Ctrl+Up/Down",action:"Transpose 1 semitone"},{keys:"Ctrl+Shift+Up/Down",action:"Transpose 1 octave"},{keys:"Alt+T / Alt+Shift+T",action:"Block transpose 1"}]},{title:"Macros & Dialogs",shortcuts:[{keys:"Ctrl+1-8",action:"Recall macro slot"},{keys:"Ctrl+Shift+1-8",action:"Save macro slot"},{keys:"Ctrl+I",action:"Interpolate"},{keys:"Ctrl+H",action:"Humanize"},{keys:"Ctrl+F",action:"Find & Replace"},{keys:"Ctrl+O",action:"Import module"},{keys:"?",action:"This shortcut sheet"}]},{title:"Effect Commands",shortcuts:[{keys:"0xy",action:"Arpeggio"},{keys:"1/2xx",action:"Pitch slide up/down"},{keys:"3xx",action:"Tone portamento"},{keys:"4xy",action:"Vibrato"},{keys:"Axy",action:"Volume slide"},{keys:"Cxx",action:"Set volume (00-40)"},{keys:"Fxx",action:"Speed (01-1F) / BPM (20-FF)"},{keys:"Exy",action:"Extended commands"}]}],AN=({isOpen:e,onClose:t})=>{const n=s.useRef(null),[a,r]=s.useState("");if(s.useEffect(()=>{if(!e)return;const n=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[e,t]),!e)return null;const o=a.toLowerCase(),i=TN.map(e=>({...e,shortcuts:e.shortcuts.filter(e=>e.keys.toLowerCase().includes(o)||e.action.toLowerCase().includes(o))})).filter(e=>e.shortcuts.length>0);return wn.jsx("div",{ref:n,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:t,children:wn.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[720px] max-w-[90vw] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-neutral-700",children:[wn.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"Keyboard Shortcuts"}),wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("input",{type:"text",placeholder:"Filter...",value:a,onChange:e=>r(e.target.value),className:"bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 w-32 focus:outline-none focus:border-blue-500",autoFocus:!0,"aria-label":"Filter keyboard shortcuts"}),wn.jsx("button",{onClick:t,className:"text-neutral-400 hover:text-neutral-200 transition-colors",children:wn.jsx(Ee,{size:18})})]})]}),wn.jsx("div",{className:"overflow-y-auto p-5",children:wn.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(e=>wn.jsxs("div",{className:"space-y-1",children:[wn.jsx("h3",{className:"text-xs font-bold text-blue-400 uppercase tracking-wide mb-2",children:e.title}),e.shortcuts.map((t,n)=>wn.jsxs("div",{className:"flex items-center justify-between gap-2 py-0.5",children:[wn.jsx("kbd",{className:"text-[10px] font-mono bg-neutral-800 border border-neutral-600 rounded px-1.5 py-0.5 text-yellow-300 whitespace-nowrap",children:t.keys}),wn.jsx("span",{className:"text-[11px] text-neutral-300 text-right",children:t.action})]},`${e.title}-${n}`))]},e.title))})}),wn.jsxs("div",{className:"px-5 py-2 border-t border-neutral-700 text-[10px] text-neutral-500 text-center",children:["Press ",wn.jsx("kbd",{className:"bg-neutral-800 border border-neutral-600 rounded px-1 text-yellow-400",children:"Esc"})," to close"," "," | Ctrl/Cmd shown as Ctrl (use Cmd on macOS)"]})]})})},_N={0:{command:"0xy",name:"Arpeggio",description:"Rapidly cycle between note, note+x semitones, note+y semitones",parameters:"x=1st offset (0-F hex), y=2nd offset (0-F hex)",tick:"tick-N",category:"misc"},1:{command:"1xx",name:"Pitch Slide Up",description:"Slide pitch upward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},2:{command:"2xx",name:"Pitch Slide Down",description:"Slide pitch downward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},3:{command:"3xx",name:"Tone Portamento",description:"Slide pitch toward target note",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},4:{command:"4xy",name:"Vibrato",description:"Oscillate pitch up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"pitch"},5:{command:"5xy",name:"Tone Porta + Vol Slide",description:"Continue tone portamento while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},6:{command:"6xy",name:"Vibrato + Vol Slide",description:"Continue vibrato while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},7:{command:"7xy",name:"Tremolo",description:"Oscillate volume up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"volume"},8:{command:"8xx",name:"Set Panning",description:"Set channel panning position",parameters:"xx=position (00=left, 80=center, FF=right)",tick:"tick-0",category:"panning"},9:{command:"9xx",name:"Sample Offset",description:"Start sample playback at offset",parameters:"xx=offset (multiply by 256 samples)",tick:"tick-0",category:"sample"},A:{command:"Axy",name:"Volume Slide",description:"Slide volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"volume"},B:{command:"Bxx",name:"Position Jump",description:"Jump to pattern in order list",parameters:"xx=position (00-FF hex)",tick:"tick-0",category:"global"},C:{command:"Cxx",name:"Set Volume",description:"Set channel volume directly",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"volume"},D:{command:"Dxx",name:"Pattern Break",description:"Break pattern and jump to row in next pattern",parameters:"xx=row (00-3F hex, 0-63 decimal)",tick:"tick-0",category:"global"},E:{command:"Exy",name:"Extended Command",description:"Extended effects (see E-commands)",parameters:"x=sub-command (0-F), y=parameter",tick:"both",category:"misc"},F:{command:"Fxx",name:"Set Speed/BPM",description:"Set speed (01-1F) or BPM (20-FF)",parameters:"xx=speed/BPM (01-1F=speed, 20-FF=BPM)",tick:"tick-0",category:"global"},G:{command:"Gxx",name:"Set Global Volume",description:"Set global volume for all channels",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"global"},H:{command:"Hxy",name:"Global Volume Slide",description:"Slide global volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"global"}},IN={E0:{command:"E0x",name:"Set Filter (Amiga)",description:"Enable/disable Amiga LED filter",parameters:"x=0 (filter on) or 1 (filter off)",tick:"tick-0",category:"misc"},E1:{command:"E1x",name:"Fine Pitch Slide Up",description:"Slide pitch up once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E2:{command:"E2x",name:"Fine Pitch Slide Down",description:"Slide pitch down once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E3:{command:"E3x",name:"Glissando Control",description:"Enable/disable glissando (semitone portamento)",parameters:"x=0 (off) or 1 (on)",tick:"tick-0",category:"pitch"},E4:{command:"E4x",name:"Set Vibrato Waveform",description:"Set vibrato waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"pitch"},E5:{command:"E5x",name:"Set Finetune",description:"Set sample finetune",parameters:"x=finetune (-8 to +7, stored as 0-F)",tick:"tick-0",category:"sample"},E6:{command:"E6x",name:"Pattern Loop",description:"Loop pattern section",parameters:"x=0 (set loop start) or 1-F (loop count)",tick:"tick-0",category:"global"},E7:{command:"E7x",name:"Set Tremolo Waveform",description:"Set tremolo waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"volume"},E8:{command:"E8x",name:"Set Panning (Fine)",description:"Set panning with fine control",parameters:"x=panning (0=left, 8=center, F=right)",tick:"tick-0",category:"panning"},E9:{command:"E9x",name:"Retrigger Note",description:"Retrigger note every x ticks",parameters:"x=retrigger rate (1-F ticks)",tick:"tick-N",category:"timing"},EA:{command:"EAx",name:"Fine Volume Slide Up",description:"Slide volume up once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EB:{command:"EBx",name:"Fine Volume Slide Down",description:"Slide volume down once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EC:{command:"ECx",name:"Note Cut",description:"Cut note (set volume to 0) at tick x",parameters:"x=tick to cut (0=immediate, 1-F=delayed)",tick:"both",category:"timing"},ED:{command:"EDx",name:"Note Delay",description:"Delay note trigger by x ticks",parameters:"x=delay in ticks (0-F)",tick:"tick-N",category:"timing"},EE:{command:"EEx",name:"Pattern Delay",description:"Delay pattern by x rows",parameters:"x=rows to delay (0-F)",tick:"tick-0",category:"global"},EF:{command:"EFx",name:"Funk Repeat (Invert Loop)",description:"Invert sample loop at speed x (Amiga)",parameters:"x=invert speed (0-F)",tick:"tick-N",category:"sample"}},DN={10:{command:"10xx",name:"Set LFO Speed",description:"Set the LFO speed for FM chip vibrato/tremolo",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set TL (Total Level)",description:"Set operator total level (volume)",parameters:"xx=TL value (00-7F, lower=louder)",tick:"tick-0",category:"volume"},12:{command:"12xx",name:"Set AR (Attack Rate)",description:"Set operator attack rate",parameters:"xx=AR value (00-1F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set DR (Decay Rate)",description:"Set operator decay rate",parameters:"xx=DR value (00-1F)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set MULT (Multiplier)",description:"Set operator frequency multiplier",parameters:"xx=MULT value (00-0F)",tick:"tick-0",category:"pitch"},15:{command:"15xx",name:"Set RR (Release Rate)",description:"Set operator release rate",parameters:"xx=RR value (00-0F)",tick:"tick-0",category:"misc"},16:{command:"16xx",name:"Set SL (Sustain Level)",description:"Set operator sustain level",parameters:"xx=SL value (00-0F)",tick:"tick-0",category:"volume"},17:{command:"17xx",name:"Set DT (Detune)",description:"Set operator detune",parameters:"xx=DT value (00-07)",tick:"tick-0",category:"pitch"},18:{command:"18xx",name:"Set SSG-EG",description:"Set SSG envelope generator mode",parameters:"xx=SSG-EG mode (00-0F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"Set Algorithm",description:"Set FM algorithm (operator routing)",parameters:"xx=algorithm (00-07)",tick:"tick-0",category:"misc"},"1A":{command:"1Axx",name:"Set Feedback",description:"Set operator 1 feedback level",parameters:"xx=feedback (00-07)",tick:"tick-0",category:"misc"},"1B":{command:"1Bxy",name:"Set AM/PM Depth",description:"Set amplitude/phase modulation depth",parameters:"x=AM depth (0-3), y=PM depth (0-7)",tick:"tick-0",category:"misc"},"1C":{command:"1Cxx",name:"FM Hard Reset",description:"Force hard reset on note (key-off before key-on)",parameters:"xx=01 (enable), 00 (disable)",tick:"tick-0",category:"misc"}},ON={10:{command:"10xx",name:"Set Filter Cutoff",description:"Set SID filter cutoff frequency",parameters:"xx=cutoff (00-FF, 11-bit scaled)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Filter Resonance",description:"Set SID filter resonance",parameters:"xx=resonance (00-0F)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Filter Mode",description:"Set SID filter mode",parameters:"xx: 0=off, 1=LP, 2=BP, 4=HP (can combine)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Ring Mod",description:"Enable/disable ring modulation",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Hard Sync",description:"Enable/disable oscillator hard sync",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pulse Width",description:"Set pulse wave width",parameters:"xx=pulse width (00-FF, scaled to 12-bit)",tick:"tick-0",category:"misc"}},FN={11:{command:"11xx",name:"Set DMC",description:"Set DMC sample parameters",parameters:"xx=DMC control value",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty/Noise",description:"Set pulse duty or noise mode",parameters:"xx: pulse 0-3=duty, noise 0=short 1=long",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (pulse channels)",parameters:"x=period, y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Envelope Mode",description:"Set envelope/length counter mode",parameters:"xx=envelope settings",tick:"tick-0",category:"misc"},18:{command:"18xx",name:"FDS Mod Depth",description:"Set FDS modulation depth",parameters:"xx=mod depth (00-3F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"FDS Mod Speed High",description:"Set FDS modulation speed (high byte)",parameters:"xx=speed high byte",tick:"tick-0",category:"misc"}},RN={10:{command:"10xx",name:"Set Envelope Shape",description:"Set AY envelope shape",parameters:"xx=shape (00-0F)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Envelope Period Low",description:"Set AY envelope period (low byte)",parameters:"xx=period low byte",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Envelope Period High",description:"Set AY envelope period (high byte)",parameters:"xx=period high byte",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Auto-Envelope",description:"Enable auto-envelope (track note pitch)",parameters:"xx=auto-envelope numerator",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Noise Freq",description:"Set noise frequency",parameters:"xx=noise period (00-1F)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Noise Mode",description:"Set noise/tone mixing mode",parameters:"xx=mode bits (tone/noise enable)",tick:"tick-0",category:"misc"}},jN={10:{command:"10xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Wave Position",description:"Set wave position in RAM",parameters:"xx=position (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave Length",description:"Set wave length",parameters:"xx=length (must be power of 2)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Wave Load",description:"Load wave from position",parameters:"xx=load parameters",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Channel Limit",description:"Set max active channels (N163)",parameters:"xx=channel count (1-8)",tick:"tick-0",category:"misc"}},LN={10:{command:"10xx",name:"Set Sample Mode",description:"Set sample playback mode",parameters:"xx=mode (chip-specific)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Sample Bank",description:"Set sample bank",parameters:"xx=bank number",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Direction",description:"Set sample playback direction",parameters:"xx: 0=forward, 1=reverse",tick:"tick-0",category:"sample"},20:{command:"20xx",name:"ES5506 Filter Mode",description:"Set ES5506 filter mode",parameters:"xx=filter mode (00-03)",tick:"tick-0",category:"misc"},21:{command:"21xx",name:"ES5506 Filter K1",description:"Set ES5506 filter K1 coefficient",parameters:"xx=K1 value",tick:"tick-0",category:"misc"},22:{command:"22xx",name:"ES5506 Filter K2",description:"Set ES5506 filter K2 coefficient",parameters:"xx=K2 value",tick:"tick-0",category:"misc"},30:{command:"30xx",name:"QSound Echo",description:"Set QSound echo feedback",parameters:"xx=echo feedback",tick:"tick-0",category:"misc"},31:{command:"31xx",name:"QSound Surround",description:"Set QSound surround/3D position",parameters:"xx=surround position",tick:"tick-0",category:"panning"}},BN={FurnaceOPN:DN,FurnaceOPN2:DN,FurnaceOPM:DN,FurnaceOPL:DN,FurnaceOPL2:DN,FurnaceOPL3:DN,FurnaceOPLL:DN,FurnaceOPZ:DN,FurnaceESFM:DN,FurnaceC64:ON,FurnaceSID2:ON,FurnaceSID3:ON,FurnaceGB:{10:{command:"10xx",name:"Set Envelope",description:"Set volume envelope (NRx2 register)",parameters:"xx: high nibble=volume, low nibble=direction+period",tick:"tick-0",category:"volume"},11:{command:"11xx",name:"Set Wave",description:"Load wavetable into wave channel",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty",description:"Set pulse wave duty cycle",parameters:"xx: 0=12.5%, 1=25%, 2=50%, 3=75%",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (channel 1 only)",parameters:"x=period (0-7), y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Noise Mode",description:"Set noise channel width mode",parameters:"xx: 0=15-bit (normal), 1=7-bit (metallic)",tick:"tick-0",category:"misc"}},FurnaceNES:FN,FurnaceFDS:FN,FurnaceVRC6:FN,Furnace5E01:FN,FurnacePCE:{10:{command:"10xx",name:"Set LFO Mode",description:"Set PCE LFO mode",parameters:"xx=LFO mode (00-03)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set LFO Speed",description:"Set PCE LFO speed",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"}},FurnaceAY:RN,FurnaceAY8930:RN,FurnaceSAA:RN,FurnaceSMS:RN,FurnaceT6W28:RN,FurnaceN163:jN,FurnaceSCC:jN,FurnaceVB:jN,FurnaceSWAN:jN,FurnaceX1_010:jN,FurnaceSNES:{10:{command:"10xx",name:"Set Echo Enable",description:"Enable/disable echo for channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Echo Delay",description:"Set echo delay time",parameters:"xx=delay (00-0F, 16ms steps)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Echo Feedback",description:"Set echo feedback amount",parameters:"xx=feedback (-80 to 7F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Echo Volume",description:"Set echo volume",parameters:"xx=volume (-80 to 7F)",tick:"tick-0",category:"volume"},14:{command:"14xx",name:"Set Echo FIR",description:"Set echo FIR filter coefficient",parameters:"xx=coefficient index and value",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pitch Mod",description:"Enable pitch modulation from prev channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"pitch"},16:{command:"16xx",name:"Set Gain Mode",description:"Set ADSR/gain mode",parameters:"xx=gain mode (see SNES docs)",tick:"tick-0",category:"misc"},17:{command:"17xx",name:"Set Invert",description:"Invert waveform phase",parameters:"xx: 1=left, 2=right, 3=both",tick:"tick-0",category:"misc"}},FurnaceAmiga:LN,FurnaceSEGAPCM:LN,FurnaceQSOUND:LN,FurnaceES5506:LN,FurnaceRF5C68:LN,FurnaceC140:LN,FurnaceC219:LN,FurnaceK054539:LN,FurnaceYMZ280B:LN,FurnaceGA20:LN,FurnaceK007232:LN,FurnaceK053260:LN,FurnaceOKI:LN};const VN={pitch:"Pitch",volume:"Volume",panning:"Panning",timing:"Timing",global:"Global",sample:"Sample",misc:"Misc",chip:"Chip"},zN=["pitch","volume","panning","timing","global","sample","misc"],UN={pitch:"text-blue-400",volume:"text-emerald-400",panning:"text-purple-400",timing:"text-yellow-400",global:"text-red-400",sample:"text-cyan-400",misc:"text-orange-400",chip:"text-pink-400"},GN=({isOpen:e,position:t,onSelect:n,onClose:a,synthType:r})=>{const[o,i]=s.useState(""),[l,c]=s.useState("all"),d=s.useRef(null),u=s.useRef(null);s.useEffect(()=>{e&&u.current&&u.current.focus()},[e]),s.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&(e.preventDefault(),a())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,a]);const p=r&&function(e){return e.startsWith("Furnace")||e in BN}(r),h=s.useMemo(()=>{const e=[];if(Object.entries(_N).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!1,isFurnace:!1})}),Object.entries(IN).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!0,isFurnace:!1})}),p&&r){const t=function(e){return e&&BN[e]?Object.values(BN[e]):Object.values(DN)}(r);t.forEach(t=>{const n=t.command.substring(0,2);e.push({...t,key:n,isExtended:!1,isFurnace:!0,category:"misc"})})}return e},[p,r]),m=s.useMemo(()=>{const e=o.toLowerCase();return h.filter(t=>{if("chip"===l){if(!t.isFurnace)return!1}else if("all"!==l){if(t.isFurnace)return!1;if(t.category!==l)return!1}return!o||(t.name.toLowerCase().includes(e)||t.command.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))})},[h,o,l]);if(!e)return null;const f=t?{position:"fixed",left:Math.max(0,Math.min(t.x,window.innerWidth-400)),top:Math.max(0,Math.min(t.y,window.innerHeight-500)),zIndex:60}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:60};return wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"fixed inset-0 bg-black/40 z-50",onClick:a}),wn.jsxs("div",{ref:d,className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[380px] max-h-[480px] flex flex-col z-[60]",style:f,children:[wn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[wn.jsx("h3",{className:"text-sm font-semibold text-neutral-100",children:"Effect Commands"}),wn.jsx("button",{onClick:a,className:"text-neutral-400 hover:text-neutral-200","aria-label":"Close effect picker",children:wn.jsx(Ee,{size:16})})]}),wn.jsx("div",{className:"px-3 py-2 border-b border-neutral-800",children:wn.jsx("input",{ref:u,type:"text",placeholder:"Search effects...",value:o,onChange:e=>i(e.target.value),className:"w-full bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 focus:outline-none focus:border-blue-500","aria-label":"Search effects"})}),wn.jsxs("div",{className:"flex flex-wrap gap-1 px-3 py-1.5 border-b border-neutral-800",children:[wn.jsx("button",{onClick:()=>c("all"),className:"px-2 py-0.5 text-[10px] rounded "+("all"===l?"bg-neutral-700 text-white":"text-neutral-400 hover:text-neutral-200"),children:"All"}),zN.map(e=>wn.jsx("button",{onClick:()=>c(e),className:"px-2 py-0.5 text-[10px] rounded "+(l===e?"bg-neutral-700 text-white":`${UN[e]} hover:opacity-80`),children:VN[e]},e)),p&&wn.jsxs("button",{onClick:()=>c("chip"),className:"px-2 py-0.5 text-[10px] rounded "+("chip"===l?"bg-pink-700 text-white":`${UN.chip} hover:opacity-80`),children:[VN.chip," (",r?.replace("Furnace",""),")"]})]}),wn.jsx("div",{className:"overflow-y-auto flex-1 p-1",children:0===m.length?wn.jsx("div",{className:"text-center text-neutral-500 text-xs py-4",children:"No effects match"}):m.map(e=>{const t=e.isFurnace?UN.chip:UN[e.category];return wn.jsxs("button",{onClick:()=>(e=>{if(e.isExtended){const t=parseInt(e.key.substring(1),16);n(14,t<<4)}else if(e.isFurnace){const t=parseInt(e.key,16);n(t,0)}else{const t=parseInt(e.key,16);n(t,0)}a()})(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-800 transition-colors text-left group",children:[wn.jsx("span",{className:`font-mono text-xs font-bold w-8 ${t}`,children:e.command.substring(0,3)}),wn.jsxs("div",{className:"flex-1 min-w-0",children:[wn.jsxs("div",{className:"text-xs text-neutral-200 truncate",children:[e.name,e.isFurnace&&wn.jsx("span",{className:"ml-1 text-[9px] text-pink-400",children:"(Chip)"})]}),wn.jsx("div",{className:"text-[10px] text-neutral-500 truncate",children:e.description})]}),wn.jsx("span",{className:"text-[9px] text-neutral-600 group-hover:text-neutral-400",children:"tick-0"===e.tick?"T0":"tick-N"===e.tick?"TN":"T*"})]},e.isFurnace?`f-${e.key}`:e.isExtended?`e-${e.key}`:`n-${e.key}`)})})]})]})},WN={"text-blue-400":"bg-blue-400","text-green-400":"bg-green-400","text-yellow-400":"bg-yellow-400","text-red-400":"bg-red-400","text-purple-400":"bg-purple-400","text-orange-400":"bg-orange-400","text-cyan-400":"bg-cyan-400","text-neutral-400":"bg-neutral-400"},KN=e=>WN[e]||"bg-neutral-400",HN=({isOpen:e,onClose:t})=>{const{undoStack:n,redoStack:a,undo:s,redo:r}=zy();if(!e)return null;const o=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return wn.jsxs("div",{className:"absolute right-0 top-0 w-64 h-full bg-neutral-900 border-l border-neutral-700 flex flex-col z-30 shadow-xl",children:[wn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(Dt,{size:14,className:"text-neutral-400"}),wn.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"History"})]}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx("button",{onClick:s,disabled:0===n.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Undo","aria-label":"Undo",children:wn.jsx(Ot,{size:12,className:"text-neutral-400"})}),wn.jsx("button",{onClick:r,disabled:0===a.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Redo","aria-label":"Redo",children:wn.jsx(Ft,{size:12,className:"text-neutral-400"})}),wn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors text-xs","aria-label":"Close history panel",children:"x"})]})]}),wn.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a.length>0&&wn.jsxs("div",{className:"opacity-40",children:[wn.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Redo (",a.length,")"]}),[...a].reverse().map((e,t)=>wn.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>r(),title:"Redo one step",children:[wn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${KN(Gy(e.type))}`}),wn.jsx("div",{className:"flex-1 min-w-0",children:wn.jsx("div",{className:"text-[10px] text-neutral-400 truncate",children:Uy(e.type)})}),wn.jsx("span",{className:"text-[9px] text-neutral-600",children:o(e.timestamp)})]},`redo-${e.id}-${t}`))]}),wn.jsx("div",{className:"px-3 py-1 bg-blue-900/30 border-y border-blue-800/50",children:wn.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"Current State"})}),n.length>0?wn.jsxs("div",{children:[wn.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Undo (",n.length,")"]}),[...n].reverse().map((e,t)=>wn.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>s(),title:"Undo one step",children:[wn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${KN(Gy(e.type))}`}),wn.jsxs("div",{className:"flex-1 min-w-0",children:[wn.jsx("div",{className:"text-[10px] text-neutral-300 truncate",children:Uy(e.type)}),e.description&&wn.jsx("div",{className:"text-[9px] text-neutral-500 truncate",children:e.description})]}),wn.jsx("span",{className:"text-[9px] text-neutral-600",children:o(e.timestamp)})]},`undo-${e.id}-${t}`))]}):wn.jsx("div",{className:"text-center text-neutral-600 text-xs py-8",children:"No history yet"})]}),wn.jsx("div",{className:"px-3 py-1.5 border-t border-neutral-700 text-[9px] text-neutral-600 text-center",children:"Ctrl+Z undo | Ctrl+Y redo"})]})},$N=({isOpen:e,onClose:t})=>{const{patterns:n,patternOrder:a,currentPositionIndex:r,setCurrentPosition:o,addToOrder:i,removeFromOrder:l}=tf(Fn(e=>({patterns:e.patterns,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,addToOrder:e.addToOrder,removeFromOrder:e.removeFromOrder}))),c=s.useCallback(e=>{o(e)},[o]),d=s.useCallback(()=>{i(0)},[i]),u=s.useCallback(e=>{a.length>1&&l(e)},[l,a.length]),p=s.useCallback((e,t)=>{tf.setState(n=>{const a=[...n.patternOrder];return a[e]=t,{patternOrder:a}})},[]);return e?wn.jsxs("div",{className:"absolute left-0 top-0 w-56 h-full bg-neutral-900 border-r border-neutral-700 flex flex-col z-30 shadow-xl",children:[wn.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[wn.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"Pattern Matrix"}),wn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors",children:wn.jsx(Ee,{size:14})})]}),wn.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:wn.jsxs("table",{className:"w-full border-collapse",children:[wn.jsx("thead",{children:wn.jsxs("tr",{children:[wn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pos"}),wn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pattern"}),wn.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-right",children:"Len"}),wn.jsx("th",{className:"w-6"})]})}),wn.jsx("tbody",{children:a.map((e,t)=>{const s=t===r,o=n[e];return wn.jsxs("tr",{className:"cursor-pointer transition-colors "+(s?"bg-blue-900/40 text-blue-300":"hover:bg-neutral-800 text-neutral-300"),onClick:()=>c(t),children:[wn.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-neutral-500",children:t.toString(16).toUpperCase().padStart(2,"0")}),wn.jsx("td",{className:"px-1 py-0.5",children:wn.jsx("select",{value:e,onChange:e=>{e.stopPropagation(),p(t,parseInt(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-full bg-transparent text-[10px] font-mono cursor-pointer focus:outline-none "+(s?"text-blue-300":"text-neutral-300"),children:n.map((e,t)=>wn.jsxs("option",{value:t,className:"bg-neutral-900 text-neutral-200",children:[t.toString(16).toUpperCase().padStart(2,"0"),n[t]?.name?` ${n[t].name}`:""]},t))})}),wn.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-right text-neutral-500",children:o?.length||"?"}),wn.jsx("td",{className:"px-0.5 py-0.5",children:wn.jsx("button",{onClick:e=>{e.stopPropagation(),u(t)},className:"p-0.5 rounded hover:bg-red-900/50 text-neutral-600 hover:text-red-400 transition-colors",title:"Remove position",disabled:a.length<=1,children:wn.jsx(Ee,{size:10})})})]},t)})})]})}),wn.jsxs("div",{className:"px-3 py-2 border-t border-neutral-700 flex items-center justify-between",children:[wn.jsxs("span",{className:"text-[9px] text-neutral-500",children:[a.length," positions | ",n.length," patterns"]}),wn.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-[10px] bg-neutral-800 hover:bg-neutral-700 text-neutral-300 rounded transition-colors",children:[wn.jsx(Ye,{size:10}),"Add"]})]})]}):null},qN=({label:e,value:t,onChange:n,min:a=0,max:r=999,step:o=1,format:i="decimal",throttleMs:l=0,presets:c})=>{const d=s.useRef(null),u=s.useRef(null),p=s.useRef(t),h=s.useRef(0),m=s.useRef(null),[f,y]=s.useState(!1),[g,v]=s.useState({x:0,y:0});s.useEffect(()=>{p.current=t},[t]),s.useEffect(()=>()=>{d.current&&clearInterval(d.current),u.current&&clearTimeout(u.current)},[]),s.useEffect(()=>{if(!f)return;const e=e=>{m.current&&!m.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const b=s.useCallback(e=>{c&&0!==c.length&&(e.preventDefault(),v({x:e.clientX,y:e.clientY}),y(!0))},[c]),x=s.useCallback(e=>{n(e),y(!1)},[n]),w=s.useCallback(e=>{const t=Date.now();l>0&&t-h.current<l||(h.current=t,n(e))},[n,l]),k=s.useCallback(()=>{const e=Math.min(r,p.current+o);p.current=e,w(e)},[r,o,w]),S=s.useCallback(()=>{const e=Math.max(a,p.current-o);p.current=e,w(e)},[a,o,w]),M=s.useCallback(e=>{e(),u.current&&clearTimeout(u.current),d.current&&clearInterval(d.current),u.current=window.setTimeout(()=>{d.current=window.setInterval(e,80)},300)},[]),N=s.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null),d.current&&(clearInterval(d.current),d.current=null)},[]);return wn.jsxs("div",{ref:m,className:"ft2-numeric-group",onContextMenu:b,title:c?"Right-click for presets":void 0,children:[wn.jsxs("span",{className:"ft2-numeric-label",children:[e,":"]}),wn.jsx("span",{className:"ft2-numeric-value",children:(C=t,"hex"===i?C.toString(16).toUpperCase().padStart(2,"0"):C.toString().padStart(3,"0"))}),wn.jsxs("div",{className:"ft2-numeric-arrows",children:[wn.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>M(k),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(k),onTouchEnd:N,title:`Increase ${e}`,children:wn.jsx("span",{className:"ft2-arrow-icon",children:""})}),wn.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>M(S),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(S),onTouchEnd:N,title:`Decrease ${e}`,children:wn.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),f&&c&&wn.jsx("div",{className:"ft2-presets-menu",style:{position:"fixed",left:g.x,top:g.y,zIndex:1e3,backgroundColor:"#1a1a1d",border:"1px solid #333",borderRadius:"4px",padding:"4px 0",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",minWidth:"100px"},children:c.map(e=>wn.jsx("button",{onClick:()=>x(e.value),className:"ft2-preset-item",style:{display:"block",width:"100%",padding:"6px 12px",textAlign:"left",background:t===e.value?"#333":"transparent",border:"none",color:t===e.value?"#ef4444":"#e0e0e0",cursor:"pointer",fontSize:"12px",fontFamily:"monospace"},onMouseEnter:e=>e.currentTarget.style.background="#2a2a2d",onMouseLeave:n=>n.currentTarget.style.background=t===e.value?"#333":"transparent",children:e.label},e.value))})]});var C},YN={TB303:{type:"TB303",name:"TB-303",shortName:"303",description:"Classic acid bass synthesizer with resonant filter and slide",bestFor:["Acid bass","Squelchy lines","Techno","House"],icon:"Zap",color:"text-accent-primary"},MonoSynth:{type:"MonoSynth",name:"Mono Synth",shortName:"Mono",description:"Single-voice synth with oscillator, filter, and envelope",bestFor:["Bass","Lead lines","Portamento"],icon:"AudioLines",color:"text-blue-400"},Synth:{type:"Synth",name:"Basic Synth",shortName:"Synth",description:"Simple polyphonic synthesizer with amplitude envelope",bestFor:["Pads","Chords","Simple sounds"],icon:"Music2",color:"text-purple-400"},DuoSynth:{type:"DuoSynth",name:"Duo Synth",shortName:"Duo",description:"Two-voice synth with harmonics and vibratoesque LFO",bestFor:["Rich leads","Detuned sounds","Fat bass"],icon:"Layers",color:"text-indigo-400"},FMSynth:{type:"FMSynth",name:"FM Synth",shortName:"FM",description:"Frequency modulation synth for complex harmonic tones",bestFor:["Bells","Electric piano","Metallic sounds"],icon:"Radio",color:"text-cyan-400"},AMSynth:{type:"AMSynth",name:"AM Synth",shortName:"AM",description:"Amplitude modulation synth with ring modulation character",bestFor:["Tremolo effects","Ring mod","Atmospheric"],icon:"Activity",color:"text-teal-400"},PluckSynth:{type:"PluckSynth",name:"Pluck Synth",shortName:"Pluck",description:"Karplus-Strong string synthesis for plucked strings",bestFor:["Guitar","Harp","Pizzicato","String plucks"],icon:"Guitar",color:"text-amber-400"},MembraneSynth:{type:"MembraneSynth",name:"Membrane Synth",shortName:"Membrane",description:"Drum membrane simulation for kicks and toms",bestFor:["Kick drums","Toms","Percussion"],icon:"Circle",color:"text-orange-400"},MetalSynth:{type:"MetalSynth",name:"Metal Synth",shortName:"Metal",description:"Metallic percussion synthesis with harmonics",bestFor:["Hi-hats","Cymbals","Bells","Metallic hits"],icon:"Hexagon",color:"text-yellow-400"},NoiseSynth:{type:"NoiseSynth",name:"Noise Synth",shortName:"Noise",description:"Filtered noise generator with envelope",bestFor:["Snares","Hi-hats","Risers","FX"],icon:"Hash",color:"text-gray-400"},Wavetable:{type:"Wavetable",name:"Wavetable",shortName:"Wave",description:"Wavetable synth with morphing and unison",bestFor:["Evolving pads","Modern bass","Complex timbres"],icon:"Waves",color:"text-pink-400"},Sampler:{type:"Sampler",name:"Sampler",shortName:"Sampler",description:"Multi-sample playback with velocity layers",bestFor:["Realistic instruments","Sample kits","One-shots"],icon:"FileAudio",color:"text-rose-400"},Player:{type:"Player",name:"Sample Player",shortName:"Player",description:"Simple one-shot sample playback",bestFor:["Loops","One-shots","Vocal samples"],icon:"Play",color:"text-lime-400"},GranularSynth:{type:"GranularSynth",name:"Granular Synth",shortName:"Granular",description:"Sample-based granular synthesis with grain manipulation",bestFor:["Textures","Pads","Ambient","Sound design","Glitch"],icon:"Sparkles",color:"text-violet-400"},SuperSaw:{type:"SuperSaw",name:"SuperSaw",shortName:"SSaw",description:"Massive detuned saw waves for trance and EDM",bestFor:["Trance leads","EDM drops","Big chords","Supersaw stabs"],icon:"Layers",color:"text-orange-500"},PolySynth:{type:"PolySynth",name:"Poly Synth",shortName:"Poly",description:"True polyphonic synth with voice management",bestFor:["Chords","Pads","Polyphonic parts","Layered sounds"],icon:"LayoutGrid",color:"text-blue-500"},Organ:{type:"Organ",name:"Drawbar Organ",shortName:"Organ",description:"Hammond-style tonewheel organ with drawbars",bestFor:["House","Gospel","Jazz","Rock organ"],icon:"Piano",color:"text-amber-600"},DrumMachine:{type:"DrumMachine",name:"Roland TR-808/909",shortName:"808/909",description:"Analog drum synthesis (808/909 style)",bestFor:["Kicks","Snares","Hi-hats","Electronic drums"],icon:"Disc",color:"text-red-500"},ChipSynth:{type:"ChipSynth",name:"Chip Synth",shortName:"Chip",description:"8-bit video game console sounds",bestFor:["Chiptune","Retro","Lo-fi","Arpeggios"],icon:"Gamepad2",color:"text-green-400"},PWMSynth:{type:"PWMSynth",name:"PWM Synth",shortName:"PWM",description:"Pulse width modulation for rich analog tones",bestFor:["Analog pads","Warm leads","Classic synth"],icon:"Waves",color:"text-emerald-400"},StringMachine:{type:"StringMachine",name:"String Machine",shortName:"Strings",description:"Vintage ensemble strings (Solina-style)",bestFor:["Lush pads","Disco strings","Ambient","Retro"],icon:"Music4",color:"text-rose-400"},FormantSynth:{type:"FormantSynth",name:"Formant Synth",shortName:"Vocal",description:"Vowel synthesis for vocal-like sounds",bestFor:["Vocal pads","Talk box","Choir","Robotic"],icon:"Mic",color:"text-fuchsia-400"},Furnace:{type:"Furnace",name:"Furnace FM",shortName:"FUI",description:"FM engine compatible with Furnace Tracker (.fui) instruments",bestFor:["Genesis bass","FM bells","Retro arcade","4-op FM"],icon:"Cpu",color:"text-amber-500"},FurnaceOPN:{type:"FurnaceOPN",name:"Sega Genesis (YM2612)",shortName:"Genesis",description:"Sega Genesis / Mega Drive YM2612 - 6 channels of 4-op FM",bestFor:["Genesis bass","FM leads","Slap bass","16-bit game music"],icon:"Gamepad2",color:"text-blue-500"},FurnaceOPM:{type:"FurnaceOPM",name:"Arcade / X68000 (YM2151)",shortName:"OPM",description:"Yamaha YM2151 - Sharp X68000, arcade machines",bestFor:["Arcade FM","Bright leads","Brass","Game music"],icon:"Cpu",color:"text-cyan-500"},FurnaceOPL:{type:"FurnaceOPL",name:"AdLib / Sound Blaster (OPL3)",shortName:"OPL3",description:"Yamaha YMF262 - AdLib, Sound Blaster, DOS games",bestFor:["DOS game music","MIDI synth","Organs","PC gaming"],icon:"Monitor",color:"text-yellow-500"},FurnaceOPLL:{type:"FurnaceOPLL",name:"MSX / Sega (OPLL)",shortName:"OPLL",description:"Yamaha YM2413 - MSX, SMS FM unit, budget FM",bestFor:["MSX music","SMS FM","Lo-fi FM","Simple FM"],icon:"Radio",color:"text-orange-400"},FurnaceESFM:{type:"FurnaceESFM",name:"ESFM",shortName:"ESFM",description:"Enhanced Sound FM - advanced OPL3 with operator detune",bestFor:["Modern retro","Enhanced FM","Detuned sounds"],icon:"Zap",color:"text-purple-500"},FurnaceOPZ:{type:"FurnaceOPZ",name:"Yamaha TX81Z (OPZ)",shortName:"OPZ",description:"Yamaha YM2414 - TX81Z, DX11, advanced FM",bestFor:["Lately bass","DX bells","Complex FM","E-piano"],icon:"Piano",color:"text-indigo-500"},FurnaceNES:{type:"FurnaceNES",name:"Nintendo NES (2A03)",shortName:"NES",description:"Nintendo Entertainment System - 2 pulse, triangle, noise, DPCM",bestFor:["NES chiptune","8-bit melodies","Retro drums","Famicom"],icon:"Gamepad2",color:"text-red-500"},FurnaceGB:{type:"FurnaceGB",name:"Nintendo Game Boy",shortName:"GB",description:"Nintendo Game Boy - 2 pulse, wave, noise channels",bestFor:["Game Boy music","Lo-fi chiptune","Portable gaming"],icon:"Smartphone",color:"text-green-500"},FurnaceC64:{type:"FurnaceC64",name:"Commodore 64 (SID)",shortName:"SID",description:"Commodore 64 SID chip - 3 voices with filters",bestFor:["SID leads","Arpeggios","Filter sweeps","Demoscene"],icon:"Terminal",color:"text-violet-500"},FurnaceAY:{type:"FurnaceAY",name:"ZX Spectrum / Amstrad (AY)",shortName:"AY",description:"General Instrument AY - ZX Spectrum, MSX, Atari ST",bestFor:["ZX Spectrum","MSX","Amstrad CPC","Envelope tricks"],icon:"Tv",color:"text-sky-500"},FurnaceTIA:{type:"FurnaceTIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 - primitive but distinctive sound",bestFor:["Atari 2600","Primitive bleeps","Retro FX"],icon:"Joystick",color:"text-amber-600"},FurnaceVERA:{type:"FurnaceVERA",name:"Commander X16 (VERA)",shortName:"VERA",description:"Commander X16 - modern retro 16 channels PSG + PCM",bestFor:["Modern retro","X16 music","Rich PSG"],icon:"Cpu",color:"text-teal-500"},FurnaceSAA:{type:"FurnaceSAA",name:"SAM Coup (SAA1099)",shortName:"SAA",description:"Philips SAA1099 - Sam Coup, some PC sound cards",bestFor:["Sam Coup","Stereo chips","European home computers"],icon:"Speaker",color:"text-pink-500"},FurnacePSG:{type:"FurnacePSG",name:"Sega Master System (PSG)",shortName:"PSG",description:"TI SN76489 - Master System, Game Gear, BBC Micro",bestFor:["Master System","Colecovision","Square wave PSG"],icon:"SquareStack",color:"text-emerald-500"},FurnaceVIC:{type:"FurnaceVIC",name:"Commodore VIC-20",shortName:"VIC",description:"Commodore VIC-20 - 3 square + noise",bestFor:["VIC-20 music","Early 80s","Simple tones"],icon:"Monitor",color:"text-lime-500"},FurnaceLynx:{type:"FurnaceLynx",name:"Atari Lynx",shortName:"Lynx",description:"Atari Lynx - 4 channel wavetable",bestFor:["Lynx music","Portable gaming","Wavetable"],icon:"Gamepad",color:"text-rose-500"},FurnaceSID6581:{type:"FurnaceSID6581",name:"SID 6581",shortName:"6581",description:"Classic C64 SID - warm, gritty original chip",bestFor:["Authentic C64","Warm bass","Classic demoscene"],icon:"Terminal",color:"text-violet-400"},FurnaceSID8580:{type:"FurnaceSID8580",name:"SID 8580",shortName:"8580",description:"Revised SID - cleaner filter, brighter sound",bestFor:["Clean SID","Later C64/C128","Clearer filters"],icon:"Terminal",color:"text-violet-600"},FurnaceOPNA:{type:"FurnaceOPNA",name:"NEC PC-98 (OPNA)",shortName:"OPNA",description:"YM2608 - NEC PC-98, arcade machines",bestFor:["PC-98 music","Touhou-style","Japanese arcade"],icon:"Cpu",color:"text-blue-400"},FurnaceOPNB:{type:"FurnaceOPNB",name:"SNK Neo Geo (OPNB)",shortName:"OPNB",description:"YM2610 - SNK Neo Geo",bestFor:["Neo Geo music","Fighting games","SNK"],icon:"Gamepad2",color:"text-red-400"},FurnaceOPL4:{type:"FurnaceOPL4",name:"Yamaha OPL4",shortName:"OPL4",description:"Yamaha YMF278 - FM + wavetable hybrid",bestFor:["Advanced OPL","FM + samples","Late DOS"],icon:"Layers",color:"text-yellow-400"},FurnaceY8950:{type:"FurnaceY8950",name:"MSX-Audio (Y8950)",shortName:"Y8950",description:"Yamaha Y8950 - MSX-Audio, OPL + ADPCM",bestFor:["MSX-Audio","OPL with drums","Japanese PC"],icon:"Radio",color:"text-orange-300"},FurnacePCE:{type:"FurnacePCE",name:"PC Engine / TurboGrafx",shortName:"PCE",description:"PC Engine / TurboGrafx-16 - 6 channel wavetable",bestFor:["PC Engine","TurboGrafx","HuCard games"],icon:"Tv",color:"text-orange-500"},FurnaceSNES:{type:"FurnaceSNES",name:"Super Nintendo (SPC700)",shortName:"SNES",description:"Super Nintendo - Sony SPC700 8-channel BRR",bestFor:["SNES music","16-bit classics","BRR samples"],icon:"Gamepad2",color:"text-purple-400"},FurnaceVB:{type:"FurnaceVB",name:"Nintendo Virtual Boy",shortName:"VB",description:"Nintendo Virtual Boy - 6 channel wavetable",bestFor:["Virtual Boy","Stereo 3D audio","Nintendo VB"],icon:"Glasses",color:"text-red-600"},FurnaceSWAN:{type:"FurnaceSWAN",name:"Bandai WonderSwan",shortName:"SWAN",description:"Bandai WonderSwan - 4 channel wavetable + PCM",bestFor:["WonderSwan","Portable gaming","Bandai"],icon:"Smartphone",color:"text-cyan-400"},FurnaceVRC6:{type:"FurnaceVRC6",name:"Famicom (VRC6)",shortName:"VRC6",description:"Konami VRC6 - 2 pulse + saw (Castlevania 3 JP)",bestFor:["Castlevania 3","Konami NES","Extra channels"],icon:"Zap",color:"text-amber-400"},FurnaceVRC7:{type:"FurnaceVRC7",name:"Famicom (VRC7)",shortName:"VRC7",description:"Konami VRC7 - OPLL clone (Lagrange Point)",bestFor:["Lagrange Point","FM on NES","Konami FM"],icon:"Radio",color:"text-amber-500"},FurnaceN163:{type:"FurnaceN163",name:"Namco Arcade (N163)",shortName:"N163",description:"Namco 163 - 8 channel wavetable",bestFor:["Namco NES","Wavetable","Complex tones"],icon:"Waves",color:"text-green-400"},FurnaceFDS:{type:"FurnaceFDS",name:"Famicom Disk System",shortName:"FDS",description:"Famicom Disk System - wavetable + modulation",bestFor:["FDS games","Wavy bass","Zelda FDS"],icon:"Disc",color:"text-yellow-500"},FurnaceMMC5:{type:"FurnaceMMC5",name:"Famicom (MMC5)",shortName:"MMC5",description:"MMC5 - 2 extra pulse channels",bestFor:["Castlevania 3 US","Extra NES pulse","CV3"],icon:"Plus",color:"text-blue-300"},FurnaceTED:{type:"FurnaceTED",name:"Commodore Plus/4 (TED)",shortName:"TED",description:"Commodore Plus/4 TED - 2 square + noise",bestFor:["Plus/4 music","Commodore 16","Budget C64"],icon:"Monitor",color:"text-violet-400"},FurnaceSEGAPCM:{type:"FurnaceSEGAPCM",name:"Sega Arcade (SegaPCM)",shortName:"SEGAPCM",description:"Sega System 16/18 - 16 channel PCM",bestFor:["OutRun","After Burner","Sega arcade"],icon:"Speaker",color:"text-blue-500"},FurnaceQSOUND:{type:"FurnaceQSOUND",name:"Capcom Arcade (QSound)",shortName:"QSound",description:"Capcom QSound - CPS1/CPS2 with 3D audio",bestFor:["Street Fighter","CPS games","3D positioning"],icon:"Headphones",color:"text-purple-500"},FurnaceES5506:{type:"FurnaceES5506",name:"ES5506",shortName:"ES5506",description:"Ensoniq ES5506 - 32 voice wavetable",bestFor:["Taito F3","Ensoniq synths","High quality"],icon:"AudioLines",color:"text-pink-400"},FurnaceRF5C68:{type:"FurnaceRF5C68",name:"RF5C68",shortName:"RF5C68",description:"Ricoh RF5C68 - Sega CD, 8 channel PCM",bestFor:["Sega CD","Mega CD","CD audio"],icon:"Disc",color:"text-cyan-500"},FurnaceC140:{type:"FurnaceC140",name:"C140",shortName:"C140",description:"Namco C140 - System 2, 24 channel PCM",bestFor:["Namco arcade","System 2","Assault"],icon:"Cpu",color:"text-yellow-400"},FurnaceK007232:{type:"FurnaceK007232",name:"K007232",shortName:"K007232",description:"Konami K007232 - 2 channel PCM",bestFor:["Contra arcade","Konami PCM","TMNT"],icon:"Speaker",color:"text-red-400"},FurnaceK053260:{type:"FurnaceK053260",name:"K053260",shortName:"K053260",description:"Konami K053260 - 4 channel PCM with ADPCM",bestFor:["Sunset Riders","Simpsons","Konami 90s"],icon:"Speaker",color:"text-orange-400"},FurnaceGA20:{type:"FurnaceGA20",name:"GA20",shortName:"GA20",description:"Irem GA20 - 4 channel PCM",bestFor:["R-Type Leo","Irem arcade","In the Hunt"],icon:"Cpu",color:"text-teal-400"},FurnaceOKI:{type:"FurnaceOKI",name:"OKI MSM6295",shortName:"OKI",description:"OKI MSM6295 - 4 channel ADPCM",bestFor:["Neo Geo","Data East","ADPCM drums"],icon:"Volume2",color:"text-gray-400"},FurnaceYMZ280B:{type:"FurnaceYMZ280B",name:"YMZ280B",shortName:"YMZ280B",description:"Yamaha YMZ280B - 8 channel ADPCM",bestFor:["Cave shmups","Late arcade","High quality"],icon:"AudioLines",color:"text-indigo-400"},FurnaceSCC:{type:"FurnaceSCC",name:"Konami SCC",shortName:"SCC",description:"Konami SCC - 5 channel wavetable (MSX)",bestFor:["Gradius","Snatcher","MSX Konami"],icon:"Waves",color:"text-green-500"},FurnaceX1_010:{type:"FurnaceX1_010",name:"X1-010",shortName:"X1-010",description:"Seta X1-010 - 16 channel wavetable",bestFor:["Seta arcade","Wavetable","Twin Eagle"],icon:"Waves",color:"text-lime-400"},FurnaceBUBBLE:{type:"FurnaceBUBBLE",name:"Bubble System",shortName:"BUBBLE",description:"Konami Bubble System - wavetable",bestFor:["Konami arcade","Bubble System","Wavetable"],icon:"Circle",color:"text-sky-400"},FurnaceSM8521:{type:"FurnaceSM8521",name:"SM8521",shortName:"SM8521",description:"Sharp SM8521 - Game.com",bestFor:["Game.com","Tiger electronics","Obscure"],icon:"Smartphone",color:"text-gray-500"},FurnaceT6W28:{type:"FurnaceT6W28",name:"T6W28",shortName:"T6W28",description:"NEC T6W28 - PC-6001, stereo PSG",bestFor:["NEC PC-6001","Japanese PC","Stereo PSG"],icon:"Monitor",color:"text-blue-300"},FurnaceSUPERVISION:{type:"FurnaceSUPERVISION",name:"Supervision",shortName:"SV",description:"Watara Supervision - 4 channel + noise/DMA",bestFor:["Supervision","Portable gaming","Watara"],icon:"Gamepad",color:"text-emerald-400"},FurnaceUPD1771:{type:"FurnaceUPD1771",name:"PD1771",shortName:"UPD1771",description:"NEC PD1771 - Epoch Super Cassette Vision",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-400"},FurnaceOPN2203:{type:"FurnaceOPN2203",name:"YM2203 / OPN",shortName:"OPN",description:"YM2203 - PC-88/98, simpler 3-channel FM + SSG",bestFor:["PC-88 music","Japanese PC games","Simpler FM"],icon:"Cpu",color:"text-blue-300"},FurnaceOPNBB:{type:"FurnaceOPNBB",name:"YM2610B",shortName:"OPNB-B",description:"YM2610B - Extended Neo Geo with more FM channels",bestFor:["Neo Geo CD","Extended OPNB","SNK"],icon:"Gamepad2",color:"text-red-300"},FurnaceAY8930:{type:"FurnaceAY8930",name:"AY-8930",shortName:"AY+",description:"Enhanced AY-3-8910 with expanded features",bestFor:["Enhanced chiptune","Extended AY","Microchip"],icon:"Tv",color:"text-sky-400"},FurnaceNDS:{type:"FurnaceNDS",name:"Nintendo DS",shortName:"NDS",description:"Nintendo DS - 16 channel PCM/PSG",bestFor:["NDS music","Portable gaming","Modern chiptune"],icon:"Smartphone",color:"text-slate-400"},FurnaceGBA:{type:"FurnaceGBA",name:"Game Boy Advance",shortName:"GBA",description:"GBA DMA Sound - 2 channel direct PCM",bestFor:["GBA music","Portable gaming","PCM"],icon:"Gamepad",color:"text-purple-300"},FurnacePOKEMINI:{type:"FurnacePOKEMINI",name:"Pokemon Mini",shortName:"PKMN",description:"Pokemon Mini - tiny handheld sound",bestFor:["Pokemon Mini","Tiny tunes","Lo-fi"],icon:"Star",color:"text-yellow-300"},FurnaceNAMCO:{type:"FurnaceNAMCO",name:"Namco WSG",shortName:"WSG",description:"Namco WSG - Pac-Man, Galaga wavetable",bestFor:["Pac-Man","Galaga","Classic arcade"],icon:"Circle",color:"text-yellow-400"},FurnacePET:{type:"FurnacePET",name:"Commodore PET",shortName:"PET",description:"Commodore PET - single voice shift register",bestFor:["PET music","Early 80s","Primitive"],icon:"Monitor",color:"text-green-300"},FurnacePOKEY:{type:"FurnacePOKEY",name:"Atari POKEY",shortName:"POKEY",description:"Atari POKEY - Atari 800/5200/arcade",bestFor:["Atari 8-bit","Atari arcade","Classic chiptune"],icon:"Joystick",color:"text-orange-400"},FurnaceMSM6258:{type:"FurnaceMSM6258",name:"MSM6258",shortName:"MSM6258",description:"OKI MSM6258 - 4-bit ADPCM voice",bestFor:["Voice samples","ADPCM","Japanese arcade"],icon:"Mic",color:"text-pink-300"},FurnaceMSM5232:{type:"FurnaceMSM5232",name:"MSM5232",shortName:"MSM5232",description:"OKI MSM5232 - 8-voice PSG synthesizer",bestFor:["Early arcade","Organ sounds","8-voice"],icon:"Music2",color:"text-amber-300"},FurnaceMULTIPCM:{type:"FurnaceMULTIPCM",name:"Sega MultiPCM",shortName:"MPCM",description:"Sega MultiPCM - System 32, Model 1/2",bestFor:["Virtua Racing","Sega arcade","High quality PCM"],icon:"Headphones",color:"text-blue-400"},FurnaceAMIGA:{type:"FurnaceAMIGA",name:"Amiga Paula",shortName:"PAULA",description:"Amiga Paula - 4 channel 8-bit PCM",bestFor:["Amiga MODs","Demoscene","Classic samples"],icon:"Disc",color:"text-slate-300"},FurnacePCSPKR:{type:"FurnacePCSPKR",name:"PC Speaker",shortName:"PCSPK",description:"PC Speaker - internal IBM PC beeper",bestFor:["DOS games","Beeper music","Lo-fi PC"],icon:"Volume2",color:"text-gray-400"},FurnacePONG:{type:"FurnacePONG",name:"AY-3-8500",shortName:"PONG",description:"AY-3-8500 - original Pong chip sound",bestFor:["Pong","Retro bleeps","Primitive"],icon:"Circle",color:"text-white"},FurnacePV1000:{type:"FurnacePV1000",name:"Casio PV-1000",shortName:"PV1K",description:"Casio PV-1000 - 3 channel PSG",bestFor:["PV-1000","Obscure","Japanese"],icon:"Tv",color:"text-green-400"},FurnaceDAVE:{type:"FurnaceDAVE",name:"Enterprise DAVE",shortName:"DAVE",description:"Enterprise DAVE - 3 channel + noise",bestFor:["Enterprise 64/128","Hungarian","European"],icon:"Monitor",color:"text-red-300"},FurnaceSU:{type:"FurnaceSU",name:"Sound Unit",shortName:"SU",description:"Commander X16 Sound Unit",bestFor:["X16 music","Modern retro","Sound Unit"],icon:"Speaker",color:"text-teal-300"},FurnacePOWERNOISE:{type:"FurnacePOWERNOISE",name:"Power Noise",shortName:"PNOISE",description:"Power Noise - noise generator chip",bestFor:["Noise music","Experimental","Harsh sounds"],icon:"Zap",color:"text-violet-400"},FurnaceZXBEEPER:{type:"FurnaceZXBEEPER",name:"ZX Beeper",shortName:"BEEP",description:"ZX Spectrum beeper - 1-bit audio",bestFor:["ZX Spectrum","Beeper music","1-bit audio"],icon:"Speaker",color:"text-cyan-300"},FurnaceSCVTONE:{type:"FurnaceSCVTONE",name:"SCV Tone",shortName:"SCV",description:"Epoch SCV tone generator",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-300"},FurnacePCMDAC:{type:"FurnacePCMDAC",name:"PCM DAC",shortName:"DAC",description:"Generic PCM DAC output",bestFor:["PCM output","Generic DAC","Simple samples"],icon:"AudioLines",color:"text-gray-300"},ChiptuneModule:{type:"ChiptuneModule",name:"Chiptune Module",shortName:"MOD",description:"Libopenmpt-powered playback for MOD/XM/IT/S3M files",bestFor:["Tracker modules","Retro game music","Sample-accurate playback"],icon:"Gamepad2",color:"text-lime-400"},WobbleBass:{type:"WobbleBass",name:"Wobble Bass",shortName:"Wobble",description:"Dubstep/DnB bass with tempo-synced LFO, Reese detuning, FM growl",bestFor:["Dubstep","DnB","Jungle","Neurofunk","Riddim"],icon:"Waves",color:"text-fuchsia-500"},DrumKit:{type:"DrumKit",name:"Drum Kit",shortName:"Kit",description:"Multi-sample instrument with keymap - assign different samples to different notes",bestFor:["Drum kits","Instrument layers","Velocity splits","Sample mapping"],icon:"Piano",color:"text-amber-500"},Buzzmachine:{type:"Buzzmachine",name:"Buzzmachine",shortName:"Buzz",description:"Jeskola Buzz machines - classic tracker effects and generators from the Buzz ecosystem",bestFor:["Effects","Generators","Classic tracker sounds","Buzz compatibility"],icon:"Cpu",color:"text-yellow-500"},BuzzDTMF:{type:"BuzzDTMF",name:"CyanPhase DTMF",shortName:"DTMF",description:"Phone dial tone generator - classic DTMF tones",bestFor:["Phone tones","Retro effects","Experimental"],icon:"Phone",color:"text-cyan-400"},BuzzFreqBomb:{type:"BuzzFreqBomb",name:"Frequency Bomb",shortName:"FreqBomb",description:"Elenzil Frequency Bomb - chaotic frequency modulation",bestFor:["Noise","Chaos","Experimental"],icon:"Bomb",color:"text-red-500"},BuzzKick:{type:"BuzzKick",name:"FSM Kick",shortName:"Kick",description:"FSM Kick drum synthesizer",bestFor:["Kick drums","Bass drums","Percussion"],icon:"Drum",color:"text-orange-500"},BuzzKickXP:{type:"BuzzKickXP",name:"FSM KickXP",shortName:"KickXP",description:"Extended FSM Kick with more parameters",bestFor:["Kick drums","Deep bass","EDM kicks"],icon:"Drum",color:"text-orange-600"},BuzzNoise:{type:"BuzzNoise",name:"Jeskola Noise",shortName:"Noise",description:"Jeskola Noise generator",bestFor:["Noise","Hi-hats","Textures"],icon:"Waves",color:"text-gray-400"},BuzzTrilok:{type:"BuzzTrilok",name:"Jeskola Trilok",shortName:"Trilok",description:"Jeskola Trilok bass drum synthesizer",bestFor:["Bass drums","Toms","Percussion"],icon:"Drum",color:"text-amber-500"},Buzz4FM2F:{type:"Buzz4FM2F",name:"MadBrain 4FM2F",shortName:"4FM2F",description:"4-operator FM synthesizer with 2 filters",bestFor:["FM sounds","Complex timbres","DX-style"],icon:"Radio",color:"text-purple-500"},BuzzDynamite6:{type:"BuzzDynamite6",name:"MadBrain Dynamite6",shortName:"Dyn6",description:"6-voice additive synthesizer",bestFor:["Additive synthesis","Organs","Complex sounds"],icon:"Zap",color:"text-yellow-500"},BuzzM3:{type:"BuzzM3",name:"Makk M3",shortName:"M3",description:"Dual-oscillator mono synth",bestFor:["Bass","Leads","Classic synth"],icon:"AudioLines",color:"text-green-500"},Buzz3o3:{type:"Buzz3o3",name:"Oomek Aggressor 3o3",shortName:"3o3",description:"TB-303 style acid synth clone",bestFor:["Acid bass","Squelchy lines","Techno"],icon:"Zap",color:"text-lime-500"},MAMEVFX:{type:"MAMEVFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq ES5506 (OTTO) 32-voice wavetable synthesis",bestFor:["Evolving pads","90s digital","Cinematic","Layers"],icon:"AudioLines",color:"text-pink-400"},MAMEDOC:{type:"MAMEDOC",name:"Ensoniq ESQ-1",shortName:"DOC",description:"Ensoniq ES5503 (DOC) 8-bit wavetable synthesis",bestFor:["Lo-fi digital","ESQ-1 pads","Gritty bass","80s digital"],icon:"Waves",color:"text-amber-400"},MAMERSA:{type:"MAMERSA",name:"Roland SA",shortName:"MKS20",description:"Roland Structured Adaptive Synthesis (MKS-20/RD-1000)",bestFor:["Electric piano","Authentic piano","80s keys"],icon:"Piano",color:"text-sky-400"},MAMESWP30:{type:"MAMESWP30",name:"Yamaha SWP30",shortName:"AWM2",description:"Yamaha SWP30 (AWM2) 64-voice ROMpler/DSP engine",bestFor:["Realistic instruments","90s ROMpler","Advanced effects","AWM2 sounds"],icon:"Cpu",color:"text-emerald-400"},CZ101:{type:"CZ101",name:"Casio CZ-101",shortName:"CZ",description:"Casio Phase Distortion synthesis - 8 voices, dual oscillator with DCO/DCW/DCA envelopes",bestFor:["Digital bass","Metallic leads","Synth brass","80s digital","Phase distortion"],icon:"Activity",color:"text-violet-400"},CEM3394:{type:"CEM3394",name:"CEM3394 (Curtis)",shortName:"CEM",description:"Curtis Electromusic analog synth voice - used in Prophet VS, Matrix-6, ESQ-1, Six-Trak",bestFor:["Analog bass","Warm pads","Classic leads","80s analog","Prophet sounds"],icon:"Waves",color:"text-emerald-400"},SCSP:{type:"SCSP",name:"Sega Saturn SCSP",shortName:"SCSP",description:"Yamaha YMF292-F 32-voice sound processor - Sega Saturn, Model 2/3 arcade",bestFor:["Arcade sounds","90s gaming","Saturn pads","Virtua sounds","Sega classics"],icon:"Gamepad2",color:"text-blue-500"},DubSiren:{type:"DubSiren",name:"Dub Siren",shortName:"Siren",description:"Classic dub sound system siren with LFO and delay",bestFor:["Dub FX","Reggae","Sound system","Alerts"],icon:"Megaphone",color:"text-red-500"},SpaceLaser:{type:"SpaceLaser",name:"Space Laser",shortName:"Laser",description:"FM-based cosmic zap generator for classic reggae and anime effects",bestFor:["Laser shots","Anime FX","Reggae dubs","Sci-fi"],icon:"Zap",color:"text-green-500"},V2:{type:"V2",name:"Farbrausch V2 Synth",shortName:"V2",description:"Authentic 4k/64k demoscene synthesis with multi-voice subtractive engine.",bestFor:["Demoscene","Trance","Techno","Leads"],icon:"Radio",color:"amber"},V2Speech:{type:"V2Speech",name:"V2 Speech",shortName:"V2Sp",description:"Farbrausch V2 speech synthesis module for robotic and vocoder-style voices.",bestFor:["Speech","Robotic Voices","Demoscene","FX"],icon:"Radio",color:"amber"},Sam:{type:"Sam",name:"Commodore SAM",shortName:"SAM",description:"Software Automatic Mouth - classic 8-bit speech synthesizer from 1982.",bestFor:["Speech","Robotic Voices","Lo-Fi","FX"],icon:"MessageSquare",color:"amber"},Synare:{type:"Synare",name:"Synare 3",shortName:"Synare",description:'Classic electronic percussion synthesizer for "disco tom" and dub sounds',bestFor:["Dub percussion","Disco toms","Electronic drums","SFX"],icon:"Drum",color:"text-yellow-500"},WAM:{type:"WAM",name:"Web Audio Module",shortName:"WAM",description:"Load external audio plugins from URL (standard WAM 2.0 format)",bestFor:["External plugins","Community synths","Rich UI"],icon:"Globe",color:"text-cyan-400"},Dexed:{type:"Dexed",name:"Dexed (DX7)",shortName:"DX7",description:"Yamaha DX7 FM synthesizer emulation - 6-operator FM with 32 algorithms",bestFor:["FM Bass","Electric Piano","Bells","Pads","Classic FM sounds"],icon:"Piano",color:"text-blue-400"},OBXd:{type:"OBXd",name:"OBXd (Oberheim)",shortName:"OBXd",description:"Oberheim OB-X analog polysynth emulation - classic warm analog sounds",bestFor:["Pads","Brass","Strings","Warm leads","Analog sounds"],icon:"Waves",color:"text-amber-400"},DexedBridge:{type:"DexedBridge",name:"Dexed DX7 (Bridge)",shortName:"DX7B",description:"Dexed DX7 via VSTBridge generic framework - test/validation of the bridge",bestFor:["FM Bass","Electric Piano","Bells","Bridge testing"],icon:"Plug",color:"text-purple-400"},Vital:{type:"Vital",name:"Vital (Wavetable)",shortName:"Vital",description:"Spectral warping wavetable synthesizer - 3 oscillators with spectral morphing, 13 morph types, phase distortion",bestFor:["Wavetable","Spectral","Modern bass","Pads","Leads","Sound design"],icon:"Waves",color:"text-violet-400"},Odin2:{type:"Odin2",name:"Odin2 (Hybrid)",shortName:"Odin2",description:"Semi-modular hybrid synth - 11 oscillator types (analog, wavetable, FM, vector, chiptune), 9 filter types, modulation matrix",bestFor:["Hybrid synthesis","Analog","Wavetable","FM","Vector","Chiptune"],icon:"Zap",color:"text-emerald-400"},Surge:{type:"Surge",name:"Surge XT (Hybrid)",shortName:"Surge",description:"Professional hybrid synth - dual scenes, 12 oscillator types, 32 effect types, 765 parameters, open source since 2018",bestFor:["Professional","Hybrid","Sound design","Bass","Pads","Leads","FX"],icon:"Activity",color:"text-cyan-400"},TonewheelOrgan:{type:"TonewheelOrgan",name:"Tonewheel Organ",shortName:"Organ",description:"Hammond-style tonewheel organ - 9 drawbars, key click, percussion, vibrato/chorus scanner, overdrive",bestFor:["Reggae organ","Gospel","Jazz","Blues","Rock organ","Ska"],icon:"Music",color:"text-amber-400"},Melodica:{type:"Melodica",name:"Melodica",shortName:"Melod",description:"Monophonic reed instrument physical model - breath dynamics, body resonance, vibrato, portamento",bestFor:["Reggae melodica","Dub","Ska","Augustus Pablo","Lead melodies"],icon:"Wind",color:"text-teal-400"},Monique:{type:"Monique",name:"Monique (Monosynth)",shortName:"Moniq",description:"Morphing monosynth - 3 oscillators, 3 cross-routed filters, 4 tempo-synced MFOs, distortion, delay, arpeggiator",bestFor:["Wobble bass","Dubstep","DnB bass","Acid","Mono leads","Bass"],icon:"AudioLines",color:"text-rose-400"},Buzz3o3DF:{type:"Buzz3o3DF",name:"Aggressor Devil Fish",shortName:"3o3DF",description:"Enhanced TB-303 clone with Devil Fish mods - accent decay, VEG, filter tracking, muffler",bestFor:["Acid bass","Deep acid","Experimental","Devil Fish tones"],icon:"Zap",color:"text-lime-400"},BuzzM4:{type:"BuzzM4",name:"Makk M4",shortName:"M4",description:"Wavetable synth with 100+ waveforms, dual oscillators, sub osc, and dual LFOs",bestFor:["Wavetable","Leads","Pads","Bass"],icon:"Layers",color:"text-sky-400"},MAMEAICA:{type:"MAMEAICA",name:"Sega AICA",shortName:"AICA",description:"Sega Dreamcast/Naomi AICA - 64-voice ADPCM+FM sound processor",bestFor:["Dreamcast sounds","Arcade PCM","90s gaming","ADPCM samples"],icon:"Gamepad2",color:"text-blue-400"},MAMEASC:{type:"MAMEASC",name:"Apple Sound Chip",shortName:"ASC",description:"Apple ASC - 4-voice wavetable synthesis from Apple IIGS and Mac",bestFor:["Retro Mac","Wavetable","IIGS sounds","80s digital"],icon:"Cpu",color:"text-gray-400"},MAMEAstrocade:{type:"MAMEAstrocade",name:"Bally Astrocade",shortName:"Astro",description:"Bally Astrocade custom sound - 3 voices + noise, vibrato modulation",bestFor:["Retro arcade","Lo-fi","Noise FX","Vintage gaming"],icon:"Gamepad2",color:"text-purple-400"},MAMEC352:{type:"MAMEC352",name:"Namco C352",shortName:"C352",description:"Namco System 22/23 - 32-voice PCM with built-in effects (needs ROM)",bestFor:["Namco arcade","Ridge Racer","Tekken sounds","Arcade PCM"],icon:"Gamepad2",color:"text-red-400"},MAMEES5503:{type:"MAMEES5503",name:"Ensoniq ES5503",shortName:"ES5503",description:"Ensoniq DOC - 32-oscillator wavetable chip (Apple IIGS, ESQ-1, Mirage)",bestFor:["Wavetable","Lo-fi digital","80s synth","IIGS music"],icon:"Waves",color:"text-amber-400"},MAMEICS2115:{type:"MAMEICS2115",name:"ICS WaveFront",shortName:"ICS",description:"ICS 2115 WaveFront - 32-voice wavetable with interpolation (needs ROM)",bestFor:["Wavetable","90s soundcard","GUS compatible","Tracker music"],icon:"Cpu",color:"text-teal-400"},MAMEK054539:{type:"MAMEK054539",name:"Konami K054539",shortName:"K054",description:"Konami 054539 - 8-channel PCM for Konami arcade (needs ROM)",bestFor:["Konami arcade","TMNT","Gradius","Arcade samples"],icon:"Gamepad2",color:"text-yellow-400"},MAMEMEA8000:{type:"MAMEMEA8000",name:"Philips MEA8000",shortName:"MEA",description:"Philips MEA8000 - LPC speech synthesis with formant modeling",bestFor:["Speech","Robotic voice","Retro talking","Voice FX"],icon:"Mic",color:"text-green-400"},MAMEMSM5232:{type:"MAMEMSM5232",name:"OKI MSM5232",shortName:"MSM",description:"OKI MSM5232 - 8-voice PSG organ/synth chip (MAME native emulation)",bestFor:["Organ","Arcade melody","Retro synth","Simple tones"],icon:"Cpu",color:"text-orange-400"},MAMERF5C400:{type:"MAMERF5C400",name:"Ricoh RF5C400",shortName:"RF5C",description:"Ricoh RF5C400 - 32-voice PCM with digital filtering (needs ROM)",bestFor:["Seta arcade","PCM playback","Arcade samples"],icon:"Cpu",color:"text-indigo-400"},MAMESN76477:{type:"MAMESN76477",name:"TI SN76477",shortName:"SN77",description:"TI SN76477 Complex Sound Generator - VCO, noise, envelope, mixer",bestFor:["Sci-fi FX","Laser sounds","Space Invaders","Retro arcade FX"],icon:"Zap",color:"text-green-500"},MAMESNKWave:{type:"MAMESNKWave",name:"SNK Wave",shortName:"SNK",description:"SNK custom wavetable sound generator - Neo Geo era",bestFor:["Retro arcade","Wavetable","SNK sounds","Lo-fi"],icon:"Gamepad2",color:"text-red-500"},MAMESP0250:{type:"MAMESP0250",name:"GI SP0250",shortName:"SP02",description:"General Instrument SP0250 - LPC speech synthesis for arcade machines",bestFor:["Arcade speech","Robotic voice","Q*bert sounds","Retro talking"],icon:"Mic",color:"text-yellow-500"},MAMETIA:{type:"MAMETIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 TIA - MAME-accurate 2-voice with 16 distortion modes",bestFor:["Atari sounds","2600 bleeps","Lo-fi","Retro FX"],icon:"Gamepad2",color:"text-amber-500"},MAMETMS36XX:{type:"MAMETMS36XX",name:"TMS36XX Organ",shortName:"TMS3",description:"TI TMS3615/3617 - electronic organ chip with 13 chromatic notes",bestFor:["Electronic organ","Retro tones","Circus music","Simple melody"],icon:"Music2",color:"text-rose-400"},MAMETMS5220:{type:"MAMETMS5220",name:"Speak & Spell",shortName:"TMS5",description:"TI TMS5220 LPC speech - the Speak & Spell chip, phoneme-based voice",bestFor:["Speech","Speak & Spell","Robotic voice","LPC vocoder"],icon:"Mic",color:"text-orange-500"},MAMETR707:{type:"MAMETR707",name:"Roland TR-707",shortName:"707",description:"Roland TR-707 PCM drum machine - 10 voices with analog filtering (needs ROM)",bestFor:["House drums","Electro beats","80s rhythm","Classic drum machine"],icon:"Disc",color:"text-red-400"},MAMEUPD931:{type:"MAMEUPD931",name:"NEC uPD931",shortName:"931",description:"NEC uPD931 - speech synthesis processor with LPC coding",bestFor:["Japanese speech","Arcade voice","Retro talking","Speech FX"],icon:"Mic",color:"text-cyan-400"},MAMEUPD933:{type:"MAMEUPD933",name:"NEC uPD933",shortName:"933",description:"NEC uPD933 raw phase distortion chip - the core of the Casio CZ series",bestFor:["Phase distortion","CZ sounds","Digital bass","Metallic leads"],icon:"Activity",color:"text-violet-400"},MAMEVotrax:{type:"MAMEVotrax",name:"Votrax SC-01",shortName:"Vtrx",description:"Votrax SC-01 - classic 1980s phoneme speech synthesizer chip",bestFor:["Robotic speech","Arcade talking","Q*bert","Retro voice"],icon:"Mic",color:"text-emerald-400"},MAMEYMF271:{type:"MAMEYMF271",name:"Yamaha OPX",shortName:"OPX",description:"Yamaha YMF271 OPX - 12-voice FM+PCM synthesis for arcade hardware",bestFor:["Arcade FM","FM+PCM","Jaleco sounds","Complex FM"],icon:"Radio",color:"text-blue-500"},MAMEYMOPQ:{type:"MAMEYMOPQ",name:"Yamaha OPQ",shortName:"OPQ",description:"Yamaha YM3806 OPQ - 4-op FM synthesis for Yamaha keyboards",bestFor:["FM synthesis","Yamaha sounds","Vintage FM","Keyboard sounds"],icon:"Radio",color:"text-indigo-500"},MAMEVASynth:{type:"MAMEVASynth",name:"Virtual Analog",shortName:"VA",description:"Virtual Analog modeling synthesizer - subtractive with multi-waveform oscillators",bestFor:["Analog modeling","Bass","Leads","Pads","Classic analog"],icon:"Waves",color:"text-pink-500"}},XN=[{id:"bass",name:"Bass",description:"Deep and punchy bass synths",synths:[YN.TB303,YN.MonoSynth,YN.WobbleBass]},{id:"lead",name:"Lead",description:"Melodic lead synthesizers",synths:[YN.Synth,YN.DuoSynth,YN.FMSynth,YN.AMSynth,YN.PluckSynth,YN.SuperSaw,YN.ChipSynth,YN.PWMSynth,YN.FormantSynth,YN.V2]},{id:"drums",name:"Drums",description:"Percussion and drum synthesis",synths:[YN.MembraneSynth,YN.MetalSynth,YN.NoiseSynth,YN.DrumMachine,YN.DrumKit,YN.Synare,YN.MAMETR707]},{id:"pads",name:"Pads",description:"Evolving textures and pads",synths:[YN.Wavetable,YN.GranularSynth,YN.PolySynth,YN.StringMachine,YN.V2]},{id:"dub",name:"Dub & FX",description:"Classic sound system and special effects",synths:[YN.DubSiren,YN.SpaceLaser,YN.V2,YN.Synare]},{id:"vintage",name:"Keys",description:"Keyboard instruments",synths:[YN.Organ]},{id:"samples",name:"Samples",description:"Sample-based instruments",synths:[YN.Sampler,YN.Player]},{id:"plugins",name:"Plugins",description:"External Web Audio Modules (WAM 2.0)",synths:[YN.WAM]},{id:"fx",name:"FX",description:"Sound effects and noise generators",synths:[YN.DubSiren]},{id:"furnace",name:" Furnace Chips",description:"All Furnace chip emulations - 70+ authentic retro sound chips",synths:[YN.FurnaceOPN,YN.FurnaceOPN2203,YN.FurnaceOPNA,YN.FurnaceOPNB,YN.FurnaceOPNBB,YN.FurnaceOPM,YN.FurnaceOPL,YN.FurnaceOPLL,YN.FurnaceOPL4,YN.FurnaceOPZ,YN.FurnaceY8950,YN.FurnaceESFM,YN.FurnaceVRC7,YN.FurnaceNES,YN.FurnaceGB,YN.FurnaceSNES,YN.FurnacePCE,YN.FurnacePSG,YN.FurnaceVB,YN.FurnaceLynx,YN.FurnaceSWAN,YN.FurnaceNDS,YN.FurnaceGBA,YN.FurnacePOKEMINI,YN.FurnaceVRC6,YN.FurnaceN163,YN.FurnaceFDS,YN.FurnaceMMC5,YN.FurnaceC64,YN.FurnaceSID6581,YN.FurnaceSID8580,YN.FurnaceAY,YN.FurnaceAY8930,YN.FurnaceVIC,YN.FurnacePET,YN.FurnaceSAA,YN.FurnaceTED,YN.FurnaceDAVE,YN.FurnaceVERA,YN.FurnaceSCC,YN.FurnaceTIA,YN.FurnacePOKEY,YN.FurnaceZXBEEPER,YN.FurnaceAMIGA,YN.FurnacePCSPKR,YN.FurnaceSEGAPCM,YN.FurnaceQSOUND,YN.FurnaceES5506,YN.FurnaceRF5C68,YN.FurnaceC140,YN.FurnaceK007232,YN.FurnaceK053260,YN.FurnaceGA20,YN.FurnaceOKI,YN.FurnaceYMZ280B,YN.FurnaceX1_010,YN.FurnaceBUBBLE,YN.FurnaceMULTIPCM,YN.FurnaceMSM6258,YN.FurnaceMSM5232,YN.FurnaceNAMCO,YN.FurnaceSM8521,YN.FurnaceT6W28,YN.FurnaceSUPERVISION,YN.FurnaceUPD1771,YN.FurnacePONG,YN.FurnacePV1000,YN.FurnaceSU,YN.FurnacePOWERNOISE,YN.FurnaceSCVTONE,YN.FurnacePCMDAC,YN.Furnace]},{id:"chiptune-fm",name:"FM Chips",description:"Yamaha FM synthesis chips (OPN, OPL, OPM families)",synths:[YN.FurnaceOPN,YN.FurnaceOPN2203,YN.FurnaceOPNA,YN.FurnaceOPNB,YN.FurnaceOPNBB,YN.FurnaceOPM,YN.FurnaceOPL,YN.FurnaceOPLL,YN.FurnaceOPL4,YN.FurnaceOPZ,YN.FurnaceY8950,YN.FurnaceESFM,YN.FurnaceVRC7]},{id:"chiptune-console",name:"Console Chips",description:"Game console sound chips (Nintendo, Sega, etc.)",synths:[YN.FurnaceNES,YN.FurnaceGB,YN.FurnaceSNES,YN.FurnacePCE,YN.FurnacePSG,YN.FurnaceVB,YN.FurnaceLynx,YN.FurnaceSWAN,YN.FurnaceNDS,YN.FurnaceGBA,YN.FurnacePOKEMINI,YN.FurnaceVRC6,YN.FurnaceN163,YN.FurnaceFDS,YN.FurnaceMMC5]},{id:"chiptune-computer",name:"Computer Chips",description:"Home computer sound chips (C64, Spectrum, etc.)",synths:[YN.FurnaceC64,YN.FurnaceSID6581,YN.FurnaceSID8580,YN.FurnaceAY,YN.FurnaceAY8930,YN.FurnaceVIC,YN.FurnacePET,YN.FurnaceSAA,YN.FurnaceTED,YN.FurnaceDAVE,YN.FurnaceVERA,YN.FurnaceSCC,YN.FurnaceTIA,YN.FurnacePOKEY,YN.FurnaceZXBEEPER,YN.FurnaceAMIGA,YN.FurnacePCSPKR]},{id:"chiptune-arcade",name:"Arcade PCM",description:"Arcade game PCM/ADPCM chips (Sega, Namco, Konami, Capcom)",synths:[YN.FurnaceSEGAPCM,YN.FurnaceQSOUND,YN.FurnaceES5506,YN.FurnaceRF5C68,YN.FurnaceC140,YN.FurnaceK007232,YN.FurnaceK053260,YN.FurnaceGA20,YN.FurnaceOKI,YN.FurnaceYMZ280B,YN.FurnaceX1_010,YN.FurnaceBUBBLE,YN.FurnaceMULTIPCM,YN.FurnaceMSM6258,YN.FurnaceMSM5232,YN.FurnaceNAMCO]},{id:"chiptune-other",name:"Other Chips",description:"Obscure and miscellaneous sound chips",synths:[YN.FurnaceSM8521,YN.FurnaceT6W28,YN.FurnaceSUPERVISION,YN.FurnaceUPD1771,YN.FurnacePONG,YN.FurnacePV1000,YN.FurnaceSU,YN.FurnacePOWERNOISE,YN.FurnaceSCVTONE,YN.FurnacePCMDAC,YN.Furnace]},{id:"buzzmachines",name:"Buzzmachines",description:"Jeskola Buzz machines - classic tracker synths and drums",synths:[YN.Buzz3o3,YN.Buzz3o3DF,YN.BuzzM3,YN.BuzzM4,YN.Buzz4FM2F,YN.BuzzDynamite6,YN.BuzzKick,YN.BuzzKickXP,YN.BuzzTrilok,YN.BuzzNoise,YN.BuzzFreqBomb,YN.BuzzDTMF]},{id:"mame-synths",name:"MAME Hardware Synths",description:"Hardware-accurate synth and keyboard chip emulations",synths:[YN.MAMEVFX,YN.MAMEDOC,YN.MAMEES5503,YN.MAMERSA,YN.MAMESWP30,YN.CZ101,YN.MAMEUPD933,YN.CEM3394,YN.SCSP,YN.MAMEVASynth,YN.MAMEYMF271,YN.MAMEYMOPQ]},{id:"mame-arcade",name:"MAME Arcade & Retro",description:"Arcade game and retro computer sound chips (MAME-emulated)",synths:[YN.MAMEAICA,YN.MAMEASC,YN.MAMEAstrocade,YN.MAMEC352,YN.MAMEICS2115,YN.MAMEK054539,YN.MAMEMSM5232,YN.MAMERF5C400,YN.MAMESN76477,YN.MAMESNKWave,YN.MAMETIA,YN.MAMETMS36XX]},{id:"speech",name:"Speech & Voice",description:"Speech synthesis and voice generation",synths:[YN.MAMETMS5220,YN.MAMEVotrax,YN.MAMEMEA8000,YN.MAMESP0250,YN.MAMEUPD931,YN.Sam,YN.V2]},{id:"juce-synths",name:" JUCE Synths",description:"Professional quality WASM-based synth emulations",synths:[YN.Dexed,YN.OBXd]},{id:"vstbridge",name:" VST Bridge",description:"Open-source synths ported via the generic VSTBridge framework",synths:[YN.Vital,YN.Surge,YN.Odin2,YN.DexedBridge,YN.TonewheelOrgan,YN.Melodica,YN.Monique]}],QN=Object.keys(YN).sort((e,t)=>YN[e].shortName.localeCompare(YN[t].shortName));function ZN(e){return YN[e]}const JN=({compact:e=!1})=>{const{instruments:t,currentInstrumentId:n,setCurrentInstrument:a}=Py(),r=Ay(e=>e.useHexNumbers),[o,i]=s.useState(!1),l=s.useRef(null),c=s.useRef(n??0);s.useEffect(()=>{c.current=n??0},[n]);const d=[...t].sort((e,t)=>e.id-t.id),u=t.find(e=>e.id===n);s.useEffect(()=>{if(!o)return;const e=e=>{l.current&&!l.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[o]);const p=s.useCallback(e=>{const t=d.findIndex(e=>e.id===c.current);if(-1===t)return;const n=t+e;if(n>=0&&n<d.length){const e=d[n].id;c.current=e,a(e)}},[d,a]),h=s.useRef(null),m=s.useRef(null);s.useEffect(()=>()=>{h.current&&clearInterval(h.current),m.current&&clearTimeout(m.current)},[]);const f=s.useCallback(e=>{e(),m.current&&clearTimeout(m.current),h.current&&clearInterval(h.current),m.current=window.setTimeout(()=>{h.current=window.setInterval(e,80)},300)},[]),y=s.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null),h.current&&(clearInterval(h.current),h.current=null)},[]),g=e=>r?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return wn.jsxs("div",{className:"ft2-numeric-group relative",ref:l,children:[wn.jsx("span",{className:"ft2-numeric-label",children:"Instr:"}),wn.jsx("button",{className:"ft2-numeric-value cursor-pointer hover:bg-dark-bgHover rounded px-1",onClick:()=>i(!o),title:u?.name||"Select instrument",children:g(n??0)}),!e&&u&&wn.jsx("span",{className:"ml-1 text-[10px] text-text-muted truncate max-w-[60px]",title:u.name,children:u.name.slice(0,8)}),wn.jsxs("div",{className:"ft2-numeric-arrows",children:[wn.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>f(()=>p(-1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(-1)),onTouchEnd:y,title:"Previous instrument",children:wn.jsx("span",{className:"ft2-arrow-icon",children:""})}),wn.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>f(()=>p(1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(1)),onTouchEnd:y,title:"Next instrument",children:wn.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),o&&wn.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 max-h-64 overflow-y-auto bg-dark-bgTertiary border border-dark-border rounded shadow-xl z-50 scrollbar-modern",children:d.map(e=>{const t=ZN(e.synthType),s=(r=t.icon,Rt[r]||jt);var r;const o=e.id===n;return wn.jsxs("div",{onClick:()=>{return t=e.id,a(t),void i(!1);var t},className:`\n                  flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors\n                  ${o?"bg-accent-primary/20 text-text-primary":"hover:bg-dark-bgHover text-text-secondary"}\n                `,children:[wn.jsx("span",{className:"font-mono text-xs w-5 text-text-muted",children:g(e.id)}),wn.jsx(s,{size:12,className:t.color}),wn.jsx("span",{className:"flex-1 text-xs truncate",children:e.name}),wn.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:t.shortName})]},e.id)})})]})};const eC=({width:e=800,height:t=120,mode:n="waveform"})=>{const a=s.useRef(null),r=s.useRef(null),o=s.useRef(),{analyserNode:i,fftNode:l}=Ly(),[c,d]=s.useState("number"==typeof e?e:800);s.useEffect(()=>{if("auto"!==e)return void d(e);const t=a.current;if(!t)return;const n=()=>{const e=t.getBoundingClientRect();d(Math.floor(e.width))};n();const s=new ResizeObserver(n);return s.observe(t),()=>s.disconnect()},[e]);const{currentThemeId:u}=Zy(),p="cyan-lineart"===u,h=Ry(e=>e.isPlaying);return s.useEffect(()=>{const e=r.current;if(!e)return;const a=e.getContext("2d");if(!a)return;if(e.width=c,e.height=t,!h){const e=p?"#030808":"#0a0a0b",n=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",s=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)";a.fillStyle=e,a.fillRect(0,0,c,t),a.strokeStyle=n,a.lineWidth=1;for(let r=0;r<c;r+=50)a.beginPath(),a.moveTo(r,0),a.lineTo(r,t),a.stroke();for(let r=0;r<t;r+=30)a.beginPath(),a.moveTo(0,r),a.lineTo(c,r),a.stroke();return a.strokeStyle=s,a.beginPath(),a.moveTo(0,t/2),a.lineTo(c,t/2),void a.stroke()}let s=!0,d=0;const u=1e3/30,m=p?"#030808":"#0a0a0b",f=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",y=p?"#00ffff":"#00d4aa",g=p?"#00ffff":"#7c3aed",v=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)",b=a.createLinearGradient(0,0,c,0);b.addColorStop(0,y),b.addColorStop(.5,y),b.addColorStop(1,g);const x=[];if("spectrum"===n)for(let t=0;t<1024;t++)if(p)x.push("rgba(0, 255, 255, 0.75)");else{const e=160+t/1024*120;x.push(`hsla(${e}, 80%, 50%, 0.8)`)}const w=r=>{if(!s||!e||!a)return;const h=r-d;if(h<u)o.current=requestAnimationFrame(w);else{d=r-h%u,a.fillStyle=m,a.fillRect(0,0,c,t),a.strokeStyle=f,a.lineWidth=1;for(let e=0;e<c;e+=50)a.beginPath(),a.moveTo(e,0),a.lineTo(e,t),a.stroke();for(let e=0;e<t;e+=30)a.beginPath(),a.moveTo(0,e),a.lineTo(c,e),a.stroke();if("waveform"===n&&i){const e=i.getValue();a.strokeStyle=b,a.lineWidth=2,a.beginPath();const n=c/e.length;let s=0;for(let r=0;r<e.length;r++){const o=(e[r]+1)/2*t;0===r?a.moveTo(s,o):a.lineTo(s,o),s+=n}a.stroke(),a.strokeStyle=v,a.lineWidth=1,a.beginPath(),a.moveTo(0,t/2),a.lineTo(c,t/2),a.stroke()}else if("spectrum"===n&&l){const e=l.getValue(),n=c/e.length;let s=0;for(let r=0;r<e.length;r++){const o=(e[r]+100)/100,i=o*t;p?(a.globalAlpha=.5+.5*o,a.fillStyle="rgb(0, 255, 255)"):a.fillStyle=x[r]||x[x.length-1],a.fillRect(s,t-i,n-1,i),s+=n}a.globalAlpha=1}o.current=requestAnimationFrame(w)}};return o.current=requestAnimationFrame(w),()=>{s=!1,o.current&&cancelAnimationFrame(o.current)}},[c,t,n,i,l,p,h]),wn.jsx("div",{ref:a,className:"auto"===e?"w-full":"",children:wn.jsx("canvas",{ref:r,style:{width:"auto"===e?"100%":`${c}px`,height:`${t}px`}})})},tC=({height:e=100,width:t="auto"})=>{const n=s.useRef(null),a=s.useRef(null),r=s.useRef(null),o=s.useRef([]),i=s.useRef([]),{patterns:l,currentPatternIndex:c}=tf(),d=Ry(e=>e.isPlaying),{currentThemeId:u}=Zy(),p=l[c],h=p?.channels.length||4,m="cyan-lineart"===u;s.useEffect(()=>{o.current=new Array(h).fill(0),i.current=new Array(h).fill(null).map(()=>({level:0,frames:0}))},[h]);const f=s.useCallback(t=>{const s=a.current,l=n.current;if(!s||!l)return void(r.current=requestAnimationFrame(f));const c=s.getContext("2d");if(!c)return void(r.current=requestAnimationFrame(f));const d=l.clientWidth;s.width===d&&s.height===e||(s.width=d,s.height=e);const u=Hm().getChannelTriggerLevels(h);for(let e=0;e<h;e++){const t=u[e]||0,n=o.current[e]||0;t>n?o.current[e]=n+.7*(t-n):(o.current[e]=.88*n,o.current[e]<.01&&(o.current[e]=0));const a=i.current[e];o.current[e]>=a.level?(a.level=o.current[e],a.frames=30):a.frames>0?a.frames--:(a.level*=.95,a.level<.01&&(a.level=0))}const p=m?"#030808":"#0a0a0b";c.fillStyle=p,c.fillRect(0,0,d,e);const y=Math.max(6,(e-24-3*(h-1))/h),g=d-40;for(let e=0;e<h;e++){const t=12+e*(y+3),n=o.current[e],a=i.current[e],s=n*g,r=20+a.level*g;if(c.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",c.font="9px monospace",c.textAlign="left",c.fillText(`${e+1}`,4,t+y-1),c.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",c.fillRect(20,t,g,y),s>0){const e=c.createLinearGradient(20,0,20+g,0);m?(e.addColorStop(0,"rgba(0, 200, 200, 0.8)"),e.addColorStop(.7,"rgba(0, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 100, 100, 1)")):(e.addColorStop(0,"rgba(0, 180, 140, 0.8)"),e.addColorStop(.7,"rgba(0, 212, 170, 1)"),e.addColorStop(1,"rgba(255, 80, 80, 1)")),c.fillStyle=e,c.fillRect(20,t,s,y)}a.level>.02&&(c.fillStyle=m?"#00ffff":"#ff4444",c.fillRect(r-1,t,2,y))}c.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",c.font="10px sans-serif",c.textAlign="center",c.fillText("Channel Levels",d/2,e-3),r.current=requestAnimationFrame(f)},[h,e,m]);return s.useEffect(()=>{if(!d){r.current&&(cancelAnimationFrame(r.current),r.current=null);const t=a.current,s=n.current;if(t&&s){const n=t.getContext("2d");if(n){const a=s.clientWidth;t.width=a,t.height=e;const r=m?"#030808":"#0a0a0b";n.fillStyle=r,n.fillRect(0,0,a,e);const o=Math.max(6,(e-24-3*(h-1))/h),i=a-40,l=12;for(let e=0;e<h;e++){const t=l+e*(o+3);n.fillStyle=m?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",n.font="9px monospace",n.textAlign="left",n.fillText(`${e+1}`,4,t+o-1),n.fillStyle=m?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",n.fillRect(20,t,i,o)}n.fillStyle=m?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",n.font="10px sans-serif",n.textAlign="center",n.fillText("Channel Levels",a/2,e-3)}}return o.current=new Array(h).fill(0),void(i.current=new Array(h).fill(null).map(()=>({level:0,frames:0})))}return r.current=requestAnimationFrame(f),()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)}},[f,d,h,e,m]),wn.jsx("div",{ref:n,className:"auto"===t?"w-full":"",children:wn.jsx("canvas",{ref:a,style:{width:"100%",height:`${e}px`}})})},nC=e.memo(({height:e=100,onComplete:t})=>{const n=s.useRef(null),a=s.useRef(null),[r,o]=s.useState(null),i=s.useRef(null),l=s.useRef(null),c=s.useRef(t);s.useEffect(()=>{c.current=t},[t]);const d=s.useRef(!1),{currentThemeId:u}=Zy(),p="cyan-lineart"===u;s.useEffect(()=>{fetch("/DEViLBOX/assets/up-rough-logo.svg").then(e=>e.text()).then(e=>{let t=e;t=t.replace(/stroke="#000"/g,'stroke="currentColor"'),t=t.replace(/stroke-width="0"/g,'stroke-width="0" fill="currentColor"'),o(t)}).catch(e=>{})},[]);const h=s.useCallback(()=>{if(!a.current)return;const e=a.current.querySelector("svg");if(e){e.querySelectorAll("*").forEach(e=>{e.style.animationPlayState="paused"}),e.style.animationPlayState="paused"}},[]);s.useEffect(()=>(d.current=!1,l.current=setTimeout(()=>{h(),d.current=!0,c.current?.()},1e4),()=>{l.current&&clearTimeout(l.current)}),[h]);const m=s.useCallback(()=>{if(!a.current)return void(i.current=requestAnimationFrame(m));const e=a.current,t=p?"#00ffff":"#00d4aa";e.style.color=t,e.style.transform="scale(1.5)",e.style.filter="",i.current=requestAnimationFrame(m)},[p]);s.useEffect(()=>(i.current=requestAnimationFrame(m),()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null)}),[m]);const f=p?"#00ffff":"#00d4aa";return wn.jsx("div",{ref:n,className:"w-full flex items-center justify-center overflow-hidden",style:{height:`${e}px`},onClick:e=>{e.stopPropagation(),l.current&&clearTimeout(l.current),i.current&&cancelAnimationFrame(i.current),c.current?.()},title:"Click to skip",children:r?wn.jsx("div",{ref:a,className:"flex items-center justify-center",style:{height:"100%",width:"100%",color:f,transformOrigin:"center center",transform:"scale(1.5)"},dangerouslySetInnerHTML:{__html:r}}):wn.jsx("span",{className:"text-text-muted text-sm",children:"Loading..."})})}),aC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const o=window.devicePixelRatio||1;s.width=a*o,s.height=e*o,r.scale(o,o);const i=a/2,l=e/2,c=.4*Math.min(a,e),d=()=>{r.clearRect(0,0,a,e);const t=Hm().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}r.strokeStyle="#333",r.lineWidth=2,r.beginPath(),r.arc(i,l,c,0,2*Math.PI),r.stroke();for(let e=0;e<3;e++){const t=c*(.4+.2*e),n=Math.max(0,s-.3*e);if(n>0){const e=2*Math.PI*Math.min(2*n,1),a=r.createLinearGradient(i-t,l,i+t,l);a.addColorStop(0,"#00d4aa"),a.addColorStop(.5,"#00ffff"),a.addColorStop(1,"#00d4aa"),r.strokeStyle=a,r.lineWidth=8,r.lineCap="round",r.beginPath(),r.arc(i,l,t,-Math.PI/2,-Math.PI/2+e),r.stroke()}}r.fillStyle=s>.5?"#00ffff":"#333",r.beginPath(),r.arc(i,l,4,0,2*Math.PI),r.fill(),n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,e]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},sC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const o=window.devicePixelRatio||1;s.width=a*o,s.height=e*o,r.scale(o,o);const i=a/32,l=new Array(32).fill(0),c=()=>{r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Hm().getFFT();if(t){const n=t,a=Math.floor(n.length/32);for(let t=0;t<32;t++){const s=(n[t*a]+140)/140,o=Math.max(0,Math.min(1,s))*e*.9;l[t]+=.3*(o-l[t]);const c=t*i,d=l[t],u=r.createLinearGradient(c,e-d,c,e);u.addColorStop(0,"#00ffff"),u.addColorStop(.5,"#00d4aa"),u.addColorStop(1,"#006655"),r.fillStyle=u,r.fillRect(c+1,e-d,i-2,d),r.fillStyle="rgba(0, 255, 255, 0.5)",r.fillRect(c+1,e-d,i-2,2),r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(c+i-2,e-d,1,d)}}n.current=requestAnimationFrame(c)};return c(),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,e]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},rC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),a=s.useRef([]),[r,o]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const o=s.getContext("2d");if(!o)return;const i=window.devicePixelRatio||1;s.width=r*i,s.height=e*i,o.scale(i,i);const l=a.current,c=(e,t,n)=>({x:e,y:t,vx:(Math.random()-.5)*n*4,vy:(Math.random()-.5)*n*4,size:3*Math.random()+1,life:1}),d=()=>{o.fillStyle="rgba(10, 10, 11, 0.15)",o.fillRect(0,0,r,e);const t=Hm().getWaveform();let a=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);a=Math.min(1,10*e)}if(a>.1&&l.length<150){const t=Math.floor(8*a);for(let n=0;n<t;n++)l.push(c(r/2+40*(Math.random()-.5),e/2+40*(Math.random()-.5),a))}for(let n=l.length-1;n>=0;n--){const t=l[n];t.x+=t.vx,t.y+=t.vy,t.life-=.015;const s=r/2-t.x,i=e/2-t.y,c=Math.sqrt(s*s+i*i);if(c>20&&(t.vx+=s/c*.05,t.vy+=i/c*.05),t.vx*=.98,t.vy*=.98,t.life<=0){l.splice(n,1);continue}const d=t.life,u=(60*t.life+160)%360;o.fillStyle=`hsla(${u}, 100%, 60%, ${d})`,o.beginPath(),o.arc(t.x,t.y,t.size*t.life,0,2*Math.PI),o.fill(),a>.5&&(o.fillStyle=`hsla(${u}, 100%, 80%, ${.3*d})`,o.beginPath(),o.arc(t.x,t.y,t.size*t.life*2,0,2*Math.PI),o.fill())}n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current),a.current=[]}},[r,e]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},oC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Hm().getWaveform();if(t){const e=t;for(let t=0;t<c;t++){const n=Math.floor(t/d),a=t%d*p,s=n*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(a,s,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,a+4,s+10);const o=4,i=h-2*o-12,u=s+o+12,m=Math.max(1,Math.floor(e.length/(p-2*o))),f=Math.floor(t/c*e.length),y=123*t%e.length;r.strokeStyle=l?.channels[t]?.muted?"#333":"#00d4aa",r.lineWidth=1.5,r.beginPath();for(let l=0;l<p-2*o;l++){let n=e[(f+l*m+y)%e.length];n=n*(.3+t/c*.5)*(1+t%3);const s=a+o+l,d=u+i/2+n*i*.4;0===l?r.moveTo(s,d):r.lineTo(s,d)}r.stroke()}}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},iC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4,d=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const u=Math.min(8,c),p=Math.ceil(c/u),h=a/u,m=e/p,f=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Hm().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/u),n=e%u*h,a=t*m,o=Date.now()/1e3,i=2.1*e,c=.4*Math.sin(2*o+i)+.3*Math.cos(1.3*o+.7*i),p=.5+e%4*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*p+c));d.current[e]+=.2*(f-d.current[e]);const y=d.current[e],g=2;r.fillStyle="#111",r.fillRect(n+g,a+g,h-2*g,m-2*g);const v=(m-2*g)*y,b=r.createLinearGradient(n,a+m,n,a+m-v);y>.8?(b.addColorStop(0,"#ff0000"),b.addColorStop(.3,"#ffff00"),b.addColorStop(1,"#00ff00")):y>.5?(b.addColorStop(0,"#ffff00"),b.addColorStop(1,"#00ff00")):(b.addColorStop(0,"#00ff00"),b.addColorStop(1,"#00d4aa")),r.fillStyle=b,r.fillRect(n+g,a+m-g-v,h-2*g,v),r.fillStyle=y>.5?"#000":"#666",r.font="9px monospace",r.textAlign="center",r.fillText((e+1).toString(),n+h/2,a+m/2+3),r.strokeStyle=l?.channels[e]?.solo?"#00ffff":"#222",r.lineWidth=l?.channels[e]?.solo?2:1,r.strokeRect(n+g,a+g,h-2*g,m-2*g)}n.current=requestAnimationFrame(f)};return f(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},lC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Hm().getFFT();if(t){const e=t,n=16;for(let t=0;t<c;t++){const a=Math.floor(t/d),s=t%d*p,o=a*h;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(s,o,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,s+4,o+10);const i=4,u=(p-2*i)/n,m=h-2*i-12;for(let d=0;d<n;d++){const a=Math.floor(t/c*e.length*.6),p=(e[(Math.floor(d/n*e.length)+a)%e.length]+140)/140,h=Math.max(0,Math.min(1,p))*m,f=Date.now()/1e3,y=1.7*t,g=.4+t%3*.3,v=h*(l?.channels[t]?.muted?0:.3*Math.sin(1.5*f+y+.4*d)+g),b=s+i+d*u,x=o+i+12+m-v,w=d/n*180+180;r.fillStyle=`hsl(${w}, 80%, 50%)`,r.fillRect(b,x,u-1,v)}}}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},cC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const d=Math.min(4,c),u=Math.ceil(c/d),p=a/d,h=e/u,m=()=>{if(!o)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Hm().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),n=e%d*p,a=t*h,o=Date.now()/1e3,i=2.5*e,u=.3*Math.sin(2*o+i),m=.6+e%3*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*m+u));r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(n,a,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${e+1}`,n+4,a+10);const y=n+p/2,g=a+h/2,v=Math.min(p,h)/2-12;r.strokeStyle="#333",r.lineWidth=1,r.beginPath(),r.arc(y,g,v,0,2*Math.PI),r.stroke();const b=2;for(let s=0;s<b;s++){const t=v*(.5+.3*s),n=Math.max(0,f-.4*s);if(n>0){const a=2*Math.PI*Math.min(1.5*n,1),s=(o+.3*e)%(2*Math.PI),i=160+e/c*60;r.strokeStyle=`hsl(${i}, 80%, 50%)`,r.lineWidth=4,r.lineCap="round",r.beginPath(),r.arc(y,g,t,-Math.PI/2+s,-Math.PI/2+s+a),r.stroke()}}r.fillStyle=f>.5?"#00ffff":"#333",r.beginPath(),r.arc(y,g,3,0,2*Math.PI),r.fill()}n.current=requestAnimationFrame(m)};return m(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},dC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),a=s.useRef([]),[r,o]=s.useState(300),{patterns:i,currentPatternIndex:l}=tf(),c=i[l],d=c?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const o=s.getContext("2d");if(!o)return;let i=!0;const l=window.devicePixelRatio||1;s.width=r*l,s.height=e*l,o.scale(l,l);const u=Math.min(4,d),p=Math.ceil(d/u),h=r/u,m=e/p;a.current=Array(d).fill(0).map(()=>[]);const f=()=>{if(!i)return;o.fillStyle="#0a0a0b",o.fillRect(0,0,r,e);const t=Hm().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<d;e++){const t=Math.floor(e/u),n=e%u*h,r=t*m,i=Date.now()/1e3,l=2.3*e,p=.35*Math.sin(2.5*i+l),f=.5+e%4*.25,y=c?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*f+p));o.strokeStyle="#222",o.lineWidth=1,o.strokeRect(n,r,h,m),o.fillStyle="#555",o.font="8px monospace",o.fillText(`CH${e+1}`,n+4,r+10);const g=n+h/2,v=r+m/2,b=20,x=a.current[e];if(y>.1&&x.length<b){const t=Math.floor(3*y);for(let n=0;n<t;n++){const t=Math.random()*Math.PI*2,n=.5+1.5*Math.random();x.push({x:g,y:v,vx:Math.cos(t)*n,vy:Math.sin(t)*n,life:1,maxLife:.5+.5*Math.random(),channelIndex:e})}}for(let a=x.length-1;a>=0;a--){const t=x[a];t.x+=t.vx,t.y+=t.vy;const n=g-t.x,s=v-t.y;if(Math.sqrt(n*n+s*s)>5&&(t.vx+=.01*n,t.vy+=.01*s),t.vx*=.98,t.vy*=.98,t.life-=.02,t.life<=0){x.splice(a,1);continue}const r=t.life,i=160+e/d*60,l=2+2*r;o.fillStyle=`hsla(${i}, 80%, 50%, ${.8*r})`,o.beginPath(),o.arc(t.x,t.y,l,0,2*Math.PI),o.fill(),o.fillStyle=`hsla(${i}, 80%, 50%, ${.2*r})`,o.beginPath(),o.arc(t.x,t.y,2*l,0,2*Math.PI),o.fill()}}n.current=requestAnimationFrame(f)};return f(),()=>{i=!1,n.current&&cancelAnimationFrame(n.current)}},[r,e,d,c]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},uC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4,d=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const u=Math.min(4,c),p=Math.ceil(c/u),h=a/u,m=e/p,f=()=>{if(!o)return;r.fillStyle="#000",r.fillRect(0,0,a,e);const t=Hm().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/u),n=e%u*h,a=t*m,o=Date.now()/1e3,i=1.5*e,p=.2*Math.sin(3*o+i),f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s+p));d.current[e]+=.15*(f-d.current[e]);const y=d.current[e],g=n+h/2,v=a+m/2,b=Math.min(h,m)/2-10;r.fillStyle="#333",r.font="8px monospace",r.fillText((e+1).toString(),n+4,a+10);const x=3;for(let s=0;s<x;s++){const t=Math.max(0,y-.2*s),n=b/x*(s+1)+10*t,a=.2+.8*t,o=180+e/c*120+20*s;r.beginPath(),r.arc(g,v,n,0,2*Math.PI),r.strokeStyle=`hsla(${o}, 80%, 50%, ${a})`,r.lineWidth=1+3*t,r.stroke(),t>.3&&(r.shadowBlur=10*t,r.shadowColor=`hsla(${o}, 100%, 50%, 0.5)`,r.stroke(),r.shadowBlur=0)}r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.moveTo(g-5,v),r.lineTo(g+5,v),r.moveTo(g,v-5),r.lineTo(g,v+5),r.stroke()}n.current=requestAnimationFrame(f)};return f(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},pC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4,d=s.useRef(0);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const u=Math.min(4,c),p=Math.ceil(c/u),h=a/u,m=e/p,f=()=>{if(!o)return;r.fillStyle="#000",r.fillRect(0,0,a,e);const t=Hm().getFFT();d.current+=.05;for(let e=0;e<c;e++){const n=Math.floor(e/u),a=e%u*h,s=n*m,o=a+h/2,i=s+m/2;let p=0;if(t&&t.length>0){const n=e*Math.floor(t.length/c);let a=0;for(let e=0;e<10;e++)a+=(t[n+e]+140)/140;p=Math.max(0,Math.min(1,a/10))}l?.channels[e]?.muted&&(p=0);const f=8;for(let t=0;t<f;t++){const n=(t/f+d.current%(1/f))%1,l=1-n,u=.8*n,y=200+e/c*100+50*n;r.strokeStyle=`hsla(${y}, 80%, 50%, ${u})`,r.lineWidth=1+2*p;const g=h*l,v=m*l;r.strokeRect(o-g/2,i-v/2,g,v),0===t&&p>.5&&(r.beginPath(),r.moveTo(a,s),r.lineTo(o-g/2,i-v/2),r.moveTo(a+h,s),r.lineTo(o+g/2,i-v/2),r.moveTo(a,s+m),r.lineTo(o-g/2,i+v/2),r.moveTo(a+h,s+m),r.lineTo(o+g/2,i+v/2),r.stroke())}const y=r.createRadialGradient(o,i,0,o,i,10+20*p),g=180+e/c*60;y.addColorStop(0,`hsla(${g}, 100%, 70%, ${.5*p})`),y.addColorStop(1,"transparent"),r.fillStyle=y,r.fillRect(a,s,h,m)}n.current=requestAnimationFrame(f)};return f(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},hC=({height:e=100})=>{const t=s.useRef(null),n=s.useRef(void 0),[a,r]=s.useState(300),{patterns:o,currentPatternIndex:i}=tf(),l=o[i],c=l?.channels.length||4,d=s.useRef(0),u=s.useRef([]);return s.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let o=!0;const i=window.devicePixelRatio||1;s.width=a*i,s.height=e*i,r.scale(i,i);const p=Math.min(4,c),h=Math.ceil(c/p),m=a/p,f=e/h;u.current.length!==c&&(u.current=Array(c).fill(0).map(()=>[]));const y=()=>{if(!o)return;r.fillStyle="#000",r.fillRect(0,0,a,e);const t=Hm().getWaveform();d.current+=.05;for(let e=0;e<c;e++){const n=Math.floor(e/p),a=e%p*m+m/2,s=n*f+f/2,o=Math.min(m,f)/2-5;r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.arc(a,s,o,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(a,s,.6*o,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(a,s,.3*o,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(a-o,s),r.lineTo(a+o,s),r.moveTo(a,s-o),r.lineTo(a,s+o),r.stroke();let i=0;if(t&&t.length>0){const n=Math.floor(e/c*t.length),a=Math.floor((e+1)/c*t.length);let s=0;for(let e=n;e<a;e+=10)s+=Math.abs(t[e]);i=Math.min(1,s/((a-n)/10)*5)}if(l?.channels[e]?.muted&&(i=0),i>.3){const t=d.current%(2*Math.PI),n=(.2+.8*Math.random())*o;u.current[e].push({x:a+Math.cos(t)*n,y:s+Math.sin(t)*n,age:1,hue:120+e/c*100})}for(let t=u.current[e].length-1;t>=0;t--){const n=u.current[e][t];r.fillStyle=`hsla(${n.hue}, 100%, 50%, ${n.age})`,r.beginPath(),r.arc(n.x,n.y,2*n.age,0,2*Math.PI),r.fill(),n.age-=.01,n.age<=0&&u.current[e].splice(t,1)}const h=r.createConicGradient(d.current,a,s),y=120+e/c*100;h.addColorStop(0,`hsla(${y}, 100%, 50%, 0.5)`),h.addColorStop(.1,`hsla(${y}, 100%, 50%, 0)`),h.addColorStop(1,`hsla(${y}, 100%, 50%, 0)`),r.fillStyle=h,r.beginPath(),r.moveTo(a,s),r.arc(a,s,o,d.current,d.current-.5,!0),r.fill(),r.strokeStyle=`hsla(${y}, 100%, 70%, 0.8)`,r.lineWidth=2,r.beginPath(),r.moveTo(a,s),r.lineTo(a+Math.cos(d.current)*o,s+Math.sin(d.current)*o),r.stroke()}n.current=requestAnimationFrame(y)};return y(),()=>{o=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,c,l]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center",children:wn.jsx("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}})})},mC=[{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,2,2,2,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,9,8,9,9,8,9,9,9,9,9,10,9,10,10,9,10,10,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,10,10,9,10,10,9,10,9,9,9,9,9,8,9,9,8,9,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,8,1,8,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,1,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,2,3,2,3,4,3,4,4,4,3,4,3,2,3,2,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,10,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,10,9,10,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,9,10,9,9,9,8,8,9,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,8,8,9,9,9,10,9,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,3,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,1,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,1,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,1,1,1,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,1,0,0,0,0,0,0,0,0,0,0,2,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,4,4,4,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,9,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,1,8,8,8,9,9,9,10,9,10,10,10,10,9,10,9,9,9,8,9,8,8,8,1,8,1,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,1,4,1,4,4,3,4,3,3,3,4,3,4,4,1,4,1,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,1,1,4,1,4,4,3,4,3,3,2,2,3,4,3,4,4,1,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:0,p2Dir:5,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,3,4,4,4,4,4,0,0,2,2,2,3,4,4,4,4,4,0,0,9,9,9,9,9,10,10,10,0,0,9,9,9,9,9,10,10,10,0,0,0,7,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,4,0,0,2,0,0,0,0,0,0,0,4,0,0,9,0,0,0,0,9,10,10,0,0,9,0,0,0,0,9,10,10,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0],[0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,10,10,9,0,0,0,0,0,9,0,0,10,10,9,0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,2,0,0,4,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,6,0,0,10,10,10,9,9,9,9,9,9,0,0,10,10,10,9,9,9,9,9,9,0,0,4,4,4,4,3,2,2,2,0,0,4,4,4,4,3,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,3,3,4,4,1,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,0,1,0,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,1,4,4,3,3,2,2,2,2],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,4,4,3,3,2,2,2,2,3,3,4,0,0,0,0,0,0,0,4,3,3,2,2,2,2,3,3,4,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,1,0,1,0,4,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,7,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,0,8,8,8,8,0,8,8,8,8,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,8,8,8,8,0,8,8,8,8,0,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,3,2,2,2,2,2,3,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0],[0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0],[0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,9,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,1,9,0,0,0,0,0,0,10,1,10,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,9,9,9,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,8,8,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,8,8,8,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,10,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,1,9,0,0,0,0,0],[0,0,10,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,0,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,2,0,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,0,0,0,0,3,3,3,3,3,3,0,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,0,3,2,2,2,3,3,0,3,4,4,4,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,0,2,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,1,0,4,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,2,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,4,1,0,1,4,4,0,3,3,3,0,2,2,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,2,2,2,0,3,3,4,4,4,0,1,1,1,4,4,0,3,3,3,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,10,10,10,10,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,8,8,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,0,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,7,0],[0,0,0,0,0,8,0,9,0,1,0,9,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,2,0,3,0,4,0,1,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,9,0,10,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,4,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,8,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,4,0,3,0,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,2,0,4,0,2,2,2,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,9,0,1,0,10,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,1,0,9,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,3,0,4,4,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,9,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,3,3,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,4,0,1,0,3,0,2,0,0,0,0,0],[0,0,0,0,0,9,0,8,0,9,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,9,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,0,1,0,4,0,2,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,3,0,4,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,8,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,3,3,0,4,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,8,0,9,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,0,9,9,9,0,8,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,0,2,0,3,0,0,0,0,0],[0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,2,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,3,0,1,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[6,0,0,0,0,3,4,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,2,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,3,0,1,0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,1,0,0,0,3,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,3,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,3,0,3,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,3,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,1,4,0],[0,4,3,0,1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,2,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,4,1,4,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,2,0,0,0,3,0,0,0,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,1,0,0,0,0,0,0,2,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,3,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,1,0,7]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,9,9,9,9,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,4,4,4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}],fC="nibbles";const yC=new class{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise||(this.initPromise=new Promise((e,t)=>{const n=indexedDB.open("devilbox-scores",1);n.onerror=()=>{t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(fC)){const e=t.createObjectStore(fC,{keyPath:"id",autoIncrement:!0});e.createIndex("score","score",{unique:!1}),e.createIndex("date","date",{unique:!1})}}})),this.initPromise}async ensureDb(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async saveScore(e){const t=await this.ensureDb(),n={...e,date:new Date};return new Promise((e,a)=>{const s=t.transaction([fC],"readwrite").objectStore(fC).add(n);s.onsuccess=()=>{e(s.result)},s.onerror=()=>{a(s.error)}})}async getTopScores(e=10){const t=await this.ensureDb();return new Promise((n,a)=>{const s=t.transaction([fC],"readonly").objectStore(fC).index("score").openCursor(null,"prev"),r=[];s.onsuccess=()=>{const t=s.result;t&&r.length<e?(r.push(t.value),t.continue()):n(r)},s.onerror=()=>{a(s.error)}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,n)=>{const a=e.transaction([fC],"readwrite").objectStore(fC).clear();a.onsuccess=()=>t(),a.onerror=()=>n(a.error)})}},gC=[12,8,6,4],vC=51,bC=23,xC=["#000000","#5397FF","#000067","#4BFFFF","#AB7787","#FFFFFF","#7F7F7F","#ABCDEF","#733747","#F7CBDB","#434343","#D3D3D3","#FFFF00"],wC=({height:t=100,onExit:n})=>{const a=s.useRef(null),r=s.useRef(null),[o,i]=s.useState(408),[l,c]=s.useState({level:0,score1:0,score2:0,lives1:3,lives2:3,isPlaying:!1,showMenu:!1,showHighScores:!1}),[d,u]=s.useState(1),[p,h]=s.useState(1),[m,f]=s.useState(!1),[y,g]=s.useState(!0),[v,b]=s.useState(!1),[x,w]=s.useState([]),k=s.useRef(0),S=s.useRef(0),M=s.useRef(0),N=s.useRef(3),C=s.useRef(3),E=s.useRef(!1),P=s.useRef([]),T=s.useRef([]),A=s.useRef([]),_=s.useRef(0),I=s.useRef(0),D=s.useRef(5),O=s.useRef(5),F=s.useRef(0),R=s.useRef(0),j=s.useRef(0),L=s.useRef([]),B=s.useRef([]),V=s.useRef(null),z=s.useCallback(()=>{c({level:k.current,score1:S.current,score2:M.current,lives1:N.current,lives2:C.current,isPlaying:E.current,showMenu:!1,showHighScores:!1})},[]),U=e=>c(t=>({...t,showMenu:e})),G=e=>c(t=>({...t,showHighScores:e})),W=e=>{E.current=e,c(t=>({...t,isPlaying:e}))},K=s.useCallback(async()=>{const e=await yC.getTopScores(10);w(e)},[]);s.useEffect(()=>{K()},[K]);const H=s.useCallback(async()=>{W(!1);const e=S.current,t=M.current,n=k.current,a=x.length<10?0:x[x.length-1].score;if(e>a){const t=prompt("Player 1 - Enter your name for the highscore:","Player 1");t&&await yC.saveScore({name:t,score:e,level:n+1,players:p,speed:d})}if(2===p&&t>a){const e=prompt("Player 2 - Enter your name for the highscore:","Player 2");e&&await yC.saveScore({name:e,score:t,level:n+1,players:p,speed:d})}K(),G(!0),k.current=0,S.current=0,M.current=0,N.current=3,C.current=3,$(0),z()},[p,d,x,K,z]);s.useEffect(()=>{const e=()=>{r.current&&i(r.current.clientWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const $=s.useCallback(e=>{const t=mC[e%mC.length],n=t.grid.map(e=>[...e]);let a=2,s=2,r=48,o=20;for(let l=0;l<bC;l++)for(let e=0;e<vC;e++){const t=n[l][e];6===t&&(a=e,s=l,n[l][e]=0),7===t&&(r=e,o=l,n[l][e]=0)}P.current=n;const i=e=>0===e?2:5===e?3:6===e?0:7===e?1:0;_.current=i(t.p1Dir),I.current=i(t.p2Dir),T.current=Array(256).fill(null).map(()=>({x:a,y:s})),A.current=Array(256).fill(null).map(()=>({x:r,y:o})),D.current=5,O.current=5,F.current=0,R.current=0,j.current=0,P.current[s][a]=6,2===p&&(P.current[o][r]=7),L.current=[],B.current=[],v||q()},[p,v]),q=()=>{let e=0;for(;e<1e3;){const t=Math.floor(Math.random()*vC),n=Math.floor(Math.random()*bC);if(0===P.current[n][t]&&(22===n||0===P.current[n+1][t]))return j.current++,void(P.current[n][t]=16+j.current);e++}},Y=(e,t,n)=>{if(!m&&(0===e&&2===n||50===e&&0===n||0===t&&1===n||22===t&&3===n))return!0;const a=P.current[t][e];return a>=1&&a<=15},X=s.useCallback(()=>{if(!E.current)return;if(L.current.length>0){const e=L.current.shift();0===e&&2===_.current||2===e&&0===_.current||1===e&&3===_.current||3===e&&1===_.current||(_.current=e)}if(2===p&&B.current.length>0){const e=B.current.shift();0===e&&2===I.current||2===e&&0===I.current||1===e&&3===I.current||3===e&&1===I.current||(I.current=e)}const e=(e,t)=>{let{x:n,y:a}=e;return 0===t?n++:1===t?a--:2===t?n--:3===t&&a++,n<0&&(n=50),n>=vC&&(n=0),a<0&&(a=22),a>=bC&&(a=0),{x:n,y:a}},t=e(T.current[0],_.current),n=2===p?e(A.current[0],I.current):null,a=Y(t.x,t.y,_.current),s=!!n&&Y(n.x,n.y,I.current),r=n&&t.x===n.x&&t.y===n.y;if(a||s||r)return N.current-=a||r?1:0,C.current-=s||r?1:0,void(N.current<=0||2===p&&C.current<=0?H():(W(!1),$(k.current),z()));let o=!1,i=!1;const l=P.current[t.y][t.x];if(l>=16&&(S.current+=999*(l-16)*(k.current+1),F.current=D.current>>1,o=!0),n){const e=P.current[n.y][n.x];e>=16&&(M.current+=999*(e-16)*(k.current+1),R.current=O.current>>1,i=!0)}if(o||i){if(9===j.current)return k.current++,$(k.current),void z();q()}for(let c=255;c>0;c--)T.current[c]=T.current[c-1]?{...T.current[c-1]}:null,2===p&&(A.current[c]=A.current[c-1]?{...A.current[c-1]}:null);if(T.current[0]=t,n&&(A.current[0]=n),!v){if(F.current>0&&D.current<255)F.current--,D.current++;else{const e=T.current[D.current];e&&(P.current[e.y][e.x]=0)}if(2===p)if(R.current>0&&O.current<255)R.current--,O.current++;else{const e=A.current[O.current];e&&(P.current[e.y][e.x]=0)}}S.current=Math.max(0,S.current-17),2===p&&(M.current=Math.max(0,M.current-17)),P.current[t.y][t.x]=6,n&&(P.current[n.y][n.x]=7),z()},[p,m,v,$,H,z]);return s.useEffect(()=>{let e=0;const t=n=>{E.current&&n-e>=16.67*gC[d]&&(e=n,X()),V.current=requestAnimationFrame(t)};return V.current=requestAnimationFrame(t),()=>{V.current&&cancelAnimationFrame(V.current)}},[d,X]),s.useEffect(()=>{const e=e=>{E.current&&("ArrowRight"===e.key&&(e.preventDefault(),L.current.push(0)),"ArrowUp"===e.key&&(e.preventDefault(),L.current.push(1)),"ArrowLeft"===e.key&&(e.preventDefault(),L.current.push(2)),"ArrowDown"===e.key&&(e.preventDefault(),L.current.push(3)),"d"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(0)),"w"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(1)),"a"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(2)),"s"===e.key.toLowerCase()&&(e.preventDefault(),B.current.push(3)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),s.useEffect(()=>{const e=a.current;if(!e)return;const t=e.getContext("2d");if(!t)return;let n=!0;const s=()=>{if(!n)return;if(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),l.showMenu||l.showHighScores)return void(V.current=requestAnimationFrame(s));const a=Math.min(e.width/vC,e.height/bC),r=(e.width-vC*a)/2,o=(e.height-bC*a)/2;for(let e=0;e<bC;e++)for(let n=0;n<vC;n++){const s=P.current[e]?.[n];if(void 0===s||0===s)continue;const i=r+n*a,l=o+e*a;s>=16?(t.fillStyle=xC[5],t.font=`bold ${Math.floor(.8*a)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText((s-16).toString(),i+a/2,l+a/2+1)):y?(t.fillStyle="#222",t.fillRect(i,l,a,a),t.fillStyle=xC[s]||"#fff",t.fillRect(i+1,l+1,a-1,a-1)):(t.fillStyle=xC[s]||"#fff",t.fillRect(i,l,a,a))}V.current=requestAnimationFrame(s)},r=requestAnimationFrame(s);return()=>{n=!1,cancelAnimationFrame(r)}},[y,l.showMenu,l.showHighScores]),s.useEffect(()=>{$(0),z()},[$,z]),wn.jsxs("div",{ref:r,className:"w-full h-full flex flex-col items-center relative group overflow-hidden",style:{height:`${t}px`},onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"absolute top-0 left-0 w-full flex justify-between px-2 py-0.5 pointer-events-none z-10 bg-black/40 backdrop-blur-sm transition-opacity opacity-0 "+(l.isPlaying?"group-hover:opacity-100":""),children:[wn.jsxs("div",{className:"font-mono text-[8px] text-white uppercase",children:["P1: ",l.score1," | L:",l.lives1]}),wn.jsxs("div",{className:"font-mono text-[8px] text-accent-primary font-bold",children:["LVL ",l.level+1]}),wn.jsxs("div",{className:"font-mono text-[8px] text-white uppercase",children:["P2: ",l.score2," | L:",l.lives2]})]}),wn.jsx("canvas",{ref:a,width:o,height:t,className:"cursor-pointer",onClick:e=>{e.stopPropagation(),l.isPlaying||W(!0)}}),!l.isPlaying&&!l.showMenu&&!l.showHighScores&&wn.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-20",children:wn.jsxs("div",{className:"flex flex-col items-center gap-2 scale-75 md:scale-100",children:[wn.jsx("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"NIBBLES"}),wn.jsx("button",{onClick:e=>{e.stopPropagation(),W(!0)},className:"bg-accent-primary hover:bg-accent-secondary text-white px-6 py-1 rounded-full text-xs font-bold uppercase transition-all shadow-glow-sm",children:"Start Game"}),wn.jsxs("div",{className:"flex gap-4",children:[wn.jsx("button",{onClick:e=>{e.stopPropagation(),U(!0)},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"Options"}),wn.jsx("button",{onClick:e=>{e.stopPropagation(),G(!0),K()},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"High Scores"}),wn.jsx("button",{onClick:e=>{e.stopPropagation(),n?.()},className:"text-red-400/70 hover:text-red-400 text-[9px] uppercase font-mono",children:"Exit"})]})]})}),l.showHighScores&&!l.isPlaying&&wn.jsxs("div",{className:"absolute inset-0 bg-black z-40 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[wn.jsx("span",{className:"text-accent-primary font-bold text-[10px] uppercase tracking-wider",children:"Fasttracker Nibbles Highscore"}),wn.jsx("button",{onClick:e=>{e.stopPropagation(),G(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),wn.jsx("div",{className:"flex-1 flex flex-col gap-1 mt-1",children:0===x.length?wn.jsx("div",{className:"text-center text-text-muted py-4 text-[9px] uppercase font-mono",children:"No high scores yet!"}):wn.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto] gap-x-4 gap-y-1",children:[wn.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30",children:"Player"}),wn.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Score"}),wn.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Lvl"}),x.map((t,n)=>wn.jsxs(e.Fragment,{children:[wn.jsx("div",{className:"text-text-primary text-[9px] truncate font-mono",children:t.name}),wn.jsx("div",{className:"text-accent-secondary text-[9px] font-mono text-right",children:t.score.toLocaleString()}),wn.jsx("div",{className:"text-text-secondary text-[9px] font-mono text-right",children:t.level})]},t.id||n))]})}),wn.jsx("button",{onClick:async e=>{e.stopPropagation(),confirm("Are you sure you want to clear all high scores?")&&(await yC.clearAll(),K())},className:"text-red-500/50 hover:text-red-500 uppercase text-[8px] font-mono mt-auto pt-2",children:"Clear All"})]}),l.showMenu&&!l.isPlaying&&wn.jsxs("div",{className:"absolute inset-0 bg-black z-30 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[wn.jsx("span",{className:"text-white font-bold text-[10px] uppercase",children:"Options"}),wn.jsx("button",{onClick:e=>{e.stopPropagation(),U(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),wn.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[9px] font-mono uppercase text-text-secondary",children:[wn.jsxs("div",{className:"flex flex-col gap-1",children:[wn.jsx("span",{children:"Speed:"}),wn.jsxs("select",{value:d,onChange:e=>{e.stopPropagation(),u(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[wn.jsx("option",{value:0,children:"Novice"}),wn.jsx("option",{value:1,children:"Average"}),wn.jsx("option",{value:2,children:"Pro"}),wn.jsx("option",{value:3,children:"Up Rough"})]})]}),wn.jsxs("div",{className:"flex flex-col gap-1",children:[wn.jsx("span",{children:"Players:"}),wn.jsxs("select",{value:p,onChange:e=>{e.stopPropagation(),h(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[wn.jsx("option",{value:1,children:"1 Player"}),wn.jsx("option",{value:2,children:"2 Players"})]})]})]}),wn.jsxs("div",{className:"flex flex-wrap gap-3 mt-1",children:[wn.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[wn.jsx("input",{type:"checkbox",checked:m,onChange:e=>{e.stopPropagation(),f(e.target.checked)},className:"accent-accent-primary"}),"Wrap"]}),wn.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[wn.jsx("input",{type:"checkbox",checked:y,onChange:e=>{e.stopPropagation(),g(e.target.checked)},className:"accent-accent-primary"}),"Grid"]}),wn.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[wn.jsx("input",{type:"checkbox",checked:v,onChange:e=>{e.stopPropagation(),b(e.target.checked)},className:"accent-accent-primary"}),"Surround"]})]})]})]})},kC=({height:e=100,text:t="*** GREETINGS FLIES OUT TO....     AEROSOL   AFRIKA   ANDROMEDA   ATE BIT   ATLANTIS   BLACK MAIDEN   BOOZE DESIGN   BOOZOHOLICS   BYTERAPERS   CENSOR DESIGN   DA JORMAS  DCS   DEKADENCE   DEPTH   DESIRE   DIVINE STYLERS   DUREX   ELCREW   ELUDE   EPHIDRENA   EPSILON DESIGN   FAIRLIGHT   FATZONE   FIT   FLUSH  FUNKTION   GENESIS PROJECT   HACK N TRADE   HAUJOBB   HARD BOYLING BOYS   HOAXERS   LFT  IMPURE ASCII 1940  INSANE   INSTINCT   IRIS  JOSSYSTEM   JUDAS   KESO   LA PAZ   LAXATIVE EFFECTS   LEMON  LOONIES     MAHONEY   MANKIND  MAWI   MOODS PLATEAU   NATURE  NONAMENO   NUKLEUS   OFFENCE  ONSALA SECTOR     ONSLAUGHT   OUTBREAK   OXYRON   PACIF!C   PANDA DESIGN   PARADOX   PERFOMERS   PLANET JAZZ   POWERLINE   RAZOR 1911   REALITY   RELAPSE  RNO   RESISTANCE SCARAB   SCENESAT   SCOOPEX   SHARE AND ENJOY   SHAPE   SIGFLUP   SPACEBALLS   STRUTS SUBSPACE   STYLE   THE ELECTRONIC KNIGHTS   THE BLACK LOTUS   THE GANG   TITAN   TPOLM   TRAKTOR   TRIAD   TRSI   TULOU   UK SCENE ALLSTARS   UNIQUE   UNSTABLE LABEL   Y-CREW   AND   ZENON ***"})=>{const n=s.useRef(null),a=s.useRef(void 0),r=s.useRef(0),[o,i]=s.useState(800),{bpm:l,isPlaying:c}=Ry();return s.useEffect(()=>{const e=n.current;if(!e)return;const t=e.parentElement;if(!t)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(t),()=>a.disconnect()},[]),s.useEffect(()=>{const s=n.current;if(!s)return;const i=s.getContext("2d");if(!i)return;const d=window.devicePixelRatio||1;s.width=o*d,s.height=e*d,i.scale(d,d);let u=!0;const p=[];for(let t=0;t<200;t++)p.push({x:(Math.random()-.5)*o*2,y:(Math.random()-.5)*e*2,z:1e3*Math.random(),speed:.5+1.5*Math.random()});const h=Math.min(.4*e,32),m=.6*h,f=.2*e,y=2*(c?l/125:1);let g=0,v=1,b=0;const x=(t+"     ").repeat(5),w=()=>{if(!u)return;const n=Hm().getWaveform();let s=0;if(n&&n.length>0&&c){const e=Math.sqrt(n.reduce((e,t)=>e+t*t,0)/n.length);s=Math.min(1,10*e)}b+=.15*(s-b),i.fillStyle="#0a0a0b",i.fillRect(0,0,o,e);const l=o/2,d=e/2;for(const t of p){t.z-=t.speed*(1+1*b),t.z<=0&&(t.x=(Math.random()-.5)*o*2,t.y=(Math.random()-.5)*e*2,t.z=1e3);const n=200/t.z,a=l+t.x*n,s=d+t.y*n;if(a<0||a>o||s<0||s>e)continue;const r=Math.max(1,3*(1-t.z/1e3)),c=Math.floor(255*(1-t.z/1e3));i.fillStyle=`rgb(${.8*c}, ${.9*c}, ${c})`,i.beginPath(),i.arc(a,s,r,0,2*Math.PI),i.fill()}const k=Date.now()/1e3;v=1+.8*b,g=Math.sin(.5*k*v)*e*.3;const S=f;r.current+=y,r.current>m*(t.length+5)&&(r.current=0),i.font=`bold ${h}px monospace`,i.textBaseline="middle";for(let t=0;t<x.length;t++){const n=x[t];if(" "===n)continue;const a=o+t*m-r.current;if(a<-m||a>o+m)continue;const s=.035*(r.current+t*m),l=e/2+Math.sin(s)*S,c=i.createLinearGradient(0,g,0,e+g),d=30*k*v%360;c.addColorStop(0,`hsl(${d}, 100%, 60%)`),c.addColorStop(.25,`hsl(${(d+60)%360}, 100%, 70%)`),c.addColorStop(.5,`hsl(${(d+120)%360}, 100%, 70%)`),c.addColorStop(.75,`hsl(${(d+180)%360}, 100%, 70%)`),c.addColorStop(1,`hsl(${(d+240)%360}, 100%, 60%)`);const u=(d+.3*a)%360,p=10+8*b;i.shadowColor=`hsla(${u}, 100%, 50%, ${.5+.3*b})`,i.shadowBlur=p,i.fillStyle=c,i.fillText(n,a,l),i.shadowBlur=0,i.strokeStyle="rgba(0, 0, 0, 0.6)",i.lineWidth=2,i.strokeText(n,a,l)}a.current=requestAnimationFrame(w)};return w(),()=>{u=!1,a.current&&cancelAnimationFrame(a.current)}},[o,e,t]),wn.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:wn.jsx("canvas",{ref:n,style:{width:`${o}px`,height:`${e}px`}})})},SC=e.memo(({label:e,value:t,onChange:n,color:a="#00d4aa",size:s="md",disabled:r=!1,title:o})=>{const i="cyan-lineart"===Zy(e=>e.currentThemeId),l=i?"#00ffff":a,c=i?"#0a1a1f":"#1a1a1f",d=i?"#0a3333":"#333",u=i?"#0a6666":"#666",{width:p,height:h,fontSize:m}={sm:{width:36,height:18,fontSize:9},md:{width:44,height:22,fontSize:10}}[s];return wn.jsxs("div",{className:"toggle-container",style:{width:p+10,opacity:r?.4:1},children:[wn.jsx("div",{className:"toggle-label",style:{fontSize:m-1},children:e}),wn.jsx("button",{className:"toggle-switch "+(t?"toggle-on":"toggle-off"),onClick:()=>!r&&n(!t),disabled:r,title:o,style:{width:p,height:h,borderRadius:h/2,backgroundColor:t?l:c,border:`2px solid ${t?l:d}`,cursor:r?"not-allowed":"pointer"},children:wn.jsx("div",{className:"toggle-thumb",style:{width:h-6,height:h-6,borderRadius:"50%",backgroundColor:t?"#fff":u,transform:`translateX(${t?p-h+2:0}px)`,transition:"transform 0.15s ease-out, background-color 0.15s",boxShadow:t?`0 0 6px ${l}`:"none"}})})]})},(e,t)=>e.value===t.value&&e.label===t.label&&e.disabled===t.disabled&&e.color===t.color&&e.size===t.size);SC.displayName="Toggle";const MC=({onClose:e})=>{const{useHexNumbers:t,setUseHexNumbers:n,blankEmptyCells:a,setBlankEmptyCells:r,tb303Collapsed:o,setTB303Collapsed:i,oscilloscopeVisible:l,setOscilloscopeVisible:c,compactToolbar:d,setCompactToolbar:u}=Ay(),{currentThemeId:p,setTheme:h}=Zy(),{amigaLimits:m,setAmigaLimits:f,linearInterpolation:y,setLinearInterpolation:g,audioLatency:v,setAudioLatency:b,autoLatency:x,setAutoLatency:w,midiPolyphonic:k,setMidiPolyphonic:S}=Wm(),[M,N]=s.useState(!!document.fullscreenElement);s.useEffect(()=>{const e=()=>{N(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);return wn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:wn.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-lg shadow-xl",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[wn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-wide",children:"SETTINGS"}),wn.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none","aria-label":"Close",children:wn.jsx(Ee,{size:16})})]}),wn.jsxs("div",{className:"p-4 space-y-6 max-h-[70vh] overflow-y-auto scrollbar-ft2",children:[wn.jsxs("section",{children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DISPLAY"}),wn.jsxs("div",{className:"space-y-3",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Theme:"}),wn.jsx("select",{value:p,onChange:e=>h(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:Xy.map(e=>wn.jsx("option",{value:e.id,className:"bg-ft2-bg text-ft2-text",children:e.name},e.id))})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Number Format:"}),wn.jsxs("select",{value:t?"hex":"dec",onChange:e=>n("hex"===e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[wn.jsx("option",{value:"hex",className:"bg-ft2-bg text-ft2-text",children:"Hexadecimal (01, 02, 0A, 0F)"}),wn.jsx("option",{value:"dec",className:"bg-ft2-bg text-ft2-text",children:"Decimal (01, 02, 10, 15)"})]})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Blank Empty Cells:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Hide ---, .., ... on empty rows"})]}),wn.jsx(SC,{label:"",value:a,onChange:r,size:"sm"})]})]})]}),wn.jsxs("section",{children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"LAYOUT"}),wn.jsxs("div",{className:"space-y-3",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"TB-303 Panel:"}),wn.jsx(SC,{label:"",value:!o,onChange:e=>i(!e),size:"sm"})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Oscilloscope:"}),wn.jsx(SC,{label:"",value:l,onChange:c,size:"sm"})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Compact Toolbar:"}),wn.jsx(SC,{label:"",value:d,onChange:u,size:"sm"})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx(At,{size:14,className:"text-ft2-textDim"}),wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Fullscreen:"})]}),wn.jsx(SC,{label:"",value:M,onChange:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},size:"sm"})]})]})]}),wn.jsxs("section",{children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"MIDI"}),wn.jsx("div",{className:"space-y-3",children:wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Polyphonic Mode:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Play multiple notes simultaneously"})]}),wn.jsx(SC,{label:"",value:k,onChange:S,size:"sm"})]})})]}),wn.jsxs("section",{children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"ENGINE"}),wn.jsxs("div",{className:"space-y-3",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Amiga Limits:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Clamp periods to 113-856"})]}),wn.jsx(SC,{label:"",value:m,onChange:f,size:"sm"})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Sample Interpolation:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Linear (clean) vs None (crunchy)"})]}),wn.jsx(SC,{label:"",value:y,onChange:g,size:"sm"})]}),wn.jsxs("div",{className:"flex items-center justify-between border-t border-ft2-border/30 pt-3",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Audio Latency Mode:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Low latency for live jamming vs stable playback"})]}),wn.jsxs("select",{value:v,onChange:e=>b(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[wn.jsx("option",{value:"interactive",children:"Interactive (10ms)"}),wn.jsx("option",{value:"balanced",children:"Balanced (50ms)"}),wn.jsx("option",{value:"playback",children:"Stable (150ms)"})]})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Dynamic Latency:"}),wn.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Instant (10ms) when stopped, stable when playing"})]}),wn.jsx(SC,{label:"",value:x,onChange:w,size:"sm"})]})]})]}),wn.jsx("section",{className:"pt-4 border-t border-ft2-border",children:wn.jsxs("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1",children:[wn.jsx("div",{children:"DEViLBOX v1.0.0"}),wn.jsx("div",{children:"TB-303 Acid Tracker"}),wn.jsx("div",{className:"text-ft2-highlight",children:"Settings are saved automatically"})]})})]}),wn.jsx("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-end",children:wn.jsx("button",{onClick:e,className:"px-4 py-1.5 bg-ft2-cursor border border-ft2-cursor text-ft2-bg text-xs font-bold hover:bg-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none",children:"CLOSE"})})]})})},NC=({onClose:e})=>{const{swing:t,setSwing:n,grooveSteps:a,setGrooveSteps:s,jitter:r,setJitter:o,useMpcScale:i,setUseMpcScale:l,grooveTemplateId:c,setGrooveTemplate:d}=Ry();return wn.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 backdrop-blur-sm",children:wn.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[wn.jsx("div",{className:"flex items-center gap-2",children:wn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-widest uppercase",children:"Groove & Swing Settings"})}),wn.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none",children:wn.jsx(Ee,{size:18})})]}),wn.jsxs("div",{className:"flex-1 overflow-hidden p-0 flex flex-col md:flex-row min-h-0",children:[wn.jsx("div",{className:"w-full md:w-72 flex flex-col bg-dark-bgSecondary border-r border-ft2-border min-h-0",children:wn.jsxs("section",{className:"flex flex-col flex-1 min-h-0 p-6",children:[wn.jsx("h3",{className:"flex-shrink-0 text-ft2-highlight text-xs font-bold mb-4 tracking-wider uppercase flex items-center gap-2",children:"Groove Templates"}),wn.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-ft2 space-y-4",children:["straight","shuffle","swing","funk","hip-hop","custom"].map(e=>{const t=Ba.filter(t=>t.category===e);return 0===t.length?null:wn.jsxs("div",{className:"space-y-1",children:[wn.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase px-1 pb-1 border-b border-dark-border",children:e}),wn.jsx("div",{className:"grid grid-cols-1 gap-1 pt-1",children:t.map(e=>wn.jsxs("button",{onClick:()=>d(e.id),className:"w-full text-left px-3 py-2 text-xs font-mono transition-all rounded "+(e.id===c?"bg-accent-primary text-white font-bold shadow-glow-sm":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary bg-dark-bgSecondary border border-transparent hover:border-ft2-border"),children:[wn.jsxs("div",{className:"flex justify-between items-center",children:[wn.jsx("span",{children:e.name}),e.id===c&&wn.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]}),e.description&&wn.jsx("div",{className:"text-[10px] mt-0.5 leading-tight "+(e.id===c?"text-white":"opacity-60"),children:e.description})]},e.id))})]},e)})})]})}),wn.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-ft2 p-6 space-y-8 min-h-0",children:[wn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Global Intensity"}),wn.jsx("div",{className:"flex items-center gap-2",children:wn.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer group bg-dark-bgTertiary px-2 py-1 rounded border border-ft2-border hover:border-accent-primary transition-colors",title:"Use authentic MPC 50-75% scale",children:[wn.jsx("input",{type:"checkbox",checked:i,onChange:e=>l(e.target.checked),className:"w-3 h-3 accent-accent-primary"}),wn.jsx("span",{className:"text-[10px] text-text-muted group-hover:text-text-secondary font-bold uppercase",children:"MPC SCALE"})]})})]}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsxs("div",{className:"flex justify-between items-end",children:[wn.jsx("span",{className:"text-[10px] text-text-secondary font-mono uppercase",children:"Groove Amount"}),wn.jsx("span",{className:"text-xl font-mono text-accent-primary font-bold leading-none",children:i?t:`${t}%`})]}),wn.jsx("input",{type:"range",min:i?50:0,max:i?75:200,value:t,onChange:e=>n(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),n(i?50:100)},className:"w-full h-2 accent-accent-primary cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),wn.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[wn.jsx("span",{children:i?"50%":"Fixed"}),wn.jsx("span",{children:i?"66%":"100%"}),wn.jsx("span",{children:i?"75%":"200%"})]}),wn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:i?"Authentic MPC timing. 66% is the perfect triplet ratio. Right-click to reset.":"Scales template intensity. 100% is standard. Right-click to reset."})]})]}),wn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[wn.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Swing Resolution"}),wn.jsx("div",{className:"grid grid-cols-3 gap-2",children:[2,4,8,16,32,64].map(e=>wn.jsxs("button",{onClick:()=>{s(e),"straight"!==c&&d("straight")},className:"px-2 py-2 text-[10px] font-mono border rounded transition-all "+(a===e&&"straight"===c?"bg-accent-primary border-accent-primary text-white font-bold":"bg-dark-bgTertiary border-ft2-border text-text-secondary hover:border-text-muted"),children:[2===e?"16th":4===e?"8th":8===e?"4th":e/16+"b",wn.jsxs("div",{className:"text-[8px] opacity-60",children:["(",e," stp)"]})]},e))}),wn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed",children:"Determines which notes in the pattern cycle are swung. 16th is standard for electronic music."})]}),wn.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("h3",{className:"text-cyan-400 text-xs font-bold tracking-wider uppercase",children:"Humanization (Jitter)"}),wn.jsxs("span",{className:"text-lg font-mono text-cyan-400 font-bold leading-none",children:[r,"%"]})]}),wn.jsxs("div",{className:"space-y-2",children:[wn.jsx("input",{type:"range",min:"0",max:"100",value:r,onChange:e=>o(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),o(0)},className:"w-full h-2 accent-cyan-500 cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),wn.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[wn.jsx("span",{children:"Robotic"}),wn.jsx("span",{children:"Loose"}),wn.jsx("span",{children:"Drunken"})]}),wn.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:"Adds random micro-timing offsets (0-10ms) to every note. Simulates unstable vintage clocks or human performance."})]})]})]})]}),wn.jsxs("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-between items-center",children:[wn.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[wn.jsx(Tt,{size:12,className:"text-ft2-highlight"}),wn.jsx("span",{children:"Groove affects all patterns globally"})]}),wn.jsx("button",{onClick:e,className:"px-6 py-1.5 bg-accent-primary border border-accent-primary text-white text-xs font-bold hover:bg-accent-secondary hover:border-accent-secondary transition-all rounded shadow-glow-sm focus:outline-none uppercase tracking-widest",children:"Accept"})]})]})})};e.createContext,s.createContext();const CC=e=>"string"==typeof e,EC=()=>{let e,t;const n=new Promise((n,a)=>{e=n,t=a});return n.resolve=e,n.reject=t,n},PC=e=>null==e?"":""+e,TC=/###/g,AC=e=>e&&e.indexOf("###")>-1?e.replace(TC,"."):e,_C=e=>!e||CC(e),IC=(e,t,n)=>{const a=CC(t)?t.split("."):t;let s=0;for(;s<a.length-1;){if(_C(e))return{};const t=AC(a[s]);!e[t]&&n&&(e[t]=new n),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return _C(e)?{}:{obj:e,k:AC(a[s])}},DC=(e,t,n)=>{const{obj:a,k:s}=IC(e,t,Object);if(void 0!==a||1===t.length)return void(a[s]=n);let r=t[t.length-1],o=t.slice(0,t.length-1),i=IC(e,o,Object);for(;void 0===i.obj&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),i=IC(e,o,Object),null!=i&&i.obj&&typeof i.obj[`${i.k}.${r}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${r}`]=n},OC=(e,t)=>{const{obj:n,k:a}=IC(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,a))return n[a]},FC=(e,t,n)=>{for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?CC(e[a])||e[a]instanceof String||CC(t[a])||t[a]instanceof String?n&&(e[a]=t[a]):FC(e[a],t[a],n):e[a]=t[a]);return e},RC=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var jC={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const LC=e=>CC(e)?e.replace(/[&<>"'\/]/g,e=>jC[e]):e;const BC=[" ",",","?","!",";"],VC=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const n=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,n),this.regExpQueue.push(e),n}}(20),zC=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const a=t.split(n);let s=e;for(let r=0;r<a.length;){if(!s||"object"!=typeof s)return;let e,t="";for(let o=r;o<a.length;++o)if(o!==r&&(t+=n),t+=a[o],e=s[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&o<a.length-1)continue;r+=o-r+1;break}s=e}return s},UC=e=>null==e?void 0:e.replace("_","-"),GC={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,a;null==(a=null==(n=null==console?void 0:console[e])?void 0:n.apply)||a.call(n,console,t)}};class WC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||GC,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,n,a){return a&&!this.debug?null:(CC(e[0])&&(e[0]=`${n}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new WC(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new WC(this.logger,e)}}var KC=new WC;class HC{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const n=this.observers[e].get(t)||0;this.observers[e].set(t,n+1)}),this}off(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,a]=e;for(let s=0;s<a;s++)t(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[a,s]=t;for(let r=0;r<s;r++)a.apply(a,[e,...n])})}}class $C extends HC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,n){var a,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,i=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],n&&(Array.isArray(n)?l.push(...n):CC(n)&&o?l.push(...n.split(o)):l.push(n)));const c=OC(this.data,l);return!c&&!t&&!n&&e.indexOf(".")>-1&&(e=l[0],t=l[1],n=l.slice(2).join(".")),!c&&i&&CC(n)?zC(null==(s=null==(a=this.data)?void 0:a[e])?void 0:s[t],n,o):c}addResource(e,t,n,a){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const r=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator;let o=[e,t];n&&(o=o.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(o=e.split("."),a=t,t=o[1]),this.addNamespaces(t),DC(this.data,o,a),s.silent||this.emit("added",e,t,n,a)}addResources(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const s in n)(CC(n[s])||Array.isArray(n[s]))&&this.addResource(e,t,s,n[s],{silent:!0});a.silent||this.emit("added",e,t,n)}addResourceBundle(e,t,n,a,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),a=n,n=t,t=o[1]),this.addNamespaces(t);let i=OC(this.data,o)||{};r.skipCopy||(n=JSON.parse(JSON.stringify(n))),a?FC(i,n,s):i={...i,...n},DC(this.data,o,i),r.silent||this.emit("added",e,t,n)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var qC={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,a,s){return e.forEach(e=>{var r;t=(null==(r=this.processors[e])?void 0:r.process(t,n,a,s))??t}),t}};const YC={},XC=e=>!CC(e)&&"boolean"!=typeof e&&"number"!=typeof e;class QC extends HC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),((e,t,n)=>{e.forEach(e=>{t[e]&&(n[e]=t[e])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=KC.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const n=this.resolve(e,t);return void 0!==(null==n?void 0:n.res)}extractFromKey(e,t){let n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const r=n&&e.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,n)=>{t=t||"",n=n||"";const a=BC.filter(e=>t.indexOf(e)<0&&n.indexOf(e)<0);if(0===a.length)return!0;const s=VC.getRegExp(`(${a.map(e=>"?"===e?"\\?":e).join("|")})`);let r=!s.test(e);if(!r){const t=e.indexOf(n);t>0&&!s.test(e.substring(0,t))&&(r=!0)}return r})(e,n,a));if(r&&!o){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:CC(s)?[s]:s};const r=e.split(n);(n!==a||n===a&&this.options.ns.indexOf(r[0])>-1)&&(s=r.shift()),e=r.join(a)}return{key:e,namespaces:CC(s)?[s]:s}}translate(e,t,n){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof options&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:r,namespaces:o}=this.extractFromKey(e[e.length-1],t),i=o[o.length-1],l=t.lng||this.language,c=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===(null==l?void 0:l.toLowerCase())){if(c){const e=t.nsSeparator||this.options.nsSeparator;return a?{res:`${i}${e}${r}`,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:i,usedParams:this.getUsedParamsDetails(t)}:`${i}${e}${r}`}return a?{res:r,usedKey:r,exactUsedKey:r,usedLng:l,usedNS:i,usedParams:this.getUsedParamsDetails(t)}:r}const d=this.resolve(e,t);let u=null==d?void 0:d.res;const p=(null==d?void 0:d.usedKey)||r,h=(null==d?void 0:d.exactUsedKey)||r,m=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,f=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==t.count&&!CC(t.count),g=QC.hasDefaultValue(t),v=y?this.pluralResolver.getSuffix(l,t.count,t):"",b=t.ordinal&&y?this.pluralResolver.getSuffix(l,t.count,{ordinal:!1}):"",x=y&&!t.ordinal&&0===t.count,w=x&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${v}`]||t[`defaultValue${b}`]||t.defaultValue;let k=u;f&&!u&&g&&(k=w);const S=XC(k),M=Object.prototype.toString.apply(k);if(!(f&&k&&S&&["[object Number]","[object Function]","[object RegExp]"].indexOf(M)<0)||CC(m)&&Array.isArray(k))if(f&&CC(m)&&Array.isArray(u))u=u.join(m),u&&(u=this.extendTranslation(u,e,t,n));else{let a=!1,o=!1;!this.isValidLookup(u)&&g&&(a=!0,u=w),this.isValidLookup(u)||(o=!0,u=r);const c=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&o?void 0:u,p=g&&w!==u&&this.options.updateMissing;if(o||a||p){if(this.logger.log(p?"updateKey":"missingKey",l,i,r,p?w:u),s){const e=this.resolve(r,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const n=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&n&&n[0])for(let t=0;t<n.length;t++)e.push(n[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const a=(e,n,a)=>{var s;const r=g&&a!==u?a:c;this.options.missingKeyHandler?this.options.missingKeyHandler(e,i,n,r,p,t):null!=(s=this.backendConnector)&&s.saveMissing&&this.backendConnector.saveMissing(e,i,n,r,p,t),this.emit("missingKey",e,i,n,u)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{const n=this.pluralResolver.getSuffixes(e,t);x&&t[`defaultValue${this.options.pluralSeparator}zero`]&&n.indexOf(`${this.options.pluralSeparator}zero`)<0&&n.push(`${this.options.pluralSeparator}zero`),n.forEach(n=>{a([e],r+n,t[`defaultValue${n}`]||w)})}):a(e,r,w))}u=this.extendTranslation(u,e,t,d,n),o&&u===r&&this.options.appendNamespaceToMissingKey&&(u=`${i}:${r}`),(o||a)&&this.options.parseMissingKeyHandler&&(u=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${i}:${r}`:r,a?u:void 0))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,k,{...t,ns:o}):`key '${r} (${this.language})' returned an object instead of string.`;return a?(d.res=e,d.usedParams=this.getUsedParamsDetails(t),d):e}if(s){const e=Array.isArray(k),n=e?[]:{},a=e?h:p;for(const r in k)if(Object.prototype.hasOwnProperty.call(k,r)){const e=`${a}${s}${r}`;n[r]=g&&!u?this.translate(e,{...t,defaultValue:XC(w)?w[r]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...t,joinArrays:!1,ns:o}),n[r]===e&&(n[r]=k[r])}u=n}}return a?(d.res=u,d.usedParams=this.getUsedParamsDetails(t),d):u}extendTranslation(e,t,n,a,s){var r,o,i=this;if(null!=(r=this.i18nFormat)&&r.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const r=CC(e)&&(void 0!==(null==(o=null==n?void 0:n.interpolation)?void 0:o.skipOnVariables)?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(r){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=n.replace&&!CC(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,n.lng||this.language||a.usedLng,n),r){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(n.nest=!1)}!n.lng&&a&&a.res&&(n.lng=this.language||a.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(null==s?void 0:s[0])!==a[0]||n.context?i.translate(...a,t):(i.logger.warn(`It seems you are nesting recursively key: ${a[0]} in key: ${t[0]}`),null)},n)),n.interpolation&&this.interpolator.reset()}const l=n.postProcess||this.options.postProcess,c=CC(l)?[l]:l;return null!=e&&null!=c&&c.length&&!1!==n.applyPostProcessor&&(e=qC.handle(c,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),e}resolve(e){let t,n,a,s,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return CC(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const i=this.extractFromKey(e,o),l=i.key;n=l;let c=i.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==o.count&&!CC(o.count),u=d&&!o.ordinal&&0===o.count,p=void 0!==o.context&&(CC(o.context)||"number"==typeof o.context)&&""!==o.context,h=o.lngs?o.lngs:this.languageUtils.toResolveHierarchy(o.lng||this.language,o.fallbackLng);c.forEach(e=>{var i,c;this.isValidLookup(t)||(r=e,!YC[`${h[0]}-${e}`]&&null!=(i=this.utils)&&i.hasLoadedNamespace&&!(null!=(c=this.utils)&&c.hasLoadedNamespace(r))&&(YC[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${n}" for languages "${h.join(", ")}" won't get resolved as namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(n=>{var r;if(this.isValidLookup(t))return;s=n;const i=[l];if(null!=(r=this.i18nFormat)&&r.addLookupKeys)this.i18nFormat.addLookupKeys(i,l,n,e,o);else{let e;d&&(e=this.pluralResolver.getSuffix(n,o.count,o));const t=`${this.options.pluralSeparator}zero`,a=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(i.push(l+e),o.ordinal&&0===e.indexOf(a)&&i.push(l+e.replace(a,this.options.pluralSeparator)),u&&i.push(l+t)),p){const n=`${l}${this.options.contextSeparator}${o.context}`;i.push(n),d&&(i.push(n+e),o.ordinal&&0===e.indexOf(a)&&i.push(n+e.replace(a,this.options.pluralSeparator)),u&&i.push(n+t))}}let c;for(;c=i.pop();)this.isValidLookup(t)||(a=c,t=this.getResource(n,e,c,o))}))})}),{res:t,usedKey:n,exactUsedKey:a,usedLng:s,usedNS:r}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,n){var a;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null!=(a=this.i18nFormat)&&a.getResource?this.i18nFormat.getResource(e,t,n,s):this.resourceStore.getResource(e,t,n,s)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=e.replace&&!CC(e.replace);let a=n?e.replace:e;if(n&&typeof e.count<"u"&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!n){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){const t="defaultValue";for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}class ZC{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=KC.create("languageUtils")}getScriptPartFromCode(e){if(!(e=UC(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(!(e=UC(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(CC(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const n=this.formatLanguageCode(e);(!this.options.supportedLngs||this.isSupportedCode(n))&&(t=n)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const n=this.getScriptPartFromCode(e);if(this.isSupportedCode(n))return t=n;const a=this.getLanguagePartFromCode(e);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(e=>e===a?e:e.indexOf("-")<0&&a.indexOf("-")<0||!(e.indexOf("-")>0&&a.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===a||0===e.indexOf(a)&&a.length>1)?void 0:e)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),CC(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}toResolveHierarchy(e,t){const n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],s=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return CC(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):CC(e)&&s(this.formatLanguageCode(e)),n.forEach(e=>{a.indexOf(e)<0&&s(this.formatLanguageCode(e))}),a}}const JC={zero:0,one:1,two:2,few:3,many:4,other:5},eE={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class tE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=KC.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=UC("dev"===e?"en":e),a=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:n,type:a});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let r;try{r=new Intl.PluralRules(n,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),eE;if(!e.match(/-|_/))return eE;const n=this.languageUtils.getLanguagePartFromCode(e);r=this.getRule(n,t)}return this.pluralRulesCache[s]=r,r}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),(null==n?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return n||(n=this.getRule("dev",t)),n?n.resolvedOptions().pluralCategories.sort((e,t)=>JC[e]-JC[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=this.getRule(e,n);return a?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,n))}}const nE=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=((e,t,n)=>{const a=OC(e,n);return void 0!==a?a:OC(t,n)})(e,t,n);return!r&&s&&CC(n)&&(r=zC(e,n,a),void 0===r&&(r=zC(t,n,a))),r},aE=e=>e.replace(/\$/g,"$$$$");class sE{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=KC.create("interpolator"),this.options=t,this.format=(null==(e=null==t?void 0:t.interpolation)?void 0:e.format)||(e=>e),this.init(t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:n,useRawValueToEscape:a,prefix:s,prefixEscaped:r,suffix:o,suffixEscaped:i,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:u,nestingPrefixEscaped:p,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:f,maxReplaces:y,alwaysFormat:g}=e.interpolation;this.escape=void 0!==t?t:LC,this.escapeValue=void 0===n||n,this.useRawValueToEscape=void 0!==a&&a,this.prefix=s?RC(s):r||"{{",this.suffix=o?RC(o):i||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=u?RC(u):p||RC("$t("),this.nestingSuffix=h?RC(h):m||RC(")"),this.nestingOptionsSeparator=f||",",this.maxReplaces=y||1e3,this.alwaysFormat=void 0!==g&&g,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>(null==e?void 0:e.source)===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,n,a){var s;let r,o,i;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=e=>{if(e.indexOf(this.formatSeparator)<0){const s=nE(t,l,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(s,void 0,n,{...a,...t,interpolationkey:e}):s}const s=e.split(this.formatSeparator),r=s.shift().trim(),o=s.join(this.formatSeparator).trim();return this.format(nE(t,l,r,this.options.keySeparator,this.options.ignoreJSONStructure),o,n,{...a,...t,interpolationkey:r})};this.resetRegExp();const d=(null==a?void 0:a.missingInterpolationHandler)||this.options.missingInterpolationHandler,u=void 0!==(null==(s=null==a?void 0:a.interpolation)?void 0:s.skipOnVariables)?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>aE(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?aE(this.escape(e)):aE(e)}].forEach(t=>{for(i=0;r=t.regex.exec(e);){const n=r[1].trim();if(o=c(n),void 0===o)if("function"==typeof d){const t=d(e,r,a);o=CC(t)?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,n))o="";else{if(u){o=r[0];continue}this.logger.warn(`missed to pass in variable ${n} for interpolating ${e}`),o=""}else!CC(o)&&!this.useRawValueToEscape&&(o=PC(o));const s=t.safeValue(o);if(e=e.replace(r[0],s),u?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),e}nest(e,t){let n,a,s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=(e,t)=>{const n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;const a=e.split(new RegExp(`${n}[ ]*{`));let r=`{${a[1]}`;e=a[0],r=this.interpolate(r,s);const o=r.match(/'/g),i=r.match(/"/g);(((null==o?void 0:o.length)??0)%2==0&&!i||i.length%2!=0)&&(r=r.replace(/'/g,'"'));try{s=JSON.parse(r),t&&(s={...t,...s})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${n}${r}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,e};for(;n=this.nestingRegexp.exec(e);){let i=[];s={...r},s=s.replace&&!CC(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){const e=n[1].split(this.formatSeparator).map(e=>e.trim());n[1]=e.shift(),i=e,l=!0}if(a=t(o.call(this,n[1].trim(),s),s),a&&n[0]===e&&!CC(a))return a;CC(a)||(a=PC(a)),a||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),a=""),l&&(a=i.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:n[1].trim()}),a.trim())),e=e.replace(n[0],a),this.regexp.lastIndex=0}return e}}const rE=e=>{const t={};return(n,a,s)=>{let r=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(r={...r,[s.interpolationkey]:void 0});const o=a+JSON.stringify(r);let i=t[o];return i||(i=e(UC(a),s),t[o]=i),i(n)}};class oE{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=KC.create("formatter"),this.options=e,this.formats={number:rE((e,t)=>{const n=new Intl.NumberFormat(e,{...t});return e=>n.format(e)}),currency:rE((e,t)=>{const n=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>n.format(e)}),datetime:rE((e,t)=>{const n=new Intl.DateTimeFormat(e,{...t});return e=>n.format(e)}),relativetime:rE((e,t)=>{const n=new Intl.RelativeTimeFormat(e,{...t});return e=>n.format(e,t.range||"day")}),list:rE((e,t)=>{const n=new Intl.ListFormat(e,{...t});return e=>n.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=rE(t)}format(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(e=>e.indexOf(")")>-1)){const e=s.findIndex(e=>e.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,e)].join(this.formatSeparator)}return s.reduce((e,t)=>{var s;const{formatName:r,formatOptions:o}=(e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const s=a[1].substring(0,a[1].length-1);"currency"===t&&s.indexOf(":")<0?n.currency||(n.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?n.range||(n.range=s.trim()):s.split(";").forEach(e=>{if(e){const[t,...a]=e.split(":"),s=a.join(":").trim().replace(/^'+|'+$/g,""),r=t.trim();n[r]||(n[r]=s),"false"===s&&(n[r]=!1),"true"===s&&(n[r]=!0),isNaN(s)||(n[r]=parseInt(s,10))}})}return{formatName:t,formatOptions:n}})(t);if(this.formats[r]){let t=e;try{const i=(null==(s=null==a?void 0:a.formatParams)?void 0:s[a.interpolationkey])||{},l=i.locale||i.lng||a.locale||a.lng||n;t=this.formats[r](e,l,{...o,...a,...i})}catch(i){this.logger.warn(i)}return t}return this.logger.warn(`there was no format function for ${r}`),e},e)}}class iE extends HC{constructor(e,t,n){var a,s;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=n,this.languageUtils=n.languageUtils,this.options=r,this.logger=KC.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],null==(s=null==(a=this.backend)?void 0:a.init)||s.call(a,n,r.backend,r)}queueLoad(e,t,n,a){const s={},r={},o={},i={};return e.forEach(e=>{let a=!0;t.forEach(t=>{const o=`${e}|${t}`;!n.reload&&this.store.hasResourceBundle(e,t)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===r[o]&&(r[o]=!0):(this.state[o]=1,a=!1,void 0===r[o]&&(r[o]=!0),void 0===s[o]&&(s[o]=!0),void 0===i[t]&&(i[t]=!0)))}),a||(o[e]=!0)}),(Object.keys(s).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(s),pending:Object.keys(r),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(i)}}loaded(e,t,n){const a=e.split("|"),s=a[0],r=a[1];t&&this.emit("failedLoading",s,r,t),!t&&n&&this.store.addResourceBundle(s,r,n,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&n&&(this.state[e]=0);const o={};this.queue.forEach(n=>{((e,t,n)=>{const{obj:a,k:s}=IC(e,t,Object);a[s]=a[s]||[],a[s].push(n)})(n.loaded,[s],r),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach(e=>{o[e]||(o[e]={});const t=n.loaded[e];t.length&&t.forEach(t=>{void 0===o[e][t]&&(o[e][t]=!0)})}),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(e=>!e.done)}read(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,r=arguments.length>5?arguments[5]:void 0;if(!e.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:a,wait:s,callback:r});this.readingCalls++;const o=(o,i)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}o&&i&&a<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,n,a+1,2*s,r)},s):r(o,i)},i=this.backend[n].bind(this.backend);if(2!==i.length)return i(e,t,o);try{const n=i(e,t);n&&"function"==typeof n.then?n.then(e=>o(null,e)).catch(o):o(null,n)}catch(l){o(l)}}prepareLoading(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();CC(e)&&(e=this.languageUtils.toResolveHierarchy(e)),CC(t)&&(t=[t]);const s=this.queueLoad(e,t,n,a);if(!s.toLoad.length)return s.pending.length||a(),null;s.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,n){this.prepareLoading(e,t,{},n)}reload(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.split("|"),a=n[0],s=n[1];this.read(a,s,"read",void 0,void 0,(n,r)=>{n&&this.logger.warn(`${t}loading namespace ${s} for language ${a} failed`,n),!n&&r&&this.logger.log(`${t}loaded namespace ${s} for language ${a}`,r),this.loaded(e,n,r)})}saveMissing(e,t,n,a,s){var r,o,i,l,c;let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(null==(o=null==(r=this.services)?void 0:r.utils)||!o.hasLoadedNamespace||null!=(l=null==(i=this.services)?void 0:i.utils)&&l.hasLoadedNamespace(t)){if(null!=n&&""!==n){if(null!=(c=this.backend)&&c.create){const r={...d,isUpdate:s},o=this.backend.create.bind(this.backend);if(o.length<6)try{let s;s=5===o.length?o(e,t,n,a,r):o(e,t,n,a),s&&"function"==typeof s.then?s.then(e=>u(null,e)).catch(u):u(null,s)}catch(p){u(p)}else o(e,t,n,a,u,r)}!e||!e[0]||this.store.addResource(e[0],t,n,a)}}else this.logger.warn(`did not save key "${n}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const lE=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),CC(e[1])&&(t.defaultValue=e[1]),CC(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const n=e[3]||e[2];Object.keys(n).forEach(e=>{t[e]=n[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),cE=e=>{var t,n;return CC(e.ns)&&(e.ns=[e.ns]),CC(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),CC(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),(null==(n=null==(t=e.supportedLngs)?void 0:t.indexOf)?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e},dE=()=>{};class uE extends HC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=cE(e),this.services={},this.logger=KC,this.modules={external:[]},n=this,Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(e=>{"function"==typeof n[e]&&(n[e]=n[e].bind(n))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}var n}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(n=t,t={}),null==t.defaultNS&&t.ns&&(CC(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const a=lE();this.options={...a,...this.options,...cE(t)},this.options.interpolation={...a.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?KC.init(s(this.modules.logger),this.options):KC.init(null,this.options),t=this.modules.formatter?this.modules.formatter:oE;const n=new ZC(this.options);this.store=new $C(this.options.resources,this.options);const r=this.services;r.logger=KC,r.resourceStore=this.store,r.languageUtils=n,r.pluralResolver=new tE(n,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),t&&(!this.options.interpolation.format||this.options.interpolation.format===a.interpolation.format)&&(r.formatter=s(t),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new sE(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new iE(s(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e.emit(t,...a)}),this.modules.languageDetector&&(r.languageDetector=s(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=s(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new QC(this.services,this.options),this.translator.on("*",function(t){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];e.emit(t,...a)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,n||(n=dE),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const r=EC(),o=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),r.resolve(t),n(e,t)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?o():setTimeout(o,0),r}loadResources(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dE;const s=CC(e)?e:this.language;if("function"==typeof e&&(a=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===(null==s?void 0:s.toLowerCase())&&(!this.options.preload||0===this.options.preload.length))return a();const e=[],r=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};s?r(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>r(e)),null==(n=null==(t=this.options.preload)?void 0:t.forEach)||n.call(t,e=>r(e)),this.services.backendConnector.load(e,this.options.ns,e=>{!e&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),a(e)})}else a(null)}reloadResources(e,t,n){const a=EC();return"function"==typeof e&&(n=e,e=void 0),"function"==typeof t&&(n=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),n||(n=dE),this.services.backendConnector.reload(e,t,e=>{a.resolve(),n(e)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&qC.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}}changeLanguage(e,t){var n=this;this.isLanguageChangingTo=e;const a=EC();this.emit("languageChanging",e);const s=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},r=(r,o)=>{o?this.isLanguageChangingTo===e&&(s(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,a.resolve(function(){return n.t(...arguments)}),t&&t(r,function(){return n.t(...arguments)})},o=t=>{var n,a;!e&&!t&&this.services.languageDetector&&(t=[]);const o=this.services.languageUtils.getBestMatchFromCodes(CC(t)?[t]:t);o&&(this.language||s(o),this.translator.language||this.translator.changeLanguage(o),null==(a=null==(n=this.services.languageDetector)?void 0:n.cacheUserLanguage)||a.call(n,o)),this.loadResources(o,e=>{r(e,o)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),a}getFixedT(e,t,n){var a=this;const s=function(e,t){let r;if("object"!=typeof t){for(var o=arguments.length,i=new Array(o>2?o-2:0),l=2;l<o;l++)i[l-2]=arguments[l];r=a.options.overloadTranslationOptionHandler([e,t].concat(i))}else r={...t};r.lng=r.lng||s.lng,r.lngs=r.lngs||s.lngs,r.ns=r.ns||s.ns,""!==r.keyPrefix&&(r.keyPrefix=r.keyPrefix||n||s.keyPrefix);const c=a.options.keySeparator||".";let d;return d=r.keyPrefix&&Array.isArray(e)?e.map(e=>`${r.keyPrefix}${c}${e}`):r.keyPrefix?`${r.keyPrefix}${c}${e}`:e,a.t(d,r)};return CC(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=n,s}t(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return null==(e=this.translator)?void 0:e.translate(...n)}exists(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return null==(e=this.translator)?void 0:e.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=t.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;const r=(e,t)=>{const n=this.services.backendConnector.state[`${e}|${t}`];return-1===n||0===n||2===n};if(t.precheck){const e=t.precheck(this,r);if(void 0!==e)return e}return!!(this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(n,e)&&(!a||r(s,e)))}loadNamespaces(e,t){const n=EC();return this.options.ns?(CC(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}loadLanguages(e,t){const n=EC();CC(e)&&(e=[e]);const a=this.options.preload||[],s=e.filter(e=>a.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return s.length?(this.options.preload=a.concat(s),this.loadResources(e=>{n.resolve(),t&&t(e)}),n):(t&&t(),Promise.resolve())}dir(e){var t,n;if(e||(e=this.resolvedLanguage||((null==(t=this.languages)?void 0:t.length)>0?this.languages[0]:this.language)),!e)return"rtl";const a=(null==(n=this.services)?void 0:n.languageUtils)||new ZC(lE());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(a.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new uE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dE;const n=e.forkResourceStore;n&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},s=new uE(a);if((void 0!==e.debug||void 0!==e.prefix)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(e=>{s[e]=this[e]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},n){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},Object.keys(e[t]).reduce((n,a)=>(n[a]={...e[t][a]},n),{})),{});s.store=new $C(e,a),s.services.resourceStore=s.store}return s.translator=new QC(s.services,a),s.translator.on("*",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];s.emit(e,...n)}),s.init(a,t),s.translator.options=a,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const pE=uE.createInstance();function hE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}pE.createInstance=uE.createInstance,pE.createInstance,pE.dir,pE.init,pE.loadResources,pE.reloadResources,pE.use,pE.changeLanguage,pE.getFixedT,pE.t,pE.exists,pE.setDefaultNamespace,pE.hasLoadedNamespace,pE.loadNamespaces,pE.loadLanguages,s.createContext(()=>e=>e),s.createContext(),s.createContext(),s.createContext(),s.createContext();var mE,fE,yE,gE,vE,bE={exports:{}};function xE(){if(fE)return mE;fE=1;return mE="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function wE(){if(gE)return yE;gE=1;var e=xE();function t(){}function n(){}return n.resetWarningCache=t,yE=function(){function a(t,n,a,s,r,o){if(o!==e){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function s(){return a}a.isRequired=a;var r={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:s,element:a,elementType:a,instanceOf:s,node:a,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:n,resetWarningCache:t};return r.PropTypes=r,r}}function kE(){return vE||(vE=1,bE.exports=wE()()),bE.exports}const SE=hE(kE());SE.bool.isRequired,SE.func.isRequired;const ME=(e,t,n)=>{const a=e[t];try{return void new URL(a)}catch{return new Error(`Invalid prop \`${t}\` supplied to \`${n}\`. Expected a valid URL but received \`${a}\`.`)}};SE.arrayOf(SE.shape({name:SE.string.isRequired,isDirectory:SE.bool.isRequired,path:SE.string.isRequired,updatedAt:(e,t,n)=>{const a=e[t];if(a&&isNaN(Date.parse(a)))return new Error(`Invalid prop \`${t}\` supplied to \`${n}\`. Expected a valid date string (ISO 8601) but received \`${a}\`.`)},size:SE.number})).isRequired,SE.shape({url:ME,headers:SE.objectOf(SE.string),method:SE.oneOf(["POST","PUT"])}),SE.bool,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.func,SE.oneOf(["grid","list"]),SE.number,SE.bool,SE.string,SE.oneOfType([SE.string,SE.number]),SE.oneOfType([SE.string,SE.number]),SE.string,SE.func,SE.string,SE.string,SE.string,SE.shape({create:SE.bool,upload:SE.bool,move:SE.bool,copy:SE.bool,rename:SE.bool,download:SE.bool,delete:SE.bool}),SE.bool,SE.bool,SE.string,SE.object,SE.func;const NE=()=>"showOpenFilePicker"in window&&"showDirectoryPicker"in window;let CE=null;function EE(){return CE}async function PE(e,t){const n=await e.createWritable();await n.write(t),await n.close()}const TE="http://localhost:3001";async function AE(e){const t=e.replace(/^\/+/,""),n=await fetch(`${TE}/api/files/${t}`);if(!n.ok)throw new Error(`Failed to read file: ${n.statusText}`);return n.arrayBuffer()}const _E=[".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx"],IE=[..._E,".sqs",".seq"];function DE(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return _E.includes(t)}const OE=({isOpen:e,onClose:t,onLoad:n,onLoadTrackerModule:a,mode:r,currentProjectData:o,suggestedFilename:i="untitled.dbx"})=>{const[l,c]=s.useState([]),[d,u]=s.useState(!1),[p,h]=s.useState(null),[m,f]=s.useState(null),[y,g]=s.useState(i),[v,b]=s.useState(!1),[x,w]=s.useState(!1),[k,S]=s.useState(""),[M,N]=s.useState(null);s.useEffect(()=>{e&&(()=>{const e=Vb(),t=NE()&&!!EE();b(e||t)})()},[e]);const C=s.useCallback(async()=>{u(!0),h(null);try{let t=[];if(Vb()&&window.electron?.fs){if(!M)return void u(!1);const e=M||k;if(e){t=(await window.electron.fs.readdir(e,[])).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),t.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}}else{if(!x){const e=await async function(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),n=await fetch(`${TE}/api/files/songs`,{method:"HEAD",signal:e.signal});return clearTimeout(t),n.ok}catch{return!1}}();w(e)}if(x)try{const e=k||"songs";t=(await async function(e){const t=e.replace(/^\/+/,""),n=await fetch(`${TE}/api/files/${t}`);if(!n.ok)throw new Error(`Failed to list directory: ${n.statusText}`);return(await n.json()).items||[]}(e)).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),t.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}catch(e){w(!1)}else{const e=EE();if(e){const n=await async function(e,t){const n=e||CE;if(!n)throw new Error("No directory handle available");const a=[];for await(const[s,r]of n.entries()){const e="directory"===r.kind;let o,i;if(!e&&t&&t.length>0){const e="."+s.split(".").pop()?.toLowerCase();if(!t.includes(e))continue}if(!e)try{const e=await r.getFile();o=e.size,i=new Date(e.lastModified)}catch{}a.push({name:s,path:`${n.name}/${s}`,isDirectory:e,size:o,modifiedAt:i,handle:r})}return a.sort((e,t)=>e.isDirectory!==t.isDirectory?e.isDirectory?-1:1:e.name.localeCompare(t.name)),a}(e,[]);t=n.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt,source:"filesystem",handle:e.handle}))}}}c(t)}catch(e){h(e instanceof Error?e.message:"Failed to load files")}finally{u(!1)}},[k,M,x]);s.useEffect(()=>{e&&C()},[e,C]);const E=async()=>{const e=await async function(){if(!NE())return null;try{const e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return CE=e,e}catch(p){if("AbortError"===p.name)return null;throw p}}();e&&b(!0)},P=async()=>{if(m){u(!0),h(null);try{if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return IE.includes(t)}(m.name)){if(!a)throw new Error("Binary file loading not supported");let e;if("filesystem"!==m.source)throw new Error("Cannot read tracker module");if(Vb()&&window.electron?.fs&&m.path)e=await window.electron.fs.readFile(m.path);else if(x&&m.path)e=await AE(m.path);else{if(!m.handle)throw new Error("Cannot read tracker module");{const t=await m.handle.getFile();e=await t.arrayBuffer()}}return await a(e,m.name),void t()}let e;const s=m.name.toLowerCase().endsWith(".xml");if(Vb()&&window.electron?.fs&&m.path){const t=await window.electron.fs.readFile(m.path),n=(new TextDecoder).decode(t);e=s?n:JSON.parse(n)}else if(x&&m.path){const t=await AE(m.path),n=(new TextDecoder).decode(t);e=s?n:JSON.parse(n)}else{if(!m.handle)throw new Error("Cannot read file");{const t=await async function(e){return(await e.getFile()).text()}(m.handle);e=s?t:JSON.parse(t)}}n(e,m.name),t()}catch(e){h(e instanceof Error?e.message:"Failed to load file")}finally{u(!1)}}},T=async e=>{if(confirm(`Delete "${e.name}"?`))try{const t=EE();t&&await async function(e,t){const n=t||CE;if(!n)throw new Error("No directory handle available");await n.removeEntry(e)}(e.name,t),C()}catch(t){h(t instanceof Error?t.message:"Failed to delete file")}};return e?wn.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:t,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[800px] max-w-[90vw] h-[600px] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[wn.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"load"===r?"Load Module":"Save Module"}),wn.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary","aria-label":"Close",children:wn.jsx(Ee,{size:18})})]}),wn.jsx("div",{className:"flex border-b border-dark-border",children:wn.jsx("button",{onClick:()=>v?null:E(),className:"px-4 py-2 text-sm font-medium "+(v?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-primary"),children:v?"Filesystem":"Open Folder..."})}),k&&wn.jsx("div",{className:"px-4 py-2 bg-dark-bgTertiary border-b border-dark-border",children:wn.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted font-mono truncate",children:[wn.jsx(Lt,{size:14})," ",k]})}),wn.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[p&&wn.jsx("div",{className:"bg-red-900/30 border border-red-500 text-red-300 px-4 py-2 rounded mb-4",children:p}),d?wn.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"Loading..."}):0===l.length?wn.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[wn.jsx("p",{className:"mb-4",children:"No files found"}),!Vb()&&!x&&!v&&wn.jsx("button",{onClick:E,className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Open Folder"}),Vb()&&!M&&wn.jsx("button",{onClick:async()=>{if(window.electron?.fs){const e=await window.electron.fs.openDirectory();e&&(N(e),S(e),C())}},className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Select Folder"})]}):wn.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[""!==k&&(Vb()||x)&&wn.jsxs("div",{onClick:()=>{if(Vb()&&k){const e=k.split("/").slice(0,-1).join("/")||"/";S(e),N(e)}else if(x&&k){const e=k.split("/").slice(0,-1).join("/")||"songs";S(e)}f(null)},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors bg-dark-bgSecondary hover:bg-dark-bgHover border border-dark-border",children:[wn.jsx(Bt,{size:18,className:"text-text-muted"}),wn.jsx("div",{className:"flex-1",children:wn.jsx("div",{className:"font-medium text-text-primary",children:".. (back)"})})]}),l.map(e=>wn.jsxs("div",{onClick:()=>f(e),onDoubleClick:()=>{e.isDirectory?Vb()?(S(e.path),N(e.path),f(null)):x&&(S(e.path),f(null)):(f(e),"load"===r&&P())},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors "+(m?.id===e.id?"bg-accent-primary/20 border border-accent-primary":"bg-dark-bgTertiary hover:bg-dark-bgHover border border-transparent"),children:[wn.jsx("div",{className:"text-text-muted flex-shrink-0",children:e.isDirectory?wn.jsx(Vt,{size:18}):DE(e.name)?wn.jsx(Nt,{size:18}):wn.jsx(zt,{size:18})}),wn.jsxs("div",{className:"flex-1 min-w-0",children:[wn.jsx("div",{className:"font-medium text-text-primary truncate",children:e.name}),wn.jsxs("div",{className:"text-xs text-text-muted",children:[e.size?`${(e.size/1024).toFixed(1)} KB`:"",e.modifiedAt&&`  ${e.modifiedAt.toLocaleDateString()}`]})]}),wn.jsx("button",{onClick:t=>{t.stopPropagation(),T(e)},className:"text-text-muted hover:text-red-400 p-1",title:"Delete","aria-label":"Delete",children:wn.jsx(Re,{size:14})})]},e.id))]})]}),wn.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 border-t border-dark-border",children:["save"===r&&wn.jsx("input",{type:"text",value:y,onChange:e=>g(e.target.value),placeholder:"Filename",className:"flex-1 px-3 py-2 bg-dark-bgTertiary border border-dark-border rounded text-text-primary"}),wn.jsx("div",{className:"flex-1"}),wn.jsx("button",{onClick:t,className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"Cancel"}),wn.jsx("button",{onClick:"load"===r?P:async()=>{if(o){u(!0),h(null);try{const e=o(),n=y.endsWith(".dbx")?y:`${y}.dbx`;if(Vb()&&window.electron?.fs){const t=`${M||k}/${n}`,a=JSON.stringify(e,null,2),s=(new TextEncoder).encode(a);await window.electron.fs.writeFile(t,s)}else if(x){const t=k?`${k}/${n}`:`songs/${n}`,a=JSON.stringify(e,null,2),s=(new TextEncoder).encode(a);await async function(e,t){const n=e.replace(/^\/+/,""),a=t instanceof ArrayBuffer?new Uint8Array(t):t,s=btoa(String.fromCharCode(...a)),r=await fetch(`${TE}/api/files/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})});if(!r.ok)throw new Error(`Failed to write file: ${r.statusText}`)}(t,s)}else{const t=EE();if(t)await async function(e,t,n){const a=n||CE;if(!a)throw new Error("No directory handle available");const s=await a.getFileHandle(e,{create:!0});return await PE(s,t),s}(n,JSON.stringify(e,null,2),t);else{const t=await async function(e,t){if(!NE())throw new Error("File System Access API not supported");try{return await window.showSaveFilePicker({suggestedName:e,types:t??[{description:"DEViLBOX Module",accept:{"application/json":[".dbox"]}}]})}catch(p){if("AbortError"===p.name)return null;throw p}}(n);t&&await PE(t,JSON.stringify(e,null,2))}}C(),t()}catch(e){h(e instanceof Error?e.message:"Failed to save file")}finally{u(!1)}}},disabled:"load"===r&&(!m||m.isDirectory),className:"px-6 py-2 rounded font-medium "+("load"!==r||m&&!m.isDirectory?"bg-accent-primary text-white hover:bg-accent-primaryHover":"bg-dark-bgTertiary text-text-muted cursor-not-allowed"),children:"load"===r?"Load":"Save"})]})]})}):null};var FE=r();function RE(e,t,n,a,s,r,o,i,l={},c){const d={format:"devilbox-song",version:Tv,metadata:e,bpm:t,instruments:n,patterns:a,sequence:s,...r&&Object.keys(r).length>0?{automation:r}:{},...i&&i.length>0?{automationCurves:i}:{},...o&&o.length>0?{masterEffects:o}:{},...c&&"straight"!==c?{grooveTemplateId:c}:{}},u=l.prettify?JSON.stringify(d,null,2):JSON.stringify(d),p=new Blob([u],{type:"application/json"}),h=`${GE(e.name)}.dbx`;FE.saveAs(p,h)}function jE(e,t,n,a,s={}){const r={format:"devilbox-sfx",version:Tv,name:e,instrument:t,pattern:n,bpm:a},o=s.prettify?JSON.stringify(r,null,2):JSON.stringify(r),i=new Blob([o],{type:"application/json"}),l=`${GE(e)}.sfx.json`;FE.saveAs(i,l)}function LE(e,t={}){const n={format:"devilbox-instrument",version:Tv,instrument:e},a=t.prettify?JSON.stringify(n,null,2):JSON.stringify(n),s=new Blob([a],{type:"application/json"}),r=`${GE(e.name)}.dbi`;FE.saveAs(s,r)}async function BE(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-song"!==n.format)throw new Error("Invalid song format");return n}catch(t){return null}}async function VE(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-sfx"!==n.format)throw new Error("Invalid SFX format");return n}catch(t){return null}}async function zE(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-instrument"!==n.format)throw new Error("Invalid instrument format");return n}catch(t){return null}}async function UE(e){try{const t=await e.text(),n=JSON.parse(t);return"devilbox-song"===n.format?"song":"devilbox-sfx"===n.format?"sfx":"devilbox-instrument"===n.format?"instrument":"unknown"}catch{return"unknown"}}function GE(e){return e.replace(/[^a-z0-9_-]/gi,"_").replace(/_{2,}/g,"_").toLowerCase()}function WE(e){const t=new Uint8Array(e),n=[];for(let a=0;a<t.length;a+=32768){const e=t.subarray(a,Math.min(a+32768,t.length));n.push(String.fromCharCode.apply(null,e))}return btoa(n.join(""))}function KE(e){const[t,n,a,s,r,o]=e;let i=0;t>0&&t<=120?i=Math.max(1,t-12):254!==t&&255!==t||(i=97);return{note:i,instrument:n>0?n:0,volume:r>0?Math.min(16+Math.min(r,64),80):0,effTyp:s,eff:o,effTyp2:0,eff2:0}}function HE(e){const t=e.note,n=e.effectType,a=e.effectParam,s=e.volume,r=e.instrument;let o=0,i=0;if(s>=96){const e=function(e){const t=15&e;switch(e>>4){case 6:return[10,t];case 7:return[10,t<<4];case 8:return[14,176+t];case 9:return[14,160+t];case 11:return[4,t];case 12:return[8,17*t];case 13:return[25,t];case 14:return[25,t<<4];case 15:return[3,t>0?16*t:0];default:return null}}(s);null!==e&&(o=e[0],i=e[1])}return{note:t,instrument:r,volume:s,effTyp:n,eff:a,effTyp2:o,eff2:i}}function $E(e){const t=function(e){if(0===e)return 0;const t=[1712,1616,1525,1440,1357,1281,1209,1141,1077,1017,961,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];let n=0,a=1/0;for(let r=0;r<t.length;r++){const s=Math.abs(t[r]-e);s<a&&(a=s,n=r+1)}const s=n+24;return Math.min(96,Math.max(1,s))}(e.period),n=e.instrument,a=(s=e.effect,r=e.effectParam,`${s.toString(16).toUpperCase()}${r.toString(16).padStart(2,"0").toUpperCase()}`);var s,r;const[o,i]=a?Ha(a):[0,0];return{note:t,instrument:n,volume:0,effTyp:o,eff:i,effTyp2:0,eff2:0,period:e.period}}function qE(e){return e.instruments||[]}function YE(e){return e.samples||[]}function XE(e){const t=function(e){if(!e.patterns||0===e.patterns.length)return[];const t=[],n=e.channels.length;for(let a=0;a<e.patterns.length;a++){const s=e.patterns[a],r=s.rows.length;if(0===r)continue;const o=[];for(let t=0;t<n;t++){const n=e.channels[t]||`Channel ${t+1}`,i=[];let l=null;for(let e=0;e<r;e++){const n=s.rows[e];if(n&&n[t]){const e=KE(n[t]);0!==e.instrument&&(l=e.instrument),i.push(e)}else i.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const c=null!==l&&0!==l?l:1;o.push({id:`import-ch-${a}-${t}-${Date.now()}`,name:n||`Ch ${t+1}`,rows:i,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:c,color:null})}const i=s.name||`Pattern ${a}`;t.push({id:`import-pat-${a}-${Date.now()}`,name:i,length:r,channels:o})}return t}(e),n=function(e){return e.orders?e.orders.map(e=>e.pat):[]}(e);let a;return a=n.length>0?n.map((e,n)=>{const a=t[e];return a?{...a,id:`import-pos-${n}-pat-${e}-${Date.now()}`,name:`${String(n).padStart(2,"0")}: ${a.name}`,channels:a.channels.map(e=>({...e,id:`${e.id}-pos-${n}`,rows:[...e.rows]}))}:t[0]}):t,{patterns:a,order:n,instrumentNames:qE(e),sampleNames:YE(e),channelCount:e.channels?.length||4}}function QE(e,t,n,a,s){const r=[];for(let d=0;d<e.length;d++){const a=e[d],s=a.length,o=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let n=0;n<s;n++){const s=a[n]?.[e];if(s){const e=HE(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const i=null!==r?r:0;o.push({id:`xm-ch-${d}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:i,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`xm-pat-${d}-${Date.now()}`,name:`Pattern ${d}`,length:s,channels:o,importMetadata:n})}const o=n.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),i=n.modData?.songLength||o.length,l=o.slice(0,i);let c;return s&&(c={base64:WE(s),format:"XM",sourceFile:n.sourceFile}),{patterns:r,order:l,instrumentNames:a,sampleNames:a,channelCount:t,metadata:n,originalModuleData:c}}function ZE(e,t,n,a,s){const r=[];for(let d=0;d<e.length;d++){const a=e[d],s=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let n=0;n<64;n++){const s=a[n]?.[e];if(s){const e=$E(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const o=null!==r?r:0;s.push({id:`mod-ch-${d}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:o,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`mod-pat-${d}-${Date.now()}`,name:`Pattern ${d}`,length:64,channels:s,importMetadata:n})}const o=n.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),i=n.modData?.songLength||o.length,l=o.slice(0,i);let c;return s&&(c={base64:WE(s),format:"MOD",sourceFile:n.sourceFile}),{patterns:r,order:l,instrumentNames:a,sampleNames:a,channelCount:t,metadata:n,originalModuleData:c}}function JE(e,t=0){const n={attack:10,decay:500,sustain:t,release:100};if(!e||!e.enabled||e.points.length<2)return n;const a=e.points;try{const t=function(e){if(0===e.length)return 10;const t=e[0];let n=0,a=e[0].value;for(let i=1;i<e.length;i++)if(e[i].value>a)a=e[i].value,n=i;else if(e[i].value<a-5)break;const s=e[n],r=s.tick-t.tick,o=32;return Math.max(1,r*o)}(a),{decay:n,sustain:s}=function(e,t,n){if(0===e.length)return{decay:500,sustain:0};let a=0,s=e[0].value;for(let u=0;u<e.length;u++)e[u].value>s&&(s=e[u].value,a=u);let r=n??a,o=e[r]?.value??s;if(null!==n&&n<e.length)o=e[n].value;else for(let u=a+1;u<e.length;u++){if(Math.abs(e[u].value-e[u-1].value)<6){r=u,o=e[u].value;break}}const i=e[r].tick-e[a].tick,l=32,c=Math.max(0,i*l),d=o/64*100;return{decay:c,sustain:d}}(a,0,e.sustainPoint),r=function(e,t){if(0===e.length)return 100;const n=t??Math.max(0,e.length-2);if(n>=e.length-1)return 100;let a=e.length-1;for(let o=n+1;o<e.length;o++)if(e[o].value<5){a=o;break}const s=e[a].tick-e[n].tick,r=32;return Math.max(10,s*r)}(a,e.sustainPoint);return{attack:Math.max(0,Math.min(2e3,t)),decay:Math.max(0,Math.min(2e3,n)),sustain:Math.max(0,Math.min(100,s)),release:Math.max(0,Math.min(5e3,r))}}catch(s){return n}}function eP(e,t,n){const a=[];if(e.furnace){const s=e.furnace.synthType;if("Sampler"===s||"Player"===s){if(e.samples.length>0)for(let s=0;s<e.samples.length;s++){const r=nP(e.samples[s],e,t+s,n);a.push(r)}else{const n=tP(e,t);a.push(n)}return a}const r=tP(e,t);a.push(r);for(let o=0;o<e.samples.length;o++){const s=nP(e.samples[o],e,t+o+1,n);a.push(s)}return a}for(let s=0;s<e.samples.length;s++){const r=nP(e.samples[s],e,t+s,n);a.push(r)}return a}function tP(e,t){const n=e.furnace,a=n.synthType,s={chipType:n.chipType,furnaceIndex:e.id-1,rawBinaryData:e.rawBinaryData,algorithm:n.fm?.algorithm??0,feedback:n.fm?.feedback??0,fms:n.fm?.fms??0,ams:n.fm?.ams??0,ops:n.fm?.ops??4,opllPreset:n.fm?.opllPreset??0,operators:n.fm?.operators?.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r??0,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2??0,rs:e.rs??0,am:e.am??!1,ksr:e.ksr??!1,ksl:e.ksl??0,sus:e.sus??!1,vib:e.vib??!1,ws:e.ws??0,ssg:e.ssg??0}))??[],macros:n.macros.map(e=>({code:e.type,type:e.type,data:[...e.data],loop:e.loop,release:e.release,mode:e.mode??0,delay:e.delay,speed:e.speed})),opMacros:[],wavetables:n.wavetables.map(e=>({id:e.id,data:[...e.data],len:e.len,max:e.max}))};return{id:t,name:e.name||`Furnace Inst ${t}`,type:"synth",synthType:a,envelope:{attack:10,decay:100,sustain:80,release:100},effects:[],volume:0,pan:0,metadata:{importedFrom:"FUR"},furnace:s,parameters:{}}}function nP(e,t,n,a){const{audioBuffer:s,blobUrl:r}=function(e){const t=e.sampleRate||8363,n=e.length,a=new Int16Array(n);if(8===e.bitDepth){const t=e.pcmData instanceof Float32Array?new Float32Array(e.pcmData):new Int8Array(e.pcmData);for(let e=0;e<n;e++)t instanceof Float32Array?a[e]=Math.round(32767*t[e]):a[e]=256*t[e]}else if(16===e.bitDepth){const t=new Int16Array(e.pcmData);for(let e=0;e<n;e++)a[e]=t[e]}const s="none"!==e.loopType?{start:e.loopStart,end:e.loopStart+e.loopLength}:void 0,r=function(e,t,n){const a=1,s=2*e.length,r=n?68:0,o=44+s+r,i=new ArrayBuffer(o),l=new DataView(i),c=(e,t)=>{for(let n=0;n<t.length;n++)l.setUint8(e+n,t.charCodeAt(n))};c(0,"RIFF"),l.setUint32(4,o-8,!0),c(8,"WAVE"),c(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,a,!0),l.setUint32(24,t,!0),l.setUint32(28,t*a*2,!0),l.setUint16(32,2*a,!0),l.setUint16(34,16,!0),c(36,"data"),l.setUint32(40,s,!0);let d=44;for(let u=0;u<e.length;u++)l.setInt16(d,e[u],!0),d+=2;n&&(c(d,"smpl"),l.setUint32(d+4,60,!0),l.setUint32(d+8,0,!0),l.setUint32(d+12,0,!0),l.setUint32(d+16,Math.floor(1e9/t),!0),l.setUint32(d+20,60,!0),l.setUint32(d+24,0,!0),l.setUint32(d+28,0,!0),l.setUint32(d+32,0,!0),l.setUint32(d+36,1,!0),l.setUint32(d+40,0,!0),l.setUint32(d+44,0,!0),l.setUint32(d+48,0,!0),l.setUint32(d+52,n.start,!0),l.setUint32(d+56,n.end-1,!0),l.setUint32(d+60,0,!0),l.setUint32(d+64,0,!0));return i}(a,t,s),o=function(e){const t=new Uint8Array(e);let n="";for(let a=0;a<t.byteLength;a++)n+=String.fromCharCode(t[a]);return btoa(n)}(r);return{audioBuffer:r,blobUrl:`data:audio/wav;base64,${o}`}}(e),o=(e.sampleRate,function(e){const t=48+e,n=Math.floor(t/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}${n}`}(e.relativeNote,e.finetune)),i=100*e.finetune/128,l=JE(t.volumeEnvelope),c=e.sampleRate||8363,d={audioBuffer:s,url:r,baseNote:o,detune:i,loop:"none"!==e.loopType,loopStart:e.loopStart,loopEnd:e.loopStart+e.loopLength,sampleRate:c,reverse:!1,playbackRate:1},u={importedFrom:"FUR"===a||"DMF"===a?"FUR":a,originalEnvelope:t.volumeEnvelope,autoVibrato:t.autoVibrato,preservedSample:{audioBuffer:d.audioBuffer,url:d.url,baseNote:d.baseNote,detune:d.detune,loop:d.loop,loopStart:d.loopStart,loopEnd:d.loopEnd,envelope:l},modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:e.finetune,defaultVolume:e.volume}};return{id:n,name:e.name||t.name||`Instrument ${n}`,type:"sample",synthType:"Sampler",sample:d,envelope:l,effects:[],volume:0,pan:(e.panning-128)/127*100,metadata:u,parameters:{sampleUrl:r}}}const aP=Object.freeze(Object.defineProperty({__proto__:null,analyzeSample:function(e,t){const n=function(e){if(!e||!e.enabled||e.points.length<2)return{type:"unknown",hasQuickAttack:!1,hasSustain:!1,hasLongRelease:!1};const t=JE(e),n=t.attack<20,a=t.sustain>20,s=t.release>500;let r="unknown";return n&&!a&&t.decay<300?r="pluck":n&&!a&&t.decay<100?r="percussive":!n&&a?r="pad":n&&a&&(r="sustained"),{type:r,hasQuickAttack:n,hasSustain:a,hasLongRelease:s}}(t),a="none"!==e.loopType,s=0!==e.relativeNote||a;return{dominantFrequency:s?440:null,harmonicContent:e.length<8e3&&!a&&"percussive"===n.type?"noise":s?"rich":"pure",envelopeShape:n.type,hasLoop:a,isPitched:s,bandwidth:1e3}},convertToInstrument:eP,suggestSynthConfig:function(e,t){switch(e){case"TB303":return{oscillator:{type:"rich"===t.harmonicContent?"sawtooth":"square"},filter:{cutoff:t.dominantFrequency?500:1e3,resonance:70},filterEnvelope:{envMod:60,decay:"pluck"===t.envelopeShape?200:500},accent:{amount:70},slide:{time:60,mode:"exponential"}};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:"pad"===t.envelopeShape?200:50,decay:500,sustain:t.hasLoop?50:0,release:100},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:"rich"===t.harmonicContent?3:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:"percussive"===t.envelopeShape?100:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100}}}}},Symbol.toStringTag,{value:"Module"}));var sP,rP,oP,iP,lP,cP={},dP={};function uP(){if(rP)return sP;function e(e){for(var n,a=new t(e),s=[];!a.eof();){var r=o();s.push(r)}return s;function o(){var e={};e.deltaTime=a.readVarInt();var t=a.readUInt8();if(240&~t){var s;if(128&t)s=a.readUInt8(),n=t;else{if(null===n)throw"Running status byte encountered before status byte";s=t,t=n,e.running=!0}var r=t>>4;switch(e.channel=15&t,r){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=a.readUInt8(),e;case 9:var o=a.readUInt8();return e.type=0===o?"noteOff":"noteOn",e.noteNumber=s,e.velocity=o,0===o&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=a.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=a.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(a.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+r}}else{if(255!==t){if(240==t){e.type="sysEx";l=a.readVarInt();return e.data=a.readBytes(l),e}if(247==t){e.type="endSysEx";l=a.readVarInt();return e.data=a.readBytes(l),e}throw"Unrecognised MIDI event type byte: "+t}e.meta=!0;var i=a.readUInt8(),l=a.readVarInt();switch(i){case 0:if(e.type="sequenceNumber",2!==l)throw"Expected length for sequenceNumber event is 2, got "+l;return e.number=a.readUInt16(),e;case 1:return e.type="text",e.text=a.readString(l),e;case 2:return e.type="copyrightNotice",e.text=a.readString(l),e;case 3:return e.type="trackName",e.text=a.readString(l),e;case 4:return e.type="instrumentName",e.text=a.readString(l),e;case 5:return e.type="lyrics",e.text=a.readString(l),e;case 6:return e.type="marker",e.text=a.readString(l),e;case 7:return e.type="cuePoint",e.text=a.readString(l),e;case 32:if(e.type="channelPrefix",1!=l)throw"Expected length for channelPrefix event is 1, got "+l;return e.channel=a.readUInt8(),e;case 33:if(e.type="portPrefix",1!=l)throw"Expected length for portPrefix event is 1, got "+l;return e.port=a.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=l)throw"Expected length for endOfTrack event is 0, got "+l;return e;case 81:if(e.type="setTempo",3!=l)throw"Expected length for setTempo event is 3, got "+l;return e.microsecondsPerBeat=a.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=l)throw"Expected length for smpteOffset event is 5, got "+l;var c=a.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&c],e.hour=31&c,e.min=a.readUInt8(),e.sec=a.readUInt8(),e.frame=a.readUInt8(),e.subFrame=a.readUInt8(),e;case 88:if(e.type="timeSignature",2!=l&&4!=l)throw"Expected length for timeSignature event is 4 or 2, got "+l;return e.numerator=a.readUInt8(),e.denominator=1<<a.readUInt8(),4===l?(e.metronome=a.readUInt8(),e.thirtyseconds=a.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=l)throw"Expected length for keySignature event is 2, got "+l;return e.key=a.readInt8(),e.scale=a.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=a.readBytes(l),e;default:return e.type="unknownMeta",e.data=a.readBytes(l),e.metatypeByte=i,e}}}}function t(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}return rP=1,t.prototype.eof=function(){return this.pos>=this.bufferLen},t.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},t.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},t.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},t.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},t.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},t.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},t.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},t.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},sP=function(n){var a=new t(n),s=a.readChunk();if("MThd"!=s.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var r=function(e){var n=new t(e),a=n.readUInt16(),s=n.readUInt16(),r={format:a,numTracks:s},o=n.readUInt16();32768&o?(r.framesPerSecond=256-(o>>8),r.ticksPerFrame=255&o):r.ticksPerBeat=o;return r}(s.data),o=[],i=0;!a.eof()&&i<r.numTracks;i++){var l=a.readChunk();if("MTrk"!=l.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var c=e(l.data);o.push(c)}return{header:r,tracks:o}}}function pP(){if(iP)return oP;function e(e,a,s){var r,o=new n,i=a.length,l=null;for(r=0;r<i;r++)!1!==s.running&&(s.running||a[r].running)||(l=null),l=t(o,a[r],l,s.useByte9ForNoteOff);e.writeChunk("MTrk",o.buffer)}function t(e,t,n,a){var s=t.type,r=t.deltaTime,o=t.text||"",i=t.data||[],l=null;switch(e.writeVarInt(r),s){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(o.length),e.writeString(o);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(o.length),e.writeString(o);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(o.length),e.writeString(o);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(o.length),e.writeString(o);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(o.length),e.writeString(o);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(o.length),e.writeString(o);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(o.length),e.writeString(o);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var d=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(d),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(i.length),e.writeBytes(i);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(i.length),e.writeBytes(i));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(i.length),e.writeBytes(i);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(i.length),e.writeBytes(i);break;case"noteOff":(l=(!1!==a&&t.byte9||a&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(l=144|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(l=160|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(l=176|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(l=192|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(l=208|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":(l=224|t.channel)!==n&&e.writeUInt8(l);var u=8192+t.value,p=127&u,h=u>>7&127;e.writeUInt8(p),e.writeUInt8(h);break;default:throw"Unrecognized event type: "+s}return l}function n(){this.buffer=[]}return iP=1,n.prototype.writeUInt8=function(e){this.buffer.push(255&e)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(a)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,a=e>>8&255,s=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(a),this.writeUInt8(s)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},n.prototype.writeString=function(e){var t,n=e.length,a=[];for(t=0;t<n;t++)a.push(e.codePointAt(t));this.writeBytes(a)},n.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var a=127&t|128;n.push(a),t>>=7}this.writeBytes(n.reverse())}},n.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},oP=function(t,a){if("object"!=typeof t)throw"Invalid MIDI data";a=a||{};var s,r=t.header||{},o=t.tracks||[],i=o.length,l=new n;for(function(e,t,a){var s=null==t.format?1:t.format,r=128;t.timeDivision?r=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?r=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(r=32767&t.ticksPerBeat);var o=new n;o.writeUInt16(s),o.writeUInt16(a),o.writeUInt16(r),e.writeChunk("MThd",o.buffer)}(l,r,i),s=0;s<i;s++)e(l,o[s],a);return l.buffer}}function hP(){return lP||(lP=1,dP.parseMidi=uP(),dP.writeMidi=pP()),dP}var mP,fP,yP={},gP={};function vP(){if(mP)return gP;function e(e,t,n){void 0===n&&(n="ticks");var a=0,s=e.length,r=s;if(s>0&&e[s-1][n]<=t)return s-1;for(;a<r;){var o=Math.floor(a+(r-a)/2),i=e[o],l=e[o+1];if(i[n]===t){for(var c=o;c<e.length;c++){e[c][n]===t&&(o=c)}return o}if(i[n]<t&&l[n]>t)return o;i[n]>t?r=o:i[n]<t&&(a=o+1)}return-1}return mP=1,Object.defineProperty(gP,"__esModule",{value:!0}),gP.insert=gP.search=void 0,gP.search=e,gP.insert=function(t,n,a){if(void 0===a&&(a="ticks"),t.length){var s=e(t,n[a],a);t.splice(s+1,0,n)}else t.push(n)},gP}function bP(){return fP||(fP=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=vP(),n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function a(t){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),t){n.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?a.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?a.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&a.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var s=0;t.tracks[0].forEach(function(e){s+=e.deltaTime,e.meta&&("trackName"===e.type?a.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||a.meta.push({text:e.text,ticks:s,type:e.type}))}),this.update()}}return a.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort(function(e,t){return e.ticks-t.ticks}),this.tempos.forEach(function(a,s){var r=s>0?e.tempos[s-1].bpm:e.tempos[0].bpm,o=a.ticks/e.ppq-n,i=60/r*o;a.time=i+t,t=a.time,n+=o}),this.timeSignatures.sort(function(e,t){return e.ticks-t.ticks}),this.timeSignatures.forEach(function(t,n){var a=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],s=(t.ticks-a.ticks)/e.ppq/a.timeSignature[0]/(a.timeSignature[1]/4);a.measures=a.measures||0,t.measures=s+a.measures})},a.prototype.ticksToSeconds=function(e){var n=(0,t.search)(this.tempos,e);if(-1!==n){var a=this.tempos[n],s=a.time,r=(e-a.ticks)/this.ppq;return s+60/a.bpm*r}return.5*(e/this.ppq)},a.prototype.ticksToMeasures=function(e){var n=(0,t.search)(this.timeSignatures,e);if(-1!==n){var a=this.timeSignatures[n],s=(e-a.ticks)/this.ppq;return a.measures+s/(a.timeSignature[0]/a.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(a.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),a.prototype.secondsToTicks=function(e){var n=(0,t.search)(this.tempos,e,"time");if(-1!==n){var a=this.tempos[n],s=(e-a.time)/(60/a.bpm);return Math.round(a.ticks+s*this.ppq)}var r=e/.5;return Math.round(r*this.ppq)},a.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},a.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(e){return Object.assign({},e)}),this.timeSignatures=e.timeSignatures.map(function(e){return Object.assign({},e)}),this.keySignatures=e.keySignatures.map(function(e){return Object.assign({},e)}),this.meta=e.meta.map(function(e){return Object.assign({},e)}),n.set(this,e.ppq),this.update()},a.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},a}();e.Header=a}(yP)),yP}var xP,wP={},kP={};function SP(){return xP||(xP=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,n){return t[e.controlChangeNames[n]]=n,t},{});var t=new WeakMap,n=new WeakMap,a=function(){function a(e,a){t.set(this,a),n.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(a.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){return t.get(this).ticksToSeconds(this.ticks)},set:function(e){var n=t.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},a}();e.ControlChange=a}(kP)),kP}var MP,NP={};var CP,EP={};var PP,TP,AP={},_P={};function IP(){if(TP)return AP;TP=1,Object.defineProperty(AP,"__esModule",{value:!0}),AP.Instrument=void 0;var e=(PP||(PP=1,Object.defineProperty(_P,"__esModule",{value:!0}),_P.DrumKitByPatchID=_P.InstrumentFamilyByID=_P.instrumentByPatchID=void 0,_P.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],_P.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],_P.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),_P),t=new WeakMap,n=function(){function n(e,n){if(this.number=0,t.set(this,n),this.number=0,e){var a=e.find(function(e){return"programChange"===e.type});a&&(this.number=a.programNumber)}}return Object.defineProperty(n.prototype,"name",{get:function(){return this.percussion?e.DrumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var n=e.instrumentByPatchID.indexOf(t);-1!==n&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"family",{get:function(){return this.percussion?"drums":e.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"percussion",{get:function(){return 9===t.get(this).channel},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},n.prototype.fromJSON=function(e){this.number=e.number},n}();return AP.Instrument=n,AP}var DP,OP,FP={};function RP(){if(DP)return FP;function e(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}DP=1,Object.defineProperty(FP,"__esModule",{value:!0}),FP.Note=void 0;var t=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var a=e.exec(n),s=a[1],r=a[2];return t[s.toLowerCase()]+12*(parseInt(r,10)+1)}}(),n=new WeakMap,a=function(){function a(e,t,a){n.set(this,a),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return t=this.midi,n=Math.floor(t/12)-1,e(t)+n.toString();var t,n},set:function(e){this.midi=t(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var e=n.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){return n.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return FP.Note=a,FP}function jP(){if(OP)return wP;OP=1,Object.defineProperty(wP,"__esModule",{value:!0}),wP.Track=void 0;var e=vP(),t=SP(),n=function(){if(MP)return NP;MP=1,Object.defineProperty(NP,"__esModule",{value:!0}),NP.createControlChanges=void 0;var e=SP();return NP.createControlChanges=function(){return new Proxy({},{get:function(t,n){return t[n]?t[n]:e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]:void 0},set:function(t,n,a){return e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]=a:t[n]=a,!0}})},NP}(),a=function(){if(CP)return EP;CP=1,Object.defineProperty(EP,"__esModule",{value:!0}),EP.PitchBend=void 0;var e=new WeakMap,t=function(){function t(t,n){e.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return e.get(this).ticksToSeconds(this.ticks)},set:function(t){var n=e.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return EP.PitchBend=t,EP}(),s=IP(),r=RP(),o=new WeakMap,i=function(){function i(e,t){var a=this;if(this.name="",this.notes=[],this.controlChanges=(0,n.createControlChanges)(),this.pitchBends=[],o.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var i=e.filter(function(e){return"noteOn"===e.type}),l=e.filter(function(e){return"noteOff"===e.type}),c=function(){var e=i.shift();d.channel=e.channel;var t=l.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var n=l.splice(t,1)[0];d.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},d=this;i.length;)c();e.filter(function(e){return"controller"===e.type}).forEach(function(e){a.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){a.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})});var u=e.find(function(e){return"endOfTrack"===e.type});this.endOfTrackTicks=void 0!==u?u.absoluteTime:void 0}}return i.prototype.addNote=function(t){var n=o.get(this),a=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(a,t),(0,e.insert)(this.notes,a,"ticks"),this},i.prototype.addCC=function(n){var a=o.get(this),s=new t.ControlChange({controllerType:n.number},a);return delete n.number,Object.assign(s,n),Array.isArray(this.controlChanges[s.number])||(this.controlChanges[s.number]=[]),(0,e.insert)(this.controlChanges[s.number],s,"ticks"),this},i.prototype.addPitchBend=function(t){var n=o.get(this),s=new a.PitchBend({},n);return Object.assign(s,t),(0,e.insert)(this.pitchBends,s,"ticks"),this},Object.defineProperty(i.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),i.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},i.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},i}();return wP.Track=i,wP}var LP={};function BP(e,t){for(var n=0;n<e.length;n++){var a=e[n];Array.isArray(a)?BP(a,t):t.push(a)}}const VP=d(Object.freeze(Object.defineProperty({__proto__:null,flatten:function(e){var t=[];return BP(e,t),t}},Symbol.toStringTag,{value:"Module"})));var zP,UP;function GP(){if(zP)return LP;zP=1;var e=LP&&LP.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,s=0,r=t.length;s<r;s++)!a&&s in t||(a||(a=Array.prototype.slice.call(t,0,s)),a[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))};Object.defineProperty(LP,"__esModule",{value:!0}),LP.encode=void 0;var t=hP(),n=bP(),a=VP;function s(e){return(0,a.flatten)(e.notes.map(function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)}))}function r(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function o(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}return LP.encode=function(a){var i={header:{format:1,numTracks:a.tracks.length+1,ticksPerBeat:a.header.ppq},tracks:e([e(e(e(e([{absoluteTime:0,deltaTime:0,meta:!0,text:a.header.name,type:"trackName"}],a.header.keySignatures.map(function(e){return function(e){var t=n.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)}),!0),a.header.meta.map(function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t}),!0),a.header.tempos.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)}),!0),a.header.timeSignatures.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)}),!0)],a.tracks.map(function(t){return e(e(e([(n=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:n,type:"trackName"}),o(t)],s(t),!0),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(n){t.push(r(n,e.channel))});return t}(t),!0),function(e){var t=[];return e.pitchBends.forEach(function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))}),t}(t),!0);var n}),!0)};return i.tracks=i.tracks.map(function(e){e=e.sort(function(e,t){return e.absoluteTime-t.absoluteTime});var t=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array((0,t.writeMidi)(i))},LP}var WP=(UP||(UP=1,function(e){var t=cP&&cP.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,r){function o(e){try{l(a.next(e))}catch(t){r(t)}}function i(e){try{l(a.throw(e))}catch(t){r(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,i)}l((a=a.apply(e,t||[])).next())})},n=cP&&cP.__generator||function(e,t){var n,a,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&r[0]?a.return:r[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(i){r=[6,i],a=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var a=hP(),s=bP(),r=jP(),o=GP(),i=function(){function e(e){var t=this,n=null;if(e){var o=e instanceof ArrayBuffer?new Uint8Array(e):e;(n=(0,a.parseMidi)(o)).tracks.forEach(function(e){var t=0;e.forEach(function(e){t+=e.deltaTime,e.absoluteTime=t})}),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var a=t.length,s=new Map,r=Array(16).fill(0),o=0,i=e[n];o<i.length;o++){var l=i[o],c=a,d=l.channel;if(void 0!==d){"programChange"===l.type&&(r[d]=l.programNumber);var u=r[d],p="".concat(u," ").concat(d);s.has(p)?c=s.get(p):(c=a+s.size,s.set(p,c))}t[c]||t.push([]),t[c].push(l)}return t}(n.tracks)}this.header=new s.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map(function(e){return new r.Track(e,t.header)}),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(a){return t(this,void 0,void 0,function(){var t;return n(this,function(n){switch(n.label){case 0:return[4,fetch(a)];case 1:return(t=n.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new e(n.sent())];case 3:throw new Error("Could not load '".concat(a,"'"))}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map(function(e){return e.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(e){return e.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new r.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,o.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(e){var n=new r.Track(void 0,t.header);return n.fromJSON(e),n})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();e.Midi=i;var l=jP();Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=bP();Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}})}(cP)),cP);function KP(e="id"){return`${e}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const HP={quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64};async function $P(e,t={}){const n={...HP,...t},a=await e.arrayBuffer(),s=new WP.Midi(a),r=s.header.ppq||480;if(0===r)throw new Error("Invalid MIDI file: PPQ (pulses per quarter note) cannot be zero");const o=s.header.tempos.length>0?Math.round(s.header.tempos[0].bpm):120,i=s.header.timeSignatures.length>0?[s.header.timeSignatures[0].timeSignature[0],s.header.timeSignatures[0].timeSignature[1]]:[4,4],l=[];if(n.mergeChannels){const e=function(e,t,n,a){const s=e.duration*(e.header.tempos[0]?.bpm||120)/60,r=Math.min(256,Math.max(t.defaultPatternLength||64,Math.ceil(s*a))),o=new Map;e.tracks.forEach(e=>{e.notes.forEach(e=>{const t=e.midi%16;o.has(t)||o.set(t,[]),o.get(t).push({tick:e.ticks,note:e})})});const i=Array.from(o.entries()).sort((e,t)=>e[0]-t[0]).map(([e,s])=>{const o=Array.from({length:r},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return s.forEach(({tick:e,note:s})=>{const i=YP(e,n,a,t.quantize);if(i<0||i>=r)return;const l=Ya(s.midi);if(!l)return;if(o[i].note=l,t.velocityToVolume){const e=XP(127*s.velocity);o[i].volume=16+Math.round(e/64*64)}const c=YP(e+s.durationTicks,n,a,t.quantize);c<r&&c>i&&(o[c].note=97)}),{id:KP("channel"),name:`Ch ${e+1}`,instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:o}});return{id:KP("pattern"),name:e.name||"MIDI Import",length:r,channels:i}}(s,n,r,4);l.push(e)}else for(let c=0;c<s.tracks.length;c++){const e=s.tracks[c];if(0===e.notes.length)continue;const t=qP(e,c,n,r,4);l.push(t)}return{patterns:l,bpm:o,timeSignature:i,metadata:{name:s.name||e.name.replace(/\.[^/.]+$/,""),tracks:s.tracks.length,totalTicks:s.durationTicks}}}function qP(e,t,n,a,s){const r=e.notes.length>0?e.notes[e.notes.length-1]:null,o=YP(r?r.ticks+r.durationTicks:0,a,s,0),i=Math.min(256,Math.max(n.defaultPatternLength||64,64*Math.ceil(o/64))),l=Array.from({length:i},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return e.notes.forEach(e=>{const t=YP(e.ticks,a,s,n.quantize);if(t<0||t>=i)return;const r=Ya(e.midi);if(!r)return;if(l[t].note=r,n.velocityToVolume){const n=XP(127*e.velocity);l[t].volume=16+Math.round(n/64*64)}const o=YP(e.ticks+e.durationTicks,a,s,n.quantize);o<i&&o>t&&(l[o].note=97)}),{id:KP("pattern"),name:e.name||`Track ${t+1}`,length:i,channels:[{id:KP("channel"),name:"Channel 1",instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:l}]}}function YP(e,t,n,a=0){if(0===t)return 0;const s=Math.round(e/t*n);return a>0?Math.round(s/a)*a:s}function XP(e){return Math.round(e/127*64)}function QP(e,t="DB303 Pattern",n=1){const a=(new DOMParser).parseFromString(e,"text/xml"),s=a.querySelector("parsererror");if(s)throw new Error("Invalid XML: "+s.textContent);const r=a.querySelector("db303-pattern");if(!r)throw new Error("Invalid pattern XML: missing db303-pattern element");const o=parseInt(r.getAttribute("numSteps")||"16",10),i=Math.max(1,Math.min(256,isNaN(o)?16:o)),l=parseInt(r.getAttribute("rootNote")||"36",10),c=r.getAttribute("tempo")?parseInt(r.getAttribute("tempo"),10):void 0,d=r.getAttribute("swing")?parseFloat(r.getAttribute("swing")):void 0,u=[];a.querySelectorAll("step").forEach(e=>{const t=parseInt(e.getAttribute("index")||"0",10),n=parseInt(e.getAttribute("key")||"0",10),a=parseInt(e.getAttribute("octave")||"0",10),s="true"===e.getAttribute("gate"),r="true"===e.getAttribute("accent"),o="true"===e.getAttribute("slide"),i="true"===e.getAttribute("mute"),l="true"===e.getAttribute("hammer");u.push({index:t,key:n,octave:a,gate:s,accent:r,slide:o,mute:i,hammer:l})}),u.sort((e,t)=>e.index-t.index);const p=new Map(u.map(e=>[e.index,e])),h=[];let m=-1;for(let f=0;f<i;f++){const e=p.get(f);if(e){let t=0;if(e.gate){t=l+e.key+12*e.octave-11,t=Math.max(1,Math.min(96,t)),m=f}else m>=0&&(t=97);h.push({note:t,instrument:e.gate?n:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:e.mute?3:e.hammer?4:void 0,flag2:e.slide?2:!e.hammer||e.accent||e.mute?void 0:4})}else h.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}return{pattern:{id:`db303-${Date.now()}`,name:t,length:i,channels:[{id:"ch-1",name:"TB-303",rows:h,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:"#22c55e"}]},tempo:c,swing:d}}function ZP(e,t=120,n=0,a=36){const s=[];s.push('<?xml version="1.0" encoding="UTF-8"?>');const r=e.channels?.[0];if(!r)throw new Error("Pattern has no channels to export");const o=Math.min(e.length,32),i=n>0?` swing="${n.toFixed(2)}"`:"";s.push(`<db303-pattern version="1.0" numSteps="${o}" tempo="${Math.round(t)}"${i} rootNote="${a}">`);for(let l=0;l<o;l++){const e=r?.rows[l];if(!e){s.push(`  <step index="${l}" key="0" octave="0" gate="false" accent="false" slide="false" mute="false" hammer="false"/>`);continue}const t=e.note>0&&e.note<=96,n=t,o=1===e.flag1||1===e.flag2,i=2===e.flag1||2===e.flag2,c=3===e.flag1||3===e.flag2,d=4===e.flag1||4===e.flag2;let u=0,p=0;if(t){const t=e.note-1-a;p=Math.floor(t/12),u=(t%12+12)%12,p=Math.max(-1,Math.min(1,p))}s.push(`  <step index="${l}" key="${u}" octave="${p}" gate="${n}" accent="${o}" slide="${i}" mute="${c}" hammer="${d}"/>`)}return s.push("</db303-pattern>"),s.join("\n")}function JP(e,t="pattern",n=120,a=0,s=36){const r=ZP(e,n,a,s),o=new Blob([r],{type:"application/xml"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download=`${t}.xml`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}async function eT(e=0,t){const{useTrackerStore:n}=await An(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>nf);return{useTrackerStore:e}},void 0),{useTransportStore:a}=await An(async()=>{const{useTransportStore:e}=await Promise.resolve().then(()=>jy);return{useTransportStore:e}},void 0),s=n.getState(),r=a.getState(),o=s.patterns,i=s.currentPatternIndex;if(!o||0===o.length)return;const l=o[i];if(!l)return;let c=l;e>0&&l.channels[e]&&(c={...l,channels:[l.channels[e]]});const d=r.bpm||120,u=r.swing||0;JP(c,t||l.name?.replace(/[^a-zA-Z0-9-_]/g,"_")||"pattern",d,u,36)}"undefined"!=typeof window&&(window.exportCurrentPatternToDb303=eT,window.convertToDb303Pattern=ZP,window.downloadDb303Pattern=JP);const tT=Object.freeze(Object.defineProperty({__proto__:null,convertToDb303Pattern:ZP,downloadDb303Pattern:JP,exportCurrentPatternToDb303:eT,parseDb303Pattern:QP},Symbol.toStringTag,{value:"Module"})),nT=[".json",".song.json",".dbx",".xml",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".mid",".midi"].join(",");function aT(e,t,n){const a=new Set;for(const o of e)for(const e of o.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&a.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const o of Array.from(a).sort((e,t)=>e-t)){const e=t[o-1]||`Instrument ${o}`;{const t=r[(o-1)%r.length];s.push({id:o,name:e.trim()||`Instrument ${o}`,type:"synth",synthType:"Synth",oscillator:{...Fa,type:t},envelope:{...Ra},filter:{...ja},effects:[],volume:-6,pan:0})}}for(const o of[0,1])a.has(o)||s.push({id:o,name:0===o?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Fa,type:"sawtooth"},envelope:{...Ra},filter:{...ja},effects:[],volume:-6,pan:0});return s.sort((e,t)=>e.id-t.id),s}const sT=({onShowExport:t,onShowHelp:n,onShowMasterFX:a,onShowInstruments:r,onShowPatternOrder:o,onShowDrumpads:i,showMasterFX:l})=>{const{patterns:c,currentPatternIndex:d,setCurrentPattern:u,deletePattern:p,addPattern:h,expandPattern:m,shrinkPattern:f,resizePattern:y,loadPatterns:g,setPatternOrder:v,patternOrder:b,currentPositionIndex:x,setCurrentPosition:w,recordMode:k,editStep:S,toggleRecordMode:M,setEditStep:N,reset:C,duplicatePosition:E,removeFromOrder:P}=tf(),{isPlaying:T,isLooping:A,bpm:_,setBPM:I,speed:D,setSpeed:O,setIsLooping:F,play:R,stop:j,grooveTemplateId:L,setGrooveTemplate:B,swing:V,jitter:z,useMpcScale:U,reset:G}=Ry(),{isDirty:W,setMetadata:K,metadata:H}=By(),{instruments:$,loadInstruments:q,updateInstrument:Y,addInstrument:X,reset:Q}=Py(),{masterEffects:Z}=Ly(),{compactToolbar:J,toggleCompactToolbar:ee,oscilloscopeVisible:te}=Ay(),{curves:ne}=Vy(),ae=qy(e=>e.addTab),se=Hm(),re=s.useRef(null),[oe,ie]=s.useState(!1),[le,ce]=s.useState("logo"),{tap:de,tapCount:ue,isActive:pe}=function(e){const[t,n]=s.useState(0),[a,r]=s.useState(null),[o,i]=s.useState(!1),l=s.useRef([]),c=s.useRef(null),d=s.useCallback(()=>{l.current=[],n(0),r(null),i(!1),c.current&&(clearTimeout(c.current),c.current=null)},[]);return s.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),{bpm:a,tapCount:t,isActive:o,tap:s.useCallback(()=>{const t=performance.now();c.current&&clearTimeout(c.current);const a=l.current[l.current.length-1];a&&t-a>2e3&&(l.current=[]),l.current.push(t),i(!0),l.current.length>8&&(l.current=l.current.slice(-8));const s=l.current;if(n(s.length),s.length>=2){const t=[];for(let e=1;e<s.length;e++)t.push(s[e]-s[e-1]);const n=t.reduce((e,t)=>e+t,0)/t.length;let a=Math.round(6e4/n);a=Math.max(20,Math.min(999,a)),r(a),e&&e(a)}c.current=setTimeout(()=>{i(!1)},2e3)},[e]),reset:d}}(I),[he,me]=s.useState(!1),[fe,ye]=s.useState(!1),[ge,ve]=s.useState(!1),[be,xe]=s.useState(!1),[we,ke]=s.useState(!1),[Se,Ne]=s.useState(!1),[Ce,Ee]=s.useState(!!document.fullscreenElement),Pe=s.useCallback(()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("logo")+1)%e.length;ce(e[t])},[]);e.useEffect(()=>{const e=()=>{Ee(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),e.useEffect(()=>{},[]);const Te=s.useRef(null);e.useEffect(()=>{if(!he)return;const e=e=>{he&&Te.current&&!Te.current.contains(e.target)&&me(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[he]);const Ae=()=>{try{const e=c.map(e=>e.id),t={};c.forEach(e=>{e.channels.forEach((n,a)=>{const s=ne.filter(t=>t.patternId===e.id&&t.channelIndex===a);s.length>0&&(t[e.id]||(t[e.id]={}),t[e.id][a]=s.reduce((e,t)=>(e[t.parameter]=t,e),{}))})}),RE(H,_,$,c,e,Object.keys(t).length>0?t:void 0,Z.length>0?Z:void 0,ne.length>0?ne:void 0,{prettify:!0},L),tg.success("Song downloaded!",2e3)}catch(e){tg.error("Failed to download file")}},_e=async e=>{T&&j(),se.releaseAll(),ie(!0);try{let t,n;if(e.nativeData?.patterns){const{format:n,patterns:a,importMetadata:s,instruments:r}=e.nativeData,o=s.originalChannelCount,i=r?.map(e=>e.name)||[];if("XM"===n)t=QE(a,o,s,i,e.arrayBuffer);else if("MOD"===n)t=ZE(a,o,s,i,e.arrayBuffer);else{if("FUR"!==n&&"DMF"!==n)return void tg.error(`Unsupported native format: ${n}`);{const e=s.modData?.patternOrderTable||[],n=a[0]?.length||64,r=s.originalChannelCount||a[0]?.[0]?.length||4;t={patterns:a.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:n,importMetadata:s,channels:Array.from({length:r},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:i}}}}else{if(!e.metadata.song)return void tg.error(`Module "${e.metadata.title}" has no pattern data`);t=XE(e.metadata.song)}if(e.nativeData?.instruments){const t=e.nativeData.instruments,a=e.nativeData.format;n=t.flatMap(e=>eP(e,e.id,a))}else n=aT(t.patterns,t.instrumentNames);q(n),g(t.patterns),t.order&&t.order.length>0&&(v(t.order),u(t.order[0])),K({name:e.metadata.title,author:"",description:`Imported from ${e.metadata.type}`});const a=e.nativeData?.importMetadata.modData?.initialBPM;a&&I(a);const s=e.nativeData?.importMetadata.modData?.initialSpeed;s&&O(s),tg.success(`Imported ${e.metadata.type}: ${e.metadata.title}`,3e3),await se.preloadInstruments(n)}catch(t){tg.error("Failed to import module")}finally{ie(!1)}},Ie=c[d],De=Ie?.length||64,Oe=c.length,Fe=T&&!A,Re=T&&A;return wn.jsxs("div",{className:"ft2-toolbar "+(J?"ft2-toolbar-compact":""),children:[wn.jsx("button",{className:"panel-collapse-toggle",onClick:ee,children:J?wn.jsx(Me,{size:12}):wn.jsx(xt,{size:12})}),wn.jsxs("div",{className:"flex min-w-0 overflow-hidden",children:[wn.jsxs("div",{className:"flex-shrink min-w-0",children:[wn.jsxs("div",{className:"ft2-toolbar-row",children:[wn.jsxs("div",{className:"ft2-section ft2-col-1",children:[wn.jsx(qN,{label:"Position",value:x,onChange:e=>{w(e)},min:0,max:b.length-1,format:"hex"}),wn.jsxs("div",{className:"flex gap-1 ml-auto",children:[wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>E(x),className:"min-w-[32px]",children:"Ins"}),wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>{b.length>1&&P(x)},disabled:b.length<=1,className:"min-w-[32px]",children:"Del"})]})]}),wn.jsxs("div",{className:"ft2-section ft2-col-2",children:[wn.jsx(qN,{label:"BPM",value:_,onChange:I,min:32,max:255,throttleMs:50}),wn.jsx(Ob,{variant:pe?"primary":"default",size:"sm",onClick:de,title:`Tap Tempo (${ue} taps)`,className:"min-w-[40px] ml-1",children:wn.jsx(Ut,{size:14})})]}),wn.jsx("div",{className:"ft2-section ft2-col-3",children:wn.jsx(qN,{label:"Pattern",value:b[x]??d,onChange:e=>{const t=[...b];t[x]=e,v(t),u(e)},min:0,max:c.length-1,format:"hex"})}),wn.jsx("div",{className:"ft2-section ft2-col-instrument",children:wn.jsx(JN,{})}),wn.jsxs("div",{className:"ft2-section ft2-section-playback",children:[wn.jsx(Ob,{variant:Fe?"danger":"primary",size:"sm",onClick:async()=>{T&&!A?j():(T&&j(),F(!1),await se.init(),R())},className:"min-w-[72px]",children:Fe?"Stop Song":"Play Song"}),wn.jsx(Ob,{variant:Re?"danger":"primary",size:"sm",onClick:async()=>{T&&A?j():(T&&j(),F(!0),await se.init(),R())},className:"min-w-[88px]",children:Re?"Stop Pattern":"Play Pattern"}),wn.jsx(Ob,{variant:k?"danger":"default",size:"sm",className:"min-w-[48px]",onClick:M,children:k?" Rec":"Rec"})]})]}),!J&&wn.jsxs("div",{className:"ft2-toolbar-row",children:[wn.jsx("div",{className:"ft2-section ft2-col-1",children:wn.jsx(qN,{label:"Song Len",value:Oe,onChange:e=>{const t=c.length;if(e>t)for(let n=t;n<e;n++)h(De);else if(e<t&&e>=1)for(let n=t-1;n>=e;n--)p(n)},min:1,max:256,format:"hex"})}),wn.jsxs("div",{className:"ft2-section ft2-col-2",children:[wn.jsx(qN,{label:"Speed",value:D,onChange:O,min:1,max:31,format:"hex"}),wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>ye(!0),title:`Groove & Swing Settings (Current: ${Ba.find(e=>e.id===L)?.name||"None"})`,className:"min-w-[32px] ml-1 "+("straight"!==L||V!==(U?50:100)||z>0?"text-accent-primary font-bold shadow-glow-sm border-accent-primary/50":""),children:"Groove"}),fe&&wn.jsx(NC,{onClose:()=>ye(!1)})]}),wn.jsx("div",{className:"ft2-section ft2-col-3",children:wn.jsx(qN,{label:"Length",value:De,onChange:e=>{e>=1&&e<=256&&y(d,e)},min:1,max:256,format:"hex",presets:[{label:"16 rows",value:16},{label:"32 rows",value:32},{label:"48 rows",value:48},{label:"64 rows (default)",value:64},{label:"96 rows",value:96},{label:"128 rows",value:128},{label:"192 rows",value:192},{label:"256 rows (max)",value:256}]})}),wn.jsx("div",{className:"ft2-section ft2-col-4"})]}),!J&&wn.jsxs("div",{className:"ft2-toolbar-row",children:[wn.jsx("div",{className:"ft2-section ft2-col-1",children:wn.jsx(qN,{label:"Edit Step",value:S,onChange:N,min:0,max:16,format:"hex"})}),wn.jsx("div",{className:"ft2-section ft2-col-2",children:wn.jsxs("div",{className:"ft2-numeric-group",children:[wn.jsx("span",{className:"ft2-numeric-label",children:"Modify:"}),wn.jsxs("div",{className:"flex gap-1 ml-1",children:[wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>m?.(d),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Expand"}),wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>f?.(d),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Shrink"})]})]})}),wn.jsx("div",{className:"ft2-section ft2-col-3"}),wn.jsx("div",{className:"ft2-section ft2-col-4"})]}),wn.jsx("div",{className:"ft2-toolbar-row ft2-toolbar-row-menu",children:wn.jsxs("div",{className:"ft2-section",children:[wn.jsx("input",{ref:re,type:"file",accept:nT,onChange:async e=>{const t=e.target.files?.[0];if(t)if(e.target.value="",vN(t.name))xe(!0);else{T&&(j(),se.releaseAll()),ie(!0);try{if(t.name.toLowerCase().endsWith(".xml")){const e=await t.text(),n=t.name.replace(".xml","")||"Imported Pattern",{pattern:a}=QP(e,n),s=[...c,a];return g(s),u(s.length-1),tg.success(`Loaded DB303 pattern: ${a.name}`),void ie(!1)}if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return".mid"===t||".midi"===t}(t.name)){const e=await $P(t,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64}),n=aT(e.patterns,[]);g(e.patterns),q(n),K({name:e.metadata.name,author:"",description:`Imported from ${t.name} (${e.metadata.tracks} tracks)`}),I(e.bpm),tg.success(`Loaded MIDI: ${e.metadata.name}`)}else{const e=await BE(t);if(!e)return void tg.error("Failed to import song");const{needsMigration:n,migrateProject:a}=await An(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>ky);return{needsMigration:e,migrateProject:t}},void 0);let s=e.patterns,r=e.instruments;if(n(s,r)){const e=a(s,r);s=e.patterns,r=e.instruments}if(g(s),e.sequence&&Array.isArray(e.sequence)){const t=new Map(s.map((e,t)=>[e.id,t])),n=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);n.length>0&&v(n)}r&&q(r),e.masterEffects&&Ly.getState().setMasterEffects(e.masterEffects),I(e.bpm),K(e.metadata),B(e.grooveTemplateId||"straight"),tg.success(`Loaded: ${e.metadata?.name||t.name}`)}}catch(n){tg.error(`Failed to load ${t.name}`)}finally{ie(!1)}}},className:"hidden"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>ke(!0),disabled:oe,loading:oe,children:"Load"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:Ae,children:W?"Save*":"Save"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:Ae,children:"Download"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:t,children:"Export"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>ae(),icon:wn.jsx(Gt,{size:14}),iconPosition:"left",children:"New"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>Ne(!0),children:"Clear"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:o,children:"Order"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:r,children:"Instruments"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:i,children:"Pads"}),wn.jsx(Ob,{variant:l?"primary":"ghost",size:"sm",onClick:a,children:"Master FX"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:n,children:"Help"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>ve(!0),children:"Settings"}),wn.jsx(Ob,{variant:Ce?"primary":"ghost",size:"sm",onClick:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},title:Ce?"Exit Fullscreen (F11)":"Enter Fullscreen (F11)",children:Ce?wn.jsx(_t,{size:14}):wn.jsx(At,{size:14})})]})})]}),wn.jsxs("div",{className:"flex-1 min-w-[120px] flex items-center justify-center border-l border-dark-border px-2 cursor-pointer relative group bg-black overflow-hidden rounded-[6px] m-1",onClick:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf(le)+1)%e.length;ce(e[t])},children:[wn.jsxs("div",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-text-muted opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["v",Pv]}),te&&wn.jsxs(wn.Fragment,{children:[("waveform"===le||"spectrum"===le)&&wn.jsx(eC,{width:"auto",height:J?70:100,mode:le}),"channels"===le&&wn.jsx(tC,{height:J?70:100}),"logo"===le&&wn.jsx(nC,{height:J?70:100,onComplete:Pe}),"circular"===le&&wn.jsx(aC,{height:J?70:100}),"bars"===le&&wn.jsx(sC,{height:J?70:100}),"particles"===le&&wn.jsx(rC,{height:J?70:100}),"chanWaves"===le&&wn.jsx(oC,{height:J?70:100}),"chanActivity"===le&&wn.jsx(iC,{height:J?70:100}),"chanSpectrum"===le&&wn.jsx(lC,{height:J?70:100}),"chanCircular"===le&&wn.jsx(cC,{height:J?70:100}),"chanParticles"===le&&wn.jsx(dC,{height:J?70:100}),"chanRings"===le&&wn.jsx(uC,{height:J?70:100}),"chanTunnel"===le&&wn.jsx(pC,{height:J?70:100}),"chanRadar"===le&&wn.jsx(hC,{height:J?70:100}),"chanNibbles"===le&&wn.jsx(wC,{height:J?70:100,onExit:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("chanNibbles")+1)%e.length;ce(e[t])}}),"sineScroll"===le&&wn.jsx(kC,{height:J?70:100})]})]})]}),ge&&wn.jsx(MC,{onClose:()=>ve(!1)}),wn.jsx(wN,{isOpen:be,onClose:()=>xe(!1),onImport:_e}),wn.jsx(OE,{isOpen:we,onClose:()=>ke(!1),mode:"load",onLoad:async(e,t)=>{T&&(j(),se.releaseAll());try{if("string"==typeof e&&t.toLowerCase().endsWith(".xml"))try{const n=e.includes("<db303-preset"),a=e.includes("<db303-pattern");if(n){const{parseDb303Preset:n}=await An(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-BMwWFetk.js");return{parseDb303Preset:e}},[]),a=n(e);let s=$.find(e=>"TB303"===e.synthType);if(!s){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();X(t),s=t}const r={...s.tb303,...a};Y(s.id,{tb303:r});$.find(e=>e.id===s.id);return void tg.success(`Loaded DB303 preset: ${t.replace(".xml","")}`)}if(a){const n=t.replace(".xml","")||"Imported Pattern";let a=$.find(e=>"TB303"===e.synthType);if(!a){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();X(t),a=t}const{pattern:s,tempo:r}=QP(e,n,a.id);s.channels[0].instrumentId=a.id;const o=[...c,s];return g(o),u(o.length-1),v([o.length-1]),void 0!==r&&I(r),void tg.success(`Loaded DB303 pattern: ${s.name} (${s.length} steps${r?`, ${r} BPM`:""})`)}return void tg.error("Unknown XML format. Expected db303-pattern or db303-preset.")}catch(n){return void tg.error(`Failed to parse XML: ${n instanceof Error?n.message:"Unknown error"}`)}const{needsMigration:a,migrateProject:s}=await An(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>ky);return{needsMigration:e,migrateProject:t}},void 0);let r=e.patterns,o=e.instruments;if(a(r,o)){const e=s(r,o);r=e.patterns,o=e.instruments}if(r&&(g(r),e.sequence&&Array.isArray(e.sequence))){const t=new Map(r.map((e,t)=>[e.id,t])),n=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);n.length>0&&v(n)}o&&q(o),e.metadata&&K(e.metadata),e.bpm&&I(e.bpm),B(e.grooveTemplateId||"straight"),tg.success(`Loaded: ${e.metadata?.name||t}`)}catch(a){tg.error("Failed to load file")}},onLoadTrackerModule:async(e,t)=>{T&&(j(),se.releaseAll());try{const n=t.toLowerCase();if(n.endsWith(".sqs")||n.endsWith(".seq")){const{parseTD3File:t}=await An(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:n}=await An(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-BjkPGM14.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{loadPatterns:a,setCurrentPattern:s,setPatternOrder:r}=tf.getState(),{instruments:o,addInstrument:i}=Py.getState();let l=o.find(e=>"TB303"===e.synthType);if(!l){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();i(t),l=t}const c=await t(e);if(0===c.patterns.length)return void tg.error("No patterns found in file");const d=l.id,u=c.patterns.map((e,t)=>{const a=n(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${l.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:l.id,color:"#ec4899",rows:a.slice(0,s).map(e=>({...e,instrument:e.note?d:0}))}]}});a(u),s(0),r(u.map((e,t)=>t)),tg.success(`Imported ${u.length} TD-3 pattern(s)`)}else{const{loadModuleFile:n}=await An(async()=>{const{loadModuleFile:e}=await Promise.resolve().then(()=>xN);return{loadModuleFile:e}},void 0),a=await n(new File([e],t));a&&await _e(a)}}catch(n){tg.error("Failed to load file")}}}),Se&&wn.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60",children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl",children:[wn.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Clear Project"}),wn.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"What would you like to clear?"}),wn.jsxs("div",{className:"flex flex-col gap-2",children:[wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>{T&&(j(),se.releaseAll()),Q(),Ne(!1),tg.success("Instruments cleared")},children:"Clear Instruments"}),wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>{T&&(j(),se.releaseAll()),C(),Ne(!1),tg.success("Song data cleared")},children:"Clear Song Data"}),wn.jsx(Ob,{variant:"default",size:"sm",onClick:()=>{T&&(j(),se.releaseAll()),Q(),C(),Ne(!1),tg.success("Project cleared")},children:"Clear Both"}),wn.jsx(Ob,{variant:"danger",size:"sm",onClick:()=>{T&&(j(),se.releaseAll()),Q(),C(),G(),Ne(!1),tg.success("Reset to defaults")},children:"Reset to Defaults"}),wn.jsx(Ob,{variant:"ghost",size:"sm",onClick:()=>Ne(!1),children:"Cancel"})]})]})})]})},rT=200,oT=s.memo(({config:e,onChange:t,onPresetLoad:n,isBuzz3o3:a=!1})=>{const r=s.useRef(null),[o,i]=s.useState({mods:!1,lfo:!1,effects:!1}),l=s.useRef(e);l.current=e;const[c,d]=s.useState(1200);s.useLayoutEffect(()=>{const e=()=>{if(r.current?.parentElement){const e=r.current.parentElement.clientWidth-32;d(Math.max(1e3,e))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const u=(e,n)=>{t({filter:{...l.current.filter,[e]:n}})},p=(e,n)=>{t({filterEnvelope:{...l.current.filterEnvelope,[e]:n}})},h=(e,n)=>{const a=l.current.devilFish||{enabled:!1,normalDecay:.5,accentDecay:.5,vegDecay:.5,vegSustain:0,softAttack:0,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"};t({devilFish:{...a,[e]:n}})},m=(e,n)=>{t({oscillator:{...l.current.oscillator,[e]:n}})},f=(e,n)=>{const a=l.current.lfo||{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0};t({lfo:{...a,[e]:n}})},y=(e,n)=>{const a=l.current.chorus||{enabled:!1,mode:1,mix:.3};t({chorus:{...a,[e]:n}})},g=(e,n)=>{const a=l.current.phaser||{enabled:!1,rate:.5,depth:.5,feedback:.3,mix:.3};t({phaser:{...a,[e]:n}})},v=(e,n)=>{const a=l.current.delay||{enabled:!1,time:.25,feedback:.3,tone:.7,mix:.25,stereo:.5};t({delay:{...a,[e]:n}})},b=({label:e,expanded:t,onToggle:n,x:a,y:s,width:r,colorClass:o="text-accent-primary"})=>wn.jsx("div",{style:{left:`${a}px`,top:`${s}px`,width:`${r}px`,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",zIndex:10,pointerEvents:"auto"},onClick:n,className:"group",children:wn.jsxs("div",{className:Wt("flex items-center gap-2 px-4 py-1.5 rounded-full bg-black/60 border border-white/10 group-hover:border-white/30 group-hover:bg-black/80 transition-all shadow-lg",o,t?"opacity-100":"opacity-70"),children:[t?wn.jsx(Me,{size:14}):wn.jsx(Oe,{size:14}),wn.jsx("span",{className:"text-[11px] font-bold uppercase tracking-[0.15em]",children:e})]})}),x=(e,t,n,a,s=0)=>({left:`${e}px`,top:`${t+s}px`,width:`${n}px`,height:`${a}px`,position:"absolute"}),w=(e,t,n,a=0)=>({left:`${e}px`,top:`${t+a}px`,width:`${n}px`,position:"absolute",textAlign:"center",fontSize:"10px",fontWeight:"bold",color:"#888",textTransform:"uppercase",letterSpacing:"0.08em"}),k=40,S=230,M=165,N=o.mods,C=!a&&o.lfo,E=!a&&o.effects,P=N?0:-230,T=P+(C?0:-165),A=325+(N?S:0)+(a?0:k+(C?M:0))+(a?0:k+(E?175:0));return wn.jsx("div",{ref:r,className:"w-full overflow-visible flex justify-center py-4 select-none",style:{minHeight:`${A+32}px`,transition:"min-height 0.3s ease-out"},children:wn.jsxs("div",{className:"relative bg-[#1a1a1a] rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border-b-8 border-r-4 border-black/40 overflow-hidden",style:{width:`${c}px`,height:`${A}px`,background:"linear-gradient(180deg, #252525 0%, #1a1a1a 100%)",transition:"all 0.3s ease-out"},children:[wn.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[wn.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-black/20"}),wn.jsx("div",{className:"absolute top-[110px] left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]"}),wn.jsx("div",{style:w(40,115,400),className:"text-accent-primary opacity-80",children:"Filter & Envelope"}),wn.jsx("div",{style:w(670,115,80),className:"text-accent-primary opacity-80",children:"Output"}),wn.jsx("div",{style:{...w(c-360,115,320),textAlign:"right",paddingRight:"20px"},className:"text-cyan-400 opacity-80",children:"Oscillator"}),wn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:"285px"}}),wn.jsx(b,{label:"Modifications",expanded:N,onToggle:()=>i(e=>({...e,mods:!e.mods})),x:40,y:292,width:c-80,colorClass:"text-red-500"}),!a&&wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${325+(N?S:0)}px`,transition:"top 0.3s ease-out"}}),wn.jsx(b,{label:"LFO (Modulation)",expanded:o.lfo,onToggle:()=>i(e=>({...e,lfo:!e.lfo})),x:40,y:332+(N?S:0),width:c-80,colorClass:"text-purple-500"})]}),!a&&wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:`${325+(N?S:0)+k+(C?M:0)}px`,transition:"top 0.3s ease-out"}}),wn.jsx(b,{label:"Built-in Effects",expanded:o.effects,onToggle:()=>i(e=>({...e,effects:!e.effects})),x:40,y:332+(N?S:0)+k+(C?M:0),width:c-80,colorClass:"text-green-500"})]})]}),wn.jsx("div",{style:x(40,145,65,80),children:wn.jsx(Ab,{value:e.tuning??.5,min:0,max:1,defaultValue:.5,bipolar:!0,onChange:e=>{t({tuning:e})},label:"Tune",size:"md",color:"#ffcc00",formatValue:e=>(e-.5>0?"+":"")+Math.round(100*(e-.5))+"c"})}),wn.jsx("div",{style:x(145,145,65,80),children:wn.jsx(Ab,{value:e.filter.cutoff,min:0,max:1,defaultValue:.5,onChange:e=>u("cutoff",e),label:"Cutoff",size:"md",color:"#ffcc00",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"})}),wn.jsx("div",{style:x(250,145,65,80),children:wn.jsx(Ab,{value:e.filter.resonance,min:0,max:1,defaultValue:0,onChange:e=>u("resonance",e),label:"Reso",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(355,145,65,80),children:wn.jsx(Ab,{value:e.filterEnvelope.envMod,min:0,max:1,defaultValue:.5,onChange:e=>p("envMod",e),label:"EnvMod",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(460,145,65,80),children:wn.jsx(Ab,{value:e.filterEnvelope.decay,min:0,max:1,defaultValue:.5,onChange:e=>p("decay",e),label:"Decay",size:"md",color:"#ffcc00",formatValue:e=>Math.round(rT*Math.pow(10,e))+" ms"})}),wn.jsx("div",{style:x(565,145,65,80),children:wn.jsx(Ab,{value:e.accent.amount,min:0,max:1,defaultValue:.5,onChange:e=>{return n="amount",a=e,void t({accent:{...l.current.accent,[n]:a}});var n,a},label:"Accent",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(670,145,65,80),children:wn.jsx(Ab,{value:e.volume??.75,min:0,max:1,defaultValue:.75,onChange:e=>t({volume:e}),label:"Level",size:"md",color:"#00ffff",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsxs("div",{style:{...x(c-360,145,320,80),display:"flex",alignItems:"center",gap:"12px",justifyContent:"flex-end",paddingRight:"20px"},children:[wn.jsx("div",{style:{width:"65px"},children:wn.jsx(Ab,{value:e.oscillator.pulseWidth??1,min:0,max:1,defaultValue:1,onChange:e=>m("pulseWidth",e),label:"PWM",size:"md",color:"#00cccc",formatValue:e=>Math.round(50+49*e)+"%"})}),wn.jsx("div",{style:{width:"65px"},children:wn.jsx(Ab,{value:e.oscillator.subOscGain??0,min:0,max:1,defaultValue:0,onChange:e=>m("subOscGain",e),label:"SubG",size:"md",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:{width:"65px"},children:wn.jsx(Ab,{value:e.oscillator.subOscBlend??1,min:0,max:1,defaultValue:1,onChange:e=>m("subOscBlend",e),label:"SubB",size:"md",color:"#00cccc",formatValue:e=>e<.5?"Mix":"Add"})}),wn.jsx("div",{style:{width:"65px"},children:wn.jsx(Ab,{value:e.oscillator.pitchToPw??0,min:0,max:1,defaultValue:0,onChange:e=>m("pitchToPw",e),label:"PPW",size:"md",color:"#00cccc",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsxs("div",{className:"flex flex-col items-center justify-center",style:{minWidth:"60px"},children:[wn.jsx("span",{className:Wt("text-[9px] font-bold mb-1 transition-colors","sawtooth"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SAW"}),wn.jsx(SC,{label:"",value:"square"===e.oscillator.type,onChange:e=>{return n=e?"square":"sawtooth",void t({oscillator:{...l.current.oscillator,type:n}});var n},color:"#00ffff",size:"sm"}),wn.jsx("span",{className:Wt("text-[9px] font-bold mt-1 transition-colors","square"===e.oscillator.type?"text-cyan-400":"text-gray-600"),children:"SQR"})]})]}),N&&wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{style:x(52,325,50,45),className:"flex flex-col items-center",children:[wn.jsx(SC,{label:"",value:e.devilFish?.enabled||!1,onChange:e=>h("enabled",e),color:"#ff3333",size:"sm"}),wn.jsx("span",{className:"text-[8px] font-bold text-red-500 mt-1",children:"ENABLE"})]}),wn.jsx("div",{style:x(82,295,12,12),className:Wt("rounded-full border border-black/40 transition-all duration-300",e.devilFish?.enabled?"bg-red-500 shadow-[0_0_10px_#ef4444]":"bg-red-950")}),wn.jsx("div",{style:x(125,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.normalDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("normalDecay",e),label:"N.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(rT*Math.pow(10,e))+" ms"})}),wn.jsx("div",{style:x(195,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.accentDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("accentDecay",e),label:"A.Dec",size:"sm",color:"#ff3333",formatValue:e=>Math.round(rT*Math.pow(10,e))+" ms"})}),wn.jsx("div",{style:x(265,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.softAttack??0,min:0,max:1,defaultValue:0,onChange:e=>h("softAttack",e),label:"S.Atk",size:"sm",color:"#ff3333",formatValue:e=>(.3*Math.pow(100,e)).toFixed(1)+" ms"})}),wn.jsx("div",{style:x(335,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.accentSoftAttack??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("accentSoftAttack",e),label:"A.Atk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(405,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.passbandCompensation??.9,min:0,max:1,defaultValue:.9,onChange:e=>h("passbandCompensation",e),label:"Comp",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(475,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.resTracking??.7,min:0,max:1,defaultValue:.7,onChange:e=>h("resTracking",e),label:"R.Trk",size:"sm",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(545,325,40,40),children:wn.jsx(Ab,{value:e.slide?.time??.17,min:0,max:1,defaultValue:.17,onChange:e=>{t({slide:{...l.current.slide,time:e}})},label:"Slide",size:"sm",color:"#ff3333",formatValue:e=>Math.round(2*Math.pow(180,e))+" ms"})}),wn.jsx("div",{style:x(615,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.filterInputDrive??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterInputDrive",e),label:"Drive",size:"sm",color:"#ff3333",formatValue:e=>(10*e).toFixed(1)})}),wn.jsx("div",{style:x(680,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.diodeCharacter??0,min:0,max:1,defaultValue:0,onChange:e=>h("diodeCharacter",e),label:"Diode",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(740,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.duffingAmount??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>h("duffingAmount",e),label:"Duff",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(800,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.filterFmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterFmDepth",e),label:"F.FM",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(860,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.lpBpMix??0,min:0,max:1,defaultValue:0,onChange:e=>h("lpBpMix",e),label:"LP/BP",size:"sm",color:"#ff9900",formatValue:e=>e<.05?"LP":e>.95?"BP":"Mix"})}),wn.jsx("div",{style:x(920,325,40,40),children:wn.jsx(Ab,{value:e.devilFish?.filterTracking??0,min:0,max:1,defaultValue:0,onChange:e=>h("filterTracking",e),label:"K.Trk",size:"sm",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsxs("div",{style:x(980,320,80,50),className:"flex flex-col",children:[wn.jsx("label",{className:"text-[8px] font-bold text-orange-500/70 mb-1 ml-1",children:"FILTER"}),wn.jsxs("select",{value:e.devilFish?.filterSelect??1,onChange:e=>h("filterSelect",parseInt(e.target.value)),className:"bg-[#111] text-[10px] text-orange-400 border border-orange-900/30 rounded px-1 py-1 outline-none focus:border-orange-500",children:[wn.jsx("option",{value:1,children:"303 Lowpass"}),wn.jsx("option",{value:5,children:"Korg Ladder"})]})]}),wn.jsx("div",{style:w(40,380,200),className:"text-cyan-400/60 text-[9px]",children:"KORG FILTER"}),wn.jsx("div",{style:x(60,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.korgBite??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgBite",e),label:"Bite",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),wn.jsx("div",{style:x(120,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.korgClip??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgClip",e),label:"Clip",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),wn.jsx("div",{style:x(180,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.korgCrossmod??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgCrossmod",e),label:"XMod",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),wn.jsx("div",{style:x(240,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.korgQSag??0,min:0,max:1,defaultValue:0,onChange:e=>h("korgQSag",e),label:"Q.Sag",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),wn.jsx("div",{style:x(300,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.korgSharpness??.5,min:0,max:1,defaultValue:.5,onChange:e=>h("korgSharpness",e),label:"Sharp",size:"sm",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%",disabled:5!==e.devilFish?.filterSelect})}),wn.jsx("div",{style:w(400,380,200),className:"text-yellow-400/60 text-[9px]",children:"EXTRAS"}),wn.jsx("div",{style:x(420,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.stageNLAmount??0,min:0,max:1,defaultValue:0,onChange:e=>h("stageNLAmount",e),label:"StgNL",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(480,395,40,40),children:wn.jsx(Ab,{value:e.devilFish?.ensembleAmount??0,min:0,max:1,defaultValue:0,onChange:e=>h("ensembleAmount",e),label:"Ensem",size:"sm",color:"#eab308",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:w(560,380,200),className:"text-gray-400/60 text-[9px]",children:"QUALITY"}),wn.jsxs("div",{style:x(580,390,90,45),className:"flex flex-col",children:[wn.jsx("label",{className:"text-[8px] font-bold text-gray-400/70 mb-1",children:"OVERSAMPLE"}),wn.jsxs("select",{value:e.devilFish?.oversamplingOrder??0,onChange:e=>h("oversamplingOrder",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-gray-300 border border-gray-700 rounded px-1 py-0.5 outline-none focus:border-gray-500",children:[wn.jsx("option",{value:0,children:"Off"}),wn.jsx("option",{value:1,children:"2"}),wn.jsx("option",{value:2,children:"4"}),wn.jsx("option",{value:3,children:"8"}),wn.jsx("option",{value:4,children:"16"})]})]})]}),C&&wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{style:x(60,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.rate??0,min:0,max:1,defaultValue:0,onChange:e=>f("rate",e),label:"Rate",size:"md",color:"#a855f7",formatValue:e=>{const t=.05*Math.pow(400,e);return t>=10?t.toFixed(1)+"Hz":t.toFixed(2)+"Hz"}})}),wn.jsx("div",{style:x(170,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.contour??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>f("contour",e),label:"Contour",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(280,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.pitchDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("pitchDepth",e),label:"Pitch",size:"md",color:"#a855f7",formatValue:e=>"+"+Math.round(12*e)+" semi"})}),wn.jsx("div",{style:x(390,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.pwmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("pwmDepth",e),label:"PWM",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(500,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.filterDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("filterDepth",e),label:"Filter",size:"md",color:"#a855f7",formatValue:e=>"+"+(2*e).toFixed(1)+" oct"})}),wn.jsx("div",{style:x(610,480,65,65,P),children:wn.jsx(Ab,{value:e.lfo?.stiffDepth??0,min:0,max:1,defaultValue:0,onChange:e=>f("stiffDepth",e),label:"Stiff",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(720,483,150,50,P),className:"flex gap-2 items-center",children:[0,1,2].map(t=>wn.jsx("button",{onClick:()=>f("waveform",t),className:Wt("px-2 py-1 text-[10px] font-bold rounded border transition-all",e.lfo?.waveform===t?"bg-purple-500 text-white border-purple-400":"bg-black/40 text-purple-500/60 border-purple-900/30"),children:["SIN","TRI","SQR"][t]},t))})]}),E&&wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{style:w(40,615,120,T),className:"text-green-400/60 text-[10px]",children:"CHORUS"}),wn.jsx("div",{style:x(60,635,40,40,T),children:wn.jsx(SC,{value:e.chorus?.enabled??!1,onChange:e=>y("enabled",e),label:"On",size:"sm"})}),wn.jsxs("div",{style:x(100,632,50,45,T),className:"flex flex-col",children:[wn.jsxs("select",{value:e.chorus?.mode??1,onChange:e=>y("mode",parseInt(e.target.value)),className:"bg-[#111] text-[9px] text-green-400 border border-green-900/30 rounded px-1 py-0.5 outline-none focus:border-green-500",children:[wn.jsx("option",{value:0,children:"Subtle"}),wn.jsx("option",{value:1,children:"Medium"}),wn.jsx("option",{value:2,children:"Wide"})]}),wn.jsx("span",{className:"text-[7px] text-gray-500 mt-0.5 text-center",children:"MODE"})]}),wn.jsx("div",{style:x(155,635,40,40,T),children:wn.jsx(Ab,{value:e.chorus?.mix??.5,min:0,max:1,defaultValue:.5,onChange:e=>y("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:w(200,615,120,T),className:"text-green-400/60 text-[10px]",children:"PHASER"}),wn.jsx("div",{style:x(220,635,40,40,T),children:wn.jsx(Ab,{value:e.phaser?.rate??.5,min:0,max:1,defaultValue:.5,onChange:e=>g("rate",e),label:"Rate",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(270,635,40,40,T),children:wn.jsx(Ab,{value:e.phaser?.depth??.7,min:0,max:1,defaultValue:.7,onChange:e=>g("depth",e),label:"Width",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(320,635,40,40,T),children:wn.jsx(Ab,{value:e.phaser?.feedback??0,min:0,max:1,defaultValue:0,onChange:e=>g("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(370,635,40,40,T),children:wn.jsx(Ab,{value:e.phaser?.mix??0,min:0,max:1,defaultValue:0,onChange:e=>g("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:w(460,615,120,T),className:"text-green-400/60 text-[10px]",children:"DELAY"}),wn.jsx("div",{style:x(480,635,40,40,T),children:wn.jsx(Ab,{value:e.delay?.time??.5,min:0,max:1,defaultValue:.5,onChange:e=>v("time",e),label:"Time",size:"sm",color:"#22c55e",formatValue:e=>(.25+15.75*e).toFixed(2)})}),wn.jsx("div",{style:x(530,635,40,40,T),children:wn.jsx(Ab,{value:e.delay?.feedback??0,min:0,max:1,defaultValue:0,onChange:e=>v("feedback",e),label:"FB",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(580,635,40,40,T),children:wn.jsx(Ab,{value:e.delay?.tone??.5,min:0,max:1,defaultValue:.5,onChange:e=>v("tone",e),label:"Tone",size:"sm",color:"#22c55e",formatValue:e=>e<.4?"LP":e>.6?"HP":"Bypass"})}),wn.jsx("div",{style:x(630,635,40,40,T),children:wn.jsx(Ab,{value:e.delay?.mix??0,min:0,max:1,defaultValue:0,onChange:e=>v("mix",e),label:"Mix",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})}),wn.jsx("div",{style:x(680,635,40,40,T),children:wn.jsx(Ab,{value:e.delay?.stereo??.75,min:0,max:1,defaultValue:.75,onChange:e=>v("stereo",e),label:"Spread",size:"sm",color:"#22c55e",formatValue:e=>Math.round(100*e)+"%"})})]}),wn.jsxs("div",{className:"absolute top-4 left-6 flex items-center gap-4",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("div",{className:"bg-accent-primary p-1 rounded",children:wn.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"3",children:wn.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),wn.jsxs("div",{className:"flex flex-col -space-y-1",children:[wn.jsx("span",{className:"text-white font-black italic text-xl tracking-tighter",children:"DB-303"}),wn.jsx("span",{className:"text-[8px] text-gray-500 font-bold uppercase tracking-widest",children:"TB-303 WASM Engine"})]})]}),wn.jsx("div",{className:"h-8 w-px bg-gray-800"}),wn.jsxs("div",{className:"flex flex-col",children:[wn.jsx("label",{className:"text-[8px] font-bold text-gray-500 mb-1",children:"PRESET"}),wn.jsxs("select",{value:"",onChange:e=>{const a=af.find(t=>t.name===e.target.value);a&&(n?n(a):a.tb303&&t(a.tb303))},className:"bg-[#111] text-[10px] text-accent-primary border border-gray-800 rounded px-2 py-1 outline-none focus:border-accent-primary transition-colors max-w-[160px]",children:[wn.jsx("option",{value:"",disabled:!0,children:"Load Preset..."}),af.map(e=>wn.jsxs("option",{value:e.name,children:[e.name,e.effects?.length?` [${e.effects.length} FX]`:""]},e.name))]})]})]}),wn.jsxs("div",{className:"absolute bottom-2 right-4 text-[8px] text-gray-600 font-mono",children:["V",Pv,"-WASM"]})]})})});oT.displayName="JC303StyledKnobPanel";const iT=s.memo(()=>{const{instruments:e,updateInstrument:t}=Py(Fn(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument}))),{tb303Collapsed:n,toggleTB303Collapsed:a}=Ay(Fn(e=>({tb303Collapsed:e.tb303Collapsed,toggleTB303Collapsed:e.toggleTB303Collapsed}))),{controlledInstrumentId:r}=kg(),o=r?e.find(e=>e.id===r&&"TB303"===e.synthType):e.find(e=>"TB303"===e.synthType),i=s.useCallback(async e=>{if(!o)return;const n={...o.tb303,...e};t(o.id,{tb303:n});const{getToneEngine:a}=await An(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>$m);return{getToneEngine:e}},void 0),s=a().getInstrument(o.id,o);s&&"setCutoff"in s&&Object.entries(e).forEach(([e,t])=>{if(!t||"object"!=typeof t)return void("tuning"===e?s.setTuning(t):"volume"===e&&s.setVolume(t));const n=t;"filter"===e?("cutoff"in n&&s.setCutoff(n.cutoff),"resonance"in n&&s.setResonance(n.resonance)):"filterEnvelope"===e?("envMod"in n&&s.setEnvMod(n.envMod),"decay"in n&&s.setDecay(n.decay)):"accent"===e?"amount"in n&&s.setAccent(n.amount):"oscillator"===e?("type"in n&&s.setWaveform("square"===n.type?1:0),"pulseWidth"in n&&s.setPulseWidth(n.pulseWidth),"subOscGain"in n&&s.setSubOscGain(n.subOscGain),"subOscBlend"in n&&s.setSubOscBlend(n.subOscBlend),"pitchToPw"in n&&s.setPitchToPw(n.pitchToPw)):"slide"===e?"time"in n&&s.setSlideTime(n.time):"devilFish"===e?("enabled"in n&&s.enableDevilFish(n.enabled),"normalDecay"in n&&s.setNormalDecay(n.normalDecay),"accentDecay"in n&&s.setAccentDecay(n.accentDecay),"softAttack"in n&&s.setSoftAttack(n.softAttack),"accentSoftAttack"in n&&s.setAccentSoftAttack(n.accentSoftAttack),"passbandCompensation"in n&&s.setPassbandCompensation(n.passbandCompensation),"resTracking"in n&&s.setResTracking(n.resTracking),"filterInputDrive"in n&&s.setFilterInputDrive(n.filterInputDrive),"diodeCharacter"in n&&s.setDiodeCharacter(n.diodeCharacter),"duffingAmount"in n&&s.setDuffingAmount(n.duffingAmount),"filterFmDepth"in n&&s.setFilterFmDepth(n.filterFmDepth),"lpBpMix"in n&&s.setLpBpMix(n.lpBpMix),"filterTracking"in n&&s.setFilterTracking(n.filterTracking),"filterSelect"in n&&s.setFilterSelect(n.filterSelect),"korgBite"in n&&s.setKorgBite(n.korgBite),"korgClip"in n&&s.setKorgClip(n.korgClip),"korgCrossmod"in n&&s.setKorgCrossmod(n.korgCrossmod),"korgQSag"in n&&s.setKorgQSag(n.korgQSag),"korgSharpness"in n&&s.setKorgSharpness(n.korgSharpness),"stageNLAmount"in n&&s.setStageNLAmount(n.stageNLAmount),"ensembleAmount"in n&&s.setEnsembleAmount(n.ensembleAmount),"oversamplingOrder"in n&&s.setOversamplingOrder(n.oversamplingOrder)):"lfo"===e?("waveform"in n&&s.setLfoWaveform(n.waveform),"rate"in n&&s.setLfoRate(n.rate),"contour"in n&&s.setLfoContour(n.contour),"pitchDepth"in n&&s.setLfoPitchDepth(n.pitchDepth),"pwmDepth"in n&&s.setLfoPwmDepth(n.pwmDepth),"filterDepth"in n&&s.setLfoFilterDepth(n.filterDepth),"stiffDepth"in n&&s.setLfoStiffDepth(n.stiffDepth)):"chorus"===e?("mode"in n&&s.setChorusMode(n.mode),"mix"in n&&s.setChorusMix(n.mix)):"phaser"===e?("rate"in n&&s.setPhaserRate(n.rate),"depth"in n&&s.setPhaserWidth(n.depth),"feedback"in n&&s.setPhaserFeedback(n.feedback),"mix"in n&&s.setPhaserMix(n.mix)):"delay"===e&&("time"in n&&s.setDelayTime(n.time),"feedback"in n&&s.setDelayFeedback(n.feedback),"tone"in n&&s.setDelayTone(n.tone),"mix"in n&&s.setDelayMix(n.mix),"stereo"in n&&s.setDelaySpread(n.stereo))})},[o,t]),l=s.useCallback(async e=>{if(o&&(e.tb303&&i(e.tb303),void 0!==e.effects)){const n=e.effects.map((e,t)=>({...e,id:e.id||`tb303-fx-${Date.now()}-${t}`}));t(o.id,{effects:n});const{getToneEngine:a}=await An(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>$m);return{getToneEngine:e}},void 0),s=a();await s.rebuildInstrumentEffects(o.id,n)}},[o,i,t]);return o&&o.tb303?n?wn.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[wn.jsx("div",{className:"absolute top-0 right-0 z-50",children:wn.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:a,title:"Expand synth panel",children:wn.jsx(Me,{size:16})})}),wn.jsxs("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[wn.jsx("span",{className:"font-bold",children:"TB-303"}),wn.jsxs("span",{className:"text-gray-500",children:["CH",String(e.indexOf(o)+1).padStart(2,"0")]}),wn.jsx("span",{className:"text-gray-400",children:o.name})]})]}):wn.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",maxHeight:"400px",background:"#1a1a1a",borderTop:"1px solid #333",overflow:"auto"},children:[wn.jsxs("div",{className:"sticky top-0 right-0 z-50 flex justify-end gap-1 bg-black/80 p-1",children:[wn.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80",onClick:a,title:"Collapse synth panel",children:wn.jsx(xt,{size:16})}),wn.jsx("button",{className:"p-2 text-gray-400 hover:text-red-400 bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:()=>Ay.getState().setTB303Collapsed(!0),title:"Close synth panel",children:wn.jsx(Ee,{size:16})})]}),wn.jsx("div",{children:wn.jsx(oT,{config:o.tb303,onChange:i,onPresetLoad:l},o.id)})]}):null});iT.displayName="TB303KnobPanel";const lT=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],cT=[1,3,6,8,10],dT=({step:e,stepIndex:t,position:n,onChange:a,onClose:r,onNavigate:o,unitId:i=1})=>{const[l,c]=s.useState(!0),d=s.useRef(null);s.useEffect(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]);const u=s.useCallback(t=>{if(a({note:t}),l)try{const n=Hm(),a=Py.getState().instruments.find(e=>e.id===i);if(a&&n){const s=`${t}${e.octave??2}`;n.triggerNote(i,s,.2,Q(),.8,a,e.accent,e.slide)}}catch(n){}},[a,l,i,e.octave,e.accent,e.slide]),p=s.useCallback(t=>{const n=e.octave===t?2:t;a({octave:n})},[e.octave,a]),h=s.useCallback(t=>{a({[t]:!e[t]})},[e,a]),m={position:"fixed",left:`${n.x}px`,top:`${n.y}px`,transform:"translate(-50%, -100%) translateY(-10px)",zIndex:1e4};return wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"piano-popover-overlay"}),wn.jsxs("div",{ref:d,className:"piano-popover",style:m,children:[wn.jsxs("div",{className:"popover-header",children:[wn.jsxs("div",{className:"step-navigation",children:[wn.jsx("button",{className:"nav-btn",onClick:()=>o("prev"),"aria-label":"Previous step",children:""}),wn.jsxs("div",{className:"step-indicator",children:["Step ",(t+1).toString().padStart(2,"0")]}),wn.jsx("button",{className:"nav-btn",onClick:()=>o("next"),"aria-label":"Next step",children:""})]}),wn.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:""})]}),wn.jsxs("div",{className:"popover-controls",children:[wn.jsxs("div",{className:"control-group",children:[wn.jsx("div",{className:"control-label",children:"Octave"}),wn.jsxs("div",{className:"octave-selector",children:[wn.jsx("button",{className:"octave-select-btn "+(1===e.octave?"active":""),onClick:()=>p(1),children:"DN"}),wn.jsx("button",{className:"octave-select-btn "+(2===e.octave?"active":""),onClick:()=>p(2),children:"MID"}),wn.jsx("button",{className:"octave-select-btn "+(3===e.octave?"active":""),onClick:()=>p(3),children:"UP"})]})]}),wn.jsxs("div",{className:"control-group",children:[wn.jsx("div",{className:"control-label",children:"Modifiers"}),wn.jsxs("div",{className:"modifier-toggles",children:[wn.jsx("button",{className:"modifier-btn accent "+(e.accent?"active":""),onClick:()=>h("accent"),children:wn.jsx("span",{children:"AC"})}),wn.jsx("button",{className:"modifier-btn slide "+(e.slide?"active":""),onClick:()=>h("slide"),children:wn.jsx("span",{children:"SL"})})]})]}),wn.jsxs("div",{className:"control-group",children:[wn.jsx("div",{className:"control-label",children:"TT-303"}),wn.jsxs("div",{className:"modifier-toggles",children:[wn.jsx("button",{className:"modifier-btn mute "+(e.mute?"active":""),onClick:()=>h("mute"),title:"Mute - silent step, data preserved",children:wn.jsx("span",{children:"MT"})}),wn.jsx("button",{className:"modifier-btn hammer "+(e.hammer?"active":""),onClick:()=>h("hammer"),title:"Hammer - legato without pitch glide",children:wn.jsx("span",{children:"HM"})})]})]}),wn.jsxs("div",{className:"preview-toggle",children:[wn.jsx("input",{type:"checkbox",id:`preview-${i}-${t}`,checked:l,onChange:e=>c(e.target.checked)}),wn.jsx("label",{htmlFor:`preview-${i}-${t}`,children:"Preview Sound"})]})]}),wn.jsx("div",{className:"piano-keyboard",children:lT.map((t,n)=>{const a=cT.includes(n),s=e.note===t;return wn.jsx("div",{className:`\n                  piano-key\n                  ${a?"black":"white"}\n                  ${s?"selected":""}\n                `,onClick:()=>u(t),children:wn.jsx("div",{className:"key-label",children:t})},t)})})]})]})},uT=({steps:e,currentStep:t=-1,isPlaying:n=!1,onStepChange:a,onStepToggle:r,unitId:o=1})=>{const[i,l]=s.useState(null),c=s.useRef(null),d=s.useCallback(e=>{r&&r(e)},[r]),u=s.useCallback((e,t)=>{e.stopPropagation();const n=e.target.getBoundingClientRect();l({visible:!0,stepIndex:t,x:n.left+n.width/2,y:n.top})},[]),p=s.useCallback((t,n,s)=>{if(t.stopPropagation(),!a)return;const r=e[n],o=r.octave===s?2:s;a(n,{...r,octave:o})},[e,a]),h=s.useCallback((t,n,s)=>{if(t.stopPropagation(),!a)return;const r=e[n];a(n,{...r,[s]:!r[s]})},[e,a]),m=s.useCallback((t,n)=>{if(!a)return;const s=e[t];a(t,{...s,...n})},[e,a]),f=s.useCallback(()=>{l(null)},[]),y=s.useCallback(e=>{if(!i)return;const t="prev"===e?(i.stepIndex-1+16)%16:(i.stepIndex+1)%16;l({...i,stepIndex:t})},[i]);return wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{ref:c,className:"tb303-sequencer",children:e.map((e,a)=>wn.jsxs("div",{className:`\n              tb303-step\n              ${e.active?"active":""}\n              ${n&&a===t?"current":""}\n            `,onClick:()=>d(a),children:[wn.jsx("div",{className:"step-led"}),wn.jsx("div",{className:"step-note",onClick:e=>u(e,a),children:e.note}),wn.jsxs("div",{className:"step-octave-btns",children:[wn.jsx("div",{className:"octave-btn "+(1===e.octave?"active":""),onClick:e=>p(e,a,1),children:"DN"}),wn.jsx("div",{className:"octave-btn "+(3===e.octave?"active":""),onClick:e=>p(e,a,3),children:"UP"})]}),wn.jsxs("div",{className:"step-toggles",children:[wn.jsx("div",{className:"toggle-btn accent "+(e.accent?"active":""),onClick:e=>h(e,a,"accent"),children:"AC"}),wn.jsx("div",{className:"toggle-btn slide "+(e.slide?"active":""),onClick:e=>h(e,a,"slide"),children:"SL"})]})]},a))}),i?.visible&&wn.jsx(dT,{step:e[i.stepIndex],stepIndex:i.stepIndex,position:{x:i.x,y:i.y},onChange:e=>m(i.stepIndex,e),onClose:f,onNavigate:y,unitId:o})]})},pT=e=>{if("number"==typeof e){if(0===e||97===e)return{note:"C",octave:2};const t=Ga(e),n=t.substring(0,2),a=t.substring(2),s=parseInt(a,10);let r=2;s<=2?r=1:s>=4&&(r=3);return{note:n.replace("-",""),octave:r}}if("string"==typeof e){if(!e||"..."===e||"==="===e)return{note:"C",octave:2};const t=e.substring(0,2),n=e.substring(2),a=parseInt(n,10);let s=2;a<=2?s=1:a>=4&&(s=3);return{note:t.replace("-",""),octave:s}}return{note:"C",octave:2}},hT=(e,t)=>{const n=1===t?2:2===t?3:4;return Ua(`${1===e.length?`${e}-`:e}${n}`)},mT=({channelIndex:e=0})=>{const{patterns:t,currentPatternIndex:n,setCell:a}=tf(),{instruments:r,updateInstrument:o}=Py(),{isPlaying:i,currentRow:l,bpm:c}=Ry(),d=t[n],u=d?.channels[e],p=u?.instrumentId??0,h=r.find(e=>e.id===p),m=i?l%16:-1,[f,y]=s.useState(!1),g=s.useRef(h),v=s.useRef(h?.tb303);g.current=h,v.current=h?.tb303;const b=s.useRef(null),x=s.useCallback(e=>{b.current&&clearTimeout(b.current),b.current=window.setTimeout(()=>{o(p,e),b.current=null},300)},[p,o]),w=h?.tb303,k="square"===w?.oscillator.type?1:0,S=w?.filter.cutoff??1e3,M=w?.filter.resonance??50,N=w?.filterEnvelope.envMod??50,C=w?.filterEnvelope.decay??300,E=w?.accent.amount??50,P=s.useMemo(()=>{if(!d||!d.channels[e])return Array.from({length:16},()=>({active:!1,note:"C",octave:2,accent:!1,slide:!1}));const t=d.channels[e],n=[];for(let e=0;e<16;e++){const a=t.rows[e],s=!(!a||!a.note||0===a.note||97===a.note),{note:r,octave:o}=s?pT(a.note):{note:"C",octave:2};n.push({active:s,note:r,octave:o,accent:!(1!==a?.flag1&&1!==a?.flag2),slide:!(2!==a?.flag1&&2!==a?.flag2)})}return n},[d,e]),T=s.useCallback(e=>{h&&w&&o(p,{tb303:{...w,oscillator:{...w.oscillator,type:e<.5?"sawtooth":"square"}}})},[p,h,w,o]),A=s.useCallback(e=>{const t=v.current;if(!g.current||!t)return;const n={...t,filter:{...t.filter,cutoff:e}};Hm().updateTB303Parameters(p,n),x({tb303:n})},[p,x]),_=s.useCallback(e=>{const t=v.current;if(!g.current||!t)return;const n={...t,filter:{...t.filter,resonance:e}};Hm().updateTB303Parameters(p,n),x({tb303:n})},[p,x]),I=s.useCallback(e=>{const t=v.current;if(!g.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,envMod:e}};Hm().updateTB303Parameters(p,n),x({tb303:n})},[p,x]),D=s.useCallback(e=>{const t=v.current;if(!g.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,decay:e}};Hm().updateTB303Parameters(p,n),x({tb303:n})},[p,x]),O=s.useCallback(e=>{const t=v.current;if(!g.current||!t)return;const n={...t,accent:{...t.accent,amount:e}};Hm().updateTB303Parameters(p,n),x({tb303:n})},[p,x]),F=s.useCallback((t,n)=>{a(e,t,{note:n.active?hT(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[e,a]),R=s.useCallback(t=>{const n=P[t],s=!n.active;a(e,t,{note:s?hT(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[e,a,P]);return h?w||"TB303"===h.synthType||"Buzz3o3"===h.synthType?wn.jsxs("div",{className:"tb303-view",children:[wn.jsxs(wn.Fragment,{children:[wn.jsxs("div",{className:"tb303-transport",children:[i&&wn.jsxs("div",{className:"transport-step",children:["Step ",(m+1).toString().padStart(2,"0"),"/16 @ ",c," BPM"]}),wn.jsx("div",{className:"transport-spacer"}),wn.jsxs("button",{onClick:()=>y(!0),className:"pattern-btn acid",children:[wn.jsx(nt,{size:16}),wn.jsx("span",{children:"Acid"})]}),wn.jsxs("button",{onClick:()=>{const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let n=0;n<16;n++){const s=Math.random()>.3,r=t[Math.floor(Math.random()*t.length)],o=Math.floor(3*Math.random())+1,i=Math.random()>.7,l=Math.random()>.8;a(e,n,{note:s?hT(r,o):0,flag1:i?1:0,flag2:l?2:0})}},className:"pattern-btn randomize",children:[wn.jsx(wt,{size:16}),wn.jsx("span",{children:"Random"})]}),wn.jsxs("button",{onClick:()=>{for(let t=0;t<16;t++)a(e,t,{note:0,flag1:0,flag2:0})},className:"pattern-btn clear",children:[wn.jsx(Re,{size:16}),wn.jsx("span",{children:"Clear"})]})]}),wn.jsxs("div",{className:"tb303-sequencer-section",children:[wn.jsx("h3",{className:"section-title",children:"Pattern Sequencer"}),wn.jsx(uT,{steps:P,currentStep:m,isPlaying:i,onStepChange:F,onStepToggle:R,unitId:1})]}),wn.jsxs("div",{className:"tb303-params-section",children:[wn.jsx("h3",{className:"section-title",children:"TB-303 Parameters"}),wn.jsxs("div",{className:"params-grid",children:[wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Waveform",value:k,min:0,max:1,step:.01,onChange:T,bipolar:!1,size:"md"}),wn.jsx("div",{className:"param-value",children:k<.5?"Saw":"Square"})]}),wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Cutoff",value:S,min:200,max:5e3,logarithmic:!0,onChange:A,bipolar:!1,size:"md"}),wn.jsxs("div",{className:"param-value",children:[Math.round(S),"Hz"]})]}),wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Resonance",value:M,min:0,max:100,onChange:_,bipolar:!1,size:"md"}),wn.jsxs("div",{className:"param-value",children:[M,"%"]})]}),wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Env Mod",value:N,min:0,max:100,onChange:I,bipolar:!1,size:"md"}),wn.jsxs("div",{className:"param-value",children:[N,"%"]})]}),wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Decay",value:C,min:200,max:2e3,logarithmic:!0,onChange:D,bipolar:!1,size:"md"}),wn.jsxs("div",{className:"param-value",children:[Math.round(C),"ms"]})]}),wn.jsxs("div",{className:"param-item",children:[wn.jsx(Ab,{label:"Accent",value:E,min:0,max:100,onChange:O,bipolar:!1,size:"md"}),wn.jsxs("div",{className:"param-value",children:[E,"%"]})]})]})]})]}),f&&wn.jsx(Jx,{channelIndex:e,onClose:()=>y(!1)})]}):wn.jsx("div",{className:"tb303-view",children:wn.jsxs("div",{className:"tb303-error",children:["Channel ",e+1," is using ",h.synthType,", not TB-303"]})}):wn.jsx("div",{className:"tb303-view",children:wn.jsxs("div",{className:"tb303-error",children:["No instrument assigned to channel ",e+1]})})},fT=[{id:"pattern",label:"Pattern",icon:wn.jsx(Kt,{size:20})},{id:"instruments",label:"Instruments",icon:wn.jsx(jt,{size:20})},{id:"controls",label:"Controls",icon:wn.jsx(Ht,{size:20})}],yT=({activeTab:e,onTabChange:t})=>wn.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-dark-bgSecondary border-t border-dark-border safe-area-bottom",children:wn.jsx("div",{className:"flex items-stretch",children:fT.filter(e=>e&&e.icon).map(n=>{const a=e===n.id;return wn.jsxs("button",{onClick:()=>t(n.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-1\n                py-2 min-h-[56px] transition-colors\n                ${a?"text-accent-primary bg-accent-primary/10":"text-text-muted hover:text-text-secondary active:bg-dark-bgTertiary"}\n              `,"aria-current":a?"page":void 0,children:[wn.jsx("span",{className:a?"scale-110 transition-transform":"",children:n.icon}),wn.jsx("span",{className:"text-[10px] font-medium",children:n.label})]},n.id)})})}),gT=({isOpen:e,currentName:t,onConfirm:n,onClose:a})=>{const[r,o]=s.useState(t),i=s.useRef(null);s.useEffect(()=>{e&&(o(t),setTimeout(()=>i.current?.select(),0))},[e,t]);return e?Xb.createPortal(wn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:a,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between mb-4",children:[wn.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Instrument"}),wn.jsx("button",{onClick:a,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:wn.jsx(Ee,{size:14})})]}),wn.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&r!==t&&n(r.trim()),a()},children:[wn.jsx("input",{ref:i,type:"text",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Escape"===e.key&&a()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter instrument name",autoFocus:!0}),wn.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[wn.jsx("button",{type:"button",onClick:a,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),wn.jsx("button",{type:"submit",disabled:!r.trim()||r===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})]})]})]})}),document.body):null},vT=({isOpen:e,title:t,message:n,confirmLabel:a="Confirm",danger:r=!1,onConfirm:o,onClose:i})=>{const l=s.useCallback(e=>{"Escape"===e.key?i():"Enter"===e.key&&(o(),i())},[i,o]);return s.useEffect(()=>{if(e)return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,l]),e?Xb.createPortal(wn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:i,children:wn.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[wn.jsxs("div",{className:"flex items-center justify-between mb-3",children:[wn.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:t}),wn.jsx("button",{onClick:i,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:wn.jsx(Ee,{size:14})})]}),wn.jsx("p",{className:"text-sm text-text-secondary mb-4",children:n}),wn.jsxs("div",{className:"flex justify-end gap-2",children:[wn.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),wn.jsx("button",{onClick:()=>{o(),i()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(r?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:a})]})]})}),document.body):null},bT=({instrumentId:e,onEdit:t,onSavePreset:n,children:a})=>{const{position:r,open:o,close:i,isOpen:l}=ex(),{instruments:c,setCurrentInstrument:d,cloneInstrument:u,deleteInstrument:p,updateInstrument:h}=Py(),[m,f]=s.useState(!1),[y,g]=s.useState(!1),v=c.find(t=>t.id===e),b=c.length>1,x=s.useCallback(t=>{h(e,{name:t})},[e,h]),w=s.useCallback(()=>{h(e,{synthType:"Synth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0})},[e,h]),k=s.useMemo(()=>v?[{id:"edit",label:"Edit",icon:wn.jsx($t,{size:14}),onClick:()=>{d(e),t?.()}},{type:"divider"},{id:"duplicate",label:"Duplicate",icon:wn.jsx(He,{size:14}),onClick:()=>u(e)},{id:"delete",label:"Delete",icon:wn.jsx(Re,{size:14}),danger:!0,disabled:!b,onClick:()=>p(e)},{type:"divider"},{id:"rename",label:"Rename",icon:wn.jsx(qt,{size:14}),onClick:()=>f(!0)},{type:"divider"},{id:"copy-settings",label:"Copy Settings",icon:wn.jsx(Yt,{size:14}),onClick:()=>{localStorage.setItem("devilbox-instrument-clipboard",JSON.stringify(v))}},{id:"paste-settings",label:"Paste Settings",icon:wn.jsx(st,{size:14}),onClick:()=>{const t=localStorage.getItem("devilbox-instrument-clipboard");if(t)try{const n=JSON.parse(t),{id:a,name:s,...r}=n;h(e,r)}catch(n){}}},{type:"divider"},{id:"save-preset",label:"Save as Preset",icon:wn.jsx($e,{size:14}),onClick:()=>{n?.()}},{id:"reset",label:"Reset to Default",icon:wn.jsx(gt,{size:14}),danger:!0,onClick:()=>g(!0)}]:[],[v,e,b,d,u,p,h,t,n]);return wn.jsxs("div",{onContextMenu:o,children:[a,l&&wn.jsx(Zb,{items:k,position:r,onClose:i}),wn.jsx(gT,{isOpen:m,currentName:v?.name||"",onConfirm:x,onClose:()=>f(!1)}),wn.jsx(vT,{isOpen:y,title:"Reset Instrument",message:"Reset this instrument to default settings? This cannot be undone.",confirmLabel:"Reset",danger:!0,onConfirm:w,onClose:()=>g(!1)})]})},xT=({onClose:e})=>{const{currentInstrumentId:t,updateInstrument:n,setPreviewInstrument:a}=Py(),{userPresets:r,deletePreset:o,addToRecent:i,exportPresets:l,importPresets:c,importNKSFFiles:d,exportAllPresetsAsNKSF:u}=Sv(),[p,h]=s.useState("factory"),[m,f]=s.useState("Bass"),[y,g]=s.useState("All"),[v,b]=s.useState(""),[x,w]=s.useState(null),[k,S]=s.useState(null),M=s.useRef(null),N=s.useRef(null),C=Object.keys(oy),E=e=>{h(e),w(null),S(null),b("")},P=s.useMemo(()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);return e?e.config:null}return"factory"===p&&x&&oy[m].find(e=>e.name===x)||null},[p,x,m,k,r]);s.useEffect(()=>{const t=t=>{"Escape"===t.key&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),s.useEffect(()=>{if(P){const t={...P,id:999,isLive:!0};a(t);try{Hm().invalidateInstrument(999)}catch(e){}}else a(null);return()=>{a(null)}},[P,a]),s.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=Hm(),n={...P,id:999,isLive:!0};e.triggerPolyNoteAttack(999,t,1,n)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&P){const e=Hm(),n={...P,id:999,isLive:!0};e.triggerPolyNoteRelease(999,t,n)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[P]);const T=e=>Rt[e]||jt,A=s.useMemo(()=>{const e=oy[m]||[];if(!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(t)||e.synthType?.toLowerCase().includes(t))},[m,v]),_=s.useMemo(()=>{let e=r;if("All"!==y&&(e=e.filter(e=>e.category===y)),!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.synthType.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},[r,y,v]),I=a=>{null!==t&&(n(t,a),e())},D=(a,s)=>{null!==t&&(i(a),n(t,s),e())},O=e=>({Bass:"text-blue-400",Leads:"text-yellow-400",Pads:"text-purple-400",Drums:"text-red-400","TR-808":"text-red-500","TR-909":"text-orange-400","TR-707":"text-rose-400","TR-505":"text-amber-400",Chip:"text-cyan-400",Furnace:"text-teal-400",FX:"text-green-400",Dub:"text-green-400",DubSiren:"text-red-500",SpaceLaser:"text-green-500",V2:"text-amber-500",Sam:"text-amber-500",Synare:"text-yellow-500",Drumnibus:"text-emerald-400",Keys:"text-amber-600",MAME:"text-pink-400",Module:"text-lime-400",Lead:"text-yellow-400",Pad:"text-purple-400",Drum:"text-red-400",User:"text-gray-400",All:"text-ft2-highlight"}[e]||"text-ft2-highlight"),F="factory"===p?A.length:_.length;return wn.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:[wn.jsxs("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden",children:[wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[wn.jsxs("div",{children:[wn.jsx("h2",{className:"text-ft2-highlight font-bold text-sm uppercase tracking-widest",children:"LOAD PRESET"}),wn.jsx("p",{className:"text-ft2-textDim text-[10px]",children:"Browse, Jam and Load sounds"})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsxs("div",{className:"flex bg-ft2-bg rounded overflow-hidden border border-ft2-border",children:[wn.jsx("button",{onClick:()=>E("factory"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("factory"===p?"bg-ft2-cursor text-ft2-bg":"text-ft2-textDim hover:text-ft2-text"),children:"Factory"}),wn.jsxs("button",{onClick:()=>E("user"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("user"===p?"bg-amber-500 text-black":"text-ft2-textDim hover:text-ft2-text"),children:["User (",r.length,")"]})]}),wn.jsx("button",{onClick:e,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:wn.jsx(Ee,{size:20})})]})]}),wn.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border",children:wn.jsxs("div",{className:"relative",children:[wn.jsx(St,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"}),wn.jsx("input",{type:"text",value:v,onChange:e=>b(e.target.value),placeholder:"factory"===p?"Search factory presets...":"Search user presets by name, synth type, or tag...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none placeholder:text-ft2-textDim/50",autoFocus:!0})]})}),wn.jsx("div",{className:"flex flex-wrap gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border",children:"factory"===p?C.map(e=>{const t=m===e;return wn.jsx("button",{onClick:()=>(e=>{f(e),w(null),b("")})(e),className:`\n                    px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                    ${t?"bg-ft2-cursor text-ft2-bg shadow-[0_0_15px_rgba(255,255,255,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${O(e)}`}\n                  `,children:e},e)}):wn.jsxs(wn.Fragment,{children:[["All","Bass","Lead","Pad","Drum","FX","User"].map(e=>{const t=y===e;return wn.jsx("button",{onClick:()=>{g(e),S(null)},className:`\n                      px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                      ${t?"bg-amber-500 text-black shadow-[0_0_15px_rgba(245,158,11,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-amber-500/50 ${O(e)}`}\n                    `,children:e},e)}),wn.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[wn.jsxs("button",{onClick:()=>M.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import presets from JSON file",children:[wn.jsx(Ct,{size:10})," Import"]}),wn.jsxs("button",{onClick:()=>N.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import .nksf preset files",children:[wn.jsx(Ct,{size:10})," NKSF"]}),wn.jsxs("button",{onClick:()=>{const e=l();if(0===e.length)return void tg.warning("No user presets to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="devilbox-presets.json",a.click(),URL.revokeObjectURL(n),tg.success(`Exported ${e.length} presets`,2e3)},className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all user presets as JSON",children:[wn.jsx(Ue,{size:10})," Export"]}),wn.jsxs("button",{onClick:()=>u("DEViLBOX User"),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all presets as .nksf files",children:[wn.jsx(Ue,{size:10})," NKS"]})]})]})}),wn.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:"factory"===p?0===A.length?wn.jsxs("div",{className:"flex items-center justify-center h-full text-ft2-textDim font-mono text-sm uppercase",children:['No presets found matching "',v,'"']}):wn.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:A.map((e,t)=>{const n=ZN(e.synthType||"Synth"),a=T(n.icon),s=x===e.name;return wn.jsxs("button",{onClick:()=>(e=>{w(e.name||null),S(null);const t=Hm(),n={...e,id:999,isLive:!0};t.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{t.triggerPolyNoteRelease(999,"C4",n)},300)})(e),onDoubleClick:()=>I(e),className:`\n                        p-3 rounded border-2 text-left transition-all group\n                        ${s?"bg-ft2-cursor text-ft2-bg border-ft2-cursor shadow-[0_0_20px_rgba(255,255,255,0.1)]":"bg-ft2-header border-ft2-border hover:border-ft2-highlight hover:bg-ft2-bg"}\n                      `,children:[wn.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[wn.jsx(a,{size:14,className:s?"text-ft2-bg":n.color}),wn.jsx("span",{className:"font-bold text-sm truncate "+(s?"text-ft2-bg":"text-ft2-text"),children:e.name})]}),wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsx("span",{className:"text-[10px] font-mono uppercase "+(s?"text-ft2-bg/80":"text-ft2-textDim"),children:e.synthType}),e.effects&&e.effects.length>0&&wn.jsxs("span",{className:"text-[9px] px-1.5 font-bold rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-green-600/20 text-green-400"),children:[e.effects.length," FX"]})]})]},`${m}-${e.name}-${t}`)})}):0===_.length?wn.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-ft2-textDim",children:[wn.jsx("span",{className:"font-mono text-sm uppercase",children:0===r.length?"No user presets yet":`No presets matching "${v}"`}),0===r.length&&wn.jsx("p",{className:"text-xs text-center max-w-md",children:"Save presets from the instrument editor to build your library. You can also import presets using the buttons above."})]}):wn.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:_.map(e=>{const t=ZN(e.synthType),n=T(t.icon),a=k===e.id;return wn.jsxs("div",{onClick:()=>((e,t)=>{S(e),w(null);const n=Hm(),a={...t,id:999,isLive:!0};n.triggerPolyNoteAttack(999,"C4",1,a),setTimeout(()=>{n.triggerPolyNoteRelease(999,"C4",a)},300)})(e.id,e.config),onDoubleClick:()=>D(e.id,e.config),className:`\n                        p-3 rounded border-2 text-left transition-all group cursor-pointer relative\n                        ${a?"bg-amber-500 text-black border-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]":"bg-ft2-header border-ft2-border hover:border-amber-500/50 hover:bg-ft2-bg"}\n                      `,children:[wn.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),o(t),k===t&&S(null),tg.success("Preset deleted",2e3)})(t,e.id),className:"absolute top-1 right-1 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(a?"hover:bg-black/20 text-black/60":"hover:bg-red-500/20 text-red-400/60 hover:text-red-400"),title:"Delete preset",children:wn.jsx(Re,{size:12})}),wn.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[wn.jsx(n,{size:14,className:a?"text-black":t.color}),wn.jsx("span",{className:"font-bold text-sm truncate "+(a?"text-black":"text-ft2-text"),children:e.name})]}),wn.jsxs("div",{className:"flex items-center justify-between mb-1",children:[wn.jsx("span",{className:"text-[10px] font-mono uppercase "+(a?"text-black/70":"text-ft2-textDim"),children:e.synthType}),wn.jsx("span",{className:"text-[9px] px-1.5 font-bold rounded "+(a?"bg-black/10 text-black/70":"bg-amber-500/10 text-amber-400"),children:e.category})]}),e.tags.length>0&&wn.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,3).map(e=>wn.jsxs("span",{className:"text-[8px] px-1 rounded flex items-center gap-0.5 "+(a?"bg-black/10 text-black/60":"bg-ft2-bg text-ft2-textDim"),children:[wn.jsx(Xt,{size:7}),e]},e))})]},e.id)})})},`${p}-${m}-${y}`),wn.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-t-2 border-ft2-border",children:[wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsxs("div",{className:"text-ft2-textDim text-xs font-mono",children:[F," PRESET",1!==F?"S":"","  ","factory"===p?m.toUpperCase():"All"===y?"ALL USER":y.toUpperCase(),(x||k)&&wn.jsx("span",{className:"ml-2 text-ft2-text",children:" DOUBLE-CLICK TO APPLY"})]}),P&&wn.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[wn.jsx(_e,{size:12,className:"text-amber-400 fill-amber-400"}),wn.jsx("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"})]})]}),wn.jsxs("div",{className:"flex gap-2",children:[wn.jsx("button",{onClick:e,className:"px-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors font-bold text-xs uppercase",children:"Cancel"}),wn.jsxs("button",{onClick:()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);e&&D(e.id,e.config)}else P&&I(P)},disabled:!P,className:"flex items-center gap-2 px-6 py-2 bg-ft2-cursor text-ft2-bg font-black hover:bg-ft2-highlight rounded transition-all disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs",children:[wn.jsx(Fe,{size:16}),"Load Preset"]})]})]})]}),wn.jsx("input",{ref:M,type:"file",accept:".json",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const e=JSON.parse(n.result);Array.isArray(e)?(c(e),tg.success(`Imported ${e.length} presets`,2e3)):tg.error("Invalid preset file format")}catch{tg.error("Failed to parse preset file")}},n.readAsText(t),M.current&&(M.current.value="")}}),wn.jsx("input",{ref:N,type:"file",accept:".nksf",multiple:!0,className:"hidden",onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const n=await d(Array.from(t));n.length>0?tg.success(`Imported ${n.length} NKSF presets`,2e3):tg.error("Failed to import NKSF files"),N.current&&(N.current.value="")}})]})},wT=s.memo(({compact:e=!1,maxHeight:t="300px",showActions:n=!0,onInstrumentChange:a,showPreviewOnClick:r=!1,showSamplePackButton:o=!1,showPresetButton:i=!1,showEditButton:l=!1,onEditInstrument:c,variant:d="default",onCreateNew:u})=>{const{instruments:p,currentInstrumentId:h,setCurrentInstrument:m,createInstrument:f,deleteInstrument:y,cloneInstrument:g,updateInstrument:v}=Py(Fn(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument,createInstrument:e.createInstrument,deleteInstrument:e.deleteInstrument,cloneInstrument:e.cloneInstrument,updateInstrument:e.updateInstrument}))),{useHexNumbers:b,setShowSamplePackModal:x}=Ay(Fn(e=>({useHexNumbers:e.useHexNumbers,setShowSamplePackModal:e.setShowSamplePackModal}))),w=s.useRef(null),k=s.useRef(null),S=s.useRef(null),M=s.useRef(null),[N,C]=s.useState(!1),[E,P]=s.useState(null),[T,A]=s.useState(""),_="ft2"===d;s.useEffect(()=>{k.current&&w.current&&k.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[h]);const I=s.useCallback(async e=>{if(r)try{await ye(),S.current&&window.clearTimeout(S.current);const t=Hm(),n="TB303"===e.synthType||e.name.toLowerCase().includes("bass")?"C3":"C4",a=Q();t.triggerNoteAttack(e.id,n,a,.8,e),S.current=window.setTimeout(()=>{t.triggerNoteRelease(e.id,n,Q(),e)},300)}catch(t){}},[r]),D=(e,t)=>{m(e),a?.(e),r&&I(t)},O=(e,t)=>{e.stopPropagation(),p.length>1&&y(t)},F=(e,t)=>{e.stopPropagation(),g(t)},R=(e,t,n)=>{e.stopPropagation(),P(t),A(n),setTimeout(()=>M.current?.focus(),0)},j=()=>{null!==E&&T.trim()&&v(E,{name:T.trim()}),P(null),A("")},L=e=>{"Enter"===e.key?j():"Escape"===e.key&&(P(null),A(""))},B=[...p].sort((e,t)=>e.id-t.id),V=_&&(i||o||l);return wn.jsxs("div",{className:"flex flex-col h-full "+(_?"bg-ft2-bg border-l border-ft2-border":""),children:[V&&wn.jsx("div",{className:"px-2 py-2 bg-ft2-header border-b border-ft2-border flex-shrink-0",children:wn.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[wn.jsxs("button",{onClick:()=>{if(_){f(Wf[0])}else f()},className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Add new instrument (303 Classic)",children:[wn.jsx(Ye,{size:14}),wn.jsx("span",{className:"text-[8px] font-bold",children:"ADD"})]}),i&&wn.jsxs("button",{onClick:()=>C(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Load preset into current instrument",children:[wn.jsx(Lt,{size:14}),wn.jsx("span",{className:"text-[8px] font-bold",children:"PRESET"})]}),o&&wn.jsxs("button",{onClick:()=>x(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-green-600 text-green-400 hover:bg-green-600 hover:text-ft2-bg transition-colors",title:"Browse sample packs",children:[wn.jsx(Qt,{size:14}),wn.jsx("span",{className:"text-[8px] font-bold",children:"SAMPLE"})]}),l&&wn.jsxs("button",{onClick:()=>c?.(h),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Edit current instrument",children:[wn.jsx(Zt,{size:14}),wn.jsx("span",{className:"text-[8px] font-bold",children:"EDIT"})]})]})}),wn.jsx("div",{ref:w,className:"flex-1 overflow-y-auto "+(_?"scrollbar-ft2 min-h-0":"scrollbar-modern"),style:_?void 0:{maxHeight:t},children:wn.jsx("div",{className:"flex flex-col divide-y divide-ft2-border/30",children:B.map(t=>{const a=ZN(t.synthType),s=t.id===h,r=Rt[a?.icon||"Music2"]||jt;return _?wn.jsxs("div",{ref:s?k:void 0,onClick:()=>D(t.id,t),className:`\n                  instrument-list-item\n                  flex items-center gap-2 px-2 py-1.5 cursor-pointer border-b border-ft2-border\n                  transition-colors group\n                  ${s?"bg-ft2-cursor text-ft2-bg":"hover:bg-ft2-header text-ft2-text"}\n                `,children:[wn.jsx("span",{className:"font-mono text-xs font-bold w-6 "+(s?"text-ft2-bg":"text-ft2-highlight"),children:b?t.id.toString(16).toUpperCase().padStart(2,"0"):t.id.toString(10).padStart(2,"0")}),wn.jsx(r,{size:12,className:s?"text-ft2-bg":a?.color||"text-ft2-highlight"}),E===t.id?wn.jsx("input",{ref:M,type:"text",value:T,onChange:e=>A(e.target.value),onBlur:j,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-xs font-mono bg-ft2-bg border border-ft2-cursor px-1 py-0.5 rounded text-ft2-text focus:outline-none w-24",autoFocus:!0}):wn.jsx("span",{className:"text-xs font-mono whitespace-nowrap cursor-text",onDoubleClick:e=>R(e,t.id,t.name),title:"Double-click to rename",children:t.name}),wn.jsx("span",{className:"text-[9px] px-1 rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-ft2-header text-ft2-textDim"),children:a?.shortName||t.synthType}),n&&wn.jsxs("div",{className:`instrument-action-buttons flex gap-0.5 ${s?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[wn.jsx("button",{onClick:e=>F(e,t.id),className:"p-0.5 rounded "+(s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"),title:"Duplicate",children:wn.jsx(He,{size:10})}),p.length>1&&wn.jsx("button",{onClick:e=>O(e,t.id),className:`p-0.5 rounded ${s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-red-400`,title:"Delete",children:wn.jsx(Re,{size:10})})]})]},t.id):wn.jsx(bT,{instrumentId:t.id,children:wn.jsxs("div",{ref:s?k:void 0,onClick:()=>D(t.id,t),className:`\n                  group flex items-center gap-2 px-3 py-2 cursor-pointer transition-all\n                  ${s?"bg-accent-primary/20 border-l-2 border-accent-primary":"hover:bg-dark-bgHover border-l-2 border-transparent"}\n                `,children:[wn.jsx("span",{className:`\n                    font-mono text-xs w-6 text-center\n                    ${s?"text-accent-primary":"text-text-muted"}\n                  `,children:String(t.id).padStart(2,"0")}),wn.jsx(r,{size:e?12:14,className:a?.color||"text-accent-primary"}),E===t.id?wn.jsx("input",{ref:M,type:"text",value:T,onChange:e=>A(e.target.value),onBlur:j,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-sm bg-dark-bg border border-accent-primary px-1 py-0.5 rounded text-text-primary focus:outline-none w-28",autoFocus:!0}):wn.jsx("span",{className:`\n                      text-sm whitespace-nowrap cursor-text\n                      ${s?"text-text-primary":"text-text-secondary"}\n                    `,onDoubleClick:e=>R(e,t.id,t.name),title:"Double-click to rename",children:t.name}),!e&&wn.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:a?.shortName||t.synthType}),t.sample?.loop&&wn.jsx("span",{className:"text-text-muted ml-auto",title:"pingpong"===t.sample.loopType?"Ping-pong loop":"Forward loop",children:"pingpong"===t.sample.loopType?wn.jsx(Qe,{size:10,className:"text-blue-400"}):wn.jsx(Jt,{size:10,className:"text-green-400"})}),n&&wn.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[wn.jsx("button",{onClick:e=>F(e,t.id),className:"p-1 text-text-muted hover:text-accent-primary",title:"Clone instrument",children:wn.jsx(He,{size:12})}),p.length>1&&wn.jsx("button",{onClick:e=>O(e,t.id),className:"p-1 text-text-muted hover:text-accent-error",title:"Delete instrument",children:wn.jsx(Re,{size:12})})]})]})},t.id)})})}),wn.jsx("div",{className:_?"px-3 py-1.5 bg-ft2-header border-t border-ft2-border":"px-3 py-1 border-t border-dark-border bg-dark-bgSecondary",children:wn.jsxs("span",{className:_?"text-ft2-textDim text-[10px] font-mono":"text-[10px] text-text-muted",children:[p.length," instrument",1!==p.length?"s":""]})}),N&&wn.jsx(xT,{onClose:()=>C(!1)})]})});wT.displayName="InstrumentList";const kT=({onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:a,onShowInstruments:r,showPatterns:o,showMasterFX:i})=>{const[l,c]=s.useState("pattern"),{isPlaying:d,togglePlayPause:u}=Ry(),{patterns:p,currentPatternIndex:h}=tf(),m=p[h];return wn.jsxs("div",{className:"flex flex-col flex-1 min-h-0 bg-dark-bg",children:[wn.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-3 py-2 bg-dark-bgSecondary border-b border-dark-border",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("span",{className:"text-xs text-text-muted",children:"PAT"}),wn.jsx("span",{className:"text-sm font-bold text-accent-primary",children:(h+1).toString().padStart(2,"0")}),wn.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:m?.name||"Untitled"})]}),wn.jsx("div",{className:"flex items-center gap-1",children:wn.jsx("button",{onClick:u,className:`\n              p-2 rounded-lg transition-colors touch-target\n              ${d?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-primary hover:bg-dark-bgHover"}\n            `,children:d?wn.jsx(Et,{size:18}):wn.jsx(Pt,{size:18})})})]}),wn.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden mobile-bottom-padding",children:["pattern"===l&&wn.jsx(Ax,{}),"instruments"===l&&wn.jsx("div",{className:"h-full overflow-y-auto",children:wn.jsx(wT,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})}),"controls"===l&&wn.jsxs("div",{className:"h-full overflow-y-auto",children:[wn.jsx("div",{className:"p-4 border-b border-dark-border",children:wn.jsx(iT,{})}),wn.jsx("div",{className:"p-2",children:wn.jsx(sT,{onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:a,onShowInstruments:r,showPatterns:o,showMasterFX:i})})]})]}),wn.jsx(yT,{activeTab:l,onTabChange:c})]})};const ST=e.memo(({verticalZoom:e,scrollY:t,visibleNotes:n,containerHeight:a,activeNotes:r=new Set,scaleNotes:o,onNoteClick:i,onNotePreview:l,onNoteRelease:c})=>{const d=s.useCallback(e=>{l?.(e),i?.(e)},[i,l]),u=s.useCallback(()=>{c?.()},[c]),p=s.useMemo(()=>{const e=[],a=Math.min(127,t+n),s=Math.max(0,t);for(let t=a;t>=s;t--){const n=t%12,a=!o||o.has(n);e.push({midiNote:t,isBlack:Tg(t),name:Pg(t),inScale:a})}return e},[t,n,o]);return wn.jsx("div",{className:"flex flex-col bg-gray-900 border-r border-dark-border overflow-hidden shrink-0",style:{width:48,height:a||"auto"},role:"group","aria-label":"Piano keyboard",children:p.map(({midiNote:t,isBlack:n,name:a,inScale:s})=>{const o=t%12==0,i=r.has(t),l=!s;return wn.jsx("div",{className:`\n              flex items-center justify-end pr-1 text-[9px] font-mono cursor-pointer\n              select-none border-b transition-all duration-75 shrink-0\n              ${i?"bg-accent-primary text-text-inverse border-accent-primary brightness-110 shadow-lg":n?"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 "+(l?"opacity-40":""):"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 "+(l?"opacity-40":"")}\n              ${o?"font-bold":""}\n            `,style:{height:e,transform:i?"translateX(2px)":"translateX(0)"},onMouseDown:()=>d(t),onMouseUp:u,onMouseLeave:u,title:a,role:"button","aria-label":`Play ${a}`,"aria-pressed":i,children:o?a:""},t)})})}),MT=e.memo(({note:e,horizontalZoom:t,verticalZoom:n,scrollX:a,scrollY:r,isSelected:o,showVelocity:i,isGhost:l=!1,onSelect:c,onDragStart:d})=>{const u=(e.startRow-a)*t,p=(e.endRow-e.startRow)*t,h=(r+60-e.midiNote)*n;if(u+p<-50||u>3e3||h<-50||h>2e3)return null;const m=s.useCallback(t=>{if(l)return;t.stopPropagation();const n=t.currentTarget.getBoundingClientRect(),a=t.clientX-n.left>p-8;c?.(e.id,t.shiftKey||t.ctrlKey||t.metaKey),d&&d(e.id,a?"resize-end":"move",t)},[e.id,p,l,c,d]),f=e.velocity/127*100,y=["bg-cyan-500","bg-purple-500","bg-green-500","bg-amber-500","bg-pink-500","bg-blue-500","bg-red-500","bg-teal-500"],g=y[e.channelIndex%y.length],v=p>30&&n>=10,b=Pg(e.midiNote);return l?wn.jsx("div",{className:`absolute rounded-sm pointer-events-none ${g}`,style:{left:u,top:h,width:Math.max(4,p-1),height:n-1,opacity:.3,border:"1px dashed rgba(255,255,255,0.5)"}}):wn.jsxs("div",{className:`\n        absolute rounded-sm cursor-move select-none\n        ${g}\n        ${o?"ring-2 ring-accent-primary ring-opacity-100 brightness-125 z-10":"ring-1 ring-black/30"}\n        hover:brightness-125 hover:ring-accent-primary/50 hover:z-20\n        transition-all duration-75\n        shadow-md hover:shadow-lg\n      `,style:{left:u,top:h,width:Math.max(4,p-1),height:n-1,opacity:.8+e.velocity/127*.2},onMouseDown:m,title:`${b} vel:${e.velocity}${e.slide?" [SLIDE]":""}${e.accent?" [ACCENT]":""}`,role:"button","aria-label":`Note ${b}, velocity ${e.velocity}${e.slide?", slide":""}${e.accent?", accent":""}`,tabIndex:0,children:[v&&wn.jsx("span",{className:"absolute left-1 top-0 text-[8px] text-white/80 font-mono leading-none pointer-events-none",style:{lineHeight:n-1+"px"},children:b}),i&&p>20&&wn.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/30 pointer-events-none",style:{height:100-f+"%"}}),e.slide&&wn.jsx("div",{className:"absolute top-0 right-3 w-1.5 h-full bg-yellow-400/60 pointer-events-none"}),e.accent&&wn.jsx("div",{className:"absolute top-0 left-0 w-0 h-0 pointer-events-none",style:{borderLeft:"6px solid rgba(255,100,0,0.8)",borderBottom:"6px solid transparent"}}),wn.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 transition-colors"})]})}),NT=e.memo(({notes:t,patternLength:n,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,gridDivision:l,showVelocity:c,selectedNotes:d,playheadRow:u,containerHeight:p,scaleNotes:h,onNoteSelect:m,onNoteDragStart:f,onGridClick:y,onGridRightClick:g,onScroll:v,onSelectionBoxStart:b})=>{const x=s.useRef(null),w=_g(e=>e.ghostNotes),k=_g(e=>e.drag),[S,M]=e.useState(800);e.useEffect(()=>{const e=()=>{x.current&&M(x.current.clientWidth)};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]);const N=s.useMemo(()=>Math.ceil(S/a)+2,[a,S]),C=s.useMemo(()=>{const e=p||x.current?.clientHeight||400;return Math.ceil(e/r)+2},[r,p]),E=s.useCallback(e=>{e.preventDefault();const t=e.shiftKey?e.deltaY:e.deltaX,n=e.shiftKey?0:e.deltaY;v(t/a,-n/r)},[a,r,v]),P=s.useCallback(e=>{if(!x.current)return;if(2===e.button)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);y(Math.max(0,l),Math.max(0,Math.min(127,c)))},[a,r,o,i,y]),T=s.useCallback(e=>{if(e.preventDefault(),!x.current)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);g(Math.max(0,l),Math.max(0,Math.min(127,c)),e.clientX,e.clientY)},[a,r,o,i,g]),A=s.useCallback(e=>{if(!x.current||0!==e.button)return;const t=x.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(n/a)+o,c=i+60-Math.floor(s/r);b(Math.max(0,l),Math.max(0,Math.min(127,c)),e)},[a,r,o,i,b]),_=s.useMemo(()=>{const e=[],t=n*a,s=Math.max(S,t),c=Math.floor(o),d=Math.ceil(o+N),u=4/l,p=Math.max(d,Math.ceil(S/a+o));for(let r=c;r<=p;r++){const t=(r-o)*a,s=r%4==0,i=r%16==0,l=r>n;(r%u===0||s||i)&&e.push(wn.jsx("div",{className:"absolute top-0 bottom-0 "+(l?"bg-gray-700/20":i?"bg-gray-500/50":s?"bg-gray-600/40":"bg-gray-700/30"),style:{left:t,width:1}},`v-${r}`))}for(let n=0;n<C;n++){const t=i+60-n;if(t<0||t>127)continue;const a=n*r,o=t%12==0,l=Tg(t),c=t%12,d=h&&!h.has(c);e.push(wn.jsx("div",{className:`absolute left-0 ${d?"bg-gray-900/70":l?"bg-gray-800/50":"bg-gray-900/30"} ${o?"border-t border-gray-500/50":""}`,style:{top:a,height:r,width:s}},`h-${t}`))}return e},[o,i,a,r,n,N,C,l,S,h]),I=null!==u?(u-o)*a:null,D=_g(e=>e.tool),O="draw"===D?"cursor-crosshair":"erase"===D?"cursor-not-allowed":"cursor-default",F=s.useMemo(()=>{if("select-box"!==k.mode||!k.isDragging)return null;if(!x.current)return null;const e=x.current.getBoundingClientRect();return{left:Math.min(k.startX,k.currentX)-e.left,top:Math.min(k.startY,k.currentY)-e.top,width:Math.abs(k.currentX-k.startX),height:Math.abs(k.currentY-k.startY)}},[k]);return wn.jsxs("div",{ref:x,className:`flex-1 w-full h-full relative overflow-hidden bg-gray-900 ${O}`,onWheel:E,onClick:P,onContextMenu:T,onMouseDown:A,role:"grid","aria-label":"Piano roll note grid",children:[wn.jsx("div",{className:"absolute inset-0 pointer-events-none",children:_}),w.map(e=>wn.jsx(MT,{note:e,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,isSelected:!1,showVelocity:!1,isGhost:!0},`ghost-${e.id}`)),t.map(e=>wn.jsx(MT,{note:e,horizontalZoom:a,verticalZoom:r,scrollX:o,scrollY:i,isSelected:d.has(e.id),showVelocity:c,onSelect:m,onDragStart:f},e.id)),F&&wn.jsx("div",{className:"absolute border-2 border-accent-primary/60 bg-accent-primary/10 pointer-events-none z-20",style:F}),null!==I&&I>=0&&wn.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent-primary pointer-events-none z-10",style:{left:I}}),wn.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-red-500/50 pointer-events-none",style:{left:(n-o)*a}})]})}),CT=e.memo(({notes:e,horizontalZoom:t,scrollX:n,selectedNotes:a,onVelocityChange:r,onMultiVelocityChange:o,onBeginDrag:i,onDragVelocity:l,onDragMultiVelocity:c,onEndDrag:d})=>{const u=s.useRef(null),[p,h]=s.useState(null),[m,f]=s.useState(null),y=s.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),g=s.useCallback((e,t)=>{if(t.preventDefault(),t.stopPropagation(),h(e),i(),!u.current)return;const n=u.current.getBoundingClientRect(),s=t.clientY-n.top,r=y(s);a.has(e)&&a.size>1?c(Array.from(a),r):l(e,r)},[a,i,l,c,y]),v=s.useCallback(e=>{if(!p||!u.current)return;const t=u.current.getBoundingClientRect(),n=e.clientY-t.top,s=y(n);a.has(p)&&a.size>1?c(Array.from(a),s):l(p,s)},[p,a,l,c,y]),b=s.useCallback(()=>{p&&d(),h(null)},[p,d]),x=s.useMemo(()=>e.map(e=>{const s=(e.startRow-n)*t,r=(e.endRow-e.startRow)*t;if(s+r<0||s>2e3)return null;const o=e.velocity/127*80,i=a.has(e.id),l=m===e.id,c=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],d=c[e.channelIndex%c.length];return wn.jsx("div",{className:"absolute bottom-0 cursor-ns-resize",style:{left:s,width:Math.max(3,r-1),height:o,backgroundColor:d,opacity:i?1:l?.9:.7,border:i?"1px solid #facc15":"none",borderRadius:"2px 2px 0 0",transition:"opacity 75ms"},onMouseDown:t=>g(e.id,t),onMouseEnter:()=>f(e.id),onMouseLeave:()=>f(null),title:`Velocity: ${e.velocity}`},e.id)}).filter(Boolean),[e,t,n,a,m,g]),w=s.useMemo(()=>{const e=[];return[32,64,96,127].forEach((t,n)=>{const a=80-t/127*80;e.push(wn.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:a},children:[wn.jsx("div",{className:"border-t border-gray-700/40 w-full"}),wn.jsx("span",{className:"absolute left-1 text-[8px] text-text-muted/40 -translate-y-full",children:t})]},t))}),e},[]);return wn.jsxs("div",{ref:u,className:"relative bg-gray-900/80 border-t border-dark-border overflow-hidden shrink-0",style:{height:80},onMouseMove:v,onMouseUp:b,onMouseLeave:b,children:[w,wn.jsx("div",{className:"absolute top-1 left-1 text-[9px] text-text-muted/50 pointer-events-none z-10",children:"VEL"}),x]})}),ET=({onCopy:e,onCut:t,onPaste:n,onDelete:a,onSelectAll:r,onQuantize:o,onToggleSlide:i,onToggleAccent:l,hasSelection:c,hasClipboard:d})=>{const{contextMenu:u,hideContextMenu:p}=_g(),h=s.useRef(null);if(s.useEffect(()=>{if(!u.visible)return;const e=e=>{h.current&&!h.current.contains(e.target)&&p()},t=e=>{"Escape"===e.key&&p()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[u.visible,p]),!u.visible)return null;const m=Math.min(u.x,window.innerWidth-200),f=Math.min(u.y,window.innerHeight-260),y={position:"fixed",left:Math.max(0,m),top:Math.max(0,f),zIndex:100},g=({icon:e,label:t,shortcut:n,onClick:a,disabled:s})=>wn.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-1.5 text-xs text-left rounded transition-colors\n        "+(s?"text-text-muted/50 cursor-not-allowed":"text-text-primary hover:bg-dark-bgTertiary"),onClick:()=>{s||(a(),p())},disabled:s,children:[e,wn.jsx("span",{className:"flex-1",children:t}),n&&wn.jsx("span",{className:"text-text-muted text-[10px]",children:n})]}),v=()=>wn.jsx("div",{className:"h-px bg-dark-border mx-2 my-1"});return wn.jsxs("div",{ref:h,className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl py-1 min-w-[180px]",style:y,children:[wn.jsx(g,{icon:wn.jsx(He,{size:12}),label:"Copy",shortcut:"Ctrl+C",onClick:e,disabled:!c}),wn.jsx(g,{icon:wn.jsx(at,{size:12}),label:"Cut",shortcut:"Ctrl+X",onClick:t,disabled:!c}),wn.jsx(g,{icon:wn.jsx(st,{size:12}),label:"Paste",shortcut:"Ctrl+V",onClick:n,disabled:!d}),wn.jsx(g,{icon:wn.jsx(Re,{size:12}),label:"Delete",shortcut:"Del",onClick:a,disabled:!c}),wn.jsx(v,{}),wn.jsx(g,{icon:wn.jsx(en,{size:12}),label:"Select All",shortcut:"Ctrl+A",onClick:r}),wn.jsx(v,{}),wn.jsx(g,{icon:wn.jsx(Kt,{size:12}),label:"Quantize",shortcut:"Q",onClick:o,disabled:!c}),wn.jsx(v,{}),wn.jsx(g,{icon:wn.jsx(tn,{size:12}),label:"Toggle Slide",shortcut:"S",onClick:i,disabled:!c}),wn.jsx(g,{icon:wn.jsx(_e,{size:12}),label:"Toggle Accent",shortcut:"A",onClick:l,disabled:!c})]})};function PT(e,t){return`${e}-${t}`}function TT(e,t,n){for(let a=t+1;a<n;a++){const n=e[a];if(97===n.note)return a-t;if(n.note&&0!==n.note&&97!==n.note)return a-t}return n-t}function AT(e){return JSON.parse(JSON.stringify(e))}function _T(e,t,n,a){(0,zy.getState().pushAction)("EDIT_CELL",a,n,e,JSON.parse(JSON.stringify(t)))}function IT(e){const{patterns:t,currentPatternIndex:n,setCell:a}=tf(),r=t[n],o=s.useMemo(()=>r?function(e,t){const n=[];return(void 0!==t?[e.channels[t]].filter(Boolean):e.channels).forEach((a,s)=>{const r=void 0!==t?t:s;for(let t=0;t<a.rows.length;t++){const s=a.rows[t];if(!s.note||0===s.note||97===s.note)continue;const o=qa(s.note);if(null===o)continue;const i=TT(a.rows,t,e.length),l=s.volume>=16&&s.volume<=80?Math.round((s.volume-16)/64*127):100;n.push({id:PT(r,t),channelIndex:r,startRow:t,endRow:t+i,midiNote:o,velocity:l,instrument:s.instrument,slide:2===s.flag1||2===s.flag2,accent:1===s.flag1||1===s.flag2})}}),n}(r,e):[],[r,e]),i=s.useCallback((t,s,o,i=100,l)=>{const c=l??e??0;if(!r)return;const d=AT(r),u=Ya(t),p=Math.round(i/127*64);a(c,s,{note:u,volume:16+p}),s+o<(r?.length||64)&&a(c,s+o,{note:97});const h=tf.getState().patterns[n];h&&_T(d,h,n,"Add note")},[e,r,n,a]),l=s.useCallback(e=>{const[t,s]=e.split("-"),i=parseInt(t,10),l=parseInt(s,10),c=o.find(t=>t.id===e);if(!c||!r)return;const d=AT(r);if(a(i,l,{note:0,volume:0}),c.endRow<(r?.length||64)){const e=r?.channels[i]?.rows[c.endRow];97===e?.note&&a(i,c.endRow,{note:0})}const u=tf.getState().patterns[n];u&&_T(d,u,n,"Delete note")},[o,r,n,a]),c=s.useCallback(e=>{if(!r||0===e.length)return;const t=AT(r);e.forEach(e=>{const[t,s]=e.split("-"),i=parseInt(t,10),l=parseInt(s,10),c=o.find(t=>t.id===e);if(c&&(a(i,l,{note:0,volume:0}),c.endRow<(r?.length||64))){const e=tf.getState().patterns[n],t=e?.channels[i]?.rows[c.endRow];97===t?.note&&a(i,c.endRow,{note:0})}});const s=tf.getState().patterns[n];s&&_T(t,s,n,`Delete ${e.length} notes`)},[o,r,n,a]),d=s.useCallback((e,t,s)=>{const i=o.find(t=>t.id===e);if(!i||!r)return;const l=AT(r),c=Math.max(0,i.startRow+t),d=Math.max(0,Math.min(127,i.midiNote+s)),u=i.endRow-i.startRow,[p,h]=e.split("-"),m=parseInt(p,10),f=parseInt(h,10);if(a(m,f,{note:0,volume:0}),i.endRow<(r?.length||64)){const e=r?.channels[m]?.rows[i.endRow];97===e?.note&&a(m,i.endRow,{note:0})}const y=Ya(d),g=16+Math.round(i.velocity/127*64);a(i.channelIndex,c,{note:y,volume:g}),c+u<(r?.length||64)&&a(i.channelIndex,c+u,{note:97});const v=tf.getState().patterns[n];v&&_T(l,v,n,"Move note")},[o,r,n,a]),u=s.useCallback((e,t)=>{const s=o.find(t=>t.id===e);if(!s||!r)return;const i=AT(r),l=Math.max(1,t-s.startRow),[c,d]=e.split("-"),u=parseInt(c,10),p=parseInt(d,10);if(a(u,p,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=r?.channels[u]?.rows[s.endRow];97===e?.note&&a(u,s.endRow,{note:0})}const h=Ya(s.midiNote),m=16+Math.round(s.velocity/127*64);a(s.channelIndex,s.startRow,{note:h,volume:m}),s.startRow+l<(r?.length||64)&&a(s.channelIndex,s.startRow+l,{note:97});const f=tf.getState().patterns[n];f&&_T(i,f,n,"Resize note")},[o,r,n,a]),p=s.useCallback((e,t)=>{const[s,o]=e.split("-"),i=parseInt(s,10),l=parseInt(o,10);if(!r)return;const c=AT(r),d=Math.round(t/127*64);a(i,l,{volume:16+d});const u=tf.getState().patterns[n];u&&_T(c,u,n,"Set velocity")},[r,n,a]),h=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=AT(r),o=16+Math.round(t/127*64);e.forEach(e=>{const[t,n]=e.split("-"),s=parseInt(t,10),r=parseInt(n,10);a(s,r,{volume:o})});const i=tf.getState().patterns[n];i&&_T(s,i,n,`Set velocity (${e.length} notes)`)},[r,n,a]),m=s.useRef(null),f=s.useCallback(()=>{r&&(m.current=AT(r))},[r]),y=s.useCallback((e,t)=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10),i=Math.round(t/127*64);a(r,o,{volume:16+i})},[a]),g=s.useCallback((e,t)=>{const n=16+Math.round(t/127*64);e.forEach(e=>{const[t,s]=e.split("-"),r=parseInt(t,10),o=parseInt(s,10);a(r,o,{volume:n})})},[a]),v=s.useCallback(()=>{if(!m.current)return;const e=tf.getState().patterns[n];e&&_T(m.current,e,n,"Adjust velocity"),m.current=null},[n]),b=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=AT(r);e.forEach(e=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10);a(r,o,{flag2:t?2:0})});const o=tf.getState().patterns[n];o&&_T(s,o,n,"Toggle slide")},[r,n,a]),x=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=AT(r);e.forEach(e=>{const[n,s]=e.split("-"),r=parseInt(n,10),o=parseInt(s,10);a(r,o,{flag1:t?1:0})});const o=tf.getState().patterns[n];o&&_T(s,o,n,"Toggle accent")},[r,n,a]),w=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=AT(r),i=Math.max(1,Math.floor(4/t));e.forEach(e=>{const t=o.find(t=>t.id===e);if(!t)return;const s=Math.round(t.startRow/i)*i;if(s===t.startRow)return;const l=t.endRow-t.startRow,[c,d]=e.split("-"),u=parseInt(c,10),p=parseInt(d,10);if(a(u,p,{note:0,volume:0}),t.endRow<(r?.length||64)){const e=tf.getState().patterns[n],s=e?.channels[u]?.rows[t.endRow];97===s?.note&&a(u,t.endRow,{note:0})}const h=Ya(t.midiNote),m=16+Math.round(t.velocity/127*64);a(t.channelIndex,s,{note:h,volume:m}),s+l<(r?.length||64)&&a(t.channelIndex,s+l,{note:97})});const l=tf.getState().patterns[n];l&&_T(s,l,n,"Quantize notes")},[o,r,n,a]),k=s.useCallback((t,s,o,i)=>{if(!r||0===t.notes.length)return;const l=AT(r),c=s-t.minRow,d=o-t.minNote,u=i??e??0;t.notes.forEach(e=>{const t=e.startRow+c,n=Math.max(0,Math.min(127,e.midiNote+d)),s=e.endRow-e.startRow;if(t<0||t>=(r?.length||64))return;const o=Ya(n),i=Math.round(e.velocity/127*64);a(u,t,{note:o,volume:16+i}),t+s<(r?.length||64)&&a(u,t+s,{note:97})});const p=tf.getState().patterns[n];p&&_T(l,p,n,"Paste notes")},[e,r,n,a]);return{notes:o,pattern:r,addNote:i,deleteNote:l,deleteNotes:c,moveNote:d,resizeNote:u,setNoteVelocity:p,setMultipleVelocities:h,beginVelocityDrag:f,setVelocityNoUndo:y,setMultipleVelocitiesNoUndo:g,endVelocityDrag:v,toggleSlide:b,toggleAccent:x,quantizeNotes:w,pasteNotes:k}}const DT={z:0,s:1,x:2,d:3,c:4,v:5,g:6,b:7,h:8,n:9,j:10,m:11,q:12,2:13,w:14,3:15,e:16,r:17,5:18,t:19,6:20,y:21,7:22,u:23,i:24,9:25,o:26,0:27,p:28},OT=({channelIndex:e})=>{const{view:t,selection:n,tool:a,drag:r,clipboard:o,setHorizontalZoom:i,setVerticalZoom:l,setScroll:c,setSnapToGrid:d,setGridDivision:u,setShowVelocity:p,setShowVelocityLane:h,setChannelIndex:m,setMultiChannel:f,setScaleKey:y,setScaleRoot:g,setNoteLengthPreset:v,selectNote:b,selectNotes:x,selectAll:w,clearSelection:k,setTool:S,startDrag:M,updateDrag:N,endDrag:C,copyNotes:E,showContextMenu:P,hideContextMenu:T,setGhostNotes:A}=_g(),{notes:_,pattern:I,addNote:D,deleteNote:O,deleteNotes:F,moveNote:R,resizeNote:j,setNoteVelocity:L,setMultipleVelocities:B,beginVelocityDrag:V,setVelocityNoUndo:z,setMultipleVelocitiesNoUndo:U,endVelocityDrag:G,toggleSlide:W,toggleAccent:K,quantizeNotes:H,pasteNotes:$}=IT(t.multiChannel?void 0:e??t.channelIndex),q=Ry(e=>e.isPlaying),Y=Ry(e=>e.currentRow),{instruments:X,currentInstrumentId:Z}=Py(),J=s.useRef(null),[ee,te]=s.useState(400),[ne,ae]=s.useState(!1),se=s.useRef(null);s.useEffect(()=>{void 0!==e&&m(e)},[e,m]);const re=s.useRef(null),oe=s.useRef(null);s.useEffect(()=>{if(q&&null!==Y){if(oe.current!==I)_g.setState({view:{..._g.getState().view,scrollX:0}}),oe.current=I,re.current=Y;else if(null===re.current||Y>=re.current){const e=48;if((Y-t.scrollX)*t.horizontalZoom>e+t.horizontalZoom){const n=Y-e/t.horizontalZoom;_g.setState({view:{..._g.getState().view,scrollX:Math.max(0,n)}})}re.current=Y}}else re.current=null,oe.current=null},[q,Y,I,t.scrollX,t.horizontalZoom]),s.useEffect(()=>{const e=()=>{if(J.current){const e=J.current.clientHeight-44;te(Math.max(200,e))}};e();const t=new ResizeObserver(e);return J.current&&t.observe(J.current),()=>t.disconnect()},[]);const ie=s.useMemo(()=>Math.ceil(ee/t.verticalZoom)+2,[ee,t.verticalZoom]),le=s.useMemo(()=>Math.floor(ie/12),[ie]),ce=s.useMemo(()=>{if(!q||null===Y)return new Set;const e=new Set;return _.forEach(t=>{Y>=t.startRow&&Y<t.endRow&&e.add(t.midiNote)}),e},[q,Y,_]),de=s.useMemo(()=>{if("chromatic"===t.scaleKey)return;const e=Rx[t.scaleKey];return e?new Set(function(e,t){return e<0||e>11?[]:t.intervals.map(t=>(e+t)%12)}(t.scaleRoot,e)):void 0},[t.scaleKey,t.scaleRoot]),ue=s.useCallback(()=>t.noteLengthPreset>0?t.noteLengthPreset:t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,[t.noteLengthPreset,t.snapToGrid,t.gridDivision]),pe=s.useCallback(e=>{if(!de)return e;if(de.has(e%12))return e;for(let t=1;t<=6;t++){if(de.has((e+t)%12))return e+t;if(de.has((e-t+12)%12))return e-t}return e},[de]),he=s.useCallback(e=>{if(null===Z)return;const t=Hm(),n=X.find(e=>e.id===Z);if(!n)return;const a=Pg(e);se.current=a,t.triggerNoteAttack(Z,a,Q(),.8,n)},[Z,X]),me=s.useCallback(()=>{if(se.current&&null!==Z){Hm().releaseNote(Z,se.current),se.current=null}},[Z]),fe=s.useCallback((e,t)=>{"erase"===a?O(e):b(e,t)},[a,O,b]),ye=s.useCallback((e,t,n)=>{M(t,n.clientX,n.clientY,e)},[M]),ge=s.useCallback((e,n)=>{if(T(),"draw"===a){const a=pe(n),s=ue();D(a,e,s,100,t.channelIndex)}else"select"===a&&(r.isDragging||k())},[a,t.channelIndex,D,k,T,r.isDragging,pe,ue]),ve=s.useCallback((e,t,a,s)=>{const r=_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote);r&&!n.notes.has(r.id)&&b(r.id,!1),P(a,s,r?.id||null,e,t)},[_,n.notes,b,P]),be=s.useCallback((e,t,n)=>{if("select"!==a)return;_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote)||M("select-box",n.clientX,n.clientY)},[a,_,M]),xe=s.useRef(t.scrollX),we=s.useRef(t.scrollY),ke=s.useRef(null),Se=s.useRef(t.scrollX),Me=s.useRef(t.scrollY);s.useEffect(()=>{t.scrollX!==Se.current&&(xe.current=t.scrollX),t.scrollY!==Me.current&&(we.current=t.scrollY),Se.current=t.scrollX,Me.current=t.scrollY},[t.scrollX,t.scrollY]),s.useEffect(()=>()=>{null!==ke.current&&cancelAnimationFrame(ke.current)},[]);const Ne=s.useCallback(()=>{const e=_g.getState().view.scrollX,t=_g.getState().view.scrollY,n=xe.current,a=we.current,s=n-e,r=a-t;if(Math.abs(s)<.1&&Math.abs(r)<.1)return c(n,a),Se.current=n,Me.current=a,void(ke.current=null);const o=e+.25*s,i=t+.25*r;c(o,i),Se.current=o,Me.current=i,ke.current=requestAnimationFrame(Ne)},[c]),Ce=s.useCallback((e,t)=>{xe.current=Math.max(0,xe.current+e),we.current=Math.max(0,Math.min(127,we.current+t)),null===ke.current&&(ke.current=requestAnimationFrame(Ne))},[Ne]);s.useEffect(()=>{const e=e=>{const n=_g.getState().drag;if(n.isDragging){if(N(e.clientX,e.clientY),"move"===n.mode&&n.noteId){const a=e.clientX-n.startX,s=e.clientY-n.startY,r=Math.round(a/t.horizontalZoom),o=-Math.round(s/t.verticalZoom);if(0!==r||0!==o){const e=_.find(e=>e.id===n.noteId);if(e){const t=_g.getState().selection.notes,n=(t.has(e.id)?Array.from(t):[e.id]).map(e=>{const t=_.find(t=>t.id===e);return t?{...t,startRow:Math.max(0,t.startRow+r),endRow:Math.max(1,t.endRow+r),midiNote:Math.max(0,Math.min(127,t.midiNote+o))}:null}).filter(Boolean);A(n)}}}if("select-box"===n.mode){const a=document.querySelector('[role="grid"]');if(!a)return;const s=a.getBoundingClientRect(),r=Math.min(n.startX,e.clientX)-s.left,o=Math.max(n.startX,e.clientX)-s.left,i=Math.min(n.startY,e.clientY)-s.top,l=Math.max(n.startY,e.clientY)-s.top,c=Math.floor(r/t.horizontalZoom)+t.scrollX,d=Math.ceil(o/t.horizontalZoom)+t.scrollX,u=t.scrollY+60-Math.floor(l/t.verticalZoom),p=t.scrollY+60-Math.floor(i/t.verticalZoom),h=_.filter(e=>e.startRow<d&&e.endRow>c&&e.midiNote>=u&&e.midiNote<=p).map(e=>e.id);x(h)}}},n=e=>{const n=_g.getState().drag;if(!n.isDragging)return;if("select-box"===n.mode)return void C();if(!n.noteId)return void C();const a=n.currentX-n.startX,s=n.currentY-n.startY,r=Math.round(a/t.horizontalZoom),o=-Math.round(s/t.verticalZoom);if("move"!==n.mode||0===r&&0===o){if("resize-end"===n.mode){const e=_.find(e=>e.id===n.noteId);e&&j(n.noteId,e.endRow+r)}}else R(n.noteId,r,o);C()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}},[t.horizontalZoom,t.verticalZoom,t.scrollX,t.scrollY,_,R,j,N,C,x,A]);const Ee=s.useCallback(()=>{const e=_.filter(e=>n.notes.has(e.id));e.length>0&&E(e)},[_,n.notes,E]),Pe=s.useCallback(()=>{Ee();const e=Array.from(n.notes);F(e),k()},[Ee,n.notes,F,k]),Te=s.useCallback(()=>{const e=_g.getState().clipboard;e&&$(e,Math.floor(t.scrollX),Math.round(t.scrollY+60),t.channelIndex)},[$,t.scrollX,t.scrollY,t.channelIndex]),_e=s.useCallback(()=>{const e=Array.from(n.notes);F(e),k()},[n.notes,F,k]),Ie=s.useCallback(()=>{w(_.map(e=>e.id))},[_,w]),De=s.useCallback(()=>{const e=Array.from(n.notes);H(e,t.gridDivision)},[n.notes,H,t.gridDivision]),Oe=s.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.slide);W(e,!t)},[_,n.notes,W]),Fe=s.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.accent);K(e,!t)},[_,n.notes,K]),Re=s.useCallback(()=>{const e=zy.getState().undo();e&&tf.getState().replacePattern(tf.getState().currentPatternIndex,e)},[]),je=s.useCallback(()=>{const e=zy.getState().redo();e&&tf.getState().replacePattern(tf.getState().currentPatternIndex,e)},[]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if(e.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const s=e.key,r=s.toLowerCase();if((e.ctrlKey||e.metaKey)&&"z"===r&&!e.shiftKey)return e.preventDefault(),void Re();if((e.ctrlKey||e.metaKey)&&("y"===r||"z"===r&&e.shiftKey))return e.preventDefault(),void je();if((e.ctrlKey||e.metaKey)&&"c"===r)return e.preventDefault(),void Ee();if((e.ctrlKey||e.metaKey)&&"x"===r)return e.preventDefault(),void Pe();if((e.ctrlKey||e.metaKey)&&"v"===r)return e.preventDefault(),void Te();if((e.ctrlKey||e.metaKey)&&"a"===r)return e.preventDefault(),void Ie();if("Delete"===s||"Backspace"===s)return e.preventDefault(),void _e();if("Escape"===s)return e.preventDefault(),k(),void T();if(!e.ctrlKey&&!e.metaKey&&!e.altKey){if("q"===r&&n.notes.size>0&&"select"===a)return e.preventDefault(),void De();if("s"===r&&n.notes.size>0&&"select"===a&&!e.shiftKey&&"select"===a)return e.preventDefault(),void Oe();if("a"===r&&n.notes.size>0&&"select"===a&&!e.shiftKey)return e.preventDefault(),void Fe();if("draw"!==a){if("1"===s)return S("select"),void e.preventDefault();if("2"===s)return S("draw"),void e.preventDefault();if("3"===s)return S("erase"),void e.preventDefault()}}if(!("draw"!==a||e.ctrlKey||e.metaKey||e.altKey||e.repeat)){const n=DT[r];if(void 0!==n){e.preventDefault();const a=tf.getState().currentOctave||4,s=pe(12*a+n),r=Math.floor(t.scrollX),o=ue();return D(s,r,o,100,t.channelIndex),void he(s)}}},s=e=>{const t=e.key.toLowerCase();"draw"===a&&void 0!==DT[t]&&me()};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[a,n.notes,t.scrollX,t.channelIndex,t.gridDivision,_,D,Ee,Pe,Te,_e,Ie,De,Oe,Fe,Re,je,k,T,S,pe,ue,he,me]);const Le=s.useMemo(()=>t.showVelocityLane?ee-80:ee,[ee,t.showVelocityLane]),Be=I?.length||64,Ve=s.useMemo(()=>Object.entries(Rx).map(([e,t])=>({value:e,label:t.name})),[]);return wn.jsxs("div",{ref:J,className:"flex flex-col h-full w-full bg-dark-bgSecondary",role:"application","aria-label":"Piano roll editor",children:[wn.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-border bg-dark-bgTertiary shrink-0 flex-wrap",children:[wn.jsxs("div",{className:"flex items-center bg-dark-bg rounded-md p-0.5",role:"toolbar","aria-label":"Editing tools",children:[wn.jsx("button",{onClick:()=>S("select"),className:"p-1.5 rounded transition-colors "+("select"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Select (1)","aria-pressed":"select"===a,children:wn.jsx(nn,{size:14})}),wn.jsx("button",{onClick:()=>S("draw"),className:"p-1.5 rounded transition-colors "+("draw"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Draw (2)","aria-pressed":"draw"===a,children:wn.jsx(Zt,{size:14})}),wn.jsx("button",{onClick:()=>S("erase"),className:"p-1.5 rounded transition-colors "+("erase"===a?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Erase (3)","aria-pressed":"erase"===a,children:wn.jsx(an,{size:14})})]}),wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx("span",{className:"text-[10px] text-text-muted",children:"H"}),wn.jsx("button",{onClick:()=>i(.8*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out horizontally",children:wn.jsx(sn,{size:14})}),wn.jsx("span",{className:"text-xs text-text-muted w-6 text-center",children:Math.round(t.horizontalZoom)}),wn.jsx("button",{onClick:()=>i(1.25*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in horizontally",children:wn.jsx(rn,{size:14})})]}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx("span",{className:"text-[10px] text-text-muted",children:"V"}),wn.jsx("button",{onClick:()=>l(t.verticalZoom-2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out vertically",children:wn.jsx(_t,{size:14})}),wn.jsxs("span",{className:"text-xs text-text-muted w-10 text-center",title:`${le} octaves visible`,children:[le,"oct"]}),wn.jsx("button",{onClick:()=>l(t.verticalZoom+2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in vertically",children:wn.jsx(At,{size:14})})]}),wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("button",{onClick:()=>d(!t.snapToGrid),className:"p-1 rounded transition-colors "+(t.snapToGrid?"text-accent-primary":"text-text-muted"),title:"Snap to grid","aria-pressed":t.snapToGrid,children:wn.jsx(Kt,{size:14})}),wn.jsxs("select",{value:t.gridDivision,onChange:e=>u(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Grid division","aria-label":"Grid division",children:[wn.jsx("option",{value:1,children:"1/1"}),wn.jsx("option",{value:2,children:"1/2"}),wn.jsx("option",{value:4,children:"1/4"}),wn.jsx("option",{value:8,children:"1/8"}),wn.jsx("option",{value:16,children:"1/16"})]})]}),wn.jsx("select",{value:t.noteLengthPreset,onChange:e=>v(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Note length","aria-label":"Note length preset",children:Ag.map(e=>wn.jsx("option",{value:e.value,children:e.label},e.value))}),wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx(Ae,{size:12,className:"text-text-muted"}),wn.jsx("select",{value:t.scaleRoot,onChange:e=>g(Number(e.target.value)),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary w-10",title:"Root note","aria-label":"Scale root note",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e,t)=>wn.jsx("option",{value:t,children:e},t))}),wn.jsx("select",{value:t.scaleKey,onChange:e=>y(e.target.value),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Scale","aria-label":"Scale type",children:Ve.map(e=>wn.jsx("option",{value:e.value,children:e.label},e.value))})]}),wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsx("button",{onClick:()=>p(!t.showVelocity),className:"p-1 rounded transition-colors "+(t.showVelocity?"text-accent-primary":"text-text-muted"),title:"Show velocity on notes","aria-pressed":t.showVelocity,children:t.showVelocity?wn.jsx(lt,{size:14}):wn.jsx(it,{size:14})}),wn.jsx("button",{onClick:()=>h(!t.showVelocityLane),className:"p-1 rounded transition-colors "+(t.showVelocityLane?"text-accent-primary":"text-text-muted"),title:"Velocity editing lane","aria-pressed":t.showVelocityLane,children:wn.jsx(mt,{size:14})}),wn.jsx("button",{onClick:()=>f(!t.multiChannel),className:"p-1 rounded transition-colors "+(t.multiChannel?"text-accent-primary":"text-text-muted"),title:"Show all channels","aria-pressed":t.multiChannel,children:wn.jsx(en,{size:14})}),wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsxs("button",{onClick:()=>ae(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-text-primary rounded transition-colors",title:"Generate 303 acid pattern",children:[wn.jsx(nt,{size:12}),"Acid"]}),!t.multiChannel&&void 0===e&&I&&wn.jsxs(wn.Fragment,{children:[wn.jsx("div",{className:"w-px h-4 bg-dark-border"}),wn.jsxs("div",{className:"flex items-center gap-1.5",children:[wn.jsx("span",{className:"text-xs text-text-muted",children:"CH"}),wn.jsx("select",{value:t.channelIndex,onChange:e=>m(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary","aria-label":"Channel",children:I.channels.map((e,t)=>wn.jsxs("option",{value:t,children:[String(t+1).padStart(2,"0")," ",e.name?`- ${e.name}`:""]},t))})]})]}),wn.jsx("div",{className:"flex-1"}),wn.jsxs("span",{className:"text-xs text-text-muted",children:[_.length," notes",n.notes.size>0&&` (${n.notes.size} sel)`,o&&` | clip:${o.notes.length}`]})]}),wn.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:[wn.jsxs("div",{className:"flex-1 flex w-full overflow-hidden min-h-0",children:[wn.jsx(ST,{verticalZoom:t.verticalZoom,scrollY:t.scrollY,visibleNotes:ie,containerHeight:Le,activeNotes:ce,scaleNotes:de,onNotePreview:he,onNoteRelease:me}),wn.jsx(NT,{notes:_,patternLength:Be,horizontalZoom:t.horizontalZoom,verticalZoom:t.verticalZoom,scrollX:t.scrollX,scrollY:t.scrollY,gridDivision:t.gridDivision,showVelocity:t.showVelocity,selectedNotes:n.notes,playheadRow:q?Y:null,containerHeight:Le,scaleNotes:de,onNoteSelect:fe,onNoteDragStart:ye,onGridClick:ge,onGridRightClick:ve,onScroll:Ce,onSelectionBoxStart:be})]}),t.showVelocityLane&&wn.jsxs("div",{className:"flex w-full shrink-0",children:[wn.jsx("div",{className:"shrink-0",style:{width:48}})," ",wn.jsx(CT,{notes:_,horizontalZoom:t.horizontalZoom,scrollX:t.scrollX,selectedNotes:n.notes,onVelocityChange:L,onMultiVelocityChange:B,onBeginDrag:V,onDragVelocity:z,onDragMultiVelocity:U,onEndDrag:G})]})]}),wn.jsx(ET,{onCopy:Ee,onCut:Pe,onPaste:Te,onDelete:_e,onSelectAll:Ie,onQuantize:De,onToggleSlide:Oe,onToggleAccent:Fe,hasSelection:n.notes.size>0,hasClipboard:null!==o}),ne&&wn.jsx(Jx,{channelIndex:e??t.channelIndex,onClose:()=>ae(!1)})]})},FT=({curve:e,parameter:t,patternLength:n,onChange:a})=>{const r=s.useRef(null),o=s.useRef(null),[i,l]=s.useState("pencil"),[c,d]=s.useState(!1),[u,p]=s.useState(null),[h,m]=s.useState(800),f=200,y=35,g=10,v="cyan-lineart"===Zy(e=>e.currentThemeId),b=v?"#00ffff":"#00d4aa",x=v?"#00ffff":"#7c3aed",w=v?"rgba(0, 255, 255, 0.3)":"rgba(0, 212, 170, 0.3)",k=v?"#0a2020":"#1a1a1d",S=v?"#0f3030":"#252528",M=v?"#030808":"#0a0a0b",N=v?"#00a0a0":"#606068";s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e)m(t.contentRect.width)});return t.observe(e),m(e.clientWidth),()=>t.disconnect()},[]);const C=h-y-10,E=165,P=s.useCallback(e=>y+e/n*C,[n,C]),T=s.useCallback(e=>g+(1-e)*E,[E]),A=s.useCallback(e=>{const t=(e-y)/C;return Math.round(t*n)},[n,C]),_=s.useCallback(e=>{const t=1-(e-g)/E;return Math.max(0,Math.min(1,t))},[E]),I=s.useCallback(()=>{const t=o.current;if(!t)return;const a=t.getContext("2d");if(a){a.fillStyle=M,a.fillRect(0,0,h,f);for(let e=0;e<=n;e++){const t=P(e),s=e%16==0,r=e%4==0;a.strokeStyle=s?S:k,a.lineWidth=s?1.5:.5,(n<=64||r)&&(a.beginPath(),a.moveTo(t,g),a.lineTo(t,175),a.stroke()),s&&e<n&&(a.fillStyle=N,a.font="9px JetBrains Mono, monospace",a.textAlign="center",a.fillText(e.toString(),t,192))}a.strokeStyle=k,a.lineWidth=.5;for(let e=0;e<=4;e++){const t=g+e/4*E,n=2===e;a.strokeStyle=n?S:k,a.lineWidth=n?1:.5,a.beginPath(),a.moveTo(y,t),a.lineTo(h-10,t),a.stroke()}if(a.fillStyle=N,a.font="9px JetBrains Mono, monospace",a.textAlign="right",a.fillText("1.0",30,14),a.fillText("0.5",30,95.5),a.fillText("0.0",30,178),e.points.length>0){const t=a.createLinearGradient(y,0,h-10,0);t.addColorStop(0,b),t.addColorStop(1,x),a.strokeStyle=t,a.lineWidth=2,a.beginPath();const n=[...e.points].sort((e,t)=>e.row-t.row);n.forEach((t,s)=>{const r=P(t.row),o=T(t.value);if(0===s)a.moveTo(r,o);else if("linear"===e.interpolation)a.lineTo(r,o);else if("exponential"===e.interpolation){const e=n[s-1],t=P(e.row),i=t+.5*(r-t),l=T(e.value);a.quadraticCurveTo(i,l,r,o)}}),a.stroke(),n.forEach((e,t)=>{const n=P(e.row),s=T(e.value);t===u&&(a.fillStyle=w,a.beginPath(),a.arc(n,s,10,0,2*Math.PI),a.fill()),a.fillStyle=t===u?b:x,a.beginPath(),a.arc(n,s,5,0,2*Math.PI),a.fill(),a.fillStyle="#ffffff",a.beginPath(),a.arc(n,s,2,0,2*Math.PI),a.fill()})}}},[e,n,u,P,T,b,x,w,h,M,k,S,N,C,E]);s.useEffect(()=>{I()},[I]);const[D,O]=s.useState(!1),F=()=>{d(!1),O(!1)},R=s.useCallback(t=>{if(("Delete"===t.key||"Backspace"===t.key)&&null!==u){const t=e.points.filter((e,t)=>t!==u);a({...e,points:t}),p(null)}},[u,e,a]);s.useEffect(()=>(window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)),[R]);const j=(t,s)=>{if(t<0||t>n)return;const r=[...e.points],o=r.findIndex(e=>e.row===t);o>=0?r[o].value=s:r.push({row:t,value:s}),a({...e,points:r.sort((e,t)=>e.row-t.row)})},L=t=>{const s=[];for(let e=0;e<=n;e+=4){let a=0;switch(t){case"rampUp":a=e/n;break;case"rampDown":a=1-e/n;break;case"triangle":a=e<n/2?e/n*2:2-e/n*2;break;case"sine":a=(Math.sin(e/n*Math.PI*2-Math.PI/2)+1)/2;break;case"saw":a=e%(n/4)/(n/4);break;case"square":a=e<n/2?1:0;break;case"random":a=Math.random()}s.push({row:e,value:a})}a({...e,points:s})};return wn.jsxs("div",{className:"bg-dark-bg p-4",children:[wn.jsx("div",{className:"text-accent-primary text-sm font-semibold mb-3",children:t.toUpperCase()}),wn.jsxs("div",{className:"flex gap-2 mb-3 flex-wrap",children:[wn.jsxs("div",{className:"flex gap-1 flex-wrap",children:[wn.jsx("button",{onClick:()=>L("rampUp"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Up"}),wn.jsx("button",{onClick:()=>L("rampDown"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Down"}),wn.jsx("button",{onClick:()=>L("triangle"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Triangle"}),wn.jsx("button",{onClick:()=>L("sine"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Sine"}),wn.jsx("button",{onClick:()=>L("random"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Random"})]}),wn.jsx("div",{className:"w-px bg-dark-border mx-1"}),wn.jsx("button",{onClick:()=>{a({...e,points:[]})},className:"px-3 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-accent-error border border-dark-border hover:border-accent-error transition-colors",children:"Clear"})]}),wn.jsx("div",{ref:r,className:"w-full",children:wn.jsx("canvas",{ref:o,width:h,height:f,onMouseDown:t=>{const n=o.current;if(!n)return;const a=n.getBoundingClientRect(),s=n.width/a.width,r=n.height/a.height,l=(t.clientX-a.left)*s,c=(t.clientY-a.top)*r,u=A(l),h=_(c),m=e.points.findIndex(e=>{const t=P(e.row),n=T(e.value);return Math.hypot(t-l,n-c)<15});if(m>=0)return p(m),void O(!0);"pencil"===i?(d(!0),j(u,h)):"select"===i&&p(null)},onMouseMove:t=>{const s=o.current;if(!s)return;const r=s.getBoundingClientRect(),l=s.width/r.width,d=s.height/r.height,h=(t.clientX-r.left)*l,m=(t.clientY-r.top)*d,f=A(h),y=_(m);if(D&&null!==u){const t=[...e.points],s=Math.max(0,Math.min(n,f));t[u]={row:s,value:y};const r=t.sort((e,t)=>e.row-t.row),o=r.findIndex(e=>e.row===s&&Math.abs(e.value-y)<.001);a({...e,points:r}),o>=0&&o!==u&&p(o)}else"pencil"===i&&c&&j(f,y)},onMouseUp:F,onMouseLeave:F,onContextMenu:t=>{t.preventDefault();const n=o.current;if(!n)return;const s=n.getBoundingClientRect(),r=n.width/s.width,i=n.height/s.height,l=(t.clientX-s.left)*r,c=(t.clientY-s.top)*i,d=e.points.findIndex(e=>{const t=P(e.row),n=T(e.value);return Math.hypot(t-l,n-c)<15});if(d>=0){const t=e.points.filter((e,t)=>t!==d);a({...e,points:t}),p(null)}},className:"w-full rounded-lg border border-dark-border "+(D?"cursor-grabbing":"cursor-crosshair"),style:{height:f},tabIndex:0})}),wn.jsxs("div",{className:"mt-3 flex gap-2 items-center",children:[wn.jsx("span",{className:"text-text-muted text-xs",children:"Interpolation:"}),wn.jsx("button",{onClick:()=>a({...e,interpolation:"linear"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("linear"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Linear"}),wn.jsx("button",{onClick:()=>a({...e,interpolation:"exponential"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("exponential"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Exponential"})]})]})},RT=[{label:"TB-303 Filter",params:[{id:"cutoff",name:"Cutoff",description:"Filter frequency"},{id:"resonance",name:"Resonance",description:"Filter resonance"},{id:"envMod",name:"Env Mod",description:"Envelope depth"},{id:"decay",name:"Decay",description:"Envelope decay time"}]},{label:"TB-303 Character",params:[{id:"accent",name:"Accent",description:"Accent intensity"},{id:"tuning",name:"Tuning",description:"Pitch detune"},{id:"overdrive",name:"Overdrive",description:"Saturation drive"}]},{label:"Mixer",params:[{id:"volume",name:"Volume",description:"Channel volume"},{id:"pan",name:"Pan",description:"Stereo panning"}]},{label:"Effects",params:[{id:"distortion",name:"Distortion",description:"Drive amount"},{id:"delay",name:"Delay",description:"Delay wet mix"},{id:"reverb",name:"Reverb",description:"Reverb wet mix"}]}],jT=()=>{const{patterns:e,currentPatternIndex:t}=tf(),{getAutomation:n,setAutomation:a}=Vy(),[r,o]=s.useState("cutoff"),[i,l]=s.useState(0),c="cyan-lineart"===Zy(e=>e.currentThemeId),d=c?"bg-cyan-500/20":"bg-orange-500/20",u=c?"text-cyan-400":"text-orange-400",p=c?"border-cyan-500":"border-orange-500",h=c?"hover:bg-cyan-500/30":"hover:bg-orange-500/30",m=c?"bg-cyan-500":"bg-orange-500",f=e[t],y=f?.channels.length||4,g=Math.min(i,y-1);if(!f)return wn.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const v=n(f.id,g,r);return wn.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-dark-bg",children:[wn.jsx("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:wn.jsxs("div",{className:"flex items-center justify-between",children:[wn.jsxs("div",{className:"flex items-center gap-3",children:[wn.jsx("span",{className:"text-text-secondary text-sm",children:"Automation"}),wn.jsxs("span",{className:"text-text-primary font-medium",children:["Pattern ",String(t).padStart(2,"0"),": ",f.name]})]}),wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsx("span",{className:"text-text-muted text-xs",children:"Channel:"}),wn.jsx("div",{className:"flex gap-1",children:Array.from({length:y},(e,t)=>{const n=f.channels[t];return wn.jsx("button",{onClick:()=>l(t),className:`\n                      w-8 h-7 text-xs font-mono rounded border transition-all\n                      ${g===t?"text-text-inverse border-transparent":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"}\n                    `,style:g===t?{backgroundColor:n?.color||"#22c55e"}:void 0,title:n?.name||`Channel ${t+1}`,children:t+1},t)})})]})]})}),wn.jsx("div",{className:"border-b border-dark-border bg-dark-bgSecondary p-3",children:wn.jsx("div",{className:"flex gap-6 flex-wrap",children:RT.map(e=>wn.jsxs("div",{className:"flex flex-col gap-1.5",children:[wn.jsx("div",{className:"text-text-muted text-[10px] font-medium uppercase tracking-wider",children:e.label}),wn.jsx("div",{className:"flex gap-1.5",children:e.params.map(e=>{const t=n(f.id,g,e.id).points.length>0,a=r===e.id;return wn.jsxs("button",{onClick:()=>o(e.id),className:`\n                        relative px-3 py-1.5 text-xs rounded-md border transition-all duration-150\n                        ${a?"bg-accent-primary text-text-inverse border-accent-primary shadow-glow-sm":t?`${d} ${u} ${p} ${h}`:"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight hover:text-text-primary"}\n                      `,title:e.description+(t?" (has automation)":""),children:[e.name,t&&!a&&wn.jsx("span",{className:`absolute -top-1 -right-1 w-2 h-2 ${m} rounded-full`})]},e.id)})})]},e.label))})}),wn.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:wn.jsx(FT,{curve:v,parameter:r,patternLength:f.length,onChange:e=>{a(f.id,g,r,e)}})})]})};function LT(e,t,n){let a="";for(let s=0;s<n;s++){const n=e[t+s];if(0===n)break;a+=String.fromCharCode(n)}return a.trim()}function BT(e,t){return e[t]|e[t+1]<<8}function VT(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}async function zT(e){const t=await e.arrayBuffer(),n=new Uint8Array(t),a=function(e){if(e.length>1084){const t=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);if(["M.K.","M!K!","4CHN","6CHN","8CHN","FLT4","FLT8"].includes(t))return"MOD";if(t.match(/^\d\dCH$/))return"MOD"}if(e.length>17&&"Extended Module: "===String.fromCharCode(...e.slice(0,17)))return"XM";if(e.length>48&&26===e[44]&&16===e[45]&&16===e[29])return"S3M";if(e.length>4&&"IMPM"===String.fromCharCode(e[0],e[1],e[2],e[3]))return"IT";return null}(n);if(!a)throw new Error("Unknown or unsupported module format");switch(a){case"MOD":return function(e){const t=LT(e,0,20),n=[],a=[];for(let d=0;d<31;d++){const t=20+30*d,n=LT(e,t,22),s=2*(e[t+22]<<8|e[t+23]),r=15&e[t+24],o=e[t+25],i=2*(e[t+26]<<8|e[t+27]),l=2*(e[t+28]<<8|e[t+29]);a.push({name:n,length:s,fineTune:r,volume:o,loopStart:i,loopLength:l})}const s=e[950],r=e.slice(952,1080);let o=0;for(let d=0;d<s;d++)r[d]>o&&(o=r[d]);const i=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);let l=4;"6CHN"===i?l=6:"8CHN"===i||"FLT8"===i?l=8:i.match(/^\d\dCH$/)&&(l=parseInt(i.substring(0,2),10));let c=1084+64*(o+1)*l*4;for(let d=0;d<31;d++){const t=a[d];if(0===t.length)continue;const s=new Float32Array(t.length);for(let n=0;n<t.length;n++){const t=e[c+n],a=t>127?t-256:t;s[n]=a/128}let r="none";t.loopLength>2&&(r="forward"),n.push({name:t.name||`Sample ${d+1}`,sampleRate:8363,channels:1,bitDepth:8,pcmData:s,loopStart:t.loopStart,loopEnd:t.loopStart+t.loopLength,loopType:r,baseNote:"C-4",fineTune:t.fineTune>7?t.fineTune-16:t.fineTune,volume:t.volume}),c+=t.length}return{samples:n,format:"MOD",title:t}}(n);case"XM":return function(e){const t=LT(e,17,20),n=[],a=VT(e,60),s=BT(e,72);let r=60+a;for(let o=0;o<s&&!(r>=e.length);o++){const t=VT(e,r),a=LT(e,r+4,22),s=BT(e,r+27);if(0===s){r+=t;continue}const o=VT(e,r+29);r+=t;const i=[];for(let n=0;n<s&&!(r+40>e.length);n++)i.push({length:VT(e,r),loopStart:VT(e,r+4),loopLength:VT(e,r+8),volume:e[r+12],fineTune:e[r+13]>127?e[r+13]-256:e[r+13],type:e[r+14],pan:e[r+15],relNote:e[r+16]>127?e[r+16]-256:e[r+16],name:LT(e,r+18,22)}),r+=o;for(let l=0;l<s;l++){const t=i[l];if(0===t.length)continue;const s=!!(16&t.type),o=s?t.length/2:t.length,c=new Float32Array(o);if(s){let n=0;for(let t=0;t<o;t++){const a=BT(e,r+2*t);n+=a>32767?a-65536:a,n>32767&&(n-=65536),n<-32768&&(n+=65536),c[t]=n/32768}r+=t.length}else{let n=0;for(let a=0;a<t.length;a++){const t=e[r+a];n+=t>127?t-256:t,n>127&&(n-=256),n<-128&&(n+=256),c[a]=n/128}r+=t.length}let d="none";1==(3&t.type)?d="forward":2==(3&t.type)&&(d="pingpong"),n.push({name:t.name||a||`Sample ${n.length+1}`,sampleRate:8363,channels:1,bitDepth:s?16:8,pcmData:c,loopStart:s?t.loopStart/2:t.loopStart,loopEnd:s?(t.loopStart+t.loopLength)/2:t.loopStart+t.loopLength,loopType:d,baseNote:"C-4",fineTune:t.fineTune,volume:t.volume})}}return{samples:n,format:"XM",title:t}}(n);case"S3M":return function(e){const t=LT(e,0,28),n=[],a=BT(e,34),s=[];for(let r=0;r<a;r++)s.push(16*BT(e,96+2*r));for(let r=0;r<a;r++){const t=s[r];if(0===t||t>=e.length)continue;if(1!==e[t])continue;const a=LT(e,t+48,28),o=BT(e,t+16)|e[t+18]<<16,i=BT(e,t+20)|e[t+22]<<16,l=BT(e,t+24)|e[t+26]<<16,c=e[t+28],d=e[t+31],u=VT(e,t+32),p=16*(e[t+13]<<16|BT(e,t+14));if(0===o||p>=e.length)continue;const h=!!(4&d),m=!!(1&d),f=o/((h?2:1)*(2&d?2:1)),y=new Float32Array(f);if(h)for(let n=0;n<f;n++){const t=BT(e,p+2*n);y[n]=(t-32768)/32768}else for(let n=0;n<f;n++){const t=e[p+n];y[n]=(t-128)/128}n.push({name:a||`Sample ${r+1}`,sampleRate:u||8363,channels:1,bitDepth:h?16:8,pcmData:y,loopStart:m?h?i/2:i:void 0,loopEnd:m?h?l/2:l:void 0,loopType:m?"forward":"none",baseNote:"C-4",volume:c})}return{samples:n,format:"S3M",title:t}}(n);case"IT":throw new Error("IT format sample extraction not yet implemented");default:throw new Error(`Unsupported format: ${a}`)}}function UT(e){const{pcmData:t,sampleRate:n,channels:a}=e,s=t.length,r=2*a,o=n*r,i=2*s,l=44+i,c=new ArrayBuffer(l),d=new DataView(c);GT(d,0,"RIFF"),d.setUint32(4,l-8,!0),GT(d,8,"WAVE"),GT(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,a,!0),d.setUint32(24,n,!0),d.setUint32(28,o,!0),d.setUint16(32,r,!0),d.setUint16(34,16,!0),GT(d,36,"data"),d.setUint32(40,i,!0);let u=44;for(let m=0;m<s;m++){const e=Math.max(-1,Math.min(1,t[m])),n=Math.round(32767*e);d.setInt16(u,n,!0),u+=2}const p=new Uint8Array(c);let h="";for(let m=0;m<p.length;m++)h+=String.fromCharCode(p[m]);return`data:audio/wav;base64,${btoa(h)}`}function GT(e,t,n){for(let a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}function WT(e,t){const n=function(e){const t={version:1,name:e.name,rows:e.length,channels:e.channels.length,data:e.channels.map(e=>e.rows)},n=JSON.stringify(t,null,2);return new Blob([n],{type:"application/json"})}(e),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=`${e.name}.xp`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function KT(e,t,n){const a=t.channels[e];if(!a)throw new Error(`Channel ${e} not found in pattern`);const s=function(e,t){const n=t.channels[e];if(!n)throw new Error(`Channel ${e} not found in pattern`);const a={version:1,name:n.name,rows:t.length,data:n.rows},s=JSON.stringify(a,null,2);return new Blob([s],{type:"application/json"})}(e,t),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`${a.name}.xt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}const HT=({onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:a,onShowInstruments:r,onShowImportModule:o,onShowDrumpads:i,showMasterFX:l,showInstrumentFX:c,showImportModule:d})=>{const{isMobile:u,width:p}=function(){const[e,t]=s.useState(()=>{const e="undefined"!=typeof window?window.innerWidth:1024;return{width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024}});return s.useEffect(()=>{const e=()=>{const e=window.innerWidth;t({width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}(),{patterns:h,currentPatternIndex:m,cursor:f,showGhostPatterns:y,loadPatterns:g,setPatternOrder:v,setOriginalModuleData:b,setShowGhostPatterns:x,scaleVolume:w,fadeVolume:k,remapInstrument:S}=tf(Fn(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,showGhostPatterns:e.showGhostPatterns,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,setOriginalModuleData:e.setOriginalModuleData,setShowGhostPatterns:e.setShowGhostPatterns,scaleVolume:e.scaleVolume,fadeVolume:e.fadeVolume,remapInstrument:e.remapInstrument}))),{loadInstruments:M}=Py(Fn(e=>({loadInstruments:e.loadInstruments}))),{setMetadata:N}=By(Fn(e=>({setMetadata:e.setMetadata}))),{setBPM:C,setSpeed:E,smoothScrolling:P,setSmoothScrolling:T,grooveTemplateId:A,swing:_,jitter:I,useMpcScale:D}=Ry(Fn(e=>({setBPM:e.setBPM,setSpeed:e.setSpeed,smoothScrolling:e.smoothScrolling,setSmoothScrolling:e.setSmoothScrolling,grooveTemplateId:e.grooveTemplateId,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale}))),{masterMuted:O,toggleMasterMute:F}=Ly(Fn(e=>({masterMuted:e.masterMuted,toggleMasterMute:e.toggleMasterMute}))),R=Ay(e=>e.statusMessage),j=Ay(e=>e.pendingModuleFile),L=Ay(e=>e.setPendingModuleFile),[B,V]=s.useState("tracker"),[z,U]=s.useState(0),[G,W]=s.useState(!1),[K,H]=s.useState(!1),[$,q]=s.useState(!1),[Y,X]=s.useState(!1),[Q,Z]=s.useState(!1),[J,ee]=s.useState(!1),[te,ne]=s.useState(!1),[ae,se]=s.useState(!1),[re,oe]=s.useState(!1),[ie,le]=s.useState(!1),[ce,de]=s.useState(!1),[ue,pe]=s.useState(!1),[he,me]=s.useState(!1),[fe,ye]=s.useState("block"),[ge,ve]=s.useState("block"),[be,xe]=s.useState(!1),[we,ke]=s.useState(0),[Se,Me]=s.useState(!1),Ne=d??ie,Ce=o??le,[Ee,Te]=s.useState(!0),[Ae,Ie]=s.useState(!1),[De,Oe]=s.useState(!1),{fps:Fe,averageFps:Re,quality:je}={fps:60,averageFps:60,quality:Ay(e=>e.performanceQuality)};s.useEffect(()=>{"grid"===B&&requestAnimationFrame(()=>{U(f.channelIndex)})},[B,f.channelIndex]);const Le=s.useCallback(e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return!e.ctrlKey&&!e.metaKey||"i"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"h"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"f"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"o"!==e.key.toLowerCase()||e.shiftKey||e.altKey?"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey?!e.ctrlKey&&!e.metaKey||"e"!==e.key.toLowerCase()||e.shiftKey||e.altKey?(e.ctrlKey||e.metaKey)&&"h"===e.key.toLowerCase()&&e.shiftKey&&!e.altKey?(e.preventDefault(),void ne(e=>!e)):!e.ctrlKey&&!e.metaKey||"m"!==e.key.toLowerCase()||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void se(e=>!e)):(e.preventDefault(),void ee(e=>!e)):(e.preventDefault(),void X(e=>!e)):(e.preventDefault(),void Ce(!0)):(e.preventDefault(),void q(!0)):(e.preventDefault(),void H(!0)):(e.preventDefault(),void W(!0))},[Ce,W,H,q]);s.useEffect(()=>(window.addEventListener("keydown",Le),()=>window.removeEventListener("keydown",Le)),[Le]),s.useEffect(()=>{j&&Ce(!0)},[j,Ce]),(()=>{const{cursor:e,patterns:t,currentPatternIndex:n,selection:a,currentOctave:r,recordMode:o,editStep:i,insertMode:l,multiRecEnabled:c,multiEditEnabled:d,multiRecChannels:u,recReleaseEnabled:p}=tf(Fn(e=>({cursor:e.cursor,patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,selection:e.selection,currentOctave:e.currentOctave,recordMode:e.recordMode,editStep:e.editStep,insertMode:e.insertMode,multiRecEnabled:e.multiRecEnabled,multiEditEnabled:e.multiEditEnabled,multiRecChannels:e.multiRecChannels,recReleaseEnabled:e.recReleaseEnabled}))),h=tf(e=>e.moveCursor),m=tf(e=>e.moveCursorToRow),f=tf(e=>e.moveCursorToChannel),y=tf(e=>e.moveCursorToColumn),g=tf(e=>e.setCell),v=tf(e=>e.clearCell),b=tf(e=>e.setCurrentPattern),x=tf(e=>e.startSelection),w=tf(e=>e.endSelection),k=tf(e=>e.clearSelection),S=tf(e=>e.copySelection),M=tf(e=>e.cutSelection),N=tf(e=>e.paste),C=tf(e=>e.pasteMix),E=tf(e=>e.pasteFlood),P=tf(e=>e.pastePushForward),T=tf(e=>e.setCurrentOctave),A=tf(e=>e.transposeSelection),_=tf(e=>e.interpolateSelection),I=tf(e=>e.humanizeSelection),D=tf(e=>e.toggleRecordMode),O=tf(e=>e.setEditStep),F=tf(e=>e.writeMacroSlot),R=tf(e=>e.readMacroSlot),j=tf(e=>e.toggleInsertMode),L=tf(e=>e.setKeyOn),B=tf(e=>e.setKeyOff),V=tf(e=>e.findBestChannel),z=tf(e=>e.insertRow),U=tf(e=>e.deleteRow),G=tf(e=>e.setPtnJumpPos),W=tf(e=>e.getPtnJumpPos),{isPlaying:K,currentRow:H,stop:$,play:q,togglePlayPause:Y}=Ry(Fn(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow,stop:e.stop,play:e.play,togglePlayPause:e.togglePlayPause}))),{instruments:X,currentInstrumentId:Q,setCurrentInstrument:Z}=Py(),J=t[n],ee=s.useRef(new Map),te=s.useCallback(()=>d&&o&&!K||c&&o&&K?V():e.channelIndex,[e.channelIndex,o,K,d,c,V]),ne=s.useCallback((e,t,n)=>{if(null===Q)return;const a=Hm(),s=X.find(e=>e.id===Q);if(!s)return;const r=`${e}${t}`,o=Ua(`${e}-${t}`);if(ee.current.has(n))return;const i=ee.current.size>0,l="TB303"===s.synthType||"Buzz3o3"===s.synthType,c=i&&l,d=!1,u=te(),{midiPolyphonic:p}=Wm.getState();p?a.triggerPolyNoteAttack(Q,r,1,s,d,c):a.triggerNoteAttack(Q,r,void 0,1,s,void 0,d,c),ee.current.set(n,{note:r,xmNote:o,instrumentId:Q,channelIndex:u}),L(u,o)},[Q,X,te,L]),ae=s.useCallback(e=>{const t=ee.current.get(e);if(!t)return;const n=Hm(),a=X.find(e=>e.id===t.instrumentId),{midiPolyphonic:s}=Wm.getState();s&&a?n.triggerPolyNoteRelease(t.instrumentId,t.note,a):n.releaseNote(t.instrumentId,t.note),B(t.channelIndex),p&&o&&K&&g(t.channelIndex,H,{note:97}),ee.current.delete(e)},[X,B,p,o,K,g,H]),se=s.useCallback((t,n,a)=>{const s=Ua(`${t}-${n}`);if(0===s)return;const r=void 0!==a?a:te(),c=o&&K?H:e.rowIndex;if(l&&!K&&z(r,c),g(r,c,{note:s,instrument:null!==Q?Q:void 0}),Ay.getState().chordEntryMode&&!K&&void 0===a){const t=J.channels.length,n=e.channelIndex+1;if(n<t)return void f(n)}i>0&&!K&&m((e.rowIndex+i)%J.length)},[e,g,o,i,J,m,f,K,H,l,z,te]),re=s.useCallback(()=>{z(e.channelIndex,e.rowIndex)},[e,z]),oe=s.useCallback(()=>{U(e.channelIndex,e.rowIndex)},[e,U]),ie=s.useCallback(s=>{if(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const l=s.key,c=l.toLowerCase();if("F9"===l){if(s.preventDefault(),s.shiftKey)G(0,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(0);m(e),q()}else m(0);return}if("F10"===l){if(s.preventDefault(),s.shiftKey)G(1,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(1);m(e),q()}else m(Math.floor(.25*J.length));return}if("F11"===l){if(s.preventDefault(),s.shiftKey)G(2,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(2);m(e),q()}else m(Math.floor(.5*J.length));return}if("F12"===l){if(s.preventDefault(),s.shiftKey)G(3,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=W(3);m(e),q()}else m(Math.floor(.75*J.length));return}if("PageUp"===l)return s.preventDefault(),void m(Math.max(0,e.rowIndex-16));if("PageDown"===l)return s.preventDefault(),void m(Math.min(J.length-1,e.rowIndex+16));if("Home"===l)return s.preventDefault(),void m(0);if("End"===l)return s.preventDefault(),void m(J.length-1);if("Tab"===l)return s.preventDefault(),s.shiftKey?"note"===e.columnType&&(e.channelIndex>0?f(e.channelIndex-1):f(J.channels.length-1)):e.channelIndex<J.channels.length-1?f(e.channelIndex+1):f(0),void y("note");if(s.altKey&&void 0!==rw[c]){s.preventDefault();const e=rw[c]%J.channels.length;return f(e),void y("note")}if(s.altKey&&void 0!==ow[c]){s.preventDefault();const e=ow[c]%J.channels.length;return f(e),void y("note")}if((s.ctrlKey||s.metaKey)&&l>="1"&&l<="8"&&!s.altKey){s.preventDefault();const e=parseInt(l)-1;return void(s.shiftKey?F(e):R(e))}if("Insert"===l)return s.preventDefault(),void(o?(s.shiftKey,re()):j());if(o&&(s.ctrlKey||s.metaKey)&&"ArrowUp"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?A(12):A(1));if(o&&(s.ctrlKey||s.metaKey)&&"ArrowDown"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?A(-12):A(-1));if("ArrowUp"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("up"),w()):h("up"));if("ArrowDown"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("down"),w()):h("down"));if("ArrowLeft"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("left"),w()):h("left"));if("ArrowRight"===l)return s.preventDefault(),void(s.altKey?(a||x(),h("right"),w()):h("right"));if("Delete"===l&&o)return s.preventDefault(),s.shiftKey?g(e.channelIndex,e.rowIndex,{note:0,instrument:0,volume:0,effTyp:0,eff:0}):s.ctrlKey||s.metaKey?g(e.channelIndex,e.rowIndex,{volume:0,effTyp:0,eff:0}):s.altKey?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"note"===e.columnType?g(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?g(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?g(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?g(e.channelIndex,e.rowIndex,{probability:void 0}):v(e.channelIndex,e.rowIndex),void(i>0&&!K&&m((e.rowIndex+i)%J.length));if("Backspace"===l&&o)return s.preventDefault(),void(s.shiftKey?e.rowIndex>0&&(h("up"),oe()):e.rowIndex>0&&(h("up"),v(e.channelIndex,e.rowIndex)));if("F3"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&M());if("F4"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&S());if("F5"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&N());if((s.ctrlKey||s.metaKey)&&"c"===c&&!s.altKey)return s.preventDefault(),S(),void Ay.getState().setStatusMessage("COPY");if((s.ctrlKey||s.metaKey)&&"x"===c&&!s.altKey)return s.preventDefault(),M(),void Ay.getState().setStatusMessage("CUT");if((s.ctrlKey||s.metaKey)&&"v"===c&&!s.altKey)return s.preventDefault(),void(s.shiftKey?(C(),Ay.getState().setStatusMessage("MIX PASTE")):(N(),Ay.getState().setStatusMessage("PASTE")));if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"f"===c)return s.preventDefault(),void E();if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"i"===c)return s.preventDefault(),void P();if("Escape"===l)return s.preventDefault(),void k();if("Shift"===s.key&&2===s.location)return s.preventDefault(),o||D(),void q();if("Control"===s.key&&2===s.location)return s.preventDefault(),void q();if("Alt"===s.key&&2===s.location)return s.preventDefault(),void q();if(" "===l){if(s.preventDefault(),K)$(),Ay.getState().setStatusMessage("STOPPED");else{D();const e=tf.getState().recordMode;Ay.getState().setStatusMessage(e?"RECORD ON":"RECORD OFF")}return}if("Enter"===l&&(s.ctrlKey||s.metaKey))return s.preventDefault(),q(),void Ay.getState().setStatusMessage("PLAYING");if("CapsLock"===l){if(s.preventDefault(),"note"===e.columnType){const t=o&&K?H:e.rowIndex;g(e.channelIndex,t,{note:97}),i>0&&!K&&m((e.rowIndex+i)%J.length)}return}if(l>="F1"&&l<="F7"){s.preventDefault();const e=parseInt(l.substring(1));return T(e),void Ay.getState().setStatusMessage(`OCTAVE ${e}`)}if("`"===l||"~"===l){let e;return s.preventDefault(),e=s.shiftKey?0===i?16:i-1:16===i?0:i+1,O(e),void Ay.getState().setStatusMessage(`EDIT STEP ${e}`)}if("NumpadAdd"===s.code||"+"===l&&!s.shiftKey&&3===s.location)return s.preventDefault(),void(r<7&&T(r+1));if("NumpadSubtract"===s.code||"-"===l&&3===s.location)return s.preventDefault(),void(r>1&&T(r-1));if(s.shiftKey&&"ArrowLeft"===l)return s.preventDefault(),void(n>0&&b(n-1));if(s.shiftKey&&"ArrowRight"===l)return s.preventDefault(),void(n<t.length-1&&b(n+1));if(s.shiftKey&&"ArrowUp"===l){if(s.preventDefault(),null!==Q&&Q>0){const e=X.find(e=>e.id===Q-1);e&&Z(e.id)}return}if(s.shiftKey&&"ArrowDown"===l){if(s.preventDefault(),null!==Q){const e=X.find(e=>e.id===Q+1);e&&Z(e.id)}return}if(sw[c]&&!s.altKey&&!s.ctrlKey&&!s.metaKey&&!s.repeat&&"note"===e.columnType){s.preventDefault();const{note:e,octaveOffset:t}=sw[c],n=r+t;if(ne(e,n,c),o){const t=ee.current.get(c),a=t?.channelIndex;se(e,n,a)}return}if(sw[c]&&s.repeat&&"note"===e.columnType){if(s.preventDefault(),o&&!K){const{note:e,octaveOffset:t}=sw[c],n=r+t,a=ee.current.get(c);se(e,n,a?.channelIndex)}return}const d=J.channels[e.channelIndex].rows[e.rowIndex];if(o&&"instrument"===e.columnType&&iw.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.instrument||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,a>128&&(a=128),g(e.channelIndex,e.rowIndex,{instrument:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&"volume"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=d.volume||0;if(0===e.digitIndex){const n=lw[c];if(void 0!==n){s.preventDefault();let a=n<<4|15&t;return a>=81&&a<=95&&(a=80),g(e.channelIndex,e.rowIndex,{volume:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}}else if(iw.includes(l)){s.preventDefault();const n=parseInt(l,16);let a;return a=t<16?16+n:240&t|n,a>=81&&a<=95&&(a=80),g(e.channelIndex,e.rowIndex,{volume:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}}if(o&&"effTyp"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=cw[c];if(void 0!==t)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{effTyp:t}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&"effParam"===e.columnType&&iw.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.eff||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,g(e.channelIndex,e.rowIndex,{eff:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&"effTyp2"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=cw[c];if(void 0!==t)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{effTyp2:t}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&("flag1"===e.columnType||"flag2"===e.columnType)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=e.columnType;if("a"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:1}),void(i>0&&!K&&m((e.rowIndex+i)%J.length));if("s"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:2}),void(i>0&&!K&&m((e.rowIndex+i)%J.length));if("m"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:3}),void(i>0&&!K&&m((e.rowIndex+i)%J.length));if("h"===c)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:4}),void(i>0&&!K&&m((e.rowIndex+i)%J.length));if("0"===l||"."===l)return s.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:0}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&"effParam2"===e.columnType&&iw.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),n=d.eff2||0;let a;return a=0===e.digitIndex?t<<4|15&n:240&n|t,g(e.channelIndex,e.rowIndex,{eff2:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}if(o&&"probability"===e.columnType&&/^[0-9]$/.test(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,10),n=d.probability||0;let a;return a=0===e.digitIndex?10*t+n%10:10*Math.floor(n/10)+t,a=Math.min(99,Math.max(0,a)),g(e.channelIndex,e.rowIndex,{probability:a}),void(i>0&&!K&&m((e.rowIndex+i)%J.length))}},[e,J,t,n,K,H,r,Q,X,a,o,D,i,O,h,m,f,y,g,v,b,Z,$,q,x,w,k,S,M,N,C,E,P,ne,se,re,oe,A,_,I,G,W]),le=s.useCallback(e=>{const t=e.key.toLowerCase();sw[t]&&ae(t)},[ae]);s.useEffect(()=>(window.addEventListener("keydown",ie,{capture:!0}),window.addEventListener("keyup",le,{capture:!0}),()=>{window.removeEventListener("keydown",ie,{capture:!0}),window.removeEventListener("keyup",le,{capture:!0})}),[ie,le])})();const Be=(()=>{const{cursor:e,selection:t,clipboard:n,patterns:a,currentPatternIndex:r,startSelection:o,endSelection:i,clearSelection:l,copySelection:c,cutSelection:d,paste:u,setCell:p}=tf(),[h,m]=s.useState({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}),f=a[r],y=s.useCallback(()=>{o(),m(e=>({...e,blockStartMarked:!0,blockEndMarked:!1,isBlockSelected:!1}))},[o,e]),g=s.useCallback(()=>{i(),m(e=>({...e,blockEndMarked:!0,isBlockSelected:!0}))},[i,e]),v=s.useCallback(()=>{t&&c()},[t,c]),b=s.useCallback(()=>{n&&u()},[n,u,e]),x=s.useCallback(()=>{t&&(d(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}))},[t,d]),w=s.useCallback(()=>{l(),m({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1})},[l]),k=s.useCallback(()=>t?{startChannel:Math.min(t.startChannel,t.endChannel),endChannel:Math.max(t.startChannel,t.endChannel),startRow:Math.min(t.startRow,t.endRow),endRow:Math.max(t.startRow,t.endRow)}:null,[t]),S=s.useCallback((e,t)=>{const n=k();return!!n&&e>=n.startChannel&&e<=n.endChannel&&t>=n.startRow&&t<=n.endRow},[k]),M=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let a=t.startRow;a<=t.endRow;a++){const t=f.channels[n].rows[a];if(t.note&&0!==t.note&&97!==t.note){const s=qa(t.note);if(null!==s){const t=s+e;if(t>=12&&t<=107){const e=Ya(t);p(n,a,{note:e})}}}}},[k,f,p]),N=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let a=t.startRow;a<=t.endRow;a++){const t=f.channels[n].rows[a];if(null!==t.volume){const s=Math.min(64,Math.max(0,Math.round(t.volume*e)));p(n,a,{volume:s})}}},[k,f,p]),C=s.useCallback(e=>{const t=k();if(t)for(let n=t.startChannel;n<=t.endChannel;n++){const a=f.channels[n].rows[t.startRow],s=f.channels[n].rows[t.endRow],r=a[e]||0,o=s[e]||0,i=t.endRow-t.startRow;if(!(i<=1))for(let l=1;l<i;l++){const a=l/i,s=Math.round(r+(o-r)*a),c=t.startRow+l;p(n,c,{[e]:s})}}},[k,f,p]),E=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let a=e.startChannel;a<=e.endChannel;a++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[a].rows[n]});n.push(t)}for(let a=e.startChannel;a<=e.endChannel;a++){const s=a-e.startChannel;for(let r=0;r<t;r++){const o=n[s][t-1-r];p(a,e.startRow+r,{note:o.note,instrument:o.instrument,volume:o.volume,effTyp:o.effTyp,eff:o.eff,effTyp2:o.effTyp2,eff2:o.eff2,flag1:o.flag1,flag2:o.flag2})}}},[k,f,p]),P=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,a=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[s].rows[n]});a.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const r=s-e.startChannel;for(let o=0;o<2*t;o++){const t=e.startRow+o;if(t>=n)break;if(o%2==0){const e=a[r][o/2];p(s,t,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(s,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}e.startRow},[k,f,p]),T=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let a=e.startChannel;a<=e.endChannel;a++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[a].rows[n]});n.push(t)}for(let a=e.startChannel;a<=e.endChannel;a++){const s=a-e.startChannel;for(let r=0;r<t;r++){const o=e.startRow+r,i=2*r;if(i<t){const e=n[s][i];p(a,o,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(a,o,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[k,f,p]),A=s.useCallback((e,t,n)=>{const a=k();if(a)for(let s=a.startChannel;s<=a.endChannel;s++)for(let r=a.startRow;r<=a.endRow;r++){const a=f.channels[s].rows[r][n];if(0===a&&"volume"===n)continue;let o;switch(e){case"add":o=a+t;break;case"sub":o=a-t;break;case"mul":o=Math.round(a*t);break;case"div":o=0!==t?Math.round(a/t):a}const i="volume"===n?80:255;o=Math.max(0,Math.min(i,o)),p(s,r,{[n]:o})}},[k,f,p]),_=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,a=[];for(let r=e.startChannel;r<=e.endChannel;r++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[r].rows[n]});a.push(t)}let s=e.endRow+1;for(;s<n;){for(let n=e.startChannel;n<=e.endChannel;n++){const r=n-e.startChannel,o=(s-e.endRow-1)%t,i=a[r][o];p(n,s,{note:i.note,instrument:i.instrument,volume:i.volume,effTyp:i.effTyp,eff:i.eff,effTyp2:i.effTyp2,eff2:i.eff2,flag1:i.flag1,flag2:i.flag2})}s++}},[k,f,p]);return s.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return e.altKey&&"b"===e.key.toLowerCase()?(e.preventDefault(),void y()):e.altKey&&"e"===e.key.toLowerCase()?(e.preventDefault(),void g()):e.altKey&&"c"===e.key.toLowerCase()?(e.preventDefault(),void v()):!e.altKey||"v"!==e.key.toLowerCase()&&"p"!==e.key.toLowerCase()?e.altKey&&"x"===e.key.toLowerCase()?(e.preventDefault(),void x()):"Escape"===e.key&&t?(e.preventDefault(),void w()):e.altKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(1)):e.altKey&&e.shiftKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(-1)):!e.altKey||"r"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?!e.altKey||"d"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?void 0:(e.preventDefault(),void _()):(e.preventDefault(),void E()):(e.preventDefault(),void b())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[y,g,v,b,x,w,M,E,_,t]),{blockState:h,selection:t,clipboard:n,markBlockStart:y,markBlockEnd:g,copyBlock:v,pasteBlock:b,cutBlock:x,clearBlock:w,isCellInBlock:S,getBlockBounds:k,transposeBlock:M,amplifyBlock:N,interpolateBlock:C,reverseBlock:E,expandBlock:P,shrinkBlock:T,mathBlock:A,duplicateBlock:_}})();(()=>{const{patterns:e,currentPatternIndex:t,setCurrentPattern:n,patternOrder:a,currentPositionIndex:r,setCurrentPosition:o}=tf(),{isPlaying:i,isLooping:l,bpm:c,setCurrentRow:d,setCurrentRowThrottled:u}=Ry(),{instruments:p}=Py(),{automation:h}=Vy(),{masterEffects:m}=Ly(),f=a[r]??t,y=e[f],g=Hm(),v=Sx(),b=s.useRef(!1);s.useEffect(()=>{g.setBPM(c)},[c]),s.useEffect(()=>{g.rebuildMasterEffects(m)},[m]),s.useEffect(()=>{y&&(y.channels.forEach((e,t)=>{const n=e.volume>0?e.volume/100*60-60:-1/0;g.setChannelVolume(t,n),g.setChannelPan(t,e.pan)}),g.updateMuteStates(y.channels.map(e=>({muted:e.muted,solo:e.solo}))))},[y]),s.useEffect(()=>{if(i&&y&&!b.current){b.current=!0;const s=y.importMetadata?.sourceFormat??"XM",r=y.importMetadata?.modData,i=l?[t]:a;v.loadSong({name:y.importMetadata?.sourceFile??y.name??"Untitled",format:s,patterns:e,instruments:p,songPositions:i,songLength:l?1:r?.songLength??a.length,restartPosition:0,numChannels:y.channels.length,initialSpeed:r?.initialSpeed??6,initialBPM:r?.initialBPM??c});let d=-1,h=-1;v.onRowChange=(t,a,s)=>{u(t,e[a]?.length??64),0!==t||a===d&&s===h||(d=a,h=s,queueMicrotask(()=>{n(a),o(s)}))},v.onSongEnd=()=>{},v.play().catch(e=>{})}else!i&&b.current&&(b.current=!1,v.stop(),v.onRowChange=null,v.onSongEnd=null,d(0));return()=>{!i&&b.current&&(v.stop(),v.onRowChange=null,v.onSongEnd=null)}},[i,l,y,p,a,e,c,t,n,o,d,u])})();const Ve=s.useCallback(async(e,t)=>{const{useLibopenmpt:n}=t;if(Hm().releaseAll(),e.nativeData){const{format:t,importMetadata:a,instruments:s,patterns:r}=e.nativeData;let o;if("XM"===t)o=QE(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);else if("MOD"===t)o=ZE(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);else if("FUR"===t||"DMF"===t){const e=a.modData?.patternOrderTable||[],t=r[0]?.length||64,n=a.originalChannelCount||r[0]?.[0]?.length||4;o={patterns:r.map((e,s)=>({id:`pattern-${s}`,name:`Pattern ${s}`,length:t,importMetadata:a,channels:Array.from({length:n},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:s.map(e=>e.name)}}else o=ZE(r,a.originalChannelCount,a,s.map(e=>e.name),n?e.arrayBuffer:void 0);if(0===o.patterns.length)return void tg.error(`Module "${e.metadata.title}" contains no patterns to import.`);const i=[];for(let e=0;e<s.length;e++){const n=eP(s[e],s[e].id,t);i.push(...n)}M(i),g(o.patterns),o.order&&o.order.length>0&&v(o.order),o.originalModuleData?b(o.originalModuleData):b(null),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"} (${t})`}),C(a.modData?.initialBPM||125),E(a.modData?.initialSpeed||6);return i.filter(e=>"Sampler"===e.synthType).length>0&&await Hm().preloadInstruments(i),void tg.success(`Imported "${e.metadata.title}" - ${o.patterns.length} patterns, ${i.length} instruments`)}if(!e.metadata.song)return void tg.error(`Module "${e.metadata.title}" loaded but no pattern data found.`);const a=XE(e.metadata.song);if(0===a.patterns.length)return void tg.error(`Module "${e.metadata.title}" contains no patterns to import.`);let s;if(e.file&&function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".s3m"].includes(t)}(e.file.name))try{const t=await zT(e.file);s=new Map;for(let e=0;e<t.samples.length;e++){const n=t.samples[e];if(n.pcmData.length>0){const t=UT(n);s.set(e+1,t)}}}catch(o){}const r=function(e,t,n){const a=new Set;for(const o of e)for(const e of o.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&a.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const o of Array.from(a).sort((e,t)=>e-t)){const e=t[o-1]||`Instrument ${o}`,a=n?.get(o);if(a)s.push({id:o,name:e.trim()||`Sample ${o}`,type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:a}});else{const t=r[(o-1)%r.length];s.push({id:o,name:e.trim()||`Instrument ${o}`,type:"synth",synthType:"Synth",oscillator:{...Fa,type:t},envelope:{...Ra},filter:{...ja},effects:[],volume:-6,pan:0})}}for(const o of[0,1])if(!a.has(o)){const e=n?.get(o);e?s.push({id:o,name:0===o?"Default":"Sample 01",type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:e}}):s.push({id:o,name:0===o?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Fa,type:"sawtooth"},envelope:{...Ra},filter:{...ja},effects:[],volume:-6,pan:0})}return s.sort((e,t)=>e.id-t.id),s}(a.patterns,a.instrumentNames,s);M(r),g(a.patterns),a.order&&a.order.length>0&&v(a.order),N({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"}`}),C(125);r.filter(e=>"Sampler"===e.synthType).length>0&&await Hm().preloadInstruments(r),tg.success(`Imported "${e.metadata.title}" - ${a.patterns.length} patterns, ${r.length} instruments`)},[M,g,N,C,E,v,b]),ze=s.useCallback(e=>{ke(e),xe(!0)},[]),Ue=h[m];return u?wn.jsxs(wn.Fragment,{children:[wn.jsx(kT,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstruments:r,showMasterFX:l}),wn.jsx(fw,{isOpen:G,onClose:()=>W(!1)}),wn.jsx(yw,{isOpen:K,onClose:()=>H(!1)}),wn.jsx(gw,{isOpen:$,onClose:()=>q(!1)}),wn.jsx(AN,{isOpen:Y,onClose:()=>X(!1)}),wn.jsx(CN,{isOpen:Q,onClose:()=>Z(!1)}),wn.jsx(GN,{isOpen:J,onSelect:(e,t)=>{const{cursor:n,setCell:a}=tf.getState();a(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),ee(!1)},onClose:()=>ee(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=tf.getState(),a=t[n];if(!a)return;const s=a.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Py.getState().getInstrument(s.instrument);return r?.synthType})()}),wn.jsx(HN,{isOpen:te,onClose:()=>ne(!1)}),wn.jsx($N,{isOpen:ae,onClose:()=>se(!1)}),wn.jsx(wN,{isOpen:Ne,onClose:()=>{Ce(!1),L(null)},onImport:Ve,initialFile:j}),ce&&wn.jsx(kN,{scope:fe,onConfirm:e=>{w(fe,e),de(!1)},onCancel:()=>de(!1)}),ue&&wn.jsx(SN,{scope:fe,onConfirm:(e,t)=>{k(fe,e,t),pe(!1)},onCancel:()=>pe(!1)}),he&&wn.jsx(MN,{scope:ge,onConfirm:(e,t)=>{S(e,t,ge),me(!1)},onCancel:()=>me(!1)}),be&&wn.jsx(Jx,{channelIndex:we,onClose:()=>xe(!1)})]}):wn.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-dark-bg overflow-y-hidden",children:[wn.jsx("div",{className:"flex-shrink min-h-[80px]",children:wn.jsx(sT,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:a,onShowInstruments:r,onShowPatternOrder:()=>Me(!0),onShowDrumpads:i,showMasterFX:l,showInstrumentFX:c})}),"tb303"!==B&&wn.jsx("div",{className:"flex-shrink-0",children:wn.jsx(iT,{})}),wn.jsxs("div",{className:"flex-shrink flex items-center justify-between px-2 py-1 bg-dark-bgTertiary border-b border-dark-border min-h-[28px]",children:[wn.jsxs("div",{className:"flex items-center gap-2",children:[wn.jsxs("div",{className:"flex items-center gap-1",children:["tracker"===B&&wn.jsx(on,{size:14,className:"text-text-secondary"}),"grid"===B&&wn.jsx(Kt,{size:14,className:"text-text-secondary"}),"pianoroll"===B&&wn.jsx(ln,{size:14,className:"text-text-secondary"}),"tb303"===B&&wn.jsx(Pe,{size:14,className:"text-text-secondary"}),wn.jsxs("select",{value:B,onChange:e=>V(e.target.value),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",title:"Select editor view",children:[wn.jsx("option",{value:"tracker",children:"Tracker"}),wn.jsx("option",{value:"grid",children:"Grid"}),wn.jsx("option",{value:"pianoroll",children:"Piano Roll"}),wn.jsx("option",{value:"tb303",children:"TB-303"})]})]}),("grid"===B||"pianoroll"===B)&&Ue&&wn.jsxs(wn.Fragment,{children:[wn.jsx("span",{className:"text-text-secondary text-[10px] font-medium",children:"CH:"}),wn.jsx("select",{value:z,onChange:e=>U(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",children:Ue.channels.map((e,t)=>wn.jsx("option",{value:t,children:(t+1).toString().padStart(2,"0")},t))})]}),"tracker"===B&&wn.jsxs("button",{onClick:()=>x(!y),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${y?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:y?"Hide ghost patterns":"Show ghost patterns",children:[y?wn.jsx(lt,{size:12}):wn.jsx(it,{size:12}),wn.jsx("span",{children:"Ghosts"})]}),"tracker"===B&&wn.jsxs("button",{onClick:()=>Ie(!Ae),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${Ae?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Advanced Edit Panel",children:[wn.jsx(_e,{size:12}),wn.jsx("span",{children:"Edit"})]}),"tracker"===B&&wn.jsxs("button",{onClick:()=>Oe(!0),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Automation Editor",children:[wn.jsx(Ze,{size:12}),wn.jsx("span",{children:"Auto"})]}),wn.jsxs("button",{onClick:i,className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Drumpad Editor",children:[wn.jsx(yt,{size:12}),wn.jsx("span",{children:"Pads"})]}),wn.jsx("div",{className:"w-px h-4 bg-dark-border mx-1"}),wn.jsx("button",{onClick:F,className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${O?"bg-accent-error/20 text-accent-error":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:O?"Unmute master output":"Mute master output",children:O?"Unmute":"Mute"}),wn.jsx("button",{onClick:()=>T(!P),className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${P?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:P?"Switch to stepped scrolling":"Switch to smooth scrolling",children:P?"Smooth":"Stepped"}),wn.jsxs("div",{className:"flex items-center gap-1 ml-1 pl-2 border-l border-dark-border",children:[wn.jsx("button",{onClick:()=>oe(!0),className:"px-2 py-1 text-[10px] rounded font-mono font-bold transition-colors "+("straight"!==A||_!==(D?50:100)||I>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/50":"bg-dark-bgSecondary text-text-secondary border border-dark-border hover:text-text-primary"),title:`Groove Settings (Current: ${Ba.find(e=>e.id===A)?.name||"None"})`,children:"GROOVE"}),re&&wn.jsx(NC,{onClose:()=>oe(!1)})]}),R&&wn.jsx("div",{className:"flex items-center px-3 ml-2 pl-3 border-l border-dark-border",children:wn.jsx("span",{className:"text-accent-primary font-bold tracking-[0.3em] text-[11px] animate-pulse font-mono",children:R.toUpperCase()})})]}),wn.jsxs("div",{className:`\n            flex items-center gap-1 px-2 py-0.5 text-xs rounded font-mono\n            ${"low"===je?"bg-accent-error/20 text-accent-error":"medium"===je?"bg-orange-500/20 text-orange-400":"bg-green-500/20 text-green-400"}\n          `,title:`Performance: ${je.toUpperCase()} | Avg FPS: ${Re} | Current: ${Fe}`,children:[wn.jsx("span",{className:"font-bold",children:Re}),wn.jsx("span",{className:"text-[10px] opacity-70",children:"FPS"}),wn.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${"low"===je?"bg-accent-error":"medium"===je?"bg-orange-400":"bg-green-400"} animate-pulse`})]})]}),wn.jsxs("div",{className:"flex-1 min-h-0 min-w-0 relative z-10 flex overflow-hidden",children:[wn.jsx("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col overflow-hidden",children:"tracker"===B?wn.jsx(Ax,{onAcidGenerator:ze}):"grid"===B?wn.jsx(aw,{channelIndex:z}):"pianoroll"===B?wn.jsx(OT,{channelIndex:z}):wn.jsx("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden bg-dark-bgPrimary",children:wn.jsx(mT,{channelIndex:z})})}),p>=900&&wn.jsx("button",{onClick:()=>Te(!Ee),className:`\n              flex-shrink-0 w-6 flex items-center justify-center\n              bg-ft2-header border-l border-ft2-border\n              hover:bg-ft2-border transition-colors\n              ${Ee?"text-ft2-highlight":"text-ft2-textDim"}\n            `,title:Ee?"Hide Instruments":"Show Instruments",children:wn.jsx(jt,{size:14,className:Ee?"":"rotate-180"})}),p>=900&&Ee&&wn.jsx("div",{className:"flex-shrink-0 w-fit min-w-48 max-w-80 border-l border-ft2-border flex flex-col overflow-hidden animate-fade-in",children:wn.jsx(wT,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})})]}),wn.jsx(fw,{isOpen:G,onClose:()=>W(!1)}),wn.jsx(yw,{isOpen:K,onClose:()=>H(!1)}),wn.jsx(gw,{isOpen:$,onClose:()=>q(!1)}),wn.jsx(AN,{isOpen:Y,onClose:()=>X(!1)}),wn.jsx(CN,{isOpen:Q,onClose:()=>Z(!1)}),wn.jsx(GN,{isOpen:J,onSelect:(e,t)=>{const{cursor:n,setCell:a}=tf.getState();a(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),ee(!1)},onClose:()=>ee(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=tf.getState(),a=t[n];if(!a)return;const s=a.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Py.getState().getInstrument(s.instrument);return r?.synthType})()}),wn.jsx(HN,{isOpen:te,onClose:()=>ne(!1)}),wn.jsx($N,{isOpen:ae,onClose:()=>se(!1)}),wn.jsx(wN,{isOpen:Ne,onClose:()=>{Ce(!1),L(null)},onImport:Ve,initialFile:j}),ce&&wn.jsx(kN,{scope:fe,onConfirm:e=>{w(fe,e),de(!1)},onCancel:()=>de(!1)}),ue&&wn.jsx(SN,{scope:fe,onConfirm:(e,t)=>{k(fe,e,t),pe(!1)},onCancel:()=>pe(!1)}),he&&wn.jsx(MN,{scope:ge,onConfirm:(e,t)=>{S(e,t,ge),me(!1)},onCancel:()=>me(!1)}),Se&&wn.jsx(NN,{onClose:()=>Me(!1)}),Ae&&wn.jsx(PN,{onClose:()=>Ie(!1),onShowScaleVolume:e=>{ye(e),de(!0)},onShowFadeVolume:e=>{ye(e),pe(!0)},onShowRemapInstrument:e=>{ve(e),me(!0)},onExportPattern:()=>{WT(h[m])},onExportTrack:()=>{const e=h[m];KT(f.channelIndex,e)},onReverse:Be.reverseBlock,onExpand:Be.expandBlock,onShrink:Be.shrinkBlock,onDuplicate:Be.duplicateBlock,onMath:Be.mathBlock}),be&&wn.jsx(Jx,{channelIndex:we,onClose:()=>xe(!1)}),De&&wn.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:wn.jsxs("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[wn.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-bgSecondary",children:[wn.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center gap-2",children:[wn.jsx(Ze,{size:20,className:"text-accent-primary"}),"Automation Editor"]}),wn.jsx("button",{onClick:()=>Oe(!1),className:"p-2 rounded hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors",title:"Close",children:wn.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:wn.jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})]}),wn.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:wn.jsx(jT,{})})]})})]})},$T=e.memo(({onShowTips:e})=>{const t=tf(e=>e.cursor),n=tf(e=>e.currentOctave),a=tf(e=>e.insertMode),s=tf(e=>e.recordMode),r=tf(e=>e.patterns[e.currentPatternIndex]?.length||64),{isPlaying:o,currentRow:i}=Ry(),{contextState:l}=Ly(),{knobBank:c,setKnobBank:d,isInitialized:u,inputDevices:p,selectedInputId:h,showKnobBar:m,setShowKnobBar:f}=kg(),y=o?i:t.rowIndex,g=`${String(y).padStart(2,"0")}/${String(r-1).padStart(2,"0")}`,v=`Ch ${t.channelIndex+1}`,b=u&&p.length>0,x=b?p.find(e=>e.id===h)||p[0]:null,w=x?.name||"MIDI Controller",k=[{id:"303",label:"303/Synth",icon:Ie},{id:"Siren",label:"Dub Siren",icon:Ze},{id:"FX",label:"Effects",icon:ct},{id:"Mixer",label:"Mixer",icon:Te}],S=b?hg[c]:[];return wn.jsxs("div",{className:"flex flex-col",children:[b&&m&&wn.jsxs("div",{className:"bg-dark-bgTertiary border-t border-dark-border px-4 py-2 flex flex-col gap-2",children:[wn.jsxs("div",{className:"flex items-center gap-1",children:[wn.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase mr-2 tracking-widest",children:"Knob Bank:"}),k.map(e=>{const t=e.icon,n=c===e.id;return wn.jsxs("button",{onClick:()=>d(e.id),className:`\n                    flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase transition-all border\n                    ${n?"bg-accent-primary text-dark-bg border-accent-primary shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-dark-bgSecondary text-text-muted border-dark-border hover:border-text-muted"}\n                  `,children:[wn.jsx(t,{size:12}),e.label]},e.id)})]}),wn.jsx("div",{className:"grid grid-cols-8 gap-2",children:S.map((e,t)=>wn.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border relative group overflow-hidden",children:[wn.jsx("div",{className:"absolute top-0 left-0 w-full h-[2px] bg-accent-primary/20 group-hover:bg-accent-primary/50 transition-colors"}),wn.jsxs("span",{className:"text-[8px] font-mono text-text-muted mb-1 flex items-center gap-1",children:[wn.jsx(cn,{size:8})," K",t+1," (CC ",e.cc,")"]}),wn.jsx("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label})]},t))})]}),wn.jsxs("div",{className:"bg-dark-bgSecondary border-t border-dark-border flex items-center justify-between px-4 py-1.5 text-xs font-mono",children:[wn.jsxs("div",{className:"flex items-center gap-4",children:[wn.jsxs("span",{className:"text-text-secondary",children:["Row ",wn.jsx("span",{className:"text-accent-primary font-semibold",children:g})]}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"}),wn.jsx("span",{className:"text-text-secondary",children:v}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"}),wn.jsx("span",{className:"text-text-secondary capitalize",children:t.columnType}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"}),wn.jsxs("span",{className:"text-text-secondary",children:["Oct ",wn.jsx("span",{className:"text-accent-primary font-semibold",children:n})]}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"}),wn.jsxs("span",{className:"text-text-secondary",title:a?"Insert mode: new data shifts rows down":"Overwrite mode: new data replaces existing",children:["Mode: ",wn.jsx("span",{className:a?"text-accent-warning":"text-accent-primary",children:a?"INS":"OVR"})]}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"}),wn.jsx("span",{className:"px-2 py-0.5 rounded "+(s?"bg-accent-error/20 text-accent-error":"text-text-muted"),children:s?"REC":"EDIT"})]}),wn.jsxs("div",{className:"flex items-center gap-4",children:[b&&wn.jsxs(wn.Fragment,{children:[wn.jsxs("button",{onClick:()=>f(!m),className:"flex items-center gap-1.5 text-[10px] text-text-muted hover:text-accent-primary transition-colors",title:m?"Hide MIDI controls":"Show MIDI controls",children:[wn.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"}),wn.jsx("span",{className:"font-bold uppercase",children:w}),m?wn.jsx(Me,{size:12}):wn.jsx(xt,{size:12})]}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),e&&wn.jsxs(wn.Fragment,{children:[wn.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-accent-warning/10 text-accent-warning hover:bg-accent-warning/20 transition-colors",title:"Tip of the Day",children:[wn.jsx(dn,{size:12}),wn.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Tips"})]}),wn.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),wn.jsxs("span",{className:"flex items-center gap-1.5 "+("running"===l?"text-accent-success":"text-text-muted"),children:[wn.jsx("span",{className:"w-2 h-2 rounded-full "+("running"===l?"bg-accent-success":"bg-text-muted")}),"running"===l?"Audio Active":"Audio Off"]})]})]})]})});const qT="devilbox-project";function YT(){try{const e=tf.getState(),t=Py.getState(),n=By.getState(),a=Ry.getState(),s=Vy.getState(),r=Ly.getState(),o={version:"1.0.0",schemaVersion:2,savedAt:(new Date).toISOString(),metadata:n.metadata,bpm:a.bpm,patterns:e.patterns,patternOrder:e.patternOrder,instruments:t.instruments.map(e=>{if(e.metadata?.preservedSynth&&e.sample?.url?.startsWith("blob:")){const t={...e};return t.sample={...e.sample,url:""},t}return e}),automation:s.curves,masterEffects:r.masterEffects,..."straight"!==a.grooveTemplateId?{grooveTemplateId:a.grooveTemplateId}:{}};return!o.instruments.some(e=>"MOD"===e.metadata?.importedFrom||"XM"===e.metadata?.importedFrom||"IT"===e.metadata?.importedFrom||"S3M"===e.metadata?.importedFrom)&&(localStorage.setItem(qT,JSON.stringify(o)),n.markAsSaved(),!0)}catch(e){return!1}}function XT(){try{const e=localStorage.getItem(qT);if(!e)return!1;const t=JSON.parse(e);if(!t.version||!t.patterns||!t.instruments)return!1;if(!t.schemaVersion||t.schemaVersion<2)return localStorage.removeItem(qT),!1;if(xy(t.patterns,t.instruments)){const e=wy(t.patterns,t.instruments);t.patterns=e.patterns,t.instruments=e.instruments}const n=tf.getState(),a=Py.getState(),s=By.getState(),r=Ry.getState(),o=Vy.getState(),i=Ly.getState();return n.loadPatterns(t.patterns),t.patternOrder&&t.patternOrder.length>0&&n.setPatternOrder(t.patternOrder),a.loadInstruments(t.instruments),s.setMetadata(t.metadata),r.setBPM(t.bpm),t.automation&&o.loadCurves(t.automation),t.masterEffects&&i.setMasterEffects(t.masterEffects),r.setGrooveTemplate(t.grooveTemplateId||"straight"),a.autoBakeInstruments(),s.markAsSaved(),!0}catch(e){return!1}}function QT(){try{return null!==localStorage.getItem(qT)}catch{return!1}}function ZT(){try{localStorage.removeItem(qT)}catch(e){}}const JT={success:wn.jsx(pn,{size:18}),error:wn.jsx(De,{size:18}),warning:wn.jsx(un,{size:18}),info:wn.jsx(Tt,{size:18})},eA={success:"text-accent-success border-accent-success/30 bg-accent-success/10",error:"text-accent-error border-accent-error/30 bg-accent-error/10",warning:"text-accent-warning border-accent-warning/30 bg-accent-warning/10",info:"text-accent-primary border-accent-primary/30 bg-accent-primary/10"},tA=()=>{const{notifications:e,removeNotification:t}=eg();return 0===e.length?null:wn.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:e.map(e=>wn.jsxs("div",{className:`\n            flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg\n            animate-slide-in-right\n            ${eA[e.type]}\n          `,role:"alert",children:[wn.jsx("span",{className:"flex-shrink-0 mt-0.5",children:JT[e.type]}),wn.jsx("p",{className:"flex-1 text-sm font-medium text-text-primary",children:e.message}),wn.jsx("button",{onClick:()=>t(e.id),className:"flex-shrink-0 p-0.5 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss notification",children:wn.jsx(Ee,{size:14,className:"text-text-muted"})})]},e.id))})},nA=({onRefresh:e,onDismiss:t,currentVersion:n,latestVersion:a})=>wn.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[60] max-w-md w-full px-4",children:wn.jsxs("div",{className:"\n          flex items-center gap-3 px-4 py-3 rounded-lg border shadow-2xl\n          bg-accent-primary/20 border-accent-primary/40 backdrop-blur-sm\n          animate-slide-in-top\n        ",role:"alert",children:[wn.jsx(kt,{size:20,className:"text-accent-primary flex-shrink-0 animate-pulse"}),wn.jsxs("div",{className:"flex-1 min-w-0",children:[wn.jsx("p",{className:"text-sm font-semibold text-text-primary mb-1",children:"Update Available"}),wn.jsxs("p",{className:"text-xs text-text-muted",children:["Version ",a," is now available (current: ",n,")"]})]}),wn.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[wn.jsx(Ob,{onClick:e,className:"px-3 py-1.5 text-xs bg-accent-primary hover:bg-accent-primary/80 text-white font-medium rounded",children:"Refresh"}),wn.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss update notification",children:wn.jsx(Ee,{size:16,className:"text-text-muted"})})]})]})}),aA=()=>{const{activeError:e,dismissError:t,copyToClipboard:n,getDebugString:a}=jo(),[r,o]=s.useState(!1),[i,l]=s.useState(!1);if(!e)return null;const c=()=>{t(e.id),o(!1),l(!1)};return wn.jsxs(dw,{isOpen:!0,onClose:c,size:"lg",closeOnBackdropClick:!1,closeOnEscape:!0,children:[wn.jsx(uw,{title:"Synth Error",subtitle:{init:"Initialization Error",wasm:"WASM Engine Error",runtime:"Runtime Error",audio:"Audio Context Error"}[e.errorType],icon:wn.jsx(un,{className:"w-6 h-6 text-red-500"})}),wn.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[wn.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4",children:wn.jsx("div",{className:"flex items-start gap-3",children:wn.jsxs("div",{className:"flex-1",children:[wn.jsxs("p",{className:"font-mono text-sm text-red-300",children:[wn.jsx("span",{className:"text-red-400 font-bold",children:e.synthType}),e.synthName&&wn.jsxs("span",{className:"text-red-300/70",children:[" (",e.synthName,")"]})]}),wn.jsx("p",{className:"mt-2 text-white",children:e.message})]})})}),wn.jsxs("button",{onClick:()=>l(!i),className:"flex items-center gap-2 text-sm text-dark-text-secondary hover:text-white transition-colors",children:[i?wn.jsx(xt,{size:16}):wn.jsx(Me,{size:16}),i?"Hide":"Show"," Debug Details"]}),i&&wn.jsxs("div",{className:"bg-dark-surface rounded-lg p-4 space-y-3",children:[wn.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary",children:"Timestamp:"}),wn.jsx("p",{className:"font-mono text-xs",children:e.debugData.timestamp})]}),wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary",children:"AudioContext:"}),wn.jsx("p",{className:"font-mono text-xs",children:e.debugData.audioContextState})]}),wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary",children:"WASM Supported:"}),wn.jsx("p",{className:"font-mono text-xs",children:e.debugData.wasmSupported?"Yes":"No"})]}),wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary",children:"Error Type:"}),wn.jsx("p",{className:"font-mono text-xs",children:e.errorType})]})]}),e.stack&&wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Stack Trace:"}),wn.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-red-300 overflow-x-auto max-h-32 overflow-y-auto",children:e.stack})]}),wn.jsxs("div",{children:[wn.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Full Debug Report:"}),wn.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-dark-text-secondary overflow-x-auto max-h-40 overflow-y-auto whitespace-pre-wrap",children:a(e)})]})]}),wn.jsx("p",{className:"text-sm text-dark-text-secondary",children:"This synth failed to initialize properly. Please copy the debug information and report this issue. The synth will not be available until the error is resolved."})]}),wn.jsx(pw,{children:wn.jsxs("div",{className:"flex justify-between w-full",children:[wn.jsx("button",{onClick:async()=>{await n(e)&&(o(!0),setTimeout(()=>o(!1),2e3))},className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:r?wn.jsxs(wn.Fragment,{children:[wn.jsx(Fe,{size:16,className:"text-green-500"}),wn.jsx("span",{className:"text-green-500",children:"Copied!"})]}):wn.jsxs(wn.Fragment,{children:[wn.jsx(He,{size:16}),wn.jsx("span",{children:"Copy Debug Info"})]})}),wn.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition-colors",children:[wn.jsx(Ee,{size:16}),wn.jsx("span",{children:"Dismiss"})]})]})})]})};const sA=[".dbx",".dbi",".xml",".sqs",".seq",".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx",".mid",".midi",".wav",".mp3",".ogg",".flac",".aiff",".aif"];const rA=({onFileLoaded:e,children:t})=>{const[n,a]=s.useState(!1),[r,o]=s.useState(0),i=s.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),o(e=>e+1),e.dataTransfer.items&&e.dataTransfer.items.length>0){Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&a(!0)}},[]),l=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),o(e=>{const t=e-1;return 0===t&&a(!1),t})},[]),c=s.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),d=s.useCallback(async t=>{t.preventDefault(),t.stopPropagation(),a(!1),o(0);const n=Array.from(t.dataTransfer.files);if(0===n.length)return;const s=n.find(e=>function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return sA.includes(t)}(e.name));if(s)try{await e(s)}catch(r){}},[e]);return wn.jsxs("div",{onDragEnter:i,onDragLeave:l,onDragOver:c,onDrop:d,className:"relative w-full h-full",children:[t,n&&wn.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center pointer-events-none animate-fade-in",children:wn.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary border-dashed rounded-xl p-12 flex flex-col items-center gap-4 shadow-2xl",children:[wn.jsx(Ct,{size:64,className:"text-accent-primary animate-bounce"}),wn.jsxs("div",{className:"text-center",children:[wn.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"}),wn.jsx("p",{className:"text-text-muted text-sm",children:"Supports .dbx, .dbi, .xml, .mod, .xm, .it, .s3m, .fur, .mid, and more"})]})]})})]})},oA=s.lazy(()=>An(()=>import("./HelpModal-D2qKXot6.js"),__vite__mapDeps([7,1,2,4,3])).then(e=>({default:e.HelpModal}))),iA=s.lazy(()=>An(()=>import("./ExportDialog-DnUR5P5S.js"),__vite__mapDeps([8,1,2,3,4])).then(e=>({default:e.ExportDialog}))),lA=s.lazy(()=>An(()=>import("./EditInstrumentModal-CBV1UQnt.js"),__vite__mapDeps([9,1,2,4,3,10])).then(e=>({default:e.EditInstrumentModal}))),cA=s.lazy(()=>An(()=>import("./index-DdWT8iC5.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.MasterEffectsModal}))),dA=s.lazy(()=>An(()=>import("./index-DdWT8iC5.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.InstrumentEffectsModal}))),uA=s.lazy(()=>An(()=>import("./index-DdWT8iC5.js"),__vite__mapDeps([11,1,2,10,4,3])).then(e=>({default:e.EffectParameterEditor}))),pA=s.lazy(()=>An(()=>import("./TD3PatternDialog-tuexvlDs.js"),__vite__mapDeps([12,1,2,5,3,4,6,13])).then(e=>({default:e.TD3PatternDialog}))),hA=s.lazy(()=>An(()=>import("./DrumpadEditorModal-CWHBekV5.js"),__vite__mapDeps([14,1,2,4,3])).then(e=>({default:e.DrumpadEditorModal}))),mA=s.lazy(()=>An(()=>import("./TipOfTheDay-BGHy40vt.js"),__vite__mapDeps([15,1,2,4,3])).then(e=>({default:e.TipOfTheDay}))),fA=s.lazy(()=>An(()=>import("./PatternManagement-y3rDGB0F.js"),__vite__mapDeps([16,1,2,10,4,3])).then(e=>({default:e.PatternManagement}))),yA=s.lazy(()=>An(()=>import("./SamplePackBrowser-hod1PL00.js"),__vite__mapDeps([17,1,2,3,4])).then(e=>({default:e.SamplePackBrowser})));function gA(){const{updateAvailable:e,latestVersion:t,currentVersion:n,refresh:a}=function(e=3e5){const[t,n]=s.useState(!1),[a,r]=s.useState(null),o=async()=>{try{const e=`/DEViLBOX/version.json?t=${Date.now()}`,t=await fetch(e,{cache:"no-cache"});if(!t.ok)return;const a=await t.json();r(a),a.buildHash!==Nv&&n(!0)}catch(e){}};return s.useEffect(()=>{o();const t=setInterval(o,e);return()=>clearInterval(t)},[e]),{updateAvailable:t,latestVersion:a,currentVersion:{buildNumber:Mv,buildHash:Nv},refresh:()=>{window.location.reload()}}}(),[r,o]=s.useState(!1),{initialized:i,contextState:l,setInitialized:c,setContextState:d,setToneEngineInstance:u,setAnalyserNode:p,setFFTNode:h}=Ly(Fn(e=>({initialized:e.initialized,contextState:e.contextState,setInitialized:e.setInitialized,setContextState:e.setContextState,setToneEngineInstance:e.setToneEngineInstance,setAnalyserNode:e.setAnalyserNode,setFFTNode:e.setFFTNode}))),{showSamplePackModal:m,setShowSamplePackModal:f,applyAutoCompact:y}=Ay(),[g,v]=s.useState(null),[b,x]=s.useState(!1),[w,k]=s.useState(!1),[S,M]=s.useState(!1),[N,C]=s.useState(!1),[E,P]=s.useState(!1),[T,A]=s.useState(!1),[_,I]=s.useState(!1),[D,O]=s.useState(!1),[F,R]=s.useState("tips"),[j,L]=s.useState(null),[B,V]=s.useState(!1),[z,U]=s.useState(null),[G,W]=s.useState(!1),{showPatternDialog:K,closePatternDialog:H,showKnobBar:$,setShowKnobBar:q}=kg();s.useEffect(()=>{const e=localStorage.getItem("devilbox-seen-version"),t="false"!==localStorage.getItem("show-tips-at-startup");e!==n.buildNumber?(R("changelog"),O(!0)):t&&(R("tips"),O(!0))},[n.buildNumber]),function(){const{isPlaying:e,togglePlayPause:t,stop:n}=Ry(),{currentPatternIndex:a,patterns:r,setCurrentPattern:o,currentOctave:i,setCurrentOctave:l,cursor:c,moveCursorToChannel:d}=tf();s.useEffect(()=>{const e=ig();e.init();const s=[];return s.push(e.registerAction("transport.play",()=>{t()})),s.push(e.registerAction("transport.stop",()=>{n()})),s.push(e.registerAction("transport.playFromStart",()=>{n(),setTimeout(()=>t(),50)})),s.push(e.registerAction("pattern.next",()=>{a<r.length-1&&o(a+1)})),s.push(e.registerAction("pattern.previous",()=>{a>0&&o(a-1)})),s.push(e.registerAction("pattern.first",()=>{o(0)})),s.push(e.registerAction("pattern.last",()=>{o(r.length-1)})),s.push(e.registerAction("octave.up",()=>{i<8&&l(i+1)})),s.push(e.registerAction("octave.down",()=>{i>0&&l(i-1)})),s.push(e.registerAction("channel.next",()=>{const e=r[a];e&&c.channelIndex<e.channels.length-1&&d(c.channelIndex+1)})),s.push(e.registerAction("channel.previous",()=>{c.channelIndex>0&&d(c.channelIndex-1)})),()=>{s.forEach(e=>e())}},[e,t,n,a,r,o,i,l,c,d])}(),function(){const e=s.useCallback(e=>{const{patterns:t,currentPatternIndex:n,setCurrentPattern:a,currentOctave:s,setCurrentOctave:r}=tf.getState(),{isPlaying:o,isLooping:i,play:l,stop:c,pause:d,setIsLooping:u,currentRow:p,setCurrentRow:h}=Ry.getState(),{currentInstrumentId:m,setCurrentInstrument:f,instruments:y}=Py.getState(),{undo:g,redo:v}=zy.getState();switch(e){case"transport.play":o||l();break;case"transport.stop":c();break;case"transport.pause":d();break;case"transport.loop":u(!i);break;case"nav.patternUp":n<t.length-1&&a(n+1);break;case"nav.patternDown":n>0&&a(n-1);break;case"nav.rowUp":p>0&&h(p-1);break;case"nav.rowDown":const e=t[n];e&&p<e.length-1&&h(p+1);break;case"nav.toStart":h(0);break;case"nav.toEnd":const b=t[n];b&&h(b.length-1);break;case"edit.octaveUp":s<8&&r(s+1);break;case"edit.octaveDown":s>0&&r(s-1);break;case"edit.instrumentUp":if(null!==m){const e=m+1;y.some(t=>t.id===e)&&f(e)}break;case"edit.instrumentDown":if(null!==m&&m>1){const e=m-1;y.some(t=>t.id===e)&&f(e)}break;case"edit.undo":g();break;case"edit.redo":v()}},[]),t=s.useCallback((e,t)=>{const{instruments:n}=Py.getState(),a=Hm(),s=rg().getControlledInstrument();let r=n.filter(e=>("TB303"===e.synthType||"Buzz3o3"===e.synthType)&&e.tb303);if(null!==s){const e=n.find(e=>e.id===s);if(e&&e.tb303)r=[e];else if(e)return}0!==r.length&&r.forEach(n=>{if(!n.tb303)return;const s=JSON.parse(JSON.stringify(n.tb303));switch(e){case"cutoff":s.filter&&(s.filter.cutoff=t);break;case"resonance":s.filter&&(s.filter.resonance=t);break;case"envMod":s.filterEnvelope&&(s.filterEnvelope.envMod=t);break;case"decay":s.filterEnvelope&&(s.filterEnvelope.decay=t);break;case"accent":s.accent&&(s.accent.amount=t);break;case"slideTime":s.slide&&(s.slide.time=t);break;case"overdrive":s.overdrive&&(s.overdrive.amount=t);break;case"normalDecay":s.devilFish&&(s.devilFish.normalDecay=t);break;case"accentDecay":s.devilFish&&(s.devilFish.accentDecay=t);break;case"softAttack":s.devilFish&&(s.devilFish.softAttack=t);break;case"vegSustain":s.devilFish&&(s.devilFish.vegSustain=t);break;case"filterFM":s.devilFish&&(s.devilFish.filterFM=t);break;case"filterTracking":s.devilFish&&(s.devilFish.filterTracking=t)}a.updateTB303Parameters(n.id,s)})},[]),n=s.useCallback((n,a,s)=>{if(a.startsWith("transport.")||a.startsWith("nav.")||a.startsWith("edit.")||a.startsWith("channel.")||a.startsWith("pattern.")||a.startsWith("view."))s>64&&e(a);else if(a.startsWith("tb303.")){const e=a.replace("tb303.","");return void t(e,s)}},[e,t]);s.useEffect(()=>rg().onParameterChange(n),[n])}(),s.useEffect(()=>{const e=cg(),t=Km.getInstance();e.init();const n=(e,n)=>{const a=Py.getState().instruments.find(t=>t.id===e.targetInstrumentId);if(!a)return;const s=e.targetNote??60,r=ce(s,"midi").toNote(),o=2===r.length?r.charAt(0)+"-"+r.charAt(1):r,i=n/127;if(n>0){t.triggerPolyNoteAttack(a.id,r,i,{...a,isLive:!0});const e=tf.getState(),n=Ry.getState();if(e.recordMode){const t=n.isPlaying?n.currentRow:e.cursor.rowIndex;let s=e.cursor.channelIndex;e.multiRecEnabled&&n.isPlaying&&(s=e.findBestChannel());const r=Ua(o);if(e.setCell(s,t,{note:r,instrument:a.id}),!n.isPlaying&&e.editStep>0){const n=e.patterns[e.currentPatternIndex];if(n){const a=(t+e.editStep)%n.length;e.moveCursorToRow(a)}}}}else{t.triggerPolyNoteRelease(a.id,r,{...a,isLive:!0});const e=tf.getState(),n=Ry.getState();e.recordMode&&n.isPlaying&&e.recReleaseEnabled}},a=e.onTrigger(n),s=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const a=kg.getState();if("NumpadEnter"===t.code||"Enter"===t.key&&3===t.location)return t.preventDefault(),void a.togglePadBank();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===a.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&n(r,127)}},r=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const a=kg.getState();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===a.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&n(r,0)}};return window.addEventListener("keydown",s),window.addEventListener("keyup",r),()=>{a(),window.removeEventListener("keydown",s),window.removeEventListener("keyup",r)}},[]),s.useEffect(()=>{(async()=>{try{const{connectToNKSPairedDevice:e}=await An(async()=>{const{connectToNKSPairedDevice:e}=await Promise.resolve().then(()=>Nb);return{connectToNKSPairedDevice:e}},void 0);await e()}catch(e){}})()},[]);const{updateMasterEffect:Y}=Ly();s.useEffect(()=>{y()},[y]);const{save:X}=function(){const{isDirty:e,markAsModified:t}=By(),n=s.useRef(null),a=s.useRef(!1),r=s.useRef(!0);s.useEffect(()=>{!a.current&&QT()&&(a.current=!0,XT())},[]),s.useEffect(()=>tf.subscribe((e,n)=>{r.current?r.current=!1:e.patterns!==n.patterns&&t()}),[t]),s.useEffect(()=>Py.subscribe((e,n)=>{e.instruments!==n.instruments&&t()}),[t]),s.useEffect(()=>Ry.subscribe((e,n)=>{e.bpm===n.bpm&&e.grooveTemplateId===n.grooveTemplateId||t()}),[t]);const o=s.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e&&YT()},3e4)},[e]);return s.useEffect(()=>(e&&o(),()=>{n.current&&clearTimeout(n.current)}),[e,o]),s.useEffect(()=>{const t=t=>{e&&(YT(),t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),{save:s.useCallback(()=>YT(),[]),load:s.useCallback(()=>XT(),[]),hasSaved:QT(),clear:ZT,isDirty:e}}();s.useEffect(()=>{(async()=>{try{const e=Hm();u(e),p(e.analyser),h(e.fft),d(e.getContextState()),c(!0)}catch(e){v(e instanceof Error?e.message:"Unknown error")}})()},[]);const{undo:Q,redo:Z,canUndo:J,canRedo:ee}=zy(),{replacePattern:te,currentPatternIndex:ne}=tf(),ae=s.useCallback(()=>{if(!J())return;const e=Q();e&&te(ne,e)},[Q,J,te,ne]),se=s.useCallback(()=>{if(!ee())return;const e=Z();e&&te(ne,e)},[Z,ee,te,ne]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey)return e.preventDefault(),void ae();if((e.ctrlKey||e.metaKey)&&"z"===e.key&&e.shiftKey||(e.ctrlKey||e.metaKey)&&"y"===e.key)return e.preventDefault(),void se();if((e.ctrlKey||e.metaKey)&&"s"===e.key)return e.preventDefault(),void X();if("Escape"===e.key)return e.preventDefault(),void(w?k(!1):S?M(!1):N&&C(!1));if(e.shiftKey&&"?"===e.key)return e.preventDefault(),void k(!0);if(e.ctrlKey&&e.shiftKey&&"E"===e.key)return e.preventDefault(),void M(!0);if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return e.preventDefault(),void C(!N);if((e.ctrlKey||e.metaKey)&&"k"===e.key)return e.preventDefault(),void q(!$);if((e.ctrlKey||e.metaKey)&&"i"===e.key&&!e.shiftKey)return e.preventDefault(),void V(!B);if((e.ctrlKey||e.metaKey)&&"m"===e.key&&!e.shiftKey)return e.preventDefault(),void P(!E);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key)return e.preventDefault(),void A(!T);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key)return e.preventDefault(),void Ly.getState().toggleMasterMute();if(!("l"!==e.key&&"L"!==e.key||e.ctrlKey||e.metaKey||e.altKey))return e.preventDefault(),void Mg.getState().toggleLiveMode();const t=parseInt(e.key);if(!isNaN(t)&&t>=1&&t<=9){const n=Mg.getState();if(n.isLiveMode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();const a=t-1;return void(a<tf.getState().patterns.length&&n.queuePattern(a))}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[N,w,S,B,E,T,ae,se,X]);s.useEffect(()=>{const e=async()=>{if("running"!==l)try{const e=Hm();await e.init(),d(e.getContextState())}catch(t){}window.removeEventListener("click",e),window.removeEventListener("keydown",e)};return window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[l,d]);const re=s.useCallback(async e=>{const{loadPatterns:t,setPatternOrder:n}=tf.getState(),{loadInstruments:a}=Py.getState(),{setBPM:s,setGrooveTemplate:r}=Ry.getState(),{setMetadata:o}=By.getState();try{const i=e.name.toLowerCase();if(i.endsWith(".mid")||i.endsWith(".midi")){const n=await $P(e,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});t(n.patterns);a(n.patterns.map((e,t)=>({id:t+1,name:`Track ${t+1}`,type:"synth",synthType:"Synth",effects:[],volume:-6,pan:0}))),o({name:n.metadata.name,author:"",description:`Imported from ${e.name} (${n.metadata.tracks} tracks)`}),s(n.bpm),tg.success(`Loaded MIDI: ${n.metadata.name}`)}else if(i.endsWith(".fur")||i.endsWith(".dmf")){const{parseFurnaceSong:r,convertFurnaceToDevilbox:i}=await An(async()=>{const{parseFurnaceSong:e,convertFurnaceToDevilbox:t}=await Promise.resolve().then(()=>pN);return{parseFurnaceSong:e,convertFurnaceToDevilbox:t}},void 0),{convertToInstrument:l}=await An(async()=>{const{convertToInstrument:e}=await Promise.resolve().then(()=>aP);return{convertToInstrument:e}},void 0),c=await e.arrayBuffer(),d=i(await r(c)),u=d.instruments.map((e,t)=>l(e,t+1,"FUR")).flat().map((e,t)=>({...e,id:t+1})),p=d.metadata.modData?.patternOrderTable||[],h=d.patterns,m=h[0]?.length||64,f=h[0]?.[0]?.length||4,y=h.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:m,channels:Array.from({length:f},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:0,eff2:0}})}))}));a(u),t(y),p.length>0&&n(p),s(d.metadata.modData?.initialBPM||150),o({name:d.metadata.sourceFile.replace(/\.[^/.]+$/,""),author:"",description:`Imported from ${e.name} (Furnace)`}),tg.success(`Loaded Furnace: ${e.name} (${u.length} instruments, ${y.length} patterns)`)}else if(i.match(/\.(mod|xm|it|s3m|mptm|669|amf|ams|dbm|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))Ay.getState().setPendingModuleFile(e),tg.info(`Opening import dialog for ${e.name}...`);else if(i.endsWith(".dbx")){const i=await e.text(),l=JSON.parse(i),{needsMigration:c,migrateProject:d}=await An(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>ky);return{needsMigration:e,migrateProject:t}},void 0);let u=l.patterns,p=l.instruments;if(c(u,p)){const e=d(u,p);u=e.patterns,p=e.instruments}if(t(u),l.sequence&&Array.isArray(l.sequence)){const e=new Map(u.map((e,t)=>[e.id,t])),t=l.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&n(t)}p&&a(p),l.masterEffects&&Ly.getState().setMasterEffects(l.masterEffects),s(l.bpm),o(l.metadata),r(l.grooveTemplateId||"straight"),tg.success(`Loaded: ${l.metadata?.name||e.name}`)}}catch(i){tg.error(`Failed to load ${e.name}`)}},[]),oe=s.useCallback(async e=>{const{addInstrument:t}=Py.getState();try{const n=e.name.toLowerCase();if(n.match(/\.(dbx|mid|midi|mod|xm|it|s3m|fur|mptm|669|amf|ams|dbm|dmf|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))return U(e),void W(!0);if(n.endsWith(".dbi")){const n=await zE(e);n?.instrument?(t(n.instrument),tg.success(`Loaded instrument: ${n.instrument.name||"Untitled"}`)):tg.error(`Failed to load instrument: ${e.name}`)}else if(n.endsWith(".xml")){const t=await e.text(),n=t.includes("<db303-preset"),a=t.includes("<db303-pattern");if(n){const{parseDb303Preset:n}=await An(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-BMwWFetk.js");return{parseDb303Preset:e}},[]),{instruments:a,updateInstrument:s,addInstrument:r}=Py.getState(),o=n(t);let i=a.find(e=>"TB303"===e.synthType);if(!i){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();r(t),i=t}s(i.id,{tb303:{...i.tb303,...o}}),tg.success(`Loaded DB303 preset: ${e.name}`)}else if(a){const{parseDb303Pattern:n}=await An(async()=>{const{parseDb303Pattern:e}=await Promise.resolve().then(()=>tT);return{parseDb303Pattern:e}},void 0),{patterns:a,loadPatterns:s,setCurrentPattern:r,setPatternOrder:o}=tf.getState(),{instruments:i,addInstrument:l}=Py.getState(),{setBPM:c}=Ry.getState();let d=i.find(e=>"TB303"===e.synthType);if(!d){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),d=t}const u=e.name.replace(".xml","")||"Imported Pattern",{pattern:p,tempo:h}=n(t,u,d.id);p.channels[0].instrumentId=d.id;const m=[...a,p];s(m),r(m.length-1),o([m.length-1]),void 0!==h&&c(h),tg.success(`Loaded DB303 pattern: ${p.name}`)}else tg.error("Unknown XML format. Expected db303-pattern or db303-preset.")}else if(n.endsWith(".sqs")||n.endsWith(".seq")){const{parseTD3File:t}=await An(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:n}=await An(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-BjkPGM14.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{patterns:a,loadPatterns:s,setCurrentPattern:r,setPatternOrder:o}=tf.getState(),{instruments:i,addInstrument:l}=Py.getState();let c=i.find(e=>"TB303"===e.synthType);if(!c){const{createDefaultTB303Instrument:e}=await An(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-yThb9Tjn.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),c=t}const d=await e.arrayBuffer(),u=await t(d);if(0===u.patterns.length)return void tg.error("No patterns found in SQS file");const p=Py.getState().instruments.findIndex(e=>e.id===c.id)+1||1,h=u.patterns.map((e,t)=>{const a=n(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${c.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:c.id,color:"#ec4899",rows:a.slice(0,s).map(e=>({...e,instrument:e.note?p:0}))}]}});s([...a,...h]),r(a.length),o(h.map((e,t)=>a.length+t)),tg.success(`Loaded ${h.length} TD-3 pattern(s) from ${e.name}`)}else n.match(/\.(wav|mp3|ogg|flac|aiff|aif)$/)?(tg.info(`Audio sample: ${e.name}. Opening instrument editor...`),V(!0)):tg.warning(`Unsupported file format: ${e.name}`)}catch(n){tg.error(`Failed to handle ${e.name}`)}},[]),ie=async()=>{try{const e=Hm();await e.init(),d(e.getContextState()),x(!1)}catch(e){v(e instanceof Error?e.message:"Unknown error")}};return g?wn.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:wn.jsxs("div",{className:"panel p-8 max-w-md",children:[wn.jsx("h2",{className:"text-xl font-bold text-accent-error mb-4",children:"Audio Initialization Error"}),wn.jsx("p",{className:"text-text-secondary mb-4",children:g}),wn.jsx(Ob,{variant:"primary",onClick:()=>window.location.reload(),children:"Reload Application"})]})}):i?b&&"running"!==l?wn.jsx(Ub,{children:wn.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:wn.jsxs("div",{className:"text-center max-w-2xl",children:[wn.jsxs("div",{className:"mb-8",children:[wn.jsx("h1",{className:"text-5xl font-bold text-text-primary mb-2 tracking-tight",children:"DEViLBOX"}),wn.jsx("p",{className:"text-lg text-text-secondary",children:"TB-303 Acid Tracker with Devil Fish Mod"})]}),wn.jsx(Ob,{variant:"primary",size:"lg",onClick:ie,icon:wn.jsx(_e,{size:20}),className:"shadow-glow animate-pulse-glow",children:"Start Audio Engine"}),wn.jsxs("div",{className:"mt-12 grid grid-cols-2 gap-4 text-left",children:[wn.jsxs("div",{className:"card p-4",children:[wn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[wn.jsx("div",{className:"p-2 rounded-md bg-accent-primary/20 text-accent-primary",children:wn.jsx(Ae,{size:18})}),wn.jsx("h3",{className:"font-semibold text-text-primary",children:"22 Synth Engines"})]}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"Including authentic TB-303 with accent and slide"})]}),wn.jsxs("div",{className:"card p-4",children:[wn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[wn.jsx("div",{className:"p-2 rounded-md bg-accent-secondary/20 text-accent-secondary",children:wn.jsx(on,{size:18})}),wn.jsx("h3",{className:"font-semibold text-text-primary",children:"Pattern Editor"})]}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"4-16 channels with FT2-style keyboard layout"})]}),wn.jsxs("div",{className:"card p-4",children:[wn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[wn.jsx("div",{className:"p-2 rounded-md bg-accent-warning/20 text-accent-warning",children:wn.jsx(Te,{size:18})}),wn.jsx("h3",{className:"font-semibold text-text-primary",children:"Automation"})]}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"Real-time parameter curves for filter sweeps"})]}),wn.jsxs("div",{className:"card p-4",children:[wn.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[wn.jsx("div",{className:"p-2 rounded-md bg-accent-success/20 text-accent-success",children:wn.jsx(Ue,{size:18})}),wn.jsx("h3",{className:"font-semibold text-text-primary",children:"36+ Presets"})]}),wn.jsx("p",{className:"text-sm text-text-secondary",children:"Factory sounds for instant acid basslines"})]})]}),wn.jsxs("p",{className:"mt-8 text-sm text-text-muted",children:["Press ",wn.jsx("kbd",{className:"px-2 py-0.5 rounded bg-dark-bgTertiary border border-dark-border text-text-secondary",children:"?"})," anytime for help"]})]})})}):wn.jsx(rA,{onFileLoaded:oe,children:wn.jsxs(Ub,{children:[wn.jsxs("div",{className:"flex flex-col flex-1 min-h-0 min-w-0 overflow-y-hidden",children:[wn.jsx("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-y-hidden",children:wn.jsxs("div",{className:"flex flex-col min-h-0 min-w-0 flex-1",children:[N&&wn.jsx("div",{className:"h-48 border-b border-dark-border animate-fade-in",children:wn.jsx(s.Suspense,{fallback:wn.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"Loading patterns..."}),children:wn.jsx(fA,{})})}),wn.jsx("div",{className:"flex-1 min-h-0 min-w-0 flex flex-col",children:wn.jsx(HT,{onShowPatterns:()=>C(!N),onShowExport:()=>M(!0),onShowHelp:()=>k(!0),onShowMasterFX:()=>P(!E),onShowInstrumentFX:()=>A(!T),onShowInstruments:()=>V(!0),onShowDrumpads:()=>I(!0),showPatterns:N,showMasterFX:E,showInstrumentFX:T})})]})}),wn.jsx($T,{onShowTips:()=>O(!0)})]}),wn.jsxs(s.Suspense,{fallback:null,children:[w&&wn.jsx(oA,{isOpen:w,onClose:()=>k(!1)}),S&&wn.jsx(iA,{isOpen:S,onClose:()=>M(!1)}),B&&wn.jsx(lA,{isOpen:B,onClose:()=>V(!1)}),E&&wn.jsx(cA,{isOpen:E,onClose:()=>P(!1)}),T&&wn.jsx(dA,{isOpen:T,onClose:()=>A(!1)}),K&&wn.jsx(pA,{isOpen:K,onClose:H}),_&&wn.jsx(hA,{isOpen:_,onClose:()=>I(!1)}),m&&wn.jsx(yA,{onClose:()=>f(!1)}),D&&wn.jsx(mA,{isOpen:D,onClose:()=>O(!1),initialTab:F}),j&&wn.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:wn.jsx("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:wn.jsx(uA,{effect:j.effect,onUpdateParameter:(e,t)=>{if(!j)return;const n={...j.effect.parameters,[e]:t};Y(j.effect.id,{parameters:n}),L({...j,effect:{...j.effect,parameters:n}})},onUpdateWet:e=>{j&&(Y(j.effect.id,{wet:e}),L({...j,effect:{...j.effect,wet:e}}))},onClose:()=>L(null)})})}),G&&z&&wn.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:wn.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md mx-4 animate-slide-in-up shadow-2xl",children:[wn.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Load Song File?"}),wn.jsxs("p",{className:"text-text-secondary mb-6",children:["Loading ",wn.jsx("span",{className:"text-accent-primary font-mono",children:z.name})," will replace your current project."]}),wn.jsx("p",{className:"text-text-muted text-sm mb-6",children:"Make sure you've saved any unsaved changes before continuing."}),wn.jsxs("div",{className:"flex gap-3 justify-end",children:[wn.jsx(Ob,{variant:"ghost",onClick:()=>{W(!1),U(null)},children:"Cancel"}),wn.jsx(Ob,{variant:"primary",onClick:async()=>{z&&await re(z),W(!1),U(null)},children:"Load File"})]})]})})]}),wn.jsx(tA,{}),wn.jsx(aA,{}),e&&!r&&wn.jsx(nA,{onRefresh:a,onDismiss:()=>o(!0),currentVersion:n.buildNumber,latestVersion:t?.buildNumber||"unknown"})]})}):wn.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:wn.jsx("div",{className:"panel p-8",children:wn.jsxs("div",{className:"flex items-center gap-3 text-accent-primary",children:[wn.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),wn.jsx("span",{children:"Initializing audio engine..."})]})})})}class vA extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:wn.jsx("div",{className:"min-h-screen bg-bg flex items-center justify-center p-4",children:wn.jsxs("div",{className:"max-w-lg w-full bg-bg-secondary rounded-lg border border-border p-6 text-center",children:[wn.jsx("div",{className:"text-6xl mb-4",children:""}),wn.jsx("h1",{className:"text-2xl font-bold text-text mb-2",children:"Something went wrong"}),wn.jsx("p",{className:"text-text-secondary mb-4",children:"DEViLBOX encountered an unexpected error. Your work may have been auto-saved."}),!1,wn.jsxs("div",{className:"flex gap-3 justify-center",children:[wn.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-bg-tertiary hover:bg-border rounded text-text transition-colors",children:"Try Again"}),wn.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 bg-accent hover:bg-accent-hover rounded text-white transition-colors",children:"Reload App"})]})]})}):this.props.children}}const bA=["ChiptuneModule","Player","Sampler","DrumKit"];async function xA(e){const t=YN[e],n={synthType:e,name:t?.name||e,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,loadTimeMs:0};if(bA.includes(e))return n.error="Skipped (requires external resources)",n;const a=performance.now();try{const t={id:999,name:`Test ${e}`,type:"synth",synthType:e,effects:[],volume:-12,pan:0},r=Dm.createInstrument(t);if(n.loadTimeMs=performance.now()-a,!r)return n.error="createInstrument returned null",n;n.loaded=!0;const o=new pe("waveform",256);if(Xa(r)){const e=ns(o);e&&r.output.connect(e)}else r.connect(o);o.toDestination();try{"triggerAttack"in r&&"function"==typeof r.triggerAttack?(r.triggerAttack("C4",Q(),.8),n.noteOnWorked=!0):"triggerAttackRelease"in r&&"function"==typeof r.triggerAttackRelease&&(r.triggerAttackRelease("C4","8n",Q(),.8),n.noteOnWorked=!0)}catch(s){n.error=`Note trigger error: ${s}`}await new Promise(e=>setTimeout(e,100));try{const e=o.getValue().some(e=>Math.abs(e)>.001);n.producedSound=e}catch(s){}try{"triggerRelease"in r&&"function"==typeof r.triggerRelease&&(r.triggerRelease("C4",Q()),n.noteOffWorked=!0)}catch(s){}await new Promise(e=>setTimeout(e,50));try{if(Xa(r))try{r.output.disconnect()}catch{}else r.disconnect();o.disconnect(),"dispose"in r&&"function"==typeof r.dispose&&r.dispose(),o.dispose()}catch(s){}}catch(s){n.error=`${s}`,n.loadTimeMs=performance.now()-a}return n}async function wA(e={}){const{verbose:t=!0,filter:n,timeout:a=5e3}=e;await ye();const s=n?QN.filter(n):QN,r=[];for(const d of s){const e=await Promise.race([xA(d),new Promise(e=>setTimeout(()=>e({synthType:d,name:YN[d]?.name||d,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,error:"Timeout",loadTimeMs:a}),a))]);if(r.push(e),t){e.loaded&&e.producedSound}}const o=r.filter(e=>e.loaded&&e.noteOnWorked),i=r.filter(e=>!e.loaded&&!bA.includes(e.synthType)),l=r.filter(e=>bA.includes(e.synthType)),c={total:r.length,passed:o.length,failed:i.length,skipped:l.length,results:r,failedSynths:i.map(e=>e.synthType),passedSynths:o.map(e=>e.synthType),timestamp:(new Date).toISOString()};if(t){c.failedSynths.length>0&&c.failedSynths.forEach(e=>{r.find(t=>t.synthType===e)});const e=r.filter(e=>e.loaded&&!e.producedSound&&!bA.includes(e.synthType));e.length>0&&e.forEach(e=>{})}return c}"undefined"!=typeof window&&(window.testAllSynths=wA,window.testToneSynths=async function(){const e=["Synth","MonoSynth","DuoSynth","FMSynth","AMSynth","PluckSynth","MetalSynth","MembraneSynth","NoiseSynth","PolySynth"];return wA({filter:t=>e.includes(t)})},window.testCustomSynths=async function(){const e=["TB303","DubSiren","SpaceLaser","Synare","V2","Sam","Dexed","OBXd","SuperSaw","Organ","DrumMachine","ChipSynth","PWMSynth","WobbleBass","StringMachine","FormantSynth","GranularSynth","Wavetable"];return wA({filter:t=>e.includes(t)})},window.testFurnaceSynths=async function(){return wA({filter:e=>e.startsWith("Furnace"),timeout:1e4})},window.testBuzzmachineSynths=async function(){return wA({filter:e=>e.startsWith("Buzz")})},window.quickTestSynths=async function(){return wA({timeout:2e3})}),o(),Wm.subscribe(e=>{try{const t=Ry.getState().isPlaying;e.autoLatency&&!t||Hm().setAudioLatency(e.audioLatency)}catch(t){}});let kA=Ry.getState().isPlaying;Ry.subscribe(e=>{if(e.isPlaying!==kA){kA=e.isPlaying;try{const t=Wm.getState();if(t.autoLatency){const n=Hm();e.isPlaying?n.setAudioLatency(t.audioLatency):n.setAudioLatency("interactive")}}catch(t){}}}),window.addEventListener("error",e=>{}),window.addEventListener("unhandledrejection",e=>{}),Pn.createRoot(document.getElementById("root")).render(wn.jsx(s.StrictMode,{children:wn.jsx(vA,{children:wn.jsx(mx,{children:wn.jsx(gA,{})})})}));export{Bf as $,Pa as A,Ob as B,Ca as C,Oa as D,va as E,Po as F,xa as G,ya as H,pa as I,ua as J,da as K,ra as L,dw as M,jb as N,sa as O,fa as P,ma as Q,ha as R,XN as S,Km as T,La as U,ka as V,ba as W,oT as X,wa as Y,Ab as Z,al as _,Ao as a,Lf as a0,sl as a1,Zy as a2,Ji as a3,fr as a4,Gn as a5,Cm as a6,Yo as a7,xr as a8,Ea as a9,kg as aA,ag as aB,FE as aC,cg as aD,_v as aE,Lv as aF,th as aG,Mv as aH,Pv as aI,Ev as aJ,ex as aK,Mg as aL,Zb as aM,Xb as aN,Jn as aO,ea as aP,jn as aQ,Ga as aR,Ua as aS,rl as aT,Ja as aU,Lo as aV,ga as aa,Ia as ab,ia as ac,oa as ad,Sa as ae,Ma as af,py as ag,_a as ah,Ta as ai,Sr as aj,Am as ak,Wm as al,ca as am,QN as an,YN as ao,wT as ap,iy as aq,ja as ar,Ra as as,Fa as at,rx as au,xo as av,wo as aw,Mo as ax,No as ay,dg as az,Py as b,By as c,Ry as d,Vy as e,Ly as f,Hm as g,UE as h,zE as i,wn as j,VE as k,BE as l,LE as m,tg as n,jE as o,RE as p,Sv as q,uw as r,pw as s,kv as t,tf as u,ry as v,ZN as w,qa as x,Sg as y,Da as z};
