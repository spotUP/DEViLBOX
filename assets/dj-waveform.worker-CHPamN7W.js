!function(){"use strict";let t=null,e=null,o=1,l=400,n=120,i=null,a=0,s=0,r=[],f=!0;self.onmessage=c=>{const h=c.data;switch(h.type){case"init":t=h.canvas,t.width=Math.round(h.width*h.dpr),t.height=Math.round(h.height*h.dpr),e=t.getContext("2d"),o=h.dpr,l=h.width,n=h.height,i=h.waveformPeaks,a=h.durationMs,s=h.audioPosition,r=h.cuePoints,function(){const t=()=>{f&&function(){if(!e||!i||0===i.length)return;f=!1,e.setTransform(o,0,0,o,0,0);const t=a/1e3;if(t<=0)return;e.fillStyle="#0b0909",e.fillRect(0,0,l,n);const c=i.length,h=n/2,u=10,d=s-u/2;for(let o=0;o<l;o++){const n=d+o/l*u,a=n/t,r=Math.floor(a*c);if(r<0||r>=c)continue;const f=i[r]*h*.85;e.fillStyle=n<s?"rgba(80, 130, 220, 0.4)":"rgba(100, 170, 255, 0.7)",e.fillRect(o,h-f,1,2*f)}const g=s+u/2;for(const o of r){const t=o.position/1e3;if(t<d||t>g)continue;const i=(t-d)/u*l;e.fillStyle=o.color+"80",e.fillRect(Math.round(i),0,1,n),e.fillStyle=o.color,e.beginPath(),e.moveTo(i-3,0),e.lineTo(i+3,0),e.lineTo(i,5),e.closePath(),e.fill(),o.name&&(e.fillStyle=o.color,e.font="bold 8px monospace",e.fillText(o.name,i+3,10))}const p=l/2;e.fillStyle="#ffffff",e.fillRect(p-1,0,2,n),e.fillStyle="rgba(255,255,255,0.3)",e.fillRect(p-1,0,2,n),e.fillStyle="rgba(255,255,255,0.5)",e.font="10px monospace";const m=Math.floor(s/60),M=Math.floor(s%60),S=Math.floor(s%1*100);e.fillText(`${m}:${String(M).padStart(2,"0")}.${String(S).padStart(2,"0")}`,4,n-4)}(),requestAnimationFrame(t)};requestAnimationFrame(t)}(),self.postMessage({type:"ready"});break;case"waveformPeaks":i=h.peaks,a=h.durationMs,f=!0;break;case"position":s=h.audioPosition,f=!0;break;case"cuePoints":r=h.cuePoints,f=!0;break;case"resize":o=h.dpr,l=h.w,n=h.h,t&&(t.width=Math.round(l*o),t.height=Math.round(n*o)),f=!0}}}();
