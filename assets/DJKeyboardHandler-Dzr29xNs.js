const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-zx6LJBPK.js","assets/vendor-react-DkDaD07v.js","assets/vendor-utils-XMmR-oGw.js","assets/vendor-tone-CADp_hfL.js","assets/vendor-ui-uomqNFY-.js","assets/index-Cnoi0D0R.css"])))=>i.map(i=>d[i]);
import{aQ as e,cw as t,aR as o,j as n,cx as a,bw as r,cy as s,_ as c,cz as i,cA as l,cB as d,cC as m,cD as u,cE as p,cF as h,cG as b,bB as f,cH as x,cI as k,cJ as D,bC as N,bK as g,cK as v,cL as y,cu as j,bN as B}from"./index-zx6LJBPK.js";import{r as w}from"./vendor-utils-XMmR-oGw.js";import{i as E,p as C}from"./parseModuleToSong-BCo4MrbT.js";import{aC as V,l as P,I as S,X as L,Y as A,T as M,m as _,a2 as O,G as U,an as J,H as X,v as F,aD as T,a9 as q,aE as I,f as z,aF as $,aG as R,aH as G}from"./vendor-ui-uomqNFY-.js";const H=new Map;function Q(e,t){for(H.has(e)&&H.delete(e),H.set(e,t);H.size>8;){const e=H.keys().next().value;if(void 0===e)break;H.delete(e)}}function W(){H.clear()}const K=Object.freeze(Object.defineProperty({__proto__:null,cacheSong:Q,clearSongCache:W},Symbol.toStringTag,{value:"Module"}));function Y(e){const t=e.initialBPM,o=new Map;e.initialSpeed;const n=Math.min(e.songLength,8);for(let a=0;a<n;a++){const t=e.songPositions[a],n=e.patterns[t];n&&Z(n,e.format,o)}if(o.size>0){let e=0,n=t;for(const[t,a]of o)a>e&&(e=a,n=t);return{bpm:n,confidence:"exact",source:`Fxx effect (found ${o.size} BPM commands)`}}return t>0&&125!==t?{bpm:t,confidence:"estimated",source:"Song header initialBPM"}:{bpm:125,confidence:"default",source:"Default (no BPM data found)"}}function Z(e,t,o,n){for(const a of e.channels)for(const e of a.rows){const n=e.effTyp??0,a=e.eff??0;if(!n&&!a)continue;(("MOD"===t||"XM"===t)&&15===n||("IT"===t||"S3M"===t)&&20===n)&&a>=32&&o.set(a,(o.get(a)??0)+1)}}function ee(e){let t=0;for(let n=0;n<e.songLength;n++){const o=e.songPositions[n],a=e.patterns[o];t+=a?.length??64}const o=2.5/e.initialBPM;return t*e.initialSpeed*o}const te=Object.freeze(Object.defineProperty({__proto__:null,detectBPM:Y,estimateSongDuration:ee},Symbol.toStringTag,{value:"Module"})),oe="audioCache",ne=100;let ae=null;async function re(){return ae||new Promise((e,t)=>{const o=indexedDB.open("DEViLBOX_AudioCache",1);o.onerror=()=>t(new Error("Failed to open IndexedDB")),o.onsuccess=()=>{ae=o.result,e(ae)},o.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(oe)){t.createObjectStore(oe,{keyPath:"hash"}).createIndex("timestamp","timestamp",{unique:!1})}}})}async function se(e){const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}async function ce(e){try{const t=await re(),o=await se(e);return new Promise((e,n)=>{const a=t.transaction(oe,"readonly").objectStore(oe).get(o);a.onsuccess=()=>{const t=a.result;t?(!async function(e){try{const t=await re(),o=t.transaction(oe,"readwrite").objectStore(oe),n=o.get(e);n.onsuccess=()=>{const e=n.result;e&&(e.timestamp=Date.now(),o.put(e))}}catch(t){}}(o),e(t)):e(null)},a.onerror=()=>n(a.error)})}catch(t){return null}}async function ie(e){try{const t=await re(),o=await se(e);return new Promise(e=>{const n=t.transaction(oe,"readonly").objectStore(oe).getKey(o);n.onsuccess=()=>e(void 0!==n.result),n.onerror=()=>e(!1)})}catch{return!1}}async function le(e,t,o,n,a,r,s){try{const c=await re(),i=await se(e),l=o.byteLength,d={hash:i,filename:t,audioData:o,duration:n,waveformPeaks:Array.from(a),sampleRate:r,numberOfChannels:s,timestamp:Date.now(),sizeBytes:l};return await async function(e){const t=await de(),o=524288e3;if(t.totalSizeBytes+e>o){const n=t.totalSizeBytes+e-o;await me(n)}t.entryCount>=ne&&await me(0,t.entryCount-ne+1)}(l),new Promise((e,t)=>{const o=c.transaction(oe,"readwrite").objectStore(oe).put(d);o.onsuccess=()=>e(),o.onerror=()=>t(o.error)})}catch(c){throw c}}async function de(){try{const e=await re();return new Promise((t,o)=>{const n=e.transaction(oe,"readonly").objectStore(oe).getAll();n.onsuccess=()=>{const e=n.result,o=e.reduce((e,t)=>e+t.sizeBytes,0);t({totalSizeBytes:o,entryCount:e.length})},n.onerror=()=>o(n.error)})}catch{return{totalSizeBytes:0,entryCount:0}}}async function me(e=0,t=0){try{const o=await re();return new Promise((n,a)=>{const r=o.transaction(oe,"readwrite").objectStore(oe).index("timestamp").openCursor();let s=0,c=0;r.onsuccess=o=>{const a=o.target.result;if(!a)return void n();const r=a.value;s>=e&&c>=t?n():(a.delete(),s+=r.sizeBytes,c++,a.continue())},r.onerror=()=>a(r.error)})}catch(o){}}async function ue(){try{const e=await re();return new Promise((t,o)=>{const n=e.transaction(oe,"readwrite").objectStore(oe).clear();n.onsuccess=()=>{t()},n.onerror=()=>o(n.error)})}catch(e){throw e}}async function pe(){const e=await de();return{sizeMB:e.totalSizeBytes/1048576,entryCount:e.entryCount}}function he(e,t,o){const n=e.length,a=1*n*2,r=44+a,s=new ArrayBuffer(r),c=new DataView(s);be(c,0,"RIFF"),c.setUint32(4,r-8,!0),be(c,8,"WAVE"),be(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,1,!0),c.setUint32(24,o,!0),c.setUint32(28,1*o*2,!0),c.setUint16(32,2,!0),c.setUint16(34,16,!0),be(c,36,"data"),c.setUint32(40,a,!0);let i=44;for(let l=0;l<n;l++){const t=Math.max(-1,Math.min(1,e[l]));c.setInt16(i,t<0?32768*t:32767*t,!0),i+=2}return s}function be(e,t,o){for(let n=0;n<o.length;n++)e.setUint8(t+n,o.charCodeAt(n))}function fe(e,t,o){const n=new Float32Array(o),a=Math.floor(e.length/o);if(a<1)return n;for(let r=0;r<o;r++){const o=r*a,s=Math.min(o+a,e.length);let c=0;for(let n=o;n<s;n++){const o=.5*(Math.abs(e[n])+Math.abs(t[n]));o>c&&(c=o)}n[r]=c}return n}let xe=null;function ke(){return xe||(xe=new De),xe}class De{renderWorker=null;analysisWorker=null;queue=[];processing=!1;currentTaskId=null;currentDeckId=null;renderCallbacks=new Map;analysisCallbacks=new Map;inflight=new Map;constructor(){this.initWorkers()}initWorkers(){this.renderWorker=new Worker(new URL("/assets/dj-render.worker-CTgY1-Px.js",import.meta.url),{type:"module"}),this.renderWorker.onmessage=e=>this.handleRenderMessage(e),this.renderWorker.onerror=e=>{},this.analysisWorker=new Worker(new URL("/assets/dj-analysis.worker-DrdKCnmX.js",import.meta.url),{type:"module"}),this.analysisWorker.onmessage=e=>this.handleAnalysisMessage(e),this.analysisWorker.onerror=e=>{},this.renderWorker.postMessage({type:"init"}),this.analysisWorker.postMessage({type:"init"})}handleRenderMessage(e){const t=e.data;switch(t.type){case"ready":break;case"renderProgress":{const{id:e,progress:o}=t;e===this.currentTaskId&&this.updateDeckAnalysisState(e,"rendering",this.currentDeckId),this.emitTaskProgress(e,.5*o);break}case"renderComplete":{const{id:e,left:o,right:n,sampleRate:a,duration:r}=t,s=this.renderCallbacks.get(e);s&&(this.renderCallbacks.delete(e),s.resolve({left:o,right:n,sampleRate:a,duration:r}));break}case"renderError":{const{id:e,error:o}=t,n=this.renderCallbacks.get(e);n&&(this.renderCallbacks.delete(e),n.reject(new Error(o)));break}}}handleAnalysisMessage(e){const t=e.data;switch(t.type){case"ready":break;case"analysisProgress":{const{id:e,progress:o}=t;this.emitTaskProgress(e,50+.5*o);break}case"analysisComplete":{const{id:e,result:o}=t,n=this.analysisCallbacks.get(e);n&&(this.analysisCallbacks.delete(e),n.resolve(o));break}case"analysisError":{const{id:e,error:o}=t,n=this.analysisCallbacks.get(e);n&&(this.analysisCallbacks.delete(e),n.reject(new Error(o)));break}}}enqueue(t){return new Promise((o,n)=>{const a={task:t,resolve:o,reject:n},r={high:0,normal:1,low:2},s=this.queue.findIndex(e=>r[e.task.priority]>r[t.priority]);-1===s?this.queue.push(a):this.queue.splice(s,0,a),this.updateStoreQueue(),t.deckId&&e.getState().setDeckState(t.deckId,{analysisState:"pending"}),this.processNext()})}async renderAndAnalyze(e,t,o,n="normal"){const a=`${t}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return this.enqueue({id:a,fileBuffer:e,filename:t,deckId:o,priority:n})}async analyzeOnly(e,t,o,n,a,r,s="normal"){const c=`analyze-${t}-${Date.now()}`;return this.enqueue({id:c,fileBuffer:e,filename:t,deckId:r,priority:s,analysisOnly:!0,pcmLeft:o,pcmRight:n,sampleRate:a})}async loadOrEnqueue(t,o,n,a="high"){const r=await ce(t);if(r&&r.beatGrid&&r.bpm){if(n){const t=-14,o=r.rmsDb??-100,a=r.peakDb??-100,s=o>-80?Math.max(-12,Math.min(12,t-o)):0,c=e.getState().decks[n].autoGainEnabled?s:0;e.getState().setDeckState(n,{analysisState:"ready",beatGrid:r.beatGrid,musicalKey:r.musicalKey??null,keyConfidence:r.keyConfidence??0,frequencyPeaks:r.frequencyPeaks?r.frequencyPeaks.map(e=>new Float32Array(e)):null,rmsDb:o,peakDb:a,trimGain:c})}return{wavData:r.audioData,duration:r.duration,sampleRate:r.sampleRate,waveformPeaks:new Float32Array(r.waveformPeaks),analysis:{bpm:r.bpm,bpmConfidence:r.bpmConfidence??0,beats:r.beatGrid?.beats??[],downbeats:r.beatGrid?.downbeats??[],timeSignature:r.beatGrid?.timeSignature??4,musicalKey:r.musicalKey??"Unknown",keyConfidence:r.keyConfidence??0,frequencyPeaks:r.frequencyPeaks??[],rmsDb:r.rmsDb??-100,peakDb:r.peakDb??-100}}}if(r&&!r.beatGrid)try{const e=new OfflineAudioContext(2,1,44100),s=await e.decodeAudioData(r.audioData.slice(0)),c=s.getChannelData(0),i=s.numberOfChannels>1?s.getChannelData(1):c;return this.analyzeOnly(t,o,c,i,s.sampleRate,n,a)}catch(l){}const s=await se(t),c=this.inflight.get(s);if(c)return c;const i=this.renderAndAnalyze(t,o,n,a);return this.inflight.set(s,i),i.finally(()=>this.inflight.delete(s)),i}get queueSize(){return this.queue.length}get isActive(){return this.processing}cancelAll(){for(const e of this.queue)e.reject(new Error("Pipeline cancelled"));this.queue=[],this.updateStoreQueue()}cancelForDeck(e){const t=this.queue.filter(t=>t.task.deckId===e);this.queue=this.queue.filter(t=>t.task.deckId!==e);for(const o of t)o.reject(new Error(`Cancelled: deck ${e} reloaded`));this.updateStoreQueue()}dispose(){this.stopProgressTicker(),this.cancelAll(),this.renderWorker?.terminate(),this.analysisWorker?.terminate(),this.renderWorker=null,this.analysisWorker=null}async processNext(){if(this.processing||0===this.queue.length)return;this.processing=!0;const t=this.queue.shift(),{task:o,resolve:n,reject:a}=t;this.currentTaskId=o.id,this.currentDeckId=o.deckId??null,this.currentDeckId&&this.startProgressTicker(this.currentDeckId),this.updateStoreQueue();try{n(await this.executeTask(o))}catch(r){a(r instanceof Error?r:new Error(String(r)))}finally{this.stopProgressTicker(),this.processing=!1,this.currentTaskId=null,this.currentDeckId=null,this.queue.length>0?this.processNext():e.getState().setPipelineState(0,null)}}async executeTask(o){const n=performance.now();let a,r,s,c,i,l;if(o.analysisOnly&&o.pcmLeft)a=o.pcmLeft,r=o.pcmRight??o.pcmLeft,s=o.sampleRate??44100,c=a.length/s,i=he(a,0,s),l=fe(a,r,800);else if(o.wavData){i=o.wavData;const e=new OfflineAudioContext(2,1,44100),t=await e.decodeAudioData(i.slice(0));a=t.getChannelData(0),r=t.numberOfChannels>1?t.getChannelData(1):a,s=t.sampleRate,c=t.duration,l=fe(a,r,800)}else{this.updateDeckAnalysisState(o.id,"rendering",o.deckId);const e=await this.doRender(o);a=e.left,r=e.right,s=e.sampleRate,c=e.duration,this.emitTaskProgress(o.id,48),i=he(a,0,s),l=fe(a,r,800),this.emitTaskProgress(o.id,49),await le(o.fileBuffer,o.filename,i,c,l,s,2),await new Promise(e=>setTimeout(e,50))}this.updateDeckAnalysisState(o.id,"analyzing",o.deckId);let d=null;try{if(d=await this.doAnalysis(o.id,a,r,s),d){const e={beats:d.beats,downbeats:d.downbeats,bpm:d.bpm,timeSignature:d.timeSignature};await async function(e,t){try{const o=await re(),n=await se(e);return new Promise((e,a)=>{const r=o.transaction(oe,"readwrite").objectStore(oe),s=r.get(n);s.onsuccess=()=>{const o=s.result;if(!o)return void e();Object.assign(o,t),o.timestamp=Date.now();const n=r.put(o);n.onsuccess=()=>e(),n.onerror=()=>a(n.error)},s.onerror=()=>a(s.error)})}catch(o){}}(o.fileBuffer,{beatGrid:e,bpm:d.bpm,bpmConfidence:d.bpmConfidence,musicalKey:d.musicalKey,keyConfidence:d.keyConfidence,frequencyPeaks:d.frequencyPeaks,analysisVersion:1})}}catch(m){}if(o.deckId){if(d){const t=-14,n=d.rmsDb>-80?Math.max(-12,Math.min(12,t-d.rmsDb)):0,a=e.getState().decks[o.deckId].autoGainEnabled?n:0;e.getState().setDeckState(o.deckId,{analysisState:"ready",beatGrid:{beats:d.beats,downbeats:d.downbeats,bpm:d.bpm,timeSignature:d.timeSignature},musicalKey:d.musicalKey,keyConfidence:d.keyConfidence,frequencyPeaks:d.frequencyPeaks.map(e=>new Float32Array(e)),rmsDb:d.rmsDb,peakDb:d.peakDb,trimGain:a})}else e.getState().setDeckState(o.deckId,{analysisState:"ready"});const n=t();if(n){const t=n.getDeck(o.deckId),a=e.getState().decks[o.deckId];a.fileName===o.filename&&"tracker"===a.playbackMode&&t.hotSwapToAudio(i,o.filename).catch(e=>{})}}Math.round(performance.now()-n);return{wavData:i,duration:c,sampleRate:s,waveformPeaks:l,analysis:d}}doRender(e){return new Promise((t,o)=>{if(!this.renderWorker)return void o(new Error("Render worker not initialized"));this.renderCallbacks.set(e.id,{resolve:t,reject:o});const n=e.fileBuffer.slice(0);this.renderWorker.postMessage({type:"render",id:e.id,fileBuffer:n,filename:e.filename,subsong:e.subsong},[n])})}doAnalysis(e,t,o,n){return new Promise((a,r)=>{if(!this.analysisWorker)return void r(new Error("Analysis worker not initialized"));this.analysisCallbacks.set(e,{resolve:a,reject:r});const s=new Float32Array(t),c=new Float32Array(o);this.analysisWorker.postMessage({type:"analyze",id:e,pcmLeft:s,pcmRight:c,sampleRate:n,numBins:800},[s.buffer,c.buffer])})}updateStoreQueue(){e.getState().setPipelineState(this.queue.length+(this.processing?1:0),this.currentTaskId?`Processing: ${this.currentTaskId}`:null)}updateDeckAnalysisState(t,o,n){const a=n??this.findDeckForTask(t);a&&e.getState().setDeckState(a,{analysisState:o})}findDeckForTask(e){for(const t of this.queue)if(t.task.id===e&&t.task.deckId)return t.task.deckId;return null}progressTarget=0;progressDisplayed=0;progressTickTimer=null;progressDeckId=null;startProgressTicker(t){this.stopProgressTicker(),this.progressTarget=0,this.progressDisplayed=0,this.progressDeckId=t,this.progressTickTimer=setInterval(()=>{if(this.progressDisplayed>=this.progressTarget)return;const t=this.progressTarget-this.progressDisplayed,o=Math.max(.5,.3*t);this.progressDisplayed=Math.min(this.progressTarget,this.progressDisplayed+o),this.progressDeckId&&e.getState().setDeckAnalysisProgress(this.progressDeckId,Math.round(this.progressDisplayed))},200)}stopProgressTicker(){this.progressTickTimer&&(clearInterval(this.progressTickTimer),this.progressTickTimer=null)}emitTaskProgress(t,o){const n=t===this.currentTaskId&&this.currentDeckId?this.currentDeckId:this.findDeckForTask(t);if(n)if(this.progressTarget=o,this.progressDeckId=n,o>=100)this.progressDisplayed=100,this.stopProgressTicker(),e.getState().setDeckAnalysisProgress(n,100);else if(this.progressDisplayed<o){const t=o-this.progressDisplayed;this.progressDisplayed+=.6*t,e.getState().setDeckAnalysisProgress(n,Math.round(this.progressDisplayed))}}}class Ne{static syncBPM(e,t){const o=e.replayer.getBPM()*e.replayer.getTempoMultiplier(),n=t.replayer.getBPM();if(n<=0||o<=0)return 0;const a=o/n,r=12*Math.log2(a);return Math.max(-16,Math.min(16,r))}static nudgeToPhase(e,t,o="forward"){const n=e.replayer.getCurrentRow(),a=t.replayer.getCurrentRow(),r=e.replayer.getSpeed(),s=n-a;if(Math.abs(s)<1)return;const c="forward"===o?3:-3,i=Math.min(Math.abs(s)*r,32);t.nudge(c,i)}static getBPMDifference(e,t){return e.replayer.getBPM()*e.replayer.getTempoMultiplier()-t.replayer.getBPM()*t.replayer.getTempoMultiplier()}static isSynced(e,t,o=.5){return Math.abs(this.getBPMDifference(e,t))<o}}function ge(t,o){const n=e.getState(),a=n.decks[t],r=Ce(n.decks[o]),s=Ce(a);if(r<=0||s<=0)return 0;const c=r/s,i=12*Math.log2(c),l=Math.max(-16,Math.min(16,i));return n.setDeckPitch(t,l),l}function ve(t,n,a="beat"){const r=e.getState();if(!r.decks[n].beatGrid)return;const s=Pe(n);if(!s)return;const c=r.decks[t];if(!c.beatGrid)return;const i=c.beatGrid,l=Ve(t),d="bar"===a?i.downbeats:i.beats;if(0===d.length)return;const m="bar"===a?s.barPhase:s.beatPhase;let u=0,p=1/0;for(let e=0;e<d.length;e++){const t=Math.abs(d[e]-l);t<p&&(p=t,u=e)}const h=i.bpm>0?60/i.bpm:.5,b=h*i.timeSignature,f="bar"===a?b:h;!function(t,n){try{const a=o().getDeck(t),r=e.getState().decks[t];if("audio"===a.playbackMode)a.audioPlayer.seek(Math.max(0,n)),e.getState().setDeckState(t,{audioPosition:n,elapsedMs:1e3*n});else{const o=r.durationMs>0?r.durationMs/1e3:1,s=Math.max(r.totalPositions,1),c=Math.min(Math.max(0,Math.floor(n/o*s)),s-1);a.cue(c,0),e.getState().setDeckPosition(t,c,0)}}catch{}}(t,d[u]+m*f)}function ye(t){const o=Pe(t);if(!o)return 0;const n=e.getState().decks[t];if(!n.beatGrid||n.beatGrid.bpm<=0)return 0;return 60/n.beatGrid.bpm*(1-o.beatPhase)}function je(t){const o=Pe(t);if(!o)return 0;const n=e.getState().decks[t];if(!n.beatGrid||n.beatGrid.bpm<=0)return 0;return 60/n.beatGrid.bpm*n.beatGrid.timeSignature*(1-o.barPhase)}function Be(e,t){const o=ye(e),n=setTimeout(t,1e3*o);return()=>clearTimeout(n)}function we(e,t){const o=je(e),n=setTimeout(t,1e3*o);return()=>clearTimeout(n)}function Ee(e){return Pe(e)}function Ce(e){return e.beatGrid?.bpm&&e.beatGrid.bpm>0?e.beatGrid.bpm:e.detectedBPM>0?e.detectedBPM:e.effectiveBPM>0?e.effectiveBPM:0}function Ve(t){const o=e.getState().decks[t];return"audio"===o.playbackMode?o.audioPosition:o.elapsedMs/1e3}function Pe(t){const o=e.getState().decks[t].beatGrid;if(!o||0===o.beats.length)return null;const n=Ve(t),a=o.beats,r=o.downbeats;let s=0,c=Math.abs(n-a[0]);for(let e=1;e<a.length;e++){const t=Math.abs(n-a[e]);if(t<c&&(c=t,s=e),a[e]>n+c)break}const i=o.bpm>0?60/o.bpm:.5,l=((n-a[s])%i+i)%i/i;let d=0;if(r.length>0){let e=Math.abs(n-r[0]);for(let t=1;t<r.length;t++){const o=Math.abs(n-r[t]);if(o<e&&(e=o,d=t),r[t]>n+e)break}}const m=i*o.timeSignature,u=((n-(r.length>0?r[d]:a[0]))%m+m)%m/m;return{position:n,nearestBeatIdx:s,nearestBeatTime:a[s],beatPhase:l,nearestDownbeatIdx:d,barPhase:u}}let Se="beat";const Le=new Map;function Ae(e){Se=e}function Me(){return Se}function _e(e,t){if("off"===Se)return t(),()=>{};const o="bar"===Se?we:Be;return("bar"===Se?je(e):ye(e))<.01?(t(),()=>{}):o(e,t)}function Oe(e,t,n){return _e(e,()=>{try{o().getDeck(e).setEQKill(t,n)}catch{}})}function Ue(e,t,n){try{o().getDeck(e).setEQKill(t,n)}catch{}}function Je(t,n,a=4,r){const s=`filterSweep:${t}`;ze(s);const c={id:0,cancelled:!1};Le.set(s,c);let i=500;try{const o=e.getState().decks[t],n=o.beatGrid?.bpm||o.detectedBPM||o.effectiveBPM||120;i=60*a/n*1e3}catch{}const l=Math.max(-1,Math.min(1,n)),d=_e(t,()=>{let e=0;try{e=function(e){return $e[e]??0}(t)}catch{e=0}const n=performance.now();c.id=requestAnimationFrame(function a(){if(c.cancelled)return;const d=performance.now()-n,m=Math.min(1,d/i),u=m<.5?2*m*m:1-Math.pow(-2*m+2,2)/2,p=e+(l-e)*u;try{o().getDeck(t).setFilterPosition(p),Re(t,p)}catch{}m<1?c.id=requestAnimationFrame(a):(Le.delete(s),r?.())})});return()=>{c.cancelled=!0,cancelAnimationFrame(c.id),Le.delete(s),d()}}function Xe(e){return _e(e,()=>{try{o().getDeck(e).setFilterPosition(0),Re(e,0)}catch{}})}function Fe(t,n=16,a="A",r){const s="crossfaderSweep";ze(s);const c={id:0,cancelled:!1};Le.set(s,c);let i=8e3;try{const t=e.getState().decks[a],o=t.beatGrid?.bpm||t.detectedBPM||t.effectiveBPM||120;i=60*n/o*1e3}catch{}const l=Math.max(0,Math.min(1,t)),d=_e(a,()=>{let e=.5;try{e=o().mixer.getCrossfader()}catch{}const t=performance.now();c.id=requestAnimationFrame(function n(){if(c.cancelled)return;const a=performance.now()-t,r=Math.min(1,a/i),d=r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2,m=e+(l-e)*d;try{o().setCrossfader(m)}catch{}r<1?c.id=requestAnimationFrame(n):Le.delete(s)})});return()=>{c.cancelled=!0,cancelAnimationFrame(c.id),Le.delete(s),d()}}function Te(t,n,a=8,r=!0){const s=[];let c=!1;ge(n,t),ve(n,t,"bar");let i=4;try{const o=e.getState().decks[t];i=o.beatGrid?.timeSignature||4}catch{}const l=a*i,d=_e(t,()=>{if(c)return;try{const e=o();e.getDeck(n).play()}catch{}const e="A"===n?0:"B"===n?1:.5;s.push(Fe(e,l,t)),r&&s.push(Je(t,-.6,Math.floor(.75*l),()=>{if(!c)try{o().getDeck(t).setFilterPosition(-1),Re(t,-1)}catch{}}))});return s.push(d),()=>{c=!0,s.forEach(e=>e())}}function qe(t,n=4,a){const r=`echoOut:${t}`;ze(r);const s={id:0,cancelled:!1};Le.set(r,s);let c=2e3;try{const o=e.getState().decks[t],a=o.beatGrid?.bpm||o.detectedBPM||o.effectiveBPM||120;c=60*n/a*1e3}catch{}const i=_e(t,()=>{let e=1;try{e=o().getDeck(t).getVolume()}catch{}const n=performance.now();s.id=requestAnimationFrame(function i(){if(s.cancelled)return;const l=performance.now()-n,d=Math.min(1,l/c),m=e*Math.pow(1-d,2);try{o().getDeck(t).setVolume(m)}catch{}d<1?s.id=requestAnimationFrame(i):(Le.delete(r),a?.())})});return()=>{s.cancelled=!0,cancelAnimationFrame(s.id),Le.delete(r),i()}}function Ie(){Le.forEach(e=>{e.cancelled=!0,cancelAnimationFrame(e.id)}),Le.clear()}function ze(e){const t=Le.get(e);t&&(t.cancelled=!0,cancelAnimationFrame(t.id),Le.delete(e))}const $e={};function Re(e,t){$e[e]=t}const Ge=Object.freeze(Object.defineProperty({__proto__:null,beatMatchedTransition:Te,cancelAllAutomation:Ie,crossfaderSweep:Fe,echoOut:qe,filterReset:Xe,filterSweep:Je,getQuantizeMode:Me,instantEQKill:Ue,quantizedEQKill:Oe,setQuantizeMode:Ae,setTrackedFilterPosition:Re},Symbol.toStringTag,{value:"Module"})),He=({deckId:t,channel:a,size:r,muted:s,onClick:c})=>{const i=w.useRef(null),l=w.useRef(0),d=-1===a,m=w.useCallback(()=>{const n=i.current;if(!n)return;const c=window.devicePixelRatio||1;n.width===r*c&&n.height===r*c||(n.width=r*c,n.height=r*c,n.style.width=`${r}px`,n.style.height=`${r}px`);const u=n.getContext("2d");if(!u)return;u.setTransform(c,0,0,c,0,0);const p=getComputedStyle(n),h=p.getPropertyValue("--color-bg").trim()||"#0b0909",b=p.getPropertyValue("--color-border").trim()||"#2f2525",f=p.getPropertyValue("--color-success").trim()||"#10b981",x=p.getPropertyValue("--color-text-muted").trim()||"#686060",k=p.getPropertyValue("--color-accent").trim()||"#ef4444";u.fillStyle=h,u.fillRect(0,0,r,r),u.strokeStyle=s?k:b,u.lineWidth=s?1:.5,u.strokeRect(.5,.5,r-1,r-1);const D=r/2;u.beginPath(),u.moveTo(1,D),u.lineTo(r-1,D),u.strokeStyle=b,u.lineWidth=.5,u.stroke();let N=null;if(e.getState().decks[t]?.isPlaying??!1)try{N=o().getDeck(t).getWaveform()}catch{}if(N&&N.length>=256)if(d){u.beginPath();for(let e=0;e<256;e++){const t=1+e/255*(r-2),o=D-(N[e]||0)*(r/2-2);0===e?u.moveTo(t,o):u.lineTo(t,o)}u.strokeStyle=f,u.lineWidth=1,u.stroke()}else{const e=64,t=a*e;u.beginPath();for(let o=0;o<e;o++){const n=1+o/(e-1)*(r-2),a=D-(N[t+o]||0)*(r/2-2);0===o?u.moveTo(n,a):u.lineTo(n,a)}u.strokeStyle=s?x:f,u.lineWidth=1,u.globalAlpha=s?.3:1,u.stroke(),u.globalAlpha=1}u.fillStyle=s?k:x,u.globalAlpha=s?.8:.5,u.font="9px monospace",u.textAlign="left",u.textBaseline="top",u.fillText(d?"ALL":`CH${a+1}`,3,3),u.globalAlpha=1,s&&!d&&(u.fillStyle=k,u.globalAlpha=.15,u.fillRect(0,0,r,r),u.globalAlpha=1),l.current=requestAnimationFrame(m)},[t,a,r,s,d]);return w.useEffect(()=>(l.current=requestAnimationFrame(m),()=>cancelAnimationFrame(l.current)),[m]),n.jsxDEV("canvas",{ref:i,className:"block rounded-sm flex-shrink-0 cursor-pointer",style:{width:r,height:r},onClick:c,title:d?"Enable all channels":`CH${a+1} — click to mute/unmute, shift+click to solo`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScopes.tsx",lineNumber:148,columnNumber:5},void 0)},Qe=({deckId:t,size:o=64})=>{const a=e(e=>e.decks[t].channelMask),r=w.useCallback((o,n)=>{const a=e.getState();n.shiftKey?(a.setAllDeckChannels(t,!1),a.toggleDeckChannel(t,o)):a.toggleDeckChannel(t,o)},[t]),s=w.useCallback(()=>{e.getState().setAllDeckChannels(t,!0)},[t]);return n.jsxDEV("div",{className:"flex gap-1 flex-shrink-0",children:[Array.from({length:4},(e,s)=>{return n.jsxDEV(He,{deckId:t,channel:s,size:o,muted:(c=s,!(a&1<<c)),onClick:e=>r(s,e)},s,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScopes.tsx",lineNumber:181,columnNumber:9},void 0);var c}),n.jsxDEV(He,{deckId:t,channel:-1,size:o,muted:!1,onClick:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScopes.tsx",lineNumber:190,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScopes.tsx",lineNumber:179,columnNumber:5},void 0)},We=[{division:"1/4",label:"¼"},{division:"1/8",label:"⅛"},{division:"1/16",label:"⅟₁₆"},{division:"1/32",label:"⅟₃₂"}],Ke=({deckId:t})=>{const r=e(e=>e.decks[t].activePatternName),s=e(e=>e.decks[t].scratchVelocity),c=e(e=>e.decks[t].scratchFaderGain),i=e(e=>e.decks[t].faderLFOActive),l=e(e=>e.decks[t].faderLFODivision),[d,m]=w.useState(null),u=w.useRef(0),p="B"===t,h=p?"text-red-400":"text-blue-400",b=p?"bg-red-900/40 border-red-500/60":"bg-blue-900/40 border-blue-500/60",f=p?"bg-red-900/20 border-red-500/30":"bg-blue-900/20 border-blue-500/30",x=w.useCallback(()=>o().getDeck(t),[t]),k=w.useCallback((o,n)=>{if(n.currentTarget.setPointerCapture(n.pointerId),null!==r)return;u.current=performance.now();const a=e.getState();m(o);let s=0;try{x().playPattern(o,e=>{s=e,setTimeout(()=>{m(null),a.setDeckPattern(t,o)},e)})}catch{return void m(null)}0===s&&(m(null),a.setDeckPattern(t,o))},[t,r,x]),D=w.useCallback(o=>{if(performance.now()-u.current<300)try{x().finishPatternCycle()}catch{}else{try{x().stopPattern()}catch{}e.getState().setDeckPattern(t,null),m(null)}},[t,x]),N=w.useCallback(o=>{const n=e.getState();if(null===o||i&&l===o){try{x().stopFaderLFO()}catch{}n.setDeckFaderLFO(t,!1)}else{try{x().startFaderLFO(o)}catch{}n.setDeckFaderLFO(t,!0,o)}},[t,i,l,x]);return n.jsxDEV("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxDEV("div",{className:"flex items-center gap-1",children:a.map(e=>{const t=r===e.name,o=d===e.name;return n.jsxDEV("button",{onPointerDown:t=>k(e.name,t),onPointerUp:()=>D(e.name),onContextMenu:e=>e.preventDefault(),className:`\n                px-2 py-0.5 rounded border font-mono text-xs tracking-wider transition-all select-none\n                ${t?`${b} ${h}`:o?`${f} ${h} animate-pulse`:null!==r?"bg-transparent border-white/5 text-white/20 cursor-not-allowed":"bg-transparent border-white/10 text-white/40 hover:border-white/30 hover:text-white/70"}\n              `,title:e.name,children:o?"WAIT":e.shortName},e.name,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:125,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:120,columnNumber:7},void 0),(r||i)&&n.jsxDEV("div",{className:`flex items-center gap-1 font-mono text-xs ${h}`,children:[r&&n.jsxDEV(n.Fragment,{children:[n.jsxDEV("span",{className:"opacity-60",children:s>.1?">":s<-.1?"<":"|"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:154,columnNumber:15},void 0),n.jsxDEV("span",{className:"w-6 text-right tabular-nums opacity-80",children:Math.abs(s).toFixed(1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:157,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:153,columnNumber:13},void 0),n.jsxDEV("div",{className:"rounded-sm border",style:{width:4,height:12,borderColor:p?"rgba(248, 113, 113, 0.4)":"rgba(96, 165, 250, 0.4)",backgroundColor:c>.5?p?"rgba(248, 113, 113, 0.7)":"rgba(96, 165, 250, 0.7)":"transparent"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:163,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:151,columnNumber:9},void 0),n.jsxDEV("div",{className:"w-px h-4 bg-white/10 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:178,columnNumber:7},void 0),n.jsxDEV("div",{className:"flex items-center gap-1",children:[n.jsxDEV("span",{className:"text-xs font-mono text-white/30 mr-0.5",children:"LFO"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:182,columnNumber:9},void 0),n.jsxDEV("button",{onClick:()=>N(null),className:`\n            px-2 py-0.5 rounded border font-mono text-xs tracking-wider transition-all\n            ${i?"bg-transparent border-white/10 text-white/40 hover:border-white/30 hover:text-white/70":`${b} ${h}`}\n          `,children:"OFF"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:185,columnNumber:9},void 0),We.map(({division:e,label:t})=>{const o=i&&l===e;return n.jsxDEV("button",{onClick:()=>N(e),className:`\n                px-2 py-0.5 rounded border font-mono text-xs tracking-wider transition-all\n                ${o?`${b} ${h}`:"bg-transparent border-white/10 text-white/40 hover:border-white/30 hover:text-white/70"}\n              `,title:`Fader LFO ${e} note`,children:t},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:201,columnNumber:13},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:181,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckScratch.tsx",lineNumber:118,columnNumber:5},void 0)};function Ye(t,n){try{const a=e.getState().decks[t],r=o().getDeck(t),s=a.beatGrid;if(!s||s.bpm<=0){const o=.5*n;if("audio"===r.playbackMode){const n=Math.max(0,a.audioPosition+o);r.audioPlayer.seek(n),e.getState().setDeckState(t,{audioPosition:n,elapsedMs:1e3*n})}else{const o=Math.round(n),s=Math.max(0,Math.min(a.totalPositions-1,a.songPos+o));r.cue(s,0),e.getState().setDeckPosition(t,s,0)}return}const c=n*(60/s.bpm);if("audio"===r.playbackMode){const o=Math.max(0,a.audioPosition+c);r.audioPlayer.seek(o),e.getState().setDeckState(t,{audioPosition:o,elapsedMs:1e3*o})}else{const o=a.durationMs>0?a.durationMs/1e3:1,n=Math.max(a.totalPositions,1),s=a.elapsedMs/1e3,i=Math.max(0,s+c),l=Math.min(Math.max(0,Math.floor(i/o*n)),n-1);r.cue(l,0),e.getState().setDeckPosition(t,l,0)}}catch{}}function Ze(t,n){try{const a=e.getState(),r=a.decks[t].hotCues[n],s=o().getDeck(t);if(r){const e=r.position/1e3;if("audio"===s.playbackMode)s.audioPlayer.seek(e),a.setDeckState(t,{audioPosition:e,elapsedMs:r.position});else{const e=a.decks[t];if(e.durationMs>0&&e.totalPositions>0){const t=Math.floor(r.position/e.durationMs*e.totalPositions);s.cue(Math.max(0,Math.min(t,e.totalPositions-1)),0)}}}else{const e=["#E91E63","#FF9800","#2196F3","#4CAF50","#9C27B0","#00BCD4","#FFEB3B","#F44336"];let o=0;o="audio"===s.playbackMode?1e3*s.audioPlayer.getPosition():a.decks[t].elapsedMs,a.setHotCue(t,n,{position:o,color:e[n]||"#FFFFFF",name:""})}}catch{}}function et(t,n){try{const a=e.getState(),r=a.decks[t].seratoLoops.find(e=>e.index===n);if(!r)return;const s=o().getDeck(t),c=r.startPosition/1e3,i=r.endPosition/1e3;a.setAudioLoopIn(t,c),a.setAudioLoopOut(t,i),s.setAudioLoop(c,i),a.setDeckLoop(t,"line",!0),"audio"===s.playbackMode&&(s.audioPlayer.seek(c),a.setDeckState(t,{audioPosition:c,elapsedMs:r.startPosition}))}catch{}}const tt=["#E91E63","#FF9800","#2196F3","#4CAF50","#9C27B0","#00BCD4","#FFEB3B","#F44336"],ot=({deckId:t})=>{const a=e(e=>e.decks[t].hotCues),r=e(e=>e.decks[t].seratoCuePoints),s=e(e=>e.decks[t].playbackMode),c=w.useCallback((n,a)=>{try{const r=o().getDeck(t),s=e.getState(),c=s.decks[t].hotCues[n];if(a.shiftKey&&c)return void s.deleteHotCue(t,n);if(c){const e=c.position/1e3;if("audio"===r.playbackMode)r.audioPlayer.seek(e),s.setDeckState(t,{audioPosition:e,elapsedMs:c.position});else{const e=s.decks[t];if(e.durationMs>0&&e.totalPositions>0){const t=Math.floor(c.position/e.durationMs*e.totalPositions);r.cue(Math.max(0,Math.min(t,e.totalPositions-1)),0)}}}else{let e=0;const o=s.decks[t];e="audio"===r.playbackMode?1e3*r.audioPlayer.getPosition():o.elapsedMs;const a={position:e,color:tt[n],name:""};s.setHotCue(t,n,a)}}catch{}},[t]),i=a.map((e,t)=>{if(e)return{position:e.position,color:e.color,name:e.name,isNative:!0};const o=r.find(e=>e.index===t);return o?{position:o.position,color:o.color,name:o.name,isNative:!1}:null}),l=i.some(e=>null!==e);return"audio"===s||l?n.jsxDEV("div",{className:"flex gap-1",children:i.map((e,t)=>n.jsxDEV("button",{onClick:e=>c(t,e),className:"flex-1 h-6 rounded text-[9px] font-mono font-bold transition-all border border-transparent",style:e?{backgroundColor:`${e.color}30`,borderColor:`${e.color}80`,color:e.color}:{backgroundColor:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.15)"},title:e?`${e.name||`Cue ${t+1}`} — ${nt(e.position)}${e.isNative?"":" (Serato)"}\nShift+click to delete`:`Cue ${t+1} — click to set at current position`,children:e&&e.name||t+1},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckCuePoints.tsx",lineNumber:104,columnNumber:9},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckCuePoints.tsx",lineNumber:102,columnNumber:5},void 0):null};function nt(e){const t=Math.floor(e/1e3),o=Math.floor(t/60),n=t%60,a=Math.floor(e%1e3/10);return`${o}:${String(n).padStart(2,"0")}.${String(a).padStart(2,"0")}`}function at(e){return new Worker("/assets/dj-beatgrid.worker-B9WxezqL.js",{name:e?.name})}const rt=({deckId:t,height:o=24})=>{const a=w.useRef(null),s=w.useRef(null),c=w.useRef(null),i=e(e=>e.decks[t].seratoBeatGrid),l=e(e=>e.decks[t].beatGrid),d=e(e=>e.decks[t].playbackMode),m=i.length>0,u=null!==l&&l.beats.length>0,p=m||u;return w.useEffect(()=>{const n=s.current;if(!n||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;if(!p)return;const i=document.createElement("canvas");i.style.cssText=`display:block;width:100%;height:${o}px`,n.appendChild(i),a.current=i;const l=window.devicePixelRatio||1,d=Math.max(1,n.clientWidth),m=e.getState().decks[t],u=i.transferControlToOffscreen(),h="tracker"===m.playbackMode&&m.totalPositions>0?(m.songPos+.5)/m.totalPositions:0,b=new r(at,{onReady:()=>{}});c.current=b,b.post({type:"init",canvas:u,dpr:l,width:d,height:o,beatGrid:m.seratoBeatGrid,analysisBeatGrid:m.beatGrid,durationMs:m.durationMs,audioPosition:m.audioPosition,positionFraction:h},[u]);const f=e.subscribe(e=>[e.decks[t].audioPosition,e.decks[t].songPos,e.decks[t].totalPositions],([e,t,o])=>{const n=o>0?(t+.5)/o:0;c.current?.post({type:"position",audioPosition:e,positionFraction:n})}),x=e.subscribe(e=>[e.decks[t].seratoBeatGrid,e.decks[t].beatGrid],([o,n])=>c.current?.post({type:"beatGrid",beatGrid:o,analysisBeatGrid:n,durationMs:e.getState().decks[t].durationMs})),k=new ResizeObserver(e=>{const t=e[0];if(!t)return;const n=Math.floor(t.contentRect.width);n>0&&c.current?.post({type:"resize",w:n,h:o,dpr:window.devicePixelRatio||1})});return k.observe(n),()=>{f(),x(),k.disconnect(),b.dispose(),c.current=null,i.remove(),a.current=null}},[t,d,p,o]),p?n.jsxDEV("div",{ref:s,className:"absolute inset-0 pointer-events-none",style:{height:o}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatGrid.tsx",lineNumber:124,columnNumber:5},void 0):null};const st=({onClose:t})=>{const a=s(e=>e.playlists),r=s(e=>e.activePlaylistId),i=s(e=>e.createPlaylist),l=s(e=>e.deletePlaylist),d=s(e=>e.renamePlaylist),m=s(e=>e.setActivePlaylist),u=s(e=>e.addTrack),p=s(e=>e.removeTrack),h=s(e=>e.reorderTrack),[b,f]=w.useState(!1),[x,k]=w.useState(""),[D,N]=w.useState(null),[g,v]=w.useState(""),[y,j]=w.useState(null),[B,U]=w.useState(!1),J=w.useRef(null),X=a.find(e=>e.id===r)??null,F=w.useCallback(()=>{x.trim()&&(i(x.trim()),k(""),f(!1))},[x,i]),T=w.useCallback(e=>{g.trim()&&(d(e,g.trim()),N(null))},[g,d]),q=w.useCallback(async e=>{if(r&&e.target.files){U(!0);for(const o of Array.from(e.target.files))try{const e=E(o.name),t=o.name.split(".").pop()?.toUpperCase()??"MOD";if(e){const e={fileName:o.name,trackName:o.name.replace(/\.[^.]+$/,""),format:t,bpm:0,duration:0,addedAt:Date.now()};u(r,e)}else{const e=await C(o);Q(o.name,e);const n=Y(e),a=ee(e),s={fileName:o.name,trackName:e.name||o.name,format:t,bpm:n.bpm,duration:a,addedAt:Date.now()};u(r,s)}}catch(t){}U(!1),J.current&&(J.current.value="")}},[r,u]),I=w.useCallback(async(t,n,a,r)=>{const s=o(),c=Y(t);if(r){e.getState().setDeckState(a,{fileName:n,trackName:t.name||n,detectedBPM:c.bpm,effectiveBPM:c.bpm,analysisState:"rendering",isPlaying:!1});try{const o=await ke().loadOrEnqueue(r,n,a,"high");await s.loadAudioToDeck(a,o.wavData,n,t.name||n,o.analysis?.bpm||c.bpm,t),e.getState().setDeckViewMode("visualizer")}catch(i){}}},[]),z=w.useCallback(async(t,n)=>{const a=o();if(t.fileName.startsWith("modland:")){const o=t.fileName.slice(8);try{const{downloadModlandFile:r}=await c(async()=>{const{downloadModlandFile:e}=await import("./index-zx6LJBPK.js").then(e=>e.eE);return{downloadModlandFile:e}},__vite__mapDeps([0,1,2,3,4,5])),s=await r(o),i=o.split("/").pop()||"download.mod";if(E(i))await a.loadAudioToDeck(n,s,t.fileName),e.getState().setDeckViewMode("vinyl");else{const e=new File([s],i,{type:"application/octet-stream"}),o=await C(e);Q(t.fileName,o),await I(o,t.fileName,n,s)}return}catch(s){}}const r=document.createElement("input");r.type="file",r.accept="*/*",r.onchange=async()=>{const t=r.files?.[0];if(t)try{const o=await t.arrayBuffer();if(E(t.name))await a.loadAudioToDeck(n,o,t.name),e.getState().setDeckViewMode("vinyl");else{const e=await C(t);Q(t.name,e),await I(e,t.name,n,o)}}catch(s){}},r.click()},[I]),$=w.useCallback(e=>{j(e)},[]),R=w.useCallback((e,t)=>{e.preventDefault(),null!==y&&y!==t&&r&&(h(r,y,t),j(t))},[y,r,h]),G=w.useCallback(()=>{j(null)},[]),H=w.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!r)return;const t=Array.from(e.dataTransfer.files);if(0!==t.length){U(!0);for(const e of t)try{const t=E(e.name),o=e.name.split(".").pop()?.toUpperCase()??"MOD";if(t)u(r,{fileName:e.name,trackName:e.name.replace(/\.[^.]+$/,""),format:o,bpm:0,duration:0,addedAt:Date.now()});else{const t=await C(e);Q(e.name,t);const n=Y(t),a=ee(t);u(r,{fileName:e.name,trackName:t.name||e.name,format:o,bpm:n.bpm,duration:a,addedAt:Date.now()})}}catch(o){}U(!1)}},[r,u]);return n.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-2 max-h-[400px]",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(V,{size:14,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:298,columnNumber:11},void 0),n.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"Playlists"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:299,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:297,columnNumber:9},void 0),n.jsxDEV("div",{className:"flex items-center gap-1.5",children:[b?n.jsxDEV("div",{className:"flex items-center gap-1",children:[n.jsxDEV("input",{autoFocus:!0,value:x,onChange:e=>k(e.target.value),onKeyDown:e=>{"Enter"===e.key&&F(),"Escape"===e.key&&f(!1)},placeholder:"Playlist name...",className:"w-32 px-2 py-0.5 text-[10px] font-mono bg-dark-bg border border-dark-borderLight\n                           rounded text-text-primary placeholder:text-text-muted/40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:316,columnNumber:15},void 0),n.jsxDEV("button",{onClick:F,className:"p-0.5 text-green-400 hover:text-green-300",children:n.jsxDEV(S,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:329,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:328,columnNumber:15},void 0),n.jsxDEV("button",{onClick:()=>f(!1),className:"p-0.5 text-text-muted hover:text-text-primary",children:n.jsxDEV(L,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:332,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:331,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:315,columnNumber:13},void 0):n.jsxDEV("button",{onClick:()=>f(!0),className:"flex items-center gap-1 px-2 py-1 text-[10px] font-mono text-text-secondary\n                         bg-dark-bgTertiary border border-dark-borderLight rounded\n                         hover:bg-dark-bgHover hover:text-text-primary transition-colors",children:[n.jsxDEV(P,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:311,columnNumber:15},void 0),"New"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:305,columnNumber:13},void 0),t&&n.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary p-1",children:n.jsxDEV(L,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:338,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:337,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:303,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:296,columnNumber:7},void 0),a.length>0&&n.jsxDEV("div",{className:"flex gap-1 flex-wrap",children:a.map(e=>n.jsxDEV("div",{className:"group flex items-center gap-1 px-2 py-1 rounded text-[10px] font-mono cursor-pointer transition-colors "+(r===e.id?"bg-accent-primary/15 text-accent-primary border border-accent-primary/30":"bg-dark-bgTertiary text-text-muted border border-dark-borderLight hover:text-text-secondary"),onClick:()=>m(e.id),children:D===e.id?n.jsxDEV("input",{autoFocus:!0,value:g,onChange:e=>v(e.target.value),onKeyDown:t=>{"Enter"===t.key&&T(e.id),"Escape"===t.key&&N(null)},onBlur:()=>T(e.id),onClick:e=>e.stopPropagation(),className:"w-20 px-1 bg-dark-bg border border-dark-borderLight rounded text-[10px] text-text-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:358,columnNumber:17},void 0):n.jsxDEV(n.Fragment,{children:[n.jsxDEV("span",{className:"truncate max-w-[80px]",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:372,columnNumber:19},void 0),n.jsxDEV("span",{className:"text-text-muted/40",children:e.tracks.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:373,columnNumber:19},void 0),n.jsxDEV(A,{size:9,className:"opacity-0 group-hover:opacity-60 hover:!opacity-100 shrink-0",onClick:t=>{t.stopPropagation(),N(e.id),v(e.name)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:374,columnNumber:19},void 0),n.jsxDEV(M,{size:9,className:"opacity-0 group-hover:opacity-60 hover:!opacity-100 text-red-400 shrink-0",onClick:t=>{t.stopPropagation(),l(e.id)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:383,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:371,columnNumber:17},void 0)},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:348,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:346,columnNumber:9},void 0),X?n.jsxDEV("div",{className:"flex-1 overflow-y-auto min-h-0",onDragOver:e=>e.preventDefault(),onDrop:H,children:[n.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[n.jsxDEV("button",{onClick:()=>J.current?.click(),disabled:B,className:"flex items-center gap-1 px-2 py-1 text-[10px] font-mono text-text-secondary\n                         bg-dark-bgTertiary border border-dark-borderLight rounded\n                         hover:bg-dark-bgHover hover:text-text-primary transition-colors disabled:opacity-50",children:[n.jsxDEV(P,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:414,columnNumber:15},void 0),B?"Loading...":"Add Tracks"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:407,columnNumber:13},void 0),n.jsxDEV("span",{className:"text-[9px] font-mono text-text-muted/40",children:"or drop files here"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:417,columnNumber:13},void 0),n.jsxDEV("input",{ref:J,type:"file",multiple:!0,accept:"*/*",onChange:q,className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:420,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:406,columnNumber:11},void 0),0===X.tracks.length?n.jsxDEV("div",{className:"flex flex-col items-center justify-center py-6 text-text-muted",children:[n.jsxDEV(_,{size:20,className:"mb-1.5 opacity-30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:432,columnNumber:15},void 0),n.jsxDEV("p",{className:"text-[10px] font-mono",children:"Empty playlist"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:433,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:431,columnNumber:13},void 0):n.jsxDEV("div",{className:"flex flex-col gap-0.5",children:X.tracks.map((t,o)=>{return n.jsxDEV("div",{draggable:!0,onDragStart:()=>$(o),onDragOver:e=>R(e,o),onDragEnd:G,className:"flex items-center gap-1.5 px-2 py-1.5 rounded border transition-colors group "+(y===o?"bg-accent-primary/10 border-accent-primary/30":"bg-dark-bg border-dark-borderLight hover:border-dark-border"),children:[n.jsxDEV(O,{size:10,className:"text-text-muted/30 group-hover:text-text-muted/60 shrink-0 cursor-grab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:451,columnNumber:19},void 0),n.jsxDEV("span",{className:"text-[9px] font-mono text-text-muted/40 w-4 text-right shrink-0",children:o+1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:457,columnNumber:19},void 0),n.jsxDEV("div",{className:"flex-1 min-w-0",children:[n.jsxDEV("div",{className:"text-text-primary text-[11px] font-mono truncate",children:t.trackName},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:463,columnNumber:21},void 0),n.jsxDEV("div",{className:"flex gap-2 text-[9px] text-text-muted/50 font-mono",children:[n.jsxDEV("span",{children:t.format},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:467,columnNumber:23},void 0),t.bpm>0&&n.jsxDEV("span",{children:[t.bpm," BPM"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:468,columnNumber:41},void 0),t.duration>0&&n.jsxDEV("span",{children:(a=t.duration,`${Math.floor(a/60)}:${Math.floor(a%60).toString().padStart(2,"0")}`)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:469,columnNumber:46},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:466,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:462,columnNumber:19},void 0),n.jsxDEV("button",{onClick:()=>z(t,"A"),className:"px-1.5 py-0.5 text-[9px] font-mono font-bold rounded\n                               bg-blue-900/30 text-blue-400 border border-blue-800/50\n                               hover:bg-blue-800/40 hover:text-blue-300 transition-colors\n                               opacity-0 group-hover:opacity-100",title:"Load to Deck 1",children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:474,columnNumber:19},void 0),n.jsxDEV("button",{onClick:()=>z(t,"B"),className:"px-1.5 py-0.5 text-[9px] font-mono font-bold rounded\n                               bg-red-900/30 text-red-400 border border-red-800/50\n                               hover:bg-red-800/40 hover:text-red-300 transition-colors\n                               opacity-0 group-hover:opacity-100",title:"Load to Deck 2",children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:484,columnNumber:19},void 0),e.getState().thirdDeckActive&&n.jsxDEV("button",{onClick:()=>z(t,"C"),className:"px-1.5 py-0.5 text-[9px] font-mono font-bold rounded\n                                 bg-emerald-900/30 text-emerald-400 border border-emerald-800/50\n                                 hover:bg-emerald-800/40 hover:text-emerald-300 transition-colors\n                                 opacity-0 group-hover:opacity-100",title:"Load to Deck 3",children:"3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:495,columnNumber:21},void 0),n.jsxDEV("button",{onClick:()=>p(X.id,o),className:"p-0.5 text-text-muted hover:text-accent-error transition-colors\n                               opacity-0 group-hover:opacity-100",children:n.jsxDEV(L,{size:9},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:511,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:506,columnNumber:19},void 0)]},`${t.fileName}-${o}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:438,columnNumber:17},void 0);var a})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:436,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:400,columnNumber:9},void 0):n.jsxDEV("div",{className:"flex-1 flex flex-col items-center justify-center py-8 text-text-muted",children:[n.jsxDEV(V,{size:24,className:"mb-2 opacity-30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:520,columnNumber:11},void 0),n.jsxDEV("p",{className:"text-[10px] font-mono",children:"Create a playlist to get started"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:521,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:519,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJPlaylistPanel.tsx",lineNumber:294,columnNumber:5},void 0)},ct=({onClose:t})=>{const[a,r]=w.useState(""),[h,b]=w.useState(""),[f,x]=w.useState([]),[k,D]=w.useState([]),[N,g]=w.useState(null),[v,y]=w.useState(!1),[j,B]=w.useState(null),[E,V]=w.useState(0),[P,S]=w.useState(!1),[A,M]=w.useState(new Set),[_,O]=w.useState(-1),q=w.useRef(null),I=w.useRef(null),z=w.useRef(null),$=i();w.useEffect(()=>{l().then(g).catch(()=>{}),d().then(D).catch(()=>{}),requestAnimationFrame(()=>I.current?.focus())},[]);const R=w.useCallback(async(e,t,o,n)=>{if(e||t){y(!0),B(null);try{const a=await m({q:e||void 0,format:t||void 0,limit:50,offset:o});x(n?e=>[...e,...a.results]:a.results),S(50===a.results.length),V(o)}catch(a){B(a instanceof Error?a.message:"Search failed")}finally{y(!1)}}else n||x([])},[]);w.useEffect(()=>(q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{R(a,h,0,!1),O(0)},300),()=>{q.current&&clearTimeout(q.current)}),[a,h,R]);const G=w.useCallback(()=>{R(a,h,E+50,!0)},[a,h,E,R]);w.useEffect(()=>{if(_<0||!z.current)return;const e=z.current.querySelectorAll("[data-result-item]");e[_]?.scrollIntoView({block:"nearest"})},[_]);const H=w.useCallback(async(t,n)=>{M(e=>new Set(e).add(t.full_path)),B(null);try{const[a,r]=await Promise.all([u(t.full_path),p(t.full_path)]);if(r){const{UADEEngine:e}=await c(async()=>{const{UADEEngine:e}=await import("./index-zx6LJBPK.js").then(e=>e.e3);return{UADEEngine:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.getInstance().addCompanionFile(r.filename,r.buffer)}const s=new File([a],t.filename,{type:"application/octet-stream"}),i=await C(s),l=Y(i),d=`modland:${t.full_path}`;Q(d,i);const m=o();e.getState().setDeckState(n,{fileName:d,trackName:i.name||t.filename,detectedBPM:l.bpm,effectiveBPM:l.bpm,analysisState:"rendering",isPlaying:!1});const h=await ke().loadOrEnqueue(a,t.filename,n,"high");await m.loadAudioToDeck(n,h.wavData,d,i.name||t.filename,h.analysis?.bpm||l.bpm,i),e.getState().setDeckViewMode("visualizer")}catch(a){B(a instanceof Error?a.message:"Failed to load")}finally{M(e=>{const o=new Set(e);return o.delete(t.full_path),o})}},[]),W=w.useCallback(async e=>{const t=s.getState().activePlaylistId;if(t){M(t=>new Set(t).add(e.full_path)),B(null);try{const[o,n]=await Promise.all([u(e.full_path),p(e.full_path)]);if(n){const{UADEEngine:e}=await c(async()=>{const{UADEEngine:e}=await import("./index-zx6LJBPK.js").then(e=>e.e3);return{UADEEngine:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.getInstance().addCompanionFile(n.filename,n.buffer)}const a=new File([o],e.filename,{type:"application/octet-stream"}),r=await C(a),i=Y(r),l=ee(r),d=`modland:${e.full_path}`;Q(d,r),s.getState().addTrack(t,{fileName:d,trackName:r.name||e.filename,format:e.extension.toUpperCase(),bpm:i.bpm,duration:l,addedAt:Date.now()})}catch(o){B(o instanceof Error?o.message:"Failed to add to playlist")}finally{M(t=>{const o=new Set(t);return o.delete(e.full_path),o})}}},[]),K=w.useCallback(t=>{if("ArrowDown"===t.key)t.preventDefault(),O(e=>Math.min(e+1,f.length-1));else if("ArrowUp"===t.key)t.preventDefault(),O(e=>Math.max(e-1,0));else if("Enter"===t.key&&_>=0&&_<f.length){t.preventDefault();const e=f[_];A.has(e.full_path)||H(e,t.shiftKey?"B":"A")}else if(("1"===t.key||"2"===t.key||"3"===t.key)&&_>=0&&_<f.length){if("INPUT"===t.target.tagName)return;t.preventDefault();const o=f[_];if(A.has(o.full_path))return;const n={1:"A",2:"B",3:"C"}[t.key];"C"!==n||$||e.getState().setThirdDeckActive(!0),H(o,n)}},[f,_,A,$,H]);return n.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-2 max-h-[400px]",onKeyDown:K,tabIndex:-1,children:[n.jsxDEV("div",{className:"flex-shrink-0 flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(U,{size:14,className:"text-green-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:279,columnNumber:11},void 0),n.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"Modland"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:280,columnNumber:11},void 0),N&&"ready"===N.status&&n.jsxDEV("span",{className:"text-[10px] font-mono text-text-muted",children:[N.totalFiles.toLocaleString()," files"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:284,columnNumber:13},void 0),N&&"indexing"===N.status&&n.jsxDEV("span",{className:"text-[10px] font-mono text-amber-400 flex items-center gap-1",children:[n.jsxDEV(J,{size:10,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:290,columnNumber:15},void 0)," Indexing..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:289,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:278,columnNumber:9},void 0),t&&n.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary p-1",children:n.jsxDEV(L,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:296,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:295,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:277,columnNumber:7},void 0),n.jsxDEV("div",{className:"flex-shrink-0 flex gap-2",children:[n.jsxDEV("div",{className:"flex-1 relative",children:[n.jsxDEV(X,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:304,columnNumber:11},void 0),n.jsxDEV("input",{ref:I,value:a,onChange:e=>r(e.target.value),placeholder:"Search modules...",className:"w-full pl-7 pr-2 py-1.5 text-xs font-mono bg-dark-bg border border-dark-borderLight\n                       rounded text-text-primary placeholder:text-text-muted/40\n                       focus:border-green-600 focus:outline-none transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:305,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:303,columnNumber:9},void 0),n.jsxDEV("select",{value:h,onChange:e=>b(e.target.value),className:"px-2 py-1.5 text-[10px] font-mono bg-dark-bg border border-dark-borderLight\n                     rounded text-text-secondary cursor-pointer hover:bg-dark-bgHover transition-colors",children:[n.jsxDEV("option",{value:"",children:"All formats"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:321,columnNumber:11},void 0),k.map(e=>n.jsxDEV("option",{value:e.format,children:[e.format," (",e.count.toLocaleString(),")"]},e.format,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:323,columnNumber:13},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:315,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:302,columnNumber:7},void 0),j&&n.jsxDEV("div",{className:"flex items-center gap-1.5 text-red-400 text-[10px] font-mono px-2 py-1 bg-red-900/20 rounded border border-red-900/30",children:[n.jsxDEV(F,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:333,columnNumber:11},void 0),j]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:332,columnNumber:9},void 0),n.jsxDEV("div",{ref:z,className:"flex-1 overflow-y-auto min-h-0",children:[0!==f.length||v?n.jsxDEV("div",{className:"flex flex-col gap-0.5",children:[f.map((t,o)=>{return n.jsxDEV("div",{"data-result-item":!0,onClick:()=>O(o),className:"flex items-center gap-2 px-2 py-1.5 rounded border transition-colors group cursor-pointer "+(o===_?"bg-green-900/20 border-green-700/50":"bg-dark-bg border-dark-borderLight hover:border-dark-border"),children:[n.jsxDEV("div",{className:"flex-1 min-w-0",children:[n.jsxDEV("div",{className:"text-text-primary text-xs font-mono truncate",children:t.filename},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:362,columnNumber:19},void 0),n.jsxDEV("div",{className:"flex gap-3 text-[10px] text-text-muted font-mono",children:[n.jsxDEV("span",{children:t.format},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:366,columnNumber:21},void 0),n.jsxDEV("span",{className:"text-text-muted/60",children:t.author},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:367,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:365,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:361,columnNumber:17},void 0),(a=t.full_path,A.has(a)?n.jsxDEV(J,{size:12,className:"animate-spin text-green-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:373,columnNumber:19},void 0):n.jsxDEV(n.Fragment,{children:[n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),W(t)},className:"p-1 text-text-muted hover:text-amber-400 transition-colors\n                                 opacity-0 group-hover:opacity-100",title:"Add to active playlist",children:n.jsxDEV(T,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:382,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:376,columnNumber:21},void 0),n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),H(t,"A")},className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                 bg-blue-900/30 text-blue-400 border border-blue-800/50\n                                 hover:bg-blue-800/40 hover:text-blue-300 transition-colors\n                                 opacity-0 group-hover:opacity-100",children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:384,columnNumber:21},void 0),n.jsxDEV("button",{onClick:e=>{e.stopPropagation(),H(t,"B")},className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                 bg-red-900/30 text-red-400 border border-red-800/50\n                                 hover:bg-red-800/40 hover:text-red-300 transition-colors\n                                 opacity-0 group-hover:opacity-100",children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:393,columnNumber:21},void 0),n.jsxDEV("button",{onClick:o=>{o.stopPropagation(),$||e.getState().setThirdDeckActive(!0),H(t,"C")},className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                 bg-emerald-900/30 text-emerald-400 border border-emerald-800/50\n                                 hover:bg-emerald-800/40 hover:text-emerald-300 transition-colors\n                                 opacity-0 group-hover:opacity-100 "+($?"":"opacity-0 group-hover:opacity-50"),children:"3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:402,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:375,columnNumber:19},void 0))]},t.full_path,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:350,columnNumber:15},void 0);var a}),P&&n.jsxDEV("button",{onClick:G,disabled:v,className:"mt-1 py-1.5 text-[10px] font-mono text-text-secondary bg-dark-bgTertiary\n                           border border-dark-borderLight rounded hover:bg-dark-bgHover\n                           hover:text-text-primary transition-colors disabled:opacity-50",children:v?n.jsxDEV("span",{className:"flex items-center justify-center gap-1",children:[n.jsxDEV(J,{size:10,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:431,columnNumber:21},void 0)," Loading..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:430,columnNumber:19},void 0):"Load more"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:422,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:348,columnNumber:11},void 0):n.jsxDEV("div",{className:"flex flex-col items-center justify-center py-8 text-text-muted",children:[n.jsxDEV(U,{size:24,className:"mb-2 opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:342,columnNumber:13},void 0),n.jsxDEV("p",{className:"text-xs font-mono",children:a||h?"No results found":"Search the modland archive"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:343,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:341,columnNumber:11},void 0),v&&0===f.length&&n.jsxDEV("div",{className:"flex items-center justify-center py-8",children:n.jsxDEV(J,{size:16,className:"animate-spin text-green-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:444,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:443,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:339,columnNumber:7},void 0),f.length>0&&n.jsxDEV("div",{className:"text-[9px] font-mono text-text-muted/50 flex gap-3 px-1",children:[n.jsxDEV("span",{children:"↑↓ navigate"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:452,columnNumber:11},void 0),n.jsxDEV("span",{children:"⏎ deck 1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:453,columnNumber:11},void 0),n.jsxDEV("span",{children:"⇧⏎ deck 2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:454,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:451,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJModlandBrowser.tsx",lineNumber:271,columnNumber:5},void 0)};function it(e,t=0){const o=new DataView(e),n=[];let a=t;for(;a+8<=e.byteLength;){const t=new Uint8Array(e,a,4),r=String.fromCharCode(t[0],t[1],t[2],t[3]),s=o.getUint32(a+4,!1);if(a+8+s>e.byteLength)break;const c=new Uint8Array(e,a+8,s);n.push({tag:r,data:c,offset:a}),a+=8+s}return n}function lt(e){return it(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function dt(e){const t=[];for(let o=0;o+1<e.length;o+=2){const n=e[o]<<8|e[o+1];if(0===n)break;t.push(String.fromCharCode(n))}return t.join("")}function mt(e){const t=it(e),o=[];for(const n of t){if("otrk"!==n.tag)continue;const e=ut(lt(n.data));e.filePath&&o.push(e)}return o}function ut(e){const t={filePath:"",title:"",artist:"",album:"",genre:"",bpm:0,duration:0,bitrate:0,sampleRate:0,key:"",fileType:"",fileSize:0,dateAdded:""};for(const o of e){const e=dt(o.data);switch(o.tag){case"pfil":case"ptrk":t.filePath||(t.filePath=e);break;case"tsng":t.title=e;break;case"tart":t.artist=e;break;case"talb":t.album=e;break;case"tgen":t.genre=e;break;case"tbpm":t.bpm=parseFloat(e)||0;break;case"tlen":t.duration=pt(e);break;case"tbit":t.bitrate=parseInt(e,10)||0;break;case"tsmp":t.sampleRate=parseInt(e,10)||0;break;case"tkey":t.key=e;break;case"ttyp":t.fileType=e;break;case"tsiz":t.fileSize=parseInt(e,10)||0;break;case"tadd":t.dateAdded=e}}if(!t.title&&t.filePath){const e=t.filePath.replace(/\\/g,"/").split("/"),o=e[e.length-1]||"";t.title=o.replace(/\.[^.]+$/,"")}return t}function pt(e){if(e.includes(":")){const t=e.split(":");return 60*(parseInt(t[0],10)||0)+(parseInt(t[1],10)||0)}return parseInt(e,10)||0}function ht(e,t){const o=it(e),n=[];for(const r of o){if("otrk"!==r.tag)continue;const e=lt(r.data);for(const t of e)if("ptrk"===t.tag){const e=dt(t.data);e&&n.push(e)}}return{name:(a=t,a.replace(/\.crate$/,"").replace(/%%/g," / ")),fileName:t,tracks:n};var a}var bt={};function ft(){try{if("undefined"!=typeof process&&bt)return bt.USER||bt.USERNAME||""}catch{}return""}async function xt(e){if(!h())return!1;try{return(await window.electron.fs.readdir(e)).some(e=>"database V2"===e.name&&!e.isDirectory)}catch{return!1}}async function kt(e){const t=window.electron?.fs;if(!t)throw new Error("Electron filesystem not available");const o=e+(e.endsWith("/")?"":"/")+"database V2";let n=[];try{n=mt(await t.readFile(o))}catch(s){}const a=[],r=e+(e.endsWith("/")?"":"/")+"Subcrates";try{const e=await t.readdir(r,[".crate"]);for(const o of e)if(!o.isDirectory&&o.name.endsWith(".crate"))try{const e=ht(await t.readFile(o.path),o.name);a.push(e)}catch(s){}}catch{}return{tracks:n,crates:a,libraryPath:e}}async function Dt(){if(h()){const e=window.electron.fs,t=await e.showOpenDialog({properties:["openDirectory"]});if(!t||0===t.length)return null;const o=t[0];if(!(await xt(o)))throw new Error(`"${o}" does not appear to be a Serato library (no "database V2" file found)`);return kt(o)}if("showDirectoryPicker"in window)try{const e=await window.showDirectoryPicker({mode:"read"});if(!(await async function(e){try{return await e.getFileHandle("database V2"),!0}catch{return!1}}(e)))throw new Error("Selected folder does not appear to be a Serato library");return async function(e){let t=[];try{const o=await e.getFileHandle("database V2"),n=await o.getFile();t=mt(await n.arrayBuffer())}catch(n){}const o=[];try{const t=await e.getDirectoryHandle("Subcrates");for await(const[e,a]of t)if("file"===a.kind&&e.endsWith(".crate"))try{const t=a,n=await t.getFile(),r=ht(await n.arrayBuffer(),e);o.push(r)}catch(n){}}catch{}return{tracks:t,crates:o,libraryPath:e.name}}(e)}catch(e){if("AbortError"===e.name)return null;throw e}throw new Error("No file system access available. Use Chrome/Edge for browser mode, or the desktop app.")}async function Nt(){if(!h())return null;const e=function(){if(!b())return null;const e=window.electron?.platform;return"darwin"===e?"/Users/"+ft()+"/Music/_Serato_":"win32"===e?"C:\\Users\\"+ft()+"\\Music\\_Serato_":"/home/"+ft()+"/Music/_Serato_"}();return e&&await xt(e)?kt(e):null}const gt="devilbox-serato-library-path";function vt(e){if(!e||e<=0)return"--:--";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}const yt=({onClose:t,onLoadTrackToDevice:o})=>{const[a,r]=w.useState(null),[s,c]=w.useState(!1),[i,l]=w.useState(null),[d,m]=w.useState(null),[u,p]=w.useState(""),[h,b]=w.useState("title"),[f,x]=w.useState("asc"),k=w.useRef(null);w.useEffect(()=>{let e=!1;return(async()=>{c(!0);try{const t=await Nt();!e&&t&&(r(t),localStorage.setItem(gt,t.libraryPath))}catch{}finally{e||c(!1)}})(),()=>{e=!0}},[]);const D=w.useCallback(async()=>{c(!0),l(null);try{const e=await Dt();e&&(r(e),localStorage.setItem(gt,e.libraryPath))}catch(e){l(e instanceof Error?e.message:"Failed to open Serato library")}finally{c(!1)}},[]),N=w.useMemo(()=>{if(!a)return[];let e;if(d){const t=a.crates.find(e=>e.name===d);if(!t)return[];const o=new Set(t.tracks.map(e=>e.toLowerCase()));e=a.tracks.filter(e=>o.has(e.filePath.toLowerCase())||o.has(e.filePath.replace(/\\/g,"/").split("/").pop()?.toLowerCase()||""))}else e=a.tracks;if(u){const t=u.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t)||e.artist.toLowerCase().includes(t)||e.album.toLowerCase().includes(t)||e.genre.toLowerCase().includes(t)||e.key.toLowerCase().includes(t))}const t="asc"===f?1:-1;return e.sort((e,o)=>{switch(h){case"bpm":return(e.bpm-o.bpm)*t;case"duration":return(e.duration-o.duration)*t;case"artist":return e.artist.localeCompare(o.artist)*t;case"key":return e.key.localeCompare(o.key)*t;case"genre":return e.genre.localeCompare(o.genre)*t;default:return e.title.localeCompare(o.title)*t}}),e},[a,d,u,h,f]),g=w.useCallback(e=>{h===e?x(e=>"asc"===e?"desc":"asc"):(b(e),x("asc"))},[h]);return a||s?s?n.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-2 max-h-[400px]",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(q,{size:14,className:"text-purple-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:214,columnNumber:13},void 0),n.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"Serato"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:215,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:213,columnNumber:11},void 0),t&&n.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary p-1",children:n.jsxDEV(L,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:218,columnNumber:95},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:218,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:212,columnNumber:9},void 0),n.jsxDEV("div",{className:"flex items-center justify-center py-8",children:[n.jsxDEV(J,{size:16,className:"animate-spin text-purple-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:222,columnNumber:11},void 0),n.jsxDEV("span",{className:"ml-2 text-xs font-mono text-text-muted",children:"Reading Serato library..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:223,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:221,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:211,columnNumber:7},void 0):n.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-2 max-h-[400px]",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(q,{size:14,className:"text-purple-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:235,columnNumber:11},void 0),n.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"Serato"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:236,columnNumber:11},void 0),n.jsxDEV("span",{className:"text-[10px] font-mono text-text-muted",children:[a.tracks.length.toLocaleString()," tracks",a.crates.length>0&&` / ${a.crates.length} crates`]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:239,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:234,columnNumber:9},void 0),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV("button",{onClick:D,className:"text-text-muted hover:text-purple-400 p-1 transition-colors",title:"Change Serato library",children:n.jsxDEV(I,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:250,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:245,columnNumber:11},void 0),t&&n.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary p-1",children:n.jsxDEV(L,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:254,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:253,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:244,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:233,columnNumber:7},void 0),i&&n.jsxDEV("div",{className:"flex items-center gap-1.5 text-red-400 text-[10px] font-mono px-2 py-1 bg-red-900/20 rounded border border-red-900/30",children:[n.jsxDEV(F,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:263,columnNumber:11},void 0),i]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:262,columnNumber:9},void 0),n.jsxDEV("div",{className:"flex gap-2",children:[n.jsxDEV("div",{className:"flex-1 relative",children:[n.jsxDEV(X,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:271,columnNumber:11},void 0),n.jsxDEV("input",{ref:k,value:u,onChange:e=>p(e.target.value),placeholder:"Search tracks...",className:"w-full pl-7 pr-2 py-1.5 text-xs font-mono bg-dark-bg border border-dark-borderLight\n                       rounded text-text-primary placeholder:text-text-muted/40\n                       focus:border-purple-600 focus:outline-none transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:272,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:270,columnNumber:9},void 0),n.jsxDEV("select",{value:d||"",onChange:e=>m(e.target.value||null),className:"px-2 py-1.5 text-[10px] font-mono bg-dark-bg border border-dark-borderLight\n                     rounded text-text-secondary cursor-pointer hover:bg-dark-bgHover transition-colors\n                     max-w-[160px]",children:[n.jsxDEV("option",{value:"",children:"All Tracks"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:290,columnNumber:11},void 0),a.crates.map(e=>n.jsxDEV("option",{value:e.name,children:[e.name," (",e.tracks.length,")"]},e.fileName,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:292,columnNumber:13},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:283,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:269,columnNumber:7},void 0),n.jsxDEV("div",{className:"flex items-center gap-2 px-2 py-1 text-[10px] font-mono text-text-muted border-b border-dark-borderLight",children:[[["title","Title","flex-1 min-w-0"],["artist","Artist","w-[120px]"],["bpm","BPM","w-[50px] text-right"],["key","Key","w-[40px]"],["duration","Len","w-[40px] text-right"]].map(([e,t,o])=>n.jsxDEV("button",{onClick:()=>g(e),className:`${o} hover:text-text-primary transition-colors text-left truncate ${h===e?"text-purple-400":""}`,children:[t,h===e&&n.jsxDEV("span",{className:"ml-0.5",children:"asc"===f?"▲":"▼"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:317,columnNumber:15},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:308,columnNumber:11},void 0)),n.jsxDEV("div",{className:"w-[60px]"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:321,columnNumber:9},void 0)," "]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:300,columnNumber:7},void 0),n.jsxDEV("div",{className:"flex-1 overflow-y-auto min-h-0",children:0===N.length?n.jsxDEV("div",{className:"flex flex-col items-center justify-center py-8 text-text-muted",children:[n.jsxDEV(_,{size:24,className:"mb-2 opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:328,columnNumber:13},void 0),n.jsxDEV("p",{className:"text-xs font-mono",children:u?"No matching tracks":"No tracks in this view"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:329,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:327,columnNumber:11},void 0):n.jsxDEV("div",{className:"flex flex-col gap-0.5",children:N.map((t,a)=>{return n.jsxDEV("div",{className:"flex items-center gap-2 px-2 py-1.5 bg-dark-bg rounded border border-dark-borderLight\n                           hover:border-dark-border transition-colors group",children:[n.jsxDEV("div",{className:"flex-1 min-w-0 text-text-primary text-xs font-mono truncate",children:t.title||t.filePath.split(/[/\\]/).pop()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:341,columnNumber:17},void 0),n.jsxDEV("div",{className:"w-[120px] text-text-muted text-[10px] font-mono truncate",children:t.artist},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:344,columnNumber:17},void 0),n.jsxDEV("div",{className:"w-[50px] text-right text-[10px] font-mono text-text-muted",children:(r=t.bpm,!r||r<=0?"--":r.toFixed(1))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:347,columnNumber:17},void 0),n.jsxDEV("div",{className:"w-[40px] text-[10px] font-mono text-text-muted",children:t.key||"--"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:350,columnNumber:17},void 0),n.jsxDEV("div",{className:"w-[40px] text-right text-[10px] font-mono text-text-muted",children:vt(t.duration)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:353,columnNumber:17},void 0),o?n.jsxDEV(n.Fragment,{children:[n.jsxDEV("button",{onClick:()=>o(t,"A"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                 bg-blue-900/30 text-blue-400 border border-blue-800/50\n                                 hover:bg-blue-800/40 hover:text-blue-300 transition-colors\n                                 opacity-0 group-hover:opacity-100",children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:360,columnNumber:21},void 0),n.jsxDEV("button",{onClick:()=>o(t,"B"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                 bg-red-900/30 text-red-400 border border-red-800/50\n                                 hover:bg-red-800/40 hover:text-red-300 transition-colors\n                                 opacity-0 group-hover:opacity-100",children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:369,columnNumber:21},void 0),e.getState().thirdDeckActive&&n.jsxDEV("button",{onClick:()=>o(t,"C"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                                   bg-emerald-900/30 text-emerald-400 border border-emerald-800/50\n                                   hover:bg-emerald-800/40 hover:text-emerald-300 transition-colors\n                                   opacity-0 group-hover:opacity-100",children:"3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:379,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:359,columnNumber:19},void 0):n.jsxDEV("div",{className:"w-[60px] flex justify-end gap-1",children:n.jsxDEV("span",{className:"text-[9px] font-mono text-text-muted/40 truncate",children:t.fileType||"--"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:392,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:391,columnNumber:19},void 0)]},`${t.filePath}-${a}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:336,columnNumber:15},void 0);var r})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:334,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:325,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:231,columnNumber:5},void 0):n.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-3 max-h-[400px]",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV(q,{size:14,className:"text-purple-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:170,columnNumber:13},void 0),n.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"Serato"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:171,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:169,columnNumber:11},void 0),t&&n.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary p-1",children:n.jsxDEV(L,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:177,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:176,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:168,columnNumber:9},void 0),i&&n.jsxDEV("div",{className:"flex items-center gap-1.5 text-red-400 text-[10px] font-mono px-2 py-1 bg-red-900/20 rounded border border-red-900/30",children:[n.jsxDEV(F,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:184,columnNumber:13},void 0),i]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:183,columnNumber:11},void 0),n.jsxDEV("div",{className:"flex flex-col items-center justify-center py-6 text-text-muted",children:[n.jsxDEV(q,{size:28,className:"mb-3 opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:190,columnNumber:11},void 0),n.jsxDEV("p",{className:"text-xs font-mono mb-3",children:"Connect your Serato library"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:191,columnNumber:11},void 0),n.jsxDEV("button",{onClick:D,className:"flex items-center gap-1.5 px-4 py-2 bg-purple-900/30 border border-purple-700/50\n                       rounded text-purple-300 text-xs font-mono hover:bg-purple-800/40 transition-colors",children:[n.jsxDEV(I,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:197,columnNumber:13},void 0),"Browse for _Serato_ folder"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:192,columnNumber:11},void 0),n.jsxDEV("p",{className:"text-[10px] text-text-muted/60 mt-2 font-mono",children:"Usually at ~/Music/_Serato_"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:200,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:189,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSeratoBrowser.tsx",lineNumber:167,columnNumber:7},void 0)},jt="master-fx-user-presets",Bt=["DJ","Genre","Loud","Warm","Clean","Wide","Vinyl"].map(e=>({category:e,presets:N.filter(t=>t.category===e)})).filter(e=>e.presets.length>0),wt=()=>{const[e,t]=w.useState(!1),[o,a]=w.useState(null),r=w.useRef(null),s=f(e=>e.setMasterEffects),c=x(e=>e.user),i=w.useCallback(()=>{try{const e=localStorage.getItem(jt);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>null!==e&&"object"==typeof e&&"string"==typeof e.name&&Array.isArray(e.effects)):[]}catch{return[]}},[]),[l,d]=w.useState(i);w.useEffect(()=>{e&&d(i())},[e,i]);const m=w.useCallback(e=>{k(D.MASTER_FX_PRESETS,e).catch(()=>{})},[]),u=w.useCallback(e=>{const o=e.effects.map((e,t)=>({...e,id:`master-fx-${Date.now()}-${t}`}));s(o),a(e.name),t(!1)},[s]),p=w.useCallback(e=>{const o=e.effects.map((e,t)=>({...e,id:`master-fx-${Date.now()}-${t}`}));s(o),a(e.name),t(!1)},[s]),h=w.useCallback(async(e,t)=>{t.stopPropagation();const n=i().filter(t=>t.name!==e);localStorage.setItem(jt,JSON.stringify(n)),d(n),o===e&&a(null),await m(n)},[i,o,m]),b=w.useCallback(()=>{s([]),a(null),t(!1)},[s]);return w.useEffect(()=>{if(!e)return;const o=e=>{r.current&&!r.current.contains(e.target)&&t(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[e]),n.jsxDEV("div",{ref:r,className:"relative",children:[n.jsxDEV("button",{onClick:()=>t(!e),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n          "+(o?"border-green-600/60 bg-green-950/30 text-green-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:[n.jsxDEV("span",{className:"truncate max-w-[120px]",children:o||"FX Presets"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:154,columnNumber:9},void 0),n.jsxDEV(z,{size:12,className:"shrink-0 transition-transform "+(e?"rotate-180":"")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:157,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:146,columnNumber:7},void 0),e&&n.jsxDEV("div",{className:"absolute right-0 top-full mt-1 z-50 w-64 max-h-[70vh] overflow-y-auto rounded-lg border border-dark-border bg-dark-bgSecondary shadow-xl",children:[n.jsxDEV("button",{onClick:b,className:"w-full px-3 py-2 text-left text-xs font-mono text-text-muted hover:bg-dark-bgHover hover:text-text-primary border-b border-dark-border transition-colors",children:"Clear All FX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:164,columnNumber:11},void 0),l.length>0&&n.jsxDEV("div",{className:"border-b border-dark-border",children:[n.jsxDEV("div",{className:"flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest text-amber-400/70",children:[n.jsxDEV($,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:175,columnNumber:17},void 0),"My Presets",c&&n.jsxDEV(R,{size:9,className:"ml-auto text-green-500/50","aria-label":"Synced to account"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:177,columnNumber:26},void 0),!c&&n.jsxDEV(G,{size:9,className:"ml-auto text-text-muted/30","aria-label":"Local only — log in to sync"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:178,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:174,columnNumber:15},void 0),l.map(e=>n.jsxDEV("button",{onClick:()=>p(e),className:"group flex items-center w-full px-3 py-1.5 text-left text-xs font-mono transition-colors\n                    "+(o===e.name?"bg-amber-950/30 text-amber-300":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:[n.jsxDEV("span",{className:"truncate flex-1",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:190,columnNumber:19},void 0),n.jsxDEV("span",{className:"text-[9px] text-text-muted/50 mr-2",children:[e.effects.length," fx"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:191,columnNumber:19},void 0),n.jsxDEV(M,{size:11,className:"shrink-0 opacity-0 group-hover:opacity-60 hover:!opacity-100 text-red-400 transition-opacity",onClick:t=>h(e.name,t)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:194,columnNumber:19},void 0)]},e.name,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:181,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:173,columnNumber:13},void 0),Bt.map(({category:e,presets:t})=>n.jsxDEV("div",{className:"border-b border-dark-border last:border-0",children:[n.jsxDEV("div",{className:"px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest text-text-muted/60",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:207,columnNumber:15},void 0),t.map(e=>n.jsxDEV("button",{onClick:()=>u(e),className:"w-full px-3 py-1.5 text-left text-xs font-mono transition-colors\n                    "+(o===e.name?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),title:e.description,children:e.name},e.name,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:211,columnNumber:17},void 0))]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:206,columnNumber:13},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:162,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFxQuickPresets.tsx",lineNumber:144,columnNumber:5},void 0)},Et=[...[{id:"pioneer-ddj-sb3",name:"DDJ-SB3",manufacturer:"Pioneer DJ",description:"2-channel Serato DJ controller",ccMappings:[{channel:0,cc:63,param:"dj.crossfader"},{channel:0,cc:19,param:"dj.deckA.volume"},{channel:1,cc:19,param:"dj.deckB.volume"},{channel:0,cc:4,param:"dj.deckA.volume"},{channel:1,cc:4,param:"dj.deckB.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:0,cc:23,param:"dj.deckA.filter"},{channel:1,cc:23,param:"dj.deckB.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0}],noteMappings:[{channel:0,note:11,action:"play_a"},{channel:1,note:11,action:"play_b"},{channel:0,note:12,action:"cue_a"},{channel:1,note:12,action:"cue_b"},{channel:0,note:88,action:"sync_a"},{channel:1,note:88,action:"sync_b"},{channel:7,note:0,action:"hotcue1_a"},{channel:7,note:1,action:"hotcue2_a"},{channel:7,note:2,action:"hotcue3_a"},{channel:7,note:3,action:"hotcue4_a"},{channel:7,note:4,action:"hotcue1_b"},{channel:7,note:5,action:"hotcue2_b"},{channel:7,note:6,action:"hotcue3_b"},{channel:7,note:7,action:"hotcue4_b"}],jogMapping:{deckA:{channel:0,cc:33,touchNote:54},deckB:{channel:1,cc:33,touchNote:54}}},{id:"pioneer-ddj-flx4",name:"DDJ-FLX4",manufacturer:"Pioneer DJ",description:"2-channel DJ controller (Serato/rekordbox)",ccMappings:[{channel:0,cc:31,param:"dj.crossfader"},{channel:0,cc:19,param:"dj.deckA.volume"},{channel:1,cc:19,param:"dj.deckB.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:0,cc:23,param:"dj.deckA.filter"},{channel:1,cc:23,param:"dj.deckB.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0}],noteMappings:[{channel:0,note:11,action:"play_a"},{channel:1,note:11,action:"play_b"},{channel:0,note:12,action:"cue_a"},{channel:1,note:12,action:"cue_b"},{channel:0,note:88,action:"sync_a"},{channel:1,note:88,action:"sync_b"},{channel:7,note:0,action:"hotcue1_a"},{channel:7,note:1,action:"hotcue2_a"},{channel:7,note:2,action:"hotcue3_a"},{channel:7,note:3,action:"hotcue4_a"},{channel:7,note:4,action:"hotcue1_b"},{channel:7,note:5,action:"hotcue2_b"},{channel:7,note:6,action:"hotcue3_b"},{channel:7,note:7,action:"hotcue4_b"}],jogMapping:{deckA:{channel:0,cc:33,touchNote:54},deckB:{channel:1,cc:33,touchNote:54}}},{id:"pioneer-ddj-1000",name:"DDJ-1000",manufacturer:"Pioneer DJ",description:"4-channel professional DJ controller",ccMappings:[{channel:0,cc:63,param:"dj.crossfader"},{channel:0,cc:19,param:"dj.deckA.volume"},{channel:1,cc:19,param:"dj.deckB.volume"},{channel:0,cc:4,param:"dj.deckA.volume"},{channel:1,cc:4,param:"dj.deckB.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:0,cc:23,param:"dj.deckA.filter"},{channel:1,cc:23,param:"dj.deckB.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0},{channel:0,cc:25,param:"dj.masterVolume"}],noteMappings:[{channel:0,note:11,action:"play_a"},{channel:1,note:11,action:"play_b"},{channel:0,note:12,action:"cue_a"},{channel:1,note:12,action:"cue_b"},{channel:0,note:88,action:"sync_a"},{channel:1,note:88,action:"sync_b"},{channel:7,note:0,action:"hotcue1_a"},{channel:7,note:1,action:"hotcue2_a"},{channel:7,note:2,action:"hotcue3_a"},{channel:7,note:3,action:"hotcue4_a"},{channel:7,note:4,action:"hotcue5_a"},{channel:7,note:5,action:"hotcue6_a"},{channel:7,note:6,action:"hotcue7_a"},{channel:7,note:7,action:"hotcue8_a"},{channel:7,note:8,action:"hotcue1_b"},{channel:7,note:9,action:"hotcue2_b"},{channel:7,note:10,action:"hotcue3_b"},{channel:7,note:11,action:"hotcue4_b"},{channel:7,note:12,action:"hotcue5_b"},{channel:7,note:13,action:"hotcue6_b"},{channel:7,note:14,action:"hotcue7_b"},{channel:7,note:15,action:"hotcue8_b"}],jogMapping:{deckA:{channel:0,cc:33,touchNote:54},deckB:{channel:1,cc:33,touchNote:54}}},{id:"numark-mixtrack-pro-fx",name:"Mixtrack Pro FX",manufacturer:"Numark",description:"2-channel Serato DJ controller",ccMappings:[{channel:0,cc:26,param:"dj.crossfader"},{channel:0,cc:23,param:"dj.deckA.volume"},{channel:1,cc:23,param:"dj.deckB.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:0,cc:27,param:"dj.deckA.filter"},{channel:1,cc:27,param:"dj.deckB.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0}],noteMappings:[{channel:0,note:0,action:"play_a"},{channel:1,note:0,action:"play_b"},{channel:0,note:1,action:"cue_a"},{channel:1,note:1,action:"cue_b"},{channel:0,note:2,action:"sync_a"},{channel:1,note:2,action:"sync_b"},{channel:0,note:20,action:"hotcue1_a"},{channel:0,note:21,action:"hotcue2_a"},{channel:0,note:22,action:"hotcue3_a"},{channel:0,note:23,action:"hotcue4_a"},{channel:1,note:20,action:"hotcue1_b"},{channel:1,note:21,action:"hotcue2_b"},{channel:1,note:22,action:"hotcue3_b"},{channel:1,note:23,action:"hotcue4_b"}],jogMapping:{deckA:{channel:0,cc:22,touchNote:10},deckB:{channel:1,cc:22,touchNote:10}}},{id:"numark-dj2go2",name:"DJ2GO2 Touch",manufacturer:"Numark",description:"Portable 2-channel Serato DJ controller",ccMappings:[{channel:0,cc:8,param:"dj.crossfader"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0},{channel:0,cc:19,param:"dj.deckA.volume"},{channel:1,cc:19,param:"dj.deckB.volume"}],noteMappings:[{channel:0,note:7,action:"play_a"},{channel:1,note:11,action:"play_b"},{channel:0,note:6,action:"cue_a"},{channel:1,note:10,action:"cue_b"},{channel:0,note:5,action:"sync_a"},{channel:1,note:9,action:"sync_b"}],jogMapping:{deckA:{channel:0,cc:22,touchNote:16},deckB:{channel:1,cc:22,touchNote:16}}},{id:"roland-dj-202",name:"DJ-202",manufacturer:"Roland",description:"2-channel Serato DJ controller with TR drum machine",ccMappings:[{channel:0,cc:63,param:"dj.crossfader"},{channel:0,cc:19,param:"dj.deckA.volume"},{channel:1,cc:19,param:"dj.deckB.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:0,cc:23,param:"dj.deckA.filter"},{channel:1,cc:23,param:"dj.deckB.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0}],noteMappings:[{channel:0,note:11,action:"play_a"},{channel:1,note:11,action:"play_b"},{channel:0,note:12,action:"cue_a"},{channel:1,note:12,action:"cue_b"},{channel:0,note:88,action:"sync_a"},{channel:1,note:88,action:"sync_b"}],jogMapping:{deckA:{channel:0,cc:33,touchNote:54},deckB:{channel:1,cc:33,touchNote:54}}}],...[{id:"generic-8x8",name:"Generic 8-Knob + 8-Pad",manufacturer:"Generic",description:"Standard 8-knob (CC 70-77) + 8-pad (36-43) layout",ccMappings:[{channel:0,cc:70,param:"dj.deckA.eqHi"},{channel:0,cc:71,param:"dj.deckA.eqMid"},{channel:0,cc:72,param:"dj.deckA.eqLow"},{channel:0,cc:73,param:"dj.deckA.filter"},{channel:0,cc:74,param:"dj.deckB.eqHi"},{channel:0,cc:75,param:"dj.deckB.eqMid"},{channel:0,cc:76,param:"dj.deckB.eqLow"},{channel:0,cc:77,param:"dj.deckB.filter"},{channel:0,cc:0,param:"dj.deckA.volume"},{channel:0,cc:1,param:"dj.deckB.volume"},{channel:0,cc:2,param:"dj.crossfader"},{channel:0,cc:3,param:"dj.masterVolume"}],noteMappings:[{channel:9,note:36,action:"play_a"},{channel:9,note:37,action:"cue_a"},{channel:9,note:38,action:"sync_a"},{channel:9,note:39,action:"hotcue1_a"},{channel:9,note:40,action:"play_b"},{channel:9,note:41,action:"cue_b"},{channel:9,note:42,action:"sync_b"},{channel:9,note:43,action:"hotcue1_b"}],jogMapping:{deckA:{channel:0,cc:16,touchNote:60},deckB:{channel:1,cc:16,touchNote:61}}},{id:"generic-4x16",name:"Generic 4-Knob + 16-Pad",manufacturer:"Generic",description:"Pad-heavy layout: 4 knobs + 16 pads (36-51)",ccMappings:[{channel:0,cc:70,param:"dj.deckA.filter"},{channel:0,cc:71,param:"dj.deckB.filter"},{channel:0,cc:72,param:"dj.deckA.volume"},{channel:0,cc:73,param:"dj.deckB.volume"},{channel:0,cc:2,param:"dj.crossfader"}],noteMappings:[{channel:9,note:36,action:"hotcue1_a"},{channel:9,note:37,action:"hotcue2_a"},{channel:9,note:38,action:"hotcue3_a"},{channel:9,note:39,action:"hotcue4_a"},{channel:9,note:40,action:"play_a"},{channel:9,note:41,action:"cue_a"},{channel:9,note:42,action:"sync_a"},{channel:9,note:43,action:"loop_a"},{channel:9,note:44,action:"hotcue1_b"},{channel:9,note:45,action:"hotcue2_b"},{channel:9,note:46,action:"hotcue3_b"},{channel:9,note:47,action:"hotcue4_b"},{channel:9,note:48,action:"play_b"},{channel:9,note:49,action:"cue_b"},{channel:9,note:50,action:"sync_b"},{channel:9,note:51,action:"loop_b"}],jogMapping:{deckA:{channel:0,cc:16,touchNote:60},deckB:{channel:1,cc:16,touchNote:61}}},{id:"generic-mixer",name:"Generic 2-Channel Mixer",manufacturer:"Generic",description:"Simple mixer: faders, EQ, crossfader only",ccMappings:[{channel:0,cc:7,param:"dj.deckA.volume"},{channel:1,cc:7,param:"dj.deckB.volume"},{channel:0,cc:16,param:"dj.deckA.eqHi"},{channel:0,cc:17,param:"dj.deckA.eqMid"},{channel:0,cc:18,param:"dj.deckA.eqLow"},{channel:1,cc:16,param:"dj.deckB.eqHi"},{channel:1,cc:17,param:"dj.deckB.eqMid"},{channel:1,cc:18,param:"dj.deckB.eqLow"},{channel:0,cc:8,param:"dj.crossfader"},{channel:0,cc:10,param:"dj.masterVolume"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0}],noteMappings:[{channel:0,note:0,action:"play_a"},{channel:1,note:0,action:"play_b"},{channel:0,note:1,action:"cue_a"},{channel:1,note:1,action:"cue_b"},{channel:0,note:2,action:"sync_a"},{channel:1,note:2,action:"sync_b"}],jogMapping:{deckA:{channel:0,cc:22,touchNote:16},deckB:{channel:1,cc:22,touchNote:16}}},{id:"generic-4deck",name:"Generic 4-Deck Controller",manufacturer:"Generic",description:"Full 4-deck layout (A+B mapped, C+D reserved)",ccMappings:[{channel:0,cc:19,param:"dj.deckA.volume"},{channel:0,cc:7,param:"dj.deckA.eqHi"},{channel:0,cc:11,param:"dj.deckA.eqMid"},{channel:0,cc:15,param:"dj.deckA.eqLow"},{channel:0,cc:23,param:"dj.deckA.filter"},{channel:0,cc:9,param:"dj.deckA.pitch",invert:!0},{channel:0,cc:4,param:"dj.deckA.trimGain"},{channel:1,cc:19,param:"dj.deckB.volume"},{channel:1,cc:7,param:"dj.deckB.eqHi"},{channel:1,cc:11,param:"dj.deckB.eqMid"},{channel:1,cc:15,param:"dj.deckB.eqLow"},{channel:1,cc:23,param:"dj.deckB.filter"},{channel:1,cc:9,param:"dj.deckB.pitch",invert:!0},{channel:1,cc:4,param:"dj.deckB.trimGain"},{channel:0,cc:63,param:"dj.crossfader"},{channel:0,cc:25,param:"dj.masterVolume"}],noteMappings:[{channel:0,note:11,action:"play_a"},{channel:0,note:12,action:"cue_a"},{channel:0,note:88,action:"sync_a"},{channel:7,note:0,action:"hotcue1_a"},{channel:7,note:1,action:"hotcue2_a"},{channel:7,note:2,action:"hotcue3_a"},{channel:7,note:3,action:"hotcue4_a"},{channel:1,note:11,action:"play_b"},{channel:1,note:12,action:"cue_b"},{channel:1,note:88,action:"sync_b"},{channel:7,note:4,action:"hotcue1_b"},{channel:7,note:5,action:"hotcue2_b"},{channel:7,note:6,action:"hotcue3_b"},{channel:7,note:7,action:"hotcue4_b"}],jogMapping:{deckA:{channel:0,cc:33,touchNote:54},deckB:{channel:1,cc:33,touchNote:54}}},{id:"generic-twister",name:"Generic Rotation Controller",manufacturer:"Generic",description:"16-encoder layout (e.g., MIDI Fighter Twister)",ccMappings:[{channel:0,cc:0,param:"dj.deckA.volume"},{channel:0,cc:1,param:"dj.deckA.filter"},{channel:0,cc:2,param:"dj.deckA.eqHi"},{channel:0,cc:3,param:"dj.deckA.eqMid"},{channel:0,cc:4,param:"dj.deckA.eqLow"},{channel:0,cc:5,param:"dj.deckA.pitch"},{channel:0,cc:6,param:"dj.deckA.filterQ"},{channel:0,cc:7,param:"dj.deckA.trimGain"},{channel:0,cc:8,param:"dj.deckB.volume"},{channel:0,cc:9,param:"dj.deckB.filter"},{channel:0,cc:10,param:"dj.deckB.eqHi"},{channel:0,cc:11,param:"dj.deckB.eqMid"},{channel:0,cc:12,param:"dj.deckB.eqLow"},{channel:0,cc:13,param:"dj.deckB.pitch"},{channel:0,cc:14,param:"dj.deckB.filterQ"},{channel:0,cc:15,param:"dj.crossfader"}],noteMappings:[{channel:0,note:0,action:"play_a"},{channel:0,note:1,action:"cue_a"},{channel:0,note:2,action:"sync_a"},{channel:0,note:8,action:"play_b"},{channel:0,note:9,action:"cue_b"},{channel:0,note:10,action:"sync_b"}]}]];function Ct(e){return Et.find(t=>t.id===e)??null}class Vt{static instance=null;activePreset=null;handlerRegistered=!1;ccLookup=new Map;noteLookup=new Map;jogCCs=new Set;jogTouchNotes=new Map;activeLoopRolls=new Map;constructor(){}static getInstance(){return Vt.instance||(Vt.instance=new Vt),Vt.instance}setPreset(e){if(this.activePreset=e,this.ccLookup.clear(),this.noteLookup.clear(),this.jogCCs.clear(),this.jogTouchNotes.clear(),e){for(const t of e.ccMappings)this.ccLookup.set(`${t.channel}:${t.cc}`,t);for(const t of e.noteMappings)this.noteLookup.set(`${t.channel}:${t.note}`,t);if(e.jogMapping){const{deckA:t,deckB:o}=e.jogMapping;this.jogCCs.add(`${t.channel}:${t.cc}`),this.jogCCs.add(`${o.channel}:${o.cc}`),void 0!==t.touchNote&&this.jogTouchNotes.set(`${t.channel}:${t.touchNote}`,"A"),void 0!==o.touchNote&&this.jogTouchNotes.set(`${o.channel}:${o.touchNote}`,"B")}this.ensureHandlerRegistered()}}getPreset(){return this.activePreset}ensureHandlerRegistered(){if(this.handlerRegistered)return;this.handlerRegistered=!0;g().addMessageHandler(e=>{this.activePreset&&this.handleMessage(e)})}handleMessage(e){if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value)this.handleCC(e.channel,e.cc,e.value);else if("noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){const t=`${e.channel}:${e.note}`,o=this.jogTouchNotes.get(t);if(o)return void this.handleJogTouch(o,!0);e.velocity>0&&this.handleNote(e.channel,e.note)}else if("noteOff"===e.type&&void 0!==e.note){const t=`${e.channel}:${e.note}`,o=this.jogTouchNotes.get(t);o&&this.handleJogTouch(o,!1);const n=`${e.channel}:${e.note}`,a=this.activeLoopRolls.get(n);a&&this.releaseLoopRoll(n,a)}}handleCC(e,t,o){const n=`${e}:${t}`;if(this.jogCCs.has(n)&&this.activePreset?.jogMapping){const n=this.activePreset.jogMapping.deckA.channel===e&&this.activePreset.jogMapping.deckA.cc===t;return void this.handleJogSpin(n?"A":"B",o)}const a=this.ccLookup.get(n);if(!a)return;let r=o/127;a.invert&&(r=1-r),v(a.param,r),this.syncParamToStore(a.param,r)}handleNote(e,t){const o=`${e}:${t}`,n=this.noteLookup.get(o);n&&(n.action.startsWith("loop_roll_")?this.executeDJAction(n.action,o):this.executeDJAction(n.action))}executeDJAction(t,n){if(t.startsWith("tracker_"))this.executeTrackerScratchAction(t);else if(y())try{const a=o(),r=e.getState();switch(t){case"play_a":a.deckA.isPlaying()?(a.deckA.pause(),r.setDeckPlaying("A",!1)):(a.deckA.play(),r.setDeckPlaying("A",!0));break;case"play_b":a.deckB.isPlaying()?(a.deckB.pause(),r.setDeckPlaying("B",!1)):(a.deckB.play(),r.setDeckPlaying("B",!0));break;case"cue_a":{const e=r.decks.A.cuePoint;a.deckA.cue(e);break}case"cue_b":{const e=r.decks.B.cuePoint;a.deckB.cue(e);break}case"sync_a":try{const e=Ne.syncBPM(a.deckB,a.deckA);r.setDeckPitch("A",e)}catch{}break;case"sync_b":try{const e=Ne.syncBPM(a.deckA,a.deckB);r.setDeckPitch("B",e)}catch{}break;case"loop_a":r.toggleLoop("A");break;case"loop_b":r.toggleLoop("B");break;case"loop_roll_4_a":case"loop_roll_8_a":case"loop_roll_16_a":case"loop_roll_32_a":{const e=parseInt(t.match(/\d+/)?.[0]||"4");this.activateLoopRoll("A",e,n);break}case"loop_roll_4_b":case"loop_roll_8_b":case"loop_roll_16_b":case"loop_roll_32_b":{const e=parseInt(t.match(/\d+/)?.[0]||"4");this.activateLoopRoll("B",e,n);break}case"beatjump_back_a":this.beatJump("A",-4);break;case"beatjump_fwd_a":this.beatJump("A",4);break;case"beatjump_back_b":this.beatJump("B",-4);break;case"beatjump_fwd_b":this.beatJump("B",4);break;case"pfl_a":r.togglePFL("A");break;case"pfl_b":r.togglePFL("B");break;case"fx_echo_a":case"fx_reverb_a":case"fx_delay_a":case"fx_flanger_a":{const e=t.replace("fx_","").replace("_a","");this.triggerQuantizedFX("A",e);break}case"fx_echo_b":case"fx_reverb_b":case"fx_delay_b":case"fx_flanger_b":{const e=t.replace("fx_","").replace("_b","");this.triggerQuantizedFX("B",e);break}default:{const e=t.match(/^hotcue(\d)_([ab])$/);if(e){const t=parseInt(e[1])-1,o=e[2].toUpperCase(),n=r.decks[o].seratoCuePoints.find(e=>e.index===t);if(n){const e=a.getDeck(o);"audio"===e.playbackMode&&(e.audioPlayer.seek(n.position/1e3),r.setDeckState(o,{audioPosition:n.position/1e3,elapsedMs:n.position}))}}}}}catch{}}executeTrackerScratchAction(e){const t=j();switch(e){case"tracker_fader_cut":t.setFaderCut(!0),setTimeout(()=>t.setFaderCut(!1),50);break;case"tracker_fader_cut_on":t.setFaderCut(!0);break;case"tracker_fader_cut_off":t.setFaderCut(!1);break;case"tracker_scratch_trans":t.toggleFaderPattern("Transformer");break;case"tracker_scratch_crab":t.toggleFaderPattern("Crab");break;case"tracker_scratch_flare":t.toggleFaderPattern("Flare");break;case"tracker_scratch_chirp":t.toggleFaderPattern("Chirp");break;case"tracker_scratch_stab":t.toggleFaderPattern("Stab");break;case"tracker_scratch_8crab":t.toggleFaderPattern("8-Finger Crab");break;case"tracker_scratch_twdl":t.toggleFaderPattern("Twiddle");break;case"tracker_scratch_stop":t.stopFaderPattern()}}handleJogTouch(t,n){if(y())try{const a=o().getDeck(t);n?(a.startScratch(),e.getState().setDeckScratchActive(t,!0)):(a.stopScratch(),e.getState().setDeckScratchActive(t,!1))}catch{}else j().onMidiJogTouch(n)}handleJogSpin(t,n){let a;if(a=n<=63?n/63:-(128-n)/63,a*=2*(e.getState().jogWheelSensitivity||1),y())try{o().getDeck(t).setScratchVelocity(a)}catch{}else{const e=j(),t=e.turntable.touching;e.onMidiJogSpin(n,t)}}syncParamToStore(t,o){const n=e.getState();switch(t){case"dj.crossfader":n.setCrossfader(o);break;case"dj.deckA.volume":n.setDeckVolume("A",1.5*o);break;case"dj.deckB.volume":n.setDeckVolume("B",1.5*o);break;case"dj.masterVolume":n.setMasterVolume(1.5*o);break;case"dj.deckA.pitch":n.setDeckPitch("A",12*o-6);break;case"dj.deckB.pitch":n.setDeckPitch("B",12*o-6);break;case"dj.deckA.eqHi":n.setDeckEQ("A","high",30*o-24);break;case"dj.deckA.eqMid":n.setDeckEQ("A","mid",30*o-24);break;case"dj.deckA.eqLow":n.setDeckEQ("A","low",30*o-24);break;case"dj.deckB.eqHi":n.setDeckEQ("B","high",30*o-24);break;case"dj.deckB.eqMid":n.setDeckEQ("B","mid",30*o-24);break;case"dj.deckB.eqLow":n.setDeckEQ("B","low",30*o-24);break;case"dj.deckA.filter":n.setDeckFilter("A",2*o-1);break;case"dj.deckB.filter":n.setDeckFilter("B",2*o-1)}}activateLoopRoll(t,o,n){const a=e.getState(),r=a.decks[t].loopActive,s=a.decks[t].lineLoopSize;if(a.setLineLoopSize(t,o),r||a.toggleLoop(t),n){const e=this.activeLoopRolls.get(n);e?.timeoutId&&clearTimeout(e.timeoutId);const o=setTimeout(()=>{const e=this.activeLoopRolls.get(n);e&&this.releaseLoopRoll(n,e)},50);this.activeLoopRolls.set(n,{deckId:t,prevLooping:r,prevSize:s,timeoutId:o})}else setTimeout(()=>{r||a.toggleLoop(t),a.setLineLoopSize(t,s)},50)}releaseLoopRoll(t,o){o.timeoutId&&clearTimeout(o.timeoutId);const n=e.getState();o.prevLooping||n.toggleLoop(o.deckId),n.setLineLoopSize(o.deckId,o.prevSize),this.activeLoopRolls.delete(t)}beatJump(t,n){try{const a=o().getDeck(t),r=e.getState(),s=r.decks[t],c=n/(s.effectiveBPM/60),i=s.audioPosition+c,l=Math.max(0,Math.min(i,s.durationMs/1e3));"audio"===a.playbackMode&&(a.audioPlayer.seek(l),r.setDeckState(t,{audioPosition:l,elapsedMs:1e3*l}))}catch{}}async triggerQuantizedFX(e,t){try{switch(t){case"echo":{const{echoOut:t}=await c(async()=>{const{echoOut:e}=await Promise.resolve().then(()=>Ge);return{echoOut:e}},void 0);t(e,4);break}case"reverb":{const{filterSweep:t}=await c(async()=>{const{filterSweep:e}=await Promise.resolve().then(()=>Ge);return{filterSweep:e}},void 0);t(e,.8,4);break}case"delay":{const{filterSweep:t}=await c(async()=>{const{filterSweep:e}=await Promise.resolve().then(()=>Ge);return{filterSweep:e}},void 0);t(e,-.6,2,()=>{t(e,0,2)});break}case"flanger":{const{filterSweep:t}=await c(async()=>{const{filterSweep:e}=await Promise.resolve().then(()=>Ge);return{filterSweep:e}},void 0);t(e,.5,1,()=>{t(e,-.5,1,()=>{t(e,0,1)})});break}}}catch(o){}}}function Pt(){return Vt.getInstance()}const St="devilbox-dj-controller-preset",Lt=()=>{const[e,t]=w.useState(()=>localStorage.getItem(St)||"");w.useEffect(()=>{if(e){const t=Ct(e);Pt().setPreset(t)}},[]);const o=w.useCallback(e=>{const o=e.target.value;if(t(o),o){const e=Ct(o);Pt().setPreset(e),localStorage.setItem(St,o)}else Pt().setPreset(null),localStorage.removeItem(St)},[]),a=new Map;for(const n of Et){const e=a.get(n.manufacturer)||[];e.push(n),a.set(n.manufacturer,e)}return n.jsxDEV("select",{value:e,onChange:o,className:"px-2 py-1 text-[10px] font-mono bg-dark-bgTertiary text-text-secondary border border-dark-border rounded hover:bg-dark-bgHover transition-colors cursor-pointer",title:"Select DJ controller for MIDI mapping",children:[n.jsxDEV("option",{value:"",children:"Controller: None"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJControllerSelector.tsx",lineNumber:57,columnNumber:7},void 0),Array.from(a.entries()).map(([e,t])=>n.jsxDEV("optgroup",{label:e,children:t.map(e=>n.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJControllerSelector.tsx",lineNumber:61,columnNumber:13},void 0))},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJControllerSelector.tsx",lineNumber:59,columnNumber:9},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJControllerSelector.tsx",lineNumber:51,columnNumber:5},void 0)},At=[1,2,4,8,16,32];function Mt(){const t=w.useCallback((t,n)=>{const a=n,r=o(),s=e.getState(),c=a.shiftKey,i=(e,t)=>{const o=`eq${t.charAt(0).toUpperCase()+t.slice(1)}Kill`,n=!s.decks[e][o];s.setDeckEQKill(e,t,n),"off"!==Me()?Oe(e,t,n):Ue(e,t,n)};let l=!0;if(a.ctrlKey||a.metaKey){switch(a.key.toLowerCase()){case"z":Ye("A",-16);break;case"x":Ye("A",-4);break;case"c":Ye("A",4);break;case"v":Ye("A",16);break;case"m":Ye("B",-16);break;case",":Ye("B",-4);break;case".":Ye("B",4);break;case"/":Ye("B",16);break;case"1":et("A",0);break;case"2":et("A",1);break;case"3":et("A",2);break;case"4":et("A",3);break;case"7":et("B",0);break;case"8":et("B",1);break;case"9":et("B",2);break;case"0":et("B",3);break;default:l=!1}if(l)return!0;l=!0}switch(a.key.toLowerCase()){case"q":r.deckA.isPlaying()?(r.deckA.pause(),s.setDeckPlaying("A",!1)):(r.deckA.play(),s.setDeckPlaying("A",!0));break;case"w":c?s.setDeckPitch("A",s.decks.A.pitchOffset+1):r.deckA.cue(s.decks.A.cuePoint);break;case"e":r.deckA.cue(s.decks.A.songPos+1);break;case"r":s.setDeckCuePoint("A",r.deckA.replayer.getSongPos());break;case"a":r.deckA.nudge(c?-5:-2,c?16:8);break;case"d":r.deckA.nudge(c?5:2,c?16:8);break;case"s":c?s.setDeckPitch("A",s.decks.A.pitchOffset-1):s.setDeckPitch("A",0);break;case"z":s.decks.A.loopActive?(r.deckA.clearLineLoop(),s.setDeckLoop("A","off",!1)):(r.deckA.setLineLoop(s.decks.A.lineLoopSize),s.setDeckLoop("A","line",!0));break;case"x":{const e=At.indexOf(s.decks.A.lineLoopSize);if(e>0){const t=At[e-1];s.setDeckLoopSize("A",t),s.decks.A.loopActive&&r.deckA.setLineLoop(t)}break}case"c":{const e=At.indexOf(s.decks.A.lineLoopSize);if(e<At.length-1){const t=At[e+1];s.setDeckLoopSize("A",t),s.decks.A.loopActive&&r.deckA.setLineLoop(t)}break}case"1":case"2":case"3":case"4":{const e=parseInt(a.key)-1;c?(s.setAllDeckChannels("A",!1),s.toggleDeckChannel("A",e)):s.toggleDeckChannel("A",e);break}case"5":s.setAllDeckChannels("A",!0);break;case"tab":a.preventDefault(),s.setDeckState("A",{repitchLock:!s.decks.A.repitchLock});break;case"p":r.deckB.isPlaying()?(r.deckB.pause(),s.setDeckPlaying("B",!1)):(r.deckB.play(),s.setDeckPlaying("B",!0));break;case"o":c?s.setDeckPitch("B",s.decks.B.pitchOffset+1):r.deckB.cue(s.decks.B.cuePoint);break;case"i":r.deckB.cue(s.decks.B.songPos+1);break;case"u":s.setDeckCuePoint("B",r.deckB.replayer.getSongPos());break;case"j":r.deckB.nudge(c?-5:-2,c?16:8);break;case"l":r.deckB.nudge(c?5:2,c?16:8);break;case"k":c?s.setDeckPitch("B",s.decks.B.pitchOffset-1):s.setDeckPitch("B",0);break;case"m":s.decks.B.loopActive?(r.deckB.clearLineLoop(),s.setDeckLoop("B","off",!1)):(r.deckB.setLineLoop(s.decks.B.lineLoopSize),s.setDeckLoop("B","line",!0));break;case",":{const e=At.indexOf(s.decks.B.lineLoopSize);if(e>0){const t=At[e-1];s.setDeckLoopSize("B",t),s.decks.B.loopActive&&r.deckB.setLineLoop(t)}break}case".":{const e=At.indexOf(s.decks.B.lineLoopSize);if(e<At.length-1){const t=At[e+1];s.setDeckLoopSize("B",t),s.decks.B.loopActive&&r.deckB.setLineLoop(t)}break}case"7":case"8":case"9":case"0":{const e={7:0,8:1,9:2,0:3}[a.key];c?(s.setAllDeckChannels("B",!1),s.toggleDeckChannel("B",e)):s.toggleDeckChannel("B",e);break}case"-":s.setAllDeckChannels("B",!0);break;case"\\":s.setDeckState("B",{repitchLock:!s.decks.B.repitchLock});break;case" ":a.preventDefault(),s.setCrossfader(.5),r.mixer.setCrossfader(.5);break;case"f":s.setCrossfader(Math.max(0,s.crossfaderPosition-.05)),r.mixer.setCrossfader(s.crossfaderPosition);break;case"g":s.setCrossfader(Math.min(1,s.crossfaderPosition+.05)),r.mixer.setCrossfader(s.crossfaderPosition);break;case"t":{const e=s.decks.A,t=s.decks.B;if(e.beatGrid&&t.beatGrid){const e=ge("B","A");ve("B","A","beat"),s.setDeckPitch("B",e)}else{const e=Ne.syncBPM(r.deckA,r.deckB);s.setDeckPitch("B",e)}}break;case"`":r.killAll(),s.setDeckPlaying("A",!1),s.setDeckPlaying("B",!1);break;case"f1":a.preventDefault(),s.setDeckPFL("A",!s.decks.A.pflEnabled);break;case"f2":a.preventDefault(),s.setDeckPFL("B",!s.decks.B.pflEnabled);break;case"f4":a.preventDefault(),s.setDeckSlip("A",!s.decks.A.slipEnabled),r.deckA.setSlipEnabled(!s.decks.A.slipEnabled);break;case"v":i("A","low");break;case"b":i("A","mid");break;case"n":i("A","high");break;case"/":i("B","low");break;case";":i("B","mid");break;case"'":i("B","high");break;case"h":{const e=["off","beat","bar"],t=e.indexOf(Me());Ae(e[(t+1)%e.length]);break}case"y":if(s.decks.A.beatGrid&&s.decks.B.beatGrid){const e=ge("A","B");ve("A","B","beat"),s.setDeckPitch("A",e)}else{const e=Ne.syncBPM(r.deckB,r.deckA);s.setDeckPitch("A",e)}break;case"f5":a.preventDefault(),Ze("A",c?4:0);break;case"f6":a.preventDefault(),Ze("A",c?5:1);break;case"f7":a.preventDefault(),Ze("A",c?6:2);break;case"f8":a.preventDefault(),Ze("A",c?7:3);break;case"f9":a.preventDefault(),Ze("B",c?4:0);break;case"f10":a.preventDefault(),Ze("B",c?5:1);break;case"f11":a.preventDefault(),Ze("B",c?6:2);break;case"f12":a.preventDefault(),Ze("B",c?7:3);break;default:l=!1}return l},[]);w.useEffect(()=>B("dj",t),[t])}export{ue as A,W as B,Mt as C,Ne as D,Lt as E,wt as F,st as G,ct as H,yt as I,K as J,te as K,Ae as a,Ee as b,Je as c,Ye as d,qe as e,Xe as f,Me as g,Q as h,Ue as i,Y as j,ke as k,Qe as l,rt as m,ot as n,Ke as o,ve as p,Oe as q,Re as r,ge as s,Ie as t,Te as u,we as v,ie as w,ce as x,ee as y,pe as z};
