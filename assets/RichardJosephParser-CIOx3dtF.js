function n(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}function t(n,t){return(n[t]<<8|n[t+1])>>>0}function e(n){return!(n.length<16)&&(82===n[0]&&74===n[1]&&80===n[2]&&(83===n[4]&&77===n[5]&&79===n[6]&&68===n[7]))}async function o(o,r){const a=new Uint8Array(o);if(!e(a))throw new Error("Not a Richard Joseph Player module");const l=a[3],s=n(a,8),i=Math.min(s>>>5,256);let p=1;try{const t=12+s;if(t+8<a.length){const e=t+4+n(a,t);if(e+4<=a.length){const t=n(a,e)>>>2;t>0&&t<=256&&(p=t)}}}catch{}const h=[];for(let n=0;n<i;n++){const e=12+32*n;let o=0,r=0,l=0;e+32<=a.length&&(o=2*t(a,e+16),r=2*t(a,e+18),l=t(a,e+26)),h.push({id:n+1,name:`Sample ${n+1}`,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0,metadata:{rjpSample:{loopStart:o,loopSize:r,hasLoop:r>2,lengthBytes:2*l}}})}0===h.length&&h.push({id:1,name:"Sample 1",type:"synth",synthType:"Synth",effects:[],volume:0,pan:0});const u=r.split("/").pop()??r,m=u.replace(/^rjp\./i,"").replace(/\.(sng|rjp)$/i,"")||u,c=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${m} [Richard Joseph v${l}] (${i} smp, ${p} sub)`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(n,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===t||3===t?-50:50,instrumentId:null,color:null,rows:c})),importMetadata:{sourceFormat:"MOD",sourceFile:r,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:i}}],instruments:h,songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{e as isRJPFormat,o as parseRJPFile};
