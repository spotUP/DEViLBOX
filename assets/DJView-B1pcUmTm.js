const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeckVinyl3DView-yf6ukDtA.js","assets/index-zx6LJBPK.js","assets/vendor-react-DkDaD07v.js","assets/vendor-utils-XMmR-oGw.js","assets/vendor-tone-CADp_hfL.js","assets/vendor-ui-uomqNFY-.js","assets/index-Cnoi0D0R.css","assets/DJ3DCameraControls-DKofB3_2.js","assets/react-three-fiber.esm-DUbY8J_y.js","assets/DJKeyboardHandler-Dzr29xNs.js","assets/parseModuleToSong-BCo4MrbT.js","assets/ReadOnlyPatternCanvas-D4F3fqwn.js","assets/sortable.esm-Nw3Rboz6.js","assets/MasterEffectsModal-BHri30Qv.js","assets/guitarMLRegistry-Ct9uudVS.js","assets/useVisualizationAnimation-D37DdYyX.js","assets/NoteRepeatEngine-CA535fLg.js","assets/MpcResamplerDSP-nORj9P5z.js","assets/AudioContextSingleton-BmUieoGD.js","assets/MixerVestax3DView-C62mNShX.js"])))=>i.map(i=>d[i]);
import{aQ as e,aR as t,j as r,bw as o,aG as s,cM as n,cN as i,cO as a,cP as c,cQ as l,cR as d,cS as m,cT as u,cU as b,aS as p,aT as x,_ as f,aH as v,cV as N,cW as D,cy as h,w as g,cw as k,bP as E,bQ as V,bR as j,bS as C,bT as y,bU as B,bV as w,bW as L,bX as O,bY as M,bZ as P,b_ as U,b$ as X,c0 as S,c1 as A,c2 as T,c3 as J,c4 as F,c5 as R,c6 as I,c7 as $,c8 as z,c9 as _,ca as q,cb as H,c as G,cX as K,bB as W,t as Q}from"./index-zx6LJBPK.js";import{R as Y,r as Z}from"./vendor-utils-XMmR-oGw.js";import{an as ee,ao as te,a as re,ap as oe,aq as se,u as ne,C as ie,ar as ae,as as ce}from"./react-three-fiber.esm-DUbY8J_y.js";import{g as le,s as de,p as me,D as ue,a as be,b as pe,q as xe,i as fe,e as ve,f as Ne,c as De,d as he,h as ge,j as ke,k as Ee,l as Ve,m as je,n as Ce,o as ye,r as Be,t as we,u as Le,v as Oe,w as Me,x as Pe,y as Ue,z as Xe,A as Se,B as Ae,C as Te,E as Je,F as Fe,G as Re,H as Ie,I as $e}from"./DJKeyboardHandler-Dzr29xNs.js";import{i as ze,p as _e}from"./parseModuleToSong-BCo4MrbT.js";import{aI as qe,P as He,a9 as Ge,aJ as Ke,ad as We,C as Qe,c as Ye,aK as Ze,a0 as et,$ as tt,aL as rt,Z as ot,X as st,aM as nt,an as it,a6 as at,m as ct,aD as lt,ap as dt,T as mt}from"./vendor-ui-uomqNFY-.js";import{R as ut}from"./ReadOnlyPatternCanvas-D4F3fqwn.js";import"./sortable.esm-Nw3Rboz6.js";import{a as bt}from"./MasterEffectsModal-BHri30Qv.js";import"./vendor-tone-CADp_hfL.js";import{u as pt,D as xt,N as ft,g as vt,P as Nt}from"./NoteRepeatEngine-CA535fLg.js";import{g as Dt,r as ht}from"./AudioContextSingleton-BmUieoGD.js";function gt(){return gt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},gt.apply(null,arguments)}const kt=e=>{let t;const r=new Set,o=(e,o)=>{const s="function"==typeof e?e(t):e;if(!Object.is(s,t)){const e=t;t=(null!=o?o:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,n={setState:o,getState:s,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{r.clear()}},i=t=e(o,s,n);return n},Et={},{useDebugValue:Vt}=Y,{useSyncExternalStoreWithSelector:jt}=ee;let Ct=!1;const yt=e=>e;const Bt=e=>{const t="function"==typeof e?(e=>e?kt(e):kt)(e):e,r=(e,r)=>function(e,t=yt,r){"production"!==(Et?"production":void 0)&&r&&!Ct&&(Ct=!0);const o=jt(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Vt(o),o}(t,e,r);return Object.assign(r,t),r};var wt,Lt;const Ot="undefined"!=typeof window&&(null!=(wt=window.document)&&wt.createElement||"ReactNative"===(null==(Lt=window.navigator)?void 0:Lt.product))?Y.useLayoutEffect:Y.useEffect;function Mt(){const e=(t=e=>({current:new Array,version:0,set:e}))?Bt(t):Bt;var t;return{In:({children:t})=>{const r=e(e=>e.set),o=e(e=>e.version);return Ot(()=>{r(e=>({version:e.version+1}))},[]),Ot(()=>(r(({current:e})=>({current:[...e,t]})),()=>r(({current:e})=>({current:e.filter(e=>e!==t)}))),[t,o]),null},Out:()=>{const t=e(e=>e.current);return Y.createElement(Y.Fragment,null,t)}}}const Pt=new ie,Ut=Mt();function Xt(e,t){const{right:r,top:o,left:s,bottom:n,width:i,height:a}=t,c=t.bottom<0||o>e.height||r<0||t.left>e.width,l=e.top+e.height-n;return{position:{width:i,height:a,left:s-e.left,top:o,bottom:l,right:r},isOffscreen:c}}function St(e,{left:t,bottom:r,width:o,height:s}){let n;const i=o/s;var a;return(a=e.camera)&&a.isOrthographicCamera?e.camera.manual?e.camera.updateProjectionMatrix():e.camera.left===o/-2&&e.camera.right===o/2&&e.camera.top===s/2&&e.camera.bottom===s/-2||(Object.assign(e.camera,{left:o/-2,right:o/2,top:s/2,bottom:s/-2}),e.camera.updateProjectionMatrix()):e.camera.aspect!==i&&(e.camera.aspect=i,e.camera.updateProjectionMatrix()),n=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,r,o,s),e.gl.setScissor(t,r,o,s),e.gl.setScissorTest(!0),n}function At(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function Tt(e){e.gl.getClearColor(Pt),e.gl.setClearColor(Pt,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function Jt({visible:e=!0,canvasSize:t,scene:r,index:o,children:s,frames:n,rect:i,track:a}){const c=re(),[l,d]=Z.useState(!1);let m=0;return ne(o=>{var c;(n===1/0||m<=n)&&(a&&(i.current=null==(c=a.current)?void 0:c.getBoundingClientRect()),m++);if(i.current){const{position:n,isOffscreen:a}=Xt(t,i.current);if(l!==a&&d(a),e&&!l&&i.current){const e=St(o,n);o.gl.render(s?o.scene:r,o.camera),At(o,e)}}},o),Z.useLayoutEffect(()=>{const r=i.current;if(r&&(!e||!l)){const{position:e}=Xt(t,r),o=St(c,e);Tt(c),At(c,o)}},[e,l]),Z.useEffect(()=>{if(!a)return;const e=i.current,r=c.get().events.connected;return c.setEvents({connected:a.current}),()=>{if(e){const{position:r}=Xt(t,e),o=St(c,r);Tt(c),At(c,o)}c.setEvents({connected:r})}},[a]),Z.createElement(Z.Fragment,null,s,Z.createElement("group",{onPointerOver:()=>null}))}const Ft=Z.forwardRef(({track:e,visible:t=!0,index:r=1,id:o,style:s,className:n,frames:i=1/0,children:a,...c},l)=>{var d,m,u,b;const p=Z.useRef(null),{size:x,scene:f}=re(),[v]=Z.useState(()=>new oe),[N,D]=Z.useReducer(()=>!0,!1),h=Z.useCallback((t,r)=>{if(p.current&&e&&e.current&&t.target===e.current){const{width:e,height:o,left:s,top:n}=p.current,i=t.clientX-s,a=t.clientY-n;r.pointer.set(i/e*2-1,-a/o*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}},[p,e]);return Z.useEffect(()=>{var t;e&&(p.current=null==(t=e.current)?void 0:t.getBoundingClientRect()),D()},[e]),Z.createElement("group",gt({ref:l},c),N&&se(Z.createElement(Jt,{visible:t,canvasSize:x,frames:i,scene:f,track:e,rect:p,index:r},a),v,{events:{compute:h,priority:r},size:{width:null==(d=p.current)?void 0:d.width,height:null==(m=p.current)?void 0:m.height,top:null==(u=p.current)?void 0:u.top,left:null==(b=p.current)?void 0:b.left}}))}),Rt=Z.forwardRef(({as:e="div",id:t,visible:r,className:o,style:s,index:n=1,track:i,frames:a=1/0,children:c,...l},d)=>{const m=Z.useId(),u=Z.useRef(null);return Z.useImperativeHandle(d,()=>u.current),Z.createElement(Z.Fragment,null,Z.createElement(e,gt({ref:u,id:t,className:o,style:s},l)),Z.createElement(Ut.In,null,Z.createElement(Ft,{visible:r,key:m,track:u,frames:a,index:n},c)))}),It=(()=>{const e=Z.forwardRef((e,t)=>Z.useContext(te)?Z.createElement(Ft,gt({ref:t},e)):Z.createElement(Rt,gt({ref:t},e)));return e.Port=()=>Z.createElement(Ut.Out,null),e})(),$t=({deckId:o})=>{const s=e(e=>e.decks[o].isPlaying),n=e(e=>e.decks[o].cuePoint),i=e(e=>e.decks[o].keyLockEnabled),a=e(e=>e.setDeckPlaying),c="A"===o?"B":"A",l=e(e=>e.decks[o].effectiveBPM),d=e(e=>e.decks[c].effectiveBPM),m=Math.abs(l-d)<.5,u=Z.useCallback(async()=>{const e=t().getDeck(o);s?(e.pause(),a(o,!1)):(await e.play(),a(o,!0))},[o,s,a]),b=Z.useCallback(()=>{t().getDeck(o).cue(n)},[o,n]),[p,x]=Z.useState(le),f=Z.useCallback(()=>{const e=["off","beat","bar"],t=(e.indexOf(p)+1)%e.length,r=e[t];be(r),x(r)},[p]),v=Z.useCallback(()=>{const r=!i;e.getState().setDeckKeyLock(o,r);try{t().getDeck(o).setKeyLock(r)}catch{}},[o,i]),N=Z.useCallback(()=>{try{const r=t(),s=r.getDeck(o),n=r.getDeck(c),i=e.getState().decks[c],a=e.getState().decks[o];if(!i.fileName)return;if(a.beatGrid&&i.beatGrid){const t=de(o,c);return me(o,c,"beat"),void e.getState().setDeckPitch(o,t)}if("audio"===n.playbackMode||"audio"===s.playbackMode){const t=i.detectedBPM,r=e.getState().decks[o].detectedBPM;if(t>0&&r>0){const s=t/r,n=12*Math.log2(s);e.getState().setDeckPitch(o,n)}}else{if(!n.replayer.getSong())return;const t=ue.syncBPM(n,s);e.getState().setDeckPitch(o,t)}}catch{}},[o,c]);return r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV("button",{onClick:u,className:`\n          flex items-center justify-center w-10 h-10 rounded-lg\n          transition-all duration-100 border border-dark-border\n          active:translate-y-[1px]\n          ${s?"bg-green-600 text-white":"bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover"}\n        `,title:s?"Pause":"Play",children:s?r.jsxDEV(qe,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:124,columnNumber:22},void 0):r.jsxDEV(He,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:124,columnNumber:44},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:110,columnNumber:7},void 0),r.jsxDEV("button",{onClick:b,className:"\n          flex items-center justify-center w-10 h-10 rounded-lg\n          bg-dark-bgTertiary text-accent-warning border border-dark-border\n          hover:bg-dark-bgHover\n          active:translate-y-[1px]\n          transition-all duration-100\n        ",title:"Cue",children:r.jsxDEV(Ge,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:139,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:128,columnNumber:7},void 0),r.jsxDEV("button",{onClick:N,className:`\n          flex items-center justify-center w-10 h-10 rounded-lg\n          border border-dark-border\n          active:translate-y-[1px]\n          transition-all duration-100\n          ${m?"bg-cyan-600/30 text-cyan-300":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-text-secondary"}\n        `,title:"Sync",children:r.jsxDEV(Ke,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:158,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:143,columnNumber:7},void 0),r.jsxDEV("button",{onClick:f,className:`\n          flex items-center justify-center h-10 px-2 rounded-lg\n          border border-dark-border text-[10px] font-bold tracking-wide\n          active:translate-y-[1px]\n          transition-all duration-100\n          ${"off"===p?"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover":"beat"===p?"bg-violet-600/30 text-violet-300 border-violet-500/40":"bg-fuchsia-600/30 text-fuchsia-300 border-fuchsia-500/40"}\n        `,title:`Quantize: ${p.toUpperCase()} (click to cycle)`,children:["Q","off"!==p&&r.jsxDEV("span",{className:"ml-0.5 opacity-70",children:"beat"===p?"â™©":"ð„"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:179,columnNumber:30},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:162,columnNumber:7},void 0),r.jsxDEV("button",{onClick:v,className:`\n          flex items-center justify-center w-10 h-10 rounded-lg\n          border border-dark-border\n          active:translate-y-[1px]\n          transition-all duration-100\n          ${i?"bg-amber-600/30 text-amber-300 border-amber-500/40":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-text-secondary"}\n        `,title:i?"Key Lock ON â€” pitch slider changes tempo only":"Key Lock OFF â€” pitch and tempo coupled",children:r.jsxDEV(We,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:198,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:183,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTransport.tsx",lineNumber:108,columnNumber:5},void 0)},zt=24,_t=({deckId:t})=>{const o=e(e=>e.decks[t].pitchOffset),s=e(e=>e.setDeckPitch),n=Z.useRef(o);Z.useEffect(()=>{n.current=o},[o]);const i=Z.useRef(null),[a,c]=Z.useState(!1),[l,d]=Z.useState(200);Z.useEffect(()=>{const e=i.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0]?.contentRect.height;t&&t>0&&d(t)});return t.observe(e),()=>t.disconnect()},[]);const m=Z.useCallback(e=>(16-e)/32*(l-zt),[l]),u=Z.useCallback(e=>16-32*(Math.max(0,Math.min(l-zt,e))/(l-zt)),[l]),b=Z.useCallback(e=>{if(!i.current)return;const r=e-i.current.getBoundingClientRect().top-12,o=Math.round(10*u(r))/10;s(t,o)},[t,s,u]),p=Z.useCallback(e=>{e.preventDefault(),c(!0),b(e.clientY)},[b]);Z.useEffect(()=>{if(!a)return;const e=e=>{b(e.clientY)},t=()=>{c(!1)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[a,b]);const x=Z.useCallback(()=>{s(t,0)},[t,s]),f=m(o),v=m(0),N=o>0?`+${o.toFixed(1)}`:o<0?o.toFixed(1):"0.0";return r.jsxDEV("div",{className:"flex flex-col items-center gap-2 select-none h-full",children:[r.jsxDEV("div",{ref:i,className:"relative cursor-pointer flex-1 min-h-0",style:{width:32},onMouseDown:p,onDoubleClick:x,onContextMenu:e=>{e.preventDefault(),s(t,0)},children:[r.jsxDEV("div",{className:"absolute left-1/2 -translate-x-1/2 rounded-sm top-0 bottom-0",style:{width:6,backgroundColor:"#1a1a2e",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.6)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:125,columnNumber:9},void 0),r.jsxDEV("div",{className:"absolute left-0 right-0",style:{top:v+12-1,height:2,backgroundColor:"#666"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:135,columnNumber:9},void 0),r.jsxDEV("div",{className:"absolute left-0 right-0 rounded-sm",style:{top:f,height:zt,backgroundColor:"#555",backgroundImage:"linear-gradient(to bottom, #6a6a6a 0%, #555 40%, #444 100%)",boxShadow:a?"0 0 6px rgba(255,255,255,0.2), inset 0 1px 0 rgba(255,255,255,0.15)":"inset 0 1px 0 rgba(255,255,255,0.15), 0 1px 3px rgba(0,0,0,0.5)",cursor:a?"grabbing":"grab"},children:r.jsxDEV("div",{className:"absolute inset-x-1 top-1/2 -translate-y-1/2 flex flex-col gap-[2px]",children:[r.jsxDEV("div",{className:"h-[1px] bg-black/30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:161,columnNumber:13},void 0),r.jsxDEV("div",{className:"h-[1px] bg-white/10"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:162,columnNumber:13},void 0),r.jsxDEV("div",{className:"h-[1px] bg-black/30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:163,columnNumber:13},void 0),r.jsxDEV("div",{className:"h-[1px] bg-white/10"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:164,columnNumber:13},void 0),r.jsxDEV("div",{className:"h-[1px] bg-black/30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:165,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:160,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:145,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:116,columnNumber:7},void 0),r.jsxDEV("div",{className:"font-mono text-xs text-text-secondary text-center shrink-0",style:{minWidth:48},children:[N," st"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:171,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPitchSlider.tsx",lineNumber:114,columnNumber:5},void 0)},qt=({deckId:e})=>{const o=Z.useCallback((r,o)=>{const s=o.shiftKey,n=r*(s?5:2),i=s?16:8;t().getDeck(e).nudge(n,i)},[e]);return r.jsxDEV("div",{className:"flex items-center gap-1",children:[r.jsxDEV("button",{onClick:e=>o(-1,e),className:"\n          flex items-center justify-center w-10 h-10 rounded-lg\n          bg-dark-bgTertiary text-text-secondary border border-dark-border\n          hover:bg-dark-bgHover hover:text-text-primary\n          active:translate-y-[1px]\n          transition-all duration-100\n        ",title:"Nudge slower (Shift = hard nudge)",children:r.jsxDEV(Qe,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckNudge.tsx",lineNumber:48,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckNudge.tsx",lineNumber:37,columnNumber:7},void 0),r.jsxDEV("button",{onClick:e=>o(1,e),className:"\n          flex items-center justify-center w-10 h-10 rounded-lg\n          bg-dark-bgTertiary text-text-secondary border border-dark-border\n          hover:bg-dark-bgHover hover:text-text-primary\n          active:translate-y-[1px]\n          transition-all duration-100\n        ",title:"Nudge faster (Shift = hard nudge)",children:r.jsxDEV(Ye,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckNudge.tsx",lineNumber:63,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckNudge.tsx",lineNumber:52,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckNudge.tsx",lineNumber:35,columnNumber:5},void 0)},Ht={"A minor":{number:8,letter:"A",display:"8A"},"E minor":{number:9,letter:"A",display:"9A"},"B minor":{number:10,letter:"A",display:"10A"},"F# minor":{number:11,letter:"A",display:"11A"},"Db minor":{number:12,letter:"A",display:"12A"},"C# minor":{number:12,letter:"A",display:"12A"},"Ab minor":{number:1,letter:"A",display:"1A"},"G# minor":{number:1,letter:"A",display:"1A"},"Eb minor":{number:2,letter:"A",display:"2A"},"D# minor":{number:2,letter:"A",display:"2A"},"Bb minor":{number:3,letter:"A",display:"3A"},"A# minor":{number:3,letter:"A",display:"3A"},"F minor":{number:4,letter:"A",display:"4A"},"C minor":{number:5,letter:"A",display:"5A"},"G minor":{number:6,letter:"A",display:"6A"},"D minor":{number:7,letter:"A",display:"7A"},"C major":{number:8,letter:"B",display:"8B"},"G major":{number:9,letter:"B",display:"9B"},"D major":{number:10,letter:"B",display:"10B"},"A major":{number:11,letter:"B",display:"11B"},"E major":{number:12,letter:"B",display:"12B"},"B major":{number:1,letter:"B",display:"1B"},"Cb major":{number:1,letter:"B",display:"1B"},"F# major":{number:2,letter:"B",display:"2B"},"Gb major":{number:2,letter:"B",display:"2B"},"Db major":{number:3,letter:"B",display:"3B"},"C# major":{number:3,letter:"B",display:"3B"},"Ab major":{number:4,letter:"B",display:"4B"},"G# major":{number:4,letter:"B",display:"4B"},"Eb major":{number:5,letter:"B",display:"5B"},"D# major":{number:5,letter:"B",display:"5B"},"Bb major":{number:6,letter:"B",display:"6B"},"A# major":{number:6,letter:"B",display:"6B"},"F major":{number:7,letter:"B",display:"7B"}};function Gt(e){if(!e)return null;const t=Ht[e];if(t)return t;const r=function(e){const t=e.match(/^([A-Ga-g][#bâ™¯â™­]?)\s*(min(?:or)?|maj(?:or)?|m)$/i);if(!t)return null;let r=t[1].charAt(0).toUpperCase()+t[1].slice(1).toLowerCase();r=r.replace("â™¯","#").replace("â™­","b");const o=t[2].toLowerCase(),s="m"===o||o.startsWith("min");return`${r} ${s?"minor":"major"}`}(e);if(r){const e=Ht[r];if(e)return e}const o=e.match(/^(\d{1,2})([ABab])$/);if(o){const e=parseInt(o[1]),t=o[2].toUpperCase();if(e>=1&&e<=12)return{number:e,letter:t,display:`${e}${t}`}}return null}function Kt(e){const t=Gt(e);return t?t.display:"â€”"}const Wt=({deckId:t})=>{const o=e(e=>!!e.decks[t].beatGrid),s=e(e=>e.decks[t].beatGrid?.timeSignature??4),[n,i]=Z.useState(null),a=Z.useRef(0),c=Z.useRef(!0);Z.useEffect(()=>{c.current=!0;const e=()=>{if(!c.current)return;const r=pe(t);i(r),a.current=requestAnimationFrame(e)};return a.current=requestAnimationFrame(e),()=>{c.current=!1,cancelAnimationFrame(a.current)}},[t]);const l=n?Math.floor(n.barPhase*s)%4:-1,d=n?n.beatPhase:0,m=d<.12||d>.88,u="A"===t?"#3b82f6":"#f97316",b="rgba(255,255,255,0.08)";return o?r.jsxDEV("div",{className:"flex items-center gap-[3px]",children:Array.from({length:4},(e,t)=>{const o=t===l,s=0===t,n=o?m?1:Math.max(.3,1-.8*d):.08,i=s?u:"#ffffff";return r.jsxDEV("div",{className:"rounded-sm relative overflow-hidden",style:{width:10,height:10,backgroundColor:b},children:[r.jsxDEV("div",{className:"absolute inset-0 rounded-sm",style:{backgroundColor:i,opacity:n,transition:o?"none":"opacity 0.1s"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:108,columnNumber:13},void 0),o&&m&&r.jsxDEV("div",{className:"absolute inset-[-2px] rounded-sm pointer-events-none",style:{boxShadow:`0 0 6px 1px ${s?u:"rgba(255,255,255,0.5)"}`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:118,columnNumber:15},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:98,columnNumber:11},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:86,columnNumber:5},void 0):r.jsxDEV("div",{className:"flex items-center gap-[3px]",children:Array.from({length:4},(e,t)=>r.jsxDEV("div",{className:"rounded-sm",style:{width:10,height:10,backgroundColor:b}},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:71,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckBeatPhase.tsx",lineNumber:69,columnNumber:7},void 0)},Qt=({deckId:t})=>{const o=e(e=>e.decks[t].trackName),s=e(e=>e.decks[t].effectiveBPM),n=e(e=>e.decks[t].detectedBPM),i=e(e=>e.decks[t].elapsedMs),a=e(e=>e.decks[t].playbackMode),c=e(e=>e.decks[t].durationMs),l=e(e=>e.decks[t].musicalKey),d=e(e=>e.decks[t].seratoKey),m=e(e=>e.decks[t].analysisState),u=e(e=>e.decks[t].analysisProgress),b=e(e=>e.decks[t].beatGrid?.bpm??0),p=e(e=>e.decks[t].pitchOffset),x="A"===t?"B":"A",f=e(e=>e.decks[x].effectiveBPM),v=e(e=>e.decks[x].musicalKey??e.decks[x].seratoKey),N=b>0?b:"audio"===a?n:s,D=l??d??null,h=Kt(D),g=Z.useMemo(()=>Math.abs(N-f)<.5,[N,f]),k=Z.useMemo(()=>function(e,t){const r=Gt(e),o=Gt(t);if(!r||!o)return"clash";if(r.number===o.number&&r.letter===o.letter)return"perfect";if(r.number===o.number&&r.letter!==o.letter)return"mood-change";if(r.letter===o.letter){const e=(o.number-r.number+12)%12;if(1===e)return"energy-boost";if(11===e)return"energy-drop"}return"clash"}(D,v),[D,v]),E=Z.useMemo(()=>D?v?function(e){switch(e){case"perfect":case"compatible":return"#22c55e";case"energy-boost":return"#3b82f6";case"energy-drop":return"#a855f7";case"mood-change":return"#f59e0b";case"clash":return"#ef4444"}}(k):function(e){const t=Gt(e);return t?`hsl(${30*(t.number-1)%360}, ${"B"===t.letter?70:55}%, ${"B"===t.letter?65:55}%)`:"#6b7280"}(D):"#6b7280",[D,v,k]),V=Z.useMemo(()=>{if(0===p)return null;const e=100*(Math.pow(2,p/12)-1);return`${e>0?"+":""}${e.toFixed(1)}%`},[p]),j=Z.useMemo(()=>{if(!v||!D)return null;switch(k){case"perfect":return"MATCH";case"compatible":return"COMPAT";case"energy-boost":return"ENERGYâ†‘";case"energy-drop":return"ENERGYâ†“";case"mood-change":return"MOOD";case"clash":return"CLASH";default:return null}},[k,v,D]),C=Z.useMemo(()=>{const e=Math.floor(i/1e3),t=Math.floor(e/60),r=e%60;return`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`},[i]),y=Z.useMemo(()=>{if("audio"!==a||c<=0)return null;const e=Math.max(0,c-i),t=Math.floor(e/1e3),r=Math.floor(t/60),o=t%60;return`-${String(r).padStart(2,"0")}:${String(o).padStart(2,"0")}`},[a,c,i]),B=Z.useMemo(()=>{const e=u>0?` ${u}%`:"";switch(m){case"pending":return{text:"QUEUE",color:"text-yellow-600"};case"rendering":return{text:`REND${e}`,color:"text-blue-400"};case"analyzing":return{text:`ANLZ${e}`,color:"text-purple-400"};default:return null}},[m,u]);return r.jsxDEV("div",{className:"flex flex-col gap-1 min-w-0",children:[r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV("div",{className:"text-sm text-text-primary truncate flex-1",title:o||"No track loaded",children:o||"No track loaded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:117,columnNumber:9},void 0),B&&r.jsxDEV("span",{className:`text-[9px] font-bold ${B.color} animate-pulse tracking-wider flex-shrink-0`,children:B.text},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:124,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:116,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-center gap-3",children:[r.jsxDEV(Wt,{deckId:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:133,columnNumber:9},void 0),r.jsxDEV("span",{className:"font-mono text-2xl font-bold tabular-nums "+(g?"text-accent-success":"text-text-primary"),children:N>0?N.toFixed(1):"---.-"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:136,columnNumber:9},void 0),r.jsxDEV("span",{className:"text-xs text-text-muted uppercase tracking-wider",children:"BPM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:141,columnNumber:9},void 0),V&&r.jsxDEV("span",{className:"font-mono text-xs tabular-nums text-text-secondary",children:V},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:147,columnNumber:11},void 0),D&&r.jsxDEV("span",{className:"font-mono text-sm font-semibold tabular-nums",style:{color:E},title:`${D} (${h})${v?` â€¢ ${k} with ${Kt(v)}`:""}`,children:[h,j&&r.jsxDEV("span",{className:"ml-1 text-[9px] font-normal opacity-80",children:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:161,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:154,columnNumber:11},void 0),r.jsxDEV("span",{className:"font-mono text-sm text-text-secondary tabular-nums",children:C},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:169,columnNumber:9},void 0),y&&r.jsxDEV("span",{className:"font-mono text-sm text-text-muted tabular-nums",children:y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:175,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:131,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackInfo.tsx",lineNumber:114,columnNumber:5},void 0)};function Yt(e){return new Worker("/assets/dj-overview.worker-zUiGkdEO.js",{name:e?.name})}function Zt(e){const t=getComputedStyle(e);return{bg:t.getPropertyValue("--color-bg").trim()||"#0b0909",bgSecondary:t.getPropertyValue("--color-bg-secondary").trim()||"#131010",bgTertiary:t.getPropertyValue("--color-bg-tertiary").trim()||"#1d1818",border:t.getPropertyValue("--color-border").trim()||"#2f2525"}}function er(e){return{playbackMode:e.playbackMode,songPos:e.songPos,totalPositions:e.totalPositions,cuePoint:e.cuePoint,loopActive:e.loopActive,patternLoopStart:e.patternLoopStart,patternLoopEnd:e.patternLoopEnd,audioPosition:e.audioPosition,durationMs:e.durationMs,waveformPeaks:e.waveformPeaks?Array.from(e.waveformPeaks):null,frequencyPeaks:e.frequencyPeaks?e.frequencyPeaks.map(e=>Array.from(e)):null}}const tr=({deckId:n})=>{const i=e(e=>e.decks[n].analysisState),a=e(e=>e.decks[n].analysisProgress),c=Z.useRef(null),l=Z.useRef(null),d=Z.useRef(null);Z.useEffect(()=>{const t=l.current;if(!t||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const r=document.createElement("canvas");r.className="block rounded-sm",r.style.cssText="display:block;width:100%;height:24px;border-radius:2px;",t.appendChild(r),c.current=r;const i=window.devicePixelRatio||1,a=Math.max(1,t.clientWidth),m=Zt(t),u=e.getState().decks[n],b=r.transferControlToOffscreen(),p=new o(Yt,{onReady:()=>{}});d.current=p,p.post({type:"init",canvas:b,dpr:i,width:a,height:24,colors:m,...er(u)},[b]);const x=e.subscribe(e=>e.decks[n],e=>d.current?.post({type:"state",...er(e)})),f=s.subscribe(()=>{l.current&&d.current?.post({type:"colors",colors:Zt(l.current)})}),v=new ResizeObserver(e=>{const t=e[0];if(!t)return;const r=Math.floor(t.contentRect.width);r>0&&d.current?.post({type:"resize",w:r,h:24,dpr:window.devicePixelRatio||1})});return v.observe(t),()=>{x(),f(),v.disconnect(),p.dispose(),d.current=null,r.remove(),c.current=null}},[n]);const m=Z.useCallback(r=>{const o=Math.max(0,Math.min(1,r));try{const r=t().getDeck(n);if("audio"===r.playbackMode){const t=o*(e.getState().decks[n].durationMs/1e3);r.audioPlayer.seek(t),e.getState().setDeckState(n,{audioPosition:t,elapsedMs:1e3*t})}else{const t=Math.max(e.getState().decks[n].totalPositions,1),s=Math.min(Math.floor(o*t),t-1);r.cue(s,0),e.getState().setDeckPosition(n,s,0)}}catch{}},[n]),u=Z.useCallback(t=>{const r=Math.max(0,Math.min(1,t));try{const t=e.getState().decks[n];if("audio"===t.playbackMode){const o=r*(t.durationMs/1e3);e.getState().setDeckState(n,{audioPosition:o,elapsedMs:1e3*o})}else{const o=Math.max(t.totalPositions,1),s=Math.min(Math.floor(r*o),o-1);e.getState().setDeckPosition(n,s,0)}}catch{}},[n]),b=Z.useRef(!1),p=Z.useRef(0),x=Z.useCallback(e=>{e.preventDefault(),b.current=!0;const t=l.current;if(!t)return;const r=t.getBoundingClientRect(),o=Math.max(0,Math.min(1,(e.clientX-r.left)/r.width));p.current=o,m(o);const s=e=>{if(!b.current||!t)return;const r=t.getBoundingClientRect(),o=Math.max(0,Math.min(1,(e.clientX-r.left)/r.width));p.current=o,u(o)},n=()=>{b.current=!1,m(p.current),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",n)},[m,u]);return r.jsxDEV("div",{ref:l,className:"w-full cursor-pointer relative",style:{height:24},onMouseDown:x,children:("rendering"===i||"analyzing"===i)&&r.jsxDEV("div",{className:"absolute inset-0 pointer-events-none z-10 overflow-hidden rounded-sm",style:{backgroundColor:"rgba(0,0,0,0.3)"},children:[r.jsxDEV("div",{className:"h-full transition-all duration-500 ease-out "+("rendering"===i?"bg-blue-500/40":"bg-purple-500/40"),style:{width:`${a}%`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackOverview.tsx",lineNumber:209,columnNumber:11},void 0),r.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxDEV("span",{className:"text-[10px] font-bold text-white/70 tracking-tighter uppercase",children:[i," ",a,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackOverview.tsx",lineNumber:214,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackOverview.tsx",lineNumber:213,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackOverview.tsx",lineNumber:205,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTrackOverview.tsx",lineNumber:198,columnNumber:5},void 0)},rr=({deckId:o})=>{const s=e(e=>e.decks[o].songPos),n=e(e=>e.decks[o].pattPos),i=e(e=>e.decks[o].isPlaying),a=e(e=>e.decks[o].fileName),c=e(e=>e.decks[o].totalPositions),l=e(e=>e.decks[o].activePatternName),[d,m]=Z.useState(0),u=Z.useRef(0),b=Z.useRef(0);Z.useEffect(()=>{if(!l)return m(0),void(u.current=0);const t=()=>{const r=performance.now(),s=e.getState(),n=s.decks[o].scratchVelocity;if(u.current>0&&n<-.1){const e=(s.decks[o].effectiveBPM||125)/60*6,t=(r-u.current)/1e3,i=Math.abs(n)*e*t;m(e=>e+i)}else n>.1&&m(e=>e>0?Math.max(0,e-2):0);u.current=r,b.current=requestAnimationFrame(t)};return b.current=requestAnimationFrame(t),()=>{cancelAnimationFrame(b.current),u.current=0}},[o,l]);const{patternData:p,numChannels:x,numRows:f}=Z.useMemo(()=>{try{const e=t(),r=e.getDeck(o).replayer.getSong();if(!r||!r.songPositions||0===r.songPositions.length)return{patternData:null,numChannels:4,numRows:64};const n=r.songPositions[s]??0,i=r.patterns[n]??null;return{patternData:i,numChannels:r.numChannels,numRows:i?i.length:64}}catch{return{patternData:null,numChannels:4,numRows:64}}},[o,s,a,c]),v=l&&d>0?((n-Math.round(d))%f+f)%f:n;return r.jsxDEV("div",{className:"bg-dark-bg border border-dark-border rounded-sm overflow-hidden w-full h-full",children:r.jsxDEV(ut,{pattern:p,currentRow:v,numChannels:x,isPlaying:i},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPatternDisplay.tsx",lineNumber:101,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckPatternDisplay.tsx",lineNumber:100,columnNumber:5},void 0)},or=i.slice(1),sr=({deckId:e,resetKey:o=0})=>{const[s,i]=Z.useState(0),[p,x]=Z.useState(!1),[f,v]=Z.useState(!1),[N,D]=Z.useState(!1),h=Z.useRef(null),g=Z.useRef(null),k=Z.useRef(null),E=Z.useRef(null),V=Z.useRef(n()),j=Z.useRef(0),C=Z.useRef(performance.now()/1e3),y=Z.useRef(null),B=or[s%or.length],w=a(B),[L,O]=Z.useState(0),M=Z.useRef(0),P=Z.useRef(-1);Z.useEffect(()=>{let t=!0,r=0;const o=()=>{if(!t)return;const s=pe(e);s&&(s.nearestBeatIdx!==P.current&&P.current>=0&&(r=1),P.current=s.nearestBeatIdx),r>.01?(r*=.88,O(r)):r>0&&(r=0,O(0)),M.current=requestAnimationFrame(o)};return M.current=requestAnimationFrame(o),()=>{t=!1,cancelAnimationFrame(M.current)}},[e]);const U="A"===e?"59,130,246":"249,115,22",X=Z.useRef(o);Z.useEffect(()=>{o!==X.current&&(X.current=o,i(0))},[o]);const S=Z.useCallback(e=>{e?.stopPropagation(),i(e=>(e+1)%or.length)},[]),A=Z.useCallback(e=>{e?.stopPropagation(),i(e=>(e-1+or.length)%or.length)},[]),T=Z.useCallback(e=>{e?.stopPropagation(),i(e=>{let t;do{t=Math.floor(Math.random()*or.length)}while(t===e&&or.length>1);return t})},[]),J=Z.useCallback(e=>{e?.stopPropagation(),D(e=>!e)},[]);Z.useEffect(()=>(N&&(y.current=setInterval(()=>{i(e=>{let t;do{t=Math.floor(Math.random()*or.length)}while(t===e&&or.length>1);return t})},15e3)),()=>{y.current&&(clearInterval(y.current),y.current=null)}),[N]);const F=Z.useCallback(async e=>{e.stopPropagation(),h.current&&(document.fullscreenElement?await document.exitFullscreen():await h.current.requestFullscreen())},[]);Z.useEffect(()=>{const e=()=>x(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),Z.useEffect(()=>{if(w)return;const r=g.current;if(!r)return;if(!k.current){const e=r.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,stencil:!1,powerPreference:"high-performance"});if(!e)return;e.getExtension("EXT_color_buffer_float"),k.current=e,E.current=c(e)}const o=k.current,s=E.current,n=V.current;let i=!0;const a=()=>{if(!i)return;const c=h.current;if(c&&r){const i=Math.min(window.devicePixelRatio,2),a=c.clientWidth,l=c.clientHeight,d=Math.round(a*i),m=Math.round(l*i);r.width===d&&r.height===m||(r.width=d,r.height=m,r.style.width=`${a}px`,r.style.height=`${l}px`),o.viewport(0,0,d,m);const u=function(e){try{const r=t().getDeck(e),o=r.getWaveform(),s=r.getFFT();let n=0,i=0;for(let e=0;e<o.length;e++){const t=o[e];n+=t*t;const r=Math.abs(t);r>i&&(i=r)}const a=Math.sqrt(n/o.length),c=e=>Math.max(0,(e+100)/100);let l=0,d=0,m=0;const u=10,b=100;for(let e=0;e<s.length;e++){const t=c(s[e]);e<u?l+=t:e<b?d+=t:m+=t}return{waveform:o,fft:s,rms:a,peak:i,bassEnergy:l/u,midEnergy:d/(b-u),highEnergy:m/(s.length-b)}}catch{return nr}}(e),p=performance.now()/1e3-C.current,x=b[B];x&&x(s,u,n,p,d,m)}j.current=requestAnimationFrame(a)};return j.current=requestAnimationFrame(a),()=>{i=!1,cancelAnimationFrame(j.current)}},[e,B,w]),Z.useEffect(()=>()=>{E.current&&(l(E.current),E.current=null),k.current=null,cancelAnimationFrame(j.current)},[]);const R=u[B];return r.jsxDEV("div",{ref:h,className:"relative w-full h-full bg-dark-bg border border-dark-border rounded-sm overflow-hidden select-none",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[w&&r.jsxDEV("div",{className:"absolute inset-0 w-full h-full",children:r.jsxDEV(d,{preset:m[B]??"ledBars",audioSource:"A"===e?"deckA":"deckB"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:258,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:257,columnNumber:9},void 0),r.jsxDEV("canvas",{ref:g,className:"absolute inset-0 w-full h-full",style:{display:w?"none":"block"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:266,columnNumber:7},void 0),r.jsxDEV("div",{className:"absolute inset-0",style:{opacity:.55},children:r.jsxDEV(rr,{deckId:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:274,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:273,columnNumber:7},void 0),L>.01&&r.jsxDEV("div",{className:"absolute inset-0 pointer-events-none rounded-sm",style:{boxShadow:`inset 0 0 12px 2px rgba(${U},${.6*L})`,border:`1px solid rgba(${U},${.4*L})`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:279,columnNumber:9},void 0),r.jsxDEV("div",{className:"absolute bottom-1 right-1 text-[9px] font-mono uppercase tracking-wider pointer-events-none",style:{opacity:p?.7:.4,color:"#888"},children:[R,N&&" âŸ³"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:289,columnNumber:7},void 0),(f||p)&&r.jsxDEV("div",{className:"absolute top-1 right-1 flex gap-0.5 z-10",children:[r.jsxDEV("button",{className:"p-0.5 rounded bg-black/50 hover:bg-black/80 text-white/60 hover:text-white/90 transition-colors",onClick:A,title:"Previous visualizer",children:r.jsxDEV(Qe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:305,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:300,columnNumber:11},void 0),r.jsxDEV("button",{className:"p-0.5 rounded bg-black/50 hover:bg-black/80 text-white/60 hover:text-white/90 transition-colors",onClick:S,title:"Next visualizer",children:r.jsxDEV(Ye,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:312,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:307,columnNumber:11},void 0),r.jsxDEV("button",{className:"p-0.5 rounded bg-black/50 hover:bg-black/80 text-white/60 hover:text-white/90 transition-colors",onClick:T,title:"Random visualizer",children:r.jsxDEV(Ze,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:319,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:314,columnNumber:11},void 0),r.jsxDEV("button",{className:"p-0.5 rounded transition-colors "+(N?"bg-green-500/40 text-green-300 hover:bg-green-500/60":"bg-black/50 hover:bg-black/80 text-white/60 hover:text-white/90"),onClick:J,title:N?"Stop slideshow":"Random slideshow (15s)",children:N?r.jsxDEV(qe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:330,columnNumber:32},void 0):r.jsxDEV(He,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:330,columnNumber:54},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:321,columnNumber:11},void 0),r.jsxDEV("button",{className:"p-0.5 rounded bg-black/50 hover:bg-black/80 text-white/60 hover:text-white/90 transition-colors",onClick:F,title:p?"Exit fullscreen":"Fullscreen",children:p?r.jsxDEV(et,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:337,columnNumber:29},void 0):r.jsxDEV(tt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:337,columnNumber:55},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:332,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:299,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVisualizer.tsx",lineNumber:249,columnNumber:5},void 0)},nr={waveform:new Float32Array(256),fft:new Float32Array(1024),rms:0,peak:0,bassEnergy:0,midEnergy:0,highEnergy:0};function ir(e){return new Worker("/assets/dj-turntable.worker-nfc2FWTA.js",{name:e?.name})}const ar=96;function cr(e){const t=getComputedStyle(e);return{bg:t.getPropertyValue("--color-bg").trim()||"#0b0909",bgSecondary:t.getPropertyValue("--color-bg-secondary").trim()||"#131010",bgTertiary:t.getPropertyValue("--color-bg-tertiary").trim()||"#1d1818",border:t.getPropertyValue("--color-border").trim()||"#2f2525",borderLight:t.getPropertyValue("--color-border-light").trim()||"#403535"}}const lr=({deckId:n})=>{const i=Z.useRef(null),a=Z.useRef(null),c=Z.useRef(null),l=Z.useRef(1),d=Z.useRef(null),m=Z.useRef(0),u=Z.useRef(0),b=Z.useRef(1),[p,x]=Z.useState(!1),f=Z.useRef(!1);Z.useEffect(()=>{const t=a.current;if(!t||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const r=document.createElement("canvas");r.style.cssText="display:block;width:96px;height:96px;border-radius:4px;touch-action:none;",t.appendChild(r),i.current=r;const l=e.getState().decks[n],d=window.devicePixelRatio||1,m=cr(t),u=r.transferControlToOffscreen(),b=new o(ir,{onReady:()=>{}});c.current=b,b.post({type:"init",canvas:u,dpr:d,width:ar,height:ar,colors:m,deckId:n,isPlaying:l.isPlaying,effectiveBPM:l.effectiveBPM},[u]);const p=e.subscribe(e=>({isPlaying:e.decks[n].isPlaying,effectiveBPM:e.decks[n].effectiveBPM}),({isPlaying:e,effectiveBPM:t})=>{c.current?.post({type:"playback",isPlaying:e,effectiveBPM:t})},{equalityFn:(e,t)=>e.isPlaying===t.isPlaying&&e.effectiveBPM===t.effectiveBPM}),x=e.subscribe(e=>({scratchVelocity:e.decks[n].scratchVelocity,activePatternName:e.decks[n].activePatternName}),({scratchVelocity:e,activePatternName:t})=>{t&&!f.current?(c.current?.post({type:"velocity",v:e}),c.current?.post({type:"scratchActive",active:!0})):t||f.current||(c.current?.post({type:"velocity",v:1}),c.current?.post({type:"scratchActive",active:!1}))},{equalityFn:(e,t)=>e.scratchVelocity===t.scratchVelocity&&e.activePatternName===t.activePatternName}),v=s.subscribe(()=>{a.current&&c.current?.post({type:"colors",colors:cr(a.current)})});return()=>{p(),x(),v(),b.dispose(),c.current=null,r.remove(),i.current=null}},[n]);const v=Z.useCallback(e=>{m.current&&cancelAnimationFrame(m.current),u.current=performance.now(),b.current=e;const t=()=>{const e=Math.min(1,(performance.now()-u.current)/500),r=1-Math.pow(1-e,3),o=b.current+(1-b.current)*r;l.current=o,c.current?.post({type:"velocity",v:o}),e<1?m.current=requestAnimationFrame(t):(l.current=1,m.current=0)};m.current=requestAnimationFrame(t)},[]),N=Z.useCallback(r=>{r.preventDefault(),r.currentTarget.setPointerCapture(r.pointerId),m.current&&(cancelAnimationFrame(m.current),m.current=0),d.current={x:r.clientX,y:r.clientY},l.current=1,f.current=!0,x(!0),e.getState().setDeckScratchActive(n,!0),c.current?.post({type:"scratchActive",active:!0});try{t().getDeck(n).startScratch()}catch{}},[n]),D=Z.useCallback(e=>{if(!d.current)return;const r=a.current;if(!r)return;const o=r.getBoundingClientRect(),s=o.left+48,i=o.top+48,m=e.clientX-s,u=e.clientY-i,b=Math.sqrt(m*m+u*u);if(b>4){const r=e.clientX-d.current.x,o=(m*(e.clientY-d.current.y)-u*r)/b,s=Math.max(-4,Math.min(4,1+.06*o));l.current=s,c.current?.post({type:"velocity",v:s});try{t().getDeck(n).setScratchVelocity(s)}catch{}}d.current={x:e.clientX,y:e.clientY}},[n]),h=Z.useCallback(r=>{r.currentTarget.releasePointerCapture(r.pointerId),d.current=null;const o=l.current;f.current=!1,x(!1),e.getState().setDeckScratchActive(n,!1),c.current?.post({type:"scratchActive",active:!1}),v(o);try{t().getDeck(n).stopScratch(200)}catch{}},[n,v]);return Z.useEffect(()=>()=>{m.current&&cancelAnimationFrame(m.current)},[]),r.jsxDEV("div",{ref:a,className:"flex-shrink-0 rounded",style:{width:ar,height:ar,cursor:p?"grabbing":"grab",touchAction:"none"},onPointerDown:N,onPointerMove:D,onPointerUp:h},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckTurntable.tsx",lineNumber:208,columnNumber:5},void 0)},dr={A:"#60a5fa",B:"#f87171",C:"#34d399"},mr={A:"#1e2a3f",B:"#3f1e2a",C:"#1e3f2a"},ur=({deckId:o,size:s=250})=>{const n=Z.useRef(null),i=Z.useRef(new p),a=Z.useRef(null),c=Z.useRef(0),l=Z.useRef(0),d=Z.useRef(!1),m=Z.useRef(null),u=Z.useRef(0),[b,f]=Z.useState(!1),v=e(e=>e.decks[o].isPlaying),N=e(e=>e.decks[o].effectiveBPM),D=e(e=>e.decks[o].trackName),h=e(e=>e.decks[o].activePatternName),g=dr[o]??"#60a5fa",k=mr[o]??"#1e2a3f";Z.useEffect(()=>{const r=i.current;let s=1;const n=i=>{const m=c.current>0?(i-c.current)/1e3:0;c.current=i;const u=(N||120)/120*.5556;if(v||d.current){let n=1;if((d.current||r.spinbackActive||r.powerCutActive)&&(n=r.tick(m)),l.current+=u*n*2*Math.PI*m,d.current&&Math.abs(n-s)>.01){try{t().getDeck(o).setScratchVelocity(n)}catch{}s=n}if(d.current&&!r.touching&&!r.spinbackActive&&!r.powerCutActive&&Math.abs(n-1)<.02){d.current=!1,f(!1);try{t().getDeck(o).stopScratch(50)}catch{}e.getState().setDeckScratchActive(o,!1),s=1}}V(),a.current=requestAnimationFrame(n)};return a.current=requestAnimationFrame(n),()=>{null!==a.current&&cancelAnimationFrame(a.current)}},[o]);const E=Z.useRef({isPlaying:v,effectiveBPM:N});E.current={isPlaying:v,effectiveBPM:N};const V=Z.useCallback(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const r=window.devicePixelRatio||1,i=s,a=s,c=i/2,m=a/2,u=Math.min(c,m)-4,b=.32*u,p=l.current;t.setTransform(r,0,0,r,0,0);const x=e.parentElement,f=x?getComputedStyle(x):null,v=f?.getPropertyValue("--color-bg").trim()||"#0b0909",E=f?.getPropertyValue("--color-bg-secondary").trim()||"#131010",V=f?.getPropertyValue("--color-bg-tertiary").trim()||"#1d1818",j=f?.getPropertyValue("--color-border").trim()||"#2f2525",C=f?.getPropertyValue("--color-border-light").trim()||"#403535";t.clearRect(0,0,i,a),t.beginPath(),t.arc(c,m,u,0,2*Math.PI),t.fillStyle=E,t.fill(),t.strokeStyle=j,t.lineWidth=1.5,t.stroke(),t.beginPath(),t.arc(c,m,u-4,0,2*Math.PI),t.fillStyle=v,t.fill();const y=b+6,B=u-8;t.lineWidth=.5;for(let o=0;o<28;o++){const e=y+o/27*(B-y);t.beginPath(),t.arc(c,m,e,0,2*Math.PI),t.strokeStyle=V,t.globalAlpha=.2+.12*Math.sin(1.5*o+.3*p),t.stroke()}t.globalAlpha=1,t.beginPath(),t.moveTo(c+Math.cos(p)*(b+2),m+Math.sin(p)*(b+2)),t.lineTo(c+Math.cos(p)*(u-6),m+Math.sin(p)*(u-6)),t.strokeStyle=g,t.lineWidth=2,t.stroke(),t.beginPath(),t.arc(c,m,b,0,2*Math.PI),t.fillStyle=k,t.fill(),t.strokeStyle=j,t.lineWidth=.5,t.stroke();const w=D||`Deck ${o}`;t.save(),t.translate(c,m),t.rotate(p),t.font=`bold ${Math.round(.28*b)}px monospace`,t.fillStyle=g,t.textAlign="center",t.textBaseline="middle";const L=Math.floor(2*b/(.17*b)),O=w.length>L?w.slice(0,L-1)+"â€¦":w;t.fillText(O,0,.18*-b),t.font=`${Math.round(.22*b)}px monospace`,t.fillStyle=C;const M=N?`${N.toFixed(1)} BPM`:"";t.fillText(M,0,.22*b),t.restore(),d.current&&(t.font=`bold ${Math.round(.35*b)}px monospace`,t.fillStyle=g,t.globalAlpha=.5,t.textAlign="center",t.textBaseline="middle",t.fillText("SCR",c,m+b+14),t.globalAlpha=1),h&&(t.font="bold 10px monospace",t.fillStyle=g,t.globalAlpha=.6,t.textAlign="center",t.textBaseline="bottom",t.fillText(h,c,a-4),t.globalAlpha=1),t.beginPath(),t.arc(c,m,3,0,2*Math.PI),t.fillStyle=C,t.fill()},[s,g,k,o,D,N,h]);Z.useEffect(()=>{const e=n.current;if(!e)return;const t=window.devicePixelRatio||1;e.width=Math.round(s*t),e.height=Math.round(s*t),e.style.width=`${s}px`,e.style.height=`${s}px`},[s]);const j=Z.useCallback(()=>{if(!d.current){d.current=!0,f(!0),e.getState().setDeckScratchActive(o,!0);try{t().getDeck(o).startScratch()}catch{}}},[o]),C=Z.useCallback(e=>{e.preventDefault(),e.currentTarget.setPointerCapture(e.pointerId),E.current.isPlaying&&(j(),m.current={x:e.clientX,y:e.clientY},u.current=performance.now(),i.current.setTouching(!0),i.current.setHandVelocity(0))},[j]),y=Z.useCallback(e=>{if(!m.current)return;const t=n.current;if(!t)return;const r=t.getBoundingClientRect(),o=r.left+s/2,a=r.top+s/2,c=e.clientX-o,l=e.clientY-a,d=Math.sqrt(c*c+l*l);if(d>4){const t=e.clientX-m.current.x,r=(c*(e.clientY-m.current.y)-l*t)/d,o=performance.now(),n=Math.max(.001,(o-u.current)/1e3);u.current=o;const a=r/n/(.8*s)*x;i.current.setHandVelocity(a)}m.current={x:e.clientX,y:e.clientY}},[s]),B=Z.useCallback(e=>{e.currentTarget.releasePointerCapture(e.pointerId),m.current=null,i.current.setTouching(!1)},[]);return Z.useEffect(()=>{const e=n.current;if(!e)return;const t=e=>{if(!E.current.isPlaying)return;e.preventDefault(),d.current||j();const t=p.deltaToImpulse(e.deltaY,e.deltaMode);i.current.applyImpulse(t)};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[j]),r.jsxDEV("div",{className:"flex flex-col items-center gap-1",children:r.jsxDEV("canvas",{ref:n,className:"rounded-lg",style:{width:s,height:s,cursor:b?"grabbing":"grab",touchAction:"none"},onPointerDown:C,onPointerMove:y,onPointerUp:B,onPointerCancel:B},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVinylView.tsx",lineNumber:349,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckVinylView.tsx",lineNumber:348,columnNumber:5},void 0)},br=[1,2,4,8,16,32],pr=({deckId:o})=>{const s=e(e=>e.decks[o].loopActive),n=e(e=>e.decks[o].lineLoopSize),i=e(e=>e.decks[o].slipEnabled),a=e(e=>e.decks[o].playbackMode),c=e(e=>e.decks[o].audioLoopIn),l=e(e=>e.decks[o].audioLoopOut),d=e(e=>e.setDeckLoop),m=e(e=>e.setDeckLoopSize),u=e(e=>e.setDeckSlip),b=Z.useCallback(()=>{const e=t().getDeck(o);"audio"===a?s?(e.clearAudioLoop(),d(o,"off",!1)):null!==c&&null!==l&&(e.setAudioLoop(c,l),d(o,"line",!0)):s?(e.clearLineLoop(),d(o,"off",!1)):(e.setLineLoop(n),d(o,"line",!0))},[o,s,n,d,a,c,l]),p=Z.useCallback(e=>{m(o,e);t().getDeck(o).setLineLoop(e),s||d(o,"line",!0)},[o,s,m,d]),x=Z.useCallback(()=>{try{const r=t().getDeck(o),s=r.audioPlayer.getPosition(),n=e.getState();n.setAudioLoopIn(o,s);const i=n.decks[o].audioLoopOut;null!==i&&i>s&&(r.setAudioLoop(s,i),n.setDeckLoop(o,"line",!0))}catch{}},[o]),f=Z.useCallback(()=>{try{const r=t().getDeck(o),s=r.audioPlayer.getPosition(),n=e.getState();n.setAudioLoopOut(o,s);const i=n.decks[o].audioLoopIn;null!==i&&s>i&&(r.setAudioLoop(i,s),n.setDeckLoop(o,"line",!0))}catch{}},[o]),v=Z.useCallback(()=>{try{const r=t();r.getDeck(o).clearAudioLoop(),e.getState().setAudioLoopIn(o,null),e.getState().setAudioLoopOut(o,null),e.getState().setDeckLoop(o,"off",!1)}catch{}},[o]),N=Z.useCallback(()=>{const e=t().getDeck(o),r=!i;e.setSlipEnabled(r),u(o,r)},[o,i,u]),D="audio"===a,h=null!==c&&null!==l;return r.jsxDEV("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsxDEV("button",{onClick:b,className:`\n          relative flex items-center justify-center font-mono text-xs font-bold\n          rounded-sm transition-all duration-100 select-none border border-dark-border\n          active:translate-y-[0.5px]\n          ${s?"bg-cyan-600 text-white":"bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover"}\n        `,style:{width:40,height:40},title:s?"Disable loop":D?h?"Enable loop":"Set IN/OUT first":"Enable loop",children:[r.jsxDEV("div",{className:"absolute top-1 right-1 w-1.5 h-1.5 rounded-full "+(s?"bg-cyan-300":"bg-dark-border")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:146,columnNumber:9},void 0),"LOOP"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:131,columnNumber:7},void 0),D?r.jsxDEV("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[r.jsxDEV("button",{onClick:x,className:`\n              flex-1 flex items-center justify-center font-mono font-bold\n              transition-all duration-75 select-none rounded-l-sm\n              ${null!==c?"bg-cyan-700/60 text-cyan-200":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-text-secondary"}\n            `,style:{height:40,fontSize:10,minWidth:36},title:null!==c?`Loop IN: ${xr(c)}`:"Set loop IN at current position",children:"IN"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:157,columnNumber:11},void 0),r.jsxDEV("button",{onClick:f,className:`\n              flex-1 flex items-center justify-center font-mono font-bold\n              transition-all duration-75 select-none\n              ${null!==l?"bg-cyan-700/60 text-cyan-200":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-text-secondary"}\n            `,style:{height:40,fontSize:10,minWidth:36},title:null!==l?`Loop OUT: ${xr(l)}`:"Set loop OUT at current position",children:"OUT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:172,columnNumber:11},void 0),[1,2,4,8].map(n=>r.jsxDEV("button",{onClick:()=>{try{const r=t().getDeck(o),s=e.getState().decks[o],i=60/(s.beatGrid?.bpm||s.detectedBPM||s.effectiveBPM||120),a=r.audioPlayer.getPosition(),c=a,l=a+4*n*i;e.getState().setAudioLoopIn(o,c),e.getState().setAudioLoopOut(o,l),r.setAudioLoop(c,l),e.getState().setDeckLoop(o,"line",!0)}catch{}},className:`\n                flex items-center justify-center font-mono font-bold\n                transition-all duration-75 select-none\n                ${s&&h?"bg-cyan-700/40 text-cyan-300":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover"}\n              `,style:{height:40,width:28,fontSize:9},title:`Auto-loop ${n} bar${n>1?"s":""}`,children:n},n,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:189,columnNumber:13},void 0)),r.jsxDEV("button",{onClick:v,className:"flex items-center justify-center font-mono font-bold rounded-r-sm\n              transition-all duration-75 select-none bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-red-400",style:{height:40,width:28,fontSize:8},title:"Clear loop",children:"CLR"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:220,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:156,columnNumber:9},void 0):r.jsxDEV("div",{className:"flex items-center gap-px flex-1 min-w-0",children:br.map(e=>{const t=n===e&&s,o=n===e;return r.jsxDEV("button",{onClick:()=>p(e),className:`\n                  flex-1 flex items-center justify-center font-mono font-bold\n                  transition-all duration-75 select-none\n                  ${t?"bg-cyan-700/80 text-cyan-100":o?"bg-dark-borderLight text-text-primary":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover hover:text-text-secondary"}\n                  ${e===br[0]?"rounded-l-sm":""}\n                  ${e===br[br.length-1]?"rounded-r-sm":""}\n                `,style:{height:40,fontSize:e>=10?9:11,minWidth:24},title:`Loop ${e} rows`,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:237,columnNumber:15},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:232,columnNumber:9},void 0),r.jsxDEV("button",{onClick:N,className:`\n          relative flex items-center justify-center font-mono text-xs font-bold\n          rounded-sm transition-all duration-100 select-none border border-dark-border\n          active:translate-y-[0.5px]\n          ${i?"bg-amber-600 text-white":"bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover"}\n        `,style:{width:40,height:40},title:i?"Disable slip mode":"Enable slip mode",children:[r.jsxDEV("div",{className:"absolute top-1 right-1 w-1.5 h-1.5 rounded-full "+(i?"bg-amber-300":"bg-dark-border")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:279,columnNumber:9},void 0),"SLIP"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:264,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckLoopControls.tsx",lineNumber:129,columnNumber:5},void 0)};function xr(e){const t=Math.floor(e/60),r=Math.floor(e%60),o=Math.floor(e%1*100);return`${t}:${String(r).padStart(2,"0")}.${String(o).padStart(2,"0")}`}const fr=[{id:"hpf-sweep",label:"HPF",sublabel:"â–²",color:"violet",activeColor:"violet",mode:"momentary"},{id:"lpf-sweep",label:"LPF",sublabel:"â–¼",color:"blue",activeColor:"blue",mode:"momentary"},{id:"filter-reset",label:"FLT",sublabel:"RST",color:"gray",activeColor:"green",mode:"momentary"},{id:"echo-out",label:"ECHO",sublabel:"OUT",color:"amber",activeColor:"red",mode:"momentary"},{id:"kill-low",label:"KILL",sublabel:"LO",color:"orange",activeColor:"red",mode:"toggle"},{id:"kill-mid",label:"KILL",sublabel:"MID",color:"gray",activeColor:"red",mode:"toggle"},{id:"kill-hi",label:"KILL",sublabel:"HI",color:"cyan",activeColor:"red",mode:"toggle"},{id:"brake",label:"BRK",sublabel:"âŽ",color:"rose",activeColor:"rose",mode:"momentary"}],vr=[{id:"jump-back-16",label:"â—„â—„",sublabel:"16",color:"indigo",activeColor:"indigo",mode:"instant"},{id:"jump-back-4",label:"â—„â—„",sublabel:"4",color:"blue",activeColor:"blue",mode:"instant"},{id:"jump-back-1",label:"â—„",sublabel:"1",color:"sky",activeColor:"sky",mode:"instant"},{id:"jump-back-half",label:"â—„",sublabel:"Â½",color:"teal",activeColor:"teal",mode:"instant"},{id:"jump-fwd-half",label:"â–º",sublabel:"Â½",color:"teal",activeColor:"teal",mode:"instant"},{id:"jump-fwd-1",label:"â–º",sublabel:"1",color:"sky",activeColor:"sky",mode:"instant"},{id:"jump-fwd-4",label:"â–ºâ–º",sublabel:"4",color:"blue",activeColor:"blue",mode:"instant"},{id:"jump-fwd-16",label:"â–ºâ–º",sublabel:"16",color:"indigo",activeColor:"indigo",mode:"instant"}],Nr={"kill-low":"low","kill-mid":"mid","kill-hi":"high"},Dr={"jump-back-16":-16,"jump-back-4":-4,"jump-back-1":-1,"jump-back-half":-.5,"jump-fwd-half":.5,"jump-fwd-1":1,"jump-fwd-4":4,"jump-fwd-16":16},hr=({deckId:o})=>{const[s,n]=Z.useState("fx"),[i,a]=Z.useState(new Set),c=Z.useRef(new Map),l=e(e=>e.decks[o].eqLowKill),d=e(e=>e.decks[o].eqMidKill),m=e(e=>e.decks[o].eqHighKill),u=e(e=>!!e.decks[o].beatGrid),b={"kill-low":l,"kill-mid":d,"kill-hi":m},p=Z.useCallback(e=>{const t=c.current.get(e);t&&(t(),c.current.delete(e)),a(t=>{const r=new Set(t);return r.delete(e),r})},[]),x=Z.useCallback(r=>{let s;switch(p(r),a(e=>new Set(e).add(r)),r){case"hpf-sweep":s=De(o,-.85,4,()=>p(r));break;case"lpf-sweep":s=De(o,.85,4,()=>p(r));break;case"filter-reset":s=Ne(o),setTimeout(()=>p(r),150);break;case"echo-out":s=ve(o,8,()=>p(r));break;case"kill-low":case"kill-mid":case"kill-hi":{const t=Nr[r],n=`eq${t.charAt(0).toUpperCase()+t.slice(1)}Kill`,i=!e.getState().decks[o][n];e.getState().setDeckEQKill(o,t,i),"off"!==le()?s=xe(o,t,i):fe(o,t,i),i||p(r);break}case"brake":try{const n=t().getDeck(o),i=e.getState().decks[o],a=120/(i.beatGrid?.bpm||i.detectedBPM||i.effectiveBPM||120)*1e3;let c=0;const l=performance.now(),d=()=>{const t=performance.now()-l,s=Math.min(1,t/a),i=1-s*s;e.getState().setDeckPitch(o,12*Math.log2(Math.max(.01,i))),s<1?c=requestAnimationFrame(d):(n.pause(),e.getState().setDeckPlaying(o,!1),e.getState().setDeckPitch(o,0),p(r))};c=requestAnimationFrame(d),s=()=>{cancelAnimationFrame(c),e.getState().setDeckPitch(o,0)}}catch{p(r)}}s&&c.current.set(r,s)},[o,p]),f=Z.useCallback(e=>{if("instant"===e.mode){const t=Dr[e.id];void 0!==t&&he(o,t),a(t=>new Set(t).add(e.id)),setTimeout(()=>a(t=>{const r=new Set(t);return r.delete(e.id),r}),120)}else x(e.id)},[o,x]),v=Z.useCallback(e=>{"momentary"===e.mode&&("hpf-sweep"!==e.id&&"lpf-sweep"!==e.id||(p(e.id),Ne(o)))},[o,p]),N="fx"===s?fr:vr;return r.jsxDEV("div",{className:"flex flex-col gap-1",children:[r.jsxDEV("div",{className:"flex items-center gap-1",children:[r.jsxDEV("button",{onClick:()=>n("fx"),className:"px-2 py-0.5 rounded text-[8px] font-bold transition-colors "+("fx"===s?"bg-violet-600/30 text-violet-300 border border-violet-500/40":"bg-dark-bgTertiary text-text-muted border border-dark-border hover:text-text-secondary"),children:"FX PADS"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:220,columnNumber:9},void 0),r.jsxDEV("button",{onClick:()=>n("jump"),className:"px-2 py-0.5 rounded text-[8px] font-bold transition-colors "+("jump"===s?"bg-sky-600/30 text-sky-300 border border-sky-500/40":"bg-dark-bgTertiary text-text-muted border border-dark-border hover:text-text-secondary"),children:"BEAT JUMP"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:230,columnNumber:9},void 0),"jump"===s&&u&&r.jsxDEV("span",{className:"text-[7px] text-green-400 ml-auto",children:"â— GRID"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:241,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:219,columnNumber:7},void 0),r.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:N.map(e=>{const t=(o=e.id)in b?b[o]:i.has(o);var o;return r.jsxDEV("button",{onPointerDown:()=>f(e),onPointerUp:()=>v(e),onPointerLeave:()=>"momentary"===e.mode&&v(e),className:`\n                flex flex-col items-center justify-center\n                h-9 rounded-md text-[8px] font-bold leading-tight\n                select-none touch-none\n                transition-all duration-75\n                active:scale-95\n                ${t?`bg-${e.activeColor}-600/40 text-${e.activeColor}-200 border border-${e.activeColor}-500/50`:"bg-dark-bgTertiary text-text-muted border border-dark-border hover:bg-dark-bgHover hover:text-text-secondary"}\n              `,title:`${e.label} ${e.sublabel??""} (${e.mode})`,children:[r.jsxDEV("span",{children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:269,columnNumber:15},void 0),e.sublabel&&r.jsxDEV("span",{className:"text-[7px] opacity-60",children:e.sublabel},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:270,columnNumber:32},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:250,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:246,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckFXPads.tsx",lineNumber:217,columnNumber:5},void 0)};function gr(e){return new Worker("/assets/dj-waveform.worker-CHPamN7W.js",{name:e?.name})}const kr=({deckId:s})=>{const n=Z.useRef(null),i=Z.useRef(null),a=Z.useRef(null);Z.useEffect(()=>{const t=i.current;if(!t||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const r=document.createElement("canvas");r.className="block w-full h-full",t.appendChild(r),n.current=r;const c=Math.min(window.devicePixelRatio,2),l=Math.max(1,t.clientWidth),d=Math.max(1,t.clientHeight),m=e.getState().decks[s],u=r.transferControlToOffscreen(),b=new o(gr,{onReady:()=>{}});a.current=b,b.post({type:"init",canvas:u,dpr:c,width:l,height:d,waveformPeaks:m.waveformPeaks?Array.from(m.waveformPeaks):null,durationMs:m.durationMs,audioPosition:m.audioPosition,cuePoints:m.seratoCuePoints},[u]);const p=e.subscribe(e=>e.decks[s].audioPosition,e=>a.current?.post({type:"position",audioPosition:e})),x=e.subscribe(e=>e.decks[s].waveformPeaks,t=>a.current?.post({type:"waveformPeaks",peaks:t?Array.from(t):null,durationMs:e.getState().decks[s].durationMs})),f=e.subscribe(e=>e.decks[s].seratoCuePoints,e=>a.current?.post({type:"cuePoints",cuePoints:e})),v=new ResizeObserver(e=>{const t=e[0];if(!t)return;const r=Math.floor(t.contentRect.width),o=Math.floor(t.contentRect.height);r>0&&o>0&&a.current?.post({type:"resize",w:r,h:o,dpr:Math.min(window.devicePixelRatio,2)})});return v.observe(t),()=>{p(),x(),f(),v.disconnect(),b.dispose(),a.current=null,r.remove(),n.current=null}},[s]);const c=e(e=>e.decks[s].waveformPeaks),l=Z.useCallback(r=>{const o=i.current;if(!o)return;const n=o.getBoundingClientRect(),a=(r.clientX-n.left)/n.width,c=e.getState().decks[s],l=Math.max(0,Math.min(c.audioPosition-5+10*a,c.durationMs/1e3-.01));try{t().getDeck(s).audioPlayer.seek(l),e.getState().setDeckState(s,{audioPosition:l,elapsedMs:1e3*l})}catch{}},[s]);return c&&0!==c.length?r.jsxDEV("div",{ref:i,className:"w-full h-16 shrink-0 bg-dark-bg border border-dark-border rounded-sm overflow-hidden cursor-pointer",onClick:l},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DeckAudioWaveform.tsx",lineNumber:128,columnNumber:5},void 0):null},Er=Z.lazy(()=>f(()=>import("./DeckVinyl3DView-yf6ukDtA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),Vr=({deckId:o})=>{const s=Z.useRef(0),[n,i]=Z.useState(!1),[a,c]=Z.useState(!1),[l,d]=Z.useState(0),m=Z.useRef(0),u=e(e=>e.deckViewMode),b=e(e=>e.decks[o].totalPositions>0);Z.useEffect(()=>{let r=!0;const n=()=>{if(r){try{const r=t().getDeck(o),s=e.getState();if("audio"===r.playbackMode){if(r.audioPlayer.isCurrentlyPlaying()){const e=r.audioPlayer.getPosition(),t={audioPosition:e,elapsedMs:1e3*e,durationMs:1e3*r.audioPlayer.getDuration()},n=r.getPositionAtTime(1e3*e);n&&(t.songPos=n.songPos,t.pattPos=n.pattPos),s.setDeckState(o,t)}!r.audioPlayer.isCurrentlyPlaying()&&s.decks[o].isPlaying&&s.setDeckPlaying(o,!1)}else{const e=r.replayer;if(e.isPlaying())if(s.setDeckPosition(o,e.getSongPos(),e.getPattPos()),r.isPatternActive()){const{velocity:e,faderGain:t}=r.getScratchState(),n=s.decks[o].scratchVelocity,i=s.decks[o].scratchFaderGain,a={};Math.abs(e-n)>.05&&(a.scratchVelocity=e),t!==i&&(a.scratchFaderGain=t),Object.keys(a).length>0&&s.setDeckState(o,a)}else{const t=Math.round(e.getBPM()*e.getTempoMultiplier()*100)/100;s.setDeckState(o,{elapsedMs:e.getElapsedMs(),effectiveBPM:t});try{r.notifyBPMChange(t)}catch{}const n=s.decks[o].faderLFODivision;if(s.decks[o].faderLFOActive&&n){const r=6e4/t*({"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125}[n]??1),i=e.getElapsedMs(),a=i%r<.5*r?1:0;a!==s.decks[o].scratchFaderGain&&s.setDeckState(o,{scratchFaderGain:a})}else 0===s.decks[o].scratchVelocity&&1===s.decks[o].scratchFaderGain||s.setDeckState(o,{scratchVelocity:0,scratchFaderGain:1})}r.isPatternActive()||null===s.decks[o].activePatternName||s.setDeckPattern(o,null)}}catch{}s.current=requestAnimationFrame(n)}};return s.current=requestAnimationFrame(n),()=>{r=!1,cancelAnimationFrame(s.current)}},[o]),Z.useEffect(()=>{let r=e.getState().decks[o].pitchOffset;return e.subscribe(e=>{const s=e.decks[o].pitchOffset;if(s!==r){r=s;try{t().getDeck(o).setPitch(s)}catch{}}})},[o]),Z.useEffect(()=>{let r=e.getState().decks[o].channelMask;return e.subscribe(e=>{const s=e.decks[o].channelMask;if(s!==r){r=s;try{t().getDeck(o).replayer.setChannelMuteMask(s)}catch{}}})},[o]),Z.useEffect(()=>{try{const r=t().getDeck(o);r.replayer.onRowChange=(e,t,r)=>{},r.replayer.onSongEnd=()=>{e.getState().setDeckPlaying(o,!1)}}catch{}},[o]);const p=Z.useCallback(e=>{e.preventDefault(),e.stopPropagation(),m.current++,e.dataTransfer.items&&Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&i(!0)},[]),x=Z.useCallback(e=>{e.preventDefault(),e.stopPropagation(),m.current--,0===m.current&&i(!1)},[]),v=Z.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),N=Z.useCallback(async r=>{r.preventDefault(),r.stopPropagation(),i(!1),m.current=0;const s=Array.from(r.dataTransfer.files)[0];if(s){d(e=>e+1),c(!0);try{const r=t();if(ze(s.name)){const t=await s.arrayBuffer(),n=await r.loadAudioToDeck(o,t,s.name);e.getState().setDeckViewMode("vinyl");let i=0,a=[],c=[],l=[],d=null;try{const{readSeratoMetadata:e}=await f(async()=>{const{readSeratoMetadata:e}=await import("./seratoMetadata-BC7XPZHT.js");return{readSeratoMetadata:e}},[]),r=e(t);i=r.bpm??0,a=r.cuePoints,c=r.loops,l=r.beatGrid,d=r.key}catch{}e.getState().setDeckState(o,{fileName:s.name,trackName:s.name.replace(/\.[^.]+$/,""),detectedBPM:i,effectiveBPM:i,totalPositions:0,songPos:0,pattPos:0,elapsedMs:0,isPlaying:!1,playbackMode:"audio",durationMs:1e3*n.duration,audioPosition:0,waveformPeaks:n.waveformPeaks,seratoCuePoints:a,seratoLoops:c,seratoBeatGrid:l,seratoKey:d})}else{const t=await _e(s);ge(s.name,t);const i=ke(t),a=await s.arrayBuffer();e.getState().setDeckState(o,{fileName:s.name,trackName:t.name||s.name,detectedBPM:i.bpm,effectiveBPM:i.bpm,analysisState:"rendering",isPlaying:!1});try{const n=await Ee().loadOrEnqueue(a,s.name,o,"high");await r.loadAudioToDeck(o,n.wavData,s.name,t.name||s.name,n.analysis?.bpm||i.bpm,t),e.getState().setDeckViewMode("visualizer")}catch(n){}}}catch(n){}finally{c(!1)}}},[o]),D="B"===o,h="A"===o?"1":"B"===o?"2":"3",g="A"===o?"text-blue-400":"B"===o?"text-red-400":"text-emerald-400",k="A"===o?"border-blue-900/30":"B"===o?"border-red-900/30":"border-emerald-900/30",E="A"===o?"border-blue-500/60":"B"===o?"border-red-500/60":"border-emerald-500/60";return r.jsxDEV("div",{className:`relative flex flex-col gap-2 p-3 bg-dark-bg rounded-lg border min-w-0 h-full overflow-hidden transition-all ${n?E:k}`,onDragEnter:p,onDragLeave:x,onDragOver:v,onDrop:N,"data-dj-deck-drop":!0,children:[n&&r.jsxDEV("div",{className:"absolute inset-0 z-10 bg-black/70 rounded-lg flex items-center justify-center pointer-events-none",children:r.jsxDEV("div",{className:`text-lg font-mono font-bold ${g}`,children:["Drop to load Deck ",h]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:339,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:338,columnNumber:9},void 0),a&&r.jsxDEV("div",{className:"absolute inset-0 z-10 bg-black/70 rounded-lg flex items-center justify-center pointer-events-none",children:r.jsxDEV("div",{className:`text-sm font-mono ${g} animate-pulse`,children:"Loading..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:348,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:347,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex items-start gap-2",children:[r.jsxDEV("div",{className:"flex-1 min-w-0",children:[r.jsxDEV("div",{className:`text-xs font-mono font-bold tracking-[0.3em] uppercase ${g} opacity-60 mb-1`,children:["Deck ",h]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:355,columnNumber:11},void 0),r.jsxDEV(Qt,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:358,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:354,columnNumber:9},void 0),r.jsxDEV(Ve,{deckId:o,size:64},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:360,columnNumber:9},void 0),"visualizer"===u&&r.jsxDEV(lr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:361,columnNumber:43},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:353,columnNumber:7},void 0),r.jsxDEV("div",{className:"relative",children:[r.jsxDEV(tr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:366,columnNumber:9},void 0),r.jsxDEV(je,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:367,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:365,columnNumber:7},void 0),r.jsxDEV(kr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:371,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex gap-2 flex-1 min-h-0 "+(D?"flex-row-reverse":""),children:[r.jsxDEV("div",{className:"flex-1 min-w-0 min-h-0 flex items-center justify-center relative",children:["3d"===u?r.jsxDEV(Z.Suspense,{fallback:r.jsxDEV("div",{className:"flex items-center justify-center w-full h-full text-text-muted text-xs font-mono",children:"Loading 3D..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:379,columnNumber:15},void 0),children:r.jsxDEV(Er,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:383,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:378,columnNumber:13},void 0):"vinyl"===u?r.jsxDEV(ur,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:386,columnNumber:13},void 0):r.jsxDEV(sr,{deckId:o,resetKey:l},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:388,columnNumber:13},void 0),b&&"visualizer"!==u&&r.jsxDEV("div",{className:"absolute inset-0 pointer-events-none",style:{opacity:.55},children:r.jsxDEV(rr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:394,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:393,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:376,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex-shrink-0 self-stretch",children:r.jsxDEV(_t,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:401,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:400,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:374,columnNumber:7},void 0),r.jsxDEV(Ce,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:406,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV($t,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:410,columnNumber:9},void 0),r.jsxDEV(qt,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:411,columnNumber:9},void 0),r.jsxDEV(pr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:412,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:409,columnNumber:7},void 0),r.jsxDEV(hr,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:416,columnNumber:7},void 0),r.jsxDEV(ye,{deckId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:419,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJDeck.tsx",lineNumber:326,columnNumber:5},void 0)},jr=[{key:"high",label:"HI",color:"#00d4ff",killKey:"eqHighKill"},{key:"mid",label:"MID",color:"#cccccc",killKey:"eqMidKill"},{key:"low",label:"LO",color:"#ff8800",killKey:"eqLowKill"}],Cr=({deckId:o})=>{const s=e(e=>e.decks[o].eqHigh),n=e(e=>e.decks[o].eqMid),i=e(e=>e.decks[o].eqLow),a=e(e=>e.decks[o].eqHighKill),c=e(e=>e.decks[o].eqMidKill),l=e(e=>e.decks[o].eqLowKill),d={high:s,mid:n,low:i},m={high:a,mid:c,low:l},u=Z.useCallback((r,s)=>{e.getState().setDeckEQ(o,r,s),t().getDeck(o).setEQ(r,s)},[o]),b=Z.useCallback(r=>{const s=!e.getState().decks[o][`eq${r.charAt(0).toUpperCase()+r.slice(1)}Kill`];e.getState().setDeckEQKill(o,r,s),"off"!==le()?xe(o,r,s):t().getDeck(o).setEQKill(r,s)},[o]),p=Z.useCallback(e=>0===e?"0":`${e>0?"+":""}${e.toFixed(0)}`,[]),x="A"===o?"1":"2",f={high:"High frequencies (treble)",mid:"Mid frequencies",low:"Low frequencies (bass)"};return r.jsxDEV("div",{className:"flex flex-col items-center gap-0.5",title:`Deck ${x} EQ`,children:jr.map(({key:e,label:t,color:o})=>r.jsxDEV("div",{className:"flex items-center gap-0.5",children:[r.jsxDEV(v,{value:d[e],min:-24,max:6,onChange:t=>u(e,t),label:t,size:"sm",color:o,bipolar:!0,defaultValue:0,formatValue:p,title:`Deck ${x} EQ ${t} â€” ${f[e]} (-24 to +6 dB)`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerEQ.tsx",lineNumber:74,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>b(e),className:`\n              w-4 h-4 rounded-sm text-[7px] font-black leading-none\n              flex items-center justify-center\n              transition-all duration-75\n              ${m[e]?"bg-red-600 text-white shadow-[0_0_6px_rgba(220,38,38,0.5)]":"bg-dark-bgTertiary text-text-muted hover:bg-dark-bgHover border border-dark-border"}\n            `,title:`${m[e]?"Unmute":"Kill"} ${t} (${"off"!==le()?"quantized":"instant"})`,children:"K"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerEQ.tsx",lineNumber:87,columnNumber:11},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerEQ.tsx",lineNumber:73,columnNumber:9},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerEQ.tsx",lineNumber:71,columnNumber:5},void 0)},yr=({deckId:o})=>{const s=e(e=>e.decks[o].filterPosition),n=Z.useCallback(r=>{e.getState().setDeckFilter(o,r),t().getDeck(o).setFilterPosition(r),Be(o,r)},[o]),i=Z.useCallback(e=>Math.abs(e)<.01?"OFF":e<0?"HPF":"LPF",[]),a="A"===o?"1":"2";return r.jsxDEV("div",{className:"flex flex-col items-center",title:`Deck ${a} Filter`,children:r.jsxDEV(v,{value:s,min:-1,max:1,onChange:n,label:"FILTER",size:"sm",color:"#aa44ff",bipolar:!0,defaultValue:0,formatValue:i,title:`Deck ${a} Filter â€” left: high-pass, center: off, right: low-pass`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerFilter.tsx",lineNumber:39,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerFilter.tsx",lineNumber:38,columnNumber:5},void 0)};function Br(e){if(e<=-60)return 0;if(e>=0)return 20;const t=(e+60)/60;return Math.round(20*t)}const wr=({deckId:e})=>{const[o,s]=Z.useState(-1/0),[n,i]=Z.useState(-1),a=Z.useRef(0),c=Z.useRef(!0),l=Z.useRef(-1),d=Z.useRef(0);Z.useEffect(()=>{c.current=!0;let r=performance.now();const o=n=>{if(!c.current)return;const m=(n-r)/1e3;r=n;try{const r=t().getDeck(e).getLevel(),o="number"==typeof r?r:-1/0;s(o);const a=Br(o);a>=l.current?(l.current=a,d.current=n):n-d.current>1500&&(l.current=Math.max(a,l.current-12*m)),i(Math.round(l.current))}catch{}a.current=requestAnimationFrame(o)};return a.current=requestAnimationFrame(o),()=>{c.current=!1,cancelAnimationFrame(a.current)}},[e]);const m=Br(o),u="A"===e?"1":"2";return r.jsxDEV("div",{className:"flex flex-col-reverse gap-[1px] justify-center",style:{width:12},title:`Deck ${u} level meter`,children:Array.from({length:20},(e,t)=>{const o=t<m,s=!o&&t===n-1&&n>m,i=(a=t)>=17?"var(--color-error)":a>=12?"var(--color-warning)":"var(--color-success)";var a;return r.jsxDEV("div",{className:"rounded-[1px]",style:{width:12,height:5,backgroundColor:o||s?i:"var(--color-bg-tertiary)",opacity:s?.85:1,transition:o?"none":"background-color 0.05s"}},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVUMeter.tsx",lineNumber:101,columnNumber:11},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerVUMeter.tsx",lineNumber:90,columnNumber:5},void 0)};function Lr(e){if(e<=0)return"-âˆž";const t=20*Math.log10(e);return t>=-.5?"0dB":t<-60?"-âˆždB":`${t.toFixed(0)}dB`}const Or=({deckId:o})=>{const s=e(e=>e.decks[o].volume),n=e(e=>e.decks[o].trimGain),i=e(e=>e.decks[o].scratchFaderGain),a=e(e=>e.decks[o].activePatternName),c=e(e=>e.decks[o].faderLFOActive),[l,d]=Z.useState(!1),m=Z.useRef(null);Z.useEffect(()=>{try{t().getDeck(o).setTrimGain(n)}catch{}},[o,n]);const u=Z.useCallback(r=>{const s=Math.max(0,Math.min(1,r));e.getState().setDeckVolume(o,s);try{t().getDeck(o).setVolume(s)}catch{}},[o]),b=Z.useCallback(e=>{const t=m.current;if(!t)return s;const r=t.getBoundingClientRect(),o=e-r.top;return 1-Math.max(0,Math.min(1,o/r.height))},[s]),p=Z.useCallback(e=>{e.preventDefault(),d(!0),e.target.setPointerCapture(e.pointerId),u(b(e.clientY))},[b,u]),x=Z.useCallback(e=>{l&&u(b(e.clientY))},[l,b,u]),f=Z.useCallback(()=>{d(!1)},[]),v="A"===o?"1":"2",N="B"===o,D=88*(1-s),h=null!==a||c,g=h&&i<.5,k=N?"rgba(248, 113, 113, 0.6)":"rgba(96, 165, 250, 0.6)";return r.jsxDEV("div",{className:"flex flex-col items-center gap-1",title:`Deck ${v} channel fader`,children:[r.jsxDEV("div",{className:"text-text-muted text-[10px] font-mono tracking-wider",children:v},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:101,columnNumber:7},void 0),r.jsxDEV("div",{ref:m,className:"relative cursor-pointer select-none",style:{width:28,height:100},onPointerDown:p,onPointerMove:x,onPointerUp:f,onPointerCancel:f,children:[r.jsxDEV("div",{className:"absolute rounded-full "+(g?"border":"bg-dark-bgTertiary border border-dark-border"),style:{left:"50%",transform:"translateX(-50%)",width:6,top:0,bottom:0,...g?{backgroundColor:k,borderColor:k}:{}}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:116,columnNumber:9},void 0),h&&r.jsxDEV("div",{className:"absolute rounded-full",style:{left:"50%",transform:"translateX(-50%)",width:6,bottom:0,height:100*i+"%",backgroundColor:N?"rgba(248, 113, 113, 0.4)":"rgba(96, 165, 250, 0.4)",transition:"height 20ms linear"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:134,columnNumber:11},void 0),r.jsxDEV("div",{className:"absolute rounded-sm border "+(l?"bg-text-muted border-text-secondary":g?"border-dark-border":"bg-dark-borderLight border-dark-border hover:bg-text-muted"),style:{width:24,height:12,left:"50%",transform:"translateX(-50%)",top:D,transition:l?"none":"top 0.05s ease-out",backgroundColor:g?k:void 0}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:149,columnNumber:9},void 0),g&&r.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:r.jsxDEV("span",{className:"text-[8px] font-mono font-bold tracking-wider",style:{color:N?"#f87171":"#60a5fa"},children:"CUT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:173,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:170,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:106,columnNumber:7},void 0),r.jsxDEV("div",{className:"text-text-muted text-[9px] font-mono",children:Lr(s)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:184,columnNumber:7},void 0),0!==n&&r.jsxDEV("div",{className:"text-[8px] font-mono text-accent-info opacity-70",title:`Auto-gain trim: ${n>0?"+":""}${n.toFixed(1)}dB`,children:["AG ",n>0?"+":"",n.toFixed(0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:190,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerChannelStrip.tsx",lineNumber:99,columnNumber:5},void 0)},Mr=[{key:"linear",label:"Linear"},{key:"cut",label:"Cut"},{key:"smooth",label:"Smooth"}],Pr=()=>{const o=e(e=>e.crossfaderPosition),s=e(e=>e.crossfaderCurve),n=Z.useRef({position:o,curve:s});Z.useEffect(()=>{n.current={position:o,curve:s}},[o,s]);const i=Z.useCallback(r=>{const o=parseFloat(r.target.value);e.getState().setCrossfader(o);try{t().mixer.setCrossfader(o)}catch{}},[]),a=Z.useCallback(r=>{e.getState().setCrossfaderCurve(r);try{t().mixer.setCurve(r)}catch{}},[]);return r.jsxDEV("div",{className:"flex flex-col items-center gap-1 w-full px-2",title:"Crossfader",children:[r.jsxDEV("div",{className:"flex items-center gap-3 w-full",children:[r.jsxDEV("span",{className:"text-text-secondary text-xs font-mono font-bold",title:"Deck 1",children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:56,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex-1 relative",children:r.jsxDEV("input",{type:"range",min:0,max:1,step:.005,value:o,onChange:i,className:"crossfader-slider w-full",title:"Crossfader â€” blend between Deck 1 and Deck 2",style:{appearance:"none",WebkitAppearance:"none",height:24,background:"transparent",cursor:"pointer"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:59,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:58,columnNumber:9},void 0),r.jsxDEV("span",{className:"text-text-secondary text-xs font-mono font-bold",title:"Deck 2",children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:78,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:55,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex gap-1",children:Mr.map(({key:e,label:t})=>r.jsxDEV("button",{onClick:()=>a(e),className:`\n                px-2 py-0.5 text-[10px] font-mono rounded transition-colors\n                ${s===e?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-muted hover:text-text-secondary border border-dark-borderLight"}\n              `,title:{linear:"Linear â€” equal crossfade, smooth blend",cut:"Cut â€” hard switch, no blending",smooth:"Smooth â€” constant-power crossfade"}[e],children:t},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:90,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:82,columnNumber:7},void 0),r.jsxDEV("style",{children:"\n        .crossfader-slider::-webkit-slider-runnable-track {\n          height: 6px;\n          background: var(--color-bg-tertiary);\n          border-radius: 3px;\n          border: 1px solid var(--color-border);\n        }\n        .crossfader-slider::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          width: 32px;\n          height: 18px;\n          background: var(--color-border-light);\n          border: 1px solid var(--color-border);\n          border-radius: 3px;\n          cursor: grab;\n          margin-top: -7px;\n        }\n        .crossfader-slider::-webkit-slider-thumb:active {\n          cursor: grabbing;\n          background: var(--color-text-muted);\n        }\n        .crossfader-slider::-moz-range-track {\n          height: 6px;\n          background: var(--color-bg-tertiary);\n          border-radius: 3px;\n          border: 1px solid var(--color-border);\n        }\n        .crossfader-slider::-moz-range-thumb {\n          width: 32px;\n          height: 18px;\n          background: var(--color-border-light);\n          border: 1px solid var(--color-border);\n          border-radius: 3px;\n          cursor: grab;\n        }\n      "},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:110,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCrossfader.tsx",lineNumber:53,columnNumber:5},void 0)},Ur=()=>{const[e,o]=Z.useState(!1),[s,n]=Z.useState(null),i=Z.useRef(null),a=Z.useCallback(()=>{i.current&&(i.current(),i.current=null),we(),o(!1),n(null)},[]),c=Z.useCallback((e,t)=>{a(),o(!0),n("A"===e?"Aâ†’B":"Bâ†’A"),i.current=Le(e,t,8,!0);const r=setTimeout(()=>{o(!1),n(null),i.current=null},3e4),s=i.current;i.current=()=>{clearTimeout(r),s()}},[a]),l=Z.useCallback(e=>{a();const r="A"===e?0:1;if("off"!==le()){const s="A"===e?"B":"A";o(!0),n("A"===e?"Bâ†’A":"Aâ†’B"),i.current=Oe(s,()=>{try{t().setCrossfader(r)}catch{}o(!1),n(null),i.current=null})}else try{t().setCrossfader(r)}catch{}},[a]);return r.jsxDEV("div",{className:"flex items-center justify-center gap-1.5 w-full",children:[r.jsxDEV("button",{onClick:()=>c("A","B"),disabled:e&&"Aâ†’B"!==s,className:`\n          flex items-center gap-1 px-2 h-7 rounded text-[9px] font-bold\n          transition-all duration-100\n          ${e&&"Aâ†’B"===s?"bg-cyan-600/40 text-cyan-200 border border-cyan-500/50 animate-pulse":"bg-dark-bgTertiary text-text-muted border border-dark-border hover:bg-dark-bgHover hover:text-text-secondary"}\n          disabled:opacity-30\n        `,title:"Auto-transition Aâ†’B (8 bars, with filter sweep)",children:[r.jsxDEV(rt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:102,columnNumber:9},void 0),r.jsxDEV("span",{children:"Aâ†’B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:103,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:87,columnNumber:7},void 0),r.jsxDEV("button",{onClick:()=>l("A"),className:"flex items-center gap-0.5 px-1.5 h-7 rounded text-[9px] font-bold\n          bg-dark-bgTertiary text-text-muted border border-dark-border\n          hover:bg-amber-600/20 hover:text-amber-300 transition-all duration-100",title:"Quick cut to A (on downbeat if quantized)",children:[r.jsxDEV(ot,{size:8},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:114,columnNumber:9},void 0),"A"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:107,columnNumber:7},void 0),e?r.jsxDEV("button",{onClick:a,className:"flex items-center gap-0.5 px-1.5 h-7 rounded text-[9px] font-bold\n            bg-red-600/30 text-red-300 border border-red-500/40\n            hover:bg-red-600/50 transition-all duration-100",title:"Cancel automation",children:r.jsxDEV(st,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:126,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:119,columnNumber:9},void 0):r.jsxDEV("div",{className:"w-7"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:129,columnNumber:9},void 0),r.jsxDEV("button",{onClick:()=>l("B"),className:"flex items-center gap-0.5 px-1.5 h-7 rounded text-[9px] font-bold\n          bg-dark-bgTertiary text-text-muted border border-dark-border\n          hover:bg-amber-600/20 hover:text-amber-300 transition-all duration-100",title:"Quick cut to B (on downbeat if quantized)",children:["B",r.jsxDEV(ot,{size:8},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:140,columnNumber:10},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:133,columnNumber:7},void 0),r.jsxDEV("button",{onClick:()=>c("B","A"),disabled:e&&"Bâ†’A"!==s,className:`\n          flex items-center gap-1 px-2 h-7 rounded text-[9px] font-bold\n          transition-all duration-100\n          ${e&&"Bâ†’A"===s?"bg-cyan-600/40 text-cyan-200 border border-cyan-500/50 animate-pulse":"bg-dark-bgTertiary text-text-muted border border-dark-border hover:bg-dark-bgHover hover:text-text-secondary"}\n          disabled:opacity-30\n        `,title:"Auto-transition Bâ†’A (8 bars, with filter sweep)",children:[r.jsxDEV("span",{children:"Bâ†’A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:159,columnNumber:9},void 0),r.jsxDEV(rt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:160,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:144,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerTransition.tsx",lineNumber:85,columnNumber:5},void 0)};function Xr(e){if(e<=-60)return 0;if(e>=0)return 12;const t=(e+60)/60;return Math.round(12*t)}function Sr(e,t){return t?e>=10?"var(--color-error)":e>=7?"var(--color-warning)":"var(--color-success)":"var(--color-bg-tertiary)"}const Ar=()=>{const o=e(e=>e.masterVolume),[s,n]=Z.useState(-1/0),[i,a]=Z.useState(-1/0),[c,l]=Z.useState(!1),d=Z.useRef(0),m=Z.useRef(!0),u=Z.useCallback(r=>{e.getState().setMasterVolume(r),t().mixer.setMasterVolume(r)},[]);Z.useEffect(()=>{m.current=!0;const e=()=>{if(m.current){try{const e=t().mixer.getMasterLevel();if(Array.isArray(e)&&e.length>=2)n(e[0]),a(e[1]),l(e[0]>-1||e[1]>-1);else{const t="number"==typeof e?e:-1/0;n(t),a(t),l(t>-1)}}catch{}d.current=requestAnimationFrame(e)}};return d.current=requestAnimationFrame(e),()=>{m.current=!1,cancelAnimationFrame(d.current)}},[]);const b=Xr(s),p=Xr(i),x=Z.useCallback(e=>{if(e<=0)return"-âˆž";const t=20*Math.log10(e);return`${t>=-.5?"0":t.toFixed(0)}`},[]);return r.jsxDEV("div",{className:"flex flex-col items-center gap-1",title:"Master output",children:[r.jsxDEV(v,{value:o,min:0,max:1.5,onChange:u,label:"MST",size:"sm",color:"#ffffff",defaultValue:1,formatValue:x,title:"Master volume â€” controls overall output level"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:88,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex gap-[2px]",title:"Master stereo level meter (L/R)",children:[r.jsxDEV("div",{className:"flex flex-col items-center",children:[r.jsxDEV("span",{className:"text-text-muted text-[7px] font-mono leading-none mb-0.5",children:"L"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:105,columnNumber:11},void 0),r.jsxDEV("div",{className:"flex flex-col-reverse gap-[1px]",children:Array.from({length:8},(e,t)=>r.jsxDEV("div",{className:"rounded-[1px]",style:{width:5,height:4,backgroundColor:Sr(Math.round(12*t/8),t<Math.round(8*b/12)),transition:"background-color 0.05s"}},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:108,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:106,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:104,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex flex-col items-center",children:[r.jsxDEV("span",{className:"text-text-muted text-[7px] font-mono leading-none mb-0.5",children:"R"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:124,columnNumber:11},void 0),r.jsxDEV("div",{className:"flex flex-col-reverse gap-[1px]",children:Array.from({length:8},(e,t)=>r.jsxDEV("div",{className:"rounded-[1px]",style:{width:5,height:4,backgroundColor:Sr(Math.round(12*t/8),t<Math.round(8*p/12)),transition:"background-color 0.05s"}},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:127,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:125,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:123,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:102,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-center gap-0.5",title:"Limiter â€” lights red when output is clipping",children:[r.jsxDEV("div",{className:"rounded-full",style:{width:5,height:5,backgroundColor:c?"var(--color-error)":"var(--color-bg-tertiary)",transition:"background-color 0.1s"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:144,columnNumber:9},void 0),r.jsxDEV("span",{className:"text-text-muted text-[8px] font-mono",children:"LIM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:153,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:143,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerMaster.tsx",lineNumber:87,columnNumber:5},void 0)},Tr=()=>{const t=e(e=>e.decks.A.pflEnabled),o=e(e=>e.decks.B.pflEnabled),s=e(e=>e.cueVolume),n=e(e=>e.cueDeviceId),i=e(e=>e.setCueDevice),[a,c]=Z.useState([]),[l,d]=Z.useState(!1),m=Z.useRef({pflA:t,pflB:o,cueVolume:s});Z.useEffect(()=>{m.current={pflA:t,pflB:o,cueVolume:s}},[t,o,s]),Z.useEffect(()=>{d(N.supportsSetSinkId());(async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop())}catch(t){}const e=await N.getOutputDevices();c(e)})()},[]);const u=Z.useCallback(t=>{const r="A"===t?m.current.pflA:m.current.pflB;e.getState().setDeckPFL(t,!r)},[]),b=Z.useCallback(t=>{e.getState().setCueVolume(t)},[]),p=Z.useCallback(e=>{const t=e.target.value||null;i(t)},[i]);return r.jsxDEV("div",{className:"flex flex-col items-center gap-1.5",title:"Headphone cue section",children:[r.jsxDEV(v,{value:s,min:0,max:1.5,onChange:b,label:"CUE",size:"sm",color:"#ffcc00",defaultValue:1,title:"Cue volume â€” headphone pre-fader listen level"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:73,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex gap-1 items-center",children:[r.jsxDEV(nt,{size:10,className:"text-text-muted flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:87,columnNumber:9},void 0),r.jsxDEV("button",{onClick:()=>u("A"),title:`PFL Deck 1 â€” ${t?"disable":"enable"} headphone monitoring`,className:`\n            px-1.5 py-0.5 text-[9px] font-mono font-bold rounded transition-colors\n            ${t?"bg-accent-warning text-text-inverse":"bg-dark-bgTertiary text-text-muted border border-dark-borderLight hover:text-text-secondary"}\n          `,children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:88,columnNumber:9},void 0),r.jsxDEV("button",{onClick:()=>u("B"),title:`PFL Deck 2 â€” ${o?"disable":"enable"} headphone monitoring`,className:`\n            px-1.5 py-0.5 text-[9px] font-mono font-bold rounded transition-colors\n            ${o?"bg-accent-warning text-text-inverse":"bg-dark-bgTertiary text-text-muted border border-dark-borderLight hover:text-text-secondary"}\n          `,children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:102,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:86,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex flex-col items-center w-full gap-0.5",children:[r.jsxDEV("select",{value:n||"",onChange:p,className:"w-full px-1 py-0.5 text-[8px] font-mono bg-dark-bgTertiary text-text-secondary border border-dark-borderLight rounded hover:bg-dark-bgHover transition-colors cursor-pointer",title:"Select headphone output device",children:[r.jsxDEV("option",{value:"",children:"System Default"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:126,columnNumber:11},void 0),a.map(e=>r.jsxDEV("option",{value:e.deviceId,children:e.label||"Unknown Device"},e.deviceId,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:128,columnNumber:13},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:120,columnNumber:9},void 0),!l&&r.jsxDEV("span",{className:"text-[7px] text-accent-warning opacity-70",title:"setSinkId not supported - requires Chrome/Edge or Y-splitter cable",children:"âš  Y-splitter required"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:132,columnNumber:11},void 0),l&&r.jsxDEV("span",{className:"text-[7px] text-accent-success opacity-70",title:"Multi-output supported",children:"âœ“ Multi-output"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:137,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:119,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/MixerCueSection.tsx",lineNumber:71,columnNumber:5},void 0)},Jr=()=>{const t=e(e=>e.thirdDeckActive);return r.jsxDEV("div",{className:"\n        flex flex-col items-center gap-2 p-2\n        bg-dark-bg border border-dark-border rounded-lg h-full\n      ",children:[r.jsxDEV("div",{className:"flex items-center justify-center gap-4 w-full border-b border-dark-border pb-2",children:[r.jsxDEV(yr,{deckId:"A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:34,columnNumber:9},void 0),r.jsxDEV(yr,{deckId:"B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:35,columnNumber:9},void 0),t&&r.jsxDEV(yr,{deckId:"C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:36,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:33,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-end justify-center gap-1 w-full border-b border-dark-border pb-2",children:[r.jsxDEV(Cr,{deckId:"A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:41,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex gap-1 items-end mx-0.5",children:[r.jsxDEV(wr,{deckId:"A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:45,columnNumber:11},void 0),r.jsxDEV(wr,{deckId:"B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:46,columnNumber:11},void 0),t&&r.jsxDEV(wr,{deckId:"C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:47,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:44,columnNumber:9},void 0),r.jsxDEV(Cr,{deckId:"B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:50,columnNumber:9},void 0),t&&r.jsxDEV(Cr,{deckId:"C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:51,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:40,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-start justify-center gap-4 w-full border-b border-dark-border pb-2",children:[r.jsxDEV(Or,{deckId:"A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:56,columnNumber:9},void 0),r.jsxDEV("div",{className:"w-px bg-dark-borderLight self-stretch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:57,columnNumber:9},void 0),r.jsxDEV(Or,{deckId:"B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:58,columnNumber:9},void 0),t&&r.jsxDEV(r.Fragment,{children:[r.jsxDEV("div",{className:"w-px bg-dark-borderLight self-stretch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:61,columnNumber:13},void 0),r.jsxDEV(Or,{deckId:"C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:62,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:60,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:55,columnNumber:7},void 0),r.jsxDEV("div",{className:"w-full border-b border-dark-border pb-2",children:r.jsxDEV(Pr,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:69,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:68,columnNumber:7},void 0),r.jsxDEV("div",{className:"w-full border-b border-dark-border pb-2",children:r.jsxDEV(Ur,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:74,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:73,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex items-center justify-center gap-2 w-full",children:[r.jsxDEV(Ar,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:79,columnNumber:9},void 0),r.jsxDEV("div",{className:"w-px bg-dark-borderLight self-stretch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:80,columnNumber:9},void 0),r.jsxDEV(Tr,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:81,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:78,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJMixer.tsx",lineNumber:26,columnNumber:5},void 0)};async function Fr(e){return Me(e)}const Rr=({onClose:o})=>{const[s,n]=Z.useState([]),[i,a]=Z.useState(!1),[c,l]=Z.useState(null),[d,m]=Z.useState("name"),u=Z.useRef(null),b=Z.useCallback(async e=>{const t=e.target.files;if(!t)return;a(!0),l(null);const r=[];for(const s of Array.from(t))try{const e=await s.arrayBuffer(),t=s.name.split(".").pop()?.toLowerCase()??"";if(ze(s.name))r.push({name:s.name,bpm:0,duration:0,format:t.toUpperCase(),rawBuffer:e});else{const o=D(s.name),n=await _e(s),i=ke(n),a=Ue(n);ge(s.name,n);const c=await Fr(e);r.push({name:s.name,song:n,bpm:i.bpm,duration:a,format:t.toUpperCase(),rawBuffer:e,isUADE:o,isCached:c})}}catch(o){l(`Failed to load ${s.name}: ${o instanceof Error?o.message:"unknown error"}`)}n(e=>[...e,...r]),a(!1),u.current&&(u.current.value="")},[]),p=Z.useCallback(async(r,o)=>{const s=t();try{if(r.rawBuffer){if(!r.song)return await s.loadAudioToDeck(o,r.rawBuffer,r.name),void e.getState().setDeckViewMode("vinyl");if(r.isUADE){const t=await async function(t,r,o,s,n=!1,i,a){const c=await Pe(o);if(c){const e=await t.loadAudioToDeck(r,c.audioData,s,a||c.filename,i||c.bpm);return c.beatGrid||Ee().loadOrEnqueue(o,s,r,"normal").catch(e=>{}),{cached:!0,duration:e.duration}}if(n){const{parseModuleToSong:n}=await f(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},__vite__mapDeps([10,1,2,3,4,5,6])),c=new File([o],s),d=await n(c);await t.loadToDeck(r,d,s,i||125),e.getState().setDeckState(r,{analysisState:"rendering",isPlaying:!1});try{const e=await Ee().loadOrEnqueue(o,s,r,"high");return{cached:!0,duration:(await t.loadAudioToDeck(r,e.wavData,s,a||s,e.analysis?.bpm||i||125)).duration}}catch(l){throw l}}return{cached:!1,duration:0}}(s,o,r.rawBuffer,r.name,!0,r.bpm,r.song.name);e.getState().setDeckViewMode("visualizer"),n(e=>e.map(e=>e.name===r.name?{...e,isCached:t.cached}:e))}else{e.getState().setDeckState(o,{fileName:r.name,trackName:r.song.name||r.name,detectedBPM:r.bpm,effectiveBPM:r.bpm,analysisState:"rendering",isPlaying:!1});const t=await Ee().loadOrEnqueue(r.rawBuffer,r.name,o,"high");await s.loadAudioToDeck(o,t.wavData,r.name,r.song.name||r.name,t.analysis?.bpm||r.bpm,r.song),e.getState().setDeckViewMode("visualizer")}}}catch(i){l(`Failed to load to deck: ${i instanceof Error?i.message:"unknown error"}`)}},[]),x=Z.useCallback(e=>{n(t=>t.filter((t,r)=>r!==e))},[]),v=[...s].sort((e,t)=>{switch(d){case"bpm":return e.bpm-t.bpm;case"format":return e.format.localeCompare(t.format);default:return e.name.localeCompare(t.name)}});return r.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-3 flex flex-col gap-2 max-h-[400px]",children:[r.jsxDEV("div",{className:"flex items-center justify-between",children:[r.jsxDEV("h3",{className:"text-text-primary text-sm font-mono font-bold tracking-wider uppercase",children:"File Browser"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:176,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV("button",{onClick:()=>u.current?.click(),disabled:i,className:"flex items-center gap-1.5 px-3 py-1.5 bg-dark-bgTertiary border border-dark-borderLight\n                       rounded text-text-secondary text-xs font-mono hover:bg-dark-bgHover hover:text-text-primary\n                       transition-colors disabled:opacity-50",children:[i?r.jsxDEV(it,{size:12,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:187,columnNumber:24},void 0):r.jsxDEV(at,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:187,columnNumber:73},void 0),i?"Loading...":"Add Files"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:180,columnNumber:11},void 0),o&&r.jsxDEV("button",{onClick:o,className:"text-text-muted hover:text-text-primary p-1",children:r.jsxDEV(st,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:192,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:191,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:179,columnNumber:9},void 0),r.jsxDEV("input",{ref:u,type:"file",multiple:!0,accept:"*/*",onChange:b,className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:196,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:175,columnNumber:7},void 0),c&&r.jsxDEV("div",{className:"text-red-400 text-[10px] font-mono px-2 py-1 bg-red-900/20 rounded border border-red-900/30",children:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:208,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex gap-1 text-[10px] font-mono",children:["name","bpm","format"].map(e=>r.jsxDEV("button",{onClick:()=>m(e),className:"px-2 py-0.5 rounded transition-colors "+(d===e?"bg-dark-bgActive text-text-primary":"text-text-muted hover:text-text-secondary"),children:e.toUpperCase()},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:216,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:214,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex-1 overflow-y-auto min-h-0",children:0!==v.length||i?r.jsxDEV("div",{className:"flex flex-col gap-1",children:v.map((t,o)=>{return r.jsxDEV("div",{className:"flex items-center gap-2 px-2 py-1.5 bg-dark-bg rounded border border-dark-borderLight\n                           hover:border-dark-border transition-colors group",children:[r.jsxDEV("div",{className:"flex-1 min-w-0",children:[r.jsxDEV("div",{className:"flex items-center gap-1.5",children:[r.jsxDEV("div",{className:"text-text-primary text-xs font-mono truncate",children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:248,columnNumber:21},void 0),t.isCached&&r.jsxDEV("span",{className:"text-[8px] font-mono px-1 py-0.5 bg-green-900/30 text-green-400 rounded border border-green-700/30",children:"CACHED"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:250,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:247,columnNumber:19},void 0),r.jsxDEV("div",{className:"flex gap-3 text-[10px] text-text-muted font-mono",children:[r.jsxDEV("span",{children:t.format},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:256,columnNumber:21},void 0),t.bpm>0&&r.jsxDEV("span",{children:[t.bpm," BPM"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:257,columnNumber:38},void 0),t.duration>0&&r.jsxDEV("span",{children:(s=t.duration,`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,"0")}`)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:258,columnNumber:43},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:255,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:246,columnNumber:17},void 0),r.jsxDEV("button",{onClick:()=>{const e=h.getState().activePlaylistId;e&&h.getState().addTrack(e,{fileName:t.name,trackName:t.song?.name||t.name,format:t.format,bpm:t.bpm,duration:t.duration,addedAt:Date.now()})},className:"p-1 text-text-muted hover:text-amber-400 transition-colors\n                             opacity-0 group-hover:opacity-100",title:"Add to active playlist",children:r.jsxDEV(lt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:280,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:263,columnNumber:17},void 0),r.jsxDEV("button",{onClick:()=>p(t,"A"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                             bg-blue-900/30 text-blue-400 border border-blue-800/50\n                             hover:bg-blue-800/40 hover:text-blue-300 transition-colors\n                             opacity-0 group-hover:opacity-100",children:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:284,columnNumber:17},void 0),r.jsxDEV("button",{onClick:()=>p(t,"B"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                             bg-red-900/30 text-red-400 border border-red-800/50\n                             hover:bg-red-800/40 hover:text-red-300 transition-colors\n                             opacity-0 group-hover:opacity-100",children:"2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:293,columnNumber:17},void 0),e.getState().thirdDeckActive&&r.jsxDEV("button",{onClick:()=>p(t,"C"),className:"px-2 py-1 text-[10px] font-mono font-bold rounded\n                               bg-emerald-900/30 text-emerald-400 border border-emerald-800/50\n                               hover:bg-emerald-800/40 hover:text-emerald-300 transition-colors\n                               opacity-0 group-hover:opacity-100",children:"3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:303,columnNumber:19},void 0),r.jsxDEV("button",{onClick:()=>x(o),className:"p-0.5 text-text-muted hover:text-accent-error transition-colors\n                             opacity-0 group-hover:opacity-100",children:r.jsxDEV(st,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:318,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:313,columnNumber:17},void 0)]},`${t.name}-${o}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:240,columnNumber:15},void 0);var s})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:238,columnNumber:11},void 0):r.jsxDEV("div",{className:"flex flex-col items-center justify-center py-8 text-text-muted",children:[r.jsxDEV(ct,{size:24,className:"mb-2 opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:234,columnNumber:13},void 0),r.jsxDEV("p",{className:"text-xs font-mono",children:"Drop modules here or click Add Files"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:235,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:233,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:231,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJFileBrowser.tsx",lineNumber:173,columnNumber:5},void 0)},Ir=({className:e})=>{const[t,o]=Z.useState(null),[s,n]=Z.useState(!1);Z.useEffect(()=>{i()},[]);const i=async()=>{try{const e=await Xe();o(e)}catch(e){}};return t?r.jsxDEV("div",{className:`flex items-center gap-3 px-3 py-2 bg-dark-bgSecondary border border-dark-border rounded ${e||""}`,children:[r.jsxDEV(dt,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:61,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex-1 flex items-center gap-4 text-xs font-mono",children:[r.jsxDEV("span",{className:"text-text-secondary",children:[r.jsxDEV("span",{className:"text-text-primary font-bold",children:t.entryCount},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:66,columnNumber:11},void 0)," cached"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:65,columnNumber:9},void 0),r.jsxDEV("span",{className:"text-text-secondary",children:[r.jsxDEV("span",{className:"text-text-primary font-bold",children:t.sizeMB.toFixed(1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:70,columnNumber:11},void 0)," MB"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:69,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:64,columnNumber:7},void 0),t.entryCount>0&&r.jsxDEV("button",{onClick:async()=>{if(confirm("Clear all pre-rendered UADE audio cache? This cannot be undone.")){n(!0);try{await Se(),await i()}catch(e){}finally{n(!1)}}},disabled:s,className:"flex items-center gap-1.5 px-2 py-1 text-[10px] font-mono rounded\n                     bg-dark-bgTertiary border border-dark-borderLight\n                     hover:bg-red-900/20 hover:border-red-800/30 hover:text-red-400\n                     text-text-muted transition-colors disabled:opacity-50",title:"Clear cache",children:[s?r.jsxDEV(it,{size:10,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:87,columnNumber:13},void 0):r.jsxDEV(mt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:89,columnNumber:13},void 0),"Clear"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:77,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:59,columnNumber:5},void 0):r.jsxDEV("div",{className:`flex items-center gap-2 px-3 py-2 bg-dark-bgSecondary border border-dark-border rounded ${e||""}`,children:[r.jsxDEV(it,{size:14,className:"animate-spin text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:52,columnNumber:9},void 0),r.jsxDEV("span",{className:"text-xs font-mono text-text-muted",children:"Loading cache stats..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:53,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJCachePanel.tsx",lineNumber:51,columnNumber:7},void 0)},$r={scratch_baby:H,scratch_trans:q,scratch_flare:_,scratch_hydro:z,scratch_crab:$,scratch_orbit:I,scratch_chirp:R,scratch_stab:F,scratch_scribble:J,scratch_tear:T,scratch_uzi:A,scratch_twiddle:S,scratch_8crab:X,scratch_3flare:U,scratch_laser:P,scratch_phaser:M,scratch_tweak:O,scratch_drag:L,scratch_vibrato:w,scratch_stop:B,lfo_off:y,lfo_14:C,lfo_18:j,lfo_116:V,lfo_132:E},zr=({onClose:e})=>{const[t,o]=Z.useState({}),[s,n]=Z.useState(null),i=Z.useRef(new Set),a=Z.useRef(!1),c=Z.useRef(null),l=Z.useRef(null),{programs:d,currentProgramId:m,currentBank:u,setBank:b,loadProgram:p}=pt(),x=d.get(m),f=pt(e=>e.noteRepeatEnabled),v=pt(e=>e.noteRepeatRate),N=g(e=>e.bpm),D=pt(e=>e.busLevels);Z.useEffect(()=>{const e=Dt(),t=k(),r=t?.mixer.samplerInput??void 0;return c.current=new xt(e,r),l.current=new ft(c.current),pt.getState().loadFromIndexedDB(e),()=>{l.current?.dispose(),c.current?.dispose()}},[]),Z.useEffect(()=>{c.current&&x&&c.current.setMasterLevel(x.masterLevel)},[x?.masterLevel]),Z.useEffect(()=>{c.current&&x&&c.current.setMuteGroups(x.pads)},[x]),Z.useEffect(()=>{a.current=f,l.current?.setEnabled(f)},[f]),Z.useEffect(()=>{l.current?.setRate(v)},[v]),Z.useEffect(()=>{l.current?.setBpm(N)},[N]),Z.useEffect(()=>{if(c.current&&D)for(const[e,t]of Object.entries(D))c.current.setOutputLevel(e,t)},[D]);const h=Z.useCallback(async(e,t)=>{if(o(r=>({...r,[e]:t})),await ht(),x&&c.current){const r=x.pads.find(t=>t.id===e);r&&(r.scratchAction&&$r[r.scratchAction]?.(),r.sample&&c.current.triggerPad(r,t),"sustain"===r.playMode&&i.current.add(e),a.current&&l.current&&(l.current.startRepeat(r,t),i.current.add(e)))}setTimeout(()=>{o(t=>({...t,[e]:0}))},200)},[x]),E=Z.useCallback(e=>{if(i.current.has(e)&&(i.current.delete(e),l.current?.stopRepeat(e),x&&c.current)){const t=x.pads.find(t=>t.id===e);t&&"sustain"===t.playMode&&c.current.stopPad(e,t.release/1e3)}},[x]),V=Z.useMemo(()=>x?vt(x.pads,u):[],[x,u]),j=Z.useMemo(()=>Array.from(d.values()),[d]);if(!x)return null;const C=V.filter(e=>null!==e.sample).length;return r.jsxDEV("div",{className:"flex flex-col gap-1 bg-dark-bgSecondary border border-dark-border rounded-lg p-2",children:[r.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV("span",{className:"text-[10px] font-mono font-bold text-amber-400 uppercase tracking-wider",children:"Sampler"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:200,columnNumber:11},void 0),r.jsxDEV("select",{value:m,onChange:e=>p(e.target.value),className:"px-1.5 py-0.5 text-[10px] font-mono bg-dark-surface border border-dark-border rounded text-text-secondary cursor-pointer",children:j.map(e=>r.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:210,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:204,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:199,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex items-center gap-1.5",children:[["A","B","C","D"].map(e=>r.jsxDEV("button",{onClick:()=>b(e),className:"w-5 h-5 text-[9px] font-bold font-mono rounded transition-colors "+(u===e?"bg-amber-600 text-white":"bg-dark-surface border border-dark-border text-text-muted hover:text-white"),children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:217,columnNumber:13},void 0)),r.jsxDEV("span",{className:"text-[9px] font-mono text-text-muted ml-1",children:[C,"/16"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:229,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>c.current?.stopAll(),className:"px-1.5 py-0.5 text-[9px] font-mono text-red-400 hover:text-red-300 bg-dark-surface border border-dark-border rounded transition-colors",title:"Stop all",children:"â– "},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:232,columnNumber:11},void 0),r.jsxDEV("button",{onClick:e,className:"px-1.5 py-0.5 text-[9px] font-mono text-text-muted hover:text-white bg-dark-surface border border-dark-border rounded transition-colors",children:"âœ•"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:239,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:214,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:198,columnNumber:7},void 0),r.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:V.map(e=>r.jsxDEV(Nt,{pad:e,isSelected:s===e.id,velocity:t[e.id]||0,onTrigger:h,onRelease:E,onSelect:n,className:"!min-h-[40px] !text-[8px]"},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:251,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:249,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJSamplerPanel.tsx",lineNumber:196,columnNumber:5},void 0)},_r=Z.lazy(()=>f(()=>import("./MixerVestax3DView-C62mNShX.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),qr=Object.freeze(Object.defineProperty({__proto__:null,DJView:({onShowDrumpads:o})=>{const s=Z.useRef(null),n=Z.useRef(null),i=e(e=>e.setDJModeActive),a=e(e=>e.deckViewMode),c=e(e=>e.cycleDeckViewMode),l=e(e=>e.thirdDeckActive),d=e(e=>e.setThirdDeckActive),[m,u]=Z.useState(!1),[b,p]=Z.useState(!1),[x,v]=Z.useState(!1),[N,D]=Z.useState(!1),[h,k]=Z.useState(!1),[E,V]=Z.useState(!1);Z.useEffect(()=>{const{isPlaying:e,stop:r}=g.getState();return e&&r(),G().releaseAll(),n.current=t(),i(!0),()=>{i(!1),K(),Ae(),n.current=null;const e=G();e.setGlobalPlaybackRate(1),e.setGlobalDetune(0),e.releaseAll(),g.getState().setGlobalPitch(0)}},[i]),Z.useEffect(()=>{const t=n.current;if(!t)return;const r=e.subscribe(e=>e.decks.A.pflEnabled,e=>t.mixer.setPFL("A",e)),o=e.subscribe(e=>e.decks.B.pflEnabled,e=>t.mixer.setPFL("B",e)),s=e.subscribe(e=>e.decks.C.pflEnabled,e=>t.mixer.setPFL("C",e)),i=e.subscribe(e=>e.cueVolume,e=>t.cueEngine.setCueVolume(e)),a=e.subscribe(e=>e.cueDeviceId,e=>{e&&t.cueEngine.setCueDevice(e)});return()=>{r(),o(),s(),i(),a()}},[]),Te();const j=W(e=>e.masterEffects),C=Z.useMemo(()=>j.map(e=>`${e.id}:${e.enabled}:${e.type}`).join("|"),[j]);Z.useEffect(()=>{const e=n.current;e&&e.mixer.rebuildMasterEffects(j)},[C]);const y=Z.useCallback(async(r,o)=>{const s=window.electron?.fs;if(s)try{const n=await s.readFile(r.filePath),i=r.filePath.split(/[/\\]/).pop()||r.title,a=t(),c=`serato:${r.filePath}`,{isAudioFile:l}=await f(async()=>{const{isAudioFile:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.a);return{isAudioFile:e}},__vite__mapDeps([10,1,2,3,4,5,6]));if(l(i)){const t=await a.loadAudioToDeck(o,n.slice(0),i),{readSeratoMetadata:s}=await f(async()=>{const{readSeratoMetadata:e}=await import("./seratoMetadata-BC7XPZHT.js");return{readSeratoMetadata:e}},[]),l=s(n),d=l.bpm??(r.bpm>0?r.bpm:0);e.getState().setDeckState(o,{fileName:c,trackName:r.title||i.replace(/\.[^.]+$/,""),detectedBPM:d,effectiveBPM:d,totalPositions:0,songPos:0,pattPos:0,elapsedMs:0,isPlaying:!1,playbackMode:"audio",durationMs:1e3*t.duration,audioPosition:0,waveformPeaks:t.waveformPeaks,seratoCuePoints:l.cuePoints,seratoLoops:l.loops,seratoBeatGrid:l.beatGrid,seratoKey:r.key||l.key})}else{const{parseModuleToSong:t}=await f(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},__vite__mapDeps([10,1,2,3,4,5,6])),{detectBPM:s}=await f(async()=>{const{detectBPM:e}=await import("./DJKeyboardHandler-Dzr29xNs.js").then(e=>e.K);return{detectBPM:e}},__vite__mapDeps([9,1,2,3,4,5,6,10])),{cacheSong:l}=await f(async()=>{const{cacheSong:e}=await import("./DJKeyboardHandler-Dzr29xNs.js").then(e=>e.J);return{cacheSong:e}},__vite__mapDeps([9,1,2,3,4,5,6,10])),d=new File([n],i,{type:"application/octet-stream"}),m=await t(d),u=s(m);l(c,m),await a.loadToDeck(o,m,i,u.bpm),Ee().loadOrEnqueue(n.slice(0),i,o,"high").catch(e=>{});const{computeTrackerPeaks:b}=await f(async()=>{const{computeTrackerPeaks:e}=await import("./computeTrackerPeaks-DdWoXxa7.js");return{computeTrackerPeaks:e}},[]),p=b(m,800);e.getState().setDeckState(o,{fileName:c,trackName:m.name||r.title||i,detectedBPM:r.bpm>0?r.bpm:u.bpm,effectiveBPM:r.bpm>0?r.bpm:u.bpm,totalPositions:m.songLength,songPos:0,pattPos:0,elapsedMs:0,isPlaying:!1,playbackMode:"tracker",durationMs:0,audioPosition:0,waveformPeaks:p,seratoCuePoints:[],seratoLoops:[],seratoBeatGrid:[],seratoKey:null})}}catch(n){}},[]);return r.jsxDEV("div",{ref:s,className:"relative flex flex-col h-full w-full overflow-hidden select-none bg-dark-bg font-mono",children:[r.jsxDEV("div",{className:"flex items-center justify-between px-4 py-2 shrink-0 bg-dark-bgSecondary border-b border-dark-border",children:[r.jsxDEV("div",{className:"flex items-center gap-3",children:[r.jsxDEV("select",{value:"dj",onChange:t=>{const r=t.target.value;if("dj"!==r){if("vj"!==r){const{decks:r}=e.getState();if((r.A.isPlaying||r.B.isPlaying||r.C.isPlaying)&&!window.confirm("Audio is playing. Switch view? This will stop DJ playback."))return void(t.target.value="dj")}Q.getState().setActiveView(r)}},className:"px-2 py-0.5 text-[10px] font-bold tracking-widest uppercase bg-dark-bgTertiary text-text-muted border border-dark-border rounded hover:bg-dark-bgHover transition-colors cursor-pointer",title:"Switch view",children:[r.jsxDEV("option",{value:"tracker",children:"Tracker"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:270,columnNumber:13},void 0),r.jsxDEV("option",{value:"grid",children:"Grid"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:271,columnNumber:13},void 0),r.jsxDEV("option",{value:"pianoroll",children:"Piano Roll"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:272,columnNumber:13},void 0),r.jsxDEV("option",{value:"tb303",children:"TB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:273,columnNumber:13},void 0),r.jsxDEV("option",{value:"arrangement",children:"Arrangement"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:274,columnNumber:13},void 0),r.jsxDEV("option",{value:"dj",children:"DJ Mixer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:275,columnNumber:13},void 0),r.jsxDEV("option",{value:"drumpad",children:"Drum Pads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:276,columnNumber:13},void 0),r.jsxDEV("option",{value:"vj",children:"VJ View"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:277,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:250,columnNumber:11},void 0),r.jsxDEV("div",{className:"h-4 w-px bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:279,columnNumber:11},void 0),r.jsxDEV("span",{className:"font-mono text-sm font-bold tracking-widest uppercase text-accent-primary",children:"DEViLBOX DJ"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:280,columnNumber:11},void 0),r.jsxDEV("span",{className:"font-mono text-[10px] text-text-muted uppercase tracking-wider",children:"Dual Deck Mixer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:283,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:248,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV(Je,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:289,columnNumber:11},void 0),r.jsxDEV(Fe,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:290,columnNumber:11},void 0),r.jsxDEV("button",{onClick:c,className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+("vinyl"===a?"border-amber-500 bg-amber-900/20 text-amber-400":"3d"===a?"border-purple-500 bg-purple-900/20 text-purple-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),title:"Cycle deck view: Visualizer â†’ Vinyl â†’ 3D",children:"3d"===a?"3D":"vinyl"===a?"Vinyl":"Deck"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:291,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>d(!l),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(l?"border-emerald-500 bg-emerald-900/20 text-emerald-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),title:"Toggle 3rd deck (Deck C)",children:"Deck C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:304,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>k(!h),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(h?"border-accent-primary bg-dark-bgActive text-text-primary":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),title:"Open Master FX editor",children:"FX Editor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:315,columnNumber:11},void 0),o&&r.jsxDEV("button",{onClick:o,className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary",children:"Drumpads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:327,columnNumber:13},void 0),r.jsxDEV("button",{onClick:()=>V(!E),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(E?"border-amber-500 bg-amber-900/20 text-amber-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),title:"Toggle inline sampler pads (routes through DJ mixer)",children:"Sampler"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:334,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>u(!m),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(m?"border-accent-primary bg-dark-bgActive text-text-primary":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:"Browser"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:345,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>p(!b),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(b?"border-accent-primary bg-dark-bgActive text-text-primary":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:"Playlists"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:355,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>v(!x),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(x?"border-green-500 bg-green-900/20 text-green-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:"Modland"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:365,columnNumber:11},void 0),r.jsxDEV("button",{onClick:()=>D(!N),className:"px-3 py-1.5 rounded-md text-xs font-mono border transition-all\n              "+(N?"border-purple-500 bg-purple-900/20 text-purple-400":"border-dark-borderLight bg-dark-bgTertiary text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"),children:"Serato"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:375,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:288,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:247,columnNumber:7},void 0),(m||b||x||N)&&(()=>{const e=[m,b,x,N].filter(Boolean).length,t=e>=4?"grid grid-cols-4 gap-2":3===e?"grid grid-cols-3 gap-2":2===e?"grid grid-cols-2 gap-2":"";return r.jsxDEV("div",{className:"flex flex-col gap-2 shrink-0 px-2 pt-2 max-h-[25vh] overflow-auto",children:[r.jsxDEV(Ir,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:403,columnNumber:13},void 0),r.jsxDEV("div",{className:t,children:[m&&r.jsxDEV(Rr,{onClose:()=>u(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:408,columnNumber:17},void 0),b&&r.jsxDEV(Re,{onClose:()=>p(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:411,columnNumber:17},void 0),x&&r.jsxDEV(Ie,{onClose:()=>v(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:414,columnNumber:17},void 0),N&&r.jsxDEV($e,{onClose:()=>D(!1),onLoadTrackToDevice:y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:417,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:406,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:401,columnNumber:11},void 0)})(),E&&r.jsxDEV("div",{className:"shrink-0 px-2 pt-2",children:r.jsxDEV(zr,{onClose:()=>V(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:432,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:431,columnNumber:9},void 0),r.jsxDEV("div",{className:"flex-1 grid gap-2 p-2 overflow-hidden min-h-0 "+(l?"3d"===a?"grid-cols-[1fr_1fr_1fr_1fr]":"grid-cols-[1fr_280px_1fr_1fr]":"3d"===a?"grid-cols-[1fr_1fr_1fr]":"grid-cols-[1fr_280px_1fr]"),children:[r.jsxDEV("div",{className:"min-h-0 min-w-0 overflow-hidden",children:r.jsxDEV(Vr,{deckId:"A"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:450,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:449,columnNumber:9},void 0),r.jsxDEV("div",{className:"min-h-0 min-w-0 overflow-hidden",children:"3d"===a?r.jsxDEV(Z.Suspense,{fallback:r.jsxDEV("div",{className:"w-full h-full bg-black flex items-center justify-center text-text-muted text-xs",children:"Loading 3D mixer..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:456,columnNumber:33},void 0),children:r.jsxDEV(_r,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:457,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:456,columnNumber:13},void 0):r.jsxDEV(Jr,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:460,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:454,columnNumber:9},void 0),r.jsxDEV("div",{className:"min-h-0 min-w-0 overflow-hidden",children:r.jsxDEV(Vr,{deckId:"B"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:466,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:465,columnNumber:9},void 0),l&&r.jsxDEV("div",{className:"min-h-0 min-w-0 overflow-hidden",children:r.jsxDEV(Vr,{deckId:"C"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:472,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:471,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:439,columnNumber:7},void 0),r.jsxDEV(bt,{isOpen:h,onClose:()=>k(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:478,columnNumber:7},void 0),r.jsxDEV(ae,{style:{position:"absolute",inset:0,pointerEvents:"none",background:"transparent"},eventSource:s,eventPrefix:"client",gl:{alpha:!0,antialias:!0,powerPreference:"high-performance"},onCreated:({gl:e})=>{e.toneMapping=ce,e.toneMappingExposure=1.2,e.domElement.addEventListener("webglcontextlost",e=>e.preventDefault(),!1)},children:r.jsxDEV(It.Port,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:500,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:489,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dj/DJView.tsx",lineNumber:243,columnNumber:5},void 0)}},Symbol.toStringTag,{value:"Module"}));export{qr as D,It as V,gt as _};
