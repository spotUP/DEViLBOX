import{aB as e,aD as t,aC as n}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";function r(e,t){return e.getUint8(t)}function o(e,t){return e.getUint16(t,!1)}function a(e,t){return e.getUint32(t,!1)}const f=1024,s=[-50,50,50,-50];function i(e,t){return{offset:a(e,t),length:o(e,t+4),zero:r(e,t+6),volume:r(e,t+7),address:a(e,t+8),loopLength:o(e,t+12),dataStart:o(e,t+14)}}function u(e){if(e.byteLength<444)return!1;const t=new DataView(e);return 71===t.getUint8(0)&&76===t.getUint8(1)&&85===t.getUint8(2)&&69===t.getUint8(3)}function l(e,t){switch(e){case 0:default:return{effTyp:0,eff:0};case 1:return{effTyp:1,eff:t};case 2:return{effTyp:2,eff:t};case 3:return{effTyp:12,eff:127&t};case 4:return{effTyp:13,eff:t};case 5:return{effTyp:11,eff:t};case 6:return{effTyp:14,eff:0};case 7:return{effTyp:14,eff:1};case 8:return{effTyp:15,eff:t}}}async function p(a,u){const p=new DataView(a),c=new Uint8Array(a),m=[];for(let e=0;e<15;e++)m.push(i(p,16*e));const h=Math.max(1,Math.min(r(p,243),100)),g=[];for(let e=0;e<100;e++)g.push(o(p,244+2*e));const y=g.slice(0,h).map(e=>e/f),d=Math.max(0,...y)+1,T=new Map;function M(e){if(T.has(e))return T.get(e);const o=444+e*f,i=[];for(let f=0;f<4;f++){const e=[];for(let s=0;s<64;s++){const i=o+4*(4*s+f);if(i+3>=a.byteLength){e.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});continue}const u=r(p,i),c=r(p,i+1),m=r(p,i+2),h=r(p,i+3);let g=0;if(255===u&&254===c)g=97;else{const e=(15&u)<<8|c,r=t(e);g=e>0?n(r):0}const y=240&u|m>>4,d=15&m,T=h,{effTyp:M,eff:v}=l(d,T);e.push({note:g,instrument:y,volume:0,effTyp:M,eff:v,effTyp2:0,eff2:0})}i.push({id:`channel-${f}`,name:`Channel ${f+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:s[f],instrumentId:null,color:null,rows:e})}const c={id:`pattern-${e}`,name:`Pattern ${e}`,length:64,channels:i,importMetadata:{sourceFormat:"GMC",sourceFile:u,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:d,originalInstrumentCount:15}};return T.set(e,c),c}const v=[],w=new Map,C=[];for(const e of y)w.has(e)||(w.set(e,v.length),v.push(M(e))),C.push(w.get(e));const S=444+d*f,U=m.map((t,n)=>{const r=n+1,o=`Sample ${r}`,f=2*t.length,s=t.loopLength>2,i=2*t.loopLength,u=s?f-i:0,l=s?f:0,p=t.dataStart;if(0===f)return{id:r,name:o,type:"sample",synthType:"Sampler",effects:[],volume:-60,pan:0};let h=S;for(let e=0;e<n;e++)h+=2*m[e].length;const g=h+p,y=Math.max(0,f-p);if(g+y>a.byteLength||0===y)return{id:r,name:o,type:"sample",synthType:"Sampler",effects:[],volume:-60,pan:0};const d=c.subarray(g,g+y),T=s?Math.max(0,u-p):0,M=s?Math.max(0,l-p):0;return e(r,o,d,t.volume,8287,s?T:0,s?M:0)});return{name:u.replace(/\.[^/.]+$/,""),format:"MOD",patterns:v,instruments:U,songPositions:C,songLength:C.length,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{u as isGMCFormat,p as parseGMCFile};
